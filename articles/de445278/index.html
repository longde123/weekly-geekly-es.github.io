<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßõ üéûÔ∏è ‚õ¥Ô∏è So erstellen Sie ein Spiel, wenn Sie noch nie K√ºnstler sind üîõ üê∏ üßü</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Es gab Momente im Leben eines jeden Programmierers, in denen er davon tr√§umte, ein interessantes Spiel zu machen. Viele Programmierer verwirklichen di...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>So erstellen Sie ein Spiel, wenn Sie noch nie K√ºnstler sind</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445278/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/96/hp/x0/96hpx0qpk4w0_hmjm3csu0lj92o.png"></div><br>  Es gab Momente im Leben eines jeden Programmierers, in denen er davon tr√§umte, ein interessantes Spiel zu machen.  Viele Programmierer verwirklichen diese Tr√§ume und sogar erfolgreich, aber es geht nicht um sie.  Es geht um diejenigen, die gerne Spiele spielen, die (auch ohne Wissen und Erfahrung) einmal versucht haben, sie zu erschaffen, inspiriert von Beispielen einzelner Helden, die weltweiten Ruhm (und enorme Gewinne) erlangt haben, dies aber tief im Inneren verstanden haben konkurriere mit dem Guru igrostroya, den er sich nicht leisten kann. <br><br>  Und nicht ... <br><a name="habracut"></a><br><h2>  Kleine Einf√ºhrung </h2><br>  Ich werde sofort reservieren: Unser Ziel ist es nicht, Geld zu verdienen - es gibt viele Artikel zu diesem Thema auf Habr√©.  Nein, wir werden ein Traumspiel machen. <br><br><div class="spoiler">  <b class="spoiler_title">Lyrischer Exkurs √ºber das Spiel der Tr√§ume</b> <div class="spoiler_text">  Wie oft habe ich dieses Wort von einzelnen Entwicklern und kleinen Studios geh√∂rt.  Wo auch immer Sie hinschauen, alle Neulinge igrodelov beeilen sich, der Welt ihre Tr√§ume und ihre ‚Äûperfekte Vision‚Äú zu offenbaren, und schreiben dann lange Artikel √ºber ihre heldenhaften Bem√ºhungen, ihren Arbeitsprozess, unvermeidliche finanzielle Schwierigkeiten, Probleme mit Verlagen und im Allgemeinen ‚ÄûSpieler-undankbare-Hunde-im- Gib-Grafik-und-M√ºnzen-und-alles-frei-und-bezahle-will-kein-Spiel-Piraten-und-wir-haben-Gewinne-wegen-ihnen-hier verloren. " <br><br>  Leute, lasst euch nicht t√§uschen.  Sie machen kein Traumspiel, sondern ein Spiel, das sich gut verkaufen wird - das sind zwei verschiedene Dinge.  Spieler (und besonders anspruchsvolle) k√ºmmern sich nicht um Ihren Traum und werden ihn nicht bezahlen.  Wenn Sie Gewinne erzielen m√∂chten - Trends studieren, sehen, was jetzt beliebt ist, etwas Einzigartiges tun, besser, ungew√∂hnlicher als andere, Artikel lesen (es gibt viele), mit Verlagen kommunizieren - im Allgemeinen die Tr√§ume der Endbenutzer verwirklichen, nicht Ihrer. <br><br>  Wenn Sie noch nicht weggelaufen sind und Ihr Traumspiel noch verwirklichen m√∂chten, geben Sie den Gewinn im Voraus auf.  Verkaufen Sie Ihren Traum √ºberhaupt nicht - teilen Sie ihn kostenlos.  Geben Sie den Menschen Ihren Traum, bringen Sie sie dazu, und wenn Ihr Traum etwas wert ist, erhalten Sie, wenn nicht Geld, aber Liebe und Anerkennung.  Das ist manchmal viel wertvoller. <br></div></div><br>  Viele Leute denken, dass Spiele Zeit- und Energieverschwendung sind und dass ernsthafte Leute √ºberhaupt nicht √ºber dieses Thema sprechen sollten.  Aber die Leute, die sich hier versammelt haben, sind nicht ernst, deshalb sind wir uns nur teilweise einig - Spiele brauchen wirklich viel Zeit, wenn Sie sie spielen.  Die Entwicklung von Spielen kann jedoch viele Vorteile bringen, obwohl sie um ein Vielfaches l√§nger dauert.  So k√∂nnen Sie sich beispielsweise mit den Prinzipien, Ans√§tzen und Algorithmen vertraut machen, die bei der Entwicklung von Nicht-Gaming-Anwendungen nicht zu finden sind.  Oder vertiefen Sie die F√§higkeiten, Werkzeuge (z. B. eine Programmiersprache) zu besitzen und etwas Ungew√∂hnliches und Aufregendes zu tun.  Ich selbst kann hinzuf√ºgen (und viele werden zustimmen), dass die Spieleentwicklung (auch wenn sie nicht erfolgreich ist) immer eine besondere, unvergleichliche Erfahrung ist, an die Sie sich dann mit Besorgnis und Liebe erinnern, die ich f√ºr jeden Entwickler mindestens einmal in meinem Leben erleben m√∂chte. <br><br>  Wir werden keine neuen Game-Engines, Frameworks und Bibliotheken verwenden - wir werden die Essenz des Gameplays betrachten und es von innen heraus sp√ºren.  Wir geben flexible Entwicklungsmethoden auf (die Aufgabe wird durch die Notwendigkeit vereinfacht, die Arbeit von nur einer Person zu organisieren).  Wir werden keine Zeit und Energie darauf verwenden, nach Designern, K√ºnstlern, Komponisten und Spezialisten f√ºr Klang zu suchen - wir werden alles selbst tun, wie wir k√∂nnen (aber gleichzeitig werden wir alles mit Bedacht tun - wenn wir pl√∂tzlich einen K√ºnstler haben, werden wir uns nicht viel M√ºhe geben, das Modische zu befestigen Grafiken auf dem fertigen Rahmen).  Am Ende werden wir die Tools nicht einmal wirklich studieren und das richtige ausw√§hlen - wir werden es mit dem tun, das wir kennen und wie wir es verwenden k√∂nnen.  Zum Beispiel in Java, damit Sie es sp√§ter, falls erforderlich, auf Android (oder eine Kaffeemaschine) √ºbertragen k√∂nnen. <br><br>  <i>‚ÄûAh !!!</i>  <i>Horror!</i>  <i>Ein Albtraum!</i>  <i>Wie kannst du Zeit mit so einem Unsinn verbringen!</i>  <i>Verschwinde von hier, ich werde etwas Interessanteres lesen! ‚Äú</i> <br><br>  Warum das?  Ich meine, das Rad neu erfinden?  Warum nicht eine vorgefertigte Spiel-Engine verwenden?  Die Antwort ist einfach: Wir wissen nichts √ºber ihn, aber wir wollen das Spiel jetzt.  Stellen Sie sich die Denkweise eines durchschnittlichen Programmierers vor: ‚ÄûIch m√∂chte ein Spiel machen!  Es wird Fleisch und Explosionen geben und pumpen, <s>und Sie k√∂nnen einen Korovan ausrauben</s> , und die Verschw√∂rung bombardiert, und das ist nirgendwo anders passiert!  Ich fange gleich an zu schreiben! .. Und worauf?  Mal sehen, was jetzt bei uns beliebt ist ... Ja, X, Y und Z. Nehmen wir Z, jetzt schreibt jeder dar√ºber ... ".  Und beginnt den Motor zu studieren.  Und er wirft die Idee auf, weil daf√ºr schon nicht genug Zeit ist.  Fin.  Oder, okay, es gibt nicht auf, aber ohne die Engine wirklich zu lernen, wird es f√ºr das Spiel genommen.  Nun, wenn er dann das Gewissen hat, niemandem sein erstes "Handwerk" zu zeigen.  Normalerweise nicht (gehen Sie in einen Anwendungsspeicher, √ºberzeugen Sie sich selbst) - nun, ich m√∂chte Gewinne, keine Kraft zum Aushalten.  Einmal war die Schaffung von Spielen die Menge der begeisterten kreativen Menschen.  Leider ist diese Zeit unwiderruflich vergangen - jetzt ist die Hauptsache im Spiel nicht die Seele, sondern das Gesch√§ftsmodell (zumindest gibt es viel mehr Gespr√§che dar√ºber).  Unser Ziel ist einfach: Wir werden mit der Seele spielen.  Daher abstrahieren wir vom Tool (jeder wird es tun) und konzentrieren uns auf die Aufgabe. <br><br>  Also, lass uns weitermachen. <br>  Ich werde nicht auf die Details meiner eigenen bitteren Erfahrung eingehen, aber ich werde sagen, dass eines der Hauptprobleme f√ºr einen Programmierer bei der Entwicklung von Spielen die Grafik ist.  Programmierer wissen normalerweise nicht, wie man zeichnet (obwohl es Ausnahmen gibt), und K√ºnstler wissen normalerweise nicht, wie man programmiert (obwohl es Ausnahmen gibt).  Und ohne Grafik muss man zugeben, dass ein seltenes Spiel umgangen wird.  Was tun? <br><br>  Es gibt Optionen: <br><br><div class="spoiler">  <b class="spoiler_title">1. Zeichnen Sie alles selbst in einem einfachen grafischen Editor</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/5b/no/-o/5bno-orbfc3-ov3esi3ld_ezdqs.png"></a> <br>  <i>Screenshots des Spiels "Kill Him All", 2003</i> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">2. Zeichnen Sie alles selbst in einen Vektor</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/46/dj/u8/46dju8rama3wvfx2fzopin-yfiw.png"></a> <br>  <i>Screenshots des Spiels "Raven", 2001</i> <br><br> <a href=""><img src="https://habrastorage.org/webt/jn/mm/vz/jnmmvzujgfsziasffz8m6sitmi0.png"></a> <br>  <i>Screenshots des Spiels "Inferno", 2002</i> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">3. Fragen Sie einen Bruder, der auch nicht zeichnen kann (aber etwas besser macht).</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/tf/tx/jc/tftxjcy5luf045ehrm5_kdb5fzy.png"></a> <br>  <i>Screenshots des Spiels "Fucking", 2004</i> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">4. Laden Sie ein Programm f√ºr die 3D-Modellierung herunter und ziehen Sie Assets von dort</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/k9/nj/o6/k9njo6wryhhmaiagpool44qt5ua.jpeg"></a> <br>  <i>Screenshots des Spiels "Fucking 2. Demo", 2006</i> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">5. In der Verzweiflung Haare auf den Kopf rei√üen</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/3p/fw/01/3pfw013bspmxrjyyewsnsgqobma.png"></a> <br> <a href=""><img src="https://habrastorage.org/webt/oa/gx/go/oagxgo1wmfykrll-ji-qwyrsv7e.png"></a> <br>  <i>Screenshots des Spiels "Fucking", 2004</i> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">6. Zeichnen Sie alles selbst in Pseudografien (ASCII)</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/db/ht/s5/dbhts5ryeccznntuaiiwjmx32fo.png"></a> <br>  <i>Screenshots des Spiels "Fifa", 2000</i> <br><br> <a href=""><img src="https://habrastorage.org/webt/q0/u-/vu/q0u-vuxozevapmdwswaygicakgg.png"></a> <br>  <i>Screenshots des Spiels "Sumo", 1998</i> <br></div></div><br>  Lassen Sie uns auf Letzteres eingehen (zum Teil, weil es nicht so deprimierend aussieht wie die anderen).  Viele unerfahrene Spieler glauben, dass Spiele ohne coole moderne Grafik nicht die Herzen der Spieler erobern k√∂nnen - selbst der Name des Spiels macht sie nicht einmal zu Spielen.  Entwickler von Meisterwerken wie <i>ADOM</i> , <i>NetHack</i> und <i>Dwarf Fortress</i> <i>lehnen</i> solche Argumente stillschweigend ab.  Das Aussehen ist nicht immer ein entscheidender Faktor, die Verwendung von <abbr title="Amerikanischer Standardcode f√ºr den Informationsaustausch">ASCII</abbr> bietet einige interessante Vorteile: <br><br><ul><li>  W√§hrend des Entwicklungsprozesses konzentriert sich der Programmierer auf das Gameplay, die Spielmechanik, die Handlungskomponente und vieles mehr, ohne von kleinen Dingen abgelenkt zu werden. </li><li>  Das Entwickeln einer Grafikkomponente nimmt nicht zu viel Zeit in Anspruch - ein funktionierender Prototyp (dh eine Version durch Spielen, die Sie verstehen k√∂nnen, aber es lohnt sich, fortzufahren) wird viel fr√ºher fertig sein. </li><li>  keine Notwendigkeit, Frameworks und Grafik-Engines zu lernen; </li><li>  Ihre Grafiken werden in den f√ºnf Jahren, in denen Sie das Spiel entwickeln, nicht veraltet sein. </li><li>  Hardcore-Mitarbeiter k√∂nnen Ihr Produkt auch auf Plattformen ohne grafische Umgebung bewerten. </li><li>  Wenn alles richtig gemacht ist, k√∂nnen die coolen Grafiken sp√§ter, sp√§ter befestigt werden. </li></ul><br>  Die obige lange Einf√ºhrung sollte dem Anf√§nger igrodelov helfen, √Ñngste und Vorurteile zu √ºberwinden, sich keine Sorgen mehr zu machen und dennoch zu versuchen, so etwas zu tun.  Bist du bereit  Dann fangen wir an. <br><br><h2>  <font color="#0474a0">Erster Schritt.</font>  <font color="#0474a0">Idee</font> </h2><br>  Wie?  Hast du noch keine Ahnung? <br><br>  Schalten Sie den Computer aus, gehen Sie essen, gehen Sie, trainieren Sie.  Oder im schlimmsten Fall schlafen.  Ein Spiel zu entwickeln bedeutet nicht, Fenster zu waschen - Einsicht in den Prozess kommt nicht.  Normalerweise entsteht die Idee eines Spiels pl√∂tzlich und unerwartet, wenn Sie √ºberhaupt nicht dar√ºber nachdenken.  Wenn dies pl√∂tzlich passiert ist, schnappen Sie sich schneller einen Bleistift und schreiben Sie auf, bis die Idee wegflog.  Jeder kreative Prozess wird auf diese Weise implementiert. <br><br>  Und Sie k√∂nnen die Spiele anderer Leute kopieren.  Nun, kopiere.  Nat√ºrlich nicht schamlos rei√üen und an jeder Ecke sagen, wie schlau Sie sind, sondern die Erfahrung anderer in Ihrem Produkt nutzen.  Wie viel danach speziell von Ihrem Traum √ºbrig bleibt, ist eine sekund√§re Frage, denn oft haben Spieler dies: Sie m√∂gen alles im Spiel, bis auf zwei oder drei nervige Dinge, aber wenn es anders gemacht w√ºrde ... Wer wei√ü Vielleicht ist es Ihr Traum, sich an die gute Idee eines Menschen zu erinnern. <br><br>  Aber wir werden den einfachen Weg gehen - nehmen wir an, wir haben bereits eine Idee und haben lange nicht dar√ºber nachgedacht.  Als unser erstes grandioses Projekt werden wir einen Klon eines guten Spiels aus Obsidian - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Pathfinder Adventures erstellen</a> . <br><br>  <i>‚ÄûWas zum Teufel ist das?</i>  <i>Irgendwelche Tische? "</i> <br><br>  Wie sie sagen, <i>pourquoi pas?</i>  Wir scheinen Vorurteile bereits aufgegeben zu haben und beginnen mutig, die Idee zu verfeinern.  Nat√ºrlich werden wir das Spiel nicht eins zu eins klonen, aber wir werden die Grundmechanik ausleihen.  Dar√ºber hinaus hat die Implementierung eines rundenbasierten Brettspiels seine Vorteile: <br><br><ul><li>  Es ist Schritt f√ºr Schritt - so k√∂nnen Sie sich keine Gedanken √ºber Timer, Synchronisation, Optimierung, FPS und andere trostlose Dinge machen. </li><li>  Es ist kooperativ, dh der oder die Spieler treten nicht gegeneinander an, sondern gegen eine bestimmte "Umgebung", die nach deterministischen Regeln spielt. Dadurch entf√§llt die Notwendigkeit, <abbr title="K√ºnstliche Intelligenz">KI</abbr> ( <abbr title="K√ºnstliche Intelligenz">KI</abbr> ) zu programmieren - eine der schwierigsten Phasen der Spieleentwicklung. </li><li>  Es ist sinnvoll - die Tischplatten sind im Allgemeinen skurrile Leute, sie spielen nichts: Geben Sie ihnen durchdachte Mechanik und interessantes Gameplay - Sie werden nicht in einem sch√∂nen Bild ausgehen (es gibt Freunden etwas, oder?); </li><li>  es ist mit der Handlung - viele E-Sportler werden nicht zustimmen, aber f√ºr mich pers√∂nlich sollte das Spiel eine interessante Geschichte erz√§hlen - wie ein Buch, nur mit seinen speziellen k√ºnstlerischen Mitteln. </li><li>  Sie ist unterhaltsam, was nicht jedermanns Sache ist. Die beschriebenen Ans√§tze k√∂nnen auf jeden nachfolgenden Traum angewendet werden, egal wie viele Sie haben. </li></ul><br><div class="spoiler">  <b class="spoiler_title">F√ºr diejenigen, die mit den Regeln nicht vertraut sind, eine kurze Einf√ºhrung:</b> <div class="spoiler_text">  <b>Pathfinder Adventures</b> ist eine digitale Version eines Brettspiels, das auf der Grundlage eines Brettspiels (oder vielmehr eines gesamten Rollenspielsystems) Pathfinder erstellt wurde.  Spieler (in H√∂he von 1 bis 6) w√§hlen einen Charakter f√ºr sich selbst aus und begeben sich zusammen mit ihm auf ein Abenteuer, das in verschiedene Szenarien unterteilt ist.  Jeder Charakter verf√ºgt √ºber Karten verschiedener Art (wie Waffen, R√ºstungen, Zauber, Verb√ºndete, Gegenst√§nde usw.), mit deren Hilfe er in jedem Szenario den Schurken finden und brutal bestrafen muss - eine spezielle Karte mit besonderen Eigenschaften. <br><br>  Jedes Szenario bietet eine Reihe von Orten oder Orten (deren Anzahl von der Anzahl der Spieler abh√§ngt), die die Spieler besuchen und erkunden m√ºssen.  Jeder Ort enth√§lt ein verdecktes Kartenspiel, das die Charaktere abwechselnd erkunden - das hei√üt, sie √∂ffnen die oberste Karte und versuchen, sie gem√§√ü den einschl√§gigen Regeln zu √ºberwinden.  Zus√§tzlich zu harmlosen Karten, die das Deck des Spielers auff√ºllen, enthalten diese Decks auch b√∂se Feinde und Hindernisse - sie m√ºssen besiegt werden, um weiter voranzukommen.  Die Schurkenkarte liegt ebenfalls in einem der Decks, aber die Spieler wissen nicht, welches - sie muss gefunden werden. <br><br>  Um die Karten zu besiegen (und neue zu erwerben), m√ºssen die Charaktere den Test einer ihrer Eigenschaften (Standard f√ºr RPGs, St√§rke, Geschicklichkeit, Weisheit usw.) bestehen, indem sie einen W√ºrfel werfen, dessen Gr√∂√üe durch den Wert der entsprechenden Eigenschaft (von d4 bis d12) bestimmt wird, und Modifikatoren hinzuf√ºgen (definiert) Regeln und das Niveau der Charakterentwicklung) und spielen, um die Wirkung der entsprechenden Karten aus der Hand zu verbessern.  Nach dem Sieg wird die getroffene Karte entweder aus dem Spiel entfernt (wenn es sich um einen Feind handelt) oder die Hand eines Spielers wird wieder aufgef√ºllt (wenn es sich um einen Gegenstand handelt) und der Zug geht an einen anderen Spieler.  Wenn er verliert, wird der Charakter oft besch√§digt, was dazu f√ºhrt, dass er Karten von seiner Hand abwirft.  Ein interessanter Mechanismus ist, dass die Gesundheit des Charakters durch die Anzahl der Karten in seinem Deck bestimmt wird. Sobald der Spieler eine Karte aus dem Deck ziehen muss, diese aber nicht da ist, stirbt sein Charakter. <br><br>  Das Ziel ist es, den Schurken zu finden und zu besiegen, nachdem er zuvor seinen Weg zum R√ºckzug blockiert hatte (Sie k√∂nnen mehr dar√ºber und vieles mehr erfahren, indem Sie die Regeln lesen).  Dies muss f√ºr eine Weile gemacht werden, was die Hauptschwierigkeit des Spiels ist.  Die Anzahl der Z√ºge ist streng begrenzt und eine einfache Aufz√§hlung aller verf√ºgbaren Karten erreicht das Ziel nicht.  Daher m√ºssen Sie verschiedene Tricks und clevere Techniken anwenden. <br><br>  Wenn die Szenarien erf√ºllt sind, werden die Charaktere wachsen und sich entwickeln, ihre Eigenschaften verbessern und neue n√ºtzliche F√§higkeiten erwerben.  Das Verwalten des Decks ist auch ein sehr wichtiges Element des Spiels, da das Ergebnis des Szenarios (insbesondere in den sp√§teren Phasen) normalerweise von richtig ausgew√§hlten Karten abh√§ngt (und von viel Gl√ºck, aber was wollen Sie von einem Spiel mit W√ºrfeln?). </div></div><br>  Im Allgemeinen ist das Spiel interessant, w√ºrdig, bemerkenswert und, was f√ºr uns wichtig ist, ziemlich kompliziert (beachten Sie, dass ich "schwierig" sage, nicht im Sinne von "schwierig"), um es interessant zu machen, seinen Klon zu implementieren. <br><br>  In unserem Fall werden wir eine globale konzeptionelle √Ñnderung vornehmen - wir werden die Karten aufgeben.  Vielmehr werden wir uns √ºberhaupt nicht weigern, aber wir werden die Karten durch W√ºrfel ersetzen, die immer noch unterschiedliche Gr√∂√üen und Farben haben (technisch gesehen ist es nicht ganz richtig, ihre "W√ºrfel" zu verwenden, da es neben dem richtigen Sechseck noch andere Formen gibt, aber es ist ungew√∂hnlich, dass ich sie "Knochen" nenne. und es ist unangenehm, aber amerikanisches G√§nsebl√ºmchen zu verwenden ist ein Zeichen f√ºr schlechten Geschmack. Lassen wir es also so, wie es ist.  Anstelle von Decks haben die Spieler jetzt Taschen.  Und die Standorte werden auch Taschen haben, aus denen die Spieler im Forschungsprozess beliebige W√ºrfel herausziehen werden.  Die Farbe des W√ºrfels bestimmt seinen Typ und dementsprechend die Regeln f√ºr das Bestehen des Tests.  Die pers√∂nlichen Eigenschaften des Charakters (St√§rke, Geschicklichkeit usw.) werden dadurch beseitigt, aber es werden neue interessante Mechaniken auftauchen (dazu sp√§ter mehr). <br><br>  Wird es Spa√ü machen zu spielen?  Ich habe keine Ahnung, und niemand kann dies verstehen, bis ein funktionierender Prototyp fertig ist.  Aber wir m√∂gen nicht das Spiel, sondern die Entwicklung, oder?  Daher sollte kein Zweifel am Erfolg bestehen. <br><br><h2>  <font color="#0474a0">Schritt zwei</font>  <font color="#0474a0">Design</font> </h2><br>  Eine Idee zu haben ist nur ein Drittel der Geschichte.  Jetzt ist es wichtig, diese Idee zu entwickeln.  Das hei√üt, machen Sie keinen Spaziergang im Park oder nehmen Sie ein Dampfbad, sondern setzen Sie sich an den Tisch, nehmen Sie Papier mit einem Stift (oder √∂ffnen Sie Ihren bevorzugten Texteditor) und schreiben Sie sorgf√§ltig ein Designdokument, wobei Sie jeden Aspekt der Spielmechanik sorgf√§ltig ausarbeiten.  Die Zeit daf√ºr wird einen Durchbruch bringen. Erwarten Sie also nicht, das Schreiben in einer Sitzung abzuschlie√üen.  Und hoffen Sie nicht einmal, alles auf einmal durchzudenken - w√§hrend Sie implementieren, werden Sie die Notwendigkeit erkennen, eine Reihe von √Ñnderungen und √Ñnderungen vorzunehmen (und manchmal etwas global zu √ºberarbeiten), aber einige Grundlagen m√ºssen vorhanden sein, bevor der Entwicklungsprozess beginnt. <br><br><div class="spoiler">  <b class="spoiler_title">Ihr Designdokument sieht zun√§chst ungef√§hr so ‚Äã‚Äãaus</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/oi/qw/fp/oiqwfpjf6vasnpmy6ucqglbnwy8.jpeg"></a> <br><br> <a href=""><img src="https://habrastorage.org/webt/ff/gu/7q/ffgu7qx80qefetycgrmdraoetv8.jpeg"></a> <br></div></div><br>  Und erst nachdem Sie mit der ersten Welle grandioser Ideen fertig geworden sind, nehmen Sie den Kopf auf, entscheiden sich f√ºr die Struktur des Dokuments und beginnen, es methodisch mit Inhalten zu f√ºllen (√ºberpr√ºfen Sie jede Sekunde mit dem, was bereits geschrieben wurde, um unn√∂tige Wiederholungen und insbesondere Widerspr√ºche zu vermeiden).  Schritt f√ºr Schritt erhalten Sie so etwas Sinnvolles und Pr√§gnantes. <br><br>  W√§hlen Sie bei der Beschreibung des Designs die Sprache, in der Sie Ihre Gedanken leichter ausdr√ºcken k√∂nnen, insbesondere wenn Sie alleine arbeiten.  Wenn Sie jemals Entwickler von Drittanbietern in das Projekt einbeziehen m√ºssen, stellen Sie sicher, dass diese den ganzen kreativen Unsinn verstehen, der in Ihrem Kopf vor sich geht. <br><br>  Um fortzufahren, empfehle ich dringend, dass Sie das zitierte Dokument zumindest diagonal lesen, da ich in Zukunft auf die dort vorgestellten Begriffe und Konzepte verweisen werde, ohne n√§her auf deren Interpretation einzugehen. <br><br>  <i>‚ÄûAutor, t√∂te dich gegen die Wand.</i>  <i>Zu viele Buchstaben. "</i> <br><br><h2>  <font color="#0474a0">Schritt drei</font>  <font color="#0474a0">Modellierung</font> </h2><br>  Das hei√üt, alle das gleiche Design, nur detaillierter. <br>  Ich wei√ü, dass viele bereits darauf aus sind, eine IDE zu √∂ffnen und mit dem Codieren zu beginnen, aber seien Sie etwas geduldiger.  Wenn Ideen unsere K√∂pfe √ºberw√§ltigen, scheint es uns, dass wir nur die Tastatur ber√ºhren m√ºssen und unsere H√§nde in himmelhohe Entfernungen rasen - bevor der Kaffee Zeit hat, auf dem Herd zu kochen, wenn die funktionierende Version der Anwendung fertig ist ... um in den Papierkorb zu gelangen.  Um das Gleiche nicht viele Male neu zu schreiben (und insbesondere nach drei Stunden Entwicklungszeit nicht sicherzustellen, dass das Layout nicht funktioniert und neu gestartet werden muss), empfehle ich, zun√§chst die Hauptstruktur der Anwendung zu √ºberdenken (und zu dokumentieren). <br><br>  Da wir als Entwickler mit objektorientierter Programmierung (OOP) gut vertraut sind, werden wir deren Prinzipien in unserem Projekt verwenden.  F√ºr OOP gibt es jedoch nichts Besseres, als mit einer Reihe langweiliger UML-Diagramme mit der Entwicklung zu beginnen.  (Sie wissen nicht, was <abbr title="Einheitliche Modellierungssprache">UML ist</abbr> ? Ich habe es auch fast vergessen, aber ich werde mich gerne daran erinnern - nur um zu zeigen, was f√ºr ein flei√üiger Programmierer ich bin, hehe.) <br><br>  Beginnen wir mit dem Anwendungsfalldiagramm.  Wir werden darauf zeigen, wie unser Benutzer (Spieler) mit dem zuk√ºnftigen System interagiert: <br><br><div class="spoiler">  <b class="spoiler_title">Anwendungsf√§lle</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/rt/ph/st/rtphstumyokd9_gnpgzoewpaux8.png"></a> <br></div></div><br>  <i>"√Ñh ... worum geht es?"</i> <br><br>  Nur ein Scherz, nur ein Scherz ... und vielleicht h√∂re ich auf, dar√ºber zu scherzen - das ist eine ernste Angelegenheit (schlie√ülich ein Traum).  Im Diagramm der Anwendungsf√§lle m√ºssen die M√∂glichkeiten angezeigt werden, die das System dem Benutzer bietet.  Im Detail.  Aber es ist historisch so passiert, dass diese Art von Diagrammen f√ºr mich das Schlimmste ist - Geduld ist anscheinend nicht genug.  Und Sie m√ºssen mich nicht so ansehen - wir sind nicht an der Universit√§t, um das Diplom zu sch√ºtzen, aber wir genie√üen den Arbeitsprozess.  Und f√ºr diesen Prozess sind Anwendungsf√§lle nicht so wichtig.  Es ist viel wichtiger, die Anwendung korrekt in unabh√§ngige Module zu unterteilen, dh das Spiel so zu implementieren, dass die Funktionen der visuellen Oberfl√§che die Spielmechanik nicht beeinflussen und die grafische Komponente bei Bedarf leicht ge√§ndert werden kann. <br><br>  Dieser Punkt kann im folgenden Komponentendiagramm detailliert beschrieben werden: <br><br><div class="spoiler">  <b class="spoiler_title">Systemkomponenten</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/lm/br/br/lmbrbrdoyppboylxuoopjr--d5u.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier haben wir bereits bestimmte Subsysteme identifiziert, die Teil unserer Anwendung sind, und wie sp√§ter gezeigt wird, werden sie alle unabh√§ngig voneinander entwickelt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gleichzeitig werden wir herausfinden, wie der Hauptspielzyklus aussehen wird (oder besser gesagt, der interessanteste Teil ist der, der die Charaktere im Skript implementiert). </font><font style="vertical-align: inherit;">Hierzu eignet sich ein Aktivit√§tsdiagramm f√ºr uns:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie stehen, setzen Sie sich</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/o-/f6/ev/o-f6evthl0hpqu0rhwlejbxyhty.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Und schlie√ülich w√§re es sch√∂n, die Abfolge der Interaktion des Endbenutzers mit der Spiel-Engine √ºber ein Eingabe-Ausgabe-System allgemein darzustellen. </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W√ºrstchen</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/hs/jo/_d/hsjo_dinyd5genlr77jrgz0ouys.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Nacht ist lang, weit vor Sonnenaufgang. </font><font style="vertical-align: inherit;">Nachdem Sie wie gew√ºnscht am Tisch gesessen haben, werden Sie ruhig die anderen zwei Dutzend Diagramme zeichnen - glauben Sie mir, ihre Anwesenheit wird Ihnen in Zukunft helfen, auf dem gew√§hlten Weg zu bleiben, Ihr Selbstwertgef√ºhl zu steigern, das Innere des Raums zu aktualisieren, verblasste Tapeten mit bunten Postern aufzuh√§ngen und in einfachen Worten Ihre Vision zu verwirklichen Kollegen, die bald in Scharen zu den T√ºren Ihres neuen Studios eilen werden (wir streben keinen Erfolg an, erinnerst du dich?). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bisher werden wir keine Klassendiagramme (Klassen) zitieren, die wir alle lieben - es wird erwartet, dass Klassen </font><font style="vertical-align: inherit;">viel </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">durchbrechen</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und das Bild in drei Bildschirmen der Klarheit wird zun√§chst nicht hinzugef√ºgt. </font><font style="vertical-align: inherit;">Es ist besser, es in St√ºcke zu zerbrechen und schrittweise auszulegen, w√§hrend Sie mit der Entwicklung des entsprechenden Subsystems fortfahren.</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schritt vier </font><font style="vertical-align: inherit;">Werkzeugauswahl</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie bereits vereinbart, werden wir eine plattform√ºbergreifende Anwendung entwickeln, die sowohl auf Desktops mit verschiedenen Betriebssystemen als auch auf Mobilger√§ten ausgef√ºhrt werden kann. Wir werden Java als Programmiersprache w√§hlen, und Kotlin ist noch besser, da letzteres neuer und frischer ist und noch keine Zeit hatte, in den Wellen der Emp√∂rung zu schwimmen, die seinen Vorg√§nger √ºberw√§ltigten (gleichzeitig werde ich lernen, wenn jemand anderes es nicht besitzt). </font><font style="vertical-align: inherit;">Wie Sie wissen, ist </font></font><abbr title="Java Virtual Machine"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die JVM</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √ºberall verf√ºgbar (auf drei Milliarden Ger√§ten, hehe). Wir werden sowohl Windows als auch UNIX unterst√ºtzen, und selbst auf einem Remote-Server k√∂nnen wir √ºber eine SSH-Verbindung spielen (es ist niemandem bekannt, der sie ben√∂tigt, aber Wir werden eine solche Gelegenheit bieten). Wir werden es auch auf Android √ºbertragen, wenn wir reich werden und einen K√ºnstler einstellen, aber dazu sp√§ter mehr.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bibliotheken (ohne sie kommen wir nicht weiter) w√§hlen wir entsprechend unserer plattform√ºbergreifenden Anforderung aus. </font><font style="vertical-align: inherit;">Wir werden Maven als Build-System verwenden. </font><font style="vertical-align: inherit;">Oder Gradle. </font><font style="vertical-align: inherit;">Oder trotzdem, Maven, fangen wir damit an. </font><font style="vertical-align: inherit;">Ich rate Ihnen sofort, ein Versionskontrollsystem einzurichten (je nachdem, welches Sie bevorzugen), damit Sie sich nach vielen Jahren leichter mit nostalgischen Gef√ºhlen daran erinnern k√∂nnen, wie gro√üartig es einmal war. </font><font style="vertical-align: inherit;">IDE w√§hlen auch die vertrauten, bevorzugten und bequemen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eigentlich brauchen wir nichts anderes. </font><font style="vertical-align: inherit;">Sie k√∂nnen mit der Entwicklung beginnen.</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schritt f√ºnf </font><font style="vertical-align: inherit;">Projekt erstellen und einrichten</font></font></font> </h2><br>  Wenn Sie eine IDE verwenden, ist das Erstellen eines Projekts trivial.  Sie m√ºssen nur einen klangvollen Namen (z. B. <b>Dice</b> ) f√ºr unser zuk√ºnftiges Meisterwerk ausw√§hlen, die Maven-Unterst√ºtzung in den Einstellungen nicht aktivieren und die erforderlichen Bezeichner in die Datei <code>pom.xml</code> schreiben: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span>4.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>my.company<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>dice<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span>jar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  F√ºgen Sie auch die Kotlin-Unterst√ºtzung hinzu, die standardm√§√üig fehlt: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>kotlin-stdlib<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${kotlin.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  und einige Einstellungen, auf die wir nicht im Detail eingehen werden: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project.build.sourceEncoding</span></span></span><span class="hljs-tag">&gt;</span></span>UTF-8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project.build.sourceEncoding</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.source</span></span></span><span class="hljs-tag">&gt;</span></span>1.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.source</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.target</span></span></span><span class="hljs-tag">&gt;</span></span>1.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.target</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.version</span></span></span><span class="hljs-tag">&gt;</span></span>1.3.20<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.compiler.incremental</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.compiler.incremental</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Ein paar Informationen zu Hybridprojekten</b> <div class="spoiler_text">  Wenn Sie planen, sowohl Java als auch Kotlin in Ihrem Projekt zu verwenden, haben Sie zus√§tzlich zum <code>src/main/kotlin</code> <code>src/main/java</code> .  Kotlin-Entwickler behaupten, dass die Quelldateien aus dem ersten Ordner ( <code>*.kt</code> ) fr√ºher kompiliert werden m√ºssen als die Quelldateien aus dem zweiten Ordner ( <code>*.java</code> ) und empfehlen daher dringend, die Einstellungen der Standard-Maven-Ziele zu √§ndern: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>kotlin-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${kotlin.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>process-sources<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDirs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDir</span></span></span><span class="hljs-tag">&gt;</span></span>${project.basedir}/src/main/kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDir</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDir</span></span></span><span class="hljs-tag">&gt;</span></span>${project.basedir}/src/main/java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDir</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDirs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>test-compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>test-compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDirs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDir</span></span></span><span class="hljs-tag">&gt;</span></span>${project.basedir}/src/test/kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDir</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDir</span></span></span><span class="hljs-tag">&gt;</span></span>${project.basedir}/src/test/java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDir</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDirs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.apache.maven.plugins<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>maven-compiler-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>3.5.1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Replacing default-compile --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>default-compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>none<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Replacing default-testCompile --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>default-testCompile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>none<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>java-compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>java-test-compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>test-compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>testCompile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Ich kann nicht sagen, wie wichtig dies ist - die Projekte laufen ohne dieses Blatt recht gut.  Aber nur f√ºr den Fall, Sie werden gewarnt. <br></div></div><br>  Lassen Sie uns drei Pakete gleichzeitig erstellen (warum etwas spielen?): <br><br><ul><li>  <code>model</code> - f√ºr Klassen, die Objekte der Spielwelt beschreiben; </li><li>  <code>game</code> - f√ºr Klassen, die das Gameplay implementieren; </li><li>  <code>ui</code> - f√ºr Klassen, die f√ºr die Benutzerinteraktion verantwortlich sind. </li></ul><br>  Letzteres enth√§lt nur Schnittstellen, deren Methoden wir zur Eingabe und Ausgabe von Daten verwenden.  Wir werden bestimmte Implementierungen in einem separaten Projekt speichern, aber dazu sp√§ter mehr.  In der Zwischenzeit werden wir diese Klassen hier nebeneinander hinzuf√ºgen, um nicht zu viel zu spr√ºhen. <br><br>  Versuchen Sie nicht, es sofort perfekt zu machen: Denken Sie √ºber die Details der Paketnamen, Schnittstellen, Klassen und Methoden nach.  Verschreiben Sie die Interaktion von Objekten untereinander gr√ºndlich - all dies wird sich mehr als ein Dutzend Mal √§ndern.  W√§hrend sich das Projekt entwickelt, werden Ihnen viele Dinge h√§sslich, sperrig, ineffektiv und dergleichen erscheinen - Sie k√∂nnen sie jederzeit √§ndern, da das Refactoring in modernen IDEs eine sehr billige Operation ist. <br><br>  Wir werden auch eine Klasse mit der <code>main</code> erstellen und sind bereit f√ºr gro√üartige Erfolge.  Sie k√∂nnen die IDE selbst zum Starten verwenden. Wie Sie sp√§ter sehen werden, ist diese Methode f√ºr unsere Zwecke nicht geeignet (die Standard-IDE-Konsole kann unsere grafischen Ergebnisse nicht wie gew√ºnscht anzeigen). Daher konfigurieren wir den Start von au√üen mithilfe von Batch (oder Shell auf UNIX-Systemen). Datei.  Vorher werden wir jedoch einige zus√§tzliche Einstellungen vornehmen. <br><br>  Nachdem der <code>mvn package</code> abgeschlossen ist, erhalten wir die Ausgabe des JAR-Archivs mit allen kompilierten Klassen.  Erstens enth√§lt dieses Archiv standardm√§√üig nicht die Abh√§ngigkeiten, die f√ºr das Funktionieren des Projekts erforderlich sind (bisher haben wir sie nicht, aber sie werden sicherlich in Zukunft angezeigt).  Zweitens ist der Pfad zur Hauptklasse, die die <code>main</code> , nicht in der Archivmanifestdatei angegeben, sodass wir das Projekt nicht mit dem <code>java -jar dice-1.0.jar</code> .  Beheben Sie dies, indem Sie <code>pom.xml</code> zus√§tzliche Einstellungen hinzuf√ºgen: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>maven-assembly-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.6<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>package<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>single<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">descriptorRefs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">descriptorRef</span></span></span><span class="hljs-tag">&gt;</span></span>jar-with-dependencies<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">descriptorRef</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">descriptorRefs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mainClass</span></span></span><span class="hljs-tag">&gt;</span></span>my.company.dice.MainKt<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mainClass</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Achten Sie auf den Namen der Hauptklasse.  F√ºr Kotlin-Funktionen, die au√üerhalb von Klassen enthalten sind (wie zum Beispiel die Hauptfunktion), werden beim Kompilieren weiterhin Klassen erstellt (da die JVM nichts wei√ü und nicht wissen m√∂chte).  Der Name dieser Klasse ist der Name der Datei mit dem Zusatz von <code>Kt</code> .  Das hei√üt, wenn Sie die Hauptklasse <code>Main</code> , wird sie in die Datei <code>MainKt.class</code> kompiliert.  Es ist das letzte, das wir im Manifest der JAR-Datei angeben m√ºssen. <br><br>  Beim <code>dice-1.0.jar</code> des Projekts erhalten wir jetzt zwei JAR-Dateien am Ausgang: <code>dice-1.0.jar</code> und <code>dice-1.0-jar-with-dependencies.jar</code> .  Wir interessieren uns f√ºr die zweite.  Wir werden ein Startskript daf√ºr schreiben. <br><br>  <b>dice.bat</b> (f√ºr Windows) <br><br><pre> <code class="dos hljs">@<span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> OFF <span class="hljs-built_in"><span class="hljs-built_in">rem</span></span> Compiling <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> "path_to_maven\mvn.bat" -f "path_to_project\Dice\pom.xml" package <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">errorlevel</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Project compilation failed! &amp; <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span> &amp; <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> :EOF <span class="hljs-built_in"><span class="hljs-built_in">rem</span></span> Running java -jar path_to_project\Dice\target\dice-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>-jar-with-dependencies.jar <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span></code> </pre><br>  <b>dice.sh</b> (f√ºr UNIX) <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # Compiling mvn -f "path_to_project/Dice/pom.xml" package if [[ "$?" -ne 0 ]] ; then echo 'Project compilation failed!'; exit $rc fi # Running java -jar path_to_project/Dice/target/dice-1.0-jar-with-dependencies.jar</span></span></code> </pre><br>  Bitte beachten Sie, dass wir das Skript unterbrechen m√ºssen, wenn die Kompilierung fehlschl√§gt.  Andernfalls wird nicht die letzte Harfe gestartet, sondern die Datei, die von der vorherigen erfolgreichen Assembly √ºbrig geblieben ist (manchmal finden wir nicht einmal den Unterschied).  Oft verwenden Entwickler den Befehl <code>mvn clean package</code> , um alle zuvor kompilierten Dateien zu l√∂schen. In diesem Fall beginnt der gesamte Kompilierungsprozess jedoch immer von vorne (auch wenn sich der Quellcode nicht ge√§ndert hat), was viel Zeit in Anspruch nimmt.  Aber wir k√∂nnen es kaum erwarten - wir m√ºssen ein Spiel machen. <br><br>  Das Projekt startet also gut, macht aber bisher nichts.  Keine Sorge, wir werden es bald beheben. <br><br><h2>  <font color="#0474a0">Schritt sechs</font>  <font color="#0474a0">Hauptobjekte</font> </h2><br>  Allm√§hlich werden wir beginnen, das <code>model</code> mit den f√ºr das Gameplay erforderlichen Klassen zu f√ºllen. <br><br><div class="spoiler">  <b class="spoiler_title">Klassendiagramm</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/lv/de/4t/lvde4t7282puwgyjgl6qrooazka.png"></a> <br></div></div><br>  W√ºrfel sind unser Alles, f√ºgen Sie sie zuerst hinzu.  Jeder W√ºrfel (eine Instanz der <code>Die</code> ) ist durch seinen Typ (Farbe) und seine Gr√∂√üe gekennzeichnet.  F√ºr die <code>Die.Type</code> wir eine separate Aufz√§hlung ( <code>Die.Type</code> ), markieren die Gr√∂√üe mit einer Ganzzahl von 4 bis 12. Wir implementieren auch die <code>roll()</code> -Methode, die eine beliebige, gleichm√§√üig verteilte Zahl aus dem f√ºr den W√ºrfel verf√ºgbaren Bereich (von 1 bis einschlie√ülich des Gr√∂√üenwerts) erzeugt. <br><br>  Die Klasse implementiert die Schnittstelle <code>Comparable</code> , <code>Comparable</code> die Cubes miteinander verglichen werden k√∂nnen (n√ºtzlich sp√§ter, wenn mehrere Cubes in einer geordneten Zeile angezeigt werden).  Gr√∂√üere W√ºrfel werden fr√ºher platziert. <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Die</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Type, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> size: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>) : Comparable&lt;Die&gt; { <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Type</span></span></span><span class="hljs-class"> </span></span>{ PHYSICAL, <span class="hljs-comment"><span class="hljs-comment">//Blue SOMATIC, //Green MENTAL, //Purple VERBAL, //Yellow DIVINE, //Cyan WOUND, //Gray ENEMY, //Red VILLAIN, //Orange OBSTACLE, //Brown ALLY //White } fun roll() = (1.. size).random() override fun toString() = "d$size" override fun compareTo(other: Die): Int { return compareValuesBy(this, other, Die::type, { -it.size }) } }</span></span></code> </pre><br>  Um keinen Staub zu sammeln, werden W√ºrfel in Handtaschen (Kopien der <code>Bag</code> Klasse) aufbewahrt.  Man kann nur raten, was in der Tasche vor sich geht, daher macht es keinen Sinn, eine bestellte Sammlung zu verwenden.  So'ne Art.  Sets (Sets) setzen die Idee, die wir brauchen, gut um, passen aber aus zwei Gr√ºnden nicht.  Wenn Sie sie verwenden, m√ºssen Sie zun√§chst die Methoden <code>equals()</code> und <code>hashCode()</code> implementieren, und es ist nicht klar, wie, da es falsch ist, die Typen und Gr√∂√üen von Cubes zu vergleichen. In unserem Set k√∂nnen beliebig viele identische Cubes gespeichert werden.  Zweitens erwarten wir, wenn wir den W√ºrfel aus dem Beutel ziehen, nicht nur etwas Nicht-Deterministisches, sondern Zuf√§lliges, jedes Mal anders.  Daher rate ich Ihnen trotzdem, eine geordnete Sammlung (Liste) zu verwenden und sie jedes Mal zu mischen, wenn Sie ein neues Element hinzuf√ºgen (in der <code>put()</code> -Methode) oder unmittelbar vor der Ausgabe (in der <code>draw()</code> -Methode). <br><br>  Die Methode <code>examine()</code> eignet sich f√ºr F√§lle, in denen ein Spieler, der keine Unsicherheit mehr hat, den Inhalt des Beutels auf dem Tisch in den Herzen sch√ºttelt (achten Sie auf das Sortieren), und die Methode <code>clear()</code> , wenn die ausgesch√ºttelten W√ºrfel nicht in den Beutel zur√ºckkehren. <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bag</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dice = LinkedList&lt;Die&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> size <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = dice.size <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">put</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">vararg</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dice: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { dice.forEach(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dice::addLast) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dice.shuffle() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Die = dice.pollFirst() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = dice.clear() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">examine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = dice.sorted().toList() }</code> </pre><br>  Neben Beuteln mit W√ºrfeln ben√∂tigen Sie auch Haufen mit W√ºrfeln (Instanzen der <code>Pile</code> Klasse).  Von der ersten unterscheiden sich die zweiten darin, dass ihr Inhalt f√ºr die Spieler sichtbar ist. Entfernen Sie daher bei Bedarf einen W√ºrfel vom Haufen, und der Spieler kann eine bestimmte interessierende Instanz ausw√§hlen.  Wir implementieren diese Idee mit der Methode <code>removeDie()</code> . <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pile</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Bag</span></span></span></span>() { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeDie</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(die: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = dice.remove(die) }</code> </pre><br>  Jetzt wenden wir uns unseren Hauptfiguren zu - den Helden.  Das hei√üt, Charaktere, die wir jetzt Helden nennen werden (es gibt einen guten Grund, Ihre Klasse nicht mit dem Namen <code>Character</code> in Java zu bezeichnen).  Es gibt verschiedene Arten von Charakteren (um es in Klassen einzuteilen, obwohl es besser ist, die Wortklasse nicht zu verwenden), aber f√ºr unseren funktionierenden Prototyp nehmen wir nur zwei: <i>Brawler</i> ( <i>dh</i> K√§mpfer mit Schwerpunkt auf St√§rke und St√§rke) und <i>Hunter</i> (auch bekannt als Ranger / Dieb, mit Schwerpunkt) Geschicklichkeit und Heimlichkeit).  Die Klasse des Helden bestimmt seine Eigenschaften, F√§higkeiten und den anf√§nglichen Satz von W√ºrfeln, aber wie sp√§ter zu sehen sein wird, sind die Helden nicht streng an Klassen gebunden, und daher k√∂nnen ihre pers√∂nlichen Einstellungen leicht an einem einzigen Ort ge√§ndert werden. <br><br>  Wir werden dem Helden die erforderlichen Eigenschaften gem√§√ü dem Designdokument hinzuf√ºgen: Name, bevorzugter W√ºrfeltyp, W√ºrfelgrenzen, erlernte und nicht erlernte F√§higkeiten, Hand, Tasche und Stapel zum Zur√ºcksetzen.  Beachten Sie die Funktionen zur Implementierung von Sammlungseigenschaften.  In der gesamten zivilisierten Welt wird es als schlechte Form angesehen, (mit Hilfe eines Getters) nach au√üen auf Sammlungen zuzugreifen, die im Objekt gespeichert sind. Skrupellose Programmierer k√∂nnen den Inhalt dieser Sammlungen ohne Wissen der Klasse √§ndern.  Eine M√∂glichkeit, damit umzugehen, besteht darin, separate Methoden zum Hinzuf√ºgen und Entfernen von Elementen, zum Abrufen ihrer Nummer und zum Zugriff √ºber den Index zu implementieren.  Sie k√∂nnen Getter implementieren, aber gleichzeitig nicht die Sammlung selbst, sondern ihre unver√§nderliche Kopie zur√ºckgeben - f√ºr eine kleine Anzahl von Elementen ist es nicht besonders be√§ngstigend, genau das zu tun. <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Hero</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Type) { <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Type</span></span></span><span class="hljs-class"> </span></span>{ BRAWLER HUNTER } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isAlive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> favoredDieType: Die.Type = Die.Type.ALLY <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> hand = Hand(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> bag: Bag = Bag() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> discardPile: Pile = Pile() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> diceLimits = mutableListOf&lt;DiceLimit&gt;() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> skills = mutableListOf&lt;Skill&gt;() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dormantSkills = mutableListOf&lt;Skill&gt;() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addDiceLimit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(limit: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DiceLimit</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = diceLimits.add(limit) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDiceLimits</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;DiceLimit&gt; = Collections.unmodifiableList(diceLimits) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addSkill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(skill: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Skill</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = skills.add(skill) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSkills</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;Skill&gt; = Collections.unmodifiableList(skills) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addDormantSkill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(skill: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Skill</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = dormantSkills.add(skill) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDormantSkills</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;Skill&gt; = Collections.unmodifiableList(dormantSkills) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">increaseDiceLimit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { diceLimits.find { it.type == type }?.let { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { it.current &lt; it.maximal -&gt; it.current++ <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"Already at maximum"</span></span>) } } ?: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"Incorrect type specified"</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hideDieFromHand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(die: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { bag.put(die) hand.removeDie(die) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">discardDieFromHand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(die: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { discardPile.put(die) hand.removeDie(die) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasSkill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Skill</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = skills.any { it.type == type } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improveSkill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Skill</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { dormantSkills .find { it.type == type } ?.let { skills.add(it) dormantSkills.remove(it) } skills .find { it.type == type } ?.let { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { it.level &lt; it.maxLevel -&gt; it.level += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalStateException(<span class="hljs-string"><span class="hljs-string">"Skill already maxed out"</span></span>) } } ?: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"Skill not found"</span></span>) } }</code> </pre><br>  Die Hand des Helden (die W√ºrfel, die er gerade hat) wird durch ein separates Objekt ( <code>Hand</code> ) beschrieben.  Die Entwurfsentscheidung, die alliierten W√ºrfel vom Hauptarm getrennt zu halten, war eine der ersten, die mir in den Sinn kamen.  Anfangs schien es ein super cooles Feature zu sein, aber sp√§ter verursachte es eine Vielzahl von Problemen und Unannehmlichkeiten.  Trotzdem suchen wir nicht nach einfachen Wegen, und daher stehen uns die <code>dice</code> und <code>allies</code> mit allen Methoden zur Verf√ºgung, die Sie zum Hinzuf√ºgen, Empfangen und L√∂schen ben√∂tigen (einige von ihnen bestimmen auf intelligente Weise, auf welche der beiden Listen Sie zugreifen k√∂nnen).  Wenn Sie einen W√ºrfel aus Ihrer Hand entfernen, werden alle nachfolgenden W√ºrfel an den Anfang der Liste verschoben und f√ºllen die L√ºcken aus. In Zukunft wird dies die Suche erheblich erleichtern (es ist nicht erforderlich, Situationen mit <code>null</code> ). <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Hand</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> capacity: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dice = LinkedList&lt;Die&gt;() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> allies = LinkedList&lt;Die&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dieCount <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = dice.size <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> allyDieCount <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = allies.size <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dieAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(index: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { (index <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> until dieCount) -&gt; dice[index] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">null</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allyDieAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(index: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { (index <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> until allyDieCount) -&gt; allies[index] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">null</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addDie</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(die: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { die.type == Die.Type.ALLY -&gt; allies.addLast(die) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; dice.addLast(die) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeDie</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(die: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { die.type == Die.Type.ALLY -&gt; allies.remove(die) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; dice.remove(die) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findDieOfType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Die? = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (type) { Die.Type.ALLY -&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (allies.isNotEmpty()) allies.first <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; dice.firstOrNull { it.type == type } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">examine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;Die&gt; = (dice + allies).sorted() }</code> </pre><br>  Die Sammlung von Objekten der <code>DiceLimit</code> Klasse begrenzt die Anzahl der W√ºrfel jedes Typs, die der Held zu Beginn des Skripts haben kann.  Es gibt nichts Besonderes zu sagen, wir bestimmen zun√§chst die Maximal- und Stromwerte f√ºr jeden Typ. <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DiceLimit</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Die.Type, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> initial: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> maximal: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> current: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>)</code> </pre><br>  Aber mit F√§higkeiten ist es interessanter.  Jeder von ihnen muss einzeln implementiert werden (wor√ºber sp√§ter), aber wir werden nur zwei betrachten: <i>Treffer</i> und <i>Schie√üen</i> (jeweils einen f√ºr jede Klasse).  F√§higkeiten k√∂nnen von der anf√§nglichen bis zur maximalen Stufe entwickelt (‚Äûgepumpt‚Äú) werden, was sich h√§ufig auf die Modifikatoren auswirkt, die den W√ºrfeln hinzugef√ºgt werden.  Dies <code>maxLevel</code> in den Eigenschaften <code>level</code> , <code>maxLevel</code> , <code>modifier1</code> und <code>modifier2</code> <code>maxLevel</code> . <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Skill</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Type) { <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Type</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//Brawler HIT, //Hunter SHOOT, } var level = 1 var maxLevel = 3 var isActive = true var modifier1 = 0 var modifier2 = 0 }</span></span></code> </pre><br>  Achten Sie auf die Hilfsmethoden der Heldenklasse, mit denen Sie einen W√ºrfel aus Ihrer Hand verstecken oder werfen, pr√ºfen k√∂nnen, ob der Held eine bestimmte F√§higkeit besitzt, und erh√∂hen Sie au√üerdem die Stufe der erlernten F√§higkeit oder lernen Sie eine neue.  Alle werden fr√ºher oder sp√§ter ben√∂tigt, aber jetzt werden wir nicht n√§her darauf eingehen. <br><br>  Bitte haben Sie keine Angst vor der Anzahl der Klassen, die wir erstellen m√ºssen.  F√ºr ein Projekt dieser Komplexit√§t sind mehrere hundert eine h√§ufige Sache.  Hier fangen wir, wie bei jeder ernsthaften Besch√§ftigung, klein an, erh√∂hen allm√§hlich das Tempo, in einem Monat haben wir Angst vor dem Umfang.  Vergessen Sie nicht, wir sind immer noch ein kleines Studio von einer Person - wir stehen nicht vor √ºberw√§ltigenden Aufgaben. <br><br>  <i>‚ÄûEtwas hat mich satt.</i>  <i>Ich werde rauchen gehen oder so ... "</i> <br><br>  Und wir werden weitermachen. <br>  Die Helden und ihre F√§higkeiten werden beschrieben, es ist Zeit, sich den gegnerischen Kr√§ften zuzuwenden - der gro√üen und schrecklichen Spielmechanik.  Oder vielmehr Objekte, mit denen unsere Helden interagieren m√ºssen. <br><br><div class="spoiler">  <b class="spoiler_title">Ein weiteres Klassendiagramm</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/bq/7k/iq/bq7kiq7fcsqbhrf61f9g1bh-9e8.png"></a> <br></div></div><br>  Unsere tapferen Protagonisten werden mit drei Arten von W√ºrfeln und Karten konfrontiert: B√∂sewichte ( <code>Villain</code> ), Feinde ( <code>Enemy</code> ) und Hindernisse ( <code>Obstacle</code> ), die unter dem allgemeinen Begriff ‚ÄûBedrohungen‚Äú zusammengefasst sind ( <code>Threat</code> ist eine abstrakte ‚Äûgesperrte‚Äú Klasse, die Liste ihrer m√∂glichen Erben ist streng begrenzt).  Jede Bedrohung verf√ºgt √ºber eine Reihe von Besonderheiten ( <code>Trait</code> ), die spezielle Verhaltensregeln beschreiben, wenn sie einer solchen Bedrohung ausgesetzt sind, und dem Gameplay Abwechslung verleihen. <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Threat</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name: String = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> description: String = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> traits = mutableListOf&lt;Trait&gt;() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addTrait</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">trait</span></span></span></span><span class="hljs-function"><span class="hljs-params">: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Trait</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = traits.add(<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fun</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getTraits</span></span></span></span>(): List&lt;Trait&gt; = traits } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Obstacle</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> tier: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">vararg</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dieTypes: Die.Type) : Threat() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Villain</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Threat</span></span></span></span>() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Enemy</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Threat</span></span></span></span>() <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Trait</span></span></span><span class="hljs-class"> </span></span>{ MODIFIER_PLUS_ONE, <span class="hljs-comment"><span class="hljs-comment">//Add +1 modifier MODIFIER_PLUS_TWO, //Add +2 modifier }</span></span></code> </pre><br>  Beachten Sie, dass die Liste der Objekte der <code>Trait</code> Klasse als ver√§nderbar ( <code>MutableList</code> ) definiert ist, jedoch als unver√§nderliche <code>MutableList</code> ausgegeben wird.  Obwohl dies in Kotlin funktioniert, ist der Ansatz unsicher, da nichts daran hindert, die resultierende Liste in eine ver√§nderbare Schnittstelle zu konvertieren und verschiedene √Ñnderungen vorzunehmen. Dies ist besonders einfach, wenn Sie √ºber Java-Code auf die Klasse zugreifen (wobei die <code>List</code> Schnittstelle ver√§nderbar ist).  Der paranoideste Weg, Ihre Sammlung zu sch√ºtzen, besteht darin, Folgendes zu tun: <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTraits</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;Trait&gt; = Collections.unmodifiableList(traits)</code> </pre> <br>  Wir werden uns dem Problem jedoch nicht so gewissenhaft n√§hern (Sie werden jedoch gewarnt). <br><br>  Aufgrund der Besonderheiten der Spielmechanik unterscheidet sich die <code>Obstacle</code> von ihren Gegenst√ºcken durch das Vorhandensein zus√§tzlicher Felder, aber wir werden uns nicht auf diese konzentrieren. <br><br>  Bedrohungskarten (und wenn Sie das Designdokument sorgf√§ltig lesen, denken Sie daran, dass es sich um Karten handelt) werden zu Decks zusammengefasst, die von der <code>Deck</code> Klasse dargestellt werden: <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Deck</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">E: Threat</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cards = LinkedList&lt;E&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> size <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = cards.size <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addToTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(card: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">E</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = cards.addFirst(card) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addToBottom</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(card: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">E</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = cards.addLast(card) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">revealTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: E = cards.first <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawFromTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: E = cards.removeFirst() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shuffle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = cards.shuffle() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = cards.clear() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">examine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = cards.toList() }</code> </pre><br>  Hier gibt es nichts Ungew√∂hnliches, au√üer dass die Klasse parametrisiert ist und eine geordnete Liste (oder vielmehr eine Zwei-Wege-Warteschlange) enth√§lt, die mit der entsprechenden Methode gemischt werden kann.  Decks mit Feinden und Hindernissen werden f√ºr uns buchst√§blich in einer Sekunde ben√∂tigt, wenn wir zur √úberlegung kommen ... <br><br>  ... der <code>Location</code> Klasse, von denen jede Instanz einen einzigartigen Ort beschreibt, den unsere Helden als Teil des Skripts besuchen m√ºssen. <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Location</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name: String = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> description: String = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isOpen = <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> closingDifficulty = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bag: Bag <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> villain: Villain? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> enemies: Deck&lt;Enemy&gt; <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obstacles: Deck&lt;Obstacle&gt; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> specialRules = mutableListOf&lt;SpecialRule&gt;() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addSpecialRule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rule: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">SpecialRule</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = specialRules.add(rule) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSpecialRules</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = specialRules }</code> </pre><br>  Jeder Ort hat einen Namen, eine Beschreibung, eine Schwierigkeit der Schlie√üung und das Zeichen ‚Äûoffen / geschlossen‚Äú.  Irgendwo hier lauert der B√∂sewicht m√∂glicherweise (oder er lauert m√∂glicherweise nicht, wodurch das Eigentum des <code>villain</code> m√∂glicherweise <code>null</code> ).  In jedem Bereich gibt es eine Tasche mit W√ºrfeln und ein Kartenspiel mit Bedrohungen.  Au√üerdem kann das Gebiet √ºber eigene Spielfunktionen ( <code>SpecialRule</code> ) <code>SpecialRule</code> , die wie die Eigenschaften von Bedrohungen das Gameplay abwechslungsreicher gestalten.  Wie Sie sehen, legen wir den Grundstein f√ºr zuk√ºnftige Funktionen, auch wenn wir nicht vorhaben, diese in naher Zukunft zu implementieren (wof√ºr wir tats√§chlich die Modellierungsphase ben√∂tigen). <br><br>  Schlie√ülich m√ºssen noch die Skripte ( <code>Scenario</code> Klasse) implementiert werden: <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Scenario</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> description = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> level = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> initialTimer = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> allySkills = mutableListOf&lt;AllySkill&gt;() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> specialRules = mutableListOf&lt;SpecialRule&gt;() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addAllySkill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(skill: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">AllySkill</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = allySkills.add(skill) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAllySkills</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;AllySkill&gt; = Collections.unmodifiableList(allySkills) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addSpecialRule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rule: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">SpecialRule</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = specialRules.add(rule) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSpecialRules</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;SpecialRule&gt; = Collections.unmodifiableList(specialRules) }</code> </pre><br>  Jedes Szenario ist durch den Pegel und den Anfangswert des Timers gekennzeichnet.  √Ñhnlich wie zuvor wurden spezielle Regeln ( <code>specialRules</code> ) und F√§higkeiten von Verb√ºndeten festgelegt (wir werden sie nicht ber√ºcksichtigen).  Sie k√∂nnten denken, dass das Skript auch eine Liste von Speicherorten (Objekten der <code>Location</code> ) enthalten sollte, und logischerweise ist dies wirklich so.  Wie wir sp√§ter sehen werden, werden wir eine solche Verbindung nirgendwo verwenden und sie bietet keinen technischen Vorteil. <br><br>  Ich erinnere Sie daran, dass alle bisher betrachteten Klassen im <code>model</code> enthalten sind - wir haben als Kind in Erwartung einer epischen Spielzeugschlacht Soldaten auf die Oberfl√§che des Tisches gelegt.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und jetzt, nach ein paar schmerzhaften Momenten, werden wir auf das Signal des Oberbefehlshabers in die Schlacht eilen, unsere Spielsachen zusammenschieben und die Konsequenzen des Gameplays genie√üen. </font><font style="vertical-align: inherit;">Aber vorher ein wenig √ºber das Arrangement selbst. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Nun sooo ..."</font></font></i> <br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Siebter Schritt. </font><font style="vertical-align: inherit;">Muster und Generatoren</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stellen wir uns f√ºr eine Sekunde vor, wie der Prozess der Erzeugung eines der zuvor betrachteten Objekte aussehen wird, zum Beispiel der Ort (Gel√§nde). </font><font style="vertical-align: inherit;">Wir m√ºssen eine Instanz der Klasse erstellen </font></font><code>Location</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ihre Felder mit Werten initialisieren und so f√ºr jeden Ort, den wir im Spiel verwenden m√∂chten. </font><font style="vertical-align: inherit;">Aber warten Sie: Jeder Ort sollte eine Tasche haben, die auch generiert werden muss. </font><font style="vertical-align: inherit;">Und Taschen haben W√ºrfel - dies sind auch Instanzen der entsprechenden Klasse ( </font></font><code>Die</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Ich spreche hier nicht von Feinden und Hindernissen - sie m√ºssen im Allgemeinen in Decks gesammelt werden. </font><font style="vertical-align: inherit;">Und der B√∂sewicht bestimmt nicht das Gel√§nde selbst, sondern die Merkmale des Szenarios befinden sich eine Ebene h√∂her. </font><font style="vertical-align: inherit;">Nun, du verstehst, worum es geht. </font><font style="vertical-align: inherit;">Der Quellcode f√ºr das Obige k√∂nnte folgenderma√üen aussehen:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> location = Location().apply { name = <span class="hljs-string"><span class="hljs-string">"Some location"</span></span> description = <span class="hljs-string"><span class="hljs-string">"Some description"</span></span> isOpen = <span class="hljs-literal"><span class="hljs-literal">true</span></span> closingDifficulty = <span class="hljs-number"><span class="hljs-number">4</span></span> bag = Bag().apply { put(Die(Die.Type.PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>)) put(Die(Die.Type.SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>)) put(Die(Die.Type.MENTAL, <span class="hljs-number"><span class="hljs-number">4</span></span>)) put(Die(Die.Type.ENEMY, <span class="hljs-number"><span class="hljs-number">6</span></span>)) put(Die(Die.Type.OBSTACLE, <span class="hljs-number"><span class="hljs-number">6</span></span>)) put(Die(Die.Type.VILLAIN, <span class="hljs-number"><span class="hljs-number">6</span></span>)) } villain = Villain().apply { name = <span class="hljs-string"><span class="hljs-string">"Some villain"</span></span> description = <span class="hljs-string"><span class="hljs-string">"Some description"</span></span> addTrait(Trait.MODIFIER_PLUS_ONE) } enemies = Deck&lt;Enemy&gt;().apply { addToTop(Enemy().apply { name = <span class="hljs-string"><span class="hljs-string">"Some enemy"</span></span> description = <span class="hljs-string"><span class="hljs-string">"Some description"</span></span> }) addToTop(Enemy().apply { name = <span class="hljs-string"><span class="hljs-string">"Other enemy"</span></span> description = <span class="hljs-string"><span class="hljs-string">"Some description"</span></span> }) shuffle() } obstacles = Deck&lt;Obstacle&gt;().apply { addToTop(Obstacle(<span class="hljs-number"><span class="hljs-number">1</span></span>, Die.Type.PHYSICAL, Die.Type.VERBAL).apply { name = <span class="hljs-string"><span class="hljs-string">"Some obstacle"</span></span> description = <span class="hljs-string"><span class="hljs-string">"Some Description"</span></span> }) } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies ist auch der Sprache und dem Design von Kotlin zu verdanken </font></font><code>apply{}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- in Java w√§re der Code doppelt so umfangreich. Dar√ºber hinaus wird es, wie gesagt, viele Orte geben, und neben ihnen gibt es auch Szenarien, Abenteuer und Helden mit ihren F√§higkeiten und Eigenschaften - im Allgemeinen gibt es f√ºr den Spieledesigner etwas zu tun.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Spieledesigner schreibt jedoch keinen Code, und es ist f√ºr uns unpraktisch, das Projekt bei der geringsten √Ñnderung in der Spielwelt neu zu kompilieren. </font><font style="vertical-align: inherit;">Hier wird jeder kompetente Programmierer einwenden, dass die Beschreibungen von Objekten aus dem Klassencode getrennt werden sollten - idealerweise, damit Instanzen des letzteren bei Bedarf dynamisch basierend auf dem ersteren generiert werden, √§hnlich wie ein Teil aus einer Zeichenanlage hergestellt wird. </font><font style="vertical-align: inherit;">Wir implementieren auch solche Zeichnungen, nennen sie nur Vorlagen und stellen sie als Instanzen einer speziellen Klasse dar. </font><font style="vertical-align: inherit;">Mit solchen Mustern erstellt ein spezieller Programmcode (Generator) die endg√ºltigen Objekte aus dem zuvor beschriebenen Modell.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Prozess des Generierens eines Objekts aus einer Vorlage</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/lj/cn/hb/ljcnhbcwls0jogmaxfbncrek6gc.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daher m√ºssen f√ºr jede Klasse unserer Objekte zwei neue Entit√§ten definiert werden: die Vorlagenschnittstelle und die Generatorklasse. </font><font style="vertical-align: inherit;">Und da sich eine anst√§ndige Anzahl von Objekten angesammelt hat, wird es auch eine Reihe von Entit√§ten geben ... unanst√§ndig:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klassendiagramm</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/ef/hu/4k/efhu4kgepx97_87cnpis8ranl0c.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bitte atmen Sie tiefer, h√∂ren Sie genau zu und lassen Sie sich nicht ablenken. Erstens zeigt das Diagramm nicht alle Objekte der Spielwelt, sondern nur die Hauptobjekte, auf die Sie zun√§chst nicht verzichten k√∂nnen. Zweitens wurden einige der bereits in anderen Diagrammen erw√§hnten Verbindungen weggelassen, um die Schaltung nicht mit unn√∂tigen Details zu √ºberlasten. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beginnen wir mit etwas Einfachem - dem Generieren von W√ºrfeln. ‚ÄûWie? - Du sagst. - Sind wir nicht genug Konstruktor? Ja, das ist der mit dem Typ und der Gr√∂√üe. " Nein, ich werde antworten, nicht genug. In der Tat m√ºssen in vielen F√§llen (lesen Sie die Regeln) W√ºrfel willk√ºrlich in einer beliebigen Menge erzeugt werden (zum Beispiel: ‚Äûvon einem bis drei W√ºrfel entweder blau oder gr√ºn‚Äú). Dar√ºber hinaus sollte die Gr√∂√üe abh√§ngig von der Komplexit√§t des Skripts ausgew√§hlt werden. Deshalb f√ºhren wir eine spezielle Schnittstelle ein </font></font><code>DieTypeFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DieTypeFilter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verschiedene Implementierungen dieser Schnittstelle pr√ºfen, ob der Cube-Typ verschiedenen Regels√§tzen entspricht (alle, die nur in den Sinn kommen). </font><font style="vertical-align: inherit;">Zum Beispiel, ob der Typ einem genau festgelegten Wert ("blau") oder einem Wertebereich ("blau, gelb oder gr√ºn") entspricht; </font><font style="vertical-align: inherit;">oder umgekehrt entspricht einem anderen Typ als dem angegebenen ("wenn es nur auf keinen Fall wei√ü w√§re" - irgendetwas, nur nicht das). </font><font style="vertical-align: inherit;">Auch wenn im Voraus nicht klar ist, welche spezifischen Implementierungen erforderlich sind, spielt es keine Rolle - sie k√∂nnen sp√§ter hinzugef√ºgt werden, das System wird nicht davon abweichen (Polymorphismus, erinnerst du dich?).</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SingleDieTypeFilter</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Die.Type): DieTypeFilter { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type == type) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InvertedSingleDieTypeFilter</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Die.Type): DieTypeFilter { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type != type) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MultipleDieTypeFilter</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">vararg</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> types: Die.Type): DieTypeFilter { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = (type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InvertedMultipleDieTypeFilter</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">vararg</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> types: Die.Type): DieTypeFilter { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = (type !<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types) }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Gr√∂√üe des W√ºrfels wird ebenfalls willk√ºrlich festgelegt, aber dazu sp√§ter mehr. </font><font style="vertical-align: inherit;">In der Zwischenzeit werden wir einen Cubes-Generator ( </font></font><code>DieGenerator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">schreiben </font><font style="vertical-align: inherit;">, der im Gegensatz zum Klassenkonstruktor </font></font><code>Die</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nicht den expliziten Typ und die Gr√∂√üe des Cubes akzeptiert, sondern den Filter und den Grad der Komplexit√§t.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> DISTRIBUTION_LEVEL1 = intArrayOf(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> DISTRIBUTION_LEVEL2 = intArrayOf(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> DISTRIBUTION_LEVEL3 = intArrayOf(<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> DISTRIBUTIONS = arrayOf( intArrayOf(<span class="hljs-number"><span class="hljs-number">4</span></span>), DISTRIBUTION_LEVEL1, DISTRIBUTION_LEVEL2, DISTRIBUTION_LEVEL3 ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMaxLevel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = DISTRIBUTIONS.size - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateDie</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(filter: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DieTypeFilter</span></span></span></span><span class="hljs-function"><span class="hljs-params">, level: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Die(generateDieType(filter), generateDieSize(level)) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateDieType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(filter: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DieTypeFilter</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Die.Type { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> type: Die.Type <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { type = Die.Type.values().random() } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!filter.test(type)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> type } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateDieSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(level: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = DISTRIBUTIONS[<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (level &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> || level &gt; getMaxLevel()) <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> level].random()</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In Java w√§ren diese Methoden statisch, aber da es sich um Kotlin handelt, ben√∂tigen wir die Klasse als solche nicht, was auch f√ºr die anderen unten diskutierten Generatoren gilt (auf logischer Ebene werden wir jedoch weiterhin das Konzept der Klasse verwenden). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zwei private Methoden erzeugen getrennt den Typ und die Gr√∂√üe des W√ºrfels - √ºber jeden kann etwas Interessantes gesagt werden. Die Methode </font></font><code>generateDieType()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kann durch √úbergeben eines Eingangsfilters mit in eine Endlosschleife getrieben werden</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(filter: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DieTypeFilter</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br> (    ,         ,          ).  <code>generateDieSize()</code> ,       ,     (    ).            ,      <b>Dice</b> ,             (   ,      ).    ,     ,      .   -   (       ), ,   . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und da es sich um Taschen handelt, werden wir eine Vorlage f√ºr sie entwickeln. </font><font style="vertical-align: inherit;">Im Gegensatz zu Ihren Freunden ist diese Vorlage ( </font></font><code>BagTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) eine bestimmte Klasse. </font><font style="vertical-align: inherit;">Es enth√§lt andere Vorlagen - jede beschreibt die Regeln (oder </font></font><code>Plan</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), nach denen ein oder mehrere W√ºrfel (erinnern Sie sich an die zuvor gestellten Anforderungen?) Der Tasche hinzugef√ºgt werden.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BagTemplate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Plan</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> minQuantity: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> maxQuantity: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> filter: DieTypeFilter) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> plans = mutableListOf&lt;Plan&gt;() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addPlan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(minQuantity: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, maxQuantity: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, filter: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DieTypeFilter</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { plans.add(Plan(minQuantity, maxQuantity, filter)) } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jeder Plan definiert ein Muster f√ºr die Art der W√ºrfel sowie die Anzahl (Minimum und Maximum) der W√ºrfel, die dieses Muster erf√ºllen. </font><font style="vertical-align: inherit;">Dank dieses Ansatzes k√∂nnen Sie Taschen nach bizarren Regeln generieren (und ich weine wieder bitter um das Alter, weil mein Nachbar sich rundweg weigert, mir zu helfen).</font></font> Irgendwie so: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">realizePlan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(plan: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">BagTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Plan</span></span></span></span><span class="hljs-function"><span class="hljs-params">, level: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Array&lt;Die&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> count = (plan.minQuantity..plan.maxQuantity).shuffled().last() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>..count).map { generateDie(plan.filter, level) }.toTypedArray() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateBag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">BagTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">, level: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Bag { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> template.plans.asSequence() .map { realizePlan(it, level) } .fold(Bag()) { b, d -&gt; b.put(*d); b } } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie, genau wie ich, diesen ganzen Funktionalismus satt haben, befestigen Sie sich - es wird nur noch schlimmer. Im Gegensatz zu vielen undeutlichen Tutorials im Internet haben wir jedoch die M√∂glichkeit, die Verwendung verschiedener cleverer Methoden in Bezug auf einen realen, verst√§ndlichen Themenbereich zu untersuchen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alleine liegen die Taschen nicht auf dem Feld - Sie m√ºssen sie den Helden und Orten geben. Beginnen wir mit letzterem.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LocationTemplate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> description: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> bagTemplate: BagTemplate <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> basicClosingDifficulty: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enemyCardsCount: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> obstacleCardsCount: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enemyCardPool: Collection&lt;EnemyTemplate&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> obstacleCardPool: Collection&lt;ObstacleTemplate&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> specialRules: List&lt;SpecialRule&gt; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In der Kotlin-Sprache k√∂nnen Sie anstelle von Methoden </font></font><code>get()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schnittstelleneigenschaften verwenden - dies ist viel pr√§ziser. Wir sind bereits mit der Taschenvorlage vertraut, ber√ºcksichtigen Sie die verbleibenden Methoden. Die Eigenschaft </font></font><code>basicClosingDifficulty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">legt die grundlegende Komplexit√§t der Pr√ºfung zum Schlie√üen des Gel√§ndes fest. Das Wort ‚Äûgrundlegend‚Äú bedeutet hier nur, dass die endg√ºltige Komplexit√§t von der Ebene des Szenarios abh√§ngt und zu diesem Zeitpunkt unklar ist. Au√üerdem m√ºssen wir Muster f√ºr Feinde und Hindernisse (und gleichzeitig f√ºr B√∂sewichte) definieren. Dar√ºber hinaus werden aus der Vielzahl der in der Vorlage beschriebenen Feinde und Hindernisse nicht alle verwendet, sondern nur eine begrenzte Anzahl (um den Wiederholungswert zu erh√∂hen). Bitte beachten Sie, dass die Sonderregeln ( </font></font><code>SpecialRule</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) des Bereichs durch eine einfache Aufz√§hlung ( </font></font><code>enum class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">implementiert werden </font><font style="vertical-align: inherit;">und daher keine separate Vorlage erfordern.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EnemyTemplate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> description: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> traits: List&lt;Trait&gt; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ObstacleTemplate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> description: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> tier: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dieTypes: Array&lt;Die.Type&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> traits: List&lt;Trait&gt; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VillainTemplate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> description: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> traits: List&lt;Trait&gt; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Und lassen Sie den Generator nicht nur einzelne Objekte, sondern auch ganze Decks mit ihnen erstellen. </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateVillain</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">VillainTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Villain().apply { name = template.name description = template.description template.traits.forEach { addTrait(it) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateEnemy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">EnemyTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Enemy().apply { name = template.name description = template.description template.traits.forEach { addTrait(it) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateObstacle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ObstacleTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Obstacle(template.tier, *template.dieTypes).apply { name = template.name description = template.description template.traits.forEach { addTrait(it) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateEnemyDeck</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(types: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Collection</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">EnemyTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;, limit: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span>: Deck&lt;Enemy&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> deck = types .map { generateEnemy(it) } .shuffled() .fold(Deck&lt;Enemy&gt;()) { d, c -&gt; d.addToTop(c); d } limit?.let { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (deck.size &gt; it) deck.drawFromTop() } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> deck } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateObstacleDeck</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(templates: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Collection</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ObstacleTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;, limit: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span>: Deck&lt;Obstacle&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> deck = templates .map { generateObstacle(it) } .shuffled() .fold(Deck&lt;Obstacle&gt;()) { d, c -&gt; d.addToTop(c); d } limit?.let { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (deck.size &gt; it) deck.drawFromTop() } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> deck }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn sich mehr Karten im Deck befinden, als wir ben√∂tigen (Parameter </font></font><code>limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), werden wir sie von dort entfernen. </font><font style="vertical-align: inherit;">Indem wir Taschen mit W√ºrfeln und Kartenspielen erzeugen k√∂nnen, k√∂nnen wir endlich Terrain schaffen:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">LocationTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">, level: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Location().apply { name = template.name description = template.description bag = generateBag(template.bagTemplate, level) closingDifficulty = template.basicClosingDifficulty + level * <span class="hljs-number"><span class="hljs-number">2</span></span> enemies = generateEnemyDeck(template.enemyCardPool, template.enemyCardsCount) obstacles = generateObstacleDeck(template.obstacleCardPool, template.obstacleCardsCount) template.specialRules.forEach { addSpecialRule(it) } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Das Terrain, das wir am Anfang des Kapitels explizit im Code festgelegt haben, sieht jetzt ganz anders aus: </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeLocationTemplate</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LocationTemplate { override val name = "Some location" override val description = "Some description" override val bagTemplate = BagTemplate</span></span></span></span>().apply { addPlan(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, SingleDieTypeFilter(Die.Type.PHYSICAL)) addPlan(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, SingleDieTypeFilter(Die.Type.SOMATIC)) addPlan(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, SingleDieTypeFilter(Die.Type.MENTAL)) addPlan(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, MultipleDieTypeFilter(Die.Type.ENEMY, Die.Type.OBSTACLE)) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> basicClosingDifficulty = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enemyCardsCount = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> obstacleCardsCount = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enemyCardPool = listOf( SomeEnemyTemplate(), OtherEnemyTemplate() ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> obstacleCardPool = listOf( SomeObstacleTemplate() ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> specialRules = emptyList&lt;SpecialRule&gt;() } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeEnemyTemplate</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EnemyTemplate { override val name = "Some enemy" override val description = "Some description" override val traits = emptyList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Trait</span></span></span><span class="hljs-class">&gt;</span></span>() } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OtherEnemyTemplate</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EnemyTemplate { override val name = "Other enemy" override val description = "Some description" override val traits = emptyList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Trait</span></span></span><span class="hljs-class">&gt;</span></span>() } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeObstacleTemplate</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ObstacleTemplate { override val name = "Some obstacle" override val description = "Some description" override val traits = emptyList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Trait</span></span></span><span class="hljs-class">&gt;</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> tier = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dieTypes = arrayOf( Die.Type.PHYSICAL, Die.Type.VERBAL ) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> location = generateLocation(SomeLocationTemplate(), <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Die Szenariogenerierung erfolgt auf √§hnliche Weise. </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ScenarioTemplate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> description: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> initialTimer: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> staticLocations: List&lt;LocationTemplate&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dynamicLocationsPool: List&lt;LocationTemplate&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> villains: List&lt;VillainTemplate&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> specialRules: List&lt;SpecialRule&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateDynamicLocationsCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(numberOfHeroes: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = numberOfHeroes + <span class="hljs-number"><span class="hljs-number">2</span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In √úbereinstimmung mit den Regeln h√§ngt die Anzahl der dynamisch generierten Orte von der Anzahl der Helden ab. </font><font style="vertical-align: inherit;">Die Schnittstelle definiert eine Standardberechnungsfunktion, die bei Bedarf in bestimmten Implementierungen neu definiert werden kann. </font><font style="vertical-align: inherit;">In Verbindung mit dieser Anforderung generiert der Szenario-Generator auch Terrain f√ºr diese Szenarien - an derselben Stelle werden die B√∂sewichte zuf√§llig auf die Orte verteilt.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateScenario</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ScenarioTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">, level: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Scenario().apply { name =template.name description = template.description <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.level = level initialTimer = template.initialTimer template.specialRules.forEach { addSpecialRule(it) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateLocations</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ScenarioTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">, level: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, numberOfHeroes: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: List&lt;Location&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> locations = template.staticLocations.map { generateLocation(it, level) } + template.dynamicLocationsPool .map { generateLocation(it, level) } .shuffled() .take(template.calculateDynamicLocationsCount(numberOfHeroes)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> villains = template.villains .map(::generateVillain) .shuffled() locations.forEachIndexed { index, location -&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index &lt; villains.size) { location.villain = villains[index] location.bag.put(generateDie(SingleDieTypeFilter(Die.Type.VILLAIN), level)) } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> locations }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Viele aufmerksame Leser werden einwenden, dass die Vorlagen nicht im Quellcode der Klassen, sondern in einigen Textdateien (Skripten) gespeichert werden m√ºssen, damit auch diejenigen, die weit von der Programmierung entfernt sind, sie erstellen und verwalten k√∂nnen. </font><font style="vertical-align: inherit;">Ich stimme zu, ich nehme meinen Hut ab, aber ich streue keine Asche auf meinen Kopf - denn einer st√∂rt den anderen nicht. </font><font style="vertical-align: inherit;">Wenn Sie m√∂chten, definieren Sie einfach eine spezielle Implementierung der Vorlage, deren Eigenschaftswerte aus einer externen Datei geladen werden. </font><font style="vertical-align: inherit;">Der Generierungsprozess √§ndert kein Jota davon. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nun, es scheint, als h√§tten sie nichts vergessen ... Oh ja, Helden - sie m√ºssen auch generiert werden, was bedeutet, dass sie auch ihre eigenen Vorlagen ben√∂tigen. </font><font style="vertical-align: inherit;">Hier sind einige zum Beispiel:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HeroTemplate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Hero.Type <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> initialHandCapacity: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> favoredDieType: Die.Type <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> initialDice: Collection&lt;Die&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> initialSkills: List&lt;SkillTemplate&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dormantSkills: List&lt;SkillTemplate&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDiceCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Pair&lt;<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>&gt;? }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und sofort bemerken wir zwei Kuriosit√§ten. </font><font style="vertical-align: inherit;">Erstens verwenden wir keine Vorlagen, um darin Taschen und W√ºrfel zu generieren.</font></font> Warum?<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ja, da f√ºr jeden Heldentyp (jede Klasse) die Liste der Anfangsw√ºrfel streng definiert ist - es macht keinen Sinn, den Prozess ihrer Erstellung zu verkomplizieren. </font><font style="vertical-align: inherit;">Zweitens </font></font><code>getDiceCount()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- was f√ºr ein Bodensatz ist das ??? </font><font style="vertical-align: inherit;">Beruhige dich, dies sind diejenigen </font></font><code>DiceLimit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die die Einschr√§nkungen f√ºr die W√ºrfel definieren. </font><font style="vertical-align: inherit;">Und die Vorlage f√ºr sie wurde in einer so bizarren Form ausgew√§hlt, dass bestimmte Werte klarer aufgezeichnet wurden. </font><font style="vertical-align: inherit;">√úberzeugen Sie sich anhand des Beispiels:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BrawlerHeroTemplate</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HeroTemplate { override val type = Hero.Type.BRAWLER override val favoredDieType = PHYSICAL override val initialHandCapacity = 4 override val initialDice = listOf</span></span></span></span>( Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">6</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">6</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">6</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(MENTAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(VERBAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(VERBAL, <span class="hljs-number"><span class="hljs-number">4</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDiceCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (type) { PHYSICAL -&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> to <span class="hljs-number"><span class="hljs-number">12</span></span> SOMATIC -&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> to <span class="hljs-number"><span class="hljs-number">7</span></span> MENTAL -&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> to <span class="hljs-number"><span class="hljs-number">2</span></span> VERBAL -&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> to <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">null</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> initialSkills = listOf( HitSkillTemplate() ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dormantSkills = listOf&lt;SkillTemplate&gt;() } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HunterHeroTemplate</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HeroTemplate { override val type = Hero.Type.HUNTER override val favoredDieType = SOMATIC override val initialHandCapacity = 5 override val initialDice = listOf</span></span></span></span>( Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">6</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">6</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(MENTAL, <span class="hljs-number"><span class="hljs-number">6</span></span>), Die(MENTAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(MENTAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(MENTAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(VERBAL, <span class="hljs-number"><span class="hljs-number">4</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDiceCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (type) { PHYSICAL -&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> to <span class="hljs-number"><span class="hljs-number">5</span></span> SOMATIC -&gt; <span class="hljs-number"><span class="hljs-number">7</span></span> to <span class="hljs-number"><span class="hljs-number">11</span></span> MENTAL -&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> to <span class="hljs-number"><span class="hljs-number">7</span></span> VERBAL -&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> to <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">null</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> initialSkills = listOf( ShootSkillTemplate() ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dormantSkills = listOf&lt;SkillTemplate&gt;() }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bevor wir jedoch einen Generator schreiben, definieren wir eine Vorlage f√ºr F√§higkeiten. </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SkillTemplate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Skill.Type <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> maxLevel: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> modifier1: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> modifier2: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> isActive <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HitSkillTemplate</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SkillTemplate { override val type = Skill.Type.HIT override val maxLevel = 3 override val modifier1 = +1 override val modifier2 = +3 } class ShootSkillTemplate : SkillTemplate { override val type = Skill.Type.SHOOT override val maxLevel = 3 override val modifier1 = +0 override val modifier2 = +2 }</span></span></span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leider wird es uns nicht gelingen, Fertigkeiten in Stapeln wie Feinde und Skripte zu vernetzen. </font><font style="vertical-align: inherit;">Jede neue Fertigkeit erfordert die Erweiterung der Spielmechanik und das Hinzuf√ºgen eines neuen Codes zur Spiel-Engine - selbst bei Helden ist diesbez√ºglich einfacher. </font><font style="vertical-align: inherit;">Vielleicht kann dieser Prozess abstrahiert werden, aber ich habe noch keinen Weg gefunden. </font><font style="vertical-align: inherit;">Ja, und nicht zu versucht, um ehrlich zu sein.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateSkill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">SkillTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">, initialLevel: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Skill { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> skill = Skill(template.type) skill.isActive = template.isActive skill.level = initialLevel skill.maxLevel = template.maxLevel skill.modifier1 = template.modifier1 skill.modifier2 = template.modifier2 <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> skill } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateHero</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hero</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">, name: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Hero { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> template = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (type) { BRAWLER -&gt; BrawlerHeroTemplate() HUNTER -&gt; HunterHeroTemplate() } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> hero = Hero(type) hero.name = name hero.isAlive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> hero.favoredDieType = template.favoredDieType hero.hand.capacity = template.initialHandCapacity template.initialDice.forEach { hero.bag.put(it) } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ((t, l) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Die.Type.values().map { it to template.getDiceCount(it) }) { l?.let { hero.addDiceLimit(DiceLimit(t, it.first, it.second, it.first)) } } template.initialSkills .map { generateSkill(it) } .forEach { hero.addSkill(it) } template.dormantSkills .map { generateSkill(it, <span class="hljs-number"><span class="hljs-number">0</span></span>) } .forEach { hero.addDormantSkill(it) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hero }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nur ein paar Momente sind auff√§llig. </font><font style="vertical-align: inherit;">Zun√§chst w√§hlt die Generierungsmethode selbst die gew√ºnschte Vorlage in Abh√§ngigkeit von der Klasse des Helden aus. </font><font style="vertical-align: inherit;">Zweitens ist es nicht erforderlich, einen Namen sofort anzugeben (manchmal wissen wir ihn in der Generierungsphase noch nicht). </font><font style="vertical-align: inherit;">Drittens brachte Kotlin eine beispiellose Menge syntaktischen Zuckers ein, die einige Entwickler unangemessen missbrauchen. </font><font style="vertical-align: inherit;">Und kein bisschen besch√§mt.</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schritt acht. </font><font style="vertical-align: inherit;">Spielzyklus</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schlie√ülich kamen wir zum interessantesten - der Implementierung des Spielzyklus. </font><font style="vertical-align: inherit;">In einfachen Worten, sie fingen an, "das Spiel zu machen". </font><font style="vertical-align: inherit;">Viele anf√§ngliche Entwickler beginnen oft genau in dieser Phase, abgesehen vom Spielemachen und allem anderen. </font><font style="vertical-align: inherit;">Vor allem alle m√∂glichen bedeutungslosen kleinen Pl√§ne zum Zeichnen, pfff ... Aber wir werden uns nicht beeilen (es ist noch weit vom Morgen entfernt) und daher etwas mehr modellieren. </font><font style="vertical-align: inherit;">Ja nochmal.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aktivit√§tsdiagramm</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/up/tm/6t/uptm6t8obpw80m3_cr1i6b9q62e.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie Sie sehen k√∂nnen, ist das gegebene Fragment des Spielzyklus eine Gr√∂√üenordnung kleiner als das, was wir oben zitiert haben. Wir werden nur den Prozess der √úbertragung des Kurses, der Erkundung des Gel√§ndes (und wir werden das Treffen mit nur zwei Arten von W√ºrfeln beschreiben) und des Verwerfens der W√ºrfel am Ende der Runde betrachten. Und das Szenario mit einem Verlust abzuschlie√üen (ja, es wird uns noch nicht gelingen, unser Spiel zu gewinnen) - aber wie gef√§llt es Ihnen? Der Timer wird mit jeder Runde k√ºrzer und nach Abschluss muss etwas getan werden. Zeigen Sie zum Beispiel eine Nachricht an und beenden Sie das Spiel - alles ist so, wie es in den Regeln geschrieben steht. Ein weiteres Spiel muss nach dem Tod der Helden abgeschlossen sein, aber niemand wird ihnen Schaden zuf√ºgen, deshalb werden wir es verlassen. Um zu gewinnen, m√ºssen Sie alle Bereiche schlie√üen, was schwierig ist, auch wenn es nur einer ist. Lassen wir deshalb diesen Moment. Es macht keinen Sinn, zu viel zu spr√ºhen - es ist wichtig, dass wir die Essenz verstehen und den Rest sp√§ter in meiner Freizeit erledigen (oder besser gesagt, um ihn zu beenden).und du - schreib ein Spiel</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deiner</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tr√§ume). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Als erstes m√ºssen wir entscheiden, welche Objekte wir ben√∂tigen. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Helden</font></font></b>  <b>Das Skript.</b> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Standorte. </font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben den Entstehungsprozess bereits √ºberpr√ºft - wir werden ihn nicht wiederholen. </font><font style="vertical-align: inherit;">Wir notieren nur das Gel√§ndemuster, das wir in unserem kleinen Beispiel verwenden werden.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestLocationTemplate</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LocationTemplate { override val name = "Test" override val description = "Some Description" override val basicClosingDifficulty = 0 override val enemyCardsCount = 0 override val obstacleCardsCount = 0 override val bagTemplate = BagTemplate</span></span></span></span>().apply { addPlan(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, SingleDieTypeFilter(Die.Type.PHYSICAL)) addPlan(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, SingleDieTypeFilter(Die.Type.SOMATIC)) addPlan(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, SingleDieTypeFilter(Die.Type.MENTAL)) addPlan(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, SingleDieTypeFilter(Die.Type.VERBAL)) addPlan(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, SingleDieTypeFilter(Die.Type.DIVINE)) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enemyCardPool = emptyList&lt;EnemyTemplate&gt;() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> obstacleCardPool = emptyList&lt;ObstacleTemplate&gt;() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> specialRules = emptyList&lt;SpecialRule&gt;() }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie Sie sehen k√∂nnen, befinden sich in der Tasche nur "positive" W√ºrfel - blau, gr√ºn, lila, gelb und blau. Es gibt keine Feinde und Hindernisse in der Gegend, B√∂sewichte und Wunden werden nicht gefunden. Es gibt auch keine speziellen Regeln - ihre Implementierung ist sehr zweitrangig. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Haufen f√ºr zur√ºckbehaltene W√ºrfel.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Oder ein abschreckender Haufen. Da wir die blauen W√ºrfel in den Beutel des Gel√§ndes legen, k√∂nnen sie f√ºr Schecks verwendet und nach Gebrauch auf einem speziellen Haufen aufbewahrt werden. Eine Instanz der Klasse ist hierf√ºr n√ºtzlich </font></font><code>Pile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modifikatoren.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Das hei√üt, die numerischen Werte, die zum Ergebnis des W√ºrfelwurfs addiert oder subtrahiert werden m√ºssen. Sie k√∂nnen f√ºr jeden Cube entweder einen globalen oder einen separaten Modifikator implementieren. Wir werden die zweite Option w√§hlen (also klarer), daher werden wir eine einfache Klasse erstellen </font></font><code>DiePair</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DiePair</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> die: Die, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> modifier: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Position der Zeichen im Bereich.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In guter Weise muss dieser Moment mithilfe einer speziellen Struktur verfolgt werden. Zum Beispiel Karten des Formulars, </font></font><code>Map&lt;Location, List&lt;Hero&gt;&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in dem jeder Ort eine Liste der aktuell darin enthaltenen Helden enth√§lt (sowie eine Methode f√ºr das Gegenteil - Bestimmung des Ortes, an dem sich ein bestimmter Held befindet). Wenn Sie sich f√ºr diesen Pfad entscheiden, vergessen Sie nicht </font></font><code>Location</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, der Implementierungsklasse Methoden </font><font style="vertical-align: inherit;">hinzuzuf√ºgen </font><font style="vertical-align: inherit;">, </font></font><code>equals()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>hashCode()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ich hoffe, Sie m√ºssen nicht erkl√§ren, warum. Wir werden keine Zeit damit verschwenden, da das Gebiet nur eines ist und die Helden es nirgendwo lassen. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√úberpr√ºfen Sie die H√§nde des Helden.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W√§hrend des Spiels m√ºssen die Helden st√§ndig Pr√ºfungen durchlaufen (die unten beschrieben werden), dh W√ºrfel aus der Hand nehmen, werfen (Modifikatoren hinzuf√ºgen), die Ergebnisse aggregieren, wenn mehrere W√ºrfel vorhanden sind (zusammenfassen, Maximum / Minimum, Durchschnitt usw. nehmen), sie mit dem Wurf vergleichen einen anderen W√ºrfel (einer, der aus dem Beutel des Bereichs entfernt wird) und f√ºhren Sie je nach Ergebnis die folgenden Aktionen aus. Zuallererst muss man verstehen, ob der Held die Pr√ºfung grunds√§tzlich bestehen kann, dh ob er die notwendigen W√ºrfel in der Hand hat. Daf√ºr bieten wir eine einfache Schnittstelle </font></font><code>HandFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HandFilter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(hand: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hand</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schnittstellenimplementierungen nehmen die Hand des Helden (Klassenobjekt </font></font><code>Hand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">als Eingabe </font><font style="vertical-align: inherit;">und geben </font><font style="vertical-align: inherit;">je nach Ergebnis der Pr√ºfung </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entweder zur√ºck </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. F√ºr unser Fragment des Spiels ben√∂tigen wir eine einzige Implementierung: Wenn ein blauer, gr√ºner, lila oder gelber W√ºrfel getroffen wird, m√ºssen wir feststellen, ob die Hand des Helden einen W√ºrfel derselben Farbe hat.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SingleDieHandFilter</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">vararg</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> types: Die.Type) : HandFilter { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(hand: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hand</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = (<span class="hljs-number"><span class="hljs-number">0</span></span> until hand.dieCount).mapNotNull { hand.dieAt(it) }.any { it.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types } || (Die.Type.ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types &amp;&amp; hand.allyDieCount &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ja, wieder Funktionalismus. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aktive / ausgew√§hlte Elemente.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nachdem wir sichergestellt haben, dass die Hand des Helden f√ºr die Durchf√ºhrung des Tests geeignet ist, muss der Spieler aus der Hand die W√ºrfel (oder W√ºrfel) ausw√§hlen, mit denen er diesen Test bestehen wird. Zun√§chst m√ºssen Sie die entsprechenden Positionen markieren (hervorheben) (an denen sich W√ºrfel des gew√ºnschten Typs befinden). Zweitens m√ºssen Sie die ausgew√§hlten W√ºrfel irgendwie markieren. F√ºr diese beiden Anforderungen ist eine Klasse geeignet </font></font><code>HandMask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die tats√§chlich eine Reihe von Ganzzahlen (Anzahl der ausgew√§hlten Positionen) und Methoden zum Hinzuf√ºgen und Entfernen dieser enth√§lt.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HandMask</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> positions = mutableSetOf&lt;<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>&gt;() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> allyPositions = mutableSetOf&lt;<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> positionCount <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = positions.size <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> allyPositionCount <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = allyPositions.size <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = positions.add(position) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removePosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = positions.remove(position) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addAllyPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = allyPositions.add(position) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeAllyPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = allyPositions.remove(position) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = position <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> positions <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkAllyPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = position <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> allyPositions <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">switchPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!removePosition(position)) { addPosition(position) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">switchAllyPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!removeAllyPosition(position)) { addAllyPosition(position) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { positions.clear() allyPositions.clear() } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich habe bereits gesagt, wie ich unter der ‚Äûgenialen‚Äú Idee leide, wei√üe W√ºrfel in einer separaten Hand aufzubewahren? Aufgrund dieser Dummheit m√ºssen Sie sich mit zwei S√§tzen befassen und jede der vorgestellten Methoden duplizieren. Wenn jemand Ideen hat, wie die Implementierung dieser Anforderung vereinfacht werden kann (verwenden Sie beispielsweise einen Satz, aber f√ºr wei√üe W√ºrfel beginnen die Indizes mit hundert - oder etwas anderem, das ebenfalls dunkel ist), teilen Sie diese in den Kommentaren mit. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√úbrigens muss eine √§hnliche Klasse implementiert werden, um Cubes aus dem heap ( </font></font><code>PileMask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">auszuw√§hlen </font><font style="vertical-align: inherit;">, aber diese Funktionalit√§t liegt au√üerhalb des Bereichs dieses Beispiels. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Auswahl der W√ºrfel aus der Hand.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es reicht jedoch nicht aus, akzeptable Positionen hervorzuheben, sondern es ist wichtig, diese Hervorhebung bei der Auswahl der W√ºrfel zu √§ndern. Das hei√üt, wenn ein Spieler nur einen W√ºrfel von seiner Hand nehmen muss, sollten bei Auswahl dieses W√ºrfels alle anderen Positionen unzug√§nglich werden. Dar√ºber hinaus ist es in jeder Phase erforderlich, die Erf√ºllung des Ziels durch den Spieler zu kontrollieren, dh zu verstehen, ob die ausgew√§hlten W√ºrfel ausreichen, um den einen oder anderen Test zu bestehen. Eine solch schwierige Aufgabe erfordert eine komplexe Instanz einer komplexen Klasse.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HandMaskRule</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> hand: Hand) { <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPositionActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isAllyPositionActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCheckedDice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: List&lt;Die&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((<span class="hljs-number"><span class="hljs-number">0</span></span> until hand.dieCount).filter(mask::checkPosition).map(hand::dieAt)) .plus((<span class="hljs-number"><span class="hljs-number">0</span></span> until hand.allyDieCount).filter(mask::checkAllyPosition).map(hand::allyDieAt)) .filterNotNull() } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ziemlich komplizierte Logik, ich werde Sie verstehen und Ihnen vergeben, wenn diese Klasse f√ºr Sie unverst√§ndlich ist. Und versuche immer noch zu erkl√§ren. Implementierungen dieser Klasse speichern immer einen Verweis auf die Hand (das Objekt </font></font><code>Hand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), mit der sie sich befassen. Jede der Methoden erh√§lt eine Maske ( </font></font><code>HandMask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), die den aktuellen Status der Auswahl widerspiegelt (welche Positionen vom Spieler ausgew√§hlt werden und welche nicht). Die Methode gibt an </font></font><code>checkMask()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ob die ausgew√§hlten W√ºrfel ausreichen, um den Test zu bestehen. Die Methode </font></font><code>isPositionActive()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gibt an, ob eine bestimmte Position hervorgehoben werden muss - ob es m√∂glich ist, dem Test einen W√ºrfel an dieser Position hinzuzuf√ºgen (oder einen bereits ausgew√§hlten W√ºrfel zu entfernen). Die Methode </font></font><code>isAllyPositionActive()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist die gleiche f√ºr wei√üe W√ºrfel (ja, ich wei√ü, ich bin ein Idiot). Nun und die Hilfsmethode</font></font><code>getCheckedDice()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es gibt einfach eine Liste aller W√ºrfel aus der Hand zur√ºck, die der Maske entsprechen - dies ist notwendig, um sie alle auf einmal zu nehmen, sie auf den Tisch zu werfen und das lustige Klopfen zu genie√üen, mit dem sie sich in verschiedene Richtungen zerstreuen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir brauchen zwei Realisierungen dieser abstrakten Klasse (√úberraschung, √úberraschung!). Der erste steuert den Prozess des Bestehens des Tests beim Erwerb eines neuen W√ºrfels eines bestimmten Typs (nicht wei√ü). Wie Sie sich erinnern, k√∂nnen einer solchen Pr√ºfung beliebig viele blaue W√ºrfel hinzugef√ºgt werden.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StatDieAcquireHandMaskRule</span></span></span></span>(hand: Hand, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> requiredType: Die.Type) : HandMaskRule(hand) { <span class="hljs-comment"><span class="hljs-comment">/** * Define how many dice of specified type are currently checked */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkedDieCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = (<span class="hljs-number"><span class="hljs-number">0</span></span> until hand.dieCount) .filter(mask::checkPosition) .mapNotNull(hand::dieAt) .count { it.type === requiredType } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = (mask.allyPositionCount == <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; checkedDieCount(mask) == <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPositionActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = with(hand.dieAt(position)) { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { mask.checkPosition(position) -&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> == <span class="hljs-literal"><span class="hljs-literal">null</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type === Die.Type.DIVINE -&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type === requiredType &amp;&amp; checkedDieCount(mask) &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isAllyPositionActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die zweite Implementierung ist komplizierter. Sie kontrolliert den W√ºrfelwurf am Ende des Zuges. In diesem Fall sind zwei Optionen m√∂glich. Wenn die Anzahl der W√ºrfel in der Hand die maximal zul√§ssige Gr√∂√üe (Kapazit√§t) √ºberschreitet, m√ºssen wir alle zus√§tzlichen W√ºrfel plus eine beliebige Anzahl zus√§tzlicher W√ºrfel verwerfen (wenn wir m√∂chten). Wenn die Gr√∂√üe nicht √ºberschritten wird, k√∂nnen Sie nichts zur√ºcksetzen (oder, falls gew√ºnscht, zur√ºcksetzen). In keinem Fall k√∂nnen graue W√ºrfel weggeworfen werden.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DiscardExtraDiceHandMaskRule</span></span></span></span>(hand: Hand) : HandMaskRule(hand) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> minDiceToDiscard = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hand.dieCount &gt; hand.capacity) min(hand.dieCount - hand.woundCount, hand.dieCount - hand.capacity) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> maxDiceToDiscard = hand.dieCount - hand.woundCount <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = (mask.positionCount <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> minDiceToDiscard..maxDiceToDiscard) &amp;&amp; (mask.allyPositionCount <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>..hand.allyDieCount) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPositionActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { mask.checkPosition(position) -&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> hand.dieAt(position) == <span class="hljs-literal"><span class="hljs-literal">null</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> hand.dieAt(position)!!.type == Die.Type.WOUND -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> mask.positionCount &lt; maxDiceToDiscard -&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isAllyPositionActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = hand.allyDieAt(position) != <span class="hljs-literal"><span class="hljs-literal">null</span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nezhdanchik: In der Klasse </font></font><code>Hand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tauchte pl√∂tzlich eine Eigenschaft auf </font></font><code>woundCount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die vorher nicht existierte. Sie k√∂nnen die Implementierung selbst schreiben, es ist ganz einfach. √úbe gleichzeitig. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schecks bestehen.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Endlich zu ihnen gekommen. Wenn die W√ºrfel aus der Hand genommen werden, ist es Zeit, sie zu werfen. F√ºr jeden W√ºrfel muss Folgendes ber√ºcksichtigt werden: seine Gr√∂√üe, seine Modifikatoren, das Ergebnis seines Wurfs. Obwohl jeweils nur ein W√ºrfel aus dem Beutel genommen werden kann, k√∂nnen mehrere W√ºrfel dagegen gelegt werden, um die Ergebnisse ihrer W√ºrfe zu aggregieren. Lassen Sie uns im Allgemeinen von den W√ºrfeln abstrahieren und die Truppen auf dem Schlachtfeld darstellen. Einerseits haben wir einen Feind - er ist nur einer, aber er ist stark und wild. Auf der anderen Seite ein Gegner, der genauso stark ist wie er, aber mit Unterst√ºtzung. Der Ausgang des Kampfes wird in einem kurzen Gefecht entschieden, der Gewinner kann nur einer sein ...</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entschuldigung, weggetragen. Um unseren allgemeinen Kampf zu simulieren, implementieren wir eine spezielle Klasse.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DieBattleCheck</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> method: Method, opponent: DiePair? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Method</span></span></span><span class="hljs-class"> </span></span>{ SUM, AVG_UP, AVG_DOWN, MAX, MIN } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">inner</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Wrap</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pair: DiePair, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> roll: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">infix</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> DiePair.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(roll: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Wrap(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, roll) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> opponent: Wrap? = opponent?.with(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> heroics = ArrayList&lt;Wrap&gt;() <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isRolled = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> heroPairCount <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = heroics.size <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOpponentPair</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = opponent?.pair <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOpponentResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { isRolled -&gt; opponent?.roll ?: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalStateException(<span class="hljs-string"><span class="hljs-string">"Not rolled yet"</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addHeroPair</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pair: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DiePair</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (method == Method.SUM &amp;&amp; heroics.size &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { pair.modifier = <span class="hljs-number"><span class="hljs-number">0</span></span> } heroics.add(pair with <span class="hljs-number"><span class="hljs-number">0</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addHeroPair</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(die: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">, modifier: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = addHeroPair(DiePair(die, modifier)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearHeroPairs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = heroics.clear() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHeroPairAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(index: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = heroics[index].pair <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHeroResultAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(index: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { isRolled -&gt; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { (index <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> until heroics.size) -&gt; heroics[index].roll <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalStateException(<span class="hljs-string"><span class="hljs-string">"Not rolled yet"</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">roll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">roll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(wrap: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Wrap</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { wrap.roll = wrap.pair.die.roll() } isRolled = <span class="hljs-literal"><span class="hljs-literal">true</span></span> opponent?.let { roll(it) } heroics.forEach { roll(it) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isRolled) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalStateException(<span class="hljs-string"><span class="hljs-string">"Not rolled yet"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> opponentResult = opponent?.let { it.roll + it.pair.modifier } ?: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> stats = heroics.map { it.roll + it.pair.modifier } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> heroResult = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (method) { DieBattleCheck.Method.SUM -&gt; stats.sum() DieBattleCheck.Method.AVG_UP -&gt; ceil(stats.average()).toInt() DieBattleCheck.Method.AVG_DOWN -&gt; floor(stats.average()).toInt() DieBattleCheck.Method.MAX -&gt; stats.max() ?: <span class="hljs-number"><span class="hljs-number">0</span></span> DieBattleCheck.Method.MIN -&gt; stats.min() ?: <span class="hljs-number"><span class="hljs-number">0</span></span> } result = heroResult - opponentResult } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Da jeder Cube einen Modifikator haben kann, speichern wir Daten in Objekten </font></font><code>DiePair</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. So'ne Art. Nein, denn neben dem Cube und dem Modifikator m√ºssen Sie auch das Ergebnis seines Wurfs speichern (denken Sie daran, dass der Cube selbst diesen Wert generiert, ihn jedoch nicht in seinen Eigenschaften speichert). Wickeln Sie daher jedes Paar in einen Wrapper ( </font></font><code>Wrap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><code>with</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Achten Sie </font><font style="vertical-align: inherit;">auf die Infix-Methode </font><font style="vertical-align: inherit;">, hehe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Klassenkonstruktor definiert die Aggregationsmethode (eine Instanz der internen Aufz√§hlung </font></font><code>Method</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) und den Gegner (der m√∂glicherweise nicht vorhanden ist). Die Liste der Heldenw√ºrfel wird mit den entsprechenden Methoden erstellt. Es bietet auch eine Reihe von Methoden, um die Paare in den Test einzubeziehen, und die Ergebnisse ihrer W√ºrfe (falls vorhanden). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Methode</font></font><code>roll()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ruft die gleichnamige Methode jedes Cubes auf, speichert die Zwischenergebnisse und markiert die Ausf√ºhrung mit einem Flag </font></font><code>isRolled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Bitte beachten Sie, dass das Endergebnis des Wurfs nicht sofort berechnet wird. Hierf√ºr gibt es eine spezielle Methode </font></font><code>calculateResult()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, bei der der endg√ºltige Wert in die Eigenschaft geschrieben wird </font></font><code>result</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Warum wird das ben√∂tigt? F√ºr einen dramatischen Effekt. Die Methode </font></font><code>roll()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wird mehrmals ausgef√ºhrt, wobei jedes Mal auf den Fl√§chen der W√ºrfel unterschiedliche Werte angezeigt werden (genau wie im wirklichen Leben). Und erst wenn sich die W√ºrfel auf dem Tisch beruhigen, erfahren wir √ºber </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unser Schicksal das</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Endergebnis (den Unterschied zwischen den Werten der W√ºrfel des Helden und den W√ºrfeln des Gegners). Um Stress abzubauen, werde ich sagen, dass ein Ergebnis von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> als erfolgreicher Test bestanden wird.</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Status der Spiel-Engine.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Anspruchsvolle Objekte aussortiert, jetzt sind die Dinge einfacher. Es wird keine gro√üe Entdeckung sein zu sagen, dass wir den aktuellen ‚ÄûFortschritt‚Äú der Spiel-Engine, die Phase oder Phase, in der sie sich befindet, kontrollieren m√ºssen. Hierf√ºr ist eine spezielle Aufz√§hlung hilfreich.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GamePhase</span></span></span><span class="hljs-class"> </span></span>{ SCENARIO_START, HERO_TURN_START, HERO_TURN_END, LOCATION_BEFORE_EXPLORATION, LOCATION_ENCOUNTER_STAT, LOCATION_ENCOUNTER_DIVINE, LOCATION_AFTER_EXPLORATION, GAME_LOSS }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eigentlich gibt es mehr Phasen, aber wir haben nur diejenigen ausgew√§hlt, die in unserem Beispiel verwendet werden. Um die Phase der Spiel-Engine zu √§ndern, verwenden wir Methoden </font></font><code>changePhaseX()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, wobei </font></font><code>X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">der Wert aus der obigen Liste ist. Bei diesen Methoden werden alle internen Variablen des Motors auf Werte reduziert, die f√ºr den Beginn der entsprechenden Phase angemessen sind, aber dazu sp√§ter mehr. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachrichten</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Es reicht nicht aus, den Status der Spiel-Engine beizubehalten. Es ist auch wichtig, dass der Benutzer irgendwie √ºber ihn informiert - sonst woher wei√ü dieser, was auf seinem Bildschirm passiert? Deshalb brauchen wir eine andere Auflistung.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StatusMessage</span></span></span><span class="hljs-class"> </span></span>{ EMPTY, CHOOSE_DICE_PERFORM_CHECK, END_OF_TURN_DISCARD_EXTRA, END_OF_TURN_DISCARD_OPTIONAL, CHOOSE_ACTION_BEFORE_EXPLORATION, CHOOSE_ACTION_AFTER_EXPLORATION, ENCOUNTER_PHYSICAL, ENCOUNTER_SOMATIC, ENCOUNTER_MENTAL, ENCOUNTER_VERBAL, ENCOUNTER_DIVINE, DIE_ACQUIRE_SUCCESS, DIE_ACQUIRE_FAILURE, GAME_LOSS_OUT_OF_TIME }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie Sie sehen k√∂nnen, werden alle m√∂glichen Zust√§nde aus unserem Beispiel durch die Werte dieser Aufz√§hlung beschrieben. F√ºr jeden von ihnen wird eine Textzeile bereitgestellt, die auf dem Bildschirm angezeigt wird (au√üer </font></font><code>EMPTY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- dies ist eine besondere Bedeutung), aber wir werden dies etwas sp√§ter erfahren. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aktionen</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> F√ºr die Kommunikation zwischen dem Benutzer und der Spiel-Engine reichen einfache Nachrichten nicht aus. Es ist auch wichtig, den ersten √ºber die Ma√ünahmen zu informieren, die er im Moment ergreifen kann (um zu recherchieren, die Bl√∂cke zu passieren, den Umzug abzuschlie√üen - das ist alles gut). Dazu werden wir eine spezielle Klasse entwickeln.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Action</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Type, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isEnabled: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Type</span></span></span><span class="hljs-class"> </span></span>{ NONE, <span class="hljs-comment"><span class="hljs-comment">//Blank type CONFIRM, //Confirm some action CANCEL, //Cancel action HAND_POSITION, //Some position in hand HAND_ALLY_POSITION, //Some ally position in hand EXPLORE_LOCATION, //Explore current location FINISH_TURN, //Finish current turn ACQUIRE, //Acquire (DIVINE) die FORFEIT, //Remove die from game HIDE, //Put die into bag DISCARD, //Put die to discard pile } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine interne Aufz√§hlung </font></font><code>Type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beschreibt die Art der ausgef√ºhrten Aktion. Das Feld ist </font></font><code>isEnabled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erforderlich, um Aktionen in einem inaktiven Zustand anzuzeigen. Das hei√üt, um zu melden, dass diese Aktion normalerweise verf√ºgbar ist, aber aus irgendeinem Grund derzeit nicht ausgef√ºhrt werden kann (eine solche Anzeige ist viel informativer als wenn die Aktion √ºberhaupt nicht angezeigt wird). Die Eigenschaft </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(f√ºr einige Arten von Aktionen erforderlich) speichert einen speziellen Wert, der einige zus√§tzliche Details √ºbermittelt (z. B. den Index der vom Benutzer ausgew√§hlten Position oder die Nummer des ausgew√§hlten Elements aus der Liste). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klas</font></font><code>Action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist die Haupt- "Schnittstelle" zwischen der Spiel-Engine und den Eingabe-Ausgabe-Systemen (√ºber die unten). </font><font style="vertical-align: inherit;">Da es h√§ufig mehrere Aktionen gibt (andernfalls warum dann w√§hlen?), Werden sie zu Gruppen (Listen) zusammengefasst. </font><font style="vertical-align: inherit;">Anstatt Standardsammlungen zu verwenden, schreiben wir unsere eigene erweiterte.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionList</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Iterable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Action</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> actions = mutableListOf&lt;Action&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> size <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = actions.size <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Action</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ActionList { actions.add(action) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Action</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">, enabled: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ActionList { add(Action(type, enabled)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(actions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ActionList { actions.forEach { add(it) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">remove</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Action</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ActionList { actions.removeIf { it.type == type } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(index: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = actions[index] <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Action</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = actions.find { it.type == type } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">iterator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Iterator&lt;Action&gt; = ActionListIterator() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">inner</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionListIterator</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Iterator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Action</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> position = -<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasNext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = (actions.size &gt; position + <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = actions[++position] } <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> EMPTY <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = ActionList() } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Klasse enth√§lt viele verschiedene Methoden zum Hinzuf√ºgen und Entfernen von Aktionen zur Liste (die miteinander verkettet werden k√∂nnen) sowie zum Abrufen sowohl nach Index als auch nach Typ (beachten Sie die ‚Äû√úberladung‚Äú </font></font><code>get()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- der Operator in eckigen Klammern gilt f√ºr unsere Liste). </font><font style="vertical-align: inherit;">Die Implementierung der Schnittstelle </font></font><code>Iterator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erm√∂glicht es uns, </font><font style="vertical-align: inherit;">verschiedene Stream-Manipulationen (Funktionalit√§t, Aha) </font><font style="vertical-align: inherit;">mit unserer </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">allerlei verr√ºckten Schei√üklasse</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> durchzuf√ºhren </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ein leerer Wert wird ebenfalls bereitgestellt, um schnell eine leere Liste zu erstellen. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bildschirme.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zum Schluss noch eine Auflistung, die die verschiedenen Arten von Inhalten beschreibt, die derzeit angezeigt werden ... Sie sehen mich an und blinzeln mit den Augen, ich wei√ü. Als ich mir √ºberlegte, wie ich diese Klasse klarer beschreiben k√∂nnte, schlug ich meinen Kopf auf den Tisch, weil ich nichts wirklich herausfinden konnte. Verstehe dich, hoffe ich.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GameScreen</span></span></span><span class="hljs-class"> </span></span>{ HERO_TURN_START, LOCATION_INTERIOR, GAME_LOSS }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nur die im Beispiel verwendeten ausgew√§hlt. F√ºr jeden von ihnen wird eine separate Rendering-Methode bereitgestellt ... Ich erkl√§re es noch einmal unerkl√§rlich. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Anzeige" und "Eingabe".</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Und jetzt kommen wir endlich zum wichtigsten Punkt - der Interaktion der Spiel-Engine mit dem Benutzer (Spieler). Wenn Sie eine so lange Einf√ºhrung noch nicht gelangweilt hat, erinnern Sie sich wahrscheinlich daran, dass wir uns darauf geeinigt haben, diese beiden Teile funktional voneinander zu trennen. Daher werden wir anstelle einer spezifischen Implementierung des E / A-Systems nur eine Schnittstelle bereitstellen. Genauer gesagt, zwei. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erste Schnittstelle</font></font><code>GameRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, entwickelt, um Bilder auf dem Bildschirm anzuzeigen. Ich erinnere Sie daran, dass wir von Bildschirmgr√∂√üen, bestimmten Grafikbibliotheken usw. abstrahieren. Wir senden einfach den Befehl: "Zeichne mir das" - und diejenigen unter Ihnen, die unsere verschwommene Konversation √ºber Bildschirme verstanden haben, haben bereits vermutet, dass jeder dieser Bildschirme seine eigene Methode innerhalb der Benutzeroberfl√§che hat.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GameRenderer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawHeroTurnStart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(hero: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hero</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawLocationInteriorScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( location: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Location</span></span></span></span><span class="hljs-function"><span class="hljs-params">, heroesAtLocation: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">List</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hero</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;, timer: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, currentHero: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hero</span></span></span></span><span class="hljs-function"><span class="hljs-params">, battleCheck: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DieBattleCheck</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, encounteredDie: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DiePair</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, pickedDice: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, activePositions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, statusMessage: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">StatusMessage</span></span></span></span><span class="hljs-function"><span class="hljs-params">, actions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawGameLoss</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">StatusMessage</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich denke, hier sind keine zus√§tzlichen Erkl√§rungen erforderlich - der Zweck aller √ºbertragenen Objekte wurde oben ausf√ºhrlich er√∂rtert. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºr Benutzereingaben implementieren wir eine andere Oberfl√§che - </font></font><code>GameInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ja, Skripte zur Rechtschreibpr√ºfung betonen dieses Wort immer, obwohl es so scheint ...). Seine Methoden werden den Spieler nach den erforderlichen Befehlen f√ºr verschiedene Situationen fragen: W√§hlen Sie eine Aktion aus der Liste der vorgeschlagenen aus, w√§hlen Sie ein Element aus der Liste aus, w√§hlen Sie W√ºrfel aus der Hand aus, dr√ºcken Sie zumindest etwas usw. Es sollte sofort beachtet werden, dass die Eingabe synchron erfolgt (das Spiel ist Schritt f√ºr Schritt), dh die Ausf√ºhrung der Spielschleife wird unterbrochen, bis der Benutzer auf die Anfrage reagiert.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GameInteractor</span></span></span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">anyInput</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pickAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(list: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Action <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pickDiceFromHand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(activePositions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, actions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Action }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√úber die letzte Methode etwas mehr. </font><font style="vertical-align: inherit;">Wie der Name schon sagt, l√§dt from den Benutzer ein, W√ºrfel aus der Hand auszuw√§hlen und ein Objekt bereitzustellen </font></font><code>HandMask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- die Anzahl der aktiven Positionen. </font><font style="vertical-align: inherit;">Die Ausf√ºhrung der Methode wird fortgesetzt, bis einige von ihnen ausgew√§hlt sind. In diesem Fall gibt die Methode eine Aktion vom Typ </font></font><code>HAND_POSITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(oder </font></font><code>HAND_ALLY_POSITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mda) mit der Nummer der ausgew√§hlten Position im Feld zur√ºck </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dar√ºber hinaus ist es m√∂glich, eine andere Aktion (z. B. </font></font><code>CONFIRM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oder </font></font><code>CANCEL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) aus dem Objekt </font><font style="vertical-align: inherit;">auszuw√§hlen </font></font><code>ActionList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Implementierungen von Eingabemethoden sollten zwischen Situationen unterscheiden, in denen das Feld auf </font></font><code>isEnabled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gesetzt ist, </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und Benutzereingaben solcher Aktionen ignorieren. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Game Engine Klasse. </font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben alles untersucht, was f√ºr die Arbeit notwendig ist, die Zeit ist gekommen und der Motor zu implementieren. </font><font style="vertical-align: inherit;">Erstellen Sie eine Klasse</font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mit folgendem Inhalt: </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entschuldigung, dies ist nicht f√ºr eindrucksvolle Personen zu zeigen.</font></font></b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> renderer: GameRenderer, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> interactor: GameInteractor, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> scenario: Scenario, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> locations: List&lt;Location&gt;, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> heroes: List&lt;Hero&gt;) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> timer = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentHeroIndex = -<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentHero: Hero <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentLocation: Location <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> deterrentPile = Pile() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> encounteredDie: DiePair? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> battleCheck: DieBattleCheck? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> activeHandPositions = HandMask() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pickedHandPositions = HandMask() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> phase: GamePhase = GamePhase.SCENARIO_START <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> screen = GameScreen.SCENARIO_INTRO <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statusMessage = StatusMessage.EMPTY <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> actions: ActionList = ActionList.EMPTY <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (heroes.isEmpty()) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalStateException(<span class="hljs-string"><span class="hljs-string">"Heroes list is empty!"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (locations.isEmpty()) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalStateException(<span class="hljs-string"><span class="hljs-string">"Location list is empty!"</span></span>) heroes.forEach { it.isAlive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } timer = scenario.initialTimer <span class="hljs-comment"><span class="hljs-comment">//Draw initial hand for each hero heroes.forEach(::drawInitialHand) //First hero turn currentHeroIndex = -1 changePhaseHeroTurnStart() processCycle() } private fun drawInitialHand(hero: Hero) { val hand = hero.hand val favoredDie = hero.bag.drawOfType(hero.favoredDieType) hand.addDie(favoredDie!!) refillHeroHand(hero, false) } private fun refillHeroHand(hero: Hero, redrawScreen: Boolean = true) { val hand = hero.hand while (hand.dieCount &lt; hand.capacity &amp;&amp; hero.bag.size &gt; 0) { val die = hero.bag.draw() hand.addDie(die) if (redrawScreen) { Audio.playSound(Sound.DIE_DRAW) drawScreen() Thread.sleep(500) } } } private fun changePhaseHeroTurnEnd() { battleCheck = null encounteredDie = null phase = GamePhase.HERO_TURN_END //Discard extra dice (or optional dice) val hand = currentHero.hand pickedHandPositions.clear() activeHandPositions.clear() val allowCancel = if (hand.dieCount &gt; hand.capacity) { statusMessage = StatusMessage.END_OF_TURN_DISCARD_EXTRA false } else { statusMessage = StatusMessage.END_OF_TURN_DISCARD_OPTIONAL true } val result = pickDiceFromHand(DiscardExtraDiceHandMaskRule(hand), allowCancel) statusMessage = StatusMessage.EMPTY actions = ActionList.EMPTY if (result) { val discardDice = collectPickedDice(hand) val discardAllyDice = collectPickedAllyDice(hand) pickedHandPositions.clear() (discardDice + discardAllyDice).forEach { die -&gt; Audio.playSound(Sound.DIE_DISCARD) currentHero.discardDieFromHand(die) drawScreen() Thread.sleep(500) } } pickedHandPositions.clear() //Replenish hand refillHeroHand(currentHero) changePhaseHeroTurnStart() } private fun changePhaseHeroTurnStart() { phase = GamePhase.HERO_TURN_START screen = GameScreen.HERO_TURN_START //Tick timer timer-- if (timer &lt; 0) { changePhaseGameLost(StatusMessage.GAME_LOSS_OUT_OF_TIME) return } //Pick next hero do { currentHeroIndex = ++currentHeroIndex % heroes.size currentHero = heroes[currentHeroIndex] } while (!currentHero.isAlive) currentLocation = locations[0] //Setup Audio.playMusic(Music.SCENARIO_MUSIC_1) Audio.playSound(Sound.TURN_START) } private fun changePhaseLocationBeforeExploration() { phase = GamePhase.LOCATION_BEFORE_EXPLORATION screen = GameScreen.LOCATION_INTERIOR encounteredDie = null battleCheck = null pickedHandPositions.clear() activeHandPositions.clear() statusMessage = StatusMessage.CHOOSE_ACTION_BEFORE_EXPLORATION actions = ActionList() actions.add(Action.Type.EXPLORE_LOCATION, checkLocationCanBeExplored(currentLocation)) actions.add(Action.Type.FINISH_TURN) } private fun changePhaseLocationEncounterStatDie() { Audio.playSound(Sound.ENCOUNTER_STAT) phase = GamePhase.LOCATION_ENCOUNTER_STAT screen = GameScreen.LOCATION_INTERIOR battleCheck = null pickedHandPositions.clear() activeHandPositions.clear() statusMessage = when (encounteredDie!!.die.type) { Die.Type.PHYSICAL -&gt; StatusMessage.ENCOUNTER_PHYSICAL Die.Type.SOMATIC -&gt; StatusMessage.ENCOUNTER_SOMATIC Die.Type.MENTAL -&gt; StatusMessage.ENCOUNTER_MENTAL Die.Type.VERBAL -&gt; StatusMessage.ENCOUNTER_VERBAL else -&gt; throw AssertionError("Should not happen") } val canAttemptCheck = checkHeroCanAttemptStatCheck(currentHero, encounteredDie!!.die.type) actions = ActionList() actions.add(Action.Type.HIDE, canAttemptCheck) actions.add(Action.Type.DISCARD, canAttemptCheck) actions.add(Action.Type.FORFEIT) } private fun changePhaseLocationEncounterDivineDie() { Audio.playSound(Sound.ENCOUNTER_DIVINE) phase = GamePhase.LOCATION_ENCOUNTER_DIVINE screen = GameScreen.LOCATION_INTERIOR battleCheck = null pickedHandPositions.clear() activeHandPositions.clear() statusMessage = StatusMessage.ENCOUNTER_DIVINE actions = ActionList() actions.add(Action.Type.ACQUIRE, checkHeroCanAcquireDie(currentHero, Die.Type.DIVINE)) actions.add(Action.Type.FORFEIT) } private fun changePhaseLocationAfterExploration() { phase = GamePhase.LOCATION_AFTER_EXPLORATION screen = GameScreen.LOCATION_INTERIOR encounteredDie = null battleCheck = null pickedHandPositions.clear() activeHandPositions.clear() statusMessage = StatusMessage.CHOOSE_ACTION_AFTER_EXPLORATION actions = ActionList() actions.add(Action.Type.FINISH_TURN) } private fun changePhaseGameLost(message: StatusMessage) { Audio.stopMusic() Audio.playSound(Sound.GAME_LOSS) phase = GamePhase.GAME_LOSS screen = GameScreen.GAME_LOSS statusMessage = message } private fun pickDiceFromHand(rule: HandMaskRule, allowCancel: Boolean = true, onEachLoop: (() -&gt; Unit)? = null): Boolean { //Preparations pickedHandPositions.clear() actions = ActionList().add(Action.Type.CONFIRM, false) if (allowCancel) { actions.add(Action.Type.CANCEL) } val hand = rule.hand while (true) { //Recurring action onEachLoop?.invoke() //Define success condition val canProceed = rule.checkMask(pickedHandPositions) actions[Action.Type.CONFIRM]?.isEnabled = canProceed //Prepare active hand commands activeHandPositions.clear() (0 until hand.dieCount) .filter { rule.isPositionActive(pickedHandPositions, it) } .forEach { activeHandPositions.addPosition(it) } (0 until hand.allyDieCount) .filter { rule.isAllyPositionActive(pickedHandPositions, it) } .forEach { activeHandPositions.addAllyPosition(it) } //Draw current phase drawScreen() //Process interaction result val result = interactor.pickDiceFromHand(activeHandPositions, actions) when (result.type) { Action.Type.CONFIRM -&gt; if (canProceed) { activeHandPositions.clear() return true } Action.Type.CANCEL -&gt; if (allowCancel) { activeHandPositions.clear() pickedHandPositions.clear() return false } Action.Type.HAND_POSITION -&gt; { Audio.playSound(Sound.DIE_PICK) pickedHandPositions.switchPosition(result.data) } Action.Type.HAND_ALLY_POSITION -&gt; { Audio.playSound(Sound.DIE_PICK) pickedHandPositions.switchAllyPosition(result.data) } else -&gt; throw AssertionError("Should not happen") } } } private fun collectPickedDice(hand: Hand) = (0 until hand.dieCount) .filter(pickedHandPositions::checkPosition) .mapNotNull(hand::dieAt) private fun collectPickedAllyDice(hand: Hand) = (0 until hand.allyDieCount) .filter(pickedHandPositions::checkAllyPosition) .mapNotNull(hand::allyDieAt) private fun performStatDieAcquireCheck(shouldDiscard: Boolean): Boolean { //Prepare check battleCheck = DieBattleCheck(DieBattleCheck.Method.SUM, encounteredDie) pickedHandPositions.clear() statusMessage = StatusMessage.CHOOSE_DICE_PERFORM_CHECK val hand = currentHero.hand //Try to pick dice from performer's hand if (!pickDiceFromHand(StatDieAcquireHandMaskRule(currentHero.hand, encounteredDie!!.die.type), true) { battleCheck!!.clearHeroPairs() (collectPickedDice(hand) + collectPickedAllyDice(hand)) .map { DiePair(it, if (shouldDiscard) 1 else 0) } .forEach(battleCheck!!::addHeroPair) }) { battleCheck = null pickedHandPositions.clear() return false } //Remove dice from hand collectPickedDice(hand).forEach { hand.removeDie(it) } collectPickedAllyDice(hand).forEach { hand.removeDie(it) } pickedHandPositions.clear() //Perform check Audio.playSound(Sound.BATTLE_CHECK_ROLL) for (i in 0..7) { battleCheck!!.roll() drawScreen() Thread.sleep(100) } battleCheck!!.calculateResult() val result = battleCheck?.result ?: -1 val success = result &gt;= 0 //Process dice which participated in the check (0 until battleCheck!!.heroPairCount) .map(battleCheck!!::getHeroPairAt) .map(DiePair::die) .forEach { d -&gt; if (d.type === Die.Type.DIVINE) { currentHero.hand.removeDie(d) deterrentPile.put(d) } else { if (shouldDiscard) { currentHero.discardDieFromHand(d) } else { currentHero.hideDieFromHand(d) } } } //Show message to user Audio.playSound(if (success) Sound.BATTLE_CHECK_SUCCESS else Sound.BATTLE_CHECK_FAILURE) statusMessage = if (success) StatusMessage.DIE_ACQUIRE_SUCCESS else StatusMessage.DIE_ACQUIRE_FAILURE actions = ActionList.EMPTY drawScreen() interactor.anyInput() //Clean up battleCheck = null //Resolve consequences of the check if (success) { Audio.playSound(Sound.DIE_DRAW) currentHero.hand.addDie(encounteredDie!!.die) } return true } private fun processCycle() { while (true) { drawScreen() when (phase) { GamePhase.HERO_TURN_START -&gt; { interactor.anyInput() changePhaseLocationBeforeExploration() } GamePhase.GAME_LOSS -&gt; { interactor.anyInput() return } GamePhase.LOCATION_BEFORE_EXPLORATION -&gt; when (interactor.pickAction(actions).type) { Action.Type.EXPLORE_LOCATION -&gt; { val die = currentLocation.bag.draw() encounteredDie = DiePair(die, 0) when (die.type) { Die.Type.PHYSICAL, Die.Type.SOMATIC, Die.Type.MENTAL, Die.Type.VERBAL -&gt; changePhaseLocationEncounterStatDie() Die.Type.DIVINE -&gt; changePhaseLocationEncounterDivineDie() else -&gt; TODO("Others") } } Action.Type.FINISH_TURN -&gt; changePhaseHeroTurnEnd() else -&gt; throw AssertionError("Should not happen") } GamePhase.LOCATION_ENCOUNTER_STAT -&gt; { val type = interactor.pickAction(actions).type when (type) { Action.Type.DISCARD, Action.Type.HIDE -&gt; { performStatDieAcquireCheck(type === Action.Type.DISCARD) changePhaseLocationAfterExploration() } Action.Type.FORFEIT -&gt; { Audio.playSound(Sound.DIE_REMOVE) changePhaseLocationAfterExploration() } else -&gt; throw AssertionError("Should not happen") } } GamePhase.LOCATION_ENCOUNTER_DIVINE -&gt; when (interactor.pickAction(actions).type) { Action.Type.ACQUIRE -&gt; { Audio.playSound(Sound.DIE_DRAW) currentHero.hand.addDie(encounteredDie!!.die) changePhaseLocationAfterExploration() } Action.Type.FORFEIT -&gt; { Audio.playSound(Sound.DIE_REMOVE) changePhaseLocationAfterExploration() } else -&gt; throw AssertionError("Should not happen") } GamePhase.LOCATION_AFTER_EXPLORATION -&gt; when (interactor.pickAction(actions).type) { Action.Type.FINISH_TURN -&gt; changePhaseHeroTurnEnd() else -&gt; throw AssertionError("Should not happen") } else -&gt; throw AssertionError("Should not happen") } } } private fun drawScreen() { when (screen) { GameScreen.HERO_TURN_START -&gt; renderer.drawHeroTurnStart(currentHero) GameScreen.LOCATION_INTERIOR -&gt; renderer.drawLocationInteriorScreen(currentLocation, heroes, timer, currentHero, battleCheck, encounteredDie, null, pickedHandPositions, activeHandPositions, statusMessage, actions) GameScreen.GAME_LOSS -&gt; renderer.drawGameLoss(statusMessage) } } private fun checkLocationCanBeExplored(location: Location) = location.isOpen &amp;&amp; location.bag.size &gt; 0 private fun checkHeroCanAttemptStatCheck(hero: Hero, type: Die.Type): Boolean { return hero.isAlive &amp;&amp; SingleDieHandFilter(type).test(hero.hand) } private fun checkHeroCanAcquireDie(hero: Hero, type: Die.Type): Boolean { if (!hero.isAlive) { return false } return when (type) { Die.Type.ALLY -&gt; hero.hand.allyDieCount &lt; MAX_HAND_ALLY_SIZE else -&gt; hero.hand.dieCount &lt; MAX_HAND_SIZE } } }</span></span></code> </pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Methode </font></font><code>start()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- der Einstiegspunkt in das Spiel. </font><font style="vertical-align: inherit;">Hier werden Variablen initialisiert, Helden gewogen, H√§nde mit W√ºrfeln gef√ºllt und Reporter mit Kameras von allen Seiten. </font><font style="vertical-align: inherit;">Der Hauptzyklus wird jede Minute gestartet, danach kann er nicht mehr gestoppt werden. </font><font style="vertical-align: inherit;">Die Methode </font></font><code>drawInitialHand()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">spricht f√ºr sich selbst (wir schienen den Code der </font></font><code>drawOfType()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klassenmethode </font><font style="vertical-align: inherit;">nicht zu ber√ºcksichtigen </font></font><code>Bag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, aber nachdem Sie so weit zusammen gegangen sind, k√∂nnen Sie diesen Code selbst schreiben). </font><font style="vertical-align: inherit;">Die Methode </font></font><code>refillHeroHand()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hat zwei Optionen (abh√§ngig vom Wert des Arguments </font></font><code>redrawScreen</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">): schnell und leise (wenn Sie zu Beginn des Spiels die H√§nde aller Helden f√ºllen m√ºssen) und laut mit einem Haufen Pathos, wenn Sie am Ende des Zuges die W√ºrfel gezielt aus der Tasche entfernen m√ºssen, um die Hand auf die richtige Gr√∂√üe zu bringen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine Reihe von Methoden mit Namen, die mit beginnen</font></font><code>changePhase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, - wie bereits gesagt, dienen sie dazu, die aktuelle Spielphase zu √§ndern und sind mit der Zuordnung der entsprechenden Werte der Spielvariablen besch√§ftigt. Hier wird eine Liste erstellt, </font></font><code>actions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in der die f√ºr diese Phase charakteristischen Aktionen hinzugef√ºgt werden. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Gebrauchsmethode </font></font><code>pickDiceFromHand()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in verallgemeinerter Form befasst sich mit der Auswahl von W√ºrfeln aus der Hand. Hier wird ein Objekt einer vertrauten Klasse √ºbergeben </font></font><code>HandMaskRule</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, das die Auswahlregeln definiert. Es zeigt auch die M√∂glichkeit an, die Auswahl ( </font></font><code>allowCancel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">abzulehnen </font><font style="vertical-align: inherit;">, sowie eine Funktion, </font></font><code>onEachLoop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deren Code jedes Mal aufgerufen werden muss, wenn die Liste der ausgew√§hlten Cubes ge√§ndert wird (normalerweise ein erneutes Zeichnen des Bildschirms). Die mit dieser Methode ausgew√§hlten W√ºrfel k√∂nnen mit den Methoden </font></font><code>collectPickedDice()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font><font style="vertical-align: inherit;">aus der Hand zusammengesetzt werden </font></font><code>collectPickedAllyDice()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine andere Dienstprogrammmethode</font></font><code>performStatDieAcquireCheck()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implementiert den Helden, der den Test f√ºr den Erwerb eines neuen W√ºrfels besteht, vollst√§ndig. Die zentrale Rolle bei dieser Methode spielt das Objekt </font></font><code>DieBattleCheck</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Der Prozess beginnt mit der Auswahl der W√ºrfel nach der Methode </font></font><code>pickDiceFromHand()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(bei jedem Schritt wird die Liste der ‚ÄûTeilnehmer‚Äú aktualisiert </font></font><code>DieBattleCheck</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). Die ausgew√§hlten W√ºrfel werden aus der Hand entfernt, woraufhin ein ‚ÄûWurf‚Äú auftritt - jeder W√ºrfel aktualisiert seinen Wert (achtmal hintereinander), wonach das Ergebnis berechnet und angezeigt wird. Bei einem erfolgreichen Wurf f√§llt dem Helden ein neuer W√ºrfel in die Hand. Die am Test teilnehmenden W√ºrfel werden entweder gehalten (wenn sie blau sind) oder weggeworfen (wenn </font></font><code>shouldDiscard = true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) oder sind im Beutel versteckt (wenn </font></font><code>shouldDiscard = false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hauptmethode</font></font><code>processCycle()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enth√§lt eine Endlosschleife (ich frage ohne Ohnmacht), in der der Bildschirm zuerst gezeichnet wird, dann der Benutzer zur Eingabe aufgefordert wird, dann wird diese Eingabe verarbeitet - mit allen sich daraus ergebenden Konsequenzen. </font><font style="vertical-align: inherit;">Die Methode </font></font><code>drawScreen()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ruft die gew√ºnschte Schnittstellenmethode auf </font></font><code>GameRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(abh√§ngig vom aktuellen Wert </font></font><code>screen</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) und √ºbergibt ihr die erforderlichen Objekte an die Eingabe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au√üerdem enth√§lt die Klasse mehrere Hilfsmethoden: </font></font><code>checkLocationCanBeExplored()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>checkHeroCanAttemptStatCheck()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>checkHeroCanAcquireDie()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ihre Namen sprechen f√ºr sich selbst, deshalb werden wir nicht im Detail auf sie eingehen. </font><font style="vertical-align: inherit;">Au√üerdem gibt es Klassenmethodenaufrufe </font></font><code>Audio</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die durch eine rote Wellenlinie unterstrichen werden. </font><font style="vertical-align: inherit;">Kommentieren Sie sie vorerst - wir werden sp√§ter √ºber ihren Zweck nachdenken.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wer √ºberhaupt nichts versteht, hier ein Diagramm (aus Gr√ºnden der Klarheit sozusagen):</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/j3/hl/so/j3hlsov7ev0lducteyrvthdwkge.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das ist alles, das Spiel ist fertig (hehe). </font><font style="vertical-align: inherit;">Es gab wirklich kleine Dinge dar√ºber unten.</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schritt neun. </font><font style="vertical-align: inherit;">Bild anzeigen</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir kommen also zum Hauptthema des heutigen Gespr√§chs - der grafischen Komponente der Anwendung. </font><font style="vertical-align: inherit;">Wie Sie sich erinnern, besteht unsere Aufgabe darin, die Schnittstelle </font></font><code>GameRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und ihre drei Methoden </font><font style="vertical-align: inherit;">zu implementieren. </font><font style="vertical-align: inherit;">Da es in unserem Team noch keinen talentierten K√ºnstler gibt, werden wir dies selbst mithilfe von Pseudografien tun. </font><font style="vertical-align: inherit;">Aber zun√§chst w√§re es sch√∂n zu verstehen, was wir allgemein am Ausgang erwarten. </font><font style="vertical-align: inherit;">Und wir m√∂chten drei Bildschirme mit ungef√§hr den folgenden Inhalten sehen:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bildschirm 1. Spieler-Turn-ID</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/ey/kv/ro/eykvrovfqckvawmiylrmb03gx70.png"></a> <br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bildschirm 2. Informationen √ºber das Gebiet und den aktuellen Helden</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/5v/xd/ad/5vxdadvii-aunblqcdkxs4h8jrs.png"></a> <br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bildschirm 3. Skriptverlustmeldung</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/ry/l1/6y/ryl16yvaas4njnnu5mxginmvsm0.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich denke, die Mehrheit hat bereits erkannt, dass sich die pr√§sentierten Bilder von allem unterscheiden, was wir normalerweise in der Konsole von Java-Anwendungen sehen, und dass die √ºblichen Funktionen </font></font><code>prinltn()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f√ºr uns offensichtlich nicht ausreichen werden. Ich m√∂chte auch in der Lage sein, zu beliebigen Stellen auf dem Bildschirm zu springen und Symbole in verschiedenen Farben zu zeichnen. </font><s><font style="vertical-align: inherit;">Chip- und Dale- </font></s><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">ANSI-Codes</font></a></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> helfen uns zu Hilfe</font></font><s><font style="vertical-align: inherit;"></font></s> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Durch das Senden bizarrer Zeichenfolgen zur Ausgabe k√∂nnen Sie nicht weniger bizarre Effekte erzielen: √Ñndern Sie die Farbe des Texts / Hintergrunds, die Art und Weise, wie die Zeichen gezeichnet werden, die Position des Cursors auf dem Bildschirm und vieles mehr. Nat√ºrlich werden wir sie nicht in ihrer reinen Form vorstellen - wir werden die Implementierung hinter den Methoden der Klasse verbergen. Und wir werden die Klasse selbst nicht von Grund auf neu schreiben - zum Gl√ºck haben es kluge Leute f√ºr uns getan. Wir m√ºssen nur eine leichte Bibliothek herunterladen und mit dem Projekt verbinden, zum Beispiel </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jansi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.fusesource.jansi<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jansi<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.17.1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und Sie k√∂nnen anfangen zu erstellen. </font><font style="vertical-align: inherit;">Diese Bibliothek bietet uns ein Klassenobjekt </font></font><code>Ansi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(das als Ergebnis eines statischen Aufrufs erhalten wurde </font></font><code>Ansi.ansi()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) mit einer Reihe praktischer Methoden, die verkettet werden k√∂nnen. </font><font style="vertical-align: inherit;">Es funktioniert nach dem Prinzip </font></font><code>StringBuilder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'a - zuerst bilden wir das Objekt und senden es dann zum Drucken. </font><font style="vertical-align: inherit;">Von den n√ºtzlichen Methoden werden wir n√ºtzlich finden:</font></font><br><br><ul><li> <code>a()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - um Zeichen anzuzeigen; </font></font></li><li> <code>cursor()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - um den Cursor auf dem Bildschirm zu bewegen; </font></font></li><li> <code>eraseLine()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - als ob f√ºr sich selbst spricht; </font></font></li><li> <code>eraseScreen()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - √§hnlich; </font></font></li><li> <code>fg(), bg(), fgBright(), bgBright()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - sehr unpraktische Methoden f√ºr die Arbeit mit Text- und Hintergrundfarben - wir werden unsere eigenen, angenehmer machen; </font></font></li><li> <code>reset()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - um die eingestellten Farbeinstellungen, das Flimmern usw. zur√ºckzusetzen. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lassen Sie uns eine Klasse </font></font><code>ConsoleRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mit Dienstprogrammmethoden erstellen, die f√ºr uns in unserer Arbeit n√ºtzlich sein k√∂nnen. </font><font style="vertical-align: inherit;">Die erste Version sieht ungef√§hr so ‚Äã‚Äãaus:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConsoleRenderer</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ansi: Ansi <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> { AnsiConsole.systemInstall() clearScreen() resetAnsi() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resetAnsi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { ansi = Ansi.ansi() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { print(Ansi.ansi().eraseScreen(Ansi.Erase.ALL).cursor(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)) } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">render</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { print(ansi.toString()) resetAnsi() } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Methode </font></font><code>resetAnsi()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erstellt ein neues (leeres) Objekt </font></font><code>Ansi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, das mit den erforderlichen Befehlen (Verschieben, Ausgeben usw.) gef√ºllt wird. </font><font style="vertical-align: inherit;">Nach Abschluss des F√ºllvorgangs wird das generierte Objekt von der Methode zum Drucken gesendet </font></font><code>render()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und die Variable mit einem neuen Objekt initialisiert. </font><font style="vertical-align: inherit;">Noch nichts kompliziertes, oder? </font><font style="vertical-align: inherit;">Und wenn ja, dann werden wir beginnen, diese Klasse mit anderen n√ºtzlichen Methoden zu f√ºllen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beginnen wir mit den Gr√∂√üen. </font><font style="vertical-align: inherit;">Die Standardkonsole der meisten Terminals ist 80 x 24 gro√ü. </font><font style="vertical-align: inherit;">Wir notieren diese Tatsache mit zwei Konstanten </font></font><code>CONSOLE_WIDTH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>CONSOLE_HEIGHT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Wir werden nicht an bestimmte Werte gebunden sein und versuchen, das Design so gummiartig wie m√∂glich zu gestalten (wie im Internet). </font><font style="vertical-align: inherit;">Die Nummerierung der Koordinaten beginnt mit eins, die erste Koordinate ist eine Zeile, die zweite ist eine Spalte. </font><font style="vertical-align: inherit;">In diesem Wissen schreiben wir eine Utility-Methode</font></font><code>drawHorizontalLine()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> um die angegebene Zeichenfolge mit dem angegebenen Zeichen zu f√ºllen. </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawHorizontalLine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offsetY: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, filler: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Char</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { ansi.cursor(offsetY, <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span>..CONSOLE_WIDTH).forEach { ansi.a(filler) } <span class="hljs-comment"><span class="hljs-comment">//for (i in 1..CONSOLE_WIDTH) { ansi.a(filler) } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich m√∂chte Sie noch einmal daran erinnern, dass das Aufrufen von Befehlen </font></font><code>a()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oder </font></font><code>cursor()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keine sofortige Auswirkung hat, sondern nur die </font></font><code>Ansi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entsprechende Befehlsfolge </font><font style="vertical-align: inherit;">zum Objekt hinzuf√ºgt </font><font style="vertical-align: inherit;">. Nur wenn diese Sequenzen zum Drucken gesendet werden, werden sie auf dem Bildschirm angezeigt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es </font><font style="vertical-align: inherit;">gibt keinen grunds√§tzlichen Unterschied </font><font style="vertical-align: inherit;">zwischen der Verwendung des klassischen Zyklus </font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und des funktionalen Ansatzes mit </font></font><code>ClosedRange</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>forEach{}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- jeder Entwickler entscheidet f√ºr sich, was f√ºr ihn bequemer ist. Ich werde Ihre K√∂pfe jedoch weiterhin mit Funktionalismus t√§uschen, einfach weil </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ich ein Affe bin, der alles liebt, was neu ist und gl√§nzende</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klammern nicht in eine neue Zeile eingeschlossen sind und der Code kompakter aussieht. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir implementieren eine andere Dienstprogrammmethode </font></font><code>drawBlankLine()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die dasselbe tut wie</font></font><code>drawHorizontalLine(offsetY, ' ')</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nur mit Verl√§ngerung. </font><font style="vertical-align: inherit;">Manchmal m√ºssen wir die Linie nicht vollst√§ndig leer machen, sondern am Anfang und am Ende eine vertikale Linie lassen (Frame, ja). </font><font style="vertical-align: inherit;">Der Code sieht ungef√§hr so ‚Äã‚Äãaus:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawBlankLine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offsetY: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, drawBorders: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { ansi.cursor(offsetY, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (drawBorders) { ansi.a(<span class="hljs-string"><span class="hljs-string">'‚îÇ'</span></span>) (<span class="hljs-number"><span class="hljs-number">2</span></span> until CONSOLE_WIDTH).forEach { ansi.a(<span class="hljs-string"><span class="hljs-string">' '</span></span>) } ansi.a(<span class="hljs-string"><span class="hljs-string">'‚îÇ'</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ansi.eraseLine(Ansi.Erase.ALL) } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie, Sie haben nie Frames aus Pseudografien gezeichnet? </font><font style="vertical-align: inherit;">Symbole k√∂nnen direkt in den Quellcode eingef√ºgt werden. </font><font style="vertical-align: inherit;">Halten Sie die Alt-Taste gedr√ºckt und geben Sie den Zeichencode auf dem Ziffernblock ein. </font><font style="vertical-align: inherit;">Dann lass los. </font><font style="vertical-align: inherit;">Die ASCII-Codes, die wir f√ºr jede Codierung ben√∂tigen, sind die gleichen. Hier ist der minimale Gentleman-Satz:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6u/0y/js/6u0yjs19ntz1fue2wgkichhvnfo.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und dann, wie in Minecraft, sind die M√∂glichkeiten nur durch die Grenzen Ihrer Vorstellungskraft begrenzt. </font><font style="vertical-align: inherit;">Und die Bildschirmgr√∂√üe.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawCenteredCaption</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offsetY: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, text: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, color: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Color</span></span></span></span><span class="hljs-function"><span class="hljs-params">, drawBorders: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> center = (CONSOLE_WIDTH - text.length) / <span class="hljs-number"><span class="hljs-number">2</span></span> ansi.cursor(offsetY, <span class="hljs-number"><span class="hljs-number">1</span></span>) ansi.a(<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (drawBorders) <span class="hljs-string"><span class="hljs-string">'‚îÇ'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>) (<span class="hljs-number"><span class="hljs-number">2</span></span> until center).forEach { ansi.a(<span class="hljs-string"><span class="hljs-string">' '</span></span>) } ansi.color(color).a(text).reset() (text.length + center until CONSOLE_WIDTH).forEach { ansi.a(<span class="hljs-string"><span class="hljs-string">' '</span></span>) } ansi.a(<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (drawBorders) <span class="hljs-string"><span class="hljs-string">'‚îÇ'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>) }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reden wir ein wenig √ºber die Blumen. Die Klasse </font></font><code>Ansi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enth√§lt Konstanten </font></font><code>Color</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f√ºr acht Prim√§rfarben (Schwarz, Blau, Gr√ºn, Cyan, Rot, Violett, Gelb, Grau), die Sie an die Eingabe von Methoden </font></font><code>fg()/bg()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f√ºr die dunkle Version oder </font></font><code>fgBright()/bgBright()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f√ºr die helle √ºbergeben m√ºssen, was f√ºr die Identifizierung der Farbe furchtbar unpraktisch ist √úbrigens reicht uns ein Wert nicht - wir brauchen mindestens zwei (Farbe und Helligkeit). Daher werden wir unsere Liste der Konstanten und unsere Erweiterungsmethoden erstellen (sowie Kartenbindungsfarben f√ºr W√ºrfeltypen und Heldenklassen):</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Color</span></span></span><span class="hljs-class"> </span></span>{ BLACK, DARK_BLUE, DARK_GREEN, DARK_CYAN, DARK_RED, DARK_MAGENTA, DARK_YELLOW, LIGHT_GRAY, DARK_GRAY, LIGHT_BLUE, LIGHT_GREEN, LIGHT_CYAN, LIGHT_RED, LIGHT_MAGENTA, LIGHT_YELLOW, WHITE } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> Ansi.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(color: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Color</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span>: Ansi = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (color) { Color.BLACK -&gt; fgBlack() Color.DARK_BLUE -&gt; fgBlue() Color.DARK_GREEN -&gt; fgGreen() Color.DARK_CYAN -&gt; fgCyan() Color.DARK_RED -&gt; fgRed() Color.DARK_MAGENTA -&gt; fgMagenta() Color.DARK_YELLOW -&gt; fgYellow() Color.LIGHT_GRAY -&gt; fg(Ansi.Color.WHITE) Color.DARK_GRAY -&gt; fgBrightBlack() Color.LIGHT_BLUE -&gt; fgBrightBlue() Color.LIGHT_GREEN -&gt; fgBrightGreen() Color.LIGHT_CYAN -&gt; fgBrightCyan() Color.LIGHT_RED -&gt; fgBrightRed() Color.LIGHT_MAGENTA -&gt; fgBrightMagenta() Color.LIGHT_YELLOW -&gt; fgBrightYellow() Color.WHITE -&gt; fgBright(Ansi.Color.WHITE) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> Ansi.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">background</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(color: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Color</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span>: Ansi = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (color) { Color.BLACK -&gt; ansi.bg(Ansi.Color.BLACK) Color.DARK_BLUE -&gt; ansi.bg(Ansi.Color.BLUE) Color.DARK_GREEN -&gt; ansi.bgGreen() Color.DARK_CYAN -&gt; ansi.bg(Ansi.Color.CYAN) Color.DARK_RED -&gt; ansi.bgRed() Color.DARK_MAGENTA -&gt; ansi.bgMagenta() Color.DARK_YELLOW -&gt; ansi.bgYellow() Color.LIGHT_GRAY -&gt; ansi.bg(Ansi.Color.WHITE) Color.DARK_GRAY -&gt; ansi.bgBright(Ansi.Color.BLACK) Color.LIGHT_BLUE -&gt; ansi.bgBright(Ansi.Color.BLUE) Color.LIGHT_GREEN -&gt; ansi.bgBrightGreen() Color.LIGHT_CYAN -&gt; ansi.bgBright(Ansi.Color.CYAN) Color.LIGHT_RED -&gt; ansi.bgBrightRed() Color.LIGHT_MAGENTA -&gt; ansi.bgBright(Ansi.Color.MAGENTA) Color.LIGHT_YELLOW -&gt; ansi.bgBrightYellow() Color.WHITE -&gt; ansi.bgBright(Ansi.Color.WHITE) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dieColors = mapOf( Die.Type.PHYSICAL to Color.LIGHT_BLUE, Die.Type.SOMATIC to Color.LIGHT_GREEN, Die.Type.MENTAL to Color.LIGHT_MAGENTA, Die.Type.VERBAL to Color.LIGHT_YELLOW, Die.Type.DIVINE to Color.LIGHT_CYAN, Die.Type.WOUND to Color.DARK_GRAY, Die.Type.ENEMY to Color.DARK_RED, Die.Type.VILLAIN to Color.LIGHT_RED, Die.Type.OBSTACLE to Color.DARK_YELLOW, Die.Type.ALLY to Color.WHITE ) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> heroColors = mapOf( Hero.Type.BRAWLER to Color.LIGHT_BLUE, Hero.Type.HUNTER to Color.LIGHT_GREEN )</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jetzt wird jede der 16 verf√ºgbaren Farben durch eine einzelne Konstante eindeutig identifiziert. Wir werden ein paar weitere Dienstprogrammmethoden schreiben, aber vorher werden wir noch eines herausfinden: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wo werden die Konstanten f√ºr Textzeichenfolgen gespeichert? </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄûString-Konstanten m√ºssen in separaten Dateien entfernt werden, damit sie alle an einem Ort gespeichert werden. Dies erleichtert die Wartung. Und es ist auch wichtig f√ºr die Lokalisierung ... "</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> String-Konstanten m√ºssen in separate Dateien verschoben werden ... na ja. Wir werden es aushalten. Der Standard-Java-Mechanismus f√ºr die Arbeit mit dieser Art von Ressourcen sind die Objekte </font></font><code>java.util.ResourceBundle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die mit Dateien arbeiten </font></font><code>.properties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Hier beginnen wir mit einer solchen Datei:</font></font><br><br><pre> <code class="plaintext hljs"># Game status messages choose_dice_perform_check=Choose dice to perform check: end_of_turn_discard_extra=END OF TURN: Discard extra dice: end_of_turn_discard_optional=END OF TURN: Discard any dice, if needed: choose_action_before_exploration=Choose your action: choose_action_after_exploration=Already explored this turn. Choose what to do now: encounter_physical=Encountered PHYSICAL die. Need to pass respective check or lose this die. encounter_somatic=Encountered SOMATIC die. Need to pass respective check or lose this die. encounter_mental=Encountered MENTAL die. Need to pass respective check or lose this die. encounter_verbal=Encountered VERBAL die. Need to pass respective check or lose this die. encounter_divine=Encountered DIVINE die. Can be acquired automatically (no checks needed): die_acquire_success=You have acquired the die! die_acquire_failure=You have failed to acquire the die. game_loss_out_of_time=You ran out of time # Die types physical=PHYSICAL somatic=SOMATIC mental=MENTAL verbal=VERBAL divine=DIVINE ally=ALLY wound=WOUND enemy=ENEMY villain=VILLAIN obstacle=OBSTACLE # Hero types and descriptions brawler=Brawler hunter=Hunter # Various labels avg=avg bag=Bag bag_size=Bag size class=Class closed=Closed discard=Discard empty=Empty encountered=Encountered fail=Fail hand=Hand heros_turn=%s's turn max=max min=min perform_check=Perform check: pile=Pile received_new_die=Received new die result=Result success=Success sum=sum time=Time total=Total # Action names and descriptions action_confirm_key=ENTER action_confirm_name=Confirm action_cancel_key=ESC action_cancel_name=Cancel action_explore_location_key=E action_explore_location_name=xplore action_finish_turn_key=F action_finish_turn_name=inish action_hide_key=H action_hide_name=ide action_discard_key=D action_discard_name=iscard action_acquire_key=A action_acquire_name=cquire action_leave_key=L action_leave_name=eave action_forfeit_key=F action_forfeit_name=orfeit</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jede Zeile enth√§lt ein Schl√ºssel-Wert-Paar, das durch ein Zeichen getrennt ist </font></font><code>=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Sie k√∂nnen die Datei an einer beliebigen Stelle ablegen. Hauptsache, der Pfad dazu ist Teil des Klassenpfads. </font><font style="vertical-align: inherit;">Bitte beachten Sie, dass der Text f√ºr Aktionen aus zwei Teilen besteht: Der erste Buchstabe wird nicht nur gelb hervorgehoben, wenn er auf dem Bildschirm angezeigt wird, sondern bestimmt auch die Taste, die gedr√ºckt werden muss, um diese Aktion auszuf√ºhren. </font><font style="vertical-align: inherit;">Daher ist es zweckm√§√üig, sie separat aufzubewahren. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir abstrahieren jedoch von einem bestimmten Format (in Android werden beispielsweise Zeichenfolgen unterschiedlich gespeichert) und beschreiben die Schnittstelle zum Laden von Zeichenfolgenkonstanten.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringLoader</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: String }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Schl√ºssel wird an den Eingang √ºbertragen, der Ausgang ist eine bestimmte Zeile. </font><font style="vertical-align: inherit;">Die Implementierung ist so einfach wie die Schnittstelle selbst (angenommen, die Datei liegt auf dem Pfad </font></font><code>src/main/resources/text/strings.properties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PropertiesStringLoader</span></span></span></span>() : StringLoader { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> properties = ResourceBundle.getBundle(<span class="hljs-string"><span class="hljs-string">"text.strings"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = properties.getString(key) ?: <span class="hljs-string"><span class="hljs-string">""</span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jetzt wird es nicht schwierig sein, eine Methode </font></font><code>drawStatusMessage()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zum Anzeigen des aktuellen Status der Spiel-Engine ( </font></font><code>StatusMessage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">auf dem Bildschirm </font><font style="vertical-align: inherit;">und eine Methode </font></font><code>drawActionList()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zum Anzeigen einer Liste verf√ºgbarer Aktionen ( </font></font><code>ActionList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">zu implementieren </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Sowie andere offizielle Methoden, die nur die Seele w√ºnscht.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt eine Menge Code, einen Teil davon haben wir bereits gesehen ... also hier ist ein Spoiler f√ºr Sie</font></font></b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConsoleRenderer</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> strings: StringLoader) { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ansi: Ansi <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> { AnsiConsole.systemInstall() clearScreen() resetAnsi() } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = strings.loadString(key) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resetAnsi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { ansi = Ansi.ansi() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { print(Ansi.ansi().eraseScreen(Ansi.Erase.ALL).cursor(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)) } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">render</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { ansi.cursor(CONSOLE_HEIGHT, CONSOLE_WIDTH) System.<span class="hljs-keyword"><span class="hljs-keyword">out</span></span>.print(ansi.toString()) resetAnsi() } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawBigNumber</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offsetX: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, offsetY: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, number: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> = with(ansi) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentX = offsetX cursor(offsetY, currentX) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> text = number.toString() text.forEach { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (it) { <span class="hljs-string"><span class="hljs-string">'0'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà‚ñà "</span></span>) } <span class="hljs-string"><span class="hljs-string">'1'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà‚ñà‚ñà‚ñà‚ñà "</span></span>) } <span class="hljs-string"><span class="hljs-string">'2'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà‚ñà‚ñà‚ñà‚ñà "</span></span>) } <span class="hljs-string"><span class="hljs-string">'3'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà‚ñà‚ñà‚ñà "</span></span>) } <span class="hljs-string"><span class="hljs-string">'4'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà‚ñà‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) } <span class="hljs-string"><span class="hljs-string">'5'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà‚ñà‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà‚ñà‚ñà‚ñà "</span></span>) } <span class="hljs-string"><span class="hljs-string">'6'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà‚ñà "</span></span>) } <span class="hljs-string"><span class="hljs-string">'7'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà‚ñà‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) } <span class="hljs-string"><span class="hljs-string">'8'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà‚ñà "</span></span>) } <span class="hljs-string"><span class="hljs-string">'9'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà‚ñà "</span></span>) } } currentX += <span class="hljs-number"><span class="hljs-number">6</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawHorizontalLine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offsetY: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, filler: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Char</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { ansi.cursor(offsetY, <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span>..CONSOLE_WIDTH).forEach { ansi.a(filler) } } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawBlankLine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offsetY: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, drawBorders: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { ansi.cursor(offsetY, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (drawBorders) { ansi.a(<span class="hljs-string"><span class="hljs-string">'‚îÇ'</span></span>) (<span class="hljs-number"><span class="hljs-number">2</span></span> until CONSOLE_WIDTH).forEach { ansi.a(<span class="hljs-string"><span class="hljs-string">' '</span></span>) } ansi.a(<span class="hljs-string"><span class="hljs-string">'‚îÇ'</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ansi.eraseLine(Ansi.Erase.ALL) } } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawCenteredCaption</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offsetY: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, text: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, color: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Color</span></span></span></span><span class="hljs-function"><span class="hljs-params">, drawBorders: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> center = (CONSOLE_WIDTH - text.length) / <span class="hljs-number"><span class="hljs-number">2</span></span> ansi.cursor(offsetY, <span class="hljs-number"><span class="hljs-number">1</span></span>) ansi.a(<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (drawBorders) <span class="hljs-string"><span class="hljs-string">'‚îÇ'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>) (<span class="hljs-number"><span class="hljs-number">2</span></span> until center).forEach { ansi.a(<span class="hljs-string"><span class="hljs-string">' '</span></span>) } ansi.color(color).a(text).reset() (text.length + center until CONSOLE_WIDTH).forEach { ansi.a(<span class="hljs-string"><span class="hljs-string">' '</span></span>) } ansi.a(<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (drawBorders) <span class="hljs-string"><span class="hljs-string">'‚îÇ'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawStatusMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offsetY: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, message: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">StatusMessage</span></span></span></span><span class="hljs-function"><span class="hljs-params">, drawBorders: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">//Setup val messageText = loadString(message.toString().toLowerCase()) var currentX = 1 val rightBorder = CONSOLE_WIDTH - if (drawBorders) 1 else 0 //Left border ansi.cursor(offsetY, 1) if (drawBorders) { ansi.a('‚îÇ') currentX++ } ansi.a(' ') currentX++ //Text ansi.a(messageText) currentX += messageText.length //Right border (currentX..rightBorder).forEach { ansi.a(' ') } if (drawBorders) { ansi.a('‚îÇ') } } protected fun drawActionList(offsetY: Int, actions: ActionList, drawBorders: Boolean = true) { val rightBorder = CONSOLE_WIDTH - if (drawBorders) 1 else 0 var currentX = 1 //Left border ansi.cursor(offsetY, 1) if (drawBorders) { ansi.a('‚îÇ') currentX++ } ansi.a(' ') currentX++ //List of actions actions.forEach { action -&gt; val key = loadString("action_${action.toString().toLowerCase()}_key") val name = loadString("action_${action.toString().toLowerCase()}_name") val length = key.length + 2 + name.length if (currentX + length &gt;= rightBorder) { (currentX..rightBorder).forEach { ansi.a(' ') } if (drawBorders) { ansi.a('‚îÇ') } ansi.cursor(offsetY + 1, 1) currentX = 1 if (drawBorders) { ansi.a('‚îÇ') currentX++ } ansi.a(' ') currentX++ } if (action.isEnabled) { ansi.color(Color.LIGHT_YELLOW) } ansi.a('(').a(key).a(')').reset() ansi.a(name) ansi.a(" ") currentX += length + 2 } //Right border (currentX..rightBorder).forEach { ansi.a(' ') } if (drawBorders) { ansi.a('‚îÇ') } } protected enum class Color { BLACK, DARK_BLUE, DARK_GREEN, DARK_CYAN, DARK_RED, DARK_MAGENTA, DARK_YELLOW, LIGHT_GRAY, DARK_GRAY, LIGHT_BLUE, LIGHT_GREEN, LIGHT_CYAN, LIGHT_RED, LIGHT_MAGENTA, LIGHT_YELLOW, WHITE } protected fun Ansi.color(color: Color?): Ansi = when (color) { Color.BLACK -&gt; fgBlack() Color.DARK_BLUE -&gt; fgBlue() Color.DARK_GREEN -&gt; fgGreen() Color.DARK_CYAN -&gt; fgCyan() Color.DARK_RED -&gt; fgRed() Color.DARK_MAGENTA -&gt; fgMagenta() Color.DARK_YELLOW -&gt; fgYellow() Color.LIGHT_GRAY -&gt; fg(Ansi.Color.WHITE) Color.DARK_GRAY -&gt; fgBrightBlack() Color.LIGHT_BLUE -&gt; fgBrightBlue() Color.LIGHT_GREEN -&gt; fgBrightGreen() Color.LIGHT_CYAN -&gt; fgBrightCyan() Color.LIGHT_RED -&gt; fgBrightRed() Color.LIGHT_MAGENTA -&gt; fgBrightMagenta() Color.LIGHT_YELLOW -&gt; fgBrightYellow() Color.WHITE -&gt; fgBright(Ansi.Color.WHITE) else -&gt; this } protected fun Ansi.background(color: Color?): Ansi = when (color) { Color.BLACK -&gt; ansi.bg(Ansi.Color.BLACK) Color.DARK_BLUE -&gt; ansi.bg(Ansi.Color.BLUE) Color.DARK_GREEN -&gt; ansi.bgGreen() Color.DARK_CYAN -&gt; ansi.bg(Ansi.Color.CYAN) Color.DARK_RED -&gt; ansi.bgRed() Color.DARK_MAGENTA -&gt; ansi.bgMagenta() Color.DARK_YELLOW -&gt; ansi.bgYellow() Color.LIGHT_GRAY -&gt; ansi.bg(Ansi.Color.WHITE) Color.DARK_GRAY -&gt; ansi.bgBright(Ansi.Color.BLACK) Color.LIGHT_BLUE -&gt; ansi.bgBright(Ansi.Color.BLUE) Color.LIGHT_GREEN -&gt; ansi.bgBrightGreen() Color.LIGHT_CYAN -&gt; ansi.bgBright(Ansi.Color.CYAN) Color.LIGHT_RED -&gt; ansi.bgBrightRed() Color.LIGHT_MAGENTA -&gt; ansi.bgBright(Ansi.Color.MAGENTA) Color.LIGHT_YELLOW -&gt; ansi.bgBrightYellow() Color.WHITE -&gt; ansi.bgBright(Ansi.Color.WHITE) else -&gt; this } protected val dieColors = mapOf( Die.Type.PHYSICAL to Color.LIGHT_BLUE, Die.Type.SOMATIC to Color.LIGHT_GREEN, Die.Type.MENTAL to Color.LIGHT_MAGENTA, Die.Type.VERBAL to Color.LIGHT_YELLOW, Die.Type.DIVINE to Color.LIGHT_CYAN, Die.Type.WOUND to Color.DARK_GRAY, Die.Type.ENEMY to Color.DARK_RED, Die.Type.VILLAIN to Color.LIGHT_RED, Die.Type.OBSTACLE to Color.DARK_YELLOW, Die.Type.ALLY to Color.WHITE ) protected val heroColors = mapOf( Hero.Type.BRAWLER to Color.LIGHT_BLUE, Hero.Type.HUNTER to Color.LIGHT_GREEN ) protected open fun shortcut(index: Int) = "1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ"[index] }</span></span></code> </pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warum haben wir das alle gemacht, fragst du? </font><font style="vertical-align: inherit;">Ja, um unsere Schnittstellenimplementierung von dieser wunderbaren Klasse zu erben </font></font><code>GameRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klassendiagramm</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/tn/00/fj/tn00fjvlnpga4zqm1p-ojveq7nm.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> So sieht die Implementierung der ersten, einfachsten Methode aus: </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawGameLoss</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">StatusMessage</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> centerY = CONSOLE_HEIGHT / <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span> until centerY).forEach { drawBlankLine(it, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = loadString(message.toString().toLowerCase()).toUpperCase() drawCenteredCaption(centerY, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>, LIGHT_RED, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) (centerY + <span class="hljs-number"><span class="hljs-number">1</span></span>..CONSOLE_HEIGHT).forEach { drawBlankLine(it, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) } render() }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nichts √úbernat√ºrliches, nur eine </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rot gezeichnete </font><font style="vertical-align: inherit;">Textzeile ( </font><font style="vertical-align: inherit;">) in der Mitte des Bildschirms ( </font></font><code>drawCenteredCaption()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). Der Rest des Codes f√ºllt den Rest des Bildschirms mit Leerzeilen. Vielleicht wird jemand fragen, warum dies notwendig ist - schlie√ülich gibt es eine Methode </font></font><code>clearScreen()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die ausreicht, um sie am Anfang der Methode aufzurufen, den Bildschirm zu l√∂schen und dann den gew√ºnschten Text zu zeichnen. Leider ist dies ein fauler Ansatz, den wir nicht verwenden werden. Der Grund ist sehr einfach: Bei diesem Ansatz werden einige Positionen auf dem Bildschirm zweimal gezeichnet, was zu einem merklichen Flackern f√ºhrt, insbesondere wenn der Bildschirm nacheinander mehrmals hintereinander gezeichnet wird (w√§hrend Animationen). Daher ist es unsere Aufgabe, nicht nur die richtigen Zeichen an den richtigen Stellen zu zeichnen, sondern das </font><b><font style="vertical-align: inherit;">Ganze</font></b><font style="vertical-align: inherit;"> auszuf√ºllen</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Rest des Bildschirms enth√§lt leere Zeichen (damit keine Artefakte aus anderen Renderings darauf verbleiben). Und diese Aufgabe ist nicht so einfach. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die folgende Methode folgt diesem Prinzip:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawHeroTurnStart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(hero: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hero</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> centerY = (CONSOLE_HEIGHT - <span class="hljs-number"><span class="hljs-number">5</span></span>) / <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span> until centerY).forEach { drawBlankLine(it, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) } ansi.color(heroColors[hero.type]) drawHorizontalLine(centerY, <span class="hljs-string"><span class="hljs-string">'‚îÄ'</span></span>) drawHorizontalLine(centerY + <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'‚îÄ'</span></span>) ansi.reset() ansi.cursor(centerY + <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).eraseLine() ansi.cursor(centerY + <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).eraseLine() ansi.cursor(centerY + <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> text = String.format(loadString(<span class="hljs-string"><span class="hljs-string">"heros_turn"</span></span>), hero.name.toUpperCase()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> index = text.indexOf(hero.name.toUpperCase()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> center = (CONSOLE_WIDTH - text.length) / <span class="hljs-number"><span class="hljs-number">2</span></span> ansi.cursor(centerY + <span class="hljs-number"><span class="hljs-number">2</span></span>, center) ansi.eraseLine(Ansi.Erase.BACKWARD) ansi.a(text.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, index)) ansi.color(heroColors[hero.type]).a(hero.name.toUpperCase()).reset() ansi.a(text.substring(index + hero.name.length)) ansi.eraseLine(Ansi.Erase.FORWARD) (centerY + <span class="hljs-number"><span class="hljs-number">5</span></span>..CONSOLE_HEIGHT).forEach { drawBlankLine(it, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) } render() }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier gibt es neben dem zentrierten Text auch zwei horizontale Linien (siehe Screenshots oben). </font><font style="vertical-align: inherit;">Bitte beachten Sie, dass die mittlere Beschriftung in zwei Farben angezeigt wird. </font><font style="vertical-align: inherit;">Und stellen Sie sicher, dass das Erlernen von Mathematik in der Schule immer noch n√ºtzlich ist. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nun, wir haben uns die einfachsten Methoden angesehen und es ist Zeit, die Implementierung kennenzulernen </font></font><code>drawLocationInteriorScreen()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Wie Sie selbst verstehen, wird es hier eine Gr√∂√üenordnung mehr Code geben. </font><font style="vertical-align: inherit;">Dar√ºber hinaus √§ndert sich der Inhalt des Bildschirms dynamisch als Reaktion auf Benutzeraktionen und muss st√§ndig neu gezeichnet werden (manchmal mit Animation). </font><font style="vertical-align: inherit;">Nun, um Sie endg√ºltig fertig zu machen: Stellen Sie sich vor, dass im Rahmen dieser Methode zus√§tzlich zum obigen Screenshot die Anzeige von drei weiteren implementiert werden muss:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Treffen mit dem aus dem Beutel entfernten W√ºrfel</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/8x/lx/h9/8xlxh9h-ulu0efaigsnnfuo6nsq.png"></a> <br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. W√ºrfel ausw√§hlen, um den Test zu bestehen</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/cd/iw/2e/cdiw2e0fxlfdsjeijyxwauzth-m.png"></a> <br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Testergebnisse anzeigen</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/t3/-w/7r/t3-w7rfvplkfeywr9_5accvkada.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daher ist hier mein gro√üer Rat an Sie: Schieben Sie nicht den gesamten Code in eine Methode. </font><font style="vertical-align: inherit;">Teilen Sie die Implementierung in mehrere Methoden auf (auch wenn jede nur einmal aufgerufen wird). </font><font style="vertical-align: inherit;">Vergessen Sie nicht den "Gummi".</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn es in Ihren Augen zu kr√§useln beginnt, blinken Sie ein paar Sekunden lang - dies sollte helfen</font></font></b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConsoleGameRenderer</span></span></span></span>(loader: StringLoader) : ConsoleRenderer(loader), GameRenderer { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawLocationTopPanel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(location: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Location</span></span></span></span><span class="hljs-function"><span class="hljs-params">, heroesAtLocation: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">List</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hero</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;, currentHero: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hero</span></span></span></span><span class="hljs-function"><span class="hljs-params">, timer: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> closedString = loadString(<span class="hljs-string"><span class="hljs-string">"closed"</span></span>).toLowerCase() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> timeString = loadString(<span class="hljs-string"><span class="hljs-string">"time"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> locationName = location.name.toString().toUpperCase() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> separatorX1 = locationName.length + <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location.isOpen) { <span class="hljs-number"><span class="hljs-number">6</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location.bag.size &gt;= <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { closedString.length + <span class="hljs-number"><span class="hljs-number">7</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> separatorX2 = CONSOLE_WIDTH - timeString.length - <span class="hljs-number"><span class="hljs-number">6</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (timer &gt;= <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">//Top border ansi.cursor(1, 1) ansi.a('‚îå') (2 until CONSOLE_WIDTH).forEach { ansi.a(if (it == separatorX1 || it == separatorX2) '‚î¨' else '‚îÄ') } ansi.a('‚îê') //Center row ansi.cursor(2, 1) ansi.a("‚îÇ ") if (location.isOpen) { ansi.color(WHITE).a(locationName).reset() ansi.a(": ").a(location.bag.size) } else { ansi.a(locationName).reset() ansi.color(DARK_GRAY).a(" (").a(closedString).a(')').reset() } ansi.a(" ‚îÇ") var currentX = separatorX1 + 2 heroesAtLocation.forEach { hero -&gt; ansi.a(' ') ansi.color(heroColors[hero.type]) ansi.a(if (hero === currentHero) '‚òª' else '').reset() currentX += 2 } (currentX..separatorX2).forEach { ansi.a(' ') } ansi.a("‚îÇ ").a(timeString).a(": ") when { timer &lt;= 5 -&gt; ansi.color(LIGHT_RED) timer &lt;= 15 -&gt; ansi.color(LIGHT_YELLOW) else -&gt; ansi.color(LIGHT_GREEN) } ansi.bold().a(timer).reset().a(" ‚îÇ") //Bottom border ansi.cursor(3, 1) ansi.a('‚îú') (2 until CONSOLE_WIDTH).forEach { ansi.a(if (it == separatorX1 || it == separatorX2) '‚î¥' else '‚îÄ') } ansi.a('‚î§') } private fun drawLocationHeroPanel(offsetY: Int, hero: Hero) { val bagString = loadString("bag").toUpperCase() val discardString = loadString("discard").toUpperCase() val separatorX1 = hero.name.length + 4 val separatorX3 = CONSOLE_WIDTH - discardString.length - 6 - if (hero.discardPile.size &gt;= 10) 1 else 0 val separatorX2 = separatorX3 - bagString.length - 6 - if (hero.bag.size &gt;= 10) 1 else 0 //Top border ansi.cursor(offsetY, 1) ansi.a('‚îú') (2 until CONSOLE_WIDTH).forEach { ansi.a(if (it == separatorX1 || it == separatorX2 || it == separatorX3) '‚î¨' else '‚îÄ') } ansi.a('‚î§') //Center row ansi.cursor(offsetY + 1, 1) ansi.a("‚îÇ ") ansi.color(heroColors[hero.type]).a(hero.name.toUpperCase()).reset() ansi.a(" ‚îÇ") val currentX = separatorX1 + 1 (currentX until separatorX2).forEach { ansi.a(' ') } ansi.a("‚îÇ ").a(bagString).a(": ") when { hero.bag.size &lt;= hero.hand.capacity -&gt; ansi.color(LIGHT_RED) else -&gt; ansi.color(LIGHT_YELLOW) } ansi.a(hero.bag.size).reset() ansi.a(" ‚îÇ ").a(discardString).a(": ") ansi.a(hero.discardPile.size) ansi.a(" ‚îÇ") //Bottom border ansi.cursor(offsetY + 2, 1) ansi.a('‚îú') (2 until CONSOLE_WIDTH).forEach { ansi.a(if (it == separatorX1 || it == separatorX2 || it == separatorX3) '‚î¥' else '‚îÄ') } ansi.a('‚î§') } private fun drawDieSize(die: Die, checked: Boolean = false) { when { checked -&gt; ansi.background(dieColors[die.type]).color(BLACK) else -&gt; ansi.color(dieColors[die.type]) } ansi.a(die.toString()).reset() } private fun drawDieFrameSmall(offsetX: Int, offsetY: Int, longDieSize: Boolean) { //Top border ansi.cursor(offsetY, offsetX) ansi.a('‚ïî') (0 until if (longDieSize) 5 else 4).forEach { ansi.a('‚ïê') } ansi.a('‚ïó') //Left border ansi.cursor(offsetY + 1, offsetX) ansi.a("‚ïë ") //Bottom border ansi.cursor(offsetY + 2, offsetX) ansi.a("‚ïö") (0 until if (longDieSize) 5 else 4).forEach { ansi.a('‚ïê') } ansi.a('‚ïù') //Right border ansi.cursor(offsetY + 1, offsetX + if (longDieSize) 6 else 5) ansi.a('‚ïë') } private fun drawDieSmall(offsetX: Int, offsetY: Int, pair: DiePair, rollResult: Int? = null) { ansi.color(dieColors[pair.die.type]) val longDieSize = pair.die.size &gt;= 10 drawDieFrameSmall(offsetX, offsetY, longDieSize) //Roll result or die size ansi.cursor(offsetY + 1, offsetX + 1) if (rollResult != null) { ansi.a(String.format(" %2d %s", rollResult, if (longDieSize) " " else "")) } else { ansi.a(' ').a(pair.die.toString()).a(' ') } //Draw modifier ansi.cursor(offsetY + 3, offsetX) val modString = if (pair.modifier == 0) "" else String.format("%+d", pair.modifier) val frameLength = 4 + if (longDieSize) 3 else 2 var spaces = (frameLength - modString.length) / 2 (0 until spaces).forEach { ansi.a(' ') } ansi.a(modString) spaces = frameLength - spaces - modString.length (0 until spaces).forEach { ansi.a(' ') } ansi.reset() } private fun drawDieFrameBig(offsetX: Int, offsetY: Int, longDieSize: Boolean) { //Top border ansi.cursor(offsetY, offsetX) ansi.a('‚ïî') (0 until if (longDieSize) 3 else 2).forEach { ansi.a("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê") } ansi.a("‚ïê‚ïó") //Left border (1..5).forEach { ansi.cursor(offsetY + it, offsetX) ansi.a('‚ïë') } //Bottom border ansi.cursor(offsetY + 6, offsetX) ansi.a('‚ïö') (0 until if (longDieSize) 3 else 2).forEach { ansi.a("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê") } ansi.a("‚ïê‚ïù") //Right border val currentX = offsetX + if (longDieSize) 20 else 14 (1..5).forEach { ansi.cursor(offsetY + it, currentX) ansi.a('‚ïë') } } private fun drawDieSizeBig(offsetX: Int, offsetY: Int, pair: DiePair) { ansi.color(dieColors[pair.die.type]) val longDieSize = pair.die.size &gt;= 10 drawDieFrameBig(offsetX, offsetY, longDieSize) //Die size ansi.cursor(offsetY + 1, offsetX + 1) ansi.a(" ‚ñà‚ñà‚ñà‚ñà ") ansi.cursor(offsetY + 2, offsetX + 1) ansi.a(" ‚ñà ‚ñà ") ansi.cursor(offsetY + 3, offsetX + 1) ansi.a(" ‚ñà ‚ñà ") ansi.cursor(offsetY + 4, offsetX + 1) ansi.a(" ‚ñà ‚ñà ") ansi.cursor(offsetY + 5, offsetX + 1) ansi.a(" ‚ñà‚ñà‚ñà‚ñà ") drawBigNumber(offsetX + 8, offsetY + 1, pair.die.size) //Draw modifier ansi.cursor(offsetY + 7, offsetX) val modString = if (pair.modifier == 0) "" else String.format("%+d", pair.modifier) val frameLength = 4 + 6 * if (longDieSize) 3 else 2 var spaces = (frameLength - modString.length) / 2 (0 until spaces).forEach { ansi.a(' ') } ansi.a(modString) spaces = frameLength - spaces - modString.length - 1 (0 until spaces).forEach { ansi.a(' ') } ansi.reset() } private fun drawBattleCheck(offsetY: Int, battleCheck: DieBattleCheck) { val performCheck = loadString("perform_check") var currentX = 4 var currentY = offsetY //Top message ansi.cursor(offsetY, 1) ansi.a("‚îÇ ").a(performCheck) (performCheck.length + 4 until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('‚îÇ') //Left border (1..4).forEach { ansi.cursor(offsetY + it, 1) ansi.a("‚îÇ ") } //Opponent var opponentWidth = 0 var vsWidth = 0 (battleCheck.getOpponentPair())?.let { //Die if (battleCheck.isRolled) { drawDieSmall(4, offsetY + 1, it, battleCheck.getOpponentResult()) } else { drawDieSmall(4, offsetY + 1, it) } opponentWidth = 4 + if (it.die.size &gt;= 10) 3 else 2 currentX += opponentWidth //VS ansi.cursor(currentY + 1, currentX) ansi.a(" ") ansi.cursor(currentY + 2, currentX) ansi.color(LIGHT_YELLOW).a(" VS ").reset() ansi.cursor(currentY + 3, currentX) ansi.a(" ") ansi.cursor(currentY + 4, currentX) ansi.a(" ") vsWidth = 4 currentX += vsWidth } //Clear below for (row in currentY + 5..currentY + 8) { ansi.cursor(row, 1) ansi.a('‚îÇ') (2 until currentX).forEach { ansi.a(' ') } } //Dice for (index in 0 until battleCheck.heroPairCount) { if (index &gt; 0) { ansi.cursor(currentY + 1, currentX) ansi.a(" ") ansi.cursor(currentY + 2, currentX) ansi.a(if (battleCheck.method == DieBattleCheck.Method.SUM) " + " else " / ").reset() ansi.cursor(currentY + 3, currentX) ansi.a(" ") ansi.cursor(currentY + 4, currentX) ansi.a(" ") currentX += 3 } val pair = battleCheck.getHeroPairAt(index) val width = 4 + if (pair.die.size &gt;= 10) 3 else 2 if (currentX + width + 3 &gt; CONSOLE_WIDTH) { //Out of space for (row in currentY + 1..currentY + 4) { ansi.cursor(row, currentX) (currentX until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('‚îÇ') } currentY += 4 currentX = 4 + vsWidth + opponentWidth } if (battleCheck.isRolled) { drawDieSmall(currentX, currentY + 1, pair, battleCheck.getHeroResultAt(index)) } else { drawDieSmall(currentX, currentY + 1, pair) } currentX += width } //Clear the rest (currentY + 1..currentY + 4).forEach { row -&gt; ansi.cursor(row, currentX) (currentX until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('‚îÇ') } if (currentY == offsetY) { //Still on the first line currentX = 4 + vsWidth + opponentWidth (currentY + 5..currentY + 8).forEach { row -&gt; ansi.cursor(row, currentX) (currentX until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('‚îÇ') } } //Draw result (battleCheck.result)?.let { r -&gt; val frameTopY = offsetY + 5 val result = String.format("%+d", r) val message = loadString(if (r &gt;= 0) "success" else "fail").toUpperCase() val color = if (r &gt;= 0) DARK_GREEN else DARK_RED //Frame ansi.color(color) drawHorizontalLine(frameTopY, '‚ñí') drawHorizontalLine(frameTopY + 3, '‚ñí') ansi.cursor(frameTopY + 1, 1).a("‚ñí‚ñí") ansi.cursor(frameTopY + 1, CONSOLE_WIDTH - 1).a("‚ñí‚ñí") ansi.cursor(frameTopY + 2, 1).a("‚ñí‚ñí") ansi.cursor(frameTopY + 2, CONSOLE_WIDTH - 1).a("‚ñí‚ñí") ansi.reset() //Top message val resultString = loadString("result") var center = (CONSOLE_WIDTH - result.length - resultString.length - 2) / 2 ansi.cursor(frameTopY + 1, 3) (3 until center).forEach { ansi.a(' ') } ansi.a(resultString).a(": ") ansi.color(color).a(result).reset() (center + result.length + resultString.length + 2 until CONSOLE_WIDTH - 1).forEach { ansi.a(' ') } //Bottom message center = (CONSOLE_WIDTH - message.length) / 2 ansi.cursor(frameTopY + 2, 3) (3 until center).forEach { ansi.a(' ') } ansi.color(color).a(message).reset() (center + message.length until CONSOLE_WIDTH - 1).forEach { ansi.a(' ') } } } private fun drawExplorationResult(offsetY: Int, pair: DiePair) { val encountered = loadString("encountered") ansi.cursor(offsetY, 1) ansi.a("‚îÇ ").a(encountered).a(':') (encountered.length + 5 until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('‚îÇ') val dieFrameWidth = 3 + 6 * if (pair.die.size &gt;= 10) 3 else 2 for (row in 1..8) { ansi.cursor(offsetY + row, 1) ansi.a("‚îÇ ") ansi.cursor(offsetY + row, dieFrameWidth + 4) (dieFrameWidth + 4 until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('‚îÇ') } drawDieSizeBig(4, offsetY + 1, pair) } private fun drawHand(offsetY: Int, hand: Hand, checkedDice: HandMask, activePositions: HandMask) { val handString = loadString("hand").toUpperCase() val alliesString = loadString("allies").toUpperCase() val capacity = hand.capacity val size = hand.dieCount val slots = max(size, capacity) val alliesSize = hand.allyDieCount var currentY = offsetY var currentX = 1 //Hand title ansi.cursor(currentY, currentX) ansi.a("‚îÇ ").a(handString) //Left border currentY += 1 currentX = 1 ansi.cursor(currentY, currentX) ansi.a("‚îÇ ‚ïî") ansi.cursor(currentY + 1, currentX) ansi.a("‚îÇ ‚ïë") ansi.cursor(currentY + 2, currentX) ansi.a("‚îÇ ‚ïö") ansi.cursor(currentY + 3, currentX) ansi.a("‚îÇ ") currentX += 3 //Main hand for (i in 0 until min(slots, MAX_HAND_SIZE)) { val die = hand.dieAt(i) val longDieName = die != null &amp;&amp; die.size &gt;= 10 //Top border ansi.cursor(currentY, currentX) if (i &lt; capacity) { ansi.a("‚ïê‚ïê‚ïê‚ïê").a(if (longDieName) "‚ïê" else "") } else { ansi.a("‚îÄ‚îÄ‚îÄ‚îÄ").a(if (longDieName) "‚îÄ" else "") } ansi.a(if (i &lt; capacity - 1) '‚ï§' else if (i == capacity - 1) '‚ïó' else if (i &lt; size - 1) '‚î¨' else '‚îê') //Center row ansi.cursor(currentY + 1, currentX) ansi.a(' ') if (die != null) { drawDieSize(die, checkedDice.checkPosition(i)) } else { ansi.a(" ") } ansi.a(' ') ansi.a(if (i &lt; capacity - 1) '‚îÇ' else if (i == capacity - 1) '‚ïë' else '‚îÇ') //Bottom border ansi.cursor(currentY + 2, currentX) if (i &lt; capacity) { ansi.a("‚ïê‚ïê‚ïê‚ïê").a(if (longDieName) '‚ïê' else "") } else { ansi.a("‚îÄ‚îÄ‚îÄ‚îÄ").a(if (longDieName) '‚îÄ' else "") } ansi.a(if (i &lt; capacity - 1) '‚ïß' else if (i == capacity - 1) '‚ïù' else if (i &lt; size - 1) '‚î¥' else '‚îò') //Die number ansi.cursor(currentY + 3, currentX) if (activePositions.checkPosition(i)) { ansi.color(LIGHT_YELLOW) } ansi.a(String.format(" (%s) %s", shortcut(i), if (longDieName) " " else "")) ansi.reset() currentX += 5 + if (longDieName) 1 else 0 } //Ally subhand if (alliesSize &gt; 0) { currentY = offsetY //Ally title ansi.cursor(currentY, handString.length + 5) (handString.length + 5 until currentX).forEach { ansi.a(' ') } ansi.a(" ").a(alliesString) (currentX + alliesString.length + 5 until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('‚îÇ') //Left border currentY += 1 ansi.cursor(currentY, currentX) ansi.a(" ‚îå") ansi.cursor(currentY + 1, currentX) ansi.a(" ‚îÇ") ansi.cursor(currentY + 2, currentX) ansi.a(" ‚îî") ansi.cursor(currentY + 3, currentX) ansi.a(" ") currentX += 4 //Ally slots for (i in 0 until min(alliesSize, MAX_HAND_ALLY_SIZE)) { val allyDie = hand.allyDieAt(i)!! val longDieName = allyDie.size &gt;= 10 //Top border ansi.cursor(currentY, currentX) ansi.a("‚îÄ‚îÄ‚îÄ‚îÄ").a(if (longDieName) "‚îÄ" else "") ansi.a(if (i &lt; alliesSize - 1) '‚î¨' else '‚îê') //Center row ansi.cursor(currentY + 1, currentX) ansi.a(' ') drawDieSize(allyDie, checkedDice.checkAllyPosition(i)) ansi.a(" ‚îÇ") //Bottom border ansi.cursor(currentY + 2, currentX) ansi.a("‚îÄ‚îÄ‚îÄ‚îÄ").a(if (longDieName) "‚îÄ" else "") ansi.a(if (i &lt; alliesSize - 1) '‚î¥' else '‚îò') //Die number ansi.cursor(currentY + 3, currentX) if (activePositions.checkAllyPosition(i)) { ansi.color(LIGHT_YELLOW) } ansi.a(String.format(" (%s) %s", shortcut(i + 10), if (longDieName) " " else "")).reset() currentX += 5 + if (longDieName) 1 else 0 } } else { ansi.cursor(offsetY, 9) (9 until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('‚îÇ') ansi.cursor(offsetY + 4, currentX) (currentX until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('‚îÇ') } //Clear the end of the line (0..3).forEach { row -&gt; ansi.cursor(currentY + row, currentX) (currentX until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('‚îÇ') } } override fun drawHeroTurnStart(hero: Hero) { val centerY = (CONSOLE_HEIGHT - 5) / 2 (1 until centerY).forEach { drawBlankLine(it, false) } ansi.color(heroColors[hero.type]) drawHorizontalLine(centerY, '‚îÄ') drawHorizontalLine(centerY + 4, '‚îÄ') ansi.reset() ansi.cursor(centerY + 1, 1).eraseLine() ansi.cursor(centerY + 3, 1).eraseLine() ansi.cursor(centerY + 2, 1) val text = String.format(loadString("heros_turn"), hero.name.toUpperCase()) val index = text.indexOf(hero.name.toUpperCase()) val center = (CONSOLE_WIDTH - text.length) / 2 ansi.cursor(centerY + 2, center) ansi.eraseLine(Ansi.Erase.BACKWARD) ansi.a(text.substring(0, index)) ansi.color(heroColors[hero.type]).a(hero.name.toUpperCase()).reset() ansi.a(text.substring(index + hero.name.length)) ansi.eraseLine(Ansi.Erase.FORWARD) (centerY + 5..CONSOLE_HEIGHT).forEach { drawBlankLine(it, false) } render() } override fun drawLocationInteriorScreen( location: Location, heroesAtLocation: List&lt;Hero&gt;, timer: Int, currentHero: Hero, battleCheck: DieBattleCheck?, encounteredDie: DiePair?, pickedDice: HandMask, activePositions: HandMask, statusMessage: StatusMessage, actions: ActionList) { //Top panel drawLocationTopPanel(location, heroesAtLocation, currentHero, timer) //Encounter info when { battleCheck != null -&gt; drawBattleCheck(4, battleCheck) encounteredDie != null -&gt; drawExplorationResult(4, encounteredDie) else -&gt; (4..12).forEach { drawBlankLine(it) } } //Fill blank space val bottomHalfTop = CONSOLE_HEIGHT - 11 (13 until bottomHalfTop).forEach { drawBlankLine(it) } //Hero-specific info drawLocationHeroPanel(bottomHalfTop, currentHero) drawHand(bottomHalfTop + 3, currentHero.hand, pickedDice, activePositions) //Separator ansi.cursor(bottomHalfTop + 8, 1) ansi.a('‚îú') (2 until CONSOLE_WIDTH).forEach { ansi.a('‚îÄ') } ansi.a('‚î§') //Status and actions drawStatusMessage(bottomHalfTop + 9, statusMessage) drawActionList(bottomHalfTop + 10, actions) //Bottom border ansi.cursor(CONSOLE_HEIGHT, 1) ansi.a('‚îî') (2 until CONSOLE_WIDTH).forEach { ansi.a('‚îÄ') } ansi.a('‚îò') //Finalize render() } override fun drawGameLoss(message: StatusMessage) { val centerY = CONSOLE_HEIGHT / 2 (1 until centerY).forEach { drawBlankLine(it, false) } val data = loadString(message.toString().toLowerCase()).toUpperCase() drawCenteredCaption(centerY, data, LIGHT_RED, false) (centerY + 1..CONSOLE_HEIGHT).forEach { drawBlankLine(it, false) } render() } }</span></span></code> </pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt ein kleines Problem bei der √úberpr√ºfung der Funktionsweise dieses gesamten Codes. </font><font style="vertical-align: inherit;">Da die integrierte IDE-Konsole keine ANSI-Escape-Sequenzen unterst√ºtzt, m√ºssen Sie die Anwendung in einem externen Terminal starten (wir haben bereits ein Skript zum fr√ºheren Starten geschrieben). </font><font style="vertical-align: inherit;">Dar√ºber hinaus ist mit ANSI-Unterst√ºtzung unter Windows nicht alles in Ordnung - soweit ich wei√ü, kann uns die Standard-cmd.exe nur mit der 10. Version mit einem hochwertigen Display zufrieden stellen (und das mit einigen Problemen, auf die wir uns nicht konzentrieren werden). </font><font style="vertical-align: inherit;">Und PowerShell hat nicht sofort gelernt, Sequenzen zu erkennen (trotz der aktuellen Nachfrage). </font><font style="vertical-align: inherit;">Wenn Sie Pech haben, lassen Sie sich nicht entmutigen - es gibt immer alternative L√∂sungen ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zum Beispiel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Und wir gehen weiter.</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schritt zehn </font><font style="vertical-align: inherit;">Benutzereingabe</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Anzeigen des Bildes auf dem Bildschirm ist immer noch die halbe Miete. Ebenso wichtig ist es, Steuerbefehle vom Benutzer korrekt zu empfangen. Und diese Aufgabe, m√∂chte ich Ihnen sagen, kann sich als technisch viel schwieriger herausstellen als alle vorherigen.</font></font> Aber das Wichtigste zuerst. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie Sie sich erinnern, stehen wir vor der Notwendigkeit, Klassenmethoden zu implementieren </font></font><code>GameInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Es gibt nur drei von ihnen, aber sie erfordern besondere Aufmerksamkeit. Erstens die Synchronisation. Die Spiel-Engine sollte angehalten werden, bis der Spieler eine Taste dr√ºckt. Zweitens klicken Sie auf Verarbeitung. Leider ist die Kapazit√§t von Standardklassen </font></font><code>Reader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Scanner</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Console</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist nicht genug , </font><font style="vertical-align: inherit;">um diese dringendsten zu erkennen: Wir brauchen nicht um </font><font style="vertical-align: inherit;">den Benutzer zu dr√ºcken nach jedem Befehl ENTER. Wir brauchen so etwas wie </font></font><code>KeyListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'a', aber es ist eng mit dem Swing-Framework verbunden, und unsere Konsolenanwendung ist ohne all dieses grafische Lametta.</font></font><br><br>  Was tun?<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Suche nach Bibliotheken und diesmal ihre Arbeit basieren nat√ºrlich ausschlie√ülich auf nativem Code. Was bedeutet "Auf Wiedersehen, plattform√ºbergreifend" ... oder nicht? Leider habe ich noch keine Bibliothek gefunden, die einfache Funktionen in einer leichten, plattformunabh√§ngigen Form implementiert. Lassen Sie uns in der Zwischenzeit auf das Monster </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jLine achten</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , das einen Harvester zum </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Erstellen</font></a><font style="vertical-align: inherit;"> erweiterter Benutzeroberfl√§chen (in der Konsole) implementiert. Ja, es hat eine native Implementierung, ja, es unterst√ºtzt sowohl Windows als auch Linux / UNIX (durch Bereitstellung der entsprechenden Bibliotheken). Und ja, verwendet </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> den meisten seiner Funktionalit√§t, wissen </font><font style="vertical-align: inherit;">wir nicht hundert Jahre brauchen. Alles, was ben√∂tigt wird, ist eine kleine, schlecht dokumentierte Gelegenheit, deren Arbeit wir nun analysieren werden.</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>jline<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jline<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.14.6<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bitte beachten Sie, dass wir nicht die dritte, neueste Version ben√∂tigen, sondern die zweite, in der es eine Klasse </font></font><code>ConsoleReader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mit einer Methode gibt </font></font><code>readCharacter()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Wie der Name schon sagt, gibt diese Methode den Code des auf der Tastatur gedr√ºckten Zeichens zur√ºck (w√§hrend wir synchron arbeiten, was wir brauchen). Der Rest ist eine technische Angelegenheit: Erstellen Sie eine Korrespondenztabelle zwischen Symbolen und Aktionstypen ( </font></font><code>Action.Type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) und geben Sie durch Klicken auf eines das andere zur√ºck. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄûWissen Sie, dass nicht alle Tasten auf der Tastatur mit einem Zeichen dargestellt werden k√∂nnen? Viele Schl√ºssel verwenden Escape-Sequenzen mit zwei, drei, vier verschiedenen Zeichen. Wie kann man mit ihnen zusammen sein? "</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es sollte beachtet werden, dass die Eingabeaufgabe kompliziert ist, wenn wir "Nicht-Zeichen-Tasten" erkennen m√∂chten: Pfeile, F-Tasten, Home, Einf√ºgen, PgUp / Dn, Ende, L√∂schen, Nummernblock und andere. </font><font style="vertical-align: inherit;">Aber wir wollen nicht, deshalb werden wir weitermachen. </font><font style="vertical-align: inherit;">Erstellen wir eine Klasse </font></font><code>ConsoleInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mit den erforderlichen Servicemethoden.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConsoleInteractor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> reader = ConsoleReader() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mapper = mapOf( CONFIRM to <span class="hljs-number"><span class="hljs-number">13</span></span>.toChar(), CANCEL to <span class="hljs-number"><span class="hljs-number">27</span></span>.toChar(), EXPLORE_LOCATION to <span class="hljs-string"><span class="hljs-string">'e'</span></span>, FINISH_TURN to <span class="hljs-string"><span class="hljs-string">'f'</span></span>, ACQUIRE to <span class="hljs-string"><span class="hljs-string">'a'</span></span>, LEAVE to <span class="hljs-string"><span class="hljs-string">'l'</span></span>, FORFEIT to <span class="hljs-string"><span class="hljs-string">'f'</span></span>, HIDE to <span class="hljs-string"><span class="hljs-string">'h'</span></span>, DISCARD to <span class="hljs-string"><span class="hljs-string">'d'</span></span>, ) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = reader.readCharacter().toChar() <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIndexForKey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Char</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-string"><span class="hljs-string">"1234567890abcdefghijklmnopqrstuvw"</span></span>.indexOf(key) }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stellen Sie die Karte </font></font><code>mapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und Methode ein </font></font><code>read()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dar√ºber hinaus stellen wir eine Methode </font></font><code>getIndexForKey()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zur </font><font style="vertical-align: inherit;">Verf√ºgung, </font><font style="vertical-align: inherit;">die in Situationen verwendet wird, in denen ein Element aus einer Liste oder W√ºrfel aus einer Hand ausgew√§hlt werden m√ºssen. </font><font style="vertical-align: inherit;">Es bleibt, unsere Schnittstellenimplementierung von dieser Klasse zu erben </font></font><code>GameInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klassendiagramm</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/hv/oh/h_/hvohh_s5evuqa4kwwwhtvvfbsmw.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Und in der Tat der Code: </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConsoleGameInteractor</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ConsoleInteractor</span></span></span></span>(), GameInteractor { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">anyInput</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { read() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pickAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(list: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Action { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> key = read() list .filter(Action::isEnabled) .find { mapper[it.type] == key } ?.let { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> it } } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pickDiceFromHand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(activePositions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, actions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> : Action { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> key = read() actions.forEach { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mapper[it.type] == key &amp;&amp; it.isEnabled) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> it } <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (key) { <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">'1'</span></span>..<span class="hljs-string"><span class="hljs-string">'9'</span></span> -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> index = key - <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (activePositions.checkPosition(index)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Action(HAND_POSITION, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = index) } } <span class="hljs-string"><span class="hljs-string">'0'</span></span> -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (activePositions.checkPosition(<span class="hljs-number"><span class="hljs-number">9</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Action(HAND_POSITION, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = <span class="hljs-number"><span class="hljs-number">9</span></span>) } } <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">'a'</span></span>..<span class="hljs-string"><span class="hljs-string">'f'</span></span> -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> allyIndex = key - <span class="hljs-string"><span class="hljs-string">'a'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (activePositions.checkAllyPosition(allyIndex)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Action(HAND_ALLY_POSITION, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = allyIndex) } } } } } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Umsetzung unserer Methoden ist sehr h√∂flich und gutm√ºtig, um nicht verschiedene unangemessene Unsinn hervorzubringen. </font><font style="vertical-align: inherit;">Sie selbst √ºberpr√ºfen, ob die ausgew√§hlte Aktion aktiv ist und die ausgew√§hlte Handposition im g√ºltigen Satz enthalten ist. </font><font style="vertical-align: inherit;">Und ich m√∂chte, dass wir alle so h√∂flich zu den Menschen um uns herum sind.</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schritt elf. </font><font style="vertical-align: inherit;">Kl√§nge und Musik</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aber wie kann es ohne sie sein? Wenn Sie jemals Spiele mit ausgeschaltetem Ton gespielt haben (z. B. mit einem Tablet unter der Decke, w√§hrend niemand zu Hause etwas sieht), haben Sie m√∂glicherweise festgestellt, wie viel Sie verlieren. Es ist, als w√ºrde man nur die H√§lfte des Spiels spielen. Viele Spiele sind ohne Klangbegleitung nicht vorstellbar, f√ºr viele ist dies eine unver√§u√üerliche Voraussetzung, obwohl es umgekehrte Situationen gibt (zum Beispiel, wenn im Prinzip keine Kl√§nge vorhanden sind oder sie so elend sind, dass es ohne sie besser w√§re). Gute Arbeit zu leisten ist eigentlich nicht so einfach, wie es auf den ersten Blick scheint (nicht ohne Grund tun dies hochqualifizierte Spezialisten in gro√üen Studios), aber wie auch immer, in den meisten F√§llen ist es viel besser, eine Audiokomponente (zumindest einige) in Ihrem Spiel zu haben als sie √ºberhaupt nicht zu haben. Als letztes Mittel kann die Klangqualit√§t sp√§ter verbessert werden.wenn es Zeit und Stimmung erlauben.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aufgrund der Besonderheiten des Genres wird unser Spiel nicht durch meisterhafte Soundeffekte gekennzeichnet sein. Wenn Sie digitale Anpassungen von Brettspielen gespielt haben, verstehen Sie, was ich meine. Kl√§nge sto√üen ihre Monotonie ab, werden bald langweilig und nach einiger Zeit scheint das Spielen ohne sie kein ernsthafter Verlust mehr zu sein. Das Problem wird durch die Tatsache versch√§rft, dass es keine wirksamen M√∂glichkeiten gibt, mit diesem Ph√§nomen umzugehen. Ersetzen Sie Spielger√§usche durch v√∂llig andere, und im Laufe der Zeit werden sie angewidert. In guten Spielen erg√§nzen Sounds das Gameplay, enth√ºllen die Atmosph√§re der laufenden Action, machen sie lebendig - dies ist schwer zu erreichen, wenn die Atmosph√§re nur ein Tisch mit einem Haufen staubiger Taschen ist und das gesamte Gameplay aus W√ºrfeln besteht. Trotzdem werden wir genau das sagen: Die Seide ist hier, die Besetzung ist hier,Rascheln und Rascheln zu lauten Schreien - als ob wir kein Bild auf dem Bildschirm beobachten w√ºrden, sondern wirklich mit realen physischen Objekten interagieren w√ºrden. Sie m√ºssen vollst√§ndig, aber unauff√§llig ge√§u√üert werden - w√§hrend des gesamten Skripts werden Sie sie hundertmal h√∂ren, damit die Sounds nicht in den Vordergrund treten - schattieren Sie das Gameplay nur sanft. Wie kann dies kompetent erreicht werden? Ich habe keine Ahnung, ich bin kein besonderer Klang. Ich kann Ihnen nur raten, Ihr Spiel so oft wie m√∂glich zu spielen und auff√§llige Fehler zu bemerken und zu beseitigen (dieser Rat gilt √ºbrigens nicht nur f√ºr Sounds).Wie kann dies kompetent erreicht werden? Ich habe keine Ahnung, ich bin kein besonderer Klang. Ich kann Ihnen nur raten, Ihr Spiel so oft wie m√∂glich zu spielen und auff√§llige Fehler zu bemerken und zu beseitigen (dieser Rat gilt √ºbrigens nicht nur f√ºr Sounds).Wie kann dies kompetent erreicht werden? Ich habe keine Ahnung, ich bin kein besonderer Klang. Ich kann Ihnen nur raten, Ihr Spiel so oft wie m√∂glich zu spielen und auff√§llige Fehler zu bemerken und zu beseitigen (dieser Rat gilt √ºbrigens nicht nur f√ºr Sounds).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mit der Theorie, so scheint es, ist es an der Zeit, mit der Praxis fortzufahren. Und vorher m√ºssen Sie eine Frage stellen: Wo sollen eigentlich Spieledateien abgelegt werden? Der einfachste und sicherste Weg - sie selbst in h√§sslicher Qualit√§t aufzunehmen, mit einem alten Mikrofon oder sogar mit dem Telefon. Das Internet ist voll von Videos dar√ºber, wie das Abschrauben der Ananasspitzen oder das Brechen von Eis mit einem Stiefel den Effekt erzielen kann, Knochen und einen knusprigen R√ºcken zu zerquetschen. Wenn Sie der √Ñsthetik des Surrealismus nicht fremd sind, k√∂nnen Sie Ihre eigene Stimme oder K√ºchenutensilien als Musikinstrument verwenden (es gibt Beispiele - und sogar erfolgreiche -, wo dies getan wurde). Oder Sie k√∂nnen zu </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">freesound.org</font></a><font style="vertical-align: inherit;"> gehen</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wo hundert andere Leute das vor langer Zeit f√ºr dich getan haben. </font><font style="vertical-align: inherit;">Achten Sie nur auf die Lizenz: Viele Autoren reagieren sehr empfindlich auf die Audioaufnahmen ihres lauten Hustens oder der auf den Boden geworfenen M√ºnzen - Sie m√∂chten die Fr√ºchte ihrer Arbeit keinesfalls skrupellos verwenden, ohne den urspr√ºnglichen Sch√∂pfer zu bezahlen oder sein kreatives Pseudonym nicht zu erw√§hnen (manchmal sehr bizarr). in den Kommentaren. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ziehen Sie die gew√ºnschten Dateien und platzieren Sie sie irgendwo im Klassenpfad. </font><font style="vertical-align: inherit;">Um sie zu identifizieren, verwenden wir die Aufz√§hlung, wobei jede Instanz einem Soundeffekt entspricht.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sound</span></span></span><span class="hljs-class"> </span></span>{ TURN_START, <span class="hljs-comment"><span class="hljs-comment">//Hero starts the turn BATTLE_CHECK_ROLL, //Perform check, type BATTLE_CHECK_SUCCESS, //Check was successful BATTLE_CHECK_FAILURE, //Check failed DIE_DRAW, //Draw die from bag DIE_HIDE, //Remove die to bag DIE_DISCARD, //Remove die to pile DIE_REMOVE, //Remove die entirely DIE_PICK, //Check/uncheck the die TRAVEL, //Move hero to another location ENCOUNTER_STAT, //Hero encounters STAT die ENCOUNTER_DIVINE, //Hero encounters DIVINE die ENCOUNTER_ALLY, //Hero encounters ALLY die ENCOUNTER_WOUND, //Hero encounters WOUND die ENCOUNTER_OBSTACLE, //Hero encounters OBSTACLE die ENCOUNTER_ENEMY, //Hero encounters ENEMY die ENCOUNTER_VILLAIN, //Hero encounters VILLAIN die DEFEAT_OBSTACLE, //Hero defeats OBSTACLE die DEFEAT_ENEMY, //Hero defeats ENEMY die DEFEAT_VILLAIN, //Hero defeats VILLAIN die TAKE_DAMAGE, //Hero takes damage HERO_DEATH, //Hero death CLOSE_LOCATION, //Location closed GAME_VICTORY, //Scenario completed GAME_LOSS, //Scenario failed ERROR, //When something unexpected happens }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Da die Methode zur Wiedergabe von Sounds je nach Hardwareplattform unterschiedlich ist, k√∂nnen wir √ºber die Schnittstelle von einer bestimmten Implementierung abstrahieren. </font><font style="vertical-align: inherit;">Zum Beispiel dieses:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SoundPlayer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sound: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Sound</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie die zuvor diskutierten Schnittstellen </font></font><code>GameRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>GameInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muss auch ihre Implementierung an die Eingabe an die Klasseninstanz √ºbergeben werden </font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. F√ºr den Anfang k√∂nnte eine Implementierung folgenderma√üen aussehen:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MuteSoundPlayer</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SoundPlayer { override fun play</span></span></span></span>(sound: Sound) { <span class="hljs-comment"><span class="hljs-comment">//Do nothing } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anschlie√üend werden wir weitere interessante Implementierungen betrachten, aber jetzt wollen wir √ºber Musik sprechen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie Soundeffekte spielt es eine gro√üe Rolle bei der Schaffung der Atmosph√§re des Spiels, und auf die gleiche Weise kann ein ausgezeichnetes Spiel durch unangemessene Musik ruiniert werden. Wie Kl√§nge sollte Musik unauff√§llig sein, nicht in den Vordergrund treten (au√üer wenn dies f√ºr einen k√ºnstlerischen Effekt erforderlich ist) und der Handlung auf dem Bildschirm angemessen entsprechen (hoffen Sie nicht, dass jemand ernsthaft vom Schicksal eines √ºberfallenen und gnadenlos get√∂teten Hauptdarstellers durchdrungen ist Held, wenn die Szene seines tragischen Todes von einer lustigen kleinen Musik aus einem Kinderlied begleitet wird). Dies ist sehr schwer zu erreichen, speziell ausgebildete Leute besch√§ftigen sich mit solchen Problemen (wir sind mit ihnen nicht vertraut), aber wir als Anf√§nger des Gamebuilding-Genies k√∂nnen auch etwas tun. Zum Beispiel irgendwohin gehen</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">freemusicarchive.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oder </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">soundcloud.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (oder sogar YouTube) und finden Sie etwas nach Ihren W√ºnschen. </font><font style="vertical-align: inherit;">F√ºr Desktops ist Ambient eine gute Wahl - leise, sanfte Musik ohne ausgepr√§gte Melodie, die sich gut zum Erstellen eines Hintergrunds eignet. </font><font style="vertical-align: inherit;">Achten Sie doppelt auf die Lizenz: Selbst freie Musik wird manchmal von talentierten Komponisten geschrieben, die eine finanzielle Anerkennung verdienen, wenn nicht sogar eine finanzielle Belohnung. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lassen Sie uns noch eine Aufz√§hlung erstellen:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Music</span></span></span><span class="hljs-class"> </span></span>{ SCENARIO_MUSIC_1, SCENARIO_MUSIC_2, SCENARIO_MUSIC_3, }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ebenso definieren wir die Schnittstelle und ihre Standardimplementierung. </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MusicPlayer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(music: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Music</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MuteMusicPlayer</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MusicPlayer { override fun play</span></span></span></span>(music: Music) { <span class="hljs-comment"><span class="hljs-comment">//Do nothing } override fun stop() { //Do nothing } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bitte beachten Sie, dass in diesem Fall zwei Methoden erforderlich sind: eine zum Starten der Wiedergabe und die andere zum Stoppen der Wiedergabe. </font><font style="vertical-align: inherit;">Es ist auch durchaus m√∂glich, dass zus√§tzliche Methoden (Pause / Fortsetzen, Zur√ºckspulen usw.) in Zukunft n√ºtzlich sein werden, aber bisher reichen diese beiden aus. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es scheint nicht sehr praktisch zu sein, jedes Mal Verweise auf Spielerklassen zwischen Objekten zu √ºbergeben. </font><font style="vertical-align: inherit;">Zu einer Zeit, brauchen wir nur einen ekzepmlyar Spieler, so w√ºrde ich vorschlagen wagen alle notwendigen spielen T√∂ne und Musik Methoden in einem separaten Objekt zu machen und machen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ein Einzelg√§nger</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Singleton). </font><font style="vertical-align: inherit;">Somit ist das verantwortliche Audio-Subsystem immer von √ºberall in der Anwendung verf√ºgbar, ohne st√§ndig Links zu derselben Instanz zu √ºbertragen. </font><font style="vertical-align: inherit;">Es wird so aussehen:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klassendiagramm des Audiowiedergabesystems</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/ie/jf/86/iejf862lemxbjw9vm5ozkq7ow4k.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klasse </font></font><code>Audio</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist unser Singleton. </font><font style="vertical-align: inherit;">Es bietet dem Subsystem eine einzige Fassade ... √ºbrigens, hier ist die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fassade</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Fassade) - ein weiteres Entwurfsmuster, das in diesen Bereichen Ihres Internets sorgf√§ltig entworfen und wiederholt (mit Beispielen) beschrieben wurde. </font><font style="vertical-align: inherit;">Nachdem ich bereits unzufriedene Schreie aus den hinteren Reihen geh√∂rt habe, h√∂re ich auf, die seit langem bekannten Dinge zu erkl√§ren, und gehe weiter. </font><font style="vertical-align: inherit;">Der Code lautet:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">object</span></span> Audio { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> soundPlayer: SoundPlayer = MuteSoundPlayer() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> musicPlayer: MusicPlayer = MuteMusicPlayer() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(soundPlayer: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">SoundPlayer</span></span></span></span><span class="hljs-function"><span class="hljs-params">, musicPlayer: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">MusicPlayer</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.soundPlayer = soundPlayer <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.musicPlayer = musicPlayer } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">playSound</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sound: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Sound</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.soundPlayer.play(sound) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">playMusic</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(music: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Music</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.musicPlayer.play(music) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopMusic</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.musicPlayer.stop() }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es reicht aus, es </font></font><code>init()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nur einmal ganz am Anfang </font><font style="vertical-align: inherit;">aufzurufen </font><font style="vertical-align: inherit;">(indem es mit den erforderlichen Objekten initialisiert wird) und in Zukunft bequeme Methoden zu verwenden, wobei die Implementierungsdetails v√∂llig vergessen werden. </font><font style="vertical-align: inherit;">Auch wenn Sie dies nicht tun, keine Sorge, das System stirbt - das Objekt wird durch Standardklassen initialisiert.</font></font><br><br>  Das ist alles.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es bleibt die eigentliche Wiedergabe zu behandeln. F√ºr das Abspielen von Sounds (oder, wie kluge Leute sagen, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Samples</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) verf√ºgt Java √ºber eine praktische Klasse </font></font><code>AudioSystem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und Oberfl√§che </font></font><code>Clip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Alles was wir brauchen ist, den Pfad zur Audiodatei korrekt festzulegen (was in unserem Klassenpfad liegt, erinnerst du dich?):</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.sound.sampled.AudioSystem <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BasicSoundPlayer</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SoundPlayer { private fun pathToFile</span></span></span></span>(sound: Sound) = <span class="hljs-string"><span class="hljs-string">"/sound/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${sound.toString().toLowerCase()}</span></span></span><span class="hljs-string">.wav"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sound: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Sound</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> url = javaClass.getResource(pathToFile(sound)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> audioIn = AudioSystem.getAudioInputStream(url) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> clip = AudioSystem.getClip() clip.<span class="hljs-keyword"><span class="hljs-keyword">open</span></span>(audioIn) clip.start() } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Methode </font></font><code>open()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kann es wegwerfen </font></font><code>IOException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(insbesondere, wenn ihm das Dateiformat mit etwas nicht gefallen hat - in diesem Fall empfehle ich, die Datei in einem Audio-Editor zu √∂ffnen und erneut zu speichern). Es w√§re also sch√∂n, sie in einen Block zu packen </font></font><code>try-catch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, aber zuerst tun wir es nicht, damit die Anwendung laut ist st√ºrzte jedes Mal mit Tonproblemen ab. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Ich wei√ü nicht einmal, was ich sagen soll ..."</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mit Musik ist es viel schlimmer. </font><font style="vertical-align: inherit;">Soweit ich wei√ü, gibt es in Java keine Standardmethode zum Abspielen von Musikdateien (z. B. im MP3-Format). Sie m√ºssen daher auf jeden Fall eine Bibliothek eines Drittanbieters verwenden (es gibt Dutzende verschiedener). </font><font style="vertical-align: inherit;">Jedes Leichtgewicht mit minimaler Funktionalit√§t ist f√ºr uns geeignet, zum Beispiel der recht beliebte </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JLayer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">F√ºgen Sie es hinzu, abh√§ngig von:</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.googlecode.soundlibs<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jlayer<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0.1.4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Und wir implementieren unseren Player mit seiner Hilfe. </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BasicMusicPlayer</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MusicPlayer { private var currentMusic: Music? = null private var thread: PlayerThread? = null private fun pathToFile</span></span></span></span>(music: Music) = <span class="hljs-string"><span class="hljs-string">"/music/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${music.toString().toLowerCase()}</span></span></span><span class="hljs-string">.mp3"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(music: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Music</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentMusic == music) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } currentMusic = music thread?.finish() Thread.yield() thread = PlayerThread(pathToFile(music)) thread?.start() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { currentMusic = <span class="hljs-literal"><span class="hljs-literal">null</span></span> thread?.finish() } <span class="hljs-comment"><span class="hljs-comment">// Thread responsible for playback private inner class PlayerThread(private val musicPath: String) : Thread() { private lateinit var player: Player private var isLoaded = false private var isFinished = false init { isDaemon = true } override fun run() { loop@ while (!isFinished) { try { player = Player(javaClass.getResource(musicPath).openConnection().apply { useCaches = false }.getInputStream()) isLoaded = true player.play() } catch (ex: Exception) { finish() break@loop } player.close() } } fun finish() { isFinished = true this.interrupt() if (isLoaded) { player.close() } } } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstens f√ºhrt diese Bibliothek die Wiedergabe synchron durch und blockiert den Hauptstrom, bis das Ende der Datei erreicht ist. Daher m√ºssen wir einen separaten Thread ( </font></font><code>PlayerThread</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">implementieren </font><font style="vertical-align: inherit;">und ihn "optional" (Daemon) machen, damit die Anwendung in keinem Fall vorzeitig beendet wird. Zweitens wird die Kennung der aktuell wiedergegebenen Musikdatei ( </font></font><code>currentMusic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">im Player-Code gespeichert </font><font style="vertical-align: inherit;">. Wenn pl√∂tzlich ein zweiter Befehl zum Abspielen kommt, werden wir die Wiedergabe nicht von vorne beginnen. Drittens wird die Wiedergabe nach Erreichen des Endes der Musikdatei erneut gestartet - und so weiter, bis der Stream durch den Befehl explizit gestoppt wird</font></font><code>finish()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(oder bis andere Threads abgeschlossen sind, wie bereits erw√§hnt). </font><font style="vertical-align: inherit;">Viertens, obwohl der obige Code mit scheinbar unn√∂tigen Flags und Befehlen gef√ºllt ist, wird er gr√ºndlich getestet und getestet - der Player arbeitet wie erwartet, verlangsamt das System nicht, unterbricht nicht pl√∂tzlich auf halbem Weg, f√ºhrt nicht zu Speicherlecks, enth√§lt keine genetisch ver√§nderten Objekte, leuchtet Frische und Reinheit. </font><font style="vertical-align: inherit;">Nehmen Sie es und verwenden Sie es mutig in Ihren Projekten.</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schritt zw√∂lf. </font><font style="vertical-align: inherit;">Lokalisierung</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Unser Spiel ist fast fertig, aber niemand wird es spielen. </font></font> Warum? <br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Es gibt kein Russisch! .. Es gibt kein Russisch! .. F√ºgen Sie die russische Sprache hinzu! .. Entwickelt von Hunden!" </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√ñffnen Sie die Seite eines interessanten Story-Spiels (insbesondere f√ºr Handys) auf der Website des Shops und lesen Sie die Rezensionen. </font><font style="vertical-align: inherit;">Werden sie anfangen, erstaunliche, handgezeichnete Grafiken zu loben? </font><font style="vertical-align: inherit;">Oder den atmosph√§rischen Klang bestaunen? </font><font style="vertical-align: inherit;">Oder eine spannende Geschichte diskutieren, die von der ersten Minute an s√ºchtig macht und erst am Ende losl√§sst?</font></font><br><br>  Nein.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unzufriedene "Spieler" weisen eine Reihe von Einheiten an und l√∂schen das Spiel im Allgemeinen. </font><font style="vertical-align: inherit;">Und dann brauchen sie auch Geld zur√ºck - und das alles aus einem einfachen Grund. </font><font style="vertical-align: inherit;">Ja, Sie haben vergessen, Ihr Meisterwerk in alle 95 Weltsprachen zu √ºbersetzen. </font><font style="vertical-align: inherit;">Oder besser gesagt, derjenige, dessen Tr√§ger am lautesten schreien. </font><font style="vertical-align: inherit;">Und alle!</font></font> Verstehst du<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monate harter Arbeit, lange schlaflose N√§chte, st√§ndige Nervenzusammenbr√ºche - all dies ist ein Hamster unter dem Schwanz. Sie haben eine gro√üe Anzahl von Spielern verloren und dies kann nicht behoben werden. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Denken Sie also voraus. Entscheiden Sie sich f√ºr Ihre Zielgruppe, w√§hlen Sie mehrere Hauptsprachen aus, bestellen Sie √úbersetzungsdienste ... tun Sie im Allgemeinen alles, was andere mehr als einmal in thematischen Artikeln beschrieben haben (schlauer als ich). Wir werden uns auf die technische Seite des Problems konzentrieren und dar√ºber sprechen, wie wir unser Produkt schmerzlos lokalisieren k√∂nnen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zuerst kommen wir zu den Vorlagen. Denken Sie daran, bevor die Namen und Beschreibungen als einfach gespeichert wurden </font></font><code>String</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Jetzt wird es nicht mehr funktionieren. Zus√§tzlich zur Standardsprache m√ºssen Sie auch eine √úbersetzung in alle Sprachen bereitstellen, die Sie unterst√ºtzen m√∂chten. Zum Beispiel so:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestEnemyTemplate</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EnemyTemplate { override val name = "Test enemy" override val description = "Some enemy standing in your way." override val nameLocalizations = mapOf</span></span></span></span>( <span class="hljs-string"><span class="hljs-string">"ru"</span></span> to <span class="hljs-string"><span class="hljs-string">" -"</span></span>, <span class="hljs-string"><span class="hljs-string">"ar"</span></span> to <span class="hljs-string"><span class="hljs-string">"ÿ®ÿπÿ∂ ÿßŸÑÿπÿØŸà"</span></span>, <span class="hljs-string"><span class="hljs-string">"iw"</span></span> to <span class="hljs-string"><span class="hljs-string">"◊ê◊ô◊ñ◊î ◊ê◊ï◊ô◊ë"</span></span>, <span class="hljs-string"><span class="hljs-string">"zh"</span></span> to <span class="hljs-string"><span class="hljs-string">"‰∏Ä‰∫õÊïµ‰∫∫"</span></span>, <span class="hljs-string"><span class="hljs-string">"ua"</span></span> to <span class="hljs-string"><span class="hljs-string">"—ñ "</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> descriptionLocalizations = mapOf( <span class="hljs-string"><span class="hljs-string">"ru"</span></span> to <span class="hljs-string"><span class="hljs-string">" - ."</span></span>, <span class="hljs-string"><span class="hljs-string">"ar"</span></span> to <span class="hljs-string"><span class="hljs-string">"ŸàÿµŸÅ ÿßŸÑÿπÿØŸà"</span></span>, <span class="hljs-string"><span class="hljs-string">"iw"</span></span> to <span class="hljs-string"><span class="hljs-string">"◊™◊ô◊ê◊ï◊® ◊î◊ê◊ï◊ô◊ë"</span></span>, <span class="hljs-string"><span class="hljs-string">"zh"</span></span> to <span class="hljs-string"><span class="hljs-string">"‰∏Ä‰∫õÊïµ‰∫∫ÁöÑÊèèËø∞"</span></span>, <span class="hljs-string"><span class="hljs-string">"ua"</span></span> to <span class="hljs-string"><span class="hljs-string">" —ó —ñ   ."</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> traits = listOf&lt;Trait&gt;() }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºr Vorlagen ist dieser Ansatz durchaus geeignet. </font><font style="vertical-align: inherit;">Wenn Sie keine √úbersetzung f√ºr eine Sprache angeben m√∂chten, m√ºssen Sie dies nicht tun - es gibt immer einen Standardwert. </font><font style="vertical-align: inherit;">In den endg√ºltigen Objekten m√∂chte ich jedoch nicht mehrere verschiedene Felder anordnen. </font><font style="vertical-align: inherit;">Daher werden wir einen belassen, aber seinen Typ ersetzen.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LocalizedString</span></span></span></span>(defaultValue: String, localizations: Map&lt;String, String&gt;) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: String = defaultValue <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> values: Map&lt;String, String&gt; = localizations.toMap() <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lang: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = values.getOrDefault(lang, <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(other: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> === other -&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> other !<span class="hljs-keyword"><span class="hljs-keyword">is</span></span> LocalizedString -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> == other.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hashCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.hashCode() } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Und korrigieren Sie den Generatorcode entsprechend. </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateEnemy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">EnemyTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Enemy().apply { name = LocalizedString(template.name, template.nameLocalizations) description = LocalizedString(template.description, template.descriptionLocalizations) template.traits.forEach { addTrait(it) } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nat√ºrlich sollte der gleiche Ansatz auf die verbleibenden Vorlagentypen angewendet werden. </font><font style="vertical-align: inherit;">Wenn die √Ñnderungen fertig sind, k√∂nnen sie problemlos verwendet werden.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> language = Locale.getDefault().language <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enemyName = enemy.name[language]</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In unserem Beispiel haben wir eine vereinfachte Version der Lokalisierung bereitgestellt, bei der nur die Sprache ber√ºcksichtigt wird. Im Allgemeinen </font></font><code>Locale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definieren </font><font style="vertical-align: inherit;">Klassenobjekte </font><font style="vertical-align: inherit;">auch das Land und die Region. Wenn dies in Ihrer Bewerbung wichtig ist, </font></font><code>LocalizedString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sieht </font><font style="vertical-align: inherit;">Ihre Bewerbung </font><font style="vertical-align: inherit;">etwas anders aus, aber wir sind trotzdem damit zufrieden. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben uns mit den Vorlagen befasst, es bleibt die Lokalisierung der in unserer Anwendung verwendeten Servicezeilen. Zum Gl√ºck </font></font><code>ResourceBundle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enth√§lt </font><font style="vertical-align: inherit;">es </font><font style="vertical-align: inherit;">bereits alle notwendigen Mechanismen. Es ist nur erforderlich, Dateien mit √úbersetzungen vorzubereiten und die Art und Weise zu √§ndern, in der sie heruntergeladen werden.</font></font><br><br><pre> <code class="plaintext hljs"># Game status messages choose_dice_perform_check=    : end_of_turn_discard_extra= :   : end_of_turn_discard_optional= :    : choose_action_before_exploration=,  : choose_action_after_exploration= .   ? encounter_physical=  .   . encounter_somatic=  .   . encounter_mental=  .   . encounter_verbal=  .   . encounter_divine=  .    : die_acquire_success=   ! die_acquire_failure=    . game_loss_out_of_time=    # Die types physical= somatic= mental= verbal= divine= ally= wound= enemy= villain= obstacle= # Hero types and descriptions brawler= hunter= # Various labels avg= bag= bag_size=  class= closed= discard= empty= encountered=  fail= hand= heros_turn= %s max= min= perform_check= : pile= received_new_die=   result= success= sum= time= total= # Action names and descriptions action_confirm_key=ENTER action_confirm_name= action_cancel_key=ESC action_cancel_name= action_explore_location_key=E action_explore_location_name= action_finish_turn_key=F action_finish_turn_name=  action_hide_key=H action_bag_name= action_discard_key=D action_discard_name= action_acquire_key=A action_acquire_name= action_leave_key=L action_leave_name= action_forfeit_key=F action_forfeit_name=</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich werde nicht f√ºr die Aufzeichnung sagen: Das Schreiben von Phrasen auf Russisch ist viel schwieriger als auf Englisch. Wenn es erforderlich ist, ein Substantiv in einem endg√ºltigen Fall zu verwenden oder sich vom Geschlecht zu l√∂sen (und diese Anforderungen m√ºssen unbedingt bestehen bleiben), m√ºssen Sie viel schwitzen, bevor Sie ein Ergebnis erhalten, das zum einen den Anforderungen entspricht und zum anderen nicht wie eine mechanische √úbersetzung eines Cyborgs aussieht mit H√ºhnerhirn. Beachten Sie auch, dass wir die Aktionstasten nicht √§ndern - wie zuvor werden dieselben Zeichen verwendet, um letztere auszuf√ºhren wie in der englischen Sprache (die √ºbrigens nicht in einem anderen Tastaturlayout als dem lateinischen funktioniert, aber das ist nicht unsere Sache - lassen wir es jetzt so wie es ist).</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PropertiesStringLoader</span></span></span></span>(locale: Locale) : StringLoader { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> properties = ResourceBundle.getBundle(<span class="hljs-string"><span class="hljs-string">"text.strings"</span></span>, locale) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = properties.getString(key) ?: <span class="hljs-string"><span class="hljs-string">""</span></span> }</code> </pre>  . <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie bereits erw√§hnt, </font></font><code>ResourceBundle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√ºbernimmt er selbst die Verantwortung, unter den Lokalisierungsdateien diejenige zu finden, die dem aktuellen Gebietsschema am ehesten entspricht. </font><font style="vertical-align: inherit;">Und wenn er es nicht findet, nimmt er die Standarddatei ( </font></font><code>string.properties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Und alles wird gut ...</font></font><br><br><div class="spoiler">  <b class="spoiler_title">Ja!</b> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Da war es!</font></font></b> <div class="spoiler_text"> ,  Unicode   <code>.properties</code>     Java 9.       ISO-8859-1 ‚Äî <code>ResourceBundle</code>     .  ,     ,           ‚Äî     .       Unicode- ‚Äî ,  ,   : <code>'\uXXXX'</code> .    ,      ,   Java       <b>native2ascii</b> ,        .         : <br><br><pre> <code class="plaintext hljs"># Game status messages choose_dice_perform_check=\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u0443\u0431\u0438\u043a\u0438 \u0434\u043b\u044f \u043f\u0440\u043e\u0445\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438: end_of_turn_discard_extra=\u041a\u041e\u041d\u0415\u0426 \u0425\u041e\u0414\u0410: \u0421\u0431\u0440\u043e\u0441\u044c\u0442\u0435 \u043b\u0438\u0448\u043d\u0438\u0435 \u043a\u0443\u0431\u0438\u043a\u0438: end_of_turn_discard_optional=\u041a\u041e\u041d\u0415\u0426 \u0425\u041e\u0414\u0410: \u0421\u0431\u0440\u043e\u0441\u044c\u0442\u0435 \u043a\u0443\u0431\u0438\u043a\u0438 \u043f\u043e \u0436\u0435\u043b\u0430\u043d\u0438\u044e: choose_action_before_exploration=\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435, \u0447\u0442\u043e \u0434\u0435\u043b\u0430\u0442\u044c: choose_action_after_exploration=\u0418\u0441\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u043d\u0438\u0435 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u043e. \u0427\u0442\u043e \u0434\u0435\u043b\u0430\u0442\u044c \u0434\u0430\u043b\u044c\u0448\u0435? encounter_physical=\u0412\u0441\u0442\u0440\u0435\u0447\u0435\u043d \u0424\u0418\u0417\u0418\u0427\u0415\u0421\u041a\u0418\u0419 \u043a\u0443\u0431\u0438\u043a. \u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u0440\u043e\u0439\u0442\u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443. encounter_somatic=\u0412\u0441\u0442\u0440\u0435\u0447\u0435\u043d \u0421\u041e\u041c\u0410\u0422\u0418\u0427\u0415\u0421\u041a\u0418\u0419 \u043a\u0443\u0431\u0438\u043a. \u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u0440\u043e\u0439\u0442\u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443. encounter_mental=\u0412\u0441\u0442\u0440\u0435\u0447\u0435\u043d \u041c\u0415\u041d\u0422\u0410\u041b\u042c\u041d\u042b\u0419 \u043a\u0443\u0431\u0438\u043a. \u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u0440\u043e\u0439\u0442\u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443. encounter_verbal=\u0412\u0441\u0442\u0440\u0435\u0447\u0435\u043d \u0412\u0415\u0420\u0411\u0410\u041b\u042c\u041d\u042b\u0419 \u043a\u0443\u0431\u0438\u043a. \u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u0440\u043e\u0439\u0442\u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443. encounter_divine=\u0412\u0441\u0442\u0440\u0435\u0447\u0435\u043d \u0411\u041e\u0416\u0415\u0421\u0422\u0412\u0415\u041d\u041d\u042b\u0419 \u043a\u0443\u0431\u0438\u043a. \u041c\u043e\u0436\u043d\u043e \u0432\u0437\u044f\u0442\u044c \u0431\u0435\u0437 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438: die_acquire_success=\u0412\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u043b\u0438 \u043d\u043e\u0432\u044b\u0439 \u043a\u0443\u0431\u0438\u043a! die_acquire_failure=\u0412\u0430\u043c \u043d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043a\u0443\u0431\u0438\u043a. game_loss_out_of_time=\u0423 \u0432\u0430\u0441 \u0437\u0430\u043a\u043e\u043d\u0447\u0438\u043b\u043e\u0441\u044c \u0432\u0440\u0435\u043c\u044f</code> </pre><br>           .     ‚Äî  .    ‚Äî  .  ,  IDE    ( )  ¬´ ¬ª,       ‚Äî            -  (  ),    IDE,    . <br><br>  ,  .  <code>getBundle()</code> ,    ,   ,      <code>ResourceBundle.Control</code> ‚Äî -         . <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PropertiesStringLoader</span></span></span></span>(locale: Locale) : StringLoader { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> properties = ResourceBundle.getBundle( <span class="hljs-string"><span class="hljs-string">"text.strings"</span></span>, locale, Utf8ResourceBundleControl()) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = properties.getString(key) ?: <span class="hljs-string"><span class="hljs-string">""</span></span> }</code> </pre><br> , ,  : <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Utf8ResourceBundleControl</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ResourceBundle.Control</span></span></span></span>() { <span class="hljs-meta"><span class="hljs-meta">@Throws(IllegalAccessException::class, InstantiationException::class, IOException::class)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newBundle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(baseName: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, locale: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Locale</span></span></span></span><span class="hljs-function"><span class="hljs-params">, format: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, loader: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ClassLoader</span></span></span></span><span class="hljs-function"><span class="hljs-params">, reload: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ResourceBundle? { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> bundleName = toBundleName(baseName, locale) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (format) { <span class="hljs-string"><span class="hljs-string">"java.class"</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.newBundle(baseName, locale, format, loader, reload) <span class="hljs-string"><span class="hljs-string">"java.properties"</span></span> -&gt; with((<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"://"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> bundleName) <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> toResourceName(bundleName, <span class="hljs-string"><span class="hljs-string">"properties"</span></span>)) ?: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { reload -&gt; reload(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, loader) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; loader.getResourceAsStream(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) }?.let { stream -&gt; InputStreamReader(stream, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>).use { r -&gt; PropertyResourceBundle(r) } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"Unknown format: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$format</span></span></span><span class="hljs-string">"</span></span>) } } <span class="hljs-meta"><span class="hljs-meta">@Throws(IOException::class)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reload</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(resourceName: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, classLoader: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ClassLoader</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: InputStream { classLoader.getResource(resourceName)?.let { url -&gt; url.openConnection().let { connection -&gt; connection.useCaches = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> connection.getInputStream() } } <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IOException(<span class="hljs-string"><span class="hljs-string">"Unable to load data!"</span></span>) } }</code> </pre><br>    ,   ‚Ä¶ ,  ( ) ‚Äî   (  Kotlin    ).    ‚Äî ,       <code>.properties</code>   UTF-8  - . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Um den Betrieb der Anwendung in verschiedenen Sprachen zu testen, m√ºssen Sie die Einstellungen des Betriebssystems nicht √§ndern. Geben Sie beim Starten der JRE lediglich die erforderliche Sprache an: </font></font><br><br><pre> <code class="dos hljs">java -Duser.language=ru -jar path_to_project\Dice\target\dice-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>-jar-with-dependencies.jar</code> </pre><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie noch unter Windows arbeiten, erwarten Sie Probleme</font></font></b> <div class="spoiler_text">  ,   Windows (cmd.exe)     437 (   DOSLatinUS),     ‚Äî      .  , UTF-8 ,        : <br><br><pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">chcp</span></span> <span class="hljs-number"><span class="hljs-number">65001</span></span></code> </pre> <br>    Java  ,    ,       .     : <br><br><pre> <code class="dos hljs">java -Dfile.encoding=UTF-<span class="hljs-number"><span class="hljs-number">8</span></span> -Duser.language=ru -jar path_to_project\Dice\target\dice-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>-jar-with-dependencies.jar</code> </pre><br>   ,      ,  Unicode- (, Lucida Console) <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nach all unseren aufregenden Abenteuern kann das Ergebnis der √ñffentlichkeit stolz demonstriert und laut erkl√§rt werden: ‚ÄûWir sind keine Hunde!‚Äú </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rassengetreue Option</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/ap/92/qd/ap92qdlfulptfgjg_-ms3ejqddm.png"></a> <br></div></div><br>  Und das ist gut. <br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schritt 13 </font><font style="vertical-align: inherit;">Alles zusammenf√ºgen</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aufmerksame Leser m√ºssen bemerkt haben, dass ich die Namen bestimmter Pakete nur einmal erw√§hnt habe und nie zu ihnen zur√ºckgekehrt bin. Erstens hat jeder Entwickler seine eigenen √úberlegungen, welche Klasse sich in welchem ‚Äã‚ÄãPaket befinden soll. Zweitens werden sich Ihre Gedanken √§ndern, wenn Sie an dem Projekt arbeiten und immer mehr neue Klassen hinzuf√ºgen. Drittens ist das √Ñndern der Struktur der Anwendung einfach und kosteng√ºnstig (und moderne Versionskontrollsysteme erkennen die Migration, sodass Sie nicht den Verlauf verlieren). Sie k√∂nnen also die Namen von Klassen, Paketen, Methoden und Variablen √§ndern. Vergessen Sie nicht, nur die Dokumentation zu aktualisieren (Sie behalten sie) richtig?). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und alles, was uns bleibt, ist, unser Projekt zusammenzustellen und zu starten. Wie Sie sich erinnern, haben </font></font><code>main()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wir bereits eine </font><font style="vertical-align: inherit;">Methode erstellt </font><font style="vertical-align: inherit;">, die wir jetzt mit Inhalten f√ºllen werden.</font></font> Wir werden brauchen: <br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Drehbuch und Terrain; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Helden </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schnittstellenimplementierung </font></font><code>GameInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementierung von Schnittstellen </font></font><code>GameRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>StringLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementierung von Schnittstellen </font></font><code>SoundPlayer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>MusicPlayer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klassenobjekt </font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine Flasche Champagner. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lass uns gehen! </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(args: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Array</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { Audio.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(BasicSoundPlayer(), BasicMusicPlayer()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> loader = PropertiesStringLoader(Locale.getDefault()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> renderer = ConsoleGameRenderer(loader) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> interactor = ConsoleGameInteractor() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> template = TestScenarioTemplate() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> scenario = generateScenario(template, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> locations = generateLocations(template, <span class="hljs-number"><span class="hljs-number">1</span></span>, heroes.size) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> heroes = listOf( generateHero(Hero.Type.BRAWLER, <span class="hljs-string"><span class="hljs-string">"Brawler"</span></span>), generateHero(Hero.Type.HUNTER, <span class="hljs-string"><span class="hljs-string">"Hunter"</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> game = Game(renderer, interactor, scenario, locations, heroes) game.start() }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir starten und genie√üen den ersten funktionierenden Prototyp. </font><font style="vertical-align: inherit;">Los geht's.</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schritt vierzehn. </font><font style="vertical-align: inherit;">Spielbalance</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ummm ... </font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schritt f√ºnfzehn.</font></font></font>  <font color="#0474a0">Tests</font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachdem der Gro√üteil des Codes f√ºr den ersten funktionierenden Prototyp geschrieben wurde, w√§re es sch√∂n, ein paar Komponententests hinzuzuf√ºgen ... </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Wie? </font><font style="vertical-align: inherit;">Nur jetzt? </font><font style="vertical-align: inherit;">Ja, Tests mussten ganz am Anfang geschrieben werden und dann Code! ‚Äú </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Viele Leser bemerken zu Recht, dass das Schreiben von Komponententests der Entwicklung von </font><abbr title="Test-Driven Development"><font style="vertical-align: inherit;">Arbeitscode</font></abbr><font style="vertical-align: inherit;"> ( </font><abbr title="Test-Driven Development"><font style="vertical-align: inherit;">TDD)</font></abbr><font style="vertical-align: inherit;"> vorausgehen sollte</font></font><abbr title="Test-Driven Development"><font style="vertical-align: inherit;"></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und andere modische Methoden). Andere werden emp√∂rt sein: Es gibt nichts f√ºr Menschen, die ihr Gehirn mit ihren Tests t√§uschen k√∂nnten, selbst wenn sie zumindest anfangen, etwas zu entwickeln, sonst geht jede Motivation verloren. Ein paar andere Leute kriechen aus der L√ºcke im Baseboard und sagen sch√ºchtern: "Ich verstehe nicht, warum diese Tests ben√∂tigt werden - alles funktioniert f√ºr mich" ... Dann werden sie mit einem Stiefel ins Gesicht gedr√ºckt und schnell zur√ºckgeschoben. Ich werde nicht anfangen, ideologische Konfrontationen zu initiieren (sie sind bereits im Internet voll davon), und deshalb stimme ich teilweise allen zu. Ja, Tests sind manchmal n√ºtzlich (insbesondere bei Code, der sich h√§ufig √§ndert oder mit komplexen Berechnungen verbunden ist). Ja, Unit-Tests sind nicht f√ºr den gesamten Code geeignet (z. B. werden Interaktionen mit dem Benutzer oder externen Systemen nicht abgedeckt). Ja, neben Unit-Tests gibt es diese viele andere Arten davon (naja, mindestens f√ºnf wurden benannt),und ja, wir werden uns nicht darauf konzentrieren, Tests zu schreiben - unser Artikel handelt von etwas anderem.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sagen wir einfach: Viele Programmierer (insbesondere Anf√§nger) vernachl√§ssigen Tests. </font><font style="vertical-align: inherit;">Viele begr√ºnden sich damit, dass die Funktionalit√§t ihrer Anwendungen durch Tests nur unzureichend abgedeckt wird. </font><font style="vertical-align: inherit;">Zum Beispiel ist es viel einfacher, die Anwendung zu starten und zu pr√ºfen, ob alles in Ordnung mit dem Erscheinungsbild und der Interaktion ist, als komplexe Konstruktionen unter Beteiligung spezieller Frameworks zum Testen der Benutzeroberfl√§che (und solcher) zu fechten. </font><font style="vertical-align: inherit;">Und ich werde Ihnen sagen, wann ich die Schnittstellen implementiert habe </font></font><code>Renderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- genau das habe ich getan. </font><font style="vertical-align: inherit;">Es gibt jedoch Methoden in unserem Code, f√ºr die das Konzept des Unit-Tests gro√üartig ist.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zum Beispiel Generatoren. </font><font style="vertical-align: inherit;">Und das ist alles. </font><font style="vertical-align: inherit;">Dies ist eine ideale Black Box: Vorlagen werden an die Eingabe gesendet, Objekte der Spielwelt werden an der Ausgabe abgerufen. </font><font style="vertical-align: inherit;">Im Inneren ist etwas los, aber wir m√ºssen es testen. </font><font style="vertical-align: inherit;">Zum Beispiel so:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DieGeneratorTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testGetMaxLevel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ assertEquals(<span class="hljs-string"><span class="hljs-string">"Max level should be 3"</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, DieGeneratorKt.getMaxLevel()); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testDieGenerationSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ DieTypeFilter filter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SingleDieTypeFilter(Die.Type.ALLY); List&lt;? extends List&lt;Integer&gt;&gt; allowedSizes = Arrays.asList( <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, Arrays.asList(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>), Arrays.asList(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), Arrays.asList(<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>) ); IntStream.rangeClosed(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>).forEach(level -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size = DieGeneratorKt.generateDie(filter, level).getSize(); assertTrue(<span class="hljs-string"><span class="hljs-string">"Incorrect level of die generated: "</span></span> + size, allowedSizes.get(level).contains(size)); assertTrue(<span class="hljs-string"><span class="hljs-string">"Incorrect die size: "</span></span> + size, size &gt;= <span class="hljs-number"><span class="hljs-number">4</span></span>); assertTrue(<span class="hljs-string"><span class="hljs-string">"Incorrect die size: "</span></span> + size, size &lt;= <span class="hljs-number"><span class="hljs-number">12</span></span>); assertTrue(<span class="hljs-string"><span class="hljs-string">"Incorrect die size: "</span></span> + size, size % <span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>); } }); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testDieGenerationType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ List&lt;Die.Type&gt; allowedTypes1 = Arrays.asList(Die.Type.PHYSICAL); List&lt;Die.Type&gt; allowedTypes2 = Arrays.asList(Die.Type.PHYSICAL, Die.Type.SOMATIC, Die.Type.MENTAL, Die.Type.VERBAL); List&lt;Die.Type&gt; allowedTypes3 = Arrays.asList(Die.Type.ALLY, Die.Type.VILLAIN, Die.Type.ENEMY); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; i++) { Die.Type type1 = DieGeneratorKt.generateDie(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SingleDieTypeFilter(Die.Type.PHYSICAL), <span class="hljs-number"><span class="hljs-number">1</span></span>).getType(); assertTrue(<span class="hljs-string"><span class="hljs-string">"Incorrect die type: "</span></span> + type1, allowedTypes1.contains(type1)); Die.Type type2 = DieGeneratorKt.generateDie(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StatsDieTypeFilter(), <span class="hljs-number"><span class="hljs-number">1</span></span>).getType(); assertTrue(<span class="hljs-string"><span class="hljs-string">"Incorrect die type: "</span></span> + type2, allowedTypes2.contains(type2)); Die.Type type3 = DieGeneratorKt.generateDie(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MultipleDieTypeFilter(Die.Type.ALLY, Die.Type.VILLAIN, Die.Type.ENEMY), <span class="hljs-number"><span class="hljs-number">1</span></span>).getType(); assertTrue(<span class="hljs-string"><span class="hljs-string">"Incorrect die type: "</span></span> + type3, allowedTypes3.contains(type3)); } } }</code> </pre><br>  Oder so: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BagGeneratorTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testGenerateBag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ BagTemplate template1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BagTemplate(); template1.addPlan(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SingleDieTypeFilter(Die.Type.PHYSICAL)); template1.addPlan(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SingleDieTypeFilter(Die.Type.SOMATIC)); template1.setFixedDieCount(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); BagTemplate template2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BagTemplate(); template2.addPlan(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SingleDieTypeFilter(Die.Type.DIVINE)); template2.setFixedDieCount(<span class="hljs-number"><span class="hljs-number">5</span></span>); BagTemplate template3 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BagTemplate(); template3.addPlan(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SingleDieTypeFilter(Die.Type.ALLY)); template3.setFixedDieCount(<span class="hljs-number"><span class="hljs-number">50</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; i++) { Bag bag1 = BagGeneratorKt.generateBag(template1, <span class="hljs-number"><span class="hljs-number">1</span></span>); assertTrue(<span class="hljs-string"><span class="hljs-string">"Incorrect bag size: "</span></span> + bag1.getSize(), bag1.getSize() &gt;= <span class="hljs-number"><span class="hljs-number">5</span></span> &amp;&amp; bag1.getSize() &lt;= <span class="hljs-number"><span class="hljs-number">15</span></span>); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect number of SOMATIC dice"</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, bag1.examine().stream().filter(d -&gt; d.getType() == Die.Type.SOMATIC).count()); Bag bag2 = BagGeneratorKt.generateBag(template2, <span class="hljs-number"><span class="hljs-number">1</span></span>); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect bag size"</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, bag2.getSize()); Bag bag3 = BagGeneratorKt.generateBag(template3, <span class="hljs-number"><span class="hljs-number">1</span></span>); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect bag size"</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, bag3.getSize()); List&lt;Die.Type&gt; dieTypes3 = bag3.examine().stream().map(Die::getType).distinct().collect(Collectors.toList()); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect die types"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, dieTypes3.size()); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect die types"</span></span>, Die.Type.ALLY, dieTypes3.get(<span class="hljs-number"><span class="hljs-number">0</span></span>)); } } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Oder sogar so: </font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LocationGeneratorTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testLocationGeneration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name, LocationTemplate template)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-string"><span class="hljs-string">"Template: "</span></span> + template.getName()); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect template type"</span></span>, name, template.getName()); IntStream.rangeClosed(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>).forEach(level -&gt; { Location location = LocationGeneratorKt.generateLocation(template, level); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect location type"</span></span>, name, location.getName().get(<span class="hljs-string"><span class="hljs-string">""</span></span>)); assertTrue(<span class="hljs-string"><span class="hljs-string">"Location not open by default"</span></span>, location.isOpen()); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> closingDifficulty = location.getClosingDifficulty(); assertTrue(<span class="hljs-string"><span class="hljs-string">"Closing difficulty too small"</span></span>, closingDifficulty &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect closing difficulty"</span></span>, closingDifficulty, template.getBasicClosingDifficulty() + level * <span class="hljs-number"><span class="hljs-number">2</span></span>); Bag bag = location.getBag(); assertNotNull(<span class="hljs-string"><span class="hljs-string">"Bag is null"</span></span>, bag); assertTrue(<span class="hljs-string"><span class="hljs-string">"Bag is empty"</span></span>, location.getBag().getSize() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>); Deck&lt;Enemy&gt; enemies = location.getEnemies(); assertNotNull(<span class="hljs-string"><span class="hljs-string">"Enemies are null"</span></span>, enemies); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect enemy threat count"</span></span>, enemies.getSize(), template.getEnemyCardsCount()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bag.drawOfType(Die.Type.ENEMY) != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { assertTrue(<span class="hljs-string"><span class="hljs-string">"Enemy cards not specified"</span></span>, enemies.getSize() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>); } Deck&lt;Obstacle&gt; obstacles = location.getObstacles(); assertNotNull(<span class="hljs-string"><span class="hljs-string">"Obstacles are null"</span></span>, obstacles); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect obstacle threat count"</span></span>, obstacles.getSize(), template.getObstacleCardsCount()); List&lt;SpecialRule&gt; specialRules = location.getSpecialRules(); assertNotNull(<span class="hljs-string"><span class="hljs-string">"SpecialRules are null"</span></span>, specialRules); }); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testGenerateLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ testLocationGeneration(<span class="hljs-string"><span class="hljs-string">"Test Location"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TestLocationTemplate()); testLocationGeneration(<span class="hljs-string"><span class="hljs-string">"Test Location 2"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TestLocationTemplate2()); } }</code> </pre><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Halt, h√∂r auf, h√∂r auf!" </font><font style="vertical-align: inherit;">Was ist das? </font><font style="vertical-align: inherit;">Java ??? " </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Du hast es verstanden. </font><font style="vertical-align: inherit;">Dar√ºber hinaus ist es gut, solche Tests zu Beginn zu schreiben, bevor Sie mit der Implementierung des Generators selbst beginnen. </font><font style="vertical-align: inherit;">Nat√ºrlich ist der zu testende Code recht einfach und h√∂chstwahrscheinlich funktioniert die Methode beim ersten Mal und ohne Tests. </font><font style="vertical-align: inherit;">Wenn </font><font style="vertical-align: inherit;">Sie jedoch einen Test schreiben, wenn Sie </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ihn f√ºr immer vergessen,</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sch√ºtzen Sie sich vor m√∂glichen Problemen in der Zukunft (deren L√∂sung viel Zeit in Anspruch nimmt, insbesondere ab dem Moment der Entwicklung F√ºnf Jahre sind vergangen und Sie haben bereits vergessen, wie alles in der Methode dort funktioniert. </font><font style="vertical-align: inherit;">Und wenn Ihr Projekt eines Tages pl√∂tzlich aufgrund fehlgeschlagener Tests nicht mehr erfasst wird, wissen Sie definitiv den Grund: Die Anforderungen an das System haben sich ge√§ndert und Ihre alten Tests erf√ºllen sie nicht mehr (woran haben Sie gedacht?).</font></font><br><br>  Und noch etwas.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erinnerst </font></font><code>HandMaskRule</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">du </font><font style="vertical-align: inherit;">dich an die Klasse </font><font style="vertical-align: inherit;">und ihre Erben? Stellen Sie sich nun vor, dass der Held irgendwann drei W√ºrfel aus seiner Hand nehmen muss, um die F√§higkeit zu nutzen, und die Arten dieser W√ºrfel unterliegen strengen Einschr√§nkungen (zum Beispiel: ‚ÄûDie ersten W√ºrfel m√ºssen blau, gr√ºn oder wei√ü sein, die zweiten - gelb, wei√ü oder blau, und der dritte - blau oder lila "- f√ºhlst du die Schwierigkeit?). Wie gehe ich mit der Klassenimplementierung um? Nun ... f√ºr den Anfang k√∂nnen Sie die Eingabe- und Ausgabeparameter festlegen. Offensichtlich muss die Klasse drei Arrays (oder Mengen) akzeptieren, von denen jedes g√ºltige Typen f√ºr den ersten, zweiten und dritten W√ºrfel enth√§lt.</font></font> Und was dann?<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Busting? </font><font style="vertical-align: inherit;">Rekursionen? </font><font style="vertical-align: inherit;">Was ist, wenn ich etwas vermisse? </font><font style="vertical-align: inherit;">Machen Sie einen tiefen Eingang. </font><font style="vertical-align: inherit;">Verschieben Sie nun die Implementierung von Klassenmethoden und schreiben Sie einen Test - da die Anforderungen einfach, verst√§ndlich und gut formalisierbar sind. </font><font style="vertical-align: inherit;">Und schreiben Sie besser einige Tests ... Aber wir werden einen betrachten, hier zum Beispiel:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TripleDieHandMaskRuleTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Hand hand; <span class="hljs-meta"><span class="hljs-meta">@Before</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ hand = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Hand(<span class="hljs-number"><span class="hljs-number">10</span></span>); hand.addDie(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Die(Die.Type.PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>)); <span class="hljs-comment"><span class="hljs-comment">//0 hand.addDie(new Die(Die.Type.PHYSICAL, 4)); //1 hand.addDie(new Die(Die.Type.SOMATIC, 4)); //2 hand.addDie(new Die(Die.Type.SOMATIC, 4)); //3 hand.addDie(new Die(Die.Type.MENTAL, 4)); //4 hand.addDie(new Die(Die.Type.MENTAL, 4)); //5 hand.addDie(new Die(Die.Type.VERBAL, 4)); //6 hand.addDie(new Die(Die.Type.VERBAL, 4)); //7 hand.addDie(new Die(Die.Type.DIVINE, 4)); //8 hand.addDie(new Die(Die.Type.DIVINE, 4)); //9 hand.addDie(new Die(Die.Type.ALLY, 4)); //A (0) hand.addDie(new Die(Die.Type.ALLY, 4)); //B (1) } @Test public void testRule1() { HandMaskRule rule = new TripleDieHandMaskRule( hand, new Die.Type[]{Die.Type.PHYSICAL, Die.Type.SOMATIC}, new Die.Type[]{Die.Type.MENTAL, Die.Type.VERBAL}, new Die.Type[]{Die.Type.PHYSICAL, Die.Type.ALLY} ); HandMask mask = new HandMask(); assertTrue("Ally should be on", rule.isAllyPositionActive(mask, 0)); assertTrue("Ally should be on", rule.isAllyPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 0)); assertTrue("Should be on", rule.isPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 2)); assertTrue("Should be on", rule.isPositionActive(mask, 3)); assertTrue("Should be on", rule.isPositionActive(mask, 4)); assertTrue("Should be on", rule.isPositionActive(mask, 5)); assertTrue("Should be on", rule.isPositionActive(mask, 6)); assertTrue("Should be on", rule.isPositionActive(mask, 7)); assertFalse("Should be off", rule.isPositionActive(mask, 8)); assertFalse("Should be off", rule.isPositionActive(mask, 9)); assertFalse("Rule should not be met yet", rule.checkMask(mask)); mask.addPosition(0); assertTrue("Ally should be on", rule.isAllyPositionActive(mask, 0)); assertTrue("Ally should be on", rule.isAllyPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 0)); assertTrue("Should be on", rule.isPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 2)); assertTrue("Should be on", rule.isPositionActive(mask, 3)); assertTrue("Should be on", rule.isPositionActive(mask, 4)); assertTrue("Should be on", rule.isPositionActive(mask, 5)); assertTrue("Should be on", rule.isPositionActive(mask, 6)); assertTrue("Should be on", rule.isPositionActive(mask, 7)); assertFalse("Should be off", rule.isPositionActive(mask, 8)); assertFalse("Should be off", rule.isPositionActive(mask, 9)); assertFalse("Rule should not be met yet", rule.checkMask(mask)); mask.addPosition(4); assertTrue("Ally should be on", rule.isAllyPositionActive(mask, 0)); assertTrue("Ally should be on", rule.isAllyPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 0)); assertTrue("Should be on", rule.isPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 2)); assertTrue("Should be on", rule.isPositionActive(mask, 3)); assertTrue("Should be on", rule.isPositionActive(mask, 4)); assertFalse("Should be off", rule.isPositionActive(mask, 5)); assertFalse("Should be off", rule.isPositionActive(mask, 6)); assertFalse("Should be off", rule.isPositionActive(mask, 7)); assertFalse("Should be off", rule.isPositionActive(mask, 8)); assertFalse("Should be off", rule.isPositionActive(mask, 9)); assertFalse("Rule should not be met yet", rule.checkMask(mask)); mask.addAllyPosition(0); assertTrue("Ally should be on", rule.isAllyPositionActive(mask, 0)); assertFalse("Ally should be off", rule.isAllyPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 0)); assertFalse("Should be off", rule.isPositionActive(mask, 1)); assertFalse("Should be off", rule.isPositionActive(mask, 2)); assertFalse("Should be off", rule.isPositionActive(mask, 3)); assertTrue("Should be on", rule.isPositionActive(mask, 4)); assertFalse("Should be off", rule.isPositionActive(mask, 5)); assertFalse("Should be off", rule.isPositionActive(mask, 6)); assertFalse("Should be off", rule.isPositionActive(mask, 7)); assertFalse("Should be off", rule.isPositionActive(mask, 8)); assertFalse("Should be off", rule.isPositionActive(mask, 9)); assertTrue("Rule should be met", rule.checkMask(mask)); mask.removePosition(0); assertTrue("Ally should be on", rule.isAllyPositionActive(mask, 0)); assertFalse("Ally should be off", rule.isAllyPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 0)); assertTrue("Should be on", rule.isPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 2)); assertTrue("Should be on", rule.isPositionActive(mask, 3)); assertTrue("Should be on", rule.isPositionActive(mask, 4)); assertFalse("Should be off", rule.isPositionActive(mask, 5)); assertFalse("Should be off", rule.isPositionActive(mask, 6)); assertFalse("Should be off", rule.isPositionActive(mask, 7)); assertFalse("Should be off", rule.isPositionActive(mask, 8)); assertFalse("Should be off", rule.isPositionActive(mask, 9)); assertFalse("Rule should not be met again", rule.checkMask(mask)); } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das ist anstrengend, aber nicht so sehr, wie es scheint, bis Sie anfangen (irgendwann macht es sogar Spa√ü). </font><font style="vertical-align: inherit;">Aber wenn Sie einen solchen Test (und einige andere zu verschiedenen Anl√§ssen) geschrieben haben, werden Sie sich pl√∂tzlich ruhig und selbstbewusst f√ºhlen. </font><font style="vertical-align: inherit;">Jetzt wird kein kleiner Tippfehler Ihre Methode verderben und zu unangenehmen √úberraschungen f√ºhren, die viel schwieriger manuell zu testen sind. </font><font style="vertical-align: inherit;">Nach und nach beginnen wir langsam, die notwendigen Methoden der Klasse zu implementieren. </font><font style="vertical-align: inherit;">Und am Ende f√ºhren wir den Test durch, um sicherzustellen, dass wir irgendwo einen Fehler gemacht haben. </font><font style="vertical-align: inherit;">Finden Sie den Problempunkt und schreiben Sie ihn neu. </font><font style="vertical-align: inherit;">Wiederholen, bis fertig.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TripleDieHandMaskRule</span></span></span></span>( hand: Hand, types1: Array&lt;Die.Type&gt;, types2: Array&lt;Die.Type&gt;, types3: Array&lt;Die.Type&gt;) : HandMaskRule(hand) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> types1 = types1.toSet() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> types2 = types2.toSet() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> types3 = types3.toSet() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mask.positionCount + mask.allyPositionCount != <span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getCheckedDice(mask).asSequence() .filter { it.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 } .any { d1 -&gt; getCheckedDice(mask) .filter { d2 -&gt; d2 !== d1 } .filter { it.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 } .any { d2 -&gt; getCheckedDice(mask) .filter { d3 -&gt; d3 !== d1 } .filter { d3 -&gt; d3 !== d2 } .any { it.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 } } } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPositionActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mask.checkPosition(position)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> die = hand.dieAt(position) ?: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (mask.positionCount + mask.allyPositionCount) { <span class="hljs-number"><span class="hljs-number">0</span></span> -&gt; die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 || die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 || die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 <span class="hljs-number"><span class="hljs-number">1</span></span> -&gt; with(getCheckedDice(mask).first()) { (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; (die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 || die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3)) || (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; (die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 || die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3)) || (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; (die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 || die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2)) } <span class="hljs-number"><span class="hljs-number">2</span></span>-&gt; with(getCheckedDice(mask)) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> d1 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> d2 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-number"><span class="hljs-number">1</span></span>] (d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3) || (d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3) || (d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2) || (d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2) || (d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1) || (d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1) } <span class="hljs-number"><span class="hljs-number">3</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isAllyPositionActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mask.checkAllyPosition(position)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hand.allyDieAt(position) == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (mask.positionCount + mask.allyPositionCount) { <span class="hljs-number"><span class="hljs-number">0</span></span> -&gt; ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 || ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 || ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 <span class="hljs-number"><span class="hljs-number">1</span></span> -&gt; with(getCheckedDice(mask).first()) { (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; (ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 || ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3)) || (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; (ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 || ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3)) || (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; (ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 || ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2)) } <span class="hljs-number"><span class="hljs-number">2</span></span>-&gt; with(getCheckedDice(mask)) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> d1 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> d2 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-number"><span class="hljs-number">1</span></span>] (d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3) || (d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3) || (d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2) || (d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2) || (d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1) || (d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1) } <span class="hljs-number"><span class="hljs-number">3</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> } } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie Ideen haben, wie Sie solche Funktionen einfacher implementieren k√∂nnen, k√∂nnen Sie dies gerne kommentieren. </font><font style="vertical-align: inherit;">Und ich bin unglaublich froh, dass ich klug genug war, diese Klasse mit dem Schreiben eines Tests zu implementieren. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄûUnd ich &lt;...&gt; bin auch &lt;...&gt; sehr &lt;...&gt; froh &lt;...&gt;. </font><font style="vertical-align: inherit;">Steig ein! </font><font style="vertical-align: inherit;">&lt;...&gt; zur√ºck! </font><font style="vertical-align: inherit;">&lt;...&gt; in die L√ºcke! "</font></font></i> <br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schritt sechzehn. </font><font style="vertical-align: inherit;">Modularit√§t</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie erwartet k√∂nnen reife Kinder nicht ihr ganzes Leben lang im Schutz ihrer Eltern sein - fr√ºher oder sp√§ter m√ºssen sie ihren eigenen Weg w√§hlen und ihm mutig folgen, um Schwierigkeiten und St√∂rungen zu √ºberwinden. </font><font style="vertical-align: inherit;">So reiften die von uns entwickelten Komponenten so stark, dass sie unter einem Dach eng wurden. </font><font style="vertical-align: inherit;">Es ist an der Zeit, sie in mehrere Teile zu teilen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir stehen vor einer eher trivialen Aufgabe. </font><font style="vertical-align: inherit;">Es ist notwendig, alle bisher erstellten Klassen in drei Gruppen zu unterteilen:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grundfunktionalit√§t: Modul, Game Engine, Connector-Schnittstellen und plattformunabh√§ngige Implementierungen ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kern</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> );</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vorlagen von Szenarien, Gel√§nde, Feinden und Hindernissen - Bestandteile des sogenannten "Abenteuers" ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abenteuers</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> );</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">spezifische Implementierungen von Schnittstellen, die f√ºr eine bestimmte Plattform spezifisch sind: in unserem Fall eine Konsolenanwendung ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cli</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Das Ergebnis dieser Trennung sieht letztendlich wie folgt aus: </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie die Schauspieler am Ende der Show treten unsere heutigen Helden mit voller Wucht wieder in die Szene ein</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/ci/t5/gm/cit5gmpnmhdsrzoprl0fagpzpw8.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen Sie zus√§tzliche Projekte und √ºbertragen Sie die entsprechende Klasse. </font><font style="vertical-align: inherit;">Und wir m√ºssen nur die Interaktion von Projekten untereinander richtig konfigurieren. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kernprojekt</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dieses Projekt ist ein reiner Motor. </font><font style="vertical-align: inherit;">Alle spezifischen Klassen wurden auf andere Projekte √ºbertragen - nur die Grundfunktionalit√§t, der Kern, blieb √ºbrig. </font><font style="vertical-align: inherit;">Bibliothek, wenn Sie wollen. </font><font style="vertical-align: inherit;">Es gibt keine Startklasse mehr, es muss nicht einmal ein Paket erstellt werden. </font><font style="vertical-align: inherit;">Assemblies dieses Projekts werden im lokalen Maven-Repository gehostet (dazu sp√§ter mehr) und von anderen Projekten als Abh√§ngigkeiten verwendet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Datei </font></font><code>pom.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lautet wie folgt:</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span>4.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>my.company<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>dice-core<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span>jar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>kotlin-stdlib<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${kotlin.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>junit<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>junit-dep<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>4.8.2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>test<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- other Kotlin setup --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project.build.sourceEncoding</span></span></span><span class="hljs-tag">&gt;</span></span>UTF-8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project.build.sourceEncoding</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.source</span></span></span><span class="hljs-tag">&gt;</span></span>1.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.source</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.target</span></span></span><span class="hljs-tag">&gt;</span></span>1.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.target</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.version</span></span></span><span class="hljs-tag">&gt;</span></span>1.3.20<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.compiler.incremental</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.compiler.incremental</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Von nun an werden wir es so sammeln: </font></font><br><br><pre> <code class="bash hljs">mvn -f <span class="hljs-string"><span class="hljs-string">"path_to_project/DiceCore/pom.xml"</span></span> install</code> </pre><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cli-Projekt</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hier ist der Einstiegspunkt in die Anwendung - mit diesem Projekt interagiert der Endbenutzer. </font><font style="vertical-align: inherit;">Der Kernel wird als Abh√§ngigkeit verwendet. </font><font style="vertical-align: inherit;">Da wir in unserem Beispiel mit der Konsole arbeiten, enth√§lt das Projekt die f√ºr die Arbeit erforderlichen Klassen (wenn wir das Spiel pl√∂tzlich auf einer Kaffeemaschine starten m√∂chten, ersetzen wir dieses Projekt einfach durch ein √§hnliches mit den entsprechenden Implementierungen). </font><font style="vertical-align: inherit;">Wir werden sofort Ressourcen (Zeilen, Audiodateien usw.) hinzuf√ºgen. </font><font style="vertical-align: inherit;">Abh√§ngigkeiten von externen Bibliotheken werden in die </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datei √ºbertragen </font></font><code>pom.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span>4.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>my.company<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>dice-cli<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span>jar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>kotlin-stdlib<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${kotlin.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>my.company<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>dice-core<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.fusesource.jansi<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jansi<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.17.1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>jline<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jline<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.14.6<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.googlecode.soundlibs<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jlayer<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0.1.4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- other Kotlin setup --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>maven-assembly-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.6<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>package<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>single<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">descriptorRefs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">descriptorRef</span></span></span><span class="hljs-tag">&gt;</span></span>jar-with-dependencies<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">descriptorRef</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">descriptorRefs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mainClass</span></span></span><span class="hljs-tag">&gt;</span></span>my.company.dice.MainKt<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mainClass</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project.build.sourceEncoding</span></span></span><span class="hljs-tag">&gt;</span></span>UTF-8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project.build.sourceEncoding</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.source</span></span></span><span class="hljs-tag">&gt;</span></span>1.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.source</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.target</span></span></span><span class="hljs-tag">&gt;</span></span>1.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.target</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.version</span></span></span><span class="hljs-tag">&gt;</span></span>1.3.20<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.compiler.incremental</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.compiler.incremental</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wir haben bereits das Skript zum Erstellen und Ausf√ºhren dieses Projekts gesehen - wir werden es nicht wiederholen. </font></font><br><br>  <b>Abenteuer</b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nun, schlie√ülich nehmen wir in einem separaten Projekt die Handlung heraus. Das hei√üt, alle Szenarien, Gel√§nde, Feinde und andere einzigartige Objekte der Spielwelt, die sich die Mitarbeiter der Szenarioabteilung Ihres Unternehmens vorstellen k√∂nnen (oder bislang nur unsere eigene kranke Vorstellungskraft - wir sind immer noch der einzige Spieledesigner in der Region). Die Idee ist, die Skripte in Sets (Abenteuer) zu gruppieren und jedes Set als separates Projekt zu verteilen (√§hnlich wie in der Welt der Brettspiele und Videospiele). Sammeln Sie also JAR-Archive und legen Sie sie in einem separaten Ordner ab, damit die Game Engine diesen Ordner scannt und automatisch alle dort enthaltenen Abenteuer verbindet. Die technische Umsetzung dieses Ansatzes ist jedoch mit enormen Schwierigkeiten verbunden.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wo soll ich anfangen? Nun, erstens aufgrund der Tatsache, dass wir Vorlagen in Form spezifischer Java-Klassen verteilen (ja, schlagen Sie mich und schelten Sie mich - ich habe das vorausgesehen). In diesem Fall sollten sich diese Klassen beim Start im Klassenpfad der Anwendung befinden. Die Durchsetzung dieser Anforderung ist nicht schwierig - Sie registrieren Ihre JAR-Dateien explizit in der entsprechenden Umgebungsvariablen (ab Java 6 k√∂nnen Sie sogar * - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Platzhalter verwenden</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br><br><pre> <code class="bash hljs">java -classpath <span class="hljs-string"><span class="hljs-string">"path_to_project/DiceCli/target/adventures/*"</span></span> -jar path_to_project/DiceCli/target/dice-1.0-jar-with-dependencies.jar</code> </pre><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄûEin Idiot, oder was? Bei Verwendung des Schalters -jar wird der Schalter -classpath ignoriert! ‚Äù</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dies wird jedoch nicht funktionieren. Der Klassenpfad f√ºr ausf√ºhrbare JAR-Archive muss explizit in die interne Datei geschrieben werden </font></font><code>META-INF/MANIFEST.MF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(der Abschnitt hei√üt - </font></font><code>Claspath:</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). Es ist okay, es gibt sogar spezielle Plugins daf√ºr ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maven-Compiler-Plugin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oder im schlimmsten </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fall Maven-Assembly-Plugin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Aber die Platzhalter im Manifest funktionieren leider nicht - Sie m√ºssen die Namen der abh√§ngigen JAR-Dateien explizit angeben. Das hei√üt, sie im Voraus zu kennen, was in unserem Fall problematisch ist. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und das wollte ich sowieso nicht. Ich wollte, dass das Projekt nicht neu kompiliert werden muss. Zum Ordner</font></font><code>adventures/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie k√∂nnen eine beliebige Anzahl von Abenteuern werfen, sodass alle w√§hrend der Ausf√ºhrung f√ºr die Spiel-Engine sichtbar sind. </font><font style="vertical-align: inherit;">Leider geht die scheinbar offensichtliche Funktionalit√§t √ºber die Standarddarstellungen der Java-Welt hinaus. </font><font style="vertical-align: inherit;">Daher ist es nicht erw√ºnscht. </font><font style="vertical-align: inherit;">Ein anderer Ansatz muss gew√§hlt werden, um unabh√§ngige Abenteuer zu verbreiten. </font><font style="vertical-align: inherit;">Welches? </font><font style="vertical-align: inherit;">Ich wei√ü nicht, schreibe in die Kommentare - sicher hat jemand kluge Ideen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In der Zwischenzeit gibt es keine Ideen. Hier ist ein kleiner (oder gro√üer, je nach Aussehen) Trick, mit dem Sie dem Klassenpfad dynamisch Abh√§ngigkeiten hinzuf√ºgen k√∂nnen, ohne deren Namen zu kennen und ohne das Projekt neu kompilieren zu m√ºssen: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In Windows:</font></font><br><br><pre> <code class="dos hljs">@<span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> OFF <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> "path_to_maven\mvn.bat" -f "path_to_project\DiceCore\pom.xml" install <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> "path_to_maven\mvn.bat" -f "path_to_project\DiceCli\pom.xml" package <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> "path_to_maven\mvn.bat" -f "path_to_project\TestAdventure\pom.xml" package <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> path_to_project\DiceCli\target\adventures <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> "path_to_project\TestAdventure\target\test-adventure-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.jar" path_to_project\DiceCli\target\adventures\ <span class="hljs-built_in"><span class="hljs-built_in">chcp</span></span> <span class="hljs-number"><span class="hljs-number">65001</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> path_to_project\DiceCli\target\ java -Dfile.encoding=UTF-<span class="hljs-number"><span class="hljs-number">8</span></span> -cp "dice-cli-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>-jar-with-dependencies.jar;adventures\*" my.company.dice.MainKt <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Und unter Unix: </font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh mvn -f "path_to_project/DiceCore/pom.xml" install mvn -f "path_to_project/DiceCli/pom.xml" package mvn -f "path_to_project/TestAdventure/pom.xml" package mkdir path_to_project/DiceCli/target/adventures cp path_to_project/TestAdventure/target/test-adventure-1.0.jar path_to_project/DiceCli/target/adventures/ cd path_to_project/DiceCli/target/ java -cp "dice-cli-1.0-jar-with-dependencies.jar:adventures/*" my.company.dice.MainKt</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und hier ist der Trick. </font><font style="vertical-align: inherit;">Anstatt den Schl√ºssel zu verwenden, </font></font><code>-jar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f√ºgen wir das </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cli-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Projekt </font><font style="vertical-align: inherit;">dem Klassenpfad hinzu und geben die darin enthaltene Klasse explizit als Einstiegspunkt an </font></font><code>MainKt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Au√üerdem verbinden wir hier alle Archive aus dem Ordner </font></font><code>adventures/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie m√ºssen nicht noch einmal angeben, wie viel diese krumme Entscheidung ist - ich selbst wei√ü, danke. </font><font style="vertical-align: inherit;">Schlagen Sie Ihre Ideen besser in den Kommentaren vor. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bitte</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">(‡≤•Ôπè‡≤•)</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schritt siebzehn. </font><font style="vertical-align: inherit;">Handlung</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein bisschen Text. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In unserem Artikel geht es um die technische Seite des Workflows, aber Spiele sind nicht nur Software-Code. Dies sind aufregende Welten mit interessanten Ereignissen und lebhaften Charakteren, in die Sie mit Ihrem Kopf eintauchen und auf die reale Welt verzichten. Jede solche Welt ist auf ihre Weise ungew√∂hnlich und auf ihre Weise interessant, an die Sie sich nach vielen Jahren noch viele erinnern. Wenn Sie m√∂chten, dass Ihre Welt auch mit warmen Gef√ºhlen in Erinnerung bleibt, machen Sie sie ungew√∂hnlich und interessant.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich wei√ü, dass wir hier Programmierer sind, keine Drehbuchautoren, aber wir haben einige grundlegende Vorstellungen √ºber die narrative Komponente des Spielgenres (Spieler mit Erfahrung, oder?). </font><font style="vertical-align: inherit;">Wie in jedem Buch sollte die Geschichte ein Auge (in dem wir nach und nach das Problem der Helden beschreiben), eine Entwicklung, zwei oder drei interessante Wendungen, einen H√∂hepunkt (den akutesten Moment der Handlung, wenn die Leser vor Aufregung erstarren und vergessen zu atmen) und eine Aufl√∂sung (in) haben welche Ereignisse allm√§hlich zu ihrem logischen Abschluss kommen). </font><font style="vertical-align: inherit;">Vermeiden Sie Understatement, logische Grundlosigkeit und Handlungsl√∂cher - alle gestarteten Linien sollten zu einem angemessenen Ergebnis kommen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lassen Sie uns unsere Geschichte anderen vorlesen - ein unvoreingenommener Blick von der Seite hilft sehr oft, die gemachten Fehler zu verstehen und sie rechtzeitig zu korrigieren.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Handlung des Spiels</font></font></b> <div class="spoiler_text">         ,    ,      .      ,     :  ( )   ( ),   .       ,     . <br><br>   ‚Äî   ,              .     ,                  ,     . <br><br> ,  ,  - . ,    ,  ,           ,     .       . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gl√ºcklicherweise bin ich kein Tolkien, ich habe die Spielwelt nicht zu detailliert ausgearbeitet, aber ich habe versucht, sie interessant genug und vor allem logisch gerechtfertigt zu machen. Gleichzeitig erlaubte er sich, einige Unklarheiten einzuf√ºhren, die jeder Spieler auf seine Weise interpretieren kann. Nirgends konzentrierte er sich zum Beispiel auf den Stand der technologischen Entwicklung der beschriebenen Welt: das Feudalsystem und moderne demokratische Institutionen, b√∂se Tyrannen und organisierte kriminelle Gruppen, das h√∂chste Ziel und das banale √úberleben, Busfahrten und K√§mpfe in Tavernen - selbst die Charaktere schie√üen aus irgendeinem Grund: von B√∂gen / Armbr√ºsten oder von Sturmgewehren. In der Welt gibt es einen Anschein von Magie (seine Pr√§senz f√ºgt den taktischen F√§higkeiten Gameplay hinzu) und Elementen der Mystik (nur um zu sein).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich wollte mich von Handlungsklischees und Fantasy-Konsumg√ºtern entfernen - all diesen Elfen, Gnomen, Drachen, schwarzen Lords und dem absoluten B√∂sen der Welt (sowie: ausgew√§hlten Helden, alten Prophezeiungen, Superartefakten, epischen Schlachten ... obwohl letztere √ºbrig bleiben k√∂nnen). Ich wollte auch wirklich die Welt lebendig machen, damit jeder getroffene Charakter (auch ein kleinerer) seine eigene Geschichte und Motivation hat, dass Elemente der Spielmechanik in die Gesetze der Welt passen, dass die Entwicklung von Helden auf nat√ºrliche Weise erfolgt, dass die Anwesenheit von Feinden und Hindernissen an Orten logisch durch die Merkmale des Ortes selbst gerechtfertigt ist ‚Ä¶ usw. Leider war dieser Wunsch ein grausamer Witz, der den Entwicklungsprozess sehr verlangsamte, und es war nicht immer m√∂glich, von Spielekonventionen abzuweichen. Trotzdem stellte sich heraus, dass die Zufriedenheit mit dem Endprodukt um eine Gr√∂√üenordnung h√∂her war.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was m√∂chte ich zu all dem sagen? Eine gut durchdachte interessante Handlung mag nicht so notwendig sein, aber Ihr Spiel wird nicht unter ihrer Pr√§senz leiden: Im besten Fall werden die Spieler sie genie√üen, im schlimmsten Fall werden sie sie einfach ignorieren. Und diejenigen, die besonders begeistert sind, werden Ihrem Spiel sogar einige Funktionsm√§ngel verzeihen, nur um herauszufinden, wie die Geschichte endet.</font></font><br><br><h2>  Was weiter? </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die weitere Programmierung endet und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">das Spieldesign</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> beginnt </font><font style="vertical-align: inherit;">. Jetzt ist es an der Zeit, nicht den Code zu schreiben, sondern Szenarien, Orte und Feinde zu √ºberdenken - Sie verstehen, dieser ganze Bodensatz. Wenn Sie immer noch alleine arbeiten, gratuliere ich Ihnen - Sie haben das Stadium erreicht, in dem die meisten Spielprojekte in Eile sind. In gro√üen AAA-Studios arbeiten spezielle Leute als Designer und Drehbuchautoren, die daf√ºr Geld erhalten - sie haben einfach nichts zu tun. Aber wir haben viele M√∂glichkeiten: spazieren gehen, essen, banal schlafen - aber was kann man dort tun, sogar um ein neues Projekt zu starten, indem man die gesammelten Erfahrungen und Kenntnisse nutzt.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie noch hier sind und um jeden Preis weitermachen m√∂chten, dann bereiten Sie sich auf Schwierigkeiten vor. Zeitmangel, Faulheit, Mangel an kreativer Inspiration - etwas wird Sie st√§ndig ablenken. Es ist nicht einfach, all diese Hindernisse zu √ºberwinden (wieder wurden viele Artikel zu diesem Thema geschrieben), aber es ist m√∂glich. Zun√§chst rate ich Ihnen, die weitere Entwicklung des Projekts sorgf√§ltig zu planen. Gl√ºcklicherweise arbeiten wir zu unserem Vergn√ºgen, die Verlage dr√§ngen uns nicht, niemand fordert die Einhaltung bestimmter Fristen - was bedeutet, dass es die M√∂glichkeit gibt, ohne allzu gro√üe Eile ins Gesch√§ft zu kommen. Erstellen Sie eine ‚ÄûRoadmap‚Äú des Projekts, bestimmen Sie die Hauptphasen und (wenn Sie den Mut haben) ungef√§hre Bedingungen f√ºr deren Umsetzung. Holen Sie sich ein Notizbuch (Sie k√∂nnen es elektronisch machen) und schreiben Sie st√§ndig Ideen auf, die darin entstehen (und sogar mitten in der Nacht pl√∂tzlich aufwachen).Markieren Sie Ihren Fortschritt mit Tabellen (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zum Beispiel solche</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) oder andere Hilfsmittel. Starten Sie die Dokumentation: sowohl extern, √∂ffentlich ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">z. B. Wiki</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) f√ºr die zuk√ºnftige gro√üe Community von Fans als auch intern f√ºr sich selbst (ich werde den Link nicht teilen) - glauben Sie mir, ohne ihn werden Sie sich nach einer einmonatigen Pause nicht mehr daran erinnern, was genau und wie Sie es getan haben. Schreiben Sie im Allgemeinen so viele Begleitinformationen wie m√∂glich zu Ihrem Spiel. Denken Sie daran, das Spiel selbst zu schreiben. Ich habe grundlegende Optionen vorgeschlagen, aber ich gebe keine spezifischen Ratschl√§ge - jeder entscheidet f√ºr sich selbst, wie es f√ºr ihn bequemer ist, seinen Arbeitsprozess zu organisieren. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Aber trotzdem willst du nicht √ºber Spielbalance sprechen?"</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bereiten Sie sich sofort darauf vor, dass das erstmalige Erstellen des perfekten Spiels nicht funktioniert. Ein funktionierender Prototyp ist gut - er zeigt zun√§chst die Realisierbarkeit des Projekts, √ºberzeugt oder entt√§uscht Sie und gibt eine Antwort auf eine sehr wichtige Frage: ‚ÄûLohnt es sich, fortzufahren?‚Äú Er wird jedoch nicht viele andere Fragen beantworten, von denen die wichtigste wahrscheinlich lautet: "Wird es interessant sein, mein Spiel langfristig zu spielen?" Es gibt eine gro√üe Anzahl von Theorien und Artikeln (wieder) zu diesem Thema. Ein interessantes Spiel sollte m√§√üig schwierig sein, da ein zu einfaches Spiel den Spieler nicht herausfordert. Wenn andererseits die Komplexit√§t unerschwinglich ist, bleiben nur hartn√§ckige Hardcore-Spieler oder Leute, die versuchen, jemandem etwas zu beweisen, vom Spielpublikum √ºbrig. Das Spiel sollte im Idealfall sehr vielf√§ltig sein - bieten Sie mehrere M√∂glichkeiten, um das Ziel zu erreichen.so dass jeder Spieler eine Option nach Geschmack w√§hlt. Eine Passing-Strategie sollte den Rest nicht dominieren, sonst wird sie nur verwendet ... Und so weiter.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mit anderen Worten, das Spiel muss ausgeglichen sein. Dies gilt insbesondere f√ºr das Brettspiel, bei dem die Regeln klar formalisiert sind.</font></font> Wie kann man das machen?<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich habe keine Ahnung. Wenn Sie keinen Mathematikfreund haben, der ein mathematisches Modell erstellen kann (ich habe es gesehen, sie tun es), und Sie selbst nichts davon verstehen (und wir verstehen es nicht), besteht der einzige Ausweg darin </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, sich auf die Intuition des </font></font></s> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spieltests zu verlassen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Spielen Sie das Spiel zuerst selbst. Wenn Sie m√ºde werden - bieten Sie an, Ihre Frau zu spielen. Laden Sie nach der Scheidung andere Verwandte, Freunde, Bekannte und zuf√§llige Personen auf der Stra√üe zum Spielen ein. Wenn Sie v√∂llig alleine sind, laden Sie die Baugruppe ins Internet hoch. Die Leute werden interessiert sein, spielen wollen und Sie werden ihnen antworten: "Feedback von Ihnen!". Vielleicht wird jemand Ihren Traum genauso lieben wie Sie und mit Ihnen arbeiten wollen - Sie werden Gleichgesinnte oder zumindest eine Selbsthilfegruppe finden (warum habe ich diesen Artikel wohl geschrieben?) (Hehe).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scherz beiseite, ich w√ºnsche uns ... euch allen viel Erfolg. </font><font style="vertical-align: inherit;">Lesen Sie mehr (wer h√§tte das gedacht!) - √ºber Spieledesign und mehr. </font><font style="vertical-align: inherit;">Alle Themen, die wir untersucht haben, wurden bereits auf die eine oder andere Weise in Artikeln und Literatur behandelt (obwohl es offensichtlich unn√∂tig ist, Sie zum Lesen zu dr√§ngen, wenn Sie noch hier sind). </font><font style="vertical-align: inherit;">Teilen Sie Ihre Eindr√ºcke mit, kommunizieren Sie in den Foren - im Allgemeinen kennen Sie mich immer besser. </font><font style="vertical-align: inherit;">Sei nicht faul und du wirst Erfolg haben. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lassen Sie mich in diesem optimistischen Sinne Abschied nehmen. </font><font style="vertical-align: inherit;">Vielen Dank f√ºr Ihre Aufmerksamkeit. </font><font style="vertical-align: inherit;">Bis bald! </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄûEh! </font><font style="vertical-align: inherit;">Welche sehen dich? </font><font style="vertical-align: inherit;">Wie kann ich das alles jetzt auf einem Mobiltelefon starten? </font><font style="vertical-align: inherit;">Habe ich vergebens gewartet oder was? "</font></font></i> <br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachwort. </font><font style="vertical-align: inherit;">Android</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um die Integration unserer Game Engine in die Android-Plattform zu beschreiben, lassen wir die Klasse in Ruhe </font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und betrachten eine √§hnliche, aber viel einfachere Klasse </font></font><code>MainMenu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Wie der Name schon sagt, soll das Hauptmen√º der Anwendung implementiert werden. Tats√§chlich ist es die erste Klasse, mit der der Benutzer zu interagieren beginnt.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In der Konsolenoberfl√§che sieht es so aus</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/fx/ov/q7/fxovq7xubhonlcjjwziyvhfl_6g.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie eine Klasse </font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definiert sie eine Endlosschleife, bei der bei jeder Iteration ein Bildschirm gezeichnet und ein Befehl vom Benutzer angefordert wird. </font><font style="vertical-align: inherit;">Nur gibt es hier keine komplizierte Logik und diese Befehle sind viel kleiner. </font><font style="vertical-align: inherit;">Wir implementieren im Wesentlichen eine Sache - "Exit".</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aktivit√§tstabelle f√ºr Hauptmen√º</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/0_/xq/b5/0_xqb5sblm16brzqyrpibavvxco.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Einfach, oder? </font></font> Dar√ºber und √ºber die Rede.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der Code ist auch um eine Gr√∂√üenordnung einfacher. </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainMenu</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> renderer: MenuRenderer, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> interactor: MenuInteractor ) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> actions = ActionList.EMPTY <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { Audio.playMusic(Music.MENU_MAIN) actions = ActionList() actions.add(Action.Type.NEW_ADVENTURE) actions.add(Action.Type.CONTINUE_ADVENTURE, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) actions.add(Action.Type.MANUAL, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) actions.add(Action.Type.EXIT) processCycle() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processCycle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { renderer.drawMainMenu(actions) <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (interactor.pickAction(actions).type) { Action.Type.NEW_ADVENTURE -&gt; TODO() Action.Type.CONTINUE_ADVENTURE -&gt; TODO() Action.Type.MANUAL -&gt; TODO() Action.Type.EXIT -&gt; { Audio.stopMusic() Audio.playSound(Sound.LEAVE) renderer.clearScreen() Thread.sleep(<span class="hljs-number"><span class="hljs-number">500</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> AssertionError(<span class="hljs-string"><span class="hljs-string">"Should not happen"</span></span>) } } } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Interaktion mit dem Benutzer wird √ºber Schnittstellen implementiert </font></font><code>MenuRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>MenuInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funktioniert √§hnlich wie zuvor.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MenuRenderer</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Renderer { fun drawMainMenu</span></span></span></span>(actions: ActionList) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Interactor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">anyInput</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pickAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(list: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Action }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie Sie bereits verstanden haben, haben wir Schnittstellen wissentlich von bestimmten Implementierungen getrennt. </font><font style="vertical-align: inherit;">Jetzt m√ºssen wir nur noch das </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cli-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Projekt durch ein neues Projekt </font><font style="vertical-align: inherit;">ersetzen </font><font style="vertical-align: inherit;">(nennen wir es </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Droid</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) und eine Abh√§ngigkeit vom </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Core-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Projekt hinzuf√ºgen </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Lass es uns tun. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Starten Sie Android Studio (normalerweise werden darin Projekte f√ºr Android entwickelt), erstellen Sie ein einfaches Projekt, entfernen Sie alle unn√∂tigen Standard-Lametta und lassen Sie nur die Kotlin-Sprache unterst√ºtzt. </font><font style="vertical-align: inherit;">Wir f√ºgen auch eine Abh√§ngigkeit vom </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Core-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Projekt hinzu </font><font style="vertical-align: inherit;">, das im lokalen Maven-Repository unseres Computers gespeichert ist.</font></font><br><br><pre> <code class="lua hljs">apply plugin: <span class="hljs-string"><span class="hljs-string">'com.android.application'</span></span> apply plugin: <span class="hljs-string"><span class="hljs-string">'kotlin-android'</span></span> apply plugin: <span class="hljs-string"><span class="hljs-string">'kotlin-android-extensions'</span></span> android { compileSdkVersion <span class="hljs-number"><span class="hljs-number">28</span></span> defaultConfig { applicationId <span class="hljs-string"><span class="hljs-string">"my.company.dice"</span></span> minSdkVersion <span class="hljs-number"><span class="hljs-number">14</span></span> targetSdkVersion <span class="hljs-number"><span class="hljs-number">28</span></span> versionCode <span class="hljs-number"><span class="hljs-number">1</span></span> versionName <span class="hljs-string"><span class="hljs-string">"1.0"</span></span> } } dependencies { implementation <span class="hljs-string"><span class="hljs-string">"org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version"</span></span> implementation <span class="hljs-string"><span class="hljs-string">"my.company:dice-core:1.0"</span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Standardm√§√üig wird jedoch niemand unsere Abh√§ngigkeit sehen. Sie m√ºssen ausdr√ºcklich angeben, dass beim Erstellen des Projekts ein lokales Repository (mavenLocal) verwendet werden muss.</font></font><br><br><pre> <code class="lua hljs">buildscript { ext.kotlin_version = <span class="hljs-string"><span class="hljs-string">'1.3.20'</span></span> repositories { google() jcenter() mavenLocal() } dependencies { classpath <span class="hljs-string"><span class="hljs-string">'com.android.tools.build:gradle:3.3.0'</span></span> classpath <span class="hljs-string"><span class="hljs-string">"org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"</span></span> } } allprojects { repositories { google() jcenter() mavenLocal() } }</code> </pre><br>  ,        ,   ‚Äî  .  ,   ,    : <code>SoundPlayer</code> , <code>MusicPlayer</code> , <code>MenuInteractor</code> ( <code>GameInteractor</code> ), <code>MenuRenderer</code> ( <code>GameRenderer</code> )  <code>StringLoader</code> ,    ,    .    ,          . <br><br>           (, ,    ) Android ‚Äî      <code>Canvas</code> .      -   <code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Dies wird unsere "Leinwand" sein. </font><font style="vertical-align: inherit;">Bei der Eingabe ist es etwas komplizierter, da wir keine Tastatur mehr haben und die Benutzeroberfl√§che so gestaltet sein muss, dass Benutzereingaben auf bestimmten Teilen des Bildschirms als Eingabe von Befehlen betrachtet werden. </font><font style="vertical-align: inherit;">Dazu verwenden wir denselben Erben </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- auf diese Weise fungiert er als Vermittler zwischen dem Benutzer und der Spiel-Engine (√§hnlich wie die Systemkonsole als solcher Vermittler fungierte). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lassen Sie uns die Hauptaktivit√§t f√ºr unsere Ansicht erstellen und in das Manifest schreiben.</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"my.company.dice"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@mipmap/ic_launcher"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/app_name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:theme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@style/AppTheme"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".ui.MainActivity"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:screenOrientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sensorLandscape"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:configChanges</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"orientation|keyboardHidden|screenSize"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.category.LAUNCHER"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.MAIN"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir korrigieren die Aktivit√§t im Querformat - wie bei den meisten anderen Spielen k√∂nnen wir kein Portr√§t portr√§tieren. </font><font style="vertical-align: inherit;">Dar√ºber hinaus erweitern wir es auf den gesamten Bildschirm des Ger√§ts und schreiben das Hauptthema entsprechend vor.</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AppTheme"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">parent</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android:Theme.Black.NoTitleBar.Fullscreen"</span></span></span><span class="hljs-tag">/&gt;</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und da wir uns mit Ressourcen befasst haben, √ºbertragen wir die </font><font style="vertical-align: inherit;">lokalisierten Zeichenfolgen, die wir ben√∂tigen, </font><font style="vertical-align: inherit;">aus dem </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cli-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Projekt </font><font style="vertical-align: inherit;">und bringen sie in das gew√ºnschte Format:</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_new_adventure_key"</span></span></span><span class="hljs-tag">&gt;</span></span>N<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_new_adventure_name"</span></span></span><span class="hljs-tag">&gt;</span></span>ew adventure<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_continue_adventure_key"</span></span></span><span class="hljs-tag">&gt;</span></span>C<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_continue_adventure_name"</span></span></span><span class="hljs-tag">&gt;</span></span>ontinue adventure<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_manual_key"</span></span></span><span class="hljs-tag">&gt;</span></span>M<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_manual_name"</span></span></span><span class="hljs-tag">&gt;</span></span>anual<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_exit_key"</span></span></span><span class="hljs-tag">&gt;</span></span>X<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_exit_name"</span></span></span><span class="hljs-tag">&gt;</span></span>Exit<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sowie die im Hauptmen√º verwendeten Dateien mit Sounds und Musik (eine von jedem Typ), platzieren Sie sie in </font></font><code>/assets/sound/leave.wav</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>/assets/music/menu_main.mp3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Als wir die Ressourcen aussortierten, war es Zeit, uns dem Design zu widmen (ja, wieder). </font><font style="vertical-align: inherit;">Im Gegensatz zur Konsole verf√ºgt die Android-Plattform √ºber eigene Architekturfunktionen, die uns dazu zwingen, bestimmte Ans√§tze und Methoden zu verwenden.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klassen- und Schnittstellendiagramm</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/xb/m4/uc/xbm4ucar6ewumegpof3hr53c0a4.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warten Sie, nicht in Ohnmacht fallen, jetzt werde ich alles im Detail erkl√§ren. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir werden vielleicht mit dem Schwierigsten beginnen - der Klasse </font></font><code>DiceSurface</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- dem Erben, </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">der berufen ist, die unabh√§ngigen Teile unseres Systems zusammenzubinden (wenn Sie m√∂chten, k√∂nnen Sie es von der Klasse erben </font></font><code>SurfaceView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- oder sogar </font></font><code>GlSurfaceView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- und in einem separaten Thread zeichnen, aber wir haben ein rundenbasiertes Spiel, das schlecht in der Animation ist (was keine komplexe grafische Ausgabe erfordert, daher werden wir es nicht komplizieren). Wie bereits erw√§hnt, werden durch die Implementierung zwei Probleme gleichzeitig gel√∂st: Bildausgabe und Klickverarbeitung, von denen jedes seine eigenen unerwarteten Schwierigkeiten hat. Betrachten wir sie der Reihe nach.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Als wir auf die Konsole gemalt haben, hat unser Renderer Ausgabebefehle gesendet und ein Bild auf dem Bildschirm erstellt. Bei Android ist die Situation umgekehrt: Das Rendern wird von der Ansicht selbst initiiert, die zum Zeitpunkt der Ausf√ºhrung der Methode </font></font><code>onDraw()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bereits wissen sollte, was, wie und wo gezeichnet werden soll. Aber was ist mit der </font></font><code>drawMainMenu()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schnittstellenmethode </font></font><code>MainMenu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Kontrolliert er jetzt nicht die Ausgabe? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versuchen wir, dieses Problem mithilfe funktionaler Schnittstellen zu l√∂sen. Die Klasse </font></font><code>DiceSurface</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enth√§lt einen speziellen Parameter </font></font><code>instructions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- einen Codeblock, der bei jedem Aufruf der Methode ausgef√ºhrt werden muss </font></font><code>onDraw()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Der Renderer gibt mithilfe einer √∂ffentlichen Methode an, welche spezifischen Anweisungen befolgt werden sollen. Wenn Sie interessiert sind, verwenden Sie </font><font style="vertical-align: inherit;">ein Muster , </font><font style="vertical-align: inherit;">das die genannte </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Strategie</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Strategie). Es sieht so aus:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> RenderInstructions = (Canvas, Paint) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DiceSurface</span></span></span></span>(context: Context) : View(context) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> instructions: RenderInstructions = { _, _ -&gt; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> paint = Paint().apply { color = Color.YELLOW style = Paint.Style.STROKE isAntiAlias = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateInstructions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instructions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">RenderInstructions</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.instructions = instructions <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.postInvalidate() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDraw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(canvas: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Canvas</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onDraw(canvas) canvas.drawColor(Color.BLACK) <span class="hljs-comment"><span class="hljs-comment">//Fill background with black color instructions.invoke(canvas, paint) //Execute current render instructions } } class DroidMenuRenderer(private val surface: DiceSurface): MenuRenderer { override fun clearScreen() { surface.updateInstructions { _, _ -&gt; } } override fun drawMainMenu(actions: ActionList) { surface.updateInstructions { c, p -&gt; val canvasWidth = c.width val canvasHeight = c.height //Draw title text p.textSize = canvasHeight / 3f p.strokeWidth = 0f p.color = Color.parseColor("#ff808000") c.drawText( "DICE", (canvasWidth - p.measureText("DICE")) / 2f, (buttonTop - p.ascent() - p.descent()) / 2f, p ) //Other instructions... } } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das hei√üt, die gesamte grafische Funktionalit√§t befindet sich noch in der Renderer-Klasse. Diesmal f√ºhren wir die Befehle jedoch nicht direkt aus, sondern bereiten sie f√ºr die Ausf√ºhrung durch unsere Ansicht vor. Achten Sie auf die Art der Eigenschaft </font></font><code>instructions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Sie k√∂nnen eine separate Schnittstelle erstellen und die einzige Methode aufrufen, aber Kotlin kann die Codemenge erheblich reduzieren.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nun zu Interactor. Bisher erfolgte die Dateneingabe synchron: Als wir Daten von der Konsole (Tastatur) anforderten, wurde die Anwendung (Zyklen) angehalten, bis der Benutzer eine Taste dr√ºckte. Mit Android funktioniert ein solcher Trick nicht - er hat einen eigenen Looper, dessen Arbeit wir auf keinen Fall st√∂ren d√ºrfen, was bedeutet, dass die Eingabe asynchron sein muss. Das hei√üt, die Interactor-Schnittstellenmethoden halten die Engine weiterhin an und warten auf Befehle, w√§hrend Activity und alle seine Ansichten weiter funktionieren, bis sie diesen Befehl fr√ºher oder sp√§ter senden. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dieser Ansatz ist mithilfe einer Standardschnittstelle recht einfach zu implementieren </font></font><code>BlockingQueue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Die Klasse </font></font><code>DroidMenuInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ruft die Methode auf</font></font><code>take()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dadurch wird die Ausf√ºhrung des Spiel-Streams angehalten, bis die Elemente (Instanzen der bekannten Klasse </font></font><code>Action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">in der Warteschlange angezeigt werden </font><font style="vertical-align: inherit;">. </font></font><code>DiceSurface</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Gegenzug wird auf Benutzer klicken (eine Standardmethode der regirovat </font></font><code>onTouchEvent()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einer Klasse </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), Objekte zu erzeugen und sie in die Warteschlange Methode hinzuf√ºgen </font></font><code>offer()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Es wird so aussehen:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DiceSurface</span></span></span></span>(context: Context) : View(context) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> actionQueue: BlockingQueue&lt;Action&gt; = LinkedBlockingQueue&lt;Action&gt;() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">awaitAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Action = actionQueue.take() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTouchEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">MotionEvent</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.action == MotionEvent.ACTION_UP) { actionQueue.offer(Action(Action.Type.NONE), <span class="hljs-number"><span class="hljs-number">200</span></span>, TimeUnit.MILLISECONDS) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DroidMenuInteractor</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> surface: DiceSurface) : Interactor { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">anyInput</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { surface.awaitAction() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pickAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(list: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Action { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type = surface.awaitAction().type list .filter(Action::isEnabled) .find { it.type == type } ?.let { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> it } } } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das hei√üt, Interactor ruft die Methode auf </font></font><code>awaitAction()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und verarbeitet den empfangenen Befehl, wenn sich etwas in der Warteschlange befindet. Achten Sie darauf, wie Teams zur Warteschlange hinzugef√ºgt werden. Da der UI-Stream kontinuierlich ausgef√ºhrt wird, kann der Benutzer mehrmals hintereinander auf den Bildschirm klicken, was zu H√§ngen f√ºhren kann, insbesondere wenn die Spiel-Engine nicht bereit ist, Befehle zu empfangen (z. B. w√§hrend Animationen). In diesem Fall hilft es, die Kapazit√§t der Warteschlange zu erh√∂hen und / oder den Timeout-Wert zu verringern.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nat√ºrlich √ºbertragen wir die Befehle, aber nur den einen und einzigen. Wir m√ºssen zwischen den Koordinaten des Dr√ºckens unterscheiden und abh√§ngig von ihren Werten diesen oder jenen Befehl aufrufen. Dies ist jedoch ein Pech - Interactor hat keine Ahnung, wo an welcher Stelle auf dem Bildschirm die aktiven Schaltfl√§chen gezeichnet sind - Renderer ist f√ºr das Rendern verantwortlich. Wir werden ihre Interaktion wie folgt festlegen. Die Klasse </font></font><code>DiceSurface</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">speichert eine spezielle Sammlung - eine Liste aktiver Rechtecke (oder anderer Formen, falls wir diesen Punkt jemals erreichen). Solche Rechtecke enthalten die Koordinaten der Eckpunkte und des gebundenen </font></font><code>Action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Der Renderer generiert diese Rechtecke und f√ºgt sie der Liste hinzu. Die Methode </font></font><code>onTouchEvent()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ermittelt, welches der Rechtecke gedr√ºckt wurde, und f√ºgt das entsprechende zur Warteschlange hinzu </font></font><code>Action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActiveRect</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> action: Action, left: <span class="hljs-built_in"><span class="hljs-built_in">Float</span></span>, top: <span class="hljs-built_in"><span class="hljs-built_in">Float</span></span>, right: <span class="hljs-built_in"><span class="hljs-built_in">Float</span></span>, bottom: <span class="hljs-built_in"><span class="hljs-built_in">Float</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rect = RectF(left, top, right, bottom) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">, y: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">, w: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">, h: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = rect.contains(x / w, y / h) }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Methode </font></font><code>check()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√ºberpr√ºft, ob sich die angegebenen Koordinaten innerhalb des Rechtecks ‚Äã‚Äãbefinden. Bitte beachten Sie, dass wir zum Zeitpunkt der Arbeit von Renderer (und genau in diesem Moment, in dem die Rechtecke erstellt werden) nicht die geringste Ahnung von der Gr√∂√üe der Leinwand haben. Daher m√ºssen wir die Koordinaten in relativen Werten (Prozentsatz der Breite oder H√∂he des Bildschirms) mit Werten von 0 bis 1 speichern und zum Zeitpunkt des Dr√ºcken erneut z√§hlen. Dieser Ansatz ist nicht ganz korrekt, da das Seitenverh√§ltnis nicht ber√ºcksichtigt wird - in Zukunft muss er √ºberarbeitet werden. F√ºr unsere Bildungsaufgabe reicht es jedoch zun√§chst aus. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir werden </font></font><code>DiceSurface</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ein zus√§tzliches Feld </font><font style="vertical-align: inherit;">in der Klasse implementieren </font><font style="vertical-align: inherit;">, zwei Methoden ( </font></font><code>addRectangle()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>clearRectangles()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">hinzuf√ºgen </font><font style="vertical-align: inherit;">, um es von au√üen (von Renderers Seite) zu steuern, und erweitern, </font></font><code>onTouchEvent()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indem wir die Koordinaten der Rechtecke ber√ºcksichtigen.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DiceSurface</span></span></span></span>(context: Context) : View(context) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> actionQueue: BlockingQueue&lt;Action&gt; = LinkedBlockingQueue&lt;Action&gt;() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rectangles: MutableSet&lt;ActiveRect&gt; = Collections.newSetFromMap(ConcurrentHashMap&lt;ActiveRect, <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>&gt;()) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> instructions: RenderInstructions = { _, _ -&gt; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> paint = Paint().apply { color = Color.YELLOW style = Paint.Style.STROKE isAntiAlias = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateInstructions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instructions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">RenderInstructions</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.instructions = instructions <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.postInvalidate() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearRectangles</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { rectangles.clear() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addRectangle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Action</span></span></span></span><span class="hljs-function"><span class="hljs-params">, left: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">, top: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">, right: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">, bottom: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { rectangles.add(ActiveRect(action, left, top, right, bottom)) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">awaitAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Action = actionQueue.take() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTouchEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">MotionEvent</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.action == MotionEvent.ACTION_UP) { with(rectangles.firstOrNull { it.check(event.x, event.y, width.toFloat(), height.toFloat()) }) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { actionQueue.put(action) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { actionQueue.offer(Action(Action.Type.NONE), <span class="hljs-number"><span class="hljs-number">200</span></span>, TimeUnit.MILLISECONDS) } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDraw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(canvas: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Canvas</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onDraw(canvas) canvas.drawColor(Color.BLACK) instructions(canvas, paint) } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zum Speichern der Rechtecke wird eine wettbewerbsf√§hige Sammlung verwendet. Dadurch kann das Auftreten vermieden werden, </font></font><code>ConcurrentModificationException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wenn der Satz gleichzeitig von verschiedenen Threads aktualisiert und verschoben wird (was in unserem Fall der Fall sein wird). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Klassencode </font></font><code>DroidMenuInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bleibt unver√§ndert, </font></font><code>DroidMenuRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√§ndert sich jedoch. F√ºgen Sie der Anzeige f√ºr jedes Element vier Schaltfl√§chen hinzu </font></font><code>ActionList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Platzieren Sie sie unter der √úberschrift W√ºrfel, gleichm√§√üig √ºber die Breite des Bildschirms verteilt. Vergessen wir nicht die aktiven Rechtecke.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DroidMenuRenderer</span></span></span><span class="hljs-class"> </span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> surface: DiceSurface, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> loader: StringLoader ) : MenuRenderer { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> helper = StringLoadHelper(loader) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { surface.clearRectangles() surface.updateInstructions { _, _ -&gt; } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawMainMenu</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(actions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">//Prepare rectangles surface.clearRectangles() val percentage = 1.0f / actions.size actions.forEachIndexed { i, a -&gt; surface.addRectangle(a, i * percentage, 0.45f, i * percentage + percentage, 1f) } //Prepare instructions surface.updateInstructions { c, p -&gt; val canvasWidth = c.width val canvasHeight = c.height val buttonTop = canvasHeight * 0.45f val buttonWidth = canvasWidth / actions.size val padding = canvasHeight / 144f //Draw title text p.textSize = canvasHeight / 3f p.strokeWidth = 0f p.color = Color.parseColor("#ff808000") p.isFakeBoldText = true c.drawText( "DICE", (canvasWidth - p.measureText("DICE")) / 2f, (buttonTop - p.ascent() - p.descent()) / 2f, p ) p.isFakeBoldText = false //Draw action buttons p.textSize = canvasHeight / 24f actions.forEachIndexed { i, a -&gt; p.color = if (a.isEnabled) Color.YELLOW else Color.LTGRAY p.strokeWidth = canvasHeight / 240f c.drawRect( i * buttonWidth + padding, buttonTop + padding, i * buttonWidth + buttonWidth - padding, canvasHeight - padding, p ) val name = mergeActionData(helper.loadActionData(a)) p.strokeWidth = 0f c.drawText( name, i * buttonWidth + (buttonWidth - p.measureText(name)) / 2f, (canvasHeight + buttonTop - p.ascent() - p.descent()) / 2f, p ) } } } private fun mergeActionData(data: Array&lt;String&gt;) = if (data.size &gt; 1) { if (data[1].first().isLowerCase()) data[0] + data[1] else data[1] } else data.getOrNull(0) ?: "" }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier kehrten wir wieder zur Schnittstelle </font></font><code>StringLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und den Funktionen der Hilfsklasse zur√ºck </font></font><code>StringLoadHelper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(im Diagramm nicht dargestellt). </font><font style="vertical-align: inherit;">Die Implementierung der ersten hat einen Namen </font></font><code>ResourceStringLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und l√§dt lokalisierte Zeichenfolgen aus (offensichtlich) Anwendungsressourcen. </font><font style="vertical-align: inherit;">Dies geschieht jedoch dynamisch, da wir die Ressourcenkennungen nicht im Voraus kennen - wir sind gezwungen, sie unterwegs zu erstellen.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResourceStringLoader</span></span></span></span>(context: Context) : StringLoader { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> packageName = context.packageName <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> resources = context.resources <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: String = resources.getString(resources.getIdentifier(key, <span class="hljs-string"><span class="hljs-string">"string"</span></span>, packageName)) }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es bleibt √ºber Ger√§usche und Musik zu sprechen. </font><font style="vertical-align: inherit;">Es gibt eine wunderbare Klasse in Android </font></font><code>MediaPlayer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die sich mit diesen Dingen befasst. </font><font style="vertical-align: inherit;">Es gibt nichts Besseres zum Musikspielen:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DroidMusicPlayer</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> context: Context): MusicPlayer { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentMusic: Music? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> player = MediaPlayer() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(music: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Music</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentMusic == music) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } currentMusic = music player.setAudioStreamType(AudioManager.STREAM_MUSIC) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> afd = context.assets.openFd(<span class="hljs-string"><span class="hljs-string">"music/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${music.toString().toLowerCase()}</span></span></span><span class="hljs-string">.mp3"</span></span>) player.setDataSource(afd.fileDescriptor, afd.startOffset, afd.length) player.setOnCompletionListener { it.seekTo(<span class="hljs-number"><span class="hljs-number">0</span></span>) it.start() } player.prepare() player.start() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { currentMusic = <span class="hljs-literal"><span class="hljs-literal">null</span></span> player.release() } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zwei Punkte. Erstens wird die Methode </font></font><code>prepare()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">synchron ausgef√ºhrt, wodurch das System bei einer gro√üen Dateigr√∂√üe (aufgrund von Pufferung) angehalten wird. Es wird empfohlen, dass Sie es entweder in einem separaten Thread ausf√ºhren oder die asynchrone Methode </font></font><code>prepareAsync()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und verwenden </font></font><code>OnPreparedListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Zweitens w√§re es sch√∂n, die Wiedergabe mit dem Aktivit√§tslebenszyklus zu verkn√ºpfen (Pause, wenn der Benutzer die Anwendung minimiert und bei der Wiederherstellung fortgesetzt wird), aber wir haben dies nicht getan. Ai-ai-ai ... </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ist </font></font><code>MediaPlayer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auch </font><font style="vertical-align: inherit;">f√ºr Sounds </font><font style="vertical-align: inherit;">geeignet, aber wenn es nur wenige und einfache sind (wie in unserem Fall), reicht es aus </font></font><code>SoundPool</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Der Vorteil ist, dass die Wiedergabe von Audiodateien sofort beginnt, wenn sie bereits in den Speicher geladen sind. Der Nachteil liegt auf der Hand - es gibt m√∂glicherweise nicht gen√ºgend Speicher (aber genug f√ºr uns, wir sind bescheiden).</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DroidSoundPlayer</span></span></span></span>(context: Context) : SoundPlayer { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> soundPool: SoundPool = SoundPool(<span class="hljs-number"><span class="hljs-number">2</span></span>, AudioManager.STREAM_MUSIC, <span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> sounds = mutableMapOf&lt;Sound, <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>&gt;() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rate = <span class="hljs-number"><span class="hljs-number">1f</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> lock = ReentrantReadWriteLock() <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> { Thread(SoundLoader(context)).start() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sound: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Sound</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lock.readLock().tryLock()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { sounds[sound]?.let { s -&gt; soundPool.play(s, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, rate) } } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { lock.readLock().unlock() } } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">inner</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SoundLoader</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> context: Context) : Runnable { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> assets = context.assets lock.writeLock().lock() <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Sound.values().forEach { s -&gt; sounds[s] = soundPool.load( assets.openFd(<span class="hljs-string"><span class="hljs-string">"sound/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${s.toString().toLowerCase()}</span></span></span><span class="hljs-string">.wav"</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span> ) } } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { lock.writeLock().unlock() } } } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beim Erstellen einer Klasse werden alle Sounds aus der Aufz√§hlung </font></font><code>Sound</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in einem separaten Stream in das Repository geladen. </font><font style="vertical-align: inherit;">Dieses Mal verwenden wir keine synchronisierte Sammlung, aber wir implementieren den Mutex mit der Standardklasse </font></font><code>ReentrantReadWriteLock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jetzt, endlich, blenden wir alle Komponenten in unserem zusammen </font></font><code>MainActivity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- haben Sie das nicht vergessen? </font><font style="vertical-align: inherit;">Bitte beachten Sie, dass </font></font><code>MainMenu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(und </font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">anschlie√üend) in einem separaten Thread gestartet werden muss.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Activity</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState) Audio.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(DroidSoundPlayer(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>), DroidMusicPlayer(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> surface = DiceSurface(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> renderer = DroidMenuRenderer(surface) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> interactor = DroidMenuInteractor(surface, ResourceStringLoader(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)) setContentView(surface) Thread { MainMenu(renderer, interactor).start() finish() }.start() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBackPressed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { } }</code> </pre><br>  Das ist in der Tat alles.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nach all den Qualen sieht der Hauptbildschirm unserer Anwendung einfach fantastisch aus: </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Hauptmen√º in voller Breite des mobilen Bildschirms</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/m0/u7/-7/m0u7-7lcjmuttu9rerrvirhfgyy.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nun, das hei√üt, es wird erstaunlich aussehen, wenn ein intelligenter K√ºnstler in unseren Reihen erscheint, und mit seiner Hilfe wird dieser Elend komplett neu gezeichnet. </font></font><br><br><h2>  N√ºtzliche Links </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich wei√ü, viele haben direkt zu diesem Punkt gescrollt. </font><font style="vertical-align: inherit;">Es ist okay - die meisten Leser haben den Tab vollst√§ndig geschlossen. </font><font style="vertical-align: inherit;">Jene Einheiten, die dennoch all diesem Strom inkoh√§renten Geschw√§tzes standhielten - </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Respekt und Respekt,</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> unendliche Liebe und Dankbarkeit. </font><font style="vertical-align: inherit;">Na und Links nat√ºrlich, wo ohne sie. </font><font style="vertical-align: inherit;">Zun√§chst zum Quellcode der Projekte (denken Sie daran, dass der aktuelle Status der Projekte weit √ºber den im Artikel ber√ºcksichtigten Zustand hinausgegangen ist):</font></font><br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projekt - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Core</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cli-</font></font></b></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"> Projekt</font></a><font style="vertical-align: inherit;"> ;</font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">projizieren </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">das Droid</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nun, pl√∂tzlich wird jemand den Wunsch haben, das Projekt zu starten und zu sehen und Faulheit selbst zu sammeln. Hier ist ein Link zur Arbeitsversion: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINK!</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hier wird ein praktischer Launcher zum Starten verwendet (Sie k√∂nnen einen separaten Artikel √ºber seine Erstellung schreiben). Es verwendet JavaFX und startet daher m√∂glicherweise nicht auf Computern mit OpenJDK (Schreiben und Hilfe), macht jedoch die manuelle Registrierung von Dateipfaden zumindest √ºberfl√ºssig. Die Installationshilfe ist in der Datei readme.txt enthalten (erinnern Sie sich an diese?). Herunterladen, ansehen, verwenden und schlie√ülich schweige ich.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie an einem Projekt, einem verwendeten Tool, einer Mechanik, einer interessanten L√∂sung oder, ich wei√ü nicht, √úberlieferungsspielen interessiert sind, k√∂nnen Sie dies in einem separaten Artikel genauer untersuchen. </font><font style="vertical-align: inherit;">Wenn Sie wollen. </font><font style="vertical-align: inherit;">Und wenn Sie nicht m√∂chten, senden Sie einfach Kommentare, Bedauern und Vorschl√§ge. </font><font style="vertical-align: inherit;">Ich werde gerne reden.</font></font><br><br>  Alles Gute. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de445278/">https://habr.com/ru/post/de445278/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de445268/index.html">GraphQL-Details: Was, wie und warum</a></li>
<li><a href="../de445270/index.html">[Lesezeichen] Bash f√ºr Anf√§nger: 21 n√ºtzlicher Befehl</a></li>
<li><a href="../de445272/index.html">JavaScript ist die beste Programmiersprache f√ºr Anf√§nger. So ist es oder nicht?</a></li>
<li><a href="../de445274/index.html">Wenn "Zo√´"! == "Zo√´" oder warum Sie Unicode-Strings normalisieren m√ºssen</a></li>
<li><a href="../de445276/index.html">Vollst√§ndiges UseEffect-Handbuch</a></li>
<li><a href="../de445280/index.html">Rentabilit√§t von Websites und Dienstleistungen</a></li>
<li><a href="../de445284/index.html">ClickHouse Product Analytics VKontakte</a></li>
<li><a href="../de445286/index.html">Fu√üst√ºtze f√ºr das Gehirn: Hedera Hashgraph Distributed Registry Platform</a></li>
<li><a href="../de445288/index.html">Alle Ihre Verbraucherkredite und pers√∂nlichen Daten "an einem Ort" ...</a></li>
<li><a href="../de445290/index.html">Wie implementiere ich einheitliche Prozesse unter Ber√ºcksichtigung aller Merkmale des Unternehmens?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>