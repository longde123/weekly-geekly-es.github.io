<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕐 🏆 👩🏻‍🤝‍👨🏽 使用KOMPAS-3D API→第11课→简单文本标签 🗑️ 🗝️ 💋</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在本周期的先前课程中，我们学习了在标题栏中显示文本。 今天，我们将讨论如何将文本输出到文档本身。 我们将考虑最简单的示例，并在以下课程中显示更多复杂的技巧。 




 课程系列“使用KOMPAS-3D API的工作”的内容 


1. 基础知识 
2. 图纸设计 
3. 正确连接到KOMPAS 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>使用KOMPAS-3D API→第11课→简单文本标签</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ascon/blog/417723/"> 在本周期的先前课程中，我们学习了在标题栏中显示文本。 今天，我们将讨论如何将文本输出到文档本身。 我们将考虑最简单的示例，并在以下课程中显示更多复杂的技巧。 <br><br><img src="https://habrastorage.org/webt/wz/do/cm/wzdocmvrzusasojdie12itkajtq.png"><br><br><a name="habracut"></a><br><blockquote><h4> 课程系列“使用KOMPAS-3D API的工作”的内容 </h4><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">基础知识</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">图纸设计</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">正确连接到KOMPAS</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">主题词</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">图形图元</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">以各种格式保存文档</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">了解设置</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">标题栏中更复杂的书写方法</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">读取字幕单元</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">特殊字符，包括字符串</a> </li><li>  <b>简单文字标签</b> </li></ol></blockquote><br><h2>  <font color="#00B2FF">文字锚点</font> </h2><br>  KOMPAS中的文本始终相对于某个点显示，这称为锚点。 文本相对于文本的位置可以不同。 为了找出文本相对于锚点的位置， <b>使用</b>了<b>ksDocument2D</b>接口的<b>ksGetTextAlign</b>方法。 以下是其原型。 <br><br><pre><code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">long</span></span> ksGetTextAlign ( <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> pText <span class="hljs-comment"><span class="hljs-comment">//   );</span></span></code> </pre> <br> 作为唯一参数，它需要一个指向<i>文本</i>对象的整数指针。 该方法返回<i>binding</i>的<i>类型，</i>如果发生错误，则返回<i>-1</i> 。 有效的绑定类型如下表所示。 <br><br><img src="https://habrastorage.org/webt/x1/ar/kt/x1arktnxaiyg0pu4wxidqdqbzke.png"><br>  <i>有效绑定类型表</i> <br><br> 要更改文本绑定，请使用<b>ksDocument2D</b>接口的<b>ksSetTextAlign</b>方法。 以下是其原型。 <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ksSetTextAlign</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pText, //   «» </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> align //  </span></span></span><span class="hljs-function">)</span></span>;</code> </pre><br> 如果成功，则此方法返回<i>1</i> ，如果发生错误，则返回<i>零</i> 。 <br><br><h2>  <font color="#00B2FF">文字输出</font> </h2><br> 对于简单文本输出，请使用<b>ksDocument2D</b>接口的<b>ksText</b>方法。 以下是此方法的原型。 <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ksText</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, //   </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ang, //   </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hStr, //    </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ksuStr, //  </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bitVector, //  BSTR s //  </span></span></span><span class="hljs-function">)</span></span>;</code> </pre><br> 让我们<b>分析ksText</b>方法<b>的</b>参数。 我们在上一节中讨论了锚点。 <br><br>  <b>ang</b>参数设置文本行和水平线之间的角度（以度为单位）。 角度是逆时针计数的。 下图显示了以<i>45°</i>角绘制的线。 <br><br><img src="https://habrastorage.org/webt/f4/4s/qd/f44sqdinktxtkua8fe9qd_jvdf4.png"><br>  <i>45°弦</i> <br><br>  <b>hStr</b>参数以毫米为单位设置字符串字符的大小。 如果此参数的值<i>为零</i> ，则使用默认大小。 <br><br>  <b>ksuStr</b>参数指定文本的拉伸（缩小）。 下图显示了几行带有不同<b>ksuStr</b>参数值的行。 <br><br><img src="https://habrastorage.org/webt/eg/ph/bg/egphbgtc5ecognfjioff2r3c3dm.png"><br>  <i>具有不同拉伸值的多行</i> <br><br> 从该图可以看出，“拉伸0”等同于“拉伸1”，即没有任何拉伸。 <br><br>  <b>bitVector</b>参数包含一组确定字符样式的标志。 下表列出了有效的标志。 <br><br><img src="https://habrastorage.org/webt/yi/is/hb/yiishb0rg_-xvibw5cmm90uno3m.png"><br>  <i>字符标志表</i> <br><br> 实际上，还有其他有效的标志，但是它们的工作仅出现在复杂的复合字符串的构造中。 在下一课中，我们将考虑其中的一些。 <br> 请记住-输出字符串不应包含<i>@</i> ， <i>$</i> ， <i>＆</i> ， <i>〜</i> ， <i>^</i>和<i>＃</i>字符，因为它们是控制字符。 在本周期的下一课中，我们将讨论与他们合作。 <br> 如果成功，则<b>ksText</b>方法将返回一个指向文本的整数指针。 例如，可以将该指针传递给<b>ksSetTextAlign</b>方法，以更改文本相对于锚点的位置。 如果发生错误，则<b>ksText</b>方法返回<i>零</i> 。 <br><br><h2>  <font color="#00B2FF">例子</font> </h2><br> 下面是一个示例程序，演示了使用<b>ksText</b>方法输出字符串的方法。 <br><br><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/  BSTR str = SysAllocString(L""); long itext; itext = Document2D-&gt;ksText(100, 100, /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  0, /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  11, /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  0, /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ 0, /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  str); SysFreeString(str); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    Document2D-&gt;ksSetTextAlign(itext, txta_Left); Document2D.Unbind(); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   kompas-&gt;Visible = true; kompas.Unbind();</span></span></code> </pre><br> 为了简单起见，在此示例中省略了负责创建和执行文档的代码。 作为该程序的结果，在文档中显示文本<i>“ String”</i> 。 <br><br><h2>  <font color="#00B2FF">文字大小</font> </h2><br> 在文档中显示文本时，知道需要多少空间很有用。 文本高度由<b>ksText</b>方法的<b>hStr</b>参数设置。 但是其长度直接取决于输出字符串。 <br><br> 要确定它，请使用<b>ksDocument2D</b>接口的<b>ksGetTextLengthFromReference</b>方法。 此方法只有一个参数-指向文本的整数指针。 它返回以毫米为单位的文本长度。 <br><br>  <b>ksGetTextLengthFromReference</b>方法不方便，因为它不允许您在将行输出到文档之前确定行的长度。 要确定尚未输出到文档的字符串的长度，您需要使用<b>ksGetTextLength</b>方法。 但是在考虑之前，让我们先谈一下样式。 <br><br><h2>  <font color="#00B2FF">文字样式</font> </h2><br>  KOMPAS系统为文档中显示的文本预定义了几种样式。 每个样式都有一个整数。 下表列出了最常用的样式。 <br><br><img src="https://habrastorage.org/webt/4p/sf/ny/4psfnyywguukemqayhjyzsu0tqi.png"><br>  <i>常用文字样式</i> <br><br> 该表中未提供所有样式：仅其中一部分。 可用常量的完整列表可<i>在</i> KOMPAS文档<i>中的“参数结构和常量\常量\文本常量\系统文本样式”</i>页面上找到。 <br><br><h2>  <font color="#00B2FF"><b>KsGetTextLength</b>方法</font> </h2><br> 通过<b>ksDocument2D</b>接口的<b>ksGetTextLength</b>方法，可以在将字符串输出到文档之前确定其长度。 下面是此方法的原型。 <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ksGetTextLength</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> BSTR text, // </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> style //  </span></span></span><span class="hljs-function">)</span></span>;</code> </pre><br> 该方法返回以毫米为单位的字符串长度。 请注意：该方法接受字符串本身作为参数，而不是指向“文本”对象的指针。 这样，您可以在将行输出到文档之前评估行的大小。 <br><br><h2>  <font color="#00B2FF">例子</font> </h2><br> 考虑使用<b>ksGetTextLength</b>方法的示例。 假设我们有一条线，我们需要将其放置在一定长度的矩形中（此任务在段落的帮助下更容易解决，但在下一课中会涉及到它们）。 如果该行适合，则显示为完整。 如果不是，则将其切除并在其末尾放置省略号。 下面是解决此问题的程序的源代码。 <br><br><pre> <code class="hljs ruby">const wchar_t FULLSTR[] = L<span class="hljs-string"><span class="hljs-string">"  !   !   !"</span></span>; const wchar_t DOTS[] = L<span class="hljs-string"><span class="hljs-string">"..."</span></span>; const long STYLE = <span class="hljs-number"><span class="hljs-number">1</span></span>; double maxSize = <span class="hljs-number"><span class="hljs-number">100.0</span></span>; BSTR str = SysAllocString(FULLSTR); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Document2D-&gt;ksGetTextLength(str, STYLE) &gt; maxSize) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   BSTR str_dots = SysAllocString(DOTS); double size_dots = Document2D-&gt;ksGetTextLength(str_dots, STYLE); SysFreeString(str_dots); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     maxSize -= size_dots; SysReAllocStringLen(&amp;str, str, SysStringLen(str) - <span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ,     <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(Document2D-&gt;ksGetTextLength(str, STYLE) &gt; maxSize) SysReAllocStringLen(&amp;str, str, SysStringLen(str) - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    size_t len = SysStringLen(str); SysFreeString(str); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     wchar_t *p = new wchar_t[len + wcslen(DOTS) + <span class="hljs-number"><span class="hljs-number">1</span></span>]; wcsncpy(p, FULLSTR, len); p[len] = L<span class="hljs-string"><span class="hljs-string">'\0'</span></span>; wcscat(p, DOTS); str = SysAllocString(p); delete [] p; } /<span class="hljs-regexp"><span class="hljs-regexp">/    Document2D-&gt;ksText(100, 100, /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  0, /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  0, /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  0, /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ 0, /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  str); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  SysFreeString(str); Document2D.Unbind(); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   kompas-&gt;Visible = true; kompas.Unbind();</span></span></code> </pre><br> 源字符串在<b>FULLSTR</b>常量中指定。 变量<b>maxSize</b>设置要在其中输入字符串的矩形的长度。 稍后指定该值，从中减去省略号，该大小存储在<b>size_dots</b>变量中。 如果该行不适合，则从该行中切除一个字符，直到它适合指定大小的矩形。 这发生在<b>while循环中</b> 。 <br><br> 请注意非常重要的一点：输出字符串时， <b>ksText</b>方法的所有参数（锚点的坐标除外）的值均为<i>零</i> 。 事实是<b>ksGetTextLength</b>方法对这些参数一无所知，因此在计算字符串长度时无法将它们考虑在内。 因此，如果字符串的输出使用<b>ksText</b>方法的参数的非零值，则结果字符串长度可能与<b>ksGetTextLength</b>方法获得的字符串长度不同。 <br><br>  <b>结论</b> <br><br> 在本课程中，我们学习了如何使用<b>ksText</b>方法显示简单的文本标签。 这不是显示文本的唯一方法，而是最简单的方法。 在下一课中，我们将研究如何使用此方法输出此复合线。 接下来，我们将考虑更复杂的文本输出方法。 <br><br>  <b>要继续，请关注博客新闻。</b> <br><br> <a href=""><img src="https://habrastorage.org/web/595/eee/f27/595eeef271b24830b3578751fcb52716.png"></a>  Sergey Norseev博士，《在Delphi中进行COMPAS的应用程序开发》一书的作者。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN417723/">https://habr.com/ru/post/zh-CN417723/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN417709/index.html">开发商在哪里以及如何评价其雇主？ IT行业的公司评估服务</a></li>
<li><a href="../zh-CN417711/index.html">在Swift上用俄语读什么？</a></li>
<li><a href="../zh-CN417715/index.html">再见谷歌地图</a></li>
<li><a href="../zh-CN417717/index.html">当地球像2100年所承诺的那样炽热时，地球是什么样的？</a></li>
<li><a href="../zh-CN417721/index.html">GPU解决现代IT问题</a></li>
<li><a href="../zh-CN417725/index.html">Flant如何雇用员工</a></li>
<li><a href="../zh-CN417729/index.html">英特尔酷睿i7-8086K（第2部分）</a></li>
<li><a href="../zh-CN417731/index.html">一架T61的故事</a></li>
<li><a href="../zh-CN417733/index.html">Java 9教程，面向那些必须使用遗留代码的人</a></li>
<li><a href="../zh-CN417735/index.html">公钥基础结构：GnuPG / SMIME和PKCS＃11令牌，支持俄罗斯密码学</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>