<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤˜ğŸ» ğŸ¥ª ğŸ§  RxJavaåˆ°åç¨‹ï¼šç«¯åˆ°ç«¯åŠŸèƒ½è¿ç§» ğŸ˜ ğŸ™ğŸ¼ ğŸ­</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ï¼ˆæœ€åˆåœ¨Mediumä¸Šå‘å¸ƒï¼‰ 

 Kotlinåç¨‹ä¸ä»…ä»…åªæ˜¯è½»é‡çº§çº¿ç¨‹-å®ƒä»¬æ˜¯ä¸€ç§æ–°çš„èŒƒä¾‹ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜ä»¥ç»“æ„åŒ–å’Œæƒ¯ç”¨çš„æ–¹å¼å¤„ç†å¹¶å‘ã€‚ 

 å¼€å‘Androidåº”ç”¨ç¨‹åºæ—¶ï¼Œåº”è€ƒè™‘è®¸å¤šä¸åŒçš„äº‹æƒ…ï¼šä»UIçº¿ç¨‹ä¸­åˆ é™¤é•¿æ—¶é—´è¿è¡Œçš„æ“ä½œï¼Œå¤„ç†ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œå–æ¶ˆè®¢é˜…ï¼Œåˆ‡æ¢å›UIçº¿ç¨‹ä»¥æ›´æ–°ç”¨æˆ·ç•Œé¢ã€‚ åœ¨è¿‡å»...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>RxJavaåˆ°åç¨‹ï¼šç«¯åˆ°ç«¯åŠŸèƒ½è¿ç§»</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483832/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/jb/id/pq/jbidpqpivwqpagw9azop_fswram.png" alt="å›¾ç‰‡"></div><br>  ï¼ˆæœ€åˆåœ¨<a href="https://link.medium.com/OJ7ed2RCd3" rel="nofollow">Mediumä¸Š</a>å‘å¸ƒï¼‰ <br><br>  Kotlinåç¨‹ä¸ä»…ä»…åªæ˜¯è½»é‡çº§çº¿ç¨‹-å®ƒä»¬æ˜¯ä¸€ç§æ–°çš„èŒƒä¾‹ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜ä»¥<a href="https://medium.com/%40elizarov/structured-concurrency-722d765aa952" rel="nofollow">ç»“æ„åŒ–</a>å’Œæƒ¯ç”¨çš„æ–¹å¼å¤„ç†å¹¶å‘ã€‚ <br><br> å¼€å‘Androidåº”ç”¨ç¨‹åºæ—¶ï¼Œåº”è€ƒè™‘è®¸å¤šä¸åŒçš„äº‹æƒ…ï¼šä»UIçº¿ç¨‹ä¸­åˆ é™¤é•¿æ—¶é—´è¿è¡Œçš„æ“ä½œï¼Œå¤„ç†ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œå–æ¶ˆè®¢é˜…ï¼Œåˆ‡æ¢å›UIçº¿ç¨‹ä»¥æ›´æ–°ç”¨æˆ·ç•Œé¢ã€‚ åœ¨è¿‡å»çš„ä¸¤å¹´ä¸­ï¼ŒRxJavaæˆä¸ºè§£å†³è¿™ä¸€ç³»åˆ—é—®é¢˜çš„æœ€å¸¸ç”¨æ¡†æ¶ä¹‹ä¸€ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†æŒ‡å¯¼æ‚¨å®Œæˆä»RxJavaåˆ°åç¨‹çš„ç«¯åˆ°ç«¯åŠŸèƒ½è¿ç§»ã€‚ <br><a name="habracut"></a><br><h4> ç‰¹è‰² </h4><br> æˆ‘ä»¬è¦è½¬æ¢ä¸ºåç¨‹çš„åŠŸèƒ½éå¸¸ç®€å•ï¼šå½“ç”¨æˆ·æäº¤å›½å®¶/åœ°åŒºæ—¶ï¼Œæˆ‘ä»¬ä¼šè¿›è¡ŒAPIè°ƒç”¨ï¼Œä»¥æ£€æŸ¥è¯¥å›½å®¶/åœ°åŒºæ˜¯å¦å¯ä»¥é€šè¿‡<a href="https://www.gov.uk/government/organisations/companies-house" rel="nofollow">Companies House</a>ç­‰æä¾›ç¨‹åºè¿›è¡Œä¸šåŠ¡è¯¦ç»†ä¿¡æ¯æŸ¥è¯¢ã€‚ å¦‚æœå‘¼å«æˆåŠŸï¼Œæˆ‘ä»¬å°†æ˜¾ç¤ºå“åº”ï¼Œå¦åˆ™æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ã€‚ <br><br><h4> è¿å¾™ </h4><br><img src="https://habrastorage.org/webt/j0/0h/kg/j00hkgwjgnuwnzz4lsgdf5ry_fa.png" align="left"><br> æˆ‘ä»¬å°†ä»¥è‡ªä¸‹è€Œä¸Šçš„æ–¹æ³•è¿ç§»ä»£ç ï¼Œä»RetrofitæœåŠ¡å¼€å§‹ï¼Œå†ç§»è‡³å­˜å‚¨åº“å±‚ï¼Œç„¶åç§»è‡³Interactorå±‚ï¼Œæœ€åç§»è‡³ViewModelã€‚ <br><br> å½“å‰è¿”å›Singleçš„å‡½æ•°åº”æˆä¸ºæŒ‚èµ·å‡½æ•°ï¼Œè€Œè¿”å›Observableçš„å‡½æ•°åº”è¿”å›Flowã€‚ åœ¨æ­¤ç‰¹å®šç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä¸å¯¹Flowsåšä»»ä½•äº‹æƒ…ã€‚ <br><br><h4> ç¿»æ–°æœåŠ¡ </h4><br> è®©æˆ‘ä»¬ç›´æ¥è¿›å…¥ä»£ç ï¼Œå¹¶å°†BusinessLookupServiceä¸­çš„businessLookupEligibilityæ–¹æ³•é‡æ„ä¸ºåç¨‹ã€‚ è¿™å°±æ˜¯ç°åœ¨çš„æ ·å­ã€‚ <br><br><pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BusinessLookupService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@GET(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"v1/eligibility"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">businessLookupEligibility</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">@Query(</span></span></span><span class="hljs-meta-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta"><span class="hljs-meta-string">"countryCode"</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">)</span></span></span></span><span class="hljs-function"><span class="hljs-params"> countryCode: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span></span>: Single&lt;NetworkResponse&lt;BusinessLookupEligibilityResponse, ErrorResponse&gt;&gt; }</code> </pre> <br> é‡æ„æ­¥éª¤ï¼š <br><br><ol><li> ä»<a href="" rel="nofollow">2.6.0ç‰ˆ</a>å¼€å§‹ï¼ŒRetrofitæ”¯æŒsuspendä¿®é¥°ç¬¦ã€‚ è®©æˆ‘ä»¬å°†businessLookupEligibilityæ–¹æ³•å˜æˆä¸€ä¸ªæš‚åœå‡½æ•°ã€‚ </li><li> ä»è¿”å›ç±»å‹ä¸­åˆ é™¤SingleåŒ…è£…å™¨ã€‚ </li></ol><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BusinessLookupService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@GET(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"v1/eligibility"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">suspend</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">businessLookupEligibility</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">@Query(</span></span></span><span class="hljs-meta-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta"><span class="hljs-meta-string">"countryCode"</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">)</span></span></span></span><span class="hljs-function"><span class="hljs-params"> countryCode: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span></span>: NetworkResponse&lt;BusinessLookupEligibilityResponse, ErrorResponse&gt; }</code> </pre><br>  NetworkResponseæ˜¯ä¸€ä¸ªå¯†å°çš„ç±»ï¼Œè¡¨ç¤ºBusinessLookupEligibilityResponseæˆ–ErrorResponseã€‚  NetworkResponseæ˜¯åœ¨è‡ªå®šä¹‰Retrofitå‘¼å«é€‚é…å™¨ä¸­æ„é€ çš„ã€‚ è¿™æ ·ï¼Œæˆ‘ä»¬å°†æ•°æ®æµé™åˆ¶ä¸ºä»…ä¸¤ç§å¯èƒ½çš„æƒ…å†µ-æˆåŠŸæˆ–é”™è¯¯ï¼Œå› æ­¤BusinessLookupServiceçš„ä½¿ç”¨è€…æ— éœ€æ‹…å¿ƒå¼‚å¸¸å¤„ç†ã€‚ <br><br><h4> èµ„æ–™åº“ </h4><br> è®©æˆ‘ä»¬ç»§ç»­å‰è¿›ï¼Œçœ‹çœ‹æˆ‘ä»¬åœ¨BusinessLookupRepositoryä¸­æ‹¥æœ‰ä»€ä¹ˆã€‚ åœ¨businessLookupEligibilityæ–¹æ³•ä¸»ä½“ä¸­ï¼Œæˆ‘ä»¬ç§°ä¸ºbusinessLookupService.businessLookupEligibilityï¼ˆæˆ‘ä»¬åˆšåˆšé‡æ„çš„å¯¹è±¡ï¼‰ï¼Œå¹¶ä½¿ç”¨RxJavaçš„mapè¿ç®—ç¬¦å°†NetworkResponseè½¬æ¢ä¸ºResultå¹¶å°†å“åº”æ¨¡å‹æ˜ å°„åˆ°åŸŸæ¨¡å‹ã€‚  Resultæ˜¯å¦ä¸€ä¸ªå¯†å°çš„ç±»ï¼Œå®ƒè¡¨ç¤ºResult.Successï¼Œå¹¶ä¸”å¦‚æœç½‘ç»œè°ƒç”¨æˆåŠŸï¼Œåˆ™åŒ…å«BusinessLookupEligibilityå¯¹è±¡ã€‚ å¦‚æœç½‘ç»œè°ƒç”¨ä¸­å‡ºç°é”™è¯¯ï¼Œååºåˆ—åŒ–å¼‚å¸¸æˆ–å…¶ä»–é”™è¯¯ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æœ‰æ„ä¹‰çš„é”™è¯¯æ¶ˆæ¯ï¼ˆErrorMessageæ˜¯Stringçš„ç±»å‹<a href="https://kotlinlang.org/docs/reference/type-aliases.html" rel="nofollow">åˆ«å</a> ï¼‰æ„é€ Result.Failureã€‚ <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BusinessLookupRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-meta"><span class="hljs-class"><span class="hljs-meta">@Inject</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">constructor</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> businessLookupService: BusinessLookupService, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> businessLookupApiToDomainMapper: BusinessLookupApiToDomainMapper, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> responseToString: Mapper, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> schedulerProvider: SchedulerProvider ) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">businessLookupEligibility</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(countryCode: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Single&lt;Result&lt;BusinessLookupEligibility, ErrorMessage&gt;&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> businessLookupService.businessLookupEligibility(countryCode) .map { response -&gt; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span><span class="hljs-symbol"><span class="hljs-symbol">@map</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (response) { <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> NetworkResponse.Success -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> businessLookupEligibility = businessLookupApiToDomainMapper.map(response.body) Result.Success&lt;BusinessLookupEligibility, ErrorMessage&gt;(businessLookupEligibility) } <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> NetworkResponse.Error -&gt; Result.Failure&lt;BusinessLookupEligibility, ErrorMessage&gt;( responseToString.transform(response) ) } }.subscribeOn(schedulerProvider.io()) } }</code> </pre><br> é‡æ„æ­¥éª¤ï¼š <br><br><ol><li>  businessLookupEligibilityå˜ä¸ºæŒ‚èµ·å‡½æ•°ã€‚ </li><li> ä»è¿”å›ç±»å‹ä¸­åˆ é™¤SingleåŒ…è£…å™¨ã€‚ </li><li> å­˜å‚¨åº“ä¸­çš„æ–¹æ³•é€šå¸¸æ‰§è¡Œé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ï¼Œä¾‹å¦‚ç½‘ç»œè°ƒç”¨æˆ–æ•°æ®åº“æŸ¥è¯¢ã€‚ å­˜å‚¨åº“è´Ÿè´£æŒ‡å®šåº”åœ¨å“ªä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œæ­¤å·¥ä½œã€‚ é€šè¿‡subscriptionOnï¼ˆschedulerProvider.ioï¼ˆï¼‰ï¼‰ï¼Œæˆ‘ä»¬å‘Šè¯‰RxJavaåº”è¯¥åœ¨ioçº¿ç¨‹ä¸Šå®Œæˆå·¥ä½œã€‚ åç¨‹å¦‚ä½•å®ç°ç›¸åŒç›®çš„ï¼Ÿ æˆ‘ä»¬å°†withwithContextä¸ç‰¹å®šçš„è°ƒåº¦ç¨‹åºä¸€èµ·ä½¿ç”¨ï¼Œä»¥å°†å—çš„æ‰§è¡Œè½¬ç§»åˆ°ä¸åŒçš„çº¿ç¨‹ä¸Šï¼Œå¹¶åœ¨æ‰§è¡Œå®Œæˆåè½¬ç§»å›åŸå§‹çš„è°ƒåº¦ç¨‹åºã€‚ æœ€å¥½ä½¿ç”¨withContextç¡®ä¿å‡½æ•°æ˜¯ä¸»å®‰å…¨çš„ã€‚  BusinessLookupRepositoryçš„ä½¿ç”¨è€…ä¸åº”è€ƒè™‘åº”è¯¥ä½¿ç”¨å“ªä¸ªçº¿ç¨‹æ¥æ‰§è¡ŒbusinessLookupEligibilityæ–¹æ³•ï¼Œåº”å®‰å…¨åœ°ä»ä¸»çº¿ç¨‹è°ƒç”¨å®ƒã€‚ </li><li> æˆ‘ä»¬ä¸å†éœ€è¦åœ°å›¾è¿ç®—ç¬¦ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥åœ¨æš‚åœå‡½æ•°çš„ä¸»ä½“ä¸­ä½¿ç”¨businessLookupService.businessLookupEligibilityçš„ç»“æœã€‚ </li></ol><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BusinessLookupRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-meta"><span class="hljs-class"><span class="hljs-meta">@Inject</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">constructor</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> businessLookupService: BusinessLookupService, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> businessLookupApiToDomainMapper: BusinessLookupApiToDomainMapper, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> responseToString: Mapper, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dispatcherProvider: DispatcherProvider ) { <span class="hljs-keyword"><span class="hljs-keyword">suspend</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">businessLookupEligibility</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(countryCode: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Result&lt;BusinessLookupEligibility, ErrorMessage&gt; = withContext(dispatcherProvider.io) { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> response = businessLookupService.businessLookupEligibility(countryCode)) { <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> NetworkResponse.Success -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> businessLookupEligibility = businessLookupApiToDomainMapper.map(response.body) Result.Success&lt;BusinessLookupEligibility, ErrorMessage&gt;(businessLookupEligibility) } <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> NetworkResponse.Error -&gt; Result.Failure&lt;BusinessLookupEligibility, ErrorMessage&gt;( responseToString.transform(response) ) } } }</code> </pre><br><h4> ç‰µè¿å™¨ </h4><br> åœ¨æ­¤ç‰¹å®šç¤ºä¾‹ä¸­ï¼ŒBusinessLookupEligibilityInteractorä¸åŒ…å«ä»»ä½•å…¶ä»–é€»è¾‘ï¼Œå¹¶ç”¨ä½œBusinessLookupRepositoryçš„ä»£ç†ã€‚ æˆ‘ä»¬ä½¿ç”¨è°ƒç”¨<a href="https://kotlinlang.org/docs/reference/operator-overloading.html" rel="nofollow">è¿ç®—ç¬¦é‡è½½ï¼Œ</a>ä»¥ä¾¿å¯ä»¥å°†äº¤äº’å™¨ä½œä¸ºä¸€ä¸ªå‡½æ•°æ¥è°ƒç”¨ã€‚ <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BusinessLookupEligibilityInteractor</span></span></span><span class="hljs-class"> </span><span class="hljs-meta"><span class="hljs-class"><span class="hljs-meta">@Inject</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">constructor</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> businessLookupRepository: BusinessLookupRepository ) { <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(countryCode: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Single&lt;Result&lt;BusinessLookupEligibility, ErrorMessage&gt;&gt; = businessLookupRepository.businessLookupEligibility(countryCode) }</code> </pre><br> é‡æ„æ­¥éª¤ï¼š <br><br><ol><li> æ“ä½œå‘˜æœ‰è¶£çš„è°ƒç”¨å˜ä¸ºæš‚åœæ“ä½œå‘˜æœ‰è¶£çš„è°ƒç”¨ã€‚ </li><li> ä»è¿”å›ç±»å‹ä¸­åˆ é™¤SingleåŒ…è£…å™¨ã€‚ </li></ol><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BusinessLookupEligibilityInteractor</span></span></span><span class="hljs-class"> </span><span class="hljs-meta"><span class="hljs-class"><span class="hljs-meta">@Inject</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">constructor</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> businessLookupRepository: BusinessLookupRepository ) { <span class="hljs-keyword"><span class="hljs-keyword">suspend</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(countryCode: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Result&lt;BusinessLookupEligibility, ErrorMessage&gt; = businessLookupRepository.businessLookupEligibility(countryCode) }</code> </pre><br><h4> è§†å›¾æ¨¡å‹ </h4><br> åœ¨BusinessProfileViewModelä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨è¿”å›Singleçš„BusinessLookupEligibilityInteractorã€‚ æˆ‘ä»¬è®¢é˜…æµå¹¶é€šè¿‡æŒ‡å®šUIè°ƒåº¦ç¨‹åºåœ¨UIçº¿ç¨‹ä¸Šå¯¹å…¶è¿›è¡Œè§‚å¯Ÿã€‚ å¦‚æœæˆåŠŸï¼Œæˆ‘ä»¬ä¼šå°†åŸŸæ¨¡å‹ä¸­çš„å€¼åˆ†é…ç»™businessViewState LiveDataã€‚ å¦‚æœå‡ºç°æ•…éšœï¼Œæˆ‘ä»¬å°†åˆ†é…ä¸€æ¡é”™è¯¯æ¶ˆæ¯ã€‚ <br><br> æˆ‘ä»¬å°†æ¯ä¸ªè®¢é˜…æ·»åŠ åˆ°CompositeDisposableä¸­ï¼Œå¹¶å°†å…¶å¤„ç½®åœ¨ViewModelç”Ÿå‘½å‘¨æœŸçš„onClearedï¼ˆï¼‰æ–¹æ³•ä¸­ã€‚ <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BusinessProfileViewModel</span></span></span><span class="hljs-class"> </span><span class="hljs-meta"><span class="hljs-class"><span class="hljs-meta">@Inject</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">constructor</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> businessLookupEligibilityInteractor: BusinessLookupEligibilityInteractor, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> schedulerProvider: SchedulerProvider ) : ViewModel() { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> disposables = CompositeDisposable() <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> businessViewState: MutableLiveData&lt;ViewState&gt; = LiveDataFactory.createDefault(<span class="hljs-string"><span class="hljs-string">"Loading..."</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCountrySubmit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(country: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Country</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { disposables.add(businessLookupEligibilityInteractor(country.countryCode) .observeOn(schedulerProvider.ui()) .subscribe { state -&gt; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span><span class="hljs-symbol"><span class="hljs-symbol">@subscribe</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (state) { <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Result.Success -&gt; businessViewState.value = state.entity.provider <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Result.Failure -&gt; businessViewState.value = state.failure } }) } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> void onCleared() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCleared(); disposables.clear(); } }</code> </pre><br> é‡æ„æ­¥éª¤ï¼š <br><br><ol><li> åœ¨æœ¬æ–‡çš„å¼€å¤´ï¼Œæˆ‘æåˆ°äº†åç¨‹çš„ä¸»è¦ä¼˜ç‚¹ä¹‹ä¸€-ç»“æ„åŒ–å¹¶å‘ã€‚ è¿™å°±æ˜¯å®ƒå‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚ æ¯ä¸ªåç¨‹éƒ½æœ‰ä¸€ä¸ªèŒƒå›´ã€‚ ç¤ºæ³¢å™¨é€šè¿‡å…¶å·¥ä½œå¯ä»¥æ§åˆ¶åç¨‹ã€‚ å¦‚æœå–æ¶ˆä½œä¸šï¼Œåˆ™ç›¸åº”èŒƒå›´å†…çš„æ‰€æœ‰åç¨‹ä¹Ÿå°†è¢«å–æ¶ˆã€‚ æ‚¨å¯ä»¥è‡ªç”±åˆ›å»ºè‡ªå·±çš„èŒƒå›´ï¼Œä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨ViewModelç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥çš„viewModelScopeã€‚ æˆ‘ä»¬å°†ä½¿ç”¨viewModelScope.launchåœ¨viewModelScopeä¸­å¯åŠ¨ä¸€ä¸ªæ–°çš„åç¨‹ã€‚ åç¨‹å°†åœ¨ä¸»çº¿ç¨‹ä¸­å¯åŠ¨ï¼Œå› ä¸ºviewModelScopeå…·æœ‰é»˜è®¤çš„åˆ†æ´¾å™¨-Dispatchers.Mainã€‚ ä¸€ä¸ªåç¨‹åœ¨Dispatchersä¸Šå¯åŠ¨ï¼ŒMainåœ¨æŒ‚èµ·æ—¶ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚ å½“æˆ‘ä»¬åˆšåˆšå¯åŠ¨äº†åç¨‹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨businessLookupEligibilityInteractoræŒ‚èµ·è¿ç®—ç¬¦å¹¶è·å–ç»“æœã€‚  businessLookupEligibilityInteractorè°ƒç”¨BusinessLookupRepository.businessLookupEligibilityï¼Œè¿™ä¼šå°†æ‰§è¡Œè½¬ç§»åˆ°Dispatchers.IOï¼Œç„¶ååˆè½¬ç§»åˆ°Dispatchers.Mainã€‚ æ­£å¦‚æˆ‘ä»¬åœ¨UIçº¿ç¨‹ä¸­ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ†é…ä¸€ä¸ªå€¼æ¥æ›´æ–°businessViewState LiveDataã€‚ </li><li> ç”±äºviewModelScopeç»‘å®šåˆ°ViewModelç”Ÿå‘½å‘¨æœŸï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ‘†è„±ä¸€æ¬¡æ€§ç”¨å“ã€‚ å¦‚æœæ¸…é™¤ViewModelï¼Œåˆ™åœ¨æ­¤èŒƒå›´å†…å¯åŠ¨çš„æ‰€æœ‰åç¨‹éƒ½ä¼šè‡ªåŠ¨å–æ¶ˆã€‚ </li></ol><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BusinessProfileViewModel</span></span></span><span class="hljs-class"> </span><span class="hljs-meta"><span class="hljs-class"><span class="hljs-meta">@Inject</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">constructor</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> businessLookupEligibilityInteractor: BusinessLookupEligibilityInteractor ) : ViewModel() { <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> businessViewState: MutableLiveData&lt;ViewState&gt; = LiveDataFactory.createDefault(<span class="hljs-string"><span class="hljs-string">"Loading..."</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCountrySubmit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(country: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Country</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { viewModelScope.launch { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> state = businessLookupEligibilityInteractor(country.countryCode)) { <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Result.Success -&gt; businessViewState.value = state.entity.provider <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Result.Failure -&gt; businessViewState.value = state.failure } } } }</code> </pre><br><h4> é‡è¦è¦ç‚¹ </h4><br> è¯»å–å’Œç†è§£ç”¨åç¨‹ç¼–å†™çš„ä»£ç éå¸¸å®¹æ˜“ï¼Œä½†æ˜¯è¿™æ˜¯ä¸€ç§èŒƒå¼è½¬æ¢ï¼Œéœ€è¦ä¸€äº›åŠªåŠ›æ¥å­¦ä¹ å¦‚ä½•ä½¿ç”¨åç¨‹ç¼–å†™ä»£ç ã€‚ <br><br> åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æ²¡æœ‰ä»‹ç»æµ‹è¯•ã€‚ æˆ‘åœ¨ä½¿ç”¨Mockitoæµ‹è¯•åç¨‹æ—¶é‡åˆ°é—®é¢˜ï¼Œå› æ­¤ä½¿ç”¨äº†<a href="https://mockk.io/" rel="nofollow">ockk</a>åº“ã€‚ <br><br> æˆ‘å‘ç°ç”¨Rx Javaç¼–å†™çš„æ‰€æœ‰å†…å®¹éƒ½éå¸¸å®¹æ˜“ä½¿ç”¨åç¨‹ï¼Œ <a href="https://kotlinlang.org/docs/reference/coroutines/flow.html" rel="nofollow">æµ</a>å’Œ<a href="https://kotlinlang.org/docs/reference/coroutines/channels.html" rel="nofollow">é€šé“</a>æ¥å®ç°ã€‚ åç¨‹çš„ä¼˜ç‚¹ä¹‹ä¸€æ˜¯å®ƒä»¬æ˜¯Kotlinè¯­è¨€çš„åŠŸèƒ½ï¼Œå¹¶ä¸”ä¸è¯­è¨€ä¸€èµ·å‘å±•ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN483832/">https://habr.com/ru/post/zh-CN483832/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN483822/index.html">5ä¸ªJavaScriptåŠŸèƒ½ï¼Œå¦‚æœæ²¡æœ‰è¿™äº›åŠŸèƒ½ï¼Œæˆ‘å°†æ— æ³•ç¼–å†™ä»£ç </a></li>
<li><a href="../zh-CN483824/index.html">åœ¨ç ”ç©¶äº†æˆ‘çš„äº”ä¸ªè§„åˆ™åï¼Œå¦‚ä½•å®ç°æ¢¦æƒ³ï¼Œç§¯ææ€è€ƒå¹¶ç»§ç»­å‰è¿›ï¼Ÿ</a></li>
<li><a href="../zh-CN483826/index.html">ä½¿ç”¨Voæ¨¡æ‹Ÿè¾“å‡ºè¿æ¥MH-Z19Bå‹CO2ä¼ æ„Ÿå™¨</a></li>
<li><a href="../zh-CN483828/index.html">é—ªè€€ä¸è´«å›°åŸå­äº¤æ¢</a></li>
<li><a href="../zh-CN483830/index.html">iOSè·¯ç”±ï¼šé€šç”¨å¯¼èˆªï¼Œæ— éœ€é‡å†™åº”ç”¨ç¨‹åº</a></li>
<li><a href="../zh-CN483834/index.html">Debianï¼šåªéœ€å°†i386è½¬æ¢ä¸ºamd64</a></li>
<li><a href="../zh-CN483842/index.html">åˆ›å»ºå®¶åº­äº‘çš„å†å²ã€‚ ç¬¬5éƒ¨åˆ†ã€‚æ›´æ–°2019-PHP 7.2ï¼ŒMariaDB 10.4å’ŒNextcloud 17</a></li>
<li><a href="../zh-CN483844/index.html">åˆ†æä¿„ç½—æ–¯ä¿¡è´·å’Œé‡‘èéƒ¨é—¨ä¿¡æ¯ä¿æŠ¤çš„ç›‘ç®¡æ–‡ä»¶</a></li>
<li><a href="../zh-CN483846/index.html">Linuxä¸Šçš„æ›¿ä»£çª—å£ç®¡ç†</a></li>
<li><a href="../zh-CN483850/index.html">æ²¡æœ‰ç¥çƒ§é”…</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>