<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§˜ğŸ¿ ğŸ” ğŸ‘ğŸ½ Raspberry Pi + CentOS = Wi-Fiçƒ­ç‚¹ï¼ˆæˆ–Red Hatä¸­çš„Raspberry Routerï¼‰ ğŸ‡ ğŸ•¯ï¸ ğŸ›¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="äº’è”ç½‘ä¸Šæœ‰å¤§é‡æœ‰å…³åŸºäºå•æ¿Raspberry PCåˆ›å»ºWi-Fiæ¥å…¥ç‚¹çš„ä¿¡æ¯ã€‚ é€šå¸¸ï¼Œè¿™æ„å‘³ç€å¯¹Raspberry-Raspbianä½¿ç”¨æœ¬æœºæ“ä½œç³»ç»Ÿã€‚ 

 ä½œä¸ºåŸºäºRPMçš„ç³»ç»Ÿçš„æ‹¥æŠ¤è€…ï¼Œæˆ‘æ— æ³•è¶…è¶Šè¿™ä¸ªå°å¥‡è¿¹ï¼Œä¹Ÿæ— æ³•å°è¯•æˆ‘æœ€å–œæ¬¢çš„CentOSã€‚ 

 æœ¬æ–‡æä¾›äº†æœ‰å…³åŸºäºCentOSæ“ä½œç³»ç»Ÿçš„Rasp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Raspberry Pi + CentOS = Wi-Fiçƒ­ç‚¹ï¼ˆæˆ–Red Hatä¸­çš„Raspberry Routerï¼‰</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458994/">äº’è”ç½‘ä¸Šæœ‰å¤§é‡æœ‰å…³åŸºäºå•æ¿Raspberry PCåˆ›å»ºWi-Fiæ¥å…¥ç‚¹çš„ä¿¡æ¯ã€‚ é€šå¸¸ï¼Œè¿™æ„å‘³ç€å¯¹Raspberry-Raspbianä½¿ç”¨æœ¬æœºæ“ä½œç³»ç»Ÿã€‚ <br><br> ä½œä¸ºåŸºäºRPMçš„ç³»ç»Ÿçš„æ‹¥æŠ¤è€…ï¼Œæˆ‘æ— æ³•è¶…è¶Šè¿™ä¸ªå°å¥‡è¿¹ï¼Œä¹Ÿæ— æ³•å°è¯•æˆ‘æœ€å–œæ¬¢çš„CentOSã€‚ <br><br> æœ¬æ–‡æä¾›äº†æœ‰å…³åŸºäºCentOSæ“ä½œç³»ç»Ÿçš„Raspberry Pi 3 Model B +åˆ¶é€ 5GHz / AC Wi-Fiè·¯ç”±å™¨çš„è¯´æ˜ã€‚ å°†æœ‰å‡ ç§æ ‡å‡†çš„ä½†é²œä¸ºäººçŸ¥çš„æŠ€å·§ï¼Œè€Œä¸”è¿˜æœ‰ä¸€ä¸ªå¥½å¤„-è¿æ¥â€œæ ‘è“â€é™„åŠ Wi-Fiè®¾å¤‡çš„å›¾ï¼Œä½¿å®ƒå¯ä»¥åŒæ—¶åœ¨å‡ ç§æ¨¡å¼ä¸‹å·¥ä½œï¼ˆ2.4 + 5GHzï¼‰ã€‚ <br><br><img src="https://habrastorage.org/webt/mp/yb/fz/mpybfz6gzojqkaftnuljhpzx5da.png" alt="å›¾ç‰‡"><br>  <sub><i>ï¼ˆæ¥è‡ªå…è´¹è®¿é—®çš„å›¾åƒæ··åˆï¼‰</i></sub> <br><a name="habracut"></a><br> æˆ‘ä»¬ç«‹å³æ³¨æ„åˆ°ï¼ŒæŸäº›å®‡å®™é€Ÿåº¦å°†ä¸èµ·ä½œç”¨ã€‚ æˆ‘ä»â€œæ ‘è“â€ä¸­æœ€å¤šå‹ç¼©äº†100 Mbitï¼Œè¿™æ¶µç›–äº†Internetæä¾›å•†çš„é€Ÿåº¦ã€‚ ä¸ºä»€ä¹ˆä»ç†è®ºä¸Šè®²ï¼Œå³ä½¿æ˜¯Nï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å¦‚æ­¤ç¼“æ…¢çš„ACï¼Ÿ å¦‚æœæ‚¨é—®è¿™ä¸ªé—®é¢˜ï¼Œè¯·åˆ°å•†åº—è´­ä¹°å¸¦æœ‰å…«ä¸ªå¤–éƒ¨å¤©çº¿çš„çœŸå®è·¯ç”±å™¨ã€‚ <br><br><h1>  0.éœ€è¦ä»€ä¹ˆ </h1><br><ul><li> å®é™…ä¸Šï¼Œè¯¥æœºèŠ¯æœ¬èº«å°±æ˜¯â€œæ ‘è“äº§å“â€ï¼šPi 3 B +å‹ï¼ˆå®ç°ä»¤äººå‚æ¶çš„5GHzé€Ÿåº¦å’Œé€šé“ï¼‰ï¼› <br></li><li> å›ºæ€microSD&gt; = 4GB; <br></li><li> å…·æœ‰microSDè¯»å–å™¨/å†™å…¥å™¨çš„Linuxå·¥ä½œç«™ï¼› <br></li><li>  Linuxä¸­æœ‰è¶³å¤Ÿçš„æŠ€èƒ½ï¼Œæœ¬æ–‡é€‚ç”¨äºå‡†å¤‡çš„Geekï¼› <br></li><li>  Raspberryå’ŒLinuxä¹‹é—´çš„æœ‰çº¿ç½‘ç»œï¼ˆeth0ï¼‰è¿æ¥ï¼Œæœ¬åœ°ç½‘ç»œä¸Šæ­£åœ¨å·¥ä½œçš„DHCPæœåŠ¡å™¨ä»¥åŠä¸¤ä¸ªè®¾å¤‡çš„Internetè®¿é—®ã€‚ <br></li></ul><br> å…³äºæœ€åä¸€ç‚¹çš„ç®€çŸ­è¯„è®ºã€‚  â€œå…ˆå‘ç”Ÿä»€ä¹ˆäº‹ï¼Œä¸€ä¸ªé¸¡è›‹è¿˜æ˜¯â€¦â€¦â€åœ¨æ²¡æœ‰ä»»ä½•äº’è”ç½‘æ¥å…¥è®¾å¤‡çš„æƒ…å†µä¸‹å¦‚ä½•åˆ¶ä½œWi-Fiè·¯ç”±å™¨ï¼Ÿ è®©æˆ‘ä»¬å°†æ­¤å¨±ä¹æ€§ç»ƒä¹ ç•™åœ¨æœ¬æ–‡èŒƒå›´ä¹‹å¤–ï¼Œä»…å‡è®¾Raspberryé€šè¿‡æœ‰çº¿è¿æ¥åˆ°æœ¬åœ°ç½‘ç»œå¹¶ä¸”å¯ä»¥è®¿é—®Internetã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦é¢å¤–çš„ç”µè§†å’Œæ“çºµå™¨æ¥è®¾ç½®æ ‘è“æ´¾ã€‚ <br><br><h1>  1.å®‰è£…CentOS </h1><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é¡¹ç›®é¦–é¡µ</a> <br><br> åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œè®¾å¤‡ä¸ŠCentOSçš„å·¥ä½œç‰ˆæœ¬ä¸º32ä½ã€‚ åœ¨ä¸‡ç»´ç½‘çš„æŸä¸ªåœ°æ–¹ï¼Œæˆ‘é‡åˆ°äº†æœ‰å…³è¿™ç§æ“ä½œç³»ç»Ÿåœ¨64ä½ARMæ¶æ„ä¸Šæ€§èƒ½ä¸‹é™å¤šè¾¾20ï¼…çš„æ„è§ã€‚ æˆ‘å°†å¯¹æ­¤ä¸åŠ è¯„è®ºã€‚ <br><br> åœ¨Linuxä¸Šï¼Œä¸‹è½½å¸¦æœ‰â€œ <b>-RaspberryPI-</b> â€å†…æ ¸çš„æœ€å°æ˜ åƒå¹¶å°†å…¶å†™å…¥microSDï¼š <br><br><pre><code class="plaintext hljs"># xzcat CentOS-Userland-7-armv7hl-RaspberryPI-Minimal-1810-sda.raw.xz | \ dd of=/dev/mmcblk0 bs=4M # sync</code> </pre> <br> ä½¿ç”¨è¯¥æ˜ åƒä¹‹å‰ï¼Œè¯·ä»å…¶ä¸­åˆ é™¤SWAPéƒ¨åˆ†ï¼Œå°†æ ¹ç›®å½•æ‰©å±•åˆ°æ•´ä¸ªå¯ç”¨å·ï¼Œå¹¶æ‘†è„±SELinuxã€‚ ç®—æ³•å¾ˆç®€å•ï¼šæˆ‘ä»¬åœ¨Linuxä¸Šåˆ›å»ºæ ¹çš„å‰¯æœ¬ï¼Œä»microSDåˆ é™¤é™¤ç¬¬ä¸€ä¸ªï¼ˆ/ bootï¼‰ä¹‹å¤–çš„æ‰€æœ‰åˆ†åŒºï¼Œåˆ›å»ºæ–°çš„æ ¹å¹¶ä»å‰¯æœ¬ä¸­è¿”å›å…¶å†…å®¹ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å¿…è¦åŠ¨ä½œçš„ç¤ºä¾‹ï¼ˆè‹›åˆ»çš„æ§åˆ¶å°è¾“å‡ºï¼‰</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># mount /dev/mmcblk0p3 /mnt # cd /mnt # tar cfz ~/pi.tgz . --no-selinux # cd # umount /mnt</code> </pre><br><pre> <code class="plaintext hljs"># parted /dev/mmcblk0 (parted) unit s (parted) print free Model: SD SC16G (sd/mmc) Disk /dev/mmcblk0: 31116288s Sector size (logical/physical): 512B/512B Partition Table: msdos Disk Flags: Number Start End Size Type File system Flags 63s 2047s 1985s Free Space 1 2048s 1370111s 1368064s primary fat32 boot, lba 2 1370112s 2369535s 999424s primary linux-swap(v1) 3 2369536s 5298175s 2928640s primary ext4 5298176s 31116287s 25818112s Free Space (parted) rm 3 (parted) rm 2 (parted) print free Model: SD SC16G (sd/mmc) Disk /dev/mmcblk0: 31116288s Sector size (logical/physical): 512B/512B Partition Table: msdos Disk Flags: Number Start End Size Type File system Flags 63s 2047s 1985s Free Space 1 2048s 1370111s 1368064s primary fat32 boot, lba 1370112s 31116287s 29746176s Free Space (parted) mkpart Partition type? primary/extended? primary File system type? [ext2]? ext4 Start? 1370112s End? 31116287s (parted) set Partition number? 2 Flag to Invert? lba New state? on/[off]? off (parted) print free Model: SD SC16G (sd/mmc) Disk /dev/mmcblk0: 31116288s Sector size (logical/physical): 512B/512B Partition Table: msdos Disk Flags: Number Start End Size Type File system Flags 63s 2047s 1985s Free Space 1 2048s 1370111s 1368064s primary fat32 boot, lba 2 1370112s 31116287s 29746176s primary ext4 (parted) quit</code> </pre><br><pre> <code class="plaintext hljs"># mkfs.ext4 /dev/mmcblk0p2 mke2fs 1.44.6 (5-Mar-2019) /dev/mmcblk0p2 contains a swap file system labelled '_swap' Proceed anyway? (y,N) y Discarding device blocks: done Creating filesystem with 3718272 4k blocks and 930240 inodes Filesystem UUID: 6a1a0694-8196-4724-a58d-edde1f189b31 Superblock backups stored on blocks: 32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208 Allocating group tables: done Writing inode tables: done Creating journal (16384 blocks): done Writing superblocks and filesystem accounting information: done # mount /dev/mmcblk0p2 /mnt # tar xfz ~/pi.tgz -C /mnt --no-selinux</code> </pre><br> è§£å‹æ ¹åˆ†åŒºçš„å†…å®¹åï¼Œæ˜¯æ—¶å€™å¯¹å…¶è¿›è¡Œä¸€äº›æ›´æ”¹äº†ã€‚ <br><br> åœ¨<b>/ mnt / etc / selinux / configä¸­</b>ç¦ç”¨SELinuxï¼š <br><br><pre> <code class="plaintext hljs">SELINUX=disabled</code> </pre><br> æˆ‘ä»¬ç¼–è¾‘<b>/ mnt / etc / fstab</b> ï¼Œåœ¨å…¶ä¸­ä»…ä¿ç•™ä¸¤ä¸ªåˆ†åŒºæ¡ç›®ï¼šbootï¼ˆ/ bootï¼Œæœªæ›´æ”¹ï¼‰å’Œrootï¼ˆæ›´æ”¹UUIDå€¼ï¼Œå¯ä»¥é€šè¿‡åœ¨Linuxä¸Šæ£€æŸ¥blkidå‘½ä»¤çš„è¾“å‡ºæ‰¾åˆ°è¯¥å€¼ï¼‰ï¼š <br><br><pre> <code class="plaintext hljs">UUID=6a1a0694-8196-4724-a58d-edde1f189b31 / ext4 defaults,noatime 0 0 UUID=6938-F4F2 /boot vfat defaults,noatime 0 0</code> </pre><br> æœ€åï¼Œæˆ‘ä»¬æ›´æ”¹å†…æ ¸å¼•å¯¼å‚æ•°ï¼šæŒ‡å®šæ ¹åˆ†åŒºçš„æ–°ä½ç½®ï¼Œç¦ç”¨è°ƒè¯•ä¿¡æ¯çš„è¾“å‡ºï¼Œä»¥åŠï¼ˆå¯é€‰ï¼‰ç¦æ­¢å†…æ ¸åœ¨ç½‘ç»œæ¥å£ä¸Šåˆ†é…IPv6åœ°å€ï¼š <br><br><pre> <code class="plaintext hljs"># cd # umount /mnt # mount /dev/mmcblk0p1 /mnt</code> </pre><br> æˆ‘ä»¬<b>å°†/mnt/cmdline.txtçš„</b>å†…å®¹<b>è½¬æ¢</b>ä¸ºä»¥ä¸‹æ ¼å¼ï¼ˆä¸€è¡Œä¸å¸¦è¿å­—ç¬¦ï¼‰ï¼š <br><br><pre> <code class="plaintext hljs">root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline rootwait quiet ipv6.disable_ipv6=1</code> </pre><br> å®Œæˆï¼š <br><br><pre> <code class="plaintext hljs"># cd # umount /mnt # sync</code> </pre><br></div></div><br> æˆ‘ä»¬åœ¨â€œ Malinkaâ€ä¸­é‡æ–°æ’åˆ—microSDï¼Œè¿è¡Œå®ƒï¼Œå¹¶é€šè¿‡sshï¼ˆæ ¹/ centosï¼‰å¯¹å…¶è¿›è¡Œç½‘ç»œè®¿é—®ã€‚ <br><br><h1>  2.é…ç½®CentOS </h1><br> å‰ä¸‰ä¸ªä¸å¯åŠ¨æ‘‡çš„åŠ¨ä½œï¼š <b>passwd</b> ï¼Œ <b>yum -y update</b> ï¼Œ <b>reboot</b> ã€‚ <br><br> æˆ‘ä»¬å°†ç½‘ç»œç®¡ç†äº¤ç»™ç½‘ç»œåŒ–ï¼š <br><br><pre> <code class="plaintext hljs"># yum install systemd-networkd # systemctl enable systemd-networkd # systemctl disable NetworkManager # chkconfig network off</code> </pre><br> åˆ›å»ºæ–‡ä»¶ï¼ˆä»¥åŠç›®å½•ï¼‰ <b>/etc/systemd/network/eth0.network</b> ï¼š <br><br><pre> <code class="plaintext hljs">[Match] Name=eth0 [Network] DHCP=ipv4</code> </pre><br> æˆ‘ä»¬é‡æ–°å¯åŠ¨â€œæ ‘è“â€ï¼Œç„¶åå†æ¬¡é€šè¿‡sshè·å¾—ç½‘ç»œè®¿é—®æƒé™ï¼ˆIPåœ°å€å¯ä»¥æ›´æ”¹ï¼‰ã€‚ è¯·æ³¨æ„ï¼Œä½¿ç”¨å…ˆå‰ç”±ç½‘ç»œç®¡ç†å™¨åˆ›å»ºçš„<b>/etc/resolv.conf</b> ã€‚ å› æ­¤ï¼Œåœ¨è§£å†³é—®é¢˜æ—¶ï¼Œè¯·ç¼–è¾‘å…¶å†…å®¹ã€‚ æˆ‘ä»¬ä¸ä¼šä½¿ç”¨<b>systemd-resolved</b> ã€‚ <br><br> æˆ‘ä»¬åˆ é™¤äº†â€œå¤šä½™çš„â€ï¼Œä¿®å¤å¹¶åŠ å¿«äº†OSçš„åŠ è½½ï¼š <br><br><pre> <code class="plaintext hljs"># systemctl set-default multi-user.target # yum remove GeoIP Network* aic* alsa* cloud-utils-growpart \ cronie* dhc* firewal* initscripts iwl* kexec* logrotate \ postfix rsyslog selinux-pol* teamd wpa_supplicant</code> </pre><br> è°éœ€è¦<b>cron</b>å’Œè°ä¸æ¶ˆåŒ–å†…ç½®çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">systemdè®¡æ—¶å™¨</a> ï¼Œå¯ä»¥å®‰è£…ç¼ºå°‘çš„å†…å®¹ã€‚  <b>/ var / log-</b>å¹¶æµè§ˆ<b>journalctl</b> ã€‚ å¦‚æœæ‚¨éœ€è¦æ—¥å¿—å†å²è®°å½•ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œä¿¡æ¯ä»…ä»ç³»ç»Ÿå¯åŠ¨æ—¶å¼€å§‹å­˜å‚¨ï¼‰ï¼š <br><br><pre> <code class="plaintext hljs"># mkdir /var/log/journal # systemd-tmpfiles --create --prefix /var/log/journal # systemctl restart systemd-journald # vi /etc/systemd/journald.conf</code> </pre><br><div class="spoiler">  <b class="spoiler_title">ç¦æ­¢æ ¸å¿ƒæœåŠ¡ä½¿ç”¨IPv6ï¼ˆå¦‚æœéœ€è¦ï¼‰</b> <div class="spoiler_text">  <b>/ etc / ssh / sshd_config</b> ï¼š <br><br><pre> <code class="plaintext hljs">AddressFamily inet</code> </pre><br>  <b>/ etc / sysconfig / chronyd</b> ï¼š <br><pre> <code class="plaintext hljs">OPTIONS="-4"</code> </pre><br></div></div><br> æ—¶é—´ä¸â€œæ ‘è“â€çš„ç›¸å…³æ€§å¾ˆé‡è¦ã€‚ ç”±äºâ€œå¼€ç®±å³ç”¨â€ï¼Œæ²¡æœ‰ç¡¬ä»¶åŠŸèƒ½åœ¨é‡æ–°å¯åŠ¨æ—¶ä¿å­˜æ—¶é’Ÿçš„å½“å‰çŠ¶æ€ï¼Œå› æ­¤éœ€è¦åŒæ­¥ã€‚ ä¸€ä¸ªéå¸¸å¥½çš„å¿«é€Ÿå®ˆæŠ¤è¿›ç¨‹<b>chrony</b>å·²ç»å®‰è£…å¹¶è‡ªåŠ¨å¯åŠ¨ã€‚ æ‚¨å¯ä»¥å°†NTPæœåŠ¡å™¨æ›´æ”¹ä¸ºä¸‹ä¸€ä¸ªã€‚ <br><br>  <b>/etc/chrony.conf</b> ï¼š <br><br><pre> <code class="plaintext hljs">server 0.ru.pool.ntp.org iburst server 1.ru.pool.ntp.org iburst server 2.ru.pool.ntp.org iburst server 3.ru.pool.ntp.org iburst</code> </pre><br> æˆ‘ä»¬å°†ä½¿ç”¨<b>æŠ€å·§</b>æ¥è®¾ç½®æ—¶åŒºã€‚ ç”±äºæˆ‘ä»¬çš„ç›®æ ‡æ˜¯åˆ›å»ºä¸€ä¸ªä»¥5GHzé¢‘ç‡è¿è¡Œçš„Wi-Fiè·¯ç”±å™¨ï¼Œå› æ­¤æˆ‘ä»¬å°†æå‰ä¸º<b>ç›‘ç®¡æœºæ„å¸¦æ¥</b>æƒŠå–œï¼š <br><blockquote>  ï¼ƒyum info crda <br> æ‘˜è¦ï¼š802.11æ— çº¿ç½‘ç»œçš„åˆè§„æ€§å®ˆæŠ¤ç¨‹åº <br></blockquote><br> é™¤å…¶ä»–å¤–ï¼Œè¿™ç§æ¶æ„è®¾è®¡ç€çœ¼äºæ—¶åŒºï¼Œâ€œç¦æ­¢â€ä½¿ç”¨ï¼ˆåœ¨ä¿„ç½—æ–¯ï¼‰5GHzé¢‘ç‡å’Œâ€œå¤§â€æ•°å­—é¢‘é“ã€‚ è¯€çªæ˜¯åœ¨ä¸ä½¿ç”¨å¤§é™†/åŸå¸‚åç§°çš„æƒ…å†µä¸‹è®¾ç½®æ—¶åŒºï¼Œè€Œä¸æ˜¯ï¼š <br><br><pre> <code class="plaintext hljs"># timedatectl set-timezone Europe/Moscow</code> </pre><br> æŒ‰ä¸‹ï¼š <br><br><pre> <code class="plaintext hljs"># timedatectl set-timezone Etc/GMT-3</code> </pre><br> æœ€åæ˜¯ç³»ç»Ÿå‘å‹ï¼š <br><br><pre> <code class="plaintext hljs"># hostnamectl set-hostname router</code> </pre><br>  <b>/root/.bash_profile</b> ï¼š <br><br><pre> <code class="plaintext hljs">. . . # User specific environment and startup programs export PROMPT_COMMAND="echo -n $(($(&lt;/sys/class/thermal/thermal_zone0/temp) / 1000))\'C\ " export LANG=en_US.UTF-8 export PATH=$PATH:$HOME/bin</code> </pre><br><h1>  3. CentOSé™„åŠ ç»„ä»¶ </h1><br> ä»¥ä¸Šæ‰€è¿°å¯ä»¥è¢«è§†ä¸ºåœ¨Raspberry Piä¸Šå®‰è£…â€œé¦™è‰â€ CentOSçš„å®Œæ•´è¯´æ˜ã€‚ æ‚¨åº”è¯¥æ‹¥æœ‰ä¸€å°å¯ä»¥åœ¨ä¸åˆ°10ç§’çš„æ—¶é—´å†…é‡æ–°å¯åŠ¨ï¼Œä½¿ç”¨ä¸åˆ°15 MBçš„å†…å­˜å’Œ1.5 GBçš„microSDçš„PCï¼ˆç”±äºä¸å®Œæ•´/å¯åŠ¨ï¼Œå®é™…ä¸Šå°‘äº1 GBï¼Œä½†æ˜¯åˆ°æœ€åæˆ‘ä»¬è¿˜æ˜¯å¾ˆè¯šå®çš„ï¼‰ï¼š <br><img src="https://habrastorage.org/webt/mu/0g/cf/mu0gcfyiokq0x_2dysrb1ieh0ke.jpeg"><br><br><img src="https://habrastorage.org/webt/xx/l3/_g/xxl3_gukovfw0zawwvvy8ua0dtw.jpeg"><br><br><img src="https://habrastorage.org/webt/wt/yc/-9/wtyc-9erdcdx-rvqnnjite7c9ru.jpeg"><br><br> è¦åœ¨æ­¤ç³»ç»Ÿä¸Šå®‰è£…Wi-Fiæ¥å…¥ç‚¹è½¯ä»¶ï¼Œæ‚¨å°†éœ€è¦ç¨å¾®æ‰©å±•æ ‡å‡†CentOSå‘è¡Œç‰ˆçš„åŠŸèƒ½ã€‚ é¦–å…ˆï¼Œâ€œæ³µé€â€å†…ç½®Wi-Fié€‚é…å™¨çš„é©±åŠ¨ç¨‹åºï¼ˆå›ºä»¶ï¼‰ã€‚ é¡¹ç›®ä¸»é¡µä¸Šè¯´ï¼š <br><blockquote>  Raspberry 3Bå’Œ3Bä¸Šçš„Wifi + <br><br>  CentOSé¡¹ç›®ä¸å…è®¸åˆ†å‘Raspberry PI 3B / 3B +å›ºä»¶æ–‡ä»¶ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–‡ç« æ¥äº†è§£é—®é¢˜ï¼Œè·å–å›ºä»¶å¹¶è®¾ç½®wifiã€‚ <br></blockquote><br> æˆ‘ä»¬ç¦æ­¢ä¸ªäººä½¿ç”¨CentOSé¡¹ç›®ä¸èƒ½åšçš„äº‹æƒ…ã€‚ æˆ‘ä»¬ç”¨æ¥è‡ªBroadcomå¼€å‘äººå‘˜çš„ç›¸åº”Wi-Fiå›ºä»¶ï¼ˆé‚£äº›è®¨åŒçš„äºŒè¿›åˆ¶Blob ...ï¼‰æ›¿æ¢äº†CentOSä¸­çš„åˆ†å‘Wi-Fiå›ºä»¶ã€‚ ç‰¹åˆ«æ˜¯ï¼Œè¿™å°†å…è®¸åœ¨æ¥å…¥ç‚¹æ¨¡å¼ä¸‹ä½¿ç”¨ACã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">Wi-Fiå›ºä»¶å‡çº§</b> <div class="spoiler_text"> æˆ‘ä»¬æ‰¾å‡ºè®¾å¤‡çš„å‹å·å’Œå½“å‰å›ºä»¶ç‰ˆæœ¬ï¼š <br><br><pre> <code class="plaintext hljs"># journalctl | grep $(basename $(readlink /sys/class/net/wlan0/device/driver)) Jan 01 04:00:03 router kernel: brcmfmac: F1 signature read @0x18000000=0x15264345 Jan 01 04:00:03 router kernel: brcmfmac: brcmf_fw_map_chip_to_name: using brcm/brcmfmac43455-sdio.bin for chip 0x004345(17221) rev 0x000006 Jan 01 04:00:03 router kernel: usbcore: registered new interface driver brcmfmac Jan 01 04:00:03 router kernel: brcmfmac: brcmf_c_preinit_dcmds: Firmware version = wl0: Mar 1 2015 07:29:38 version 7.45.18 (r538002) FWID 01-6a2c8ad4 Jan 01 04:00:03 router kernel: brcmfmac: brcmf_c_preinit_dcmds: CLM version = API: 12.2 Data: 7.14.8 Compiler: 1.24.9 ClmImport: 1.24.9 Creation: 2014-09-02 03:05:33 Inc Data: 7.17.1 Inc Compiler: 1.26.11 Inc ClmImport: 1.26.11 Creation: 2015-03-01 07:22:34</code> </pre><br> æˆ‘ä»¬çœ‹åˆ°å›ºä»¶ç‰ˆæœ¬ä¸º7.45.18ï¼Œæ—¥æœŸä¸º2015å¹´3æœˆ1æ—¥ï¼Œå¹¶ä¸”æˆ‘ä»¬è®°ä½ä»¥ä¸‹æ•°å­—é›†ï¼š <b>43455</b> ï¼ˆbrcmfmac43455-sdio.binï¼‰ã€‚ <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸‹è½½Raspbiançš„å½“å‰å›¾åƒ</a> ã€‚ æ‡’æƒ°çš„äººå¯ä»¥å°†æ˜ åƒå†™å…¥microSDï¼Œç„¶åä»é‚£é‡Œä½¿ç”¨å›ºä»¶æ‹¾å–æ–‡ä»¶ã€‚ æ‚¨å¯ä»¥åœ¨Linuxä¸­æŒ‚è½½æ˜ åƒçš„æ ¹åˆ†åŒºï¼Œç„¶åä»é‚£é‡Œå¤åˆ¶æ‰€éœ€çš„åˆ†åŒºï¼š <br><br><pre> <code class="plaintext hljs"># wget https://downloads.raspberrypi.org/raspbian_lite_latest # unzip -p raspbian_lite_latest &gt; raspbian.img # fdisk -l raspbian.img Disk raspbian.img: 2 GiB, 2197815296 bytes, 4292608 sectors Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: dos Disk identifier: 0x17869b7d Device Boot Start End Sectors Size Id Type raspbian.img1 8192 532480 524289 256M c W95 FAT32 (LBA) raspbian.img2 540672 4292607 3751936 1.8G 83 Linux # mount -t ext4 -o loop,offset=$((540672 * 512)) raspbian.img /mnt # cp -fv /mnt/lib/firmware/brcm/*43455* ... '/mnt/lib/firmware/brcm/brcmfmac43455-sdio.bin' -&gt; ... '/mnt/lib/firmware/brcm/brcmfmac43455-sdio.clm_blob' -&gt; ... '/mnt/lib/firmware/brcm/brcmfmac43455-sdio.txt' -&gt; ... # umount /mnt</code> </pre><br> å¿…é¡»å¤åˆ¶Wi-Fié€‚é…å™¨ç”Ÿæˆçš„å›ºä»¶æ–‡ä»¶ï¼Œå¹¶æ›¿æ¢ç›®å½•<b>/ usr / lib / firmware / brcm /</b>ä¸­çš„â€œ raspberryâ€ã€‚ <br><br> æˆ‘ä»¬é‡å¯æœªæ¥çš„è·¯ç”±å™¨ï¼Œå¹¶å¾®ç¬‘ç€ï¼š <br><br><pre> <code class="plaintext hljs"># journalctl | grep $(basename $(readlink /sys/class/net/wlan0/device/driver)) Jan 01 04:00:03 router kernel: brcmfmac: F1 signature read @0x18000000=0x15264345 Jan 01 04:00:03 router kernel: brcmfmac: brcmf_fw_map_chip_to_name: using brcm/brcmfmac43455-sdio.bin for chip 0x004345(17221) rev 0x000006 Jan 01 04:00:03 router kernel: usbcore: registered new interface driver brcmfmac Jan 01 04:00:03 router kernel: brcmfmac: brcmf_c_preinit_dcmds: Firmware version = wl0: Feb 27 2018 03:15:32 version 7.45.154 (r684107 CY) FWID 01-4fbe0b04 Jan 01 04:00:03 router kernel: brcmfmac: brcmf_c_preinit_dcmds: CLM version = API: 12.2 Data: 9.10.105 Compiler: 1.29.4 ClmImport: 1.36.3 Creation: 2018-03-09 18:56:28</code> </pre><br> ç‰ˆæœ¬ï¼š2018å¹´2æœˆ27æ—¥çš„7.45.154ã€‚ <br></div></div><br> å½“ç„¶ï¼ŒEPELï¼š <br><br><pre> <code class="plaintext hljs"># cat &gt; /etc/yum.repos.d/epel.repo &lt;&lt; EOF [epel] name=Epel rebuild for armhfp baseurl=https://armv7.dev.centos.org/repodir/epel-pass-1/ enabled=1 gpgcheck=0 EOF # yum clean all # rm -rfv /var/cache/yum # yum update</code> </pre><br><h1>  4.ç½‘ç»œé…ç½®å’Œå³å°†é¢ä¸´çš„æŒ‘æˆ˜ </h1><br> å¦‚ä¸Šæ‰€è¿°ï¼Œâ€œ Malinkaâ€é€šè¿‡â€œç”µçº¿â€è¿æ¥åˆ°æœ¬åœ°ç½‘ç»œã€‚ å‡è®¾æä¾›è€…ä»¥å®Œå…¨ç›¸åŒçš„æ–¹å¼æä¾›Internetè®¿é—®ï¼šå…¬ç”¨ç½‘ç»œä¸Šçš„åœ°å€ç”±DHCPæœåŠ¡å™¨åŠ¨æ€å‘å¸ƒï¼ˆå¯ä»¥é“¾æ¥åˆ°MACï¼‰ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨â€œæ ‘è“â€çš„æœ€ç»ˆè®¾ç½®ä¹‹åï¼Œå°†ä¾›åº”å•†ç”µç¼†â€œæ’å…¥â€å…¶ä¸­å°±è¶³å¤Ÿäº†ï¼Œä¸€åˆ‡å‡†å¤‡å°±ç»ªã€‚ ä½¿ç”¨<b>systemd-networkdè¿›è¡Œ</b>æˆæƒæ˜¯å¦ä¸€ç¯‡æ–‡ç« çš„ä¸»é¢˜ï¼Œæ­¤å¤„ä¸äºˆè€ƒè™‘ã€‚ <br><br>  Raspberryçš„Wi-Fiæ¥å£æ˜¯ä¸€ä¸ªæœ¬åœ°ç½‘ç»œï¼Œå†…ç½®çš„ä»¥å¤ªç½‘é€‚é…å™¨ï¼ˆeth0ï¼‰æ˜¯â€‹â€‹å¤–éƒ¨çš„ã€‚ æˆ‘ä»¬å¯¹æœ¬åœ°ç½‘ç»œè¿›è¡Œé™æ€ç¼–å·ï¼Œä¾‹å¦‚ï¼š192.168.0.0/24ã€‚  Malinkaçš„åœ°å€ï¼š192.168.0.1ã€‚ åœ¨å¤–éƒ¨ç½‘ç»œï¼ˆInternetï¼‰ä¸­ï¼ŒDHCPæœåŠ¡å™¨å°†èµ·ä½œç”¨ã€‚ <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å‘½åçš„ç»Ÿä¸€æ€§é—®é¢˜</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è‘—åçš„å±åœ°é©¬æ‹‰ç¨‹åºå‘˜</a>æ˜¯ä¸¤ä¸ªéº»çƒ¦ï¼Œç­‰å¾…ç€å‚ä¸åœ¨systemdå‘è¡Œç‰ˆä¸­é…ç½®ç½‘ç»œæ¥å£å’ŒæœåŠ¡çš„æ¯ä¸ªäººã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å¹³è¡Œæ··æ²Œï¼ˆæŠ’æƒ…ç¦»é¢˜ï¼‰</b> <div class="spoiler_text">  Lennart Potteringå¾ˆå¥½åœ°å®Œæˆäº†ä»–çš„<b>ç³»ç»Ÿ</b>ç¨‹åºã€‚ è¿™ä¸ª<b>ç³»ç»Ÿ</b>ç¨‹åºå¯åŠ¨å…¶ä»–ç¨‹åºçš„é€Ÿåº¦å¦‚æ­¤ä¹‹å¿«ï¼Œä»¥è‡³äºä»–ä»¬æ²¡æœ‰æ—¶é—´ä»è£åˆ¤çš„å£å“¨ä¸­è„±é¢–è€Œå‡ºï¼Œä¸€å¼€å§‹å°±è·Œè·Œæ’æ’ï¼Œç”šè‡³æ²¡æœ‰å¼€å§‹éšœç¢èµ›ã€‚ <br><br> ä½†æ˜¯ï¼Œä¸¥é‡çš„æ˜¯ï¼Œå¯¹äºç»éªŒä¸°å¯Œçš„ä¸²è¡ŒLSBé©±åŠ¨ç¨‹åºï¼Œåœ¨systemd-OSçš„å¼€å§‹é˜¶æ®µå¯¹å¯åŠ¨çš„è¿›ç¨‹è¿›è¡Œç§¯æçš„å¹¶è¡ŒåŒ–æ˜¯ä¸€ç§â€œé©´æ¡¥â€ã€‚ å¹¸è¿çš„æ˜¯ï¼Œæ•´ç†è¿™ç§â€œå¹³è¡Œæ··ä¹±â€å¾ˆç®€å•ï¼Œå°½ç®¡äº‹å®å¹¶éæ€»æ˜¯å¾ˆæ˜æ˜¾ã€‚ <br></div></div><br> æˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªå…·æœ‰å¸¸é‡åç§°çš„è™šæ‹Ÿç½‘æ¡¥æ¥å£ï¼š <b>lan</b>å’Œ<b>wan</b> ã€‚ æˆ‘ä»¬å°†Wi-Fié€‚é…å™¨â€œè¿æ¥â€åˆ°ç¬¬ä¸€ä¸ªï¼Œå°†â€œæ ‘è“â€çš„eth0è¿æ¥åˆ°ç¬¬äºŒä¸ªã€‚ <br><br>  <b>/etc/systemd/network/lan.netdev</b> ï¼š <br><br><pre> <code class="plaintext hljs">[NetDev] Name=lan Kind=bridge</code> </pre><br>  <b>/etc/systemd/network/lan.network</b> ï¼š <br><br><pre> <code class="plaintext hljs">[Match] Name=lan [Network] Address=192.168.0.1/24 IPForward=yes</code> </pre><br>  <b>/etc/systemd/network/wan.netdev</b> ï¼š <br><br><pre> <code class="plaintext hljs">[NetDev] Name=wan Kind=bridge #MACAddress=xx:xx:xx:xx:xx:xx</code> </pre><br>  <b>/etc/systemd/network/wan.network</b> ï¼š <br><br><pre> <code class="plaintext hljs">[Match] Name=wan [Network] DHCP=ipv4 IPForward=yes</code> </pre><br>  <b>IPForward = yes</b>æ¶ˆé™¤äº†é€šè¿‡sysctlå‘å†…æ ¸æç¤ºä»¥å¯ç”¨è·¯ç”±çš„éœ€æ±‚ã€‚ <br>  <b>MACAddress =</b>å–æ¶ˆæ³¨é‡Šï¼Œå¿…è¦æ—¶è¿›è¡Œæ›´æ”¹ã€‚ <br><br> é¦–å…ˆï¼Œæˆ‘ä»¬è¿æ¥eth0ã€‚ è¯·è®°ä½â€œå‡åŒ€æ€§é—®é¢˜â€ï¼Œå¹¶ä»…ä½¿ç”¨æ­¤æ¥å£çš„MACåœ°å€ï¼Œä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ‰¾åˆ°å®ƒï¼š <br><br><pre> <code class="plaintext hljs"># cat /sys/class/net/eth0/address</code> </pre><br> åˆ›å»º<b>/etc/systemd/network/eth.network</b> ï¼š <br><br><pre> <code class="plaintext hljs">[Match] MACAddress=b8:27:eb:xx:xx:xx [Network] Bridge=wan</code> </pre><br> åˆ é™¤ä»¥å‰çš„eth0é…ç½®æ–‡ä»¶ï¼Œé‡æ–°å¯åŠ¨â€œ raspberryâ€å¹¶è·å¾—ç½‘ç»œè®¿é—®æƒé™ï¼ˆIPåœ°å€å¾ˆå¯èƒ½ä¼šæ›´æ”¹ï¼‰ï¼š <br><br><pre> <code class="plaintext hljs"># rm -fv /etc/systemd/network/eth0.network # reboot</code> </pre><br><h1>  5. DNSMASQ </h1><br> å¯¹äºåˆ¶é€ Wi-Fiæ¥å…¥ç‚¹ï¼Œè¿˜æ²¡æœ‰ä»€ä¹ˆæ¯”<b>dnsmasq</b> + <b>hostapd</b>çš„ç”œèœœå¤«å¦»æ›´å¥½çš„å‘æ˜äº†ã€‚ æˆ‘è®¤ä¸ºã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å¦‚æœæœ‰äººå¿˜è®°äº†ï¼Œé‚£...</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">hostapd</a>å¯ä»¥ç®¡ç†Wi-Fié€‚é…å™¨ï¼ˆç‰¹åˆ«æ˜¯éº»çƒ¦çš„æ˜¯å°†å®ƒä»¬è¿æ¥åˆ°æ ‘è“æ´¾çš„è™šæ‹Ÿ<b>å±€åŸŸç½‘</b> ï¼‰ï¼Œå®ƒå¯ä»¥æˆæƒå’Œæ³¨å†Œæ— çº¿å®¢æˆ·ç«¯ã€‚ <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">dnsmasq-</a>é…ç½®å®¢æˆ·ç«¯çš„ç½‘ç»œå †æ ˆï¼šæä¾›IPåœ°å€ï¼ŒDNSæœåŠ¡å™¨ï¼Œé»˜è®¤ç½‘å…³ç­‰ã€‚ <br></div></div><br> æˆ‘ä»¬ä»dnsmasqå¼€å§‹ï¼š <br><br><pre> <code class="plaintext hljs"># yum install dnsmasq</code> </pre><br> æ¨¡æ¿<b>/etc/resolv.conf</b> ï¼š <br><br><pre> <code class="plaintext hljs">nameserver 1.1.1.1 nameserver 1.0.0.1 nameserver 8.8.8.8 nameserver 8.8.4.4 nameserver 77.88.8.8 nameserver 77.88.8.1 domain router.local search router.local</code> </pre><br> æ ¹æ®è‡ªå·±çš„å–œå¥½è¿›è¡Œç¼–è¾‘ã€‚ <br><br> ç®€çº¦çš„<b>/etc/dnsmasq.conf</b> ï¼š <br><br><pre> <code class="plaintext hljs">domain-needed bogus-priv interface=lan bind-dynamic expand-hosts domain=# dhcp-range=192.168.0.100,192.168.0.199,255.255.255.0,24h conf-dir=/etc/dnsmasq.d</code> </pre><br> è¿™é‡Œçš„â€œé­”æœ¯â€æ˜¯<b>bind-dynamic</b>å‚æ•°ï¼Œå®ƒå‘Šè¯‰dnsmasqå®ˆæŠ¤ç¨‹åºç­‰å¾…<b>interface = lan</b>å‡ºç°åœ¨ç³»ç»Ÿä¸­ï¼Œè€Œä¸æ˜¯åœ¨å¯åŠ¨åå› éª„å‚²çš„å­¤ç‹¬æ”»å‡»è€Œæ™•å€’ã€‚ <br><br><pre> <code class="plaintext hljs"># systemctl enable dnsmasq # systemctl start dnsmasq; journalctl -f</code> </pre><br><h1>  6. HOSTAPD </h1><br> æœ€åï¼Œç¥å¥‡çš„hostapdé…ç½®ã€‚ æˆ‘æ¯«ä¸æ€€ç–‘æœ‰äººæ­£åœ¨é˜…è¯»æœ¬æ–‡ï¼Œä»¥å¯»æ‰¾è¿™äº›å®è´µçš„çº¿ç´¢ã€‚ <br><br> åœ¨å®‰è£…hostapdä¹‹å‰ï¼Œæ‚¨éœ€è¦å¤„ç†â€œä¸€è‡´æ€§é—®é¢˜â€ã€‚ è¿æ¥å…¶ä»–USB Wi-Fiè®¾å¤‡æ—¶ï¼Œå†…ç½®çš„wlan0 Wi-Fié€‚é…å™¨å¯ä»¥è½»æ¾å°†å…¶åç§°æ›´æ”¹ä¸ºwlan1ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¿®å¤æ¥å£çš„åç§°ï¼šæˆ‘ä»¬å°†æä¾›ï¼ˆæ— çº¿ï¼‰é€‚é…å™¨å”¯ä¸€çš„åç§°ï¼Œå¹¶å°†å®ƒä»¬ç»‘å®šåˆ°MACåœ°å€ã€‚ <br><br> å¯¹äºä»ä¸ºwlan0çš„å†…ç½®Wi-Fié€‚é…å™¨ï¼š <br><br><pre> <code class="plaintext hljs"># cat /sys/class/net/wlan0/address b8:27:eb:xx:xx:xx</code> </pre><br> åˆ›å»º<b>/etc/systemd/network/wl0.link</b> ï¼š <br><br><pre> <code class="plaintext hljs">[Match] MACAddress=b8:27:eb:xx:xx:xx [Link] Name=wl0</code> </pre><br> ç°åœ¨æˆ‘ä»¬å¯ä»¥ç¡®å®š<b>wl0</b>æ˜¯å†…ç½®çš„Wi-Fiã€‚ æˆ‘ä»¬é‡æ–°å¯åŠ¨â€œæ ‘è“â€ä»¥æŸ¥çœ‹æ­¤å†…å®¹ã€‚ <br><br> å®‰è£…ï¼š <br><br><pre> <code class="plaintext hljs"># yum install hostapd wireless-tools</code> </pre><br> é…ç½®æ–‡ä»¶<b>/etc/hostapd/hostapd.conf</b> ï¼š <br><br><pre> <code class="plaintext hljs">ssid=rpi wpa_passphrase=1234567890 channel=36 country_code=US interface=wl0 bridge=lan driver=nl80211 auth_algs=1 wpa=2 wpa_key_mgmt=WPA-PSK rsn_pairwise=CCMP macaddr_acl=0 hw_mode=a wmm_enabled=1 # N ieee80211n=1 require_ht=1 ht_capab=[MAX-AMSDU-3839][HT40+][SHORT-GI-20][SHORT-GI-40][DSSS_CCK-40] # AC ieee80211ac=1 require_vht=1 ieee80211d=0 ieee80211h=0 vht_capab=[MAX-AMSDU-3839][SHORT-GI-80] vht_oper_chwidth=1 vht_oper_centr_freq_seg0_idx=42</code> </pre><br> ä¸€åˆ†é’Ÿ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸ä¼š</a>å¿˜è®°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GKChP</a> ï¼Œæˆ‘ä»¬æ›´æ”¹äº†æ‰€éœ€çš„å‚æ•°å¹¶æ‰‹åŠ¨æ£€æŸ¥æ€§èƒ½ï¼š <br><br><pre> <code class="plaintext hljs"># hostapd /etc/hostapd/hostapd.conf</code> </pre><br>  hostapdå°†ä»¥äº¤äº’æ–¹å¼å¯åŠ¨ï¼Œå¹¶å°†å…¶çŠ¶æ€è½¬æ¢ä¸ºæ§åˆ¶å°ã€‚ å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåˆ™æ”¯æŒACæ¨¡å¼çš„å®¢æˆ·ç«¯å¯ä»¥å·²ç»è¿æ¥åˆ°æ¥å…¥ç‚¹ã€‚ åœæ­¢hostapd-Ctrl-Cã€‚ <br><br> å®ƒä»ç„¶éœ€è¦åœ¨ç³»ç»Ÿå¯åŠ¨ä¸­åŒ…å«hostapdã€‚ å¦‚æœæ‚¨ä»¥å¸¸è§„æ–¹å¼æ“ä½œï¼ˆsystemctlå¯ç”¨hostapdï¼‰ï¼Œåˆ™åœ¨ä¸‹æ¬¡é‡æ–°å¯åŠ¨åï¼Œæ‚¨å°†è·å¾—è¯Šæ–­ä¸ºâ€œ <b>æ‰¾ä¸åˆ°wl0æ¥å£</b> â€çš„æ¶é­”çš„â€œè¡€æ¶²ä¸­çš„å®ˆæŠ¤ç¨‹åºâ€ã€‚ ç”±äºâ€œå¹¶è¡Œæ··ä¹±â€ï¼Œhostapdçš„ç¼ ç»•é€Ÿåº¦æ¯”å†…æ ¸æ‰¾åˆ°æ— çº¿é€‚é…å™¨çš„é€Ÿåº¦å¿«ã€‚ <br><br> äº’è”ç½‘ä¸Šå……æ»¡äº†è¯å“ï¼šä»å®ˆæŠ¤ç¨‹åºå¯åŠ¨ä¹‹å‰çš„å¼ºåˆ¶è¶…æ—¶ï¼ˆå‡ åˆ†é’Ÿï¼‰ï¼Œåˆ°ç›‘è§†ç•Œé¢å¤–è§‚å¹¶ï¼ˆé‡æ–°ï¼‰å¯åŠ¨ä¸»æœºæ¿çš„å¦ä¸€ä¸ªå®ˆæŠ¤ç¨‹åºã€‚ è§£å†³æ–¹æ¡ˆéå¸¸æœ‰æ•ˆï¼Œä½†æ˜¯éå¸¸ä¸‘é™‹ã€‚ æˆ‘ä»¬å‘¼åä¼Ÿå¤§çš„<b>ç³»ç»Ÿ</b>ä»¥å…¶â€œç›®æ ‡â€å’Œâ€œ <s>ä»»åŠ¡</s> â€â€œä¾èµ–â€æ¥å¯»æ±‚å¸®åŠ©ã€‚ <br><br> å°†åˆ†å‘æœåŠ¡æ–‡ä»¶å¤åˆ¶åˆ°<b>/etc/systemd/system/hostapd.service</b> ï¼š <br><br><pre> <code class="plaintext hljs"># cp -fv /usr/lib/systemd/system/hostapd.service /etc/systemd/system</code> </pre><br> å¹¶å°†å…¶å†…å®¹è½¬æ¢ä¸ºä»¥ä¸‹æ ¼å¼ï¼š <br><br><pre> <code class="plaintext hljs">[Unit] Description=Hostapd IEEE 802.11 AP, IEEE 802.1X/WPA/WPA2/EAP/RADIUS Authenticator After=sys-subsystem-net-devices-wl0.device BindsTo=sys-subsystem-net-devices-wl0.device [Service] Type=forking PIDFile=/run/hostapd.pid ExecStart=/usr/sbin/hostapd /etc/hostapd/hostapd.conf -P /run/hostapd.pid -B [Install] WantedBy=sys-subsystem-net-devices-wl0.device</code> </pre><br> æ›´æ–°çš„æœåŠ¡æ–‡ä»¶çš„é­”åŠ›åœ¨äºå°†hostapdåŠ¨æ€ç»‘å®šåˆ°æ–°ç›®æ ‡-wl0æ¥å£ã€‚ å½“ç•Œé¢å‡ºç°æ—¶ï¼Œå®ˆæŠ¤ç¨‹åºå¯åŠ¨ï¼›å½“å®ƒæ¶ˆå¤±æ—¶ï¼Œå®ƒåœæ­¢ã€‚ è€Œä¸”å…¨éƒ¨åœ¨çº¿-æ— éœ€é‡æ–°å¯åŠ¨ç³»ç»Ÿã€‚ ç‰¹åˆ«æ˜¯åœ¨è¿æ¥â€œæ ‘è“â€ USB Wi-Fié€‚é…å™¨æ—¶ï¼Œè¯¥æŠ€æœ¯å°†éå¸¸æœ‰ç”¨ã€‚ <br><br> ç°åœ¨æ‚¨å¯ä»¥ï¼š <br><br><pre> <code class="plaintext hljs"># systemctl enable hostapd # reboot</code> </pre><br><h1>  7. IPTABLES </h1><br>  â€œå˜˜â€¦â€¦â€  Â©æ˜¯çš„ï¼Œæ˜¯çš„ï¼ æ²¡æœ‰<b>ç³»ç»Ÿ</b> ã€‚ æ²¡æœ‰æ–°çš„ç»„åˆï¼ˆä»¥<b>firewalld</b>çš„å½¢å¼ï¼‰ï¼Œå®ƒä»¬æœ€ç»ˆä¼šå®Œæˆç›¸åŒçš„æ“ä½œã€‚ <br><br> æˆ‘ä»¬ä½¿ç”¨è‰¯å¥½çš„æ—§<b>iptables</b> ï¼Œå®ƒä»¬çš„æœåŠ¡åœ¨å¯åŠ¨åä¼šå°†ç½‘ç»œè§„åˆ™ä¸Šè½½åˆ°å†…æ ¸ï¼Œå¹¶å®‰é™åœ°å…³é—­ï¼Œè€Œä¸ä¼šä¿ç•™ä¸‹æ¥ï¼Œä¹Ÿä¸ä¼šæ¶ˆè€—èµ„æºã€‚  <b>Systemd</b>æœ‰ä¸€ä¸ªä¼˜é›…çš„<b>IPMasquerade =</b> ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶å°†åœ°å€è½¬æ¢ï¼ˆNATï¼‰å’Œé˜²ç«å¢™å§”æ‰˜ç»™iptablesã€‚ <br><br> å®‰è£…ï¼š <br><br><pre> <code class="plaintext hljs"># yum install iptables-services # systemctl enable iptables ip6tables</code> </pre><br> æˆ‘æ›´å–œæ¬¢å°†iptablesé…ç½®å­˜å‚¨ä¸ºè„šæœ¬ï¼ˆç¤ºä¾‹ï¼‰ï¼š <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash # # Disable IPv6 # ip6tables --flush ip6tables --delete-chain ip6tables --policy INPUT DROP ip6tables --policy FORWARD DROP ip6tables --policy OUTPUT DROP ip6tables-save &gt; /etc/sysconfig/ip6tables systemctl restart ip6tables # # Cleaning # iptables -F iptables -X iptables -t nat -F iptables -t nat -X iptables -t mangle -F iptables -t mangle -X iptables -P INPUT DROP iptables -P OUTPUT ACCEPT iptables -P FORWARD ACCEPT # # Loopback, lan # iptables -A INPUT -i lo -j ACCEPT iptables -A INPUT -i lan -j ACCEPT # # Ping, Established # iptables -A INPUT -p icmp --icmp-type echo-request -j ACCEPT iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT # # NAT # iptables -t nat -A POSTROUTING -o wan -j MASQUERADE # # Saving # iptables-save &gt; /etc/sysconfig/iptables systemctl restart iptables</span></span></code> </pre><br> æˆ‘ä»¬æ‰§è¡Œä¸Šè¿°è„šæœ¬ï¼Œå¹¶å¤±å»äº†ä¸â€œ Malinkaâ€å»ºç«‹æ–°çš„æœ‰çº¿sshè¿æ¥çš„åŠŸèƒ½ã€‚ æ²¡é”™ï¼Œæˆ‘ä»¬åˆ¶é€ äº†ä¸€ä¸ªWi-Fiè·¯ç”±å™¨ï¼Œé»˜è®¤æƒ…å†µä¸‹ç¦æ­¢â€œé€šè¿‡Internetâ€è®¿é—®è¯¥è·¯ç”±å™¨ï¼Œç°åœ¨åªèƒ½â€œé€šè¿‡ç©ºä¸­â€è®¿é—®ã€‚ æˆ‘ä»¬å°†æä¾›å•†çš„ç”µç¼†è¿æ¥åˆ°ä»¥å¤ªç½‘ï¼Œç„¶åå¼€å§‹å†²æµªï¼ <br><br><h1>  8.å¥–é‡‘ï¼š+ 2.4GHz </h1><br> å½“æˆ‘ä»ä¸Šè¿°é™„å›¾ç»„è£…ç¬¬ä¸€ä¸ªRaspberryè·¯ç”±å™¨æ—¶ï¼Œæˆ‘å‘ç°å®¶é‡Œæœ‰å¾ˆå¤šå°å·¥å…·ï¼Œç”±äºå®ƒä»¬çš„è®¾è®¡é™åˆ¶ï¼ŒWi-Fiæ ¹æœ¬çœ‹ä¸åˆ°â€œæ ‘è“â€ã€‚ é‡æ–°é…ç½®è·¯ç”±å™¨ä»¥ä½¿å…¶åœ¨802.11b / g / nä¸­å·¥ä½œå¹¶ä¸åƒä½“è‚²ä¸“å®¶é‚£æ ·ï¼Œå› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹â€œç©ºä¸­â€çš„æœ€å¤§é€Ÿåº¦ä¸è¶…è¿‡40 Mbpsï¼Œè€Œæˆ‘æœ€å–œæ¬¢çš„Internetæä¾›å•†é€šè¿‡ç”µç¼†å‘æˆ‘æä¾›äº†100ã€‚ <br><br> å®é™…ä¸Šï¼Œå·²ç»å‘æ˜äº†è§£å†³è¯¥é—®é¢˜çš„æ–¹æ³•ï¼šç¬¬äºŒä¸ªå·¥ä½œåœ¨2.4GHzçš„Wi-Fiæ¥å£å’Œç¬¬äºŒä¸ªæ¥å…¥ç‚¹ã€‚ åœ¨æœ€è¿‘çš„æ‘Šä½ä¸Šï¼Œæˆ‘ä¹°çš„ä¸æ˜¯ç¬¬äºŒä¸ªï¼Œè€Œæ˜¯ç¬¬äºŒä¸ªUSB Wi-Fiâ€œå“¨å£°â€ã€‚ å…³äºèŠ¯ç‰‡ç»„ï¼Œä¸Linux ARMå†…æ ¸çš„å…¼å®¹æ€§ä»¥åŠåœ¨APæ¨¡å¼ä¸‹å·¥ä½œçš„å¯èƒ½æ€§ï¼ˆä»–ç¬¬ä¸€æ¬¡æˆç«‹ï¼‰çš„é—®é¢˜å›°æ‰°ç€å–æ–¹ã€‚ <br><br> æˆ‘ä»¬ä»¥ç±»ä¼¼äºå†…ç½®Wi-Fié€‚é…å™¨çš„æ–¹å¼æ¥é…ç½®â€œ whistleâ€ã€‚ <br><br> é¦–å…ˆï¼Œå°†å…¶é‡å‘½åä¸º<b>wl1</b> ï¼š <br><br><pre> <code class="plaintext hljs"># cat /sys/class/net/wlan0/address b0:6e:bf:xx:xx:xx</code> </pre><br>  <b>/etc/systemd/network/wl1.link</b> ï¼š <br><br><pre> <code class="plaintext hljs">[Match] MACAddress=b0:6e:bf:xx:xx:xx [Link] Name=wl1</code> </pre><br> æˆ‘ä»¬å°†æŠŠæ–°Wi-Fiæ¥å£çš„ç®¡ç†å§”æ‰˜ç»™å•ç‹¬çš„hostapdå®ˆæŠ¤ç¨‹åºï¼Œè¯¥å®ˆæŠ¤ç¨‹åºå°†æ ¹æ®ç³»ç»Ÿä¸­æ˜¯å¦å­˜åœ¨ä¸¥æ ¼å®šä¹‰çš„â€œ whistleâ€ï¼ˆwl1ï¼‰æ¥å¯åŠ¨å’Œåœæ­¢ã€‚ <br><br> é…ç½®æ–‡ä»¶<b>/etc/hostapd/hostapd2.conf</b> ï¼š <br><br><pre> <code class="plaintext hljs">ssid=rpi2 wpa_passphrase=1234567890 #channel=1 #channel=6 channel=11 interface=wl1 bridge=lan driver=nl80211 auth_algs=1 wpa=2 wpa_key_mgmt=WPA-PSK rsn_pairwise=CCMP macaddr_acl=0 hw_mode=g wmm_enabled=1 # N ieee80211n=1 require_ht=1 ht_capab=[HT40][SHORT-GI-20][SHORT-GI-40][DSSS_CCK-40]</code> </pre><br> è¯¥æ–‡ä»¶çš„å†…å®¹ç›´æ¥å–å†³äºUSB Wi-Fié€‚é…å™¨çš„å‹å·ï¼Œå› æ­¤ç®€å•çš„å¤åˆ¶/ç²˜è´´æ“ä½œä¼šè®©æ‚¨å¤±æœ›ã€‚ <br><br> å°†åˆ†å‘æœåŠ¡æ–‡ä»¶å¤åˆ¶åˆ°<b>/etc/systemd/system/hostapd2.service</b> ï¼š <br><br><pre> <code class="plaintext hljs"># cp -fv /usr/lib/systemd/system/hostapd.service /etc/systemd/system/hostapd2.service</code> </pre><br> å¹¶å°†å…¶å†…å®¹è½¬æ¢ä¸ºä»¥ä¸‹æ ¼å¼ï¼š <br><br><pre> <code class="plaintext hljs">[Unit] Description=Hostapd IEEE 802.11 AP, IEEE 802.1X/WPA/WPA2/EAP/RADIUS Authenticator After=sys-subsystem-net-devices-wl1.device BindsTo=sys-subsystem-net-devices-wl1.device [Service] Type=forking PIDFile=/run/hostapd2.pid ExecStart=/usr/sbin/hostapd /etc/hostapd/hostapd2.conf -P /run/hostapd2.pid -B [Install] WantedBy=sys-subsystem-net-devices-wl1.device</code> </pre><br> å®ƒä»ç„¶åŒ…å«äº†hostapdçš„æ–°å®ä¾‹ï¼š <br><br><pre> <code class="plaintext hljs"># systemctl enable hostapd2</code> </pre><br> ä»…æ­¤è€Œå·²ï¼ å¹å£å“¨å’Œè¦†ç›†å­æœ¬èº«ï¼Œçœ‹çœ‹å‘¨å›´çš„æ— çº¿ç½‘ç»œã€‚ <br><br> æœ€åï¼Œæˆ‘æƒ³è­¦å‘Šä¸€ä¸‹USB Wi-Fié€‚é…å™¨å’ŒRaspberryç”µæºçš„è´¨é‡ã€‚ è¿æ¥åˆ°â€œçƒ­å“¨â€ï¼Œæœ‰æ—¶ä¼šå› çŸ­æœŸç”¨ç”µæ•…éšœè€Œå¼•èµ·â€œæ ‘è“æŒ‚â€ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN458994/">https://habr.com/ru/post/zh-CN458994/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN458984/index.html">å¦‚ä½•åˆ›å»ºç¬¬ä¸€ä¸ªäº¤æ˜“æ‰€äº¤æ˜“åº”ç”¨ç¨‹åºï¼š3ä¸ªåˆå§‹æ­¥éª¤</a></li>
<li><a href="../zh-CN458986/index.html">PostgreSQLé£Ÿè°±ï¼šä»HTMLå’ŒURLè½¬æ¢ä¸ºPDFå’ŒPS</a></li>
<li><a href="../zh-CN458988/index.html">çº¹ç†ï¼Œæˆ–æˆä¸ºSurface Artistæ‰€éœ€è¦äº†è§£çš„çŸ¥è¯†ã€‚ ç¬¬4éƒ¨åˆ†ã€‚æ¨¡å‹ï¼Œæ³•çº¿å’Œæ‰«æ</a></li>
<li><a href="../zh-CN458990/index.html">ä¸å†çƒ­è¡·äºä»£ç ä¸­çš„æ³¨é‡Š</a></li>
<li><a href="../zh-CN458992/index.html">æ³¨æ„å‡è£…å’Œåœ¨Kerasä¸­çš„å®æ–½</a></li>
<li><a href="../zh-CN458996/index.html">ç”¨æˆ·Inyerface-å¦‚ä½•ä¸æŠ˜ç£¨ç”¨æˆ·</a></li>
<li><a href="../zh-CN459000/index.html">æˆ‘å¦‚ä½•å°è¯•æ”¹å–„Halo 2ï¼Œä½†å‡ ä¹æ¯äº†å®ƒ</a></li>
<li><a href="../zh-CN459002/index.html">å¦‚ä½•é…ç½®HTTPS-SSLé…ç½®ç”Ÿæˆå™¨å°†æœ‰æ‰€å¸®åŠ©</a></li>
<li><a href="../zh-CN459004/index.html">èš±hopperå¯†ç ç®—æ³•ï¼šå¤æ‚</a></li>
<li><a href="../zh-CN459012/index.html">ä»å¤´å¼€å§‹ä¸ºBitrix24åˆ›å»ºåº”ç”¨ç¨‹åº</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>