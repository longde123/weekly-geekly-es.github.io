<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐๏ธ โฝ๏ธ ๐ถ๐พ ููููุฉ ุฌุนู ุงูุฑูุจูุช ุงูุฐู ูุญูู ุงูุตูุฑุฉ ุฅูู ููุงูู. ุงูุฌุฒุก ุงูุซุงูุซ. ูุฌุงูุง ุฎุงุฏู + GPU ูููุฐุฌ ุงุณุชุถุงูุฉ ๐๐พ ๐ฒ ๐๏ธ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="โจ ุงูุฌุฒุก 1 
 โจ ุงูุฌุฒุก 2 


 ุญุณูุง ุ ุงุณุชุฑุงุญ ููุฐุง ูููู. ุงููุง ุจุนูุฏุชู 


 ูู ุงูุณูุณูุฉ ุงูุณุงุจูุฉ ุ ููุช ุฃูุช ูุฃูุง ุจุฌูุน ุงูุจูุงูุงุช ูุชุฏุฑูุจ ูููุฐุฌูุง ุงูุฃูู. 
 ุซู ุ ูุฑุนูุจู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ููููุฉ ุฌุนู ุงูุฑูุจูุช ุงูุฐู ูุญูู ุงูุตูุฑุฉ ุฅูู ููุงูู. ุงูุฌุฒุก ุงูุซุงูุซ. ูุฌุงูุง ุฎุงุฏู + GPU ูููุฐุฌ ุงุณุชุถุงูุฉ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485824/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  <a href="https://habr.com/ru/post/479218/">โจ ุงูุฌุฒุก 1</a> <br>  <a href="https://habr.com/ru/post/483168/">โจ ุงูุฌุฒุก 2</a> </p><br><p style=";text-align:right;direction:rtl">  ุญุณูุง ุ ุงุณุชุฑุงุญ ููุฐุง ูููู.  ุงููุง ุจุนูุฏุชู </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูุณูุณูุฉ ุงูุณุงุจูุฉ ุ ููุช ุฃูุช ูุฃูุง ุจุฌูุน ุงูุจูุงูุงุช ูุชุฏุฑูุจ ูููุฐุฌูุง ุงูุฃูู. <br>  ุซู ุ ูุฑุนูุจูู ุจุงููุชุงุฆุฌ ุ ุฏุฑุจูุง ุฃูุซุฑ ูู ุนุดุฑุฉ. <br>  ุญุงู ุงูููุช ูุงุธูุงุฑ ุฎูููุง ููุนุงูู! <a name="habracut"></a></p><br><h2 id="eksport-modeli" style=";text-align:right;direction:rtl">  ูููุฐุฌ ุงูุชุตุฏูุฑ </h2><br><p style=";text-align:right;direction:rtl">  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ุณูููู ุจุฅุนุงุฏุฉ ุญูุธ ุทุฑุงุฒ ุงููููุฏ ุจุชูุณูู ููุงุณุจ ุญุชู ูุง ูุถุทุฑ ุฅูู ุณุญุจ ุฅุนูุงูุงุช ุงููุฆุฉ ุฅูู ุงูุงุณุชุถุงูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุจุฅูุดุงุก ููู ุตุบูุฑ ุจููุญู * .py ูุงูุณุฎ ุงูููุฏ ูู ุฃุณูู ุงูููุณุฏ ุฃุฏูุงู ููู. <br>  ููููู jit.py: </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุชู ูุณุฎ ุงูููุฏ ุจุฏูู ุชูููุฑ ุนู ุทุฑูู ุงุณุชุจุฏุงู ุงููุณุงุฑ ุ output_path ุจุทุฑููุชู ุงูุฎุงุตุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#  path       #    *G_A.pth -   -&gt;  # output_path -      #      *.jit,  -  ,     path= '/checkpoints/resnet9_nowd_nodo_128to400_c8/60_net_G_A.pth' output_path ='/checkpoints/resnet9_nowd_nodo_128to400_c8/resnet9_nowd_nodo_128to400_c8_160-50-60_1.jit' import torch from torch import nn class ResnetGenerator(nn.Module): """Resnet-based generator that consists of Resnet blocks between a few downsampling/upsampling operations. We adapt Torch code and idea from Justin Johnson's neural style transfer project(https://github.com/jcjohnson/fast-neural-style) """ def __init__(self, input_nc, output_nc, ngf=64, norm_layer=nn.BatchNorm2d, use_dropout=False, n_blocks=6, padding_type='reflect'): """Construct a Resnet-based generator Parameters: input_nc (int) -- the number of channels in input images output_nc (int) -- the number of channels in output images ngf (int) -- the number of filters in the last conv layer norm_layer -- normalization layer use_dropout (bool) -- if use dropout layers n_blocks (int) -- the number of ResNet blocks padding_type (str) -- the name of padding layer in conv layers: reflect | replicate | zero """ assert(n_blocks &gt;= 0) super(ResnetGenerator, self).__init__() if type(norm_layer) == functools.partial: use_bias = norm_layer.func == nn.InstanceNorm2d else: use_bias = norm_layer == nn.InstanceNorm2d model = [nn.ReflectionPad2d(3), nn.Conv2d(input_nc, ngf, kernel_size=7, padding=0, bias=use_bias), norm_layer(ngf), nn.ReLU(True)] n_downsampling = 2 for i in range(n_downsampling): # add downsampling layers mult = 2 ** i model += [nn.Conv2d(ngf * mult, ngf * mult * 2, kernel_size=3, stride=2, padding=1, bias=use_bias), norm_layer(ngf * mult * 2), nn.ReLU(True)] mult = 2 ** n_downsampling for i in range(n_blocks): # add ResNet blocks model += [ResnetBlock(ngf * mult, padding_type=padding_type, norm_layer=norm_layer, use_dropout=use_dropout, use_bias=use_bias)] for i in range(n_downsampling): # add upsampling layers mult = 2 ** (n_downsampling - i) model += [nn.ConvTranspose2d(ngf * mult, int(ngf * mult / 2), kernel_size=3, stride=2, padding=1, output_padding=1, bias=use_bias), norm_layer(int(ngf * mult / 2)), nn.ReLU(True)] model += [nn.ReflectionPad2d(3)] model += [nn.Conv2d(ngf, output_nc, kernel_size=7, padding=0)] model += [nn.Tanh()] self.model = nn.Sequential(*model) def forward(self, input): """Standard forward""" return self.model(input) class ResnetBlock(nn.Module): """Define a Resnet block""" def __init__(self, dim, padding_type, norm_layer, use_dropout, use_bias): """Initialize the Resnet block A resnet block is a conv block with skip connections We construct a conv block with build_conv_block function, and implement skip connections in &lt;forward&gt; function. Original Resnet paper: https://arxiv.org/pdf/1512.03385.pdf """ super(ResnetBlock, self).__init__() self.conv_block = self.build_conv_block(dim, padding_type, norm_layer, use_dropout, use_bias) def build_conv_block(self, dim, padding_type, norm_layer, use_dropout, use_bias): """Construct a convolutional block. Parameters: dim (int) -- the number of channels in the conv layer. padding_type (str) -- the name of padding layer: reflect | replicate | zero norm_layer -- normalization layer use_dropout (bool) -- if use dropout layers. use_bias (bool) -- if the conv layer uses bias or not Returns a conv block (with a conv layer, a normalization layer, and a non-linearity layer (ReLU)) """ conv_block = [] p = 0 if padding_type == 'reflect': conv_block += [nn.ReflectionPad2d(1)] elif padding_type == 'replicate': conv_block += [nn.ReplicationPad2d(1)] elif padding_type == 'zero': p = 1 else: raise NotImplementedError('padding [%s] is not implemented' % padding_type) conv_block += [nn.Conv2d(dim, dim, kernel_size=3, padding=p, bias=use_bias), norm_layer(dim), nn.ReLU(True)] if use_dropout: conv_block += [nn.Dropout(0.5)] p = 0 if padding_type == 'reflect': conv_block += [nn.ReflectionPad2d(1)] elif padding_type == 'replicate': conv_block += [nn.ReplicationPad2d(1)] elif padding_type == 'zero': p = 1 else: raise NotImplementedError('padding [%s] is not implemented' % padding_type) conv_block += [nn.Conv2d(dim, dim, kernel_size=3, padding=p, bias=use_bias), norm_layer(dim)] return nn.Sequential(*conv_block) def forward(self, x): """Forward function (with skip connections)""" out = x + self.conv_block(x) # add skip connections return out import functools norm_layer = functools.partial(nn.InstanceNorm2d, affine=False, track_running_stats=False) model = ResnetGenerator(3,3,64, norm_layer=norm_layer, use_dropout=False, n_blocks=9) model.load_state_dict(torch.load(path)) model.eval() model.cuda() model.half() trace_input = torch.ones(1,3,256,256).cuda() model = model.eval() jit_model = torch.jit.trace(model.float(), trace_input) torch.jit.save(jit_model, output_path)</span></span></code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ุงุณุชุจุฏุงู ุงููุชุบูุฑุงุช ุงูุฎุงุตุฉ ุจู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>ุงููุณุงุฑ</strong> - ุงููุณุงุฑ ุฅูู ูููุฐุฌ ุงูุชูุฑุงุฑ ุงูุฐู ุชุฑูุฏู. <br>  ูุญู ุจุญุงุฌุฉ ุฅูู ููู * G_A.pth - ูููุฏ ุงูุตูุฑ -&gt; ุงููุชุงุจ ุงููุฒูู. </li><li style=";text-align:right;direction:rtl">  <strong>output_path</strong> - ุงุณู ููู ุงููููุฐุฌ ุงูุฐู ุชู ุชุตุฏูุฑู ุ ูููู ุฃู ูููู ุฃู ุดูุก ุจุงูุงูุชุฏุงุฏ *. ุฌูุช ุ ุงูุดูุก ุงูุฑุฆูุณู ูู ุนุฏู ูุณูุงู ุงูููุงู ุงูุฐู ุญูุธูุงู ููู. </li></ul><br><blockquote style=";text-align:right;direction:rtl">  ููุณ ูู ุงูุถุฑูุฑู ุชุตุฏูุฑ ุงููููุฏ ูู ุงูุญูุจุฉ ุงูุฃุฎูุฑุฉ ูู ุงูุชุฏุฑูุจ ุ ุฎุฐ ุงูุฐู ุชุฑุบุจ ูู ุชุญููู ูุชุงุฆุฌ ุฃูุซุฑ. </blockquote><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฐูู ุ ุงูุชูู ุฅูู ูุญุฏุฉ ุงูุชุญูู ุ ุงูุชูู ุฅูู ุงููุฌูุฏ ูุน ููููุง ูุงููุชุงุจุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">python jit.py</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููููุง!  ุงููููุฐุฌ ุฌุงูุฒ ููุชุนุฑู ุนูู ุงูุนุงูู ุงูุฎุงุฑุฌู. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุฒูุฏ ูู ุงููุนูููุงุช ุญูู ุงูุดุนูุฉ ุฌูุช</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุงููุซุงุฆู: <a href="https://pytorch.org/docs/stable/jit.html" rel="nofollow">https://pytorch.org/docs/stable/jit.html</a> <br>  ุจุงุฎุชุตุงุฑ ุ ูุชูุญ ูู ุงูุชุตุฏูุฑ ุฅูู jit ุฅุฌุฑุงุก ุชุณูุณู ูููููุฐุฌ ูุนุฏู ุงูุณุญุจ ุนูู ุทูู ุจูุฆุฉ ุงูุซุนุจุงู ุ ูุฌููุน ุงูุชุจุนูุงุช ูุงููุญุฏุงุช ุงูุฎุงุฑุฌูุฉ ุงูุชู ููููู ุงุณุชุฎุฏุงููุง.  ุจุงุณุชุซูุงุก ุงูุดุนูุฉ ุ ุจุงูุทุจุน. <br>  ุนูู ุงูุฑุบู ูู ุฃููุง ุณูุณุชุถูููุง ูู ุจูุฆุฉ ุจูุซูู ุ ุฅูุง ุฃูู ูููู ุงุณุชุฎุฏุงู ููุงุฐุฌ jit ูู ุงูุชุทุจููุงุช ุงููุณุชููุฉ. </p></div></div><br><h2 id="vybor-hostinga" style=";text-align:right;direction:rtl">  ุงุฎุชูุงุฑ ุงุณุชุถุงูุฉ </h2><br><blockquote style=";text-align:right;direction:rtl">  ุณุฃููู ุตุฑูุญุง ููุบุงูุฉ ูุฃุนุชุฑู ุนูู ุงูููุฑ: ููุฏ ุชููู ุนุดุงู ุงูุชุนูู ุงูุฏุงุฎูู ุงูุนููู ูู ููุงู ูุง ูู ุงูุณุงุนุฉ ุงูุซุงููุฉ ูู ุงุณุชูุดุงู ุฅููุงููุงุช ุงูุงุณุชุถุงูุฉ ุจุฏุนู GPU.  ูุฅุฐุง ุฃุฎุจุฑูู ุดุฎุต ูุง ุจุงุณุชุถุงูุฉ ุฎุงุฏู GPU ุบูุฑ ููููุฉ ุ ูุณุฃููู ุฃูุซุฑ ูู ููุชู. </blockquote><p style=";text-align:right;direction:rtl">  ูู ุฃุฎุทุท ููุฏูุน ููุงุจู ุฎุงุฏู ูุชูุงูู ูุชุฌุงุฑุจู ุ ูุฐูู ููุช ุฃุจุญุซ ููุท ุนู ุญููู ุจุฏูู ุฎุงุฏู. </p><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุงูุชุญุงู ุงูุฒุญู ุนูู ุฎุทุท ุงูุชุนุฑููุฉ ุงููุชุนุฏุฏุฉ ุงูุตูุญุงุช ุงูุฎุงุตุฉ ุจู Google ู Amazon ุ ููุน ุงุฎุชูุงุฑู ุนูู algorithmia.com </p><br><p style=";text-align:right;direction:rtl">  ููุงู ุนุฏุฉ ุฃุณุจุงุจ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูุนุฏ <strong>IDE Web</strong> ูุซุงูููุง ููุฏูู ุ ูุฅู ูุงู ุจุทูุฆูุง ููุบุงูุฉ ุ ูุฃูู ูุชุนูู ุนููู ุงูุงูุชุธุงุฑ ุญุชู ููุชูู ุงูุฅูุดุงุก ููุชุญูู.  ุฎุงุฑุฌ ูุฐุง ุงูุจุฑูุงูุฌ ุงูุชุนูููู ุ ุฃูุตู ุจุงุฎุชุจุงุฑ ูู ุดูุก ูุญูููุง ุ ุญูุซ ุชุญุฏุซ ูุนุธู ุงูุฃุฎุทุงุก ูู ูุฑุญูุฉ ุชูุฒูู ุงููููุงุช ูุญูุธูุง. </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  <strong>ุงูุญุฏ ุงูุฃุฏูู ูุนุฏุฏ ุงูุฎูุงุฑุงุช</strong> - ูู ุงูุตุนุจ ุฃู ุชููุช ูู ุงูุดูุฎูุฎุฉ ุงููุจูุฑุฉ ุ ุฏูู ูุฑุงุกุฉ ูุงุฆูุฉ ุงูุฎูุงุฑุงุช ุญุชู ุงูููุงูุฉ. </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  <strong>ุญุณููุง ุ ุงูุญุฌุฉ ุงูุฃุฎูุฑุฉ</strong> - ููุญู ูุตู ุนุงู ูู ุงูุชุฌุงุฑุจ ุ ูุง ุฒูุช ูู ุฃููู ุฑุตูุฏูุง ูุฌุงูููุง. </p><br></li></ul><br><p style=";text-align:right;direction:rtl">  ุฑุบู ุฃูู ุงูุขู ุนูุฏ ุชุณุฌูู ุญุณุงุจ ุดุฎุตู ููุฏูููู ุฃูู ูู ุงูุตูู ุงููุงุถู ุ ุฅูุง ุฃู ูุฐุง ูุฌุจ ุฃู ูููู ูุงููุงู ููุชุฑุฉ ูู ุงูููุช ุ ูุจุงูุชุฃููุฏ ูุฌููุน ุชุฌุงุฑุจูุง.  ูู ููุงูุฉ ุงูุดูุฑ ุ ูุชู ุณูุจ ุงููุฒูุฏ ูู ุงููุฑูุถ ุ ููุง ุฃููุฐูู ุฃูุซุฑ ูู ูุฑุฉ ูู ุงูุฎุฑุงุจ ุงููุญุชูู. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูุณูุจูุงุช ุ ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃู ุจุทุงูุงุช ุงูููุฏูู ููุงู ููุท ุชุณูุง K80 ุงููุฏููุฉ ูุน 12 ุฌูุฌุงุจุงูุช ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ุ ูุงูุฐู ููุฑุถ ูููุฏ ุงูููุงุจูุฉ.  ูู ุฃู ุญุงู ุ ุญุชู ูุตู ุฅูู ุงูุฅูุชุงุฌ ุ ุณูู ูููู ุจุงููุนู ูุง ูุญุชุงุฌู ูู ุงูุฎุงุฏู. </p><br><h2 id="deploy-modeli" style=";text-align:right;direction:rtl">  ูุดุฑ ุงูููุงุฐุฌ </h2><br><p style=";text-align:right;direction:rtl">  ุญุณูุง ุ ุฅูู ุงููุนุฑูุฉ! </p><br><h3 id="registraciya" style=";text-align:right;direction:rtl">  ุชุณุฌูู </h3><br><p style=";text-align:right;direction:rtl">  ูุฐูุจ ุฅูู <a href="https://algorithmia.com/signup" rel="nofollow">https://algorithmia.com/signup</a> ูุงูุชุณุฌูู.  ูุณุช ูุชุฃูุฏูุง ูู ูุฌูุฏ ุงุฎุชูุงู ูู ููุน ุงููููุฉ \ ููุน ุงูุญุณุงุจ ุงูุฐู ูุฌุจ ุงุฎุชูุงุฑู ุ ูููู ุฅุฐุง ูุฌุฏุช ูุฌููุนุฉ ุฐูุจูุฉ ุชููุฑ ุงูุญุฏ ุงูุฃูุตู ููุงุฆุชูุงูุงุช ุ ูุชุฃูุฏ ูู ุฅุฎุจุงุฑู ูู ุงูุชุนูููุงุช! </p><br><h3 id="zagruzka-modeli" style=";text-align:right;direction:rtl">  ุชุญููู ูููุฐุฌ </h3><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุงูุชุณุฌูู ุ ุณูููู ูู ูููู ุงูุดุฎุตู. <br>  ูุญุชุงุฌ ุฅูู ุฅูุดุงุก ูุฌูุฏุงุช ูููููุฐุฌ ูุงูุตูุฑ ุงูุชู ุณูููู ุจุฅูุดุงุฆูุง. <br>  ููููุงู ุจุฐูู ุ ุญุฏุฏ Data Sources ูู ุงููุงุฆูุฉ ุนูู ุงููุณุงุฑ. </p><br><p style=";text-align:right;direction:rtl">  ุงููุฑ ููู ูุตุฏุฑ ุจูุงูุงุช ุฌุฏูุฏ -&gt; ูุฌููุนุฉ ุงูุจูุงูุงุช ุงููุณุชุถุงูุฉ <br>  ุฏุนูุง ุงุณู ุงููุฌูุฏ "ุจูุฏู ุงูููุงุฐุฌ". <br>  ูุชูุฌุฉ ูุฐูู ุ ูุฌุจ ููููุง ุฅูู ุตูุญุฉ ุชุญุชูู ุนูู ูุงุฆูุฉ ุงููุฌูุฏุงุช ุงูุฎุงุตุฉ ุจูุง. </p><br><p style=";text-align:right;direction:rtl">  ุฅูุดุงุก ูุฌูุฏ ุขุฎุฑ: ูุฌููุนุฉ ุฌุฏูุฏุฉ -&gt; "photo2comics_out" </p><br><p style=";text-align:right;direction:rtl">  ุญุงู ุงูููุช ูุชูุฒูู ูููุฐุฌูุง ุงูููุตุฏุฑ ุญุฏูุซูุง! <br>  ุงูุชูู ุฅูู ูุฌูุฏ My Models ูุงุณุญุจ ููู ุงูุทุฑุงุฒ ุฅูู ุงููุณุชุนุฑุถ ุ ุฃู ุญุฏุฏ ุชุญููู ุงููููุงุช ูู ุงููุงุฆูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุงูุขู ูู ุจูุณุฎ ุงูุฑุงุจุท ุฅูู ูููุฐุฌูุง ุ ูุณูููู ูู ุงููููุฏ ููุง ุฃุฏูุงู.  ููููุงู ุจุฐูู ุ ุงููุฑ ููู ุนูุงูุฉ ุงููุทุน ุงูููุฌูุฏุฉ ุนูู ูููู ุงุณู ุงูููู. </p><br><p style=";text-align:right;direction:rtl">  ุงูุชูุช ุงูุจูุงูุงุช ุ ุงูุชูู ุฅูู ุงูุฎูุงุฑุฒููุฉ ููุณูุง. </p><br><h3 id="algoritm" style=";text-align:right;direction:rtl">  ุฎูุงุฑุฒููุฉ </h3><br><p style=";text-align:right;direction:rtl">  ูุนูุฏ ุฅูู ุงูููู ุงูุดุฎุตู ูู ุฎูุงู ุงูููุฑ ุนูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ูู ุงููุงุฆูุฉ ุนูู ุงููุณุงุฑ. </p><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฐูู ุ ุงููุฑ ููู ุฅูุดุงุก ุฌุฏูุฏ -&gt; ุฎูุงุฑุฒููุฉ ูุญุฏุฏ ุงุณู ุงูุฎูุงุฑุฒููุฉ ุงูุฎุงุตุฉ ุจูุง.  ูููุฃ ุงูุฎูุงุฑุงุช ุงููุชุจููุฉ ููุง ูู ุงูุตูุฑุฉ ุฃุฏูุงู. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุงูุตูุฑุฉ ุฃุฏูุงู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/7u/se/aa/7useaagraqj_hb0gzwkrrcmh3ua.png"></p></div></div><br><p style=";text-align:right;direction:rtl">  ุงููุฑ ููู ุฅูุดุงุก ุฎูุงุฑุฒููุฉ ุฌุฏูุฏุฉ ูุญุฏุฏ WebIDE ูู ุงููุงูุฐุฉ ุงูุชู ุชุธูุฑ. <br>  <em>ุฅุฐุง ููุช ุจุฅุบูุงู ุงูุฅุทุงุฑ ุงูููุจุซู ุนู ุทุฑูู ุงูุฎุทุฃ ุ ูููููู ูุชุญ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงููุตุฏุฑ ุจุงูููุฑ ููู "ุดูุฑุฉ ุงููุตุฏุฑ" ูู ูุงุฆูุฉ ุงูุฎูุงุฑุฒููุฉ ุงูุฎุงุตุฉ ุจูุง.</em> </p><br><p style=";text-align:right;direction:rtl">  ูุฒูู ุดูุฑุฉ ุงููุงูุจ ููุถูู ุฑูุฒูุง: </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุจุนุถ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ููุณุฎ ุฃูุซุฑ ุทุงุฆุด</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Algorithmia <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> torch <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> torchvision <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> torchvision.transforms <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> transforms <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cv2 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> torch <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> uuid <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> gc <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np client = Algorithmia.client() <span class="hljs-comment"><span class="hljs-comment">#     file_path,      #   model_file   . def load_model(): file_path = "{      }" model_file = client.file(file_path).getFile().name model = torch.jit.load(model_file).half().cuda() return model model = load_model().eval() torch.cuda.empty_cache() torch.cuda.ipc_collect() torch.backends.cudnn.benchmark = True #    ,    , #     , # ..      def preprocessing(image_path, max_size): response = requests.get(image_path) response = response.content nparr = np.frombuffer(response, np.uint8) img_res = cv2.imdecode(nparr, cv2.IMREAD_COLOR) img_res = cv2.cvtColor(img_res, cv2.COLOR_BGR2RGB) x = img_res.shape[0] y = img_res.shape[1] #if image is bigger than the target max_size, downscale it if x&gt;max_size and x&lt;=y: y = y*(max_size/x) x = max_size if y&gt;max_size and y&lt;x: x = x*(max_size/y) y = max_size size = (int(y),int(x)) img_res = cv2.resize(img_res,size) t = Tensor(img_res/255.)[None,:] t = t.permute(0,3,1,2).half().cuda() # standartize t = (t-0.5)/0.5 return(t) def predict(input): gc.collect() with torch.no_grad(): res = model(input).detach() return res #   ,     #      def save_file(res, file_uri): #de-standartize res = (res*0.5)+0.5 tempfile = "/tmp/"+str(uuid.uuid4())+".jpg" torchvision.utils.save_image(res,tempfile) client.file(file_uri).putFile(tempfile) # API calls will begin at the apply() method, with the request body passed as 'input' # For more details, see algorithmia.com/developers/algorithm-development/languages def apply(input): processed_data= preprocessing(input["in"], input["size"]) res = predict(processed_data) save_file(res, input["out"]) input = None res = None processed_data = None gc.collect() return "Success"</span></span></code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ูุง ุชูุณู ุฅุฏุฑุงุฌ ุฑุงุจุท ููุทุฑุงุฒ ุงูุฐู ุชู ุชูุฒููู.  ูููุง ุจูุณุฎู ูู ุงููุณู ุงูุณุงุจู ุนูุฏ ุชุญููู ุงููููุฐุฌ. </p><br><p style=";text-align:right;direction:rtl">  ุฃุซูุงุก ูุฌูุฏู ูู WebIDE ุ ุงููุฑ ููู DEPENDENCIES ูู ุงูุฌุฒุก ุงูุนููู ุงูุฃููู ูุงุณุชุจุฏู ุงููุต ุจูุงุฆูุฉ ูู ุชุจุนูุงุชูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">algorithmia&gt;=1.0.0,&lt;2.0 opencv-python six torch==1.3.0 torchvision numpy</code> </pre><br><p style=";text-align:right;direction:rtl">  <em>ูุฌุจ ุฃู ุชููู ูุณุฎุฉ ุงููุดุนู ูู ููุณูุง ุฃู ุงูุฃุญุฏุซ ูู ุงููุณุฎุฉ ุงูุชู ุญูุธูุง ุจูุง ุงููููุฐุฌ.</em>  <em>ุฎูุงู ุฐูู ุ ูุฏ ุชููู ููุงู ุฃุฎุทุงุก ุนูุฏ ุงุณุชูุฑุงุฏ ูููุฐุฌ jit.</em> </p><br><p style=";text-align:right;direction:rtl">  ุงููุฑ ููู "ุญูุธ" ู "ุฅูุดุงุก" ูุงูุชุธุฑ ุญุชู ููุชูู ุงูุฅูุดุงุก.  ุจูุฌุฑุฏ ุธููุฑ ุฑุณุงูุฉ ุญูู ุฅูุดุงุก ูุงุฌุญ ูู ูุญุฏุฉ ุงูุชุญูู ุฃุฏูุงู ุ ูููููุง ุงูุชุญูู ูู ุฃุฏุงุก ุงูุทุฑุงุฒ ุนู ุทุฑูู ุฅุฑุณุงู ุทูุจ ุงุฎุชุจุงุฑ ุฅูู ูุญุฏุฉ ุงูุชุญูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">{<span class="hljs-string"><span class="hljs-string">"in"</span></span>:<span class="hljs-string"><span class="hljs-string">"https://cdn3.sportngin.com/attachments/photo/9226/3971/JABC-9u_medium.JPG"</span></span>, <span class="hljs-string"><span class="hljs-string">"out"</span></span>:<span class="hljs-string"><span class="hljs-string">"data://username/photo2comics_out/test.jpg"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>:512}</code> </pre><br><p style=";text-align:right;direction:rtl">  ุญูุซ {ุงุณู ุงููุณุชุฎุฏู} ูู ุงุณู ุงููุณุชุฎุฏู ุงูุฎุงุต ุจู.  ุฅุฐุง ุณุงุฑุช ุงูุฃููุฑ ุนูู ูุง ูุฑุงู ุ ูุณูุธูุฑ "Success" ูู ูุญุฏุฉ ุงูุชุญูู ุ ูุณุชุธูุฑ ุงูุตูุฑุฉ ุงูุชู ุชู ุฅูุดุงุคูุง ูู ุงููุฌูุฏ ุงูุฐู ุญุฏุฏูุงู (ูู ูุฐู ุงูุญุงูุฉ photo2comics_out). </p><br><h3 id="itogi" style=";text-align:right;direction:rtl">  ุงููุชุงุฆุฌ </h3><br><p style=";text-align:right;direction:rtl">  ูุจุฑูู ุ ูุญู ุจุชุฃุฌูู ูุจุซูู ุบุงุถุจ ูููุฐุฌูุง ุงููุชูุงุถุน! </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูุนุฏุฏ ุงูุชุงูู ุ ุณูููู ุตุฏุงูุงุช ูุน ูููุฐุฌ telegram bot ุ ููู ุงูููุงูุฉ ุ ุณูุตุฏุฑ ูู ูุฐู ุงูุฃุดูุงุก. <br>  ุฅุฐุง ููุช ูุง ุชุณุชุทูุน ุงูุงูุชุธุงุฑ ูุชุฌุฑุจุฉ ุงููููุฐุฌ ุ ููููู ุฏุงุฆููุง ูุฑุงุกุฉ ุงููุซุงุฆู ุงูุฑุณููุฉ: <a href="https://algorithmia.com/developers/api/" rel="nofollow">https://algorithmia.com/developers/api/</a> </p><br><p style=";text-align:right;direction:rtl">  ุญุณููุง ุ ูู ุฃุฌู ูุถุงุก ุงูููุช ุญุชู ุงูููุงูุฉ ุงูุชุงููุฉ ุ ููููู ูุถุน ุจุนุถ ุงูุฑูุจูุชุงุช ุ ุงูููุงุฐุฌ ุงูุชู ูุดุฑุชูุง ุนูู ุงูุฎูุงุฑุฒููุฉ: </p><br><p style=";text-align:right;direction:rtl">  <a href="https://t.me/selfie2animebot" rel="nofollow">@ selfie2animebot</a> - ูุชุญูู <a href="https://t.me/selfie2animebot" rel="nofollow">selfie</a> ุฅูู ุฃูููู <br>  <a href="https://t.me/pimpmyresbot" rel="nofollow">pimpmyresbot</a> - ุฒูุงุฏุฉ ุฏูุฉ x2 (ุจุญุฏ ุฃูุตู 1400 ร 1400) <br>  <a href="https://t.me/photozoombot" rel="nofollow">photozoombot</a> - ูููู ุจุฅูุดุงุก ููุฏูู ุชูุจูุฑ ุซูุงุซู ุงูุฃุจุนุงุฏ ูู ุตูุฑุฉ ูุงุญุฏุฉ <br>  <a href="https://t.me/photo2comicsbot" rel="nofollow">@ photo2comicsbot</a> - ูู ุงููุงูุน ุ <a href="https://t.me/photo2comicsbot" rel="nofollow">ุจุทู ูุฐู</a> ุงูููุงุณุจุฉ </p><br><p style=";text-align:right;direction:rtl">  ูุง ุชูุณู ูุดุงุฑูุฉ ุงููุชุงุฆุฌ ูุงูุฃููุงุฑ ูุงููุดุงูู ุงูุชู ุตูุฏูุช ูู ุงูุชุนูููุงุช. <br>  ูุฐุง ูู ุดูุก ููุฐุง ุงูููู.  ุงุฑุงู ูุฑูุจุง! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar485824/">https://habr.com/ru/post/ar485824/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar485804/index.html">ููุฑุฉ ุฃุฎุฑู ุ ูุนุฑู ุงุฎุชุจุงุฑ CAPTCHA ุฃู nginx ุฃูุถูุง ููููุฉ ุงูุชุทุฑูุฒ</a></li>
<li><a href="../ar485806/index.html">ููุฑูุณุงุช ููุฑูู: ูู ุงูุณุงุฑุณ ุฅูู 2019-nCoV</a></li>
<li><a href="../ar485810/index.html">ุฅูุณูุฑ ุงูุณูุงููุฑ ุชุฑุฌูุฉ ุงูููุช</a></li>
<li><a href="../ar485812/index.html">7 ูุฑุงุญู ูู ุงุฎุชุจุงุฑ ุงูุชุทูุฑ ูู ุงูุดุฑูุฉ</a></li>
<li><a href="../ar485820/index.html">ุดุฎุต ููุงุฌู ุฌุฏูุง: ุงูุชุดู ูู ูู ุงููุฏู ุงูุฑุฆูุณู ููุฌุฑูู ุงูุฅูุชุฑูุช ูู ุดุฑูุชู.</a></li>
<li><a href="../ar485828/index.html">ูุง ูู ุงูููุงููู ูู ูุฌุงู ุงููุงููู ุงูุฑููู ูุฏ ุชุธูุฑ ูุฐุง ุงูุนุงู</a></li>
<li><a href="../ar485836/index.html">ูู ุจุชูุตูู iRig Pro ุจุฏูู ุฃุณูุงู ูุฌูุนุฉ</a></li>
<li><a href="../ar485838/index.html">ุนูุฉ Kubernetes ูุทุงุฑุฏุฉ ููุชูุญุฉ ุฑุณููุง</a></li>
<li><a href="../ar485842/index.html">ุจู ุงูุชูููููุฌูุง ุณุคุงู ูุฌูุงุจ</a></li>
<li><a href="../ar485844/index.html">ุงูุดุนุฑ ุงูุฑูุงุฏู ุงูุดุงุฐ: ุชุตุจุบ ุงูุดุนุฑ ุจุณุจุจ ุงูุฅุฌูุงุฏ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>