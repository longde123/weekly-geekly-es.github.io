<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üññüèø üïµÔ∏è ü§© Miniatura Macintosh Plus üê£ üåî üßòüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En los primeros d√≠as de las computadoras dom√©sticas, hab√≠a una compa√±√≠a llamada Apple. Acababa de dar grandes pasos con la l√≠nea de computadoras Apple...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Miniatura Macintosh Plus</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444574/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/160/d50/755/160d50755b66bf8a810c5b9f62491add.jpg" alt="imagen"></div><br>  En los primeros d√≠as de las computadoras dom√©sticas, hab√≠a una compa√±√≠a llamada Apple.  Acababa de dar grandes pasos con la l√≠nea de computadoras Apple II, pero necesitaba innovaci√≥n para mantenerse en la cima del mercado de las computadoras.  La compa√±√≠a ya ha trabajado en la l√≠nea Lisa, que se inspir√≥ en mini computadoras y estaba destinada a usuarios comerciales, lo que significa que ten√≠a un precio adecuado, pero para el consumidor promedio parec√≠a demasiado caro.  Como proyecto adicional, se desarroll√≥ el Macintosh, que se supon√≠a que era la realizaci√≥n de la idea de una nueva generaci√≥n de computadoras para "personas de la calle" y costaba alrededor de $ 500.  El proyecto fue asumido por Steve Jobs, y bajo su liderazgo, el hardware se hizo m√°s avanzado, el software recibi√≥ una GUI en lugar de una interfaz de texto, y el precio se dispar√≥ a casi $ 2,500.  Aunque el equipo obtenido a este precio fue un poco decepcionante, por ejemplo, carec√≠a de los aceleradores gr√°ficos y las capacidades de sonido de otras m√°quinas, pero el software justific√≥ el precio.  El primer Macintosh fue el Mac 128K, y su √©xito impuls√≥ la creaci√≥n de modelos m√°s avanzados de este Mac compacto, en particular, el Macintosh 512K, Macintosh Plus y la serie Macintosh SE. <br><br>  Aunque el desarrollo del Macintosh tuvo lugar alrededor de 1984, mucho antes de que comenzara a entender las computadoras, ten√≠a algunas debilidades para el Macintosh compacto: la primera computadora que compraron mis padres fue la Macintosh Plus.  M√°s tarde se complement√≥ con un disco duro SCSI de 20 MB, y en esta m√°quina escrib√≠ mis primeros programas b√°sicos.  Cuando a√∫n viv√≠a en los Pa√≠ses Bajos, compr√© una m√°quina SE / 30 rota y la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">convert√≠</a> en un servidor Linux, que sin embargo era capaz de ejecutar el software Mac.  Sin embargo, dej√© este auto en los Pa√≠ses Bajos, y aqu√≠, en Shanghai, ya no tengo el hardware cl√°sico de Apple. <br><br>  Aunque es obvio que ya no necesito Mac Plus en la vida cotidiana, me gust√≥ la idea de tenerlo a mano en caso de ataques de nostalgia. <a name="habracut"></a>  Quiz√°s pueda obtener una peque√±a parte de la experiencia de Macintosh si yo mismo creo una copia peque√±a de tal m√°quina.  Si ya tengo algo de experiencia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">creando versiones m√°s peque√±as de hardware antiguo</a> , ¬øpor qu√© no intentar aplicar este proceso para construir el venerable Mac Plus? <br><br><h1>  Display </h1><br>  ¬øQu√© debo usar para construir una m√°quina as√≠?  Al principio se me ocurri√≥ la idea de tomar una Raspberry Pi o algo similar, agregar una pantalla LCD de 2.5 pulgadas, un emulador como PCE o MiniVMac, imprimir una carcasa en una impresora 3D y considerar el trabajo realizado.  Pero no creo que esta idea valga la pena: la m√°quina para mi gusto no solo ser√° demasiado grande, sino que el proyecto en s√≠ es demasiado simple.  En el Mac 128K original, incluso cuando el resultado final result√≥ ser demasiado bajo, los desarrolladores lograron hacer un par de trucos para ahorrar dinero.  El montaje simple de una r√©plica de "hierro" est√°ndar es contrario al esp√≠ritu del dise√±o original.  ¬°As√≠ que fui a Taobao por ingredientes m√°s ex√≥ticos! <br><br><img align="right" src="https://habrastorage.org/getpro/habr/post_images/42f/7cf/4ba/42f7cf4ba397243640f69ed0864bb72e.png"><br>  Decid√≠ comenzar con la pantalla.  Para su √©poca, la Mac ten√≠a una pantalla de alta resoluci√≥n, por lo que era muy importante elegir la pantalla correcta.  Por lo general, cuando se trata de elegir pantallas en el mercado electr√≥nico chino, el surtido es amplio.  Desafortunadamente, el "gran surtido" consiste en pantallas de alta resoluci√≥n, pero tambi√©n en tama√±os grandes o pantallas peque√±as de peque√±a resoluci√≥n.  Idealmente, necesitaba una resoluci√≥n de 512x342 p√≠xeles;  Esta es la resoluci√≥n nativa de Mac y en una pantalla similar puedo mostrar todo sin hacer zoom.  Desafortunadamente, no hay pantallas preparadas de tal resoluci√≥n en el mercado;  el an√°logo m√°s cercano ser√° algo as√≠ como 640x480.  Por alguna raz√≥n, las pantallas de esta resoluci√≥n son bastante grandes: la m√°s peque√±a tiene una diagonal de 3.5 pulgadas.  Por lo tanto, por desgracia, si quiero que la Mac sea lo m√°s peque√±a posible, entonces debo reducir la resoluci√≥n. <br><br>  Habiendo decidido que es bastante posible reducir ligeramente la resoluci√≥n, obtuve una variedad de pantallas bastante grandes.  Una de las primeras pantallas vistas fue x163qln01, una pantalla OLED de 1.63 pulgadas hecha por AUO.  Es un poco caro (alrededor de $ 25 por pantalla), pero a menudo se puede encontrar en Taobao, y la hoja de datos al menos documenta los contactos, tama√±os y requisitos de energ√≠a.  Parece que esta pantalla fue dise√±ada para alg√∫n tipo de marca de reloj inteligente en Android, y un poco de google, incluso encontr√© algunas secuencias de iniciaci√≥n que se pueden usar. <br><br>  El √∫nico problema (excepto el conector, cuyos contactos se encuentran a una distancia de 0,5 mm entre s√≠) fue que la pantalla no utiliza una interfaz paralela y no SPI, sino la interfaz MIPI.  Tendr√© que lidiar con esto m√°s tarde. <br><br>  Una vez seleccionada la pantalla, puede ir al procesador.  Eleg√≠ el m√≥dulo ESP32-Wrover.  Este m√≥dulo contiene un ESP32 (un chip WiFi con dos CPU de 32 bits que funcionan a una frecuencia de 240 MHz y con aproximadamente medio megabyte de RAM), 4 memorias flash MiB y 4 PSRAM MiB.  Suger√≠ que los dos n√∫cleos de CPU ser√≠an lo suficientemente r√°pidos como para emular una Mac y que podr√≠a usar 4 MiB de PSRAM como una RAM de Mac.  Aunque 4 MiB de memoria flash no son mucho, deber√≠an ser suficientes para el emulador m√°s un peque√±o disco duro con software y programas del sistema.  Tambi√©n me beneficio el hecho de que trabajo en Espressif, por lo que este equipo me es bastante familiar;  Adem√°s, puedo tomar algunos m√≥dulos del trabajo, en lugar de comprarlos y esperar la entrega. <br><br>  Por lo tanto, todo est√° casi listo para funcionar: la pantalla OLED todav√≠a necesitaba componentes para la fuente de alimentaci√≥n, por lo que la cantidad de componentes aument√≥ con un estabilizador de ca√≠da de baja tensi√≥n (LDO) y otros chips de fuente de alimentaci√≥n.  La Mac tambi√©n necesitaba sonido, as√≠ que tom√© un chip acelerador y un altavoz baratos, y obtuve el m√≥dulo FT232 est√°ndar para alimentaci√≥n y depuraci√≥n.  Todos estos componentes son bastante peque√±os y me permiten reducir el cuerpo del dispositivo;  El resultado deber√≠a ser un modelo un poco m√°s de 1/6 de una Mac real. <br><br><h1>  Control de pantalla </h1><br>  Aunque no me puedo quejar de la resoluci√≥n, el tama√±o y el brillo de la pantalla, result√≥ ser m√°s dif√≠cil mostrar p√≠xeles en ella.  MIPI no era compatible con el silicio ESP32, por lo que necesitaba encontrar otra forma de comunicarme con √©l.  MIPI DSI es un est√°ndar desarrollado por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MIPI Alliance</a> y no est√° abierto;  Como esto es un pasatiempo para m√≠, tuve que recopilar fragmentos de informaci√≥n de documentos filtrados y probar dispositivos existentes.  Afortunadamente, hace uno o dos a√±os, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Mike Harrison realiz√≥</a> una ingenier√≠a inversa de la interfaz MIPI DSI utilizada para controlar las pantallas del iPod ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">2</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">3</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">4</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">5</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sitio web</a> ), y tambi√©n encontr√≥ varias copias de las especificaciones.  Me hizo la vida mucho m√°s f√°cil: al menos me ayuda a descubrir qu√© enviar a la pantalla. <br><br>  Aunque hay mucho m√°s en la interfaz (y para averiguar sobre esto, debe ver todos los videos a los que les di enlaces arriba), la capa f√≠sica de MIPI es bastante f√°cil de explicar.  MIPI utiliza cuatro cables: dos buses de datos y dos buses de reloj.  Tambi√©n tiene dos modos de transmisi√≥n de se√±al: modo de baja potencia (LP) y modo de alta velocidad (HS). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/23d/c2b/af2/23dc2baf2a437935e2144183e57c8c09.png"></div><br>  En el modo de baja potencia, los cables se utilizan por separado para transmitir estructuras de datos de control, as√≠ como para indicar que ciertos comandos tienen un efecto directo en el receptor f√≠sico, por otro lado.  La ca√≠da de voltaje en este modo es bastante grande en comparaci√≥n con el modo de alta velocidad: para una se√±al alta, el voltaje es de aproximadamente 1.2 V, y para una se√±al baja es de aproximadamente 0 V. Dado que el modo de baja potencia tiene m√°s estados de se√±al, realiza funciones como enviar el destinatario de la orden para cambiar al modo de alta velocidad o salir de √©l.  En el gr√°fico anterior, las l√≠neas azules indican la transmisi√≥n de datos en modo de bajo consumo. <br><br>  En el modo de alta velocidad, dos buses de reloj (CLKP / CLKN), as√≠ como dos buses de datos (DP / DN) funcionan como buses diferenciales: un bus siempre es opuesto al otro.  El receptor detecta las diferencias entre los dos buses y, en funci√≥n de ellos, establece el valor transmitido: 1 si est√° por encima de DP y 0 si est√° por encima de DN.  Como su nombre lo indica, el modo de alta velocidad proporciona una transferencia de datos muy r√°pida con una frecuencia de reloj de hasta 1.5 GHz.  Para lograr esto sin demasiada interferencia electromagn√©tica y consumo de energ√≠a, el est√°ndar utiliza el siguiente truco: utiliza voltajes muy bajos: el voltaje en los pares es en promedio 200 mV, con desviaciones de ¬± 100 mV por bus para indicar ceros y unos.  En el gr√°fico anterior, los bits rojos se transmiten en modo de alta velocidad. <br><br>  Desde el punto de vista de transferir los datos en modo de alta velocidad, la interfaz puede considerarse esencialmente como una interfaz SPI bastante extra√±a y diferencial: hay una se√±al de reloj y un canal de transmisi√≥n de datos, y en cada ciclo de reloj el valor de los datos se transmite a la interfaz.  La diferencia con SPI (excepto que las se√±ales son diferenciales) es que el bit de datos se transmite solo cuando cambia el estado de los buses CLK, y no solo, por ejemplo, en el borde de ataque.  Otra diferencia es que el inicio de una transmisi√≥n no se reconoce cuando la se√±al en el bus / CS se vuelve baja, sino m√°s bien una se√±al en banda: cada transmisi√≥n de datos comienza con una √∫nica "palabra m√°gica", y el receptor determina este valor para comprender cu√°ndo comienza la transmisi√≥n. <br><br>  Para asegurar que esta interfaz interact√∫a con ESP32, tendr√© que realizar un cambio de nivel.  Quer√≠a alimentar el ESP32 desde una fuente de 3.0 V para que todos los GPIO tambi√©n tuvieran 3.0 o 0 V. Para adaptar esto a los niveles de se√±al de la interfaz MIPI, eleg√≠ la soluci√≥n m√°s econ√≥mica: simplemente utilic√© redes de divisor de resistencia. <br><br>  Para calcular los valores de resistencia, cre√© ecuaciones para los tres estados de voltaje de salida que me interesan (1.1 V para la se√±al de alta potencia baja, 0.07 V para la se√±al de alta velocidad baja, 0.33 V para la se√±al de alta velocidad alta; los voltajes se eligieron como para que en la mayor√≠a de los casos permanezcan dentro de la especificaci√≥n) y los tres estados de entrada que deber√≠an generarlos.  Tengo las ecuaciones.  Te√≥ricamente, fue posible resolverlos manualmente, pero al final los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">abandon√©</a> en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">WolframAlpha</a> y obtuve los valores de resistencia requeridos. <br><br><pre>            3v
 G -R1 - + R3
 G -R2 - + - + ----&gt;
            R4
            GND<font></font>
<font></font>
 R4 * (1.9 / R1 + 1.9 / R3) = 1.1, 
 (1 / (1 / R4 + 1 / R1 + 1 / R2)) * (2.93 / R3) = 0.07, 
 (1 / (1 / R4 + 1 / R1)) * 2.67 * (1 / R3 + 1 / R2) = 0.33, 
 R2 = 1000<font></font>
<font></font>
 R1 = 280, R2 = 1K, R3 = 3K6, R4 = 150 </pre><br><br>  En este punto, me di cuenta de que tambi√©n puedes hacer un poco de trampa: dado que en el modo de alta velocidad los buses son diferenciales, la pantalla solo ver√° la diferencia entre los dos buses para determinar los datos transmitidos.  Esto significa que puedo ahorrar GPIO manteniendo un voltaje fijo en uno de los buses y aplicando una se√±al alta o baja al otro.  Para hacer esto, necesitaba un segundo tipo de red de resistencia: <br><br><pre>            3v
            R3
 G -R1 - + - + ----&gt;
            R4
            GND<font></font>
<font></font>
 R4 * (1.9 / R1 + 1.9 / R3) = 1.1,
 (1 / (1 / R4 + 1 / R1)) * (2.8 / R3) = 0.2,
 R4 = 150<font></font>
<font></font>
 R1 = 320, R3 = 1500, R4 = 150 </pre><br><br>  Otra tarea era crear un circuito de reloj.  El SPI normal transmite un poco en el borde de ataque del bus del reloj.  (O en el borde posterior, dependiendo de la configuraci√≥n). MIPI transmite un poco en los bordes inicial y final de la se√±al del reloj.  Aunque el m√≥dulo SPI del equipo ESP32 no puede generar tales se√±ales por s√≠ mismo, podemos convertir uno a otro usando un simple disparador D, cuya salida invertida est√° conectada a la entrada.  Cada pulso de reloj en la entrada cambiar√° el nivel de salida, seg√∫n sea necesario. <br><br><h1>  Diagrama de circuito </h1><br>  Habiendo tratado con el equipo de visualizaci√≥n, terminamos la parte m√°s dif√≠cil.  Ahora todo lo que tenemos que hacer es agregar el resto.  Comencemos con la fuente de energ√≠a.  Es bastante simple: alimento todo el circuito de 5V desde un convertidor de USB a serie, que tambi√©n se puede usar como interfaz de depuraci√≥n / programaci√≥n.  Se toma este voltaje para generar +4.6 V, -3.4 V y 1.8 V requeridos por la pantalla OLED, as√≠ como 3.0 V para alimentar el ESP32.  El chip TPS65631 genera voltajes de +4,6 V y -3,4 V, y el circuito de referencia para esto se muestra en la hoja de datos de la pantalla OLED.  Otros voltajes son generados por un par de LDO simples. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/70a/d6a/f70/70ad6af70745587d6804e09451e192da.png"></div><br>  El Macintosh tambi√©n ten√≠a sonido.  Seg√∫n los est√°ndares modernos, su calidad no es muy alta (22 kHz, 8 bits), pero los sonidos de sus programas ahora son legendarios, por lo que en mi proyecto no pude rechazarlos.  El ESP32 tiene un DAC incorporado de 8 bits, que se utiliza para crear ondas de sonido anal√≥gicas generadas por el emulador.  Luego se alimentan al NS8002, que es un amplificador de sonido de clase AB de 2 vatios montado en el peque√±o formato SOIC8.  Es barato, requiere muy pocos componentes de soporte y crea un sonido m√°s que suficiente para llamar la atenci√≥n sobre la peque√±a Mac. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/05d/461/dea/05d461deabf92b53b75f1e3290cef040.png"></div><br>  Uno de los aspectos que hizo que Macintosh fuera tan revolucionario fue que fue una de las primeras computadoras comerciales con mouse.  El equipo de Macintosh pens√≥ en el mouse con tanto cuidado que casi todo el sistema operativo se basa en elementos de IU controlados por el mouse y, a diferencia de, por ejemplo, la PC de IBM, todo el Macintosh podr√≠a controlarse con un mouse.  Obviamente, mi peque√±a Mac tambi√©n necesitaba este importante dispositivo perif√©rico.  Todav√≠a recuerdo los ratones de bolas vendidos con el primer Macintosh, pero no estaba muy satisfecho con la necesidad de limpiar los rodillos con demasiada frecuencia de la suciedad;  Es por esta raz√≥n que estos dispositivos mec√°nicos fueron completamente reemplazados por ratones √≥pticos.  La ventaja de esto es que los detalles de estos nuevos ratones √≥pticos son bastante f√°ciles de encontrar: por ejemplo, no me llev√≥ mucho tiempo encontrar el vendedor de los sensores de mouse para juegos ADNS9500 y la √≥ptica correspondiente. <br><br>  Otro aspecto conveniente es que el sensor √≥ptico del mouse es un dispositivo bastante integrado: requiere solo unos pocos componentes externos para funcionar, y esto se refleja en el diagrama.  Se agregaron varios condensadores para estabilizar el voltaje, un transistor MOS (copiado directamente de la hoja de datos) para encender el diodo l√°ser y otros detalles est√°ndar.  El sensor del mouse transmite datos a trav√©s de una se√±al SPI de cuatro cables, y utilic√© uno de estos cables para enviar la se√±al del bot√≥n del mouse: cuando hago clic en el bot√≥n, el contacto MISO se baja bastante.  El valor de esta resistencia pull-up no es suficiente para que el mouse deje de transmitir datos, pero s√≠ lo suficiente como para superar la resistencia pull-up, que normalmente tira del bus hacia arriba, de modo que cuando el sensor crea tres estados en el bus MISO, el ESP32 puede reconocer la presi√≥n de un bot√≥n. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/786/dc7/476/786dc7476e66ab6f8c477114a34f531b.png"></div><br>  Finalmente, debe conectar la pantalla OLED.  Ya hemos completado todo el trabajo dif√≠cil de calcular los valores de todas las resistencias, por lo que el circuito deber√≠a hablar m√°s o menos por s√≠ mismo.  El chip agregado es un D-flip-flop, y se usa para reducir a la mitad la frecuencia del reloj: como se mencion√≥ anteriormente, el est√°ndar MIPI requiere un nuevo bit cada vez que se invierte la polaridad del reloj, mientras que el ESP32 transmite un nuevo bit solo en la parte frontal o posterior frente <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/784/48e/7a6/78448e7a69765e0d224d6b36281a3f20.png"></div><br>  Despu√©s de dibujar un diagrama esquem√°tico, pas√© a crear un dise√±o de placa de circuito.  La pantalla que seleccion√© deb√≠a montarse en la placa que lo controla, y el conector debe estar en la parte posterior de esta placa de circuito.  Aunque esto no habr√≠a dejado mucho espacio para otros componentes, todav√≠a quer√≠a colocar todos los dem√°s componentes en el otro lado. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7ef/ab4/18e/7efab418e1c2d82cd2c906ca8e91e66a.jpg"></div><br>  Es genial tener una buena visi√≥n y una pistola de aire caliente: esto me permiti√≥ usar los componentes 0603 y colocar todo en el espacio limitado de la placa.  Ser√≠a especialmente dif√≠cil conectar el conector de pantalla y el chip de alimentaci√≥n OLED QFN con un soldador convencional. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/090/5db/fb3/0905dbfb3162f4d093b2e32d7a1aff8c.jpg"></div><br>  Me di cuenta de que el sensor del mouse y sus componentes ocupar√≠an demasiado espacio en la placa, as√≠ que decid√≠ soldar todos los componentes al sensor en s√≠.  Gracias a esto, todo se puede colocar en el mouse. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4d9/51b/a17/4d951ba1796a5b89dc7288e6bbdf0c58.jpg"></div><br><br><h1>  Software </h1><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e08/7b1/5f8/e087b15f8fd3a27bcfd01de4de161aef.jpg"></div><br>  Obviamente, el software es un elemento bastante importante de este ensamblaje: debe emular todo el Macintosh.  Sin embargo, Macintosh no es una m√°quina tan complicada.  De hecho, consta de un microcontrolador 68000, un controlador de transferencia en serie Zilog Z8530 que controla el puerto en serie, 6522 VIA para E / S interna y para proporcionar una interfaz con un teclado, as√≠ como varios arreglos l√≥gicos programables (PAL) que contienen l√≥gica para la pantalla y el sonido.  Tambi√©n tiene un chip integrado de m√°quina Woz que proporciona una interfaz con una unidad de disquete.  Este es un chip bastante complicado;  sin embargo, no planeo emular un disquete, por lo que ser√° suficiente para emular IWM, lo que indica que no hay ning√∫n disco en la unidad.  En cambio, planeo emular completamente el chip SCSI NCR 5380, conectado a un disco duro SCSI emulado, que leer√° desde la memoria flash ESP32-Wrover incorporada. <br><br>  Adem√°s, habr√° muy pocos programas con acceso directo a los equipos en el sistema: a los programadores de Mac se les dijo desde el principio que usaran capas de abstracci√≥n de hardware a nivel del sistema operativo para mantener la compatibilidad con futuras versiones de equipos Mac.  En general, esto significa que si logro emular el hardware de tal manera que el sistema operativo se inicie y est√© contento con todo, entonces la mayor√≠a de los programas funcionar√°n sin ning√∫n problema. <br><br>  Entonces decid√≠ que podr√≠as intentar escribir un emulador desde cero.  M√°s precisamente, no del todo desde cero;  68000 es una bestia bastante complicada y no quer√≠a reinventar <i>la</i> rueda.  En cambio, busqu√© en Internet y descubr√≠ que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MAME</a> tiene un emulador 68K conveniente y r√°pido basado en CK llamado Musashi que se adapta perfectamente a mis necesidades.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ser√° necesario conjurar un poco para transferir los c√≥digos de operaci√≥n en lugar de RAM a la memoria flash, pero por lo dem√°s, no se necesita casi nada para transferir a ESP32. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin embargo, no plane√© desarrollar todo el proyecto en ESP32: dado que el chip es compatible con OpenOCD, que proporciona capacidades de depuraci√≥n bastante amplias, el ciclo "descargado-probado-fijo-cargado" ser√° demasiado mon√≥tono. Por lo tanto, decid√≠ desarrollar primero todo en mi m√°quina Linux, sin olvidar las limitaciones de ESP32. As√≠ que comenc√© a usar la hoja de datos para diferentes chips, la informaci√≥n de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux-68K</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para la m√°quina, as√≠ como la informaci√≥n de la serie Inside Macintosh que se puede encontrar en Internet. Cuando no pod√≠a averiguar qu√© hacer a continuaci√≥n, pod√≠a mirar bajo el cap√≥ de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">otros </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">emuladores de </font></font></a> <font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">c√≥digo </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">abierto</font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Armado con todo esto, eligiendo gcc como compilador y libsdl como biblioteca para trabajar con gr√°ficos, me puse a trabajar. </font><font style="vertical-align: inherit;">En resumen, luego de un tiempo obtendr√© un emulador MacPlus simple, pero que generalmente funciona: mouse, video, disco duro SCSI y trabajo de sonido:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d9c/436/b8f/d9c436b8f1bf87e4ddeca8b928090c0e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como mi hardware a√∫n no estaba listo, decid√≠ portar mi emulador al devboard ESP-Wrover-Kit. </font><font style="vertical-align: inherit;">Todav√≠a ten√≠a varias de esas tarjetas a la mano, y adem√°s del m√≥dulo Wrover, que usar√© de todos modos, tienen una conveniente pantalla de 320x240 que se puede usar para probar el video.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/824/21d/c95/82421dc95010e61d82c8465df2301c1d.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despu√©s de la configuraci√≥n, el emulador de Mac gan√≥ bastante dinero en este tablero; de hecho, suele estar bastante cerca de los 7,8 MHz con los que se ejecuta Mac Plus. (7.8 MHz ser√° un poco m√°s r√°pido que Mac Plus; dado que en esta m√°quina, parte de los ciclos de memoria de la memoria intermedia del cuadro y el sistema de sonido se comen, la frecuencia puede reducirse en un 35%.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obviamente, el emulador en Devboard es un buen paso adelante, pero Al final, todo deber√≠a funcionar en la pantalla que compr√©, y no en la pantalla del panel de control. Y una cosa m√°s: la pantalla devkit tiene una pantalla de 320x240 y corta la parte s√≥lida de la pantalla de Mac. La pantalla que usar√© tiene un tama√±o de 320x320 y, por lo tanto, es m√°s grande solo verticalmente: ¬øc√≥mo puedo mostrar una pantalla Mac de 512x342 en ella?</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solo hay una forma de poner 512x342 p√≠xeles en una pantalla de 320x320, y eso es escalar. De hecho, tomamos una imagen, la comprimimos, la hacemos m√°s peque√±a y luego la mostramos. Sin embargo, el escalado se puede hacer de muchas maneras diferentes, y teniendo en cuenta que la imagen en blanco y negro generada por el sistema operativo supone que cada p√≠xel crea un punto de luz claramente definido en la pantalla, es decir, hay muchas formas de arruinarlo todo. Necesito perder la menor cantidad de p√≠xeles posible. Es decir, debe aumentar la resoluci√≥n de la pantalla OLED.</font></font><br><br>  ¬øPero c√≥mo hacerlo?<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es poco probable que pueda abrir la pantalla OLED y colocar algunos p√≠xeles m√°s en su interior. Sin embargo, esto no es necesario; La resoluci√≥n de la pantalla OLED ya es tres veces mayor que la indicada. La raz√≥n es que esta pantalla es de color: cada "p√≠xel" virtual tiene subp√≠xeles rojo, verde y azul. Adem√°s, en esta pantalla en particular, los subp√≠xeles est√°n alineados con un tri√°ngulo. Aqu√≠ hay una captura de pantalla de primer plano con tres p√≠xeles activados:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d51/597/1e1/d515971e1bab244debdf6e3da2ff960d.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como puede ver, los p√≠xeles son conjuntos triangulares de tres subp√≠xeles; </font><font style="vertical-align: inherit;">Dependiendo de la columna, los tri√°ngulos apuntan hacia abajo o hacia arriba. </font><font style="vertical-align: inherit;">En esencia, esto significa que la resoluci√≥n subp√≠xel de la pantalla es de 480 x 640 p√≠xeles. </font><font style="vertical-align: inherit;">Aunque esto todav√≠a no es suficiente para mostrar 512x342 p√≠xeles, la diferencia es tan peque√±a que con la elecci√≥n correcta de escalas peque√±as, la pantalla ser√° lo m√°s legible posible para una pantalla de 1.63 pulgadas que muestra una GUI dise√±ada para una pantalla de 9 pulgadas:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cfa/bf6/817/cfabf6817fcd374ca27afcf19244d6a6.jpg"></div><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vivienda </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As√≠ que ahora tengo una pantalla y un software que emula bastante bien el Macintosh Plus, adem√°s de un microcontrolador en el que se puede ejecutar. Lo que falta Obviamente, recintos para todo esto! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decid√≠ imprimirlo en una impresora 3D Formlabs 1+ SLA de mi trabajo. Para hacer esto, primero necesito un modelo. Quer√≠a crearlo desde cero. Obviamente, es mejor tener un verdadero Macintosh Plus a mano. De hecho, lo tengo, pero estamos separados por medio continente ... Afortunadamente, logr√© encontrar una soluci√≥n casi igual de buena: una persona amable indic√≥ las dimensiones del Mac 128K original (cuyo cuerpo es casi el mismo que el de Plus) en el wiki de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iFixit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todav√≠a creo todos mis modelos 3D en OpenScad, y despu√©s de atormentar y maldecir, logr√© hacer que todas las curvas se vean como deber√≠an. </font><font style="vertical-align: inherit;">Tengo un hermoso modelo de Mac en una escala de 1: 6.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c00/29f/772/c0029f7728baf02093072b9a886ba572.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tambi√©n cre√© el mouse a partir de im√°genes con iFixit, pero dado que un sensor suficientemente grande del mouse √≥ptico deber√≠a caber en √©l, no se puede escalar a 1/6 de un mouse real. </font><font style="vertical-align: inherit;">La escala est√° m√°s cerca de 2/5, por lo que el mouse se ve grande en comparaci√≥n con la peque√±a Mac, pero es mucho m√°s conveniente para los dedos humanos sin escala.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7af/f29/846/7aff29846237b0b754bafd8caa526ad1.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entonces, todo lo que queda es imprimir los modelos. </font><font style="vertical-align: inherit;">Export√© la construcci√≥n a varios archivos STL y los imprim√≠ en Formlabs 1+. </font><font style="vertical-align: inherit;">El resultado final fue lo suficientemente bueno; </font><font style="vertical-align: inherit;">Solo lamento no haber agregado pestillos a ambas partes del dise√±o. </font><font style="vertical-align: inherit;">Este problema se resolvi√≥ con una gota de superpegamento.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d3e/be4/eae/d3ebe4eae5427f564e366961b385cff6.jpg" alt="imagen"></div><br><br><h1>  Resultado </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entonces, ten√≠a todos los componentes y solo pod√≠a ensamblarlos. Los conectores de PCB en la parte frontal del chasis est√°n asegurados con varios clips. El convertidor de USB a serie, utilizado como mecanismo de arranque y fuente de alimentaci√≥n, est√° conectado a la parte posterior y tambi√©n se mantiene en varios terminales. Olvid√© hacer algo para montar dentro del altavoz, pero logr√© arreglarlo en el estuche con superpegamento. El mouse est√° conectado por un conjunto de cables delgados. (S√≠, son algo inconsistentes con el esquema de color ... tan pronto como encuentre un cable multin√∫cleo m√°s hermoso, lo arreglar√©).</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e8/5d2/efa/1e85d2efa496b34b17d3b655b73f459f.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando desarrolla todo en una computadora, se da cuenta de la escala real del producto solo cuando el proyecto se materializa por completo, por ejemplo, cuando recibe placas de circuito impreso de f√°brica o despu√©s de imprimir en la impresora 3D del dise√±o de la caja en el que ha estado trabajando durante semanas. </font><font style="vertical-align: inherit;">Por supuesto, sab√≠a que todo ser√≠a seis veces m√°s peque√±o que el Mac original, pero al armar todo y ver el autom√≥vil en vivo, me di cuenta de lo que eso significa. </font><font style="vertical-align: inherit;">¬°La Mac realmente result√≥ ser peque√±a!</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/160/d50/755/160d50755b66bf8a810c5b9f62491add.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b03/2ee/25e/b032ee25e2fabeb081533d97bd368034.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E incluso a pesar del peque√±o tama√±o y la falta de un teclado, es capaz de ejecutar la mayor√≠a de los programas por los que Mac es famoso. </font><font style="vertical-align: inherit;">Aqu√≠ hay una demostraci√≥n. </font><font style="vertical-align: inherit;">Los primeros 20 segundos, se realiza una verificaci√≥n de memoria, y s√© por experiencia que una verificaci√≥n tan larga no es un error: el Mac Plus original tard√≥ el mismo tiempo en cargarse, incluso despu√©s de la actualizaci√≥n.</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/oMH8GGEcqQU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entonces, ¬øqu√© tiene de bueno esta Mac Plus? Aunque disfrut√© cre√°ndolo, debo admitir que sin un teclado no se puede utilizar en todo su potencial. Adem√°s, no tiene los medios de comunicaci√≥n: plane√© implementar AppleTalk a trav√©s de WiFi, pero no tuve √©xito debido a las rarezas que no pod√≠a emular en el chip controlador de bus serie del Mac original. Sin embargo, teniendo el proyecto completado en este estado, finalmente puedo cumplir mi viejo sue√±o y ponerlo en la mesa de Mac con las tostadoras del protector de pantalla After Dark volando en la pantalla:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b51/a98/7fe/b51a987fe61c1d827d9075b83bf36b2b.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como de costumbre, este proyecto es de c√≥digo abierto, el dise√±o de la placa de circuito y la carcasa, as√≠ como el firmware, se publican en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Todo tiene una licencia de Beer-Ware, por lo que puede hacer casi todo lo que quiera con √©l. </font><font style="vertical-align: inherit;">Si alguna vez usa algo en sus proyectos, puede </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">escribirme al</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> respecto.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/444574/">https://habr.com/ru/post/444574/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../444564/index.html">Desarrollo de productos digitales con modelos mentales</a></li>
<li><a href="../444566/index.html">Sikorsky realiz√≥ una demostraci√≥n de un helic√≥ptero no tripulado con un hombre a bordo</a></li>
<li><a href="../444568/index.html">Los 10 errores principales de los proyectos de C ++ encontrados en 2018</a></li>
<li><a href="../444570/index.html">Los 10 errores principales en proyectos de C ++ para 2018</a></li>
<li><a href="../444572/index.html">LED parpadeante</a></li>
<li><a href="../444576/index.html">C√≥mo el sistema de tipos mejora su c√≥digo JavaScript</a></li>
<li><a href="../444578/index.html">Speakers Top 3D Expo 2019: Yousef Hesuani de 3dbio - impresi√≥n 3D de √≥rganos y tejidos</a></li>
<li><a href="../444580/index.html">Infraestructura FBO Sheremetyevo: c√≥mo los aviones ligeros se preparan para el vuelo</a></li>
<li><a href="../444582/index.html">Optimizador de pol√≠ticas de seguridad NGFW de Palo Alto Networks</a></li>
<li><a href="../444584/index.html">Android ofrecer√° a los usuarios europeos un navegador y un motor de b√∫squeda de su elecci√≥n.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>