<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš» ğŸ‘¦ğŸ¿ ğŸ‘©ğŸ½â€ğŸš’ Distance Levenshtein et recherche de contrÃ´leurs ğŸ‘¨â€ğŸ’» ğŸ‘©ğŸ¿â€ğŸ’¼ ğŸ˜‚</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probablement, dans chaque ville du BÃ©larus oÃ¹ il y a des trolleybus, il y a des groupes VK ou des chats sur Telegram dans lesquels les gens suivent l'...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Distance Levenshtein et recherche de contrÃ´leurs</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/478490/">  Probablement, dans chaque ville du BÃ©larus oÃ¹ il y a des trolleybus, il y a des groupes VK ou des chats sur Telegram dans lesquels les gens suivent l'emplacement des contrÃ´leurs.  Ceci est principalement fait afin de ne pas payer les voyages et les voyages gratuits, bien que la description des groupes contienne presque toujours le post-scriptum Â«Payer pour les voyagesÂ». <br><a name="habracut"></a><br>  Dans VC, cela ressemble gÃ©nÃ©ralement Ã  ceci: <br><br><img src="https://habrastorage.org/webt/ti/eh/cd/tiehcdyeskmccfofp3adt2ko_qe.png" alt="image"><br><br>  Un commentaire typique ressemble Ã  ceci: <br><br><img src="https://habrastorage.org/webt/ki/kp/s0/kikps0wwqqptfwyro8hrf81rtzg.png" alt="image"><br><br>  La structure est extrÃªmement simple.  Dans le commentaire, il y a des noms de l'arrÃªt oÃ¹ les contrÃ´leurs Ã©taient actuellement remarquÃ©s, il y a aussi la direction dans laquelle ils se trouvent: <br><br><img src="https://habrastorage.org/webt/no/gy/2l/nogy2l1lrraa8gte90lcyuwsume.png" alt="image"><br><br>  En consÃ©quence, le commentaire est un objet avec un arrÃªt, une heure et une date, ainsi qu'un identifiant unique permettant de l'identifier.  Avec cela, vous pouvez calculer l'emplacement le plus probable de l'emplacement actuel des contrÃ´leurs. <br><br><h4>  La prÃ©paration </h4><br>  Vous devez d'abord dÃ©terminer le public cible, Ã  partir duquel nous analyserons les donnÃ©es.  Le groupe devrait avoir beaucoup d'activitÃ© dans les commentaires, sinon nous risquons d'obtenir trop peu de donnÃ©es <br><br>  Dans mon cas, c'est le groupe Â«Control GomelÂ». <br><br>  Nous analyserons les commentaires Ã  l'aide de l'API VKontakte officielle pour Python <br><br>  Nous nous authentifions avec la clÃ© d'accÃ¨s de l'utilisateur, car certains groupes peuvent Ãªtre fermÃ©s et l'accÃ¨s Ã  leurs commentaires ne peut Ãªtre obtenu que si vous avez Ã©tÃ© acceptÃ© dans le groupe. <br>  AprÃ¨s cela, vous pouvez commencer Ã  extraire des commentaires: <br><br><h4>  Recevoir des commentaires </h4><br>  Pour commencer, nous obtenons le dernier message disponible dans le groupe pour extraire les commentaires via vk.wall.getComments et initialiser le DataFrame, dans lequel nous enregistrerons les donnÃ©es. <br><br>  Chaque article de commentaire a l'inscription Â«Passez une bonne journÃ©e, payez le prix et ne tombez pas sous le contrÃ´leÂ», alors tÃ©lÃ©chargez les commentaires, vÃ©rifiez le contenu de l'article et obtenez un tableau de commentaires Ã  partir duquel vous pouvez prendre des donnÃ©es. <br><br>  J'ai pris les commentaires des articles au cours des 3 derniers mois, Ã©tant donnÃ© qu'un article est publiÃ© chaque jour (maintenant fin novembre, l'annÃ©e scolaire commence en septembre, et les contrÃ´leurs en tiennent probablement compte et changent de place).  En principe, d'autres signes peuvent Ãªtre pris en compte, comme par exemple la pÃ©riode de l'annÃ©e. <br><br>  Certains des commentaires sont bouchÃ©s par des messages comme Â«Y a-t-il quelqu'un sur Barykin?Â»  Si vous regardez ces commentaires (inutiles), vous pouvez mettre en Ã©vidence certains signes: <br><br><ul><li>  Le texte contient les mots Â«propreÂ», Â«gaucheÂ», Â«personneÂ» et similaires </li><li>  Les mots Â«dites-moiÂ», Â«quiÂ», Â«quoiÂ», Â«commentÂ» </li><li>  Des symboles, comme des Ã©moticÃ´nes, par exemple </li></ul><br>  AprÃ¨s cela, nous passons en revue un tableau de commentaires et en retirons un identifiant, un texte, une heure, une date et un jour de la semaine uniques, que nous mettons dans le DataFrame dÃ©jÃ  crÃ©Ã©. <br><br><div class="spoiler">  <b class="spoiler_title">Recevoir des commentaires</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> re <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> vk_api <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> check_correctness <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">auth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> vk_session = vk_api.VkApi(lp.login, lp.password) vk_session.auth() vk = vk_session.get_api() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vk <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataFromComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(vk, groupID)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#     posts = vk.wall.get(owner_id=groupID, offset=1, count=90) print("\n") data = pd.DataFrame(columns=['text', 'post_id', "date", "day_in_week", "hour","minute", "day_in_month"]) for post in posts.get("items"): # id     postID = post.get("id") if "  ,       " not in post.get("text"): continue #  commentary       comments = vk.wall.getComments(owner_id=groupID, post_id=postID, count=200) #           dataframe for comment in comments.get("items"): text = comment.get("text") text = re.sub(r"A-Za-z--0123456789 ", "", str(text)) commentaryIsNice = check_correctness.detection(text) if commentaryIsNice: print(text) date = comment.get("date") time_struct = time.gmtime(date) post_id = comment.get("post_id") data = data.append({"text": text, "post_id" : post_id, "date": date,"day_in_week" : time_struct.tm_wday, "hour": (time_struct.tm_hour+3), "minute": time_struct.tm_min, "day_in_month": time_struct.tm_mday}, ignore_index=True) # print(data[:10]) # print(data.info()) print("dataset is ready") return data</span></span></code> </pre> <br></div></div><br>  Ainsi, nous avons reÃ§u un DataFrame avec le texte des commentaires, leur identifiant, le jour de la semaine, l'heure et la minute dans laquelle le commentaire a Ã©tÃ© Ã©crit.  Nous n'avons besoin que du jour de la semaine, de l'heure d'Ã©criture et du texte.  Cela ressemble Ã  ceci: <br><br><img src="https://habrastorage.org/webt/cd/hs/cy/cdhscyg3rx4f5kejgvjdguuscui.png" alt="image"><br><br><h4>  Nettoyage des donnÃ©es </h4><br>  Maintenant, nous devons effacer les donnÃ©es.  Il est nÃ©cessaire de supprimer la direction du commentaire afin de faire moins d'erreurs lors de la recherche de la distance Levenshtein.  Nous trouvons les expressions Â«sur le cÃ´tÃ©Â», Â«allerÂ», Â«commentÂ», Â«prÃ¨sÂ», car elles sont gÃ©nÃ©ralement suivies du nom du deuxiÃ¨me arrÃªt, et nous les supprimons avec ce qui vient aprÃ¨s, ainsi que remplacer certains noms de jargon des arrÃªts par l'habituel . <br><br><div class="spoiler">  <b class="spoiler_title">Effacer les donnÃ©es</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> fuzzywuzzy <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> process <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear_commentary</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    -     """</span></span> index = <span class="hljs-number"><span class="hljs-number">0</span></span> splitted = text.split(<span class="hljs-string"><span class="hljs-string">" "</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, s <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(splitted): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(splitted) == <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> np.NaN <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> ( <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> ( <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s)) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> s <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>): index = i <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> index <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> index &lt; len(splitted) - <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>): splitted.remove(splitted[index]) string = <span class="hljs-string"><span class="hljs-string">" "</span></span>.join(splitted) text = (string.lower()) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> index <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: splitted = splitted[:index] string = <span class="hljs-string"><span class="hljs-string">" "</span></span>.join(splitted) text = string.lower() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: text = <span class="hljs-string"><span class="hljs-string">" "</span></span>.join(splitted).lower() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clean_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-function">:</span></span> data.dropna(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>].map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: clear_commentary(s)) data.dropna(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) print(<span class="hljs-string"><span class="hljs-string">"cleaned"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data</code> </pre> <br></div></div><br><h4>  Conversion Ã  l'aide de la distance de Levenshtein </h4><br>  Nous allons directement Ã  la distance Levenshane.  Un peu d'aide: distance Levenshtein - le nombre minimum d'opÃ©rations pour insÃ©rer un caractÃ¨re, supprimer un caractÃ¨re et remplacer un caractÃ¨re par un autre, nÃ©cessaire pour transformer une ligne en une autre. <br><br>  Nous le trouverons en utilisant la bibliothÃ¨que <a href="https://github.com/seatgeek/fuzzywuzzy">fuzzywuzzy</a> .  Il vous aide Ã  calculer rapidement et facilement la distance Levenshtein.  Pour accÃ©lÃ©rer le travail, les auteurs de la bibliothÃ¨que recommandent Ã©galement d'installer la bibliothÃ¨que python-Levenshtein. <br><br>  Afin d'obtenir des arrÃªts Ã  partir des commentaires, nous avons besoin d'une liste d'arrÃªts.  Il m'a Ã©tÃ© gracieusement fourni par le dÃ©veloppeur de l'application GoTrans, Alexander Kozlov. <br><br>  La liste a dÃ» Ãªtre Ã©largie, en y ajoutant des arrÃªts qui n'Ã©taient pas lÃ , et en changeant une partie des noms afin qu'ils soient mieux localisÃ©s. <br><br><div class="spoiler">  <b class="spoiler_title">ArrÃªte</b> <div class="spoiler_text">  stops = ['supermarchÃ©', 'prairie', 'remybtekhnika', 'Leningrad', 'Yaroslavl', 'Polesskaya', <br>  Â«YaroslavlÂ», Â«timofeenkoÂ», Â«8 marsÂ», <br>  Â«Rechitsky trading houseÂ», Â«Rechitsky avenueÂ», Â«circusÂ», Â«department storeÂ», Â«ChongarskayaÂ», <br>  Â«chongarkaÂ», Â«gguÂ», Â«skorinaÂ», Â«universitÃ©Â», Â«appareilÂ», Â«1000 petites chosesÂ», Â«mayaÂ», Â«stationÂ», <br>  Â«parc des diplÃ´mÃ©sÂ», Â«commerce et Ã©conomieÂ», Â«anniversaireÂ», Â«microdistrict 18Â», Â«aÃ©roportÂ», Â«venant en sens inverseÂ», <br>  Â«gomelgeodezcentrÂ», Â«cristalÂ», Â«lac lyubenskoyeÂ», Â«marchÃ© davydovskyÂ», Â«davydovkaÂ», <br>  Â«riviÃ¨re sozhÂ», Â«gomeldrevÂ», <br>  Â«SevrukiÂ», Â«gmu n Â° 1Â», Â«etc. RechitskyÂ», Â«costumeÂ», Â«hÃ´pital des maladies infectieusesÂ», Â«camp de goÃ©landsÂ», <br>  Volotova, Coral, Gomeltorgmash, Gomelproekt, Vneshgomelstroy, Journal, <br>  Â«KalenikovaÂ», Â«EreminoÂ», Â«distillerieÂ», Â«spÃ©cialisation industrielleÂ», Â«2nd SchoolÂ», Â«BarykinaÂ», <br>  Â«unitÃ©s de machineÂ», Â«jeunesseÂ», Â«corps de coulÃ©eÂ», Â«chimistesÂ», Â«golovatskyÂ», Â«budennyÂ», <br>  'spu67', '35th', 'gagarin', '50 years to the Gomselmash plant ',' hill ',' radio factory ', <br>  Â«grand-mÃ¨reÂ», Â«verrerieÂ», Â«chÃ¢taignierÂ», Â«dÃ©marrage des moteursÂ», Â«astronautesÂ», <br>  Â«rtsrm initialÂ», Â«bykhovskayaÂ», Â«institut du ministÃ¨re des situations d'urgenceÂ», Â«dk gomselmashÂ», Â«magasinÂ», Â«rechitskyÂ», <br>  'Sevruks', 'Osovtsy', 'tourist', 'meat factory', 'Holy Trinity', 'medical town', 'octobre', <br>  Â«dÃ©pÃ´t d'huileÂ», Â«gomelloblavtotransÂ», Â«milkavitaÂ», Â«bakuninÂ», Â«zipÂ», Â«omaÂ», Â«rÃ©sineÂ», <br>  Â«construction market kskÂ», Â«road builderÂ», Â«fieldÂ», Â«kamenetskayaÂ», Â«bolchevikÂ», Â«jakubovkaÂ», <br>  Â«BorodinaÂ», Â«hypermarchÃ© hippopotameÂ», Â«hÃ©ros souterrainsÂ», Â«9 maiÂ», Â«chÃ¢taignierÂ», Â«prothÃ©sisteÂ», <br>  'iput station', 'communist international', 'music pedagogical college', 'farm firm', 'bypass road', 'victoire', <br>  Â«westernÂ», Â«pearlÂ», Â«VladimirÂ», Â«dryÂ», Â«dispensaryÂ», Â«IvanovaÂ», <br>  Â«construction de machinesÂ», Â«bouleauxÂ», Â«60 ansÂ», Â«ingÃ©nieur Ã©lectricienÂ», Â«centroliteÂ», <br>  Â«clinique oncologiqueÂ», Â«champ de tirÂ», Â«golovintsyÂ», Â«corailÂ», Â«sudÂ», Â«printempsÂ», <br>  Efremova, Border, Belgut, Gomelstroy, Borisenko, Athletics Palace, <br>  Â«MichurinskyÂ», Â«solaireÂ», Â«gastelloÂ», Â«militaireÂ», Â«centre automobileÂ», Â«plomberieÂ», Â«uzaÂ», <br>  Â«collÃ¨ge mÃ©dicalÂ», Â«maternelle 11Â», Â«bolchevikÂ», Â«chiotsÂ», Â«DavydovskyÂ», Â«ocÃ©anÂ», Â«progrÃ¨sÂ», <br>  Â«DobrushskayaÂ», Â«blancÂ», Â«GSKÂ», Â«davydovkaÂ», Â«Ã©quipement Ã©lectriqueÂ», Â«amitiÃ©Â», <br>  Â«70 ansÂ», Â«rÃ©paration automobileÂ», Â«colline suÃ©doiseÂ», Â«circuitÂ», Â«canal d'eauÂ», Â«machine gomelÂ», <br>  Volotova, Pioneer, RCM, Khimtorg, 2nd Meadow Lane, Bochkina, Baths, <br>  Â«clinique oncologiqueÂ», Â«carrÃ©Â», Â«LÃ©nineÂ», Â«1Ã¨re Ã©coleÂ», Â«magasin sudÂ», <br>  Â«gomelagrotransÂ», Â«meuniersÂ», Â«lyubenskyÂ», Â«bureau d'enrÃ´lement militaireÂ», Â«hÃ´pitalÂ», Â«uzaÂ», Â«rtsrmÂ», <br>  Â«lysyukovyhÂ», Â«shop iputÂ», Â«ratonÂ», Â«gas stationÂ», Â«randovskyÂ», Â«farmhouseÂ», Â«chÃ¢taignierÂ», Â«ropovskyÂ», <br>  Â«RomanovichiÂ», Â«IlyichÂ», Â«avironÂ», Â«entreprise de constructionÂ», Â«infectieuxÂ», <br>  Â«fat factoryÂ», Â«car serviceÂ», Â«agroserviceÂ», Â«stickyÂ», Â«NikolskayaÂ», <br>  Â«abatteuses automotricesÂ», Â«maÃ§onsÂ», Â«matÃ©riaux de constructionÂ», Â«machines de rÃ©parationÂ», Â«administrationÂ», <br>  Â«OctobreÂ», Â«conte de fÃ©es forestierÂ», Â«TatianaÂ», Â«Boris TsarikovÂ», Â«ZharkovskyÂ», Â«ZaitsevaÂ», <br>  Â«dÃ©localisationÂ», Â«KarpovichÂ», Â«usine de construction de maisonsÂ», Â«transports Ã©lectriques urbainsÂ», Â«zlinÂ», <br>  Â«stade gomselmashÂ», Â«ap 6Â», Â«entraÃ®nement hydrauliqueÂ», Â«dÃ©pÃ´t de locomotivesÂ», Â«marchÃ© automobile osovtsyÂ», <br>  Â«nouvelle vieÂ», Â«ZhukovaÂ», Â«unitÃ© militaireÂ», Â«3e Ã©coleÂ», Â«forÃªtÂ», Â«phare rougeÂ», <br>  Â«rÃ©gionalÂ», Â«DavydovskayaÂ», Â«KarbyshevaÂ», Â«satellite du mondeÂ», Â«jeunesseÂ», Â«locomotive du stadeÂ», <br>  Â«solaireÂ», Â«LadaserviceÂ», Â«Î¼R 21Â», Â«AresaÂ», Â«internationalistesÂ», Â«KosarevaÂ», <br>  Â«BogdanovaÂ», Â«Gomel iron-concreteÂ», Â«Î¼r 20aÂ», Â«Î¼r RechitskyÂ», Â«medical equipmentÂ», Â«JuraevaÂ», <br>  Â«collÃ¨ge d'artisanat d'artÂ», Â«glaceÂ», Â«festival dkÂ», Â«centre commercialÂ», <br>  'Kuibyshevsky', 'festival', 'garage koop 27', 'gÃ©nie sismique', 'milcha', 'tube hospital', <br>  Â«ptu179Â», Â«produits chimiquesÂ», Â«pompiersÂ», Â«hÃ´pitalÂ», Â«dÃ©pÃ´t de busÂ», <br>  Â«complexe de journauxÂ», Â«victoireÂ», Â«klenkovskyÂ», Â«diamantÂ», Â«rÃ©paration de moteurÂ», Â«mkr 19Â»] <br></div></div><br>  En utilisant .map et fuzzywuzzy.process.extractOne, nous trouvons l'arrÃªt avec la distance Levenshtein minimale dans la liste, aprÃ¨s quoi nous remplaÃ§ons le texte du commentaire par le nom de l'arrÃªt, ce qui nous permet d'obtenir un ensemble de donnÃ©es avec les noms des arrÃªts. <br><br>  L'ensemble de donnÃ©es rÃ©sultant ressemble Ã  ceci: <br><br><img src="https://habrastorage.org/webt/gd/pd/c8/gdpdc8lwdppzpastghnasxbqsbi.png"><br><br><div class="spoiler">  <b class="spoiler_title">Les commentaires se transforment en arrÃªts</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_category_from_comment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""              """</span></span> dict = process.extractOne(text.lower(), stops) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> dict[<span class="hljs-number"><span class="hljs-number">1</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">75</span></span>: text = dict[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: text = np.nan print(<span class="hljs-string"><span class="hljs-string">"wait"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_category_dataset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""      """</span></span> print(<span class="hljs-string"><span class="hljs-string">"remap started. wait"</span></span>) data.text = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> comment: get_category_from_comment(str(comment))) print(<span class="hljs-string"><span class="hljs-string">"remap ends"</span></span>) data.dropna(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: <span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: <span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data</code> </pre> <br></div></div><br><h4>  Sortie de donnÃ©es </h4><br>  Nous pouvons maintenant supposer oÃ¹ les contrÃ´leurs seront le plus probablement Ã  l'heure donnÃ©e. <br><br>  Nous recherchons dans les enregistrements de donnÃ©es rÃ©sultants pour une heure et un jour spÃ©cifiques de la semaine.  Par exemple, le mardi Ã  9 h: <br><br><pre> <code class="python hljs">&lt;code&gt;data[(data[<span class="hljs-string"><span class="hljs-string">"day_in_week"</span></span>] == day) &amp; (data[<span class="hljs-string"><span class="hljs-string">"hour"</span></span>] == hour)]&lt;/code&gt;</code> </pre> <br><img src="https://habrastorage.org/webt/t4/gg/dg/t4ggdgmwezje8lgllisorbqrqwa.png"><br>  <i>(ce ne sont pas toutes les donnÃ©es)</i> <br><br>  AprÃ¨s cela, nous trouvons le nombre d'arrÃªts uniques et affichons uniquement les arrÃªts et leur nombre: <br><br><pre> <code class="python hljs">df[(df[<span class="hljs-string"><span class="hljs-string">"day_in_week"</span></span>] == <span class="hljs-number"><span class="hljs-number">2</span></span>) &amp; (df[<span class="hljs-string"><span class="hljs-string">"hour"</span></span>] == <span class="hljs-number"><span class="hljs-number">9</span></span>)][<span class="hljs-string"><span class="hljs-string">"text"</span></span>].value_counts()</code> </pre> <br><img src="https://habrastorage.org/webt/yq/az/if/yqazifl3gkclyqw4ifykvemsrky.png"><br><br>  Maintenant, nous pouvons dire qu'Ã  9 heures du matin, le mardi, les contrÃ´leurs seront trÃ¨s probablement repÃ©rÃ©s aux arrÃªts Myasokombinat, ul.  Lugovaya, BelGUT, TD Â«OmaÂ». <br><br>  Le principal dÃ©faut de cette mÃ©thode est le manque de donnÃ©es.  Pas pour tous les jours et heures, il y a des entrÃ©es dans les commentaires donnÃ©s aux heures de pointe, lorsque les gens utilisent plus les transports publics que les donnÃ©es aux heures moins populaires, mais si vous ajoutez des donnÃ©es, par exemple, non seulement Ã  partir des commentaires d'un groupe, mais aussi Ã  partir de groupes alternatifs ou de chats tÃ©lÃ©grammes, avec le nombre d'entrÃ©es, tout deviendra plus facile. <br><br><h4>  Bot avec VK LongPoll API </h4><br>  Pour donner la possibilitÃ© de recevoir des donnÃ©es sur l'emplacement des contrÃ´leurs, selon l'heure, et sans Ãªtre liÃ© Ã  un ordinateur, j'ai crÃ©Ã© un bot pour un groupe sur VKontakte qui rÃ©pond Ã  n'importe quel message en envoyant le nombre d'arrÃªts dans les enregistrements, compte tenu de l'heure et du jour de la semaine. <br><br><div class="spoiler">  <b class="spoiler_title">Code Bot</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> randint <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> vk_api <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> get_stops_from_data <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> get_stops_by_time <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start_bot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data, token)</span></span></span><span class="hljs-function">:</span></span> vk_session = vk_api.VkApi(token=token) vk = vk_session.get_api() print(<span class="hljs-string"><span class="hljs-string">"bot started"</span></span>) longPoll = vk.groups.getLongPollServer(group_id=<span class="hljs-number"><span class="hljs-number">183524419</span></span>) server, key, ts = longPoll[<span class="hljs-string"><span class="hljs-string">'server'</span></span>], longPoll[<span class="hljs-string"><span class="hljs-string">'key'</span></span>], longPoll[<span class="hljs-string"><span class="hljs-string">'ts'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-comment"><span class="hljs-comment">#  :   ts longPoll = post('%s' % server, data={'act': 'a_check', 'key': key, 'ts': ts, 'wait': 25}).json() if longPoll['updates'] and len(longPoll['updates']) != 0: for update in longPoll['updates']: if update['type'] == 'message_new': #        vk.messages.markAsRead(peer_id=update['object']['user_id']) user = update['object']["user_id"] text = get_stops_by_time(data) if text is None or text == {}: message = "Ã­Ã¥Ã² Ã§Ã Ã¯Ã¨Ã±Ã¥Ã©" vk.messages.send(user_id=user, random_id=randint(-2147483648, 2147483647), message=message) print(message) ts = longPoll['ts'] continue message = "   -     \n" \ "\n \n" for i in text.items(): message += i[0] + " " message += str(i[1]) message += "\n" #    vk.messages.send(user_id=user, random_id=randint(-2147483648, 2147483647), message=message) ts = longPoll['ts']</span></span></code> </pre> <br></div></div><br><h4>  Conclusion </h4><br>  La qualitÃ© de telles hypothÃ¨ses a Ã©tÃ© testÃ©e par moi plus d'une fois dans la pratique, et tout fonctionne bien.  Il s'est avÃ©rÃ© que les contrÃ´leurs, au fond, sont aux mÃªmes arrÃªts, bien que des prÃ©visions absolument correctes ne puissent pas Ãªtre donnÃ©es, et la probabilitÃ© de succÃ¨s n'est pas de 100%.  La distance de Levenshtein a des dizaines d'applications diffÃ©rentes, de la correction d'erreurs en un mot, Ã  la comparaison de gÃ¨nes, de chromosomes et de protÃ©ines, mais elle a Ã©galement un potentiel dans de tels problÃ¨mes appliquÃ©s. <br><br>  Passez une bonne journÃ©e et payez le prix. <br><br>  Toutes les manipulations de code bot et de donnÃ©es sont publiÃ©es <a href="https://github.com/dingdongyouarewrong/vk_controllers_bot">ici</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr478490/">https://habr.com/ru/post/fr478490/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr478474/index.html">Le frÃ¨re Pablo Escobar a Ã©galement sorti un smartphone flexible</a></li>
<li><a href="../fr478480/index.html">Intelligence artificielle, ITSM et, en gÃ©nÃ©ral, d'oÃ¹ vient LEAN?</a></li>
<li><a href="../fr478482/index.html">Le dÃ©veloppeur a ouvert un bar pour les dÃ©veloppeurs et y accueille des rÃ©unions sur Angular, layout, PHP</a></li>
<li><a href="../fr478484/index.html">SCADA sur la framboise: mythe ou rÃ©alitÃ©?</a></li>
<li><a href="../fr478486/index.html">L'Ã¨re des puces 10 nm - qui dÃ©veloppe de tels processeurs et ce qui attend l'industrie Ã  l'avenir</a></li>
<li><a href="../fr478492/index.html">Escherichia coli au rÃ©gime CO2: un nouvel outil pour lutter contre le rÃ©chauffement climatique?</a></li>
<li><a href="../fr478494/index.html">Solution de traitement thermique Winnum TRP: configuration et utilisation</a></li>
<li><a href="../fr478496/index.html">Il y a 50 ans, dans la piÃ¨ce 3420, Internet Ã©tait nÃ©</a></li>
<li><a href="../fr478498/index.html">1. Mise en route de Fortinet v 6.0. PrÃ©sentation</a></li>
<li><a href="../fr478500/index.html">Pourquoi y a-t-il si peu de confÃ©rences en Ã©tÃ©?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>