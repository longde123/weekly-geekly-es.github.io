<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôåüèº üôãüèº üèÜ Kronos: Keine Zeitreise auch in verteilten Systemen üôç üë©‚Äç‚öñÔ∏è üêÅ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In verteilten Systemen gibt es eine Reihe grundlegender Probleme: effiziente verteilte Transaktionen, genau einmalige Datenverarbeitung, genaue Synchr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kronos: Keine Zeitreise auch in verteilten Systemen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/goto/blog/426399/"><p> In verteilten Systemen gibt es eine Reihe grundlegender Probleme: effiziente verteilte Transaktionen, genau einmalige Datenverarbeitung, genaue Synchronisation der physischen Uhren.  Um das letztere Problem zu l√∂sen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">, wurden</a> verschiedene Arten von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Logiktakten</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">erfunden</a> . </p><br><p>  Trotzdem haben <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vektoruhren</a> unangenehme Eigenschaften: Sie f√ºhren eine bedingte Abh√§ngigkeit zwischen Ereignissen ein, bei denen sie nicht existieren, und verlieren sie dort, wo sie tats√§chlich sind. </p><br><p>  Sie k√∂nnen sich jedoch etwas Zuverl√§ssigeres einfallen lassen - Kronos.  In diesem Artikel werden wir uns den Ursache-Wirkungs-Beziehungsabrechnungsalgorithmus und seine Anwendung zum Erstellen von Schl√ºsselwertspeichern mit verteilten Transaktionen ansehen. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b9e/7e5/9fd/b9e7e59fdf49111679ce30f147448e39.png" alt="Bild"></p><a name="habracut"></a><br><h2 id="problemy">  Die Probleme </h2><br><p>  Wie bereits erw√§hnt, gibt es eine Reihe von Problemen mit der logischen Uhr: </p><br><ul><li><p>  <em>Nicht existierende Abh√§ngigkeiten</em> entstehen, weil eine logische Uhr eine <em>vollst√§ndige Reihenfolge</em> von Ereignissen einf√ºhrt - das hei√üt, jedes von zwei Ereignissen kann als bedingt fr√ºher und welches bedingt sp√§ter bezeichnet werden.  Der Vertrag ist an Bedingungen gekn√ºpft, da es unm√∂glich ist, die Beziehung zwischen Ereignissen in der Zeit genau zu bestimmen, auch aufgrund der speziellen Relativit√§tstheorie. </p><br></li><li><p>  Andererseits ber√ºcksichtigt ein Logiktakt nur die Verbindung durch Nachrichten innerhalb des Systems.  Wenn zwei Ereignisse miteinander verbunden sind, jedoch au√üerhalb des Systems, z. B. durch den Benutzer (Hinzuf√ºgen von Waren zum Warenkorb in einem Teil des Systems -&gt; Zahlung f√ºr die Bestellung), kann die logische Uhr eine solche Beziehung √ºbersehen. </p><br></li><li><p>  Auf logische Uhren kann nicht von au√üen zugegriffen werden, und es ist auch schwierig, mehrere unabh√§ngige Komponenten (verteiltes Dateisystem, Anforderungsverarbeitungsdienste, Analyse) miteinander zu verbinden. </p><br></li></ul><br><h2 id="reshenie">  L√∂sung </h2><br><p>  Ein Artikel von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kronos aus dem Jahr</a> 2014 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">: Das Design und die Implementierung eines Event Ordering Service</a> schl√§gt eine L√∂sung vor - einen eigenst√§ndigen Service, der die Ursache-Wirkungs-Beziehungen in Events ber√ºcksichtigt. </p><br><p>  Die Hauptabstraktion in Kronos ist ein Ereignis, bei dem eine teilweise Ordnung eingef√ºhrt wird.  Das Kausalit√§tsverh√§ltnis ist transitiv - das hei√üt, wenn wir beispielsweise wissen, dass die Erstellung einer Datei ihrer √Ñnderung vorausgeht und die √Ñnderung der L√∂schung vorausgeht, k√∂nnen wir eine logische Schlussfolgerung ziehen, dass die Erstellung vor dem L√∂schen erfolgt ist. </p><br><p>  Die Mindest-API kann mit den folgenden Methoden definiert werden: </p><br><table><thead><tr><th>  Methode </th><th>  Ergebnis </th><th>  Kommentar </th></tr></thead><tbody><tr><td><code>create_event()</code> </td> <td> <code>e</code> </td> <td>  Erstellt ein neues Ereignis in Kronos </td></tr><tr><td> <code>query_order([(e_1, e_2), ...])</code> </td> <td> <code>[&lt;-, concurrent, -&gt;, ...]</code> </td> <td>  F√ºr jedes Paar der Anforderung wird die Ursache-Wirkungs-Beziehungsrichtung oder die <em>Gleichzeitigkeit von</em> Ereignissen zur√ºckgegeben </td></tr><tr><td> <code>assign_order([(e_1, e_2, must), (e_3, e_4, prefer), ...])</code> </td> <td> <code>OK/FAIL</code> </td> <td>  Legt f√ºr jedes Paar der Anforderung die Richtung der Verursachung fest </td></tr><tr><td> <code>acquire_ref(e)</code> </td> <td> <code>OK</code> </td> <td>  Erh√∂ht den Referenzz√§hler f√ºr dieses Ereignis. </td></tr><tr><td> <code>release_ref(e)</code> </td> <td> <code>OK</code> </td> <td>  Verringert die Referenzanzahl f√ºr dieses Ereignis. </td></tr></tbody></table><br><h2 id="realizaciya">  Implementierung </h2><br><p>  Es ist logisch, dass das System auf einem orientierten Ereignisdiagramm mit einer effektiven Breitensuche zur √úberpr√ºfung der Beziehung von Ereignissen, einem Stabilit√§tsmechanismus im Fehlerfall und einer Speicherbereinigung basiert. </p><br><p>  Wie aus der API <code>assign_order</code> akzeptiert die Anforderung <code>assign_order</code> einen Kausalbeziehungstyp: <code>must</code> oder <code>prefer</code> .  <code>must</code> entspricht strengen Invarianten - z. B. " <code>_-&gt;_</code> , darf " <code>_-&gt;_</code> nicht angewendet werden, wenn es mit " <code>must</code> Beziehungen" in Konflikt steht.  Ein Beispiel f√ºr die Verwendung von " <code>prefer</code> ist, dass fr√ºher eingegangene Anforderungen besser fr√ºher verpackt werden. Dies hat jedoch keinen Einfluss auf die Richtigkeit. </p><br><h3 id="effektivnyy-bfs">  Effektives BFS </h3><br><p>  In unserem Fall ist das Diagramm m√∂glicherweise gro√ü, aber Ereignisse, f√ºr die √úberpr√ºfungsanforderungen ausgef√ºhrt werden, sind normalerweise geschlossen.  Daher m√ºssen Sie BFS in solchen F√§llen schneller ausf√ºhren. </p><br><p>  In der Standardimplementierung ist der l√§ngste Ort die Initialisierung des Arrays der besuchten Scheitelpunkte, die immer Zeit ben√∂tigt, die der Anzahl der Scheitelpunkte im Diagramm entspricht.  Stattdessen k√∂nnen Sie eine Hash-Tabelle verwenden oder andere Tricks anwenden. </p><br><h3 id="sborka-musora">  M√ºllabfuhr </h3><br><p>  Wie Sie der Tabelle <code>acquire_ref</code> k√∂nnen, gibt es zwei weitere Methoden: <code>acquire_ref</code> und <code>release_ref</code> . </p><br><p>  In Kronos wird f√ºr jedes Ereignis ein Referenzz√§hler gespeichert.  W√§hrend einige Dienste das Ereignis verarbeiten oder die M√∂glichkeit behalten, neue Ereignisse hinzuzuf√ºgen, <em>die nach dem</em> aktuellen Ereignis auftreten, wird der Link gespeichert.  Wenn diese Notwendigkeit verschwindet, ruft der Dienst <code>release_ref</code> . </p><br><p>  Kronos l√∂scht das Ereignis, wenn alle Bedingungen erf√ºllt sind: </p><br><ol><li>  Die Anzahl der Links hat Null erreicht </li><li>  Alle Ereignisse davor sind bereits aus dem Diagramm gel√∂scht. </li></ol><br><p>  Dieser Ansatz schr√§nkt m√∂gliche Abfragen nicht ein, spart jedoch Speicher in Kronos. </p><br><h2 id="prilozheniya">  Anwendungen </h2><br><p>  Betrachten Sie die Verwendung des Systems am Beispiel der Schl√ºsselwertspeicherung mit verteilten Transaktionen. </p><br><p>  Angenommen, es gibt mehrere Server. Jeder Server ist f√ºr eine Reihe von Schl√ºsseln verantwortlich. </p><br><p>  Jede Transaktion entspricht einem Ereignis in Kronos.  F√ºr jeden Schl√ºssel muss der Server die Nummer der letzten Transaktion speichern, an der dieser Schl√ºssel teilgenommen hat.  Der Client erstellt ein Ereignis und sendet seine Nummer an alle Server, deren Schl√ºssel von dieser Transaktion betroffen sind.  Der Server versucht, in Kronos eine Abh√§ngigkeit zwischen der aktuellen Transaktionsnummer und dem vorherigen Ereignis zu erstellen, das f√ºr diesen Schl√ºssel gespeichert wurde.  Wenn Sie die Abh√§ngigkeit nicht erstellen k√∂nnen, wird die Transaktion als nicht erfolgreich erkannt (beachten Sie, dass bis jetzt noch keine Interaktion mit den Daten besteht). </p><br><p>  Wenn alle Operationen zum Hinzuf√ºgen von Abh√§ngigkeiten erfolgreich abgeschlossen wurden, bedeutet dies, dass die Transaktion stattfindet und ausgef√ºhrt werden kann.  Server erfahren dies vom Client und beginnen, Teile der Transaktion auszuf√ºhren. </p><br><p>  Beachten Sie, dass solche Transaktionen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ACID sind</a> : </p><br><ul><li>  <strong>Atomarit√§t</strong> : Die Transaktion wird entweder nicht in Kronos oder f√ºr die Ausf√ºhrung auf allen Knoten geplant. </li><li>  <strong>Konsistenz</strong> : automatisch in KV-Repositorys. </li><li>  <strong>Isolation</strong> : Wenn sich zwei Transaktionen gem√§√ü Daten √ºberschneiden, werden sie durch einen Kausalzusammenhang in Kronos verbunden, was bedeutet, dass eine vor der anderen ausgef√ºhrt wird. </li><li>  <strong>Haltbarkeit</strong> : Da Kronos sturzsicher ist und davon ausgeht, dass jede Replik des Tresors auch stabil ist, muss nur die Persistenz der Daten ausstehender Transaktionen nachgewiesen werden.  Wenn die Transaktion vom Client als erfolgreich markiert wird, der Datensatz jedoch noch nicht auf dem Server abgeschlossen wurde, ist diese Tatsache leicht festzustellen, da der Server auch die abgeschlossenen Teile der Transaktionen verfolgt. </li></ul><br><h3 id="proizvoditelnost">  Leistung </h3><br><p>  Die Implementierung eines solchen KV-Speichers kann tats√§chlich effektiv sein.  Der urspr√ºngliche Artikel zitiert Daten, dass die beschriebene Implementierung von KV-Speicher viermal schneller ist als die auf Sperren basierende Transaktion. </p><br><p>  Dar√ºber hinaus liegt das System √ºber Kronos im Vergleich zu MongoDB nur 6% zur√ºck, obwohl MongoDB keine verteilten Transaktionen verwendet. </p><br><h2 id="analiz">  Analyse </h2><br><p>  Der Betrieb von Kronos hat jedoch mehrere Nachteile. </p><br><ul><li>  Erstens gibt es den Aufwand f√ºr den Zugriff auf Kronos - f√ºr jede Anforderung ist mindestens ein Anruf erforderlich. </li><li>  Kronos wird auch eine einzige Fehlerquelle sein - die Autoren des Artikels bieten keine M√∂glichkeiten zum Partitionieren des Ereignisdiagramms. </li><li>  Es w√§re sch√∂n, dem System eine Reihe von Methoden hinzuzuf√ºgen.  Im Beispiel mit KV-Speicher w√§re es beispielsweise sch√∂n, einen R√ºckruf zu haben, der den Server √ºber den Status der Transaktion informiert - er wurde erfolgreich mit allen erforderlichen Abh√§ngigkeiten zum Diagramm hinzugef√ºgt - oder umgekehrt konnte die Transaktion nicht abgeschlossen werden. </li></ul><br><p>  Das beschriebene System erm√∂glicht jedoch eine flexible Kontrolle des Kausalzusammenhangs zwischen Ereignissen, wodurch eine vorhersehbare Einhaltung der erforderlichen Invarianten sichergestellt wird. </p><br><h1 id="zaklyuchenie">  Fazit </h1><br><p>  Dar√ºber unterrichten wir an der GoTo School Sch√ºler und Sch√ºler in Richtung verteilter Systeme. </p><br><p>  Und es gibt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Algorithmen und Anwendungen</a> , Angewandte Programmierung, Bioinformatik und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Datenanalyse</a> </p><br><p>  Besuchen Sie unsere <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Herbstschule</a> vom 27. Oktober bis 4. November oder die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Winterschule</a> Anfang Januar. </p><br><p>  Und wenn Sie kein Sch√ºler oder Sch√ºler mehr sind, <a href="">kommen Sie, um zu unterrichten</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de426399/">https://habr.com/ru/post/de426399/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de426387/index.html">Grafik in Julia. Seltsame Muster, die Reflexion eines Dreiecks von einer geraden Linie und die Konstruktion der Normalen einer kugelf√∂rmigen Katze im Vakuum</a></li>
<li><a href="../de426389/index.html">Die Verdauung von frischen Materialien aus der Welt des Frontends f√ºr die letzte Woche Nr. 334 (7.-14. Oktober 2018)</a></li>
<li><a href="../de426391/index.html">PHP Digest Nr. 141 (1. - 15. Oktober 2018)</a></li>
<li><a href="../de426395/index.html">Zum Zeitpunkt des Kaufs wird eine Geb√ºhr f√ºr Waren aus ausl√§ndischen Online-Shops erhoben</a></li>
<li><a href="../de426397/index.html">Internet Keeper</a></li>
<li><a href="../de426401/index.html">Amazon wird seiner KI beibringen, menschliche Emotionen zu definieren</a></li>
<li><a href="../de426405/index.html">Hacker im Rahmen der Gesetze der Russischen F√∂deration</a></li>
<li><a href="../de426407/index.html">Wie man die Reise zur Konferenz so nutzlos wie m√∂glich macht</a></li>
<li><a href="../de426409/index.html">Der Hacker Alexei, der MikroTik-Router ohne Erlaubnis der Eigent√ºmer sch√ºtzt, ist ber√ºhmt geworden</a></li>
<li><a href="../de426411/index.html">Entwickeln von C ++ / CLI-Deskriptorklassen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>