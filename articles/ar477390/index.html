<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ผ ๐พ ๐ธ๐ฝ ุชุฃุฎูุฑ ุดุจูุฉ ุงูุชุตุญูุญ ูู Kubernetes โ๏ธ ๐ ๐๐ป</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุจู ุนุงููู ุ ูููุดุช Kubernetes ุจุงููุนู ุนูู ูุฏููุฉ ุฌูุซุจ ุงูุฑุณููุฉ. ููุฐ ุฐูู ุงูุญูู ุ ุฃุตุจุญุช ุงูุชูููููุฌูุง ุงูููุงุณูุฉ ููุดุฑ ุงูุฎุฏูุงุช. ุชุฏูุฑ Kubernetes ุงูุขู ุฌุฒุกูุง ูุจูุฑูุง...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุชุฃุฎูุฑ ุดุจูุฉ ุงูุชุตุญูุญ ูู Kubernetes</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/477390/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/c82/5b1/413/c825b1413d9c59cf78c51e6e2c8f8049.png"><br><br>  ูุจู ุนุงููู ุ ูููุดุช Kubernetes <a href="https://github.blog/2017-08-16-kubernetes-at-github/">ุจุงููุนู</a> ุนูู ูุฏููุฉ ุฌูุซุจ ุงูุฑุณููุฉ.  ููุฐ ุฐูู ุงูุญูู ุ ุฃุตุจุญุช ุงูุชูููููุฌูุง ุงูููุงุณูุฉ ููุดุฑ ุงูุฎุฏูุงุช.  ุชุฏูุฑ Kubernetes ุงูุขู ุฌุฒุกูุง ูุจูุฑูุง ูู ุงูุฎุฏูุงุช ุงูุฏุงุฎููุฉ ูุงูุนุงูุฉ.  ูุน ููู ูุฌููุนุงุชูุง ูุฃุตุจุญุช ูุชุทูุจุงุช ุงูุฃุฏุงุก ุฃูุซุฑ ุตุฑุงูุฉ ุ ุจุฏุฃูุง ููุงุญุธ ุฃู ุจุนุถ ุงูุฎุฏูุงุช ุนูู Kubernetes ุชุนุฑุถ ุจุดูู ูุชูุทุน ุงูุชุฃุฎูุฑุงุช ุงูุชู ูุง ูููู ุชูุณูุฑูุง ูู ุฎูุงู ุชุญููู ุงูุชุทุจูู ููุณู. <br><br>  ูู ุงููุงูุน ุ ูู ุงูุชุทุจููุงุช ุ ูุญุฏุซ ุชุฃุฎูุฑ ูู ุดุจูุฉ ุนุดูุงุฆูุฉ ุชุตู ุฅูู 100 ูููู ุซุงููุฉ ุฃู ุฃูุซุฑ ุ ููุง ูุคุฏู ุฅูู ูููุงุช ุฃู ุฅุนุงุฏุฉ ุงููุญุงููุฉ.  ูุงู ูู ุงููุชููุน ุฃู ุชููู ุงูุฎุฏูุงุช ูุงุฏุฑุฉ ุนูู ุงูุงุณุชุฌุงุจุฉ ููุทูุจุงุช ุฃุณุฑุน ุจูุซูุฑ ูู 100 ูููู ุซุงููุฉ.  ูููู ูุฐุง ุบูุฑ ูููู ุฅุฐุง ูุงู ุงูุงุชุตุงู ููุณู ูุณุชุบุฑู ุงููุซูุฑ ูู ุงูููุช.  ุจุดูู ูููุตู ุ ูุงุญุธูุง ุงุณุชุนูุงูุงุช MySQL ุณุฑูุนุฉ ุฌุฏูุง ุ ูุงูุชู ูุงู ูู ุงูููุชุฑุถ ุฃู ุชุฃุฎุฐ ูููู ุซุงููุฉ ุ ูุชูููุช MySQL ูู ุฅุฏุงุฑุฉ ูููู ุซุงููุฉ ุ ูููู ูู ูุฌูุฉ ูุธุฑ ุงูุชุทุจูู ุงูุทุงูุจ ุ ุงุณุชุบุฑูุช ุงูุงุณุชุฌุงุจุฉ 100 ูููู ุซุงููุฉ ุฃู ุฃูุซุฑ. <br><a name="habracut"></a><br>  ุฃุตุจุญ ูู ุงููุงุถุญ ุนูู ุงูููุฑ ุฃู ุงููุดููุฉ ุชุญุฏุซ ููุท ุนูุฏ ุงูุงุชุตุงู ุจูุถูู Kubernetes ุ ุญุชู ูู ูุงูุช ุงูููุงููุฉ ูู ุฎุงุฑุฌ Kubernetes.  ุชุชูุซู ุฃุณูู ุทุฑููุฉ ูุฅุนุงุฏุฉ ุฅูุชุงุฌ ุงููุดููุฉ ูู ุงุฎุชุจุงุฑ <a href="https://github.com/tsenart/vegeta">Vegeta</a> ุ ุงูุฐู ูุชู ุชุดุบููู ูู ุฃู ูุถูู ุฏุงุฎูู ุ ููููู ุจุงุฎุชุจุงุฑ ุฎุฏูุฉ Kubernetes ุนูู ูููุฐ ูุนูู ุ ููุณุฌู ุจุดูู ูุชูุทุน ุชุฃุฎูุฑูุง ูุจูุฑูุง.  ูู ูุฐู ุงูููุงูุฉ ุ ุณููุธุฑ ูู ููููุฉ ุชููููุง ูู ุชุนูุจ ุณุจุจ ูุฐู ุงููุดููุฉ. <br><br><h1 style=";text-align:right;direction:rtl">  ุชุฎูุต ูู ุงูุชุนููุฏุงุช ุบูุฑ ุงูุถุฑูุฑูุฉ ูู ุณูุณูุฉ ุงููุดู </h1><br>  ุจุนุฏ ุฅุนุงุฏุฉ ุฅูุชุงุฌ ููุณ ุงููุซุงู ุ ุฃุฑุฏูุง ุชุถููู ูุทุงู ุงููุดููุฉ ูุฅุฒุงูุฉ ุทุจูุงุช ุงูุชุนููุฏ ุงูุฅุถุงููุฉ.  ูู ุงูุจุฏุงูุฉ ุ ูุงู ููุงู ุงููุซูุฑ ูู ุงูุนูุงุตุฑ ูู ุงูุชูุงุฑ ุจูู Vegeta ูุงููุฑูู ุนูู Kubernetes.  ูุชุญุฏูุฏ ูุดููุฉ ุดุจูุฉ ุฃุนูู ุ ุชุญุชุงุฌ ุฅูู ุงุณุชุจุนุงุฏ ุจุนุถูุง. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/488/8c1/d29/4888c1d29a8fc1b4a1194c4c3a14c9ff.png"><br><br>  ููุดุฆ ุงูุนููู (Vegeta) ุงุชุตุงู TCP ูุน ุฃู ุนูุฏุฉ ูู ุงููุชูุฉ.  ุชุนูู Kubernetes ูุดุจูุฉ ุชุฑุงูุจ (ุนุจุฑ ุดุจูุฉ ูุฑูุฒ ุงูุจูุงูุงุช ุงูุญุงููุฉ) ุ ูุงูุชู ุชุณุชุฎุฏู <a href="https://en.wikipedia.org/wiki/IP_in_IP">IPIP</a> ุ ุฃู ุ ุชููู ุจุชุบููู ุญุฒู IP ูุดุจูุฉ ุงูุชุฑุงูุจ ุฏุงุฎู ุญุฒู IP ุงูุฎุงุตุฉ ุจูุฑูุฒ ุงูุจูุงูุงุช.  ุนูุฏ ุงูุงุชุตุงู ุจุงูุนูุฏุฉ ุงูุฃููู ุ ูุชู ุชูููุฐ ุชุฑุฌูุฉ ุนููุงู ุดุจูุฉ ุชุฑุฌูุฉ ุนููุงู ุงูุดุจูุฉ (NAT) ูุน ูุฑุงูุจุฉ ุงูุญุงูุฉ ูุชุญููู ุนููุงู IP ูุงููููุฐ ุงูุฎุงุต ุจูุถูู Kubernetes ุฅูู ุนููุงู IP ูุงููููุฐ ุนูู ุดุจูุฉ ุงูุชุฑุงูุจ (ุฎุงุตุฉ ุ ุงูุญุงูุธุฉ ูุน ุงูุชุทุจูู).  ููุญุฒู ุงููุณุชููุฉ ุ ูุชู ุชูููุฐ ุงูุชุณูุณู ุงูุนูุณู.  ูุฐุง ูู ูุธุงู ูุนูุฏ ูุน ุงูุนุฏูุฏ ูู ุงูุฏูู ูุงูุนุฏูุฏ ูู ุงูุนูุงุตุฑ ุงูุชู ูุชู ุชุญุฏูุซูุง ุจุงุณุชูุฑุงุฑ ูุชุบููุฑูุง ูุน ูุดุฑ ุงูุฎุฏูุงุช ูููููุง. <br><br>  ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ <code>tcpdump</code> ูู ุงุฎุชุจุงุฑ Vegeta ูุนุทู ุชุฃุฎูุฑ ุฃุซูุงุก ูุตุงูุญุฉ TCP (ุจูู SYN ู SYN-ACK).  ูุฅุฒุงูุฉ ูุฐุง ุงูุชุนููุฏ ุบูุฑ ุงูุถุฑูุฑู ุ ููููู ุงุณุชุฎุฏุงู <code>hping3</code> " <code>hping3</code> " ุงูุจุณูุทุฉ ูุน ุญุฒู SYN.  ุชุญูู ููุง ุฅุฐุง ูุงู ููุงู ุชุฃุฎูุฑ ูู ุญุฒูุฉ ุงูุงุณุชุฌุงุจุฉ ุ ุซู ูู ุจุฅุนุงุฏุฉ ุชุนููู ุงูุงุชุตุงู.  ูููููุง ุชุตููุฉ ุงูุจูุงูุงุช ูู ุฎูุงู ุชุถููู ุงูุญุฒู ุงูุชู ุชุฒูุฏ ุนู 100 ูููู ุซุงููุฉ ููุท ุ ูุงูุญุตูู ุนูู ุฎูุงุฑ ุฃุจุณุท ูุฅุนุงุฏุฉ ุฅูุชุงุฌ ุงููุดููุฉ ูู ุงุฎุชุจุงุฑ ูุณุชูู ุงูุดุจูุฉ ุงููุงูู 7 ูู Vegeta.  ูููุง ููู "ุงูุฃุตูุงุช" ููุถูู Kubernetes ุจุงุณุชุฎุฏุงู TCP SYN / SYN-ACK ุนูู ูุถูู "ุงููููุฐ" ููุฎุฏูุฉ (30927) ูุน ูุงุตู ุฒููู ูุฏุฑู 10 ูููู ุซุงููุฉ ุ ุชุชู ุชุตููุชู ุจูุงุณุทุฉ ุฃุจุทุฃ ุงูุงุณุชุฌุงุจุงุช: <br><br> <code>theojulienne@shell ~ $ sudo hping3 172.16.47.27 -S -p 30927 -i u10000 | egrep --line-buffered 'rtt=[0-9]{3}\.' <br> <br> len=46 ip=172.16.47.27 ttl=59 DF id=0 sport=30927 flags=SA seq=1485 win=29200 rtt=127.1 ms <br> <br> len=46 ip=172.16.47.27 ttl=59 DF id=0 sport=30927 flags=SA seq=1486 win=29200 rtt=117.0 ms <br> <br> len=46 ip=172.16.47.27 ttl=59 DF id=0 sport=30927 flags=SA seq=1487 win=29200 rtt=106.2 ms <br> <br> len=46 ip=172.16.47.27 ttl=59 DF id=0 sport=30927 flags=SA seq=1488 win=29200 rtt=104.1 ms <br> <br> len=46 ip=172.16.47.27 ttl=59 DF id=0 sport=30927 flags=SA seq=5024 win=29200 rtt=109.2 ms <br> <br> len=46 ip=172.16.47.27 ttl=59 DF id=0 sport=30927 flags=SA seq=5231 win=29200 rtt=109.2 ms</code> <br> <br>  ูููู ุฃู ุชุฌุนู ุนูู ุงูููุฑ ุฃูู ููุงุญุธุฉ.  ุชูุถุญ ุงูุฃุฑูุงู ุงูุชุณูุณููุฉ ูุงูุชูููุชุงุช ุฃู ูุฐู ููุณุช ุงุญุชูุงู ููุฑุฉ ูุงุญุฏุฉ.  ุงูุชุฃุฎูุฑ ูุชุฑุงูู ูู ุงูุบุงูุจ ุ ููุชู ูุนุงูุฌุชู ูู ุงูููุงูุฉ. <br><br>  ุจุนุฏ ุฐูู ุ ูุฑูุฏ ุฃู ูุนุฑู ุงูููููุงุช ุงูุชู ูุฏ ุชุดุงุฑู ูู ุธููุฑ ุงูุงุฒุฏุญุงู.  ุฑุจูุง ูุฐู ูู ุจุนุถ ุงููุฆุงุช ูู ููุงุนุฏ iptables ูู NATุ  ุฃู ุจุนุถ ุงููุดุงูู ูุน ููู IPIP ุนูู ุงูุดุจูุฉุ  ุฅุญุฏู ุทุฑู ุงูุชุญูู ูู ุฐูู ูู ุงูุชุญูู ูู ูู ุฎุทูุฉ ูู ุฎุทูุงุช ุงููุธุงู ุนู ุทุฑูู ุงุณุชุจุนุงุฏูุง.  ูุงุฐุง ูุญุฏุซ ุฅุฐุง ููุช ุจุฅุฒุงูุฉ ููุทู NAT ูุฌุฏุงุฑ ุงูุญูุงูุฉ ุ ุชุงุฑูุฉ ุฌุฒุกูุง ููุท ูู IPIP: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5b3/e2a/cff/5b3e2acff2ef9f1f8c7c527356741d92.png"><br><br>  ูุญุณู ุงูุญุธ ุ ูุณูู Linux ุงููุตูู ูุจุงุดุฑุฉ ุฅูู ุทุจูุฉ ุชุฑุงูุจ IP ุฅุฐุง ูุงู ุงูุฌูุงุฒ ุนูู ููุณ ุงูุดุจูุฉ: <br><br> <code>theojulienne@kube-node-client ~ $ sudo hping3 10.125.20.64 -S -i u10000 | egrep --line-buffered 'rtt=[0-9]{3}\.' <br> <br> len=40 ip=10.125.20.64 ttl=64 DF id=0 sport=0 flags=RA seq=7346 win=0 rtt=127.3 ms <br> <br> len=40 ip=10.125.20.64 ttl=64 DF id=0 sport=0 flags=RA seq=7347 win=0 rtt=117.3 ms <br> <br> len=40 ip=10.125.20.64 ttl=64 DF id=0 sport=0 flags=RA seq=7348 win=0 rtt=107.2 ms</code> <br> <br>  ุงุฐุง ุญูููุง ูู ุฎูุงู ุงููุชุงุฆุฌ ุ ูุง ุชุฒุงู ุงููุดููุฉ ูุงุฆูุฉ!  ูุฐุง ูุณุชุจุนุฏ iptables ู NAT.  ูุจุงูุชุงูู ูุฅู ุงููุดููุฉ ูู ูู TCPุ  ุฏุนููุง ูุฑู ููู ูุฐูุจ ุจููุบ ICMP ุงูุนุงุฏูุฉ: <br><br> <code>theojulienne@kube-node-client ~ $ sudo hping3 10.125.20.64 --icmp -i u10000 | egrep --line-buffered 'rtt=[0-9]{3}\.' <br> <br> len=28 ip=10.125.20.64 ttl=64 id=42594 icmp_seq=104 rtt=110.0 ms <br> <br> len=28 ip=10.125.20.64 ttl=64 id=49448 icmp_seq=4022 rtt=141.3 ms <br> <br> len=28 ip=10.125.20.64 ttl=64 id=49449 icmp_seq=4023 rtt=131.3 ms <br> <br> len=28 ip=10.125.20.64 ttl=64 id=49450 icmp_seq=4024 rtt=121.2 ms <br> <br> len=28 ip=10.125.20.64 ttl=64 id=49451 icmp_seq=4025 rtt=111.2 ms <br> <br> len=28 ip=10.125.20.64 ttl=64 id=49452 icmp_seq=4026 rtt=101.1 ms <br> <br> len=28 ip=10.125.20.64 ttl=64 id=50023 icmp_seq=4343 rtt=126.8 ms <br> <br> len=28 ip=10.125.20.64 ttl=64 id=50024 icmp_seq=4344 rtt=116.8 ms <br> <br> len=28 ip=10.125.20.64 ttl=64 id=50025 icmp_seq=4345 rtt=106.8 ms <br> <br> len=28 ip=10.125.20.64 ttl=64 id=59727 icmp_seq=9836 rtt=106.1 ms</code> <br> <br>  ุฃุธูุฑุช ุงููุชุงุฆุฌ ุฃู ุงููุดููุฉ ูู ุชุฎุชู.  ุฑุจูุง ูุฐุง ูู ููู IPIPุ  ุฏุนููุง ุชุจุณูุท ุงูุงุฎุชุจุงุฑ: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/267/ff6/137/267ff613754b99f8cc1bb1d89119206e.png"><br><br>  ูู ูุชู ุฅุฑุณุงู ุฌููุน ุงูุญุฒู ุจูู ูุฐูู ุงููุถููููุ <br><br> <code>theojulienne@kube-node-client ~ $ sudo hping3 172.16.47.27 --icmp -i u10000 | egrep --line-buffered 'rtt=[0-9]{3}\.' <br> <br> len=46 ip=172.16.47.27 ttl=61 id=41127 icmp_seq=12564 rtt=140.9 ms <br> <br> len=46 ip=172.16.47.27 ttl=61 id=41128 icmp_seq=12565 rtt=130.9 ms <br> <br> len=46 ip=172.16.47.27 ttl=61 id=41129 icmp_seq=12566 rtt=120.8 ms <br> <br> len=46 ip=172.16.47.27 ttl=61 id=41130 icmp_seq=12567 rtt=110.8 ms <br> <br> len=46 ip=172.16.47.27 ttl=61 id=41131 icmp_seq=12568 rtt=100.7 ms <br> <br> len=46 ip=172.16.47.27 ttl=61 id=9062 icmp_seq=31443 rtt=134.2 ms <br> <br> len=46 ip=172.16.47.27 ttl=61 id=9063 icmp_seq=31444 rtt=124.2 ms <br> <br> len=46 ip=172.16.47.27 ttl=61 id=9064 icmp_seq=31445 rtt=114.2 ms <br> <br> len=46 ip=172.16.47.27 ttl=61 id=9065 icmp_seq=31446 rtt=104.2 ms</code> <br> <br>  ููุฏ ูููุง ุจุชุจุณูุท ุงููููู ุนูู ูุถูููู ูู Kubernetes ุจุฅุฑุณุงู ุฃู ุญุฒูุฉ ุฅูู ุจุนุถููุง ุงูุจุนุถ ุ ุญุชู ุจูู ุงุฎุชุจุงุฑ ICMP.  ูุง ุฒุงููุง ูุฑูู ุชุฃุฎูุฑูุง ุฅุฐุง ูุงู ุงููุถูู ุงููุฏู "ุณูุฆูุง" (ุงูุจุนุถ ุฃุณูุฃ ูู ุงูุขุฎุฑูู). <br><br>  ุงูุขู ุงูุณุคุงู ุงูุฃุฎูุฑ: ููุงุฐุง ูุญุฏุซ ุงูุชุฃุฎูุฑ ููุท ุนูู ุฎูุงุฏู ุนูุฏุฉ kubeุ  ููู ูุญุฏุซ ุนูุฏูุง ุชููู kube-node ูู ุงููุฑุณู ุฃู ุงููุณุชูุจูุ  ูุญุณู ุงูุญุธ ุ ูู ุงูุณูู ููุบุงูุฉ ูุนุฑูุฉ ุฐูู ุจุฅุฑุณุงู ุญุฒูุฉ ูู ูุถูู ุฎุงุฑุฌ Kubernetes ุ ูููู ูุน ููุณ ุงููุณุชูู "ุงูุณูุฆ ุงููุนุฑูู".  ููุง ุชุฑูู ุ ูู ุชุฎุชู ุงููุดููุฉ: <br><br> <code>theojulienne@shell ~ $ sudo hping3 172.16.47.27 -p 9876 -S -i u10000 | egrep --line-buffered 'rtt=[0-9]{3}\.' <br> <br> len=46 ip=172.16.47.27 ttl=61 DF id=0 sport=9876 flags=RA seq=312 win=0 rtt=108.5 ms <br> <br> len=46 ip=172.16.47.27 ttl=61 DF id=0 sport=9876 flags=RA seq=5903 win=0 rtt=119.4 ms <br> <br> len=46 ip=172.16.47.27 ttl=61 DF id=0 sport=9876 flags=RA seq=6227 win=0 rtt=139.9 ms <br> <br> len=46 ip=172.16.47.27 ttl=61 DF id=0 sport=9876 flags=RA seq=7929 win=0 rtt=131.2 ms</code> <br> <br>  ุจุนุฏ ุฐูู ุ ูููู ุจุชูููุฐ ุงูุทูุจุงุช ููุณูุง ูู ุนูุฏุฉ ุงููุตุฏุฑ ุงูุณุงุจูุฉ ุฅูู ุงููุถูู ุงูุฎุงุฑุฌู (ุงูุฐู ูุณุชุจุนุฏ ุงููุถูู ุงูุฃุตูู ุ ูุธุฑูุง ูุฃู ping ูุดุชูู ุนูู ููููุงุช RX ู TX): <br><br> <code>theojulienne@kube-node-client ~ $ sudo hping3 172.16.33.44 -p 9876 -S -i u10000 | egrep --line-buffered 'rtt=[0-9]{3}\.' <br> ^C <br> --- 172.16.33.44 hping statistic --- <br> 22352 packets transmitted, 22350 packets received, 1% packet loss <br> round-trip min/avg/max = 0.2/7.6/1010.6 ms</code> <br> <br>  ุจุนุฏ ูุญุต ุนูููุงุช ุงูุชูุงุท ุงูุญุฒูุฉ ุงููุคุฌูุฉ ุ ุญุตููุง ุนูู ุจุนุถ ุงููุนูููุงุช ุงูุฅุถุงููุฉ.  ุนูู ูุฌู ุงูุฎุตูุต ุ ุฃู ุงููุฑุณู (ุฃุฏูุงู) ูุฑู ูุฐู ุงููููุฉ ุ ููู ุงููุชููู (ุฃุนูุงู) ูุง ูุฑุงูุง - ุฑุงุฌุน ุนููุฏ ุฏูุชุง (ุจุงูุซูุงูู): <br><br> <a href=""><img src="https://habrastorage.org/webt/4m/-t/dj/4m-tdjzws9lrhnva3xcxijel7eg.png"></a> <br><br>  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุฅุฐุง ูุธุฑุช ุฅูู ุงููุฑู ูู ุชุฑุชูุจ ุญุฒู TCP ู ICMP (ุญุณุจ ุฃุฑูุงู ุงูุชุณูุณู) ุนูู ุฌุงูุจ ุงููุณุชูู ุ ูุฅู ุญุฒู ICMP ุชุตู ุฏุงุฆููุง ุจููุณ ุงูุชุณูุณู ุงูุฐู ุชู ุฅุฑุณุงููุง ุจู ุ ููู ูุน ุชูููุช ูุฎุชูู.  ูู ุงูููุช ููุณู ุ ุชุชุจุฏู ุญุฒู TCP ุฃุญูุงููุง ุ ููุชุนุทู ุจุนุถูุง.  ุนูู ูุฌู ุงูุฎุตูุต ุ ุฅุฐุง ูุญุตูุง ููุงูุฐ ุญุฒู SYN ุ ูุนูุฏุฆุฐู ูู ุฌุงูุจ ุงููุฑุณู ูุฐูุจูู ุจุงูุชุฑุชูุจ ุ ููู ูู ุฌุงูุจ ุงููุณุชูู ูุง ููุนููู ุฐูู. <br><br>  ููุงู ุงุฎุชูุงู ุจุณูุท ูู ููููุฉ ูุนุงูุฌุฉ <a href="https://en.wikipedia.org/wiki/Network_address_translation">ุจุทุงูุงุช ุงูุดุจูุฉ</a> ููุฎูุงุฏู ุงูุญุฏูุซุฉ (ููุง ูู ูุฑูุฒ ุงูุจูุงูุงุช ุงูุฎุงุต ุจูุง) ุงูุญุฒู ุงูุชู ุชุญุชูู ุนูู TCP ุฃู ICMP.  ุนูุฏูุง ุชุตู ุงูุญุฒูุฉ ุ ูููู ูุญูู ุงูุดุจูุฉ "ุจุชุฌุฒุฆุฉูุง ุนุจุฑ ุงูุงุชุตุงู" ุ ุฃู ุฃูู ูุญุงูู ูุทุน ุงูุงุชุตุงูุงุช ุจุงูุชูุงูุจ ูุฅุฑุณุงู ูู ูุงุฆูุฉ ุงูุชุธุงุฑ ุฅูู ูุนุงูุฌ ูุนุงูุฌ ูููุตู.  ุจุงููุณุจุฉ ุฅูู TCP ุ ุชุชุถูู ูุฐู ุงูุชุฌุฒุฆุฉ ูู ูู ุนููุงู IP ูููุตุฏุฑ ูุงููุฌูุฉ ูุงููููุฐ.  ุจูุนูู ุขุฎุฑ ุ ูุชู ุชุฌุฒุฆุฉ ูู ุงุชุตุงู (ูุญุชูู) ุจุดูู ูุฎุชูู.  ุจุงููุณุจุฉ ูู ICMP ุ ูุชู ุชุฌุฒุฆุฉ ุนูุงููู IP ููุท ุ ูุธุฑูุง ูุนุฏู ูุฌูุฏ ููุงูุฐ. <br><br>  ููุงุญุธุฉ ุฌุฏูุฏุฉ ุฃุฎุฑู: ุฎูุงู ูุฐู ุงููุชุฑุฉ ูุฑู ุชุฃุฎูุฑ ICMP ุนูู ุฌููุน ุงูุงุชุตุงูุงุช ุจูู ุงููุถูููู ุ ูููู TCP ูุง.  ูุฐุง ูุฎุจุฑูุง ุฃู ุงูุณุจุจ ุฑุจูุง ูุฑุฌุน ุฅูู ุชุฌุฒุฆุฉ ููุงุฆู ุงูุงูุชุธุงุฑ RX: ูู ุดุจู ุงููุคูุฏ ุฃู ุงูุงุญุชูุงู ูุญุฏุซ ูู ูุนุงูุฌุฉ ุญุฒู RX ุ ุจุฏูุงู ูู ุฅุฑุณุงู ุงูุฑุฏูุฏ. <br><br>  ูุณุชุซูู ูุฐุง ุฅุฑุณุงู ุงูุญุฒู ูู ูุงุฆูุฉ ุงูุฃุณุจุงุจ ุงููุญุชููุฉ.  ูุนูู ุงูุขู ุฃู ูุดููุฉ ูุนุงูุฌุฉ ุงูุญุฒู ูู ูู ุฌุงูุจ ุงููุชููู ุนูู ุจุนุถ ุฎูุงุฏู ุงูุนูุฏุฉ kube. <br><br><h1 style=";text-align:right;direction:rtl">  ููู ูุนุงูุฌุฉ ุงูุญุฒูุฉ ูู Linux Kernel </h1><br>  ูููู ุณุจุจ ุญุฏูุซ ุงููุดููุฉ ูุน ุงููุณุชูู ุนูู ุจุนุถ ุฎูุงุฏู kube-node ุ ุฏุนููุง ูุฑู ููู ุชุนุงูุฌ kernel Linux ุงูุญุฒู. <br><br>  ุจุงูุฑุฌูุน ุฅูู ุฃุจุณุท ุงูุชูููุฐ ุงูุชูููุฏู ุ ุชุชููู ุจุทุงูุฉ ุงูุดุจูุฉ ุงูุญุฒูุฉ ูุชุฑุณู <a href="https://en.wikipedia.org/wiki/Interrupt">ููุงุทุนุฉ</a> ุฅูู kernel Linux ุ ููู ุงูุญุฒูุฉ ุงูุชู ุชุญุชุงุฌ ุฅูู ูุนุงูุฌุฉ.  ุชููู kernel ุนูููุฉ ุฃุฎุฑู ุ ูุชููู ุจุชุจุฏูู ุงูุณูุงู ุฅูู ูุนุงูุฌ ุงูููุงุทุนุฉ ุ ููุนุงูุฌุฉ ุงูุญุฒูุฉ ุ ุซู ุงูุนูุฏุฉ ุฅูู ุงูููุงู ุงูุญุงููุฉ. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1a2/3c3/4ee/1a23c34eea2236294913fd09a25aa1e4.png"><br><br>  ุฑูุฒ ุชุจุฏูู ุงูุณูุงู ูุฐุง ุจุทูุก: ูุฏ ูุง ูููู ุฒูู ุงููุตูู ููุญูุธูุง ุนูู ุจุทุงูุงุช ุงูุดุจูุฉ ุฐุงุช 10 ููุฌุงุจุงูุช ูู ุงูุชุณุนููุงุช ุ ูููู ุนูู ุจุทุงูุงุช 10G ุงูุญุฏูุซุฉ ุจุณุฑุนุงุช ูุตูู ุชุตู ุฅูู 15 ููููู ุญุฒูุฉ ูู ุงูุซุงููุฉ ุ ูููู ููุงุทุนุฉ ูู ููุงุฉ ุฎุงุฏู ุตุบูุฑ ุฐู ุซูุงููุฉ ูุฑุงูุฒ ุจููุงููู ุงููุฑุงุช ูู ุงูุซุงููุฉ. <br><br>  ูู ุฃุฌู ุนุฏู ุงูุชุนุงูู ูุน ุงูููุงุทุนุฉ ุจุดูู ูุณุชูุฑ ุ ุฃุถุงู Linux ููุฐ ุนุฏุฉ ุณููุงุช <a href="https://en.wikipedia.org/wiki/New_API">NAPI</a> : ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ููุดุจูุฉ ุชุณุชุฎุฏููุง ุฌููุน ุจุฑุงูุฌ ุงูุชุดุบูู ุงูุญุฏูุซุฉ ูุฒูุงุฏุฉ ุงูุฃุฏุงุก ุจุณุฑุนุงุช ุนุงููุฉ.  ุนูุฏ ุงูุณุฑุนุงุช ุงูููุฎูุถุฉ ุ ูุง ูุฒุงู kernel ููุจู ุงูููุงุทุนุงุช ูู ุจุทุงูุฉ ุงูุดุจูุฉ ุจุงูุทุฑููุฉ ุงููุฏููุฉ.  ุจูุฌุฑุฏ ูุตูู ุนุฏุฏ ูุงูู ูู ุงูุญุฒู ูุชุฌุงูุฒ ุงูุนุชุจุฉ ุ ูููู kernel ุจุชุนุทูู ุงูููุงุทุนุงุช ูุจุฏูุงู ูู ุฐูู ูุจุฏุฃ ุงุณุชุทูุงุน ููุญูู ุงูุดุจูุฉ ูุฃุฎุฐ ุงูุญุฒู ุนูู ุฏูุนุงุช.  ุชุชู ุงููุนุงูุฌุฉ ูู softirq ุ ุฃู ูู <a href="https://www.kernel.org/doc/htmldocs/kernel-hacking/basics-softirqs.html">ุณูุงู</a> ููุงุทุนุงุช <a href="https://www.kernel.org/doc/htmldocs/kernel-hacking/basics-softirqs.html">ุงูุจุฑุงูุฌ</a> ุจุนุฏ ููุงููุงุช ุงููุธุงู ูููุงุทุน ุงูุฃุฌูุฒุฉ ุนูุฏูุง ุชููู ุงูููุงุฉ (ุนูู ุนูุณ ูุณุงุญุฉ ุงููุณุชุฎุฏู) ููุฏ ุงูุชุดุบูู ุจุงููุนู. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/22a/50d/ee1/22a50dee1fffdbc20614db2b1db28fc4.png"><br><br>  ูุฐุง ุฃุณุฑุน ุจูุซูุฑ ุ ูููู ูุณุจุจ ูุดููุฉ ูุฎุชููุฉ.  ุฅุฐุง ูุงู ููุงู ุงููุซูุฑ ูู ุงูุญุฒู ุ ููู ุงูููุช ุงูุฐู ุชุณุชุบุฑูู ูุนุงูุฌุฉ ุงูุญุฒู ูู ุจุทุงูุฉ ุงูุดุจูุฉ ุ ููุง ุชููู ุนูููุงุช ูุณุงุญุฉ ุงููุณุชุฎุฏู ุงูููุช ูุฅูุฑุงุบ ููุงุฆู ุงูุงูุชุธุงุฑ ูุฐู ูุนูููุง (ุงููุฑุงุกุฉ ูู ุงุชุตุงูุงุช TCP ุ ุฅูุฎ).  ูู ุงูููุงูุฉ ุ ุชููุฃ ุงูุทูุงุจูุฑ ููุจุฏุฃ ูู ุฅุณูุงุท ุงูุญุฒู.  ูู ูุญุงููุฉ ููุนุซูุฑ ุนูู ุฑุตูุฏ ุ ูุญุฏุฏ kernel ููุฒุงููุฉ ูุฃูุตู ุนุฏุฏ ูู ุงูุญุฒู ุงูุชู ุชุชู ูุนุงูุฌุชูุง ูู ุณูุงู softirq.  ุจูุฌุฑุฏ ุชุฌุงูุฒ ูุฐู ุงูููุฒุงููุฉ ุ <code>ksoftirqd</code> ูุคุดุฑ ุชุฑุงุจุท <code>ksoftirqd</code> ูููุตู (ุณุชุฑู ูุงุญุฏูุง ูููุง ูู <code>ps</code> ููู ููุงุฉ) ุ ูุงูุฐู ูุนุงูุฌ ูุฐู softirqs ุฎุงุฑุฌ ูุณุงุฑ syscall / interrupt ุงูุนุงุฏู.  ูุชู ุชุฎุทูุท ูุคุดุฑ ุงูุชุฑุงุจุท ูุฐุง ุจุงุณุชุฎุฏุงู ุฌุฏููุฉ ุนูููุฉ ููุงุณูุฉ ุชุญุงูู ุชูุฒูุน ุงูููุงุฑุฏ ุจุดูู ุนุงุฏู. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d0f/1e6/f0c/d0f1e6f0c54d45c24d62cb2bcf90c674.png"><br><br>  ุจุนุฏ ูุญุต ููููุฉ ูุนุงูุฌุฉ ุงูููุงุฉ ููุญุฒู ุ ููููู ุฃู ุชุฑู ุฃู ููุงู ุงุญุชูุงููุง ูุนูููุง ููุงุฒุฏุญุงู.  ุฅุฐุง ุชู ุชููู ููุงููุงุช softirq ุจุดูู ูุชูุฑุฑ ุฃูู ุ ูุณุชุถุทุฑ ุงูุญุฒู ุฅูู ุงูุงูุชุธุงุฑ ุจุนุถ ุงูููุช ูููุนุงูุฌุฉ ูู ูุงุฆูุฉ ุงูุชุธุงุฑ RX ุนูู ุจุทุงูุฉ ุงูุดุจูุฉ.  ุฑุจูุง ูููู ูุฐุง ุจุณุจุจ ุจุนุถ ุงูููุงู ุงูุชู ุชููุน ููุงุฉ ุงููุนุงูุฌ ุ ุฃู ุฃู ุดูุก ุขุฎุฑ ูููุน ุงูููุงุฉ ูู ุจุฏุก ุชุดุบูู softirq. <br><br><h1 style=";text-align:right;direction:rtl">  ูููู ุจุชุถููู ูุทุงู ุงููุนุงูุฌุฉ ุฅูู ุงูููุงุฉ ุฃู ุงูุทุฑููุฉ </h1><br>  ุงูุชุฃุฎูุฑ Softirq ูู ูุฌุฑุฏ ุงูุชุฑุงุถ.  ููู ูุฐุง ููุทูู ุ ููุนูู ุฃููุง ูุฑู ุดูุฆูุง ูุดุงุจููุง ููุบุงูุฉ.  ูุฐูู ุ ูุฅู ุงูุฎุทูุฉ ุงูุชุงููุฉ ูู ุชุฃููุฏ ูุฐู ุงููุธุฑูุฉ.  ูุฅุฐุง ุชู ุชุฃููุฏ ุฐูู ุ ูุงุจุญุซ ุนู ุณุจุจ ุงูุชุฃุฎูุฑ. <br><br>  ุงูุนูุฏุฉ ุฅูู ุงูุญุฒู ุงูุจุทูุฆุฉ ูุฏููุง: <br><br> <code>len=46 ip=172.16.53.32 ttl=61 id=29573 icmp_seq=1953 rtt=99.3 ms <br> <br> len=46 ip=172.16.53.32 ttl=61 id=29574 icmp_seq=1954 rtt=89.3 ms <br> <br> len=46 ip=172.16.53.32 ttl=61 id=29575 icmp_seq=1955 rtt=79.2 ms <br> <br> len=46 ip=172.16.53.32 ttl=61 id=29576 icmp_seq=1956 rtt=69.1 ms <br> <br> len=46 ip=172.16.53.32 ttl=61 id=29577 icmp_seq=1957 rtt=59.1 ms <br> <br> len=46 ip=172.16.53.32 ttl=61 id=29790 icmp_seq=2070 rtt=75.7 ms <br> <br> len=46 ip=172.16.53.32 ttl=61 id=29791 icmp_seq=2071 rtt=65.6 ms <br> <br> len=46 ip=172.16.53.32 ttl=61 id=29792 icmp_seq=2072 rtt=55.5 ms</code> <br> <br>  ููุง ุชูุช ููุงูุดุชู ุณุงุจููุง ุ ูุชู ุชุฌุฒุฆุฉ ุญุฒู ICMP ูุฐู ุฅูู ูุงุฆูุฉ ุงูุชุธุงุฑ NIC RX ูุงุญุฏุฉ ููุนุงูุฌุชูุง ุจูุงุณุทุฉ ูุญุฏุฉ ูุนุงูุฌุฉ ูุฑูุฒูุฉ ูุงุญุฏุฉ.  ุฅุฐุง ููุง ูุฑูุฏ ุฃู ูููู ููู ูุนูู Linux ุ ููู ุงููููุฏ ุฃู ูุนุฑู ุฃูู (ุนูู ุฃู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุงูุฃุณุงุณูุฉ) ูููู (softirq ุ ksoftirqd) ุชุชู ูุนุงูุฌุฉ ูุฐู ุงูุญุฒู ูุชุชุจุน ุงูุนูููุฉ. <br><br>  ุญุงู ุงูููุช ุงูุขู ูุงุณุชุฎุฏุงู ุงูุฃุฏูุงุช ุงูุชู ุชุณูุญ ุจูุฑุงูุจุฉ ููุงุฉ Linux ูู ุงูููุช ุงููุนูู.  ููุง ุงุณุชุฎุฏููุง <a href="https://github.com/iovisor/bcc">ูุฎููุฉ</a> .  ุชุชูุญ ูู ูุฌููุนุฉ ุงูุฃุฏูุงุช ูุฐู ูุชุงุจุฉ ุจุฑุงูุฌ C ุงูุตุบูุฑุฉ ุงูุชู ุชุนุชุฑุถ ุงููุธุงุฆู ุงูุชุนุณููุฉ ูู ุฃุญุฏุงุซ kernel ู buffer ูู ุจุฑูุงูุฌ Python ุงูุฎุงุต ุจูุณุงุญุฉ ุงููุณุชุฎุฏู ูุงูุฐู ููููู ูุนุงูุฌุชูุง ูุฅุฑุฌุงุน ุงููุชูุฌุฉ.  ุงูุฎุทุงูุงุช ูููุธุงุฆู ุงูุชุนุณููุฉ ูู kernel ูุนูุฏุฉ ุ ูููู ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ ูุตููุฉ ูุชูููุฑ ุฃูุตู ุฏุฑุฌุงุช ุงูุฃูุงู ูุชู ุชุตููููุง ูุชุชุจุน ูุดููุงุช ุงูุฅูุชุงุฌ ุจุฏูุฉ ูุงูุชู ููุณ ูู ุงูุณูู ุฅุนุงุฏุฉ ุฅูุชุงุฌูุง ูู ุจูุฆุฉ ุงุฎุชุจุงุฑ ุฃู ุชุทููุฑ. <br><br>  ุงูุฎุทุฉ ููุง ุจุณูุทุฉ: ูุญู ูุนูู ุฃู kernel ูุนุงูุฌ ูุฐู ุงูุฃุตูุงุช ูู ICMP ุ ูุฐูู ูุถุน <a href="">ุฑุจุทูุง ุนูู ูุธููุฉ icmp_echo</a> kernel ุ ุงูุชู ุชุณุชูุจู ุญุฒูุฉ ICMP ุงููุงุฑุฏุฉ "ุทูุจ ุงูุงุฑุชุฏุงุฏ" ูุชุจุฏุฃ ุฅุฑุณุงู ุงุณุชุฌุงุจุฉ ICMP "ุงุณุชุฌุงุจุฉ ุงูุงุฑุชุฏุงุฏ".  ูููููุง ุชุญุฏูุฏ ุงูุญุฒูุฉ ุนู ุทุฑูู ุฒูุงุฏุฉ ุฑูู icmp_seq ุ ูุงูุฐู ูุธูุฑ <code>hping3</code> ุฃุนูุงู. <br><br>  ูุจุฏู ุฑูุฒ <a href="https://gist.github.com/theojulienne/9d78a0cb68dbe56f19a2ae6316bc6846">ุงูุจุฑูุงูุฌ ุงููุตู bcc</a> ูุนูุฏูุง ุ ูููู ููุณ ูุฎูููุง ููุง ูุจุฏู.  ุชููู ุฏุงูุฉ <code>icmp_echo</code> ุจุชูุฑูุฑ <code>struct sk_buff *skb</code> : ูุฐู ูู ุงูุญุฒูุฉ ูุน ุทูุจ "ุทูุจ ุงูุงุฑุชุฏุงุฏ".  ูููููุง ุชุชุจุน ุฐูู ุ ูุณุญุจ ุชุณูุณู <code>echo.sequence</code> (ุงูุฐู ูุนูู <code>icmp_seq</code> ูู hping3 <code></code> ) ุ ูุฅุฑุณุงูู ุฅูู ูุณุงุญุฉ ุงููุณุชุฎุฏู.  ููุง ุฃูู ููุงุณุจ ูุงูุชูุงุท ุงุณู / ูุนุฑู ุงูุนูููุฉ ุงูุญุงูู.  ูููุง ููู ุงููุชุงุฆุฌ ุงูุชู ูุฑุงูุง ูุจุงุดุฑุฉู ุฃุซูุงุก ูุนุงูุฌุฉ ุงูุญุฒู ุจูุงุณุทุฉ kernel: <br><br><pre style=";text-align:right;direction:rtl">  TGID PID PROCESS NAME ICMP_SEQ
 0 0 swapper / 11ุ770
 0 0 swapper / 11ุ771
 0 0 swapper / 11 772
 0 0 swapper / 11 773
 0 0 swapper / 11ุ774
 20041 20086 prometheus 775
 0 0 swapper / 11ุ776
 0 0 swapper / 11ุ777
 0 0 swapper / 11 778
 4512 4542 speaker-report-s 779 </pre><br>  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ููุง ุฅูู ุฃูู ูู ุณูุงู <code>softirq</code> ุงูุนูููุงุช ุงูุชู ุฃุฌุฑุช ููุงููุงุช ุงููุธุงู ูู "ุนูููุงุช" ุ ุนูู ุงูุฑุบู ูู ุฃู ูุฐุง ุงูููุงุฉ ูู ุงูุญูููุฉ ูุนุงูุฌ ุงูุญุฒู ุจุฃูุงู ูู ุณูุงู ุงูููุงุฉ. <br><br>  ุจุงุณุชุฎุฏุงู ูุฐู ุงูุฃุฏุงุฉ ุ ูููููุง ุชุฃุณูุณ ุงุชุตุงู ุนูููุงุช ูุญุฏุฏุฉ ูุน ุญุฒู ูุญุฏุฏุฉ ุชุธูุฑ ุชุฃุฎูุฑูุง ูู <code>hping3</code> .  ูุตูุน <code>grep</code> ุจุณูุทูุง ูู ูุฐุง ุงูุงูุชูุงุท ูููู <code>icmp_seq</code> ูุญุฏุฏุฉ.  ุชู ูุถุน ุนูุงูุฉ ุนูู ุงูุญุฒู ุงูููุงุจูุฉ ูููู icmp_seq ุฃุนูุงู ุจุนูุงูุฉ RTT ุงูุฎุงุตุฉ ุจูุง ุ ูุงูุชู ูุงุญุธูุงูุง ุฃุนูุงู (ุจูู ููุณูู ูู ููู RTT ุงููุชููุนุฉ ููุญุฒู ุงูุชู ูููุง ุจุชุตููุชูุง ุจุณุจุจ ููู RTT ุงูุชู ุชูู ุนู 50 ูููู ุซุงููุฉ): <br><br><pre style=";text-align:right;direction:rtl">  TGID PID PROCESS NAME ICMP_SEQ ** RTT
 -
 10137 10436 cadvisor 1951
 10137 10436 cadvisor 1952
 76 76 ksoftirqd / 11 1953 ** 99ms
 76 76 ksoftirqd / 11 1954 ** 89ms
 76 76 ksoftirqd / 11 1955 ** 79ms
 76 76 ksoftirqd / 11 1956 ** 69ms
 76 76 ksoftirqd / 11 1957 ** 59ms
 76 76 ksoftirqd / 11 1958 ** (49ms)
 76 76 ksoftirqd / 11 1959 ** (39ms)
 76 76 ksoftirqd / 11 1960 ** (29ms)
 76 76 ksoftirqd / 11 1961 ** (19ms)
 76 76 ksoftirqd / 11 1962 ** (9ms)
 -
 10137 10436 cadvisor 2068
 10137 10436 cadvisor 2069
 76 76 ksoftirqd / 11 2070 ** 75ms
 76 76 ksoftirqd / 11 2071 ** 65ms
 76 76 ksoftirqd / 11 2072 ** 55ms
 76 76 ksoftirqd / 11 2073 ** (45ms)
 76 76 ksoftirqd / 11 2074 ** (35ms)
 76 76 ksoftirqd / 11 2075 ** (25ms)
 76 76 ksoftirqd / 11 2076 ** (15ms)
 76 76 ksoftirqd / 11 2077 ** (5ms) </pre><br>  ุงููุชุงุฆุฌ ุชุฎุจุฑูุง ุจุนุถ ุงูุฃุดูุงุก.  ุฃููุงู ุ ูุนุงูุฌ ุณูุงู <code>ksoftirqd/11</code> ูู ูุฐู ุงูุญุฒู.  ูุฐุง ูุนูู ุฃูู ุจุงููุณุจุฉ ููุฐุง ุงูุฒูุฌ ุงููุนูู ูู ุงูุขูุงุช ุ ุชู ุชุฌุฒุฆุฉ ุญุฒู ICMP ุนูู ุงูููุงุฉ 11 ูู ุงูุทุฑู ุงููุชููู.  ูุฑู ุฃูุถูุง ุฃูู ูู ูู ุงุฒุฏุญุงู ูุฑูุฑู ุ ุชูุฌุฏ ุญุฒู ูุชู ูุนุงูุฌุชูุง ูู ุณูุงู ุงุณุชุฏุนุงุก ูุธุงู <code>cadvisor</code> .  ุซู ุชุฃุฎุฐ <code>ksoftirqd</code> ุงููููุฉ ูุชูุจู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุงููุชุฑุงููุฉ: ุจุงูุถุจุท ุนุฏุฏ ุงูุญุฒู ุงูุชู ุชุฑุงููุช ุจุนุฏ <code>cadvisor</code> . <br><br>  ุญูููุฉ ุฃู <code>cadvisor</code> ูุนูู ุฏุงุฆูุง ูุจู ูุฐุง ูุจุงุดุฑุฉ ูุนูู ุชูุฑุทู ูู ุงููุดููุฉ.  ููู ุงูููุงุฑูุงุช ุฃู ุงูุบุฑุถ ูู <a href="https://github.com/google/cadvisor">cadvisor</a> ูู "ุชุญููู ุงุณุชุฎุฏุงู ุงูููุงุฑุฏ ูุฎุตุงุฆุต ุฃุฏุงุก ุญุงููุงุช ุงูุชุดุบูู" ุ ุจุฏูุงู ูู ุงูุชุณุจุจ ูู ูุดููุฉ ุงูุฃุฏุงุก ูุฐู. <br><br>  ููุง ูู ุงูุญุงู ูุน ุงูุฌูุงูุจ ุงูุฃุฎุฑู ูููุงููุฉ ุงูุญุงููุงุช ุ ููุฐู ูููุง ุฃุฏูุงุช ูุชุทูุฑุฉ ููุบุงูุฉ ูููู ูู ุฎูุงููุง ุชููุน ุญุฏูุซ ูุดููุงุช ูู ุงูุฃุฏุงุก ูู ุจุนุถ ุงูุธุฑูู ุบูุฑ ุงููุชููุนุฉ. <br><br><h1 style=";text-align:right;direction:rtl">  ูุงุฐุง ููุนู cadvisor ุฃู ูุจุทุฆ ูุงุฆูุฉ ุงูุชุธุงุฑ ุงูุญุฒูุฉุ </h1><br>  ุงูุขู ูุฏููุง ููู ุฌูุฏ ูููููุฉ ุญุฏูุซ ุงููุดู ุ ูุฃู ุนูููุฉ ุชุชุณุจุจ ููู ุ ูุนูู ุฃู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ.  ุฅููุง ูุฑู ุฃูู ูุธุฑูุง ููุญุธุฑ ุงูุตุนุจ ุ ูุง ููุฌุฏ ูุฏู Linux kernel ุงูููุช ูุฌุฏููุฉ <code>ksoftirqd</code> .  ููุญู ูุฑู ุฃู ุงูุญุฒู ุชุชู ูุนุงูุฌุชูุง ูู ุณูุงู <code>cadvisor</code> .  ูู ุงูููุทูู ุงูุชุฑุงุถ ุฃู <code>cadvisor</code> ูุจุฏุฃ <code>cadvisor</code> ุจุทูุฆูุง ุ ูุจุนุฏ ุฐูู ุชุชู ูุนุงูุฌุฉ ุฌููุน ุงูุญุฒู ุงููุชุฑุงููุฉ ูู ูุฐุง ุงูููุช: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6fd/6fb/970/6fd6fb970f2d27943039910db9b41743.png"><br><br>  ูุฐู ูู ุงููุธุฑูุฉ ุ ูููู ููู ูุงุฎุชุจุงุฑูุงุ  ูุง ูููููุง ุงูููุงู ุจู ูู ุชุชุจุน ุชุดุบูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุงูุฃุณุงุณูุฉ ุฎูุงู ูุฐู ุงูุนูููุฉ ุ ูุงูุนุซูุฑ ุนูู ุงูููุทุฉ ุงูุชู ูุชู ูููุง ุชุฌุงูุฒ ุงูููุฒุงููุฉ ูู ุฎูุงู ุนุฏุฏ ุงูุญุฒู ููุณูู ksoftirqd ุ ุซู ุชุจุฏู ูุจู ุฐูู ุจูููู - ูุง ุงูุฐู ุชู ุนููู ุจุงูุถุจุท ุนูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุงูุฃุณุงุณูุฉ ูุจู ุชูู ุงููุญุธุฉ ุจุงูุถุจุท.  ูุดุจู ุงูุฃุดุนุฉ ุงูุณูููุฉ ููุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ูู ุจุถุนุฉ ูููู ุซุงููุฉ.  ุณูุจุฏู ุดูุก ูุซู ูุฐุง: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/44a/954/6e8/44a9546e8de19e43cb125eb8a03a8f47.png"><br><br>  ูุฑูุญ ุ ูู ูุฐุง ูููู ุงูููุงู ุจู ูุน ุงูุฃุฏูุงุช ุงูููุฌูุฏุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ูุชุญูู <a href="https://perf.wiki.kernel.org/index.php/Tutorial">ุณุฌู ุงูุฃุฏุงุก</a> ูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุงููุญุฏุฏุฉ ุจุงูุชุฑุฏุฏ ุงููุดุงุฑ ุฅููู ูููููู ุฅูุดุงุก ุฌุฏูู ููููุงููุงุช ุฅูู ูุธุงู ูุนูู ุ ุจูุง ูู ุฐูู ูุณุงุญุฉ ุงููุณุชุฎุฏู ูููุงุฉ Linux.  ููููู ุฃุฎุฐ ูุฐุง ุงูุณุฌู ููุนุงูุฌุชู ุจุงุณุชุฎุฏุงู ุดููุฉ ุตุบูุฑุฉ ูู ุจุฑูุงูุฌ <a href="https://github.com/brendangregg/FlameGraph">FlameGraph</a> ูู Brendan Gregg ุ ูุงูุฐู ูุญุงูุธ ุนูู ุชุฑุชูุจ ุชุชุจุน ุงูููุฏุณ.  ูููููุง ุญูุธ ุขุซุงุฑ ููุฏุณ ุณุทุฑ ูุงุญุฏ ูู 1 ูููู ุซุงููุฉ ุ ุซู ุชุญุฏูุฏ ูุญูุธ ุงูุนููุฉ ููุฏุฉ 100 ูููู ุซุงููุฉ ูุจู ุฃู ุชุญุตู <code>ksoftirqd</code> ุนูู ุงูุชุชุจุน: <br><br> <code># record 999 times a second, or every 1ms with some offset so not to align exactly with timers <br> sudo perf record -C 11 -g -F 999 <br> # take that recording and make a simpler stack trace. <br> sudo perf script 2&gt;/dev/null | ./FlameGraph/stackcollapse-perf-ordered.pl | grep ksoftir -B 100</code> <br> <br>  ูููุง ุงููุชุงุฆุฌ: <br><br> <code>( ,   ) <br> <br> cadvisor;[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];entry_SYSCALL_64_after_swapgs;do_syscall_64;sys_read;vfs_read;seq_read;memcg_stat_show;mem_cgroup_nr_lru_pages;mem_cgroup_node_nr_lru_pages cadvisor;[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];entry_SYSCALL_64_after_swapgs;do_syscall_64;sys_read;vfs_read;seq_read;memcg_stat_show;mem_cgroup_nr_lru_pages;mem_cgroup_node_nr_lru_pages cadvisor;[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];entry_SYSCALL_64_after_swapgs;do_syscall_64;sys_read;vfs_read;seq_read;memcg_stat_show;mem_cgroup_iter cadvisor;[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];entry_SYSCALL_64_after_swapgs;do_syscall_64;sys_read;vfs_read;seq_read;memcg_stat_show;mem_cgroup_nr_lru_pages;mem_cgroup_node_nr_lru_pages cadvisor;[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];entry_SYSCALL_64_after_swapgs;do_syscall_64;sys_read;vfs_read;seq_read;memcg_stat_show;mem_cgroup_nr_lru_pages;mem_cgroup_node_nr_lru_pages ksoftirqd/11;ret_from_fork;kthread;kthread;smpboot_thread_fn;smpboot_thread_fn;run_ksoftirqd;__do_softirq;net_rx_action;ixgbe_poll;ixgbe_clean_rx_irq;napi_gro_receive;netif_receive_skb_internal;inet_gro_receive;bond_handle_frame;__netif_receive_skb_core;ip_rcv_finish;ip_rcv;ip_forward_finish;ip_forward;ip_finish_output;nf_iterate;ip_output;ip_finish_output2;__dev_queue_xmit;dev_hard_start_xmit;ipip_tunnel_xmit;ip_tunnel_xmit;iptunnel_xmit;ip_local_out;dst_output;__ip_local_out;nf_hook_slow;nf_iterate;nf_conntrack_in;generic_packet;ipt_do_table;set_match_v4;ip_set_test;hash_net4_kadt;ixgbe_xmit_frame_ring;swiotlb_dma_mapping_error;hash_net4_test ksoftirqd/11;ret_from_fork;kthread;kthread;smpboot_thread_fn;smpboot_thread_fn;run_ksoftirqd;__do_softirq;net_rx_action;gro_cell_poll;napi_gro_receive;netif_receive_skb_internal;inet_gro_receive;__netif_receive_skb_core;ip_rcv_finish;ip_rcv;ip_forward_finish;ip_forward;ip_finish_output;nf_iterate;ip_output;ip_finish_output2;__dev_queue_xmit;dev_hard_start_xmit;dev_queue_xmit_nit;packet_rcv;tpacket_rcv;sch_direct_xmit;validate_xmit_skb_list;validate_xmit_skb;netif_skb_features;ixgbe_xmit_frame_ring;swiotlb_dma_mapping_error;__dev_queue_xmit;dev_hard_start_xmit;__bpf_prog_run;__bpf_prog_run</code> <br> <br>  ููุงู ุงููุซูุฑ ูู ุงูุฃุดูุงุก ููุง ุ ูููู ุงูุดูุก ุงูุฑุฆูุณู ูู ุฃููุง ูุฌุฏ ูุงูุจ "cadvisor ูุจู ksoftirqd" ุงูุฐู ุฑุฃููุงู ุณุงุจููุง ูู ุชุชุจุน ICMP.  ูุงุฐุง ูุนูู ูุฐุงุ <br><br>  ูู ุณุทุฑ ูู ุชุชุจุน ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ูู ููุช ูุนูู ูู ุงูุฒูู.  ูุชู ูุตู ูู ุงุณุชุฏุนุงุก ูุฃุณูู ุงูููุฏุณ ูู ุฎุท ุจูุงุตูุฉ ููููุทุฉ.  ูู ููุชุตู ุงูุณุทูุฑ ุ ูุฑู syscall ูุณูู: <code>read(): .... ;do_syscall_64;sys_read; ...</code>  <code>read(): .... ;do_syscall_64;sys_read; ...</code> .  ูุจุงูุชุงูู ุ ููุถู cadvisor ุงููุซูุฑ ูู ุงูููุช ุนูู ููุงููุฉ ูุธุงู <code>read()</code> ุ ุงููุชุนููุฉ <code>mem_cgroup_*</code> (ุฃุนูู ููุฏุณ ุงูููุงููุฉ / ููุงูุฉ ุงูุณุทุฑ). <br><br>  ูู ุชุชุจุน ุงูููุงููุงุช ุ ูู ุบูุฑ <code>strace</code> ูุนุฑูุฉ ูุง ุชุชู ูุฑุงุกุชู ุจุงูุถุจุท ุ ูุฐุง ูู ุจุชุดุบููู <code>strace</code> ูุง ููุนูู cadvisor ุ ูุงุจุญุซ ุนู ููุงููุงุช ุงููุธุงู ุงูุชู ุชุฒูุฏ ุนู 100 ูููู ุซุงููุฉ: <br><br> <code>theojulienne@kube-node-bad ~ $ sudo strace -p 10137 -T -ff 2&gt;&amp;1 | egrep '&lt;0\.[1-9]' <br> [pid 10436] &lt;... futex resumed&gt; ) = 0 &lt;0.156784&gt; <br> [pid 10432] &lt;... futex resumed&gt; ) = 0 &lt;0.258285&gt; <br> [pid 10137] &lt;... futex resumed&gt; ) = 0 &lt;0.678382&gt; <br> [pid 10384] &lt;... futex resumed&gt; ) = 0 &lt;0.762328&gt; <br> [pid 10436] &lt;... read resumed&gt; "cache 154234880\nrss 507904\nrss_h"..., 4096) = 658 &lt;0.179438&gt; <br> [pid 10384] &lt;... futex resumed&gt; ) = 0 &lt;0.104614&gt; <br> [pid 10436] &lt;... futex resumed&gt; ) = 0 &lt;0.175936&gt; <br> [pid 10436] &lt;... read resumed&gt; "cache 0\nrss 0\nrss_huge 0\nmapped_"..., 4096) = 577 &lt;0.228091&gt; <br> [pid 10427] &lt;... read resumed&gt; "cache 0\nrss 0\nrss_huge 0\nmapped_"..., 4096) = 577 &lt;0.207334&gt; <br> [pid 10411] &lt;... epoll_ctl resumed&gt; ) = 0 &lt;0.118113&gt; <br> [pid 10382] &lt;... pselect6 resumed&gt; ) = 0 (Timeout) &lt;0.117717&gt; <br> [pid 10436] &lt;... read resumed&gt; "cache 154234880\nrss 507904\nrss_h"..., 4096) = 660 &lt;0.159891&gt; <br> [pid 10417] &lt;... futex resumed&gt; ) = 0 &lt;0.917495&gt; <br> [pid 10436] &lt;... futex resumed&gt; ) = 0 &lt;0.208172&gt; <br> [pid 10417] &lt;... futex resumed&gt; ) = 0 &lt;0.190763&gt; <br> [pid 10417] &lt;... read resumed&gt; "cache 0\nrss 0\nrss_huge 0\nmapped_"..., 4096) = 576 &lt;0.154442&gt;</code> <br> <br>  ููุง ูุฏ ุชุชููุน ุ ูุฑู ููุง ููุงููุงุช <code>read()</code> ุจุทูุฆุฉ.  ูู ูุญุชููุงุช ุนูููุงุช ุงููุฑุงุกุฉ <code>mem_cgroup</code> ุ ูููู ููุงุญุธุฉ ุฃู ููุงููุงุช <code>read()</code> ุชุดูุฑ ุฅูู ููู <code>memory.stat</code> ุ ุงูุฐู ููุถุญ ุงุณุชุฎุฏุงู ุงูุฐุงูุฑุฉ ููููุฏ cgroup (ุชูููุฉ ุนุฒู ููุฑุฏ Docker).  ุชููู ุฃุฏุงุฉ cadvisor ุจุงุณุชูุตุงุก ูุฐุง ุงูููู ููุญุตูู ุนูู ูุนูููุงุช ุญูู ุงุณุชุฎุฏุงู ุงูููุงุฑุฏ ููุญุงููุงุช.  ุฏุนููุง ูุชุญูู ููุง ุฅุฐุง ูุงู ูุฐุง ุงูุฌูุงุฒ ุฃู cadvisor ูููู ุจุนูู ุบูุฑ ูุชููุน: <br><br> <code>theojulienne@kube-node-bad ~ $ time cat /sys/fs/cgroup/memory/memory.stat &gt;/dev/null <br> <br> real 0m0.153s <br> user 0m0.000s <br> sys 0m0.152s <br> theojulienne@kube-node-bad ~ $</code> <br> <br>  ุงูุขู ูููููุง ุฅุนุงุฏุฉ ุฅูุชุงุฌ ุงูุฃุฎุทุงุก ูููู ุฃู ููุงุฉ Linux ุชูุงุฌู ุนูู ุงูุฃูุฑุงุถ. <br><br><h1 style=";text-align:right;direction:rtl">  ูุง ุงูุฐู ูุฌุนู ุงููุฑุงุกุฉ ุจุทูุฆุฉ ููุบุงูุฉุ </h1><br>  ูู ูุฐู ุงููุฑุญูุฉ ุ ูู ุงูุฃุณูู ุจูุซูุฑ ุงูุนุซูุฑ ุนูู ุฑุณุงุฆู ูู ูุณุชุฎุฏููู ุขุฎุฑูู ุญูู ูุดููุงุช ููุงุซูุฉ.  ููุง ุงุชุถุญ ุ ูู ุชุนูุจ cadvisor ุชู ุงูุฅุจูุงุบ ุนู ูุฐุง ุงูุฎุทุฃ <a href="https://github.com/google/cadvisor/issues/1774">ููุดููุฉ ุงุณุชุฎุฏุงู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุงูููุฑุทุฉ</a> ุ ููุท ูู ููุงุญุธ ุฃุญุฏ ุฃู ุงูุชุฃุฎูุฑ ุงูุนูุณ ุจุดูู ุนุดูุงุฆู ุฃูุถูุง ูู ููุฏุณ ุงูุดุจูุฉ.  ูู ุงููุงูุน ุ ููุญุธ ุฃู cadvisor ูุณุชููู ููุชูุง ุฃุทูู ูู ุงููุชููุน ูููุนุงูุฌ ุ ููู ูุฐุง ูู ูุนุท ุฃูููุฉ ูุจูุฑุฉ ุ ูุฃู ุฎูุงุฏููุง ูุฏููุง ุงููุซูุฑ ูู ููุงุฑุฏ ุงููุนุงูุฌ ุ ูุฐูู ูู ูุฏุฑุณ ุงููุดููุฉ ุจุนูุงูุฉ. <br><br>  ุงููุดููุฉ ูู ุฃู ูุฌููุนุงุช ุงูุชุญูู (cgroups) ุชุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ ุงุณุชุฎุฏุงู ุงูุฐุงูุฑุฉ ุฏุงุฎู ูุณุงุญุฉ ุงูุงุณู (ุงูุญุงููุฉ).  ุนูุฏ ุงูุชูุงุก ุฌููุน ุงูุนูููุงุช ูู ูุฐู ุงููุฌููุนุฉ ุ ูุญุฑุฑ Docker ูุฌููุนุฉ ุชุญูู ูู ุงูุฐุงูุฑุฉ.  ููุน ุฐูู ุ ูุฅู "ุงูุฐุงูุฑุฉ" ููุณุช ูุฌุฑุฏ ุฐุงูุฑุฉ ุนูููุฉ.  ุนูู ุงูุฑุบู ูู ุฃู ุฐุงูุฑุฉ ุงูุนูููุฉ ููุณูุง ูู ุชุนุฏ ูุณุชุฎุฏูุฉ ุ ููุฏ ุชุจูู ุฃู ุงูููุงุฉ ุชููู ุฃูุถูุง ุจุชุนููู ูุญุชูู ูุคูุช ุ ูุซู ุงูุฃุณูุงู ู inode (ุงูุฏููู ูุจูุงูุงุช ุงูููู ุงููุตููุฉ) ุ ูุงูุชู ูุชู ุชุฎุฒูููุง ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช cgroup.  ูู ูุตู ุงููุดููุฉ: <br><br><blockquote style=";text-align:right;direction:rtl">  cgroups zombies: ูุฌููุนุงุช ุงูุชุญูู ุงูุชู ูุง ุชูุฌุฏ ูููุง ุนูููุงุช ููุชู ุญุฐููุง ุ ููู ูู ุฃุฌููุง ูุง ุชุฒุงู ุงูุฐุงูุฑุฉ ูุฎุตุตุฉ (ูู ุญุงูุชู ุ ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ูุทุจ ุงูุฃุณูุงู ุ ูููู ูููู ุชุฎุตูุตูุง ุฃูุถูุง ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ููุตูุญุฉ ุฃู tmpfs). </blockquote><br>  ูููู ุฃู ูููู ุงูุชุญูู ูู ูุจู ุงูููุงุฉ ุฌููุน ุงูุตูุญุงุช ุงูููุฌูุฏุฉ ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุนูุฏ ุชุญุฑูุฑ cgroup ุจุทูุฆูุง ููุบุงูุฉ ุ ูุฐูู ูุชู ุงุฎุชูุงุฑ ุงูุนูููุฉ ุงูุจุทูุฆุฉ: ุงูุชุธุฑ ุญุชู ูุชู ุทูุจ ูุฐู ุงูุตูุญุงุช ูุฑุฉ ุฃุฎุฑู ุ ูุญุชู ุนูุฏูุง ุชููู ููุงู ุญุงุฌุฉ ุญููููุฉ ููุฐุงูุฑุฉ ุ ูู ุจุฅูุบุงุก ุชุญุฏูุฏ cgroup ุฃุฎูุฑูุง.  ุญุชู ุงูุขู ุ ูุง ุชุฒุงู cgroup ุชุคุฎุฐ ูู ุงูุงุนุชุจุงุฑ ุนูุฏ ุฌูุน ุงูุฅุญุตุงุกุงุช. <br><br>  ูููุง ูุชุนูู ุจุงูุฃุฏุงุก ุ ููุฏ ุถุญูุง ุจุงูุฐุงูุฑุฉ ูู ุฃุฌู ุงูุฃุฏุงุก: ุชุณุฑูุน ุนูููุฉ ุงูุชูุธูู ุงูุฃููู ูุธุฑูุง ูุญูููุฉ ูุฌูุฏ ุงููููู ูู ุงูุฐุงูุฑุฉ ุงููุฎุฒูุฉ ูุคูุชูุง.  ูุฐุง ุทุจูุนู.  ุนูุฏูุง ุชุณุชุฎุฏู kernel ุงูุฌุฒุก ุงูุฃุฎูุฑ ูู ุงูุฐุงูุฑุฉ ุงููุฎุจุฃุฉ ุ ูุชู ูุณุญ cgroup ูู ุงูููุงูุฉ ุ ูุฐูู ูุง ูููู ุชุณููุชู "ุชุณุฑุจ".  ูุณูุก ุงูุญุธ ุ ูุคุฏู ุงูุชูููุฐ <code>memory.stat</code> ูุขููุฉ ุงูุจุญุซ <code>memory.stat</code> ูู ูุฐุง ุงูุฅุตุฏุงุฑ kernel (4.9) ุ ุฅูู ุฌุงูุจ ุงููู ุงููุงุฆู ูู ุงูุฐุงูุฑุฉ ุนูู ุฎูุงุฏููุง ุ ุฅูู ุฃู ุงูุฃูุฑ ูุชุทูุจ ููุชูุง ุฃุทูู ุจูุซูุฑ ูุงุณุชุนุงุฏุฉ ุฃุญุฏุซ ุงูุจูุงูุงุช ุงููุฎุฒูุฉ ูุคูุชูุง ููุณุญ ุฒููุจู cgroup. <br><br>  ุงุชุถุญ ุฃู ููุงู ุงููุซูุฑ ูู ุงูุฒููุจู cgroup ุนูู ุจุนุถ ุงูุนูุฏ ูุฏููุง ุฃู ุงููุฑุงุกุฉ ูุงููููู ุชุฌุงูุฒุช ุงูุซุงููุฉ. <br><br>  ูุชูุซู ุฃุญุฏ ุญู ุงููุดููุฉ ูู cadvisor ูู ูุณุญ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุนูู ุงูููุฑ dentries / inodes ูู ุฌููุน ุฃูุญุงุก ุงููุธุงู ุ ููุง ูุญู ุนูู ุงูููุฑ ูููู ุงููุฑุงุกุฉ ููุฐูู ุฒูู ุงูุชูุงู ุงูุดุจูุฉ ุนูู ุงููุถูู ุ ูุฃู ุญุฐู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ูุชุถูู cgroup zombie ุงูุตูุญุงุช ุงููุฎุฒูุฉ ูุคูุชูุง ุ ููุง ูุชู ุชุญุฑูุฑูุง.  ูุฐุง ููุณ ุญูุงู ุ ูููู ูุคูุฏ ุณุจุจ ุงููุดููุฉ. <br><br>  ุงุชุถุญ ุฃู ุงูุฅุตุฏุงุฑุงุช ุงูุฃุญุฏุซ ูู kernel (4.19+) ุญุณููุช ุฃุฏุงุก ููุงููุฉ <code>memory.stat</code> ุ ูุฐุง ูุฅู ุงูุชุจุฏูู ุฅูู ูุฐุง kernel ุญู ุงููุดููุฉ.  ูู ุงูููุช ููุณู ุ ูุงู ูุฏููุง ุฃุฏูุงุช ูููุดู ุนู ุงูุนูุฏ ุงููุดููุฉ ูู ูุฌููุนุงุช Kubernetes ุ ูุงุณุชูุฒุงููุง ุจุฃูุงู ูุฅุนุงุฏุฉ ุงูุชุดุบูู.  ุชูุดูุทูุง ูู ุฎูุงู ุฌููุน ุงููุฌููุนุงุช ุ ูุฌุฏูุง ุงูุนูุฏ ูุน ุชุฃุฎูุฑ ุนุงููุฉ ุจูุง ููู ุงูููุงูุฉ ูุฅุนุงุฏุฉ ุชุดุบูููุง.  ูุฐุง ุฃุนุทุงูุง ุงูููุช ูุชุญุฏูุซ ูุธุงู ุงูุชุดุบูู ุนูู ุจููุฉ ุงูุฎูุงุฏู. <br><br><h1 style=";text-align:right;direction:rtl">  ูุชูุฎูุต </h1><br>  ูุธุฑูุง ูุฃู ูุฐุง ุงูุฎุทุฃ ุชููู ุนู ูุนุงูุฌุฉ ููุงุฆู ุงูุชุธุงุฑ NIC RX ููุฆุงุช ุงููููู ุซุงููุฉ ุ ููุฏ ุชุณุจุจ ูู ููุช ูุงุญุฏ ูู ุชุฃุฎูุฑ ูุจูุฑ ุนูู ุงูุงุชุตุงูุงุช ุงููุตูุฑุฉ ูุชุฃุฎูุฑ ูู ููุชุตู ุงูุงุชุตุงู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุจูู ุงุณุชุนูุงูุงุช MySQL ูุญุฒู ุงูุงุณุชุฌุงุจุฉ. <br><br>       ,   Kubernetes,            .    Kubernetes    . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar477390/">https://habr.com/ru/post/ar477390/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar477378/index.html">Mixed Agile - ููุฌ ุงูุดูุงู ุนูุฏ ุชุทุจูู ุชุทุจููุงุช ุงูุฃุนูุงู (ุงููููุจ Agile-like)</a></li>
<li><a href="../ar477382/index.html">ุงูุฑูุงุถุงุช ุงูุฅููุชุฑูููุฉ - ุชุญููู ุฑุจุญ: ูุฑุณูุฏุณ ุ ููุจุฑ ุงูุตูุช ุ ุงููุฑุงููุฉ ูุงูุนูุงูุงุช ุงูุชุฌุงุฑูุฉ ููุฑูุงุถุงุช ุงูุฅููุชุฑูููุฉ</a></li>
<li><a href="../ar477384/index.html">ูุคุชูุฑ "ุฃูู ุงููุนูููุงุช. ุชูุฏูุฏุงุช ุงูุญุงุถุฑ ูุงููุณุชูุจู "</a></li>
<li><a href="../ar477386/index.html">ุฃุณุจูุน ุงูุฃูุงู 48: ุชุณุฑุจ ุงูุจูุงูุงุช ุงูุถุฎูุฉ ูุถุนู Whatsapp</a></li>
<li><a href="../ar477388/index.html">NILFS2 - ูุธุงู ูููุงุช ูุถุงุฏ ููุฑุตุงุต ูู / home</a></li>
<li><a href="../ar477392/index.html">ูุชุญ ุงููููุฑูููู: ุงูุฎูููุฉ. ูุญู ูุฏุนู ุงููุชุญุฏุซูู</a></li>
<li><a href="../ar477396/index.html">ููููุฉ ุงูุชุณุฌูู ูู ุงูุฏูุฑุฉ ู ... ุงูุฐูุงุจ ุฅูู ุงูููุงูุฉ</a></li>
<li><a href="../ar477400/index.html">ุญูู ูููุฉ ูุฏูุฑ ุงูููุชุฌ: ููููุฉ ุชุญููู ุงููุซุงููุ</a></li>
<li><a href="../ar477402/index.html">ูุดุฑ ูููุฐุฌ ุงูุชุนูู ุงูุนููู Keras ูุชุทุจูู Python ุนูู ุงูููุจ</a></li>
<li><a href="../ar477404/index.html">ูุดููุฉ ุฅูุดุงุก ูุญุฐู ุงููุงุฆูุงุช ูู C ++ ุจุดูู ูุชูุฑุฑ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>