<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘´ğŸ» ğŸ™ŒğŸ» ğŸ‘ğŸ¼ Cauchemar du Â«chevalierÂ»: une histoire instructive sur DevOps ğŸ‡ ğŸ‘¨â€ğŸ’¼ ğŸ‘´ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1066, plus de 200 ans se sont Ã©coulÃ©s depuis le dÃ©but de l'invasion des Vikings en Angleterre. Le roi Harold, rassemblant un dÃ©tachement de chevaliers...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cauchemar du Â«chevalierÂ»: une histoire instructive sur DevOps</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/moex/blog/458304/"><img src="https://habrastorage.org/webt/im/2a/ct/im2actpwxzvrz1_j4k-2easujdy.jpeg"><br><br>  1066, plus de 200 ans se sont Ã©coulÃ©s depuis le dÃ©but de l'invasion des Vikings en Angleterre.  Le roi Harold, rassemblant un dÃ©tachement de chevaliers, se dirigea vers la riviÃ¨re Derwent pour une bataille dÃ©cisive avec les troupes de son homonyme - le roi de NorvÃ¨ge Harald.  Les armuriers ont travaillÃ© pendant un mois pour forger suffisamment d'armures de nouvelle gÃ©nÃ©ration qui pourraient protÃ©ger le chevalier contre les coups de hache scandinave.  Et combien d'expÃ©riences et d'essais en tournois avaient Ã©tÃ© auparavant!  Mais l'attente Ã©tait censÃ©e se justifier - un Ã©quipement lÃ©ger mais fiable permettait mÃªme Ã  pied, sans grandes pertes, de balayer le Viking hird.  Et finalement, ils se sont rencontrÃ©s Ã  Stamford Bridge.  Le principal dÃ©tachement de chevaliers, dirigÃ© par un commandant en armure brillante, s'est affrontÃ© au milieu d'un pont avec des ennemis.  Oui, l'acier des maÃ®tres podgorny tient le coup! <br><br>  Lentement mais sÃ»rement, les Vikings se tournent vers une dÃ©fense Ã  tour de rÃ´le.  La victoire semble proche.  Et enfin, sur le champ de bataille, le chevalier commandant et le norvÃ©gien jarl se retrouvent. <br><a name="habracut"></a><br>  La hache Ã  deux mains du Jarl est dÃ©jÃ  cassÃ©e et il est obligÃ© de se dÃ©fendre avec un saxon ordinaire, qui ne peut pas Ãªtre comparÃ© Ã  un chevalier et demi.  Une vague avec un poignard - pour l'armure du commandant, c'est comme un canif, mais elle passe Ã  travers l'armure et ... il semble que la magie soit entrÃ©e en jeu - l'armure des chevaliers voisins est dispersÃ©e!  Une autre vague, toujours sur la cible, et maintenant sur les flancs du flanc gauche, l'armure brille d'un coup.  Le troisiÃ¨me coup - les chevaliers nagent devant leurs yeux, ils trÃ©buchent, tombent et ne se lÃ¨vent plus. <br><br>  "*** ** **** ****!"  S'Ã©cria Petrovich, se rÃ©veillant lundi Ã  5 heures du matin dans une sueur froide.  Tout a mal tournÃ©: Ã  23 heures, il est montÃ© sur Wikipedia Ã  la recherche de documents pour le rapport de l'enfant sur la nature de la toundra, mais au moment de la nuit, il s'est retrouvÃ© en quelque sorte sur la description de l'invasion des Vikings en Angleterre.  Et aussi, le week-end, ils ont lancÃ© la prochaine version, qui devrait commencer aujourd'hui.  Comme toujours, nous l'avons testÃ© pendant longtemps et minutieusement, l'avons conduit Ã  travers des systÃ¨mes d'intÃ©gration continue un million de fois, que tout se passe bien ... <br><br>  Heureusement pour certains, mais malheureusement pour les victimes, il y a toujours la possibilitÃ© d'apprendre des erreurs des autres, d'amÃ©liorer quelque chose Ã  la maison et d'obtenir une part de confiance supplÃ©mentaire.  Avec cet article traduit, nous voulons encore une fois, plus en dÃ©tail, rappeler l'un des cas de "notre" industrie. <br><br><hr><br>  L'annÃ©e derniÃ¨re, lors de la confÃ©rence, j'ai parlÃ© de DevOps, de la configuration en tant que code et de la livraison continue.  En utilisant l'histoire ci-dessous, j'ai expliquÃ© l'importance de crÃ©er des dÃ©ploiements entiÃ¨rement automatisÃ©s et reproductibles dans le cadre de l'initiative DevOps / Continuous Delivery.  AprÃ¨s la confÃ©rence, plusieurs personnes m'ont demandÃ© de partager une histoire sur un blog.  C'est une histoire absolument vraie.  Ceci est une nouvelle de ce que j'ai lu, je n'y ai pas participÃ© moi-mÃªme. <br><br>  Ainsi, l'histoire de la faillite d'une entreprise avec des actifs de prÃ¨s de 400 millions de dollars en 45 minutes en raison d'un dÃ©ploiement infructueux. <br><br><h1>  Un peu de fond </h1><br>  Knight Capital Group (Â«KnightÂ» en anglais signifie Â«knightÂ») est une sociÃ©tÃ© financiÃ¨re mondiale amÃ©ricaine engagÃ©e dans la tenue de marchÃ©, l'exÃ©cution Ã©lectronique, les ventes institutionnelles et le trading.  En 2012, Knight Ã©tait le plus grand nÃ©gociant en bourse amÃ©ricain avec une part de marchÃ© d'environ 17% sur le NYSE et le NASDAQ.  Le groupe de nÃ©gociation Ã©lectronique de Knight (ETG) a gÃ©rÃ© un volume de nÃ©gociation quotidien moyen de plus de 3,3 milliards de transactions par jour, Ã©changeant plus de 21 milliards de dollars ... par jour.  Ce n'est pas une blague! <br><br>  Au 31 juillet 2012, Knight disposait d'environ 365 millions de dollars en trÃ©sorerie et Ã©quivalents de trÃ©sorerie. <br><br>  Le 1er aoÃ»t 2012, le NYSE prÃ©voyait de lancer un nouveau programme de liquiditÃ© de dÃ©tail, le Retail Liquidity Program (un programme conÃ§u pour amÃ©liorer les prix pour les investisseurs de dÃ©tail par le biais de courtiers de dÃ©tail tels que Knight).  En prÃ©paration de cet Ã©vÃ©nement, Knight a mis Ã  jour son routeur algorithmique automatisÃ© Ã  haute vitesse SMARS, qui envoie des applications sur le marchÃ© pour exÃ©cution.  L'une des principales fonctions de SMARS est de recevoir des applications d'autres composants de la plateforme de trading Knights (applications Â«parentsÂ»), puis d'envoyer une ou plusieurs applications Â«enfantsÂ» pour exÃ©cution.  En d'autres termes, SMARS recevra des commandes importantes de la plateforme de trading et les divisera en plusieurs petites afin de trouver un acheteur / vendeur pour les stocks.  Plus l'application parent est grande, plus les applications enfants seront crÃ©Ã©es. <br><br>  La mise Ã  jour SMARS Ã©tait censÃ©e remplacer l'ancien code inutilisÃ© appelÃ© Â«Power PegÂ» - cette fonctionnalitÃ© que Knight n'avait pas utilisÃ©e depuis 8 ans (pourquoi le code qui Ã©tait mort depuis si longtemps Ã©tait toujours dans la base de code est un mystÃ¨re, mais ce n'est pas le principal).  Le code mis Ã  jour a rÃ©affectÃ© l'ancien indicateur utilisÃ© pour activer la fonctionnalitÃ© Power Peg.  Le code a Ã©tÃ© soigneusement testÃ©, a fonctionnÃ© correctement et Ã©tait fiable.  Qu'est-ce qui aurait pu mal tourner? <br><br><h1>  Qu'est-ce qui aurait pu mal tourner?  Et vraiment! </h1><br>  Entre le 27 juillet 2012 et le 31 juillet 2012, Knight a dÃ©ployÃ© manuellement de nouveaux logiciels sur un nombre limitÃ© de serveurs par jour - un total de huit (8) serveurs.  Voici ce que dit le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">document de</a> la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SEC</a> sur le dÃ©ploiement manuel (SEC est la Securities and Exchanges Commission, le rÃ©gulateur amÃ©ricain des marchÃ©s boursiers). <br><br><blockquote>  Â«Lors du dÃ©ploiement du nouveau code, l'un des employÃ©s de Knight n'a pas copiÃ© le nouveau code sur l'un des huit serveurs SMARS.  Knight n'a pas effectuÃ© de deuxiÃ¨me examen technique de ce dÃ©ploiement, de sorte que le code Power Peg n'a pas Ã©tÃ© supprimÃ© du huitiÃ¨me serveur et que le nouveau code RLP n'a pas Ã©tÃ© ajoutÃ©.  L'entreprise n'avait pas mis en place de procÃ©dures nÃ©cessitant un rÃ©examen. Â»  CommuniquÃ© n Â° 70694, 16 octobre 2013 </blockquote><br>  Le 1er aoÃ»t 2012 Ã  9 h 30 HNE, les marchÃ©s se sont ouverts et Knight a commencÃ© Ã  traiter les demandes des courtiers pour le compte de ses clients dans le cadre du nouveau programme de liquiditÃ© au dÃ©tail.  Sept (7) serveurs correctement dÃ©ployÃ©s ont commencÃ© Ã  traiter correctement les demandes.  Et ces applications qui sont allÃ©es au huitiÃ¨me serveur ont probablement activÃ© le drapeau modifiÃ© et ressuscitÃ© Power Peg. <br><br><h1>  Zombie Attack: Killer Code </h1><br>  Ici, vous devez expliquer pourquoi le code Power Peg Â«mortÂ» Ã©tait nÃ©cessaire.  Cette fonctionnalitÃ© Ã©tait destinÃ©e Ã  compter les actions achetÃ©es / vendues Ã  la demande d'un parent Ã  mesure que les commandes de l'enfant sont exÃ©cutÃ©es.  Une fois l'application parent exÃ©cutÃ©e, Power Peg interdit la soumission d'applications enfants.  En principe, Power Peg suivra les ordres enfants et arrÃªtera leur exÃ©cution aprÃ¨s le traitement de la demande parent.  En 2005, Knight a annulÃ© cette fonctionnalitÃ© de suivi cumulatif Ã  une Ã©tape antÃ©rieure de l'exÃ©cution du code (supprimant ainsi le suivi des quantitÃ©s de Power Peg). <br><br>  Lorsque l'indicateur Power Peg sur le huitiÃ¨me serveur a Ã©tÃ© activÃ©, Power Peg a commencÃ© Ã  acheminer les ordres enfants pour exÃ©cution, mais ne les a pas corrÃ©lÃ©s avec le nombre de partages dans l'ordre parent - une sorte de boucle fermÃ©e est apparue <br><br><h1>  Infernal 45 minutes </h1><br>  Imaginez: vous avez un systÃ¨me qui peut envoyer des applications automatiques Ã  haut dÃ©bit sur le marchÃ© sans aucun suivi et la possibilitÃ© de voir si suffisamment d'applications ont Ã©tÃ© terminÃ©es.  Oui, tout s'est avÃ©rÃ© si mauvais. <br><br>  Lorsque le marchÃ© a ouvert Ã  9h30, les gens ont rapidement rÃ©alisÃ© que quelque chose n'allait pas.  Ã€ 9 h 31, beaucoup Ã  Wall Street avaient rÃ©alisÃ© que quelque chose de grave se passait.  Le marchÃ© a Ã©tÃ© inondÃ© d'offres avec un volume d'Ã©change inhabituel, par rapport Ã  la situation normale, pour certaines actions.  Ã€ 9 h 32 Ã  Wall Street, ils se sont demandÃ© pourquoi cette honte ne s'arrÃªtait pas.  Presque pour toujours dans le trading Ã  grande vitesse.  Pourquoi quelqu'un n'a-t-il pas cliquÃ© sur le bouton kill du systÃ¨me qui l'a fait?  Il s'est avÃ©rÃ© qu'il n'y avait pas d'interrupteur.  Au cours des 45 premiÃ¨res minutes de nÃ©gociation, l'exÃ©cution des transactions de Knight a reprÃ©sentÃ© plus de 50% du volume des transactions, augmentant certaines actions de plus de 10% de leur valeur.  En consÃ©quence, d'autres actions ont perdu de la valeur en raison de transactions erronÃ©es. <br><br>  Et pour aggraver les choses, le systÃ¨me Knight a commencÃ© Ã  envoyer des e-mails automatisÃ©s avant mÃªme ces Ã©vÃ©nements - dÃ¨s 8 h 01 (lorsque SMARS a traitÃ© des ordres adaptÃ©s Ã  la nÃ©gociation avant commercialisation).  Dans les messages, le systÃ¨me fait rÃ©fÃ©rence Ã  SMARS et affiche l'erreur Â«Power Peg is not availableÂ».  Entre 8 h 01 et 9 h 30, 97 lettres ont Ã©tÃ© envoyÃ©es aux employÃ©s de Knight.  Bien sÃ»r, ces lettres ne ressemblaient pas Ã  des avertissements systÃ¨me, donc personne ne les a regardÃ©es tout de suite.  Ouch. <br><br>  Pendant 45 minutes infernales, Knight a essayÃ© d'arrÃªter la transaction erronÃ©e.  Il n'a pas Ã©tÃ© possible de dÃ©sactiver le systÃ¨me (car il n'y avait pas de procÃ©dures documentÃ©es pour rÃ©pondre Ã  une telle situation), par consÃ©quent, essayant de rÃ©soudre le problÃ¨me dans des conditions de trading en direct, ils sont restÃ©s sur le marchÃ©, oÃ¹ 8 millions d'actions ont Ã©tÃ© vendues chaque minute.  Ã‰tant donnÃ© que les employÃ©s de l'entreprise n'ont pas pu dÃ©terminer d'oÃ¹ provenaient les applications erronÃ©es, ils ont supprimÃ© le nouveau code des serveurs sur lesquels il Ã©tait correctement dÃ©ployÃ©.  En d'autres termes, ils ont supprimÃ© le code de travail et l'ont laissÃ© en panne.  Cela n'a fait qu'exacerber les problÃ¨mes entraÃ®nant des demandes parentales supplÃ©mentaires pour activer le code Power Peg sur tous les serveurs, et pas seulement lÃ  oÃ¹ le code a Ã©tÃ© dÃ©ployÃ© Ã  l'origine de maniÃ¨re incorrecte.  Au final, j'ai rÃ©ussi Ã  arrÃªter le systÃ¨me - aprÃ¨s 45 minutes de trading. <br><br>  Pendant que la nÃ©gociation Ã©tait en cours, le code Power Peg a reÃ§u et traitÃ© 212 demandes parentales.  En consÃ©quence, SMARS a envoyÃ© des millions de filiales sur le marchÃ©, rÃ©alisÃ© 4 millions de transactions en 154 transactions avec plus de 397 millions d'actions.  Pour les connaisseurs des marchÃ©s boursiers, cela signifiait que Knight avait achetÃ© des actions de 80 sociÃ©tÃ©s diffÃ©rentes pour 3,5 milliards de dollars et vendu des actions de 74 sociÃ©tÃ©s pour 3,15 milliards de dollars. Du point de vue des non-professionnels, le Knight Capital Group a perdu 460 millions de dollars en 45 minutes.  Mais Knight n'a que 365 millions de dollars en espÃ¨ces et quasi-espÃ¨ces.  En 45 minutes, Knight est passÃ© du plus grand trader des actions amÃ©ricaines et du principal market maker du NYSE et du NASDAQ Ã  la faillite.  Ils ont eu 48 heures pour encaisser le montant nÃ©cessaire pour couvrir les pertes (ce qu'ils ont pu faire grÃ¢ce Ã  un investissement de 400 millions de dollars d'une demi-douzaine d'investisseurs).  En fin de compte, le Knight Capital Group a Ã©tÃ© acquis par Getco LLC (en dÃ©cembre 2012), et maintenant la sociÃ©tÃ© issue du regroupement s'appelle KCG Holdings. <br><br><h1>  Quelles conclusions devez-vous tirer </h1><br>  Les Ã©vÃ©nements du 1er aoÃ»t 2012 devraient Ãªtre une leÃ§on pour toutes les Ã©quipes de dÃ©veloppement et les Ã©quipes de projet.  Il ne suffit pas de crÃ©er un excellent logiciel et de le tester;  Vous devez Ã©galement vous assurer qu'il est correctement livrÃ© sur le marchÃ© afin que vos clients reÃ§oivent exactement la valeur que vous fournissez (et que vous ne mettiez pas votre entreprise en faillite).  Le ou les ingÃ©nieurs qui ont dÃ©ployÃ© SMARS ne sont pas seulement responsables du fait que la procÃ©dure suivie Ã  Knight n'a pas pris en compte les risques.  La procÃ©dure (ou son absence) Ã©tait manifestement erronÃ©e.  Chaque fois que le processus de dÃ©ploiement dÃ©pend de la faÃ§on dont les gens lisent et suivent les instructions, vous vous mettez en danger.  Les gens font des erreurs.  Les erreurs peuvent Ãªtre dans les instructions, dans l'interprÃ©tation des instructions ou dans leur mise en Å“uvre. <br><br>  La mise en page doit Ãªtre automatisÃ©e, reproductible et aussi exempte d'erreurs humaines possibles que possible.  Si Knight avait mis en Å“uvre un systÃ¨me de dÃ©ploiement automatisÃ© - un ensemble de configuration, de dÃ©ploiement automatique et de tests - alors l'erreur qui s'est transformÃ©e en cauchemar de Knight aurait pu Ãªtre Ã©vitÃ©e. <br><br>  Voici quelques principes de livraison continue (mÃªme si vous n'implÃ©mentez pas le processus complet de livraison continue): <br><br><ul><li>  La sortie du logiciel doit Ãªtre un processus reproductible et fiable. <br></li><li>  Automatisez tout ce que vous pouvez. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr458304/">https://habr.com/ru/post/fr458304/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr458290/index.html">Ordinateur biosynthÃ©tique Ã  double cÅ“ur dans une cellule vivante</a></li>
<li><a href="../fr458292/index.html">PHP Digest n Â° 159 (17 juin - 1er juillet 2019)</a></li>
<li><a href="../fr458298/index.html">FabriquÃ© un grand demi-engrenage sur des panneaux solaires pour 250 000 roubles (2 parties)</a></li>
<li><a href="../fr458300/index.html">Evolution de l'outil le plus populaire de chaque dÃ©veloppeur (dans Visual Studio)</a></li>
<li><a href="../fr458302/index.html">Frontend Weekly Digest (24-30 juin 2019)</a></li>
<li><a href="../fr458306/index.html">Le condensÃ© de matiÃ¨res fraÃ®ches du monde du front-end de la derniÃ¨re semaine n Â° 371 (24-30 juin 2019)</a></li>
<li><a href="../fr458308/index.html">Vue d'ensemble: quel sera l'avenir de Tesla et quels facteurs l'affecteront</a></li>
<li><a href="../fr458310/index.html">Collecter des mÃ©triques Ã  partir d'applications .NET Ã  l'aide de Telegraf</a></li>
<li><a href="../fr458312/index.html">Android Academy Ã  Moscou: cours avancÃ©</a></li>
<li><a href="../fr458316/index.html">Yandex Retro Games Battle 2019 - dÃ©veloppement de jeux pour ZX Spectrum</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>