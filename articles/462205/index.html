<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö£üèΩ ü¶ó üèà PHDays 9 ganadores The Standoff: la cr√≥nica del equipo True0xA3 üë®üèª‚Äçüöí üö≤ üï¥üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este es un resumen en ingl√©s de dos art√≠culos absolutamente sobresalientes escritos por Vitaliy Malkin de "Informzashita" cuyo equipo, True0xA3, se co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PHDays 9 ganadores The Standoff: la cr√≥nica del equipo True0xA3</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462205/">  Este es un resumen en ingl√©s de dos art√≠culos absolutamente sobresalientes escritos por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Vitaliy Malkin</a> de "Informzashita" cuyo equipo, True0xA3, se convirti√≥ en los ganadores de la prestigiosa competencia de sombrero negro The Standoff durante <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Positive Hack Days 9</a> en mayo de 2019. <br><br>  Vitaliy ha publicado tres art√≠culos detallados sobre Habr, dos de los cuales se dedicaron a la descripci√≥n de las estrategias que el equipo True0xA3 utiliz√≥ antes y durante la competencia para asegurar a este equipo el t√≠tulo de los ganadores.  Sent√≠ que lo √∫nico que les faltaba a esos dos art√≠culos era un resumen en ingl√©s para que una audiencia m√°s amplia de lectores pudiera disfrutarlos.  Entonces, a continuaci√≥n se muestra el resumen de dos art√≠culos de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Vitaliy Malkin</a> , junto con im√°genes que Vitaliy public√≥ para aclarar sus puntos.  Vitaliy me ha autorizado a hacer la traducci√≥n y publicarla. <br><a name="habracut"></a><br><h2>  PARTE I. Prepar√°ndose para la batalla. </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El art√≠culo original est√° aqu√≠.</a> <br><br><h3>  I. Objetivos iniciales </h3><br>  El equipo constaba de 16 pentesters verdaderos y 4 internos, armados con 6 servidores y nuestra propia estaci√≥n CUDA, adem√°s de la voluntad de llegar a la distancia. <br><br>  Los preparativos activos comenzaron 8 d√≠as antes del comienzo de The Standoff.  Este fue nuestro tercer intento de ganar The Standoff, por lo que algunos de nosotros tuvimos la experiencia suficiente para saber lo que hab√≠a que hacer.  Desde el principio, hemos discutido las siguientes prioridades para el equipo: <br><br><ol><li>  Coordinaci√≥n fluida entre los miembros del equipo. </li><li>  Colecci√≥n de frutas bajas </li><li>  Explotaci√≥n de vulnerabilidades no t√≠picas para nosotros, como los sistemas de control de procesos automatizados (APCS), los sistemas de control distribuido (DCS), IoT, GSM </li><li>  Establecer nuestra propia infraestructura y equipo con anticipaci√≥n </li><li>  Desarrollar alguna estrategia para la persistencia y el endurecimiento. </li></ol><br><h4>  Coordinaci√≥n </h4><br>  Esta es la debilidad de todos los novatos en el Standoff: las tareas no se distribuyen de manera efectiva;  varias personas est√°n trabajando en la misma tarea;  no est√° claro qu√© tareas ya se han completado;  los resultados de una tarea no se env√≠an a los miembros apropiados del equipo, etc.  Cuanto m√°s grande es el equipo, menos efectiva es la coordinaci√≥n entre los miembros del equipo.  Lo que es m√°s importante, debe haber al menos una persona que comprenda la imagen completa desde el punto de vista de la infraestructura y que pueda reunir m√∫ltiples vulnerabilidades en un vector de ataque enfocado. <br><br>  Este a√±o utilizamos la plataforma de colaboraci√≥n Discord.  Es similar al chat IRC pero con caracter√≠sticas adicionales como carga de archivos y llamadas de voz.  Para cada objetivo en el mapa Standoff, creamos un canal separado en el que se recopilar√≠an todos los datos.  De esta forma, un nuevo miembro del equipo asignado a una tarea podr√≠a ver f√°cilmente toda la informaci√≥n que ya se ha recopilado para esta tarea, los resultados de las implementaciones, etc.  Todos los canales de informaci√≥n ten√≠an un l√≠mite de 1 mensaje por minuto para evitar inundaciones.  Cada objeto en el Standoff ten√≠a su propio espacio de chat dedicado. <br><br>  Cada miembro del equipo recibi√≥ un alcance de trabajo claramente definido.  Para mejorar la coordinaci√≥n, se asign√≥ una persona para tomar decisiones finales sobre todas las tareas.  Esto nos impidi√≥ entrar en largas discusiones y desacuerdos durante la competencia. <br><br><h4>  Recolectando frutas bajas </h4><br>  Creo que el factor m√°s importante en el juego result√≥ ser la capacidad de gestionar m√∫ltiples proyectos y priorizar adecuadamente los objetivos.  En el juego del a√±o pasado, pudimos tomar el control de una oficina y quedarnos all√≠ simplemente porque usamos vulnerabilidades bien conocidas.  Este a√±o decidimos hacer una lista de tales vulnerabilidades con anticipaci√≥n y organizar nuestro conocimiento: <br><br>  <i>ms17-010;</i>  <i>ms08-67;</i>  <i>SMBCRY</i>  <i>LibSSH RCE;</i>  <i>HP DATA Protector;</i>  <i>HP iLo;</i>  <i>ipmi</i>  <i>Instalaci√≥n inteligente de Cisco</i>  <i>Java RMI</i>  <i>JDWP;</i>  <i>JBOSS;</i>  <i>drupalgeddon2;</i>  <i>weblogic</i>  <i>desangrado</i>  <i>concha</i>  <i>ibm websphere</i>  <i>iis-webdav;</i>  <i>servicios;</i>  <i>vnc;</i>  <i>ftp-anon;</i>  <i>NFS</i>  <i>smb-null;</i>  <i>Tomcat</i> <br><br>  Luego creamos 2 servicios, verificador y penetrador, que automatizaron las pruebas de vulnerabilidades y el despliegue de exploits y metasploits disponibles p√∫blicamente.  Los servicios utilizaron los resultados de nmap para acelerar nuestro trabajo. <br><br><h4>  Explotaci√≥n de vulnerabilidades no t√≠picas para nosotros </h4><br>  No ten√≠amos mucha experiencia con el an√°lisis de vulnerabilidades de los Sistemas Automatizados de Control de Procesos (APCS).  Aproximadamente 8 d√≠as antes del enfrentamiento comenzamos a profundizar en el tema.  La situaci√≥n con IoT y GSM era a√∫n peor.  Nunca tuvimos experiencia con estos sistemas fuera de los enfrentamientos anteriores. <br><br>  Por lo tanto, en la etapa de preparaci√≥n, seleccionamos a 2 personas para estudiar Sistemas de Control Autom√°tico de Procesos (APCS) y 2 m√°s para estudiar GSM e IoT.  El primer equipo en una semana cre√≥ una lista de enfoques t√≠picos para la integraci√≥n de los sistemas SCADA y estudi√≥ en detalle los videos de la infraestructura del a√±o anterior dentro del Standoff.  Tambi√©n descargaron aproximadamente 200 GB de varios HMI, controladores y otro software relacionado con los controladores.  El equipo de IoT prepar√≥ algo de hardware y ley√≥ todos los art√≠culos disponibles sobre GSM.  Esper√°bamos que fuera suficiente (alerta de spoiler: ¬°no fue as√≠!) <br><br><h4>  Conseguir nuestra propia infraestructura y equipos configurados </h4><br>  Como ten√≠amos un equipo bastante grande, decidimos que necesitar√≠amos equipo adicional.  Esto es lo que llevamos con nosotros: <br><br><ul><li>  Servidor CUDA </li><li>  Laptop de respaldo </li><li>  Router wifi </li><li>  Interruptor </li><li>  Variedad de cables de red </li><li>  WiFi Alfa </li><li>  Patitos de goma </li></ul><br>  El a√±o pasado entendimos la importancia del uso de servidores CUDA durante la pirater√≠a de un par de apretones de manos.  Es importante tener en cuenta que este a√±o, as√≠ como en a√±os anteriores, todos los equipos rojos estaban detr√°s de un NAT, por lo que no pudimos usar conexiones inversas desde DMZ.  Sin embargo, asumimos que todos los hosts que no sean los Sistemas de Control Autom√°tico de Procesos (APCS) tendr√≠an una conexi√≥n a Internet.  Con esto en mente, decidimos activar 3 servidores de escucha disponibles en Internet.  Para facilitar el pivote, utilizamos nuestro propio servidor OpenVPN con cliente a cliente activado.  Desafortunadamente, la creaci√≥n automatizada de canales no fue posible, por lo tanto, durante 12 horas de 28, uno de los miembros del equipo se dedic√≥ solo a administrar los canales. <br><br><h4>  Desarrollar alguna estrategia para la persistencia y el endurecimiento. </h4><br>  Nuestra experiencia previa con el enfrentamiento ya nos ense√±√≥ que no era suficiente con hacerse cargo de un servidor.  Era igual de importante evitar que otros equipos tambi√©n se establecieran.  Por lo tanto, pasamos mucho tiempo en la RAT (Herramienta de administraci√≥n remota) con nuevas firmas y scripts para fortalecer los sistemas Windows.  Utilizamos una RAT est√°ndar pero cambiamos ligeramente el m√©todo de ofuscaci√≥n.  Las reglas presentaron una mayor dificultad.  En general, desarrollamos la siguiente lista de scripts: <br><br><ul><li>  Cerrar los puertos SMB (bloque de mensajes del servidor) y RPC (llamada a procedimiento remoto) </li><li>  Mover RDP (protocolo de escritorio remoto) a puertos no est√°ndar </li><li>  Desactivar el cifrado reversible, las cuentas de invitados y otros problemas t√≠picos de la l√≠nea de base de seguridad </li></ul><br>  Para los sistemas Linux, desarrollamos un gui√≥n de inicio especial que cerr√≥ todos los puertos, movi√≥ SSH a un puerto no est√°ndar y cre√≥ claves p√∫blicas para el acceso del equipo a SSH <br><br><h3>  II  Briefing </h3><br>  El 17 de mayo, 5 d√≠as antes del enfrentamiento, los organizadores proporcionaron la informaci√≥n para los equipos rojos.  Proporcionaron mucha informaci√≥n que afect√≥ nuestra preparaci√≥n.  Publicaron el mapa de la red, que nos permiti√≥ dividir la red en zonas y asignar responsabilidades para cada zona a un miembro del equipo.  La informaci√≥n m√°s importante que proporcionaron los organizadores fue que APCS ser√≠a accesible solo desde un segmento de la red, y ese segmento no est√° protegido.  Adem√°s, revel√≥ que se otorgar√°n los puntos m√°s altos para el APCS y para las oficinas aseguradas.  Tambi√©n dijeron que recompensar√≠an la capacidad de los equipos rojos de noquearse entre s√≠. <br><br>  Interpretamos que esto significa lo siguiente: "Quien capture el bigbrogroup probablemente ganar√° el juego".  Esto se debe a que nuestra experiencia previa nos ha ense√±ado que no importa c√≥mo los organizadores penalicen la p√©rdida de servicio, los equipos azules matar√°n a los servidores vulnerables si no pueden parcharlos lo suficientemente r√°pido.  Esto se debe a que sus respectivas compa√±√≠as est√°n mucho m√°s preocupadas por la publicidad de un sistema totalmente pirateado que por algunos puntos perdidos en un juego.  Nuestra suposici√≥n era correcta, como veremos pronto. <br><br>  Por lo tanto, decidimos dividir el equipo en 4 partes: <br><br>  <b>I. Bigbrogroup</b> .  Decidimos priorizar esta tarea por encima de todas las dem√°s, por lo que pusimos a nuestros pentesters m√°s experimentados en ese grupo.  Este mini equipo ten√≠a 5 personas y su objetivo principal era hacerse cargo del dominio y evitar que otros equipos obtuvieran acceso al APCS. <br><br>  <b>II</b>  <b>Redes inal√°mbricas</b> .  Este equipo fue responsable de mirar Wifi, rastrear nuevos WAP, capturar los apretones de manos y forzarlos.  Tambi√©n fueron responsables de GSP, pero su objetivo principal era evitar que otros equipos se hicieran cargo de Wifi <br><br>  <b>III.</b>  <b>Redes desprotegidas</b> .  Este equipo pas√≥ las primeras 4 horas probando todas las redes desprotegidas y analizando vulnerabilidades.  Entendimos que en las primeras 4 horas no podr√≠a pasar nada de inter√©s en los segmentos protegidos, al menos nada que los equipos azules no pudieran eliminar, por lo tanto, decidimos pasar esas primeras horas protegiendo las redes desprotegidas, donde las cosas podr√≠an cambiar.  Y result√≥ que fue un buen enfoque. <br><br>  <b>IV.</b>  <b>Grupo de esc√°neres</b> .  Los equipos azules nos dijeron de antemano que la topolog√≠a de la red cambiar√° constantemente, por lo que dedicamos 2 personas a escanear la red y detectar cambios.  La automatizaci√≥n de este proceso result√≥ ser dif√≠cil ya que ten√≠amos m√∫ltiples redes con m√∫ltiples configuraciones.  Por ejemplo, en la primera hora, nuestro nmap funcion√≥ en modo T3, pero al mediod√≠a apenas funcionaba en modo T1. <br><br>  Otro vector importante fue la lista de software y tecnolog√≠as que los organizadores proporcionaron durante la sesi√≥n informativa.  Creamos un grupo de competencia para cada una de las tecnolog√≠as que podr√≠a evaluar r√°pidamente las vulnerabilidades t√≠picas.  Para algunos servicios, encontramos vulnerabilidades conocidas pero no pudimos encontrar ninguna vulnerabilidad publicada.  Este fue, por ejemplo, un caso con Redis Post-explotaci√≥n RCE.  Est√°bamos bastante seguros de que esta vulnerabilidad estar√≠a presente en la infraestructura de Standoff, por lo tanto, decidimos escribir nuestro propio exploit de 1 d√≠a.  Por supuesto, no pudimos escribir el exploit completo, pero en general reunimos 5 exploits in√©ditos que est√°bamos listos para implementar. <br><br>  Desafortunadamente, no pudimos investigar todas las tecnolog√≠as, pero result√≥ no ser tan cr√≠tico.  Como examinamos los de mayor prioridad, result√≥ ser suficiente.  Tambi√©n preparamos la lista de controladores para APCS, que tambi√©n investigamos en detalle. <br><br>  Durante la fase de preparaci√≥n, reunimos varias herramientas para la conexi√≥n subrepticia a la red APCS.  Por ejemplo, preparamos una versi√≥n barata de una pi√±a usando una frambuesa.  Se conectar√≠a a la red Ethernet de la producci√≥n y, a trav√©s de GSM, al servicio de control.  Luego podr√≠amos configurar remotamente una conexi√≥n Ethernet y luego transmitirla a trav√©s de un m√≥dulo wifi incorporado.  Desafortunadamente, durante el juego, los organizadores dejaron en claro que la conexi√≥n f√≠sica con el APCS estar√≠a prohibida, por lo tanto, no pudimos usar el m√≥dulo. <br><br>  Encontramos bastante informaci√≥n sobre el trabajo del banco, las cuentas en el extranjero y el antifraude.  Sin embargo, tambi√©n descubrimos que el banco no ten√≠a tanto dinero, as√≠ que decidimos no pasar tiempo prepar√°ndonos para ese objeto, y solo jugarlo de o√≠do durante el juego. <br><br>  En resumen, trabajamos bastante durante la fase de preparaci√≥n.  Me gustar√≠a se√±alar que, adem√°s del beneficio obvio de ser los ganadores de la competencia Standoff, obtuvimos beneficios menos notables pero no menos importantes, como <br><br><ul><li>  Tomamos un descanso de las minucias cotidianas del trabajo y probamos algo que siempre hab√≠amos esperado hacer. </li><li>  Esta fue nuestra primera experiencia en la que todo el equipo de pentesting estaba trabajando en una sola tarea, por lo que el efecto de creaci√≥n de equipo fue muy notable. </li><li>  Mucha de la informaci√≥n que reunimos durante la preparaci√≥n del juego que podemos usar para nuestros proyectos de pentesting de la vida real, hemos aumentado nuestro nivel de competencia y creado nuevas herramientas listas para usar </li></ul><br>  Mirando hacia atr√°s, me doy cuenta de que nuestra victoria en el enfrentamiento probablemente se asegur√≥ mucho antes de que comenzara el juego, durante la etapa de preparaci√≥n.  Ahora, lo que realmente ocurri√≥ durante el enfrentamiento se describir√° en la Parte II de esta serie <br><br><h2>  Parte II.  Ganar el enfrentamiento.  Compartiendo los salvavidas </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El art√≠culo original est√° aqu√≠.</a> <br><br>  De Vitaliy Malkin, el jefe del equipo rojo de la compa√±√≠a InformZachita y el capit√°n del equipo True0xA3.  True0xA3 gan√≥ una de las competiciones de sombreros blancos m√°s prestigiosas de Rusia: el Standoff en PHDays 2019. <br><br><h3>  D√≠a uno </h3><br>  <b>9:45 MSK</b> <br><br>  El d√≠a comenz√≥ recibiendo los resultados de MassScan.  Comenzamos enumerando todos los hosts con 445 puertos abiertos, y exactamente a las 10 am implementamos el verificador para el metasploit MS17-010.  Seg√∫n nuestro plan, nuestro objetivo principal era capturar el controlador de dominio del dominio bigbrogroup, por lo tanto, 2 personas de nuestro equipo se dedicaron solo a eso.  A continuaci√≥n ver√° las tareas iniciales para cada grupo. <br><br><img src="https://habrastorage.org/webt/cj/fi/_x/cjfi_xy-oe-zsqxkad1o74jxx5g.jpeg" alt="imagen"><br><br>  Como puede ver, intentamos penetrar en todas las oficinas del juego, y el hecho de que ten√≠amos 20 personas estaba haciendo una gran diferencia. <br><br>  <b>10:15</b> <br><br>  Uno de los miembros del equipo de Team1 encuentra un host en el dominio bigbrogroup.phd que es vulnerable a MS17-010.  Desplegamos el exploit con mucha prisa.  Hace un par de a√±os tuvimos la situaci√≥n en la que pudimos llevar el shell meterpreter (ataque de phishing que llevaba el c√≥digo de ejecuci√≥n remoto) a un objetivo importante, pero nos expulsaron en 10 segundos.  Este a√±o estuvimos m√°s preparados.  Asumimos el host, cerramos el puerto SMB y cambiamos el RDP al puerto 50002. Prestamos mucha atenci√≥n al proceso de persistencia en el dominio, por lo tanto, creamos algunas cuentas de administrador local e implementamos nuestras propias Herramientas de administraci√≥n remota (RAT) .  Solo despu√©s de eso pasamos a la siguiente tarea <br><br>  <b>10:25</b> <br><br>  Continuamos revisando los resultados de la informaci√≥n que recopilamos del anfitri√≥n.  Adem√°s del acceso a la red interna y la conexi√≥n al controlador de dominio, tambi√©n encontramos el token del administrador de dominio.  Antes de entusiasmarnos demasiado, verificamos si el token sigue siendo v√°lido.  Y luego nos regocijamos.  El primer dominio ha ca√≠do.  El tiempo total empleado es de 27 min 52 segundos <br><br>  Media hora despu√©s de la hora de inicio, visitamos el portal del jugador para comprender las reglas para entregar banderas y recibir puntos.  Vemos la lista est√°ndar: los inicios de sesi√≥n de administrador de dominio, los administradores locales, los administradores de intercambio y algunos otros administradores.  Desde el dominio, descargamos ntds.dit y al mismo tiempo preparamos nuestra estaci√≥n CUDA.  Luego descubrimos que el cifrado reversible es esto en el dominio, por lo que ahora podemos obtener todas las contrase√±as que necesitamos.  Para comprender qu√© contrase√±as necesitamos, formamos un equipo de 2 personas que comienzan a analizar la estructura del AD y sus grupos.  5 minutos despu√©s entregan los resultados.  Entregamos nuestras banderas y esperamos.  Ya era hora de obtener nuestra Primera Sangre, al menos para aumentar la moral del equipo si nada m√°s.  Pero nada  Nos llev√≥ una hora tratar de entender que el corrector funciona as√≠: <br><br><ul><li>  Es automatizado </li><li>  Tiene un formato muy inflexible. </li><li>  Si pasa sus banderas al cheque y no recibi√≥ una respuesta en unos segundos, entonces su formato no coincide con el formato del verificador </li></ul><br>  Finalmente, descubrimos el formato correcto y alrededor de las 11 de la ma√±ana tenemos nuestra Primera Sangre.  ¬°Uf! <br><br>  <b>11:15</b> <br><br>  El equipo 1 se est√° dividiendo en dos equipos secundarios.  El subteam 1 contin√∫a fortaleciendo el dominio: obtienen krbtgt, endurecen la l√≠nea de base, cambian las contrase√±as de los servicios de directorio.  Los organizadores de Standoff nos dijeron durante la sesi√≥n informativa que los primeros en el dominio pueden jugar como quieran.  As√≠ que cambiamos las contrase√±as de administrador para que, incluso si alguien entra y logra echarnos, no podr√°n obtener los inicios de sesi√≥n para entregar sus banderas por puntos. <br><br>  El equipo 2 contin√∫a investigando la estructura del dominio y encuentra otra bandera.  En el escritorio del CFO, encuentran un informe financiero.  Desafortunadamente, est√° comprimido y protegido con contrase√±a.  Entonces, encendemos la estaci√≥n CUDA.  Convertimos el zip en un hash y lo enviamos a hashcat. <br><br>  El Equipo 2 contin√∫a encontrando servicios interesantes con RCE (ejecuci√≥n remota de c√≥digo) y comienza a buscarlos.  Uno de ellos es un servicio de monitoreo para el dominio cf-media construido sobre la base de Nagios.  Otro es el administrador de horarios para una compa√±√≠a de env√≠o creada en torno a una tecnolog√≠a extra√±a que nunca antes hab√≠amos visto.  Tambi√©n hay algunos servicios interesantes, como los convertidores DOC a DPF. <br><br>  El segundo equipo del Equipo 1 para ese momento ya comenz√≥ a trabajar en el banco y encontr√≥ una base de datos interesante en MongoDB, que contiene, entre muchas otras cosas, el nombre de nuestro equipo y otros equipos, y sus saldos.  Cambiamos el saldo de nuestro equipo a 50 millones y seguimos adelante. <br><br>  <b>2 p.m.</b> <br><br>  La suerte nos ha dejado.  En primer lugar, los dos servicios para los que ten√≠amos RCE en los segmentos protegidos dejaron de estar disponibles.  El equipo azul simplemente los apag√≥.  Por supuesto, nos quejamos a los organizadores por violaciones a las reglas, pero sin efecto.  ¬°En el enfrentamiento no hay procesos comerciales que proteger!  En segundo lugar, no podemos encontrar una lista de clientes.  Sospechamos que est√° oculto en alg√∫n lugar en las profundidades de 1C, pero no tenemos bases de datos ni archivos de configuraci√≥n.  Callej√≥n sin salida. <br><br>  Estamos tratando de configurar el canal VPN entre nuestros servidores remotos y los Sistemas de Control Autom√°tico de Procesos (APCS).  Por alguna extra√±a raz√≥n, no lo hacemos en el controlador de dominio de bigbrogroup, y la conexi√≥n entre las interfaces se rompe.  Ahora el controlador de dominio no es accesible.  La parte del equipo responsable del acceso al dominio casi sufre un ataque al coraz√≥n.  La tensi√≥n entre los miembros del equipo crece, comienzan las huellas digitales. <br><br>  Entonces nos damos cuenta de que el controlador de dominio es accesible, pero la conexi√≥n VPN es inestable.  Retrocedemos cuidadosamente en nuestros pasos, a trav√©s de RDP apagamos la VPN, y listo, el controlador de dominio es accesible nuevamente.  El equipo exhala colectivamente.  Al final, configuramos la VPN desde otro servidor.  El controlador de dominio est√° siendo maltratado y mimado.  Todos los equipos competidores todav√≠a tienen 0 puntos, y esto es tranquilizador. <br><br>  <b>16:50</b> <br><br>  Los organizadores finalmente publican un minero.  Usando psexec lo configuramos en todos los puntos finales que controlamos.  Esto trae un poco de flujo constante de ingresos. <br><br>  El equipo 2 todav√≠a est√° trabajando en la vulnerabilidad de Nagios.  Tienen la versi√≥n con la vulnerabilidad. <br>  &lt;= 5.5.6 CVE-2018-15710 CVE-2018-15708.  Hay un exploit p√∫blico disponible, pero necesita una conexi√≥n inversa para descargar el shell web.  Como estamos detr√°s del NAT, tenemos que reescribir el exploit y dividirlo en dos partes.  La primera parte obliga a Nagios a conectarse a nuestro servidor remoto a trav√©s de Internet, y la segunda parte, ubicada en el servidor, le da a Nagios el shell web.  Esto nos da acceso a trav√©s del proxy al dominio cf-media.  Pero la conexi√≥n es inestable y dif√≠cil de usar, por lo que decidimos vender el exploit por los d√≥lares de BugBounty, al mismo tiempo que tratamos de elevar nuestro acceso a la ra√≠z. <br><br>  <b>18:07</b> <br><br>  Aqu√≠ vienen las "sorpresas" prometidas por los organizadores.  Anuncian que BigBroGroup acaba de comprar CF-media.  No estamos terriblemente sorprendidos.  Durante nuestra investigaci√≥n del dominio bigbrogroup, notamos las relaciones de confianza entre los dominios bigbrogroup y cf-media. <br><br>  En el momento en que se anunci√≥ la adquisici√≥n de los medios CF, a√∫n no ten√≠amos conexi√≥n a su red.  Pero despu√©s del anuncio, apareci√≥ el acceso.  Esto nos salv√≥ de girar nuestras ruedas tratando de pivotar desde Nagios.  Las credenciales de Bigbrogroup funcionan en el dominio cf-media, pero los usuarios no tienen privilegios.  Todav√≠a no se encuentran vulnerabilidades f√°cilmente explotables, pero somos bastante optimistas de que algo aparecer√°. <br><br>  <b>18:30</b> <br><br>  De repente, nos expulsan del dominio de bigbrogroup.  Por quien?  Como?  ¬°Parece que el equipo TSARKA es el culpable!  Est√°n cambiando la contrase√±a de administrador, pero tenemos otras 4 cuentas de administrador en las reservas.  Cambiamos la contrase√±a de administrador de dominio nuevamente, restablecemos todas las contrase√±as.  ¬°Pero minutos despu√©s nos echan de nuevo!  En ese momento exacto, encontramos un vector para el dominio cf-media.  En uno de sus servidores, el nombre de usuario y la contrase√±a coinciden con los que encontramos anteriormente en el dominio bigbrogroup.  ¬°Oh, contrase√±a reutilizada!  ¬øQu√© har√≠amos sin ti?  Ahora solo necesitamos un hash.  Usamos hashkiller y obtenemos la contrase√±a P @ ssw0rd.  Siguiendo adelante. <br><br>  <b>19:00</b> <br><br>  La lucha por el control del bidbrogroup se est√° convirtiendo en un problema grave.  TSARKA ha cambiado la contrase√±a a krbtgt dos veces, perdemos todas las cuentas de administrador ... ¬øqu√© sigue?  Callej√≥n sin salida? <br><br>  <b>19:30</b> <br><br>  Finalmente obtenemos los privilegios de administrador de dominio en cf-media y comenzamos a activar nuestras banderas.  A pesar de que se supone que este es un dominio seguro, vemos encriptaci√≥n reversible.  Entonces, ahora tenemos los inicios de sesi√≥n y las contrase√±as, y procedemos a trav√©s de los mismos pasos que con el bigbrogroup.  Creamos administradores adicionales, fortalecemos nuestro punto de apoyo, fortalecemos la l√≠nea de base, cambiamos las contrase√±as, creamos una conexi√≥n VPN.  Encontramos un segundo informe financiero, tambi√©n como un zip protegido.  Verificamos con el equipo responsable del primer informe.  Lo han logrado, pero los organizadores no lo aceptar√°n.  Resulta que ten√≠a que ser entregado como un 7zip protegido.  Por lo tanto, ¬°ni siquiera tuvimos que usarlo en bruto!  3 horas de trabajo por nada. <br><br>  Entregamos ambos informes como archivos 7zip protegidos.  Nuestro saldo total hasta ahora es de 1 mill√≥n de puntos, y TSARKA tiene 125,000, y est√°n comenzando a entregar sus banderas del dominio de bigbrogroup.  Nos damos cuenta de que debemos evitar que entreguen sus banderas, pero ¬øc√≥mo? <br><br>  <b>19:30</b> <br><br>  ¬°Encontramos una soluci√≥n!  Todav√≠a tenemos las credenciales de los administradores locales.  Iniciamos sesi√≥n, tomamos el ticket y simplemente apagamos el controlador de dominio.  El controlador se est√° apagando.  Cerramos todos los puertos del servidor excepto RDP y cambiamos las contrase√±as de todos nuestros administradores locales.  Ahora estamos en nuestro peque√±o espacio y ellos est√°n en el suyo.  ¬°Ojal√° la conexi√≥n VPN se mantuviera estable!  El equipo exhala colectivamente. <br><br>  Mientras tanto, configuramos mineros en todos los puntos finales en el dominio cf-media.  TSARKA est√° por delante de nosotros en el volumen general, pero no estamos muy lejos y tenemos m√°s caballos de fuerza. <br><br><h3>  Noche </h3><br>  Aqu√≠ puedes ver los cambios que hicimos en el equipo durante la noche. <br><br><img src="https://habrastorage.org/webt/yq/ou/m6/yqoum6x109nwggvjzj8cuvbynkm.jpeg" alt="imagen"><br><br>  Algunos de los miembros del equipo tienen que irse a pasar la noche.  A medianoche, tenemos 9 personas.  La productividad cae a casi cero.  Cada hora nos levantamos para mojarnos la cara con agua y salir para tomar aire, solo para sacudirnos la somnolencia. <br><br>  Ahora, por fin, estamos llegando a los Sistemas Automatizados de Control de Procesos (APCS) <br><br>  <b>02.00</b> <br><br>  Las √∫ltimas horas han sido muy desalentadoras.  Hemos encontrado varios vectores, pero ya est√°n cerrados.  No podemos decir si estaban cerrados para empezar o si TSARKA ya ha estado aqu√≠.  Estudiando lentamente el APCS, encontramos un controlador NetBus vulnerable.  Usamos un m√≥dulo metasploit que no entendemos completamente c√≥mo funciona.  De repente, las luces de la ciudad se apagan.  Los organizadores anuncian que contar√°n esto si podemos volver a encender la luz.  En ese momento, nuestra VPN se cae.  ¬°El servidor que administra la VPN fue asumido por TSARKA!  Parece que est√°bamos discutiendo el APCS demasiado fuerte y lograron hacerse cargo. <br><br>  <b>03.30</b> <br><br>  Incluso los m√°s dedicados de nosotros est√°n empezando a quedarse dormidos.  Solo 7 siguen trabajando.  De repente, sin ninguna explicaci√≥n, la VPN vuelve a encenderse.  ¬°Repetimos r√°pidamente el truco con las luces de la ciudad, y vemos que nuestro saldo aumenta en 200,000 puntos! <br><br>  Una parte del equipo todav√≠a est√° buscando vectores adicionales, mientras que otra est√° trabajando en el APCS.  All√≠ encontramos dos vulnerabilidades adicionales.  Uno de ellos podemos explotar.  Pero el resultado del exploit podr√≠a ser una reescritura del firmware del microcontrolador.  Discutimos esto con los organizadores y decidimos que esperaremos a que el resto de nuestro equipo se una a nosotros por la ma√±ana y luego decidamos colectivamente qu√© hacer. <br><br>  <b>05:30</b> <br><br>  Nuestra VPN funciona aproximadamente 10 minutos cada hora, y luego se desconecta nuevamente.  Dentro de ese tiempo, tratamos de trabajar.  Pero la productividad es cercana a cero.  Finalmente, decidimos tomar una hora cada una para tomar una siesta.  Alerta de spoiler: ¬°mala idea! <br><br>  5 personas siguen trabajando en el APCS. <br><br><h3>  Ma√±ana </h3><br>  Por la ma√±ana, de repente nos damos cuenta de que estamos por delante de otros equipos en casi 1 mill√≥n de puntos.  TSARKA pudo entregar dos banderas de APCS, adem√°s de varias banderas del proveedor de telecomunicaciones y bigbrogroup.  Adem√°s, tienen mineros trabajando, y deben tener algunas criptomonedas que a√∫n no han entregado.  Estimamos que ten√≠an un m√≠nimo de 200-300 mil puntos m√°s en criptograf√≠a.  Esto es desconcertante.  Tenemos la sensaci√≥n de que podr√≠an tener algunas banderas m√°s que est√°n reteniendo estrat√©gicamente hasta las √∫ltimas horas.  Pero nuestro equipo vuelve a estar en l√≠nea.  La prueba de sonido de la ma√±ana en la arena principal es un poco molesta pero ahuyenta el sue√±o. <br><br>  Todav√≠a estamos trabajando para intentar entrar en el APCS, pero la esperanza est√° disminuyendo.  La diferencia en los puntos entre el primer y el segundo equipo y el resto de los equipos es gigantesca.  Nos preocupa que los organizadores decidan lanzar algunas "sorpresas" m√°s para sacudir las cosas. <br><br>  Despu√©s de una conferencia de prensa conjunta con TSARKA en la arena principal, decidimos cambiar nuestra estrategia de "obtener m√°s banderas" para "evitar que TSARKA entregue m√°s banderas". <br><br>  En uno de nuestros servidores, activamos Cain &amp; Abel y redirigimos todo el tr√°fico a nuestro servidor.  Encontramos algunas VPN de Kazajst√°n y las matamos.  Luego decidimos eliminar todo el tr√°fico en todas partes, por lo que creamos un firewall local en el canal VPN para eliminar todo el tr√°fico dentro de la red APCS.  ¬°As√≠ es como proteges un APCS!  Los organizadores ahora se quejan de que perdieron la conexi√≥n con el APCS.  Abrimos el acceso a sus direcciones IP (NO es as√≠ como protege el APCS). <br><br>  <b>12:47</b> <br><br>  Ten√≠amos raz√≥n al preocuparnos de que los organizadores intentaran sacudir las cosas.  De la nada, hay un volcado de datos que contiene 4 inicios de sesi√≥n para cada dominio.  Movilizamos a todo el equipo. <br><br>  Objetivos: <br>  <b>Equipo 1</b> : asume de inmediato todos los segmentos protegidos. <br>  <b>Equipo 2</b> : use Outlook Web Access para cambiar todas las contrase√±as a los inicios de sesi√≥n. <br><br>  Algunos equipos azules, que perciben mucha actividad, simplemente apagan la VPN.  Otros son m√°s enga√±osos y cambian el idioma del sistema al chino.  T√©cnicamente, el servicio a√∫n est√° activo.  Pero, por supuesto, en la pr√°ctica, no es utilizable (organizadores, ¬°presten atenci√≥n!).  A trav√©s de VPN podemos conectarnos a 3 de las redes.  En uno de ellos, solo duramos 1 minuto antes de ser expulsados. <br><br><img src="https://habrastorage.org/webt/oi/ye/pn/oiyepn0gyyoym85skosi30bm9gc.jpeg" alt="imagen"><br><br>  <b>12:52</b> <br><br>  Localizamos un servidor saludable con la vulnerabilidad MS17-010 (¬øsupuestamente un segmento protegido?).  Lo explotamos r√°pidamente, sin encontrar resistencia.  Obtenemos el hash del administrador de dominio y a trav√©s de Pth accedemos al controlador de dominio.  ¬øY adivina qu√© encontramos all√≠?  Encriptaci√≥n reversible! <br><br>  Quien estaba protegiendo ese segmento no ha hecho su tarea.  Recopilamos todas las banderas, excepto la parte relacionada con 1C.  Existe una buena posibilidad de que lo consigamos si pasamos otros 30-40 minutos all√≠, pero decidimos simplemente apagar el controlador de dominio saludable.  ¬øQui√©n necesita competencia? <br><br>  <b>13:20</b> <br><br>  Entregamos nuestras banderas.  Ahora tenemos 2,900,000 puntos, m√°s algunas recompensas de errores pendientes.  TSARKA tiene un poco m√°s de 1 mill√≥n.  Entregan su criptomoneda y obtienen otros 200,000.  Ahora estamos bastante seguros de que no podr√°n ponerse al d√≠a, ser√≠a casi imposible. <br><br>  <b>13:55</b> <br><br>  La gente viene y nos felicita.  Todav√≠a estamos preocupados por alguna sorpresa de los organizadores, ¬°pero parece que realmente estamos siendo anunciados como los ganadores! <br><br>  Esta es la cr√≥nica de las 28 horas de True0xA3.  Por supuesto, me sal√≠ mucho.  Por ejemplo, las conferencias de prensa en la arena, la tortura que fueron el Wifi y el GSM, la interacci√≥n con los reporteros ... pero espero haber capturado los momentos m√°s interesantes. <br><br>  Esta fue una de las experiencias m√°s elevadas para nuestro equipo, y espero haber podido darte al menos un poco de idea de c√≥mo se siente la atm√≥sfera del Standoff, y para motivarte a que intentes participar tambi√©n. ! <br><br>  A continuaci√≥n, publicar√© la √∫ltima parte de esta serie, donde analizar√© nuestros errores y las formas de corregirlos en el futuro.  Porque aprender sobre los errores de otra persona es el mejor tipo de aprendizaje, ¬øverdad? </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/462205/">https://habr.com/ru/post/462205/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../462185/index.html">La revoluci√≥n ha terminado. ¬øExiste una alternativa a una bater√≠a de iones de litio?</a></li>
<li><a href="../462189/index.html">Grabado de datos con travajs</a></li>
<li><a href="../462191/index.html">DataArt Museum: un recorrido por el norte de Italia</a></li>
<li><a href="../462197/index.html">Consejos sobre c√≥mo liberar tu mente y aumentar tu creatividad</a></li>
<li><a href="../462203/index.html">KVM (bajo) VDI con m√°quinas virtuales √∫nicas que usan bash</a></li>
<li><a href="../462209/index.html">Soluciones de videoconferencia de Polycom. Recuerdos 6 a√±os despu√©s ... Etapa 2. Parte 1. RMX1500</a></li>
<li><a href="../462213/index.html">Aprender y trabajar: la experiencia de los estudiantes universitarios en la facultad de tecnolog√≠a de la informaci√≥n y programaci√≥n.</a></li>
<li><a href="../462221/index.html">Qu√© decepcionado estoy en Google Play</a></li>
<li><a href="../462227/index.html">Mosc√∫, 9 de agosto - Backend Stories 4.0</a></li>
<li><a href="../462243/index.html">Mejora del rendimiento front-end de Magento con ReactJS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>