<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö∂üèª üöµüèæ üë¥üèº ¬øC√≥mo escribir la direcci√≥n de la casa correctamente? üöπ ‚úåüèæ ‚õπÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="C√≥mo Servicio de Impuestos, OpenStreetMap e InterSystems IRIS 
 podr√≠a ayudar a los desarrolladores a obtener direcciones limpias 

 Pieter Brueghel e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>¬øC√≥mo escribir la direcci√≥n de la casa correctamente?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446376/"><h3>  C√≥mo Servicio de Impuestos, OpenStreetMap e InterSystems IRIS <br>  podr√≠a ayudar a los desarrolladores a obtener direcciones limpias </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/60d/d11/8ee/60dd118eefedf8b71edb40b5adcfcb77.jpg" alt="imagen"><br>  <i>Pieter Brueghel el Joven, <b>pagando el impuesto</b> (El recaudador de impuestos), 1640</i> <br><br>  En mi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo anterior</a> , acabamos de rozar la superficie de los objetos.  Continuemos nuestro reconocimiento.  El tema de hoy es dif√≠cil.  No son GRANDES DATOS, pero a√∫n as√≠ no es f√°cil trabajar con los datos: estamos hablando de cantidades bastante grandes de datos.  No encajar√° todo en la memoria RAM a la vez, y algunos de ellos ni siquiera encajar√°n en la unidad (no por falta de espacio, sino porque hay mucha basura).  El nombre de nuestro sujeto es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">FIAS DB</a> : la base de datos del Sistema de Direcciones de Informaci√≥n Federal, las bases de datos de direcciones en Rusia.  El archivo es de 5,5 GB.  Y es un archivo XML comprimido.  Despu√©s de la extracci√≥n, ser√° un total de 53 GB (reserve 110 GB para la extracci√≥n).  Y cuando comienzas a analizarlo y convertirlo, esos 110 GB no ser√°n suficientes.  Tampoco habr√° suficiente RAM. <br><a name="habracut"></a><br>  Eso estar√≠a bien, pero puedes seguir cavando.  Ya existe un proyecto internacional de c√≥digo abierto para recopilar y sistematizar datos de direcciones: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">OpenAddresses</a> .  Sus bases de datos ser√°n a√∫n m√°s grandes.  Actualmente hay muchos puntos en blanco en sus mapas.  Rusia, por ejemplo, est√° casi vac√≠a.  El tama√±o de este archivo es de 10 GB. <br><br>  Pero lo primero es lo primero, consideramos la base de datos del proyecto bastante conocido <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">OpenStreetMaps</a> .  Est√° construido por voluntarios, siguiendo el ejemplo de Wikipedia.  Es bastante completo y multiling√ºe.  Y el proyecto acaba de recibir el premio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">The Free Software Foundation 2018</a> .  En este momento, el tama√±o de todo el archivo comprimido como archivo XML comprimido es de 74 GB. <br><br>  Hablando de direcciones, he recibido <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">noticias</a> inesperadas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de DuckDuckGo</a> , el mejor motor de b√∫squeda seguro hasta la fecha anunci√≥ su traslado a Apple Maps.  M√°s precisamente, a Apple MapKit JS.  Lo m√°s interesante de esto para nuestros prop√≥sitos es la "b√∫squeda mejorada de direcciones".  ¬øApple es mejor que todos los dem√°s para recopilar y proteger meticulosamente nuestros datos?  Tendremos que estar atentos ... <br><br>  Entonces, aqu√≠ est√° el desaf√≠o.  ¬øC√≥mo podemos poner todos estos datos de direcciones en un repositorio f√°cil de usar, hacer posible imaginar una API f√°cil (en Python, por supuesto) y evitar que nuestro querido hardware se derrumbe bajo esta carga masiva?  Llamemos a esto MicroBigData, mD o ¬µBD para abreviar. <br><br>  Casi todos los desarrolladores han escuchado el siguiente comentario.  Un directorio de direcciones es un directorio de nombres de lugares, que es algo muy √∫til.  No s√© exactamente cu√°ntos datos de la direcci√≥n de sus proyectos est√°n actualizados.  Despu√©s de todo, hay tantas regiones, ciudades y calles.  Pero parece que son necesarios para cualquier proyecto que involucre personas.  Hay direcciones donde puede encontrar a alguien o enviarle un paquete.  Luego est√° la informaci√≥n necesaria para los pasaportes y otros documentos.  Y quiz√°s haya una direcci√≥n de alguna oficina o punto de referencia que alguien le haya recomendado.  Entonces, ¬øqu√© deber√≠as hacer?  ¬øD√≥nde deber√≠as conseguirlo? <br><br>  Sin tener en cuenta los errores y los duplicados, la soluci√≥n m√°s simple involucra objetos primitivos que contienen literales de cadena simples (o constantes de cadena).  Permita que los usuarios hagan entradas adicionales.  Y los objetos saben c√≥mo salvarse, como hemos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cubierto antes</a> . <br><br>  Tome los objetos descritos en la clase a continuaci√≥n como ejemplo.  <a href="">Un caso de libro de texto</a> , aunque en forma de una direcci√≥n de EE. UU., Pero con un ajuste para nuestro conjunto de datos ruso: c√≥digo postal en lugar de ZIP.  Tambi√©n cambiar√≠a el c√≥digo postal a un n√∫mero, pero lo dejar√© como una cadena para mantener las cosas uniformes.  Cualquiera que haya reconocido el lenguaje (ObjectScript) de inmediato recibir√° un "me gusta" complementario. <br><br><pre><code class="plaintext hljs">Class Sample.Address Extends %Persistent { Property streetName As %String; Property cityName As %String; Property areaName As %String; Property postalCode As %String; }</code> </pre> <br>  Por supuesto, muchas personas llorar√°n mal, diciendo que todos los literales sobresalen del objeto.  ¬øQui√©n ha o√≠do hablar de un objeto que transmite p√∫blicamente sus campos?  Dej√©moslo as√≠ por ahora.  Es un ejemplo bastante elocuente, y cualquier estudiante podr√≠a entenderlo. <br><br>  En realidad, eso es todo lo que necesitamos.  Completamos los campos.  Los almacen√©.  Se los entreg√≥ a otros objetos.  Alguien m√°s los heredar√°.  Todo funciona  ¬°Y est√° almacenado! <br><br><blockquote>  Pero tengo que decir algunas palabras sobre por qu√© no deber√≠a hacerse de esta manera.  ¬øCu√°l es nuestra direcci√≥n de objeto?  ¬øPor qu√© no puede ser solo un grupo de cadenas de texto?  Las objeciones m√°s obvias que surgen provienen del contexto: ¬øqui√©n est√° usando esta direcci√≥n, en qu√© forma la est√°n usando y con qu√© prop√≥sito?  Intente poner a un lado la l√≥gica de su programador e imagine c√≥mo piensa un "turista extranjero", "historiador", "recaudador de impuestos" o "abogado". <br><br>  Supongo que inmediatamente surgi√≥ una serie de preguntas adicionales: qu√© idioma y codificaci√≥n usar, qu√© per√≠odo de tiempo considerar y qu√© tipo de documentos est√°n involucrados en esta operaci√≥n: ¬ølegal o postal?  Y una ciudad: ¬øes esa una localidad con nombre, o qu√©?  Incluso una calle podr√≠a ser un bulevar, un carril, una avenida o algo m√°s.  ¬øC√≥mo deben manejarse todos estos detalles importantes? <br><br>  Veamos un ejemplo de la vida real.  Google ahora est√° dirigido por Sundar Pichai.  El es de la India.  Naci√≥ en la ciudad de Chennai.  ¬øO es Madras?  En 1996, los residentes decidieron que el nombre de la ciudad sonaba demasiado portugu√©s y cambiaron el nombre de la capital del estado de Tamil Nadu de Madras a Chennai.  Entonces, ¬øqu√© deber√≠an ingresar Sundar y sus 72 millones de compatriotas en sus documentos electr√≥nicos? <br><br>  De hecho, hay toda una ciencia que estudia esto: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la toponimia aplicada</a> . </blockquote>  Entonces, hay algunas preguntas de seguimiento.  ¬øC√≥mo deben manejarse la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hora y la fecha</a> ?  ¬øQu√© pasa con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">lo obvio, el dinero</a> ?  O coordenadas geogr√°ficas?  ¬øY c√≥mo debe implementar esto en su c√≥digo?  ¬øY podr√° transferirlo a su DBMS de elecci√≥n sin reducir la capa de abstracci√≥n?  ¬øC√≥mo evita la espiral descendente hacia tipos at√≥micos de datos de m√°quinas y pensamientos constantes sobre su reconstrucci√≥n?  En este caso, vale la pena buscar la fuente de una API primitiva o, por el contrario, de buena calidad.  Piensa en esto a tu antojo. <br><br>  En resumen, el contexto es lo m√°s importante.  Y el modelo de objetos nos permite utilizarlo directamente encapsulando "datos de m√°quina" e implementando un comportamiento "real" dependiente del contexto.  No es que las tuplas de bajo nivel est√©n organizadas en tablas ;-) <br><br>  Mientras tanto, volveremos a la implementaci√≥n "primitiva" y haremos las cosas m√°s dif√≠ciles para nosotros.  Para comenzar, eliminaremos errores y duplicados.  En otras palabras, buscaremos una forma de escribir direcciones correctamente la primera vez.  Al mismo tiempo, ayudaremos a los desarrolladores de IU a proporcionar sugerencias para los usuarios cuando ingresen datos en los campos. <br><blockquote>  Cuando hay dos cosas en un solo lugar: textos y la plataforma de datos IRIS de InterSystems, un desarrollador tiene una oportunidad real de cambiar las cosas sin alejarse de la m√°quina.  Mediante el uso de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">los componentes de objetos integrados iKnow e iFind</a> , por ejemplo.  Estos componentes est√°n dise√±ados para trabajar con datos no estructurados y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">b√∫squeda de texto completo</a> , respectivamente. </blockquote>  Intentemos encontrar el esquema de datos para OpenStreetMap.  No es tan f√°cil como podr√≠a parecer al principio.  No s√© la raz√≥n exacta, pero no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hay un esquema de datos para OSM</a> .  ¬°Y nos ayudar√≠a mucho, como se ver√° a continuaci√≥n!  Y eso no volver√≠a a inventar la rueda, use un <a href="">XSD adecuado</a> , que encontr√© para usted.  Y gracias, Oliver Schrenk.  <a href="">Aqu√≠ hay m√°s fotos</a> .  Debo decir que para nuestros prop√≥sitos es adecuado y corresponde a la estructura interna de los archivos XML y las descargas de OSM.  Por qu√© es importante, pero la primera l√≠nea del archivo XSD debe comenzar con "&lt;? Xml ...". <br><br>  Los elementos son los componentes b√°sicos del modelo de datos conceptuales del mundo f√≠sico de OpenStreetMap.  Consisten en <br><br><ul><li>  nodos - definiendo puntos en el espacio, </li><li>  formas: definir caracter√≠sticas lineales y l√≠mites de √°rea, y </li><li>  relaciones, que a veces se utilizan para explicar c√≥mo otros elementos trabajan juntos. </li></ul><br>  Todo lo anterior puede tener una o m√°s etiquetas asociadas (que describen el significado de un elemento en particular).  Una etiqueta consta de dos elementos, una clave y un valor.  Las etiquetas describen caracter√≠sticas espec√≠ficas de los elementos del mapa: nodos, formas o relaciones. <br><br>  ¬øD√≥nde est√°n las calles y las ciudades?  Es un gran secreto!  La geometr√≠a fue bien ense√±ada?  M√°s sobre esto la pr√≥xima vez.  :) <br><br>  Adem√°s, utilizaremos el asistente de esquema XSD, creado gentilmente por los desarrolladores de IRIS, para la clase% XML apropiada. Campos del adaptador.  El signo de porcentaje al principio solo significa que esta es una clase de la biblioteca del sistema.  <a href="">Se puede encontrar m√°s informaci√≥n al respecto en la documentaci√≥n</a> .  Realizaremos las operaciones en la terminal. <br><br><pre> <code class="plaintext hljs">set xmlSchema = ##class(%XML.Utils.SchemaReader).%New() do xmlSchema.Process("/path/to/OSMSchema.xsd")</code> </pre> <br>  Puede obtener lo mismo de <a href="">Atelier IDE</a> (en el men√∫, vaya a Herramientas&gt; Complementos&gt; Asistente de esquema XML): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/881/3a6/6d1/8813a66d16d498f4ae0d07446df14c23.png" alt="imagen"><br><br>  Como utilizamos el asistente indicando el nombre del paquete resultante y no los par√°metros, terminaron en el paquete de prueba.  Como puede ver en el segundo comando, pas√© el archivo de esquema a mi servidor Python local: <br><br><pre> <code class="python hljs">python3 -m http.server <span class="hljs-number"><span class="hljs-number">80</span></span></code> </pre> <br>  Puede usar cualquier otro servidor http que desee.  O cargue el archivo en su servidor IRIS y ap√∫ntelo. <br><br>  Como resultado, tenemos ocho clases que reflejan completamente la estructura de nuestra direcci√≥n XML.  Esta es la clase principal OSM.osm: <br><br><pre> <code class="plaintext hljs">Class OSM.osm Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "osm"; Parameter XMLSEQUENCE = 1; Property bounds As OSM.bounds(XMLNAME = "bounds", XMLREF = 1) [ Required ]; Relationship node As OSM.node(XMLNAME = "node", XMLPROJECTION = "ELEMENT", XMLREF = 1) [ Cardinality = many, Inverse = osm ]; Relationship way As OSM.way(XMLNAME = "way", XMLPROJECTION = "ELEMENT", XMLREF = 1) [ Cardinality = many, Inverse = osm1 ]; Relationship relation As OSM.relation(XMLNAME = "relation", XMLPROJECTION = "ELEMENT", XMLREF = 1) [ Cardinality = many, Inverse = osm2 ]; Property version As %xsd.float(XMLNAME = "version", XMLPROJECTION = "ATTRIBUTE") [ InitialExpression = ".6", ReadOnly ]; Property generator As %String(MAXLEN = "", XMLNAME = "generator", XMLPROJECTION = "ATTRIBUTE") [ InitialExpression = "CGImap 0.0.2", ReadOnly ]; }</code> </pre> <br>  Y OSM.node: <br><br><pre> <code class="plaintext hljs">Class OSM.node Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "node"; Parameter XMLSEQUENCE = 1; Relationship tag As OSM.tag(XMLNAME = "tag", XMLPROJECTION = "ELEMENT", XMLREF = 1) [ Cardinality = many, Inverse = node ]; Property id As %xsd.unsignedLong(XMLNAME = "id", XMLPROJECTION = "ATTRIBUTE"); Property lat As %xsd.double(XMLNAME = "lat", XMLPROJECTION = "ATTRIBUTE"); Property lon As %xsd.double(XMLNAME = "lon", XMLPROJECTION = "ATTRIBUTE"); Property user As %String(MAXLEN = "", XMLNAME = "user", XMLPROJECTION = "ATTRIBUTE") [ SqlFieldName = _user ]; Property uid As %xsd.unsignedLong(XMLNAME = "uid", XMLPROJECTION = "ATTRIBUTE"); Property visible As %Boolean(XMLNAME = "visible", XMLPROJECTION = "ATTRIBUTE"); Property version As %xsd.unsignedLong(XMLNAME = "version", XMLPROJECTION = "ATTRIBUTE"); Property changeset As %xsd.unsignedLong(XMLNAME = "changeset", XMLPROJECTION = "ATTRIBUTE"); Property timestamp As %TimeStamp(XMLNAME = "timestamp", XMLPROJECTION = "ATTRIBUTE"); Relationship osm As OSM.osm(XMLPROJECTION = "NONE") [ Cardinality = one, Inverse = node ]; }</code> </pre> <br>  Como puede ver, algunas de las opciones que ya he desactivado son innecesarias para nuestra soluci√≥n. <br><br>  El tama√±o del archivo XML solo para Rusia es de aproximadamente 53 GB.  No puede abrirlo con las herramientas habituales de procesamiento de texto: no pueden soportar archivos tan grandes.  Puede tomar muestras m√°s peque√±as para hacer ejercicio, por ejemplo, las direcciones de Rusia est√°n disponibles para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">los territorios individuales</a> .  El peque√±o volumen de la regi√≥n de Kaliningrado en formato comprimido ser√° de 18 MB, el archivo XML sin comprimir es de 203 MB. <br><blockquote>  Por cierto, la longitud m√°xima de un literal de cadena en InterSystems IRIS es 3.641.144 caracteres.  En otras palabras, cargar un archivo o URL directamente en √©l no funcionar√°.  Puede ver los otros l√≠mites <a href="">en la documentaci√≥n</a> .  Para trabajar con grandes cantidades de datos, puede usar flujos de datos que no tengan restricciones de longitud. </blockquote>  Veamos qu√© obtenemos para el conjunto de nodos. <br><br>  A continuaci√≥n, haremos las cosas <a href="https://docs.intersystems.com/irislatest/csp/docbook/DocBook.UI.Page.cls?KEY=GXML_import#GXML_import_">seg√∫n el libro</a> .  Crearemos un objeto que entienda XML como lenguaje nativo usando una clase de la biblioteca del sistema% XML.Reader: <br><br><pre> <code class="plaintext hljs">set reader = ##class(%XML.Reader).%New()</code> </pre><br>  Le daremos instrucciones sobre qu√© llevar e ignoraremos el resto.  Tomaremos una sola clase: <br><br><pre> <code class="plaintext hljs">do reader.Correlate("node","OSM.node")</code> </pre><br>  Despu√©s de eso, hay varias formas de obtener el archivo mBD original.  Si es conveniente, puede colocarlo junto al repositorio de almacenamiento, localmente en el sistema de archivos del servidor IRIS.  O, como en mi ejemplo, solicite que se env√≠e a trav√©s de HTTP.  Tambi√©n hay una opci√≥n m√°s universal, de la que hablar√© un poco m√°s abajo. <br><br><pre> <code class="plaintext hljs">set url="http://localhost/kaliningrad-latest.osm" write reader.OpenUrl(url)</code> </pre><br><blockquote>  Importante!  En este punto, la mayor√≠a de las personas que prueben este ejemplo por s√≠ mismas encontrar√°n algo horrible.  En lugar de un feliz "1" (todo est√° bien), el sistema devolver√° algo que comienza con "0, STORE ..." Y eso ser√° decepcionante.  En otras palabras, el archivo con lo que parece ser mBD result√≥ no ser tan micro y no se ajusta a nuestro objeto.  No hab√≠a suficiente memoria asignada.  ¬øSe puede arreglar esto?  Absolutamente  La plataforma de datos IRIS le permite crear objetos de hasta 4 TB en RAM.  Entonces, ¬øqu√© sali√≥ mal?  Por defecto, el tama√±o de un objeto es de 256 MB en la configuraci√≥n del sistema.  Pero necesitamos mucho m√°s que eso.  Y recuerde, estos son requisitos de RAM.  ¬øTiene suficiente espacio en su computadora / servidor? </blockquote>  Experiment√© para determinar la cantidad de memoria que necesitaremos para alojar a este gigante: casi 170 GB.  Esto deber√° especificarse en la configuraci√≥n (Men√∫&gt; Configurar memoria&gt; Capacidad m√°xima de memoria por proceso (KB)) o mediante <a href="">la variable del sistema $ ZSTORAGE</a> (en kilobytes): <br><br><pre> <code class="plaintext hljs">set $ZSTORAGE=170000000</code> </pre><br>  ¬øEjecut√≥ un nuevo proceso con la configuraci√≥n de memoria correcta?  Entonces la siguiente parte es f√°cil: solo leemos y guardamos. <br><br>  Tambi√©n hay una opci√≥n alternativa (y probablemente preferible): <a href="">use la propiedad UsePPG Handler</a> de la clase% XML. Reader, que le permite no almacenar el XML en la memoria y funciona con la configuraci√≥n de memoria est√°ndar. <br><br><pre> <code class="plaintext hljs">set reader = ##class(%XML.Reader).%New() set reader.UsePPGHandler = 1</code> </pre><br>  Siguiente ... Correlacionar / Leer, etc.  ... <br><br><pre> <code class="plaintext hljs">do reader.Next(.object) do object.%Save()</code> </pre><br>  Y as√≠ sucesivamente, 1.180.849 veces por cada operaci√≥n :-) Es tedioso.  Es por eso que agregaremos nuestro m√©todo de clase OSM.map para importar, basado en los mismos comandos: <br><br><pre> <code class="plaintext hljs">ClassMethod Import(url) { Set reader = ##class(%XML.Reader).%New() Set reader.UsePPGHandler = 1 Set status = reader.OpenURL(url) Do reader.Correlate("node","OSM.node") While (reader.Next(.object)) { Do object.%Save() } //back to top of XML file Do reader.Rewind() Do reader.Correlate("way","OSM.way") While (reader.Next(.object)) { Do object.%Save() } Do reader.Rewind() Do reader.Correlate("relation","OSM.relation") While (reader.Next(.object)) { Do object.%Save() } }</code> </pre><br>  Utilizaremos el poder del exocortex de nuestra computadora con solo un comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en la terminal</a> : <br><br><pre> <code class="plaintext hljs">do ##class(OSM.osm).Import("http://localhost/kaliningrad-latest.osm")</code> </pre><br>  Y as√≠, obtenemos los datos de la direcci√≥n de forma abierta y quiz√°s no sea una fuente muy confiable.  Es hora de pasar por las mismas etapas, pero en los datos en los que se puede confiar.  Y tambi√©n estandarizado, limpio, bien documentado y realizado por el organismo gubernamental adecuado: eso es cosa de leyendas.  Para su cr√©dito, el servicio de impuestos ruso est√° haciendo un buen trabajo con su producto digital.  En la medida en que sea posible un buen trabajo.  Sin duda, tiene sus defectos, y la limpieza de datos est√° en curso.  En cuanto a c√≥mo podemos resolver esto, dejemos que los l√≠deres del gobierno reflexionen sobre eso.  Est√°n tomando decisiones por s√≠ mismos que nos benefician a todos. <br><br>  Y ahora vamos a lo m√°s incomprensible: le ense√±aremos a Address a leer los datos correctos de nuestra fuente.  Afortunadamente, el conjunto de datos del servicio de impuestos federales tiene descripciones listas para la estructura del documento XML.  De acuerdo con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la descripci√≥n del sitio web de FIAS</a> que acompa√±a a los datos, necesitaremos el conjunto de datos ADDROBJ que, en mi caso, corresponde al archivo AS_ADDROBJ_2_250_01_04_01_01.xsd <br><br>  A continuaci√≥n, usemos el asistente de esquema XSD.  Realizaremos las operaciones en la terminal: <br><br><pre> <code class="plaintext hljs">set xmlScheme = ##class(%XML.Utils.SchemaReader).%New() do xmlScheme.Process("/path/to/AS_ADDROBJ_2_250_01_04_01_01.xsd")</code> </pre><br>  Como resultado, tenemos dos clases que reflejan completamente la estructura de nuestra direcci√≥n XML: <br><br>  Test.AddressObjects <br><br><pre> <code class="plaintext hljs">/// Composition and structure of the file with classifier information for FIAS DB elements in address form Class Test.AddressObjects Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "AddressObjects"; Parameter XMLSEQUENCE = 1; /// Classifier for elements in address form Relationship Object As Test.Object(XMLNAME = "Object", XMLPROJECTION = "ELEMENT") [ Cardinality = many, Inverse = AddressObjects ]; }</code> </pre><br>  Test.object <br><br><pre> <code class="plaintext hljs">/// Created from: http://localhost:28869/AS_ADDROBJ_2_250_01_04_01_01.xsd Class Test.Object Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "Object"; Parameter XMLSEQUENCE = 1; /// Global unique identifier of the address object Property AOGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOGUID", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Formal name Property FORMALNAME As %String(MAXLEN = 120, MINLEN = 1, XMLNAME = "FORMALNAME", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Region code Property REGIONCODE As %String(MAXLEN = 2, MINLEN = 2, XMLNAME = "REGIONCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Autonomy code Property AUTOCODE As %String(MAXLEN = 1, MINLEN = 1, XMLNAME = "AUTOCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Area code Property AREACODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "AREACODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// City code Property CITYCODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "CITYCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Code of area within city Property CTARCODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "CTARCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Locality code Property PLACECODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "PLACECODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Planning structure element code Property PLANCODE As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "PLANCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Street code Property STREETCODE As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "STREETCODE", XMLPROJECTION = "ATTRIBUTE"); /// Code of additional element in address form Property EXTRCODE As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "EXTRCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Code of subordinate additional element in address form Property SEXTCODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "SEXTCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Official name Property OFFNAME As %String(MAXLEN = 120, MINLEN = 1, XMLNAME = "OFFNAME", XMLPROJECTION = "ATTRIBUTE"); /// Postal code Property POSTALCODE As %String(MAXLEN = 6, MINLEN = 6, XMLNAME = "POSTALCODE", XMLPROJECTION = "ATTRIBUTE"); /// Federal Tax Service - Private Individual code Property IFNSFL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "IFNSFL", XMLPROJECTION = "ATTRIBUTE"); /// Federal Tax Service - Private Individual territorial district code Property TERRIFNSFL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "TERRIFNSFL", XMLPROJECTION = "ATTRIBUTE"); /// Federal Tax Service - Legal Entity code Property IFNSUL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "IFNSUL", XMLPROJECTION = "ATTRIBUTE"); /// Federal Tax Service - Legal Entity territorial district code Property TERRIFNSUL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "TERRIFNSUL", XMLPROJECTION = "ATTRIBUTE"); /// Russian Classification on Objects of Administrative Division Property OKATO As %String(MAXLEN = 11, MINLEN = 11, XMLNAME = "OKATO", XMLPROJECTION = "ATTRIBUTE"); /// Russian Classification of Territories of Municipal Formations Property OKTMO As %String(MAXLEN = 11, MINLEN = 8, XMLNAME = "OKTMO", XMLPROJECTION = "ATTRIBUTE"); /// Date of record entry Property UPDATEDATE As %Date(XMLNAME = "UPDATEDATE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Short name of object type Property SHORTNAME As %String(MAXLEN = 10, MINLEN = 1, XMLNAME = "SHORTNAME", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Address object level Property AOLEVEL As %Integer(XMLNAME = "AOLEVEL", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; /// Object identifier of the parent object Property PARENTGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "PARENTGUID", XMLPROJECTION = "ATTRIBUTE"); /// Unique record identifier. Key field. Property AOID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOID", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Record identifier associated with previous historical record Property PREVID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "PREVID", XMLPROJECTION = "ATTRIBUTE"); /// Record identifier associated with next historical record Property NEXTID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "NEXTID", XMLPROJECTION = "ATTRIBUTE"); /// Address object code in one string with validity indicator from Russian Classifier of Addresses (KLADR) 4.0. Property CODE As %String(MAXLEN = 17, MINLEN = 0, XMLNAME = "CODE", XMLPROJECTION = "ATTRIBUTE"); /// Address object code from KLADR 4.0 in one string without validity indicator (last two digits) Property PLAINCODE As %String(MAXLEN = 15, MINLEN = 0, XMLNAME = "PLAINCODE", XMLPROJECTION = "ATTRIBUTE"); /// Validity status of FIAS address object. Current address as of today's date. Usually the last entry about the address object. /// 0 - Not current /// 1 - Current Property ACTSTATUS As %Integer(XMLNAME = "ACTSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; /// Center status Property CENTSTATUS As %Integer(XMLNAME = "CENTSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; /// Operation status on record - reason for record's appearance (see description of OperationStatus table): /// 01 ‚Äì Activation; /// 10 ‚Äì Addition; /// 20 ‚Äì Change; /// 21 ‚Äì Group change; /// 30 ‚Äì Deletion; /// 31 - Deletion due to the deletion of the parent object; /// 40 ‚Äì Attachment of the address object (merger); /// 41 ‚Äì Reassignment due to the merger of the parent object; /// 42 - Termination due to the attachment to another address object; /// 43 - Creation of a new address object due to a merger of address objects; /// 50 ‚Äì Reassignment; /// 51 ‚Äì Reassignment due to the reassignment of the parent object; /// 60 ‚Äì Termination due to segmentation; /// 61 ‚Äì Creation of a new address object due to segmentation Property OPERSTATUS As %Integer(XMLNAME = "OPERSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; /// KLADR 4 validity status (last two digits in the code) Property CURRSTATUS As %Integer(XMLNAME = "CURRSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; /// Start of record operation Property STARTDATE As %Date(XMLNAME = "STARTDATE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// End of record operation Property ENDDATE As %Date(XMLNAME = "ENDDATE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Foreign key to requirements document Property NORMDOC As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "NORMDOC", XMLPROJECTION = "ATTRIBUTE"); /// Current address object indicator Property LIVESTATUS As %xsd.byte(VALUELIST = ",0,1", XMLNAME = "LIVESTATUS", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Address type: /// 0 - not defined /// 1 - municipal; /// 2 - administrative/territorial Property DIVTYPE As %xsd.int(VALUELIST = ",0,1,2", XMLNAME = "DIVTYPE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; Relationship AddressObjects As Test.AddressObjects(XMLPROJECTION = "NONE") [ Cardinality = one, Inverse = Object ]; }</code> </pre><br>  Fuera de la lista completa de archivos XML en FIAS, solo usaremos el archivo con los nombres de regiones, ciudades y calles.  Cuando me estaba preparando para la publicaci√≥n, ten√≠a este: <br><br><pre> <code class="plaintext hljs">AS_ADDROBJ_20190106_90809714-fe22-45b2-929c-52bd950963e0.XML</code> </pre> <br><br>  Cocinemos un poco de pimienta rellena de FIAS.  Esto es solo preparaci√≥n para un gran futuro por delante.  Primero, obtendremos el conjunto m√≠nimo inicial.  Estos son los √∫nicos ingredientes que necesitaremos: <br><br><pre> <code class="plaintext hljs">Class FIAS.AddressObject Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "Object"; Parameter XMLSEQUENCE = 1; /// Global unique identifier of the address object Property AOGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOGUID", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Official name Property OFFNAME As %String(MAXLEN = 120, MINLEN = 1, XMLNAME = "OFFNAME", XMLPROJECTION = "ATTRIBUTE"); /// Postal code Property POSTALCODE As %String(MAXLEN = 6, MINLEN = 6, XMLNAME = "POSTALCODE", XMLPROJECTION = "ATTRIBUTE"); /// Short name of object type Property SHORTNAME As %String(MAXLEN = 10, MINLEN = 1, XMLNAME = "SHORTNAME", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Address object level Property AOLEVEL As %Integer(XMLNAME = "AOLEVEL", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; /// Object identifier of the parent object Property PARENTGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "PARENTGUID", XMLPROJECTION = "ATTRIBUTE"); /// Unique record identifier. Key field. Property AOID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOID", XMLPROJECTION = "ATTRIBUTE") [ Required ]; }</code> </pre><br>  Crearemos un objeto que entienda XML como lenguaje nativo usando una clase de la biblioteca del sistema% XML.Reader: <br><br><pre> <code class="plaintext hljs">set reader = ##class(%XML.Reader).%New()</code> </pre> <br>  Le daremos instrucciones sobre a qui√©n tomar y le diremos que ignore el resto.  Tomaremos una sola porci√≥n para la prueba. <br><br>  Siguiente ... Correlacionar / Leer, etc.  ... <br><br><pre> <code class="plaintext hljs">do reader.Correlate("Object","FIAS.AddressObject") set url="http://localhost/AS_ADDROBJ_20190106_90809714-fe22-45b2-929c-52bd950963e0.XML" write reader.OpenUrl(url)</code> </pre><br>  Entonces la siguiente parte es f√°cil: solo leemos y guardamos. <br><br><pre> <code class="plaintext hljs">do reader.Next(.object) do object.%Save()</code> </pre><br>  Y as√≠ sucesivamente, 3.722.548 veces por cada operaci√≥n :-) <br><br>  Es a√∫n m√°s agotador que antes.  Es por eso que agregaremos nuestro m√©todo de clase FIAS.AddressObject para importar, basado en los mismos comandos: <br><br><pre> <code class="plaintext hljs">ClassMethod Import() { // Create object to read XML Set reader = ##class(%XML.Reader).%New() // Get source XML for parsing Set status = reader.OpenURL("http://localhost/AS_ADDROBJ_20190106_90809714-fe22-45b2-929c-52bd950963e0.XML") If $$$ISERR(status) {Do $System.Status.DisplayError(status)} // Join object with the right sample structure Do reader.Correlate("Object","FIAS.AddressObject") // Read and save the object in storage While (reader.Next(.object,.status)) { Set status = object.%Save() If $$$ISERR(status) {do $System.Status.DisplayError(status)} } // If an error occurs during parsing, display a message If $$$ISERR(status) {Do $System.Status.DisplayError(status) }</code> </pre><br>  Utilizaremos el poder del exocortex de nuestra computadora con solo un comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en la terminal</a> : <br><br><pre> <code class="plaintext hljs">do ##class(FIAS.AddressObject).Import()</code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/acb/18e/6c0/acb18e6c0f1e4d524accb97686a6b63a.gif" alt="imagen"><br><br>  La cena est√° lista, todos.  Era mBD, y ahora es un plato terminado, global con los nombres verificados de las ciudades rusas. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2d3/abb/06a/2d3abb06a70886fd8338fe747e72d9d6.png" alt="imagen"><br><br>  Y, finalmente, algunas palabras sobre qu√© hacer cuando 4 TB no son suficientes.  En ese caso, <a href="">usamos las transmisiones</a> .  Todo se presenta en la documentaci√≥n.  Puedes usar binarios o caracteres.  Almacenar en un global tambi√©n es posible.  Aqu√≠ est√° la receta: tome la corriente, c√≥rtela en pedazos y as√≠gnela a los objetos que necesitamos para el consumo. <br><br>  Aqu√≠ no hab√≠a suficiente espacio para obtener m√°s informaci√≥n sobre los encantadores objetos ObjectScript de direcciones y la API de Python.  Esa ser√° otra historia. <br><blockquote>  Buenas noticias: Gartner acaba de completar su colecci√≥n anual de valoraciones y comentarios de usuarios reales en la categor√≠a de DBMS y utiliz√≥ esta informaci√≥n para publicar su clasificaci√≥n de los mejores DBMS de 2019. InterSystems Cach√© e InterSystems IRIS Data Platform recibieron la calificaci√≥n m√°s alta para "Clientes "Elecci√≥n".  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Puede consultar</a> qu√© productos se consideraron y c√≥mo se calificaron. </blockquote>  El mejor software de sistemas de gesti√≥n de bases de datos operacionales de 2019 seg√∫n lo revisado por los clientes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d01/201/bfc/d01201bfc7d9afa6d4fe0c3638117cd6.png" alt="imagen"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/446376/">https://habr.com/ru/post/446376/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../446362/index.html">3 cualidades clave para un gerente de producto exitoso: Dmitry Orlov, gerente senior de producto</a></li>
<li><a href="../446364/index.html">Bromas y referencias de Los Simpson en ingl√©s para explicar</a></li>
<li><a href="../446366/index.html">ZX Spectrum 128k h√°galo usted mismo. Parte 2</a></li>
<li><a href="../446370/index.html">"Bueno, de nuevo, la estaci√≥n meteorol√≥gica"? No realmente</a></li>
<li><a href="../446372/index.html">Misiones de amor, ama y encuentra tus datos personales en p√∫blico</a></li>
<li><a href="../446378/index.html">El problema de cambiar al horario de invierno y verano para una sola escuela de Skype</a></li>
<li><a href="../446380/index.html">H2 evolution: funciones de ventana, CTE, JSON / XML en una base de datos integrada</a></li>
<li><a href="../446384/index.html">Consejos para desarrollar proyectos muy grandes en Revit</a></li>
<li><a href="../446388/index.html">La industria del petr√≥leo y el gas como ejemplo para los sistemas de nubes perif√©ricas.</a></li>
<li><a href="../446390/index.html">Memoization nomeolvides bomba</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>