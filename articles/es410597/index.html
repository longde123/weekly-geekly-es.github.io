<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçüî¨ ü§òüèø üë®‚Äçüëß Otro dispositivo inteligente para el hogar üêØ üìÖ üë∂üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Entrada 
 Al estar involucrado en la automatizaci√≥n del hogar durante los √∫ltimos tres a√±os, trato de hacer un seguimiento de todos los dispositivos n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Otro dispositivo inteligente para el hogar</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/410597/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/b8/7e/rp/b87erppacywqripfkc5as0cvpxu.png"></div><br><h3>  Entrada </h3><br>  Al estar involucrado en la automatizaci√≥n del hogar durante los √∫ltimos tres a√±os, trato de hacer un seguimiento de todos los dispositivos nuevos en esta √°rea.  Recientemente, la exposici√≥n llam√≥ la atenci√≥n de un nuevo dispositivo de producci√≥n nacional.  Despu√©s de buscar en Internet, no encontr√© ninguna informaci√≥n sobre ellos.  Pens√© extra√±amente y decid√≠ contactar al fabricante (no lo indicar√©).  Despu√©s de hablar, logr√© obtener una muestra de prueba durante un mes.  Un mes despu√©s, decid√≠ compartir mis impresiones sobre este producto. <br><br><h3>  Descripci√≥n del fabricante </h3><br>  Seg√∫n el fabricante, el dispositivo en estudio es una plataforma que le permite crear sistemas automatizados para monitorear y administrar instalaciones de infraestructura.  La plataforma le permite desarrollar sistemas centralizados y distribuidos, incluida la conexi√≥n de cualquier dispositivo inteligente, y las caracter√≠sticas funcionales del sistema est√°n determinadas por el software instalado. <br><br>  El fabricante declara las siguientes caracter√≠sticas del dispositivo: <br><a name="habracut"></a><table><tbody><tr><td>  CPU </td><td>  ‚Ä¢ CPU: Allwinner H5, Quad-core 64-bit Cortex A53 <br>  ‚Ä¢ RAM: 1 GB <br>  ‚Ä¢ Almacenamiento: 8 GB eMMC, tarjeta MicroSD </td></tr><tr><td>  Sistema operativo </td><td>  ‚Ä¢ Linux Debian o Ubuntu </td></tr><tr><td>  Comunicaciones </td><td>  ‚Ä¢ Red: Ethernet Gbps <br>  ‚Ä¢ WiFi: 802.11b / g / n <br>  ‚Ä¢ Bluetooth: modo dual 4.0 <br>  ‚Ä¢ Radio: 2.4 GHz <br>  ‚Ä¢ 2 x host USB <br>  ‚Ä¢ 1 x RS485 </td></tr><tr><td>  Puertos de entrada / salida </td><td>  ‚Ä¢ 4 contactos "secos" 350 v / 120mA <br>  ‚Ä¢ 4 salidas 12 v / 1A <br>  ‚Ä¢ 4 entradas 0 - 12 v </td></tr><tr><td>  Indicaci√≥n de estado </td><td>  ‚Ä¢ pantalla OLED <br>  ‚Ä¢ LED </td></tr><tr><td>  Nutrici√≥n </td><td>  ‚Ä¢ DC 12 v </td></tr></tbody></table><br><h3>  Preparamos al cliente <br></h3><br>  El dispositivo viene en dos versiones: solo metal desnudo y una soluci√≥n preparada con software.  Tengo la primera opci√≥n, pero a√∫n m√°s interesante: hay d√≥nde divertirse con la fantas√≠a. <br><br>  La apariencia del dispositivo es bastante asc√©tica: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b8/7e/rp/b87erppacywqripfkc5as0cvpxu.png"></div><br>  La caja del dispositivo permite el montaje en un gabinete en un riel DIN y ocupa cuatro m√≥dulos de ancho. <br><br>  En el panel frontal son: <br><br><ul><li>  exhibir </li><li>  cuatro botones </li><li>  Indicador LED del estado del dispositivo ("rojo" - deshabilitado, "verde" - se suministra energ√≠a, "azul" - indica actividad del procesador); </li></ul><br>  Debajo de las cubiertas se encuentran: <br><br><ul><li>  Conectores de E / S (a primera vista me pareci√≥ que su n√∫mero puede ser insuficiente, pero comentar√© este momento un poco m√°s bajo); </li><li>  Interfaz RS485 </li><li>  conexi√≥n de corriente. </li></ul><br>  Todos los conectores son herm√©ticos, lo que me hizo feliz porque no me gusta la sujeci√≥n.  No hay conectores ni controles en el lado derecho de la caja, lo que en general puede ser √∫til para una instalaci√≥n m√°s ajustada del equipo en el gabinete. <br><br>  Todos los conectores est√°n montados en el lado izquierdo: <br><br><ul><li>  antena WiFi extra√≠ble; </li><li>  2 USB; </li><li>  1 Eth </li><li>  conector de audio </li></ul><br>  La antena WiFi interfiere con la conexi√≥n de dispositivos USB y el cable de red.  Debe ser rechazado o llevado al frente del gabinete con un cable, la segunda opci√≥n es probablemente m√°s correcta, mejorando as√≠ el nivel de se√±al. <br><br>  Procedemos a la "apertura del paciente" (todo el caso est√° montado en pestillos, no es dif√≠cil desmontarlo) y vemos en qu√© consiste dentro / Abra la cubierta frontal y vea: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ka/j4/d4/kaj4d4omm3_z-78fnhmpqiv5ws4.png"></div><br><ul><li>  Pantalla OLED SSD1306 (128x64px): la pantalla es ciertamente peque√±a, pero puede obtener informaci√≥n m√≠nima; </li><li>  Cuatro botones para el control local del dispositivo, a juzgar por la designaci√≥n, para controlar la salida de informaci√≥n en la pantalla; </li><li>  Bot√≥n de administraci√≥n de energ√≠a (como ATtiny13 descubri√≥ m√°s tarde para la administraci√≥n de energ√≠a); </li><li>  LED RGB </li><li>  Debajo de la inscripci√≥n est√° la antena del m√≥dulo de radio. </li></ul><br>  Vamos m√°s all√°: abrimos la carcasa y vemos que el dispositivo consta de tres placas: la placa principal, la placa del procesador est√° unida a ella y la placa "superior", cuyo lado frontal se describe anteriormente, est√° conectado mediante un cable.  Los examinamos m√°s de cerca: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lt/ty/hz/lttyhznbz7tcf5yn8dzppnqxjtc.png"></div><br><br><ul><li>  El m√≥dulo procesador es una computadora de placa √∫nica NanoPi NEO Plus2.  No demasiado publicitado OBC, pero muy interesante desde un punto de vista t√©cnico.  Puedes leer sobre esto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gp/3p/x-/gp3px-m9pebjgkevd2dnqi-fsbm.png"></div><br>  En el tablero principal se encuentra: <br><br><ul><li>  Protecci√≥n contra la inversi√≥n de polaridad (pensamos en "protecci√≥n contra los tontos" ya no est√° mal); </li><li>  El convertidor DC-DC en el XL4005E1 5A, contento de que no perdieron el potente diodo Schottky (12A), pero la bobina est√° enrollada con un cable delgado: 3A tirar√°, pero ya no lo cargar√≠a, los pol√≠gonos de enfriamiento del convertidor est√°n hechos en la parte posterior del tablero, que agrega confianza en el trabajo (el convertidor de ATtiny13 est√° controlado); </li><li>  El resto de los detalles se incluyen en esquemas est√°ndar: el regulador de voltaje AMS 1117 para 3.3 v, el extensor MCP23017, el SP3485 para organizar la interfaz RS485, el ADC ADS1115 de 16 bits, la presencia del sensor de presi√≥n atmosf√©rica BMP180 sorprendi√≥ gratamente. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qk/iw/r_/qkiwr_vhzvpuc6l9aii7ovcb6u0.png"></div><br>  En el reverso de la placa "superior" est√°n instalados: <br><br><ul><li>  M√≥dulo RTC DS3231; </li><li>  PCF8574 expansor de puerto responsable de procesar clics de bot√≥n; </li><li>  M√≥dulo de radio nRF24L01P con amplificador. </li></ul><br><h3>  Uso y Programaci√≥n </h3><br>  Como ya dije, obtuve el metal desnudo y tuve que verificar el funcionamiento de los m√≥dulos y crear guiones yo mismo.  No filosof√≥, Armbian tom√≥ el ensamblaje de Linux e hizo toda la programaci√≥n en Python: ¬°r√°pido, barato y alegre!  Todos los microcircuitos son bien conocidos por una amplia gama de entusiastas de la radioafici√≥n; encontrar una descripci√≥n y m√©todos b√°sicos de uso no ser√° dif√≠cil. <br><br>  Despu√©s de estudiar el dispositivo, se form√≥ una lista aproximada de tareas: <br><br><ol><li>  Conecte los contactores 220v a trav√©s de las salidas de los contactos "secos".  (Obtenga l√≠neas el√©ctricas controlables) </li><li>  A dos salidas de 12v / 1A y dos entradas se conectan sensores est√°ndar de seguridad e incendio.  (Obtenga un sistema de seguridad e incendio, sin acceso al control remoto, pero esto a menudo no es necesario). </li><li>  Con√©ctese a entradas y salidas libres, sensores de fugas y v√°lvulas de bola con accionamiento el√©ctrico de 12 v.  (Obtenga protecci√≥n contra fugas). </li><li>  Levante el servidor WEB y escriba una interfaz de administraci√≥n (Obtenga control remoto). </li><li>  Verifique la conexi√≥n por radio, WiFi y RS485 de dispositivos adicionales (verifique la posibilidad de construir una red distribuida). </li><li>  Verifique el funcionamiento del m√≥dem USB. </li><li>  Verifique el funcionamiento como un enrutador. </li></ol><br><img src="https://habrastorage.org/webt/zc/za/cu/zczacu4t1wrx2kogetbvn3kx53u.png"><br><br>  Para las pruebas, ensambl√© r√°pidamente un soporte y comenc√© a divertirme: <br><br>  ATtiny13 ya ha sido programado, no lo toqu√©, deje que sea responsable de la fuente de alimentaci√≥n de acuerdo con el plan del fabricante. <br><br>  MCP23017, ADS1115, PCF8574, DS3231, BMP180: todo esto funciona de acuerdo con I2C, por lo que la comprensi√≥n del funcionamiento de este bus determina de inmediato alrededor del 80% del c√≥digo.  Todo comenz√≥ (como se esperaba), ya que el fabricante ya ha configurado el direccionamiento de los dispositivos. <br><br>  nRF24L01P se ejecuta en el bus SPI, ejemplos de los cuales tambi√©n son suficientes.  Me puse en contacto con un par de dispositivos en Arduino, todo funciona seg√∫n lo previsto. <br><br>  El RS485 se prob√≥ en el protocolo Modbus con un medidor de potencia Eastron SDM220.  Se toman lecturas, no han surgido sorpresas. <br><br>  El conector USB en el m√≥dem Huawei E1550 determin√≥ todo, tom√≥ el cliente vpn y contact√≥ al servidor dom√©stico.  Instal√© un servidor web y jugu√© con control remoto. <br><br>  El m√≥dulo WiFi funciona tanto en modo cliente como en modo de punto de acceso.  Puso el m√≥dulo en modo AP, instal√≥ un servidor DHCP, configur√≥ iptables y recibi√≥ un enrutador WiFi. <br><br>  La instalaci√≥n de un servidor Blynk local no caus√≥ problemas.  Trabajo comprobado con ESP8266.  El control del tel√©fono inteligente est√° funcionando, se muestran las lecturas. <br><br>  Entonces, todas las tareas se han completado, ¬°se ha lanzado el dispositivo central de la casa inteligente!  Puede parecer que todo est√° programado, configurado de forma f√°cil y sencilla, o soy un genio. <br><br>  ¬°Te aseguro que esto no es as√≠!  Ya he encontrado la mayor√≠a de los microcircuitos y m√≥dulos, as√≠ que pis√© un rastrillo antes y me dol√≠a mucho la frente ÔÅä, pero los golpes pasaron, ¬°pero el conocimiento permaneci√≥! <br><br>  La potencia del m√≥dulo del procesador es m√°s que suficiente para resolver mis tareas, durante la prueba, la carga promedio en el procesador no super√≥ el 15%.  La presencia de memoria eMMC y tarjetas MicroSD permitir√° la duplicaci√≥n de sistemas operativos y software.  El consumo sin conectar dispositivos USB es de aproximadamente 300 mA.  Con este tipo de consumo, no ser√° dif√≠cil organizar una fuente de alimentaci√≥n ininterrumpida de una bater√≠a de horas para 5 trabajos. <br><br>  La base de elementos seleccionada para construir perif√©ricos es bastante confiable, lo que da confianza en el funcionamiento sin problemas del dispositivo en modo 24x7. <br><br>  La presencia de un peque√±o n√∫mero de entradas y salidas en el dispositivo se compensa por completo con la presencia de un bus 485 y un m√≥dulo de radio, es decir, construir un sistema de control distribuido no ser√° muy dif√≠cil, y el conjunto de entradas y salidas que se encuentran a bordo se puede utilizar para el control local en el gabinete de alimentaci√≥n. <br><br><h3>  Conclusiones </h3><br>  ¬øEste dispositivo, declarado por el fabricante, integrar√° todos los dispositivos inteligentes?  Con un estiramiento, puede decir que lo har√°.  Pero desafortunadamente, no hay suficiente m√≥dulo de radio para 433 MHz, CAN-bus, soporte ZigBee, pero la presencia de RS485, m√≥dulo de radio a 2.4 GHz y WiFi permitir√° conectar una cantidad suficiente de dispositivos, y los protocolos de comunicaci√≥n se pueden implementar en el software. <br><br>  Repito, el dispositivo en cuesti√≥n est√° hecho en dos versiones: una soluci√≥n completamente preparada para construir un sistema de control distribuido y solo hardware.  En mi opini√≥n, una soluci√≥n preparada solo se puede comprar si no quieres lidiar con la programaci√≥n y la pereza.  En otros casos, es mucho m√°s interesante tomar la plataforma y programarla usted mismo. <br><br>  El costo del dispositivo es actualmente desconocido para m√≠.  En mi opini√≥n, si el fabricante no maneja el precio de m√°s de 13 tr.  para la versi√≥n "desnuda", este dispositivo es bastante interesante de comprar.  Despu√©s de haber comprado todas las piezas en China y ponerlas en un solo paquete, es poco probable que se vuelva m√°s barato. <br><br>  Un competidor puede ser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Wiren Board 5</a> .  Gana en el n√∫mero de puertos y posibles interfaces, pero pierde la potencia del m√≥dulo del procesador.  Esto no afecta las tareas est√°ndar, pero instalar un servidor Blynk localmente o crear un m√≥dulo de control de voz puede ser problem√°tico.  Si alguien intent√≥ hacer esto en WB5, comente en los comentarios. <br><br>  <b>PD:</b> Despu√©s de terminar el art√≠culo, tambi√©n encontr√© el chip de criptograf√≠a ATSHA204 en el tablero.  Es compatible con el algoritmo criptogr√°fico SHA - 256 y es ideal para tareas de autenticaci√≥n sim√©trica.  Bueno, esto es absolutamente para los Geeks! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es410597/">https://habr.com/ru/post/es410597/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es410585/index.html">C√≥mo convertirte en un mago (parte 1)</a></li>
<li><a href="../es410587/index.html">Apple tiene la intenci√≥n de comprar cobalto exclusivamente de compa√±√≠as mineras</a></li>
<li><a href="../es410589/index.html">Ecosistemas marinos capaces de adaptarse al calentamiento global</a></li>
<li><a href="../es410591/index.html">La historia emocional de los procesadores para las primeras computadoras de los a√±os 70 a principios de los 90</a></li>
<li><a href="../es410593/index.html">Telegram lleva a cabo otra ronda de ICO</a></li>
<li><a href="../es410599/index.html">Una ola de robos de equipos de granjas mineras se extendi√≥ por Islandia</a></li>
<li><a href="../es410601/index.html">¬øQu√© es la rob√≥tica educativa hoy?</a></li>
<li><a href="../es410603/index.html">Manifiesto de propiedad</a></li>
<li><a href="../es410605/index.html">Astr√≥nomo aficionado prob√≥ una nueva c√°mara y fotografi√≥ accidentalmente una supernova</a></li>
<li><a href="../es410607/index.html">SpaceX contin√∫a funcionando: los dos primeros sat√©lites de la red mundial inal√°mbrica de Internet y la b√∫squeda de carenados</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>