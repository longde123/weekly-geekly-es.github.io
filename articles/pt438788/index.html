<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë∂üèª üÜï üßòüèæ Monitoramento ambiental na sala do servidor (Bolid + Zabbix) üë©üèø‚Äçü§ù‚Äçüë©üèª ü§¶üèª ü§òüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Provavelmente, a maneira mais f√°cil para um profissional de TI resolver o problema de monitoramento ambiental na sala de servidores √© usar controlador...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Monitoramento ambiental na sala do servidor (Bolid + Zabbix)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438788/">  Provavelmente, a maneira mais f√°cil para um profissional de TI resolver o problema de monitoramento ambiental na sala de servidores √© usar controladores especializados com sa√≠da SNMP (por exemplo, NetBotz ou NetPing).  Mas para aqueles que n√£o t√™m medo de dificuldades e desejam obter uma solu√ß√£o econ√¥mica de n√≠vel industrial (com produ√ß√£o em s√©rie de equipamentos) - existe uma op√ß√£o interessante com o protocolo Modbus. <br><br><img src="https://habrastorage.org/webt/wu/uc/mi/wuucmi1fiyi7sglvrsekrvey0pk.png"><br><a name="habracut"></a><br>  Abaixo, descreverei um sistema de monitoramento baseado em componentes fabricados na R√∫ssia - NVP Bolid, e ‚Äúmesclaremos‚Äù os dados no Zabbix 4.0.  O NVP "Bolid" √© amplamente conhecido nos c√≠rculos de equipamentos de automa√ß√£o de combate a inc√™ndio e a solu√ß√£o considerada ter√° essa "impress√£o".  Seus dispositivos, para dizer o m√≠nimo, n√£o diferem no design e considera√ß√£o dos casos, mas ... o pre√ßo mais do que compensa todas essas defici√™ncias.  Vale a pena notar uma documenta√ß√£o muito boa e suporte t√©cnico gratuito mais ou menos normal. <br><br><h2>  Protocolos e Interfaces </h2><br>  Antes de passar para o hardware, veremos brevemente os protocolos e interfaces usados: <br><br>  <b>Modbus</b> : um protocolo industrial constru√≠do no princ√≠pio de "Master" - "Slave".  S√≥ pode haver um mestre em uma rede Modbus que pesquisa os escravos e "diz" o que fazer.  Como meio de transmiss√£o, ele pode usar a interface RS-485 (Modbus RTU) ou Ethernet (Modbus TCP).  Teoricamente, o n√∫mero m√°ximo de dispositivos √© 247. <br><br>  <b>Orion</b> : protocolo propriet√°rio da empresa NVP "Bolid", baseado no princ√≠pio de "Master" (Master) - "Slave" (Slave).  Aparentemente, a interface RS-485 modificada √© usada como meio de transmiss√£o de dados, devido ao qual o comprimento m√°ximo da linha pode atingir 3 km (!).  O n√∫mero m√°ximo de dispositivos √© 127. <br><br>  <b>DLS</b> (linha de comunica√ß√£o de dois fios): protocolo propriet√°rio da empresa NVP "Bolid", baseado no princ√≠pio de "Master" - "Slave" (Master).  Ele usa um cabo de par de cobre como meio de transmiss√£o de dados (recomenda-se cabo de par tran√ßado).  O n√∫mero m√°ximo de dispositivos √© 127 + 1.  Topologia - um barramento (ou anel) com ramifica√ß√µes, o comprimento m√°ximo da linha pode chegar a 1,5 km (dependendo do tipo de cabo, se√ß√£o transversal dos condutores de cabos e n√∫mero de dispositivos conectados). <br><br>  <b>RS-485</b> : interface da camada f√≠sica, usa "par tran√ßado" (um par de "dois fios" ou dois "quatro fios" para transmiss√£o de dados, o segundo √© menos comum).  O comprimento m√°ximo declarado da linha √© de 1,2 km.  Topologia √© um √¥nibus. <br><br>  Como voc√™ pode ver, linhas de comunica√ß√£o bastante "de longo alcance" s√£o usadas.  Em todos os protocolos, o endere√ßamento do dispositivo √© definido por "al√ßas" (pr√©-configura√ß√£o). <br><br><h2>  Sensores </h2><br>  O sistema envolve a conex√£o de sensores de endere√ßo "especiais" (propriet√°rios) (para ser mais estritamente "detectores", ou seja, dispositivos com um sensor embutido), mas voc√™ tamb√©m pode conectar um endere√ßo n√£o "comum" usando expansores de endere√ßo (de 1 a 8 entradas).  O uso de detectores endere√ß√°veis ‚Äã‚Äãoferece duas vantagens: quase todos os dispositivos endere√ß√°veis ‚Äã‚Äãrecebem energia atrav√©s da linha de sinal (ou seja, n√£o √© necess√°rio fornecer uma linha de energia 12V separada) e n√£o √© necess√°rio colocar o expansor de endere√ßo em qualquer lugar.  Os sensores est√£o conectados ao <abbr title="linha de comunica√ß√£o de dois fios">DPS</abbr> . <br>  A gama de equipamentos "terminais" √© bastante ampla, mas darei o que pode ser necess√°rio para solucionar nosso problema: <br><br><ul><li>  S2000-VT - sensor combinado de temperatura e umidade para uso interno (IP41).  Possui um certificado de instrumento de medi√ß√£o, o erro √© de apenas 0,5 ¬∞ C e o pre√ßo de varejo recomendado de apenas 1200 rublos! </li><li>  S2000-SMK (e suas varia√ß√µes) - sensor de ‚Äúporta aberta‚Äù (detector de contato magn√©tico, chave reed).  Pre√ßo de venda recomendado - 300 rublos. </li><li>  S2000-DZ - sensor de ponto de inunda√ß√£o (feito em conjunto com Realty, portanto, o caso √© "n√£o formatado").  Pre√ßo de venda recomendado - 800 rublos. </li><li>  2000-1, 2000-2, 2000-8 - expansores de endere√ßo para conex√µes 1, 2 e 8, podem ser usados ‚Äã‚Äãcomo "receptores" de sinais do tipo "contato seco" (ligar / desligar) de outro equipamento (por exemplo, de um dispositivo de extin√ß√£o de inc√™ndio ou bombas de ar condicionado); </li><li>  S2000-SP2 - bloco de rel√©s (para 2 sa√≠das), com o qual voc√™ pode controlar dispositivos (por exemplo, uma l√¢mpada de alarme - um indicador luminoso).  Pre√ßo de venda recomendado - 1200 rublos. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Apar√™ncia dos sensores</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/wy/ff/2k/wyff2kk8bfwz0bcq5feyh-kvja4.png"><br><br></div></div><br>  Para uma lista completa de equipamentos, consulte o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site oficial do fabricante</a> . <br><br><h2>  Controlador </h2><br>  A "linha" de controladores, se assim posso dizer, consiste em tr√™s modelos: <br><br><ul><li>  S2000-KDL - modelo b√°sico (a designa√ß√£o significa "Sistema 2000 - Controlador de uma linha de comunica√ß√£o de dois fios"); </li><li>  S2000-KDL-2I - isolamento galv√¢nico adicionado para RS-485 e DPS; </li><li>  S2000-KDL-Modbus - um conversor de protocolo Modbus S2000-PP foi adicionado ao projeto S2000-KDL-2I. </li></ul><br><div class="spoiler">  <b class="spoiler_title">A apar√™ncia dos controladores</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/gw/wu/nb/gwwunbbgi8jsdrp4lirdesxxoyi.png"><br></div></div><br>  √â mais ideal usar o S2000-KDL-Modbus, mas tamb√©m √© poss√≠vel usar o S2000-KDL / C2000-KDL-2I com o conversor de protocolo S2000-PP instalado nas proximidades, que possui um design de caixa montado em painel. <br><br>  O controlador desempenha o papel de "L√≠der" na linha <abbr title="linha de comunica√ß√£o de dois fios">DLS</abbr> (apenas uma linha DPS pode ser conectada a um controlador) e na linha Orion RS-485 j√° atua como "Escravo" e n√£o ser√° poss√≠vel coletar dados "diretamente".  Para coletar dados na linha RS-485 Orion, s√£o usados ‚Äã‚Äãos chamados console 2000 ou 2000- (incluindo a vers√£o incorporada), que j√° possuem interfaces de transfer√™ncia de dados padronizadas. <br><br>  Os seguintes controladores tamb√©m podem distinguir as seguintes caracter√≠sticas: <br><br><ul><li>  referir-se a um tipo configur√°vel, n√£o program√°vel (ou seja, voc√™ s√≥ precisa configurar os par√¢metros e n√£o desenvolver um programa); </li><li>  suporte em <abbr title="linha de comunica√ß√£o de dois fios">DPSs de</abbr> at√© 127 dispositivos endere√ß√°veis ‚Äã‚Äã(o S2000-VT possui dois endere√ßos) e muitos comiss√°rios n√£o recomendam o uso de mais de 100-110; </li><li>  entrada dupla para fonte de alimenta√ß√£o DC 12-24V; </li><li>  design do gabinete n√£o muito conveniente (todos os fios conectados n√£o podem ser ocultados no gabinete do dispositivo e voc√™ deve remov√™-los da parte traseira do dispositivo). </li></ul><br>  Para toler√¢ncia a falhas do sistema, voc√™ pode usar as seguintes medidas (que s√£o opcionais): <br><br><ul><li>  loop de anel - uma quebra de loop em um s√≥ lugar n√£o afeta a presen√ßa de sinais de sensores endere√ß√°veis; </li><li>  o uso de blocos de isolamento de ramifica√ß√£o (BRIZ) - permite fazer ramifica√ß√µes radiais, bem como isolar o segmento de loop, no qual houve um curto-circuito "DPS +" e "DPS-". </li></ul><br>  IMPORTANTE: o novo firmware est√° chegando constantemente aos controladores, eliminando erros e adicionando funcionalidades, e o firmware C2000-KDL e C2000-KDL-2I s√£o incompat√≠veis. <br><br><h2>  Conex√£o Modbus </h2><br>  Como descrito anteriormente, pode ser usado um controlador C2000-Modbus ou um conversor C2000-PP.  Ambos os esquemas prev√™em a emiss√£o de sinais usando o protocolo Modbus RTU de 2 fios usando o RS-485 como dispositivo escravo (nosso host √© o Zabbix ou algum sistema SCADA).  Dois m√©todos podem ser usados ‚Äã‚Äãpara conectar-se ao servidor: <br><br><ul><li>  Preferencial - conversor Modbus RTU / Modbus TCP com conex√£o √† mesma rede local em que nosso servidor com software est√° localizado; </li><li>  Barato - Conversor RS-485 / USB com conex√£o diretamente ao servidor.  Observo que h√° muitas reclama√ß√µes sobre a confiabilidade desses pen drives (voc√™ pode pegar quase qualquer um, pedi √† China por 100 rublos, usei um monte de conversor RS-232 / RS-485 e um adaptador USB / RS-232 e tudo continuou funcionando!). </li></ul><br>  S√£o poss√≠veis dois esquemas para transmiss√£o de eventos ao protocolo Modbus: <br><br><ul><li>  diretamente do 2000- / C2000--Modbus, quando esses dispositivos operam no modo "Orion-Master" (selecionado por um jumper na placa) e atuam como interrogadores do sistema "Orion"; </li><li>  usando o controle remoto S2000M ao coletar informa√ß√µes dos controladores e somente depois transferi-las para o Modbus via S2000-PP / C2000-KDL-Modbus (modo Orion-Slave).  Esse esquema √© bom, pois o controle remoto pode ser usado como um "terminal local" (consulte os eventos na tela LCD interna) e tamb√©m continua a registrar eventos no caso de uma falha do servidor com o software de monitoramento.  Menos: a configura√ß√£o √© um pouco mais complicada e o controle remoto tem uma apar√™ncia muito espec√≠fica. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Exemplos de circuitos do sistema</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/u6/se/lr/u6selr6hievry0qlrqy77naclpm.png"><br><br><img src="https://habrastorage.org/webt/lr/mr/ny/lrmrnydyc3k7okcrwtfinacdvj8.png"><br><br><img src="https://habrastorage.org/webt/fz/hb/gf/fzhbgfqp5l5crnlkazfbvabmemg.png"><br></div></div><br><h2>  Pot√™ncia e instala√ß√£o </h2><br>  Para fonte de alimenta√ß√£o, √© necess√°ria uma fonte de alimenta√ß√£o de 12V DC, preferencialmente estabilizada e montada em um trilho DIN.  Sua pot√™ncia (geralmente indicada em mA ou A) pode ser aproximadamente selecionada a partir do c√°lculo de 1 controlador - 500 mA.  Eu recomendaria o uso de uma fonte de alimenta√ß√£o redundante (com bateria interna, RIP) apenas se o controle remoto S2000M for usado.  E certifique-se de conectar a fonte de alimenta√ß√£o √† mesma fonte de alimenta√ß√£o ininterrupta (UPS) do servidor do sistema de monitoramento. <br><br>  √â claro que voc√™ pode montar tudo isso na parede, mas deixe para os instaladores de alarme de inc√™ndio e seguran√ßa, e usaremos um trilho DIN de 3U para instala√ß√£o em um gabinete de 19 "(por exemplo, o PSM-3U ou o Cabeus CMO com o mesmo artigo, voc√™ ter√° que jogar fora o painel frontal No caso de usar o controle remoto S2000-M, voc√™ pode usar um plugue de 19 "4U (de prefer√™ncia perfurado), que funcionar√° como um painel de montagem e no qual um trilho DIN para os terminais e o controlador j√° est√° fixo.  Menos a decis√£o - o equipamento representa o plano de montagem de 19 ". <br><br>  Montar e montar um sistema de componentes n√£o deve causar perguntas, mas chamo a aten√ß√£o para o seguinte: <br><br><ul><li>  a maioria dos sensores possui um pequeno peda√ßo de cabo saliente.  Para aumentar o cabo, voc√™ pode usar solda com termorretr√°til ou uma caixa de balan√ßo KS-2 de dois pares (compacta, mas a m√£o-de-obra √© "manca") ou a conex√£o RJ11 (RJ45); </li><li>  Antes da montagem nos sensores, seus endere√ßos devem ser registrados (conforme descrito abaixo) e marcados; </li><li>  ao conectar sensores, √© necess√°rio observar a polaridade de ‚ÄúDLS +‚Äù e ‚ÄúDPS-‚Äù (consulte a documenta√ß√£o - que cor tem DPS +, geralmente colorida) - se voc√™ confundir, o sensor n√£o ser√° detectado no sistema. </li></ul><br>  Para quem n√£o deseja soldar, mas gosta de espremer os "chips", pode usar a op√ß√£o descrita abaixo (provavelmente ainda √© melhor que o RJ11 - para n√£o conectar acidentalmente a linha DPS ao servidor). <br><br>  Ser√° necess√°rio: <br><br><ul><li>  cabo de par tran√ßado 2 pares, sem blindagem; </li><li>  "Bolsa" de conectores RJ11 (6P4C ou 6P6C); </li><li>  Divisores RJ11 com entradas do tipo soquete (h√° uma grande variedade de op√ß√µes a pre√ßos muito razo√°veis). </li></ul><br>  Em um par, iniciamos o DPS, por outro, por exemplo, 12V DC.  Conex√£o de sensores atrav√©s de divisores. <br><br><div class="spoiler">  <b class="spoiler_title">Imagem explicativa</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/xf/v-/93/xfv-93ihmj39n_uhdyhhlqidgjg.png"><br></div></div><br><h2>  Suporte de montagem </h2><br>  Para a parte "pr√°tica", foi montado um estande composto por: <br><br><ul><li>  conversor de protocolo C2000-PP fabricado pela NVP Bolid; </li><li>  controlador S2000-KDL produzido pela NVP "Bolid"; </li><li>  termo-higr√¥metro (sensor combinado de temperatura e umidade) C2000-VT fabricado pela NVP Bolid; </li><li>  detector de contato magn√©tico S2000-SMK fabricado pela NVP "Bolid"; </li><li>  sensor de vazamento pontual S2000-DZ fabricado pela Rielta; </li><li>  extensor de endere√ßo S2000-AP1 isp.  02 produ√ß√£o de NVP "Bolid"; </li><li>  detector volum√©trico Photon-10M fabricado por "Rielta" (como "amontoado"); </li><li>  Fonte de alimenta√ß√£o 12V-AT / 12 / 1.5 DIN fabricada pela AccordTec; </li><li>  Adaptador RS-485 / USB adquirido no <a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aliexpress</a> (no chip CH340G comum, o linux o define como "adaptador serial USB QinHeng Electronics HL-340").  Tornou-se interessante como o sistema funcionar√° na configura√ß√£o mais barata; </li><li>  O thin client TONK 1811 do TONK Group of Companies (foi comprado no avito por 500 rublos) em um processador Intel Atom N270 com gr√°ficos GMA950 integrados. </li></ul><br><img src="https://habrastorage.org/webt/6b/kr/ed/6bkred606ln2axp3wlcrztumlly.png"><br><br><div class="spoiler">  <b class="spoiler_title">Refinando o thin client e a apar√™ncia do suporte</b> <div class="spoiler_text">  O thin client estava um pouco "finalizado": <br><br><ul><li>  Um m√≥dulo DOM de 2 GB com o Windows XP incorporado instalado foi substitu√≠do por HDDs de 2,5 ATA de 60 GB de um laptop antigo (eu tive que comprar um cabo, por alguma raz√£o o SATA-HDD n√£o atendeu - inclu√≠a a porta SATA no BIOS); </li><li>  aumento da RAM DDR2 SO-DIMM de 1 GB para 2 GB; </li><li>  Linux Mint 19.1 ‚ÄúTessa‚Äù Xfce Edition instalado e √°rea de trabalho remota configurada usando o TightVNC; </li><li>  O sistema de refrigera√ß√£o foi ‚Äúrefinado‚Äù - reduziu o dissipador de calor para que o HDD ca√≠sse quase ‚Äúnivelado‚Äù com o gabinete, removeu a tampa superior e, no topo, ‚Äúadicionou‚Äù uma ventoinha de 120 mm conectada atrav√©s de um resistor.  Imediatamente todos os "freios" desapareceram, tornou-se bastante razo√°vel trabalhar. </li></ul><br><br><img src="https://habrastorage.org/webt/ct/ri/5v/ctri5vgqehkummqppp22cd3k2uw.jpeg"><br></div></div><br><h2>  Configurar equipamento Bolid </h2><br>  Todas as configura√ß√µes s√£o feitas no ambiente Windows; portanto, antes de iniciar o trabalho, voc√™ precisa instalar o driver no adaptador RS-485 / USB, bem como dois "super" programas do NVP Bolid, fornecidos gratuitamente: <strong>Orion-prog</strong> e <strong>Uprog</strong> .  Al√©m disso, os dispositivos s√£o conectados separadamente ao adaptador RS-485 / USB √†s portas Orion AB RS-485 (o layout direto √© usado, e n√£o como as portas COM). <br><br>  IMPORTANTE: com todas as etapas subseq√ºentes no S2000-PP, o jumper XP1 na placa deve ser removido. <br><br>  Etapa 1. Insira o adaptador RS-485 / USB no conector USB e procure no gerenciador de dispositivos qual n√∫mero da porta COM est√° atribu√≠do ao adaptador.  Os drivers do adaptador devem ser instalados sem pontos de exclama√ß√£o no "Gerenciador de dispositivos". <br><br>  Etapa 2. Em nome do administrador, execute o Orion-prog, selecione a porta COM desejada e fa√ßa uma pesquisa e veja a vers√£o do firmware do dispositivo.  Acesse o site oficial do fabricante e verifique se h√° firmware mais recente e, se necess√°rio (provavelmente, ser√° necess√°rio), execute uma atualiza√ß√£o (no momento da reda√ß√£o deste documento: 1,32 para C2000-PP, 2,22 para C2000-KDL). <br><br><div class="spoiler">  <b class="spoiler_title">Firmware do instrumento em imagens</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/6i/lm/py/6ilmpyshwlwgygxsep6myrt-yzm.gif"><br></div></div><br>  * Firmware 1.32 de fato, eu fui instalado "torto" - no Uprog, a configura√ß√£o n√£o foi lida no dispositivo.  Portanto, ele "reverteu" para 1,31. <br><br>  Etapa 3. Configurando o endere√ßo para dispositivos (primeiro com S2000-PP, por exemplo, 2 e depois com S2000-KDL - 3).  Para fazer isso, execute Uprog - todos os dispositivos t√™m um endere√ßo padr√£o 127, portanto, voc√™ precisa configurar os dispositivos no in√≠cio, um de cada vez.  Para um v√≠deo mais detalhado do fabricante, consulte <a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">YouTube</a> . <br><br>  Etapa 4. Ap√≥s definir o endere√ßo no S2000-KDL, √© necess√°rio definir os endere√ßos dos sensores na linha de comunica√ß√£o de dois fios (DLS).  Eles tamb√©m t√™m o endere√ßo padr√£o 127 (e o c√≠rculo com o sensor em Uprog n√£o √© real√ßado).  Lemos a configura√ß√£o do dispositivo (Ctrl + F3) e conectamos sequencialmente os sensores √†s sa√≠das do DLS, definindo os endere√ßos.  Ao apontar para o sensor no menu de contexto ‚ÄúSolicita√ß√£o de tipo AU‚Äù, voc√™ pode especificar o tipo de sensor ou ‚ÄúSolicita√ß√£o de AU ADC‚Äù - descobrir se o sensor funciona (por exemplo, para um detector de contato magn√©tico do ADC ao fechar: 100 e ao abrir: 50).  Na verdade, eu tenho a seguinte configura√ß√£o de endere√ßo: 1 - chave reed C2000-SMK, 2 - temperatura C2000-VT, 3 - umidade C2000-VT, 4 - vazamento C2000-DZ, 5 - ISP do expansor de endere√ßo C2000-AP1.  02 (com o detector volum√©trico Photon-10M conectado a ele). <br><br><div class="spoiler">  <b class="spoiler_title">Endere√ßando sensores em imagens</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/j9/vo/dk/j9vodkzjmmydzvrsk377m3zinok.gif"><br></div></div><br>  Em seguida, v√° para a guia "Entradas" e fa√ßa o seguinte: <br><br><ul><li>  indicar os tipos de sensores: para temperatura - 10, para medir umidade - 15, para todos os outros - 6 (tecnol√≥gico); </li><li>  para entradas tecnol√≥gicas, definimos ‚ÄúRecovery time, s‚Äù - este √© o tempo ap√≥s o qual o loop retornar√° ao estado ‚ÄúNormal‚Äù depois de receber o estado ‚ÄúViolation‚Äù.  √â necess√°rio indicar o n√∫mero de pelo menos o intervalo de pesquisa no Zabbix (levei 10 segundos); </li><li>  desative "Controle da indica√ß√£o AU" (0), "Monitoramento de circuito aberto e curto-circuito" e "Monitorando o status da bateria de reserva" para simplificar a configura√ß√£o. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Configurando entradas para S2000-KDL em imagens</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/90/cn/68/90cn68wqswa16_nt7pqxzy830de.gif"><br></div></div><br>  Ap√≥s todas as ‚Äúmanipula√ß√µes‚Äù com o C2000-KDL, realizamos o ‚ÄúRegistro de configura√ß√£o no instrumento‚Äù. <br><br>  Etapa 5. Configure o S2000-PP. <br>  Na guia "Dispositivo", as configura√ß√µes s√£o mostradas na imagem (estas s√£o as mais "em execu√ß√£o" e, por padr√£o, na maioria dos dispositivos).  A porta COM do adaptador RS-485 / USB e qualquer outro dispositivo conectado √† rede Modbus deve ter configura√ß√µes semelhantes.  Selecionei o endere√ßo 11 para o dispositivo S2000-PP na rede Modbus (o endere√ßo no sistema Orion √© 2!). <br><br><img src="https://habrastorage.org/webt/ej/6y/31/ej6y31hxzfnze6nzx29rjcnsfwk.png"><br><br>  Em seguida, vamos para a guia "Dispositivos" e come√ßamos a preencher a "Tabela de zonas": <br><br><ul><li>  a primeira coluna indicou "3" - este √© o endere√ßo do dispositivo S2000-KDL no sistema Orion; </li><li>  n√∫mero do loop de alarme ("loop de alarme") - esses s√£o os endere√ßos dos sensores (na verdade, o loop de alarme = endere√ßo, podemos pular v√°rios endere√ßos se n√£o quisermos obter informa√ß√µes deles); </li><li>  Se√ß√£o Modbus No. - voc√™ pode agrupar nossos sensores em grupos.  Para simplificar - eu n√£o fiz isso e atribui a todos 1 se√ß√£o; </li><li>  O tipo de zona √© um par√¢metro muito importante.  N√≥s o selecionamos de acordo com o tipo de sensor. </li></ul><br><img src="https://habrastorage.org/webt/8g/bo/ea/8gboea_ibzpk6nr04myidkbgtru.png"><br><br>  Ap√≥s definir o S2000-PP, realizamos o "Registro de configura√ß√£o no instrumento". <br><br>  Etapa 6. Combine C2000-PP e C2000-KDL em uma rede via RS-485 Orion, conecte os sensores ao C2000-KDL (voc√™ pode usar v√°rios terminais) e conecte o adaptador RS-485 / USB √† sa√≠da Modbus C2000-PP.  Definimos o jumper XP1 na posi√ß√£o fechada (importante: ap√≥s a instala√ß√£o do jumper, voc√™ deve reiniciar o dispositivo redefinindo a tens√£o de alimenta√ß√£o).  Tudo - o sistema est√° "pronto para a batalha". <br><br>  Verificamos a "operacionalidade" no programa de console gratuito <a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Modpoll Modbus Master Simulator</a> (doravante denominado "Modpoll"), por exemplo, no endere√ßo de firmware "S2000-PP" ou enviando informa√ß√µes do S2000-KDL para "40000" - este √© o primeiro sensor: <br><br><img src="https://habrastorage.org/webt/ij/hv/go/ijhvgoynxeyxwua5abdcgvapi3u.png"><br><br>  O firmware "para familiariza√ß√£o" pode ser baixado <a href="">aqui</a> . <br><br><h2>  Configura√ß√£o do Zabbix </h2><br>  <font color="red">Aviso: Zabbix configurado pela primeira vez, como o Linux Mint (j√° que n√£o h√° Zabbix no Windows) :)</font> <br><br>  Ap√≥s instalar o Zabbix, voc√™ precisa instalar os pacotes <i>autoconf</i> , <i>automake</i> , <i>libtool</i> , <i>pkg-config</i> e, em seguida, o m√≥dulo de extens√£o - <i>libzbxmodbus</i> .  H√° um artigo separado sobre ele no <a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Habr√©</a> (vou me referir constantemente a ele) e foi atualizado recentemente, apenas para trabalhar com o Zabbix 4.0.  O artigo tamb√©m possui informa√ß√µes mais detalhadas sobre o protocolo Modbus.    -     <a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub</a> -. <br><br>        GitHub: <br><br><pre><code class="plaintext hljs">... ./configure --prefix=/etc/zabbix --enable-zabbix-3.2 ... sudo make install</code> </pre> <br>  Ao estudar a opera√ß√£o do m√≥dulo <i>libzbxmodbus</i> , ficou claro que n√£o seria poss√≠vel aplicar o circuito com o controle remoto C2000M, porque nesse caso os dados dos termohigr√¥metros s√£o assim: escreva o n√∫mero da zona desejada para registrar 46179 e, em seguida, colete dados do registro 46328 - ou seja,  muito n√£o trivial (em sistemas SCADA "grandes", isso pode ser implementado, por exemplo, no MasterSCADA). <br><br>  No arquivo de configura√ß√£o <i>etc / zabbix / zabbix_server.conf, escrevemos os</i> links de <i>extens√£o</i> e conectamos o hardware ao servidor com o Zabbix.  N√£o precisei instalar drivers para o adaptador RS-485 / USB, mas ainda n√£o entendi como descobrir qual n√∫mero de USB usar; √© bom que a conex√£o com <i>/ dev / ttyUSB0 funcione</i> (voc√™ pode ver que o dispositivo foi encontrado no sistema usando o comando <i>lsusb</i> ). <br><br>  Como no Windows, verificamos usando o utilit√°rio Modpoll (executei o linux i386) se o hardware est√° conectado e as informa√ß√µes dispon√≠veis: <br><br><img src="https://habrastorage.org/webt/wn/8_/zz/wn8_zz98bldyf7hzc5zdkc90v80.png"><br><br>  Como o artigo descreve o processo de configura√ß√£o usando o exemplo do Zabbix 2.2 - a interface √© um pouco diferente, fornecerei explica√ß√µes e imagens das configura√ß√µes. <br><br><p>  Etapa 1. Criamos um n√≥ de rede e um grupo no qual nossos n√≥s ser√£o inclu√≠dos (por exemplo, um n√≥ - "Monitoramento Ambiental" e um grupo - "Infraestrutura de Engenharia"): <br>  Configura√ß√µes&gt; Hosts&gt; Criar host&gt; Digite nossos nomes&gt; Adicionar <br><br><img src="https://habrastorage.org/webt/vj/cd/fi/vjcdfibmwzvcm7vudrfubf4nuaa.png"><br><br>  Etapa 2. Crie os elementos de dados.  O artigo recomenda a cria√ß√£o de modelos, mas como o nosso sistema n√£o cont√©m elementos duplicados, pularemos esta etapa.  Por exemplo, se tiv√©ssemos v√°rios condicionadores de ar conectados via Modbus, poder√≠amos usar a funcionalidade do sistema. <br><br>  Configura√ß√µes&gt; N√≥s da rede&gt; Na linha que cont√©m o nome do nosso n√≥ "Monitoramento Ambiental", clique em "Elementos de Dados"&gt; na janela exibida, clique em "Criar Elemento de Dados". <br><br>  Come√ßamos a "martelar" nossos sensores: <br><br><img src="https://habrastorage.org/webt/j_/ei/9n/j_ei9nphfowd7sgjp6r8u3r9xyk.png"><br><br>  Pequenas nuances: <br><br></p><ul><li>  o artigo usa a sintaxe da fun√ß√£o <em>‚Äúmodbus_read_registers‚Äù</em> e de acordo com a descri√ß√£o do GitHub <em>‚Äúmodbus_read‚Äù</em> - a segunda op√ß√£o √© mais curta e funciona; </li><li>  em vez das macros <em>{$ MODBUS_PORT}</em> e <em>{$ MODBUS_SLAVE},</em> voc√™ pode especificar a porta nos <em>formatos / dev / ttyUSB0</em> e " <em>11</em> ", mas isso ser√° inconveniente se voc√™ precisar alterar posteriormente a porta USB ou o endere√ßo do S2000-PP; </li><li>  a documenta√ß√£o declara que, para solicitar o status da zona (coluna "Modbus zone No.") no S2000-PP, voc√™ deve entrar em contato com: "endere√ßo de registro 40000 + M, onde M = (zone No. ‚Äì1)" - este √© o progresso: "zone No. <strong>menos</strong> 1 " </li><li>  n√£o fa√ßa uma pesquisa de tempo muito frequente: o S2000-PP come√ßa a retornar um erro de ‚Äúerro de exce√ß√£o 15‚Äù - o dispositivo n√£o tem tempo para preparar os dados (isso √© expresso no brilho constante do indicador no dispositivo); </li><li>  para dados de temperatura e umidade com registros 3000 -... </li><li>  na janela "Elementos de dados" tamb√©m h√° a guia "Pr√©-processamento" desejada.  Aqui voc√™ pode editar o que ser√° mostrado "no final".  A temperatura e a umidade s√£o obtidas a partir dos valores de leitura, que devem ser divididos por 256: ‚ÄúFator do usu√°rio‚Äù - 0,0039 (ou seja, 1/256); </li><li>  Para chaves de palheta discretas, sensores de vazamento, etc.  voc√™ tamb√©m precisa usar a "exibi√ß√£o de valor", isso se deve ao modo como as informa√ß√µes s√£o fornecidas. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Definir a convers√£o de dados em imagens</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/pj/g1/yr/pjg1yrlg-hfu83bgzuch6rke-xg.png"><br><br><img src="https://habrastorage.org/webt/k4/7o/hu/k47ohudcuf9ycomoxbdebii6kvu.png"><br></div></div><br>  Um pouco sobre como os dados s√£o fornecidos ao pesquisar zonas. <br>  Suponha que voc√™ recebeu uma resposta no formato decimal 9148 (D).  N√≥s o traduziremos no formato hexadecimal (HEX): get 23BC - de acordo com as instru√ß√µes para o dispositivo S2000-PP, estes s√£o dois eventos com os c√≥digos 23 (HEX) / 35 (D) e BC (HEX) / 188 (D).  A seguir, consulte a Tabela 5. ‚ÄúLista de eventos (estados AL) do sistema Orion‚Äù.  Nele encontramos 35 "Restaurando a entrada tecnol√≥gica" e 188 "Restaurando a comunica√ß√£o com a entrada".  N√£o h√° necessidade de converter D-HEX-D, o primeiro evento √© a parte inteira da divis√£o do valor recebido por 256 e o ‚Äã‚Äãrestante √© o segundo evento ( <strong>9148</strong> = <strong>35</strong> * 256 + <strong>188</strong> ).  Ao entrevistar insumos tecnol√≥gicos, pegaremos apenas o primeiro evento (prioridade), que ‚Äúdeveria‚Äù levar os estados 35 e 36 (‚ÄúRestaurando o insumo tecnol√≥gico‚Äù e ‚ÄúViolando o insumo tecnol√≥gico‚Äù).  Descartaremos a parte fracion√°ria (segundo evento) usando a configura√ß√£o do elemento de dados ‚ÄúTipo de informa√ß√£o: num√©rico (n√∫mero inteiro positivo)‚Äù. <br><br>  Etapa 3. Preencha as macros da porta e os n√∫meros do dispositivo: <br>  Configura√ß√µes&gt; N√≥s da rede&gt; "Monitoramento ambiental"&gt; selecione "Macros" <br><br><img src="https://habrastorage.org/webt/h1/r-/qg/h1r-qgd4rrdym-txvbmnhsqwgre.png"><br><br>  Etapa 4. Exibindo leituras no painel de controle: <br>  Tela inicial&gt; Todos os pain√©is, selecione "Criar painel"&gt; na janela exibida, defina "Nome do painel" e o usu√°rio para quem este painel estar√° dispon√≠vel&gt; Clique em "Criar um novo widget"&gt; Digite "Vis√£o geral dos dados", Intervalo de atualiza√ß√£o "10 segundos", Grupos n√≥s da rede Engineering Infrastructure&gt; Adicionar&gt; Ajustar tamanho do painel e clique em "Salvar altera√ß√µes": <br><br><img src="https://habrastorage.org/webt/wl/ge/la/wlgelajwrwuuta5phssi2b5rx38.gif"><br><br><h2>  Conclus√£o </h2><br>  O sistema resultante, atrav√©s do uso de protocolos de "longo alcance", pode ser uma excelente solu√ß√£o, tanto para monitorar o servidor quanto um par de zonas de escrit√≥rios cruzadas (em termos de monitoramento das condi√ß√µes de temperatura e umidade) ou at√© mesmo um pequeno data center.  Algu√©m pode dizer: ‚Äúfu fu fu, o carro ainda √© nojento, voc√™ precisa usar o XXX (substitua algo da automa√ß√£o industrial)‚Äù tamb√©m √© uma op√ß√£o, mas, na minha opini√£o, ser√° muito redundante e tamb√©m mais caro .  E uma pequena nuance: como voc√™ pode ver, o sistema no Bolid √© bastante simples (embora exista uma l√≥gica um tanto estranha), mas ‚Äútermina‚Äù a decis√£o no baile.  controladores - √†s vezes ele ainda √© um "viciado". <br><br>  PS Este artigo √© uma adapta√ß√£o de dois artigos no meu blog: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Monitoramento barato para a sala do servidor (parte 1 - introdut√≥ria)</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Monitoramento barato para a sala do servidor (parte 2 - pr√°tico)</a> <br><br>  UPD  Depois de trabalhar por 3 dias, o adaptador RS485-USB caiu.  √â reconhecido como inst√°vel, mas adequado para comissionamento.  Foi substitu√≠do por um conversor de porta √∫nica MGate MB3170 fabricado pela MOXA (retirado do que estava √† m√£o) - tudo ficou est√°vel. <br>  Voc√™ precisa entender que este artigo √© apenas um exemplo de como "fazer amizade" com o Zabbix e o Bolid.  Para uma implementa√ß√£o real, voc√™ pode adicionar mais estados DPS monitorados, bem como, por exemplo, temperaturas negativas (eles s√£o processados ‚Äã‚Äãde maneira um pouco diferente). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt438788/">https://habr.com/ru/post/pt438788/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt438774/index.html">Tudo de bom de uma s√≥ vez. Os artigos mais v√≠vidos do blog da LANIT em Habr√© - 2018</a></li>
<li><a href="../pt438776/index.html">Dicas e truques do meu canal de telegrama @pythonetc, janeiro de 2019</a></li>
<li><a href="../pt438778/index.html">@Pythonetc janeiro de 2019</a></li>
<li><a href="../pt438782/index.html">O FSB prop√¥s o lan√ßamento de cart√µes SIM russos e usa criptografia dom√©stica para 5G</a></li>
<li><a href="../pt438784/index.html">Problemas ao usar o servi√ßo Yandex.Metrica</a></li>
<li><a href="../pt438790/index.html">A troca de criptomoedas QuadrigaCX n√£o doar√° US $ 137 milh√µes, apenas o diretor sabia a senha da loja e ele morreu.</a></li>
<li><a href="../pt438792/index.html">Usando todas as matrizes Flash do AccelStor em projetos VDI</a></li>
<li><a href="../pt438794/index.html">Detalhes do objeto JavaScript</a></li>
<li><a href="../pt438796/index.html">Parte 1 do Docker de aprendizagem: o b√°sico</a></li>
<li><a href="../pt438798/index.html">Como trabalhar com dados de intelig√™ncia cibern√©tica: aprendemos a coletar e identificar indicadores de comprometimento do sistema</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>