<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👶🏻 🆕 🧘🏾 Monitoramento ambiental na sala do servidor (Bolid + Zabbix) 👩🏿‍🤝‍👩🏻 🤦🏻 🤘🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Provavelmente, a maneira mais fácil para um profissional de TI resolver o problema de monitoramento ambiental na sala de servidores é usar controlador...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Monitoramento ambiental na sala do servidor (Bolid + Zabbix)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438788/">  Provavelmente, a maneira mais fácil para um profissional de TI resolver o problema de monitoramento ambiental na sala de servidores é usar controladores especializados com saída SNMP (por exemplo, NetBotz ou NetPing).  Mas para aqueles que não têm medo de dificuldades e desejam obter uma solução econômica de nível industrial (com produção em série de equipamentos) - existe uma opção interessante com o protocolo Modbus. <br><br><img src="https://habrastorage.org/webt/wu/uc/mi/wuucmi1fiyi7sglvrsekrvey0pk.png"><br><a name="habracut"></a><br>  Abaixo, descreverei um sistema de monitoramento baseado em componentes fabricados na Rússia - NVP Bolid, e “mesclaremos” os dados no Zabbix 4.0.  O NVP "Bolid" é amplamente conhecido nos círculos de equipamentos de automação de combate a incêndio e a solução considerada terá essa "impressão".  Seus dispositivos, para dizer o mínimo, não diferem no design e consideração dos casos, mas ... o preço mais do que compensa todas essas deficiências.  Vale a pena notar uma documentação muito boa e suporte técnico gratuito mais ou menos normal. <br><br><h2>  Protocolos e Interfaces </h2><br>  Antes de passar para o hardware, veremos brevemente os protocolos e interfaces usados: <br><br>  <b>Modbus</b> : um protocolo industrial construído no princípio de "Master" - "Slave".  Só pode haver um mestre em uma rede Modbus que pesquisa os escravos e "diz" o que fazer.  Como meio de transmissão, ele pode usar a interface RS-485 (Modbus RTU) ou Ethernet (Modbus TCP).  Teoricamente, o número máximo de dispositivos é 247. <br><br>  <b>Orion</b> : protocolo proprietário da empresa NVP "Bolid", baseado no princípio de "Master" (Master) - "Slave" (Slave).  Aparentemente, a interface RS-485 modificada é usada como meio de transmissão de dados, devido ao qual o comprimento máximo da linha pode atingir 3 km (!).  O número máximo de dispositivos é 127. <br><br>  <b>DLS</b> (linha de comunicação de dois fios): protocolo proprietário da empresa NVP "Bolid", baseado no princípio de "Master" - "Slave" (Master).  Ele usa um cabo de par de cobre como meio de transmissão de dados (recomenda-se cabo de par trançado).  O número máximo de dispositivos é 127 + 1.  Topologia - um barramento (ou anel) com ramificações, o comprimento máximo da linha pode chegar a 1,5 km (dependendo do tipo de cabo, seção transversal dos condutores de cabos e número de dispositivos conectados). <br><br>  <b>RS-485</b> : interface da camada física, usa "par trançado" (um par de "dois fios" ou dois "quatro fios" para transmissão de dados, o segundo é menos comum).  O comprimento máximo declarado da linha é de 1,2 km.  Topologia é um ônibus. <br><br>  Como você pode ver, linhas de comunicação bastante "de longo alcance" são usadas.  Em todos os protocolos, o endereçamento do dispositivo é definido por "alças" (pré-configuração). <br><br><h2>  Sensores </h2><br>  O sistema envolve a conexão de sensores de endereço "especiais" (proprietários) (para ser mais estritamente "detectores", ou seja, dispositivos com um sensor embutido), mas você também pode conectar um endereço não "comum" usando expansores de endereço (de 1 a 8 entradas).  O uso de detectores endereçáveis ​​oferece duas vantagens: quase todos os dispositivos endereçáveis ​​recebem energia através da linha de sinal (ou seja, não é necessário fornecer uma linha de energia 12V separada) e não é necessário colocar o expansor de endereço em qualquer lugar.  Os sensores estão conectados ao <abbr title="linha de comunicação de dois fios">DPS</abbr> . <br>  A gama de equipamentos "terminais" é bastante ampla, mas darei o que pode ser necessário para solucionar nosso problema: <br><br><ul><li>  S2000-VT - sensor combinado de temperatura e umidade para uso interno (IP41).  Possui um certificado de instrumento de medição, o erro é de apenas 0,5 ° C e o preço de varejo recomendado de apenas 1200 rublos! </li><li>  S2000-SMK (e suas variações) - sensor de “porta aberta” (detector de contato magnético, chave reed).  Preço de venda recomendado - 300 rublos. </li><li>  S2000-DZ - sensor de ponto de inundação (feito em conjunto com Realty, portanto, o caso é "não formatado").  Preço de venda recomendado - 800 rublos. </li><li>  2000-1, 2000-2, 2000-8 - expansores de endereço para conexões 1, 2 e 8, podem ser usados ​​como "receptores" de sinais do tipo "contato seco" (ligar / desligar) de outro equipamento (por exemplo, de um dispositivo de extinção de incêndio ou bombas de ar condicionado); </li><li>  S2000-SP2 - bloco de relés (para 2 saídas), com o qual você pode controlar dispositivos (por exemplo, uma lâmpada de alarme - um indicador luminoso).  Preço de venda recomendado - 1200 rublos. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Aparência dos sensores</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/wy/ff/2k/wyff2kk8bfwz0bcq5feyh-kvja4.png"><br><br></div></div><br>  Para uma lista completa de equipamentos, consulte o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site oficial do fabricante</a> . <br><br><h2>  Controlador </h2><br>  A "linha" de controladores, se assim posso dizer, consiste em três modelos: <br><br><ul><li>  S2000-KDL - modelo básico (a designação significa "Sistema 2000 - Controlador de uma linha de comunicação de dois fios"); </li><li>  S2000-KDL-2I - isolamento galvânico adicionado para RS-485 e DPS; </li><li>  S2000-KDL-Modbus - um conversor de protocolo Modbus S2000-PP foi adicionado ao projeto S2000-KDL-2I. </li></ul><br><div class="spoiler">  <b class="spoiler_title">A aparência dos controladores</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/gw/wu/nb/gwwunbbgi8jsdrp4lirdesxxoyi.png"><br></div></div><br>  É mais ideal usar o S2000-KDL-Modbus, mas também é possível usar o S2000-KDL / C2000-KDL-2I com o conversor de protocolo S2000-PP instalado nas proximidades, que possui um design de caixa montado em painel. <br><br>  O controlador desempenha o papel de "Líder" na linha <abbr title="linha de comunicação de dois fios">DLS</abbr> (apenas uma linha DPS pode ser conectada a um controlador) e na linha Orion RS-485 já atua como "Escravo" e não será possível coletar dados "diretamente".  Para coletar dados na linha RS-485 Orion, são usados ​​os chamados console 2000 ou 2000- (incluindo a versão incorporada), que já possuem interfaces de transferência de dados padronizadas. <br><br>  Os seguintes controladores também podem distinguir as seguintes características: <br><br><ul><li>  referir-se a um tipo configurável, não programável (ou seja, você só precisa configurar os parâmetros e não desenvolver um programa); </li><li>  suporte em <abbr title="linha de comunicação de dois fios">DPSs de</abbr> até 127 dispositivos endereçáveis ​​(o S2000-VT possui dois endereços) e muitos comissários não recomendam o uso de mais de 100-110; </li><li>  entrada dupla para fonte de alimentação DC 12-24V; </li><li>  design do gabinete não muito conveniente (todos os fios conectados não podem ser ocultados no gabinete do dispositivo e você deve removê-los da parte traseira do dispositivo). </li></ul><br>  Para tolerância a falhas do sistema, você pode usar as seguintes medidas (que são opcionais): <br><br><ul><li>  loop de anel - uma quebra de loop em um só lugar não afeta a presença de sinais de sensores endereçáveis; </li><li>  o uso de blocos de isolamento de ramificação (BRIZ) - permite fazer ramificações radiais, bem como isolar o segmento de loop, no qual houve um curto-circuito "DPS +" e "DPS-". </li></ul><br>  IMPORTANTE: o novo firmware está chegando constantemente aos controladores, eliminando erros e adicionando funcionalidades, e o firmware C2000-KDL e C2000-KDL-2I são incompatíveis. <br><br><h2>  Conexão Modbus </h2><br>  Como descrito anteriormente, pode ser usado um controlador C2000-Modbus ou um conversor C2000-PP.  Ambos os esquemas prevêem a emissão de sinais usando o protocolo Modbus RTU de 2 fios usando o RS-485 como dispositivo escravo (nosso host é o Zabbix ou algum sistema SCADA).  Dois métodos podem ser usados ​​para conectar-se ao servidor: <br><br><ul><li>  Preferencial - conversor Modbus RTU / Modbus TCP com conexão à mesma rede local em que nosso servidor com software está localizado; </li><li>  Barato - Conversor RS-485 / USB com conexão diretamente ao servidor.  Observo que há muitas reclamações sobre a confiabilidade desses pen drives (você pode pegar quase qualquer um, pedi à China por 100 rublos, usei um monte de conversor RS-232 / RS-485 e um adaptador USB / RS-232 e tudo continuou funcionando!). </li></ul><br>  São possíveis dois esquemas para transmissão de eventos ao protocolo Modbus: <br><br><ul><li>  diretamente do 2000- / C2000--Modbus, quando esses dispositivos operam no modo "Orion-Master" (selecionado por um jumper na placa) e atuam como interrogadores do sistema "Orion"; </li><li>  usando o controle remoto S2000M ao coletar informações dos controladores e somente depois transferi-las para o Modbus via S2000-PP / C2000-KDL-Modbus (modo Orion-Slave).  Esse esquema é bom, pois o controle remoto pode ser usado como um "terminal local" (consulte os eventos na tela LCD interna) e também continua a registrar eventos no caso de uma falha do servidor com o software de monitoramento.  Menos: a configuração é um pouco mais complicada e o controle remoto tem uma aparência muito específica. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Exemplos de circuitos do sistema</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/u6/se/lr/u6selr6hievry0qlrqy77naclpm.png"><br><br><img src="https://habrastorage.org/webt/lr/mr/ny/lrmrnydyc3k7okcrwtfinacdvj8.png"><br><br><img src="https://habrastorage.org/webt/fz/hb/gf/fzhbgfqp5l5crnlkazfbvabmemg.png"><br></div></div><br><h2>  Potência e instalação </h2><br>  Para fonte de alimentação, é necessária uma fonte de alimentação de 12V DC, preferencialmente estabilizada e montada em um trilho DIN.  Sua potência (geralmente indicada em mA ou A) pode ser aproximadamente selecionada a partir do cálculo de 1 controlador - 500 mA.  Eu recomendaria o uso de uma fonte de alimentação redundante (com bateria interna, RIP) apenas se o controle remoto S2000M for usado.  E certifique-se de conectar a fonte de alimentação à mesma fonte de alimentação ininterrupta (UPS) do servidor do sistema de monitoramento. <br><br>  É claro que você pode montar tudo isso na parede, mas deixe para os instaladores de alarme de incêndio e segurança, e usaremos um trilho DIN de 3U para instalação em um gabinete de 19 "(por exemplo, o PSM-3U ou o Cabeus CMO com o mesmo artigo, você terá que jogar fora o painel frontal No caso de usar o controle remoto S2000-M, você pode usar um plugue de 19 "4U (de preferência perfurado), que funcionará como um painel de montagem e no qual um trilho DIN para os terminais e o controlador já está fixo.  Menos a decisão - o equipamento representa o plano de montagem de 19 ". <br><br>  Montar e montar um sistema de componentes não deve causar perguntas, mas chamo a atenção para o seguinte: <br><br><ul><li>  a maioria dos sensores possui um pequeno pedaço de cabo saliente.  Para aumentar o cabo, você pode usar solda com termorretrátil ou uma caixa de balanço KS-2 de dois pares (compacta, mas a mão-de-obra é "manca") ou a conexão RJ11 (RJ45); </li><li>  Antes da montagem nos sensores, seus endereços devem ser registrados (conforme descrito abaixo) e marcados; </li><li>  ao conectar sensores, é necessário observar a polaridade de “DLS +” e “DPS-” (consulte a documentação - que cor tem DPS +, geralmente colorida) - se você confundir, o sensor não será detectado no sistema. </li></ul><br>  Para quem não deseja soldar, mas gosta de espremer os "chips", pode usar a opção descrita abaixo (provavelmente ainda é melhor que o RJ11 - para não conectar acidentalmente a linha DPS ao servidor). <br><br>  Será necessário: <br><br><ul><li>  cabo de par trançado 2 pares, sem blindagem; </li><li>  "Bolsa" de conectores RJ11 (6P4C ou 6P6C); </li><li>  Divisores RJ11 com entradas do tipo soquete (há uma grande variedade de opções a preços muito razoáveis). </li></ul><br>  Em um par, iniciamos o DPS, por outro, por exemplo, 12V DC.  Conexão de sensores através de divisores. <br><br><div class="spoiler">  <b class="spoiler_title">Imagem explicativa</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/xf/v-/93/xfv-93ihmj39n_uhdyhhlqidgjg.png"><br></div></div><br><h2>  Suporte de montagem </h2><br>  Para a parte "prática", foi montado um estande composto por: <br><br><ul><li>  conversor de protocolo C2000-PP fabricado pela NVP Bolid; </li><li>  controlador S2000-KDL produzido pela NVP "Bolid"; </li><li>  termo-higrômetro (sensor combinado de temperatura e umidade) C2000-VT fabricado pela NVP Bolid; </li><li>  detector de contato magnético S2000-SMK fabricado pela NVP "Bolid"; </li><li>  sensor de vazamento pontual S2000-DZ fabricado pela Rielta; </li><li>  extensor de endereço S2000-AP1 isp.  02 produção de NVP "Bolid"; </li><li>  detector volumétrico Photon-10M fabricado por "Rielta" (como "amontoado"); </li><li>  Fonte de alimentação 12V-AT / 12 / 1.5 DIN fabricada pela AccordTec; </li><li>  Adaptador RS-485 / USB adquirido no <a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aliexpress</a> (no chip CH340G comum, o linux o define como "adaptador serial USB QinHeng Electronics HL-340").  Tornou-se interessante como o sistema funcionará na configuração mais barata; </li><li>  O thin client TONK 1811 do TONK Group of Companies (foi comprado no avito por 500 rublos) em um processador Intel Atom N270 com gráficos GMA950 integrados. </li></ul><br><img src="https://habrastorage.org/webt/6b/kr/ed/6bkred606ln2axp3wlcrztumlly.png"><br><br><div class="spoiler">  <b class="spoiler_title">Refinando o thin client e a aparência do suporte</b> <div class="spoiler_text">  O thin client estava um pouco "finalizado": <br><br><ul><li>  Um módulo DOM de 2 GB com o Windows XP incorporado instalado foi substituído por HDDs de 2,5 ATA de 60 GB de um laptop antigo (eu tive que comprar um cabo, por alguma razão o SATA-HDD não atendeu - incluía a porta SATA no BIOS); </li><li>  aumento da RAM DDR2 SO-DIMM de 1 GB para 2 GB; </li><li>  Linux Mint 19.1 “Tessa” Xfce Edition instalado e área de trabalho remota configurada usando o TightVNC; </li><li>  O sistema de refrigeração foi “refinado” - reduziu o dissipador de calor para que o HDD caísse quase “nivelado” com o gabinete, removeu a tampa superior e, no topo, “adicionou” uma ventoinha de 120 mm conectada através de um resistor.  Imediatamente todos os "freios" desapareceram, tornou-se bastante razoável trabalhar. </li></ul><br><br><img src="https://habrastorage.org/webt/ct/ri/5v/ctri5vgqehkummqppp22cd3k2uw.jpeg"><br></div></div><br><h2>  Configurar equipamento Bolid </h2><br>  Todas as configurações são feitas no ambiente Windows; portanto, antes de iniciar o trabalho, você precisa instalar o driver no adaptador RS-485 / USB, bem como dois "super" programas do NVP Bolid, fornecidos gratuitamente: <strong>Orion-prog</strong> e <strong>Uprog</strong> .  Além disso, os dispositivos são conectados separadamente ao adaptador RS-485 / USB às portas Orion AB RS-485 (o layout direto é usado, e não como as portas COM). <br><br>  IMPORTANTE: com todas as etapas subseqüentes no S2000-PP, o jumper XP1 na placa deve ser removido. <br><br>  Etapa 1. Insira o adaptador RS-485 / USB no conector USB e procure no gerenciador de dispositivos qual número da porta COM está atribuído ao adaptador.  Os drivers do adaptador devem ser instalados sem pontos de exclamação no "Gerenciador de dispositivos". <br><br>  Etapa 2. Em nome do administrador, execute o Orion-prog, selecione a porta COM desejada e faça uma pesquisa e veja a versão do firmware do dispositivo.  Acesse o site oficial do fabricante e verifique se há firmware mais recente e, se necessário (provavelmente, será necessário), execute uma atualização (no momento da redação deste documento: 1,32 para C2000-PP, 2,22 para C2000-KDL). <br><br><div class="spoiler">  <b class="spoiler_title">Firmware do instrumento em imagens</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/6i/lm/py/6ilmpyshwlwgygxsep6myrt-yzm.gif"><br></div></div><br>  * Firmware 1.32 de fato, eu fui instalado "torto" - no Uprog, a configuração não foi lida no dispositivo.  Portanto, ele "reverteu" para 1,31. <br><br>  Etapa 3. Configurando o endereço para dispositivos (primeiro com S2000-PP, por exemplo, 2 e depois com S2000-KDL - 3).  Para fazer isso, execute Uprog - todos os dispositivos têm um endereço padrão 127, portanto, você precisa configurar os dispositivos no início, um de cada vez.  Para um vídeo mais detalhado do fabricante, consulte <a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">YouTube</a> . <br><br>  Etapa 4. Após definir o endereço no S2000-KDL, é necessário definir os endereços dos sensores na linha de comunicação de dois fios (DLS).  Eles também têm o endereço padrão 127 (e o círculo com o sensor em Uprog não é realçado).  Lemos a configuração do dispositivo (Ctrl + F3) e conectamos sequencialmente os sensores às saídas do DLS, definindo os endereços.  Ao apontar para o sensor no menu de contexto “Solicitação de tipo AU”, você pode especificar o tipo de sensor ou “Solicitação de AU ADC” - descobrir se o sensor funciona (por exemplo, para um detector de contato magnético do ADC ao fechar: 100 e ao abrir: 50).  Na verdade, eu tenho a seguinte configuração de endereço: 1 - chave reed C2000-SMK, 2 - temperatura C2000-VT, 3 - umidade C2000-VT, 4 - vazamento C2000-DZ, 5 - ISP do expansor de endereço C2000-AP1.  02 (com o detector volumétrico Photon-10M conectado a ele). <br><br><div class="spoiler">  <b class="spoiler_title">Endereçando sensores em imagens</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/j9/vo/dk/j9vodkzjmmydzvrsk377m3zinok.gif"><br></div></div><br>  Em seguida, vá para a guia "Entradas" e faça o seguinte: <br><br><ul><li>  indicar os tipos de sensores: para temperatura - 10, para medir umidade - 15, para todos os outros - 6 (tecnológico); </li><li>  para entradas tecnológicas, definimos “Recovery time, s” - este é o tempo após o qual o loop retornará ao estado “Normal” depois de receber o estado “Violation”.  É necessário indicar o número de pelo menos o intervalo de pesquisa no Zabbix (levei 10 segundos); </li><li>  desative "Controle da indicação AU" (0), "Monitoramento de circuito aberto e curto-circuito" e "Monitorando o status da bateria de reserva" para simplificar a configuração. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Configurando entradas para S2000-KDL em imagens</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/90/cn/68/90cn68wqswa16_nt7pqxzy830de.gif"><br></div></div><br>  Após todas as “manipulações” com o C2000-KDL, realizamos o “Registro de configuração no instrumento”. <br><br>  Etapa 5. Configure o S2000-PP. <br>  Na guia "Dispositivo", as configurações são mostradas na imagem (estas são as mais "em execução" e, por padrão, na maioria dos dispositivos).  A porta COM do adaptador RS-485 / USB e qualquer outro dispositivo conectado à rede Modbus deve ter configurações semelhantes.  Selecionei o endereço 11 para o dispositivo S2000-PP na rede Modbus (o endereço no sistema Orion é 2!). <br><br><img src="https://habrastorage.org/webt/ej/6y/31/ej6y31hxzfnze6nzx29rjcnsfwk.png"><br><br>  Em seguida, vamos para a guia "Dispositivos" e começamos a preencher a "Tabela de zonas": <br><br><ul><li>  a primeira coluna indicou "3" - este é o endereço do dispositivo S2000-KDL no sistema Orion; </li><li>  número do loop de alarme ("loop de alarme") - esses são os endereços dos sensores (na verdade, o loop de alarme = endereço, podemos pular vários endereços se não quisermos obter informações deles); </li><li>  Seção Modbus No. - você pode agrupar nossos sensores em grupos.  Para simplificar - eu não fiz isso e atribui a todos 1 seção; </li><li>  O tipo de zona é um parâmetro muito importante.  Nós o selecionamos de acordo com o tipo de sensor. </li></ul><br><img src="https://habrastorage.org/webt/8g/bo/ea/8gboea_ibzpk6nr04myidkbgtru.png"><br><br>  Após definir o S2000-PP, realizamos o "Registro de configuração no instrumento". <br><br>  Etapa 6. Combine C2000-PP e C2000-KDL em uma rede via RS-485 Orion, conecte os sensores ao C2000-KDL (você pode usar vários terminais) e conecte o adaptador RS-485 / USB à saída Modbus C2000-PP.  Definimos o jumper XP1 na posição fechada (importante: após a instalação do jumper, você deve reiniciar o dispositivo redefinindo a tensão de alimentação).  Tudo - o sistema está "pronto para a batalha". <br><br>  Verificamos a "operacionalidade" no programa de console gratuito <a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Modpoll Modbus Master Simulator</a> (doravante denominado "Modpoll"), por exemplo, no endereço de firmware "S2000-PP" ou enviando informações do S2000-KDL para "40000" - este é o primeiro sensor: <br><br><img src="https://habrastorage.org/webt/ij/hv/go/ijhvgoynxeyxwua5abdcgvapi3u.png"><br><br>  O firmware "para familiarização" pode ser baixado <a href="">aqui</a> . <br><br><h2>  Configuração do Zabbix </h2><br>  <font color="red">Aviso: Zabbix configurado pela primeira vez, como o Linux Mint (já que não há Zabbix no Windows) :)</font> <br><br>  Após instalar o Zabbix, você precisa instalar os pacotes <i>autoconf</i> , <i>automake</i> , <i>libtool</i> , <i>pkg-config</i> e, em seguida, o módulo de extensão - <i>libzbxmodbus</i> .  Há um artigo separado sobre ele no <a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Habré</a> (vou me referir constantemente a ele) e foi atualizado recentemente, apenas para trabalhar com o Zabbix 4.0.  O artigo também possui informações mais detalhadas sobre o protocolo Modbus.    -     <a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub</a> -. <br><br>        GitHub: <br><br><pre><code class="plaintext hljs">... ./configure --prefix=/etc/zabbix --enable-zabbix-3.2 ... sudo make install</code> </pre> <br>  Ao estudar a operação do módulo <i>libzbxmodbus</i> , ficou claro que não seria possível aplicar o circuito com o controle remoto C2000M, porque nesse caso os dados dos termohigrômetros são assim: escreva o número da zona desejada para registrar 46179 e, em seguida, colete dados do registro 46328 - ou seja,  muito não trivial (em sistemas SCADA "grandes", isso pode ser implementado, por exemplo, no MasterSCADA). <br><br>  No arquivo de configuração <i>etc / zabbix / zabbix_server.conf, escrevemos os</i> links de <i>extensão</i> e conectamos o hardware ao servidor com o Zabbix.  Não precisei instalar drivers para o adaptador RS-485 / USB, mas ainda não entendi como descobrir qual número de USB usar; é bom que a conexão com <i>/ dev / ttyUSB0 funcione</i> (você pode ver que o dispositivo foi encontrado no sistema usando o comando <i>lsusb</i> ). <br><br>  Como no Windows, verificamos usando o utilitário Modpoll (executei o linux i386) se o hardware está conectado e as informações disponíveis: <br><br><img src="https://habrastorage.org/webt/wn/8_/zz/wn8_zz98bldyf7hzc5zdkc90v80.png"><br><br>  Como o artigo descreve o processo de configuração usando o exemplo do Zabbix 2.2 - a interface é um pouco diferente, fornecerei explicações e imagens das configurações. <br><br><p>  Etapa 1. Criamos um nó de rede e um grupo no qual nossos nós serão incluídos (por exemplo, um nó - "Monitoramento Ambiental" e um grupo - "Infraestrutura de Engenharia"): <br>  Configurações&gt; Hosts&gt; Criar host&gt; Digite nossos nomes&gt; Adicionar <br><br><img src="https://habrastorage.org/webt/vj/cd/fi/vjcdfibmwzvcm7vudrfubf4nuaa.png"><br><br>  Etapa 2. Crie os elementos de dados.  O artigo recomenda a criação de modelos, mas como o nosso sistema não contém elementos duplicados, pularemos esta etapa.  Por exemplo, se tivéssemos vários condicionadores de ar conectados via Modbus, poderíamos usar a funcionalidade do sistema. <br><br>  Configurações&gt; Nós da rede&gt; Na linha que contém o nome do nosso nó "Monitoramento Ambiental", clique em "Elementos de Dados"&gt; na janela exibida, clique em "Criar Elemento de Dados". <br><br>  Começamos a "martelar" nossos sensores: <br><br><img src="https://habrastorage.org/webt/j_/ei/9n/j_ei9nphfowd7sgjp6r8u3r9xyk.png"><br><br>  Pequenas nuances: <br><br></p><ul><li>  o artigo usa a sintaxe da função <em>“modbus_read_registers”</em> e de acordo com a descrição do GitHub <em>“modbus_read”</em> - a segunda opção é mais curta e funciona; </li><li>  em vez das macros <em>{$ MODBUS_PORT}</em> e <em>{$ MODBUS_SLAVE},</em> você pode especificar a porta nos <em>formatos / dev / ttyUSB0</em> e " <em>11</em> ", mas isso será inconveniente se você precisar alterar posteriormente a porta USB ou o endereço do S2000-PP; </li><li>  a documentação declara que, para solicitar o status da zona (coluna "Modbus zone No.") no S2000-PP, você deve entrar em contato com: "endereço de registro 40000 + M, onde M = (zone No. –1)" - este é o progresso: "zone No. <strong>menos</strong> 1 " </li><li>  não faça uma pesquisa de tempo muito frequente: o S2000-PP começa a retornar um erro de “erro de exceção 15” - o dispositivo não tem tempo para preparar os dados (isso é expresso no brilho constante do indicador no dispositivo); </li><li>  para dados de temperatura e umidade com registros 3000 -... </li><li>  na janela "Elementos de dados" também há a guia "Pré-processamento" desejada.  Aqui você pode editar o que será mostrado "no final".  A temperatura e a umidade são obtidas a partir dos valores de leitura, que devem ser divididos por 256: “Fator do usuário” - 0,0039 (ou seja, 1/256); </li><li>  Para chaves de palheta discretas, sensores de vazamento, etc.  você também precisa usar a "exibição de valor", isso se deve ao modo como as informações são fornecidas. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Definir a conversão de dados em imagens</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/pj/g1/yr/pjg1yrlg-hfu83bgzuch6rke-xg.png"><br><br><img src="https://habrastorage.org/webt/k4/7o/hu/k47ohudcuf9ycomoxbdebii6kvu.png"><br></div></div><br>  Um pouco sobre como os dados são fornecidos ao pesquisar zonas. <br>  Suponha que você recebeu uma resposta no formato decimal 9148 (D).  Nós o traduziremos no formato hexadecimal (HEX): get 23BC - de acordo com as instruções para o dispositivo S2000-PP, estes são dois eventos com os códigos 23 (HEX) / 35 (D) e BC (HEX) / 188 (D).  A seguir, consulte a Tabela 5. “Lista de eventos (estados AL) do sistema Orion”.  Nele encontramos 35 "Restaurando a entrada tecnológica" e 188 "Restaurando a comunicação com a entrada".  Não há necessidade de converter D-HEX-D, o primeiro evento é a parte inteira da divisão do valor recebido por 256 e o ​​restante é o segundo evento ( <strong>9148</strong> = <strong>35</strong> * 256 + <strong>188</strong> ).  Ao entrevistar insumos tecnológicos, pegaremos apenas o primeiro evento (prioridade), que “deveria” levar os estados 35 e 36 (“Restaurando o insumo tecnológico” e “Violando o insumo tecnológico”).  Descartaremos a parte fracionária (segundo evento) usando a configuração do elemento de dados “Tipo de informação: numérico (número inteiro positivo)”. <br><br>  Etapa 3. Preencha as macros da porta e os números do dispositivo: <br>  Configurações&gt; Nós da rede&gt; "Monitoramento ambiental"&gt; selecione "Macros" <br><br><img src="https://habrastorage.org/webt/h1/r-/qg/h1r-qgd4rrdym-txvbmnhsqwgre.png"><br><br>  Etapa 4. Exibindo leituras no painel de controle: <br>  Tela inicial&gt; Todos os painéis, selecione "Criar painel"&gt; na janela exibida, defina "Nome do painel" e o usuário para quem este painel estará disponível&gt; Clique em "Criar um novo widget"&gt; Digite "Visão geral dos dados", Intervalo de atualização "10 segundos", Grupos nós da rede Engineering Infrastructure&gt; Adicionar&gt; Ajustar tamanho do painel e clique em "Salvar alterações": <br><br><img src="https://habrastorage.org/webt/wl/ge/la/wlgelajwrwuuta5phssi2b5rx38.gif"><br><br><h2>  Conclusão </h2><br>  O sistema resultante, através do uso de protocolos de "longo alcance", pode ser uma excelente solução, tanto para monitorar o servidor quanto um par de zonas de escritórios cruzadas (em termos de monitoramento das condições de temperatura e umidade) ou até mesmo um pequeno data center.  Alguém pode dizer: “fu fu fu, o carro ainda é nojento, você precisa usar o XXX (substitua algo da automação industrial)” também é uma opção, mas, na minha opinião, será muito redundante e também mais caro .  E uma pequena nuance: como você pode ver, o sistema no Bolid é bastante simples (embora exista uma lógica um tanto estranha), mas “termina” a decisão no baile.  controladores - às vezes ele ainda é um "viciado". <br><br>  PS Este artigo é uma adaptação de dois artigos no meu blog: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Monitoramento barato para a sala do servidor (parte 1 - introdutória)</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Monitoramento barato para a sala do servidor (parte 2 - prático)</a> <br><br>  UPD  Depois de trabalhar por 3 dias, o adaptador RS485-USB caiu.  É reconhecido como instável, mas adequado para comissionamento.  Foi substituído por um conversor de porta única MGate MB3170 fabricado pela MOXA (retirado do que estava à mão) - tudo ficou estável. <br>  Você precisa entender que este artigo é apenas um exemplo de como "fazer amizade" com o Zabbix e o Bolid.  Para uma implementação real, você pode adicionar mais estados DPS monitorados, bem como, por exemplo, temperaturas negativas (eles são processados ​​de maneira um pouco diferente). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt438788/">https://habr.com/ru/post/pt438788/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt438774/index.html">Tudo de bom de uma só vez. Os artigos mais vívidos do blog da LANIT em Habré - 2018</a></li>
<li><a href="../pt438776/index.html">Dicas e truques do meu canal de telegrama @pythonetc, janeiro de 2019</a></li>
<li><a href="../pt438778/index.html">@Pythonetc janeiro de 2019</a></li>
<li><a href="../pt438782/index.html">O FSB propôs o lançamento de cartões SIM russos e usa criptografia doméstica para 5G</a></li>
<li><a href="../pt438784/index.html">Problemas ao usar o serviço Yandex.Metrica</a></li>
<li><a href="../pt438790/index.html">A troca de criptomoedas QuadrigaCX não doará US $ 137 milhões, apenas o diretor sabia a senha da loja e ele morreu.</a></li>
<li><a href="../pt438792/index.html">Usando todas as matrizes Flash do AccelStor em projetos VDI</a></li>
<li><a href="../pt438794/index.html">Detalhes do objeto JavaScript</a></li>
<li><a href="../pt438796/index.html">Parte 1 do Docker de aprendizagem: o básico</a></li>
<li><a href="../pt438798/index.html">Como trabalhar com dados de inteligência cibernética: aprendemos a coletar e identificar indicadores de comprometimento do sistema</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>