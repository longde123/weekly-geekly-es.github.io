<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😈 🌕 👩🏽‍🌾 Benutzer in Docker 🆒 🏇 🚶🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Andrey Kopylov , unser technischer Direktor, liebt, nutzt und fördert Docker. In einem neuen Artikel spricht er darüber, wie Benutzer in Docker erstel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Benutzer in Docker</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448480/"><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Andrey Kopylov</a> , unser technischer Direktor, liebt, nutzt und fördert Docker.  In einem neuen Artikel spricht er darüber, wie Benutzer in Docker erstellt werden.  Korrigieren Sie die Arbeit mit ihnen, warum Benutzer nicht mit Root-Rechten belassen werden können und wie das Problem der Nichtübereinstimmung von Bezeichnern in der Docker-Datei gelöst werden kann. </p><a name="habracut"></a><br><p>  Alle Prozesse im Container werden als root ausgeführt, sofern nicht anders angegeben.  Es scheint sehr praktisch, da dieser Benutzer keine Einschränkungen hat.  Aus diesem Grund ist das Arbeiten unter der Wurzel aus Sicherheitsgründen falsch.  Wenn auf dem lokalen Computer niemand, der bei klarem Verstand ist, mit Root-Rechten arbeitet, starten viele Prozesse unter dem Root in Containern. </p><br><p>  Es gibt immer Fehler, die es der Malware ermöglichen, aus dem Container auf den Host-Computer zu gelangen.  Unter der Annahme des Schlimmsten müssen wir sicherstellen, dass Prozesse innerhalb des Containers von einem Benutzer gestartet werden, der keine Rechte auf dem Hostcomputer hat. </p><br><h2>  Benutzererstellung </h2><br><p>  Das Erstellen eines Benutzers in einem Container unterscheidet sich nicht vom Erstellen in Linux-Distributionen.  Bei unterschiedlichen Grundbildern können die Teams jedoch variieren. </p><br><p>  Für debian-basierte Distributionen in der Docker-Datei müssen Sie Folgendes hinzufügen: </p><br><br><pre><code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">RUN</span></span> groupadd --gid <span class="hljs-number"><span class="hljs-number">2000</span></span> node \ &amp;&amp; useradd --uid <span class="hljs-number"><span class="hljs-number">2000</span></span> --gid node --shell /bin/bash --create-home node</code> </pre> <br><p>  Für Alpen: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">RUN</span></span> addgroup -g <span class="hljs-number"><span class="hljs-number">2000</span></span> node \ &amp;&amp; adduser -u <span class="hljs-number"><span class="hljs-number">2000</span></span> -G node -s /bin/sh -D node</code> </pre><br><h2>  Prozesse vom Benutzer aus starten </h2><br><p>  Führen Sie Folgendes aus, um alle nachfolgenden Prozesse von einem Benutzer mit UID 2000 aus zu starten: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">USER</span></span> <span class="hljs-number"><span class="hljs-number">2000</span></span></code> </pre> <br><p>  Führen Sie Folgendes aus, um alle nachfolgenden Prozesse vom Benutzerknoten aus zu starten: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">USER</span></span> node</code> </pre> <br><p>  Weitere Details in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> . </p><br><h2>  Mounten von Volumes </h2><br><p>  Bieten Sie dem Benutzer beim Mounten von Volumes in einem Container die Möglichkeit, Dateien zu lesen und / oder zu schreiben.  Dazu muss die UID (GID) des Benutzers im Container und des Benutzers außerhalb des Containers, der über die entsprechenden Zugriffsrechte auf die Datei verfügt, übereinstimmen.  Gleichzeitig spielen Benutzernamen keine Rolle. </p><br><p>  Auf einem Linux-Computer sind die Benutzer-UID und die GID häufig 1000. Diese Kennungen werden dem ersten Computerbenutzer zugewiesen. </p><br><p>  Das Erhalten Ihrer Kennungen ist einfach: </p><br><pre> <code class="nginx hljs">id</code> </pre> <br><p>  Sie erhalten umfassende Informationen über Ihren Benutzer. <br>  Ersetzen Sie 2000 der Beispiele durch Ihre Kennung und alles wird gut. </p><br><h2>  Weisen Sie Benutzer-UID und GID zu </h2><br><p>  Wenn der Benutzer früher erstellt wurde, die Bezeichner jedoch geändert werden müssen, können Sie dies folgendermaßen tun: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">RUN</span></span> usermod -u <span class="hljs-number"><span class="hljs-number">1000</span></span> node \ &amp;&amp; groupmod -g <span class="hljs-number"><span class="hljs-number">1000</span></span> node</code> </pre><br><p>  Wenn Sie das grundlegende Alpenbild verwenden, müssen Sie das Schattenpaket installieren: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">RUN</span></span> apk add —<span class="hljs-literal"><span class="hljs-literal">no</span></span>-cache shadow</code> </pre> <br><h2>  Übergabe der Benutzer-ID innerhalb des Containers beim Erstellen des Bildes </h2><br><p>  Wenn Ihre Kennung und die Kennungen aller Personen, die an dem Projekt arbeiten, identisch sind, geben Sie diese Kennung einfach in der Docker-Datei an.  Häufig stimmen die Benutzerkennungen jedoch nicht überein. </p><br><p>  Wie man das Gewünschte realisiert, ist nicht sofort klar.  Für mich war es am schwierigsten, Docker zu beherrschen.  Viele Docker-Benutzer glauben nicht, dass es verschiedene Phasen im Leben eines Bildes gibt.  Zunächst wird das Bild dazu mit der Docker-Datei gesammelt.  Wenn Sie einen Container von einem Dockerfile-Image aus starten, wird er nicht mehr verwendet. </p><br><p>  Die Erstellung von Benutzern sollte beim Erstellen des Bildes erfolgen.  Gleiches gilt für die Benutzerdefinition, von der aus Prozesse gestartet werden.  Dies bedeutet, dass wir die UID (GID) irgendwie in den Container übergeben müssen. </p><br><p>  Die Anweisungen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ENV</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ARG</a> werden verwendet, um externe Variablen in der Docker-Datei zu verwenden.  Einen detaillierten Vergleich der Richtlinien finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . </p><br><p>  Dockerfile </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">ARG</span></span> UID=<span class="hljs-number"><span class="hljs-number">1000</span></span> ARG GID=<span class="hljs-number"><span class="hljs-number">1000</span></span> ENV UID=<span class="hljs-variable"><span class="hljs-variable">${UID}</span></span> ENV GID=<span class="hljs-variable"><span class="hljs-variable">${GID}</span></span> RUN usermod -u <span class="hljs-variable"><span class="hljs-variable">$UID</span></span> node \ &amp;&amp; groupmod -g <span class="hljs-variable"><span class="hljs-variable">$GID</span></span> node</code> </pre><br><p>  Sie können Argumente über Docker-Compose wie folgt übergeben: </p><br><p>  Docker-Compose </p><br><pre> <code class="nginx hljs">build: context: ./src/<span class="hljs-attribute"><span class="hljs-attribute">backend</span></span> args: UID: <span class="hljs-number"><span class="hljs-number">1000</span></span> GID: <span class="hljs-number"><span class="hljs-number">1000</span></span></code> </pre><br><p>  PS Um alle Tricks von Docker zu beherrschen, reicht es nicht aus, Dokumentation oder Artikel zu lesen.  Sie müssen viel üben, Sie müssen den Hafenarbeiter fühlen. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de448480/">https://habr.com/ru/post/de448480/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de448470/index.html">Content Marketing in den USA, Lateinamerika und Asien: Nützliche Tipps, Links und Tools für die Budgetförderung</a></li>
<li><a href="../de448472/index.html">Wie aus PROCESS_DUP_HANDLE PROCESS_ALL_ACCESS wird</a></li>
<li><a href="../de448474/index.html">Wir suchen nach Speicherlecks in Python-Anwendungen</a></li>
<li><a href="../de448476/index.html">Erweitern der WDS-Funktionalität: Hinzufügen von Download-Funktionen zu UEFI</a></li>
<li><a href="../de448478/index.html">Mondmission „Bereshit“ - vorläufige Unfallursache bekannt gegeben</a></li>
<li><a href="../de448482/index.html">Werksprüfung eines modularen Rechenzentrums</a></li>
<li><a href="../de448484/index.html">Wurzelmikroben</a></li>
<li><a href="../de448486/index.html">"Im November 2018 sind wir fälschlicherweise an allen Fronten in Spam geraten." Wie ich Mailings von einem Unternehmen mit einer millionsten Basis gespeichert habe</a></li>
<li><a href="../de448488/index.html">Angst und Abscheu vor DevSecOps</a></li>
<li><a href="../de448490/index.html">So starten Sie die DevOps-Transformation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>