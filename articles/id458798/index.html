<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ“´ ğŸµï¸ ğŸ‘¡ Bot Nutrient atau cara saya ingin mengambil roti dari pelatih kebugaran ğŸ‘§ğŸ½ ğŸ¤³ğŸ» #âƒ£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya! Semua pengembang pernah dihadapkan dengan keinginan untuk melakukan sesuatu untuk diri mereka sendiri, dan bahkan nilai material dari p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bot Nutrient atau cara saya ingin mengambil roti dari pelatih kebugaran</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458798/"> Halo semuanya!  Semua pengembang pernah dihadapkan dengan keinginan untuk melakukan sesuatu untuk diri mereka sendiri, dan bahkan nilai material dari produk tersebut menjadi tidak penting, hal utama adalah ia bekerja sendiri.  Buzz. <br><br>  Jadi, sebagai liburan Mei tunggal, saya ingin menggabungkan pengetahuan pengkodean dan beberapa lainnya, penting, dalam satu proyek.  Ternyata, menurut pendapat saya, layanan yang menarik yang ingin saya berikan kehidupan dan bicarakan. <br><br>  Saya bukan ahli gizi, bukan atlet profesional dan, tentu saja, saya tidak berpura-pura bahwa mereka akan mempercayai saya tanpa pertanyaan.  Tetapi, suatu kali, saya sangat tertarik dengan topik nutrisi yang tepat, dan saya mulai mempelajari artikel, berkomunikasi dengan pelatih keren di aula yang saya kunjungi, dan memperhatikan hal seperti itu: orang menghabiskan cukup banyak uang untuk membuat rencana nutrisi. <br><br>  Dan saya memutuskan: tetapi saya akan membuat sistem yang secara otomatis akan menghitung produk orang dalam gram, tergantung pada tujuan dan parameternya. <br><br>  Karena saya seorang pengembang backend, saya jarang menemukan front, saya memikirkannya dan memutuskan untuk membuat bot.  Pilihan messenger dipengaruhi oleh beberapa faktor: permintaan dan ketersediaan sistem pembayaran.  Jejaring sosial Vkontakte muncul. <br><br>  Untuk perhitungan, saya menggunakan rumus Harris-Benedict.  Saya memperhitungkan parameter input seperti itu (yang dimasuki pengguna bot): <br><br><ul><li>  Berat </li><li>  Pertumbuhan </li><li>  Sasaran (menurunkan berat badan / menambah berat badan / mempertahankan) </li><li>  Aktivitas fisik (semua informasi tersedia dan standar untuk perhitungan sesuai dengan rumus Harris-Benedict) </li><li>  Toleransi laktosa </li><li>  Gender </li></ul><br>  Membuat database produk di mana produk memiliki bidang: Protein, Lemak, Karbohidrat, Kcal, GI (indeks glikemik), serta konten laktosa.  Secara umum, saya ingin daftar dan komentar sepanjang jalan. <br><br>  Vkontakte memiliki <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">API yang</a> dapat diakses dan dimengerti <br><br>  Digunakan bahasa PHP. <br><a name="habracut"></a><br>  Pertama, saya mengidentifikasi beberapa fungsi dan konstanta yang diperlukan: <br><br><pre><code class="php hljs">header(<span class="hljs-string"><span class="hljs-string">'Content-Type: text/html; charset=utf-8'</span></span>); $request = file_get_contents(<span class="hljs-string"><span class="hljs-string">"php://input"</span></span>); $input = json_decode($request, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); define(<span class="hljs-string"><span class="hljs-string">'VK_API_VERSION'</span></span>, <span class="hljs-string"><span class="hljs-string">'5.95'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  API define('VK_API_ENDPOINT', "https://api.vk.com/method/"); //     API function _vkApi_call($method, $params = array()) { $params['access_token'] = //    ,        ; $params['v'] = VK_API_VERSION; $url = VK_API_ENDPOINT.$method.'?'.http_build_query($params); $curl = curl_init($url); curl_setopt($curl, CURLOPT_RETURNTRANSFER, true); $json = curl_exec($curl); curl_close($curl); $response = json_decode($json, true); return $response['error']['error_msg']; $err=$response['error']['error_msg']; } //   messages.send function vkApi_messagesSend($peer_id, $message) { return _vkApi_call('messages.send', array( 'peer_id' =&gt; $peer_id, 'user_id' =&gt; $peer_id, 'message' =&gt; $message, 'random_id' =&gt; rand(), 'qroup_id' =&gt; //      () ));} //      function vkApi_buttonSend($peer_id, $message,$button) { return _vkApi_call('messages.send', array( 'peer_id' =&gt; $peer_id, 'user_id' =&gt; $peer_id, 'message' =&gt; $message, 'random_id' =&gt; rand(), 'keyboard' =&gt; $button, 'qroup_id' =&gt; //      () ));}</span></span></code> </pre> <br>  Dalam pengaturan bot, Anda menentukan tautan ke skrip Anda (webhook).  Omong-omong, di VK API, Anda dapat menggunakan dua metode untuk menerima pesan.  Saya menggunakan webhooks.  Menurut saya itu lebih nyaman, lebih akrab. <br><br>  Selanjutnya, saya memproses json yang dihasilkan. <br><br><pre> <code class="php hljs">$test_type=$input[<span class="hljs-string"><span class="hljs-string">'type'</span></span>]; $test_group_id=$input[<span class="hljs-string"><span class="hljs-string">'group_id'</span></span>]; $user_id=$input[<span class="hljs-string"><span class="hljs-string">'object'</span></span>][<span class="hljs-string"><span class="hljs-string">'user_id'</span></span>]; $text=$input[<span class="hljs-string"><span class="hljs-string">'object'</span></span>][<span class="hljs-string"><span class="hljs-string">'body'</span></span>]; $text_body=explode(<span class="hljs-string"><span class="hljs-string">" "</span></span>, $text); $vk_pay=$text_body[<span class="hljs-number"><span class="hljs-number">0</span></span>]; $caption=$input[<span class="hljs-string"><span class="hljs-string">'object'</span></span>][<span class="hljs-string"><span class="hljs-string">'attachments'</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">'link'</span></span>][<span class="hljs-string"><span class="hljs-string">'caption'</span></span>]; $url=$input[<span class="hljs-string"><span class="hljs-string">'object'</span></span>][<span class="hljs-string"><span class="hljs-string">'attachments'</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">'link'</span></span>][<span class="hljs-string"><span class="hljs-string">'url'</span></span>]; $str3=$input[<span class="hljs-string"><span class="hljs-string">'object'</span></span>][<span class="hljs-string"><span class="hljs-string">'attachments'</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">'link'</span></span>][<span class="hljs-string"><span class="hljs-string">'title'</span></span>]; $str2 = explode(<span class="hljs-string"><span class="hljs-string">" "</span></span>, $str3); $money =(int)$str2[<span class="hljs-number"><span class="hljs-number">0</span></span>]; $money=strstr($str3, <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $money=(int)$money;</code> </pre><br>  Karena VK memiliki sistem pembayaran, saya membayangkan pembayaran melalui pembayaran VK (server VK mengirim permintaan seperti itu ke webhook Anda, tetapi hanya jika publik Anda diindikasikan sebagai TOKO dan ada PRODUK yang dapat dibayar melalui pembayaran VK), serta pembayaran tunai sederhana terjemahan yang bisa dilampirkan ke pesan. <br><br>  Saya menyimpan setiap pengguna yang menulis sesuatu ke bot dalam database, dan kemudian semua komunikasi dengan bot berlangsung tergantung pada pembayaran.  Jika tidak ada pembayaran, bot akan mengatakan bahwa Anda harus membayar terlebih dahulu, jika pembayaran telah terjadi, ia akan memberi tahu Anda apa yang harus dilakukan selanjutnya.  Untuk pengujian, Anda dapat memasukkan pesan apa pun ke bot untuk direncanakan. <br><br>  Setelah pembayaran, bot akan meminta parameter yang diperlukan untuk perhitungan, menyimpan semuanya dalam database untuk pengguna tertentu, dan setelah semua informasi yang diterima, saya mempertimbangkan dan memberikan jawaban.  Saya mengirim pesan menggunakan fungsi yang dibuat, menunjukkan user_id dari pengguna: <br><br><pre> <code class="php hljs">vkApi_messagesSend($user_id, <span class="hljs-string"><span class="hljs-string">'!   ?'</span></span>);</code> </pre><br>  Ini juga memperhitungkan saat pengguna memasukkan beberapa informasi secara tidak benar: dalam hal ini, Anda perlu mengirim nomor 404 ke bot, dan itu akan mulai bertanya terlebih dahulu, mengatur ulang data dalam database. <br><br>  Untuk beberapa pesan, saya merasa nyaman untuk membuat tombol, ketika saya mengkliknya, sebuah pesan dengan teks yang ditunjukkan pada tombol itu terbang kepada saya di webhook. <br><br><pre> <code class="php hljs">$buttons=<span class="hljs-string"><span class="hljs-string">'{ "one_time":true, "buttons":[[{ "action":{ "type":"text", "payload":"{\"button\": \"1\"}", "label":" " }, "color":"primary" }, { "action":{ "type":"text", "payload":"{\"button\": \"2\"}", "label":" " }, "color":"primary"}]]}'</span></span>; vkApi_buttonSend($user_id,<span class="hljs-string"><span class="hljs-string">' '</span></span>,$buttons) ;</code> </pre><br>  Dan kemudian semua kesenangan!  Setelah data terkumpul, perhitungan itu sendiri terjadi.  Saya sendiri tidak menciptakan apa pun, saya hanya membuat formula yang tepat, berdasarkan rumus Harris-Benedict, serta pengetahuan di bidang nutrisi yang tepat (jumlah makanan, persentase distribusi protein / lemak / karbohidrat untuk resepsi ini, dll. Adalah penting di sini). <br><br>  Secara umum, hal-hal seperti ini: <br><br><pre> <code class="php hljs">$BMR=<span class="hljs-number"><span class="hljs-number">88.363</span></span>+(<span class="hljs-number"><span class="hljs-number">13.397</span></span>*$weight)+(<span class="hljs-number"><span class="hljs-number">4.799</span></span>*$height)-(<span class="hljs-number"><span class="hljs-number">5.677</span></span>*$age); $BMR_AMR=$BMR*<span class="hljs-number"><span class="hljs-number">1.2</span></span><span class="hljs-number"><span class="hljs-number">-500</span></span>; $b_kkal=<span class="hljs-number"><span class="hljs-number">0.35</span></span>*$BMR_AMR; $b_gr=$b_kkal/<span class="hljs-number"><span class="hljs-number">4</span></span>; $g_kkal=<span class="hljs-number"><span class="hljs-number">0.3</span></span>*$BMR_AMR; $g_gr=$g_kkal/<span class="hljs-number"><span class="hljs-number">9</span></span>; $u_kkal=<span class="hljs-number"><span class="hljs-number">0.35</span></span>*$BMR_AMR; $u_gr=$u_kkal/<span class="hljs-number"><span class="hljs-number">4</span></span>; $break_b=<span class="hljs-number"><span class="hljs-number">0.15</span></span>*$b_gr; $break_u=<span class="hljs-number"><span class="hljs-number">0.25</span></span>*$u_gr; $break_g=<span class="hljs-number"><span class="hljs-number">0.25</span></span>*$g_gr; $break_kk=<span class="hljs-number"><span class="hljs-number">0.25</span></span>*$BMR_AMR; $snack_b=<span class="hljs-number"><span class="hljs-number">0.1</span></span>*$b_gr; $snack_u=<span class="hljs-number"><span class="hljs-number">0.1</span></span>*$u_gr; $snack_g=<span class="hljs-number"><span class="hljs-number">0.15</span></span>*$g_gr; $snack_kk=<span class="hljs-number"><span class="hljs-number">1</span></span>*$BMR_AMR; $snack2_b=<span class="hljs-number"><span class="hljs-number">0.05</span></span>*$b_gr; $snack2_u=<span class="hljs-number"><span class="hljs-number">0.05</span></span>*$u_gr; $snack2_kk=<span class="hljs-number"><span class="hljs-number">0.05</span></span>*$BMR_AMR; $lunch_b=<span class="hljs-number"><span class="hljs-number">0.45</span></span>*$b_gr; $lunch_u=<span class="hljs-number"><span class="hljs-number">0.4</span></span>*$u_gr; $lunch_g=<span class="hljs-number"><span class="hljs-number">0.4</span></span>*$g_gr; $lunch_kk=<span class="hljs-number"><span class="hljs-number">0.4</span></span>*$BMR_AMR; $dinner_b=<span class="hljs-number"><span class="hljs-number">0.25</span></span>*$b_gr; $dinner_u=<span class="hljs-number"><span class="hljs-number">0.2</span></span>*$u_gr; $dinner_g=<span class="hljs-number"><span class="hljs-number">0.2</span></span>*$g_gr; $dinner_kk=<span class="hljs-number"><span class="hljs-number">0.2</span></span>*$BMR_AMR;</code> </pre><br>  Oleh karena itu, untuk orang-orang dengan gaya hidup yang tidak aktif dan orang-orang dengan hiperaktif, akan ada faktor-faktor lain, saya memberikan contoh kecil. <br><br>  Setelah menghitung BZHU dan KKAL saya mengumpulkan satu set produk.  Ngomong-ngomong, jika setelah rencana nutrisi yang diterima Anda memasukkan angka 404 dan memulai lagi (kemungkinan berat badan turun / bertambah, perubahan gaya hidup, dll.), Rangkaian produk akan berubah secara acak.  Dan sekarang Anda memiliki rencana nutrisi yang berbeda! <br><br>  Akibatnya, kami mendapat layanan seperti itu di sini (saya secara resmi mempostingnya untuk pengujian, pengembang adalah pemula, dan saya sendiri tidak dapat menangkap semua bug saya jika mereka tiba-tiba ada): <br><br><div class="spoiler">  <b class="spoiler_title">tangkapan layar bot</b> <div class="spoiler_text"><table border="1"><tbody><tr><td><img src="https://habrastorage.org/webt/qy/mv/hr/qymvhrailyruujlwrvsesgmev1a.jpeg" alt="gambar" width="260"></td><td><img src="https://habrastorage.org/webt/6c/gc/b6/6cgcb65wzabxqnwzay24aug2vmm.jpeg" alt="gambar" width="260"></td></tr><tr><td><img src="https://habrastorage.org/webt/5g/yu/gk/5gyugkfknyncnta50ax3tgjlvpi.jpeg" alt="gambar" width="260"></td><td><img src="https://habrastorage.org/webt/ed/l0/g_/edl0g_ncvpj3v2gduo8mqawmy2q.jpeg" alt="gambar" width="260"></td></tr></tbody></table></div><br></div><br><h3>  Dari kesalahan yang saya perhatikan (perlu diperbaiki): </h3><br><ul><li>  Tombol tidak langsung terbuka.  Anda perlu menemukan ikon keyboard di dekat tombol "kirim".  Ini benar-benar membingungkan orang, dan mereka salah menulis (jika tombol ditekan, maka saya memproses teks dari tombol, data yang dimasukkan pengguna diabaikan). </li><li>  Bukan basis data produk yang sangat besar, dihadapkan pada kenyataan bahwa tidak ada yang akan memakan ini. </li></ul><br>  Bagi yang ingin menguji dan melihat tautan ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">publik</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id458798/">https://habr.com/ru/post/id458798/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id458788/index.html">Template khusus di GTM: contoh</a></li>
<li><a href="../id458790/index.html">Pengantar CatBoost. Laporan Yandex</a></li>
<li><a href="../id458792/index.html">Karyawan "Terbakar": apakah ada jalan keluar?</a></li>
<li><a href="../id458794/index.html">Rapat Analis Bisnis di Redmadrobot 18 Juli</a></li>
<li><a href="../id458796/index.html">Cara menyiapkan situs Anda untuk beban kerja yang berat: 5 tips praktis dan alat yang berguna</a></li>
<li><a href="../id458800/index.html">Pembelajaran yang mendalam. Pembelajaran Federasi</a></li>
<li><a href="../id458804/index.html">Intisari Artikel Pembelajaran Mesin dan Kecerdasan Buatan</a></li>
<li><a href="../id458808/index.html">Laporan postmortem Habr: surat kabar jatuh</a></li>
<li><a href="../id458810/index.html">Corel dan Parallels dijual ke grup investasi KKR dari AS</a></li>
<li><a href="../id458812/index.html">JVM TI: cara membuat plugin untuk mesin virtual</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>