<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõ∂ üë©üèº‚Äçü§ù‚Äçüë®üèª üñ®Ô∏è Carteira Apple O que √© e como integrar seu cart√£o nele üåø üéÆ üë©üèø‚Äçü§ù‚Äçüë®üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="√â geralmente aceito que o Wallet n√£o √© o servi√ßo mais popular na CEI. Mas j√° no segundo projeto consecutivo, o cliente define a tarefa "Tornar a integ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Carteira Apple O que √© e como integrar seu cart√£o nele</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/agima/blog/428437/"><p>  √â geralmente aceito que o Wallet n√£o √© o servi√ßo mais popular na CEI.  Mas j√° no segundo projeto consecutivo, o cliente define a tarefa "Tornar a integra√ß√£o com o Wallet".  Portanto, decidi escrever este artigo para falar sobre o servi√ßo como um todo e mostrar como integrar meu produto a ele. </p><br><p>  O que √© uma carteira?  Ele permite que voc√™ mantenha v√°rios tipos de cart√µes em seu telefone (ingressos, cart√µes de desconto etc.), facilitando a vida dos usu√°rios do produto.  Al√©m disso, √© poss√≠vel atualizar informa√ß√µes sobre o mapa por meio de notifica√ß√µes push, mas este √© um t√≥pico para um artigo separado.  Mas se voc√™ possui um cart√£o / ticket / assinatura que pode ser integrado ao telefone, existe uma solu√ß√£o!  Como faz√™-lo - leia abaixo. </p><a name="habracut"></a><br><p> Como regra, seu servidor √© respons√°vel por criar o mapa.  O aplicativo recebe o cart√£o na forma de um arquivo .pkpass e, por meio do aplicativo, o usu√°rio pode adicionar o cart√£o √† Carteira virtual. </p><br><h2 id="struktura-karty">  Estrutura do mapa </h2><br><p>  Qual √© o mapa do ponto de vista do desenvolvedor?  Um mapa √© um arquivo com a extens√£o .pkpass.  Ele cont√©m todos os dados necess√°rios para a exibi√ß√£o e opera√ß√£o do cart√£o.  O conte√∫do do arquivo est√° na tabela abaixo. </p><br><table><tbody><tr><th>  Ficheiro </th><th>  Nomea√ß√£o </th></tr><tr><td>  background.png </td><td>  Imagem de fundo para o cart√£o. </td></tr><tr><td>  footer.png </td><td>  Imagem ao lado do c√≥digo de barras </td></tr><tr><td>  icon.png </td><td>  √çcone para notifica√ß√µes e cartas </td></tr><tr><td>  logo.png </td><td>  Logotipo do cart√£o  Superior esquerdo exibido </td></tr><tr><td>  manifest.json </td><td>  Registro de todos os arquivos inclu√≠dos </td></tr><tr><td>  assinatura </td><td>  Assinatura PKCS7 </td></tr><tr><td>  pass.json </td><td>  Informa√ß√µes sobre apar√™ncia e mapa </td></tr><tr><td>  strip.png </td><td>  Imagem localizada atr√°s da descri√ß√£o principal do cart√£o </td></tr><tr><td>  thumbnail.png </td><td>  Imagem adicional (especifique) </td></tr></tbody></table><br><p>  Os seguintes tipos de cart√µes est√£o dispon√≠veis: </p><br><ul><li>  <b>Bilhete de embarque:</b> de avi√£o ou trem.  Normalmente, o cupom funciona para uma viagem; </li><li>  <b>Cupom:</b> para cupons e ofertas especiais; </li><li>  <b>Bilhete de evento:</b> pode funcionar tanto para um evento quanto para uma temporada inteira; </li><li>  <b>Cart√£o de desconto:</b> cart√µes de fidelidade, cart√µes de desconto ou presente; </li><li>  <b>Cart√£o de vis√£o geral:</b> se nenhuma das op√ß√µes acima se aplica ao seu caso: por exemplo, um cart√£o para viajar de metr√¥ ou um passe para a academia. </li></ul><br><p>  Considere esquematicamente a apar√™ncia de diferentes cart√µes.  As fotos s√£o melhor nomeadas, conforme indicado na tabela acima. </p><br><h3>  Cart√£o de embarque </h3><br><img src="https://habrastorage.org/webt/8m/s6/cy/8ms6cyz55rve1igxt_xfv2e034i.png"><br><h3>  Cup√£o </h3><br><img src="https://habrastorage.org/webt/-r/l-/dk/-rl-dknkbsqnkuim5-kqog6ceuu.png"><br><h3>  Bilhete de Evento </h3><br><img src="https://habrastorage.org/webt/rr/r9/jh/rrr9jh2ho29rfmht7xrf0z7pmes.png"><br><h3>  Cart√£o comunit√°rio </h3><br><img src="https://habrastorage.org/webt/az/zc/hg/azzchgo25cvpj_gcu_oof1vh1k8.png"><br><h3>  Cart√£o de desconto </h3><br><img src="https://habrastorage.org/webt/zl/zt/ft/zlztft7igalmerx8rhabnxorwfc.png"><br><h1 id="struktura-passjson">  Estrutura Pass.json </h1><br><p>  Campos obrigat√≥rios.  Cont√©m ID do tipo de passe, ID da equipe, nome da organiza√ß√£o etc. <br>  Chaves para aplicativos relacionados.  Necess√°rio para exibir aplicativos que precisam ser "associados" ao mapa. <br>  Tecla cart√µes "data de validade". <br>  Chaves de relev√¢ncia.  Por exemplo, as coordenadas da √°rea em que o mapa pode ser usado ou o in√≠cio do evento a que se destina. <br>  A chave √© o estilo.  No in√≠cio do artigo, foram listados 5 tipos de cart√µes para o Wallet.  Cada um deles tem seu pr√≥prio estilo.  Essa chave deve ser estritamente uma. <br>  Teclas para o design visual do cart√£o.  Al√©m do √≥bvio, eles cont√™m informa√ß√µes sobre o c√≥digo de barras exibido no mapa. <br>  Chaves de servi√ßo da Web.  Voc√™ pode usar servi√ßos da web para interagir com o mapa, por exemplo, atualiz√°-lo automaticamente. <br>  Teclas NFC.  Cont√©m informa√ß√µes adicionais para transa√ß√µes do Apple Pay. </p><br><p>  Agora, sobre tudo em mais detalhes. </p><br><h2>  Campos obrigat√≥rios </h2><br><table><tbody><tr><th>  <nobr>Chave em JSON</nobr> </th><th>  <nobr>Tipo de dados</nobr> </th><th>  <nobr>Descri√ß√£o do produto</nobr> </th></tr><tr><td>  descri√ß√£o </td><td>  String <br>  Localizada </td><td>  Uma breve descri√ß√£o do mapa.  Localizado. </td></tr><tr><td>  formatVersion </td><td>  Int </td><td>  Vers√£o em formato de arquivo.  O valor deve ser 1. </td></tr><tr><td>  <nobr>organizationName</nobr> </td><td>  String <br>  Localizada </td><td>  O nome da organiza√ß√£o que emite os cart√µes. </td></tr><tr><td>  <nobr>passTypeIdentifier</nobr> </td><td>  String </td><td>  Passe o ID do tipo e a conta de desenvolvedor. </td></tr><tr><td>  <nobr>serialNumber</nobr> </td><td>  String </td><td>  N√∫mero de s√©rie do cart√£o √∫nico </td></tr><tr><td>  <nobr>teamIdentifier</nobr> </td><td>  String </td><td>  ID da equipe de desenvolvimento </td></tr></tbody></table><br><h2>  Chaves para aplicativos relacionados </h2><br><table><tbody><tr><th>  <nobr>Chave em JSON</nobr> </th><th>  <nobr>Tipo de dados</nobr> </th><th>  <nobr>Descri√ß√£o do produto</nobr> </th></tr><tr><td>  <nobr>AssociatedStoreIdentifiers</nobr> </td><td>  [Int] </td><td>  Opcionalmente.  O ID dos aplicativos associados ao cart√£o.  O primeiro que √© compat√≠vel com o dispositivo atual √© sempre utilizado. </td></tr><tr><td>  <nobr>appLaunchURL</nobr> </td><td>  String </td><td>  URL que √© passado para o aplicativo na abertura </td></tr></tbody></table><br><h2>  Teclas de estilo </h2><br><table><tbody><tr><th>  <nobr>Chave em JSON</nobr> </th><th>  <nobr>Tipo de dados</nobr> </th><th>  <nobr>Descri√ß√£o do produto</nobr> </th></tr><tr><td>  <nobr>primaryFields</nobr> </td><td>  [JSON] </td><td>  Informa√ß√µes b√°sicas sobre o mapa. </td></tr><tr><td>  <nobr>campos secund√°rios</nobr> </td><td>  [JSON] </td><td>  Informa√ß√µes b√°sicas. </td></tr><tr><td>  <nobr>auxiliarryFields</nobr> </td><td>  [JSON] </td><td>  Campos para informa√ß√µes adicionais.  Opcional </td></tr><tr><td>  <nobr>headerFields</nobr> </td><td>  [JSON] </td><td>  O t√≠tulo do mapa.  √â exibido mesmo quando os cart√µes est√£o vis√≠veis na lista. </td></tr><tr><td>  <nobr>auxiliarryFields</nobr> </td><td>  [JSON] </td><td>  Informa√ß√µes b√°sicas sobre o mapa. </td></tr><tr><td>  <nobr>transitType</nobr> </td><td>  String </td><td>  Tipo de transporte para cart√µes de passagem.  Pode levar os seguintes valores: <br>  PKTransitTypeAir, <br>  PKTransitTypeBoat, <br>  PKTransitTypeBu`, <br>  PKTransitTypeGeneric, <br>  `PKTransitTypeTrain`. </td></tr><tr><td>  <nobr>backFields</nobr> </td><td>  [JSON] </td><td>  Matriz de campos respons√°veis ‚Äã‚Äãpelo verso do mapa </td></tr></tbody></table><br><p>  JSON, neste caso, tem o seguinte formato: </p><br><pre><code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"key"</span></span> : <span class="hljs-string"><span class="hljs-string">"value1"</span></span>, <span class="hljs-string"><span class="hljs-string">"label"</span></span> : <span class="hljs-string"><span class="hljs-string">"value2"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : <span class="hljs-string"><span class="hljs-string">"value3"</span></span></code> </pre> <br><p>  O valor pela chave do valor pode ser num√©rico ou sequ√™ncia.  No entanto, currencyCode junto com o valor da sequ√™ncia n√£o podem ser usados.  Quanto aos campos auxiliares e campos secund√°rios, pode haver v√°rios deles, e voc√™ deve monitorar o comprimento das linhas que s√£o usadas neles. </p><br><h2>  Teclas para Design Visual </h2><br><table><tbody><tr><th>  <nobr>Chave em JSON</nobr> </th><th>  <nobr>Tipo de dados</nobr> </th><th>  <nobr>Descri√ß√£o do produto</nobr> </th></tr><tr><td>  <nobr>c√≥digos de barras</nobr> </td><td>  [JSON] </td><td>  Informa√ß√µes para o c√≥digo de barras (veja abaixo). </td></tr><tr><td>  <nobr>backgroundColor</nobr> </td><td>  cor como string </td><td>  Cor do plano de fundo. (# Fa32e4) </td></tr><tr><td>  <nobr>primeiro planoColor</nobr> </td><td>  cor como string </td><td>  Cor da etiqueta com valores </td></tr><tr><td>  <nobr>groupingIdentifier</nobr> </td><td>  String </td><td>  Opcional para bilhetes para eventos e bilhetes de transporte.  Cart√µes com o mesmo estilo - passTypeIdentifier e groupingIdentifier - ser√£o agrupados </td></tr><tr><td>  <nobr>labelColor</nobr> </td><td>  cor como string </td><td>  R√≥tulo de texto com nomes de campo </td></tr><tr><td>  <nobr>logoText</nobr> </td><td>  String localiz√°vel </td><td>  Texto exibido ao lado do logotipo </td></tr></tbody></table><br><h2>  C√≥digo de barras </h2><br><p>  A parte mais importante do mapa.  Um n√∫mero de identifica√ß√£o do cart√£o √© costurado nele (por exemplo, um n√∫mero do cart√£o f√≠sico ou um n√∫mero do bilhete).  √â importante que o scanner ou qualquer outra ferramenta possa ler c√≥digos na codifica√ß√£o correta. </p><br><table><tbody><tr><th>  <nobr>Chave em JSON</nobr> </th><th>  <nobr>Tipo de dados</nobr> </th><th>  <nobr>Descri√ß√£o do produto</nobr> </th></tr><tr><td>  <nobr>altText</nobr> </td><td>  String </td><td>  Texto opcional exibido ao lado do c√≥digo de barras se o c√≥digo de barras n√£o for lido. </td></tr><tr><td>  <nobr>formato</nobr> </td><td>  String </td><td>  Formato de c√≥digo de barras.  Pode assumir valores: PKBarcodeFormatQR, <br>  PKBarcodeFormatPDF417, <br>  PKBarcodeFormatAztec, <br>  PKBarcodeFormatCode128 </td></tr><tr><td>  <nobr>mensagem</nobr> </td><td>  String </td><td>  C√≥digo ou n√∫mero do cart√£o criptografado em c√≥digo de barras. </td></tr><tr><td>  <nobr>messageEncoding</nobr> </td><td>  String </td><td>  Codifica√ß√£o de mensagem.  Geralmente iso-8859-1 </td></tr></tbody></table><br><h2>  Localiza√ß√£o </h2><br><p>  Essas chaves s√£o respons√°veis ‚Äã‚Äãpelo local em que o cart√£o pode ser usado. </p><br><table><tbody><tr><th>  <nobr>Chave em JSON</nobr> </th><th>  <nobr>Tipo de dados</nobr> </th><th>  <nobr>Descri√ß√£o do produto</nobr> </th></tr><tr><td>  <nobr>altiture</nobr> </td><td>  String </td><td>  Texto opcional exibido ao lado do c√≥digo de barras se o c√≥digo de barras n√£o for lido. </td></tr><tr><td>  <nobr>latitude</nobr> </td><td>  Longitude </td><td>  Latitude </td></tr><tr><td>  <nobr>longitude</nobr> </td><td>  Duplo </td><td>  Latitude </td></tr><tr><td>  <nobr>relevantesTexto</nobr> </td><td>  String </td><td>  Texto opcional que aparece na tela de bloqueio no momento em que o usu√°rio digita o intervalo do cart√£o. </td></tr></tbody></table><br><h2>  Lado traseiro </h2><br><p>  Informa√ß√µes adicionais podem ser colocadas na parte reversa das informa√ß√µes: termos de uso, pol√≠tica de atualiza√ß√£o autom√°tica, detalhes de contato e um link para o aplicativo ao qual o cart√£o pertence.  A figura mostra a correspond√™ncia dos campos em pass.json e a apar√™ncia do verso do mapa.  Se houver links, n√∫meros de telefone etc. no campo de valor, eles ser√£o destacados automaticamente. </p><br><p><img src="https://habrastorage.org/webt/er/gx/ow/ergxowmbtn08dmjnv2lkrqlo3ku.png"></p><br><h1 id="sozdanie-karty-chast-2">  Crie um mapa.  Parte 2 </h1><br><p>  Assim, as fotos est√£o prontas, o pass.json √© formado, resta reunir tudo.  Para fazer isso, preencha manifest.json (consulte a tabela 1), onde voc√™ precisa incluir todas as imagens e pass.json.  Acontece algo como isto: </p><br><pre> <code class="hljs go">. . . . . . <span class="hljs-string"><span class="hljs-string">"pass.json"</span></span> = <span class="hljs-number"><span class="hljs-number">303</span></span>c753abc39aa732ec74643d6db28348fe8a823; <span class="hljs-string"><span class="hljs-string">"strip.png"</span></span> = <span class="hljs-number"><span class="hljs-number">736d</span></span>01f84cb73d06e8a9932e43076d68f19461ff; <span class="hljs-string"><span class="hljs-string">"strip@2x.png"</span></span> = <span class="hljs-number"><span class="hljs-number">468f</span></span>a7bc93e6b55342b56fda09bdce7c829d7d46; . . . . . .</code> </pre> <br><p>  A partir deste momento, nada precisa ser alterado, pois o SHA estar√° incorreto; em caso de altera√ß√µes, √© necess√°rio regenerar o SHA. </p><br><p>  Em seguida, voc√™ precisa criar um ID do tipo de passe no escrit√≥rio do desenvolvedor e fazer um certificado para ele.  O procedimento deve ser mais ou menos familiar se voc√™ tiver criado anteriormente, por exemplo, perfis de provisionamento. </p><br><img src="https://habrastorage.org/webt/2b/um/hu/2bumhu9wgoawlz1lt-qhieildna.png"><br><p>  Em seguida, v√° para o Keychain e exporte dali o Apple Worldwide Developer Relation Certificate (WWDR) como .pem. </p><br><p><img src="https://habrastorage.org/webt/jg/kk/sl/jgkksl_tfac4e23hz7bk1swxhtq.png"></p><br><p>  A partir da√≠, exportamos o c√≥digo do tipo de passagem criado como .p12.  Nesse momento, a governanta solicitar√° que voc√™ digite a senha do certificado.  Nesse caso, uma senha √© opcional. <br>  Observe que todas as a√ß√µes adicionais devem ser executadas em uma pasta, onde manifest.json, pass.json e imagens j√° devem estar. </p><br><p>  Agora voc√™ precisa gerar uma assinatura, a qual assinaremos o arquivo.  Primeiro, exporte o ID do tipo de passe e a chave para ele como .pem. </p><br><pre> <code class="hljs powershell">openssl pkcs12 <span class="hljs-operator"><span class="hljs-operator">-in</span></span> certificate.p12 <span class="hljs-literal"><span class="hljs-literal">-clcerts</span></span> <span class="hljs-literal"><span class="hljs-literal">-nokeys</span></span> <span class="hljs-literal"><span class="hljs-literal">-out</span></span> passcertificate.pem <span class="hljs-literal"><span class="hljs-literal">-passin</span></span> pass: your_password</code> </pre> <br><p>  e </p><br><pre> <code class="hljs powershell">openssl pkcs12 <span class="hljs-operator"><span class="hljs-operator">-in</span></span> certificates.p12 <span class="hljs-literal"><span class="hljs-literal">-nocerts</span></span> <span class="hljs-literal"><span class="hljs-literal">-out</span></span> passkey.pem <span class="hljs-literal"><span class="hljs-literal">-passin</span></span> pass: <span class="hljs-literal"><span class="hljs-literal">-passout</span></span> pass:new_password</code> </pre> <br><p>  Agora estamos prontos para gerar uma assinatura.  Vamos fazer um comando: </p><br><pre> <code class="hljs powershell">openssl smime <span class="hljs-literal"><span class="hljs-literal">-binary</span></span> <span class="hljs-literal"><span class="hljs-literal">-sign</span></span> <span class="hljs-literal"><span class="hljs-literal">-certfile</span></span> WWDR.pem <span class="hljs-literal"><span class="hljs-literal">-signer</span></span> passcertificate.pem <span class="hljs-literal"><span class="hljs-literal">-inkey</span></span> passkey.pem <span class="hljs-operator"><span class="hljs-operator">-in</span></span> manifest.json <span class="hljs-literal"><span class="hljs-literal">-out</span></span> signature <span class="hljs-literal"><span class="hljs-literal">-outform</span></span> DER <span class="hljs-literal"><span class="hljs-literal">-passin</span></span> pass:___</code> </pre> <br><p>  Ent√£o, est√° tudo pronto para n√≥s, resta apenas coletar o arquivo, fazemos isso com o comando: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">zip</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">nameOfPass</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pkpass</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">manifest</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.json</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pass</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.json</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">signature</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">logo</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.png</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">logo</span></span>@<span class="hljs-keyword"><span class="hljs-keyword">2x</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">png</span></span> logo@<span class="hljs-number"><span class="hljs-number">3</span></span>x.png icon.png icon@<span class="hljs-number"><span class="hljs-number">2</span></span>x.png icon@<span class="hljs-number"><span class="hljs-number">3</span></span>x.png</code> </pre> <br><p>  Chamo a aten√ß√£o para o fato de que todos os arquivos nos quais voc√™ deseja incluir o arquivo de dados do cart√£o (.pkpass) devem ser listados aqui. <br>  Como resultado, obtemos um arquivo .pkpass que pode ser aberto no computador.  Veremos uma pr√©via do cart√£o, cuja apar√™ncia pode diferir da apar√™ncia do telefone. <br>  Tudo isso pode ser feito um pouco mais f√°cil.  A Apple fornece o utilit√°rio <code>signpass</code> ( <code>signpass</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">amostra da Apple Wallet</a> ), que cuida de todos os c√°lculos do SHA (o arquivo <code>manifest.json</code> pode ser deixado sozinho) e do trabalho de cria√ß√£o de assinaturas.  Para us√°-lo, voc√™ precisa criar um projeto e colocar o arquivo <code>signpass</code> em uma pasta com todos os recursos necess√°rios. </p><br><img src="https://habrastorage.org/webt/tj/jj/eo/tjjjeoqlhxzjumfr3nrg9ve8yhm.png"><br><p>  Em geral, a estrutura deve se parecer com isso: </p><br><img src="https://habrastorage.org/webt/qc/pb/lr/qcpblrbdaw7piffxdehwa1whlpw.png"><br><p>  Em seguida, execute o comando: </p><br><pre> <code class="hljs powershell">./signpass <span class="hljs-literal"><span class="hljs-literal">-p</span></span> wallet</code> </pre> <br><p>  Carteira √© o nome da pasta na qual todos os recursos est√£o localizados.  A sa√≠da √© wallet.pkpass.  Seu conte√∫do pode ser visualizado descompactando wallet.pkpass. </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">unzip</span></span> wallet.pkpass</code> </pre> <br><p>  √â poss√≠vel que a cria√ß√£o do pkpass seja enviada ao back-end; nesse caso, ser√° necess√°rio transferir para os desenvolvedores do WWDR o certificado para a identifica√ß√£o do tipo de passe na forma de .p12 e a senha para ele. </p><br><h1 id="integraciya-s-prilozheniem">  Integra√ß√£o de aplicativos </h1><br><p>  Para que o aplicativo possa adicionar cart√µes √† Carteira virtual, voc√™ deve habilitar esse recurso no ID do aplicativo e tamb√©m esse recurso em Recursos no projeto. </p><br><img src="https://habrastorage.org/webt/yq/wo/py/yqwopyfu9nhk-_klilrcoczwe3m.png"><br><img src="https://habrastorage.org/webt/o-/se/ek/o-seekf9zbohe4jmwtcvnzfwes4.png"><br><p>  Isso √© necess√°rio para o trabalho correto completo com a Carteira virtual.  Caso contr√°rio, n√£o ser√° poss√≠vel ler cart√µes da Carteira virtual e, por exemplo, n√£o ser√° poss√≠vel entender se nosso cart√£o foi adicionado ou n√£o.  Tamb√©m √© importante observar que o ID da equipe no pass.json deve corresponder ao ID da equipe ou voc√™ deve adicion√°-los manualmente aos direitos e isso pode corrigir a situa√ß√£o, mas n√£o verifiquei isso. </p><br><p><img src="https://habrastorage.org/webt/82/ow/p9/82owp9rv4gyaldwm0si77b5nn8m.png"></p><br><h2 id="dobavlenie-karty">  Adicionando um cart√£o </h2><br><p>  Adicionar mapas √© muito simples: </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passPath = <span class="hljs-type"><span class="hljs-type">Bundle</span></span>.main.path(forResource: <span class="hljs-string"><span class="hljs-string">"wallet"</span></span>, ofType: <span class="hljs-string"><span class="hljs-string">"pkpass"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error: <span class="hljs-type"><span class="hljs-type">ErrorPointer</span></span> = <span class="hljs-type"><span class="hljs-type">ErrorPointer</span></span>(nilLiteral: ()) <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passData = <span class="hljs-type"><span class="hljs-type">NSData</span></span>(contentsOfFile: passPath) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> pass = <span class="hljs-type"><span class="hljs-type">PKPass</span></span>(data: passData <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-type"><span class="hljs-type">Data</span></span>, error: error) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passLibrary = <span class="hljs-type"><span class="hljs-type">PKPassLibrary</span></span>() passLibrary.addPasses([pass]) { (status) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(passLibrary.containsPass(pass)) }</code> </pre> <br><p>  No entanto, mais uma vez, √© mais necess√°rio baixar o arquivo .pkpass do seu servidor. <br>  Vale ressaltar que o PassKit produz erros razoavelmente leg√≠veis, para que voc√™ possa entender facilmente o que exatamente foi feito de errado. </p><br><h2 id="poluchenie-informacii-o-dobavlennyh-kartah">  Recuperando informa√ß√µes sobre cart√µes adicionados </h2><br><p>  Para obter informa√ß√µes sobre os cart√µes dispon√≠veis no Wallet e relacionados ao seu aplicativo, voc√™ precisa acessar o objeto PKPassLibrary. </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passLibrary = <span class="hljs-type"><span class="hljs-type">PKPassLibrary</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passes = passLibrary.passes()</code> </pre> <br><p>  Assim, voc√™ pode entender se o mapa foi adicionado ou n√£o, al√©m de atualizar a interface.  Al√©m disso, os mapas da PKPassLibrary podem ser atualizados e exclu√≠dos.  Os mapas tamb√©m podem ser atualizados via servi√ßos da Web, mas neste artigo n√£o consideraremos essa op√ß√£o. </p><br><h1 id="proverka-na-unikalnost">  Verifica√ß√£o de exclusividade </h1><br><p>  Como em seu servi√ßo, como regra geral, o cart√£o est√° vinculado a uma conta, no aplicativo √© mais prov√°vel que voc√™ precise determinar de alguma forma se o cart√£o pertence ao usu√°rio atual.  Eu sugiro fazer isso atrav√©s de <code>serialNumber</code> .  Por exemplo, defina a identifica√ß√£o <code>serialNumber</code> do usu√°rio ou n√∫mero do cart√£o. </p><br><h1 id="testirovanie">  Teste </h1><br><p>  A Apple fornece exemplos de pkpass para diferentes tipos, voc√™ pode se concentrar neles. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Amostras de carteira da Apple</a> <br>  Para ver como √© o mapa, voc√™ pode adicionar o pkpass ao projeto (consulte ‚ÄúAdicionando um mapa‚Äù).  O processo de adi√ß√£o / remo√ß√£o j√° foi discutido acima, resta apenas lembrar que o aplicativo n√£o ver√° os cart√µes j√° adicionados se o cart√£o da Carteira virtual for criado na conta de um desenvolvedor e o pr√≥prio desenvolvimento foi realizado a partir de outra conta (relevante para empresas de terceiriza√ß√£o).  Nesse caso, voc√™ pode adicionar cart√µes sem problemas. <br>  Voc√™ pode verificar se as informa√ß√µes no c√≥digo de barras est√£o codificadas corretamente usando qualquer scanner de c√≥digo QR.  E √© definitivamente necess√°rio verificar a corre√ß√£o do trabalho com este scanner. </p><br><h1 id="zaklyuchenie">  Conclus√£o </h1><br><p>  O artigo examinou o processo de cria√ß√£o e design de um mapa, bem como o processo de integra√ß√£o com o aplicativo e os problemas que possam surgir.  Intencionalmente, n√£o resolvi problemas de integra√ß√£o com servi√ßos da Web e atualiza√ß√µes de mapas, e espero fazer isso no pr√≥ximo artigo. </p><br><h1 id="ispolzuemye-materialy">  Materiais utilizados: </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/PassKit_PG/Creating.html</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://developer.apple.com/library/archive/documentation/UserExperience/Reference/PassKit_Bundle/Chapters/TopLevel.html#//apple_ref/doc/uid/TP40012026-CH2-SW3</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://itechroof.wordpress.com/2015/11/30/apple-wallet-part-13/</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/PassKit_PG/Updating.html</a> </p><br><p>  Agradecimentos especiais a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">mehdzor</a> pela conta do desenvolvedor para os testes. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt428437/">https://habr.com/ru/post/pt428437/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt428423/index.html">Como um acordo de US $ 34 bilh√µes entre a IBM e a Red Hat mudar√° o mercado de TI: especialistas e analistas</a></li>
<li><a href="../pt428429/index.html">GOST R 34.10 assinatura eletr√¥nica de documentos PDF no pacote do escrit√≥rio LibreOffice</a></li>
<li><a href="../pt428431/index.html">Mais do que camadas conc√™ntricas</a></li>
<li><a href="../pt428433/index.html">Advogados particulares</a></li>
<li><a href="../pt428435/index.html">O que ler em PHP em russo?</a></li>
<li><a href="../pt428439/index.html">Sem conjunto</a></li>
<li><a href="../pt428441/index.html">Compra do GitHub conclu√≠da. O que acontecer√° depois?</a></li>
<li><a href="../pt428443/index.html">Reconcilia√ß√£o - verificando a integridade dos dados em sistemas distribu√≠dos</a></li>
<li><a href="../pt428445/index.html">Como fomos a um hackathon em Helsinque e perdemos</a></li>
<li><a href="../pt428447/index.html">Prote√ß√£o de dados em nuvem: um guia para desenvolvedores</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>