<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧔🏾 🔛 🧒🏿 ShIoTiny: nœuds, liens et événements ou caractéristiques des programmes de dessin 🐎 💐 🙋🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Points clés ou sujet de cet article 
 Le sujet de l'article est la programmation visuelle de l'automate ShIoTiny pour la maison intelligente décrite i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ShIoTiny: nœuds, liens et événements ou caractéristiques des programmes de dessin</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463285/"><img src="https://habrastorage.org/webt/s3/ym/wy/s3ymwykg-no-z12-gk5znf02hrs.jpeg"><br><br><h4>  Points clés ou sujet de cet article </h4><br>  Le sujet de l'article est la programmation visuelle de l'automate <b>ShIoTiny</b> pour la maison intelligente décrite ici: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ShIoTiny: petite automatisation, Internet des objets, ou «six mois avant les vacances»</a> . <br><br>  Des concepts tels que les <b>nœuds</b> , les <b>communications</b> , les <b>événements</b> , ainsi que les fonctionnalités de chargement et d'exécution d'un programme visuel sur <b>ESP8266</b> , qui est la base de <b>ShIoTiny</b> PLC, sont <b>très brièvement passés en revue</b> . <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>Site du</b> projet <b>ShIoTiny</b></a> <br><br><a name="habracut"></a><br><h4>  Introduction ou quelques questions d'organisation </h4><br>  Dans un article précédent sur mon développement, j'ai donné un bref aperçu des capacités du contrôleur <b>ShIoTiny</b> . <br><br>  Curieusement, le public a montré un intérêt assez fort et m'a posé beaucoup de questions.  Certains camarades m'ont même proposé immédiatement d'acheter un contrôleur.  Non, je ne suis pas opposé à gagner un peu d'argent, mais ma conscience ne me permet pas de vendre quelque chose qui est encore très grossier en termes de logiciels. <br><br>  Par conséquent, j'ai posté sur les binaires du firmware GitHub et le schéma de l'appareil: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">firmware + instruction la plus courte + circuit + exemples</a> . <br><br>  Désormais, tout le monde peut flasher ESP-07 et jouer avec le firmware par lui-même.  Si quelqu'un veut vraiment un tel tableau que sur la photo, j'en ai plusieurs.  Écrivez à <b>shiotiny@yandex.ru</b> .  Mais, comme le disaient les concombres inoubliables: "Je ne suis responsable de rien!" <br><br>  Alors, allons droit au but: qu'est-ce qu'un « <b>nœud</b> » (nœud) et un « <b>événement</b> »?  Comment est exécuté le programme? <br><br>  Comme d'habitude - commençons dans l'ordre: en téléchargeant le programme. <br><br><h4>  Comment se charge le programme </h4><br>  Pour commencer, que se passe-t-il lorsque nous cliquons sur le bouton <b>Télécharger</b> dans l'éditeur <b>ElDraw</b> et notre schéma de programme, composé de beaux carrés, vole dans l'appareil. <br><br>  Tout d'abord, sur la base du schéma que nous avons dessiné, sa description sous forme de texte est construite. <br>  Deuxièmement, il est vérifié si toutes les entrées des nœuds sont connectées aux sorties.  Il ne devrait y avoir aucune entrée «suspendue».  Si une telle entrée est détectée, le circuit dans ShIoTiny ne se chargera pas et l'éditeur affichera un avertissement. <br><br>  Si tout s'est bien passé, l'éditeur envoie une description textuelle du circuit à un nœud dans ShIoTiny.  Bien sûr, le schéma existant de ShIoTiny est précédemment supprimé.  La description textuelle résultante est enregistrée dans la mémoire FLASH. <br><br>  Soit dit en passant, si vous souhaitez supprimer le circuit de l'appareil, chargez simplement un circuit vide (qui ne contient aucun élément de nœud). <br><br>  Dès que tout le circuit du programme est chargé dans l'automate ShIoTiny, il commence à «fonctionner».  Qu'est-ce que cela signifie? <br><br>  Notez que les processus de chargement du circuit à partir de la mémoire FLASH lors de la mise sous tension et lorsque le circuit est reçu de l'éditeur sont identiques. <br><br>  Vient d'abord la création d'objets nœuds en fonction de leur description. <br>  Ensuite, la disposition des connexions entre les nœuds est effectuée.  C'est-à-dire que des liens de sorties aux entrées et d'entrées aux sorties sont générés. <br><br>  Et ce n'est qu'après tout cela que le cycle d'exécution du programme principal est lancé. <br><br>  J'ai écrit longtemps, mais tout le processus - du «chargement» du circuit de la mémoire FLASH au début de la boucle principale - prend une fraction de seconde pour un circuit de 60 à 80 nœuds. <br><br>  Comment fonctionne la boucle principale?  Très simple.  Tout d'abord, il attend que l' <b>événement</b> se <b>produise</b> dans n'importe quel nœud, puis il traite cet événement.  Et donc sans fin.  Eh bien, ou jusqu'à ce qu'ils téléchargent un nouveau schéma sur ShIoTiny. <br><br>  Déjà plusieurs fois, j'ai mentionné des choses comme les <b>événements</b> , les <b>nœuds</b> et les <b>connexions</b> .  Mais qu'est-ce que c'est d'un point de vue logiciel?  Nous en parlerons aujourd'hui. <br><br><h4>  Nœuds, connexions et événements </h4><br>  Il suffit de regarder les exemples de programmes de circuits pour <b>ShIoTiny</b> pour comprendre qu'un circuit se compose de seulement deux entités - les nœuds (ou éléments) et les relations entre eux. <br><br>  <b>Un nœud</b> , un <b>nœud</b> ou un <b>élément de circuit</b> est une représentation virtuelle d'une <b>action</b> sur les données.  Cela peut être une opération arithmétique, une opération logique ou toute autre opération qui nous arrive.  L'essentiel est que le nœud ait une entrée et une sortie. <br><br>  <b>Une entrée</b> est l'endroit où le nœud reçoit des données.  Les images d'entrée sont des points qui sont toujours sur le côté gauche du nœud. <br><br>  <b>La sortie</b> est l'endroit d'où le résultat de l'opération de nœud est extrait.  Les images de sortie sont des points qui sont toujours sur le côté droit du nœud. <br><br>  Certains nœuds n'ont pas d'entrées.  Ces nœuds génèrent un résultat en eux-mêmes.  Par exemple, un nœud constant ou un nœud capteur: ils n'ont pas besoin de données provenant d'autres nœuds pour rendre compte du résultat. <br><br>  D'autres nœuds, en revanche, n'ont pas de sortie.  Ce sont des nœuds qui affichent, par exemple, des actionneurs (relais ou autres dispositifs similaires).  Ils acceptent les données, mais ne génèrent pas le résultat des calculs disponibles pour les autres nœuds. <br><br>  En outre, il existe également un nœud de commentaire unique.  Il ne fait rien, n'a ni entrées ni sorties.  Son but est d'être une explication dans le diagramme. <br><br>  Qu'est-ce qu'un « <b>événement</b> »?  <b>Un événement</b> est l'occurrence de nouvelles données dans un nœud.  Par exemple, les événements incluent: la modification de l'état d'entrée (nœud d' <b>entrée</b> ), la réception de données d'un autre périphérique (nœuds <b>MQTT</b> et <b>UDP</b> ), l'expiration d'une période de temps spécifiée (nœuds de <b>temporisation</b> et de <b>retard</b> ), etc. <br><br>  À quoi servent les événements?  Oui, afin de déterminer dans quel nœud les nouvelles données sont apparues et les états de quels nœuds doivent être modifiés lors de la réception de nouvelles données.  L'événement, pour ainsi dire, «passe» le long de la chaîne de nœuds jusqu'à ce qu'il ait contourné tous les nœuds dont l'état doit être vérifié et modifié. <br><br>  Tous les nœuds peuvent être divisés en deux catégories. <br>  Les nœuds pouvant générer des événements sont appelés « <b>nœuds actifs</b> ». <br>  Les nœuds qui ne peuvent pas générer d'événements sont appelés « <b>nœuds passifs</b> ». <br><br>  Lorsqu'un nœud génère un événement (c'est-à-dire que de nouvelles données apparaissent sur sa sortie), alors en général l'état de la chaîne entière de nœuds connectés à la sortie du nœud générateur d'événement change. <br><br>  Pour être clair, considérons l'exemple de la figure. <br><br><img src="https://habrastorage.org/webt/mi/vd/kz/mivdkz3cx_wvzdhnd4fflb9t1xu.png"><br><br>  Les nœuds actifs ici sont Input1, Input2 et Input3.  Les nœuds restants sont passifs.  Considérez ce qui se passe lorsque telle ou telle entrée se ferme.  Pour plus de commodité, les résultats sont tabulés. <br><br><img src="https://habrastorage.org/webt/er/eh/wn/erehwn5_nqschmn03cnblvlbdbk.jpeg"><br><br>  Comme vous pouvez le voir, lorsqu'un événement se produit, une chaîne est créée du nœud source de l'événement au nœud final.  L'état de ces nœuds qui ne tombent pas dans la chaîne ne change pas. <br><br>  Une question légitime se pose, mais que se passera-t-il si deux ou même plusieurs événements se produisent simultanément? <br><br>  En tant qu’amant du travail de Gleb Anfilov, je suis tenté d’envoyer un curieux questionneur à son livre «Flight from Surprise».  Il s'agit d'une telle "théorie de la relativité pour les plus petits", dans laquelle on sait bien ce qu'est "simultanément" et comment vivre avec. <br><br>  Mais purement presque tout est beaucoup plus simple: lorsque deux ou même plusieurs événements se produisent, toutes les chaînes de chaque source d'événements sont successivement construites et traitées à tour de rôle et pas de miracles. <br><br>  La prochaine question tout à fait légitime d'un lecteur curieux est de savoir ce qui se passera si les nœuds sont connectés en anneau?  Ou, comme il est de coutume de dire parmi ces sages de la vôtre, d'introduire des commentaires.  Autrement dit, connectez la sortie de l'un des nœuds à l'entrée du nœud précédent de sorte que l'état de sortie de ce nœud affecte l'état de son entrée.  <b>L'</b> éditeur <b>ElDraw</b> ne vous permettra pas de connecter directement la sortie du nœud à sa propre entrée.  Mais indirectement, comme dans la figure ci-dessous - cela peut être fait. <br><br>  Alors, que sera-t-il dans ce cas?  La réponse sera très «définitive»: selon les nœuds.  Prenons l'exemple de la figure. <br><br><img src="https://habrastorage.org/webt/ta/rr/wd/tarrwdvrk01cizkl5xg9x4ilfym.png"><br><br>  Lorsque les contacts de l'entrée Input1 sont ouverts à l'entrée supérieure du nœud A - 0. À la sortie du nœud A, également 0. À la sortie du nœud B - 1. Et enfin, à l'entrée inférieure du nœud A - 1. Tout est clair.  Et pour qui ce n'est pas clair - regardez ci-dessous pour une description du fonctionnement des nœuds "ET" et "NON". <br><br>  Fermez maintenant les contacts de l'entrée Input1, c'est-à-dire que nous en fournirons un à l'entrée supérieure du nœud A.  Ceux qui connaissent l'électronique savent qu'en fait, nous obtenons un circuit de générateur logique classique.  Et en théorie, un tel schéma devrait produire à l'infini en sortie des éléments A et B les séquences 1-0-1-0-1-0 ...  et 0-1-0-1-0-1-1 ....  Après tout, un événement devrait constamment changer l'état des nœuds A et B, en tournant dans un cercle 2-3-2-3- ...! <br><br>  Mais cela ne se produit pas réellement.  Le circuit tombera dans un état aléatoire - ou le relais restera activé ou désactivé, ou il peut sonner légèrement en marche et en arrêt plusieurs fois de suite.  Tout dépend de la météo au pôle sud de Mars.  Et c'est pourquoi cela se produit. <br><br>  Un événement du nœud Input1 modifie plusieurs fois l'état du nœud A, puis du nœud B, et ainsi de suite dans un cercle.  Le programme détermine le "bouclage" de l'événement et met fin de force à ce carnaval.  Après cela, les changements d'état des nœuds A et B sont bloqués jusqu'à ce qu'un nouvel événement se produise.  Le moment où le programme décide - "arrête de tourner en cercle!"  - dans le cas général, cela dépend de nombreux facteurs et peut être considéré comme aléatoire. <br><blockquote>  Soyez prudent lorsque vous connectez des nœuds dans un anneau - les effets ne seront pas toujours évidents!  Eh bien, imaginez quoi et pourquoi vous faites! </blockquote>  Mais est-il possible de construire un générateur sur les nœuds qui nous sont accessibles?  Oui tu peux!  Mais cela nécessite un nœud qui sait lui-même générer des événements.  Et il y a un tel nœud - c'est une «ligne à retard».  Voyons comment fonctionne le générateur avec une période de 6 secondes dans la figure ci-dessous. <br><br><img src="https://habrastorage.org/webt/xy/ng/xc/xyngxczc6i7ryhc2ssrygfdtcwy.png"><br><br>  Un élément clé du générateur est le nœud A, la ligne à retard.  Si vous changez l'état d'entrée de la ligne à retard de 0 à 1, alors 1 à la sortie n'apparaît pas immédiatement, mais seulement après un temps spécifié.  Dans notre cas, c'est 3 secondes.  De même, si vous changez l'état d'entrée de la ligne à retard de 1 à 0, alors 0 apparaîtra à la sortie après les mêmes 3 secondes.  Le temps de retard est réglé en dixièmes de seconde.  Autrement dit, la valeur est 30 et signifie - 3 secondes. <br><br>  Une caractéristique de la ligne à retard est qu'elle génère un événement après que le temps de retard s'est écoulé. <br><br>  Supposons qu'au départ, la sortie de la ligne à retard était 0. Après avoir traversé le nœud B, l'onduleur, ce 0 devient 1 et va à l'entrée de la ligne à retard.  Rien ne se passe tout de suite.  À la sortie de la ligne à retard, telle qu'elle était, 0 restera, mais le compte à rebours du délai est alors activé.  Cela prend 3 secondes.  Et puis la ligne à retard génère un événement.  En sortie, elle en a 1. Cette unité, après avoir traversé le noeud B, l'onduleur, se transforme en 0 et passe à l'entrée de la ligne à retard.  Encore 3 secondes passent ... et le processus se répète.  Autrement dit, toutes les 3 secondes, l'état de sortie de la ligne à retard passe de 0 à 1, puis de 1 à 0. Le relais clique.  Le générateur fonctionne.  La période d'impulsion est de 6 secondes (3 secondes à la sortie de zéro et 3 secondes - une). <br><br>  Mais, dans les circuits réels, vous n'avez généralement pas besoin d'utiliser cet exemple.  Il existe des nœuds de temporisation spéciaux qui, parfaitement et sans aide extérieure, génèrent une séquence d'impulsions avec une période donnée.  La durée de «zéro» et des «unités» dans ces impulsions est égale à la moitié de la période. <br><blockquote>  Pour définir des actions périodiques, utilisez des nœuds de temporisation. </blockquote>  Je note que de tels signaux numériques, où la durée du «zéro» et des «unités» sont égales, sont appelés «méandre». <br><br>  J'espère avoir clarifié un peu la question sur la façon dont les événements sont répartis entre les nœuds et que ne devrait-on pas faire? <br><br><h4>  Conclusion et références </h4><br>  L'article s'est avéré court, mais cet article est la réponse aux questions posées sur les nœuds et les événements. <br><br>  Au fur et à mesure que le firmware évolue et que de nouveaux exemples apparaissent, j'écrirai sur la façon de programmer de petits articles <b>ShIoTiny</b> , tant que cela sera intéressant pour les gens. <br><br>  Comme précédemment, le schéma, le firmware, les exemples, la description des nœuds et tout le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">reste sont ici</a> . <br><br>  Questions, souhaits, critiques - c'est ici: <b>shiotiny@yandex.ru</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr463285/">https://habr.com/ru/post/fr463285/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr463273/index.html">Frontend Weekly Digest (5 au 11 août 2019)</a></li>
<li><a href="../fr463275/index.html">Le condensé de matières fraîches du monde du front-end de la dernière semaine n ° 375 (5 au 11 août 2019)</a></li>
<li><a href="../fr463277/index.html">Affectation pour l'auto-développement: formulaire HTML avec une liste de chaînes aléatoires et sélection par celles-ci</a></li>
<li><a href="../fr463279/index.html">PHP Digest n ° 162 (du 1er au 12 août 2019)</a></li>
<li><a href="../fr463281/index.html">Pourquoi il y a peu d'applications innovantes sur Google Play ou pourquoi parfois la programmation est magique</a></li>
<li><a href="../fr463289/index.html">Discrete Math for WMS: Clustering Stock Lots</a></li>
<li><a href="../fr463291/index.html">Dés ou os</a></li>
<li><a href="../fr463293/index.html">Collecteur d'ordures. Cours complet + transfert de BOTR</a></li>
<li><a href="../fr463295/index.html">C ++ et CMake - Brothers Forever, Partie II</a></li>
<li><a href="../fr463297/index.html">Fidélité à votre goût</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>