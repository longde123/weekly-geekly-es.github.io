<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏽‍🍳 🙎🏻 🚧 ShIoTiny: ventilation de pièce humide (exemple de projet) 🙎🏾 🏀 🧕🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Points clés ou sujet de cet article 
 Nous continuons la série d'articles sur ShIoTiny - un contrôleur visuellement programmable basé sur la puce ESP8...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ShIoTiny: ventilation de pièce humide (exemple de projet)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464485/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ue/so/ox/uesoox7zwrguyei6o5m_ndp2ufw.jpeg"></div><br><h4>  Points clés ou sujet de cet article </h4><br>  Nous continuons la série d'articles sur <b>ShIoTiny</b> - un contrôleur visuellement programmable basé sur la puce <b>ESP8266</b> . <br><br>  Cet article décrit un exemple de projet de contrôle de la ventilation dans une salle de bain ou une autre pièce humide sur la façon de créer un programme pour <b>ShIoTiny</b> . <br><br><h4>  Articles précédents de la série. </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ShIoTiny: petite automatisation, Internet des objets, ou «six mois avant les vacances»</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ShIoTiny: nœuds, liens et événements ou caractéristiques des programmes de dessin</a> <br><br><h4>  Les références </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>Site du</b> projet <b>ShIoTiny</b></a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Micrologiciel binaire, circuits de contrôleur et documentation</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Instructions et description des nœuds</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Configuration du courtier MQTT cloudmqtt.com</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Panneau de configuration du tableau de bord MQTT pour Android</a> <br><a name="habracut"></a><br><h4>  Présentation </h4><br>  Il n'y a pas de compréhension en dehors de l'expérience.  Telle est la vérité testée par le temps et les générations.  Par conséquent, il n'y a rien de mieux pour apprendre des compétences pratiques que d'essayer de faire quelque chose par vous-même.  Et des exemples qui montrent ce qui peut être fait et ce qui ne vaut pas la peine d'être essayés, ici, seront utiles.  Bien entendu, les erreurs des autres ne peuvent pas empêcher la survenue d'erreurs, mais peuvent aider à réduire le nombre de ces dernières. <br><br>  Les questions et les lettres des lecteurs d'articles précédents m'ont inspiré pour réaliser un petit projet, un exemple de contrôle de la ventilation, afin de montrer comment fonctionnent les nœuds ShIoTiny. <br><br>  L'idée initiale, sur la base de laquelle le contrôleur <b>ShIoTiny est apparu</b> - une <b>station de pompage</b> et d'irrigation - est loin de convenir à tout le monde et sera intéressante.  Par conséquent, j'ai pris pour tout le monde un système de contrôle de la ventilation compréhensible et utile à titre d'exemple. <br><br>  Je dirai que l'idée du projet n'est pas la mienne, mais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">je l'ai eu d'ici</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">je l'ai</a> ensuite adaptée à <b>ShIoTiny</b> . <br><br><h4>  Comprenez d'abord ce que vous voulez </h4><br>  Le processus de cultivation est sans fin.  Et c'est cette propriété qui a ruiné beaucoup de bonnes idées et de bons projets.  Le développeur, au lieu de publier, si ce n'est pas un idéal, mais une chose fonctionnelle, a continué de l'améliorer.  Et il l'a perfectionné jusqu'à ce que ses concurrents le contournent, libérant, sinon une solution idéale (et souvent franchement misérable), mais fonctionnelle. <br><br>  Par conséquent, il est très important de savoir où mettre fin au projet.  Ou, en d'autres termes, il est nécessaire de déterminer ce que nous voulons obtenir à la fin du projet à partir de ce que nous avons au début.  En russe, pour un document qui est rédigé juste pour décrire la façon de créer quelque chose, il y a un beau mot court et volumineux "plan", que les traducteurs mentalement retardés et les gestionnaires défectueux ont récemment commencé à appeler la "feuille de route" pour une raison quelconque.  Eh bien, Dieu les bénisse. <br><br>  Notre plan sera comme ça.  Supposons qu'il existe une pièce dans laquelle l'humidité peut parfois augmenter considérablement.  Par exemple, comme une salle de bain ou une cuisine.  L'humidité est une chose désagréable et la façon de la gérer est aussi vieille que le monde: aérez la pièce.  Il existe plusieurs méthodes de diffusion.  Mais nous refuserons peut-être les manières exotiques et démodées comme les noirs avec des toiles et nous arrêterons au fan habituel.  Les fans sont moins chers et les trouver dans notre région est plus facile. <br><br>  En bref, nous voulons contrôler le ventilateur: allumez-le et éteignez-le, respectivement.  Plus précisément, nous voulons qu'il s'allume et s'éteigne si nécessaire. <br><br>  Il reste à déterminer: dans quelles conditions le ventilateur doit-il s'allumer et dans quelles conditions - s'éteindre. <br><br>  Tout est évident ici: si l'humidité dépasse une limite prédéterminée, le ventilateur se met en marche et aspire de l'air;  l'humidité est revenue à la normale - le ventilateur s'arrête. <br><br>  Le lecteur attentif attirera immédiatement son attention sur le mot «donné».  Qui est donné?  Comment préréglé? <br><br>  Il existe plusieurs façons de régler le seuil d'humidité.  Nous en considérerons deux: le premier - à l'aide d'une résistance variable et le second - sur le réseau via le protocole MQTT.  Chacune de ces méthodes présente des avantages et des inconvénients, qui seront discutés plus loin. <br><br>  Pour ceux qui ne comprennent pas, je vais expliquer que le «seuil d'humidité» est un niveau d'humidité, dépassant ce qui nécessite l'inclusion d'un ventilateur. <br><br>  La question suivante est de savoir si donner à l'utilisateur le droit d'allumer le ventilateur directement?  Autrement dit, quel que soit le niveau d'humidité, au simple toucher d'un bouton?  Nous allons offrir une telle opportunité.  Après tout, un ventilateur peut être nécessaire non seulement avec une humidité élevée, mais aussi pour éliminer de la pièce, par exemple, une odeur désagréable, communément appelée «puanteur». <br><br>  Nous avons donc compris ce que nous voulons et même un peu comment cela fonctionnera.  Nous énumérons brièvement toutes les fonctions de notre système de contrôle de la ventilation: <br><br><ul><li>  fixer un seuil d'humidité (deux options); </li><li>  mesure de l'humidité; </li><li>  inclusion automatique du ventilateur; </li><li>  arrêt automatique du ventilateur; </li><li>  inclusion manuelle du ventilateur (sur simple pression d'un bouton). </li></ul><br>  Donc, le plan est clair.  Il est nécessaire de mettre en œuvre toutes les fonctions ci-dessus dans notre programme.  Sur la base de ce «plan», nous agirons.  Pour commencer, dessinez un schéma fonctionnel de l'appareil. <br><br><h4>  Schéma fonctionnel de l'appareil </h4><br>  D'une manière générale, nous aurons deux de ces régimes.  La première concerne l'option dans laquelle le seuil d'humidité est réglé par une résistance variable.  Le deuxième schéma concerne l'option dans laquelle le seuil d'humidité est réglé via le réseau via le protocole MQTT. <br><br>  Mais comme ces circuits ne différeront que d'un élément - la résistance variable "fixant le seuil d'humidité", nous ne dessinerons qu'un seul diagramme structurel.  Bien sûr, le schéma structurel selon GOST semble différent.  Mais nous ne nous concentrons pas sur les ingénieurs des bisons, mais sur la jeune génération.  Par conséquent, la visibilité est plus importante. <br><br><img src="https://habrastorage.org/webt/ut/qh/db/utqhdblfgdlmsv0rkcgqxaztvo8.jpeg"><br><br>  Alors que voit-on sur l'image?  Le ventilateur est connecté au relais <b>Relay1 du</b> contrôleur <b>ShIoTiny</b> .  J'attire votre attention sur le fait que le ventilateur est un engin qui vit sous haute tension.  Par conséquent, si quelqu'un le fait lui-même - soyez prudent.  C'est, au moins, avant de coller vos doigts ou des instruments de mesure dans le circuit - déconnectez au moins le ventilateur.  Et le deuxième point.  Si votre ventilateur est plus puissant que <b>250 W</b> , vous <b>ne</b> devez pas le connecter directement à <b>ShIoTiny</b> - uniquement via le démarreur. <br><br>  Nous avons compris le ventilateur.  Maintenant, le bouton «marche manuelle» du ventilateur.  Il est connecté à l'entrée <b>Input1</b> .  Il n'y a plus rien à expliquer. <br><br>  Capteur de température et d'humidité <b>DHT-11</b> (ou <b>DHT-22</b> ou leurs analogues).  Pour le connecter, une entrée spéciale est fournie sur le contrôleur <b>ShIoTiny</b> .  Comme vous pouvez le voir sur la figure, la connexion d'un tel capteur ne présente pas non plus de problèmes. <br><br>  Et enfin, une résistance variable qui fixe le seuil d'humidité.  Plus précisément, un diviseur composé de résistances variables et constantes.  Il n'y a aucun problème avec sa connexion, mais je vais expliquer que l'ADC intégré sur l' <b>ESP8266 est</b> conçu pour un maximum de 1 volt.  Par conséquent, un diviseur de tension est nécessaire environ 5 fois. <br><br>  Et encore une fois je vous rappelle que ce diviseur n'est pas nécessaire si le seuil d'humidité est réglé via le réseau en utilisant le protocole MQTT. <br><br>  Nous allons commencer à élaborer l'algorithme de l'appareil dans l'éditeur ElDraw ShIoTiny.  Comment y arriver, dans cet éditeur, vous pouvez lire dans les articles précédents ou dans les instructions, dont un lien se trouve au début de l'article. <br><br><h4>  Première option, la plus simple </h4><br>  Commençons par un simple: allumez le relais <b>Relay1 lorsque</b> le seuil d'humidité est dépassé pendant un temps donné. <br><br><img src="https://habrastorage.org/webt/un/8e/kd/un8ekdrb8cy8zvbc6e_ae2ygwyw.png"><br><br>  Comme vous pouvez le voir, rien de compliqué: juste quatre nœuds, sans compter les nœuds de commentaire.  <b>Le DHT11</b> est en fait un capteur de température et d'humidité (peut être changé en <b>DHT22</b> ). <br><br>  La <b>constante CONST</b> est le niveau d'humidité seuil, en pourcentage. <br><br>  Comparateur - un nœud comparant deux nombres et définissant la sortie 1 si la condition spécifiée est remplie et 0 si la condition n'est pas remplie. <br><br>  Dans notre cas, cette condition sera <b>A&gt; B</b> , où <b>A</b> est le niveau d'humidité mesuré par le capteur, et <b>B</b> est le niveau seuil de la même humidité. <br><br>  Dès que le niveau d'humidité mesuré ( <b>A</b> ) dépasse le niveau d'humidité seuil ( <b>B</b> ), 1 apparaît immédiatement à la sortie du comparateur <b>A&gt; B</b> et le relais s'allume.  Inversement, dès que le niveau d'humidité redevient normal (c'est-à-dire <b>A &lt;= B</b> ), immédiatement à la sortie du comparateur <b>A&gt; B,</b> 0 apparaît et le relais s'éteint. <br><br>  Tout est-il clair?  Pour ceux qui ne le font pas vraiment, relisez-le ou regardez la description du fonctionnement des nœuds dans les instructions. <br><br>  Je note que les données du capteur <b>DHT11 sont</b> mises à jour environ toutes les 10 secondes.  Par conséquent, le relais ne pourra pas s'allumer et s'éteindre plus d'une fois toutes les 10 secondes. <br><br>  Tout irait bien, mais nous aimerions régler le seuil d'humidité à l'aide d'une résistance variable.  Rien de plus simple! <br><br><img src="https://habrastorage.org/webt/ez/qe/oi/ezqeoioucwwf0nm90o2sibwizj0.png"><br><br>  Remplacez simplement le nœud constant par le nœud ADC.  Après tout, c'est à l'ADC que nous avons connecté le diviseur de tension avec une résistance variable. <br><br>  La tension à l'entrée ADC varie de 0 à 1 Volt.  Mais l'humidité à la sortie du capteur - varie de 0 à 100%.  Comment les comparons-nous?  Tout est simple.  Le nœud ADC dans <b>ShIoTiny</b> mesure non seulement la tension d'entrée, mais sait également comment la mettre à l' <i><b>échelle et la décaler</b></i> . <br><br>  Autrement dit, à la sortie du nœud ADC1 (ADC), il y aura une valeur <b>X</b> calculée par la formule <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>X</mi><mo>=</mo><mi>k</mi><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><msub><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>n</mi></mrow></msub><mo>+</mo><mi>b</mi></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.014ex" height="2.419ex" viewBox="0 -780.1 7755.9 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-58" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMAIN-3D" x="1130" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-6B" x="2186" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-63" x="2958" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-64" x="3391" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-6F" x="3915" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-74" x="4400" y="0"></use><g transform="translate(4762,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-75" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-6E" x="345" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMAIN-2B" x="6325" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-62" x="7326" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>X</mi><mo>=</mo><mi>k</mi><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>n</mi></mrow></msub><mo>+</mo><mi>b</mi></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> X = k \ cdot u_ {in} + b </script></p>  où <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>n</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.116ex" height="1.817ex" viewBox="0 -520.7 1341.4 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-75" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-6E" x="345" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>n</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-2"> u_ {in} </script>  - tension à l'entrée ADC (de 0 à 1V);  Plage <b>k</b> (plage ADC) et décalage <b>b</b> (décalage ADC).  Ainsi, si vous définissez <b>k = 100</b> et <b>b = 0</b> , alors lors du changement <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>n</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.116ex" height="1.817ex" viewBox="0 -520.7 1341.4 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-75" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-6E" x="345" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>n</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-3"> u_ {in} </script>  dans la plage de 0 à 1, la valeur de <b>X</b> à la sortie de l'unité ADC variera dans la plage de 0 à 100. C'est-à-dire, numériquement égale à la plage des changements d'humidité de 0 à 100%. <br><br>  Ou, tout simplement, en tournant le moteur à résistance variable, vous pouvez régler le seuil d'humidité de 0 à 100. Le seul inconvénient est qu'il n'y a pas de dispositifs d'affichage.  Mais en pratique, si le moteur à résistance variable fait 6 divisions 0%, 20%, 40%, 60%, 80%, 100%), cela suffit pour régler le seuil d'humidité. <br><br>  Comment définir les coefficients <b>k</b> - plage (plage ADC) et <b>b -</b> décalage (décalage ADC)?  Oui, c’est plus facile que des navets cuits à la vapeur!  Cliquez avec le pointeur de la souris dans le nœud <b>ADC1</b> et vous verrez immédiatement la fenêtre des paramètres.  Vous pouvez y définir tout ce dont vous avez besoin.  Pour notre cas, ce sera une telle fenêtre, comme sur la figure. <br><br><img src="https://habrastorage.org/webt/cn/so/ub/cnsoubc9q_rhu-2p6hlffcd_1ig.png"><br><br>  Nous avons donc la solution de travail la plus simple.  Commençons à l'améliorer. <br>  Soit dit en passant, la solution la plus simple a un avantage: elle n'a pas besoin d'Internet.  Il est complètement autonome. <br><br><h4>  Option deux, connectez le bouton </h4><br>  Tout fonctionne et tout le monde est content.  Mais pas de chance, nous ne pouvons pas activer la ventilation avec force.  Nous avons déjà convenu qu'un bouton sera connecté à l'entrée <b>Input1</b> , ce qui <b>activera</b> et désactivera le ventilateur de force, sans prêter attention au capteur d'humidité. <br>  Il est temps de traiter ce bouton dans notre programme de circuits. <br><br><img src="https://habrastorage.org/webt/rn/9h/p8/rn9hp8-41uqwkms65uqiwynd_-k.png"><br><br>  L'unité de traitement des clics sur les boutons est surlignée en orange.  Il s'agit d'un compteur de clics de bouton qui est remis à zéro lorsque la valeur à sa sortie dépasse un (ligne verte, sortie du nœud <b>CT</b> ). <br><br>  Tout fonctionne ici comme avant: le compteur <b>CT</b> compte les clics du bouton connecté à <b>Input1</b> .  Autrement dit, la valeur à la sortie de ce compteur augmente de 1 à chaque clic sur le bouton. <br><br>  Dès que cette valeur devient égale à deux (soit plus de 1), immédiatement à la sortie du comparateur <b>A&gt; B</b> apparaît 1. Et ce 1 remet le compteur <b>CT</b> à zéro.  Cela signifie le comparateur, le plus bas selon le schéma! <br><br>  Ainsi, notre bouton a deux états - 0 et 1. Si nous avions besoin de plus d'états (3 ou 4 ou même plus) - il nous suffirait de changer la constante <b>CONST</b> d'une valeur à une autre. <br><br>  Nous avons donc deux conditions pour allumer le ventilateur: dépasser le niveau d'humidité réglé et appuyer une fois sur le bouton.  Si l'une des conditions est remplie, le ventilateur se met en marche.  Et cela fonctionnera jusqu'à ce que vous appuyiez à nouveau sur le bouton <b>ET que</b> le niveau d'humidité revienne à la normale. <br><br>  Vous pouvez, bien sûr, compliquer encore plus l'algorithme, mais nous ne le ferons pas - nous laisserons de la place à la créativité pour ceux qui le souhaitent. <br><br><h4>  Option trois, connectez-vous à Internet </h4><br>  Tout ce que nous avons décrit est assez fonctionnel.  Mais qu'en est-il du spectacle?  Après tout, n'importe quel hipster-hacker-cracker maculé se moquera de quelqu'un qui tord un stylo et appuie sur un bouton, et ne le contrôle pas depuis un smartphone!  Tourner la poignée n'est «pas à la mode».  Mais pour ramper votre doigt sur le smartphone, effacer ce doigt dans le sang - le voici, le pic des désirs du pirate hipster-pirate (je ne pourrais jamais les distinguer tous - donc si j'ai fait une erreur, je suis désolé). <br><br>  Mais nous serons condescendants envers ces individus.  La gouvernance d'Internet présente de réels avantages.  Tout d'abord, c'est visuel.  Il existe de nombreuses applications pour toutes les plates-formes qui permettent à quelques pics de créer un panneau de contrôle complètement utilisable pour notre contrôleur Carlson.  Deuxièmement, c'est l'occasion de surveiller à distance l'état d'humidité dans la pièce.  Et troisièmement, vous pouvez voir non seulement ce que fait le ventilateur - qu'il tourne ou non, mais aussi quel seuil d'humidité est réglé.  Et puis - le ventilateur s'est allumé automatiquement ou manuellement.  En général, tout ce que vous voulez. <br><br>  Bien sûr, pour certains fans, il y a beaucoup d'honneur - beaucoup d'attention.  Mais ce n'est qu'un exemple. <br><br>  Ainsi, pour nous connecter à Internet, nous utiliserons la technologie <b>MQTT</b> et le protocole du même nom. <br>  Pour utiliser cette technologie, nous avons besoin d'un <b>courtier MQTT</b> .  Il s'agit d'un serveur spécial qui sert les <b>clients MQTT</b> , par exemple, <b>ShIoTIny</b> et votre smartphone. <br><br>  L'essence de la technologie <b>MQTT</b> est que tout client publie des données arbitraires sous un nom spécifique (appelé <b>rubrique</b> dans la terminologie <b>MQTT</b> ) sur un courtier MQTT (serveur).  D'autres clients peuvent s'abonner à des données arbitraires par leur nom ( <b>sujet</b> ) et recevoir des données récemment publiées.  Autrement dit, l'ensemble de l'échange de données repose sur le principe du client-courtier-client. <br><br>  Je <i><b>ne me</b></i> concentrerai <i><b>pas</b></i> sur les détails.  Il existe des tonnes d'articles et de didacticiels sur Internet sur le fonctionnement de <b>MQTT</b> et le type de programmes permettant de créer des panneaux de contrôle.  Je vais juste vous montrer comment recevoir et publier des données à l'aide de <b>ShIoTiny</b> . <br><br>  En tant que courtier, j'ai utilisé <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.cloudmqtt.com</a> , mais le principe est le même partout. <br><br>  Nous supposerons donc que vous vous êtes inscrit auprès du <b>courtier MQTT</b> .  En général, le courtier vous donnera (ou exigera d'inventer) un nom d'utilisateur et un mot de passe (pour l'autorisation), ainsi qu'un port de connexion.  <b>Il</b> existe deux façons de connecter <b>ShIoTiny</b> au <b>courtier MQTT</b> - une connexion régulière et <b>TLS</b> ( <b>SSL</b> ). <br><br>  Tous ces paramètres dans <b>ShIoTiny</b> sont entrés dans l'onglet <b>Réseau</b> , la section <b>Connexion MQTT au serveur</b> . <br><br><img src="https://habrastorage.org/webt/97/6j/kb/976jkbemm294uso3-pjdcb4wx_4.png"><br><br>  Si votre <b>courtier MQTT</b> n'a pas besoin d'autorisation, n'entrez pas votre identifiant et votre mot de passe (laissez ces champs vides). <br><br>  Le paramètre de <b>préfixe de rubrique MQTT</b> nécessite une explication distincte. <br><br>  Le préfixe des paramètres MQTT est une ligne ajoutée au titre de la rubrique lors de la publication et de l'abonnement au courtier MQTT.  Pour définir le <b>préfixe MQTT</b> de votre contrôleur, il vous suffit de le saisir dans le champ de saisie " <b>Préfixe de sujet MQTT</b> " (" <b>Préfixe de sujet MQTT</b> ").  Le préfixe commence toujours par une barre oblique ( <b>"/"</b> )!  Si vous n'entrez pas de barre oblique dans le champ de saisie, elle sera ajoutée automatiquement.  Les caractères <b>"#"</b> et <b>"+"</b> ne peuvent pas être utilisés dans le préfixe.  Il n'y a aucune autre restriction. <br><br>  Par exemple, si vous publiez le paramètre « <b>status</b> » (ou vous y abonnez) et que votre préfixe est défini sur « <b>/ shiotiny /</b> », alors sur le courtier ce paramètre sera publié sous le nom « <b>/ shiotiny / status</b> ».  Si vous avez un préfixe vide défini, tous les paramètres du courtier commenceront par une barre oblique ( <b>«/»</b> ): « <b>status</b> » sera publié sous « <b>/ status</b> ». <br><br>  Nous pensons donc que vous vous êtes inscrit auprès du <b>courtier MQTT</b> et avez reçu votre identifiant, votre mot de passe et votre port.  Ensuite, vous définissez ces paramètres dans l'onglet <b>Réseau</b> , la <b>section</b> <b>Connexion MQTT au serveur</b> <b>du</b> contrôleur <b>ShIoTiny</b> . <br><br>  Nous pensons que le préfixe est défini sur " <b>/ room /</b> ". <br><br>  Pour commencer, nous publierons l'état de tous les paramètres clés: relais <b>Realay1</b> , état manuel, état automatique et enfin, seuils et niveaux d'humidité actuels.  Eh bien et un bonus - la température dans la pièce.  Comment faire, voir la figure. <br><br><img src="https://habrastorage.org/webt/tq/xj/la/tqxjla44g3klhb_apkinf7yudka.png"><br><br>  Comme vous pouvez le voir, la différence par rapport à la version précédente n'est que les nœuds de <b>publication MQTT</b> .  Compte tenu du préfixe, les paramètres suivants sont publiés: <br><img src="https://habrastorage.org/webt/hr/9c/wd/hr9cwdccjlb3tnpkgm2g7grdyhe.jpeg"><br><br>  Comme vous pouvez le voir, l'état du système est bien en vue! <br><br>  Mais nous voulons non seulement voir, mais aussi contrôler.  Comment être  Très simple.  Nous refuserons de régler le seuil d'humidité à l'aide de l' <b>ADC</b> et d'une résistance variable et nous fixerons ce seuil même d'humidité par <b>MQTT</b> directement depuis le smartphone! <br><br><img src="https://habrastorage.org/webt/dr/e3/yw/dre3ywd0uyw_cjtw8tnzr-doicq.png"><br><br>  Nous supprimons le nœud ADC du circuit et y ajoutons trois nouveaux nœuds: <b>FLASH store</b> , <b>FLASH restore</b> et <b>MQTT decrivent</b> . <br><br>  La fonction du nœud de <b>description MQTT</b> est évidente: il reçoit le <b>paramètre / room / trigHset</b> (seuil d'humidité) du <b>courtier MQTT</b> .  Mais que fait-il des données ensuite?  Il les donne simplement au nœud de <b>stockage FLASH</b> , qui, à son tour, stocke ces données dans une mémoire non volatile sous le nom <b>trigH</b> .  Après cela, le nœud de <b>restauration FLASH</b> lit les données sous le nom <b>trigH</b> de la mémoire non volatile et nous savons déjà ce qui se passe ensuite. <br><br>  Pourquoi de telles difficultés?  Pourquoi ne puis-je pas envoyer immédiatement les données reçues à l'entrée du comparateur? <br><br>  Comme le disait le camarade S. Holmes, <i>c'est élémentaire</i> !  Personne ne garantit qu'après avoir allumé votre appareil, il rejoindra le <b>courtier MQTT</b> .  Et l'humidité doit être mesurée.  Et le ventilateur doit être allumé.  Mais sans information sur le seuil d'humidité, c'est impossible!  Par conséquent, lorsqu'il est allumé, notre appareil extrait un niveau d'humidité seuil précédemment stocké de la mémoire non volatile et l'utilise pour la prise de décision.  Et lorsque la connexion avec le <b>courtier MQTT est établie</b> et que quelqu'un publie une nouvelle valeur <b>/ chambre / trigHset</b> , cette nouvelle valeur sera utilisée. <br><br>  Ensuite, vous pouvez inventer tout ce que vous voulez.  Par exemple, en plus de l'humidité, entrez également un enregistrement de température.  Ou ajoutez une commande d'éclairage «intelligente» (nous avons encore laissé deux relais et deux entrées inutilisés).  Tout est entre vos mains! <br><br><h4>  Conclusion </h4><br>  Nous avons donc examiné plusieurs exemples de la mise en œuvre du contrôleur par essence le plus simple basé sur ShIoTiny.  Ce sera peut-être utile à quelqu'un. <br><br>  Comme toujours, suggestions, souhaits, questions, fautes de frappe, etc., par e-mail: <b>shiotiny@yandex.ru</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr464485/">https://habr.com/ru/post/fr464485/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr464465/index.html">Comment et pourquoi avons-nous migré Preply vers Kubernetes</a></li>
<li><a href="../fr464467/index.html">Apprenez l'analyse Web à partir de zéro. Grand choix</a></li>
<li><a href="../fr464471/index.html">surveillance des imprimantes snmp dans The Dude</a></li>
<li><a href="../fr464479/index.html">"Manifeste de programmeurs novices de spécialités connexes" ou comment je suis arrivé à une telle vie</a></li>
<li><a href="../fr464481/index.html">Comment nous avons construit un système de formation et de motivation en studio</a></li>
<li><a href="../fr464487/index.html">Nous construisons une interface pour saisir des documents par sélection</a></li>
<li><a href="../fr464489/index.html">Buildbot en exemples</a></li>
<li><a href="../fr464491/index.html">Vivaldi 2.7 - Une vie intense en silence</a></li>
<li><a href="../fr464495/index.html">Développement d'équipe et réflexion comme communication managériale du chef d'équipe</a></li>
<li><a href="../fr464497/index.html">JIRA comme remède contre l'insomnie et les dépressions nerveuses</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>