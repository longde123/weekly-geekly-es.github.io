<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçüç≥ üôéüèª üöß ShIoTiny: ventilation de pi√®ce humide (exemple de projet) üôéüèæ üèÄ üßïüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Points cl√©s ou sujet de cet article 
 Nous continuons la s√©rie d'articles sur ShIoTiny - un contr√¥leur visuellement programmable bas√© sur la puce ESP8...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ShIoTiny: ventilation de pi√®ce humide (exemple de projet)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464485/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ue/so/ox/uesoox7zwrguyei6o5m_ndp2ufw.jpeg"></div><br><h4>  Points cl√©s ou sujet de cet article </h4><br>  Nous continuons la s√©rie d'articles sur <b>ShIoTiny</b> - un contr√¥leur visuellement programmable bas√© sur la puce <b>ESP8266</b> . <br><br>  Cet article d√©crit un exemple de projet de contr√¥le de la ventilation dans une salle de bain ou une autre pi√®ce humide sur la fa√ßon de cr√©er un programme pour <b>ShIoTiny</b> . <br><br><h4>  Articles pr√©c√©dents de la s√©rie. </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ShIoTiny: petite automatisation, Internet des objets, ou ¬´six mois avant les vacances¬ª</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ShIoTiny: n≈ìuds, liens et √©v√©nements ou caract√©ristiques des programmes de dessin</a> <br><br><h4>  Les r√©f√©rences </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>Site du</b> projet <b>ShIoTiny</b></a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Micrologiciel binaire, circuits de contr√¥leur et documentation</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Instructions et description des n≈ìuds</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Configuration du courtier MQTT cloudmqtt.com</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Panneau de configuration du tableau de bord MQTT pour Android</a> <br><a name="habracut"></a><br><h4>  Pr√©sentation </h4><br>  Il n'y a pas de compr√©hension en dehors de l'exp√©rience.  Telle est la v√©rit√© test√©e par le temps et les g√©n√©rations.  Par cons√©quent, il n'y a rien de mieux pour apprendre des comp√©tences pratiques que d'essayer de faire quelque chose par vous-m√™me.  Et des exemples qui montrent ce qui peut √™tre fait et ce qui ne vaut pas la peine d'√™tre essay√©s, ici, seront utiles.  Bien entendu, les erreurs des autres ne peuvent pas emp√™cher la survenue d'erreurs, mais peuvent aider √† r√©duire le nombre de ces derni√®res. <br><br>  Les questions et les lettres des lecteurs d'articles pr√©c√©dents m'ont inspir√© pour r√©aliser un petit projet, un exemple de contr√¥le de la ventilation, afin de montrer comment fonctionnent les n≈ìuds ShIoTiny. <br><br>  L'id√©e initiale, sur la base de laquelle le contr√¥leur <b>ShIoTiny est apparu</b> - une <b>station de pompage</b> et d'irrigation - est loin de convenir √† tout le monde et sera int√©ressante.  Par cons√©quent, j'ai pris pour tout le monde un syst√®me de contr√¥le de la ventilation compr√©hensible et utile √† titre d'exemple. <br><br>  Je dirai que l'id√©e du projet n'est pas la mienne, mais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">je l'ai eu d'ici</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">je l'ai</a> ensuite adapt√©e √† <b>ShIoTiny</b> . <br><br><h4>  Comprenez d'abord ce que vous voulez </h4><br>  Le processus de cultivation est sans fin.  Et c'est cette propri√©t√© qui a ruin√© beaucoup de bonnes id√©es et de bons projets.  Le d√©veloppeur, au lieu de publier, si ce n'est pas un id√©al, mais une chose fonctionnelle, a continu√© de l'am√©liorer.  Et il l'a perfectionn√© jusqu'√† ce que ses concurrents le contournent, lib√©rant, sinon une solution id√©ale (et souvent franchement mis√©rable), mais fonctionnelle. <br><br>  Par cons√©quent, il est tr√®s important de savoir o√π mettre fin au projet.  Ou, en d'autres termes, il est n√©cessaire de d√©terminer ce que nous voulons obtenir √† la fin du projet √† partir de ce que nous avons au d√©but.  En russe, pour un document qui est r√©dig√© juste pour d√©crire la fa√ßon de cr√©er quelque chose, il y a un beau mot court et volumineux "plan", que les traducteurs mentalement retard√©s et les gestionnaires d√©fectueux ont r√©cemment commenc√© √† appeler la "feuille de route" pour une raison quelconque.  Eh bien, Dieu les b√©nisse. <br><br>  Notre plan sera comme √ßa.  Supposons qu'il existe une pi√®ce dans laquelle l'humidit√© peut parfois augmenter consid√©rablement.  Par exemple, comme une salle de bain ou une cuisine.  L'humidit√© est une chose d√©sagr√©able et la fa√ßon de la g√©rer est aussi vieille que le monde: a√©rez la pi√®ce.  Il existe plusieurs m√©thodes de diffusion.  Mais nous refuserons peut-√™tre les mani√®res exotiques et d√©mod√©es comme les noirs avec des toiles et nous arr√™terons au fan habituel.  Les fans sont moins chers et les trouver dans notre r√©gion est plus facile. <br><br>  En bref, nous voulons contr√¥ler le ventilateur: allumez-le et √©teignez-le, respectivement.  Plus pr√©cis√©ment, nous voulons qu'il s'allume et s'√©teigne si n√©cessaire. <br><br>  Il reste √† d√©terminer: dans quelles conditions le ventilateur doit-il s'allumer et dans quelles conditions - s'√©teindre. <br><br>  Tout est √©vident ici: si l'humidit√© d√©passe une limite pr√©d√©termin√©e, le ventilateur se met en marche et aspire de l'air;  l'humidit√© est revenue √† la normale - le ventilateur s'arr√™te. <br><br>  Le lecteur attentif attirera imm√©diatement son attention sur le mot ¬´donn√©¬ª.  Qui est donn√©?  Comment pr√©r√©gl√©? <br><br>  Il existe plusieurs fa√ßons de r√©gler le seuil d'humidit√©.  Nous en consid√©rerons deux: le premier - √† l'aide d'une r√©sistance variable et le second - sur le r√©seau via le protocole MQTT.  Chacune de ces m√©thodes pr√©sente des avantages et des inconv√©nients, qui seront discut√©s plus loin. <br><br>  Pour ceux qui ne comprennent pas, je vais expliquer que le ¬´seuil d'humidit√©¬ª est un niveau d'humidit√©, d√©passant ce qui n√©cessite l'inclusion d'un ventilateur. <br><br>  La question suivante est de savoir si donner √† l'utilisateur le droit d'allumer le ventilateur directement?  Autrement dit, quel que soit le niveau d'humidit√©, au simple toucher d'un bouton?  Nous allons offrir une telle opportunit√©.  Apr√®s tout, un ventilateur peut √™tre n√©cessaire non seulement avec une humidit√© √©lev√©e, mais aussi pour √©liminer de la pi√®ce, par exemple, une odeur d√©sagr√©able, commun√©ment appel√©e ¬´puanteur¬ª. <br><br>  Nous avons donc compris ce que nous voulons et m√™me un peu comment cela fonctionnera.  Nous √©num√©rons bri√®vement toutes les fonctions de notre syst√®me de contr√¥le de la ventilation: <br><br><ul><li>  fixer un seuil d'humidit√© (deux options); </li><li>  mesure de l'humidit√©; </li><li>  inclusion automatique du ventilateur; </li><li>  arr√™t automatique du ventilateur; </li><li>  inclusion manuelle du ventilateur (sur simple pression d'un bouton). </li></ul><br>  Donc, le plan est clair.  Il est n√©cessaire de mettre en ≈ìuvre toutes les fonctions ci-dessus dans notre programme.  Sur la base de ce ¬´plan¬ª, nous agirons.  Pour commencer, dessinez un sch√©ma fonctionnel de l'appareil. <br><br><h4>  Sch√©ma fonctionnel de l'appareil </h4><br>  D'une mani√®re g√©n√©rale, nous aurons deux de ces r√©gimes.  La premi√®re concerne l'option dans laquelle le seuil d'humidit√© est r√©gl√© par une r√©sistance variable.  Le deuxi√®me sch√©ma concerne l'option dans laquelle le seuil d'humidit√© est r√©gl√© via le r√©seau via le protocole MQTT. <br><br>  Mais comme ces circuits ne diff√©reront que d'un √©l√©ment - la r√©sistance variable "fixant le seuil d'humidit√©", nous ne dessinerons qu'un seul diagramme structurel.  Bien s√ªr, le sch√©ma structurel selon GOST semble diff√©rent.  Mais nous ne nous concentrons pas sur les ing√©nieurs des bisons, mais sur la jeune g√©n√©ration.  Par cons√©quent, la visibilit√© est plus importante. <br><br><img src="https://habrastorage.org/webt/ut/qh/db/utqhdblfgdlmsv0rkcgqxaztvo8.jpeg"><br><br>  Alors que voit-on sur l'image?  Le ventilateur est connect√© au relais <b>Relay1 du</b> contr√¥leur <b>ShIoTiny</b> .  J'attire votre attention sur le fait que le ventilateur est un engin qui vit sous haute tension.  Par cons√©quent, si quelqu'un le fait lui-m√™me - soyez prudent.  C'est, au moins, avant de coller vos doigts ou des instruments de mesure dans le circuit - d√©connectez au moins le ventilateur.  Et le deuxi√®me point.  Si votre ventilateur est plus puissant que <b>250 W</b> , vous <b>ne</b> devez pas le connecter directement √† <b>ShIoTiny</b> - uniquement via le d√©marreur. <br><br>  Nous avons compris le ventilateur.  Maintenant, le bouton ¬´marche manuelle¬ª du ventilateur.  Il est connect√© √† l'entr√©e <b>Input1</b> .  Il n'y a plus rien √† expliquer. <br><br>  Capteur de temp√©rature et d'humidit√© <b>DHT-11</b> (ou <b>DHT-22</b> ou leurs analogues).  Pour le connecter, une entr√©e sp√©ciale est fournie sur le contr√¥leur <b>ShIoTiny</b> .  Comme vous pouvez le voir sur la figure, la connexion d'un tel capteur ne pr√©sente pas non plus de probl√®mes. <br><br>  Et enfin, une r√©sistance variable qui fixe le seuil d'humidit√©.  Plus pr√©cis√©ment, un diviseur compos√© de r√©sistances variables et constantes.  Il n'y a aucun probl√®me avec sa connexion, mais je vais expliquer que l'ADC int√©gr√© sur l' <b>ESP8266 est</b> con√ßu pour un maximum de 1 volt.  Par cons√©quent, un diviseur de tension est n√©cessaire environ 5 fois. <br><br>  Et encore une fois je vous rappelle que ce diviseur n'est pas n√©cessaire si le seuil d'humidit√© est r√©gl√© via le r√©seau en utilisant le protocole MQTT. <br><br>  Nous allons commencer √† √©laborer l'algorithme de l'appareil dans l'√©diteur ElDraw ShIoTiny.  Comment y arriver, dans cet √©diteur, vous pouvez lire dans les articles pr√©c√©dents ou dans les instructions, dont un lien se trouve au d√©but de l'article. <br><br><h4>  Premi√®re option, la plus simple </h4><br>  Commen√ßons par un simple: allumez le relais <b>Relay1 lorsque</b> le seuil d'humidit√© est d√©pass√© pendant un temps donn√©. <br><br><img src="https://habrastorage.org/webt/un/8e/kd/un8ekdrb8cy8zvbc6e_ae2ygwyw.png"><br><br>  Comme vous pouvez le voir, rien de compliqu√©: juste quatre n≈ìuds, sans compter les n≈ìuds de commentaire.  <b>Le DHT11</b> est en fait un capteur de temp√©rature et d'humidit√© (peut √™tre chang√© en <b>DHT22</b> ). <br><br>  La <b>constante CONST</b> est le niveau d'humidit√© seuil, en pourcentage. <br><br>  Comparateur - un n≈ìud comparant deux nombres et d√©finissant la sortie 1 si la condition sp√©cifi√©e est remplie et 0 si la condition n'est pas remplie. <br><br>  Dans notre cas, cette condition sera <b>A&gt; B</b> , o√π <b>A</b> est le niveau d'humidit√© mesur√© par le capteur, et <b>B</b> est le niveau seuil de la m√™me humidit√©. <br><br>  D√®s que le niveau d'humidit√© mesur√© ( <b>A</b> ) d√©passe le niveau d'humidit√© seuil ( <b>B</b> ), 1 appara√Æt imm√©diatement √† la sortie du comparateur <b>A&gt; B</b> et le relais s'allume.  Inversement, d√®s que le niveau d'humidit√© redevient normal (c'est-√†-dire <b>A &lt;= B</b> ), imm√©diatement √† la sortie du comparateur <b>A&gt; B,</b> 0 appara√Æt et le relais s'√©teint. <br><br>  Tout est-il clair?  Pour ceux qui ne le font pas vraiment, relisez-le ou regardez la description du fonctionnement des n≈ìuds dans les instructions. <br><br>  Je note que les donn√©es du capteur <b>DHT11 sont</b> mises √† jour environ toutes les 10 secondes.  Par cons√©quent, le relais ne pourra pas s'allumer et s'√©teindre plus d'une fois toutes les 10 secondes. <br><br>  Tout irait bien, mais nous aimerions r√©gler le seuil d'humidit√© √† l'aide d'une r√©sistance variable.  Rien de plus simple! <br><br><img src="https://habrastorage.org/webt/ez/qe/oi/ezqeoioucwwf0nm90o2sibwizj0.png"><br><br>  Remplacez simplement le n≈ìud constant par le n≈ìud ADC.  Apr√®s tout, c'est √† l'ADC que nous avons connect√© le diviseur de tension avec une r√©sistance variable. <br><br>  La tension √† l'entr√©e ADC varie de 0 √† 1 Volt.  Mais l'humidit√© √† la sortie du capteur - varie de 0 √† 100%.  Comment les comparons-nous?  Tout est simple.  Le n≈ìud ADC dans <b>ShIoTiny</b> mesure non seulement la tension d'entr√©e, mais sait √©galement comment la mettre √† l' <i><b>√©chelle et la d√©caler</b></i> . <br><br>  Autrement dit, √† la sortie du n≈ìud ADC1 (ADC), il y aura une valeur <b>X</b> calcul√©e par la formule <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>X</mi><mo>=</mo><mi>k</mi><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><msub><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>n</mi></mrow></msub><mo>+</mo><mi>b</mi></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.014ex" height="2.419ex" viewBox="0 -780.1 7755.9 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-58" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMAIN-3D" x="1130" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-6B" x="2186" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-63" x="2958" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-64" x="3391" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-6F" x="3915" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-74" x="4400" y="0"></use><g transform="translate(4762,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-75" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-6E" x="345" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMAIN-2B" x="6325" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-62" x="7326" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>X</mi><mo>=</mo><mi>k</mi><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>n</mi></mrow></msub><mo>+</mo><mi>b</mi></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> X = k \ cdot u_ {in} + b </script></p>  o√π <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>n</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.116ex" height="1.817ex" viewBox="0 -520.7 1341.4 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-75" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-6E" x="345" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>n</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-2"> u_ {in} </script>  - tension √† l'entr√©e ADC (de 0 √† 1V);  Plage <b>k</b> (plage ADC) et d√©calage <b>b</b> (d√©calage ADC).  Ainsi, si vous d√©finissez <b>k = 100</b> et <b>b = 0</b> , alors lors du changement <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>n</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.116ex" height="1.817ex" viewBox="0 -520.7 1341.4 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-75" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhi3Qczak1LGJOIl7Uf2qyG30-IeVg#MJMATHI-6E" x="345" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>n</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-3"> u_ {in} </script>  dans la plage de 0 √† 1, la valeur de <b>X</b> √† la sortie de l'unit√© ADC variera dans la plage de 0 √† 100. C'est-√†-dire, num√©riquement √©gale √† la plage des changements d'humidit√© de 0 √† 100%. <br><br>  Ou, tout simplement, en tournant le moteur √† r√©sistance variable, vous pouvez r√©gler le seuil d'humidit√© de 0 √† 100. Le seul inconv√©nient est qu'il n'y a pas de dispositifs d'affichage.  Mais en pratique, si le moteur √† r√©sistance variable fait 6 divisions 0%, 20%, 40%, 60%, 80%, 100%), cela suffit pour r√©gler le seuil d'humidit√©. <br><br>  Comment d√©finir les coefficients <b>k</b> - plage (plage ADC) et <b>b -</b> d√©calage (d√©calage ADC)?  Oui, c‚Äôest plus facile que des navets cuits √† la vapeur!  Cliquez avec le pointeur de la souris dans le n≈ìud <b>ADC1</b> et vous verrez imm√©diatement la fen√™tre des param√®tres.  Vous pouvez y d√©finir tout ce dont vous avez besoin.  Pour notre cas, ce sera une telle fen√™tre, comme sur la figure. <br><br><img src="https://habrastorage.org/webt/cn/so/ub/cnsoubc9q_rhu-2p6hlffcd_1ig.png"><br><br>  Nous avons donc la solution de travail la plus simple.  Commen√ßons √† l'am√©liorer. <br>  Soit dit en passant, la solution la plus simple a un avantage: elle n'a pas besoin d'Internet.  Il est compl√®tement autonome. <br><br><h4>  Option deux, connectez le bouton </h4><br>  Tout fonctionne et tout le monde est content.  Mais pas de chance, nous ne pouvons pas activer la ventilation avec force.  Nous avons d√©j√† convenu qu'un bouton sera connect√© √† l'entr√©e <b>Input1</b> , ce qui <b>activera</b> et d√©sactivera le ventilateur de force, sans pr√™ter attention au capteur d'humidit√©. <br>  Il est temps de traiter ce bouton dans notre programme de circuits. <br><br><img src="https://habrastorage.org/webt/rn/9h/p8/rn9hp8-41uqwkms65uqiwynd_-k.png"><br><br>  L'unit√© de traitement des clics sur les boutons est surlign√©e en orange.  Il s'agit d'un compteur de clics de bouton qui est remis √† z√©ro lorsque la valeur √† sa sortie d√©passe un (ligne verte, sortie du n≈ìud <b>CT</b> ). <br><br>  Tout fonctionne ici comme avant: le compteur <b>CT</b> compte les clics du bouton connect√© √† <b>Input1</b> .  Autrement dit, la valeur √† la sortie de ce compteur augmente de 1 √† chaque clic sur le bouton. <br><br>  D√®s que cette valeur devient √©gale √† deux (soit plus de 1), imm√©diatement √† la sortie du comparateur <b>A&gt; B</b> appara√Æt 1. Et ce 1 remet le compteur <b>CT</b> √† z√©ro.  Cela signifie le comparateur, le plus bas selon le sch√©ma! <br><br>  Ainsi, notre bouton a deux √©tats - 0 et 1. Si nous avions besoin de plus d'√©tats (3 ou 4 ou m√™me plus) - il nous suffirait de changer la constante <b>CONST</b> d'une valeur √† une autre. <br><br>  Nous avons donc deux conditions pour allumer le ventilateur: d√©passer le niveau d'humidit√© r√©gl√© et appuyer une fois sur le bouton.  Si l'une des conditions est remplie, le ventilateur se met en marche.  Et cela fonctionnera jusqu'√† ce que vous appuyiez √† nouveau sur le bouton <b>ET que</b> le niveau d'humidit√© revienne √† la normale. <br><br>  Vous pouvez, bien s√ªr, compliquer encore plus l'algorithme, mais nous ne le ferons pas - nous laisserons de la place √† la cr√©ativit√© pour ceux qui le souhaitent. <br><br><h4>  Option trois, connectez-vous √† Internet </h4><br>  Tout ce que nous avons d√©crit est assez fonctionnel.  Mais qu'en est-il du spectacle?  Apr√®s tout, n'importe quel hipster-hacker-cracker macul√© se moquera de quelqu'un qui tord un stylo et appuie sur un bouton, et ne le contr√¥le pas depuis un smartphone!  Tourner la poign√©e n'est ¬´pas √† la mode¬ª.  Mais pour ramper votre doigt sur le smartphone, effacer ce doigt dans le sang - le voici, le pic des d√©sirs du pirate hipster-pirate (je ne pourrais jamais les distinguer tous - donc si j'ai fait une erreur, je suis d√©sol√©). <br><br>  Mais nous serons condescendants envers ces individus.  La gouvernance d'Internet pr√©sente de r√©els avantages.  Tout d'abord, c'est visuel.  Il existe de nombreuses applications pour toutes les plates-formes qui permettent √† quelques pics de cr√©er un panneau de contr√¥le compl√®tement utilisable pour notre contr√¥leur Carlson.  Deuxi√®mement, c'est l'occasion de surveiller √† distance l'√©tat d'humidit√© dans la pi√®ce.  Et troisi√®mement, vous pouvez voir non seulement ce que fait le ventilateur - qu'il tourne ou non, mais aussi quel seuil d'humidit√© est r√©gl√©.  Et puis - le ventilateur s'est allum√© automatiquement ou manuellement.  En g√©n√©ral, tout ce que vous voulez. <br><br>  Bien s√ªr, pour certains fans, il y a beaucoup d'honneur - beaucoup d'attention.  Mais ce n'est qu'un exemple. <br><br>  Ainsi, pour nous connecter √† Internet, nous utiliserons la technologie <b>MQTT</b> et le protocole du m√™me nom. <br>  Pour utiliser cette technologie, nous avons besoin d'un <b>courtier MQTT</b> .  Il s'agit d'un serveur sp√©cial qui sert les <b>clients MQTT</b> , par exemple, <b>ShIoTIny</b> et votre smartphone. <br><br>  L'essence de la technologie <b>MQTT</b> est que tout client publie des donn√©es arbitraires sous un nom sp√©cifique (appel√© <b>rubrique</b> dans la terminologie <b>MQTT</b> ) sur un courtier MQTT (serveur).  D'autres clients peuvent s'abonner √† des donn√©es arbitraires par leur nom ( <b>sujet</b> ) et recevoir des donn√©es r√©cemment publi√©es.  Autrement dit, l'ensemble de l'√©change de donn√©es repose sur le principe du client-courtier-client. <br><br>  Je <i><b>ne me</b></i> concentrerai <i><b>pas</b></i> sur les d√©tails.  Il existe des tonnes d'articles et de didacticiels sur Internet sur le fonctionnement de <b>MQTT</b> et le type de programmes permettant de cr√©er des panneaux de contr√¥le.  Je vais juste vous montrer comment recevoir et publier des donn√©es √† l'aide de <b>ShIoTiny</b> . <br><br>  En tant que courtier, j'ai utilis√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.cloudmqtt.com</a> , mais le principe est le m√™me partout. <br><br>  Nous supposerons donc que vous vous √™tes inscrit aupr√®s du <b>courtier MQTT</b> .  En g√©n√©ral, le courtier vous donnera (ou exigera d'inventer) un nom d'utilisateur et un mot de passe (pour l'autorisation), ainsi qu'un port de connexion.  <b>Il</b> existe deux fa√ßons de connecter <b>ShIoTiny</b> au <b>courtier MQTT</b> - une connexion r√©guli√®re et <b>TLS</b> ( <b>SSL</b> ). <br><br>  Tous ces param√®tres dans <b>ShIoTiny</b> sont entr√©s dans l'onglet <b>R√©seau</b> , la section <b>Connexion MQTT au serveur</b> . <br><br><img src="https://habrastorage.org/webt/97/6j/kb/976jkbemm294uso3-pjdcb4wx_4.png"><br><br>  Si votre <b>courtier MQTT</b> n'a pas besoin d'autorisation, n'entrez pas votre identifiant et votre mot de passe (laissez ces champs vides). <br><br>  Le param√®tre de <b>pr√©fixe de rubrique MQTT</b> n√©cessite une explication distincte. <br><br>  Le pr√©fixe des param√®tres MQTT est une ligne ajout√©e au titre de la rubrique lors de la publication et de l'abonnement au courtier MQTT.  Pour d√©finir le <b>pr√©fixe MQTT</b> de votre contr√¥leur, il vous suffit de le saisir dans le champ de saisie " <b>Pr√©fixe de sujet MQTT</b> " (" <b>Pr√©fixe de sujet MQTT</b> ").  Le pr√©fixe commence toujours par une barre oblique ( <b>"/"</b> )!  Si vous n'entrez pas de barre oblique dans le champ de saisie, elle sera ajout√©e automatiquement.  Les caract√®res <b>"#"</b> et <b>"+"</b> ne peuvent pas √™tre utilis√©s dans le pr√©fixe.  Il n'y a aucune autre restriction. <br><br>  Par exemple, si vous publiez le param√®tre ¬´ <b>status</b> ¬ª (ou vous y abonnez) et que votre pr√©fixe est d√©fini sur ¬´ <b>/ shiotiny /</b> ¬ª, alors sur le courtier ce param√®tre sera publi√© sous le nom ¬´ <b>/ shiotiny / status</b> ¬ª.  Si vous avez un pr√©fixe vide d√©fini, tous les param√®tres du courtier commenceront par une barre oblique ( <b>¬´/¬ª</b> ): ¬´ <b>status</b> ¬ª sera publi√© sous ¬´ <b>/ status</b> ¬ª. <br><br>  Nous pensons donc que vous vous √™tes inscrit aupr√®s du <b>courtier MQTT</b> et avez re√ßu votre identifiant, votre mot de passe et votre port.  Ensuite, vous d√©finissez ces param√®tres dans l'onglet <b>R√©seau</b> , la <b>section</b> <b>Connexion MQTT au serveur</b> <b>du</b> contr√¥leur <b>ShIoTiny</b> . <br><br>  Nous pensons que le pr√©fixe est d√©fini sur " <b>/ room /</b> ". <br><br>  Pour commencer, nous publierons l'√©tat de tous les param√®tres cl√©s: relais <b>Realay1</b> , √©tat manuel, √©tat automatique et enfin, seuils et niveaux d'humidit√© actuels.  Eh bien et un bonus - la temp√©rature dans la pi√®ce.  Comment faire, voir la figure. <br><br><img src="https://habrastorage.org/webt/tq/xj/la/tqxjla44g3klhb_apkinf7yudka.png"><br><br>  Comme vous pouvez le voir, la diff√©rence par rapport √† la version pr√©c√©dente n'est que les n≈ìuds de <b>publication MQTT</b> .  Compte tenu du pr√©fixe, les param√®tres suivants sont publi√©s: <br><img src="https://habrastorage.org/webt/hr/9c/wd/hr9cwdccjlb3tnpkgm2g7grdyhe.jpeg"><br><br>  Comme vous pouvez le voir, l'√©tat du syst√®me est bien en vue! <br><br>  Mais nous voulons non seulement voir, mais aussi contr√¥ler.  Comment √™tre  Tr√®s simple.  Nous refuserons de r√©gler le seuil d'humidit√© √† l'aide de l' <b>ADC</b> et d'une r√©sistance variable et nous fixerons ce seuil m√™me d'humidit√© par <b>MQTT</b> directement depuis le smartphone! <br><br><img src="https://habrastorage.org/webt/dr/e3/yw/dre3ywd0uyw_cjtw8tnzr-doicq.png"><br><br>  Nous supprimons le n≈ìud ADC du circuit et y ajoutons trois nouveaux n≈ìuds: <b>FLASH store</b> , <b>FLASH restore</b> et <b>MQTT decrivent</b> . <br><br>  La fonction du n≈ìud de <b>description MQTT</b> est √©vidente: il re√ßoit le <b>param√®tre / room / trigHset</b> (seuil d'humidit√©) du <b>courtier MQTT</b> .  Mais que fait-il des donn√©es ensuite?  Il les donne simplement au n≈ìud de <b>stockage FLASH</b> , qui, √† son tour, stocke ces donn√©es dans une m√©moire non volatile sous le nom <b>trigH</b> .  Apr√®s cela, le n≈ìud de <b>restauration FLASH</b> lit les donn√©es sous le nom <b>trigH</b> de la m√©moire non volatile et nous savons d√©j√† ce qui se passe ensuite. <br><br>  Pourquoi de telles difficult√©s?  Pourquoi ne puis-je pas envoyer imm√©diatement les donn√©es re√ßues √† l'entr√©e du comparateur? <br><br>  Comme le disait le camarade S. Holmes, <i>c'est √©l√©mentaire</i> !  Personne ne garantit qu'apr√®s avoir allum√© votre appareil, il rejoindra le <b>courtier MQTT</b> .  Et l'humidit√© doit √™tre mesur√©e.  Et le ventilateur doit √™tre allum√©.  Mais sans information sur le seuil d'humidit√©, c'est impossible!  Par cons√©quent, lorsqu'il est allum√©, notre appareil extrait un niveau d'humidit√© seuil pr√©c√©demment stock√© de la m√©moire non volatile et l'utilise pour la prise de d√©cision.  Et lorsque la connexion avec le <b>courtier MQTT est √©tablie</b> et que quelqu'un publie une nouvelle valeur <b>/ chambre / trigHset</b> , cette nouvelle valeur sera utilis√©e. <br><br>  Ensuite, vous pouvez inventer tout ce que vous voulez.  Par exemple, en plus de l'humidit√©, entrez √©galement un enregistrement de temp√©rature.  Ou ajoutez une commande d'√©clairage ¬´intelligente¬ª (nous avons encore laiss√© deux relais et deux entr√©es inutilis√©s).  Tout est entre vos mains! <br><br><h4>  Conclusion </h4><br>  Nous avons donc examin√© plusieurs exemples de la mise en ≈ìuvre du contr√¥leur par essence le plus simple bas√© sur ShIoTiny.  Ce sera peut-√™tre utile √† quelqu'un. <br><br>  Comme toujours, suggestions, souhaits, questions, fautes de frappe, etc., par e-mail: <b>shiotiny@yandex.ru</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr464485/">https://habr.com/ru/post/fr464485/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr464465/index.html">Comment et pourquoi avons-nous migr√© Preply vers Kubernetes</a></li>
<li><a href="../fr464467/index.html">Apprenez l'analyse Web √† partir de z√©ro. Grand choix</a></li>
<li><a href="../fr464471/index.html">surveillance des imprimantes snmp dans The Dude</a></li>
<li><a href="../fr464479/index.html">"Manifeste de programmeurs novices de sp√©cialit√©s connexes" ou comment je suis arriv√© √† une telle vie</a></li>
<li><a href="../fr464481/index.html">Comment nous avons construit un syst√®me de formation et de motivation en studio</a></li>
<li><a href="../fr464487/index.html">Nous construisons une interface pour saisir des documents par s√©lection</a></li>
<li><a href="../fr464489/index.html">Buildbot en exemples</a></li>
<li><a href="../fr464491/index.html">Vivaldi 2.7 - Une vie intense en silence</a></li>
<li><a href="../fr464495/index.html">D√©veloppement d'√©quipe et r√©flexion comme communication manag√©riale du chef d'√©quipe</a></li>
<li><a href="../fr464497/index.html">JIRA comme rem√®de contre l'insomnie et les d√©pressions nerveuses</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>