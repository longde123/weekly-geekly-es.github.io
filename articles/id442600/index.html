<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👆🏿 🐉 ⏳ Sistem otomasi rumah saya 🍦 👞 🚣</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Habr! 

 Tujuan artikel ini (siklus) adalah efek Habra, sebuah cerita pengantar tentang sistem otomasi rumah saya, tentu saja saya tidak mencipt...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sistem otomasi rumah saya</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442600/">  Halo, Habr! <br><br>  Tujuan artikel ini (siklus) adalah <s>efek Habra, sebuah</s> cerita pengantar tentang sistem otomasi rumah saya, tentu saja saya tidak menciptakan dan menciptakan segalanya dari awal, tetapi hanya mengumpulkan teknologi dan proyek yang saya anggap paling cocok untuk tujuan ini dan menambahkan sedikit dari diri saya.  Level amatir, tetapi sebagai hasilnya, semuanya bekerja, orang menggunakannya dan tidak mengejar saya dengan klub.  Saya melakukan semuanya sendiri.  Terima kasih kritik konstruktif, akan menarik untuk mengetahui pendapat apa pun. <br><br>  Sistem ini mencakup peralatan, dan serangkaian program: secara langsung sistem otomasi untuk komunikasi dan visualisasi peralatan, komunikasi dan telemetri untuk pemantauan dan pembaruan jarak jauh, asisten suara dari Yandex.  Semuanya <i>(hampir semuanya)</i> terbuka dan diposting di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Github</a> . <br><a name="habracut"></a><br><h3>  Tingkat peralatan </h3><br>  Bagian utama dan penting adalah server berbasis pada Raspberry Pi, tetapi dapat bekerja pada PC dengan Debian atau Ubuntu tanpa masalah.  Sistem operasi raspbian.  Sistem harus bekerja 24/7/365 sehingga Anda memerlukan catu daya berkualitas tinggi, misalnya, PSU ideal untuk iPad. <br><br><img src="https://habrastorage.org/webt/_v/-j/fk/_v-jfkopnckaqd6d2url7bbyso4.jpeg"><br><br>  Untuk Manajemen Jarak Jauh, saya juga memiliki keterampilan untuk asisten suara Yandex membutuhkan server dengan IP "putih" dan domain.  Server MQTT berjalan di server; SSL / TLS digunakan untuk keamanan. <br><br>  Dukungan KNX melalui BAOS 771-774 gateway.  BAOS adalah antarmuka antara bus KNX dan LAN.  Mengizinkan akses ke alamat di bus melalui layanan web dalam format JSON. <br><br>  <b>Peralatan saya:</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Proyek untuk Arduino IDE</a> <br><br>  <b>Pengontrol Wifi berbasis Wemos D1 mini</b> <br><br><img src="https://habrastorage.org/webt/rg/tk/85/rgtk85up8tdsr6xayaj8ocg47-w.jpeg"><br><br>  Didukung oleh jaringan 230 volt, dimungkinkan juga tanpa unit catu daya dari bus 5 volt umum ke power Wemo atau dari peralatan yang dikontrolnya, misalnya, penggerak gorden.  Dimungkinkan untuk memasang di kotak pemasangan dan persimpangan dengan kedalaman yang cukup, misalnya di belakang sakelar. <br><br>  Ini dapat digunakan sebagai pengganti kontrol radio dari berbagai drive tirai. <br><br><div class="spoiler">  <b class="spoiler_title">Skema</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/oy/xk/4w/oyxk4wsdxrvbw4dpkhtzajo6kt0.png"><br></div></div><br>  Pinout dari output terkontrol: <br>  L1, L2 - Output daya dari triac BT-137S, dikontrol oleh output wemo D0, D5 melalui optocoupler MOC 3063S dengan kontrol transisi fase hingga nol.  Menghidupkan dan mematikan beban akan terjadi tanpa menyebabkan gangguan pada jaringan. <br>  p1, p2 - output PWM untuk dimmer atau drive tirai bermotor atau tombol tambahan, tergantung pada pengaturan.  sesuai dengan kesimpulan dari wemos'a D6, D7. <br>  Input analog A0 untuk menghubungkan berbagai sensor, seperti cahaya atau tombol tambahan. <br>  ds - Koneksi sensor suhu DS18B20 sesuai dengan pin D1. <br>  DHT - Menghubungkan sensor suhu DHT22 sesuai dengan pin D2. <br>  b1, b2 - Tombol, pers pendek dan panjang, dengan fungsi penghitung klik, dapat dihubungkan ke output pulsa dari meteran listrik, air, dll. <br><br><div class="spoiler">  <b class="spoiler_title">Demonstrasi kerja</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/PPkzPMNiBQY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br>  Program pengontrol dibuat dalam Arduino IDE.  Cocok untuk semua motherboard berbasis ESP-8266.  Pengaturan jaringan, kontrol, dan pengoperasian pengontrol dilakukan oleh MQTT.  Untuk kenyamanan melihat pengaturan, ada antarmuka Web, sebelumnya ada kemampuan untuk mengontrol melalui http, tapi kemudian saya menganggapnya berlebihan dan menghapusnya. <br><br><div class="spoiler">  <b class="spoiler_title">Antarmuka web</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/xs/ru/id/xsruid9tfryat8x2raxfmv7dggu.png"><br></div></div><br>  Antarmuka web dapat dinonaktifkan.  Untuk kenyamanan konfigurasi awal, skrip dan instruksi winit.sh disediakan.  Untuk mengatur ulang pengontrol ke pengaturan default, Anda harus memasukkan perintah "default 1" atau secara bersamaan menekan tombol b1, b2 selama 20 detik.  Ada juga versi sederhana dari program untuk outlet Sonoff yang dikelola. <br><br>  <b>Pengontrol berbasis Arduino Mega</b> <br><br><img src="https://habrastorage.org/webt/ld/_e/cy/ld_ecy2suip8ef20lc4nmpqi53k.jpeg"><br><br>  Terdiri dari mega itu sendiri dan perisai kartu jaringan W5100, papan memiliki output terpisah untuk dimmer dan input untuk sensor dan tombol, output relai harus dihubungkan secara terpisah menggunakan kabel ke konektor 2-baris yang terletak di papan mega yang terletak di sisi yang berlawanan dari kabel daya dan port USB.  Pengontrol dirancang untuk penutup D6MG. <br><br>  Pinout: <br><br>  D2-9, D11-13 - Output PWM untuk dimmer, frekuensi PWM ditingkatkan dari standar. <br>  D14-21 - DS18B20 dan sensor suhu DHT22. <br>  D22-49 - output relai, output D22-29 dapat dikonfigurasikan untuk tirai, gerbang, tirai drive. <br>  D 10.50-53 - menggunakan kartu jaringan W5100. <br>  A0-16 - input untuk tombol, tekan pendek dan panjang.  A0-A6 dapat dikonfigurasi untuk sensor analog. <br><br>  Pengaturan jaringan untuk mega diatur dalam program sebelum menginstal.  Alamat IP sudah diperbaiki. <br><br><div class="spoiler">  <b class="spoiler_title">Antarmuka web</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/tv/9g/pp/tv9gppypwll3i_iyaqbpnjfzhbq.png"><br></div></div><br>  <b>Dimmer pada triac BT137-600E</b> <br><br><img src="https://habrastorage.org/webt/ss/uy/ah/ssuyahexjpkmq75dsydnyyefyie.jpeg"><br><br>  Input 220 volt, kontrol PWM 0-5 / 3.3 volt, atur dengan mengatur jumper.  0-5 volt untuk bekerja dengan Arduino Mega atau 0-3,3 volt jika terjadi wemo.  Sinyal PWM diumpankan ke input analog A0 Arduino Pro di mana ia dikonversi menjadi penundaan untuk membuka triac, konektor disediakan untuk mem-flash arduino di tempatnya.  Ruang khusus untuk radiator.  Di sisi arduino, ada kontrol dan konektor daya dari arduino (PWM, -, +), di sisi smimstor, ada konektor daya 4-pin - daya dan output ke beban, jika perlu, dapat juga dilengkapi dengan varistor atau snubber.  Papan dimmer dirancang untuk sasis D2MG. <br><br>  Proyek Dimmer: <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/8a1/ec4/335/8a1ec433583539dc1962e14fe1f031cd.png" alt="PCB dari PCBWay"></a> <br><br><div class="spoiler">  <b class="spoiler_title">Demonstrasi kerja</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/Dj-iw9Rz5CE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br>  <b>Ada juga unit triac 28 channel</b> dalam paket D9MG. <br><br><div class="spoiler">  <b class="spoiler_title">Saya minta maaf atas kualitas gambarnya</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/os/iy/ri/osiyriitdnczwrpxqcxttd3saaq.jpeg"><br></div></div><br>  Peralatan terhubung melalui Jaringan Area Lokal, sebuah protokol untuk komunikasi MQTT.  Saya menggunakan server Mosquitto MQTT. <br><br><h3>  Bagian perangkat lunak </h3><br>  Untuk kenyamanan, pertama-tama Anda perlu menyiapkan gambar sistem operasi dengan semua program yang diperlukan, saya menggunakan Raspbian Stretch Lite.  Anda perlu menginstal nodejs, python-pip, python3-pip, supervisor, mosquitto, mosquitto-clients, sqlite3.  Dan paket pip: paho-mqtt dan psutil.  Anda juga dapat menginstal Node-red, sempurna untuk semua jenis percobaan. <br><br>  Setelah Apple Homekit dirilis pada tahun 2016, ternyata semua produsen dan pengembang untuk seluruh keberadaan sistem Smart Home tidak dapat melakukan apa pun yang dekat dalam hal kenyamanan dan fungsionalitas dibandingkan dengan homkit, ini mirip dengan situasi dengan rilis iPhone pertama, ketika ternyata seluruh kebun binatang telepon, telepon pintar, komunikator berubah menjadi sekelompok sampah.  Bagaimanapun, selalu menyenangkan untuk menggunakan produk yang berkualitas dan jadi. <br><br>  Saya memilih proyek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">homekit2mqtt</a> sebagai sistem visualisasi utama.  Tentu saja, Anda dapat menggunakan OpenHUB atau Homeassistant, sistem ini juga bekerja dengan MQTT. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">hjmqtt</a> <br>  Homekit2mqtt menciptakan Homekit Bridge, dapat ditemukan di program Home di perangkat Apple.  Aksesori (pencahayaan, sensor, pengontrol suhu, dll.) Harus didaftarkan dalam file khusus dalam format JSON.  Script filegen.sh dan install.sh bertanggung jawab untuk membuat file ini.  Anda perlu mendaftarkan aksesori di filegen.sh, install.sh menambahkan homekit2mqtt ke pengisian otomatis dan mulai.  Hal utama yang terjadi pada file hjmqtt.py - koneksi aksesori dengan peralatan, juga secara manual dalam file, Anda perlu mendaftarkan aksesori dan parameter peralatan, alamat untuk KNX. <br>  Fungsi untuk aksesori terdaftar di file accessory.py dan accessoryknx.py.  Status perangkat disimpan dalam database sqlite; perpustakaan statdb.py digunakan untuk operasi database. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">hjconnect</a> <br>  Proyek selanjutnya diperlukan untuk telemetri jarak jauh.  Ini adalah penggunaan memori, disk, memuat dan suhu, dan paket psutil digunakan untuk ini.  Sekarang akses terbuka tersedia untuk versi hjconnect hanya untuk memantau dan tanpa enkripsi, dan sebagai proyek terpisah, program untuk menautkan file juga merupakan transfer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">file</a> MQTT <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">melalui-mqtt</a> .  Pengaturan langsung di file hjconnect.py utama.  Jika Anda menjalankannya dengan opsi -l, Anda dapat mengujinya di server MQTT lokal, pengaturan untuk server jauh ada di baris 160 <br><br><pre><code class="python hljs">rclient.connect(<span class="hljs-string"><span class="hljs-string">"test.mosquitto.org"</span></span>, <span class="hljs-number"><span class="hljs-number">1883</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>)</code> </pre> <br>  server test.mosquitto.org dapat diganti dengan domain atau IP Anda.  Untuk mengidentifikasi Raspberry Pi, nomor seri prosesor termasuk dalam topik, jika program dijalankan di komputer lain, alih-alih nomor seri, akan ada string "SN".  Interval pesan diatur pada baris 96. <br><br><pre> <code class="python hljs">th = threading.Timer(<span class="hljs-number"><span class="hljs-number">9</span></span>, my_stat) <span class="hljs-comment"><span class="hljs-comment"># interval</span></span></code> </pre> <br>  di mana 9 adalah detik. <br><br><div class="spoiler">  <b class="spoiler_title">Contoh dari apa yang tampak seperti pemantauan</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/xa/dk/tu/xadktutaa2aiieil1rcwxzhz7zs.png"><br></div></div><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sima</a> <br>  Sekarang hanya Yandex yang memiliki satu-satunya kolom berbahasa Rusia.  Menciptakan keterampilan untuk Alice cukup mudah.  Tidak seperti Siri, ada kebebasan penuh untuk bertindak.  Dan akses di perangkat apa pun.  Hanya, sayangnya, sementara tidak ada cara yang waras untuk meluncurkan keterampilan, terus-menerus menjalankan keterampilan itu tidak nyaman. <br><br><div class="spoiler">  <b class="spoiler_title">Demo</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/XiIFVnCSt-M" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br>  Ini adalah contoh keterampilan kerja.  Untuk memulai keterampilan, Anda memerlukan sertifikat SSL, dapat dibuat menggunakan openssl.  Pada baris sima.py pada baris 14 ada contoh pembuatan sertifikat <br><br><pre> <code class="bash hljs">openssl req -new -keyout crt.pem -out crt.pem -x509 -days 365 -nodes -subj <span class="hljs-string"><span class="hljs-string">'/CN=site.com/O=user/C=RU'</span></span></code> </pre> <br>  site.com dan pengguna harus diganti dengan data mereka. <br><br>  Ketika sebuah skill diluncurkan pada perangkat baru, pengenalnya direkam.  Untuk menautkan pengidentifikasi dan sistem otomasi, Anda harus terlebih dahulu membuat file csv baru di direktori klien berdasarkan pada sampel file my.csv.  Nomor seri ditulis dalam file sesuai dengan templat, ini adalah nomor seri yang sama dari program hjconnect, dan objek kontrol ditulis: nama, jenis, topik.  Topik adalah bagian penting dari topik aksesori MQTT dari file JSON untuk homekit2mqtt.  Kemudian, menggunakan sn.py, Anda perlu mengubah nomor seri menjadi kata sandi dan beri nama kata sandi ini pada perangkat yang akan Anda kelola.  Komunikasi disediakan oleh program hjconnect, dan server pemantauan MQTT adalah komputer yang sama dengan keterampilan yang dijalankan. <br><br>  Terima kasih, selamat tinggal. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id442600/">https://habr.com/ru/post/id442600/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id442590/index.html">Tip & Trik Forensik Digital: Cara Menemukan Koneksi VPN Aktif di Memory Dump</a></li>
<li><a href="../id442592/index.html">Menggunakan Akun Joomla dalam Proyek Django</a></li>
<li><a href="../id442594/index.html">Apakah Anda akan memantau segalanya untuk saya? Ya</a></li>
<li><a href="../id442596/index.html">Soundtrack untuk game: humaniora juga menangis</a></li>
<li><a href="../id442598/index.html">Apakah Headhunter dibutuhkan?</a></li>
<li><a href="../id442602/index.html">Apakah kecepatan penurunan kecepatan berkurang?</a></li>
<li><a href="../id442606/index.html">Objek Domain dengan Lombok: Battle Classic</a></li>
<li><a href="../id442608/index.html">Dompet dingin pertukaran cryptocurrency QuadrigaCX, pendiri yang meninggal, ternyata kosong</a></li>
<li><a href="../id442610/index.html">Telegram-bot + Google Analytics</a></li>
<li><a href="../id442612/index.html">Mesin kardus untuk permainan papan listrik. Bagaimana kami membawanya lebih dekat dengan kenyataan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>