<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§Æ üï¥Ô∏è üòï V8: un a√±o con Specter üë®‚Äçüè´ üë≤üèª üññüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El 3 de enero de 2018, Google Project Zero y otros revelaron los primeros tres de una nueva clase de vulnerabilidades que afectan a los procesadores d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>V8: un a√±o con Specter</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/449546/">  El 3 de enero de 2018, Google Project Zero y otros <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">revelaron los</a> primeros tres de una nueva clase de vulnerabilidades que afectan a los procesadores de ejecuci√≥n especulativa.  Se llamaron <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Spectre</a> (1 y 2) y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Meltdown</a> .  Mediante el uso de mecanismos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">especulativos de ejecuci√≥n de</a> CPU, un atacante puede omitir temporalmente las verificaciones de seguridad de software expl√≠citas e impl√≠citas que evitan que los programas lean datos inaccesibles en la memoria.  Si bien la ejecuci√≥n especulativa se dise√±√≥ como parte de la microarquitectura, invisible a nivel arquitect√≥nico, los programas cuidadosamente dise√±ados pod√≠an leer informaci√≥n inaccesible en un bloque especulativo y revelarla a trav√©s de canales laterales, como el tiempo de ejecuci√≥n de un fragmento de programa. <br><br>  Cuando se demostr√≥ que los ataques de Spectre son posibles usando JavaScript, el equipo V8 particip√≥ en la soluci√≥n del problema.  Formamos un equipo de respuesta de emergencia y trabajamos estrechamente con otros equipos de Google, nuestros otros socios de navegador y socios de hardware.  Junto con ellos, llevamos a cabo de manera proactiva tanto la investigaci√≥n ofensiva (la construcci√≥n de m√≥dulos de ataque para probar el concepto) como la defensiva (mitigando posibles ataques). <br><a name="habracut"></a><br>  El ataque Spectre consta de dos partes: <br><br><ul><li>  <i>Fuga de datos inaccesibles al estado latente de la CPU</i> .  Todos los ataques de Spectre conocidos utilizan la especulaci√≥n para transferir bits de datos inaccesibles a los cach√©s de la CPU. <br></li><li>  <i>Recuperando un estado oculto</i> para restaurar datos inaccesibles.  Para esto, un atacante necesita un reloj con suficiente precisi√≥n.  (Sorprendentemente baja precisi√≥n, especialmente con m√©todos como el umbral de borde, en comparaci√≥n con un umbral a lo largo de un contorno seleccionado). </li></ul><br>  Te√≥ricamente, ser√≠a suficiente para bloquear cualquiera de los dos componentes del ataque.  Como no sabemos c√≥mo bloquear completamente ninguno de ellos, desarrollamos e implementamos mitigaciones que reducen significativamente la cantidad de informaci√≥n que se filtra a las cach√©s de CPU y mitigaciones que dificultan la recuperaci√≥n de un estado oculto. <br><br><h1>  Temporizadores de alta precisi√≥n. </h1><br>  Los peque√±os cambios de estado que quedan despu√©s de la ejecuci√≥n especulativa producen diferencias temporales muy peque√±as, casi imposiblemente peque√±as, del orden de una billon√©sima de segundo.  Para detectar directamente tales diferencias individuales, el atacante necesita un temporizador de alta precisi√≥n.  Los procesadores ofrecen dichos temporizadores, pero la plataforma web no los configura.  El temporizador m√°s preciso en la plataforma web <code>performance.now()</code> ten√≠a una resoluci√≥n de varios microsegundos, que inicialmente se consider√≥ inadecuado para este prop√≥sito.  Sin embargo, hace dos a√±os, un grupo de investigaci√≥n especializado en ataques de microarquitectura public√≥ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un art√≠culo</a> sobre temporizadores en una plataforma web.  Llegaron a la conclusi√≥n de que la memoria compartida mutable simult√°nea y varios m√©todos de recuperaci√≥n de resoluci√≥n permiten la creaci√≥n de temporizadores de resoluci√≥n a√∫n mayor, hasta el nanosegundo.  Dichos temporizadores son lo suficientemente precisos como para detectar aciertos y errores individuales del cach√© L1.  Es √©l quien generalmente se utiliza para capturar informaci√≥n en los ataques de Spectre. <br><br><h1>  Protecci√≥n del temporizador </h1><br>  Para interrumpir la capacidad de detectar peque√±as diferencias en el tiempo, los desarrolladores de navegadores han elegido un enfoque multilateral.  En todos los navegadores, la resoluci√≥n de <code>performance.now()</code> se redujo (en Chrome de 5 microsegundos a 100) y se introdujo la fluctuaci√≥n de fase aleatoria para evitar la restauraci√≥n de la resoluci√≥n.  Despu√©s de las consultas entre los desarrolladores de todos los navegadores, juntos decidimos dar un paso sin precedentes: deshabilitar de forma inmediata y retroactiva la API <code>SharedArrayBuffer</code> en todos los navegadores para evitar la creaci√≥n de un temporizador de nanosegundos. <br><br><h1>  Ganar </h1><br>  Al comienzo de nuestra investigaci√≥n ofensiva, qued√≥ claro que las mitigaciones de temporizador por s√≠ solas no son suficientes.  Una de las razones es que un atacante puede simplemente ejecutar su c√≥digo repetidamente para que la diferencia de tiempo acumulativa sea mucho m√°s que un acierto o un error de cach√©.  Pudimos construir "dispositivos" confiables que usan muchas l√≠neas de cach√© a la vez, hasta la capacidad total de cach√©, lo que da una diferencia de tiempo de hasta 600 microsegundos.  M√°s tarde, descubrimos m√©todos de amplificaci√≥n arbitrarios que no est√°n limitados por la capacidad de cach√©.  Dichos m√©todos de amplificaci√≥n se basan en intentos repetidos de leer datos secretos. <br><br><h1>  Protecci√≥n JIT </h1><br>  Para leer datos inaccesibles utilizando Spectre, un atacante obliga a la CPU a ejecutar especulativamente c√≥digo que lee datos normalmente inaccesibles y los coloca en la memoria cach√©.  La protecci√≥n puede considerarse desde dos lados: <br><br><ol><li>  Prevenir la ejecuci√≥n de c√≥digo especulativo. <br></li><li>  Prevenci√≥n de la lectura de datos inaccesibles de la tuber√≠a especulativa. </li></ol><br>  Experimentamos con la primera opci√≥n insertando instrucciones recomendadas para evitar la especulaci√≥n, como <code>LFENCE</code> de Intel, en cada rama condicional cr√≠tica y usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">retpolins</a> para ramas indirectas.  Desafortunadamente, tales mitigaciones pesadas reducen significativamente la productividad (desaceleraci√≥n 2-3x en el punto de referencia Octane).  En cambio, tomamos el segundo enfoque al insertar secuencias de mitigaci√≥n que evitan que se lean datos confidenciales debido a especulaciones inadecuadas.  Perm√≠tanme ilustrar la t√©cnica con el siguiente fragmento de c√≥digo: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (condition) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a[i]; }</code> </pre> <br>  Por simplicidad, asumimos que la condici√≥n <code>0</code> o <code>1</code> .  El c√≥digo anterior es vulnerable si la CPU lee especulativamente de <code>a[i]</code> cuando <code>i</code> fuera de rango, obteniendo acceso a datos normalmente inaccesibles.  Una observaci√≥n importante es que en este caso, la especulaci√≥n intenta leer <code>a[i]</code> cuando la condici√≥n es <code>0</code> .  Nuestra mitigaci√≥n reescribe este programa para que se comporte exactamente igual que el programa original, pero no permita que se filtren datos cargados especulativamente. <br><br>  Reservamos un registro de CPU, que llamamos "veneno", para realizar un seguimiento de si el c√≥digo se est√° ejecutando en una rama malinterpretada.  El registro de envenenamiento es compatible con todas las ramas y llamadas del c√≥digo generado, por lo que cualquier rama interpretada incorrectamente hace que el registro de envenenamiento se convierta en <code>0</code> .  Luego medimos todos los accesos a la memoria para que enmascaren incondicionalmente el resultado de todas las descargas con el valor actual del registro de envenenamiento.  Esto no impide que el procesador prediga (o malinterprete) las ramas, pero destruye la informaci√≥n (potencialmente fuera de los l√≠mites) de los valores cargados debido a las ramas interpretadas incorrectamente.  El c√≥digo de la herramienta se muestra a continuaci√≥n ( <code>a</code> es una matriz de n√∫meros). <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> poison = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ‚Ä¶ if (condition) { poison *= condition; return a[i] * poison; }</span></span></code> </pre> <br>  El c√≥digo adicional no afecta el comportamiento normal (definido por la arquitectura) del programa.  Solo afecta el estado micro-arquitect√≥nico cuando se trabaja en una CPU con ejecuci√≥n especulativa.  Si instrumenta un programa en el nivel del c√≥digo fuente, las optimizaciones avanzadas en compiladores modernos pueden eliminar dicha instrumentaci√≥n.  En V8, evitamos que el compilador elimine las mitigaciones al insertarlas en una etapa muy tard√≠a de la compilaci√≥n. <br><br>  Tambi√©n utilizamos esta t√©cnica de envenenamiento para evitar fugas de ramas indirectas en el bucle de c√≥digo de bytes del int√©rprete y en la secuencia de llamadas a funciones de JavaScript.  En el int√©rprete, establecemos el veneno en <code>0</code> si el controlador de bytecode (es decir, una secuencia de c√≥digo de m√°quina que interpreta un bytecode) no coincide con el bytecode actual.  Para las llamadas de JavaScript, pasamos la funci√≥n de destino como un par√°metro (en el registro) y establecemos el veneno en <code>0</code> al comienzo de cada funci√≥n si la funci√≥n de destino entrante no coincide con la funci√≥n actual.  Con este ablandamiento, vemos una desaceleraci√≥n de menos del 20% en el √≠ndice de referencia de octano. <br><br>  La mitigaci√≥n para WebAssembly es m√°s simple, ya que la comprobaci√≥n de seguridad principal es garantizar que el acceso a la memoria est√© dentro de los l√≠mites.  Para las plataformas de 32 bits, adem√°s de las comprobaciones de l√≠mites habituales, llenamos toda la memoria a la siguiente potencia de dos y enmascaramos incondicionalmente los bits superiores del √≠ndice de memoria del usuario.  Las plataformas de 64 bits no necesitan esa mitigaci√≥n, ya que la implementaci√≥n utiliza protecci√≥n de memoria virtual para las comprobaciones de fronteras.  Experimentamos compilando declaraciones de interruptor / caso en c√≥digo de b√∫squeda binario en lugar de usar una rama indirecta potencialmente vulnerable, pero es demasiado costoso para algunas cargas de trabajo.  Las llamadas indirectas est√°n protegidas por retpolins. <br><br><h1>  Protecci√≥n de software: no confiable </h1><br>  Afortunada o desafortunadamente, nuestra investigaci√≥n ofensiva progres√≥ mucho m√°s r√°pido que la defensiva, y r√°pidamente encontramos imposible mitigar mediante programaci√≥n todas las posibles fugas durante los ataques de Spectre.  Hay varias razones para esto.  Primero, los esfuerzos de ingenier√≠a para combatir a Spectre son desproporcionados al nivel de amenaza.  En V8, nos encontramos con muchos otros riesgos de seguridad que son mucho peores, desde leer directamente fuera de las fronteras debido a errores comunes (que es m√°s r√°pido y m√°s f√°cil que Spectre), escribir fuera de las fronteras (esto es imposible con Spectre y peor) y el control remoto potencial ejecuci√≥n de c√≥digo (imposible con Spectre y mucho, mucho peor).  En segundo lugar, las medidas de mitigaci√≥n cada vez m√°s sofisticadas que desarrollamos e implementamos conllevaron una complejidad significativa, que es una obligaci√≥n t√©cnica y en realidad puede aumentar la superficie de ataque y la sobrecarga de rendimiento.  En tercer lugar, probar y mantener la mitigaci√≥n de las fugas microarquitect√≥nicas es a√∫n m√°s dif√≠cil que dise√±ar los propios dispositivos para un ataque, ya que es dif√≠cil asegurarse de que las mitigaciones contin√∫en funcionando de la manera en que fueron dise√±adas.  Al menos una vez, las mitigaciones importantes se deshicieron efectivamente mediante optimizaciones posteriores del compilador.  Cuarto, descubrimos que mitigar efectivamente algunas opciones de Spectre, especialmente la opci√≥n 4, simplemente no es posible en el software, incluso despu√©s de los heroicos esfuerzos de nuestros socios de Apple para tratar el problema en su compilador JIT. <br><br><h1>  Aislamiento del sitio </h1><br>  Nuestra investigaci√≥n condujo a la conclusi√≥n: en principio, el c√≥digo no confiable puede leer todo el espacio de direcciones de un proceso utilizando Spectre y canales laterales.  Las mitigaciones de software reducen la efectividad de muchos dispositivos potenciales, pero no son efectivas ni integrales.  La √∫nica medida efectiva es mover datos confidenciales fuera del espacio de direcciones del proceso.  Afortunadamente, Chrome ha estado intentando durante muchos a√±os separar los sitios en diferentes procesos para reducir la superficie de ataque debido a vulnerabilidades comunes.  Estas inversiones dieron sus frutos, y para mayo de 2018 llegamos a la etapa de preparaci√≥n y expandimos el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aislamiento de los sitios</a> en la cantidad m√°xima de plataformas.  Por lo tanto, el modelo de seguridad de Chrome ya no asume la privacidad del idioma durante el proceso de representaci√≥n. <br><br>  Specter ha recorrido un largo camino y enfatiz√≥ los m√©ritos de la colaboraci√≥n de desarrolladores en la industria y la academia.  Hasta ahora, los sombreros blancos est√°n por delante de los negros.  Todav√≠a no conocemos un solo ataque real, con la excepci√≥n de experimentadores curiosos e investigadores profesionales que desarrollan dispositivos para probar el concepto.  Nuevas variantes de estas vulnerabilidades contin√∫an apareciendo y esto continuar√° por alg√∫n tiempo.  Continuamos monitoreando estas amenazas y tom√°ndolas en serio. <br><br>  Al igual que muchos programadores, tambi√©n pensamos que los lenguajes seguros proporcionan el borde correcto para la abstracci√≥n, evitando que los programas bien escritos lean memoria arbitraria.  Es triste que esto haya resultado ser un error: esta garant√≠a no corresponde al equipo actual.  Por supuesto, todav√≠a creemos que los lenguajes seguros tienen m√°s ventajas de ingenier√≠a, y el futuro depende de ellos, pero ... en el equipo de hoy se filtran un poco. <br><br>  Los lectores interesados ‚Äã‚Äãpueden profundizar en el tema y obtener informaci√≥n m√°s detallada en nuestro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo cient√≠fico</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/449546/">https://habr.com/ru/post/449546/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../449536/index.html">iOS Digest No. 4 (5 de abril - 26 de abril)</a></li>
<li><a href="../449538/index.html">Traslado del portal web: del monolito a la arquitectura de microservicios</a></li>
<li><a href="../449540/index.html">Efecto de sombreado de Doodle</a></li>
<li><a href="../449542/index.html">Medicine se traslada a la web, salas de chat y aplicaciones m√≥viles. Conversaci√≥n con BestDoctor</a></li>
<li><a href="../449544/index.html">El mundo moderno se basa en API</a></li>
<li><a href="../449548/index.html">Centro de datos espaciales. Informe de video desde el lanzamiento</a></li>
<li><a href="../449552/index.html">Cifrado asim√©trico en la pr√°ctica.</a></li>
<li><a href="../449554/index.html">Mozilla va a usar WASI para todos los dispositivos, computadoras y sistemas operativos</a></li>
<li><a href="../449556/index.html">Blazor pas√≥ del experimento a la Vista previa</a></li>
<li><a href="../449558/index.html">Aprendizaje autom√°tico para todos los que estudiaron matem√°ticas en octavo grado</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>