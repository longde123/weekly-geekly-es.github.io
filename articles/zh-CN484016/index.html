<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤§ ğŸ’ƒğŸ¾ ğŸ‘©â€ğŸ”§ å…³äºè°ƒè¯•è‡ªåŠ¨ç¼–ç å™¨ç¤ºä¾‹çš„æ·±åº¦å­¦ä¹ åŸºç¡€ï¼Œç¬¬1éƒ¨åˆ† ğŸ‘¼ğŸ¿ ğŸ”‡ âš•ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¦‚æœæ‚¨åœ¨keras.ioç½‘ç«™ä¸Šé˜…è¯»äº†æœ‰å…³è‡ªåŠ¨ç¼–ç å™¨çš„åŸ¹è®­ï¼Œåˆ™å…¶ä¸­ç¬¬ä¸€æ¡æ¶ˆæ¯æ˜¯è¿™æ ·çš„ï¼šåœ¨å®è·µä¸­ï¼Œå‡ ä¹ä»æœªä½¿ç”¨è¿‡è‡ªåŠ¨ç¼–ç å™¨ï¼Œä½†æ˜¯åœ¨åŸ¹è®­ä¸­ç»å¸¸ä¼šè°ˆè®ºè‡ªåŠ¨ç¼–ç å™¨ï¼Œå¹¶ä¸”æœ‰äººæ¥äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å†³å®šç¼–å†™è‡ªå·±çš„å…³äºå®ƒä»¬çš„æ•™ç¨‹ï¼š 


 ä»–ä»¬çš„æˆåä¸»è¦æ¥è‡ªè®¸å¤šåœ¨çº¿æä¾›çš„æœºå™¨å­¦ä¹ å…¥é—¨è¯¾ç¨‹ã€‚ ç»“æœï¼Œè¯¥é¢†åŸŸçš„è®¸å¤šæ–°æ‰‹ç»å¯¹å–œæ¬¢è‡ª...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å…³äºè°ƒè¯•è‡ªåŠ¨ç¼–ç å™¨ç¤ºä¾‹çš„æ·±åº¦å­¦ä¹ åŸºç¡€ï¼Œç¬¬1éƒ¨åˆ†</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484016/"><p> å¦‚æœæ‚¨åœ¨keras.ioç½‘ç«™ä¸Šé˜…è¯»äº†æœ‰å…³è‡ªåŠ¨ç¼–ç å™¨çš„åŸ¹è®­ï¼Œåˆ™å…¶ä¸­ç¬¬ä¸€æ¡æ¶ˆæ¯æ˜¯è¿™æ ·çš„ï¼šåœ¨å®è·µä¸­ï¼Œå‡ ä¹ä»æœªä½¿ç”¨è¿‡è‡ªåŠ¨ç¼–ç å™¨ï¼Œä½†æ˜¯åœ¨åŸ¹è®­ä¸­ç»å¸¸ä¼šè°ˆè®ºè‡ªåŠ¨ç¼–ç å™¨ï¼Œå¹¶ä¸”æœ‰äººæ¥äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å†³å®šç¼–å†™è‡ªå·±çš„å…³äºå®ƒä»¬çš„æ•™ç¨‹ï¼š </p><br><p>  <em>ä»–ä»¬çš„æˆåä¸»è¦æ¥è‡ªè®¸å¤šåœ¨çº¿æä¾›çš„æœºå™¨å­¦ä¹ å…¥é—¨è¯¾ç¨‹ã€‚</em>  <em>ç»“æœï¼Œè¯¥é¢†åŸŸçš„è®¸å¤šæ–°æ‰‹ç»å¯¹å–œæ¬¢è‡ªåŠ¨ç¼–ç å™¨ï¼Œä½†è´­ä¹°åŠ›ä¸è¶³ã€‚</em>  <em>è¿™å°±æ˜¯æœ¬æ•™ç¨‹å­˜åœ¨çš„åŸå› ï¼</em> </p><br><p> ä½†æ˜¯ï¼Œå¯ä»¥å°†å…¶åº”ç”¨äºè‡ªå·±çš„å®é™…ä»»åŠ¡ä¹‹ä¸€æ˜¯æŸ¥æ‰¾å¼‚å¸¸ï¼Œæˆ‘ä¸ªäººåœ¨å¤œé—´é¡¹ç›®çš„æ¡†æ¶ä¸­éœ€è¦å®ƒã€‚ </p><br><p> åœ¨äº’è”ç½‘ä¸Šï¼Œæœ‰å¾ˆå¤šå…³äºè‡ªåŠ¨ç¼–ç å™¨çš„æ•™ç¨‹ï¼Œè¿˜æœ‰ä»€ä¹ˆè¦å†™çš„å‘¢ï¼Ÿ å¥½å§ï¼Œè¯´å®è¯ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š </p><br><ul><li> æ„Ÿè§‰å®é™…ä¸Šè¿™äº›æ•™ç¨‹å¤§çº¦æ˜¯3æˆ–4ä¸ªï¼Œå…¶ä½™æ‰€æœ‰éƒ½æ˜¯ç”¨è‡ªå·±çš„æ–‡å­—é‡å†™çš„ï¼› </li><li> å‡ ä¹æ‰€æœ‰å†…å®¹-åœ¨é¥±å—è‹¦éš¾çš„MNIST'eä¸Šï¼Œå›¾åƒå°ºå¯¸ä¸º28x28ï¼› </li><li> ä»¥æˆ‘çš„æ‹™è§ï¼Œä»–ä»¬å¯¹æ‰€æœ‰è¿™äº›å·¥ä½œæ–¹å¼æ²¡æœ‰ç›´è§‰ï¼Œè€Œåªæ˜¯æ„¿æ„é‡å¤ä¸€éã€‚ </li><li> æœ€é‡è¦çš„å› ç´ -å°±ä¸ªäººè€Œè¨€ï¼Œå½“æˆ‘ç”¨<strong>è‡ªå·±çš„æ•°æ®é›†</strong>æ›¿æ¢MNISTæ—¶<strong>-æ‰€æœ‰è¿™äº›éƒ½æ„šè ¢åœ°åœæ­¢äº†å·¥ä½œ</strong> ã€‚ </li></ul><br><p> ä¸‹é¢æè¿°äº†æˆ‘å¡æ»¡é”¥ä½“çš„è·¯å¾„ã€‚ å¦‚æœæ‚¨ä»å¤§é‡æ•™ç¨‹ä¸­é‡‡ç”¨ä»»ä½•å»ºè®®çš„å¹³é¢ï¼ˆéå·ç§¯ï¼‰æ¨¡å‹å¹¶æ„šè ¢åœ°å°†å…¶ç²˜è´´ï¼Œé‚£ä¹ˆä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œæ²¡æœ‰ä»»ä½•äº‹æƒ…ä¸èµ·ä½œç”¨ã€‚ æœ¬æ–‡çš„ç›®çš„æ˜¯ç†è§£åŸå› ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œè¿™æ˜¯å¯¹æ‰€æœ‰è¿™äº›å·¥ä½œåŸç†çš„æŸç§ç›´è§‚ç†è§£ã€‚ </p><br><p> æˆ‘ä¸æ˜¯æœºå™¨å­¦ä¹ ä¸“å®¶ï¼Œè€Œæ˜¯åœ¨æ—¥å¸¸å·¥ä½œä¸­ä½¿ç”¨æƒ¯ç”¨çš„æ–¹æ³•ã€‚ å¯¹äºç»éªŒä¸°å¯Œçš„æ•°æ®ç§‘å­¦å®¶æ¥è¯´ï¼Œæ•´ç¯‡æ–‡ç« å¯èƒ½éƒ½æ˜¯è’è°¬çš„ï¼Œä½†æ˜¯å¯¹åˆå­¦è€…è€Œè¨€ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œå¯èƒ½ä¼šæœ‰æ–°çš„ä¸œè¥¿å‡ºç°ã€‚ </p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">ä»€ä¹ˆæ ·çš„é¡¹ç›®</b> <div class="spoiler_text"><p> ç®€è€Œè¨€ä¹‹ï¼Œå°½ç®¡æ–‡ç« ä¸ä»–æ— å…³ã€‚ æœ‰ä¸€ä¸ªADS-Bæ¥æ”¶å™¨ï¼Œå®ƒä»é£è¡Œä¸­çš„é£æœºä¸Šæ•è·æ•°æ®ï¼Œå¹¶å°†é£æœºçš„åæ ‡å†™å…¥åŸºåœ°ã€‚ æœ‰æ—¶ï¼Œé£æœºçš„è¡Œä¸ºä¸¾æ­¢ä¸æ­£å¸¸-é™è½å‰å®ƒä»¬ä¼šè½¬åœˆç‡ƒçƒ§ç‡ƒæ–™ï¼Œæˆ–è€…åªæ˜¯ç§äººèˆªç­é£è¶Šæ ‡å‡†è·¯çº¿ï¼ˆèµ°å»Šï¼‰ã€‚ æœ‰è¶£çš„æ˜¯ï¼Œæ¯å¤©è¦ä»å¤§çº¦ä¸€åƒæ¶é£æœºä¸­åˆ†ç¦»å‡ºé‚£äº›è¡¨ç°ä¸ä½³çš„é£æœºã€‚ æˆ‘å®Œå…¨æ‰¿è®¤åŸºæœ¬åå·®å¯ä»¥è½»æ¾è®¡ç®—ï¼Œä½†æ˜¯æˆ‘å¾ˆæƒ³å°è¯•ä¸€ä¸‹ <del> é­”æœ¯ </del> ç¥ç»ç½‘ç»œã€‚ </p></div></div><br><p> è®©æˆ‘ä»¬å¼€å§‹å§ã€‚ æˆ‘æœ‰4000å¼ é»‘ç™½å›¾ç‰‡çš„64x64åƒç´ æ•°æ®é›†ï¼Œçœ‹èµ·æ¥åƒè¿™æ ·ï¼š </p><br><p><img src="https://habrastorage.org/webt/vw/5r/mh/vw5rmhetruoniuc7p4ksjulshde.png"></p><br><p> é»‘è‰²èƒŒæ™¯ä¸Šåªæœ‰å‡ è¡Œï¼Œåœ¨64x64å›¾ç‰‡ä¸­ï¼Œå¤§çº¦2ï¼…çš„ç‚¹è¢«å¡«å……ã€‚ å½“ç„¶ï¼Œå¦‚æœæ‚¨æŸ¥çœ‹è®¸å¤šå›¾ç‰‡ï¼Œé‚£ä¹ˆäº‹å®è¯æ˜å¤§å¤šæ•°çº¿æ¡éƒ½éå¸¸ç›¸ä¼¼ã€‚ </p><br><p> æˆ‘ä¸ä¼šè¯¦ç»†ä»‹ç»å¦‚ä½•åŠ è½½å’Œå¤„ç†æ•°æ®é›†ï¼Œå› ä¸ºåŒæ ·ï¼Œæœ¬æ–‡çš„ç›®çš„ä¸æ˜¯è¿™æ ·ã€‚ åªæ˜¯æ˜¾ç¤ºä¸€æ®µå¯æ€•çš„ä»£ç ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">ä»£å·</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># only for google colab %tensorflow_version 2.x import tensorflow as tf import numpy as np import matplotlib.pyplot as plt import os import zipfile import datetime import tensorflow_addons as tfa BATCH_SIZE = 128 AUTOTUNE=tf.data.experimental.AUTOTUNE def load_image(fpath): img_raw = tf.io.read_file(fpath) img = tf.io.decode_png(img_raw, channels=1, dtype=tf.uint8) return tf.image.convert_image_dtype(img, dtype=tf.float32) ## for splitting test/train def is_test(x, y): return x % 4 == 0 def is_train(x, y): return not is_test(x,y) ## for image augmentation def random_flip_flop(img): return tf.image.random_flip_left_right(img) def transform_aug(shift_val): def random_transform(img): return tfa.image.translate(img,tf.random.uniform([2], -1*shift_val, shift_val)) return random_transform def prepare_for_training(ds, cache=True, shuffle_buffer_size=1000, transform=0, flip=False): if cache: if isinstance(cache, str): ds = ds.cache(cache) else: ds = ds.cache() ds = ds.shuffle(buffer_size=shuffle_buffer_size) if transform != 0: ds = ds.map(transform_aug(transform)) if flip: ds = ds.map(random_flip_flop) ds = ds.repeat() ds = ds.batch(BATCH_SIZE) ds = ds.prefetch(buffer_size=AUTOTUNE) return ds def prepare_input_output(x): return (x, x) list_ds = tf.data.Dataset.list_files("/content/planes64/*") imgs_df = list_ds.map(load_image) train = imgs_df.enumerate().filter(is_train).map(lambda x,y: y) train_ds = prepare_for_training(train, transform=10, flip=True) train_ds = train_ds.map(prepare_input_output) val = imgs_df.enumerate().filter(is_test).map(lambda x, y: y) val_ds = val.map(prepare_input_output).batch(BATCH_SIZE, drop_remainder=True)</span></span></code> </pre> </div></div><br><p> ä¾‹å¦‚ï¼Œè¿™é‡Œæ˜¯keras.ioæå‡ºçš„ç¬¬ä¸€ä¸ªæ¨¡å‹ï¼Œä»–ä»¬ç ”ç©¶äº†mnistå¹¶å¯¹å…¶è¿›è¡Œäº†è®­ç»ƒï¼š </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># this is the size of our encoded representations encoding_dim = 32 # 32 floats -&gt; compression of factor 24.5, assuming the input is 784 floats # this is our input placeholder input_img = Input(shape=(784,)) # "encoded" is the encoded representation of the input encoded = Dense(encoding_dim, activation='relu')(input_img) # "decoded" is the lossy reconstruction of the input decoded = Dense(784, activation='sigmoid')(encoded)</span></span></code> </pre> <br><p> å°±æˆ‘è€Œè¨€ï¼Œæ¨¡å‹çš„å®šä¹‰å¦‚ä¸‹ï¼š </p><br><pre> <code class="python hljs">model = tf.keras.Sequential() model.add(tf.keras.Input(shape=(<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>))) model.add(tf.keras.layers.Flatten()) model.add(tf.keras.layers.Dense(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">64</span></span>/<span class="hljs-number"><span class="hljs-number">10</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)) model.add(tf.keras.layers.Dense(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">64</span></span>, activation=<span class="hljs-string"><span class="hljs-string">"sigmoid"</span></span>)) model.add(tf.keras.layers.Reshape(target_shape=(<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)))</code> </pre> <br><p> æˆ‘ç¡®å®ç›´æ¥åœ¨æ¨¡å‹ä¸­è¿›è¡Œäº†å±•å¹³å’Œé‡å¡‘ï¼Œå¹¶ä¸”æˆ‘æ²¡æœ‰â€œå‹ç¼©â€ 25æ¬¡ï¼Œè€Œä»…å‹ç¼©äº†10æ¬¡ï¼Œè¿™ä¹‹é—´å­˜åœ¨ç»†å¾®çš„å·®å¼‚ã€‚è¿™åº”è¯¥ä¸ä¼šæœ‰ä»»ä½•å½±å“ã€‚ </p><br><p> ä½œä¸ºæŸå¤±å‡½æ•°-å‡æ–¹è¯¯å·®ï¼Œä¼˜åŒ–å™¨ä¸æ˜¯åŸºæœ¬çš„ï¼Œè®©äºšå½“ã€‚ åœ¨ä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬è®­ç»ƒ20ä¸ªæ—¶ä»£ï¼Œæ¯ä¸ªæ—¶ä»£100æ­¥ã€‚ </p><br><p> å¦‚æœæ‚¨æŸ¥çœ‹æŒ‡æ ‡-ä¸€åˆ‡éƒ½åœ¨ç«ä¸­ã€‚ å‡†ç¡®åº¦== 0.993ã€‚ å¦‚æœæ‚¨çœ‹ä¸€ä¸‹åŸ¹è®­æ—¶é—´è¡¨ï¼Œé‚£ä¹ˆä¸€åˆ‡éƒ½ä¼šæœ‰äº›ä¸æ„‰å¿«ï¼Œæˆ‘ä»¬åˆ°è¾¾äº†ç¬¬ä¸‰ä¸ªæ—¶ä»£çš„é«˜åŸã€‚ </p><br><p><img src="https://habrastorage.org/webt/fo/rq/r7/forqr7krelrj1xq1qis_jg2jeoq.png"></p><br><p> å¥½å§ï¼Œå¦‚æœæ‚¨ç›´æ¥çœ‹ä¸€ä¸‹ç¼–ç å™¨çš„ç»“æœï¼Œæ‚¨ä¼šå¾—åˆ°ä¸€å¹…é€šå¸¸ä»¤äººéš¾è¿‡çš„å›¾ç‰‡ï¼ˆåŸå§‹å›¾ç‰‡åœ¨æœ€ä¸Šé¢ï¼Œè€Œencoding-decodingçš„ç»“æœåœ¨ä¸‹é¢ï¼‰ï¼š </p><br><p><img src="https://habrastorage.org/webt/xo/mn/oq/xomnoqmjj80uaal0echobmal9xm.png"></p><br><p> é€šå¸¸ï¼Œå½“æ‚¨è¯•å›¾æ‰¾å‡ºæŸé¡¹åŠŸèƒ½æ— æ³•æ­£å¸¸å·¥ä½œçš„åŸå› æ—¶ï¼Œè¿™æ˜¯ä¸€ç§å°†æ‰€æœ‰åŠŸèƒ½åˆ†è§£ä¸ºå¤§å—å¹¶å•ç‹¬æ£€æŸ¥æ¯ä¸ªåŠŸèƒ½çš„å¥½æ–¹æ³•ã€‚ å› æ­¤ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ã€‚ </p><br><p> åœ¨æœ¬æ•™ç¨‹çš„åŸå§‹ç¯‡ä¸­ï¼Œå°†å¹³é¢æ•°æ®æä¾›ç»™æ¨¡å‹è¾“å…¥ï¼Œå¹¶åœ¨è¾“å‡ºä¸­è·å–å®ƒä»¬ã€‚ ä¸ºä»€ä¹ˆä¸æ£€æŸ¥æˆ‘çš„å±•å¹³å’Œæ•´å½¢åŠ¨ä½œã€‚ è¿™æ˜¯ä¸€ä¸ªæ— æ“ä½œæ¨¡å‹ï¼š </p><br><pre> <code class="python hljs">model = tf.keras.Sequential() model.add(tf.keras.Input(shape=(<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>))) model.add(tf.keras.layers.Flatten()) model.add(tf.keras.layers.Reshape(target_shape=(<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)))</code> </pre> <br><p> ç»“æœï¼š <br><img src="https://habrastorage.org/webt/vx/z0/aj/vxz0ajadu2qiktdq5ndzj5xje8w.png"></p><br><p> è¿™é‡Œæ²¡æœ‰ä»€ä¹ˆè¦æ•™çš„ã€‚ å¥½å§ï¼Œä¸æ­¤åŒæ—¶ï¼Œå®ƒè¯æ˜äº†æˆ‘çš„å¯è§†åŒ–åŠŸèƒ½ä¹Ÿå¯ä»¥æ­£å¸¸å·¥ä½œã€‚ </p><br><p> æ¥ä¸‹æ¥ï¼Œå°è¯•ä½¿æ¨¡å‹ä¸æ˜¯æ— æ“ä½œçš„ï¼Œè€Œæ˜¯å°½å¯èƒ½å“‘å·´çš„-å‰ªæ‰å‹ç¼©å±‚ï¼Œä¿ç•™è¾“å…¥å¤§å°çš„ä¸€å±‚ã€‚ æ­£å¦‚ä»–ä»¬åœ¨æ‰€æœ‰æ•™ç¨‹ä¸­æ‰€è¯´çš„é‚£æ ·ï¼Œæ¨¡å‹å­¦ä¹ åŠŸèƒ½è€Œä¸åªæ˜¯èº«ä»½åŠŸèƒ½éå¸¸é‡è¦ã€‚ å¥½å§ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬å°†è¦å°è¯•å¾—åˆ°çš„ï¼Œè®©æˆ‘ä»¬å°†ç”Ÿæˆçš„å›¾ç‰‡ä¼ é€’ç»™è¾“å‡ºå³å¯ã€‚ </p><br><pre> <code class="python hljs">model = tf.keras.Sequential() model.add(tf.keras.Input(shape=(<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>))) model.add(tf.keras.layers.Flatten()) model.add(tf.keras.layers.Dense(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">64</span></span>, activation=<span class="hljs-string"><span class="hljs-string">"sigmoid"</span></span>)) model.add(tf.keras.layers.Reshape(target_shape=(<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)))</code> </pre> <br><p> å¥¹æ­£åœ¨å­¦ä¹ ä¸€äº›ä¸œè¥¿ï¼Œå‡†ç¡®æ€§== 0.995ï¼Œç„¶åå¥¹åˆè·Œè·Œæ’æ’åœ°é™·å…¥äº†å¹³ç¨³çŠ¶æ€ã€‚ <br><img src="https://habrastorage.org/webt/ro/t6/jk/rot6jkf2ertweb7weeh8d_layui.png"></p><br><p> ä½†æ˜¯ï¼Œæ€»çš„æ¥è¯´ï¼Œæ˜¾ç„¶æ•ˆæœå¹¶ä¸ç†æƒ³ã€‚ æ— è®ºå¦‚ä½•-åœ¨é‚£å„¿å­¦ä¹ ä»€ä¹ˆï¼Œå°†å…¥å£ä¼ é€’åˆ°å‡ºå£ï¼Œä»…æ­¤è€Œå·²ã€‚ </p><br><p> å¦‚æœæ‚¨é˜…è¯»æœ‰å…³å¯†é›†å±‚çš„kerasæ–‡æ¡£ï¼Œå®ƒæè¿°äº†å®ƒä»¬çš„ä½œç”¨ï¼š <code>output = activation(dot(input, kernel) + bias)</code> <br> ä¸ºäº†ä½¿è¾“å‡ºä¸è¾“å…¥ä¸€è‡´ï¼Œä¸¤ä¸ªç®€å•çš„æ¡ä»¶å°±è¶³å¤Ÿäº†ï¼šbias = 0å’Œå†…æ ¸-å•ä½çŸ©é˜µï¼ˆé‡è¦çš„æ˜¯ä¸è¦åœ¨æ­¤å¤„ç”¨å•ä½å¡«å……çŸ©é˜µ-è¿™æ˜¯éå¸¸ä¸åŒçš„ä¸œè¥¿ï¼‰ã€‚ å¹¸è¿çš„æ˜¯ï¼Œä»åŒä¸€ä¸ª<code>Dense</code>çš„æ–‡æ¡£ä¸­å¯ä»¥å¾ˆå®¹æ˜“åœ°åšåˆ°è¿™ä¸€ç‚¹ã€‚ </p><br><pre> <code class="python hljs">model = tf.keras.Sequential() model.add(tf.keras.Input(shape=(<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>))) model.add(tf.keras.layers.Flatten()) model.add(tf.keras.layers.Dense(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">64</span></span>, activation = <span class="hljs-string"><span class="hljs-string">"sigmoid"</span></span>, use_bias=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, kernel_initializer = tf.keras.initializers.Identity())) model.add(tf.keras.layers.Reshape(target_shape=(<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)))</code> </pre> <br><p> å› ä¸º æˆ‘ä»¬ç«‹å³è®¾ç½®æƒé‡ï¼Œé‚£ä¹ˆæ‚¨ä»€ä¹ˆä¹Ÿå­¦ä¸åˆ°-é©¬ä¸Šå°±å¥½äº†ï¼š <br><img src="https://habrastorage.org/webt/dm/tk/5a/dmtk5ardo9xksg8c5v5febzikdo.png"></p><br><p> ä½†æ˜¯ï¼Œå¦‚æœæ‚¨å¼€å§‹è®­ç»ƒï¼Œé‚£ä¹ˆä¹çœ‹ä¹‹ä¸‹å®ƒä¼šä»¤äººæƒŠè®¶åœ°å¼€å§‹-æ¨¡å‹ä»¥ç²¾åº¦== 1.0å¼€å§‹ï¼Œä½†æ˜¯å¾ˆå¿«å°±ä¸‹é™äº†ã€‚ <br> è®­ç»ƒå‰è¯„ä¼°ç»“æœï¼š <code>8/Unknown - 1s 140ms/step - loss: 0.2488 - accuracy: 1.0000[0.24875330179929733, 1.0]</code> ã€‚ åŸ¹è®­å†…å®¹ï¼š </p><br><pre> <code class="plaintext hljs">Epoch 1/20 100/100 [==============================] - 6s 56ms/step - loss: 0.1589 - accuracy: 0.9990 - val_loss: 0.0944 - val_accuracy: 0.9967 Epoch 2/20 100/100 [==============================] - 5s 51ms/step - loss: 0.0836 - accuracy: 0.9964 - val_loss: 0.0624 - val_accuracy: 0.9958 Epoch 3/20 100/100 [==============================] - 5s 50ms/step - loss: 0.0633 - accuracy: 0.9961 - val_loss: 0.0470 - val_accuracy: 0.9958 Epoch 4/20 100/100 [==============================] - 5s 48ms/step - loss: 0.0520 - accuracy: 0.9961 - val_loss: 0.0423 - val_accuracy: 0.9961 Epoch 5/20 100/100 [==============================] - 5s 48ms/step - loss: 0.0457 - accuracy: 0.9962 - val_loss: 0.0357 - val_accuracy: 0.9962</code> </pre> <br><p> æ˜¯çš„ï¼Œè¿˜ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªç†æƒ³çš„æ¨¡å‹-å›¾ç‰‡ä»¥1æ¯”1çš„æ¯”ä¾‹å‡ºç°ï¼Œè€ŒæŸè€—ï¼ˆå‡æ–¹è¯¯å·®ï¼‰å‡ ä¹ä¸º0.25ã€‚ </p><br><p> é¡ºä¾¿è¯´ä¸€å¥ï¼Œè¿™æ˜¯è®ºå›ä¸Šçš„ä¸€ä¸ªå¸¸è§é—®é¢˜-æŸå¤±åœ¨ä¸‹é™ï¼Œä½†å‡†ç¡®æ€§æ²¡æœ‰å¢é•¿ï¼Œè¿™æ€ä¹ˆå¯èƒ½ï¼Ÿ <br> è¿™é‡Œå€¼å¾—å†æ¬¡å›é¡¾ä¸€ä¸‹å¯†é›†å±‚çš„å®šä¹‰ï¼š <code>output = activation(dot(input, kernel) + bias)</code>å’Œå…¶ä¸­æåˆ°çš„æ¿€æ´»ä¸€è¯ï¼Œæˆ‘åœ¨ä¸Šé¢å·²ç»æˆåŠŸåœ°å¿½ç•¥äº†å®ƒä»¬ã€‚ æœ‰äº†æ¥è‡ªå•ä½çŸ©é˜µçš„æƒé‡å¹¶ä¸”æ²¡æœ‰åå·®ï¼Œæˆ‘ä»¬å¾—åˆ°<code>output = activation(input)</code> ã€‚ </p><br><p> å®é™…ä¸Šï¼Œæˆ‘ä»¬çš„æºä»£ç ä¸­çš„æ¿€æ´»åŠŸèƒ½å·²ç»æ˜¾ç¤ºä¸ºsigmoidï¼Œæˆ‘éå¸¸æ„šè ¢åœ°å¤åˆ¶äº†å®ƒï¼Œä»…æ­¤è€Œå·²ã€‚ å¹¶ä¸”åœ¨æ•™ç¨‹ä¸­å»ºè®®åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨å®ƒã€‚ ä½†æ˜¯ä½ å¿…é¡»å¼„æ¸…æ¥šã€‚ </p><br><p> å¯¹äºåˆå­¦è€…ï¼Œæ‚¨å¯ä»¥é˜…è¯»æ–‡æ¡£ä¸­æœ‰å…³å…¶å†…å®¹çš„å†…å®¹ï¼š <code>The sigmoid activation: (1.0 / (1.0 + exp(-x)))</code> ã€‚ é‚£ä¸ªäººä»€ä¹ˆä¹Ÿæ²¡å‘Šè¯‰æˆ‘ï¼Œå› ä¸ºæˆ‘ä¸æ˜¯å¹»è±¡å¤§å¸ˆï¼Œæ›¾ç»åœ¨è„‘æµ·ä¸­å»ºç«‹è¿™æ ·çš„å›¾è¡¨ã€‚ <br> ä½†æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨ç¬”è¿›è¡Œæ„å»ºï¼š </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> matplotlib.ticker <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> plticker range_tensor = tf.range(<span class="hljs-number"><span class="hljs-number">-4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">0.01</span></span>, dtype=tf.float32) fig, ax = plt.subplots(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) plt.plot(range_tensor.numpy(), tf.keras.activations.sigmoid(range_tensor).numpy()) ax.grid(which=<span class="hljs-string"><span class="hljs-string">'major'</span></span>, linestyle=<span class="hljs-string"><span class="hljs-string">'-'</span></span>, linewidth=<span class="hljs-string"><span class="hljs-string">'0.5'</span></span>, color=<span class="hljs-string"><span class="hljs-string">'red'</span></span>) ax.grid(which=<span class="hljs-string"><span class="hljs-string">'minor'</span></span>, linestyle=<span class="hljs-string"><span class="hljs-string">':'</span></span>, linewidth=<span class="hljs-string"><span class="hljs-string">'0.5'</span></span>, color=<span class="hljs-string"><span class="hljs-string">'black'</span></span>) ax.yaxis.set_major_locator(plticker.MultipleLocator(base=<span class="hljs-number"><span class="hljs-number">0.5</span></span>) ) plt.minorticks_on()</code> </pre> <br><p><img src="https://habrastorage.org/webt/tp/bs/1b/tpbs1bjym9vqahdihjhm1aubrne.png"></p><br><p> ä»è¿™é‡Œå¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼ŒSå½¢ä¸ºé›¶æ—¶ï¼ŒSå½¢ä¸º0.5ï¼Œå•ä½ä¸º0.73ã€‚ æˆ‘ä»¬å¾—åˆ°çš„ç‚¹æ˜¯é»‘è‰²ï¼ˆ0.0ï¼‰æˆ–ç™½è‰²ï¼ˆ1.0ï¼‰ã€‚ å› æ­¤äº‹å®è¯æ˜ï¼Œæ’ç­‰å‡½æ•°çš„å‡æ–¹è¯¯å·®ä¿æŒéé›¶ã€‚ </p><br><p> æ‚¨ç”šè‡³å¯ä»¥çœ‹ä¸€ä¸‹ç¬”ï¼Œè¿™æ˜¯æ‰€å¾—å›¾åƒçš„ä¸€è¡Œï¼š </p><br><pre> <code class="python hljs">array([<span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.7310586</span></span>, <span class="hljs-number"><span class="hljs-number">0.7310586</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> , <span class="hljs-number"><span class="hljs-number">0.5</span></span> ], dtype=float32)</code> </pre> <br><p> å®é™…ä¸Šï¼Œè¿™å¾ˆé…·ï¼Œå› ä¸ºä¼šåŒæ—¶å‡ºç°å‡ ä¸ªé—®é¢˜ï¼š </p><br><ul><li> ä¸ºä»€ä¹ˆåœ¨ä¸Šé¢çš„å¯è§†åŒ–å›¾ä¸­çœ‹ä¸åˆ°å®ƒï¼Ÿ </li><li> ä¸ºä»€ä¹ˆé‚£ä¹ˆç²¾åº¦== 1.0ï¼Œå› ä¸ºåŸå§‹å›¾ç‰‡æ˜¯0å’Œ1ã€‚ </li></ul><br><p> é€šè¿‡å¯è§†åŒ–ï¼Œä¸€åˆ‡éƒ½éå¸¸ç®€å•ã€‚ ä¸ºäº†æ˜¾ç¤ºå›¾åƒï¼Œæˆ‘ä½¿ç”¨äº†matplotlibï¼š <code>plt.imshow(res_imgs[i][:, :, 0])</code> ã€‚ è€Œä¸”ï¼Œåƒå¾€å¸¸ä¸€æ ·ï¼Œå¦‚æœæ‚¨è½¬è‡³æ–‡æ¡£ï¼Œä¸€åˆ‡éƒ½å°†å†™åœ¨æ­¤å¤„ï¼š <code>The Normalize instance used to scale scalar data to the [0, 1] range before mapping to colors using cmap. By default, a linear scaling mapping the lowest value to 0 and the highest to 1 is used.</code> <code>The Normalize instance used to scale scalar data to the [0, 1] range before mapping to colors using cmap. By default, a linear scaling mapping the lowest value to 0 and the highest to 1 is used.</code> å³ åº“ä»”ç»†åœ°å°†æˆ‘çš„0.5å’Œ0.73æ ‡å‡†åŒ–ä¸º0åˆ°1ã€‚æ›´æ”¹ä»£ç ï¼š </p><br><pre> <code class="python hljs">plt.imshow(res_imgs[i][:, :, <span class="hljs-number"><span class="hljs-number">0</span></span>], norm=matplotlib.colors.Normalize(<span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>))</code> </pre> <br><p><img src="https://habrastorage.org/webt/rn/qn/ta/rnqntag1dohhikail8y6myq7siy.png"></p><br><p> è¿™æ˜¯å‡†ç¡®çš„é—®é¢˜ã€‚ é¦–å…ˆ-å‡ºäºä¹ æƒ¯ï¼Œæˆ‘ä»¬å»äº†æ–‡æ¡£ï¼Œé˜…è¯»<code>tf.keras.metrics.Accuracy</code> ï¼Œçœ‹èµ·æ¥å®ƒä»¬å†™å¾—å¯ä»¥ç†è§£ï¼š </p><br><pre> <code class="plaintext hljs">For example, if y_true is [1, 2, 3, 4] and y_pred is [0, 2, 3, 4] then the accuracy is 3/4 or .75.</code> </pre> <br><p> ä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„å‡†ç¡®åº¦åº”è¯¥ä¸º0ã€‚å› æ­¤ï¼Œæˆ‘å°†è‡ªå·±åŸ‹åœ¨äº†æºä»£ç ä¸­ï¼Œè¿™å¯¹æˆ‘è‡ªå·±å¾ˆæ¸…æ¥šï¼š </p><br><pre> <code class="plaintext hljs"> When you pass the strings 'accuracy' or 'acc', we convert this to one of `tf.keras.metrics.BinaryAccuracy`, `tf.keras.metrics.CategoricalAccuracy`, `tf.keras.metrics.SparseCategoricalAccuracy` based on the loss function used and the model output shape. We do a similar conversion for the strings 'crossentropy' and 'ce' as well.</code> </pre> <br><p> è€Œä¸”ï¼Œç”±äºæŸç§åŸå› ï¼Œåœ¨æœ¬ç½‘ç«™çš„æ–‡æ¡£ä¸­ï¼Œè¯¥æ®µè½ä¸åœ¨<code>.compile</code>çš„æè¿°ä¸­ã€‚ </p><br><p> è¿™æ˜¯æ¥è‡ª<a href="https://github.com/tensorflow/tensorflow/blob/66c48046f169f3565d12e5fea263f6d731f9bfd2/tensorflow/python/keras/engine/compile_utils.py">https://github.com/tensorflow/tensorflow/blob/66c48046f169f3565d12e5fea263f6d731f9bfd2/tensorflow/python/keras/engine/compile_utils.py</a>çš„ä¸€æ®µä»£ç  </p><br><pre> <code class="python hljs">y_t_rank = len(y_t.shape.as_list()) y_p_rank = len(y_p.shape.as_list()) y_t_last_dim = y_t.shape.as_list()[<span class="hljs-number"><span class="hljs-number">-1</span></span>] y_p_last_dim = y_p.shape.as_list()[<span class="hljs-number"><span class="hljs-number">-1</span></span>] is_binary = y_p_last_dim == <span class="hljs-number"><span class="hljs-number">1</span></span> is_sparse_categorical = ( y_t_rank &lt; y_p_rank <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> y_t_last_dim == <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> y_p_last_dim &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> metric <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [<span class="hljs-string"><span class="hljs-string">'accuracy'</span></span>, <span class="hljs-string"><span class="hljs-string">'acc'</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> is_binary: metric_obj = metrics_mod.binary_accuracy <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> is_sparse_categorical: metric_obj = metrics_mod.sparse_categorical_accuracy <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: metric_obj = metrics_mod.categorical_accuracy</code> </pre> <br><p>  <code>y_t</code>æ˜¯y_trueï¼Œæˆ–è€…æ˜¯é¢„æœŸè¾“å‡ºï¼Œ <code>y_p</code>æ˜¯y_predictedï¼Œæˆ–è€…æ˜¯é¢„æµ‹ç»“æœã€‚ <br> æˆ‘ä»¬å…·æœ‰ä»¥ä¸‹æ•°æ®æ ¼å¼ï¼š <code>shape=(64,64,1)</code> ï¼Œå› æ­¤äº‹å®è¯æ˜ï¼Œç²¾åº¦è¢«è§†ä¸ºbinary_accuracyã€‚ ä¸ºäº†å¦‚ä½•è€ƒè™‘åˆ©ç›Šï¼š </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">binary_accuracy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(y_true, y_pred, threshold=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.5</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> threshold = math_ops.cast(threshold, y_pred.dtype) y_pred = math_ops.cast(y_pred &gt; threshold, y_pred.dtype) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> K.mean(math_ops.equal(y_true, y_pred), axis=<span class="hljs-number"><span class="hljs-number">-1</span></span>)</code> </pre> <br><p> æœ‰è¶£çš„æ˜¯ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¾ˆå¹¸è¿-é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ä¸œè¥¿éƒ½è¢«è§†ä¸ºå¤§äº0.5ä¸”å°äºç­‰äº0.5çš„å•ä½-é›¶ã€‚ å› æ­¤ï¼Œå¯¹äºæˆ‘ä»¬çš„èº«ä»½æ¨¡å‹è€Œè¨€ï¼Œå‡†ç¡®æ€§è¾¾åˆ°äº†ç™¾åˆ†ä¹‹ä¸€ç™¾ï¼Œå°½ç®¡å®é™…ä¸Šæ•°å­—æ ¹æœ¬ä¸å°½ç›¸åŒã€‚ å¥½å§ï¼Œå¾ˆæ˜æ˜¾ï¼Œå¦‚æœæˆ‘ä»¬ç¡®å®æ„¿æ„çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ ¡æ­£é˜ˆå€¼å¹¶å°†ç²¾åº¦é™ä½ä¸ºé›¶ï¼Œä¾‹å¦‚ï¼Œä»…ä¸éœ€è¦å®ƒã€‚ è¿™æ˜¯ä¸€ä¸ªæŒ‡æ ‡ï¼Œä¸ä¼šå½±å“åŸ¹è®­ï¼Œæ‚¨åªéœ€è¦äº†è§£æ‚¨å¯ä»¥ç”¨ä¸€åƒç§ä¸åŒçš„æ–¹å¼è¿›è¡Œè®¡ç®—å¹¶è·å¾—å®Œå…¨ä¸åŒçš„æŒ‡æ ‡å³å¯ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç¬”æå–å„ç§æŒ‡æ ‡å¹¶å°†æˆ‘ä»¬çš„æ•°æ®ä¼ è¾“ç»™å®ƒä»¬ï¼š </p><br><pre> <code class="python hljs">m = tf.keras.metrics.BinaryAccuracy() m.update_state(x_batch, res_imgs) print(m.result().numpy())</code> </pre> <br><p> å°†ç»™æˆ‘ä»¬<code>1.0</code> ã€‚ </p><br><p> åœ¨è¿™é‡Œ </p><br><pre> <code class="python hljs">m = tf.keras.metrics.Accuracy() m.update_state(x_batch, res_imgs) print(m.result().numpy())</code> </pre> <br><p> åœ¨ç›¸åŒæ•°æ®ä¸Šå°†ç»™æˆ‘ä»¬<code>0.0</code> ã€‚ </p><br><p> é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨åŒä¸€æ®µä»£ç æ¥å¤„ç†æŸå¤±å‡½æ•°å¹¶äº†è§£å…¶å·¥ä½œåŸç†ã€‚ å¦‚æœæ‚¨é˜…è¯»äº†æœ‰å…³è‡ªåŠ¨ç¼–ç å™¨çš„æ•™ç¨‹ï¼Œåˆ™åŸºæœ¬ä¸Šä»–ä»¬å»ºè®®ä½¿ç”¨ä¸¤ä¸ªæŸå¤±å‡½æ•°ä¹‹ä¸€ï¼šå‡æ–¹è¯¯å·®æˆ–'binary_crossentropy'ã€‚ æ‚¨ä¹Ÿå¯ä»¥åŒæ—¶æŸ¥çœ‹å®ƒä»¬ã€‚ </p><br><p> æˆ‘æé†’æ‚¨ï¼Œå¯¹äº<code>mse</code>æˆ‘å·²ç»æä¾›äº†<code>evaluate</code>æ¨¡å‹ï¼š </p><br><pre> <code class="plaintext hljs">8/Unknown - 2s 221ms/step - loss: 0.2488 - accuracy: 1.0000[0.24876083992421627, 1.0]</code> </pre> <br><p> å³ æŸå¤±== 0.2488ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹ä¸ºä»€ä¹ˆä¼šè¿™æ ·ã€‚ åœ¨æˆ‘ä¸ªäººçœ‹æ¥ï¼Œè¿™æ˜¯æœ€ç®€å•ï¼Œæœ€å®¹æ˜“ç†è§£çš„ï¼šy_trueå’Œy_predictä¹‹é—´çš„å·®å¼‚é€åƒç´ ç›¸å‡ï¼Œæ¯ä¸ªç»“æœå‡å¹³æ–¹ï¼Œç„¶åæœç´¢å¹³å‡å€¼ã€‚ </p><br><pre> <code class="python hljs">tf.keras.backend.mean(tf.math.squared_difference(x_batch[<span class="hljs-number"><span class="hljs-number">0</span></span>], res_imgs[<span class="hljs-number"><span class="hljs-number">0</span></span>]))</code> </pre> <br><p> å¹¶åœ¨è¾“å‡ºï¼š </p><br><pre> <code class="plaintext hljs">&lt;tf.Tensor: shape=(), dtype=float32, numpy=0.24826494&gt;</code> </pre> <br><p> è¿™é‡Œçš„ç›´è§‰éå¸¸ç®€å•-å¤§å¤šæ•°ç©ºç™½åƒç´ ï¼Œæ¨¡å‹äº§ç”Ÿ0.5ï¼Œå®ƒä»¬å¾—åˆ°0.25-å¹³æ–¹å·®ã€‚ </p><br><p> ä½¿ç”¨äºŒå…ƒäº¤å‰ä¸­å¿ƒæ³•ï¼Œäº‹æƒ…ä¼šç¨å¾®å¤æ‚ä¸€äº›ï¼Œå¹¶ä¸”æœ‰æ•´ç¯‡æ–‡ç« ä»‹ç»äº†å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä½†æ˜¯å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘æ€»æ˜¯æ›´å®¹æ˜“é˜…è¯»æºä»£ç ï¼Œå¹¶ä¸”çœ‹èµ·æ¥åƒè¿™æ ·ï¼š </p><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> from_logits: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nn.sigmoid_cross_entropy_with_logits(labels=target, logits=output) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> isinstance(output, (ops.EagerTensor, variables_module.Variable)): output = _backtrack_identity(output) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> output.op.type == <span class="hljs-string"><span class="hljs-string">'Sigmoid'</span></span>: <span class="hljs-comment"><span class="hljs-comment"># When sigmoid activation function is used for output operation, we # use logits from the sigmoid function directly to compute loss in order # to prevent collapsing zero when training. assert len(output.op.inputs) == 1 output = output.op.inputs[0] return nn.sigmoid_cross_entropy_with_logits(labels=target, logits=output) # Compute cross entropy from probabilities. bce = target * math_ops.log(output + epsilon()) bce += (1 - target) * math_ops.log(1 - output + epsilon()) return -bce</span></span></code> </pre> <br><p> è€å®è¯´ï¼Œæˆ‘èŠ±äº†å¾ˆé•¿æ—¶é—´åœ¨è¿™å‡ è¡Œä»£ç ä¸Šç»å°½è„‘æ±ã€‚ é¦–å…ˆï¼Œå¾ˆæ˜æ˜¾ï¼Œä¸¤ä¸ªå®ç°å¯ä»¥èµ·ä½œç”¨ï¼šè¦ä¹ˆ<code>sigmoid_cross_entropy_with_logits</code> ï¼Œè¦ä¹ˆæœ€åä¸€è¡Œå¯¹èµ·ä½œç”¨ã€‚ åŒºåˆ«åœ¨äº<code>sigmoid_cross_entropy_with_logits</code>å¯ç”¨äºlogitsï¼ˆé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯dohï¼‰ï¼Œè€Œä¸»ä»£ç åˆ™å¯ç”¨äºæ¦‚ç‡ã€‚ </p><br><p> è°æ˜¯ç™»å½•ç”¨æˆ·ï¼Ÿ å¦‚æœæ‚¨é˜…è¯»äº†æœ‰å…³è¯¥ä¸»é¢˜çš„100ä¸‡ç¯‡ä¸åŒæ–‡ç« ï¼Œé‚£ä¹ˆä»–ä»¬å°†æåˆ°æ•°å­¦å®šä¹‰ï¼Œå…¬å¼ç­‰ã€‚ å®é™…ä¸Šï¼Œä¸€åˆ‡ä¼¼ä¹éƒ½éå¸¸ç®€å•ï¼ˆå¦‚æœæˆ‘é”™äº†ï¼Œè¯·çº æ­£æˆ‘ï¼‰ã€‚ é¢„æµ‹çš„åŸå§‹è¾“å‡ºä¸ºlogitsã€‚ å¥½å§ï¼Œæˆ–è€…è¯´å¯¹æ•°å¥‡æ•°ï¼Œæ˜¯ç”¨å¯¹æ•°é¹¦é¹‰è®¡ç®—çš„å¯¹æ•°èµ”ç‡ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">é¢˜å¤–è¯å¾ˆå°-ä¸ºä»€ä¹ˆä¼šæœ‰å¯¹æ•°</b> <div class="spoiler_text"><p> èµ”ç‡æ˜¯æˆ‘ä»¬éœ€è¦çš„äº‹ä»¶æ•°ä¸æˆ‘ä»¬ä¸éœ€è¦çš„äº‹ä»¶æ•°ä¹‹æ¯”ï¼ˆä¸æ¦‚ç‡ç›¸åï¼Œæ¦‚ç‡æ˜¯æˆ‘ä»¬éœ€è¦çš„äº‹ä»¶ä¸æ€»çš„æ‰€æœ‰äº‹ä»¶æ•°ä¹‹æ¯”ï¼‰ã€‚ ä¾‹å¦‚-æˆ‘ä»¬é˜Ÿçš„èƒœåˆ©æ•°åˆ°å¤±è´¥çš„æ•°ã€‚ è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ã€‚ ç»§ç»­ä»¥å›¢é˜Ÿçš„èƒœåˆ©ä¸ºæ¦œæ ·ï¼Œæˆ‘ä»¬çš„å›¢é˜Ÿå¯ä»¥æ˜¯è¾“å®¶ï¼Œå¹¶ä¸”æœ‰æœºä¼šèµ¢å¾—1/2ï¼ˆä¸€åˆ°ä¸¤ï¼‰ï¼Œç”šè‡³æœ‰å¯èƒ½æ˜¯è¾“å®¶ï¼Œå¹¶ä¸”æœ‰æœºä¼šèµ¢å¾—1/100ã€‚ æ–¹å‘ç›¸å-ä¸­é™¡ï¼Œæ¯”æœ€é«˜å±±é«˜2/1ï¼Œç„¶åæ˜¯100/1ã€‚ äº‹å®è¯æ˜ï¼Œå¤±è´¥è€…å›¢é˜Ÿçš„æ•´ä¸ªèŒƒå›´ç”±0åˆ°1çš„æ•°å­—ä»¥åŠä»1åˆ°æ— ç©·çš„é…·å›¢é˜Ÿæè¿°ã€‚ ç»“æœï¼Œæ¯”è¾ƒèµ·æ¥å¾ˆä¸æ–¹ä¾¿ï¼Œæ²¡æœ‰å¯¹ç§°æ€§ï¼Œä¸€èˆ¬æ¥è¯´ç”¨å®ƒæ¥å·¥ä½œå¯¹æ¯ä¸ªäººéƒ½æ˜¯ä¸æ–¹ä¾¿çš„ï¼Œæ•°å­¦å‡ºæ¥çš„ä¸‘é™‹ã€‚ å¦‚æœæ‚¨é‡‡ç”¨å¯¹æ•°çš„å¯¹æ•°ï¼Œé‚£ä¹ˆä¸€åˆ‡éƒ½ä¼šå˜å¾—å¯¹ç§°ï¼š </p><br><pre> <code class="plaintext hljs">ln(1/2) == -0.69 ln(2/1) == 0.69 ln(1/100) == -4.6 ln(100/1) == 4.6</code> </pre> </div></div><br><p> åœ¨å¼ é‡æµçš„æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ä»»æ„çš„ï¼Œå› ä¸ºä¸¥æ ¼æ¥è¯´ï¼Œè¯¥å±‚çš„è¾“å‡ºåœ¨æ•°å­¦ä¸Šä¸æ˜¯å¯¹æ•°å¥‡æ•°ï¼Œè€Œæ˜¯å·²ç»è¢«æ¥å—ã€‚ å¦‚æœåŸå§‹å€¼æ˜¯ä»-âˆåˆ°+âˆ-ï¼Œåˆ™è¿›è¡Œlogitsã€‚ ç„¶åå¯ä»¥å°†å®ƒä»¬è½¬æ¢ä¸ºæ¦‚ç‡ã€‚ æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼šsoftmaxåŠå…¶ç‰¹æ®Šæƒ…å†µSigmoidã€‚  Softmax-å–ä¸€ä¸ªlogitå‘é‡ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªæ¦‚ç‡å‘é‡ï¼Œç”šè‡³ä½¿å…¶ä¸­æ‰€æœ‰äº‹ä»¶çš„æ¦‚ç‡æ€»å’Œå˜ä¸º1ã€‚Sigmoidï¼ˆåœ¨tfçš„æƒ…å†µä¸‹ï¼‰ä¹Ÿå–ä¸€ä¸ªlogitså‘é‡ï¼Œä½†åˆ†åˆ«å°†å…¶åˆ†åˆ«è½¬æ¢ä¸ºæ¦‚ç‡ä»å…¶ä½™çš„ã€‚ </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># 1+ln(0.5) == 0.30685281944 tf.math.softmax(tf.constant([0.30685281944, 1.0, 0.30685281944])) ## &lt;tf.Tensor: shape=(3,), dtype=float32, numpy=array([0.25, 0.5 , 0.25], dtype=float32)&gt; tf.math.sigmoid(tf.constant([0.30685281944, 1.0, 0.30685281944])) ## &lt;tf.Tensor: shape=(3,), dtype=float32, numpy=array([0.57611686, 0.7310586 , 0.57611686], dtype=float32)&gt;</span></span></code> </pre> <br><p> æ‚¨å¯ä»¥è¿™æ ·çœ‹ã€‚ æœ‰å¤šæ ‡ç­¾åˆ†ç±»ä»»åŠ¡ï¼Œæœ‰å¤šåˆ†ç±»åˆ†ç±»ä»»åŠ¡ã€‚ å¤šç±»-è¿™æ˜¯å¦‚æœæ‚¨éœ€è¦ç¡®å®šå›¾ç‰‡ä¸­çš„è‹¹æœæˆ–æ©™å­ï¼Œç”šè‡³æ˜¯è èã€‚ å¤šæ ‡ç­¾æ˜¯æŒ‡å›¾ç‰‡ä¸­æœ‰ä¸€ä¸ªæ°´æœèŠ±ç“¶ï¼Œæ‚¨éœ€è¦è¯´çš„æ˜¯ä¸Šé¢æœ‰è‹¹æœå’Œæ©™å­ï¼Œä½†æ²¡æœ‰è èã€‚ å¦‚æœæˆ‘ä»¬éœ€è¦å¤šç±»-æˆ‘ä»¬éœ€è¦softmaxï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦multilabel-æˆ‘ä»¬éœ€è¦Sigmoidã€‚ <br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é‡åˆ°äº†å¤šæ ‡ç­¾çš„æƒ…å†µ-æ¯ä¸ªåƒç´ ï¼ˆç±»ï¼‰éƒ½å¿…é¡»è¯´å‡ºæ˜¯å¦å·²å®‰è£…ã€‚ </p><br><p> å›åˆ°å¼ é‡æµï¼Œä¸ºä»€ä¹ˆåœ¨äºŒå…ƒäº¤å‰ç†µï¼ˆè‡³å°‘åœ¨å…¶ä»–äº¤å‰ç†µå‡½æ•°ä¸­å‡ ä¹ç›¸åŒï¼‰ä¸­æœ‰ä¸¤ä¸ªå…¨å±€åˆ†æ”¯ã€‚ äº¤å‰ç†µæ€»æ˜¯é€‚ç”¨äºæ¦‚ç‡ï¼Œæˆ‘ä»¬ç¨åå†è®¨è®ºã€‚ ç„¶åæœ‰ä¸¤ç§ç®€å•çš„æ–¹æ³•ï¼šè¦ä¹ˆæ¦‚ç‡å·²ç»è¾“å…¥äº†è¾“å…¥ï¼Œè¦ä¹ˆå¯¹æ•°è¿›å…¥äº†è¾“å…¥-ç„¶åå°†sigmoidåº”ç”¨äºå®ƒä»¬ä»¥è·å¾—æ¦‚ç‡ã€‚ ç¢°å·§çš„æ˜¯ï¼Œåº”ç”¨Sigmoidå’Œè®¡ç®—äº¤å‰ç†µè¦æ¯”ä»…ä»æ¦‚ç‡è®¡ç®—äº¤å‰ç†µæ›´å¥½ï¼ˆåŸå› çš„æ•°å­¦è¾“å‡ºåœ¨<code>sigmoid_cross_entropy_with_logits</code>å‡½æ•°çš„æºä¸­ï¼ŒåŠ ä¸Šå‡ºäºå¥½å¥‡ï¼Œæ‚¨å¯ä»¥åœ¨Googleä¸Šæœç´¢â€œæ•°å€¼ç¨³å®šæ€§äº¤å‰ç†µâ€ï¼‰ï¼Œå› æ­¤å³ä½¿å¼ é‡æµå¼€å‘äººå‘˜ä¹Ÿå»ºè®®ä¸è¦å°†æ¦‚ç‡ä¼ é€’ç»™è¾“å…¥äº¤å‰ç†µå‡½æ•°ï¼Œå¹¶è¿”å›åŸå§‹logitã€‚ å¥½å§ï¼Œåœ¨ä»£ç ä¸­ï¼Œæ£€æŸ¥äº†æŸå¤±å‡½æ•°æ˜¯å¦æœ€åä¸€å±‚æ˜¯Sigmoidï¼Œç„¶åå°†å…¶åˆ‡æ–­å¹¶å–æ¿€æ´»è¾“å…¥è€Œä¸æ˜¯å…¶è¾“å‡ºè¿›è¡Œè®¡ç®—ï¼Œå¹¶å°†æ‰€æœ‰è¦è€ƒè™‘çš„å†…å®¹å‘é€åˆ°<code>sigmoid_cross_entropy_with_logits</code> ã€‚ </p><br><p> å¥½çš„ï¼Œæ•´ç†å‡ºæ¥ï¼Œç°åœ¨æ˜¯binary_crossentropyã€‚ æœ‰ä¸¤ç§æµè¡Œçš„â€œç›´è§‰â€è§£é‡Šå¯ä»¥è¡¡é‡äº¤å‰ç†µã€‚ </p><br><p> æ›´æ­£å¼ï¼šå‡è®¾æœ‰ä¸€ä¸ªç‰¹å®šçš„æ¨¡å‹ï¼Œå¯¹äºnä¸ªç±»ï¼ŒçŸ¥é“å®ƒä»¬å‡ºç°çš„æ¦‚ç‡ï¼ˆy <sub>0</sub> ï¼Œy <sub>1</sub> ï¼Œ...ï¼Œy <sub>n</sub> ï¼‰ã€‚ ç°åœ¨åœ¨ç”Ÿæ´»ä¸­ï¼Œè¿™äº›ç±»åˆ«ä¸­çš„æ¯ä¸€ä¸ªéƒ½å‡ºç°äº†k <sub>n</sub>æ¬¡ï¼ˆk <sub>1</sub> ï¼Œk <sub>1</sub> ï¼Œ...ï¼Œk <sub>n</sub> ï¼‰ã€‚ æ­¤ç±»äº‹ä»¶çš„æ¦‚ç‡æ˜¯æ¯ä¸ªç±»åˆ«çš„æ¦‚ç‡çš„ä¹˜ç§¯-ï¼ˆy <sub>1</sub> ^ k <sub>1</sub> ï¼‰ï¼ˆy <sub>2</sub> ^ k <sub>2</sub> ï¼‰...ï¼ˆy <sub>n</sub> ^ k <sub>n</sub> ï¼‰ã€‚ åŸåˆ™ä¸Š-è¿™å·²ç»æ˜¯äº¤å‰ç†µçš„å¸¸è§„å®šä¹‰-ä¸€ä¸ªæ•°æ®é›†çš„æ¦‚ç‡ç”¨å¦ä¸€ä¸ªæ•°æ®é›†çš„æ¦‚ç‡è¡¨ç¤ºã€‚ æ­¤å®šä¹‰çš„é—®é¢˜åœ¨äºå®ƒå°†å˜æˆ0åˆ°1ï¼Œå¹¶ä¸”é€šå¸¸å¾ˆå°ï¼›æ¯”è¾ƒè¿™äº›å€¼å¹¶ä¸æ–¹ä¾¿ã€‚ <br> å¦‚æœæˆ‘ä»¬ä»ä¸­å–å¯¹æ•°ï¼Œåˆ™å°†å¾—å‡ºk <sub>1</sub> logï¼ˆy <sub>1</sub> ï¼‰+ k <sub>2</sub> logï¼ˆy <sub>2</sub> ï¼‰ï¼Œä¾æ­¤ç±»æ¨ã€‚ å€¼çš„èŒƒå›´ä»-âˆåˆ°0ã€‚æ‰€æœ‰è¿™äº›éƒ½ä¹˜ä»¥-1 / n-ï¼Œå¹¶ä¸”ä»0åˆ°+âˆçš„èŒƒå›´ä¹Ÿå‡ºç°äº†ï¼Œå› ä¸º å®ƒè¡¨ç¤ºä¸ºæ¯ä¸ªç±»åˆ«çš„å€¼ä¹‹å’Œï¼Œæ¯ä¸ªç±»åˆ«ä¸­çš„æ›´æ”¹ä»¥éå¸¸å¯é¢„æµ‹çš„æ–¹å¼åæ˜ åœ¨æ€»ä½“å€¼ä¸­ã€‚ </p><br><p> æ›´ç®€å•ï¼šäº¤å‰ç†µæ˜¾ç¤ºå°±åŸå§‹æ¨¡å‹è€Œè¨€ï¼Œéœ€è¦å¤šå°‘é¢å¤–çš„ä½æ¥è¡¨è¾¾æ ·æœ¬ã€‚ å¦‚æœæˆ‘ä»¬åœ¨é‚£é‡Œä»¥2ä¸ºåº•è¿›è¡Œå¯¹æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†ç›´æ¥è¿›è¡Œä½è¿ç®—ã€‚ æˆ‘ä»¬åˆ°å¤„éƒ½ä½¿ç”¨è‡ªç„¶å¯¹æ•°ï¼Œå› æ­¤å®ƒä»¬æ˜¾ç¤ºçš„æ˜¯natçš„æ•°é‡ï¼ˆ <a href="https://en.wikipedia.org/wiki/Nat_(unit">https://en.wikipedia.org/wiki/Nat_(unit</a> ï¼‰ï¼‰ï¼Œè€Œä¸æ˜¯ä½æ•°ã€‚ </p><br><p> å½“ç±»æ•°ä¸º2æ—¶ï¼ŒäºŒè¿›åˆ¶äº¤å‰ç†µåˆæ˜¯æ™®é€šäº¤å‰ç†µçš„ä¸€ç§ç‰¹æ®Šæƒ…å†µã€‚ ç„¶åï¼Œæˆ‘ä»¬å¯¹ä¸€ä¸ªç±»åˆ«y <sub>1</sub>çš„å‘ç”Ÿæ¦‚ç‡æœ‰äº†è¶³å¤Ÿçš„äº†è§£ï¼Œè€Œç¬¬äºŒä¸ªç±»åˆ«çš„å‘ç”Ÿæ¦‚ç‡ä¸ºï¼ˆ1-y <sub>1</sub> ï¼‰ã€‚ </p><br><p> ä½†æ˜¯ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œæœ‰ç‚¹æ‰“æ»‘äº†æˆ‘ã€‚ è®©æˆ‘æé†’æ‚¨ï¼Œä¸Šä¸€æ¬¡æˆ‘ä»¬å°è¯•æ„å»ºèº«ä»½è‡ªåŠ¨ç¼–ç å™¨æ—¶ï¼Œä»–å‘æˆ‘ä»¬å±•ç¤ºäº†ä¸€å¼ æ¼‚äº®çš„å›¾ç‰‡ï¼Œç”šè‡³è¾¾åˆ°äº†1.0çš„ç²¾åº¦ï¼Œä½†å®é™…ä¸Šï¼Œç»“æœå´æ˜¯å¯æ€•çš„ã€‚ ä¸ºäº†è¿›è¡Œå®éªŒï¼Œæ‚¨å¯ä»¥è¿›è¡Œæ›´å¤šæµ‹è¯•ï¼š <br>  1ï¼‰æ¿€æ´»å¯ä»¥å®Œå…¨åˆ é™¤ï¼Œä¼šæœ‰å¹²å‡€çš„èº«ä»½ <br>  2ï¼‰æ‚¨å¯ä»¥å°è¯•å…¶ä»–æ¿€æ´»åŠŸèƒ½ï¼Œä¾‹å¦‚ç›¸åŒçš„relu </p><br><p> æ²¡æœ‰æ¿€æ´»ï¼š </p><br><pre> <code class="python hljs">model = tf.keras.Sequential() model.add(tf.keras.Input(shape=(<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>))) model.add(tf.keras.layers.Flatten()) model.add(tf.keras.layers.Dense(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">64</span></span>, use_bias=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, kernel_initializer=tf.keras.initializers.Identity())) model.add(tf.keras.layers.Reshape(target_shape=(<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)))</code> </pre> <br><p> æˆ‘ä»¬å¾—åˆ°äº†å®Œç¾çš„èº«ä»½æ¨¡å‹ï¼š </p><br><pre> <code class="python hljs">model.evaluate(x=val.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: (x,x)).batch(BATCH_SIZE, drop_remainder=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)) <span class="hljs-comment"><span class="hljs-comment"># 8/Unknown - 1s 173ms/step - loss: 0.0000e+00 - accuracy: 1.0000[0.0, 1.0]</span></span></code> </pre> <br><p> é¡ºä¾¿è¯´ä¸€å¥ï¼Œè®­ç»ƒä¸ä¼šå¯¼è‡´ä»»ä½•ç»“æœï¼Œå› ä¸ºæŸå¤±== 0.0ã€‚ </p><br><p> ç°åœ¨æœ‰äº†reluã€‚ ä»–çš„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> matplotlib.ticker <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> plticker range_tensor = tf.range(<span class="hljs-number"><span class="hljs-number">-4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">0.01</span></span>, dtype=tf.float32) fig, ax = plt.subplots(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) plt.plot(range_tensor.numpy(), tf.keras.activations.relu(range_tensor).numpy()) ax.grid(which=<span class="hljs-string"><span class="hljs-string">'major'</span></span>, linestyle=<span class="hljs-string"><span class="hljs-string">'-'</span></span>, linewidth=<span class="hljs-string"><span class="hljs-string">'0.5'</span></span>, color=<span class="hljs-string"><span class="hljs-string">'red'</span></span>) ax.grid(which=<span class="hljs-string"><span class="hljs-string">'minor'</span></span>, linestyle=<span class="hljs-string"><span class="hljs-string">':'</span></span>, linewidth=<span class="hljs-string"><span class="hljs-string">'0.5'</span></span>, color=<span class="hljs-string"><span class="hljs-string">'black'</span></span>) ax.yaxis.set_major_locator(plticker.MultipleLocator(base=<span class="hljs-number"><span class="hljs-number">1</span></span>) ) plt.minorticks_on()</code> </pre> <br><p><img src="https://habrastorage.org/webt/wq/ph/iw/wqphiwwmhtmxwfogld4nstyfp9w.png"></p><br><p> ä½äºé›¶-é›¶ï¼Œé«˜äº-y = xï¼Œå³ ä»ç†è®ºä¸Šè®²ï¼Œæˆ‘ä»¬åº”è¯¥è·å¾—ä¸æ²¡æœ‰æ¿€æ´»æ—¶ç›¸åŒçš„æ•ˆæœ-ä¸€ä¸ªç†æƒ³çš„æ¨¡å‹ã€‚ </p><br><pre> <code class="python hljs">model = tf.keras.Sequential() model.add(tf.keras.Input(shape=(<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>))) model.add(tf.keras.layers.Flatten()) model.add(tf.keras.layers.Dense(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">64</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>, use_bias=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, kernel_initializer=tf.keras.initializers.Identity())) model.add(tf.keras.layers.Reshape(target_shape=(<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>))) model.compile(optimizer=<span class="hljs-string"><span class="hljs-string">"adam"</span></span>, loss=<span class="hljs-string"><span class="hljs-string">"binary_crossentropy"</span></span>, metrics=[<span class="hljs-string"><span class="hljs-string">"accuracy"</span></span>]) model.evaluate(x=val.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: (x,x)).batch(BATCH_SIZE, drop_remainder=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)) <span class="hljs-comment"><span class="hljs-comment"># 8/Unknown - 1s 158ms/step - loss: 0.0000e+00 - accuracy: 1.0000[0.0, 1.0]</span></span></code> </pre> <br><p> å¥½çš„ï¼Œæˆ‘ä»¬å¼„æ¸…æ¥šäº†èº«ä»½æ¨¡å‹ï¼Œå³ä½¿ç†è®ºçš„æŸäº›éƒ¨åˆ†å˜å¾—æ›´åŠ æ¸…æ™°ã€‚ ç°åœ¨è®©æˆ‘ä»¬å°è¯•è®­ç»ƒç›¸åŒçš„æ¨¡å‹ï¼Œä½¿å…¶æˆä¸ºèº«ä»½ã€‚ </p><br><p> ä¸ºäº†å¥½ç©ï¼Œæˆ‘å°†å¯¹ä¸‰ä¸ªæ¿€æ´»åŠŸèƒ½è¿›è¡Œæ­¤å®éªŒã€‚ é¦–å…ˆ-reluï¼Œå› ä¸ºå®ƒæ˜¾ç¤ºå¾—å¾ˆæ—©ï¼ˆä¸€åˆ‡éƒ½å’Œä»¥å‰ä¸€æ ·ï¼Œä½†æ˜¯kernel_initializerè¢«åˆ é™¤äº†ï¼Œæ‰€ä»¥é»˜è®¤æƒ…å†µä¸‹å®ƒå°†æ˜¯<code>glorot_uniform</code> ï¼‰ï¼š </p><br><pre> <code class="python hljs">model = tf.keras.Sequential() model.add(tf.keras.Input(shape=(<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>))) model.add(tf.keras.layers.Flatten()) model.add(tf.keras.layers.Dense(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">64</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>, use_bias=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>)) model.add(tf.keras.layers.Reshape(target_shape=(<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)))</code> </pre> <br><p> å®ƒå­¦å¾—å¾ˆæ£’ï¼š </p><br><p><img src="https://habrastorage.org/webt/hv/wz/oo/hvwzoodkp6dxopq7pjkopeeuorw.png"></p><br><p> ç»“æœæ˜¯ç›¸å½“ä¸é”™çš„ï¼Œå‡†ç¡®æ€§ï¼š0.9999ï¼ŒæŸå¤±ï¼ˆæ¯«ç§’ï¼‰ï¼šç»è¿‡20ä¸ªæ—¶ä»£çš„2e-04ï¼Œæ‚¨å¯ä»¥è¿›ä¸€æ­¥è®­ç»ƒã€‚ </p><br><p><img src="https://habrastorage.org/webt/4y/io/jt/4yiojttsafqnf796ha6all0qmsy.png"></p><br><p> æ¥ä¸‹æ¥ï¼Œå°è¯•ä½¿ç”¨sigmoidï¼š </p><br><pre> <code class="python hljs">model = tf.keras.Sequential() model.add(tf.keras.Input(shape=(<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>))) model.add(tf.keras.layers.Flatten()) model.add(tf.keras.layers.Dense(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">64</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'sigmoid'</span></span>, use_bias=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>)) model.add(tf.keras.layers.Reshape(target_shape=(<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)))</code> </pre> <br><p> æˆ‘ä¹‹å‰å·²ç»æ•™è¿‡ç±»ä¼¼çš„ä¸œè¥¿ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯è¿™é‡Œç¦ç”¨äº†åè§ã€‚ ä»–ä¸“å¿ƒç ”ç©¶ï¼Œåœ¨50å¹´ä»£è¿›å…¥äº†ä¸€ä¸ªç¨³å®šçš„æ—¶ä»£ï¼Œå‡†ç¡®æ€§ï¼š0.9970ï¼ŒæŸå¤±ï¼š60å¹´ä»£åçš„0.01ã€‚ </p><br><p> ç»“æœå†æ¬¡ä»¤äººå°è±¡æ·±åˆ»ï¼š </p><br><p><img src="https://habrastorage.org/webt/_7/fl/o_/_7flo_xh5gkgh8oennqthe2ymhk.png"></p><br><p> å¥½å§ï¼Œè¿˜è¦æ£€æŸ¥tanhï¼š </p><br><pre> <code class="python hljs">model = tf.keras.Sequential() model.add(tf.keras.Input(shape=(<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>))) model.add(tf.keras.layers.Flatten()) model.add(tf.keras.layers.Dense(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">64</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'tanh'</span></span>, use_bias=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>)) model.add(tf.keras.layers.Reshape(target_shape=(<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)))</code> </pre> <br><p> å…¶ç»“æœå¯ä¸reluç›¸æå¹¶è®º-ç²¾åº¦ï¼š0.9999ï¼ŒæŸå¤±ï¼š6e-04ï¼Œç»è¿‡20ä¸ªæ—¶ä»£ä¹‹åï¼Œæ‚¨å¯ä»¥è¿›ä¸€æ­¥è¿›è¡Œè®­ç»ƒï¼š </p><br><p><img src="https://habrastorage.org/webt/m4/ib/xc/m4ibxctlge5cxs7eqozjt5uwfsc.png"></p><br><p><img src="https://habrastorage.org/webt/sk/r3/p8/skr3p8etvlatcf-mnc6q9sabtfk.png"></p><br><p> äº‹å®ä¸Šï¼Œæˆ‘æ˜¯å¦ä¸ºä½¿ä¹™çŠ¶ç»“è‚ æ˜¾ç¤ºå‡ºå¯æ¯”çš„ç»“æœè€Œæ„Ÿåˆ°å›°æ‰°ã€‚ å®Œå…¨å‡ºäºä½“è‚²å…´è¶£ã€‚ </p><br><p> ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°è¯•æ·»åŠ BatchNormalizationï¼š </p><br><pre> <code class="python hljs">model = tf.keras.Sequential() model.add(tf.keras.Input(shape=(<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>))) model.add(tf.keras.layers.Flatten()) model.add(tf.keras.layers.Dense(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">64</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'sigmoid'</span></span>, use_bias=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>)) model.add(tf.keras.layers.BatchNormalization()) model.add(tf.keras.layers.Reshape(target_shape=(<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)))</code> </pre> <br><p> ç„¶åå‘ç”ŸæŸç§é­”æœ¯ã€‚ åœ¨ç¬¬13æ—¶ä»£ï¼Œå‡†ç¡®æ€§ï¼š1.0ã€‚ å’Œç«çƒ­çš„ç»“æœï¼š </p><br><p><img src="https://habrastorage.org/webt/6x/md/di/6xmddijppdnstc8ire1mxlcwkca.png"></p><br><p>  III ...åœ¨è¿™ä¸ªæ‚¬å´–å¼è¡£æ¶ä¸Šï¼Œæˆ‘å°†å®Œæˆç¬¬ä¸€éƒ¨åˆ†ï¼Œå› ä¸ºæ–‡æœ¬å¤ªæ¨¡ç³Šï¼Œå¹¶ä¸”å°šä¸æ¸…æ¥šæ˜¯å¦æœ‰äººéœ€è¦å®ƒã€‚ åœ¨ç¬¬äºŒéƒ¨åˆ†ä¸­ï¼Œæˆ‘å°†äº†è§£å‘ç”Ÿäº†ä»€ä¹ˆé­”æœ¯ï¼Œå°è¯•ä½¿ç”¨ä¸åŒçš„ä¼˜åŒ–å™¨ï¼Œå°è¯•æ„å»ºä¸€ä¸ªè¯šå®çš„ç¼–ç å™¨-è§£ç å™¨ï¼Œå°†æˆ‘çš„å¤´æ”¾åœ¨æ¡Œå­ä¸Šã€‚ æˆ‘å¸Œæœ›æœ‰äººå¯¹æ­¤æ„Ÿå…´è¶£å¹¶æœ‰æ‰€å¸®åŠ©ã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN484016/">https://habr.com/ru/post/zh-CN484016/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN484004/index.html">@Pythonetc 2019å¹´12æœˆ</a></li>
<li><a href="../zh-CN484006/index.html">æˆ‘çš„ç”µæŠ¥é¢‘é“@pythonetcçš„æç¤ºå’ŒæŠ€å·§ï¼Œ2019å¹´12æœˆ</a></li>
<li><a href="../zh-CN484008/index.html">ä»€ä¹ˆæ˜¯å›¢é˜Ÿè´Ÿè´£äºº</a></li>
<li><a href="../zh-CN484012/index.html">ç®€åŒ–å¤§å®¹é‡ç¬”è®°æœ¬çš„ä¹¦å†™è¿‡ç¨‹</a></li>
<li><a href="../zh-CN484014/index.html">2020å¹´å°†æŠ›å¼ƒ10ä¸ªSEOç¥è¯</a></li>
<li><a href="../zh-CN484018/index.html">æ¸¸è‰‡çš„ITæŠ€æœ¯é¢</a></li>
<li><a href="../zh-CN484020/index.html">æ‚¨æƒ³ç»™è°ç•™ä¸‹æ·±åˆ»çš„å°è±¡ï¼Ÿ</a></li>
<li><a href="../zh-CN484026/index.html">ç¬¬6éƒ¨åˆ†ï¼šå°†MemTest86 +ç§»æ¤åˆ°RISC-V</a></li>
<li><a href="../zh-CN484028/index.html">é©¬è¹„å¼¯-å¯æŠ˜å å¹³æ¿ç”µè„‘ï¼Œå¸¦æŠ˜å æ˜¾ç¤ºå±</a></li>
<li><a href="../zh-CN484036/index.html">æ–°è¡Œä¸šé›†å›¢ä¸ºæ™ºèƒ½å®¶å±…åˆ›å»ºé€šç”¨æ ‡å‡†</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>