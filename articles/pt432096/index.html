<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüåæ üôà üåÑ Guia completo do CMake. Parte Dois: Build System üë©üèº‚Äçüè´ üÖøÔ∏è üïã</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Introdu√ß√£o 


 Este artigo discute o uso do sistema de compila√ß√£o CMake usado em um grande n√∫mero de projetos C / C ++. √â altamente recomend√°vel qu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Guia completo do CMake. Parte Dois: Build System</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/432096/"><p><img src="https://habrastorage.org/webt/lf/se/70/lfse70sjifxiyddiuym73hdvcho.png"></p><br><h1 id="vvedenie">  1. Introdu√ß√£o </h1><br><p>  Este artigo discute o uso do sistema de compila√ß√£o CMake usado em um grande n√∫mero de projetos C / C ++.  √â altamente recomend√°vel que voc√™ leia a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">primeira parte do</a> manual para evitar entender mal a sintaxe da linguagem CMake, que aparece explicitamente ao longo do artigo. </p><a name="habracut"></a><br><h1 id="zapusk-cmake">  Lan√ßamento do CMake </h1><br><p>  A seguir, exemplos de uso da linguagem CMake que voc√™ deve praticar.  Experimente o c√≥digo-fonte modificando os comandos existentes e adicionando novos.  Para executar esses exemplos, instale o CMake no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site oficial</a> . </p><br><h1 id="princip-raboty">  Princ√≠pio de funcionamento </h1><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O sistema de cria√ß√£o do CMake</a> √© um inv√≥lucro de outros utilit√°rios dependentes da plataforma (por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ninja</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Make</a> ).  Assim, no pr√≥prio processo de montagem, por mais paradoxal que isso possa parecer, ele n√£o participa diretamente. </p><br><p> O sistema de compila√ß√£o CMake aceita um arquivo <code>CMakeLists.txt</code> com uma descri√ß√£o das regras de compila√ß√£o na linguagem formal do CMake e, em seguida, gera arquivos de compila√ß√£o intermedi√°rios e nativos no mesmo diret√≥rio aceito em sua plataforma. </p><br><p>  Os arquivos gerados conter√£o nomes espec√≠ficos de utilit√°rios, diret√≥rios e compiladores do sistema, enquanto os comandos do CMake usam apenas o conceito abstrato do compilador e n√£o est√£o vinculados a ferramentas dependentes da plataforma que diferem bastante em diferentes sistemas operacionais. </p><br><h1 id="proverka-versii-cmake">  Verificando a vers√£o do CMake </h1><br><p>  O comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>cmake_minimum_required</code></a> verifica a vers√£o em execu√ß√£o do CMake: se for menor que o m√≠nimo especificado, o CMake ser√° encerrado com um erro fatal.  Um exemplo que demonstra o uso t√≠pico desse comando no in√≠cio de qualquer arquivo CMake: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#     CMake: cmake_minimum_required(VERSION 3.0)</span></span></code> </pre> <br><p>  Conforme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">observado</a> nos coment√°rios, o comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>cmake_minimum_required</code></a> define todos os sinalizadores de compatibilidade (consulte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>cmake_policy</code></a> ).  Alguns desenvolvedores intencionalmente definem uma vers√£o baixa do CMake e ajustam a funcionalidade manualmente.  Isso permite que voc√™ suporte simultaneamente as vers√µes antigas do CMake e, em alguns lugares, aproveite os novos recursos. </p><br><h1 id="oformlenie-proekta">  Concep√ß√£o do projeto </h1><br><p>  No in√≠cio de qualquer <code>CMakeLists.txt</code> deve especificar as caracter√≠sticas do projeto com a equipe do projeto para melhor design com ambientes integrados e outras ferramentas de desenvolvimento. </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#    "MyProject": project(MyProject VERSION 1.2.3.4 LANGUAGES C CXX)</span></span></code> </pre> <br><p>  √â importante notar que, se a palavra-chave <code>LANGUAGES</code> for omitida, os idiomas padr√£o ser√£o <code>C CXX</code> .  Voc√™ tamb√©m pode desativar a indica√ß√£o de qualquer idioma, escrevendo a palavra-chave <code>NONE</code> como uma lista de idiomas ou apenas deixando uma lista vazia. </p><br><h1 id="zapusk-skriptovyh-faylov">  Executando arquivos de script </h1><br><p>  O comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>include</code></a> substitui a linha de sua chamada pelo c√≥digo do arquivo especificado, agindo de forma semelhante ao comando <code>include</code> pr√© <code>include</code> processador C / C ++.  Este exemplo executa o arquivo de script <code>MyCMakeScript.cmake</code> comando descrito: </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">message</span></span>(<span class="hljs-string"><span class="hljs-string">"'TEST_VARIABLE' is equal to [${TEST_VARIABLE}]"</span></span>) <span class="hljs-comment"><span class="hljs-comment">#   `MyCMakeScript.cmake`  : include(MyCMakeScript.cmake) message("'TEST_VARIABLE' is equal to [${TEST_VARIABLE}]")</span></span></code> </pre> <br><p>  Neste exemplo, a primeira mensagem notificar√° que a vari√°vel <code>TEST_VARIABLE</code> n√£o foi definida; no entanto, se o script <code>MyCMakeScript.cmake</code> essa vari√°vel, a segunda mensagem j√° informar√° sobre o novo valor da vari√°vel de teste.  Portanto, o arquivo de script inclu√≠do pelo comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>include</code></a> n√£o cria seu pr√≥prio escopo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mencionado</a> nos coment√°rios do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo anterior</a> . </p><br><h1 id="kompilyaciya-ispolnyaemyh-faylov">  Compila√ß√£o de arquivos execut√°veis </h1><br><p>  O comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>add_executable</code></a> compila o arquivo execut√°vel com o nome fornecido na lista de fontes.  √â importante observar que o nome final do arquivo depende da plataforma de destino (por exemplo, <code>&lt;ExecutableName&gt;.exe</code> ou apenas <code>&lt;ExecutableName&gt;</code> ).  Um exemplo t√≠pico de chamar este comando: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#    "MyExecutable"  #  "ObjectHandler.c", "TimeManager.c"  "MessageGenerator.c": add_executable(MyExecutable ObjectHandler.c TimeManager.c MessageGenerator.c)</span></span></code> </pre> <br><h1 id="kompilyaciya-bibliotek">  Compila√ß√£o da biblioteca </h1><br><p>  O comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>add_library</code></a> compila a biblioteca com a exibi√ß√£o e o nome especificados da fonte.  √â importante observar que o nome final da biblioteca depende da plataforma de destino (por exemplo, <code>lib&lt;LibraryName&gt;.a</code> ou <code>&lt;LibraryName&gt;.lib</code> ).  Um exemplo t√≠pico de chamar este comando: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#    "MyLibrary"  #  "ObjectHandler.c", "TimeManager.c"  "MessageConsumer.c": add_library(MyLibrary STATIC ObjectHandler.c TimeManager.c MessageConsumer.c)</span></span></code> </pre> <br><ul><li>  Bibliotecas est√°ticas s√£o definidas pela palavra-chave <code>STATIC</code> como o segundo argumento e s√£o arquivos de arquivos de objetos associados a arquivos execut√°veis ‚Äã‚Äãe outras bibliotecas em tempo de compila√ß√£o; </li><li>  Bibliotecas din√¢micas s√£o especificadas pela palavra-chave <code>SHARED</code> como o segundo argumento e s√£o bibliotecas bin√°rias carregadas pelo sistema operacional durante a execu√ß√£o do programa; </li><li>  Bibliotecas modulares s√£o definidas pela palavra-chave <code>MODULE</code> como o segundo argumento e s√£o bibliotecas bin√°rias carregadas usando a t√©cnica de execu√ß√£o pelo pr√≥prio execut√°vel; </li><li>  Bibliotecas de objetos s√£o definidas pela palavra-chave <code>OBJECT</code> como o segundo argumento e s√£o um conjunto de arquivos de objetos associados a arquivos execut√°veis ‚Äã‚Äãe outras bibliotecas em tempo de compila√ß√£o. </li></ul><br><h1 id="dobavlenie-ishodnikov-k-celi">  Adicionando fonte √† meta </h1><br><p>  H√° casos que exigem v√°rias adi√ß√µes de arquivos de origem ao destino.  Para isso, √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>target_sources</code></a> o comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>target_sources</code></a> , que pode adicionar fontes ao destino v√°rias vezes. </p><br><p>  O primeiro argumento para o comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>target_sources</code></a> √© o nome do destino especificado anteriormente usando os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>add_executable</code></a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>add_executable</code></a> , e os argumentos a seguir s√£o a lista de arquivos de origem a serem adicionados. </p><br><p>  As chamadas repetidas ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>target_sources</code></a> adicionam os arquivos de origem ao destino na ordem em que foram chamados, para que os dois blocos de c√≥digo inferiores sejam funcionalmente equivalentes: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#    "MyExecutable"   # "ObjectPrinter.c"  "SystemEvaluator.c": add_executable(MyExecutable ObjectPrinter.c SystemEvaluator.c) #    "MyExecutable"  "MessageConsumer.c": target_sources(MyExecutable MessageConsumer.c) #    "MyExecutable"  "ResultHandler.c": target_sources(MyExecutable ResultHandler.c)</span></span></code> </pre> <br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#    "MyExecutable"   # "ObjectPrinter.c", "SystemEvaluator.c", "MessageConsumer.c"  "ResultHandler.c": add_executable(MyExecutable ObjectPrinter.c SystemEvaluator.c MessageConsumer.c ResultHandler.c)</span></span></code> </pre> <br><h1 id="generiruemye-fayly">  Arquivos gerados </h1><br><p>  O local dos arquivos de sa√≠da gerados pelos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>add_library</code></a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>add_library</code></a> √© determinado apenas no est√°gio de gera√ß√£o; no entanto, essa regra pode ser alterada com v√°rias vari√°veis ‚Äã‚Äãque determinam o local final dos arquivos bin√°rios: </p><br><ul><li>  As vari√°veis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>RUNTIME_OUTPUT_DIRECTORY</code></a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>RUNTIME_OUTPUT_NAME</code></a> determinam a localiza√ß√£o dos destinos de execu√ß√£o; </li><li>  As vari√°veis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>LIBRARY_OUTPUT_DIRECTORY</code></a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>LIBRARY_OUTPUT_NAME</code></a> determinam a localiza√ß√£o das bibliotecas; </li><li>  As vari√°veis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>ARCHIVE_OUTPUT_DIRECTORY</code></a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>ARCHIVE_OUTPUT_NAME</code></a> determinam a localiza√ß√£o dos arquivos. </li></ul><br><p>  Arquivos execut√°veis ‚Äã‚Äãsempre s√£o considerados objetivos de execu√ß√£o, bibliotecas est√°ticas s√£o consideradas objetivos de arquivamento e bibliotecas modulares s√£o consideradas objetivos de biblioteca.  Para plataformas "n√£o DLL", as bibliotecas din√¢micas s√£o consideradas destinos de biblioteca e, para "plataformas DLL", objetivos de execu√ß√£o.  Essas vari√°veis ‚Äã‚Äãn√£o s√£o fornecidas para bibliotecas de objetos, pois esse tipo de bibliotecas √© gerado nos intestinos do diret√≥rio <code>CMakeFiles</code> . </p><br><p>  √â importante observar que todas as plataformas baseadas no Windows, incluindo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cygwin,</a> s√£o consideradas "plataformas DLL". </p><br><h1 id="komponovka-s-bibliotekami">  Layout da biblioteca </h1><br><p>  O comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>target_link_libraries</code></a> biblioteca ou execut√°vel com outras bibliotecas fornecidas.  O primeiro argumento para esse comando √© o nome do destino gerado pelos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>add_library</code></a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>add_library</code></a> , e os argumentos subsequentes s√£o os nomes dos destinos da biblioteca ou caminhos completos para as bibliotecas.  Um exemplo: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#    "MyExecutable"  #  "JsonParser", "SocketFactory"  "BrowserInvoker": target_link_libraries(MyExecutable JsonParser SocketFactory BrowserInvoker)</span></span></code> </pre> <br><p>  Vale a pena notar que as bibliotecas modulares n√£o podem ser vinculadas a arquivos execut√°veis ‚Äã‚Äãou outras bibliotecas, pois elas destinam-se apenas ao carregamento por t√©cnicas de execu√ß√£o. </p><br><h1 id="rabota-s-celyami">  Trabalhar com objetivos </h1><br><p>  Como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mencionado</a> nos coment√°rios, os alvos no CMake tamb√©m est√£o sujeitos a manipula√ß√£o manual, embora muito limitada. </p><br><p>  √â poss√≠vel controlar as propriedades dos destinos projetados para definir o processo de montagem do projeto.  O comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>get_target_property</code></a> valor da propriedade de destino para a vari√°vel fornecida.  Este exemplo exibe o valor da propriedade <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>C_STANDARD</code></a> do destino <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>C_STANDARD</code></a> na tela: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#   "VALUE"   "C_STANDARD": get_target_property(VALUE MyTarget C_STANDARD) #      : message("'C_STANDARD' property is equal to [${VALUE}]")</span></span></code> </pre> <br><p>  O comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>set_target_properties</code></a> define as propriedades de destino especificadas para os valores especificados.  Este comando aceita uma lista de objetivos para os quais os valores da propriedade ser√£o definidos e, em seguida, a palavra-chave <code>PROPERTIES</code> , seguida por uma lista do formul√°rio <code>&lt; &gt; &lt; &gt;</code> : </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#   'C_STANDARD'  "11", #   'C_STANDARD_REQUIRED'  "ON": set_target_properties(MyTarget PROPERTIES C_STANDARD 11 C_STANDARD_REQUIRED ON)</span></span></code> </pre> <br><p>  O exemplo acima define as propriedades dos destinos <code>MyTarget</code> que afetam o processo de compila√ß√£o, a saber: ao compilar o destino <code>MyTarget</code> CMake <code>MyTarget</code> compilador use o padr√£o C11.  Todos os nomes conhecidos de propriedades de destino est√£o listados <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nesta p√°gina</a> . </p><br><p>  Tamb√©m √© poss√≠vel verificar destinos definidos anteriormente usando a constru√ß√£o <code>if(TARGET &lt;TargetName&gt;)</code> : </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#  "The target was defined!"   "MyTarget"  , #    "The target was not defined!": if(TARGET MyTarget) message("The target was defined!") else() message("The target was not defined!") endif()</span></span></code> </pre> <br><h1 id="dobavlenie-podproektov">  Adicionando subprojetos </h1><br><p>  O comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>add_subdirectory</code></a> solicita que o CMake processe imediatamente o arquivo de subprojeto especificado.  O exemplo abaixo demonstra a aplica√ß√£o do mecanismo descrito: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#   "subLibrary"    , #       "subLibrary/build": add_subdirectory(subLibrary subLibrary/build)</span></span></code> </pre> <br><p>  Neste exemplo, o primeiro argumento para o comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>add_subdirectory</code></a> √© o subprojeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>add_subdirectory</code></a> , e o segundo argumento √© opcional e informa o CMake sobre a pasta destinada aos arquivos gerados do subprojeto inclu√≠do (por exemplo, <code>CMakeCache.txt</code> e <code>cmake_install.cmake</code> ). </p><br><p>  Vale ressaltar que todas as vari√°veis ‚Äã‚Äãdo escopo pai s√£o herdadas pelo diret√≥rio adicionado e todas as vari√°veis ‚Äã‚Äãdefinidas e redefinidas nesse diret√≥rio estar√£o vis√≠veis apenas para ele (se a palavra-chave <code>PARENT_SCOPE</code> n√£o <code>PARENT_SCOPE</code> especificada pelo argumento do comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>set</code></a> ).  Esse recurso foi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mencionado</a> nos coment√°rios do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo anterior</a> . </p><br><h1 id="poisk-paketov">  Pesquisa de Pacotes </h1><br><p>  O comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>find_package</code></a> localiza e carrega as configura√ß√µes de um projeto externo.  Na maioria dos casos, √© usado para links subsequentes de bibliotecas externas, como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Boost</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GSL</a> .  Este exemplo chama o comando descrito para procurar a biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GSL</a> e depois vincular: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#     "GSL": find_package(GSL 2.5 REQUIRED) #      "GSL": target_link_libraries(MyExecutable GSL::gsl) #      "GSL": target_include_directories(MyExecutable ${GSL_INCLUDE_DIRS})</span></span></code> </pre> <br><p>  No exemplo acima, o comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>find_package</code></a> aceita o nome do pacote como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>find_package</code></a> primeiro argumento e, em seguida, a vers√£o necess√°ria.  A op√ß√£o <code>REQUIRED</code> requer a impress√£o de um erro fatal e o encerramento do CMake se o pacote necess√°rio n√£o for encontrado.  O oposto √© a op√ß√£o <code>QUIET</code> , exigindo que o CMake continue seu trabalho, mesmo que o pacote n√£o tenha sido encontrado. </p><br><p>  Em seguida, o <code>MyExecutable</code> vinculado √† biblioteca GSL com o comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>target_link_libraries</code></a> usando a vari√°vel <code>GSL::gsl</code> , que encapsula o local da GSL j√° compilada. </p><br><p>  No final, o comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>target_include_directories</code></a> √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>target_include_directories</code></a> , informando o compilador sobre a localiza√ß√£o dos arquivos de cabe√ßalho da biblioteca GSL.  Observe que a vari√°vel <code>GSL_INCLUDE_DIRS</code> √© usada para <code>GSL_INCLUDE_DIRS</code> local dos cabe√ßalhos que descrevi (este √© um exemplo de configura√ß√µes de pacotes importados). </p><br><p>  Voc√™ provavelmente deseja verificar o resultado de uma pesquisa de pacote se especificou a op√ß√£o <code>QUIET</code> .  Isso pode ser feito verificando a <code>&lt;PackageName&gt;_FOUND</code> , que √© determinada automaticamente ap√≥s a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>find_package</code></a> comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>find_package</code></a> .  Por exemplo, se voc√™ importar com √™xito as configura√ß√µes GSL para o seu projeto, a vari√°vel <code>GSL_FOUND</code> se tornar√° verdadeira. </p><br><p>  Em geral, o comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>find_package</code></a> possui dois tipos de inicializa√ß√£o: modular e configura√ß√£o.  O exemplo acima aplicou um formul√°rio modular.  Isso significa que, quando o comando √© chamado, o CMake procura por um arquivo de script no formato <code>Find&lt;PackageName&gt;.cmake</code> no diret√≥rio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>CMAKE_MODULE_PATH</code></a> e o inicia e importa todas as configura√ß√µes necess√°rias (nesse caso, o CMake lan√ßou o arquivo <code>FindGSL.cmake</code> padr√£o). </p><br><h1 id="sposoby-vklyucheniya-zagolovkov">  Maneiras de incluir cabe√ßalhos </h1><br><p>  Voc√™ pode informar o compilador sobre a localiza√ß√£o dos cabe√ßalhos inclu√≠dos usando dois comandos: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>include_directories</code></a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>target_include_directories</code></a> .  Voc√™ decide qual usar, no entanto, vale a pena considerar algumas diferen√ßas entre eles (a id√©ia √© sugerida nos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">coment√°rios</a> ). </p><br><p>  O comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>include_directories</code></a> afeta o escopo do diret√≥rio.  Isso significa que todos os diret√≥rios de cabe√ßalho especificados por este comando ser√£o usados ‚Äã‚Äãpara todos os prop√≥sitos do <code>CMakeLists.txt</code> atual, bem como para subprojetos processados ‚Äã‚Äã(consulte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>add_subdirectory</code></a> ). </p><br><p>  O comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>target_include_directories</code></a> afeta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>target_include_directories</code></a> o destino especificado pelo primeiro argumento e n√£o afeta outros destinos.  O exemplo abaixo demonstra a diferen√ßa entre os dois comandos: </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">add_executable</span></span>(RequestGenerator RequestGenerator.c) <span class="hljs-keyword"><span class="hljs-keyword">add_executable</span></span>(ResponseGenerator ResponseGenerator.c) <span class="hljs-comment"><span class="hljs-comment">#     "RequestGenerator": target_include_directories(RequestGenerator headers/specific) #    "RequestGenerator"  "ResponseGenerator": include_directories(headers)</span></span></code> </pre> <br><p>  Nos coment√°rios, √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mencionado</a> que em projetos modernos o uso dos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>link_libraries</code></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>include_directories</code></a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>link_libraries</code></a> √© indesej√°vel.  Uma alternativa s√£o os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>target_link_libraries</code></a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>target_link_libraries</code></a> que atuam apenas em objetivos espec√≠ficos, e n√£o em todo o escopo atual. </p><br><h1 id="ustanovka-proekta">  Instala√ß√£o do Projeto </h1><br><p>  O comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>install</code></a> gera regras de instala√ß√£o para o seu projeto.  Este comando √© capaz de trabalhar com objetivos, arquivos, pastas e muito mais.  Primeiro, considere estabelecer metas. </p><br><p>  Para definir metas, voc√™ deve passar a palavra-chave <code>TARGETS</code> como o primeiro argumento da fun√ß√£o descrita, seguida de uma lista das metas a serem definidas e, em seguida, a palavra-chave <code>DESTINATION</code> com o local do diret√≥rio em que as metas especificadas ser√£o definidas.  Este exemplo demonstra uma configura√ß√£o de meta t√≠pica: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#   "TimePrinter"  "DataScanner"   "bin": install(TARGETS TimePrinter DataScanner DESTINATION bin)</span></span></code> </pre> <br><p>  O processo para descrever a instala√ß√£o dos arquivos √© semelhante, exceto que <code>TARGETS</code> deve especificar <code>FILES</code> vez da palavra-chave <code>TARGETS</code> .  Um exemplo demonstrando a instala√ß√£o de arquivos: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#   "DataCache.txt"  "MessageLog.txt"   "~/": install(FILES DataCache.txt MessageLog.txt DESTINATION ~/)</span></span></code> </pre> <br><p>  O processo para descrever a instala√ß√£o de pastas √© semelhante, exceto que voc√™ deve especificar <code>DIRECTORY</code> vez da palavra-chave <code>FILES</code> .  √â importante observar que durante a instala√ß√£o, todo o conte√∫do da pasta ser√° copiado, e n√£o apenas o nome.  Um exemplo de instala√ß√£o de pastas √© o seguinte: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#   "MessageCollection"  "CoreFiles"   "~/": install(DIRECTORY MessageCollection CoreFiles DESTINATION ~/)</span></span></code> </pre> <br><p>  Ap√≥s concluir o processamento do CMake de todos os seus arquivos, voc√™ pode instalar todos os objetos descritos com o <code>sudo checkinstall</code> (se o CMake gerar um <code>Makefile</code> ) ou executar esta a√ß√£o no ambiente de desenvolvimento integrado que suporta o CMake. </p><br><h1 id="naglyadnyy-primer-proekta">  Exemplo visual do projeto </h1><br><p>  Este guia n√£o seria completo sem demonstrar um exemplo do mundo real do uso do sistema de cria√ß√£o do CMake.  Considere um diagrama de projeto simples usando o CMake como o √∫nico sistema de compila√ß√£o: </p><br><pre> <code class="plaintext hljs">+ MyProject - CMakeLists.txt - Defines.h - StartProgram.c + core - CMakeLists.txt - Core.h - ProcessInvoker.c - SystemManager.c</code> </pre> <br><p>  O arquivo de montagem principal <code>CMakeLists.txt</code> descreve a compila√ß√£o de todo o programa: primeiro, o comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>add_executable</code></a> √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>add_executable</code></a> que compila o arquivo execut√°vel, depois o comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>add_subdirectory</code></a> √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>add_subdirectory</code></a> , o que estimula o processamento do subprojeto e, finalmente, o arquivo execut√°vel √© vinculado √† biblioteca compilada: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#    CMake: cmake_minimum_required(VERSION 3.0) #   : project(MyProgram VERSION 1.0.0 LANGUAGES C) #      "MyProgram": add_executable(MyProgram StartProgram.c) #    "core/CMakeFiles.txt": add_subdirectory(core) #    "MyProgram"  #    "MyProgramCore": target_link_libraries(MyProgram MyProgramCore) #    "MyProgram"   "bin": install(TARGETS MyProgram DESTINATION bin)</span></span></code> </pre> <br><p>  O arquivo <code>core/CMakeLists.txt</code> √© chamado pelo arquivo assembly principal e compila a biblioteca est√°tica <code>MyProgramCore</code> destinada √† vincula√ß√£o com o arquivo execut√°vel: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#    CMake: cmake_minimum_required(VERSION 3.0) #      "MyProgramCore": add_library(MyProgramCore STATIC ProcessInvoker.c SystemManager.c)</span></span></code> </pre> <br><p>  Ap√≥s uma s√©rie de comandos <code>cmake . &amp;&amp; make &amp;&amp; sudo checkinstall</code>  <code>cmake . &amp;&amp; make &amp;&amp; sudo checkinstall</code> sistema de compila√ß√£o CMake √© conclu√≠do com √™xito.  O primeiro comando come√ßa a processar o arquivo <code>CMakeLists.txt</code> no diret√≥rio raiz do projeto, o segundo comando finalmente compila os arquivos bin√°rios necess√°rios e o terceiro comando instala o <code>MyProgram</code> compilado no sistema. </p><br><h1 id="zaklyuchenie">  Conclus√£o </h1><br><p>  Agora voc√™ pode escrever seus pr√≥prios e entender os arquivos do CMake de outras pessoas e pode ler em detalhes sobre outros mecanismos no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site oficial</a> . </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O pr√≥ximo artigo</a> deste guia se concentrar√° em testar e criar pacotes usando o CMake e ser√° lan√ßado em uma semana.  At√© breve! <br></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt432096/">https://habr.com/ru/post/pt432096/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt432086/index.html">Impress√£o 3D na escola internacional com o nome de M.V. Lomonosov</a></li>
<li><a href="../pt432088/index.html">Alta disponibilidade do MySQL no GitHub</a></li>
<li><a href="../pt432090/index.html">Magento Meetup Kharkiv No. 4 - reportagens em v√≠deo</a></li>
<li><a href="../pt432092/index.html">Erros desagrad√°veis ‚Äã‚Äãao escrever testes de unidade</a></li>
<li><a href="../pt432094/index.html">Hackathon online conjunto da OpenGift e da plataforma Blockchain de cr√©ditos</a></li>
<li><a href="../pt432098/index.html">Pilotos autom√°ticos no transporte rodovi√°rio, como interagir com promo√ß√µes. por transporte?</a></li>
<li><a href="../pt432102/index.html">Recursos expl√≠citos de JavaScript</a></li>
<li><a href="../pt432104/index.html">Resumo dos eventos de TI de dezembro (parte um)</a></li>
<li><a href="../pt432106/index.html">Food Design Digest, novembro de 2018</a></li>
<li><a href="../pt432108/index.html">As inscri√ß√µes intensivas est√£o abertas para os Kubernetes de 1 a 3 de fevereiro em S√£o Petersburgo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>