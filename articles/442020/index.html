<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚û°Ô∏è üôÖüèø üôà Nuevo c√≥dec AV1: acelere la carga de video en un navegador üñêüèΩ üßñüèæ üìÇ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En esta gu√≠a, aprenderemos c√≥mo usar el video en la Web, como es habitual en 2019. Chrome y Firefox han comenzado a admitir el nuevo c√≥dec AV1; para e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nuevo c√≥dec AV1: acelere la carga de video en un navegador</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442020/"> En esta gu√≠a, aprenderemos c√≥mo usar el video en la Web, como es habitual en 2019. Chrome y Firefox han comenzado a admitir el nuevo c√≥dec AV1; para ellos, el video se puede hacer la mitad. <br><br>  Hablaremos por separado sobre c√≥mo reemplazar los GIF con video en AV1 y H.264, luego su tama√±o se reducir√° entre 20 y 40 veces. <br><br><img src="https://habrastorage.org/webt/e6/ma/qx/e6maqxoeu5hqqh3ilpk5vh6ozvk.jpeg" alt="AV1 en el navegador"><br><br>  YouTube ya lo usa en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">TestTube</a> .  Netflix dijo que el AV1 ser√° " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">su c√≥dec de pr√≥xima generaci√≥n</a> ". <br><br>  Nosotros en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">Evil Martians</a> ya lo usamos en nuestro sitio web y en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">Amplifer</a> .  En este art√≠culo, compartir√© la experiencia de implementar AV1 y paso a paso le dir√© c√≥mo incrustar un video para que funcione en todos los navegadores. <br><a name="habracut"></a><br><h2>  C√≥decs y contenedores </h2><br>  Con im√°genes, todo es simple: ya sea JPEG con PNG para todos los navegadores, o hacer archivos m√°s compactos en WebP para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">navegadores modernos</a> .  Siempre podemos estar seguros de que los archivos <code>.png</code> tendr√°n un formato PNG (con la rara excepci√≥n de las bombas PNG contra las que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">imgproxy</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">puede proteger</a> ). <br><br>  Los archivos de video son m√°s complicados.  La extensi√≥n del archivo ( <code>.mp4</code> , <code>.wmv</code> , <code>.webm</code> o <code>.mov</code> ) solo habla sobre el contenedor.  Mientras que los archivos de video constan de tres componentes diferentes: <br><br><ol><li>  <b>El c√≥dec de video</b> determina cu√°nto puede comprimir el video y qu√© debe sacrificar.  Los principales c√≥decs de video de la Web: H.264, HEVC, VP9 y, ahora, AV1. </li><li>  <b>El c√≥dec de audio</b> comprime el sonido.  Por supuesto, no es necesario si no hay sonido en el video.  Las opciones populares son MP3, Opus y AAC. </li><li>  <b>El contenedor</b> almacena video (comprimido por alg√∫n tipo de c√≥dec de video) y transmisi√≥n de audio (comprimido por alg√∫n tipo de c√≥dec de audio).  Adem√°s de datos adicionales, como subt√≠tulos y metainformaci√≥n.  Contenedores populares: MP4, MOV, WebM. </li></ol><br>  Cuando vemos la extensi√≥n de archivo <code>.mp4</code> , solo podemos decir que se us√≥ el contenedor MP4.  Pero los c√≥decs pueden ser diferentes: el autor podr√≠a tomar H.264 y AAC, AV1 y Opus, o algo m√°s. <br><br><h2>  He aqu√≠ AV1 </h2><br>  AV1 es un c√≥dec de video que se lanz√≥ hace un a√±o, en marzo de 2018. Fue creado para superar los c√≥decs de la generaci√≥n anterior: HEVC, VP9, ‚Äã‚ÄãH.264 y VP8. <br><br><img src="https://habrastorage.org/webt/l1/pr/n6/l1prn6kicyr6f7smayebyp7m85m.jpeg" alt="Diagrama de generaci√≥n de c√≥decs de video"><br>  <i>Diagrama de c√≥dec de generaci√≥n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">Tsahi Levent-Levy</a></i> <br><br><blockquote>  Si se interes√≥ en c√≥mo AV1 logr√≥ superar el resto de los c√≥decs en compresi√≥n, lea los detalles t√©cnicos en las traducciones en Habr√©: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Video de la pr√≥xima generaci√≥n: Presentaci√≥n de AV1</a> <br>  ‚Äú <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">AV1 C√≥dec de pr√≥xima generaci√≥n: filtro direccional correctivo CDEF</a> ‚Äù <br></blockquote><br>  Debido a las nuevas optimizaciones, AV1 comprime el video un 30-50% mejor que H.264 o VP8, y hasta un 30% mejor que HEVC.  Pero el c√≥dec se lanz√≥ recientemente y hasta ahora tiene varias enfermedades infantiles: <br><br><ul><li>  El codificador actual no est√° optimizado.  AV1 comprime el video <i>muy</i> lentamente (un nuevo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">codificador r√°pido en Rust</a> ya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">est√°</a> en desarrollo).  El c√≥dec no es adecuado para la transmisi√≥n.  Si hablamos de videos est√°ticos en aterrizajes, este problema no es relevante para nosotros. </li><li>  Hasta ahora, el c√≥dec solo es compatible con computadoras de escritorio Chrome y Firefox en Windows.  Todav√≠a no hay soporte para Safari y Edge (aunque Microsoft <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">ya lo</a> est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">probando</a> ).  Necesitar√° al menos 2 archivos: AV1 para Chrome y Firefox y H.264 para otros navegadores. </li></ul><br>  Lo mejor de AV1 es que los cuadrados de " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">jackalization</a> " no aparecen a bajas tasas de bits. <br><br><img src="https://habrastorage.org/webt/kd/fi/gm/kdfigmacjbsduq4reyw7fsjvygo.png" alt="Comparaci√≥n de la calidad de imagen para diferentes c√≥decs a diferentes velocidades de bits"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">Comparaci√≥n de la</a> calidad de imagen para diferentes c√≥decs a diferentes velocidades de bits: AV1 gana</i> <br><br><h2>  Cocinar AV1 correctamente </h2><br>  Finalmente vamos a practicar.  Primero, decidamos sobre el contenedor.  En teor√≠a, AV1 se puede colocar en diferentes contenedores, pero MP4 es m√°s compacto y se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">recomienda</a> en la especificaci√≥n.  Para el sonido en AV1 tomamos Opus, porque <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">comprime el sonido perfectamente</a> . <br><br>  Para que el video funcione en todos los navegadores, generaremos 3 archivos: <br><br><ol><li>  Para computadoras de escritorio Chrome y Firefox en Windows ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">31% del mercado a</a> marzo de 2019): contenedor MP4 con AV1 para video y Opus para sonido. </li><li>  Para Safari y Edge ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">16% del mercado</a> ): MP4 con HEVC y AAC. </li><li>  Por lo dem√°s: un gran archivo MP4 con H.264 y AAC. </li></ol><br>  Solo puede tomar AV1 y H.264: el video tambi√©n funcionar√° para todos. <br><br>  Para la compresi√≥n, recomiendo tomar la consola <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">FFmpeg</a> .  Hay muchas utilidades gr√°ficas, pero es m√°s f√°cil guardar las opciones en la consola y luego iniciar la conversi√≥n autom√°ticamente.  Aseg√∫rese de usar la √∫ltima versi√≥n de FFmpeg.  Las versiones anteriores a <b>4.1</b> no admiten AV1 en MP4. <br><br>  Para Mac OS X: <br><br><ol><li>  Instalar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">Homebrew</a> . </li><li> <code>brew install ffmpeg</code> </li> </ol><br>  Para Linux, es mejor tomar una nueva versi√≥n del sitio oficial, mientras que en muchas distribuciones no hay una versi√≥n con soporte para AV1 en MP4: <br><br><ol><li> <code>wget https://johnvansickle.com/ffmpeg/releases/ffmpeg-release-amd64-static.tar.xz</code> </li> <li> <code>tar -xf ffmpeg-release-amd64-static.tar.xz</code> </li> <li> <code>sudo cp ffmpeg-4.1-64bit-static/ff* /usr/local/bin/</code> </li> </ol><br>  Para Windows, puede instalar FFmpeg <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">de William Diaz</a> . <br><br>  Pasamos a la conversi√≥n del archivo H.264, que necesitamos para navegadores m√°s antiguos.  Como todos nuestros archivos usan el contenedor MP4, <code>.av1.mp4</code> , <code>.hevc.mp4</code> y <code>.h264.mp4</code> .  No se alarme por el largo equipo, luego lo analizaremos todo: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  SOURCE.mov     - ffmpeg -i SOURCE.mov -map_metadata -1 -c:a libfdk_aac -c:v libx264 -crf 24 -preset veryslow -profile:v main -pix_fmt yuv420p -movflags +faststart -vf "scale=trunc(iw/2)*2:trunc(ih/2)*2" video.h264.mp4</span></span></code> </pre><br>  Ahora abra <code>video.h264.mp4</code> .  Si la calidad es buena y el tama√±o es grande, intente aumentar <code>-crf</code> ( <code>-crf 26</code> luego <code>-crf 28</code> ).  Esta opci√≥n reducir√° el tama√±o del archivo a costa de una calidad reducida.  Equilibrar la calidad y el tama√±o es un arte. <br><br><blockquote>  Si no hay un archivo de video original, puede convertir el antiguo archivo H.264 a AV1. </blockquote><br>  Ahora es el momento de convertir AV1. Les recuerdo que ser√° m√°s largo que H.264.  El c√≥dec a√∫n no utiliza toda la potencia del procesador (tiene sentido comenzar a convertir varios archivos en paralelo). <br><br><pre> <code class="bash hljs">ffmpeg -i SOURCE.mov -map_metadata -1 -c:a libopus -c:v libaom-av1 -crf 34 -b:v 0 -pix_fmt yuv420p -movflags +faststart -vf <span class="hljs-string"><span class="hljs-string">"scale=trunc(iw/2)*2:trunc(ih/2)*2"</span></span> -strict experimental video.av1.mp4</code> </pre><br>  <code>-crf</code> con <code>-crf</code> nuevamente para <code>-crf</code> equilibrio perfecto entre calidad y tama√±o. <br><br>  Ahora lo mismo para HEVC. <br><br><pre> <code class="bash hljs">ffmpeg -i SOURCE.mov -map_metadata -1 -c:a libfdk_aac -c:v libx265 -crf 24 -preset veryslow -pix_fmt yuv420p -movflags +faststart -vf <span class="hljs-string"><span class="hljs-string">"scale=trunc(iw/2)*2:trunc(ih/2)*2"</span></span> video.hevc.mp4</code> </pre><br>  Copie <code>video.h264.mp4</code> , <code>video.hevc.mp4</code> y <code>video.av1.mp4</code> en la ra√≠z de su sitio. <br><br><h3>  Comprender las opciones de FFmpeg </h3><br>  ¬øLos comandos anteriores se parecen a un hechizo de invocaci√≥n de demonios?  No te preocupes, esto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">no</a> es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">PostCSS</a> .  Veamos las opciones. <br><br>  <code>-i SOURCE.mov</code> indica el archivo de entrada, desde donde FFmpeg tomar√° secuencias de video y audio, las comprimir√° y las empacar√° en un nuevo contenedor. <br><br>  <code>-map_metadata -1</code> eliminar√° la metainformaci√≥n del video (por ejemplo, el programa en el que se cre√≥ el video).  Dicha informaci√≥n rara vez es √∫til en la Web. <br><br>  <code>-c:a libopus</code> o <code>-c:a libfdk_aac</code> establece los c√≥decs de audio.  Si no necesita sonido, reempl√°celos con <code>-an</code> . <br><br>  <code>-c:v libaom-av1</code> selecciona el c√≥dec de video, una biblioteca que comprimir√° los cuadros de la transmisi√≥n de video. <br><br>  <code>-crf 34</code> - Factor de tasa constante, un equilibrio de calidad y tama√±o.  Es como un control deslizante de calidad JPEG, solo que va en una direcci√≥n diferente (0 es la mejor calidad y el archivo m√°s grande).  La escala CRF es diferente para H.264 y AV1: para H.264 sube a 51, para AV1 sube a 61. El CRF para AV1 y H.264 ser√° diferente. <br><br><blockquote>  Facebook encontr√≥ una correspondencia aproximada entre los valores de CRF para H.264 y AV1: <br>  19 ‚Üí 27, 23 ‚Üí 33, 27 ‚Üí 39, 31 ‚Üí 45, 35 ‚Üí 51, 39 ‚Üí 57. <br></blockquote><br>  <code>-preset veryslow</code> obliga a los c√≥decs H.264 y HEVC a comprimir el archivo a√∫n m√°s a costa de un fuerte aumento en el tiempo de conversi√≥n. <br><br>  <code>-profile:v main</code> utilizado por H.264 para seleccionar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">un perfil de c√≥dec</a> .  Solo "Main" funcionar√° en Safari. <br><br>  <code>-b:v 0</code> establece la tasa de bits m√≠nima para AV1 para que el video tenga una calidad constante. <br><br>  <code>-pix_fmt yuv420p</code> (formato de p√≠xel) es una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">forma</a> complicada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">de</a> reducir el tama√±o del archivo.  Deja la resoluci√≥n original para el brillo, pero reduce la resoluci√≥n para el color.  Nuestros ojos ven peor el color, por lo tanto, no se dan cuenta de este truco.  Elimine esta opci√≥n si en su caso interfiere. <br><br>  <code>-movflags +faststart</code> mueve todo lo importante al comienzo del archivo para que el navegador pueda reproducir el video hasta que se complete la descarga. <br><br>  <code>-vf "scale=trunc(iw/2)*2:trunc(ih/2)*2"</code> cambiar√° el tama√±o de los lados del video a los pares m√°s cercanos (algunos c√≥decs pueden funcionar con una resoluci√≥n de 300 √ó 200 y 302 √ó 200, pero no funcionar√°n con 301 √ó 200).  Si est√° seguro de que en todas partes la resoluci√≥n se divide por 2, puede eliminar esta opci√≥n. <br><br>  <code>-strict experimental</code> necesario para AV1, su codificador sigue siendo experimental. <br><br>  <code>video.av1.mp4</code> establece el nombre del archivo resultante. <br><br><h3>  Lanzamos video en navegadores </h3><br>  Ahora necesitamos que cada navegador descargue el video que admite.  Para esto, &lt;source&gt; tiene un atributo de <code>type</code> .  Y le aconsejo que lea sobre las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">opciones en &lt;video&gt;</a> . <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">controls</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"600"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"400"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video.hevc.mp4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video/mp4; codecs=hevc,mp4a.40.2"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video.av1.mp4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video/mp4; codecs=av01.0.05M.08,opus"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video.h264.mp4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video/mp4; codecs=avc1.4D401E,mp4a.40.2"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  &lt;source&gt; son como <code>if‚Ä¶else</code> expresiones <code>if‚Ä¶else</code> : el navegador las lee de arriba a abajo hasta que encuentra la que admite. <br><br>  En <code>type</code> puede especificar el formato de archivo completo: contenedor ( <code>video/mp4</code> para MP4), c√≥dec de video ( <code>av01.0.05M.08</code> para AV1, <code>hevc</code> para HEVC y <code>avc1.4D401E</code> para H.264) y c√≥dec de audio ( <code>opus</code> para Opus y <code>mp4a.40.2</code> para AAC). <br><br><h2>  Bonificaci√≥n: c√≥mo convertir GIF a AV1 y H.264 </h2><br>  En 2019, usar GIF para videos cortos es un gran pecado.  GIF pesa 20-40 veces m√°s que H.264 o AV1.  GIF golpea la CPU con m√°s fuerza y ‚Äã‚Äãhace que la bater√≠a gotee m√°s r√°pido.  Si necesita un video corto en bucle, tome c√≥decs de video.  Y FFmpeg puede convertir videos directamente desde GIF. <br><br>  Convierte GIF a H.264: <br><br><pre> <code class="bash hljs">ffmpeg -i IMAGE.gif -map_metadata -1 -an -c:v libx264 -crf 24 -preset veryslow -profile:v main -pix_fmt yuv420p -movflags +faststart -vf <span class="hljs-string"><span class="hljs-string">"scale=trunc(iw/2)*2:trunc(ih/2)*2"</span></span> video.h264.mp4</code> </pre><br>  Genere un AV1 a√∫n m√°s peque√±o: <br><br><pre> <code class="bash hljs">ffmpeg -i IMAGE.gif -map_metadata -1 -an opus -c:v libaom-av1 -crf 50 -b:v 0 -pix_fmt yuv420p -movflags +faststart -vf <span class="hljs-string"><span class="hljs-string">"scale=trunc(iw/2)*2:trunc(ih/2)*2"</span></span> -strict experimental video.av1.mp4</code> </pre><br>  Ahora inserte <code>animation.h264.mp4</code> y <code>animation.av1.mp4</code> en el HTML. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autoplay</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">loop</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">muted</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">playsinline</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"300"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"200"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"animation.av1.mp4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video/mp4; codecs=av01.0.05M.08"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"animation.h264.mp4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video/mp4"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Las opciones de <code>autoplay</code> y <code>loop</code> hacen que el video sea un "GIF", un video en bucle que se reproduce inmediatamente despu√©s de que se carga la p√°gina.  <code>playsinline</code> impide que Safari abra el video en pantalla completa cuando hace clic en el video. <br><br><h2>  Tiempo de retiro </h2><br>  AV1 todav√≠a es experimental.  Pero ya se puede usar para hacer feliz a una cuarta parte de sus usuarios.  Un par de comandos FFmpeg generar√°n archivos de video.  &lt;video&gt; se cre√≥ desde el principio para reproducir videos de acuerdo con las capacidades del navegador.  Ya usamos AV1 en producci√≥n y todo funciona bien (excepto el tiempo de espera hasta que el codificador AV1 termine de funcionar). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/442020/">https://habr.com/ru/post/442020/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../442010/index.html">Python y FPGA. Prueba</a></li>
<li><a href="../442012/index.html">Experimento: recopilamos un directorio de unidades que emitieron un pasaporte</a></li>
<li><a href="../442014/index.html">Dart 2.2 anunciado: C√≥digo de m√°quina m√°s eficiente, soporte para set literales</a></li>
<li><a href="../442016/index.html">Los hackers son peores que pintar, o c√≥mo proteger las aplicaciones web</a></li>
<li><a href="../442018/index.html">Ley de primavera en t√©rminos de la constituci√≥n. Por qu√© puede</a></li>
<li><a href="../442022/index.html">Dise√±o en CodeFest. Pero eso no es seguro</a></li>
<li><a href="../442024/index.html">Se est√° creando una estrategia nacional de inteligencia artificial en Rusia</a></li>
<li><a href="../442026/index.html">Trojan.Multi.BroSubsc.gen - Kaspersky funciona</a></li>
<li><a href="../442028/index.html">Carrera de esteroides. Samurai Way</a></li>
<li><a href="../442032/index.html">Reintroducci√≥n de bisontes (peque√±a victoria de los zo√≥logos)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>