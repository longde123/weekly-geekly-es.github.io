<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìÖ üßëüèΩ‚Äçü§ù‚Äçüßëüèº ‚úäüèº S√©curit√© du casque üë©üèø‚Äçü§ù‚Äçüë®üèº üçò üò´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'essence de l'histoire du gestionnaire de paquets le plus populaire pour Kubernetes pourrait √™tre repr√©sent√©e √† l'aide d'emoji: 



- la bo√Æte est He...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>S√©curit√© du casque</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/462665/">  L'essence de l'histoire du gestionnaire de paquets le plus populaire pour Kubernetes pourrait √™tre repr√©sent√©e √† l'aide d'emoji: <br><br><ul><li>  la bo√Æte est Helm (c'est la plus appropri√©e de la derni√®re version d'Emoji); </li><li>  serrure - s√©curit√©; </li><li>  l'homme est la solution au probl√®me. </li></ul><br><img src="https://habrastorage.org/webt/7f/e6/f2/7fe6f2dsslbuogltyajqyhcm3x4.jpeg"><br><br>  En fait, tout sera un peu plus compliqu√©, et l'histoire regorge de d√©tails techniques sur la <b>fa√ßon de rendre Helm s√ªr</b> . <br><br><ul><li>  En bref, qu'est-ce que Helm si vous ne le saviez pas ou l'oubliez.  Quels probl√®mes r√©sout-il et o√π se situe-t-il dans l'√©cosyst√®me? </li><li>  Consid√©rez l'architecture de Helm.  Pas une seule conversation sur la s√©curit√© et la fa√ßon de s√©curiser un outil ou une solution ne peut se passer de comprendre l'architecture du composant. </li><li>  Parlons des composants de Helm. </li><li>  Le probl√®me le plus br√ªlant est l'avenir - la nouvelle version de Helm 3. </li></ul><br>  Tout dans cet article concerne Helm 2. Cette version est maintenant en production et c'est probablement vous qui l'utilisez maintenant, et c'est l√† qu'il y a des risques de s√©curit√©. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/_8zNTJ1_R5I" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <strong>√Ä propos du conf√©rencier:</strong> Alexander Khayorov ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">allexx</a> ) d√©veloppe depuis 10 ans, contribue √† am√©liorer le contenu de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Moscow Python Conf ++</a> et a rejoint le comit√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Helm Summit</a> .  Travaille actuellement chez Chainstack en tant que responsable du d√©veloppement - il s'agit d'un hybride entre le responsable du d√©veloppement et la personne responsable de la livraison des versions finales.  Autrement dit, il est situ√© sur le site des hostilit√©s, o√π tout se passe de la cr√©ation du produit √† son fonctionnement. <br><br>  Chainstack est une petite start-up en croissance rapide dont la t√¢che est de fournir aux clients la possibilit√© d'oublier l'infrastructure et les difficult√©s de fonctionnement des applications d√©centralis√©es, l'√©quipe de d√©veloppement est situ√©e √† Singapour.  Ne demandez pas √† Chainstack de vendre ou d'acheter de la crypto-monnaie, mais proposez de parler des cadres de la blockchain d'entreprise, et ils seront heureux de vous r√©pondre. <br><br><h2>  Heaume </h2><br>  Il s'agit du gestionnaire de packages (graphiques) pour Kubernetes.  La mani√®re la plus compr√©hensible et la plus universelle d'apporter des applications au cluster Kubernetes. <br><br><img src="https://habrastorage.org/webt/0h/4j/np/0h4jnpvzc7hlncvlzprx9hfkz9s.jpeg"><br><br>  Bien entendu, il s'agit d'une approche plus structurelle et industrielle que de cr√©er vos propres manifestes YAML et d'√©crire de petits utilitaires. <br><br><blockquote>  Helm est le meilleur disponible et le plus populaire en ce moment. </blockquote><br>  Pourquoi barre?  Principalement parce qu'il est pris en charge par la CNCF.  Cloud Native - une grande organisation, est la soci√©t√© m√®re des projets Kubernetes, etcd, Fluentd et autres. <br><br>  Autre fait important, Helm est un projet tr√®s populaire.  Quand, en janvier 2019, je pr√©voyais de parler de la fa√ßon de rendre Helm s√ªr, le projet avait mille √©toiles sur GitHub.  En mai, il y en avait 12 000. <br><br>  Beaucoup de gens sont int√©ress√©s par Helm, donc, m√™me si vous ne l'utilisez toujours pas, vous aurez besoin de conna√Ætre sa s√©curit√©.  <strong>La s√©curit√© est importante.</strong> <br><br>  L'√©quipe centrale de Helm est prise en charge par Microsoft Azure, et c'est donc un projet assez stable contrairement √† beaucoup d'autres.  La sortie de Helm 3 Alpha 2 √† la mi-juillet indique que beaucoup de gens travaillent sur le projet et qu'ils ont le d√©sir et la force de d√©velopper et d'am√©liorer Helm. <br><br><img src="https://habrastorage.org/webt/c8/m1/ex/c8m1exaajnjbhme9yh_gjqw_y00.jpeg"><br><br>  Helm r√©sout plusieurs probl√®mes de gestion des applications racine dans Kubernetes. <br><br><ul><li>  Emballage d'application.  M√™me une application comme ¬´Hello, World¬ª sur WordPress comprend d√©j√† plusieurs services, et je veux les regrouper. </li><li>  Gestion de la complexit√© qui se pose avec la gestion de ces applications. </li><li>  Un cycle de vie qui ne se termine pas apr√®s l'installation ou le d√©ploiement de l'application.  Il continue de vivre, il doit √™tre mis √† jour, et Helm y contribue et essaie d'apporter les bonnes mesures et politiques pour cela. </li></ul><br>  <strong>L'emballage</strong> est organis√© de mani√®re compr√©hensible: il y a des m√©tadonn√©es en totale conformit√© avec le travail d'un gestionnaire de paquets r√©gulier pour Linux, Windows ou MacOS.  Autrement dit, le r√©f√©rentiel, en fonction de divers packages, m√©ta-informations pour les applications, param√®tres, fonctionnalit√©s de configuration, indexation des informations, etc. Tout ce Helm vous permet d'obtenir et d'utiliser pour les applications. <br><br>  <strong>Gestion de la complexit√©</strong> .  Si vous avez de nombreuses applications similaires, vous avez besoin d'un param√©trage.  Les mod√®les en d√©coulent, mais afin de ne pas trouver votre propre fa√ßon de cr√©er des mod√®les, vous pouvez utiliser ce que Helm propose d√®s le d√©part. <br><br>  <strong>Gestion du cycle de vie des applications</strong> - √† mon avis, c'est le probl√®me le plus int√©ressant et non r√©solu.  C'est pourquoi je suis venu √† Helm en temps voulu.  Nous devions surveiller le cycle de vie de l'application, nous voulions transf√©rer notre CI / CD et nos cycles d'application √† ce paradigme. <br><br>  Helm vous permet de: <br><br><ul><li>  g√©rer le d√©ploiement, introduit le concept de configuration et de r√©vision; </li><li>  restauration r√©ussie; </li><li>  utiliser des crochets pour diff√©rents √©v√©nements; </li><li>  Ajoutez des v√©rifications d'application suppl√©mentaires et r√©pondez √† leurs r√©sultats. </li></ul><br>  De plus <strong>, Helm a des ¬´batteries¬ª</strong> - un grand nombre de choses savoureuses qui peuvent √™tre incluses sous forme de plug-ins, vous simplifiant la vie.  Les plugins peuvent √™tre √©crits ind√©pendamment, ils sont assez isol√©s et ne n√©cessitent pas d'architecture √©lanc√©e.  Si vous voulez impl√©menter quelque chose, je vous recommande de le faire en tant que plugin, puis il est possible de l'inclure en amont. <br><br>  Helm est bas√© sur trois concepts principaux: <br><br><ul><li>  <strong>Chart Repo</strong> - description et tableau de param√©trage possibles pour votre manifeste. </li><li>  <strong>Config - c'est-√†</strong> -dire les valeurs qui seront appliqu√©es (texte, valeurs num√©riques, etc.). </li><li>  <strong>Release</strong> rassemble les deux premiers composants, et ensemble, ils se transforment en Release.  Les versions peuvent √™tre versionn√©es, r√©alisant ainsi l'organisation du cycle de vie: petite au moment de l'installation et grande au moment de la mise √† niveau, de la r√©trogradation ou de la restauration. </li></ul><br><h2>  Architecture de barre </h2><br>  Le diagramme refl√®te conceptuellement l'architecture de haut niveau de Helm. <br><br><img src="https://habrastorage.org/webt/ih/dk/fs/ihdkfsbvonqupbrs-tvbmspdnpm.jpeg"><br><br>  Permettez-moi de vous rappeler que Helm est quelque chose qui est li√© √† Kubernetes.  Par cons√©quent, nous ne pouvons pas nous passer de cluster Kubernetes (rectangle).  Le composant kube-apiserver est sur l'assistant.  Sans Helm, nous avons Kubeconfig.  Helm apporte un petit binaire, pour ainsi dire, l'utilitaire Helm CLI, qui est install√© sur un ordinateur, un ordinateur portable, un ordinateur central - pour tout. <br><br>  Mais cela ne suffit pas.  Helm a un composant serveur Tiller.  Il repr√©sente les int√©r√™ts de Helm au sein d'un cluster, c'est la m√™me application au sein d'un cluster Kubernetes, comme les autres. <br><br>  Le composant suivant de Chart Repo est le r√©f√©rentiel de graphiques.  Il existe un r√©f√©rentiel officiel et il peut exister un r√©f√©rentiel priv√© d'une entreprise ou d'un projet. <br><br><h3>  L'interaction </h3><br>  Voyons comment les composants d'architecture interagissent lorsque nous voulons installer une application √† l'aide de Helm. <br><br><ul><li> Nous disons <code>Helm install</code> , allez dans le r√©f√©rentiel (Chart Repo) et obtenez un graphique Helm. </li></ul><br><ul><li>  L'utilitaire Helm (Helm CLI) interagit avec Kubeconfig pour d√©terminer le cluster √† contacter. </li><li>  Apr√®s avoir re√ßu ces informations, l'utilitaire se tourne vers Tiller, qui est dans notre cluster, d√©j√† sous forme d'application. </li><li>  Tiller se tourne vers Kube-apiserver pour effectuer des actions dans Kubernetes, pour cr√©er des objets (services, pods, r√©pliques, secrets, etc.). </li></ul><br>  De plus, nous compliquerons le sch√©ma pour voir le vecteur d'attaques auquel l'ensemble de l'architecture Helm dans son ensemble peut √™tre soumis.  Et puis on va essayer de la prot√©ger. <br><br><h3>  Vecteur d'attaque </h3><br>  Le premier point potentiellement faible est l' <strong>API</strong> <strong>utilisateur</strong> <strong>privil√©gi√©</strong> .  Dans le cadre du sch√©ma, il s'agit d'un pirate informatique qui a obtenu un acc√®s administrateur √† Helm CLI. <br><br>  <strong>Un utilisateur d'API non privil√©gi√©</strong> peut √©galement √™tre dangereux s'il se trouve quelque part √† proximit√©.  Un tel utilisateur aura un contexte diff√©rent, par exemple, il peut √™tre fix√© dans un espace de noms du cluster dans les param√®tres de Kubeconfig. <br><br>  Le vecteur d'attaque le plus int√©ressant peut √™tre le processus situ√© √† l'int√©rieur du cluster quelque part pr√®s de Tiller et auquel il peut acc√©der.  Il peut s'agir d'un serveur Web ou d'un microservice qui voit l'environnement r√©seau du cluster. <br><br>  Une option d'attaque exotique, mais qui gagne en popularit√©, est associ√©e au Chart Repo.  Un graphique cr√©√© par un auteur sans scrupules peut contenir une ressource non s√©curis√©e, et vous l'ex√©cuterez en le croyant.  Ou il peut remplacer le graphique que vous t√©l√©chargez √† partir du r√©f√©rentiel officiel et, par exemple, cr√©er une ressource sous la forme de politiques et augmenter votre acc√®s. <br><br><img src="https://habrastorage.org/webt/jv/mc/86/jvmc86oowz_haxtc6jwb3gac9me.jpeg"><br><br>  Essayons de repousser les attaques de ces quatre c√¥t√©s et trouvons o√π il y a des probl√®mes dans l'architecture de Helm, et o√π, √©ventuellement, ils ne le sont pas. <br><br>  Agrandissons le sch√©ma, ajoutons plus d'√©l√©ments, mais gardons tous les composants de base. <br><br><img src="https://habrastorage.org/webt/j3/1d/ci/j31dciie_cbem-dvnilww29iksc.jpeg"><br><br>  Helm CLI communique avec Chart Repo, interagit avec Kubeconfig, le travail est transf√©r√© au cluster dans le composant Tiller. <br><br>  Tiller est repr√©sent√© par deux objets: <br><br><ul><li>  Tiller-deploy svc, qui expose un certain service; </li><li>  Tiller-deploy pod (sur le diagramme en une seule copie dans une r√©plique), qui ex√©cute toute la charge qui acc√®de au cluster. </li></ul><br>  Pour l'interaction, diff√©rents protocoles et sch√©mas sont utilis√©s.  Du point de vue de la s√©curit√©, nous sommes surtout int√©ress√©s par: <br><br><ul><li>  Le m√©canisme par lequel Helm CLI acc√®de au r√©f√©rentiel de graphiques: quel protocole, s'il existe une authentification et ce qui peut √™tre fait √† ce sujet. </li><li>  Protocole par lequel Helm CLI, √† l'aide de kubectl, communique avec Tiller.  Il s'agit d'un serveur RPC install√© √† l'int√©rieur du cluster. </li><li>  Tiller lui-m√™me est disponible pour les microservices qui sont dans un cluster et interagit avec Kube-apiserver. </li></ul><br><img src="https://habrastorage.org/webt/qm/49/cw/qm49cwtid16t8lz5lrn7ngzjahi.jpeg"><br><br>  Nous allons discuter de toutes ces directions dans l'ordre. <br><br><h2>  RBAC </h2><br><blockquote>  Il est inutile de parler de toute s√©curit√© de Helm ou d'un autre service au sein du cluster si RBAC n'est pas activ√©. </blockquote><br>  Il semble que ce ne soit pas une nouvelle recommandation en soi, mais je suis s√ªr que jusqu'√† pr√©sent, beaucoup n'ont pas inclus RBAC m√™me en production, car cela fait beaucoup de bruit et vous devez configurer beaucoup de choses.  N√©anmoins, je demande instamment que cela soit fait. <br><br><img src="https://habrastorage.org/webt/h-/6q/j6/h-6qj6oj9otudmbpt_qdx3rzfcs.jpeg"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://rbac.dev/</a> est un site d'avocats pour RBAC.  Il a collect√© une √©norme quantit√© de documents int√©ressants qui aideront √† mettre en place RBAC, montrer pourquoi il est bon et comment vivre avec, en principe, en production. <br><br>  Je vais essayer d'expliquer comment Tiller et RBAC fonctionnent.  Tiller fonctionne √† l'int√©rieur d'un cluster sous un certain compte de service.  En r√®gle g√©n√©rale, si RBAC n'est pas configur√©, ce sera le superutilisateur.  Dans la configuration de base, Tiller sera l'administrateur.  C'est pourquoi on dit souvent que Tiller est un tunnel SSH vers votre cluster.  C'est en fait le cas, vous pouvez donc utiliser un compte de service d√©di√© distinct au lieu du compte de service par d√©faut dans le diagramme ci-dessus. <br><br>  Lorsque vous initialisez Helm, installez-le d'abord sur le serveur, vous pouvez d√©finir le compte de service √† l'aide de <code>--service-account</code> .  Cela vous permettra d'utiliser l'utilisateur avec le minimum de droits n√©cessaires.  Certes, vous devez cr√©er une telle "guirlande": Role et RoleBinding. <br><br><img src="https://habrastorage.org/webt/wh/rv/-6/whrv-6tklftmsb0_fw3h0uumk5g.jpeg"><br><br>  Malheureusement, Helm ne le fera pas pour vous.  Vous ou votre administrateur de cluster Kubernetes devez pr√©parer √† l'avance un ensemble de r√¥les, RoleBinding pour le compte de service pour transf√©rer Helm. <br><br>  La question est - quelle est la diff√©rence entre Role et ClusterRole?  La diff√©rence est que ClusterRole est valide pour tous les espaces de noms, contrairement aux r√¥les et r√¥les de liaison classiques, qui ne fonctionnent que pour les espaces de noms sp√©cialis√©s.  Vous pouvez configurer des strat√©gies pour l'ensemble du cluster et tous les espaces de noms, ainsi que les personnaliser pour chaque espace de noms s√©par√©ment. <br><br>  Il convient de mentionner que RBAC r√©sout un autre gros probl√®me.  Beaucoup se plaignent du fait que Helm, malheureusement, n'est pas multi-location (ne prend pas en charge la multi-location).  Si plusieurs √©quipes consomment un cluster et utilisent Helm, il est en principe impossible de configurer des strat√©gies et de diff√©rencier leur acc√®s au sein de ce cluster, car il existe un compte de service sous lequel Helm fonctionne, et il cr√©e toutes les ressources du cluster √† partir de celui-ci, ce qui parfois tr√®s inconfortable.  Cela est vrai - en tant que binaire lui-m√™me, en tant que processus, <strong>Helm Tiller n'a aucune id√©e de la mutualisation</strong> . <br><br>  Cependant, il existe un excellent moyen d'ex√©cuter plusieurs fois Tiller dans un cluster.  Il n'y a aucun probl√®me avec cela; Tiller peut √™tre ex√©cut√© dans tous les espaces de noms.  Ainsi, vous pouvez utiliser RBAC, Kubeconfig comme contexte et restreindre l'acc√®s au Helm sp√©cial. <br><br>  Il ressemblera √† ceci. <br><br><img src="https://habrastorage.org/webt/rr/hh/kv/rrhhkvmholhz5monyp3o7vxc9nk.jpeg"><br><br>  Par exemple, il existe deux Kubeconfig avec contexte pour diff√©rentes √©quipes (deux espaces de noms): X Team pour l'√©quipe de d√©veloppement et le cluster d'administration.  Le cluster d'administration a son propre large Tiller, qui est situ√© dans l'espace de noms du syst√®me Kube, respectivement un compte de service avanc√©.  Et un espace de noms distinct pour l'√©quipe de d√©veloppement, ils pourront d√©ployer leurs services dans un espace de noms sp√©cial. <br><br>  Il s'agit d'une approche de travail, Tiller n'est pas si gourmand que cela pourrait affecter consid√©rablement votre budget.  C'est l'une des solutions rapides. <br><br><blockquote>  N'h√©sitez pas √† configurer Tiller s√©par√©ment et √† fournir √† Kubeconfig un contexte pour l'√©quipe, pour un d√©veloppeur sp√©cifique ou pour l'environnement: Dev, Staging, Production (il est douteux que tout soit sur le m√™me cluster, cependant, cela peut √™tre fait). </blockquote><br>  Poursuivant notre histoire, passez de RBAC et parlez de ConfigMaps. <br><br><h3>  Cartes de configuration </h3><br>  Helm utilise ConfigMaps comme entrep√¥t de donn√©es.  Lorsque nous avons parl√© d'architecture, il n'y avait nulle part une base de donn√©es dans laquelle √©taient stock√©es les informations sur les versions, les configurations, les annulations, etc. Pour cela, ConfigMaps est utilis√©. <br><br>  Le principal probl√®me avec ConfigMaps est connu - ils ne sont pas s√ªrs en principe, il est <strong>impossible d'y stocker des donn√©es sensibles</strong> .  Nous parlons de tout ce qui ne doit pas aller au-del√† du service, par exemple les mots de passe.  Le moyen le plus natif pour Helm est maintenant de passer de l'utilisation de ConfigMaps aux secrets. <br><br>  Cela se fait tr√®s simplement.  Red√©finissez le param√®tre Tiller et sp√©cifiez que le stockage sera secret.  Ensuite, pour chaque d√©ploiement, vous ne recevrez pas ConfigMap, mais un secret. <br><br><img src="https://habrastorage.org/webt/da/a2/e-/daa2e-a00de_nuo_crbeqtaz6qu.jpeg"><br><br>  Vous pouvez affirmer que les secrets eux-m√™mes sont un concept √©trange et qu'il n'est pas tr√®s s√ªr.  Cependant, il vaut la peine de comprendre que les d√©veloppeurs de Kubernetes le font.  √Ä partir de la version 1.10, c'est-√†-dire  il y a assez longtemps, il y a la possibilit√©, au moins dans les clouds publics, de connecter le stockage correct pour stocker les secrets.  Maintenant, l'√©quipe travaille sur une meilleure distribution de l'acc√®s aux secrets, aux soumissions individuelles ou √† d'autres entit√©s. <br><br><blockquote>  Il est pr√©f√©rable de traduire Helm de stockage en secrets, et ceux-ci, √† leur tour, sont s√©curis√©s de mani√®re centralis√©e. </blockquote><br>  Bien s√ªr, il restera une <strong>limite de stockage de donn√©es de 1 Mo.</strong>  Ici, Helm utilise etcd comme r√©f√©rentiel distribu√© pour ConfigMaps.  Et l√†, ils pensaient que c'√©tait un bloc de donn√©es appropri√© pour les r√©plications, etc.  Il y a une discussion int√©ressante sur Reddit √† ce sujet, je recommande de trouver ce sujet de lecture amusant pour le week-end ou de lire le squeeze <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br><h3>  D√©p√¥t de graphique </h3><br>  Les graphiques sont les plus vuln√©rables socialement et peuvent devenir la source de "l'homme au milieu", surtout si vous utilisez la solution de stock.  Tout d'abord, nous parlons de r√©f√©rentiels qui sont expos√©s via HTTP. <br><br><blockquote>  Certainement, vous devez exposer Helm Repo via HTTPS - c'est la meilleure option et peu co√ªteuse. </blockquote><br>  Faites attention au <strong>m√©canisme de signature des graphiques</strong> .  La technologie est simple √† d√©shonorer.  C'est la m√™me chose que vous utilisez sur GitHub, la machine PGP habituelle avec des cl√©s publiques et priv√©es.  Installez-vous et assurez-vous d'avoir les cl√©s n√©cessaires et de tout signer, c'est vraiment votre charte. <br><br>  De plus, le <strong>client Helm prend en charge TLS</strong> (pas dans le sens de HTTP c√¥t√© serveur, mais TLS mutuel).  Vous pouvez utiliser des cl√©s de serveur et de client pour communiquer.  Franchement, je n'utilise pas un tel m√©canisme en raison de l'aversion pour les certificats mutuels.  En principe, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">chartmuseum</a> - le principal outil d'exposition Helm Repo pour Helm 2 - prend √©galement en charge l'authentification de base.  Vous pouvez utiliser l'authentification de base si elle est plus pratique et plus calme. <br><br>  Il existe √©galement un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plugin helm-gcs</a> qui vous permet d'h√©berger des d√©p√¥ts de graphiques sur Google Cloud Storage.  C'est assez pratique, fonctionne tr√®s bien et est assez s√ªr, car tous les m√©canismes d√©crits sont utilis√©s. <br><br><img src="https://habrastorage.org/webt/zo/e9/io/zoe9iooiuwjc6ccwy3lcghxlsyo.jpeg"><br><br>  Si vous activez HTTPS ou TLS, utilisez mTLS, connectez l'authentification de base pour r√©duire davantage les risques, vous obtiendrez un canal de communication s√©curis√© Helm CLI et Chart Repo. <br><br><h3>  API gRPC </h3><br>  L'√©tape suivante est tr√®s responsable: s√©curiser Tiller, qui est dans le cluster et est, d'une part, le serveur, d'autre part, il acc√®de aux autres composants et essaie de se pr√©senter comme quelqu'un. <br><br>  Comme je l'ai dit, Tiller est un service qui expose gRPC, un client Helm y arrive via gRPC.  Par d√©faut, bien s√ªr, TLS est d√©sactiv√©.  Pourquoi cela se fait est une question discutable, il me semble simplifier la configuration au d√©part. <br><br><blockquote>  Pour la production et m√™me pour la mise en sc√®ne, je recommande d'activer TLS sur gRPC. </blockquote><br>  √Ä mon avis, contrairement √† mTLS pour les graphiques, cela est appropri√© ici et se fait tr√®s simplement - g√©n√©rer une infrastructure PQI, cr√©er un certificat, lancer Tiller, transf√©rer le certificat lors de l'initialisation.  Apr√®s cela, vous pouvez ex√©cuter toutes les commandes Helm, apparaissant comme un certificat g√©n√©r√© et une cl√© priv√©e. <br><br><img src="https://habrastorage.org/webt/tg/rp/lt/tgrpltlna0hqfdviwfffe4is9ym.jpeg"><br><br>  Ainsi, vous vous prot√©gerez de toutes les demandes adress√©es √† Tiller depuis l'ext√©rieur du cluster. <br><br>  Nous avons donc s√©curis√© le canal de connexion √† Tiller, d√©j√† discut√© de RBAC et ajust√© les droits de Kubernetes apiserver, r√©duit le domaine avec lequel il peut interagir. <br><br><h2>  Heaume prot√©g√© </h2><br>  Regardons le diagramme final.  Il s'agit de la m√™me architecture avec les m√™mes fl√®ches. <br><br><img src="https://habrastorage.org/webt/4h/j2/_7/4hj2_7hltplw1nsfktdw11dly4i.jpeg"><br><br>  Toutes les connexions peuvent d√©sormais √™tre peintes en vert en toute s√©curit√©: <br><br><ul><li>  pour Chart Repo, nous utilisons TLS ou mTLS et l'authentification de base; </li><li>  mTLS pour Tiller, et il est pr√©sent√© comme un service gRPC avec TLS, nous utilisons des certificats; </li><li>  le cluster utilise un compte de service sp√©cial avec Role et RoleBinding. </li></ul><br>  Nous avons nettement s√©curis√© le cluster, mais quelqu'un d'intelligent a d√©clar√©: <br><br><blockquote>  "Il ne peut y avoir qu'une seule solution absolument s√ªre - l'ordinateur est √©teint, qui est dans une bo√Æte en b√©ton et il est gard√© par des soldats." </blockquote><br>  Il existe diff√©rentes fa√ßons de manipuler les donn√©es et de trouver de nouveaux vecteurs d'attaque.  Cependant, je suis convaincu que ces recommandations permettront la mise en ≈ìuvre d'une norme de s√©curit√© industrielle de base. <br><br><h2>  Bonus </h2><br>  Cette partie n'est pas directement li√©e √† la s√©curit√©, mais elle sera √©galement utile.  Je vais vous montrer des choses int√©ressantes que peu de gens connaissent.  Par exemple, comment rechercher des graphiques - officiels et non officiels. <br><br>  Le r√©f√©rentiel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github.com/helm/charts</a> compte d√©sormais environ 300 graphiques et deux flux: stable et incubateur.  Le contributeur sait combien il est difficile de passer de l'incubateur √† l'√©curie et combien il est facile de sortir de l'√©curie.  Cependant, ce n'est pas le meilleur outil pour rechercher des graphiques pour Prometheus et tout ce que vous aimez pour une raison simple n'est pas un portail o√π il est pratique de rechercher des packages. <br><br>  Mais il existe un service <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hub.helm.sh</a> avec lequel il est beaucoup plus pratique de trouver des graphiques.  Plus important encore, il existe de nombreux autres r√©f√©rentiels externes et pr√®s de 800 caract√®res sont disponibles.  De plus, vous pouvez connecter votre r√©f√©rentiel si, pour une raison quelconque, vous ne souhaitez pas envoyer vos graphiques √† stable. <br><br>  Essayez hub.helm.sh et d√©veloppons-le ensemble.  Ce service est dans le cadre du projet Helm, et vous pouvez m√™me contribuer √† son interface utilisateur si vous √™tes un fournisseur frontal et que vous souhaitez simplement am√©liorer l'apparence. <br><br>  Je souhaite √©galement attirer votre attention sur l' <strong>int√©gration de l'API Open Service Broker</strong> .  Cela semble lourd et incompr√©hensible, mais cela r√©sout les probl√®mes auxquels tout le monde est confront√©.  Je vais vous expliquer avec un exemple simple. <br><br><img src="https://habrastorage.org/webt/sv/ry/gq/svrygqjzgdcxc_sf5rrrdc2b70g.jpeg"><br><br>  Il existe un cluster Kubernetes dans lequel nous voulons ex√©cuter l'application classique - WordPress.  En r√®gle g√©n√©rale, une base de donn√©es est n√©cessaire pour une fonctionnalit√© compl√®te.  Il existe de nombreuses solutions diff√©rentes, par exemple, vous pouvez d√©marrer votre service complet.  Ce n'est pas tr√®s pratique, mais beaucoup le font. <br><br>  D'autres, comme nous √† Chainstack, utilisent des bases de donn√©es g√©r√©es, telles que MySQL ou PostgreSQL, pour les serveurs.  Par cons√©quent, nos bases de donn√©es sont situ√©es quelque part dans le cloud. <br><br>  Mais un probl√®me se pose: vous devez connecter notre service √† la base de donn√©es, cr√©er une base de donn√©es de saveurs, transmettre les informations d'identification et les g√©rer d'une mani√®re ou d'une autre.  Tout cela est g√©n√©ralement effectu√© manuellement par l'administrateur syst√®me ou le d√©veloppeur.  Et il n'y a pas de probl√®me quand il y a peu d'applications.  Lorsqu'il y en a beaucoup, vous avez besoin d'une moissonneuse-batteuse.  Il existe une telle combinaison - c'est Service Broker.  Il vous permet d'utiliser un plug-in sp√©cial pour le cluster de cloud public et de commander des ressources aupr√®s du fournisseur via Broker, comme s'il s'agissait d'une API.  Pour cela, vous pouvez utiliser les outils natifs de Kubernetes. <br><br>  C'est tr√®s simple.  Vous pouvez interroger, par exemple, MySQL g√©r√© dans Azure avec un niveau de base (cela peut √™tre personnalis√©).  √Ä l'aide de l'API Azure, la base sera cr√©√©e et pr√©par√©e pour l'utilisation.  Vous n'avez pas besoin d'interf√©rer avec cela, le plugin en est responsable.  Par exemple, OSBA (plug-in Azure) renverra les informations d'identification au service, les transmettra √† Helm.  Vous pouvez utiliser WordPress avec MySQL nuageux, ne pas traiter du tout avec les bases de donn√©es g√©r√©es et ne vous inqui√©tez pas des services d'√âtat √† l'int√©rieur. <br><br><blockquote>  Nous pouvons dire que Helm agit comme une colle, qui d'une part vous permet de d√©ployer des services, et d'autre part, il consomme les ressources des fournisseurs de cloud. </blockquote><br>  Vous pouvez √©crire votre propre plugin et utiliser toute cette histoire sur site.  Ensuite, vous avez juste votre propre plugin pour le fournisseur de cloud d'entreprise.  Je vous conseille d'essayer cette approche, surtout si vous avez une grande √©chelle et que vous souhaitez d√©ployer rapidement le d√©veloppement, la mise en sc√®ne ou toute l'infrastructure pour une fonctionnalit√©.  Cela facilitera la vie de vos op√©rations ou DevOps. <br><br>  Une autre d√©couverte que j'ai d√©j√† mentionn√©e est le <strong>plugin helm-gcs</strong> , qui vous permet d'utiliser Google-buckets (stockage d'objets) pour stocker des graphiques Helm. <br><br><img src="https://habrastorage.org/webt/gp/id/ln/gpidlnzmqfrnh4kswxi9obliphk.jpeg"><br><br>  Il ne faut que quatre commandes pour commencer √† l'utiliser: <br><br><ol><li>  installez le plugin; </li><li>  l'initier; </li><li>  d√©finissez le chemin vers bucket, qui se trouve dans gcp; </li><li>  publier des graphiques de mani√®re standard. </li></ol><br>  La beaut√© est que la m√©thode native de gcp pour l'autorisation sera utilis√©e.  Vous pouvez utiliser un compte de service, un compte de d√©veloppeur - n'importe quoi.  Il est tr√®s pratique et ne co√ªte rien √† utiliser.  Si vous, comme moi, d√©fendez la philosophie opsless, cela sera tr√®s pratique, surtout pour les petites √©quipes. <br><br><h2>  Alternatives </h2><br>  Helm n'est pas la seule solution de gestion de services.  Il y a beaucoup de questions √† lui poser, c'est probablement pourquoi la troisi√®me version est apparue si rapidement.  Bien s√ªr, il existe des alternatives. <br><br>  Il peut s'agir de solutions sp√©cialis√©es, par exemple, Ksonnet ou Metaparticle.  Vous pouvez utiliser vos outils de gestion d'infrastructure classiques (Ansible, Terraform, Chef, etc.) aux m√™mes fins que celles dont j'ai parl√©. <br><br>  Enfin, la solution <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Operator Framework</a> , dont la popularit√© ne cesse de cro√Ætre. <br><br><blockquote>  L'op√©rateur Framework est la principale alternative de Helm √† laquelle vous devez faire attention. </blockquote><br>  Il est plus natif pour CNCF et Kubernetes, <strong>mais le seuil d'entr√©e est beaucoup plus √©lev√©</strong> , vous devez programmer plus et d√©crire moins les manifestes. <br><br>  Il existe diff√©rents addons, tels que Draft, Scaffold.  Ils simplifient consid√©rablement la vie, par exemple, les d√©veloppeurs simplifient le cycle d'envoi et de lancement de Helm pour d√©ployer un environnement de test.  Je les appellerais des prolongateurs d'opportunit√©s. <br><br>  Voici un graphique visuel de l'emplacement de ce qui se trouve. <br><br><img src="https://habrastorage.org/webt/x8/jl/f3/x8jlf3pejoqjp5b-lj9y2l9r6q0.jpeg"><br><br>  Sur l'axe des x, le niveau de votre contr√¥le personnel sur ce qui se passe, sur l'axe des y, le niveau de nativit√© de Kubernetes.  La version 2 de Helm se situe quelque part au milieu.  Dans la version 3, ce n'est pas colossal, mais le contr√¥le et le niveau de nativit√© sont am√©lior√©s.  Les solutions de niveau Ksonnet sont encore inf√©rieures m√™me √† Helm 2. Cependant, elles valent le coup d'≈ìil pour savoir ce qu'il y a d'autre dans ce monde.  Bien s√ªr, votre gestionnaire de configuration sera sous votre contr√¥le, mais absolument pas natif de Kubernetes. <br><br>  L'op√©rateur Framework est absolument natif de Kubernetes et vous permet de le g√©rer de mani√®re beaucoup plus √©l√©gante et m√©ticuleuse (mais n'oubliez pas le niveau d'entr√©e).  Au lieu de cela, il convient √† une application sp√©cialis√©e et √† la cr√©ation d'une gestion, plut√¥t qu'√† une r√©colteuse de masse pour emballer un grand nombre d'applications √† l'aide de Helm. <br><br>  Les extensions am√©liorent simplement un peu le contr√¥le, compl√®tent le flux de travail ou coupent les coins des pipelines CI / CD. <br><br><h2>  L'avenir de Helm </h2><br>  La bonne nouvelle est que Helm 3 est en train d'appara√Ætre. La version alpha de Helm 3.0.0-alpha.2 est d√©j√† sortie, vous pouvez essayer.  Il est assez stable, mais la fonctionnalit√© est encore limit√©e. <br><br>  Pourquoi avez-vous besoin de Helm 3?  Tout d'abord, c'est l'histoire de la <strong>disparition de Tiller</strong> , en tant que composant.  Comme vous le savez d√©j√†, c'est un grand pas en avant, car tout est simplifi√© du point de vue de la s√©curit√© architecturale. <br><br>  Lorsque Helm 2 a √©t√© cr√©√©, ce qui √©tait pendant Kubernetes 1.8 ou m√™me plus t√¥t, de nombreux concepts √©taient immatures.  Par exemple, le concept de CRD est activement mis en ≈ìuvre et Helm <strong>utilisera CRD</strong> pour stocker les structures.  Il sera possible d'utiliser uniquement le client et de ne pas garder le c√¥t√© serveur.  Par cons√©quent, utilisez les commandes natives de Kubernetes pour travailler avec les structures et les ressources.  C'est un √©norme pas en avant. <br><br>  <strong>La prise en charge des r√©f√©rentiels OCI natifs</strong> (Open Container Initiative) appara√Ætra.  Il s'agit d'une √©norme initiative, et Helm est surtout int√©ressant pour publier ses graphiques.  Il arrive au point que, par exemple, le Docker Hub prend en charge de nombreuses normes OCI.  Je ne me demande pas, mais peut-√™tre que les fournisseurs classiques de r√©f√©rentiels Docker commenceront √† vous donner la possibilit√© de placer leurs graphiques Helm pour vous. <br><br>  Une histoire controvers√©e pour moi est <strong>le soutien de Lua en</strong> tant que moteur de cr√©ation de mod√®les pour l'√©criture de scripts.  Je ne suis pas un grand fan de Lua, mais ce sera une fonctionnalit√© compl√®tement facultative.  Je l'ai v√©rifi√© 3 fois - l'utilisation de Lua ne sera pas n√©cessaire.  Par cons√©quent, toute personne qui veut pouvoir utiliser Lua, quelqu'un qui aime Go, rejoignez notre immense camp et utilisez go-tmpl pour cela. <br><br>  ,      ‚Äî  <strong>     </strong> .      int  string,        .  JSONS-,       values. <br><br>     <strong>event-driven model</strong> .    .    Helm 3,  ,         ,    ,   ,         . <br><br> Helm 3  ,     ,     Helm 2,    Kubernetes   . , Helm    Kubernetes        Kubernetes. <br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une autre bonne nouvelle est qu'√† la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DevOpsConf,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Alexander Khayorov </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dira </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">si les conteneurs peuvent √™tre s√ªrs? </font></a><font style="vertical-align: inherit;">Rappel, une conf√©rence sur l'int√©gration des processus de d√©veloppement, de test et d'exploitation se tiendra √† Moscou </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les 30 septembre et 1er octobre</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Jusqu'au 20 ao√ªt, vous pouvez toujours </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">soumettre un rapport</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et parler de votre exp√©rience dans la r√©solution de l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une des nombreuses</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> t√¢ches de l'approche DevOps. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suivez les points de contr√¥le et les actualit√©s de la conf√©rence dans la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">newsletter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cha√Æne de t√©l√©grammes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr462665/">https://habr.com/ru/post/fr462665/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr462655/index.html">Tapez enfin votre code</a></li>
<li><a href="../fr462657/index.html">Test et test du chargeur SkyRC B6 Nano</a></li>
<li><a href="../fr462659/index.html">Premiers pas avec PVS-Studio Static Analyzer pour le d√©veloppement C ++ sous Linux</a></li>
<li><a href="../fr462661/index.html">Connaissance de l'analyseur statique PVS-Studio lors du d√©veloppement de programmes C ++ sous Linux</a></li>
<li><a href="../fr462663/index.html">Natation, danse (!) Et rock: quelles activit√©s veulent absolument</a></li>
<li><a href="../fr462667/index.html">Galaxy Guide DevOpsConf 2019</a></li>
<li><a href="../fr462671/index.html">L'infrastructure de l'entreprise en tant que produit</a></li>
<li><a href="../fr462673/index.html">Pierre, ciseaux, papier, entretiens d'embauche, Spock</a></li>
<li><a href="../fr462675/index.html">D√©ception de l'information</a></li>
<li><a href="../fr462677/index.html">Vepp - nouveau panneau de contr√¥le de serveur et de site d'ISPsystem</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>