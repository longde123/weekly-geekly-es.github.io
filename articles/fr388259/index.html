<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê• üï∫ ‚ö´Ô∏è Vision du robot Raspberry Pi: carte de profondeur üôáüèæ üÖæÔ∏è üëêüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aujourd'hui, toute la technologie de ¬´construction de drones¬ª devient activement moins ch√®re. Sauf pour un: obtenir une carte de l'espace environnant....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Vision du robot Raspberry Pi: carte de profondeur</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/388259/"><img src="https://habrastorage.org/files/174/cb5/63e/174cb563ec424e5aabb4fc27afb4ad23.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aujourd'hui, toute la technologie de ¬´construction de drones¬ª devient activement moins ch√®re. </font><font style="vertical-align: inherit;">Sauf pour un: obtenir une carte de l'espace environnant. </font><font style="vertical-align: inherit;">Il y a deux extr√™mes: soit des lidars co√ªteux (milliers de dollars) et des solutions optiques pour construire une carte de profondeur (plusieurs centaines de dollars), soit des solutions assez penny comme les t√©l√©m√®tres √† ultrasons. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, une id√©e a surgi sur la base d'un Raspberry Pi bon march√© avec une cam√©ra pour faire une solution qui serait dans une niche vide et vous permettrait d'obtenir une carte de profondeur "pour peu co√ªteux". </font><font style="vertical-align: inherit;">Et pour ce faire dans un langage de programmation simple tel que Python, afin qu'il soit disponible pour les d√©butants √† exp√©rimenter. </font><font style="vertical-align: inherit;">En fait, je voulais parler de mes r√©sultats. </font><font style="vertical-align: inherit;">Les scripts r√©sultants avec des exemples de photos peuvent √©galement √™tre ex√©cut√©s sur le bureau.</font></font><br>
<br>
<a name="habracut"></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Carte de profondeur d'une cam√©ra.</font></font></h1><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, quelques mots sur la partie optique. Deux images sont toujours utilis√©es pour construire une carte de profondeur - √† partir des cam√©ras gauche et droite. Et nous avons des framboises avec une seule cam√©ra. Par cons√©quent, un s√©parateur optique a √©t√© d√©velopp√©, qui donne en cons√©quence une paire st√©r√©o √† la cam√©ra. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En termes simples - si vous regardez la photo, √† partir de la bo√Æte noire, deux yeux de l'appareil photo vous regardent. Mais en r√©alit√©, la cam√©ra en est une. Juste un peu de magie optique.</font></font><br>
<br>
<img src="https://habrastorage.org/files/5b0/c19/5f5/5b0c195f51cb4550b910a49f925b0389.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La photo montre la douzi√®me it√©ration de l'appareil. </font><font style="vertical-align: inherit;">Il a fallu beaucoup de temps pour obtenir une conception stable et fiable, qui en m√™me temps serait peu co√ªteuse. </font><font style="vertical-align: inherit;">La partie la plus difficile est les miroirs internes, qui ont √©t√© fabriqu√©s sur commande par d√©p√¥t d'aluminium sous vide. </font><font style="vertical-align: inherit;">Si vous utilisez des miroirs standard, dans lesquels la couche r√©fl√©chissante est situ√©e sous le verre et non au-dessus, alors √† la jonction, ils forment un espace qui g√¢che radicalement l'image enti√®re.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sur quoi allons-nous travailler</font></font></h1><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'image de framboise de Raspbian Wheezy a √©t√© prise comme base, Python 2.7 et OpenCV 2.4 ont √©t√© install√©s, ainsi, les packages requis pour les petites choses - matplotlib, numpy et autres. </font><font style="vertical-align: inherit;">Toutes sortes et un lien vers l'image finie de la carte sont dispos√©s √† la fin de l'article. </font><font style="vertical-align: inherit;">La description des scripts sous forme de le√ßons est disponible sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le site web du projet</font></font></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pr√©parer une image pour construire une carte de profondeur</font></font></h1><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre solution n'√©tant pas en m√©tal et sans optique ultra-pr√©cise, de petits √©carts par rapport √† la g√©om√©trie id√©ale sont possibles du fait de l'assemblage. </font><font style="vertical-align: inherit;">De plus, la cam√©ra est fix√©e √† l'appareil avec des vis, de sorte que sa position peut ne pas √™tre id√©ale. </font><font style="vertical-align: inherit;">Le probl√®me avec l'emplacement de la cam√©ra est r√©solu manuellement, et la compensation de la "courbure" de l'assemblage de la structure se fera par logiciel.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script One - Alignement de la cam√©ra</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La jonction des miroirs dans l'image devrait id√©alement √™tre verticale et centr√©e. </font><font style="vertical-align: inherit;">C'est difficile √† faire √† l'≈ìil nu, donc le premier script a √©t√© fait. </font><font style="vertical-align: inherit;">Il capture simplement l'image de l'appareil photo en mode d'aper√ßu en direct, l'affiche √† l'√©cran et au centre en superposition dessine une bande blanche le long de laquelle l'alignement a lieu. </font><font style="vertical-align: inherit;">Une fois que la cam√©ra est correctement orient√©e, nous resserrons les vis et l'assemblage est termin√©.</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/Kjx__P1AhKY%3Ffeature%3Doembed&amp;usg=ALkJrhgJJRU60FCh5fD517zqYjtZf5Xt8A" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce qui est int√©ressant dans le code du premier script</font></font></b><div class="spoiler_text"><ul>
<li>    ‚Äì <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a></li>
<li>           ‚Äì        ,       cv.imshow()      ,    .       ,     .   ,   ,       .</li>
<li>  ‚Äì         , ..     .   ¬´¬ª  ,  camera.hflip = True</li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le deuxi√®me script - nous obtenons une paire st√©r√©o "propre"</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos images gauche et droite sont jointes au centre de l'image. </font><font style="vertical-align: inherit;">Le joint sur la photo a une largeur non nulle - vous ne pouvez vous en d√©barrasser qu'en retirant les miroirs de l'appareil, ce qui augmente la taille de la structure. </font><font style="vertical-align: inherit;">La cam√©ra de la framboise a une mise au point d√©finie sur l'infini, et les objets proches (dans notre cas, c'est une jonction) ¬´flouent¬ª simplement. </font><font style="vertical-align: inherit;">Par cons√©quent, il vous suffit d'indiquer le script, qui, √† notre avis, est une ¬´mauvaise¬ª zone, de sorte que la paire st√©r√©o soit nette en images. </font><font style="vertical-align: inherit;">Un deuxi√®me script a √©t√© cr√©√© qui affiche une image et vous permet d'utiliser les touches pour indiquer la zone √† couper. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici √† quoi ressemble le processus:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/4eCGq_mEot8%3Ffeature%3Doembed&amp;usg=ALkJrhhsELZx_otcbFrxpw3ooVYvRo2_bQ" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce qui est int√©ressant dans le code du deuxi√®me script</font></font></b><div class="spoiler_text"><ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a></li>
<li> ,  ,     cv2.rectangle().   ,          ,       .  , ,    Enter     .</li>
<li>   ,         .           ,        .</li>
<li>         JSON.    ,   ,      .</li>
<li>   . ,     ,        ,      .       ,      ./src          .        .     pf_1280_720.txt ‚Äì       ,     .</li>
<li>           ,       .             .       :<br>
<pre><code class="python hljs">loadImagePath = <span class="hljs-string"><span class="hljs-string">""</span></span>
<span class="hljs-comment"><span class="hljs-comment"># loadImagePath = "./src/scene_1280x720_1.png"</span></span></code></pre></li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le troisi√®me script - une s√©rie de photos pour l'√©talonnage</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La science fondamentale dit que pour r√©ussir √† construire une carte de profondeur, la paire st√©r√©o doit √™tre calibr√©e. √Ä savoir, tous les points cl√©s de l'image de gauche doivent √™tre √† la m√™me hauteur et dans l'image de droite. Dans cette situation, la fonction StereoBM, qui est notre seul temps r√©el, peut r√©ussir son travail. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour l'√©talonnage, nous devons imprimer une image de r√©f√©rence, faire une s√©rie de photos et la donner √† l'algorithme d'√©talonnage, qui calculera toutes les distorsions et enregistrera les param√®tres pour ramener les images √† la normale. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alors, imprimez ¬´l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©chiquier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬ª et collez-le sur une surface plane et dure. Pour plus de simplicit√©, la photo de s√©rie a √©t√© r√©alis√©e sous la forme d'un script avec un compte √† rebours, qui s'affiche en haut de la vid√©o. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici √† quoi ressemble le script de photographie en s√©rie au travail:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/3COWaa2dW8s%3Ffeature%3Doembed&amp;usg=ALkJrhjj5F3TgloCtDnRzO6XRLAuQz5gGA" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce qui est int√©ressant dans le 3e code de script</font></font></b><div class="spoiler_text"><ul>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a></li>
<li>   . ,         . ,     ,   ¬´¬ª  .   ,          ‚Äì      ,     .          camera.capture ()  ,   use_video_port=True.</li>
<li>       ‚Äì   camera.annotate_text()          .     5  ‚Äì           .</li>
<li>-,             ,          ./src</li>
</ul><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il convient de noter que la ¬´justesse¬ª de la s√©rie r√©alis√©e est critique pour les r√©sultats d'√©talonnage. </font><font style="vertical-align: inherit;">Un peu plus tard, nous examinerons le r√©sultat obtenu avec des photographies mal prises.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script 4 - couper des photos sur des paires st√©r√©o</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s qu'une s√©rie de photos a √©t√© prise, nous allons cr√©er un autre script de service qui prend toute la s√©rie de photos prises et les coupe en paires d'images - gauche et droite, et enregistre les paires dans un dossier. zones au centre de l'image. </font><font style="vertical-align: inherit;">Le script est assez ordinaire, donc j'ai cach√© la vid√©o sous un spoiler.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un exemple de travail et un lien vers les sources du 4√®me script</font></font></b><div class="spoiler_text"><ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4- </a></li>
<li>    :<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/NvzUPVe2qvo%3Ffeature%3Doembed&amp;usg=ALkJrhiSBQPzYZi6gk9co7czXd_lrBmXXg" frameborder="0" allowfullscreen=""></iframe></li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La chose la plus int√©ressante est l'√©talonnage, le cinqui√®me script </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le script d'√©talonnage alimente toutes les paires st√©r√©o du dossier ./src vers la fonction d'√©talonnage et plonge dans la pens√©e. </font><font style="vertical-align: inherit;">Apr√®s son travail difficile (pour 15 images 1280x720 sur la premi√®re framboise cela prend environ 5 minutes), il prend la derni√®re paire st√©r√©o, "corrige" les images (rectifie) et montre des versions d√©j√† corrig√©es par lesquelles vous pouvez construire une carte de profondeur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici √† quoi ressemble le script au travail:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/mktMyDSskRM%3Ffeature%3Doembed&amp;usg=ALkJrhiZIXdmiPEl2wO6MXQ2NFGNJ2BduA" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce qui est int√©ressant dans le code du 5√®me script</font></font></b><div class="spoiler_text"><ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a></li>
<li>     StereoVision. ,       ,       ,         ¬´¬ª .</li>
<li>                ,     .    .     ¬´¬ª ,    ,   </li>
<li><pre><code class="python hljs">calibrator.add_corners((imgLeft, imgRight), <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code></pre>  True  False ‚Äì    ,    .</li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Quelque chose s'est mal pass√©."</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a des moments o√π les r√©sultats d'√©talonnage sont inattendus. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici quelques exemples frappants: </font></font><br>
<br>
<img src="https://habrastorage.org/files/ff2/0f1/11f/ff20f111fa8e4a59a068fb054bc13831.jpg" alt="Mauvaise carte de disparit√©"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, l'√©talonnage est un moment d√©terminant. </font><font style="vertical-align: inherit;">Ce que nous obtenons au stade de la construction d'une carte de profondeur d√©pend directement de sa qualit√©. </font><font style="vertical-align: inherit;">Apr√®s un grand nombre d'exp√©riences, la liste suivante des exigences de prise de vue se profile:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'image d'√©checs </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> doit </font><b><font style="vertical-align: inherit;">pas</font></b><font style="vertical-align: inherit;"> √™tre parall√®le au plan de la photo - toujours sous des angles diff√©rents. </font><font style="vertical-align: inherit;">Mais m√™me sans fanatisme - si vous tenez le tableau presque perpendiculaire au plan de la photo, le script ne trouvera tout simplement pas les √©checs dans l'image.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lumi√®re, bonne lumi√®re. </font><font style="vertical-align: inherit;">En cas de faible √©clairage de la pi√®ce, et m√™me lorsque vous retirez des images de la vid√©o, la qualit√© de l'image diminue. </font><font style="vertical-align: inherit;">Dans mon cas, la lumi√®re dans 90% des cas a imm√©diatement corrig√© la situation.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âcrivez sur Internet que la carte doit occuper autant que possible l'espace maximum dans l'image. </font><font style="vertical-align: inherit;">Aide vraiment.</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici √† quoi ressemble une paire st√©r√©o ¬´fixe¬ª avec de bons r√©sultats d'√©talonnage:</font></font><br>
<br>
<img src="https://habrastorage.org/files/b1a/080/c51/b1a080c51edc481685ad2ec4c266791f.jpg" alt="image"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script 6 - la premi√®re tentative de construction d'une carte de profondeur</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme tout est pr√™t, vous pouvez d√©j√† cr√©er une carte de profondeur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous </font><font style="vertical-align: inherit;">chargeons les r√©sultats de l'√©talonnage, prenons une photo et construisons audacieusement une carte de profondeur en utilisant cv2.StereoBM </font><font style="vertical-align: inherit;">Nous </font><font style="vertical-align: inherit;">obtenons </font><font style="vertical-align: inherit;">quelque chose comme ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/files/038/1a8/87f/0381a887fa0c4e1eac31f2e810b0ee78.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le r√©sultat n'est pas tr√®s impressionnant, √©videmment nous devons resserrer quelque chose. </font><font style="vertical-align: inherit;">Eh bien, passons √† un r√©glage plus fin dans le prochain, 7√®me script. </font><font style="vertical-align: inherit;">L√†, nous n'utiliserons pas 10 param√®tres pour la construction, comme dans StereoBM (), mais presque 10, ce qui est beaucoup plus int√©ressant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici les sources </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">du 6√®me script</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Script 7 - carte de profondeur avec param√®tres avanc√©s </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque les param√®tres ne sont pas 2 mais 10, le tri de leurs options avec un red√©marrage constant des scripts est incorrect. </font><font style="vertical-align: inherit;">Par cons√©quent, un script a √©t√© cr√©√© pour un r√©glage interactif pratique de la carte de profondeur. </font><font style="vertical-align: inherit;">La t√¢che n'√©tait pas de compliquer le code avec l'interface, donc tout a √©t√© fait sur matplotlib. </font><font style="vertical-align: inherit;">Le dessin de l'interface dans matplotlib sur les framboises est assez lent, donc je transf√®re g√©n√©ralement le dossier de travail des framboises √† l'ordinateur portable et s√©lectionne les param√®tres l√†-bas. </font><font style="vertical-align: inherit;">Voici comment fonctionne le script:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/cNpMje5AKTQ%3Ffeature%3Doembed&amp;usg=ALkJrhieZlzfj1k3ZD16HyoD79HwqQ13BA" frameborder="0" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir s√©lectionn√© les param√®tres, le script par le bouton Enregistrer enregistre le r√©sultat dans le fichier 3dmap_set.txt au format JSON.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce qui est int√©ressant dans le code du 7√®me script</font></font></b><div class="spoiler_text"><ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">7- </a></li>
<li>       . ,   -     ,        .</li>
<li>   ,         . , numOfDisparities    16,            .           update(val),            .   numOfDisparities    65.57     64.         ,            .</li>
<li>      matplotlib       ,     .</li>
</ul><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un travail pratique avec la carte de profondeur a montr√© que, tout d'abord, vous devez s√©lectionner le param√®tre minDisparity, et conjointement avec numOfDisparities. </font><font style="vertical-align: inherit;">Eh bien, rappelez-vous que numOfDisparities change en fait discr√®tement, √† l'√©tape 16. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir configur√© cette paire, vous pouvez jouer avec d'autres param√®tres. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les caract√©ristiques des param√®tres de la carte d√©pendent d√©j√† du go√ªt de l'utilisateur et d√©pendent de la t√¢che √† r√©soudre. </font><font style="vertical-align: inherit;">Vous pouvez apporter la carte √† un grand nombre de petites parties ou afficher des zones agrandies. </font><font style="vertical-align: inherit;">Pour un simple √©vitement d'obstacles par des robots, le second est plus adapt√©. </font><font style="vertical-align: inherit;">Pour un nuage de points, le premier, mais des probl√®mes de performances se posent ici (nous y reviendrons).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que voulons-nous voir?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, l'un des points les plus importants est peut-√™tre le r√©glage de la "clairvoyance" de notre appareil. </font><font style="vertical-align: inherit;">Lors de la configuration de la carte de profondeur, je place g√©n√©ralement un objet √† une distance d'environ 30 cm, le second sur un m√®tre et le reste sur deux m√®tres. </font><font style="vertical-align: inherit;">Et lors de la configuration des deux premiers param√®tres (minDisparity et numOfDisparities) dans le 7e script, j'obtiens ce qui suit:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objet le plus proche (30 cm) - rouge</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objet dans un demi-m√®tre - jaune ou vert</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objets 2-3 m√®tres - vert ou bleu clair</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cons√©quence, nous obtenons un syst√®me configur√© pour reconna√Ætre la zone ¬´proche¬ª d'obstacles dans un rayon de 5 √† 10 m√®tres.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travailler avec la vid√©o √† la vol√©e - script 8th, final</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, nous avons maintenant un syst√®me personnalis√© pr√™t √† l'emploi et nous devons obtenir un r√©sultat pratique. </font><font style="vertical-align: inherit;">Nous essayons de construire une carte de profondeur en temps r√©el en utilisant la vid√©o de notre cam√©ra et de la montrer en temps r√©el lors de sa mise √† jour.</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/-qTayRg8skA%3Ffeature%3Doembed&amp;usg=ALkJrhjofF7-ZVmLJiXsIkwtIQ-qQsUIAg" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce qui est int√©ressant dans le code du 8√®me script</font></font></b><div class="spoiler_text">  ‚Äì   .   ,     ,        overlay.      ,  :<br>
<br>
<ul>
<li>Overlay        R, G  B,      -   .    grayscale   </li>
<li><pre><code class="python hljs">disparity_color = cv2.applyColorMap(disparity_grayscale, cv2.COLORMAP_JET)</code></pre></li>
<li>  overlay    RGB,     BGR ‚Äì        cv2.cvtColor()</li>
<li>Overlay      16.     16 ‚Äî    .</li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans la course √† la vitesse</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, la premi√®re mesure a √©t√© effectu√©e sur le premier Raspberry avec un processeur monoc≈ìur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 secondes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - construire une carte sur l'image de 1280x720 C'est beaucoup. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,5 secondes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - sur le Raspberry Pi 2, d√©j√† mieux. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'analyse a montr√© que dans ce cas, un seul noyau est utilis√© sur la deuxi√®me framboise. Mess! J'ai reconstruit OpenCV en utilisant la biblioth√®que de parall√©lisation TBB. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,5 seconde</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - lancement sur la deuxi√®me framboise en utilisant le multic≈ìur. En fait, il s'est av√©r√© que seuls 2 c≈ìurs sont utilis√©s - cela doit encore √™tre bricol√©. Il s'est av√©r√© que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">non seulement j'ai</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> rencontr√© ce probl√®me </font><font style="vertical-align: inherit;">, donc il y a encore de la place pour bouger.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A en juger par l'algorithme, la vitesse de fonctionnement devrait d√©pendre lin√©airement de la taille des donn√©es trait√©es. </font><font style="vertical-align: inherit;">Par cons√©quent, si vous r√©duisez la r√©solution de 2 fois, tout devrait th√©oriquement fonctionner 4 fois plus rapidement. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,3 seconde</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , soit environ 3-4 FPS - avec une r√©solution semi-r√©duite de 640x360. </font><font style="vertical-align: inherit;">La th√©orie a √©t√© confirm√©e.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plans futurs</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, je voulais tirer le meilleur parti du multic≈ìur de la deuxi√®me framboise. </font><font style="vertical-align: inherit;">Je vais regarder de plus pr√®s les sources de la fonction StereoBM et essayer de comprendre pourquoi le travail ne va pas jusqu'au bout. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La prochaine √©tape promet beaucoup plus d'aventures - c'est l'utilisation du GPU framboises pour acc√©l√©rer les calculs. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trois chemins possibles sont trac√©s ici:</font></font><br>
<br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>      GPU,     10 FPS,      .     ‚Äî  ,     ¬´ ¬ª   OpenCV,    .</li>
<li>        Koichi Nakamura,    GPU    ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a>.  ,     -  OpenCV,     . </li>
<li>              Jan Newmarch "<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Programming AudioVideo on the Raspberry Pi GPU</a>" </li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous aviez de l'exp√©rience avec TBB pour Raspberry OpenCV, ou si vous vous occupiez du codage pour les GPU framboise, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">je vous serais reconnaissant pour des conseils suppl√©mentaires</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">J'ai r√©ussi √† trouver un certain nombre de d√©veloppements pr√™ts √† l'emploi pour une raison simple - les framboises avec deux cam√©ras sont rares. </font><font style="vertical-align: inherit;">Si vous connectez deux webcams via USB, de gros freins viennent, et seul le Raspberry Pi Compute peut fonctionner avec deux cam√©ras natives, qui ont √©galement besoin d'un devboard lourd avec des lacets et des adaptateurs.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liens utiles:</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Scripts de travail:</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sources des</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8 scripts sur github</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Image de la carte ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,6 Go dans les archives</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Configuration d'OpenCV et de Python sur les framboises:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grand blog "python-OpenCV-shnik" et un manuel </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour configurer Python et OpenCV sur les framboises</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Biblioth√®que StereoVision:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ma </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">fourchette de</font></a><font style="vertical-align: inherit;"> travail </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur github</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Original par Egret </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur le github</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description de l'auteur de StereoVision sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">son blog</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Travail GPU</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liebits</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> japonais Koichi Nakamura </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">sur github</font></a><font style="vertical-align: inherit;"> - assembleur pour python pour GPU</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Livre de Jan Newmarch " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programmation audio vid√©o sur le GPU Raspberry Pi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous avez besoin de travailler avec un appareil photo framboise Like a Boss: </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">documentation</font></a></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Picamera</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, un article int√©ressant sur le habr sur " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour reconna√Ætre les images, vous n'avez pas besoin de reconna√Ætre les images</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr388259/">https://habr.com/ru/post/fr388259/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr388243/index.html">Surveillance √† domicile et visualisation √† distance sur Internet</a></li>
<li><a href="../fr388245/index.html">Le premier t√©l√©phone modulaire est en vente</a></li>
<li><a href="../fr388247/index.html">Cassini a vol√© √† c√¥t√© d'Encelade pour la derni√®re fois</a></li>
<li><a href="../fr388253/index.html">En 2015, le Costa Rica a re√ßu environ 99% de son √©lectricit√© √† partir de sources renouvelables.</a></li>
<li><a href="../fr388257/index.html">Poudre DIY pour lave-vaisselle: nous d√©montons les produits industriels et am√©liorons la recette</a></li>
<li><a href="../fr388261/index.html">M√©moires d'un robot subhumain, chapitres 3-4</a></li>
<li><a href="../fr388263/index.html">Id√©es fausses sur l'univers [Voiceover Vert Dider]</a></li>
<li><a href="../fr388265/index.html">Modem Wi-Fi pour Commodore - √† quoi ressemble-t-il?</a></li>
<li><a href="../fr388267/index.html">Nous volons et nous asseyons avec le Falcon 9R</a></li>
<li><a href="../fr388271/index.html">Kruglendar 2016 - affiche de journal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>