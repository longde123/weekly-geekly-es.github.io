<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐥 🕺 ⚫️ Vision du robot Raspberry Pi: carte de profondeur 🙇🏾 🅾️ 👐🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aujourd'hui, toute la technologie de «construction de drones» devient activement moins chère. Sauf pour un: obtenir une carte de l'espace environnant....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Vision du robot Raspberry Pi: carte de profondeur</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/388259/"><img src="https://habrastorage.org/files/174/cb5/63e/174cb563ec424e5aabb4fc27afb4ad23.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aujourd'hui, toute la technologie de «construction de drones» devient activement moins chère. </font><font style="vertical-align: inherit;">Sauf pour un: obtenir une carte de l'espace environnant. </font><font style="vertical-align: inherit;">Il y a deux extrêmes: soit des lidars coûteux (milliers de dollars) et des solutions optiques pour construire une carte de profondeur (plusieurs centaines de dollars), soit des solutions assez penny comme les télémètres à ultrasons. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par conséquent, une idée a surgi sur la base d'un Raspberry Pi bon marché avec une caméra pour faire une solution qui serait dans une niche vide et vous permettrait d'obtenir une carte de profondeur "pour peu coûteux". </font><font style="vertical-align: inherit;">Et pour ce faire dans un langage de programmation simple tel que Python, afin qu'il soit disponible pour les débutants à expérimenter. </font><font style="vertical-align: inherit;">En fait, je voulais parler de mes résultats. </font><font style="vertical-align: inherit;">Les scripts résultants avec des exemples de photos peuvent également être exécutés sur le bureau.</font></font><br>
<br>
<a name="habracut"></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Carte de profondeur d'une caméra.</font></font></h1><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, quelques mots sur la partie optique. Deux images sont toujours utilisées pour construire une carte de profondeur - à partir des caméras gauche et droite. Et nous avons des framboises avec une seule caméra. Par conséquent, un séparateur optique a été développé, qui donne en conséquence une paire stéréo à la caméra. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En termes simples - si vous regardez la photo, à partir de la boîte noire, deux yeux de l'appareil photo vous regardent. Mais en réalité, la caméra en est une. Juste un peu de magie optique.</font></font><br>
<br>
<img src="https://habrastorage.org/files/5b0/c19/5f5/5b0c195f51cb4550b910a49f925b0389.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La photo montre la douzième itération de l'appareil. </font><font style="vertical-align: inherit;">Il a fallu beaucoup de temps pour obtenir une conception stable et fiable, qui en même temps serait peu coûteuse. </font><font style="vertical-align: inherit;">La partie la plus difficile est les miroirs internes, qui ont été fabriqués sur commande par dépôt d'aluminium sous vide. </font><font style="vertical-align: inherit;">Si vous utilisez des miroirs standard, dans lesquels la couche réfléchissante est située sous le verre et non au-dessus, alors à la jonction, ils forment un espace qui gâche radicalement l'image entière.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sur quoi allons-nous travailler</font></font></h1><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'image de framboise de Raspbian Wheezy a été prise comme base, Python 2.7 et OpenCV 2.4 ont été installés, ainsi, les packages requis pour les petites choses - matplotlib, numpy et autres. </font><font style="vertical-align: inherit;">Toutes sortes et un lien vers l'image finie de la carte sont disposés à la fin de l'article. </font><font style="vertical-align: inherit;">La description des scripts sous forme de leçons est disponible sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le site web du projet</font></font></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Préparer une image pour construire une carte de profondeur</font></font></h1><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre solution n'étant pas en métal et sans optique ultra-précise, de petits écarts par rapport à la géométrie idéale sont possibles du fait de l'assemblage. </font><font style="vertical-align: inherit;">De plus, la caméra est fixée à l'appareil avec des vis, de sorte que sa position peut ne pas être idéale. </font><font style="vertical-align: inherit;">Le problème avec l'emplacement de la caméra est résolu manuellement, et la compensation de la "courbure" de l'assemblage de la structure se fera par logiciel.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script One - Alignement de la caméra</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La jonction des miroirs dans l'image devrait idéalement être verticale et centrée. </font><font style="vertical-align: inherit;">C'est difficile à faire à l'œil nu, donc le premier script a été fait. </font><font style="vertical-align: inherit;">Il capture simplement l'image de l'appareil photo en mode d'aperçu en direct, l'affiche à l'écran et au centre en superposition dessine une bande blanche le long de laquelle l'alignement a lieu. </font><font style="vertical-align: inherit;">Une fois que la caméra est correctement orientée, nous resserrons les vis et l'assemblage est terminé.</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/Kjx__P1AhKY%3Ffeature%3Doembed&amp;usg=ALkJrhgJJRU60FCh5fD517zqYjtZf5Xt8A" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce qui est intéressant dans le code du premier script</font></font></b><div class="spoiler_text"><ul>
<li>    – <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a></li>
<li>           –        ,       cv.imshow()      ,    .       ,     .   ,   ,       .</li>
<li>  –         , ..     .   «»  ,  camera.hflip = True</li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le deuxième script - nous obtenons une paire stéréo "propre"</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos images gauche et droite sont jointes au centre de l'image. </font><font style="vertical-align: inherit;">Le joint sur la photo a une largeur non nulle - vous ne pouvez vous en débarrasser qu'en retirant les miroirs de l'appareil, ce qui augmente la taille de la structure. </font><font style="vertical-align: inherit;">La caméra de la framboise a une mise au point définie sur l'infini, et les objets proches (dans notre cas, c'est une jonction) «flouent» simplement. </font><font style="vertical-align: inherit;">Par conséquent, il vous suffit d'indiquer le script, qui, à notre avis, est une «mauvaise» zone, de sorte que la paire stéréo soit nette en images. </font><font style="vertical-align: inherit;">Un deuxième script a été créé qui affiche une image et vous permet d'utiliser les touches pour indiquer la zone à couper. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici à quoi ressemble le processus:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/4eCGq_mEot8%3Ffeature%3Doembed&amp;usg=ALkJrhhsELZx_otcbFrxpw3ooVYvRo2_bQ" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce qui est intéressant dans le code du deuxième script</font></font></b><div class="spoiler_text"><ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a></li>
<li> ,  ,     cv2.rectangle().   ,          ,       .  , ,    Enter     .</li>
<li>   ,         .           ,        .</li>
<li>         JSON.    ,   ,      .</li>
<li>   . ,     ,        ,      .       ,      ./src          .        .     pf_1280_720.txt –       ,     .</li>
<li>           ,       .             .       :<br>
<pre><code class="python hljs">loadImagePath = <span class="hljs-string"><span class="hljs-string">""</span></span>
<span class="hljs-comment"><span class="hljs-comment"># loadImagePath = "./src/scene_1280x720_1.png"</span></span></code></pre></li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le troisième script - une série de photos pour l'étalonnage</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La science fondamentale dit que pour réussir à construire une carte de profondeur, la paire stéréo doit être calibrée. À savoir, tous les points clés de l'image de gauche doivent être à la même hauteur et dans l'image de droite. Dans cette situation, la fonction StereoBM, qui est notre seul temps réel, peut réussir son travail. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour l'étalonnage, nous devons imprimer une image de référence, faire une série de photos et la donner à l'algorithme d'étalonnage, qui calculera toutes les distorsions et enregistrera les paramètres pour ramener les images à la normale. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alors, imprimez «l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">échiquier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> » et collez-le sur une surface plane et dure. Pour plus de simplicité, la photo de série a été réalisée sous la forme d'un script avec un compte à rebours, qui s'affiche en haut de la vidéo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici à quoi ressemble le script de photographie en série au travail:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/3COWaa2dW8s%3Ffeature%3Doembed&amp;usg=ALkJrhjj5F3TgloCtDnRzO6XRLAuQz5gGA" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce qui est intéressant dans le 3e code de script</font></font></b><div class="spoiler_text"><ul>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a></li>
<li>   . ,         . ,     ,   «»  .   ,          –      ,     .          camera.capture ()  ,   use_video_port=True.</li>
<li>       –   camera.annotate_text()          .     5  –           .</li>
<li>-,             ,          ./src</li>
</ul><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il convient de noter que la «justesse» de la série réalisée est critique pour les résultats d'étalonnage. </font><font style="vertical-align: inherit;">Un peu plus tard, nous examinerons le résultat obtenu avec des photographies mal prises.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script 4 - couper des photos sur des paires stéréo</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après qu'une série de photos a été prise, nous allons créer un autre script de service qui prend toute la série de photos prises et les coupe en paires d'images - gauche et droite, et enregistre les paires dans un dossier. zones au centre de l'image. </font><font style="vertical-align: inherit;">Le script est assez ordinaire, donc j'ai caché la vidéo sous un spoiler.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un exemple de travail et un lien vers les sources du 4ème script</font></font></b><div class="spoiler_text"><ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4- </a></li>
<li>    :<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/NvzUPVe2qvo%3Ffeature%3Doembed&amp;usg=ALkJrhiSBQPzYZi6gk9co7czXd_lrBmXXg" frameborder="0" allowfullscreen=""></iframe></li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La chose la plus intéressante est l'étalonnage, le cinquième script </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le script d'étalonnage alimente toutes les paires stéréo du dossier ./src vers la fonction d'étalonnage et plonge dans la pensée. </font><font style="vertical-align: inherit;">Après son travail difficile (pour 15 images 1280x720 sur la première framboise cela prend environ 5 minutes), il prend la dernière paire stéréo, "corrige" les images (rectifie) et montre des versions déjà corrigées par lesquelles vous pouvez construire une carte de profondeur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici à quoi ressemble le script au travail:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/mktMyDSskRM%3Ffeature%3Doembed&amp;usg=ALkJrhiZIXdmiPEl2wO6MXQ2NFGNJ2BduA" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce qui est intéressant dans le code du 5ème script</font></font></b><div class="spoiler_text"><ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a></li>
<li>     StereoVision. ,       ,       ,         «» .</li>
<li>                ,     .    .     «» ,    ,   </li>
<li><pre><code class="python hljs">calibrator.add_corners((imgLeft, imgRight), <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code></pre>  True  False –    ,    .</li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Quelque chose s'est mal passé."</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a des moments où les résultats d'étalonnage sont inattendus. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici quelques exemples frappants: </font></font><br>
<br>
<img src="https://habrastorage.org/files/ff2/0f1/11f/ff20f111fa8e4a59a068fb054bc13831.jpg" alt="Mauvaise carte de disparité"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, l'étalonnage est un moment déterminant. </font><font style="vertical-align: inherit;">Ce que nous obtenons au stade de la construction d'une carte de profondeur dépend directement de sa qualité. </font><font style="vertical-align: inherit;">Après un grand nombre d'expériences, la liste suivante des exigences de prise de vue se profile:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'image d'échecs </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> doit </font><b><font style="vertical-align: inherit;">pas</font></b><font style="vertical-align: inherit;"> être parallèle au plan de la photo - toujours sous des angles différents. </font><font style="vertical-align: inherit;">Mais même sans fanatisme - si vous tenez le tableau presque perpendiculaire au plan de la photo, le script ne trouvera tout simplement pas les échecs dans l'image.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lumière, bonne lumière. </font><font style="vertical-align: inherit;">En cas de faible éclairage de la pièce, et même lorsque vous retirez des images de la vidéo, la qualité de l'image diminue. </font><font style="vertical-align: inherit;">Dans mon cas, la lumière dans 90% des cas a immédiatement corrigé la situation.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Écrivez sur Internet que la carte doit occuper autant que possible l'espace maximum dans l'image. </font><font style="vertical-align: inherit;">Aide vraiment.</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici à quoi ressemble une paire stéréo «fixe» avec de bons résultats d'étalonnage:</font></font><br>
<br>
<img src="https://habrastorage.org/files/b1a/080/c51/b1a080c51edc481685ad2ec4c266791f.jpg" alt="image"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script 6 - la première tentative de construction d'une carte de profondeur</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme tout est prêt, vous pouvez déjà créer une carte de profondeur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous </font><font style="vertical-align: inherit;">chargeons les résultats de l'étalonnage, prenons une photo et construisons audacieusement une carte de profondeur en utilisant cv2.StereoBM </font><font style="vertical-align: inherit;">Nous </font><font style="vertical-align: inherit;">obtenons </font><font style="vertical-align: inherit;">quelque chose comme ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/files/038/1a8/87f/0381a887fa0c4e1eac31f2e810b0ee78.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le résultat n'est pas très impressionnant, évidemment nous devons resserrer quelque chose. </font><font style="vertical-align: inherit;">Eh bien, passons à un réglage plus fin dans le prochain, 7ème script. </font><font style="vertical-align: inherit;">Là, nous n'utiliserons pas 10 paramètres pour la construction, comme dans StereoBM (), mais presque 10, ce qui est beaucoup plus intéressant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici les sources </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">du 6ème script</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Script 7 - carte de profondeur avec paramètres avancés </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque les paramètres ne sont pas 2 mais 10, le tri de leurs options avec un redémarrage constant des scripts est incorrect. </font><font style="vertical-align: inherit;">Par conséquent, un script a été créé pour un réglage interactif pratique de la carte de profondeur. </font><font style="vertical-align: inherit;">La tâche n'était pas de compliquer le code avec l'interface, donc tout a été fait sur matplotlib. </font><font style="vertical-align: inherit;">Le dessin de l'interface dans matplotlib sur les framboises est assez lent, donc je transfère généralement le dossier de travail des framboises à l'ordinateur portable et sélectionne les paramètres là-bas. </font><font style="vertical-align: inherit;">Voici comment fonctionne le script:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/cNpMje5AKTQ%3Ffeature%3Doembed&amp;usg=ALkJrhieZlzfj1k3ZD16HyoD79HwqQ13BA" frameborder="0" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir sélectionné les paramètres, le script par le bouton Enregistrer enregistre le résultat dans le fichier 3dmap_set.txt au format JSON.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce qui est intéressant dans le code du 7ème script</font></font></b><div class="spoiler_text"><ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">7- </a></li>
<li>       . ,   -     ,        .</li>
<li>   ,         . , numOfDisparities    16,            .           update(val),            .   numOfDisparities    65.57     64.         ,            .</li>
<li>      matplotlib       ,     .</li>
</ul><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un travail pratique avec la carte de profondeur a montré que, tout d'abord, vous devez sélectionner le paramètre minDisparity, et conjointement avec numOfDisparities. </font><font style="vertical-align: inherit;">Eh bien, rappelez-vous que numOfDisparities change en fait discrètement, à l'étape 16. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir configuré cette paire, vous pouvez jouer avec d'autres paramètres. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les caractéristiques des paramètres de la carte dépendent déjà du goût de l'utilisateur et dépendent de la tâche à résoudre. </font><font style="vertical-align: inherit;">Vous pouvez apporter la carte à un grand nombre de petites parties ou afficher des zones agrandies. </font><font style="vertical-align: inherit;">Pour un simple évitement d'obstacles par des robots, le second est plus adapté. </font><font style="vertical-align: inherit;">Pour un nuage de points, le premier, mais des problèmes de performances se posent ici (nous y reviendrons).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que voulons-nous voir?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, l'un des points les plus importants est peut-être le réglage de la "clairvoyance" de notre appareil. </font><font style="vertical-align: inherit;">Lors de la configuration de la carte de profondeur, je place généralement un objet à une distance d'environ 30 cm, le second sur un mètre et le reste sur deux mètres. </font><font style="vertical-align: inherit;">Et lors de la configuration des deux premiers paramètres (minDisparity et numOfDisparities) dans le 7e script, j'obtiens ce qui suit:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objet le plus proche (30 cm) - rouge</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objet dans un demi-mètre - jaune ou vert</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objets 2-3 mètres - vert ou bleu clair</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conséquence, nous obtenons un système configuré pour reconnaître la zone «proche» d'obstacles dans un rayon de 5 à 10 mètres.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travailler avec la vidéo à la volée - script 8th, final</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, nous avons maintenant un système personnalisé prêt à l'emploi et nous devons obtenir un résultat pratique. </font><font style="vertical-align: inherit;">Nous essayons de construire une carte de profondeur en temps réel en utilisant la vidéo de notre caméra et de la montrer en temps réel lors de sa mise à jour.</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/-qTayRg8skA%3Ffeature%3Doembed&amp;usg=ALkJrhjofF7-ZVmLJiXsIkwtIQ-qQsUIAg" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce qui est intéressant dans le code du 8ème script</font></font></b><div class="spoiler_text">  –   .   ,     ,        overlay.      ,  :<br>
<br>
<ul>
<li>Overlay        R, G  B,      -   .    grayscale   </li>
<li><pre><code class="python hljs">disparity_color = cv2.applyColorMap(disparity_grayscale, cv2.COLORMAP_JET)</code></pre></li>
<li>  overlay    RGB,     BGR –        cv2.cvtColor()</li>
<li>Overlay      16.     16 —    .</li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans la course à la vitesse</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, la première mesure a été effectuée sur le premier Raspberry avec un processeur monocœur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 secondes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - construire une carte sur l'image de 1280x720 C'est beaucoup. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,5 secondes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - sur le Raspberry Pi 2, déjà mieux. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'analyse a montré que dans ce cas, un seul noyau est utilisé sur la deuxième framboise. Mess! J'ai reconstruit OpenCV en utilisant la bibliothèque de parallélisation TBB. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,5 seconde</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - lancement sur la deuxième framboise en utilisant le multicœur. En fait, il s'est avéré que seuls 2 cœurs sont utilisés - cela doit encore être bricolé. Il s'est avéré que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">non seulement j'ai</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> rencontré ce problème </font><font style="vertical-align: inherit;">, donc il y a encore de la place pour bouger.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A en juger par l'algorithme, la vitesse de fonctionnement devrait dépendre linéairement de la taille des données traitées. </font><font style="vertical-align: inherit;">Par conséquent, si vous réduisez la résolution de 2 fois, tout devrait théoriquement fonctionner 4 fois plus rapidement. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,3 seconde</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , soit environ 3-4 FPS - avec une résolution semi-réduite de 640x360. </font><font style="vertical-align: inherit;">La théorie a été confirmée.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plans futurs</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, je voulais tirer le meilleur parti du multicœur de la deuxième framboise. </font><font style="vertical-align: inherit;">Je vais regarder de plus près les sources de la fonction StereoBM et essayer de comprendre pourquoi le travail ne va pas jusqu'au bout. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La prochaine étape promet beaucoup plus d'aventures - c'est l'utilisation du GPU framboises pour accélérer les calculs. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trois chemins possibles sont tracés ici:</font></font><br>
<br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>      GPU,     10 FPS,      .     —  ,     « »   OpenCV,    .</li>
<li>        Koichi Nakamura,    GPU    ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a>.  ,     -  OpenCV,     . </li>
<li>              Jan Newmarch "<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Programming AudioVideo on the Raspberry Pi GPU</a>" </li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous aviez de l'expérience avec TBB pour Raspberry OpenCV, ou si vous vous occupiez du codage pour les GPU framboise, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">je vous serais reconnaissant pour des conseils supplémentaires</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">J'ai réussi à trouver un certain nombre de développements prêts à l'emploi pour une raison simple - les framboises avec deux caméras sont rares. </font><font style="vertical-align: inherit;">Si vous connectez deux webcams via USB, de gros freins viennent, et seul le Raspberry Pi Compute peut fonctionner avec deux caméras natives, qui ont également besoin d'un devboard lourd avec des lacets et des adaptateurs.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liens utiles:</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Scripts de travail:</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sources des</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8 scripts sur github</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Image de la carte ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,6 Go dans les archives</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Configuration d'OpenCV et de Python sur les framboises:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grand blog "python-OpenCV-shnik" et un manuel </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour configurer Python et OpenCV sur les framboises</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bibliothèque StereoVision:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ma </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">fourchette de</font></a><font style="vertical-align: inherit;"> travail </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur github</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Original par Egret </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur le github</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description de l'auteur de StereoVision sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">son blog</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Travail GPU</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liebits</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> japonais Koichi Nakamura </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">sur github</font></a><font style="vertical-align: inherit;"> - assembleur pour python pour GPU</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Livre de Jan Newmarch " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programmation audio vidéo sur le GPU Raspberry Pi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous avez besoin de travailler avec un appareil photo framboise Like a Boss: </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">documentation</font></a></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Picamera</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, un article intéressant sur le habr sur " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour reconnaître les images, vous n'avez pas besoin de reconnaître les images</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr388259/">https://habr.com/ru/post/fr388259/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr388243/index.html">Surveillance à domicile et visualisation à distance sur Internet</a></li>
<li><a href="../fr388245/index.html">Le premier téléphone modulaire est en vente</a></li>
<li><a href="../fr388247/index.html">Cassini a volé à côté d'Encelade pour la dernière fois</a></li>
<li><a href="../fr388253/index.html">En 2015, le Costa Rica a reçu environ 99% de son électricité à partir de sources renouvelables.</a></li>
<li><a href="../fr388257/index.html">Poudre DIY pour lave-vaisselle: nous démontons les produits industriels et améliorons la recette</a></li>
<li><a href="../fr388261/index.html">Mémoires d'un robot subhumain, chapitres 3-4</a></li>
<li><a href="../fr388263/index.html">Idées fausses sur l'univers [Voiceover Vert Dider]</a></li>
<li><a href="../fr388265/index.html">Modem Wi-Fi pour Commodore - à quoi ressemble-t-il?</a></li>
<li><a href="../fr388267/index.html">Nous volons et nous asseyons avec le Falcon 9R</a></li>
<li><a href="../fr388271/index.html">Kruglendar 2016 - affiche de journal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>