<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚶🏼 🛬 💋 Cara menahan peningkatan beban sistem: bicarakan persiapan skala besar untuk Black Friday 🔼 🌌 🦒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Habr! 

 Pada 2017, selama Black Friday, beban meningkat hampir satu setengah kali, dan server kami berada pada batas kemungkinan. Selama tahun ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cara menahan peningkatan beban sistem: bicarakan persiapan skala besar untuk Black Friday</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/retailrocket/blog/445900/">  Halo, Habr! <br><br>  Pada 2017, selama Black Friday, beban meningkat hampir satu setengah kali, dan server kami berada pada batas kemungkinan.  Selama tahun ini, jumlah pelanggan telah tumbuh secara signifikan, dan menjadi jelas bahwa tanpa persiapan awal yang matang, platform mungkin tidak tahan terhadap beban 2018. <br><br>  Tujuannya ditetapkan sebagai yang paling ambisius dari semua yang mungkin: kami ingin sepenuhnya siap untuk semburan aktivitas apa pun, bahkan yang paling kuat, dan mulai menarik kapasitas baru di awal tahun ini. <br><br>  CTO kami Andrei Chizh ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">chizh_andrey</a> ) menceritakan bagaimana kami mempersiapkan Black Friday 2018, tindakan apa yang kami ambil untuk menghindari jatuh, dan, tentu saja, hasil dari persiapan yang sangat hati-hati. <br><br><img src="https://habrastorage.org/webt/nv/pg/sq/nvpgsqdi4auhsvdmclno1upgvju.jpeg"><br><a name="habracut"></a><br>  Hari ini saya ingin berbicara tentang persiapan untuk Black Friday 2018. Mengapa sekarang, ketika sebagian besar penjualan besar ada di belakang?  Kami mulai mempersiapkan sekitar setahun sebelum peristiwa besar-besaran, dan dengan coba-coba kami menemukan solusi optimal.  Kami menyarankan Anda menjaga musim panas sebelumnya dan mencegah fakaps yang mungkin muncul pada saat yang paling tidak tepat. <br>  Materi akan bermanfaat bagi semua orang yang ingin memeras laba maksimum dari saham tersebut, seperti  sisi teknis dari masalah ini tidak kalah dengan sisi pemasaran. <br><br><h2>  Fitur lalu lintas pada penjualan besar </h2><br>  Berlawanan dengan kepercayaan populer, Black Friday bukan satu hari dalam setahun, tetapi hampir satu minggu penuh: penawaran diskon pertama tiba 7-8 hari sebelum penjualan.  Lalu lintas situs web mulai tumbuh dengan lancar sepanjang minggu, mencapai puncaknya pada hari Jumat dan turun cukup tajam pada hari Sabtu ke indikator toko reguler. <br><br><img src="https://habrastorage.org/webt/fp/gg/zh/fpggzhkt6td7vbzkbmw7k5ljo6u.jpeg"><br><br>  Ini penting untuk dipertimbangkan: toko online menjadi sangat sensitif terhadap "pelambatan" dalam sistem.  Selain itu, buletin email kami juga mengalami peningkatan jumlah pengiriman yang signifikan. <br><br>  Sangat penting bagi kita untuk melalui Black Friday tanpa jatuh, karena  fungsi paling penting dari situs dan milis toko tergantung pada operasi platform, yaitu: <br><br><ul><li>  Melacak dan mengeluarkan rekomendasi produk, </li><li>  Penerbitan bahan terkait (misalnya, blok rekomendasi desain gambar, seperti panah, logo, ikon dan elemen visual lainnya), </li><li>  Penerbitan gambar produk dengan ukuran yang tepat (untuk tujuan ini kami memiliki "ImageResizer" - subsistem yang mengunduh gambar dari server toko, mengompresnya ke ukuran yang diinginkan dan, melalui server caching, menyediakan gambar dengan ukuran yang tepat untuk setiap produk di setiap blok rekomendasi). </li></ul><br>  Bahkan, selama Black Friday 2019, beban pada layanan meningkat sebesar 40%, yaitu  jumlah acara yang dipantau dan diproses oleh sistem Retail Rocket di situs toko online meningkat dari 5 hingga 8 ribu permintaan per detik.  Karena kenyataan bahwa kami sedang mempersiapkan beban yang lebih serius, kami mengalami lonjakan dengan mudah. <br><br><img src="https://habrastorage.org/webt/hj/rf/yi/hjrfyizrdasmrzna_e2yv26s7x4.png"><br><br><h2>  Persiapan umum </h2><br><br>  Black Friday adalah waktu yang panas untuk semua ritel dan untuk ecommerce pada khususnya.  Jumlah pengguna dan aktivitas mereka saat ini terus meningkat, jadi kami, seperti biasa, benar-benar siap untuk waktu sibuk ini.  Kami menambahkan fakta bahwa banyak toko online yang terhubung dengan kami, tidak hanya di Rusia tetapi juga di Eropa, di mana hype jauh lebih tinggi, dan kami mendapatkan tingkat gairah yang lebih buruk daripada seri Brasil.  Apa yang perlu dilakukan agar benar-benar siap menghadapi peningkatan beban? <br><br><h3>  Bekerja dengan server </h3><br>  Untuk memulainya, perlu untuk mengetahui apa yang sebenarnya kurang untuk meningkatkan kapasitas server.  Sudah pada bulan Agustus, kami mulai memesan server baru khusus untuk Black Friday - total 10 mesin ditambahkan.  Pada bulan November, mereka sudah sepenuhnya berperang. <br><br>  Pada saat yang sama, sebagian dari mesin pembuat diinstal ulang untuk digunakan sebagai server Aplikasi.  Kami segera menyiapkannya untuk menggunakan fungsi yang berbeda: baik untuk mengeluarkan rekomendasi dan untuk layanan ImageResizer, sehingga tergantung pada jenis beban, masing-masing dapat digunakan untuk salah satu peran ini.  Dalam mode normal, server Application dan ImageResizer memiliki fungsi yang jelas: yang pertama terlibat dalam mengeluarkan rekomendasi, yang kedua mengirimkan gambar untuk huruf dan blok rekomendasi di situs web toko online.  Dalam persiapan untuk Black Friday, diputuskan untuk membuat semua server serba guna menyeimbangkan lalu lintas di antara mereka tergantung pada jenis beban. <br><br>  Kemudian kami menambahkan dua server besar untuk Kafka (Apache Kafka) dan mendapat sekelompok 5 mesin yang kuat.  Sayangnya, semuanya berjalan tidak semulus yang kita inginkan: dalam proses sinkronisasi data, dua mesin baru mengambil seluruh lebar saluran jaringan, dan kami harus dengan cepat mencari tahu bagaimana melakukan proses penambahan dengan cepat dan aman untuk seluruh infrastruktur.  Untuk mengatasi masalah ini, administrator kami harus dengan berani mengorbankan akhir pekan. <br><br><h3>  Bekerja dengan data </h3><br>  Selain server, kami memutuskan untuk mengoptimalkan file untuk memudahkan memuat, dan langkah besar bagi kami adalah terjemahan file statis.  Semua file statis yang sebelumnya di-host di server dibawa ke S3 + Cloudfront.  Mereka ingin melakukan ini untuk waktu yang lama, karena beban di server dekat dengan nilai batas, dan sekarang alasan yang bagus muncul. <br><br>  Seminggu sebelum Black Friday, kami meningkatkan waktu penyimpanan gambar menjadi 3 hari, sehingga jika terjadi penurunan ImageResizer, gambar yang sebelumnya di-cache diperoleh dari cdn.  Ini juga mengurangi beban pada server kami, karena semakin lama gambar disimpan, semakin jarang kita perlu menghabiskan sumber daya untuk mengubah ukuran. <br><br>  Dan yang terakhir, namun tidak kalah pentingnya: 5 hari sebelum Black Friday, moratorium diumumkan tentang penyebaran fungsi baru, serta pada pekerjaan apa pun dengan infrastruktur - semua perhatian diarahkan untuk mengatasi peningkatan beban. <br><br><h2>  Rencana Tanggap Darurat </h2><br>  Tidak peduli seberapa bagus persiapannya, pemalsuan selalu dimungkinkan.  Dan kami telah mengembangkan 3 rencana tanggapan untuk kemungkinan situasi kritis: <br><br><ul><li>  pengurangan beban </li><li>  menonaktifkan beberapa layanan, </li><li>  mematikan layanan sepenuhnya. </li></ul><br>  <b>Paket A: pengurangan beban.</b>  Seharusnya terlibat jika, karena lonjakan beban, server kami melampaui waktu tanggapan yang dapat diterima.  Dalam hal ini, kami menyiapkan mekanisme untuk mengurangi beban secara bertahap dengan mengalihkan sebagian lalu lintas ke server Amazon, yang hanya akan memberikan "200 OK" untuk semua permintaan dan memberikan jawaban kosong.  Kami memahami bahwa ini adalah penurunan kualitas layanan, tetapi pilihan antara fakta bahwa layanan tidak bekerja sama sekali atau tidak menunjukkan rekomendasi untuk sekitar 10% dari lalu lintas jelas. <br><br>  <b>Paket B: Menonaktifkan Layanan.</b>  Tersirat degradasi parsial layanan.  Misalnya, mengurangi kecepatan penghitungan rekomendasi pribadi demi membongkar beberapa basis data dan saluran komunikasi.  Dalam mode standar, rekomendasi dihitung dalam mode real-time, membuat versi toko online untuk setiap pengunjung, tetapi di bawah kondisi peningkatan beban, penurunan kecepatan memungkinkan layanan inti lainnya untuk terus bekerja. <br><br>  <b>Rencana C: untuk Armageddon.</b>  Jika terjadi kegagalan sistem yang lengkap, kami telah menyiapkan rencana yang akan memutuskan sambungan kami dengan aman dari pelanggan.  Pembeli hanya akan berhenti melihat rekomendasi, kinerja toko online tidak akan terpengaruh.  Untuk melakukan ini, kita harus mengatur ulang file integrasi kita sehingga pengguna baru berhenti berinteraksi dengan layanan.  Artinya, kami akan menonaktifkan pekerjaan kode pelacakan utama kami, layanan akan berhenti mengumpulkan data dan menghitung rekomendasi, dan pengguna hanya akan melihat halaman tanpa blok rekomendasi.  Untuk semua orang yang sebelumnya menerima file integrasi, kami telah menyediakan opsi untuk mengalihkan catatan DNS ke Amazon dan 200 tulisan rintisan yang OK. <br><br><h2>  Ringkasan </h2><br>  Kami mengatasi seluruh beban bahkan tanpa perlu menggunakan mesin build tambahan.  Dan berkat persiapan sebelumnya, kami tidak memerlukan rencana respons yang dikembangkan.  Tetapi semua pekerjaan yang dilakukan adalah pengalaman yang tak ternilai yang akan membantu kita mengatasi arus lalu lintas yang paling tak terduga dan besar. <br>  Seperti pada tahun 2017, beban pada layanan meningkat sebesar 40%, dan jumlah pengguna di toko online untuk Black Friday meningkat sebesar 60%.  Semua kesulitan dan kesalahan terjadi selama periode persiapan, yang menyelamatkan kami dan pelanggan kami dari situasi yang tidak terduga. <br><br>  Bagaimana perasaan Anda tentang Black Friday?  Bagaimana cara mempersiapkan beban kritis? </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id445900/">https://habr.com/ru/post/id445900/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id445890/index.html">PyTest Neo</a></li>
<li><a href="../id445892/index.html">Teori Ledakan Besar dan Kecil</a></li>
<li><a href="../id445894/index.html">[Izhevsk dan Perm, pengumuman] Hangat dan transistor menyiarkan secara online CodeFest X</a></li>
<li><a href="../id445896/index.html">Mengapa pemindai 3D anggaran tidak cocok untuk tugas profesional</a></li>
<li><a href="../id445898/index.html">Tentang ide baru, pandangan sempit dan dari mulut ke mulut</a></li>
<li><a href="../id445904/index.html">Jenis infinitas dan batang otak</a></li>
<li><a href="../id445906/index.html">Jangan makan aspirin</a></li>
<li><a href="../id445908/index.html">Golang dan evolusi interaksi basis data</a></li>
<li><a href="../id445910/index.html">Bagaimana kami berteman dengan EF 6 MSSQL dan PostgresSQL</a></li>
<li><a href="../id445912/index.html">Hai, Habr, kami adalah Advantech</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>