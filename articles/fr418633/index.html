<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õÖÔ∏è üóª üëêüèø R√©activit√© JavaScript: un exemple simple et intuitif üë©üèæ‚Äçü§ù‚Äçüë®üèø üë®üèæ‚Äçüè´ üñêüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De nombreux frameworks frontaux JavaScript (tels que Angular, React et Vue) ont leurs propres syst√®mes de r√©activit√©. Comprendre les fonctionnalit√©s d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>R√©activit√© JavaScript: un exemple simple et intuitif</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/418633/">  De nombreux frameworks frontaux JavaScript (tels que Angular, React et Vue) ont leurs propres syst√®mes de r√©activit√©.  Comprendre les fonctionnalit√©s de ces syst√®mes sera utile √† tout d√©veloppeur, l'aidera √† utiliser plus efficacement les frameworks JS modernes. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/c_/k4/dp/c_k4dpwjifcbq6pvrg-gn7wydsu.jpeg"></a> <br><br>  Le mat√©riel, dont nous publions la traduction aujourd'hui, montre un exemple √©tape par √©tape de d√©veloppement d'un syst√®me de r√©activit√© en JavaScript pur.  Ce syst√®me impl√©mente les m√™mes m√©canismes que ceux utilis√©s dans Vue. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Syst√®me de r√©activit√©</font> </h2><br>  Pour quelqu'un qui rencontre pour la premi√®re fois le syst√®me de r√©activit√© Vue, cela peut sembler une myst√©rieuse bo√Æte noire.  Prenons une simple application Vue.  Voici le balisage: <br><br><pre><code class="hljs django"><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"app"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">    </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Price: $</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ price }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">    </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Total: $</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ price*quantity }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">    </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Taxes: $</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ totalPriceWithTax }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  Voici la commande de connexion du framework et le code d'application. <br><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://cdn.jsdelivr.net/npm/vue"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript">   </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">var</span></span></span><span class="actionscript"> vm = </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">new</span></span></span><span class="actionscript"> Vue({       el: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'#app'</span></span></span><span class="actionscript">,       data: {           price: </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">5.00</span></span></span><span class="actionscript">,           quantity: </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">2</span></span></span><span class="actionscript">       },       computed: {           totalPriceWithTax() {               </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">return</span></span></span><span class="actionscript"> </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">this</span></span></span><span class="actionscript">.price * </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">this</span></span></span><span class="actionscript">.quantity * </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">1.03</span></span></span><span class="actionscript">           }       }   }) </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  D'une mani√®re ou d'une autre, Vue d√©couvre que lorsque le <code>price</code> change, le moteur doit faire trois choses: <br><br><ol><li>  Actualisez <code>price</code> valeur du <code>price</code> sur la page Web. </li><li>  Recalculez l'expression dans laquelle le <code>price</code> est multipli√© par la <code>quantity</code> et affichez la valeur r√©sultante sur la page. </li><li>  Appelez la fonction <code>totalPriceWithTax</code> et, encore une fois, mettez ce qu'elle renvoie sur la page. </li></ol><br>  Ce qui se passe ici est illustr√© dans l'illustration suivante. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/373/af5/15e/373af515eac946ce5c656df9fe2da573.jpg"></div><br>  <i><font color="#999999">Comment Vue sait-il quoi faire lorsque la propri√©t√© de prix change?</font></i> <br><br>  Nous avons maintenant des questions sur la fa√ßon dont Vue sait exactement ce qui doit √™tre mis √† jour lorsque le <code>price</code> change, et comment le moteur suit ce qui se passe sur la page.  Ce que vous pouvez observer ici ne ressemble pas √† une application JS standard. <br><br>  Ce n'est peut-√™tre pas encore √©vident, mais le principal probl√®me que nous devons r√©soudre ici est que les programmes JS ne fonctionnent g√©n√©ralement pas comme √ßa.  Par exemple, ex√©cutons le code suivant: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> price = <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quantity = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> total = price * quantity <span class="hljs-comment"><span class="hljs-comment">//  10 price = 20; console.log(`total is ${total}`)</span></span></code> </pre> <br>  Que pensez-vous qui sera affich√© dans la console?  √âtant donn√© que rien n'est utilis√© ici, sauf JS ordinaire, <code>10</code> arrivera √† la console. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/030/992/c52/030992c52de473284847fa7f8f2f6785.png"></div><br>  <i><font color="#999999">Le r√©sultat du programme</font></i> <br><br>  Et lorsque vous utilisez les capacit√©s de Vue, dans une situation similaire, nous pouvons impl√©menter un sc√©nario dans lequel la valeur <code>total</code> est recompt√©e lorsque les variables de <code>price</code> ou de <code>quantity</code> changent.  Autrement dit, si le syst√®me de r√©activit√© √©tait utilis√© dans l'ex√©cution du code ci-dessus, alors pas 10, mais 40 serait affich√© sur la console: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/22c/c4e/6c7/22cc4e6c79914b1c9f2c4df6bf83c9e1.png"></div><br>  <i><font color="#999999">Sortie console g√©n√©r√©e par un code hypoth√©tique utilisant un syst√®me de r√©activit√©</font></i> <br><br>  JavaScript est un langage qui peut fonctionner √† la fois proc√©dural et orient√© objet, mais il n'a pas de syst√®me de r√©activit√© int√©gr√©, donc le code que nous avons pris en compte lors du changement de <code>price</code> ne donnera pas le num√©ro 40 √† la console.  Pour que l'indicateur <code>total</code> soit recalcul√© lorsque le <code>price</code> ou la <code>quantity</code> change, nous devrons cr√©er nous-m√™mes un syst√®me de r√©activit√© et ainsi obtenir le comportement dont nous avons besoin.  Nous allons briser le chemin vers cet objectif en plusieurs petites √©tapes. <br><br><h2>  <font color="#3AC1EF">T√¢che: stockage des r√®gles de calcul des indicateurs</font> </h2><br>  Nous avons besoin d'un endroit pour enregistrer des informations sur la fa√ßon dont l'indicateur <code>total</code> est calcul√©, ce qui nous permettra de le recalculer lors du changement des valeurs des variables de <code>price</code> ou de <code>quantity</code> . <br><br><h3>  <font color="#3AC1EF">‚ñçSolution</font> </h3><br>  Tout d'abord, nous devons dire √† l'application ce qui suit: "Voici le code que je vais ex√©cuter, enregistrez-le, je devrai peut-√™tre l'ex√©cuter une autre fois."  Ensuite, nous devrons ex√©cuter le code.  Plus tard, si les indicateurs de <code>price</code> ou de <code>quantity</code> ont chang√©, vous devrez appeler le code enregistr√© pour recalculer le <code>total</code> .  Cela ressemble √† ceci: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7e8/de0/6ce/7e8de06ce6262d1989c13153884cd225.png"></div><br>  <i><font color="#999999">Le code de calcul total doit √™tre enregistr√© quelque part afin de pouvoir y acc√©der plus tard</font></i> <br><br>  Le code que vous pouvez appeler en JavaScript pour effectuer une action est format√© en tant que fonctions.  Par cons√©quent, nous √©crirons une fonction qui traite du calcul du <code>total</code> , et cr√©erons √©galement un m√©canisme pour stocker les fonctions dont nous pourrions avoir besoin plus tard. <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> price = <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quantity = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> total = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> target = <span class="hljs-literal"><span class="hljs-literal">null</span></span> target = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{   total = price * quantity } record() <span class="hljs-comment"><span class="hljs-comment">//       ,       target() //  </span></span></code> </pre> <br>  Notez que nous stockons la fonction anonyme dans la variable <code>target</code> , puis appelons la fonction d' <code>record</code> .  Nous en parlerons ci-dessous.  Je voudrais √©galement noter que la fonction <code>target</code> , en utilisant la syntaxe des fonctions fl√©ch√©es ES6, peut √™tre r√©√©crite comme suit: <br><br><pre> <code class="hljs coffeescript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">target</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { total = price * quantity }</code> </pre> <br>  Voici la d√©claration de la fonction d' <code>record</code> et la structure de donn√©es utilis√©e pour stocker les fonctions: <br><br><pre> <code class="hljs powershell">let storage = [] //     target <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">record</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { // target = () =&gt; { total = price * quantity }   storage.push(target) }</code> </pre> <br>  En utilisant la fonction d' <code>record</code> , nous enregistrons la fonction <code>target</code> (dans notre cas <code>{ total = price * quantity }</code> ) dans la matrice de <code>storage</code> , ce qui nous permet d'appeler cette fonction plus tard, √©ventuellement en utilisant la fonction de <code>replay</code> , dont le code est illustr√© ci-dessous.  Cela nous permettra d'appeler toutes les fonctions stock√©es dans le <code>storage</code> . <br><br><pre> <code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">replay</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{   storage.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">run</span></span></span><span class="hljs-function"> =&gt;</span></span> run()) }</code> </pre> <br>  Ici, nous passons en revue toutes les fonctions anonymes stock√©es dans la matrice de <code>storage</code> et ex√©cutons chacune d'entre elles. <br><br>  Ensuite, dans notre code, nous pouvons faire ce qui suit: <br><br><pre> <code class="hljs pgsql">price = <span class="hljs-number"><span class="hljs-number">20</span></span> console.log(total) // <span class="hljs-number"><span class="hljs-number">10</span></span> replay() console.log(total) // <span class="hljs-number"><span class="hljs-number">40</span></span></code> </pre> <br>  √áa n'a pas l'air si difficile, non?  Voici l'int√©gralit√© du code, dont nous avons discut√© les fragments ci-dessus, au cas o√π il serait plus pratique pour vous de finalement y faire face.  Soit dit en passant, ce code n'est pas accidentellement √©crit de cette fa√ßon. <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> price = <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quantity = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> total = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> target = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> storage = [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">record</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{   storage.push(target) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">replay</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{   storage.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">run</span></span></span><span class="hljs-function"> =&gt;</span></span> run()) } target = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { total = price * quantity } record() target() price = <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(total) <span class="hljs-comment"><span class="hljs-comment">// 10 replay() console.log(total) // 40</span></span></code> </pre> <br>  C'est ce qui sera affich√© dans la console du navigateur apr√®s son d√©marrage. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/67c/18e/94b/67c18e94b8afde9e116e95bb4cf8f41b.png"></div><br>  <i><font color="#999999">R√©sultat du code</font></i> <br><br><h2>  <font color="#3AC1EF">Challenge: une solution fiable pour stocker des fonctions</font> </h2><br>  Nous pouvons continuer √† noter les fonctions dont nous avons besoin si n√©cessaire, mais ce serait bien si nous avions une solution plus fiable qui peut √™tre mise √† l'√©chelle avec l'application.  Ce sera peut-√™tre une classe qui conserve une liste de fonctions √©crites √† l'origine dans la variable <code>target</code> et qui re√ßoit des notifications si nous devons r√©ex√©cuter ces fonctions. <br><br><h3>  <font color="#3AC1EF">‚ñçSolution: classe de d√©pendance</font> </h3><br>  Une approche pour r√©soudre le probl√®me ci-dessus consiste √† encapsuler le comportement dont nous avons besoin dans une classe, qui peut √™tre appel√©e d√©pendance.  Cette classe impl√©mentera le mod√®le de programmation d'observateur standard. <br><br>  Par cons√©quent, si nous cr√©ons une classe JS utilis√©e pour g√©rer nos d√©pendances (qui sera proche de la fa√ßon dont des m√©canismes similaires sont impl√©ment√©s dans Vue), cela peut ressembler √† ceci: <br><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dep</span></span></span><span class="hljs-class"> { // </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dep</span></span></span><span class="hljs-class"> -    </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dependency</span></span></span><span class="hljs-class">   constructor () {       this.subscribers = [] //  ,                               //    notify()   }   depend () { //   record       if (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">target</span></span></span><span class="hljs-class"> &amp;&amp; !</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subscribers</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">includes</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">target</span></span></span><span class="hljs-class">)){           //    target                //                this.subscribers.push(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">target</span></span></span><span class="hljs-class">)       }   }   notify () { //   replay       this.subscribers.forEach(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sub</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sub</span></span></span><span class="hljs-class">())       //  -     } }</span></span></code> </pre> <br>  Veuillez noter qu'au lieu de la matrice de <code>storage</code> , nous stockons maintenant nos fonctions anonymes dans la matrice des <code>subscribers</code> .  Au lieu de la fonction d' <code>record</code> , la m√©thode <code>depend</code> est maintenant appel√©e.  Ici aussi, au lieu de la fonction de <code>replay</code> , la fonction de <code>notify</code> est <code>notify</code> .  Voici comment ex√©cuter notre code √† l'aide de la classe <code>Dep</code> : <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dep = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dep() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> price = <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quantity = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> total = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> target = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { total = price * quantity } dep.depend() <span class="hljs-comment"><span class="hljs-comment">//   target    target() //     total console.log(total) // 10 -   price = 20 console.log(total) // 10 -    ,    dep.notify() //   -  console.log(total) // 40 -   </span></span></code> </pre> <br>  Notre nouveau code fonctionne de la m√™me mani√®re qu'auparavant, mais maintenant il est mieux con√ßu et il semble pr√©f√©rable de le r√©utiliser. <br><br>  Jusqu'√† pr√©sent, la seule chose qui semble √©trange est de travailler avec une fonction stock√©e dans la variable <code>target</code> . <br><br><h2>  <font color="#3AC1EF">T√¢che: m√©canisme de cr√©ation de fonctions anonymes</font> </h2><br>  √Ä l'avenir, nous devrons cr√©er un objet de classe <code>Dep</code> pour chaque variable.  De plus, il serait bien d'encapsuler le comportement de cr√©ation de fonctions anonymes quelque part, qui devrait √™tre appel√© lors de la mise √† jour des donn√©es pertinentes.  Peut-√™tre que cela nous aidera avec une fonction suppl√©mentaire, que nous appellerons <code>watcher</code> .  Cela conduira au fait que nous pouvons remplacer cette construction de l'exemple pr√©c√©dent par une nouvelle fonction: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> target = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { total = price * quantity } dep.depend() target()</code> </pre> <br>  En fait, un appel √† la fonction <code>watcher</code> qui remplace ce code ressemblera √† ceci: <br><br><pre> <code class="hljs coffeescript">watcher(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   total = price * quantity })</code> </pre> <br><h3>  <font color="#3AC1EF">‚ñç Solution: fonction d'observateur</font> </h3><br>  A l'int√©rieur de la fonction <code>watcher</code> , dont le code est pr√©sent√© ci-dessous, nous pouvons effectuer plusieurs actions simples: <br><br><pre> <code class="hljs cmake"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> watcher(myFunc) {   <span class="hljs-keyword"><span class="hljs-keyword">target</span></span> = myFunc //   <span class="hljs-keyword"><span class="hljs-keyword">target</span></span>   myFunc   dep.depend() //  <span class="hljs-keyword"><span class="hljs-keyword">target</span></span>      <span class="hljs-keyword"><span class="hljs-keyword">target</span></span>() //     <span class="hljs-keyword"><span class="hljs-keyword">target</span></span> = null //   <span class="hljs-keyword"><span class="hljs-keyword">target</span></span> }</code> </pre> <br>  Comme vous pouvez le voir, la fonction <code>watcher</code> prend, comme argument, la fonction <code>myFunc</code> , l'√©crit dans la variable <code>target</code> globale, appelle <code>dep.depend()</code> pour ajouter cette fonction √† la liste des abonn√©s, appelle cette fonction et r√©initialise la variable <code>target</code> . <br>  Maintenant, nous obtenons tous les m√™mes valeurs 10 et 40 si nous ex√©cutons le code suivant: <br><br><pre> <code class="hljs pgsql">price = <span class="hljs-number"><span class="hljs-number">20</span></span> console.log(total) dep.<span class="hljs-keyword"><span class="hljs-keyword">notify</span></span>() console.log(total)</code> </pre> <br>  Vous vous demandez peut-√™tre pourquoi nous avons impl√©ment√© <code>target</code> tant que variable globale, au lieu de transmettre cette variable √† nos fonctions, si n√©cessaire.  Nous avons de bonnes raisons de le faire, vous comprendrez plus tard. <br><br><h2>  <font color="#3AC1EF">T√¢che: poss√©der un objet Dep pour chaque variable</font> </h2><br>  Nous avons un seul objet de classe <code>Dep</code> .  Et si nous avions besoin que chacune de nos variables ait son propre objet de classe <code>Dep</code> ?  Avant de continuer, d√©pla√ßons les donn√©es avec lesquelles nous travaillons vers les propri√©t√©s de l'objet: <br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">let</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> = { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class">: 5, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">quantity</span></span></span><span class="hljs-class">: 2 }</span></span></code> </pre> <br>  Imaginez un instant que chacune de nos propri√©t√©s ( <code>price</code> et <code>quantity</code> ) poss√®de son propre objet de classe <code>Dep</code> interne. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0d6/7a0/686/0d67a0686a5c87e6080994309197e6b4.png"></div><br>  <i><font color="#999999">Propri√©t√©s de prix et de quantit√©</font></i> <br><br>  Maintenant, nous pouvons appeler la fonction <code>watcher</code> comme ceci: <br><br><pre> <code class="hljs coffeescript">watcher(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   total = data.price * data.quantity })</code> </pre> <br>  Puisque nous travaillons ici avec la valeur de la propri√©t√© <code>data.price</code> , nous avons besoin de l'objet de classe <code>Dep</code> de la propri√©t√© <code>price</code> pour placer une fonction anonyme (stock√©e dans <code>target</code> ) dans son tableau d'abonn√©s (en appelant <code>dep.depend()</code> ).  De plus, puisque nous travaillons avec <code>data.quantity</code> , nous avons besoin de l'objet <code>Dep</code> de la propri√©t√© <code>quantity</code> pour placer une fonction anonyme (√† nouveau, stock√©e dans <code>target</code> ) dans son tableau d'abonn√©s. <br><br>  Si vous d√©crivez cela sous la forme d'un diagramme, vous obtenez ce qui suit. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/90a/2c9/16d/90a2c916de1e45a044fb1074d64ba196.png"></div><br>  <i><font color="#999999">Les fonctions tombent dans des tableaux d'abonn√©s d'objets de classe Dep correspondant √† diff√©rentes propri√©t√©s</font></i> <br><br>  Si nous avons une fonction anonyme de plus dans laquelle nous travaillons uniquement avec la propri√©t√© <code>data.price</code> , alors la fonction anonyme correspondante ne doit aller qu'au d√©p√¥t de l'objet de cette propri√©t√©. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8e9/ed1/040/8e9ed104054baab4bb24eeed338cc6a0.png"></div><br>  <i><font color="#999999">Des observateurs suppl√©mentaires peuvent √™tre ajout√©s √† une seule des propri√©t√©s disponibles.</font></i> <br><br>  Quand pourriez-vous avoir besoin d'appeler <code>dep.notify()</code> pour les fonctions souscrites aux modifications de la propri√©t√© <code>price</code> ?  Cela sera n√©cessaire lors du changement de <code>price</code> .  Cela signifie que lorsque notre exemple est compl√®tement pr√™t, le code suivant devrait fonctionner pour nous. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2df/2d9/7a0/2df2d97a0a995fbbdb63703ea76f8349.png"></div><br>  <i><font color="#999999">Ici, lors du changement de prix, vous devez appeler dep.notify () pour toutes les fonctions souscrites au changement de prix</font></i> <br><br>  Pour que tout fonctionne de cette fa√ßon, nous avons besoin d'un moyen d'intercepter les √©v√©nements d'acc√®s √† la propri√©t√© (dans notre cas, c'est le <code>price</code> ou la <code>quantity</code> ).  Cela permettra, lorsque cela se produira, de sauvegarder la fonction <code>target</code> dans un tableau d'abonn√©s, et lorsque la variable correspondante changera, d'ex√©cuter la fonction stock√©e dans ce tableau. <br><br><h3>  <font color="#3AC1EF">‚ñçSolution: Object.defineProperty ()</font> </h3><br>  Maintenant, nous devons nous familiariser avec la m√©thode ES5 standard <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Object.defineProperty ().</a>  Il vous permet d'affecter des getters et setters aux propri√©t√©s des objets.  Permettez-moi, avant de passer √† leur utilisation pratique, de d√©montrer le fonctionnement de ces m√©canismes avec un exemple simple. <br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">let</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> = { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class">: 5, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">quantity</span></span></span><span class="hljs-class">: 2 } </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Object</span></span></span><span class="hljs-class">.defineProperty(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">, '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price'</span></span></span><span class="hljs-class">, { //       </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class">   </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get</span></span></span><span class="hljs-class">() { //        </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">console</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">log</span></span></span><span class="hljs-class">(`</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">I</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">was</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">accessed</span></span></span><span class="hljs-class">`)   },   set(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">newVal</span></span></span><span class="hljs-class">) { //        </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">console</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">log</span></span></span><span class="hljs-class">(`</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">I</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">was</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">changed</span></span></span><span class="hljs-class">`)   } }) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.price //       </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.price = 20 //     </span></span></code> </pre> <br>  Si vous ex√©cutez ce code dans la console du navigateur, il affichera le texte suivant. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ed0/7a5/ec1/ed07a5ec1a3a8183516f908695d42c47.png"></div><br>  <i><font color="#999999">Getter and Setter Results</font></i> <br><br>  Comme vous pouvez le voir, notre exemple imprime simplement quelques lignes de texte sur la console.  Cependant, il ne lit ni ne d√©finit de valeurs, car nous avons red√©fini la fonctionnalit√© standard des getters et setters.  Nous restaurerons la fonctionnalit√© de ces m√©thodes.  √Ä savoir, il est pr√©vu que les getters retournent les valeurs des m√©thodes correspondantes et que les setters les d√©finissent.  Par cons√©quent, nous ajouterons une nouvelle variable, <code>internalValue</code> , au code, que nous utiliserons pour stocker la valeur actuelle du <code>price</code> . <br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">let</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> = { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class">: 5, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">quantity</span></span></span><span class="hljs-class">: 2 } let internalValue = </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.price //   </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Object</span></span></span><span class="hljs-class">.defineProperty(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">, '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price'</span></span></span><span class="hljs-class">, { //       </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class">   </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get</span></span></span><span class="hljs-class">() { //        </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">console</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">log</span></span></span><span class="hljs-class">(`</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Getting</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class">: ${</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">internalValue</span></span></span><span class="hljs-class">}`)       return internalValue   },   set(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">newVal</span></span></span><span class="hljs-class">) {       </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">console</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">log</span></span></span><span class="hljs-class">(`</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Setting</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">to</span></span></span><span class="hljs-class">: ${</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">newVal</span></span></span><span class="hljs-class">}`)       internalValue = newVal   } }) total = </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.price * </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.quantity //       </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.price = 20 //     </span></span></code> </pre> <br>  Maintenant que le getter et le setter fonctionnent comme ils devraient fonctionner, que pensez-vous qu'il y aura dans la console lorsque ce code sera ex√©cut√©?  Jetez un ≈ìil √† la figure suivante. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/050/0c1/6b1/0500c16b12301a46ee7a0db01ea3b823.png"></div><br>  <i><font color="#999999">Sortie de donn√©es vers la console</font></i> <br><br>  Donc, nous avons maintenant un m√©canisme qui vous permet de recevoir des notifications lors de la lecture des valeurs de propri√©t√© et lorsque de nouvelles valeurs leur sont √©crites.  Maintenant, apr√®s avoir un peu retravaill√© le code, nous pouvons √©quiper les getters et les setters de toutes les propri√©t√©s de l'objet de <code>data</code> .  Ici, nous utiliserons la m√©thode <code>Object.keys()</code> , qui retourne un tableau de cl√©s de l'objet qui lui est pass√©. <br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">let</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> = { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class">: 5, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">quantity</span></span></span><span class="hljs-class">: 2 } </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Object</span></span></span><span class="hljs-class">.keys(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">).forEach(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class"> =&gt; { //        </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">   </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">let</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">internalValue</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">[</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class">]   </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Object</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">defineProperty</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class">, {       </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get</span></span></span><span class="hljs-class">() {           </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">console</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">log</span></span></span><span class="hljs-class">(`</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Getting</span></span></span><span class="hljs-class"> ${</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class">}: ${</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">internalValue</span></span></span><span class="hljs-class">}`)           return internalValue       },       set(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">newVal</span></span></span><span class="hljs-class">) {           </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">console</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">log</span></span></span><span class="hljs-class">(`</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Setting</span></span></span><span class="hljs-class"> ${</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class">} to: ${</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">newVal</span></span></span><span class="hljs-class">}`)           internalValue = newVal       }   }) }) let total = </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.price * </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.quantity </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.price = 20</span></span></code> </pre> <br>  Maintenant, toutes les propri√©t√©s de l'objet de <code>data</code> ont des getters et des setters.  C'est ce qui appara√Æt dans la console apr√®s avoir ex√©cut√© ce code. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc6/af0/6b1/bc6af06b16c72f0772634160add682ab.png"></div><br>  <i><font color="#999999">Sortie de donn√©es vers la console par les getters et les setters</font></i> <br><br><h2>  <font color="#3AC1EF">Assemblage du syst√®me de r√©activit√©</font> </h2><br>  Lorsqu'un fragment de code comme <code>total = data.price * data.quantity</code> et <code>total = data.price * data.quantity</code> valeur de la propri√©t√© <code>price</code> , nous avons besoin de la propri√©t√© <code>price</code> pour ¬´se souvenir¬ª de la fonction anonyme correspondante ( <code>target</code> dans notre cas).  Par cons√©quent, si la propri√©t√© <code>price</code> est modifi√©e, c'est-√†-dire d√©finie sur une nouvelle valeur, cela conduira √† un appel √† cette fonction pour r√©p√©ter les op√©rations qu'elle effectue, car elle sait qu'une certaine ligne de code en d√©pend.  En cons√©quence, les op√©rations effectu√©es dans les getters et setters peuvent √™tre imagin√©es comme suit: <br><br><ul><li>  Getter - vous devez vous souvenir de la fonction anonyme, que nous appellerons √† nouveau lorsque la valeur changera. </li><li>  Setter - il est n√©cessaire d'ex√©cuter la fonction anonyme stock√©e, ce qui entra√Ænera une modification de la valeur r√©sultante correspondante. </li></ul><br>  Si vous utilisez la classe <code>Dep</code> d√©j√† connue dans cette description, vous obtenez les √©l√©ments suivants: <br><br><ul><li>  Lors de la lecture d'une valeur de propri√©t√©, <code>dep.depend()</code> est appel√© pour enregistrer la fonction <code>target</code> actuelle. </li><li>  Lorsqu'une valeur est √©crite dans une propri√©t√©, <code>dep.notify()</code> est appel√© pour red√©marrer toutes les fonctions stock√©es. </li></ul><br>  Maintenant, nous allons combiner ces deux id√©es et, enfin, nous arriverons au code qui nous permet d'atteindre notre objectif. <br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">let</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> = { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class">: 5, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">quantity</span></span></span><span class="hljs-class">: 2 } let target = null //  -    ,     class </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dep</span></span></span><span class="hljs-class"> {   </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constructor</span></span></span><span class="hljs-class"> () {       </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subscribers</span></span></span><span class="hljs-class"> = []   }   depend () {       </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">target</span></span></span><span class="hljs-class"> &amp;&amp; !</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subscribers</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">includes</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">target</span></span></span><span class="hljs-class">)){           </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subscribers</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">push</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">target</span></span></span><span class="hljs-class">)       }   }   notify () {       </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subscribers</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">forEach</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sub</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sub</span></span></span><span class="hljs-class">())   } } //      ,  //      </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Object</span></span></span><span class="hljs-class">.keys(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">).forEach(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class"> =&gt; {   </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">let</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">internalValue</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">[</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class">]   //         //   </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dep</span></span></span><span class="hljs-class">   </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dep</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dep</span></span></span><span class="hljs-class">()   </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Object</span></span></span><span class="hljs-class">.defineProperty(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class">, {       </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get</span></span></span><span class="hljs-class">() {           </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dep</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">depend</span></span></span><span class="hljs-class">() //    </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">target</span></span></span><span class="hljs-class">           </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">internalValue</span></span></span><span class="hljs-class">       },       set(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">newVal</span></span></span><span class="hljs-class">) {           </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">internalValue</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">newVal</span></span></span><span class="hljs-class">           </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dep</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">notify</span></span></span><span class="hljs-class">() //           }   }) }) //   watcher   dep.depend(), //        function watcher(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">myFunc</span></span></span><span class="hljs-class">){   </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">target</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">myFunc</span></span></span><span class="hljs-class">   </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">target</span></span></span><span class="hljs-class">()   </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">target</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">null</span></span></span><span class="hljs-class"> } watcher(() =&gt; {   </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">total</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class"> * </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">quantity</span></span></span><span class="hljs-class"> })</span></span></code> </pre> <br>  Essayons avec ce code dans la console du navigateur. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2bc/47f/c10/2bc47fc1035298c26eb1dfd84d72e738.png"></div><br>  <i><font color="#999999">Exp√©riences de code pr√™t</font></i> <br><br>  Comme vous pouvez le voir, cela fonctionne exactement comme nous en avons besoin!  Les propri√©t√©s de <code>price</code> et de <code>quantity</code> sont devenues r√©actives!  Tout le code responsable de la g√©n√©ration du <code>total</code> lorsque le <code>price</code> ou la <code>quantity</code> change est ex√©cut√© √† plusieurs reprises. <br><br>  Maintenant, apr√®s avoir √©crit notre propre syst√®me de r√©activit√©, cette illustration de la documentation Vue vous semblera famili√®re et compr√©hensible. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f1e/a0d/193/f1ea0d19322cee657e9b130cbd491e65.png"></div><br>  <i><font color="#999999">Syst√®me de r√©activit√© Vue</font></i> <br><br>  Voir ce beau cercle violet qui dit <code></code> contenant des getters et setters?  Maintenant, il devrait vous √™tre familier.  Chaque instance du composant a une instance de la m√©thode observateur (cercle bleu), qui collecte les d√©pendances sur les getters (ligne rouge).  Lorsque, plus tard, le setter est appel√©, il notifie la m√©thode observateur, ce qui conduit au re-rendu du composant.  Voici le m√™me sch√©ma, fourni avec des explications le reliant √† notre d√©veloppement. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/276/fb4/6db/276fb46db5618c8a08428c5c1914e988.png"></div><br>  <i><font color="#999999">Diagramme de r√©activit√© Vue avec explications</font></i> <br><br>  Nous pensons que maintenant, apr√®s avoir √©crit notre propre syst√®me de r√©activit√©, ce sch√©ma n'a pas besoin d'explications suppl√©mentaires. <br><br>  Bien s√ªr, dans Vue, tout cela est plus compliqu√©, mais maintenant vous devez comprendre le m√©canisme sous-jacent aux syst√®mes de r√©activit√©. <br><br><h2>  <font color="#3AC1EF">R√©sum√©</font> </h2><br>  Apr√®s avoir lu ce mat√©riel, vous avez appris ce qui suit: <br><br><ul><li>  Comment cr√©er une classe <code>Dep</code> qui collecte des fonctions √† l'aide de la m√©thode <code>depend</code> et, si n√©cessaire, les appelle √† nouveau √† l'aide de la m√©thode <code>notify</code> . </li><li>  Comment cr√©er une fonction d' <code>watcher</code> qui vous permet de contr√¥ler le code que nous ex√©cutons (c'est la fonction <code>target</code> ), que vous devrez peut-√™tre enregistrer dans l'objet de la classe <code>Dep</code> . </li><li>  Comment utiliser la m√©thode <code>Object.defineProperty()</code> pour cr√©er des getters et des setters. </li></ul><br>  Tout cela, compil√© dans un seul exemple, a conduit √† la cr√©ation d'un syst√®me de r√©activit√© en JavaScript pur, en comprenant que vous pouvez comprendre les caract√©ristiques du fonctionnement de tels syst√®mes utilis√©s dans les frameworks web modernes. <br><br>  <b>Chers lecteurs!</b>  Si, avant de lire ce mat√©riel, vous avez mal imagin√© les caract√©ristiques des m√©canismes des syst√®mes de r√©activit√©, dites-moi, avez-vous maintenant r√©ussi √† y faire face? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr418633/">https://habr.com/ru/post/fr418633/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr418621/index.html">Pourquoi concevoir des comp√©tences g√©n√©rales</a></li>
<li><a href="../fr418625/index.html">Appel secret √† Andy Grove qui a aid√© Apple √† acheter le NeXT</a></li>
<li><a href="../fr418627/index.html">En savoir plus sur les m√©thodes de r√©solution de syst√®mes d'√©quations alg√©briques lin√©aires</a></li>
<li><a href="../fr418629/index.html">Comment v√©rifier ind√©pendamment si vous pouvez breveter votre produit et effectuer une recherche de brevets</a></li>
<li><a href="../fr418631/index.html">7 directives de code javascript</a></li>
<li><a href="../fr418635/index.html">Cr√©ation d'une machine d'arcade d'√©mulation. Partie 1</a></li>
<li><a href="../fr418637/index.html">Kubernetes aux masses: Slurm d√©marre le 3 ao√ªt</a></li>
<li><a href="../fr418639/index.html">Akka Streams pour les simples mortels</a></li>
<li><a href="../fr418641/index.html">Une erreur qui emp√™che un designer de grandir</a></li>
<li><a href="../fr418643/index.html">Assis vs debout: comment mieux travailler?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>