<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💓 🤵🏿 🤱🏼 En-tête d'objet Java 🥖 👨🏿‍✈️ 👨🏿‍🍳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vous êtes-vous déjà demandé à quoi ressemblent les objets java de l'intérieur? 
 Sous le chat, il y aura une description détaillée de l'en-tête de l'o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>En-tête d'objet Java</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447848/"><p>  Vous êtes-vous déjà demandé à quoi ressemblent les objets java de l'intérieur? <br>  Sous le chat, il y aura une description détaillée de l'en-tête de l'objet Java, de sa composition et de la quantité de mémoire nécessaire. </p><a name="habracut"></a><br><p>  Pour commencer, rappelez-vous qu'en jvm, tout objet en mémoire est constitué de l'en-tête d'objet et des variables d'objet (liens et primitives).  De plus, la taille finale de l'objet peut être étendue pour devenir un multiple de 8 octets. </p><br><p>  Le titre de chaque objet (à l'exception du tableau) se compose de deux mots machine - <strong>mot de marque</strong> et <strong>mot de classe</strong> .  Les tableaux ont 32 bits supplémentaires pour décrire la longueur du tableau. </p><br><p>  <em>Mark Word</em> stocke le code de hachage d'identité, les bits utilisés par le garbage collector et les bits utilisés pour les verrous.  Vous pouvez toujours trouver plus de détails dans les <a href="">tris</a> OpenJDK correspondants <a href="">markOop.hpp</a> . </p><br><p>  Un <em>mot de classe</em> stocke un pointeur vers la classe elle-même, c'est-à-dire vers l'endroit où se trouvent les informations sur ce type de données: méthodes, annotations, héritage, etc.  Plus de détails peuvent également toujours être trouvés dans les <a href="">sortes</a> OpenJDK correspondantes <a href="">de klass.hpp</a> . </p><br><p>  Examinons maintenant de plus près le <em>titre de l'objet,</em> et en particulier <em>le mot de repère</em> </p><br><h2 id="32-bitnye-jvm">  Jvm 32 bits </h2><br><p><img src="https://habrastorage.org/webt/ic/95/vd/ic95vdspq0wgsolqgrwonbgodwo.png" alt="JVM 32 bits"></p><br><p>  Comme vous pouvez le voir dans le tableau, le contenu du <em>mot Mark</em> peut varier considérablement en fonction de l'état actuel de l'objet. </p><br><h4 id="normalnoe-sostoyanie-obekta-biased_lock--0-lock--01">  État normal de l'objet (polared_lock = 0, lock = 01) </h4><br><ul><li>  identity_hashcode est le hachage d'un objet qui apparaît paresseusement.  Si l'objet a un appel System.identityHashCode (obj) pour la première fois, ce hachage sera calculé et écrit dans l'en-tête de l'objet. <br>  Dans d'autres états, lorsque différents flux sont en concurrence pour un objet, le code d'identité_hashcode sera stocké non pas dans l'en-tête de l'objet, mais dans le moniteur de l'objet. </li><li>  âge - le nombre de collectes d'ordures enregistrées.  Lorsque l'âge atteint le nombre maximal de tenure, <br>  l'objet se déplace vers la hanche de l'ancienne génération. </li><li>  polared_lock - contient 1 si le verrouillage biaisé est activé pour cet objet, sinon 0. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Un peu plus</b> <div class="spoiler_text"><blockquote>  Lorsque le verrouillage biaisé est activé, l'objet se déplace comme s'il s'agissait du premier objet qui a capturé son moniteur.  La capture ultérieure de l'objet dans le même flux sera légèrement plus rapide. <br><br>  Voici les prérequis théoriques de base pour ce verrou: <br><ul><li>  Tout au long de la vie d'un objet, il appartient principalement à un flux </li><li>  Si le thread a récemment utilisé un verrou sur cet objet, le cache du processeur contiendra probablement les données qui seront nécessaires pour recapturer cet objet. </li></ul><br><br>  Le verrouillage biaisé est activé par défaut depuis java 6, -XX: -UseBiasLocking </blockquote></div></div><br><ul><li>  lock - contient le code d'état du verrou.  00 - Léger verrouillé, 01 - Déverrouillé ou biaisé, 10 - Lourd verrouillé, 11 - Marqué pour la collecte des ordures. </li></ul><br><p>  Autrement dit, dans le tableau, l'état d'un objet est déterminé par la combinaison des bits de verrouillage biaisé et de verrouillage. </p><br><h4 id="rezhim-biased-locked-biased_lock--1-lock--01">  Mode verrouillé biaisé (polared_lock = 1, lock = 01) </h4><br><ul><li>  thread - en mode de verrouillage biaisé, on suppose que l'objet appartient principalement à un thread particulier, l'ID de ce thread est stocké dans le champ. </li><li>  epoch contient un indicateur temporaire de propriété de l'objet par un thread dont l'id est stocké dans le thread </li></ul><br><h4 id="rezhim-lightweight-locked-lock--00">  Mode verrouillé léger (verrou = 00) </h4><br><p>  Dans ce mode, on suppose que le temps de capture par cet objet par différents flux ne se coupe pas du tout ou ne se chevauche pas de manière insignifiante.  Dans ce mode, au lieu de bloquer lourdement le système d'exploitation, la JVM utilise l'atomique. </p><br><ul><li>  ptr_to_lock_record - CAS (comparer et définir) à l'intérieur de la boucle de rotation est utilisé pour définir / attendre un verrou. <br>  À titre de référence, le temps de blocage minimal du système d'exploitation sera d'environ 10 ms, à l'aide de l'atomique, le flux ne s'endort pas, mais continue de battre un petit cycle, et dès que la ressource est libre, le cycle atomique se termine et le flux capture immédiatement cet objet. </li></ul><br><h4 id="rezhim-heavyweight-locked-lock--10">  Mode verrouillé lourd (verrou = 10) </h4><br><ul><li>  ptr_to_heavyweight_monitor - si le temps de capture de cet objet avec différents flux se chevauchent de manière significative, le verrou léger sera remplacé par un verrou lourd.  Un pointeur vers le moniteur sera écrit dans ptr_to_heavyweight_monitor.  Le verrouillage du système d'exploitation est utilisé. </li></ul><br><p>  Ainsi, en jvm 32 bits, l'en-tête de l'objet se compose de 8 octets.  Les tableaux ont en outre 4 octets. </p><br><h2 id="64-bitnye-jvm">  Jvm 64 bits </h2><br><p><img src="https://habrastorage.org/webt/gz/hm/ks/gzhmksgyzo2rowjnnm85g62ldu4.png" alt="JVM 64 bits"></p><br><p>  Sur un jvm 64 bits, l'en-tête d'objet se compose de 16 octets.  Les tableaux ont en outre 4 octets. </p><br><h2 id="64-bitnye-jvm-s-szhatiem-ukazateley">  Jvm 64 bits avec compression de pointeur </h2><br><p><img src="https://habrastorage.org/webt/xt/58/lp/xt58lpwwgpxsxky_gjwivje0ub0.png" alt="Coops JVM 64 bits"></p><br><p>  Un en-tête d'objet se compose de 12 octets.  Les tableaux ont en outre 4 octets. </p><br><p>  Un peu sur la compression du pointeur.  Pour un pointeur 32 bits, l'espace d'adressage est limité à 4 Go.  Cependant, si nous rappelons à nouveau qu'en jvm, la taille d'un objet est un multiple de 8 octets, alors nous pouvons utiliser un pseudo pointeur de 35 bits, avec trois zéros à la fin.  Et, par conséquent, faites déjà référence à 32 Go de mémoire.  La compression n'est pas gratuite, le prix est une opération supplémentaire (pointeur &lt;&lt; 3) pour tout appel à tas. </p><br><h4 id="ssylka-na-originalnuyu-statyu">  Lien vers l'article d'origine: </h4><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">En-tête d'objet Java</a> </p><br><p>  Je voudrais également ajouter que tout ce qui est décrit ici n'est pas un dogme, peut-être que dans d'autres versions de jvm le titre de l'objet sera différent.  Décrit ici est pertinent pour openjdk 8. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr447848/">https://habr.com/ru/post/fr447848/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr447834/index.html">Détruisez en 9 secondes. Comment un algorithme inconnu a détruit IPO BATS</a></li>
<li><a href="../fr447836/index.html">Essai routier nanoCAD SPDS Metalwork 1.2. Partie 1</a></li>
<li><a href="../fr447838/index.html">Comment les technologies IoT vont changer le monde au cours des 10 prochaines années</a></li>
<li><a href="../fr447842/index.html">Microbiota. Qu'est-ce que cet organe et pourquoi en avons-nous besoin</a></li>
<li><a href="../fr447844/index.html">Evrone et DataArt organisent une série de mitaps à Voronej</a></li>
<li><a href="../fr447850/index.html">Sergey Golubev: «La meilleure chose qui puisse être faite pour OSM maintenant est de prendre une décharge de la planète, de la supprimer et de tout recommencer»</a></li>
<li><a href="../fr447852/index.html">Google+ est mort. Et alors?</a></li>
<li><a href="../fr447854/index.html">Huit erreurs que j'ai faites quand j'étais junior</a></li>
<li><a href="../fr447856/index.html">Comment vendre une fenêtre sans jumelage ou l'importance du positionnement avant de développer un site</a></li>
<li><a href="../fr447860/index.html">Thermodynamique des trous noirs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>