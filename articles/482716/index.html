<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äçü§ù‚Äçüë®üèΩ üé¨ üë®‚Äçüè´ Desarrollo de una placa de depuraci√≥n para K1986BE1QI (aire) üë®üèø‚Äçüè´ üéÑ üå¶Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hace unos a√±os, me reun√≠ con los microcontroladores rusos de Milander. Era 2013, cuando los ingenieros discutieron en√©rgicamente los primeros resultad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Desarrollo de una placa de depuraci√≥n para K1986BE1QI (aire)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482716/"><img src="https://habrastorage.org/webt/xa/8d/4m/xa8d4m3m5jgwavt_34l7oj8abfi.jpeg" alt="Junta de depuraci√≥n MDB1986"><br><br>  Hace unos a√±os, me reun√≠ con los microcontroladores rusos de Milander.  Era 2013, cuando los ingenieros discutieron en√©rgicamente los primeros resultados del Programa Federal de objetivos "Desarrollo de la base de componentes electr√≥nicos y radioelectr√≥nica" para 2008-2015.  En ese momento, el controlador K1986BE9x (n√∫cleo Cortex-M3) ya se lanz√≥ y el controlador 1986BE1T (n√∫cleo Cortex-M1) acaba de aparecer.  √âl en la caja de pl√°stico LQFP-144 ten√≠a la designaci√≥n K1986BE1QI (aviaci√≥n), y en el chip en s√≠ la designaci√≥n MDR32F1QI.  En el sitio web del fabricante tiene el sufijo "avia", ya que tiene interfaces espec√≠ficas para la industria aeron√°utica (ARINC 429, MIL_STD_1553). <a name="habracut"></a><br><br>  Sorprendentemente, en el momento de la distribuci√≥n de estos controladores, la compa√±√≠a Milander prepar√≥ kits de depuraci√≥n y una biblioteca de subprogramas para trabajar con perif√©ricos, "pero sin garant√≠as y obligaciones adicionales con respecto a la correcci√≥n de la biblioteca".  La biblioteca es similar a la Biblioteca perif√©rica est√°ndar de STMicroelectronics.  En general, todos los controladores ARM construidos en el n√∫cleo Cortex-M tienen mucho en com√∫n.  Por esta raz√≥n, el conocimiento de los nuevos controladores rusos fue r√°pido.  Y para aquellos que compraron kits de depuraci√≥n de marca, se proporcion√≥ soporte t√©cnico durante el uso. <br><br><img src="https://habrastorage.org/webt/36/-5/cu/36-5cuhduqbdylqea5diodzri2o.png"><br>  <i>Kit de depuraci√≥n para el microcontrolador 1986BE1T, ¬© Milander</i> <br><br>  Sin embargo, con el tiempo, comenzaron a aparecer "enfermedades infantiles" de nuevos microcircuitos y bibliotecas.  Los ejemplos de prueba de firmware funcionaron sin problemas visibles, pero con una modificaci√≥n significativa, se produjeron bloqueos y errores.  El primer "trago" en mi pr√°ctica fueron fallas inexplicables en la operaci√≥n del controlador CAN.  Un a√±o despu√©s, en el controlador de auditor√≠a temprana 1986BE1T (aire), se detect√≥ un problema con el m√≥dulo <a href="https://ru.wikipedia.org/wiki/MIL-STD-1553" rel="nofollow">MKIO (canal de intercambio de informaci√≥n multiplexado)</a> .  En general, todas las revisiones de estos microcontroladores hasta 2016 fueron de uso limitado.  Tom√≥ mucho tiempo y nervios identificar estos problemas, cuya confirmaci√≥n ahora se puede encontrar en las <a href="https://ic.milandr.ru/upload/iblock/352/352a1573c08c406a94b976ed95fe4506.pdf" rel="nofollow">listas de errores (Errata)</a> . <br><br>  Una caracter√≠stica desagradable era que era necesario trabajar y lidiar con los errores no en las placas de depuraci√≥n, sino en las placas prototipo de los dispositivos que estaban planificados para la producci√≥n en serie.  Aparte del conector JTAG, generalmente no hab√≠a nada all√≠.  Conectarse con un analizador l√≥gico fue dif√≠cil e inconveniente, y generalmente no hab√≠a LED ni pantallas.  Por esta raz√≥n, pens√© en crear mi propio tablero de depuraci√≥n. <br><br>  Por un lado, hab√≠a kits de depuraci√≥n de marca en el mercado, as√≠ como maravillosos tableros de LDM-Systems de Zelenograd.  Por otro lado, los precios de estos productos se convierten en un estupor, y la funcionalidad b√°sica sin tarjetas de expansi√≥n no cumple con las expectativas.  Una placa con un controlador soldado y un conector pin no me interesa.  Y los tableros m√°s interesantes son caros. <br><br><img src="https://habrastorage.org/webt/6u/ob/ww/6uobww_tvc36dmyyhcmemgkedhg.jpeg"><br>  <i>Tarjeta de depuraci√≥n MILANDR LDM-HELPER-K1986BE1QI-FULL, ¬© LDM Systems</i> <br><br>  Los precios y el marketing de la empresa "Milander" son peculiares.  Por lo tanto, es posible obtener muestras gratuitas de algunos microcircuitos, pero esto est√° disponible solo para personas jur√≠dicas y est√° asociado con una b√∫squeda burocr√°tica.  En general, los microcircuitos en una caja de metal y cer√°mica son dorados en un sentido directo y figurado.  Por ejemplo, el controlador 1986BE1T cuesta de 14 a 24 mil rublos en Mosc√∫.  El chip de memoria est√°tica 1645RU6U cuesta desde 15,000 rublos.  Y tal orden de precios para todos los productos.  Como resultado, incluso los institutos de investigaci√≥n especializados con √≥rdenes estatales ahorran y evitan esos precios.  Los microcircuitos en una caja de pl√°stico para uso civil son significativamente m√°s baratos, pero no est√°n disponibles en proveedores populares.  Adem√°s, me parece que la calidad de los microcircuitos en una caja de pl√°stico es peor que los "dorados".  Por ejemplo, no podr√≠a iniciar el controlador K1986BE1QI a una frecuencia de 128 MHz sin aumentar el par√°metro de latencia de flash.  Al mismo tiempo, la temperatura de este controlador aument√≥ a 40-50 ¬∞ C.  Pero el controlador 1986BE1T ("dorado") se lanz√≥ a 128 MHz sin configuraciones adicionales y permaneci√≥ fr√≠o.  El es realmente bueno. <br><br><img src="https://habrastorage.org/webt/hm/hd/vm/hmhdvmzvhpvw7ujz09cw5ol49ou.png"><br>  <i>Microcontrolador "Golden" 1986BE1T, (c) Milander</i> <br><br>  Tuve la suerte de que un microcontrolador en una caja de pl√°stico todav√≠a se puede comprar al por menor en LDM Systems, y todas las placas de circuitos est√°n disponibles gratuitamente.  Lo malo es que en el sitio en la foto del controlador hay una marca que dice que esta es la cuarta revisi√≥n de 2014, es decir  con defectos  Pens√© durante mucho tiempo: comprar o no comprar.  As√≠ pasaron varios a√±os ... <hr><br><br>  La idea de crear una placa de depuraci√≥n no ha desaparecido.  Poco a poco, form√© todos los requisitos y pens√© c√≥mo poner todo esto en una sola placa, para que fuera compacta y no costosa.  Paralelamente, orden√© los componentes faltantes a los chinos.  No ten√≠a prisa, hice todo por m√≠ mismo.  Los proveedores chinos son famosos por su descuido: tuve que pedir lo mismo en diferentes lugares para obtener todo lo que necesitaba.  Adem√°s, algunos de los microcircuitos de memoria resultaron estar en uso, obviamente evaporados de dispositivos rotos.  Esto volvi√≥ a m√≠ m√°s tarde. <br><br>  Comprar un microcontrolador Milander K1986BE1QI (avia) no es una tarea f√°cil.  En la misma tienda de Chip and Dip, en la secci√≥n "Pedidos de art√≠culos", encontr√© solo el K1986BE92QI por 740 rublos, pero no me conven√≠a.  La √∫nica opci√≥n es comprar en LDM-Systems por 2,000 rublos, no una nueva revisi√≥n.  Como no pude encontrar un reemplazo en ning√∫n otro lugar, decid√≠ comprar lo que era.  Para mi agradable sorpresa, me vendieron un nuevo controlador de lanzamiento de diciembre de 2018, revisi√≥n 6+ (1820).  Y el sitio todav√≠a tiene una foto antigua, y al momento de escribir, el controlador no est√° disponible ... <br><br><img src="https://habrastorage.org/webt/cr/p3/eu/crp3euoxhtfbkqo_pzet4vjencs.jpeg"><br>  <i>Microcontrolador K1986BE1QI (avia) en envases tecnol√≥gicos, (c) - Foto de</i> <br><br>  Las principales especificaciones t√©cnicas de mi <b>placa de</b> depuraci√≥n <b>MDB1986 son las</b> siguientes: <br><br><ul><li>  programador-depurador incorporado compatible con J-Link y CMSIS-DAP; </li><li>  Memoria est√°tica de 4Mbit (256k x 16, 10 ns); </li><li>  Chip de memoria flash de 64Mbit, Winbond 25Q64FVSIG; </li><li>  Transceptor de interfaz RS-232 con l√≠neas RTS y CTS; </li><li>  interfaces y conectores para Ethernet, USB, CAN; </li><li>  Controlador de pantalla de 7 segmentos MAX7221 </li><li>  conector pin para trabajar con MKIO (MIL_STD_1553) y ARINC429; </li><li>  Everlight PT17-21C Fototransistor; </li><li>  cinco LED de color, un bot√≥n de reinicio y dos botones de usuario; </li><li>  alimentado por puerto USB de 5 voltios; </li><li>  Dimensiones de PCB 100 x 80 mm </li></ul><br>  Me gustaron las placas de la serie STM-Discovery porque hay un programador de depuraci√≥n incorporado: ST-Link.  La marca ST-Link solo funciona con controladores de STMicroelectronics, pero hace un par de a√±os se hizo posible actualizar el firmware en ST-Link y obtener un depurador SEGGER J-Link OB (en placa).  Legalmente, existe una restricci√≥n en el uso de dicho depurador solo con placas STMicroelectronics, pero de hecho, el potencial no est√° limitado.  Por lo tanto, al tener un J-Link OB, puede tener un depurador incorporado en la placa de depuraci√≥n.  Observo que en los productos de "LDM-Systems" se usa el convertidor CP2102 (Usb2Uart), que solo puede parpadear. <br><br><img src="https://habrastorage.org/webt/fq/yd/6z/fqyd6z1yxuwig0mw46du7l0pu8y.jpeg"><br>  <i>Microcontroladores STM32F103C8T6, reales y no tan, (c) Foto de</i> <br><br>  Por lo tanto, fue necesario comprar el STM32F103C8T6 original, ya que el firmware propietario no funcionar√° correctamente con el clon.  Dudaba de esta tesis y decid√≠ probar el controlador CS32F103C8T6 de la compa√±√≠a china CKS en funcionamiento.  No tengo quejas sobre el controlador en s√≠, pero el firmware ST-Link no funcionaba en √©l.  J-Link funcion√≥ parcialmente: se detect√≥ el dispositivo USB, pero el programador no realiz√≥ sus funciones y record√≥ constantemente que estaba "defectuoso". <br><br><img src="https://habrastorage.org/webt/sh/dp/zs/shdpzs1rrvs4ndpodfxgykmxoqk.png"><br>  <i>Error al trabajar con el depurador en un controlador no original</i> <br><br>  No me tranquilic√© con esto y primero escrib√≠ el firmware para que el LED parpadeara, y luego me di cuenta de la solicitud IDCODE utilizando el protocolo JTAG.  El programador ST-Link que ten√≠a en la placa Discovery y el programa ST-Link Utility parpadeaban CS32F103C8T6 sin problemas. Como resultado, me asegur√© de que mi placa funcionara.  Para mi alegr√≠a, el controlador de destino K1986BE1QI (avia) emiti√≥ alegremente su IDCODE a trav√©s de la l√≠nea TDO. <br><br><img src="https://habrastorage.org/webt/mg/cd/6b/mgcd6bodfiolhoncf0dqpy_ztyi.png"><br>  <i>Oscilograma de l√≠nea de se√±al TDO con respuesta codificada IDCODE, (c) - Foto de</i> <br><br><img src="https://habrastorage.org/webt/ls/9b/hk/ls9bhkuow-fz1gir-e48kwyld2i.png"><br>  <i>Por lo tanto, el puerto SWD fue √∫til para depurar el depurador y verificar IDCODE</i> <br><br>  Hab√≠a una variante con el depurador <a href="https://arm-software.github.io/CMSIS_5/DAP/html/index.html" rel="nofollow">CMSIS-DAP (puerto de acceso de depuraci√≥n)</a> .  Construir un proyecto a partir del c√≥digo fuente de ARM no es una tarea f√°cil, tom√© el proyecto de <a href="https://habr.com/ru/users/x893/" class="user_link">X893</a> y luego prob√© DAP42.  Desafortunadamente, Keil uVision colg√≥ y no quiso trabajar con ellos.  Como resultado, reemplac√© el chip del depurador con el STM32F103C8T6 patentado y ya no volv√≠ a este problema. <br><br><img src="https://habrastorage.org/webt/qd/ry/fs/qdryfsbagp3hggtvmrl0tiym-dg.png"><br>  <i>Exitoso depurador J-Link STLink V2</i> <br><br>  Cuando todos los componentes clave de la futura placa de depuraci√≥n estaban en stock, sub√≠ a Eagle CAD y descubr√≠ que no estaban en la biblioteca de elementos.  Ning√∫n lugar a donde ir: ten√≠an que dibujarse.  Al mismo tiempo, hice huellas para la memoria, el conector HanRun para Ethernet y agregu√© marcos para resistencias y condensadores.  El archivo del proyecto y la biblioteca de componentes se pueden encontrar <a href="https://github.com/makbit/MDB1986" rel="nofollow">en mi GitHub</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Diagrama esquem√°tico de la placa de depuraci√≥n MDB1986</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/hx/44/jy/hx44jyp0pkskpjgb1zh-1tf6hfu.png"></div></div><br><br>  La placa est√° alimentada por una fuente de CC de 5 voltios, obtenida del puerto USB.  Hay dos puertos USB tipo B en la placa.  Uno es para el programador, el segundo es para el controlador K1986BE1QI.  La placa puede funcionar desde cualquiera de estas fuentes o con ambas al mismo tiempo.  El control de carga m√°s simple y la protecci√≥n de las l√≠neas el√©ctricas se implementan en los diodos Schottky, en el circuito D2 y D3 (SS24).  Tambi√©n en el diagrama puede ver los fusibles autorreparables F1 y F2 a 500 mA.  Las l√≠neas de se√±al del puerto USB est√°n protegidas por un conjunto de diodos USBLC6-2SC6. <br><br>  El circuito del depurador-programador ST-Link es conocido por muchos, se puede encontrar en la documentaci√≥n para placas STM32-Discovery y otras fuentes.  Para el firmware inicial del clon ST-Link / J-Link-OB / DAP (opcional), saqu√© las l√≠neas SWDIO (PA13), SWCLK (PA14), GND.  Muchas personas usan UART para firmware y se ven obligadas a tirar de los puentes de ARRANQUE.  Pero SWD es m√°s conveniente para m√≠, adem√°s, este protocolo permite la depuraci√≥n. <br><br>  Casi todos los componentes de la placa funcionan con 3,3 voltios, que provienen del regulador de voltaje AMS1117-3.3.  Para suprimir la interferencia electromagn√©tica y las corrientes de entrada, se utilizan filtros LC de condensadores y estranguladores de la serie BLM31PG. <br><br>  Tambi√©n deber√≠amos mencionar el controlador para la pantalla de 7 segmentos MAX7221.  Seg√∫n la especificaci√≥n, la fuente de alimentaci√≥n recomendada es de 4 a 5,5 voltios, y el alto nivel de se√±al (unidad l√≥gica) es de al menos 3,5 V (0,7 x VCC), con una fuente de alimentaci√≥n de 5 V.  Para el controlador K1986BE1QI (avia), la salida de una unidad l√≥gica corresponde a un voltaje de 2.8 a 3.3V.  Obviamente, hay una falta de coincidencia de los niveles de se√±al que pueden interferir con el funcionamiento normal.  Decid√≠ alimentar el MAX7221 desde 4V y bajar los niveles de se√±al a 2.8V (0.7 x 4 = 2.8).  Para hacer esto, el diodo D4 (RS1A o FR103) se instala en serie con el circuito de alimentaci√≥n del controlador.  La ca√≠da de voltaje total es de 0.9V (diodo Schottky 0.3V y diodo 0.6V), y todo funciona. <br><br>  La mayor√≠a de los puertos del microcontrolador K1986BE1QI (avia) son compatibles con se√±ales de hasta 5V.  Por lo tanto, el uso del transceptor CAN MCP2551, que tambi√©n funciona con 5V, no causa problemas.  El chip MAX3232 se indica en el diagrama como un transceptor RS-232, pero de hecho utilic√© SN65C3232D de Texas Instruments, porque  Funciona desde 3.3V y proporciona velocidades de hasta 1Mbit / s. <br><br>  Hay 4 resonadores de cuarzo en el tablero, uno para el depurador (8 MHz) y tres para el microcontrolador objetivo K1986BE1QI (avia) con valores de 32.768 kHz, 16 MHz, 25 MHz.  Estos son componentes necesarios, como  Los par√°metros del generador RC incorporado est√°n en un amplio rango de 6 a 10 MHz.  Es necesaria una frecuencia de 25 MHz para el funcionamiento del controlador Ethernet integrado.  En el sitio de Milander (quiz√°s por error) por alguna raz√≥n se indica que no hay Ethernet en la caja de pl√°stico.  Pero confiaremos en la especificaci√≥n y los hechos. <br><br>  Un incentivo importante para crear su propia placa de depuraci√≥n fue la capacidad de trabajar con el bus de sistema externo EBC (controlador de bus externo), que es esencialmente un puerto paralelo.  El microcontrolador K1986BE1QI (avia) le permite conectarse y trabajar con chips de memoria externa y perif√©ricos, por ejemplo, ADC, FPGA, etc.  Las capacidades del bus del sistema externo son bastante grandes: puede trabajar con RAM est√°tica de 8 bits, 16 bits y 32 bits, ROM y Flash NAND.  Para leer / escribir datos de 32 bits, el controlador puede realizar autom√°ticamente 2 operaciones correspondientes para circuitos de 16 bits y para 8 bits - 4 operaciones.  Obviamente, una operaci√≥n de E / S de 32 bits ser√° la m√°s r√°pida con el bus de datos de 32 bits.  Las desventajas incluyen la necesidad de que el programa funcione con datos de 32 bits, y se deben colocar 32 pistas en el tablero. <br><br><img src="https://habrastorage.org/webt/oh/sf/n8/ohsfn8vpr98krnms8rohx6l-bjs.jpeg"><br>  <i>Us√≥ chips de RAM est√°tica (adivine cu√°l es defectuoso)</i> <br><br>  Una soluci√≥n equilibrada es usar chips de memoria de 16 bits.  Tengo Integrated Silicon Solutions Inc.  (ISSI IS61LV25616AL, 16 x 256k, 10 ns, 3.3V).  Por supuesto, la compa√±√≠a Milander tiene su propia <a href="https://ic.milandr.ru/products/mikroskhemy_pamyati/" rel="nofollow">serie 1645RU de chips de</a> memoria est√°tica, pero son demasiado caros e inaccesibles.  Alternativamente, hay Samsung K6R4016V1D pin compatibles.  Anteriormente, mencion√© que los microcircuitos resultaron estar en uso y la instancia que instal√© inicialmente dio fallas y valores ca√≥ticos en la l√≠nea de datos 15.  Tard√≥ varios d√≠as en buscar errores de hardware, y mayor fue la sensaci√≥n de satisfacci√≥n cuando reemplac√© el chip da√±ado por uno que funcionaba.  Sea como fuere, la velocidad de trabajar con memoria externa deja mucho que desear. <br><br><div class="spoiler">  <b class="spoiler_title">Bus externo y modo StandAlone</b> <div class="spoiler_text">  El microcontrolador K1986BE1QI (avia) tiene un modo StandAlone √∫nico, que est√° dise√±ado para acceso externo directo a controladores Ethernet y MKIO (MIL_STD_1553) a trav√©s de un bus externo, y el n√∫cleo est√° en un estado de reinicio, es decir.  no utilizado  Este modo es conveniente para procesadores y FPGA en los que no hay Ethernet y / o MKIO. </div></div><br>  El diagrama de conexi√≥n es el siguiente: <br><br><ul><li>  Bus de datos MCU (D0-D15) =&gt; SRAM (I / O0-I / O15), </li><li>  bus de direcci√≥n MCU (A1-A18) =&gt; SRAM (A0-A17), </li><li>  Control de MCU (nWR, nRD, PortC2) =&gt; SRAM (WE, OE, CE), </li><li>  SRAM (UB, LB) conectado o tirado a tierra a trav√©s de una resistencia. </li></ul><br>  La l√≠nea CE se activa mediante una resistencia; los pines para la selecci√≥n de bytes MCU (BE0-BE3) no se utilizan.  Debajo del spoiler, cito el c√≥digo de inicializaci√≥n del puerto y el controlador de bus externo. <br><br><div class="spoiler">  <b class="spoiler_title">Inicializaci√≥n de puertos y controlador EBC (controlador de bus externo)</b> <div class="spoiler_text"><pre><code class="plaintext hljs">void SRAM_Init (void) { EBC_InitTypeDef EBC_InitStruct = { 0 }; EBC_MemRegionInitTypeDef EBC_MemRegionInitStruct = { 0 }; PORT_InitTypeDef initStruct = { 0 }; RST_CLK_PCLKcmd (RST_CLK_PCLK_EBC, ENABLE); PORT_StructInit (&amp;initStruct); //--------------------------------------------// // DATA PA0..PA15 (D0..D15) // //--------------------------------------------// initStruct.PORT_MODE = PORT_MODE_DIGITAL; initStruct.PORT_PD_SHM = PORT_PD_SHM_ON; initStruct.PORT_SPEED = PORT_SPEED_FAST; initStruct.PORT_FUNC = PORT_FUNC_MAIN; initStruct.PORT_Pin = PORT_Pin_All; PORT_Init (MDR_PORTA, &amp;initStruct); //--------------------------------------------// // Address PF3-PF15 (A0..A12), A0 - not used. // //--------------------------------------------// initStruct.PORT_FUNC = PORT_FUNC_ALTER; initStruct.PORT_Pin = PORT_Pin_4 | PORT_Pin_5 | PORT_Pin_6 | PORT_Pin_7 | PORT_Pin_8 | PORT_Pin_9 | PORT_Pin_10 | PORT_Pin_11 | PORT_Pin_12 | PORT_Pin_13 | PORT_Pin_14 | PORT_Pin_15; PORT_Init (MDR_PORTF, &amp;initStruct); //--------------------------------------------// // Address PD3..PD0 (A13..A16) // //--------------------------------------------// initStruct.PORT_FUNC = PORT_FUNC_OVERRID; initStruct.PORT_Pin = PORT_Pin_0 | PORT_Pin_1 | PORT_Pin_2 | PORT_Pin_3; PORT_Init (MDR_PORTD, &amp;initStruct); //--------------------------------------------// // Address PE3, PE4 (A17, A18) // //--------------------------------------------// initStruct.PORT_FUNC = PORT_FUNC_ALTER; initStruct.PORT_Pin = PORT_Pin_3 | PORT_Pin_4; PORT_Init (MDR_PORTE, &amp;initStruct); //--------------------------------------------// // Control PC0,PC1 (nWE,nOE) // //--------------------------------------------// initStruct.PORT_FUNC = PORT_FUNC_MAIN; initStruct.PORT_Pin = PORT_Pin_0 | PORT_Pin_1; PORT_Init (MDR_PORTC, &amp;initStruct); //--------------------------------------------// // Control PC2 (nCE) // //--------------------------------------------// initStruct.PORT_PD = PORT_PD_DRIVER; initStruct.PORT_OE = PORT_OE_OUT; initStruct.PORT_FUNC = PORT_FUNC_PORT; initStruct.PORT_Pin = MDB_SRAM_CE; PORT_Init (MDR_PORTC, &amp;initStruct); //--------------------------------------------// // Initialize EBC controler // //--------------------------------------------// EBC_DeInit(); EBC_StructInit(&amp;EBC_InitStruct); EBC_InitStruct.EBC_Mode = EBC_MODE_RAM; EBC_InitStruct.EBC_WaitState = EBC_WAIT_STATE_3HCLK; EBC_InitStruct.EBC_DataAlignment = EBC_EBC_DATA_ALIGNMENT_16; EBC_Init(&amp;EBC_InitStruct); EBC_MemRegionStructInit(&amp;EBC_MemRegionInitStruct); EBC_MemRegionInitStruct.WS_Active = 2; EBC_MemRegionInitStruct.WS_Setup = EBC_WS_SETUP_CYCLE_1HCLK; EBC_MemRegionInitStruct.WS_Hold = EBC_WS_HOLD_CYCLE_1HCLK; EBC_MemRegionInitStruct.Enable_Tune = ENABLE; EBC_MemRegionInit (&amp;EBC_MemRegionInitStruct, EBC_MEM_REGION_60000000); EBC_MemRegionCMD(EBC_MEM_REGION_60000000, ENABLE); // Turn ON RAM (nCE) PORT_ResetBits (MDR_PORTC, MDB_SRAM_CE); }</code> </pre> </div></div><br>  El microcontrolador en el paquete LQFP-144 y la memoria en el paquete TSOP-44 tienen muchos pines conectados y ocupan mucho espacio en la placa de circuito impreso.  Teniendo experiencia en la resoluci√≥n de problemas de optimizaci√≥n en el campo de la econom√≠a, para m√≠ era obvio que era necesario colocar estos microcircuitos en el tablero en primer lugar.  En varias fuentes he visto elogios para <a href="https://www.eremex.ru/products/delta-design/topor/" rel="nofollow">TopoR CAD (enrutador topol√≥gico)</a> .  Descargu√© la versi√≥n de prueba y pude exportar mi proyecto desde Eagle CAD solo cuando elimin√© casi todos los componentes.  Desafortunadamente, incluso el programa TopoR de 10 elementos no me ayud√≥ a colocarlo en el tablero.  Primero, todos los componentes se colocaron en una esquina y luego se colocaron a lo largo del borde.  Esta opci√≥n no me satisfizo, y durante mucho tiempo rastre√© la placa en modo manual en el entorno familiar Eagle CAD. <br><br>  Un elemento importante de la placa de circuito impreso es la serigraf√≠a.  La placa de depuraci√≥n no solo debe tener firmas para componentes electr√≥nicos, sino que todos los conectores deben estar firmados.  En la parte posterior de la placa, coloqu√© tablas de notas con las funciones de los puertos del controlador (primario, alternativo, anulado, real).  Orden√© la fabricaci√≥n de placas de circuito impreso en China en la conocida oficina de PCBWay.  No voy a alabar, porque la calidad es buena.  Pueden hacerlo mejor, con menos tolerancias, pero <a href="https://www.pcbway.com/HighQualityOrderOnline.aspx" rel="nofollow">por una tarifa</a> . <br><br><img src="https://habrastorage.org/webt/8q/gh/2w/8qgh2wsaofz5p2lat7gcoqc4km4.jpeg"><br>  <i>Placas de circuito impreso fabricadas MDB1986, (c) Foto del autor</i> <br><br>  Tuve que soldar los componentes "sobre mi rodilla" con un soldador de 40 vatios y una soldadura POS-61, porque rara vez lo soldo, 1-2 veces al a√±o, y la pasta de soldadura se sec√≥.  Tuve que cambiar el controlador CS32F103 chino al STM32F103 original y luego reemplazar la memoria.  En general, ahora el resultado me satisface por completo, aunque todav√≠a no he verificado el funcionamiento de RS-232 y CAN. <br><br><img src="https://habrastorage.org/webt/-h/il/8v/-hil8vgd1228zqjk7ig090eurpq.jpeg"><br>  <i>Tarjeta de depuraci√≥n MDB1986 en el trabajo - brilla y calienta, (c) Foto de</i> <br><br>  En el sitio web de Milandra, puede encontrar suficientes <a href="https://edu.milandr.ru/library/" rel="nofollow">materiales de capacitaci√≥n para estudiar</a> los controladores de la serie 1986BE9 (n√∫cleo Cortex-M3), pero no veo nada para el microcontrolador K1986BE1QI (avia).  Despu√©s de revisar los materiales publicados all√≠, los manuales y el trabajo de laboratorio para las universidades, me alegra que se est√© capacitando al personal en todo el pa√≠s para trabajar con los controladores rusos.  La mayor√≠a de los materiales de capacitaci√≥n est√°n preparados para trabajar con puertos de E / S, temporizadores, ADC, DAC, SPI, UART.  Se utilizan diferentes entornos de desarrollo IDE (Keil, IAR, CodeMaster).  En alg√∫n lugar programan usando registros CMSIS, y en otro lugar usan la Biblioteca MDR.  Es necesario mencionar el recurso <a href="https://startmilandr.ru/" rel="nofollow">Start Milandr</a> , que contiene muchos art√≠culos de programadores pr√°cticos.  Y, por supuesto, uno no debe olvidarse <a href="https://forum.milandr.ru/" rel="nofollow">del foro Milander</a> . <br><br><div class="spoiler">  <b class="spoiler_title">El pensamiento de Milander</b> <div class="spoiler_text">  La microelectr√≥nica se est√° desarrollando en Rusia, y Milander desempe√±a un papel destacado en este proceso.  Hay nuevos microcontroladores interesantes, por ejemplo, 198681 y "Power" con las interfaces SpaceWire y MKIO (lo mismo que en 1986BE1 y, posiblemente, con los mismos problemas), etc.  Pero los estudiantes comunes, los maestros y los ingenieros civiles para comprar tales chips no son realistas.  Por lo tanto, la comunidad de ingenieros no podr√° identificar r√°pidamente los errores y problemas de este chip.  Me parece que al principio es necesario producir microcircuitos en una caja de pl√°stico, distribuirlo a todas las partes interesadas, y solo despu√©s de la prueba (aprobaci√≥n latina, aprobaci√≥n, reconocimiento), los especialistas pueden preparar una auditor√≠a en una caja de metal-cer√°mica con protecci√≥n contra todos los factores terribles.  Espero que en el futuro cercano, TODOS estemos satisfechos con los nuevos proyectos anunciados en las exposiciones. </div></div><br>  Cualquier persona desarrollada por m√≠, el tablero de depuraci√≥n, puede repetir, modificar y usar en el proceso educativo.  En primer lugar, hice un tablero para m√≠, pero result√≥ tan bien que <a href="https://github.com/makbit/MDB1986" rel="nofollow">decid√≠ compartirlo con todos</a> . <br><br>  K1986BE1QI (avia) es un controlador muy interesante con interfaces √∫nicas que se pueden utilizar en las universidades para educar a los estudiantes.  ¬°Creo que despu√©s de corregir los errores detectados en el controlador y pasar las pruebas de certificaci√≥n, el controlador volar√° en el sentido literal de la palabra! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/482716/">https://habr.com/ru/post/482716/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../482702/index.html">¬øRealmente necesitamos TypeScript en 2020?</a></li>
<li><a href="../482704/index.html">Redis sincronizaci√≥n de cach√© para el servicio Go</a></li>
<li><a href="../482706/index.html">Recomendaciones para la implementaci√≥n de contabilidad paralela RAS + IFRS en la plataforma 1C</a></li>
<li><a href="../482708/index.html">Una caracter√≠stica de la cultura corporativa necesaria para el bienestar de la base del c√≥digo</a></li>
<li><a href="../482714/index.html">La columna de radio por Internet m√°s simple "Kodi" o el rescate del ladrillo "Frambuesa"</a></li>
<li><a href="../482718/index.html">Pir√°mide invertida como final de su proyecto.</a></li>
<li><a href="../482722/index.html">Fant√°stica historia "Proyecto C. Vanidad de vanidades" (10 min.)</a></li>
<li><a href="../482726/index.html">El resumen de materiales interesantes para el desarrollador m√≥vil # 328 (23 y 29 de diciembre)</a></li>
<li><a href="../482730/index.html">Encuesta de vacaciones</a></li>
<li><a href="../482734/index.html">Ofuscaci√≥n en tiempo de compilaci√≥n usando NAND / NOR</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>