<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò∂ üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë© ü•ß Zabbix como esc√°ner de seguridad üé£ üí∏ üÜô</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Todos conocemos y amamos los productos para procesos de evaluaci√≥n de vulnerabilidades como Nessus , Qualys , Max Patrol y todo tipo de otros Ope...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Zabbix como esc√°ner de seguridad</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vulners/blog/416137/"><p>  Hola  Todos conocemos y amamos los productos para procesos de evaluaci√≥n de vulnerabilidades como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Nessus</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Qualys</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Max Patrol</a> y todo tipo de otros <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">OpenVAS</a> .  Una de las tareas principales que resuelven es proporcionar control sobre las vulnerabilidades versionadas. </p><br><p>  Este es un proceso bastante simple de comparar las versiones de software instaladas con el rango "no contiene vulnerabilidades conocidas".  Bueno, entonces los responsables de la seguridad de la informaci√≥n, junto con el desarrollo y los administradores, deciden qu√© riesgos se pueden tomar y qu√© se debe parchar hoy. </p><br><p>  Existen muchas herramientas diferentes para resolver este problema, pero desde nuestro punto de vista, todas tienen un problema com√∫n: requieren una implementaci√≥n problem√°tica por separado y generan otra herramienta con una cuenta ra√≠z en su infraestructura.  Pero, despu√©s de todo, ¬°para una acci√≥n tan simple como recopilar informaci√≥n sobre paquetes ra√≠z instalados no es necesaria!  Y generalmente en la infraestructura ya hay sistemas implementados con la capacidad de consolidar datos, colaboraci√≥n y ejecuci√≥n remota de comandos en servidores.  Por lo tanto, decidimos crear una herramienta que permitiera un par de clics para implementar un sistema de monitoreo de vulnerabilidad de Linux en nuestro entorno con cambios m√≠nimos en la producci√≥n. </p><br><p>  ¬øQu√© se implementa en la mayor√≠a de los sistemas alimentarios?  Por supuesto, monitoreo.  Y muy a menudo es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Zabbix</a> .  ¬°As√≠ que vamos a sujetarlo! </p><a name="habracut"></a><br><h1 id="v-odnoy-ruke-zabbix">  En una mano Zabbix </h1><br><p>  Todo es simple: un sistema de agente distribuido, paneles de control para visualizaci√≥n, un sistema de acceso multiusuario y realizar acciones de acuerdo con criterios espec√≠ficos ya se han realizado sin nosotros.  No necesitamos reinventar la rueda y hacerlo todo desde cero. </p><br><p>  Zabbix tiene suficientes derechos para recibir informaci√≥n sobre paquetes, d√≥nde colocarlos tambi√©n.  Queda combinarlos y enviarlos para su an√°lisis a la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">API de Vulners</a> .  Y luego procesar el conocimiento adquirido sobre vulnerabilidades. </p><br><p>  Pero comencemos con una breve introducci√≥n sobre lo que Zabbix puede hacer y lo que debemos hacer. </p><br><p>  <strong>Los agentes Zabbix</strong> est√°n instalados en el servidor y permiten: </p><br><ul><li>  Obtenga una amplia gama de m√©tricas del sistema operativo </li><li>  ejecutar scripts y programas y obtener el resultado de su ejecuci√≥n; </li><li>  ejecutar cualquier comando en un proceso separado (fork), independiente de los procesos del agente Zabbix; </li><li>  trabajar con varios servidores Zabbix a la vez; </li><li>  trabajar detr√°s de un firewall, iniciando una conexi√≥n al servidor, o viceversa, esperando las conexiones entrantes. </li></ul><br><p>  <strong>El servidor Zabbix</strong> recibe las m√©tricas de monitoreo como una entrada y las escribe en la base de datos y lleva a cabo un procesamiento adicional. </p><br>  Analizando los datos obtenidos y basados ‚Äã‚Äãen una l√≥gica bastante flexible, puede realizar varias acciones: <br><br><ul><li>  Enviar alertas en varios canales (correo, sms, mensajer√≠a instant√°nea, etc.); </li><li>  Con√©ctese a los servidores a trav√©s de SSH o IPMI y ejecute varios comandos en ellos; </li><li>  O ejecute varios comandos correctivos en servidores que usan conexiones de agente Zabbix con ellos; </li></ul><br><p>  <strong>La interfaz web est√°</strong> escrita en PHP y le permitir√° mostrar las m√©tricas recopiladas por Zabbix, gr√°ficos, alertas activadas sobre problemas y comandos y acciones realizadas por el sistema de monitoreo. </p><br><p>  La administraci√≥n de Zabbix tambi√©n se lleva a cabo a trav√©s de la interfaz web. </p><br><p>  <strong>La API de Zabbix</strong> es una API basada en la web y viene como parte de la interfaz web.  Utiliza el protocolo JSON-RPC. </p><br><ul><li>  Le permite recibir, crear, configurar y eliminar cualquier objeto en el sistema de monitoreo. </li><li>  Usando la API, puede integrar f√°cilmente el sistema de monitoreo con varios sistemas externos. </li></ul><br><p>  Sin embargo, ¬°Zabbix no sabe nada sobre vulnerabilidades!  Pero <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Vulners</a> sabe de ellos :) </p><br><h2 id="v-drugoy-ruke-vulners">  Por otro lado de los Vulners </h2><br><ul><li>  Agregador de datos de vulnerabilidad de m√°s de 115 fuentes </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">API conveniente para varios m√©todos de escaneo</a> </li><li>  Proporciona datos en forma normalizada y legible por m√°quina. </li><li>  Muy rapido </li><li>  Permite la correlaci√≥n de datos de varias fuentes. </li></ul><br><p>  Intentamos integrarlos entre s√≠ y eso es lo que surgi√≥. </p><br><h1 id="zabbix-threat-control">  Control de amenazas Zabbix </h1><br><p>  Este es un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">complemento</a> Zabbix de c√≥digo abierto escrito en Python que: </p><br><ul><li>  Muestra informaci√≥n sobre las vulnerabilidades encontradas en su infraestructura en la interfaz web de Zabbix. </li><li>  Muestra el nivel de amenaza de cada vulnerabilidad de acuerdo con el est√°ndar CVSS. </li><li>  Y ofrece m√©todos f√°cilmente aplicables para eliminar las vulnerabilidades encontradas. </li></ul><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CVSS</a> es un est√°ndar abierto de la industria para evaluar la vulnerabilidad de la vulnerabilidad.  De hecho, escala de 10 puntos. </p><br>  El uso de esta t√©cnica le permite traer vulnerabilidades encontradas en diferentes sistemas y con diferentes propiedades a un solo denominador, lo que simplifica la priorizaci√≥n de los problemas detectados. <br><br>  Hablamos sobre este complemento en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Zabbix Moscow Meetup</a> .  Para aquellos a quienes no les gusta leer, pero les gusta mirar, hay un informe en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">video</a> . <br><br><h2 id="konsolidiruyte-informaciyu-ob-uyazvimostyah">  Consolidar la informaci√≥n de vulnerabilidad </h2><br><p>  El resultado del complemento en Zabbix es el siguiente: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/70c/a22/394/70ca22394ca3092373bf8529d0c69025.png" alt="Tablero de instrumentos"><br>  Este es un tablero en Zabbix.  En el cual, de izquierda a derecha, se muestra la siguiente informaci√≥n: </p><br><ul><li>  Distribuci√≥n del puntaje CVSS por servidores.  El gr√°fico circular muestra la relaci√≥n: cu√°ntos servidores tenemos con vulnerabilidades cr√≠ticas, cu√°ntas vulnerabilidades no cr√≠ticas tienen o no vulnerabilidades conocidas. </li><li>  La puntuaci√≥n mediana de CVSS de toda la infraestructura.  Se muestra en forma de gr√°fico, que le permite observar la din√°mica de su cambio. </li><li>  Lista de paquetes vulnerables con un √≠ndice del impacto de la vulnerabilidad en la infraestructura. </li><li>  Una lista completa de servidores vulnerables con un nivel de amenaza para cada uno de ellos. </li><li>  Lista de boletines de seguridad que se han "encontrado" en la infraestructura. </li></ul><br><p>  A continuaci√≥n con m√°s detalle sobre los m√°s interesantes: </p><br><p>  <strong>Informaci√≥n sobre servidores vulnerables:</strong> </p><br><p><img src="https://habrastorage.org/webt/hb/nm/5m/hbnm5mgchmq1yfj9mxfzkdepwxu.gif" alt="Anfitriones"></p><br><p>  El panel muestra una lista de todos los servidores con un nivel de vulnerabilidad superior al cr√≠tico.  El nivel m√≠nimo de criticidad aceptable, despu√©s del cual el servidor comienza a aparecer como vulnerable, se especifica en la configuraci√≥n del complemento. </p><br><p>  La siguiente informaci√≥n est√° disponible para cada servidor: </p><br><ol><li>  En realidad, el nombre del servidor vulnerable. </li><li>  Puntuaci√≥n m√°xima del servidor CVSS.  Se muestra la puntuaci√≥n m√°s alta de todas las vulnerabilidades encontradas para este servidor. </li><li>  Un comando para eliminar todas las vulnerabilidades detectadas en este servidor.  Una vez completado, obtenemos un servidor en el que no hay vulnerabilidades versionadas conocidas. </li></ol><br><p>  Los datos se presentan con clasificaci√≥n CVSS, de m√°ximo a m√≠nimo.  Esto le permite mantener los servidores que requieren la mayor atenci√≥n, siempre en la parte superior de la lista, ante sus ojos. </p><br><p>  <strong>El siguiente panel muestra los paquetes vulnerables:</strong> </p><br><p><img src="https://habrastorage.org/webt/0q/75/em/0q75emnx6roeuhvz3ltalvwrbio.gif" alt="Paquetes"></p><br><p>  Aqu√≠ para cada paquete vulnerable en nuestra infraestructura, tenemos un breve resumen: </p><br><ol><li>  El nombre del paquete vulnerable. </li><li>  <em>Versi√≥n</em> vulnerable <em>del</em> paquete. </li><li>  El n√∫mero de servidores en los que est√° instalada la versi√≥n vulnerable del paquete. </li><li>  Puntuaci√≥n CVSS para esta versi√≥n del paquete. </li><li>  √çndice del impacto de esta vulnerabilidad en la infraestructura. </li><li>  Una lista de todos los servidores en los que se detecta una versi√≥n vulnerable del paquete. </li><li>  Enlace al bolet√≠n de seguridad.  Le permite leer y comprender cu√°n cr√≠tica es esta vulnerabilidad en nuestra situaci√≥n. </li><li>  El equipo que repara la vulnerabilidad en este paquete. </li></ol><br><p>  Los datos se presentan ordenados por <em>√≠ndice de impacto</em> , de m√°ximo a m√≠nimo. </p><br><p>  <em>El √≠ndice de impacto</em> es el n√∫mero de servidores afectados multiplicado por la puntuaci√≥n de vulnerabilidad CVSS.  A menudo sucede que una vulnerabilidad con un puntaje no tan alto est√° mucho m√°s extendida en la infraestructura y, por lo tanto, es potencialmente m√°s peligrosa. </p><br><h2 id="vybirayte-strategii-ustraneniya-uyazvimostey">  Elija estrategias de gesti√≥n de vulnerabilidades </h2><br><p>  Sin embargo, no puede simplemente tomar y actualizar todos los paquetes en todos los servidores a la √∫ltima versi√≥n, lo que elimina las vulnerabilidades existentes. </p><br><p>  En cualquier infraestructura que consta de m√°s de varios servidores, existen muchas restricciones: la dependencia de un software de la versi√≥n de otro, los riesgos de una funcionalidad deteriorada, etc. </p><br><p>  Por lo tanto, siempre hay una opci√≥n: qu√© paquetes podemos actualizar sin problemas.  Qu√© paquetes requieren un plan de trabajo separado para la implementaci√≥n de medidas compensatorias.  Y por lo que podemos aceptar riesgos. </p><br><p>  El enfoque propuesto en el complemento le permite elegir la estrategia para eliminar las vulnerabilidades que m√°s le convengan: </p><br><ul><li>  <strong>Una vulnerabilidad en toda la infraestructura:</strong> si una vulnerabilidad espec√≠fica es cr√≠tica para usted, el complemento le proporciona informaci√≥n sobre d√≥nde existe esta vulnerabilidad en su infraestructura y c√≥mo se puede solucionar de inmediato en toda la infraestructura. </li><li>  <strong>Todas las vulnerabilidades en un servidor espec√≠fico:</strong> si necesita tener un servidor completamente seguro, por ejemplo, ubicado en la DMZ o detr√°s del per√≠metro de la empresa, al usar el complemento obtendr√° informaci√≥n sobre c√≥mo eliminar todas las vulnerabilidades encontradas en √©l. </li></ul><br><h2 id="ustranyayte-naydennye-uyazvimosti">  Arreglar vulnerabilidades encontradas </h2><br><p>  Pero no es suficiente saber qu√© vulnerabilidades tenemos y determinar c√≥mo y cu√°les se pueden solucionar.  ¬°Tambi√©n es necesario hacer esto! </p><br><p>  Los sistemas como Puppet o Ansible se usan ampliamente para la gesti√≥n centralizada de la configuraci√≥n y las actualizaciones de software.  Puede usar el comando de reparaci√≥n que corrige la vulnerabilidad y ejecutarlo de forma centralizada utilizando dichos sistemas. </p><br><p>  Si su infraestructura no utiliza dichos sistemas, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Zabbix Threat Control le</a> permite eliminar vulnerabilidades directamente de la interfaz web de Zabbix. </p><br><p><img src="https://habrastorage.org/webt/f5/i7/pj/f5i7pjelugjzoildcxmb-qkttfc.png"></p><br><p>  Para esto, el complemento utiliza la funcionalidad est√°ndar de Zabbix: confirmaci√≥n de eventos y ejecuci√≥n de comandos remotos: </p><br><ol><li>  Tan pronto como el problema sea confirmado a trav√©s de la interfaz web por un usuario autorizado; </li><li>  Se inicia un comando remoto que se ejecuta en el servidor de destino, o en la lista de servidores, un comando de reparaci√≥n que corrige la vulnerabilidad. </li></ol><br><h2 id="kak-eto-rabotaet">  Como funciona </h2><br><p><img src="https://habrastorage.org/webt/io/mf/li/iomflipmyk5lxwmn8qbntuswufs.gif"></p><br><ol><li>  El servidor Zabbix recibe informaci√≥n sobre los paquetes y el sistema operativo de todos los servidores en la infraestructura a trav√©s de agentes zabbix. </li><li>  El complemento (que usa la API de Zabbix) recibe un informe del sistema operativo previamente compilado por el servidor de Zabbix.  El complemento no recibe nada directamente de los servidores.  Y en esta etapa no requiere contacto directo con ellos. </li><li>  Despu√©s de procesar la informaci√≥n recibida de Zabbix, el complemento se la pasa a Vulners.  De donde recibe una lista de vulnerabilidades encontradas, su criticidad y una forma de eliminarlas. </li><li>  El complemento procesa los datos recibidos, los agrega para generar estad√≠sticas y genera paquetes de datos para su transmisi√≥n a Zabbix. </li><li>  El complemento empuja los datos de Zabbix en el formato del sistema de monitoreo requerido.  Lo hace usando la utilidad zabbix-sender.  Despu√©s de eso, ya tiene que monitorear todo sobre las vulnerabilidades encontradas, que se muestran en el panel que se mostr√≥ anteriormente. </li><li>  Despu√©s de confirmar el problema, se ejecuta un comando remoto, que pasa al complemento: <br><ul><li>  El nombre de la persona que lo inici√≥. </li><li>  Fix Vulnerability Fix Team </li><li>  Lista de servidores </li></ul></li><li>  Habiendo recibido todo este Control de amenazas Zabbix: <br><ul><li>  Comprueba que el comando de correcci√≥n sea iniciado por quienes lo necesitan.  Del que no es necesario, no acepta el comando :) </li><li>  Ejecuta el comando que se le transfiere en la cantidad necesaria de servidores. </li></ul></li></ol><br><p> De manera predeterminada, el complemento env√≠a un comando de reparaci√≥n a servidores vulnerables utilizando la utilidad zabbix-get, accediendo al agente Zabbix en el servidor de destino con el par√°metro <code>nowait</code> .  Este m√©todo de conexi√≥n permite que el proceso de actualizaci√≥n de paquetes se ejecute en segundo plano sin estar vinculado a los procesos del agente zabbix.  Tambi√©n es posible ejecutar el comando en el servidor de destino a trav√©s de una simple conexi√≥n SSH.  La forma de ejecutar los comandos de arreglo se selecciona como una opci√≥n en el archivo de configuraci√≥n del complemento. </p><br><p>  Y como resultado del trabajo: la ausencia de servidores vulnerables, su buen sue√±o y buen humor :) </p><br><h2 id="ustanovka">  Instalaci√≥n </h2><br><p>  Hablamos sobre qu√© es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Zabbix Threat Control</a> , por qu√© es necesario y c√≥mo funciona.  ¬°Ahora le diremos c√≥mo instalarlo y configurarlo! </p><br><h3 id="zavisimosti">  Dependencias </h3><br><p>  Para funcionar, el complemento no requiere nada sobrenatural.  Es necesario que en el <strong>servidor Zabbix</strong> en el que establecemos el plan, lo siguiente sea: </p><br><ul><li>  <strong>zabbix v3.4</strong> para usar paneles personalizados (solo aparecieron en esta versi√≥n). </li><li>  <strong>Se</strong> necesita <strong>zabbix-sender</strong> para enviar datos de vulnerabilidad al sistema de monitoreo. </li><li>  <strong>zabbix-get</strong> para enviar comandos de reparaci√≥n que corrigen vulnerabilidades a los servidores. </li><li>  <strong>Python v3</strong> con m√≥dulos: <strong>pyzabbix, jpath, solicitudes</strong> para ejecutar los scripts principales del complemento. </li></ul><br><p>  En todos los <strong>servidores para los que</strong> se requiere el <strong>an√°lisis</strong> de vulnerabilidades, solo: </p><br><ul><li>  <strong>zabbix-agent</strong> para recopilar datos y ejecutar scripts. </li><li>  <strong>Python v2</strong> para ejecutar el script que recopila el informe del sistema operativo. </li></ul><br><h3 id="ustanovka-plagina-iz-paketov">  Instalar el complemento desde paquetes </h3><br><p>  Para comenzar, conecte el repositorio con paquetes: </p><br><p>  Distribuciones <strong>RPM</strong> </p><br><pre> <code class="bash hljs"> rpm -Uhv https://repo.vulners.com/redhat/vulners-repo.rpm</code> </pre> <br><p>  Distribuciones <strong>DEB</strong> </p><br><pre> <code class="bash hljs"> wget https://repo.vulners.com/debian/vulners-repo.deb dpkg -i vulners-repo.deb</code> </pre> <br><p>  Despu√©s de eso, en el servidor Zabbix instalamos el paquete principal que proporciona toda la l√≥gica del complemento y el paquete que informa sobre el sistema operativo: </p><br><p>  Distribuciones <strong>RPM</strong> </p><br><pre> <code class="bash hljs"> yum install zabbix-threat-control-main zabbix-threat-control-host</code> </pre> <br><p>  Distribuciones <strong>DEB</strong> </p><br><pre> <code class="bash hljs"> apt-get update &amp;&amp; apt-get install zabbix-threat-control-main zabbix-threat-control-host</code> </pre> <br><p>  Y en todos los dem√°s servidores que requieren an√°lisis de vulnerabilidades, instalamos un paquete que genera informes del sistema operativo: </p><br><p>  Distribuciones <strong>RPM</strong> </p><br><pre> <code class="bash hljs"> yum install zabbix-threat-control-host</code> </pre> <br><p>  Distribuciones <strong>DEB</strong> </p><br><pre> <code class="bash hljs"> apt-get update &amp;&amp; apt-get install zabbix-threat-control-host</code> </pre> <br><h3 id="ustanovka-iz-ishodnikov">  Instalaci√≥n desde la fuente </h3><br><p>  Si prefiere la instalaci√≥n desde la fuente, esto tambi√©n es muy simple: </p><br><p>  En el servidor Zabbix, instalamos los scripts principales que proporcionan toda la l√≥gica del complemento y el script que informa sobre el sistema operativo: </p><br><pre> <code class="bash hljs"> git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/vulnersCom/zabbix-threat-control.git <span class="hljs-comment"><span class="hljs-comment"># main mkdir -p /opt/monitoring/zabbix-threat-control cp zabbix-threat-control/ztc* /opt/monitoring/zabbix-threat-control/ chown -R zabbix:zabbix /opt/monitoring/zabbix-threat-control chmod 640 /opt/monitoring/zabbix-threat-control/ztc_config.py touch /var/log/zabbix-threat-control.log chown zabbix:zabbix /var/log/zabbix-threat-control.log chmod 664 /var/log/zabbix-threat-control.log # host cp -R zabbix-threat-control/os-report /opt/monitoring/ chown -R zabbix:zabbix /opt/monitoring/os-report</span></span></code> </pre> <br><p>  En todos los dem√°s servidores que requieren an√°lisis de vulnerabilidades, solo instalamos un script que informa sobre el sistema operativo: </p><br><pre> <code class="bash hljs"> git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/vulnersCom/zabbix-threat-control.git <span class="hljs-comment"><span class="hljs-comment"># host mkdir -p /opt/monitoring/ cp -R zabbix-threat-control/os-report /opt/monitoring/ chown -R zabbix:zabbix /opt/monitoring/os-report</span></span></code> </pre> <br><h2 id="nastroyka">  Personalizaci√≥n </h2><br><p>  Despu√©s de la instalaci√≥n, debe configurar el complemento y preparar un sistema de monitoreo para su funcionamiento.  La siguiente es una descripci√≥n paso a paso de todas las acciones necesarias. </p><br><h3 id="nastraivaem-servera-trebuyuschie-skanirovaniya">  Configurar servidores que requieren escaneo </h3><br><p>  Debe habilitar el agente Zabbix para ejecutar comandos remotos.  Para hacer esto, en todos los servidores para los que se requiere escaneo, cambie los par√°metros en el archivo de configuraci√≥n de zabbix-agent como se muestra a continuaci√≥n: </p><br><pre> <code class="hljs">EnableRemoteCommands=1 LogRemoteCommands=1</code> </pre> <br><p>  El archivo de configuraci√≥n del agente zabbix generalmente se encuentra aqu√≠: <code>/etc/zabbix/zabbix_agentd.conf</code> </p><br><p>  Si desea utilizar la funcionalidad para eliminar las vulnerabilidades encontradas utilizando <em>Zabbix Threat Control</em> , debe permitir que el usuario de zabbix <strong>actualice los</strong> paquetes (pero no los instale ni los desinstale). </p><br>  Para hacer esto, agregue la siguiente l√≠nea al <code>/etc/sudoers</code> : <br><p>  Para distribuciones <strong>RPM</strong> , la l√≠nea se ve as√≠: </p><br><pre> <code class="hljs pgsql">zabbix <span class="hljs-keyword"><span class="hljs-keyword">ALL</span></span>=(<span class="hljs-keyword"><span class="hljs-keyword">ALL</span></span>) NOPASSWD: /usr/bin/yum -y <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> *</code> </pre> <br><p>  Para distribuciones <strong>DEB</strong> un poco diferente: </p><br><pre> <code class="hljs powershell">zabbix ALL=(ALL) NOPASSWD: /usr/bin/apt<span class="hljs-literal"><span class="hljs-literal">-get</span></span> -<span class="hljs-literal"><span class="hljs-literal">-assume</span></span><span class="hljs-literal"><span class="hljs-literal">-yes</span></span> install -<span class="hljs-literal"><span class="hljs-literal">-only</span></span><span class="hljs-literal"><span class="hljs-literal">-upgrade</span></span> *</code> </pre> <br><h3 id="podklyuchaemsya-k-vulners">  Con√©ctate a los Vulners </h3><br><p>  Para usar la API de Vulners, necesita una clave de API.  Para conseguirlo: </p><br><ul><li>  Reg√≠strate en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">vulners.com</a> </li><li>  En su cuenta, vaya a la pesta√±a KEYS API </li><li>  Seleccione "Escanear" en el √°rea Alcance y presione "GENERAR NUEVA CLAVE". </li></ul><br><p>  Obtendr√° una clave de API que se ve as√≠: RGB9YPJG7CFAXP35PMDVYFFJPGZ9ZIRO1VGO9K9269B0K86K6XQQQR32O6007NUK </p><br><p><img src="https://habrastorage.org/webt/bu/r1/_8/bur1_85domk9m6gkzoaxsghzoqa.png"></p><br><p>  Ahora debe agregar la clave de la API de Vulners al archivo de configuraci√≥n del complemento <code>/opt/monitoring/zabbix-threat-control/ztc_config.py</code> </p><br><p>  Un ejemplo: </p><br><pre> <code class="hljs 1c">vuln_api_key = 'RGB9YPJG7CFAXP35PMDVYFFJPGZ9ZIRO1VGO9K<span class="hljs-number"><span class="hljs-number">9269</span></span>B0K86K6XQQQR32O<span class="hljs-number"><span class="hljs-number">6007</span></span>NUK'</code> </pre> <br><h3 id="podklyuchaemsya-k-zabbix">  Conectar a Zabbix </h3><br><p>  Para que el complemento pueda conectarse a Zabbix, debe especificar los siguientes datos en el archivo de configuraci√≥n: <code>/opt/monitoring/zabbix-threat-control/ztc_config.py</code> </p><br><ul><li>  Direcci√≥n de la interfaz web de Zabbix para trabajar con Zabbix-API; </li><li>  nombre de usuario y contrase√±a con los que nos conectaremos a la API de Zabbix. </li></ul><br>  Nombre de dominio del servidor Zabbix y puerto para enviar datos utilizando la utilidad zabbix-sender. <br><br><p>  Un ejemplo: </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">zbx_pass</span></span> = <span class="hljs-string"><span class="hljs-string">'yourpassword'</span></span> zbx_user = <span class="hljs-string"><span class="hljs-string">'yourlogin'</span></span> zbx_url = <span class="hljs-string"><span class="hljs-string">'https://zabbixfront.yourdomain.com'</span></span> zbx_server_fqdn = <span class="hljs-string"><span class="hljs-string">'zabbixserver.yourdomain.com'</span></span> zbx_server_port = <span class="hljs-string"><span class="hljs-string">'10051'</span></span></code> </pre> <br><h3 id="podgotavlivaem-zabbix">  Preparando Zabbix </h3><br><p>  Debe crear objetos en Zabbix que proporcionen el complemento.  Para hacer esto, ejecute el script <code>/opt/monitoring/zabbix-threat-control/ztc_create.py</code> .  El script verificar√° que el complemento est√© configurado correctamente y, utilizando la API, crear√° en Zabbix: </p><br><ol><li>  <strong>Grupo</strong> de hosts al que se agregan los hosts que muestran vulnerabilidades. </li><li>  <strong>La plantilla</strong> mediante la cual se recopila el informe del sistema operativo de todos los servidores. </li><li>  <strong>Hosts</strong> para mostrar vulnerabilidades por paquetes, servidores, boletines y estad√≠sticas generales. </li><li>  <strong>Una acci√≥n</strong> para ejecutar comandos remotos de reparaci√≥n de vulnerabilidades. </li><li>  <strong>Panel</strong> de <strong>control</strong> para una f√°cil visualizaci√≥n de toda esta informaci√≥n. </li></ol><br><p><img src="https://habrastorage.org/webt/mh/p1/qe/mhp1qeyu_r-c-zvxhtrthl0bzyg.gif"></p><br><p>  Despu√©s de crear todos los objetos en Zabbix, el script mostrar√°: </p><br><ul><li>  Enlace al panel creado en Zabbix, en el que se mostrar√°n las vulnerabilidades. </li><li>  El momento en que se iniciar√° el escaneo de infraestructura en busca de vulnerabilidades. </li></ul><br><p>  Despu√©s de que se hayan creado todos los objetos necesarios en Zabbix, debe ir a la interfaz web de Zabbix y vincular la plantilla "Informe de sistema operativo Vulners" que acaba de crear el script con todos los servidores que requieren escaneo en busca de vulnerabilidades. </p><br><p><img src="https://habrastorage.org/webt/0h/px/im/0hpxim3eoxm9zxk-_isvvvkpycu.png"></p><br><p>  Despu√©s de eso, queda esperar a que el complemento se inicie a la hora especificada durante la instalaci√≥n. </p><br><h2 id="skaniruem">  Escanear! </h2><br><p>  El script de procesamiento de datos principal ( <code>ztc.py</code> ) se <code>ztc.py</code> autom√°ticamente, una vez al d√≠a, a trav√©s del "Elemento de servicio ..." en el host "Vulners - Estad√≠sticas" en el momento especificado por el script. </p><br><p>  Puede cambiar la hora de inicio del complemento a cualquier conveniente cambiando el "Intervalo de programaci√≥n" en este elemento de datos.  En este caso, tambi√©n es necesario ajustar el tiempo de recopilaci√≥n de estad√≠sticas en los tres elementos de datos de la plantilla "Informe Vulners OS": las m√©tricas en la plantilla deber√≠an funcionar 10 ... 15 minutos antes que la m√©trica principal "Elemento de servicio ..." en el host "Vulners - Estad√≠sticas". </p><br><p>  El tiempo durante el cual se procesar√°n todos los datos de vulnerabilidad depende de la cantidad de servidores en la infraestructura y la cantidad de paquetes instalados en ellos.  Se gastan aproximadamente 30 minutos en procesar mil servidores. </p><br><h1 id="plany">  Planes </h1><br><p>  Esta es solo la primera versi√≥n del complemento Zabbix Threat Control.  Y seguimos desarroll√°ndolo. </p><br>  Los planes: <br><br><ul><li>  Agregue informaci√≥n en los paneles que se encuentran en la infraestructura de CVE. </li><li>  Negarse a instalar cualquier secuencia de comandos en los agentes y recopilar toda la informaci√≥n necesaria sobre el sistema operativo y los paquetes utilizando las claves de elementos de datos integradas en el agente Zabbix. </li></ul><br><p>  Y como es de c√≥digo abierto, ¬°√∫nete a nosotros!  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Solicitudes de extracci√≥n bienvenidas :)</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es416137/">https://habr.com/ru/post/es416137/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es416125/index.html">Instalaci√≥n, configuraci√≥n del sistema y control de c√°maras.</a></li>
<li><a href="../es416127/index.html">CUDA y GPU remota</a></li>
<li><a href="../es416129/index.html">C√≥mo AI aprende a generar im√°genes de gatos</a></li>
<li><a href="../es416131/index.html">C√≥mo manejar la EP en la Federaci√≥n de Rusia y no violar la ley</a></li>
<li><a href="../es416135/index.html">Aplicaci√≥n GUI menor a 1 kb</a></li>
<li><a href="../es416139/index.html">Autenticaci√≥n fuerte como parte de la estrategia GDPR</a></li>
<li><a href="../es416143/index.html">El libro "¬°Se mostrar√° una autopsia!" An√°lisis pr√°ctico de malware ¬ª</a></li>
<li><a href="../es416147/index.html">Organizaci√≥n de la navegaci√≥n en aplicaciones iOS usando el Root Controller</a></li>
<li><a href="../es416149/index.html">Preguntas y respuestas sobre energ√≠as renovables, parte 1</a></li>
<li><a href="../es416151/index.html">Globo adimensional. An√°lisis utilitario de la dimensi√≥n m√°gica</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>