<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôéüèæ üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë® ü§∑ Utilisation de l'outil de configuration de Datapath ‚úãüèª üßôüèΩ ü§πüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nous devons franchir l'avant-derni√®re √©tape dans le d√©veloppement pratique de la collaboration avec l'UDB. Aujourd'hui, nous ne d√©velopperons pas √† l'...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Utilisation de l'outil de configuration de Datapath</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442572/"><img src="https://habrastorage.org/webt/fu/yo/23/fuyo230rbfhla_li8ryzzngttlw.jpeg"><br><br>  Nous devons franchir l'avant-derni√®re √©tape dans le d√©veloppement pratique de la collaboration avec l'UDB.  Aujourd'hui, nous ne d√©velopperons pas √† l'aide de l'√©diteur UDB automatis√©, mais en mode semi-manuel √† l'aide de Datapath Config Tool.  Une tr√®s bonne aide pour ma√Ætriser cet outil est AN82156 - PSoC 3, PSoC 4 et PSoC 5LP - Conception de composants PSoC Creator avec des chemins de donn√©es UDB.  En fait, je l'ai √©tudi√© moi-m√™me. <br><a name="habracut"></a><br>  Peut-√™tre, en lisant nos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">traductions de la documentation sur UDB</a> , quelqu'un a essay√© de reproduire les connaissances √† partir de l√† dans la pratique et a remarqu√© que toutes les fonctionnalit√©s d√©crites dans les publications ne sont pas disponibles dans l'√©diteur UDB.  Cela est d√ª au fait que les d√©veloppeurs n'ont pas commenc√© √† placer des m√©canismes particuli√®rement lourds dans l'√©diteur UDB.  Les auteurs de AN82156 soutiennent que gr√¢ce √† l'√©diteur UDB, vous ne pouvez pas faire les choses suivantes: <br><br><ul><li>  organiser l'entr√©e et la sortie de donn√©es parall√®les; </li><li>  organiser une gestion dynamique du FIFO; </li><li>  mettre en ≈ìuvre l'inverse du signal d'horloge FIFO; </li><li>  impl√©menter la fonction CRC; </li><li>  impl√©menter la fonction PRS; </li><li>  mettre en ≈ìuvre le choix du transfert entrant; </li><li>  impl√©menter la migration entrante dynamique. </li></ul><br>  De moi-m√™me, j'ajouterai que je n'ai pas trouv√© comment impl√©menter la permutation des grignotages dans l'√©diteur UDB. <br><br>  Si ces fonctions sont n√©cessaires dans le projet, vous devrez cr√©er votre propre code Verilog.  J'ai sp√©cifiquement utilis√© le mot ¬´cr√©er¬ª plut√¥t que ¬´√©crire¬ª.  Conna√Ætre ce langage de programmation suffit au niveau de la lecture.  Je veux dire, vous devez comprendre quel design est n√©cessaire pour quoi.  Et pouvoir √©crire √† partir de z√©ro est toujours utile, mais cette comp√©tence n'est pas requise pour ce qui est pr√©sent√© dans cet article. <br><br>  Comme probl√®me r√©soluble, j'ai choisi un bo√Ætier semi-synth√©tique.  En g√©n√©ral, j'ai d√©cid√© de sortir certaines donn√©es sur le port parall√®le, et en particulier, √† partir de ce qui est √† port√©e de main, le texte LCD a un port parall√®le.  Je l'ai retir√© de l'imprimante 3D MZ3D il y a trois ans lorsque j'ai transplant√© cette derni√®re en STM32.  Par cons√©quent, le bo√Ætier est semi-synth√©tique: aujourd'hui, de tels indicateurs ont g√©n√©ralement une entr√©e I2C, et ils n'ont pas besoin de se connecter via une pile de fils dans la vraie vie.  Cependant, les √©crans LCD modernes ont √©galement des ports parall√®les, donc tout le monde peut les utiliser pour r√©p√©ter l'exp√©rience. <br><br>  Consid√©rez le sch√©ma de commutation d'affichage tir√© de reprap.org (ce n'√©tait pas facile, mon fournisseur bloque ce site, ainsi que plusieurs autres sites techniques, le motivant du fait qu'il vit sur la m√™me IP que quelqu'un bloqu√©). <br><br><img src="https://habrastorage.org/webt/0x/th/ry/0xthryzxadx_9guzmhdyhrxnzty.png"><br><br>  Grande disposition!  Tout d'abord, je n'ai pas √† penser √† la lecture: les donn√©es sur l'√©cran LCD ne peuvent √™tre √©crites (la ligne R / W est mise √† la terre et n'est pas disponible sur le connecteur).  Deuxi√®mement, les donn√©es sont au format 4 bits, ce qui signifie que nous pouvons non seulement d√©terminer la sortie parall√®le, mais √©galement v√©rifier le fonctionnement de la fonction de permutation de quartets. <br><br><h2>  Cr√©ation de projet </h2><br>  Alors, lancez PSoC Creator et s√©lectionnez <b>Fichier-&gt; Nouveau-&gt; Projet</b> : <br><br><img src="https://habrastorage.org/webt/pv/ma/tv/pvmatvfviveyo4fa822osy45p2c.png"><br><br>  Ensuite, je choisis ma planche √† pain: <br><br><img src="https://habrastorage.org/webt/dv/st/hi/dvsthib82j6ynrdxc0sk-5j20nk.png"><br><br>  Vient ensuite le diagramme vide: <br><br><img src="https://habrastorage.org/webt/oi/fx/vv/oifxvvsf0qye7j-mdyoxmbfux4q.png"><br><br>  J'appellerai le projet <b>LCDTest2</b> : <br><br><img src="https://habrastorage.org/webt/qs/3f/rl/qs3frlgxrnzqzqrzzfryptvjfqq.png"><br><br>  Maintenant, comme auparavant, allez dans l'onglet <b>Composants</b> : <br><br><img src="https://habrastorage.org/webt/wq/nb/bo/wqnbboubijieyovk7akrat6piik.png"><br><br>  Et, apr√®s avoir s√©lectionn√© le projet, appuyez sur le bouton droit de la souris, puis s√©lectionnez <b>Ajouter un √©l√©ment de composant</b> . <br><br><img src="https://habrastorage.org/webt/hi/fu/hv/hifuhvearnltnfz2dvmhwtzgw4o.png"><br><br>  Et ici, vous devez choisir l' <b>Assistant Symbole</b> .  Donnez un nom ... Eh bien, disons <b>LCD4bit</b> . <br><br><img src="https://habrastorage.org/webt/59/f0/g3/59f0g3lya8ado4kcxgj6lcsxggk.png"><br><br>  J'ai attribu√© les ports suivants au symbole: <br><br><img src="https://habrastorage.org/webt/6a/jr/uo/6ajruo1io2jusjunhameiumtb20.png"><br><br>  <b>clk</b> est l'entr√©e d'horloge.  Les ports avec un pr√©fixe LCD sont des ports LCD standard.  <b>faim</b> - sorties indiquant √† l'unit√© DMA qu'il y a de l'espace libre dans FIFO, l'id√©e a √©t√© discut√©e dans un article sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">contr√¥le des LED RGB</a> .  Cliquez sur OK pour obtenir le personnage. <br><br><img src="https://habrastorage.org/webt/ze/fq/5z/zefq5z65eq0i4mq21y2d3jip7t4.png"><br><br>  Maintenant, bas√© sur ce symbole, un mod√®le Verilog devrait √™tre g√©n√©r√©.  Cliquez avec le bouton droit de la souris √† proximit√© du symbole et s√©lectionnez <b>G√©n√©rer Verilog</b> dans le menu contextuel. <br><br><img src="https://habrastorage.org/webt/h9/k7/oo/h9k7oogp_wqsdfugdg-8bdr_hru.png"><br><br>  Nous avons obtenu le mod√®le illustr√© dans la figure ci-dessous (sous forme de texte, cela n'a pas encore de sens): <br><br><img src="https://habrastorage.org/webt/ax/t9/k-/axt9k-s-zfi2kfd7qdz9pe-zlqq.png"><br><br>  Nous avons cr√©√© un module et quelques sections.  Mais ils n'ont pas encore cr√©√© Datapath.  Pour l'ajouter, allez dans l'arborescence du projet, s√©lectionnez le fichier <b>LCD4bit.v</b> , appuyez sur le bouton droit de la souris et s√©lectionnez <b>Datapath Config Tool</b> dans le menu contextuel qui appara√Æt: <br><br><img src="https://habrastorage.org/webt/z2/1g/5w/z21g5wom4_-yq_nmcjlhvb3irg0.png"><br><br>  Une fen√™tre s'ouvre devant nous, pour l'instant je ne montrerai que partiellement: <br><br><img src="https://habrastorage.org/webt/m0/fz/9i/m0fz9idl6xt5rimcittxpme2iea.png"><br><br>  Veuillez aimer et favoriser, √©diteur Datapath.  Il contient tous les bits d√©crits dans la traduction de la documentation propri√©taire.  Mais il y a tellement de ces morceaux qu'au d√©but, je l'ai regard√©, mais j'avais peur de faire quoi que ce soit.  Regardez, regardez et sortez.  Et ce n'est qu'apr√®s un certain temps, en s'y habituant, qu'il a commenc√© √† essayer de faire quelque chose.  En fait, c'est pourquoi je n'ai apport√© qu'une partie de la fen√™tre.  Pourquoi effrayer tout le monde √† l'avance?  En attendant, nous avons juste besoin de cr√©er un chemin de donn√©es, nous s√©lectionnons donc l'√©l√©ment de menu <b>√âdition-&gt; Nouveau chemin de donn√©es</b> : <br><br><img src="https://habrastorage.org/webt/-n/dx/vj/-ndxvjk_wrpdjucuq0_c3jcqfai.png"><br><br>  Quelle option choisir dans la bo√Æte de dialogue qui appara√Æt? <br><br><img src="https://habrastorage.org/webt/wf/ma/kf/wfmakfepho5l4h4nxffpua7wgok.png"><br><br>  La question est un peu plus s√©rieuse qu'il n'y para√Æt.  Permettez-moi m√™me de mettre en √©vidence le paragraphe suivant afin que personne ne se fasse attraper (je me suis fait attraper, puis j'ai vu des questions sur le r√©seau de celles que j'ai eues, et personne n'y a vraiment r√©pondu, et la r√©ponse est en <b>AN82156</b> , il vous suffit de le lire en diagonale, comme il est dit ici courte phrase discr√®te). <br><blockquote>  Si vous pr√©voyez de travailler avec des donn√©es parall√®les, vous devez absolument choisir l'option CY_PSOC3_DP.  Aucune autre option ne contiendra de ports pour la connexion de donn√©es parall√®les. </blockquote>  Alors.  Que l'instance soit appel√©e LCD_DP: <br><br><img src="https://habrastorage.org/webt/tf/a3/hs/tfa3hsi-mu2ljvyeukwmprwlm_4.png"><br><br>  Cliquez sur OK et fermez l' <b>outil de configuration de Datapath pour l'instant</b> , en acceptant d'enregistrer le r√©sultat.  Nous reviendrons ici plus tard. <br><br>  Notre code Verilog s'est √©tendu.  Maintenant, il a Datapath.  Son d√©but est totalement illisible.  Ce n'est pas effrayant, il est configur√© par <b>Datapath Config Tool</b> . <br><br><img src="https://habrastorage.org/webt/tz/d9/ur/tzd9urfa66hsfic2w9gsn6tkysu.png"><br><br>  Et nous d√©ciderons de la fin de la description de Datapath.  Notre site ressemble √† ceci <div class="spoiler">  <b class="spoiler_title">(√† partir de l√†, il est logique de tout mettre sous forme de texte).</b> <div class="spoiler_text"><pre><code class="plaintext hljs">)) LCD_DP( /* input */ .reset(1'b0), /* input */ .clk(1'b0), /* input [02:00] */ .cs_addr(3'b0), /* input */ .route_si(1'b0), /* input */ .route_ci(1'b0), /* input */ .f0_load(1'b0), /* input */ .f1_load(1'b0), /* input */ .d0_load(1'b0), /* input */ .d1_load(1'b0), /* output */ .ce0(), /* output */ .cl0(), /* output */ .z0(), /* output */ .ff0(), /* output */ .ce1(), /* output */ .cl1(), /* output */ .z1(), /* output */ .ff1(), /* output */ .ov_msb(), /* output */ .co_msb(), /* output */ .cmsb(), /* output */ .so(), /* output */ .f0_bus_stat(), /* output */ .f0_blk_stat(), /* output */ .f1_bus_stat(), /* output */ .f1_blk_stat(), /* input */ .ci(1'b0), // Carry in from previous stage /* output */ .co(), // Carry out to next stage /* input */ .sir(1'b0), // Shift in from right side /* output */ .sor(), // Shift out to right side /* input */ .sil(1'b0), // Shift in from left side /* output */ .sol(), // Shift out to left side /* input */ .msbi(1'b0), // MSB chain in /* output */ .msbo(), // MSB chain out /* input [01:00] */ .cei(2'b0), // Compare equal in from prev stage /* output [01:00] */ .ceo(), // Compare equal out to next stage /* input [01:00] */ .cli(2'b0), // Compare less than in from prv stage /* output [01:00] */ .clo(), // Compare less than out to next stage /* input [01:00] */ .zi(2'b0), // Zero detect in from previous stage /* output [01:00] */ .zo(), // Zero detect out to next stage /* input [01:00] */ .fi(2'b0), // 0xFF detect in from previous stage /* output [01:00] */ .fo(), // 0xFF detect out to next stage /* input [01:00] */ .capi(2'b0), // Software capture from previous stage /* output [01:00] */ .capo(), // Software capture to next stage /* input */ .cfbi(1'b0), // CRC Feedback in from previous stage /* output */ .cfbo(), // CRC Feedback out to next stage /* input [07:00] */ .pi(8'b0), // Parallel data port /* output [07:00] */ .po() // Parallel data port );</code> </pre> <br></div></div><br>  Effrayant  Maintenant, nous allons d√©couvrir ce qui est quoi - ce n'est plus effrayant.  En fait, il y a trois groupes distincts dans ce texte.  Rappelons la traduction de la documentation.  √Ä quoi ressemblait le chemin de donn√©es dans l'image?  Je noterai imm√©diatement sur la figure les endroits auxquels appartiennent les groupes ¬´1¬ª, ¬´2¬ª et ¬´3¬ª. <br><br><img src="https://habrastorage.org/webt/ji/xe/5x/jixe5x_fxqpx6kgybrjmakagpw4.png"><br><br>  En fait, le premier groupe de ports dans le code verilog est les entr√©es.  Comparez les noms en sortie du multiplexeur d'entr√©e (¬´1¬ª sur la figure) et les noms des signaux dans le code. <br><br>  Maintenant, toutes les entr√©es sont nulles.  Nous devrons connecter l'entr√©e d'horloge et nous pouvons transmettre jusqu'√† six lignes d'entr√©e, comme cela a √©t√© fait dans l'√©diteur UDB.  Ces entr√©es sont: <br><br><pre> <code class="plaintext hljs"> /* input */ .reset(1'b0), /* input */ .clk(1'b0), /* input [02:00] */ .cs_addr(3'b0), /* input */ .route_si(1'b0), /* input */ .route_ci(1'b0), /* input */ .f0_load(1'b0), /* input */ .f1_load(1'b0), /* input */ .d0_load(1'b0), /* input */ .d1_load(1'b0),</code> </pre><br>  Le deuxi√®me groupe est celui des sorties.  Les noms dans le code co√Øncident √©galement avec les noms des entr√©es du multiplexeur de sortie "2": <br><br><pre> <code class="plaintext hljs"> /* output */ .ce0(), /* output */ .cl0(), /* output */ .z0(), /* output */ .ff0(), /* output */ .ce1(), /* output */ .cl1(), /* output */ .z1(), /* output */ .ff1(), /* output */ .ov_msb(), /* output */ .co_msb(), /* output */ .cmsb(), /* output */ .so(), /* output */ .f0_bus_stat(), /* output */ .f0_blk_stat(), /* output */ .f1_bus_stat(), /* output */ .f1_blk_stat(),</code> </pre><br>  Seule l'esp√®ce Datapath donn√©e a le troisi√®me groupe (les autres n'en ont pas, donc il n'y a pas de donn√©es parall√®les).  Il s'agit de signaux de chemin de donn√©es internes √† travers lesquels vous pouvez cha√Æner ind√©pendamment ou effectuer d'autres actions utiles.  Les noms dans le code co√Øncident √©galement avec les noms des signaux internes diffus√©s sur la figure.  Nous, via l'un d'entre eux (le dernier de la liste, son nom est <b>po</b> ), sortirons des donn√©es parall√®les directement vers les pattes de la puce. <br><br><pre> <code class="plaintext hljs"> /* input */ .ci(1'b0), // Carry in from previous stage /* output */ .co(), // Carry out to next stage /* input */ .sir(1'b0), // Shift in from right side /* output */ .sor(), // Shift out to right side /* input */ .sil(1'b0), // Shift in from left side /* output */ .sol(), // Shift out to left side /* input */ .msbi(1'b0), // MSB chain in /* output */ .msbo(), // MSB chain out /* input [01:00] */ .cei(2'b0), // Compare equal in from prev stage /* output [01:00] */ .ceo(), // Compare equal out to next stage /* input [01:00] */ .cli(2'b0), // Compare less than in from prv stage /* output [01:00] */ .clo(), // Compare less than out to next stage /* input [01:00] */ .zi(2'b0), // Zero detect in from previous stage /* output [01:00] */ .zo(), // Zero detect out to next stage /* input [01:00] */ .fi(2'b0), // 0xFF detect in from previous stage /* output [01:00] */ .fo(), // 0xFF detect out to next stage /* input [01:00] */ .capi(2'b0), // Software capture from previous stage /* output [01:00] */ .capo(), // Software capture to next stage /* input */ .cfbi(1'b0), // CRC Feedback in from previous stage /* output */ .cfbo(), // CRC Feedback out to next stage /* input [07:00] */ .pi(8'b0), // Parallel data port /* output [07:00] */ .po() // Parallel data port );</code> </pre><br>  Alors.  Pendant que nous travaillons, nous devrons connecter certaines de ces entr√©es et sorties √† nos propres entit√©s, et les autres - il suffit de les laisser sous la forme dans laquelle nous les avons cr√©√©es. <br><br><h2>  Utiliser l'√©diteur UDB comme r√©f√©rence </h2><br>  Et maintenant nous avons un blanc, nous savons o√π et ce que nous devons √©crire.  Reste √† comprendre ce que nous y entrerons exactement.  Il se trouve que j'utilise le langage Verilog pas tous les jours, donc en g√©n√©ral je me souviens de tout, et √©crire √† partir de z√©ro pour moi est toujours une situation stressante.  Lorsque le projet est d√©j√† en cours, tout est m√©moris√©, mais si apr√®s quelques mois d'inactivit√© je commence quelque chose √† partir de z√©ro, bien s√ªr, je ne me souviens plus des d√©tails de syntaxe de ce langage particulier.  Par cons√©quent, je sugg√®re de demander √† l'environnement de d√©veloppement de nous aider. <br><br>  L'√©diteur UDB pour l'auto-surveillance construit du code Verilog.  Nous profitons du fait que les composants qui ne sont pas impliqu√©s dans le circuit principal ne sont pas compil√©s, nous pouvons donc cr√©er un composant auxiliaire dans l'√©diteur UDB, et il n'entrera pas dans le code de sortie.  Nous y dessinerons un automate, nous effectuerons un ajustement approximatif des entr√©es et des sorties de Datapath, puis transf√©rerons simplement le texte g√©n√©r√© automatiquement vers notre module verilog et modifierons tout de mani√®re cr√©ative.  C'est beaucoup plus simple que de se souvenir des d√©tails de la syntaxe Verilog et de tout √©crire √† partir de z√©ro (bien que quiconque utilise Verilog en permanence, bien s√ªr, il sera plus facile d'√©crire √† partir de z√©ro: l'ach√®vement cr√©atif, comme nous le verrons bient√¥t, est simple, mais n√©cessite temps). <br><br>  Donc, nous commen√ßons √† faire un composant auxiliaire.  Avec le mouvement habituel de la main, nous ajoutons un nouvel √©l√©ment au projet: <br><br><img src="https://habrastorage.org/webt/to/d2/fg/tod2fgx1opcdho2edizges-vr3q.png"><br><br>  Ce sera un document UDB, appelons-le <b>UDBhelper</b> : <br><br><img src="https://habrastorage.org/webt/j3/wt/iu/j3wtiuj2htdr-ct4f7m_3z497oi.png"><br><br>  Il est temps de penser √† la machine, que nous placerons sur la feuille cr√©√©e.  Pour ce faire, nous devons consid√©rer quel diagramme temporel nous devons former avec lui: <br><br><img src="https://habrastorage.org/webt/rh/zj/da/rhzjdasl8ioia8n8okjuuaieft4.png"><br><br><img src="https://habrastorage.org/webt/dy/3a/0z/dy3a0zmkacoa4tvgaugebovdhqy.png"><br><br>  Alors.  Vous devez d'abord d√©finir le signal RS (car R / W est soud√© √† z√©ro dans le mat√©riel).  Ensuite, attendez tAS, puis augmentez le signal E et r√©glez les donn√©es (le param√©trage des donn√©es par rapport au front positif E n'est pas limit√©).  Les donn√©es doivent √™tre sur le bus pas moins que tDSW, apr√®s quoi le signal E doit √™tre abandonn√©. Les donn√©es doivent rester sur le bus pendant au moins tDHW et RS pendant au moins tAH. <br><br>  RS est l'indicateur de commande ou de donn√©es.  Si RS est nul, alors une commande est √©crite, si elle est une, les donn√©es sont √©crites. <br><br>  Je sugg√®re d'envoyer des commandes via <b>FIFO0</b> et des donn√©es via <b>FIFO1</b> .  Dans le cadre de la t√¢che actuelle, cela ne contredit rien.  La machine √† √©tats finis que j'ai propos√©e aura alors la forme suivante: <br><br><img src="https://habrastorage.org/webt/jn/6y/6j/jn6y6jnzllwbwgmslak7nif1xmu.png"><br><br>  √Ä l'√©tat <b>inactif</b> , la machine ne contient toujours pas de donn√©es FIFO.  Si des donn√©es sont apparues dans <b>FIFO0</b> , elles vont √† <b>LoadF0</b> , o√π √† l'avenir elles recevront des donn√©es de <b>FIFO0</b> √† A0. <br><br>  Pendant la transmission des commandes, les donn√©es ne doivent pas √™tre envoy√©es.  Par cons√©quent, la condition de r√©ception des donn√©es sera moins prioritaire que la condition de r√©ception des commandes. <br><br><img src="https://habrastorage.org/webt/og/gn/fl/oggnfl3tcjcxa8pzu64qcj3yzpa.png"><br><br>  Les donn√©es sont re√ßues dans A1 dans l'√©tat <b>LoadF1</b> (√† partir de <b>FIFO1,</b> elles ne peuvent aller que dans le registre A1 et ne peuvent pas aller dans le registre A0), puis elles sont copi√©es de A1 vers A0 dans l'√©tat <b>A1toA0</b> . <br><br>  Quelle que soit la fa√ßon dont nous allons au point de convergence des fl√®ches, nous avons des donn√©es en A0.  Ils sont d√©j√† sortis sur le port parall√®le.  Nous <b>armons</b> E (dans l'√©tat <b>E_UP1</b> ), <b>laissons</b> tomber E (dans l'√©tat <b>E_DOWN1</b> ).  Ensuite, nous aurons un √©tat pour permuter les quartets ( <b>SWAP</b> ), apr√®s quoi E remonte ( <b>E_UP2</b> ).  Sur ce point, j'ai √©puis√© huit √©tats qui peuvent √™tre encod√©s en trois bits.  Et nous nous souvenons que la RAM de configuration dynamique Datapath n'a que trois entr√©es d'adresse.  Quelques astuces pourraient √™tre appliqu√©es, mais l'article est d√©j√† volumineux.  Par cons√©quent, juste la deuxi√®me fois, nous laisserons tomber E √† l'√©tat <b>inactif</b> .  Ensuite, huit √âtats nous suffisent. <br><br>  Nous avons √©galement mis Datapath sur la feuille et assign√© ses entr√©es et sorties d'une mani√®re famili√®re dans les articles pr√©c√©dents.  Voici les entr√©es: <br><br><img src="https://habrastorage.org/webt/ct/fn/0j/ctfn0jvexwfycfrdovbnatwv7ze.png"><br><br>  Voici les sorties: <br><br><img src="https://habrastorage.org/webt/ct/mj/gd/ctmjgdzfvx-mz8qnzwbp6undlau.png"><br><br>  Rien de nouveau, tout a d√©j√† √©t√© d√©crit dans les pr√©c√©dents articles du cycle.  Donc, nous avons un blanc, sur la base duquel nous pouvons faire quelque chose de nous-m√™mes.  Certes, pour nous assurer que tout se passe bien, nous devons amener notre syst√®me au plus haut niveau du projet, sinon aucune erreur ne sera trouv√©e.  Et dans les premi√®res exp√©riences sans erreurs ne fonctionnera pas.  Par cons√©quent, nous effectuerons une action suppl√©mentaire. <br><br>  La description de la fabrication du circuit va au-del√† de la description du travail avec UDB.  Je vais juste vous montrer quel circuit j'ai.  Il n'y a qu'une seule unit√© DMA: lors de l'envoi de commandes √† l'√©cran LCD, il est n√©cessaire de supporter des pauses importantes, il est donc encore plus facile de le faire par programme.  Pour d'autres applications, vous pouvez simplement mettre le deuxi√®me bloc DMA par analogie en utilisant le signal <b>hungry0</b> . <br><br><img src="https://habrastorage.org/webt/mz/zd/g8/mzzdg80tinx_ffjjigxypmehj0w.png"><br><br>  Pour respecter pr√©cis√©ment le d√©lai, j'ai choisi une fr√©quence d'horloge √©gale √† un m√©gahertz.  Il serait possible de prendre une fr√©quence et plus, mais les donn√©es sont transmises sur de longs fils dans des conditions de forte interf√©rence, il est donc pr√©f√©rable de prendre le temps de r√©gler les donn√©es avant et apr√®s la porte avec une marge.  Si quelqu'un r√©p√®te mes exp√©riences sur la m√™me planche √† pain - n'utilisez pas le port P3.2: un condensateur est soud√© √† cette jambe sur la carte.  J'ai tu√© pendant une demi-heure, jusqu'√† ce que je d√©couvre pourquoi je n'ai pas form√© d'impulsion E, que j'ai d'abord connect√©e l√†-bas.  Je l'ai lanc√© en P3.1 - tout a fonctionn√© tout de suite.  Mon bus de donn√©es passe √† P3.7-P3.4, RS passe √† P3.3, donc E est initialement all√© √† P3.2 ... <br><br>  Eh bien ici.  Maintenant, si vous essayez de compiler le projet, nous obtenons des erreurs compl√®tement pr√©visibles <br><br><img src="https://habrastorage.org/webt/az/tm/fb/aztmfbvzsl52ghanjovqpva5_7o.png"><br><br>  Le syst√®me essaie donc de collecter quelque chose.  Mais elle n'a toujours rien √† collectionner.  Nous proc√©dons √† la copie du code.  Pour ce faire, dans l'√©diteur UDB, basculez vers l'onglet Verilog (cet onglet est situ√© sous la fen√™tre avec la feuille de l'√©diteur UDB): <br><br><img src="https://habrastorage.org/webt/kg/tk/fy/kgtkfyn1tssdt4-cjydawzl7vnw.png"><br><br>  Qu'est-ce qui vous est familier?  √Ä la toute fin du texte se trouve le corps de l'automate.  Commen√ßons la migration √† partir de celui-ci. <br><br><div class="spoiler">  <b class="spoiler_title">Placez-le √©galement sous Datapath:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">/* ==================== State Machine: SM ==================== */ always @ (posedge clock) begin : Idle_state_logic case(SM) Idle : begin if (( !F0empty ) == 1'b1) begin SM &lt;= LoadF0 ; end else if (( !F1empty ) == 1'b1) begin SM &lt;= LoadF1 ; end end LoadF0 : begin if (( 1'b1 ) == 1'b1) begin SM &lt;= E_Up1 ; end end E_Up1 : begin if (( 1'b1 ) == 1'b1) begin SM &lt;= E_Down1 ; end end E_Down1 : begin if (( 1'b1 ) == 1'b1) begin SM &lt;= SWAP ; end end SWAP : begin if (( 1'b1 ) == 1'b1) begin SM &lt;= E_UP2 ; end end E_UP2 : begin if (( 1'b1 ) == 1'b1) begin SM &lt;= Idle ; end end LoadF1 : begin if (( 1'b1 ) == 1'b1) begin SM &lt;= A1toA0 ; end end A1toA0 : begin if (( 1'b1 ) == 1'b1) begin SM &lt;= E_Up1 ; end end default : begin SM &lt;= Idle; end endcase end</code> </pre><br></div></div><br>  Il y a des d√©clarations en haut pour ce code (noms pour les √©tats, cha√Ænes pour Datapath, un registre encodant l'√©tat d'un automate).  Nous les transf√©rons vers les <div class="spoiler">  <b class="spoiler_title">section de notre code:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">/* ==================== Wire and Register Declarations ==================== */ localparam [2:0] Idle = 3'b000; localparam [2:0] LoadF0 = 3'b001; localparam [2:0] LoadF1 = 3'b010; localparam [2:0] E_Up1 = 3'b100; localparam [2:0] A1toA0 = 3'b011; localparam [2:0] E_Down1 = 3'b101; localparam [2:0] SWAP = 3'b110; localparam [2:0] E_UP2 = 3'b111; wire hungry0; wire F0empty; wire hungry1; wire F1empty; wire Datapath_1_d0_load; wire Datapath_1_d1_load; wire Datapath_1_f0_load; wire Datapath_1_f1_load; wire Datapath_1_route_si; wire Datapath_1_route_ci; wire [2:0] Datapath_1_select; reg [2:0] SM;</code> </pre><br></div></div><br>  Et bien <br><br><div class="spoiler">  <b class="spoiler_title">le site de liaison du signal est transf√©rable:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">/* ==================== Assignment of Combinatorial Variables ==================== */ assign Datapath_1_d0_load = (1'b0); assign Datapath_1_d1_load = (1'b0); assign Datapath_1_f0_load = (1'b0); assign Datapath_1_f1_load = (1'b0); assign Datapath_1_route_si = (1'b0); assign Datapath_1_route_ci = (1'b0); assign Datapath_1_select[0] = (SM[0]); assign Datapath_1_select[1] = (SM[1]); assign Datapath_1_select[2] = (SM[2]);</code> </pre><br></div></div><br>  Il est temps de brancher Datapath.  Le code port√© depuis l'√©diteur UDB est bon pour l'√©dition machine, mais pas tr√®s bon pour l'√©dition manuelle.  L√†, des cha√Ænes sont cr√©√©es qui se connectent aux entr√©es Datapath √† une extr√©mit√© et aux constantes √† l'autre.  Mais dans le code cr√©√© par l' <b>outil de configuration de Datapath</b> (qui fait tout pour le travail manuel), toutes les entr√©es sont d√©j√† directement connect√©es √† z√©ro constantes.  Je ne connecterai donc que les lignes qui ne sont pas des constantes, mais je supprimerai tout ce qui concerne le transfert des constantes du texte transf√©r√©.  La connexion s'est d√©roul√©e comme ceci (la couleur met en √©vidence les endroits que j'ai modifi√©s concernant les cr√©√©s automatiquement dans l'outil de configuration de Datapath): <br><br><img src="https://habrastorage.org/webt/-3/gk/fd/-3gkfd3bhnnc7wygbr6wpqoscyo.png"><br><br><div class="spoiler">  <b class="spoiler_title">M√™me texte:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">)) LCD_DP( /* input */ .reset(1'b0), /* input */ .clk(clk), /* input [02:00] */ .cs_addr(SM), /* input */ .route_si(1'b0), /* input */ .route_ci(1'b0), /* input */ .f0_load(1'b0), /* input */ .f1_load(1'b0), /* input */ .d0_load(1'b0), /* input */ .d1_load(1'b0), /* output */ .ce0(), /* output */ .cl0(), /* output */ .z0(), /* output */ .ff0(), /* output */ .ce1(), /* output */ .cl1(), /* output */ .z1(), /* output */ .ff1(), /* output */ .ov_msb(), /* output */ .co_msb(), /* output */ .cmsb(), /* output */ .so(), /* output */ .f0_bus_stat(hungry0), /* output */ .f0_blk_stat(F0empty), /* output */ .f1_bus_stat(hungry1), /* output */ .f1_blk_stat(F1empty),</code> </pre><br></div></div><br>  Les donn√©es parall√®les sont un peu plus compliqu√©es.  Datapath poss√®de un port huit bits et seuls quatre d'entre eux doivent √™tre sortis.  Par cons√©quent, nous d√©marrons le circuit auxiliaire et n'en connectons que la moiti√© √† la sortie: <br><br><pre> <code class="plaintext hljs">wire [7:0] tempBus; assign LCD_D = tempBus[7:4];</code> </pre><br>  Et connectez-le comme ceci: <br><br><img src="https://habrastorage.org/webt/km/aq/_a/kmaq_abi2kkprp406kne413j5u0.png"><br><br><div class="spoiler">  <b class="spoiler_title">M√™me texte:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> /* input [07:00] */ .pi(8'b0), // Parallel data port /* output [07:00] */ .po( tempBus) // Parallel data port );</code> </pre><br></div></div><br>  Nous essayons d'assembler (Shift + F6 ou via l'√©l√©ment de menu <b>Build-&gt; Generate Application</b> ).  Nous obtenons l'erreur: <br><br><img src="https://habrastorage.org/webt/kw/ox/as/kwoxasreij4-snkxyvc63iqozxq.png"><br><br>  Nous avons des ports <b>hungry0</b> et <b>hungry1</b> (apparus lors de la cr√©ation du composant), ainsi que des cha√Ænes du m√™me nom (apparus lors du glissement depuis l'exemple).  Retirez simplement ces cha√Ænes (quittez les ports).  Et quelque part le signal d' <b>horloge</b> a fui, et nous avons ce circuit appel√© <b>clk</b> . <br><br>  Apr√®s avoir supprim√© tous les circuits inutiles (ceux qui ont initialement transmis z√©ro constantes aux entr√©es Datapath, ainsi que <b>hungry0</b> et <b>hungry1</b> ), nous obtenons le code suivant pour le d√©but de notre fichier: <br><br><pre> <code class="plaintext hljs">// Your code goes here /* ==================== Wire and Register Declarations ==================== */ localparam [2:0] Idle = 3'b000; localparam [2:0] LoadF0 = 3'b001; localparam [2:0] LoadF1 = 3'b010; localparam [2:0] E_Up1 = 3'b100; localparam [2:0] A1toA0 = 3'b011; localparam [2:0] E_Down1 = 3'b101; localparam [2:0] SWAP = 3'b110; localparam [2:0] E_UP2 = 3'b111; wire F0empty; wire F1empty; reg [2:0] SM; /* ==================== Assignment of Combinatorial Variables ==================== */ wire [7:0] tempBus; assign LCD_D = tempBus[7:4];</code> </pre><br>  Et lors du remplacement de l' <b>horloge</b> par <b>clk</b> dans le corps de la machine, en m√™me temps, je jetterai toutes les lignes qui sont bonnes pour la g√©n√©ration automatique, mais avec l'√©dition manuelle ne cr√©e que de la confusion (toutes les comparaisons qui donnent un r√©sultat inconditionnel <b>VRAI</b> et ainsi de suite).  En particulier, dans l'exemple ci-dessous, vous pouvez barrer environ la moiti√© des lignes (et certains <b>d√©but / fin</b> sont facultatifs, parfois ils seront n√©cessaires, car nous ajouterons des actions, je les ai surlign√©es): <br><br><img src="https://habrastorage.org/webt/9s/e9/t1/9se9t15zkc1hux1qrpga3jbh7cm.png"><br><br>  Apr√®s avoir peign√© selon le principe ci-dessus (et remplac√© l' <b>horloge</b> par <b>clk</b> ), un tel corps reste <br><br><div class="spoiler">  <b class="spoiler_title">(il est devenu plus court, ce qui signifie qu'il est plus facile √† lire):</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">always @ (posedge clk) begin : Idle_state_logic case(SM) Idle : begin if (( !F0empty ) == 1'b1) begin SM &lt;= LoadF0 ; end else if (( !F1empty ) == 1'b1) begin SM &lt;= LoadF1 ; end end LoadF0 : begin SM &lt;= E_Up1 ; end E_Up1 : begin SM &lt;= E_Down1 ; end E_Down1 : begin SM &lt;= SWAP ; end SWAP : begin SM &lt;= E_UP2 ; end E_UP2 : begin SM &lt;= Idle ; end LoadF1 : begin SM &lt;= A1toA0 ; end A1toA0 : begin SM &lt;= E_Up1 ; end default : begin SM &lt;= Idle; end endcase end</code> </pre><br></div></div><br>  Maintenant, lors de la compilation, on nous dit que les <b>circuits</b> <b>LCD_E</b> et <b>LCD_RS</b> ne <b>sont</b> pas connect√©s. <br><br>  En fait, c'est vrai: <br><br><img src="https://habrastorage.org/webt/cz/da/h7/czdah7nfkzmou2mr8-omzs_-hby.png"><br><br>  Le moment est venu d'ajouter de l'action √† la machine d'√©tat.  Nous remplacerons les d√©clarations des ports correspondant aux cha√Ænes non connect√©es par <b>reg</b> , puisque nous les √©crirons dans le corps de la machine (c'est la syntaxe du langage Verilog, si nous √©crivons, les donn√©es doivent cliquer, pour cela nous avons besoin d'un d√©clencheur, et elles sont donn√©es par le mot-cl√© <b>reg</b> ): <br><br><img src="https://habrastorage.org/webt/l5/vq/uj/l5vqujn7yirpf4dkorxzevy9ij4.png"><br><div class="spoiler">  <b class="spoiler_title">M√™me texte:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">module LCD4bit ( output hungry0, output hungry1, output [3:0] LCD_D, output reg LCD_E, output reg LCD_RS, input clk );</code> </pre><br></div></div><br>  Et remplissez la machine d'actions.  J'ai d√©j√† dit la logique ci-dessus lorsque je consid√©rais le graphe de transition de l'automate, donc je ne montrerai que le r√©sultat: <br><br><img src="https://habrastorage.org/webt/ij/t1/5i/ijt15itzdfznooyvlgz0sjlk5t4.png"><br><div class="spoiler">  <b class="spoiler_title">M√™me texte:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">always @ (posedge clk) begin : Idle_state_logic case(SM) Idle : begin LCD_E &lt;= 0; if (( !F0empty ) == 1'b1) begin SM &lt;= LoadF0 ; LCD_RS &lt;= 0; end else if (( !F1empty ) == 1'b1) begin SM &lt;= LoadF1 ; LCD_RS &lt;= 1; end end LoadF0 : begin SM &lt;= E_Up1 ; end E_Up1 : begin SM &lt;= E_Down1 ; LCD_E &lt;= 1'b1; end E_Down1 : begin SM &lt;= SWAP ; LCD_E &lt;= 1'b0; end SWAP : begin SM &lt;= E_UP2 ; end E_UP2 : begin SM &lt;= Idle ; LCD_E &lt;= 1; end LoadF1 : begin SM &lt;= A1toA0 ; end A1toA0 : begin SM &lt;= E_Up1 ; end default : begin SM &lt;= Idle; end endcase end</code> </pre><br></div></div><br>  A partir de ce moment, le projet commence √† se monter.  Mais il ne fonctionnera pas encore.  Jusqu'√† pr√©sent, j'ai dit: ¬´Dans cet √©tat, nous chargerons le registre √† partir de FIFO¬ª, ¬´Dans ce cas, A1 sera copi√© dans A0¬ª, ¬´Nibbles sera r√©organis√© dans ce domaine¬ª.  En g√©n√©ral, j'ai beaucoup parl√©, mais jusqu'√† pr√©sent, il n'y a eu aucune action.  Le moment est venu de les r√©aliser.  Nous regardons comment les √©tats ont √©t√© encod√©s: <br><br><pre> <code class="plaintext hljs">localparam [2:0] Idle = 3'b000; localparam [2:0] LoadF0 = 3'b001; localparam [2:0] LoadF1 = 3'b010; localparam [2:0] E_Up1 = 3'b100; localparam [2:0] A1toA0 = 3'b011; localparam [2:0] E_Down1 = 3'b101; localparam [2:0] SWAP = 3'b110; localparam [2:0] E_UP2 = 3'b111;</code> </pre><br>  <b>Rouvrez l'outil de configuration de chemin de donn√©es</b> : <br><br><img src="https://habrastorage.org/webt/eh/oh/sz/ehohszogw7vzyiup9cjumf4b3ii.png"><br><br>  Et commencez √† <b>√©diter les</b> lignes <b>CFGRAM</b> .  Lors de l'√©dition, vous devez garder √† l'esprit le sch√©ma Datapath, √† savoir: <br><br><img src="https://habrastorage.org/webt/cz/xr/vu/czxrvuaul7vkqilrqinrgzpu1fy.png"><br><br>  Les cadres rouges dans la figure ci-dessous (et les fl√®ches dans la figure ci-dessus) ont mis en √©vidence les zones corrig√©es (et le chemin de donn√©es) pour l'√©tat <b>LoadF0</b> (code 001, c'est-√†-dire <b>Reg1</b> ).  J'ai √©galement entr√© des commentaires manuellement.  Le contenu de F0 devrait entrer dans A0. <br><br><img src="https://habrastorage.org/webt/4z/zv/kh/4zzvkhchg55gnp-39oag_d-bkt8.png"><br><br>  Avec des cadres et des fl√®ches vertes, j'ai marqu√© les param√®tres et le chemin de l'√©tat LoadF1 (code 010 - <b>Reg2</b> ). <br><br>  Avec des cadres et des fl√®ches bleues, j'ai marqu√© les param√®tres et le chemin pour l'√©tat A1toA0 (code 011 - <b>Reg3</b> ). <br><br>  Les cadres et les fl√®ches violets ont marqu√© les param√®tres et le chemin pour l'√©tat de SWAP (code 110 - <b>Reg6</b> ). <br><br>  Enfin, les fl√®ches oranges indiquent le chemin de donn√©es parall√®le.  Et aucune action n'est entreprise pour eux.  Ils sortent toujours de la <b>SRCA</b> .  Nous avons presque toujours A0 s√©lectionn√© comme <b>SRCA</b> : les donn√©es proviennent de A0.  Donc, pour rediriger les donn√©es d'entr√©e, nous devons effectuer beaucoup d'actions auxiliaires, mais nous n'acceptons aucune donn√©e, donc ici nous n'avons pas besoin de ces actions, et tout le monde trouvera sa liste dans <b>AN82156</b> .  Nous n'avons pas non plus besoin de modifier les param√®tres de chemin de donn√©es statiques, fermez donc l' <b>outil de configuration de chemin de donn√©es</b> . <br><br>  C‚Äôest tout.  Mat√©riel con√ßu termin√©.  Commencer √† d√©velopper du code C.  Pour ce faire, acc√©dez √† l'onglet <b>Source</b> et modifiez le fichier <b>main.c.</b> <br><br><img src="https://habrastorage.org/webt/fp/ia/7s/fpia7s4zyzaxy8mzmqxktib-obw.png"><br><br>  L'initialisation LCD r√©guli√®re et la sortie du caract√®re "ABC" ressemblent √† ceci (je vous rappelle que les commandes vont √† <b>FIFO0</b> , la documentation doit ins√©rer des pauses entre les √©quipes, et les donn√©es vont √† <b>FIFO1</b> , je n'ai rien trouv√© sur les pauses entre les donn√©es): <br><br><pre> <code class="plaintext hljs"> volatile uint8_t* pFIFO0 = (uint8_t*) LCD4bit_1_LCD_DP__F0_REG; volatile uint8_t* pFIFO1 = (uint8_t*) LCD4bit_1_LCD_DP__F1_REG; pFIFO0[0] = 0x33; CyDelay (5); pFIFO0[0] = 0x33; CyDelay (100); pFIFO0[0] = 0x33; CyDelay (5); pFIFO0[0] = 0x20; CyDelay (5); pFIFO0[0] = 0x0C; //   CyDelay (50); pFIFO0[0] = 0x01; //   CyDelay (50); pFIFO1[0] = 'A'; pFIFO1[0] = 'B'; pFIFO1[0] = 'C';</code> </pre><br>  Qu'est-ce que  Pourquoi n'y a-t-il que le premier caract√®re √† l'√©cran? <br><br><img src="https://habrastorage.org/webt/3g/tq/sr/3gtqsrr050bqbhaqi2ke9g1pg0w.png"><br><br>  Et si vous ajoutez des retards entre la sortie des donn√©es - tout va bien: <br><br><img src="https://habrastorage.org/webt/3b/he/2a/3bhe2a1_ioou2gktkqfzydumrne.png"><br><br>  L'oscilloscope n'a pas suffisamment de canaux pour un tel travail.  Nous v√©rifions le travail sur un analyseur logique.  Le processus d'enregistrement des donn√©es est le suivant. <br><br><img src="https://habrastorage.org/webt/yr/y_/_j/yry__jhgasihbzmmrrr2cnsylaq.png"><br><br>  Toutes les donn√©es sont en place (trois paires de packages).  Le temps d'installation et de capture des donn√©es est allou√© en un volume suffisant.  En g√©n√©ral, du point de vue des diagrammes de temps - tout est fait correctement.  Le probl√®me scientifique est r√©solu, les chronogrammes souhait√©s se forment.  Voici l'ing√©nierie - non.  La raison en est la lenteur du processeur install√© sur l'√©cran LCD.  Entre les octets, ajoutez des retards. <br><br>  Nous formerons des retards √† l'aide d'un compteur √† sept bits, en m√™me temps nous nous entra√Ænerons √† l'ajouter √† un tel syst√®me.  Soyons au repos au moins un certain temps, et un compteur √† sept bits mesurera ce temps pour nous.  Et encore une fois, nous n'√©crirons pas, mais cr√©erons du code.  Par cons√©quent, nous allons √† nouveau au composant auxiliaire de l'√©diteur UDB et ajoutons un compteur √† la feuille de calcul, en d√©finissant ses param√®tres comme suit: <br><br><img src="https://habrastorage.org/webt/gq/8c/qw/gq8cqwl0liu7mv9gpgm8-wngom0.png"><br><br>  Ce compteur fonctionnera toujours ( <b>Enable est r√©gl√©</b> sur 1).  Mais il se charge lorsque la machine est dans l'√©tat <b>E_UP2</b> (apr√®s quoi nous tombons imm√©diatement dans l'√©tat <b>inactif</b> ).  La ligne <b>Count7_1_tc sera</b> augment√©e √† 1 lorsque le compteur comptera jusqu'√† z√©ro, ce qui nous fera une condition suppl√©mentaire pour sortir de l'√©tat <b>inactif</b> .  La figure contient √©galement la valeur de la p√©riode, mais nous ne la trouverons pas dans le code Verilog.  Il devra √™tre entr√© dans le code C.  Mais d'abord, nous transf√©rons le code Verilog g√©n√©r√© automatiquement en basculant vers l'onglet Verilog.  Tout d'abord, le compteur doit √™tre connect√© (nous voyons ce code au d√©but du fichier et le d√©pla√ßons √©galement au d√©but): <br><br><pre> <code class="plaintext hljs">`define CY_BLK_DIR "$CYPRESS_DIR\..\psoc\content\CyComponentLibrary\CyComponentLibrary.cylib\Count7_v1_0" `include "$CYPRESS_DIR\..\psoc\content\CyComponentLibrary\CyComponentLibrary.cylib\Count7_v1_0\Count7_v1_0.v"</code> </pre><br>  La fa√ßon dont le raffinement cr√©atif des lignes et des constantes est effectu√© a d√©j√† √©t√© d√©crite, je vais donc simplement montrer le r√©sultat.  Voici les cha√Ænes et les affectations ajout√©es en cons√©quence (le reste d√©finit les constantes, donc je les ai jet√©es): <br><br><pre> <code class="plaintext hljs">wire Count7_1_load; wire Count7_1_tc; assign Count7_1_load = (SM==E_UP2);</code> </pre><br>  Et voici le compteur lui-m√™me, plac√© √† la fin du fichier.  Toutes les constantes sont affect√©es aux ports directement dans cette d√©claration: <br><br><pre> <code class="plaintext hljs"> Count7_v1_0 Count7_1 ( .en(1'b1), .load(Count7_1_load), .clock(clk), .reset(1'b0), .cnt(), .tc(Count7_1_tc)); defparam Count7_1.EnableSignal = 1; defparam Count7_1.LoadSignal = 1;</code> </pre><br>  Pour permettre √† ce compteur de fonctionner, nous ajoutons automatiquement une condition suppl√©mentaire pour quitter l'√©tat <b>inactif</b> : <br><br><img src="https://habrastorage.org/webt/pc/it/pd/pcitpdmqenlvq8pblarf3uh5h84.png"><br><div class="spoiler">  <b class="spoiler_title">M√™me texte:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> case(SM) Idle : begin LCD_E &lt;= 0; if (( !F0empty ) == 1'b1) begin SM &lt;= LoadF0 ; LCD_RS &lt;= 0; end else if (( !F1empty &amp;Count7_1_tc ) == 1'b1) begin SM &lt;= LoadF1 ; LCD_RS &lt;= 1; end end</code> </pre><br></div></div><br>  L'API pour le compteur ajout√© de cette mani√®re n'est pas cr√©√©e, nous ajoutons donc deux lignes magiques √† la fonction <b>principale</b> , que j'ai form√©es √† l'image et √† la ressemblance de ce que j'ai vu dans l'API √† partir de projets pr√©c√©dents (la premi√®re ligne d√©finit la valeur charg√©e du compte, la m√™me charge, la seconde d√©marre le compteur): <br><br><pre> <code class="plaintext hljs"> *((uint8_t*)LCD4bit_1_Count7_1_Counter7__PERIOD_REG) = 0x20; *((uint8_t*)LCD4bit_1_Count7_1_Counter7__CONTROL_AUX_CTL_REG) |= 0x20; // Start</code> </pre><br>  L'analyseur montre que dans le cas modifi√© le retard est √©vident: <br><br><img src="https://habrastorage.org/webt/ui/ey/ax/uieyax5yt3f0kpkhyyoikiishmq.png"><br><br>  L'√©cran LCD poss√®de √©galement les trois caract√®res. <br><br>  Mais la sortie de caract√®re programmatique dans la vie r√©elle est inacceptable.  Le simple fait de les ajouter √† FIFO d√©bordera.  Attendez que le FIFO se vide - cela signifie cr√©er de grands retards pour le c≈ìur du processeur.     72 ,     7-8    1 .         DMA.      ¬´  ¬ª.        UDB,   FIFO        DMA.            DMA,       ,       . <br><br><div class="spoiler"> <b class="spoiler_title">  :</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> static const char line[] = "This is a line"; /* Defines for DMA_D */ #define DMA_D_BYTES_PER_BURST 1 #define DMA_D_REQUEST_PER_BURST 1 /* Variable declarations for DMA_D */ /* Move these variable declarations to the top of the function */ uint8 DMA_D_Chan; uint8 DMA_D_TD[1]; /* DMA Configuration for DMA_D */ DMA_D_Chan = DMA_D_DmaInitialize(DMA_D_BYTES_PER_BURST, DMA_D_REQUEST_PER_BURST, HI16(line), HI16(LCD4bit_1_LCD_DP__F1_REG)); DMA_D_TD[0] = CyDmaTdAllocate(); CyDmaTdSetConfiguration(DMA_D_TD[0], sizeof(line)-1, CY_DMA_DISABLE_TD, CY_DMA_TD_INC_SRC_ADR); CyDmaTdSetAddress(DMA_D_TD[0], LO16((uint32)line), LO16((uint32)LCD4bit_1_LCD_DP__F1_REG)); CyDmaChSetInitialTd(DMA_D_Chan, DMA_D_TD[0]); CyDmaChEnable(DMA_D_Chan, 1);</code> </pre><br></div></div><br>   : <br><br><img src="https://habrastorage.org/webt/i7/ny/vi/i7nyvipk7tg8w_jdflryw2s39uk.png"><br><br><h2>  Conclusion </h2><br>  ,     ,        UDB     ‚Äî Datapath Config Tool.  ,    UDB Editor,        UDB,     ,   UDB Editor.             ,    ,    ,     UDB Editor. <br><br>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr442572/">https://habr.com/ru/post/fr442572/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr442560/index.html">Mash: multithreading, coroutines, async et attente</a></li>
<li><a href="../fr442562/index.html">Comment refroidir l'√©quipement dans un centre de donn√©es - trois nouvelles technologies</a></li>
<li><a href="../fr442566/index.html">Comme sur la Lune: ing√©nierie inverse d'un module d'ampli op hybride</a></li>
<li><a href="../fr442568/index.html">Security Week 10: vuln√©rabilit√©s du pilote NVIDIA</a></li>
<li><a href="../fr442570/index.html">R√®gles Sigma. Craft ou nouvelle norme pour SOC</a></li>
<li><a href="../fr442574/index.html">Cr√©ation de la base d'une th√©orie g√©n√©ralis√©e des r√©seaux de neurones</a></li>
<li><a href="../fr442576/index.html">Overclockers de longue dur√©e: comment le refroidissement liquide a commenc√© √† dominer dans les centres de donn√©es</a></li>
<li><a href="../fr442578/index.html">Version Linux 5.0</a></li>
<li><a href="../fr442580/index.html">R√©tro-ing√©nierie au format binaire utilisant les fichiers Korg .SNG comme exemple</a></li>
<li><a href="../fr442582/index.html">Comment nous avons essay√© le mobbing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>