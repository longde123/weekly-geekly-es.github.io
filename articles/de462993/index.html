<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéõÔ∏è üìª üöÖ So verwandeln Sie ein Smartphone in eine vollwertige Kasse üÜñ üçë üöÜ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Jeden Tag sehen wir in Gesch√§ften verschiedene Kassen - alle Arten von eingebetteten L√∂sungen mit mysteri√∂sen Tasten. Hinter solchen Kassen stehen Kas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>So verwandeln Sie ein Smartphone in eine vollwertige Kasse</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/moysklad/blog/462993/"><p>  Jeden Tag sehen wir in Gesch√§ften verschiedene Kassen - alle Arten von eingebetteten L√∂sungen mit mysteri√∂sen Tasten.  Hinter solchen Kassen stehen Kassierer, die "Galya, wir haben abgesagt" rufen.  Dies ist sowohl f√ºr Kassierer als auch f√ºr K√§ufer unpraktisch. </p><br><p>  Die Checkout-Oberfl√§che wird mit der Zeit benutzerfreundlicher, und Gali wird bereits weniger ben√∂tigt, aber das Auschecken ist immer noch ein umst√§ndliches und komplexes Artefakt. </p><br><p><img src="https://habrastorage.org/webt/zq/bc/ia/zqbcia27fpbw0x-pgb09nk2khtw.png"></p><br><p>  Mein Name ist Vladimir Sarbeev, ich bin ein Android-Entwickler in MySklad.  Und ich bin mir sicher, dass die Registrierkasse kompakt und bequem sein kann.  Dar√ºber hinaus k√∂nnen Sie Ihr Smartphone in eine Kasse verwandeln. </p><a name="habracut"></a><br><p>  In MyStore haben wir die mobile Anwendung Kassa MyStore erstellt.  Dies ist eine vollst√§ndige Abendkasse im Smartphone. </p><br><p>  Das funktioniert so: Nach der Autorisierung kann der Kassierer Schichten √∂ffnen und schlie√üen, Waren direkt oder nach Voranmeldung verkaufen, Bargeld ber√ºcksichtigen.  Sie k√∂nnen Ger√§te, die f√ºr die Arbeit erforderlich sind, an die Kasse anschlie√üen.  Sie sind auf dem Foto: </p><br><p><img src="https://habrastorage.org/webt/wp/_t/8k/wp_t8kkm69mpwtht7fb7d6a36nq.png"><br>  <em>1 - Abendkasse Atol Sigma 10;</em>  <em>2 - Die Anwendung wird nicht unterst√ºtzt, Integration mit Mitarbeitern</em> <br>  <em>3 - Fahrkartenschalter Atol 11F;</em>  <em>4 - Terminal Verifone VX820;</em>  <em>5 - Anschluss PAX S90</em> <br>  <em>6 - Abendkasse Shtrikh-Nano-F;</em>  <em>7 - Fahrkartenschalter Atol 15F;</em>  <em>8 - Abendkasse Bar-ON-LINE</em> <br>  <em>9 - Barcode-Scanner;</em>  <em>10 - PayMe-Terminal;</em>  <em>11 - Kasse MSPOS-K</em> </p><br><p>  Das Smartphone selbst kann keine Quittungen ausdrucken und Zahlungen mit Kreditkarte akzeptieren. Daher werden Kassen und Zahlungsterminals ben√∂tigt.  Ein Hardware-Scanner ist erforderlich, wenn die Kamera des Smartphones nicht f√ºr einen vollst√§ndigen Austausch des Barcode-Scanners geeignet ist. </p><br><h2 id="vsevidyaschee-oko">  Allsehendes Auge </h2><br><p>  Noch vor der Ver√∂ffentlichung von Cash Desk MySklad haben wir entschieden, dass es sich bei der Kamera um eine Kamera handelt, der Benutzer verf√ºgt jedoch m√∂glicherweise √ºber einen Hardware-Barcode-Scanner, den er verwenden m√∂chte. </p><br><p>  Wir k√∂nnen mit Scannern in Form eines gew√∂hnlichen HID (Human Interface Device) arbeiten.  Nach dem Lesen des Barcodes erhalten wir eine Folge von Zeichen vom Scanner.  Dies ist vielleicht die einfachste Integration.  Das einfachste, wenn nicht zwei "Aber". </p><br><p>  Erstens √ºbertr√§gt ein Scanner m√∂glicherweise nicht das, was er sollte, wenn er ‚Äûout of the box‚Äú ist.  Zweitens signalisieren uns nicht alle Scannermodelle, dass das Lesen des Barcodes abgeschlossen ist. </p><br><p>  Das erste ‚Äûaber‚Äú wird einfach gel√∂st: Wenn der Scanner nicht √ºbertr√§gt, was er scannen soll, m√ºssen Sie die Anweisungen f√ºr den Scanner finden und mithilfe der Service-Barcodes konfigurieren.  In der Regel sind die Anweisungen auf Papier oder in elektronischer Form vom Hersteller vollst√§ndig.  Nach der Beschreibung der verf√ºgbaren Einstellungen enth√§lt es Barcodes, die in der gew√ºnschten Reihenfolge scannen.  So k√∂nnen Sie den Scanner nach Bedarf konfigurieren. </p><br><p>  Das zweite "aber" ist ein ernsthafteres Problem.  Der Zoo der Scanner ist umfangreich und nicht alle Ger√§te zeigen das Ende einer Lesezeile an.  Es gibt zwei M√∂glichkeiten, um dieses Problem zu l√∂sen.  Die erste besteht darin, dieselben Service-Barcodes zu verwenden, um eine Einstellung festzulegen, die das Zeilenumbruchzeichen nach dem Lesen √ºbertr√§gt.  Wenn Sie mit dem Modell kein Gl√ºck haben und die erste Option nicht passt, k√∂nnen Sie das Scannersuffix festlegen.  F√ºgen Sie mithilfe der Service-Barcodes am Ende der Lesesequenz ein Zeichen hinzu, mit dem Sie das Ende der Eingabe abfangen k√∂nnen. </p><br><h2 id="podklyuchaem-kassu">  Wir verbinden die Kasse </h2><br><p>  Die Anwendung ist also da, der Barcode-Scanner ist angeschlossen, aber wir k√∂nnen den Scheck immer noch nicht drucken.  Daf√ºr brauchen wir die Abendkasse selbst.  In MySklad unterst√ºtzen wir KKT Atol und Shtrikh, auch MSPOS. Ich werde in einem anderen Artikel dar√ºber berichten. </p><br><p>  Bei der Integration mit der Kassiererin begann die Menge an Eisencode unaufhaltsam zu wachsen.  Wir haben uns entschlossen, alle Arbeiten mit den angeschlossenen Ger√§ten in einer separaten Bibliothek abzulegen.  Die Registrierkassenanwendung selbst ist zu einem Kunden geworden, der eine Bibliothek durch gradle zieht. </p><br><p>  Je nach Modell k√∂nnen Sie eine Verbindung √ºber USB, Bluetooth oder Wi-Fi herstellen.  Und auch nach dem UART-Protokoll, das in einem Fall eine starre Kopplung von Registrierkasse und Android-Ger√§t darstellt.  Au√üerdem unterscheiden sich verschiedene Anbieter radikal in der Implementierung der Verbindung des Clients mit der Kasse.  Java-Wrapper √ºber native .so-Bibliotheken, ein Add-On √ºber die Open-Source-jPOS-Bibliothek und sogar den steuerlichen Kern, auf den √ºber einen Dienst mit einer AIDL-Schnittstelle (Android Interface Definition Language) zugegriffen wird. </p><br><p>  Bei den ersten Versuchen, ein Ger√§t eines Herstellers zu integrieren, waren wir mit dem Interaktionsschema f√ºr KKM-Ger√§te zufrieden: </p><br><p><img src="https://habrastorage.org/webt/jz/tz/my/jztzmyluw0ilashos-8utonzj9m.png"></p><br><p>  Angesichts der Anzahl der Treiberimplementierungen, der Verbindungsmethoden und der Einheitlichkeit der Funktionen haben wir uns entschlossen, die Arbeit mit Hardware zu √ºberdenken.  Infolgedessen kam das vorherige Schema zu folgender Form: </p><br><p><img src="https://habrastorage.org/webt/5s/l1/sz/5sl1szcf5jfdhbrvs0r7uebkpek.png"></p><br><p>  <em>T ist ein spezifischer Treiber-Wrapper auf niedriger Ebene</em> </p><br><p>  Der Ger√§te-Manager verbirgt die Implementierung der Verbindung vor dem Client.  Es reicht aus, einen Verbindungsassistenten zu erstellen, bei dem Sie den Hersteller des Kassierers und die Art der Verbindung konsistent ausw√§hlen und die Einstellungen vornehmen m√ºssen.  Bei einer erfolgreichen Verbindung wird ein Objekt an uns zur√ºckgegeben, das die KKMDevice-Schnittstelle implementiert. </p><br><p>  KKMDevice verbirgt die Details der Arbeit mit einem einzelnen Anbietertreiber.  Wrapper jedes Herstellers enthalten einen Link zum T-Treiber und zu Delegaten, die bestimmte Funktionss√§tze implementieren.  Zum Beispiel FiscalDelegate, NonFiscalDelegate, DeviceInfoDelegate. </p><br><p>  Ich werde einige allgemeine Integrationspunkte erw√§hnen: </p><br><ul><li>  Achten Sie darauf, dass Sie auf Treiberaktualisierungen achten.  Neben Fehlerkorrekturen und h√∂herer Geschwindigkeit treten h√§ufig Qualit√§tsspr√ºnge auf.  Glauben Sie mir, der √úbergang von einfachen HEX-Befehlen zu einer Java-√§hnlichen Oberfl√§che und von diesen zu JSON-Aufgaben erleichtert die Arbeit erheblich und macht den Code verst√§ndlicher. </li><li>  Blockieren Sie f√ºr die Dauer der Vorg√§nge die Benutzeroberfl√§che mit einem Fortschrittsbalken.  Auf dem Schild steht, dass die mehrmals hintereinander mit einer verbundenen KPCh gedr√ºckte Schaltfl√§che ‚ÄûBezahlen‚Äú ein Vorbote der Kritik im Task-Tracker ist. </li><li>  Stellen Sie sicher, dass alle Operationen mit CCP streng nacheinander ausgef√ºhrt werden.  Ein ‚Äûerfolgreiches‚Äú Flow-Rennen kann den KKT aufh√§ngen, w√§hrend der sich gleichzeitig drehende Fortschrittsbalken ebenfalls eine Anwendung ist. </li><li>  Wenn Sie die Daten√ºbertragung zum Steuerdatenoperator konfigurieren m√ºssen, empfehlen wir Ihnen, die maximale Anzahl von Parametern aus einer vordefinierten Liste auszuw√§hlen.  Weil die manuelle Eingabe von Daten mit einem milit√§rischen Steuerantrieb eine gro√üartige M√∂glichkeit ist, sich in den Fu√ü zu schie√üen, aber auf der Benutzerseite, wenn Sie die Anwendung verwenden. </li></ul><br><p>  Ein Fiscal Drive ist ein Ger√§t, das Informationen √ºber Handelsvorg√§nge sammelt und verarbeitet.  Es kann mehr kosten als die Abendkasse selbst.  Wenn das Laufwerk nicht richtig konfiguriert ist, ist m√∂glicherweise eine Prozessnullung erforderlich.  √ñffnen Sie dazu die Abendkasse, sofort l√§uft die Garantie ab. </p><br><h2 id="ekvayring">  Erwerben </h2><br><p>  Wir haben also die Kassenschnittstelle, k√∂nnen die Waren per Barcode scannen und den Scheck ausdrucken.  Es bleibt die M√∂glichkeit, mit Karte zu bezahlen. </p><br><p>  Unsere Anwendung integriert die Unterst√ºtzung f√ºr PayMe- und Inpas-Terminals.  Die ersteren sind √ºber Bluetooth verbunden, w√§hrend die letzteren √ºber USB oder √ºber Wi-Fi verbunden werden k√∂nnen. </p><br><p>  Das Verbindungsschema f√ºr Zahlungsterminals ist dem Verbinden einer CCP sehr √§hnlich, sofern keine zus√§tzliche Autorisierung erforderlich ist. </p><br><p>  Es gibt jedoch gravierende Unterschiede - beim Umgang mit dem abnormalen Verhalten des Ger√§ts.  In der KPCh wurde jede Operation entweder erfolgreich bestanden oder nicht.  Wenn der Vorgang fehlgeschlagen ist, k√∂nnen Sie es erneut versuchen oder abbrechen.  Alles andere geschieht ohne Intervention. </p><br><p>  Bei Terminals ist es notwendig, m√∂gliche Unterbrechungen des Zahlungsvorgangs in jedem Schritt zu √ºberwachen.  Eine Bankkarte wird m√∂glicherweise nicht ber√ºcksichtigt, oder die Karte enth√§lt nicht gen√ºgend Guthaben.  Sie k√∂nnen nicht auf eine Antwort von der Bank warten oder warten, sondern erhalten als Antwort einen 5xx HTTP-Code.  Und in jeder Phase kann die Verbindung einfach unterbrochen werden. </p><br><p>  Dar√ºber hinaus k√∂nnen Sie ohne Zertifizierung keine ordnungsgem√§√ü funktionierende Anwendung mit Inpas-Terminalunterst√ºtzung freigeben.  Die Zertifizierung umfasst die √úberpr√ºfung der Verf√ºgbarkeit und des korrekten Betriebs aller Benutzervorg√§nge des Terminals sowie die Verarbeitung von Ereignissen wie der Trennung vom Netzwerk, nachdem der K√§ufer bereits eine Karte an das Terminal angeschlossen hat. </p><br><p>  Beim Testen des Terminals m√ºssen Sie ber√ºcksichtigen, mit welcher Bank oder welchem ‚Äã‚ÄãZahlungssystem es gekoppelt ist.  In einigen F√§llen wird das Geld auch im Entwicklungsmodus nur √ºber das pers√∂nliche Konto des Kontos und nicht automatisch zur√ºckerstattet. </p><br><p>  Sie m√ºssen sich auch daran erinnern, dass die Bank auch am Zahlungsprozess teilnimmt.  Beispielsweise kann das Fehlen eines Belegschecks auftreten, wenn auf dem pers√∂nlichen Konto der Bank keine erforderliche Einstellung vorhanden ist. </p><br><h2 id="zaklyuchenie">  Fazit </h2><br><p>  Das Verbinden verschiedener Ger√§te mit einer Android-Anwendung ist ein komplizierter, aber interessanter Prozess.  Wir haben √ºber ihn als Ganzes gesprochen, alle Hindernisse zu beschreiben, ist nat√ºrlich unrealistisch. </p><br><p>  Wenn Sie Fragen haben, beantworte ich diese gerne in den Kommentaren.  Wenn Fragen in einen separaten Artikel eingegeben werden, schreiben Sie :) </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de462993/">https://habr.com/ru/post/de462993/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de462977/index.html">Beschleunigen Sie routinem√§√üige HR-Prozesse mit RPA und BluePrism</a></li>
<li><a href="../de462979/index.html">Spickzettel f√ºr Auszubildende: Schritt f√ºr Schritt Google Interviewing</a></li>
<li><a href="../de462983/index.html">Voice for Game Dev: Wie wir die Voice Quest "Lovecraft World" entwickelt haben</a></li>
<li><a href="../de462989/index.html">Conversational BERT - Lernen Sie neuronale Netze in der Sprache der sozialen Medien</a></li>
<li><a href="../de462991/index.html">Auf der Web 3.0 Welle reiten</a></li>
<li><a href="../de462997/index.html">Mitap der Society of Anonymous Testers # 7 - Bericht vom Treffen</a></li>
<li><a href="../de463001/index.html">Testen Sie Ihre Infrastruktur als Code mit Pulumi. Teil 1</a></li>
<li><a href="../de463005/index.html">ASMR-Sicherheit</a></li>
<li><a href="../de463009/index.html">Umsatzentwicklung bei Unternehmen N.</a></li>
<li><a href="../de463011/index.html">Alte Akustik nicht wegwerfen Neues Leben der alten Akustik</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>