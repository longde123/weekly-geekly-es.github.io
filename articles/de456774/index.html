<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏘️ 🤵🏼 🐂 Was ich in Java nach der Arbeit mit Kotlin / Scala vermisse 👶🏿 🐟 👩🏾‍🎓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In letzter Zeit höre ich oft, dass Java zu einer veralteten Sprache geworden ist, in der es schwierig ist, große unterstützte Anwendungen zu erstellen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Was ich in Java nach der Arbeit mit Kotlin / Scala vermisse</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/raiffeisenbank/blog/456774/">  In letzter Zeit höre ich oft, dass Java zu einer veralteten Sprache geworden ist, in der es schwierig ist, große unterstützte Anwendungen zu erstellen.  Im Allgemeinen stimme ich diesem Standpunkt nicht zu.  Meiner Meinung nach eignet sich die Sprache immer noch zum Schreiben schneller und gut organisierter Anwendungen.  Ich gebe jedoch zu, dass es auch vorkommt, dass Sie beim täglichen Schreiben von Code manchmal denken: „Wie gut würde es mit dieser Sache aus einer anderen Sprache gelöst werden?“.  In diesem Artikel wollte ich meine Schmerzen und Erfahrungen teilen.  Wir werden uns einige Java-Probleme ansehen und wie sie in Kotlin / Scala gelöst werden können.  Wenn Sie ein ähnliches Gefühl haben oder sich nur fragen, was andere Sprachen bieten können, frage ich Sie unter Katze. <br><br><img src="https://habrastorage.org/webt/gs/ur/yw/gsurywchgpevsavhgdjdaw1_sw4.jpeg"><br><a name="habracut"></a><br><h3>  Bestehende Klassen erweitern </h3><br>  Manchmal ist es erforderlich, eine vorhandene Klasse zu erweitern, ohne ihren internen Inhalt zu ändern.  Das heißt, nachdem wir die Klasse erstellt haben, ergänzen wir sie durch andere Klassen.  Betrachten Sie ein kleines Beispiel.  Angenommen, wir haben eine Klasse, die ein Punkt im zweidimensionalen Raum ist.  An verschiedenen Stellen in unserem Code müssen wir ihn sowohl in Json als auch in XML serialisieren. <br><br><div class="spoiler">  <b class="spoiler_title">Mal sehen, wie es in Java mit dem Besuchermuster aussehen kann</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DotDemo</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Dot</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x = x; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.y = y; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">accept</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Visitor visitor)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> visitor.visit(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getX</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getY</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> y; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Visitor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Dot dot)</span></span></span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JsonVisitor</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Visitor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Dot dot)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> String .format(<span class="hljs-string"><span class="hljs-string">""</span></span> + <span class="hljs-string"><span class="hljs-string">"{"</span></span> + <span class="hljs-string"><span class="hljs-string">"\"x\"=%d, "</span></span> + <span class="hljs-string"><span class="hljs-string">"\"y\"=%d "</span></span> + <span class="hljs-string"><span class="hljs-string">"}"</span></span>, dot.getX(), dot.getY()); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XMLVisitor</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Visitor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Dot dot)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;dot&gt;"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;x&gt;"</span></span> + dot.getX() + <span class="hljs-string"><span class="hljs-string">"&lt;/x&gt;"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;y&gt;"</span></span> + dot.getY() + <span class="hljs-string"><span class="hljs-string">"&lt;/y&gt;"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"&lt;/dot&gt;"</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ Dot dot = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dot(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); System.out.println(<span class="hljs-string"><span class="hljs-string">"-------- JSON -----------"</span></span>); System.out.println(dot.accept(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JsonVisitor())); System.out.println(<span class="hljs-string"><span class="hljs-string">"-------- XML ------------"</span></span>); System.out.println(dot.accept(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLVisitor())); } }</code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mehr über das Muster und seine Verwendung</a> <br></div></div><br>  Es sieht ziemlich voluminös aus, oder?  Ist es möglich, dieses Problem mit Hilfe von Sprachwerkzeugen eleganter zu lösen?  Scala und Kotlin nicken positiv.  Dies wird unter Verwendung des Methodenerweiterungsmechanismus erreicht.  Mal sehen, wie es aussieht. <br><br><div class="spoiler">  <b class="spoiler_title">Erweiterungen in Kotlin</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Dot</span></span></span><span class="hljs-class"> </span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> x: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> y: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>) <span class="hljs-comment"><span class="hljs-comment">//      fun Dot.convertToJson(): String = "{\"x\"=$x, \"y\"=$y}" fun Dot.convertToXml(): String = """&lt;dot&gt; &lt;x&gt;$x&lt;/x&gt; &lt;y&gt;$y&lt;/y&gt; &lt;/dot&gt;""" fun main() { val dot = Dot(1, 2) println("-------- JSON -----------") println(dot.convertToJson()) println("-------- XML -----------") println(dot.convertToXml()) }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Erweiterungen in Scala</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DotDemo</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// val is default case class Dot(x: Int, y: Int) implicit class DotConverters(dot: Dot) { def convertToJson(): String = s"""{"x"=${dot.x}, "y"=${dot.y}}""" def convertToXml(): String = s"""&lt;dot&gt; &lt;x&gt;${dot.x}&lt;/x&gt; &lt;y&gt;${dot.y}&lt;/y&gt; &lt;/dot&gt;""" } val dot = Dot(1, 2) println("-------- JSON -----------") println(dot.convertToJson()) println("-------- XML -----------") println(dot.convertToXml()) }</span></span></code> </pre><br></div></div><br>  Es sieht viel besser aus.  Manchmal reicht dies bei zahlreichen Mappings und anderen Transformationen nicht aus. <br><br><h3>  Multithread-Computerkette </h3><br>  Jetzt sprechen alle über asynchrones Rechnen und die Verbote des Sperrens von Ausführungsthreads.  Stellen wir uns das folgende Problem vor: Wir haben mehrere Zahlenquellen, wobei die erste nur die Zahl und die zweite die Antwort nach der Berechnung der ersten zurückgibt.  Daher müssen wir eine Zeichenfolge mit zwei Zahlen zurückgeben. <br><br><div class="spoiler">  <b class="spoiler_title">Schematisch kann dies wie folgt dargestellt werden</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/sl/en/2s/slen2s9wvmnlguh2sh1nh8435au.png"><br></div></div><br>  Versuchen wir zunächst, das Problem in Java zu lösen <br><br><div class="spoiler">  <b class="spoiler_title">Java-Beispiel</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> CompletableFuture&lt;Optional&lt;String&gt;&gt; calcResultOfTwoServices ( Supplier&lt;Optional&lt;Integer&gt;&gt; getResultFromFirstService, Function&lt;Integer, Optional&lt;Integer&gt;&gt; getResultFromSecondService ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CompletableFuture .supplyAsync(getResultFromFirstService) .thenApplyAsync(firstResultOptional -&gt; firstResultOptional.flatMap(first -&gt; getResultFromSecondService.apply(first).map(second -&gt; first + <span class="hljs-string"><span class="hljs-string">" "</span></span> + second ) ) ); }</code> </pre> <br></div></div><br>  In diesem Beispiel wird unsere Nummer in Optional eingeschlossen, um das Ergebnis zu steuern.  Darüber hinaus werden alle Aktionen in CompletableFuture ausgeführt, um das Arbeiten mit Threads zu vereinfachen.  Die Hauptaktion findet in der thenApplyAsync-Methode statt.  Bei dieser Methode erhalten wir Optional als Argument.  Als nächstes wird flatMap aufgerufen, um den Kontext zu steuern.  Wenn das empfangene Optional als Optional.empty zurückgegeben wird, werden wir nicht zum zweiten Service wechseln. <br><br>  Die Summe, die wir erhalten haben?  Mit den Funktionen CompletableFuture und Optional mit flatMap und map konnten wir das Problem lösen.  Obwohl die Lösung meiner Meinung nach nicht besonders elegant aussieht: Bevor Sie verstehen, worum es geht, müssen Sie den Code lesen.  Und was würde mit zwei oder mehr Datenquellen passieren? <br><br>  Könnte uns die Sprache irgendwie helfen, das Problem zu lösen?  Und wieder wenden Sie sich an Scala.  Hier erfahren Sie, wie Sie es mit Scala-Tools lösen können. <br><br><div class="spoiler">  <b class="spoiler_title">Scala Beispiel</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calcResultOfTwoServices</span></span></span></span>(getResultFromFirstService: <span class="hljs-type"><span class="hljs-type">Unit</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>], getResultFromSecondService: <span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>]) = <span class="hljs-type"><span class="hljs-type">Future</span></span> { getResultFromFirstService() }.flatMap { firsResultOption =&gt; <span class="hljs-type"><span class="hljs-type">Future</span></span> { firsResultOption.flatMap(first =&gt; getResultFromSecondService(first).map(second =&gt; <span class="hljs-string"><span class="hljs-string">s"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$first</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$second</span></span></span><span class="hljs-string">"</span></span> ) )} }</code> </pre> <br></div></div><br>  Es kommt mir bekannt vor.  Und das ist kein Zufall.  Es verwendet die Bibliothek scala.concurrent, bei der es sich hauptsächlich um einen Wrapper über java.concurrent handelt.  Womit kann uns Scala noch helfen?  Tatsache ist, dass Ketten der Form flatMap, ..., map als Sequenz in for dargestellt werden können. <br><br><div class="spoiler">  <b class="spoiler_title">Beispiel für die zweite Version von Scala</b> <div class="spoiler_text"><pre> <code class="scala hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calcResultOfTwoServices</span></span></span></span>(getResultFromFirstService: <span class="hljs-type"><span class="hljs-type">Unit</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>], getResultFromSecondService: <span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>]) = <span class="hljs-type"><span class="hljs-type">Future</span></span> { getResultFromFirstService() }.flatMap { firstResultOption =&gt; <span class="hljs-type"><span class="hljs-type">Future</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { first &lt;- firstResultOption second &lt;- getResultFromSecondService(first) } <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-string"><span class="hljs-string">s"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$first</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$second</span></span></span><span class="hljs-string">"</span></span> } }</code> </pre> <br></div></div><br>  Es ist besser geworden, aber versuchen wir noch einmal, unseren Code zu ändern.  Verbinden Sie die Katzenbibliothek. <br><br><div class="spoiler">  <b class="spoiler_title">Dritte Version des Scala-Beispiels</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cats.instances.future._ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calcResultOfTwoServices</span></span></span></span>(getResultFromFirstService: <span class="hljs-type"><span class="hljs-type">Unit</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>], getResultFromSecondService: <span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>]): <span class="hljs-type"><span class="hljs-type">Future</span></span>[<span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>]] = (<span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { first &lt;- <span class="hljs-type"><span class="hljs-type">OptionT</span></span>(<span class="hljs-type"><span class="hljs-type">Future</span></span> { getResultFromFirstService() }) second &lt;- <span class="hljs-type"><span class="hljs-type">OptionT</span></span>(<span class="hljs-type"><span class="hljs-type">Future</span></span> { getResultFromSecondService(first) }) } <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-string"><span class="hljs-string">s"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$first</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$second</span></span></span><span class="hljs-string">"</span></span>).value</code> </pre> <br></div></div><br>  Jetzt ist es nicht so wichtig, was OptionT bedeutet.  Ich möchte nur zeigen, wie einfach und kurz diese Operation sein kann. <br><br>  Aber was ist mit Kotlin?  Versuchen wir, etwas Ähnliches an Coroutinen zu tun. <br><br><div class="spoiler">  <b class="spoiler_title">Kotlin Beispiel</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> result = async { withContext(Dispatchers.Default) { getResultFromFirstService() }?.let { first -&gt; withContext(Dispatchers.Default) { getResultFromSecondService(first) }?.let { second -&gt; <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$first</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$second</span></span></span><span class="hljs-string">"</span></span> } } }</code> </pre> <br></div></div><br>  Dieser Code hat seine eigenen Besonderheiten.  Erstens verwendet es den Kotlin-Mechanismus von Corutin.  Aufgaben innerhalb von Async werden in einem speziellen Thread-Pool (nicht ForkJoin) mit einem Arbeitsdiebstahlmechanismus ausgeführt.  Zweitens erfordert dieser Code einen speziellen Kontext, aus dem Schlüsselwörter wie async und withContext übernommen werden. <br><br>  Wenn Ihnen Scala Future gefallen hat, Sie aber auf Kotlin schreiben, können Sie auf ähnliche Scala-Wrapper achten.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Geben Sie so ein.</a> <br><br><h4>  Arbeite mit Streams </h4><br>  Um das Problem oben genauer darzustellen, versuchen wir, das vorherige Beispiel zu erweitern: Wir wenden uns den beliebtesten Java-Programmiertools zu - <i>Reactor</i> auf Scala - <i>fs2</i> . <br><br>  Betrachten Sie das zeilenweise Lesen von 3 Dateien in einem Stream und versuchen Sie, dort Übereinstimmungen zu finden. <br>  Hier ist der einfachste Weg, dies mit Reactor in Java zu tun. <br><br><div class="spoiler">  <b class="spoiler_title">Reaktorbeispiel in Java</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Flux&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">glueFiles</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String filename1, String filename2, String filename3)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getLinesOfFile(filename1).flatMap(lineFromFirstFile -&gt; getLinesOfFile(filename2) .filter(line -&gt; line.equals(lineFromFirstFile)) .flatMap(lineFromSecondFile -&gt; getLinesOfFile(filename3) .filter(line -&gt; line.equals(lineFromSecondFile)) .map(lineFromThirdFile -&gt; lineFromThirdFile ) ) ); }</code> </pre> <br></div></div><br>  Nicht der optimalste Weg, aber bezeichnend.  Es ist nicht schwer zu erraten, dass mit mehr Logik und Zugriff auf Ressourcen von Drittanbietern die Komplexität des Codes zunehmen wird.  Sehen wir uns die Alternative zum Verständnis der Syntaxzucker an. <br><br><div class="spoiler">  <b class="spoiler_title">Beispiel aus fs2 auf Scala</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-function">def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findUniqueLines</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(filename1: String, filename2: String, filename3: String)</span></span></span><span class="hljs-function">: Stream[IO, String] </span></span>= <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { lineFromFirstFile &lt;- readFile(filename1) lineFromSecondFile &lt;- readFile(filename2).filter(_.equals(lineFromFirstFile)) result &lt;- readFile(filename3).filter(_.equals(lineFromSecondFile)) } yield result</code> </pre> <br></div></div><br>  Es scheint, dass es nicht viele Änderungen gibt, aber es sieht viel besser aus. <br><br><h4>  Trennen der Geschäftslogik mit HigherKind und implizit </h4><br>  Lassen Sie uns sehen, wie wir unseren Code noch verbessern können.  Ich möchte warnen, dass der nächste Teil möglicherweise nicht sofort verständlich ist.  Ich möchte die Möglichkeiten aufzeigen und die Implementierungsmethode vorerst aus den Klammern herauslassen.  Eine ausführliche Erklärung erfordert mindestens einen separaten Artikel.  Wenn es einen Wunsch / Kommentare gibt - ich werde in den Kommentaren folgen, um Fragen zu beantworten und den zweiten Teil mit einer detaillierteren Beschreibung zu schreiben :) <br><br>  Stellen Sie sich also eine Welt vor, in der wir die Geschäftslogik unabhängig von den technischen Auswirkungen festlegen können, die während der Entwicklung auftreten können.  Beispielsweise können wir jede nachfolgende Anforderung an ein DBMS oder einen Drittanbieter-Service in einem separaten Thread ausführen.  In Unit-Tests müssen wir einen dummen Mok machen, in dem nichts passiert.  Usw. <br><br>  Vielleicht haben einige Leute über die BPM-Engine nachgedacht, aber heute geht es nicht mehr um ihn.  Es stellt sich heraus, dass dieses Problem mit Hilfe einiger Muster der funktionalen Programmierung und Sprachunterstützung gelöst werden kann.  An einer Stelle können wir die Logik so beschreiben. <br><br><div class="spoiler">  <b class="spoiler_title">An einer Stelle können wir die Logik so beschreiben</b> <div class="spoiler_text"><pre> <code class="scala hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeCatHappy</span></span></span></span>[<span class="hljs-type"><span class="hljs-type">F</span></span>[_]: <span class="hljs-type"><span class="hljs-type">Monad</span></span>: <span class="hljs-type"><span class="hljs-type">CatClinicClient</span></span>](): <span class="hljs-type"><span class="hljs-type">F</span></span>[<span class="hljs-type"><span class="hljs-type">Unit</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { catId &lt;- <span class="hljs-type"><span class="hljs-type">CatClinicClient</span></span>[<span class="hljs-type"><span class="hljs-type">F</span></span>].getHungryCat memberId &lt;- <span class="hljs-type"><span class="hljs-type">CatClinicClient</span></span>[<span class="hljs-type"><span class="hljs-type">F</span></span>].getFreeMember _ &lt;- <span class="hljs-type"><span class="hljs-type">CatClinicClient</span></span>[<span class="hljs-type"><span class="hljs-type">F</span></span>].feedCatByFreeMember(catId, memberId) } <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> ()</code> </pre> <br></div></div><br>  Hier bedeutet F [_] (gelesen als "ef mit einem Loch") einen Typ über einem Typ (manchmal wird es in der russischen Literatur eine Art genannt).  Dies kann List, Set, Option, Future usw. sein.  Das alles ist ein Container eines anderen Typs. <br><br>  Als nächstes ändern wir einfach den Kontext der Codeausführung.  Zum Beispiel können wir für die Produktumgebung so etwas tun. <br><br><div class="spoiler">  <b class="spoiler_title">Wie könnte der Kampfcode aussehen?</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RealCatClinicClient</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatClinicClient</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Future</span></span></span><span class="hljs-class">] </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHungryCat</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Future</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>] = <span class="hljs-type"><span class="hljs-type">Future</span></span> { <span class="hljs-type"><span class="hljs-type">Thread</span></span>.sleep(<span class="hljs-number"><span class="hljs-number">1000</span></span>) <span class="hljs-comment"><span class="hljs-comment">// doing some calls to db (waiting 1 second) 40 } override def getFreeMember: Future[Int] = Future { Thread.sleep(1000) // doing some calls to db (waiting 1 second) 2 } override def feedCatByFreeMember(catId: Int, memberId: Int): Future[Unit] = Future { Thread.sleep(1000) // happy cat (waiting 1 second) println("so testy!") // Don't do like that. It is just for debug } }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Wie der Testcode aussehen könnte</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MockCatClinicClient</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatClinicClient</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Id</span></span></span><span class="hljs-class">] </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHungryCat</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Id</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>] = <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFreeMember</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Id</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>] = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">feedCatByFreeMember</span></span></span></span>(catId: <span class="hljs-type"><span class="hljs-type">Int</span></span>, memberId: <span class="hljs-type"><span class="hljs-type">Int</span></span>): <span class="hljs-type"><span class="hljs-type">Id</span></span>[<span class="hljs-type"><span class="hljs-type">Unit</span></span>] = { println(<span class="hljs-string"><span class="hljs-string">"so testy!"</span></span>) <span class="hljs-comment"><span class="hljs-comment">// Don't do like that. It is just for debug } }</span></span></code> </pre> <br></div></div><br>  Unsere Geschäftslogik hängt jetzt nicht mehr davon ab, welche Frameworks, http-Clients und Server wir verwendet haben.  Wir können den Kontext jederzeit ändern, und das Tool wird sich ändern. <br><br>  Dies wird durch Funktionen wie highKind und implicit erreicht.  Betrachten wir das erste, und dafür kehren wir zu Java zurück. <br><br><div class="spoiler">  <b class="spoiler_title">Schauen wir uns den Code an</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Calcer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> CompletableFuture&lt;Integer&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCalc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre><br></div></div><br>  Wie viele Möglichkeiten, das Ergebnis zurückzugeben?  Sehr viel.  Wir können subtrahieren, addieren, tauschen und vieles mehr.  Stellen Sie sich nun vor, wir hätten klare Anforderungen erhalten.  Wir müssen die erste Zahl zur zweiten hinzufügen.  Wie viele Möglichkeiten können wir dies tun?  <s>Wenn Sie sich anstrengen und viel verfeinern ...</s> im Allgemeinen nur eine. <br><br><div class="spoiler">  <b class="spoiler_title">Da ist er</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Calcer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> CompletableFuture&lt;Integer&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCalc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CompletableFuture.supplyAsync(() -&gt; x + y); } }</code> </pre> <br></div></div><br>  Was aber, wenn der Aufruf dieser Methode ausgeblendet ist und wir in einer Single-Thread-Umgebung testen möchten?  Oder was ist, wenn wir die Implementierung der Klasse ändern möchten, indem wir CompletableFuture entfernen / ersetzen.  Leider sind wir in Java machtlos und müssen die Methoden-API ändern.  Schauen Sie sich die Alternative in Scala an. <br><br><div class="spoiler">  <b class="spoiler_title">Betrachten Sie die Eigenschaft</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Calcer</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">F</span></span></span><span class="hljs-class">[_]] </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCulc</span></span></span></span>(x: <span class="hljs-type"><span class="hljs-type">Int</span></span>, y: <span class="hljs-type"><span class="hljs-type">Int</span></span>): <span class="hljs-type"><span class="hljs-type">F</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>] }</code> </pre><br></div></div><br>  Wir erstellen Merkmale (das nächste Analogon ist die Schnittstelle in Java), ohne den Containertyp unseres ganzzahligen Werts anzugeben. <br><br>  Außerdem können wir bei Bedarf einfach verschiedene Implementierungen erstellen. <br><br><div class="spoiler">  <b class="spoiler_title">Wie so</b> <div class="spoiler_text"><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> futureCalcer: <span class="hljs-type"><span class="hljs-type">Calcer</span></span>[<span class="hljs-type"><span class="hljs-type">Future</span></span>] = (x, y) =&gt; <span class="hljs-type"><span class="hljs-type">Future</span></span> {x + y} <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> optionCalcer: <span class="hljs-type"><span class="hljs-type">Calcer</span></span>[<span class="hljs-type"><span class="hljs-type">Option</span></span>] = (x, y) =&gt; <span class="hljs-type"><span class="hljs-type">Option</span></span>(x + y)</code> </pre><br></div></div><br>  Darüber hinaus gibt es so etwas Interessantes wie Implizit.  Sie können den Kontext unserer Umgebung erstellen und implizit die Implementierung des darauf basierenden Merkmals auswählen. <br><br><div class="spoiler">  <b class="spoiler_title">Wie so</b> <div class="spoiler_text"><pre> <code class="scala hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">userCalcer</span></span></span></span>[<span class="hljs-type"><span class="hljs-type">F</span></span>[_]](<span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> calcer: <span class="hljs-type"><span class="hljs-type">Calcer</span></span>[<span class="hljs-type"><span class="hljs-type">F</span></span>]): <span class="hljs-type"><span class="hljs-type">F</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>] = calcer.getCulc(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doItInFutureContext</span></span></span></span>(): <span class="hljs-type"><span class="hljs-type">Unit</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> futureCalcer: <span class="hljs-type"><span class="hljs-type">Calcer</span></span>[<span class="hljs-type"><span class="hljs-type">Future</span></span>] = (x, y) =&gt; <span class="hljs-type"><span class="hljs-type">Future</span></span> {x + y} println(userCalcer) } doItInFutureContext() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doItInOptionContext</span></span></span></span>(): <span class="hljs-type"><span class="hljs-type">Unit</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> optionCalcer: <span class="hljs-type"><span class="hljs-type">Calcer</span></span>[<span class="hljs-type"><span class="hljs-type">Option</span></span>] = (x, y) =&gt; <span class="hljs-type"><span class="hljs-type">Option</span></span>(x + y) println(userCalcer) } doItInOptionContext()</code> </pre> <br></div></div><br>  Vereinfachtes implizites Vor-Val - Hinzufügen einer Variablen zur aktuellen Umgebung und implizites Argument für eine Funktion bedeutet, dass die Variable aus der Umgebung entfernt wird.  Dies erinnert etwas an eine implizite Schließung. <br><br>  Insgesamt stellt sich heraus, dass wir eine Kampf- und Testumgebung ziemlich präzise erstellen können, ohne Bibliotheken von Drittanbietern zu verwenden. <br><div class="spoiler">  <b class="spoiler_title">Aber was ist mit Kotlin?</b> <div class="spoiler_text">  In ähnlicher Weise können wir dies in Kotlin tun: <br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Calculator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eval</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, y: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: T } <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> FutureCalculator : Calculator&lt;CompletableFuture&lt;<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>&gt;&gt; { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eval</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, y: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = CompletableFuture.supplyAsync { x + y } } <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> OptionalCalculator : Calculator&lt;Optional&lt;<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>&gt;&gt; { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eval</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, y: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Optional.of(x + y) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T&gt;</span></span></span><span class="hljs-function"> Calculator</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T&gt;</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useCalculator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(y: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = eval(<span class="hljs-number"><span class="hljs-number">1</span></span>, y) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { with (FutureCalculator) { println(useCalculator(<span class="hljs-number"><span class="hljs-number">2</span></span>)) } with (OptionalCalculator) { println(useCalculator(<span class="hljs-number"><span class="hljs-number">2</span></span>)) } }</code> </pre> <br>  Hier legen wir auch den Ausführungskontext unseres Codes fest, aber im Gegensatz zu Scala kennzeichnen wir dies explizit. <br>  Vielen Dank an <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Beholder</a> für das Beispiel. <br></div></div><br><br><h4>  Fazit </h4><br>  Im Allgemeinen sind dies nicht alle meine Schmerzen.  Es gibt noch mehr.  Ich denke, dass jeder Entwickler seinen eigenen hat.  Für mich selbst wurde mir klar, dass es vor allem darum geht, zu verstehen, was für den Nutzen des Projekts wirklich notwendig ist.  Wenn wir beispielsweise einen Rest-Service haben, der als eine Art Adapter mit einer Reihe von Zuordnungen und einfacher Logik fungiert, sind meiner Meinung nach alle oben genannten Funktionen nicht sehr nützlich.  Spring Boot + Java / Kotlin ist perfekt für solche Aufgaben.  Es gibt andere Fälle mit einer großen Anzahl von Integrationen und Aggregationen einiger Informationen.  Für solche Aufgaben sieht meiner Meinung nach die letzte Option sehr gut aus.  Im Allgemeinen ist es cool, wenn Sie ein Werkzeug basierend auf einer Aufgabe auswählen können. <br><br>  Nützliche Ressourcen: <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link zu allen obigen Beispielen</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mehr zu Corotin in Kotlin</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ein gutes Einführungsbuch zur funktionalen Programmierung in Scala</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de456774/">https://habr.com/ru/post/de456774/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de456760/index.html">Crowdsourcing im ML Boot Camp. Wir betrachten mIOU ohne Bilder für eine neue Aufgabe von Odnoklassniki</a></li>
<li><a href="../de456762/index.html">Von Witcher 3 zu Cyberpunk: Die Entwicklung des CD Projekt Quest Designs</a></li>
<li><a href="../de456768/index.html">4 Schwierigkeiten bei der Lokalisierung von Handyspielen am Beispiel von Fishing Clash - Übersetzung</a></li>
<li><a href="../de456770/index.html">Wettrüsten</a></li>
<li><a href="../de456772/index.html">M & A für Projektteams: Wie können Projektdaten und -prozesse effektiv verwaltet werden?</a></li>
<li><a href="../de456780/index.html">9 Möglichkeiten, die Effizienz des Entwicklers mobiler Apps zu steigern</a></li>
<li><a href="../de456782/index.html">Modellorientiertes Design - wie man Tschernobyl nicht wiederholt</a></li>
<li><a href="../de456790/index.html">PostgreSQL News Digest. Ausgabe Nr. 16</a></li>
<li><a href="../de456792/index.html">Stellen Sie Kubernetes Cluster mit Kubespray auf OpenStack bereit</a></li>
<li><a href="../de456794/index.html">Web-UI-Architektur: Eine hölzerne Vergangenheit, eine seltsame Gegenwart und eine glänzende Zukunft</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>