<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöã üçø üéí BlessRNG o RNG verifique la honestidad üìü üë®üèæ‚Äçüè´ üï∫üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En gamedev, a menudo necesitas vincular algo en una casa aleatoria: Unity tiene su propio Random para esto, y System.Random existe en paralelo con √©l....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>BlessRNG o RNG verifique la honestidad</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/playgendary/blog/473880/"><img src="https://habrastorage.org/webt/l7/la/vl/l7lavlbtdajd-exhq5l43oeur6i.png"><br><br>  En gamedev, a menudo necesitas vincular algo en una casa aleatoria: Unity tiene su propio Random para esto, y System.Random existe en paralelo con √©l.  Hab√≠a una vez en uno de los proyectos que parec√≠a que ambos podr√≠an funcionar de manera diferente (aunque deber√≠an tener una distribuci√≥n uniforme). <br><br>  Luego no entraron en detalles: fue suficiente que la transici√≥n a System.Random solucion√≥ todos los problemas.  Ahora decidimos comprender con m√°s detalle y realizar un poco de investigaci√≥n: qu√© tan "sesgados" o predecibles son los RNG, y cu√°l elegir.  Adem√°s, a menudo he escuchado opiniones contradictorias sobre su "honestidad". Tratemos de descubrir c√≥mo se relacionan los resultados reales con los declarados. <br><a name="habracut"></a><br><h2>  Un breve programa educativo o RNG es en realidad un PRNG </h2><br>  <i>Si ya est√° familiarizado con los generadores de n√∫meros aleatorios, puede pasar inmediatamente a la secci√≥n "Pruebas".</i> <br><br>  Los n√∫meros aleatorios (MF) son una secuencia de n√∫meros generados mediante alg√∫n proceso aleatorio (ca√≥tico), una fuente de entrop√≠a.  Es decir, esta es una secuencia de este tipo, cuyos elementos no est√°n conectados por ninguna ley matem√°tica, no tienen una relaci√≥n causal. <br><br>  Lo que crea un rango medio se llama generador de n√∫meros aleatorios (RNG).  Parece que todo es elemental, pero si pasamos de la teor√≠a a la pr√°ctica, implementar un algoritmo de software para generar tal secuencia no es tan simple. <br><br>  La raz√≥n radica en la ausencia de aleatoriedad en la electr√≥nica de consumo moderna.  Sin √©l, los n√∫meros aleatorios dejan de ser aleatorios, y su generador se convierte en una funci√≥n ordinaria de argumentos determinados deliberadamente.  Para una serie de especialidades en el campo de TI, este es un problema grave (por ejemplo, para la criptograf√≠a), para el resto hay una soluci√≥n perfectamente aceptable. <br><br>  Necesitamos escribir un algoritmo que regrese, incluso si no son n√∫meros verdaderamente aleatorios, pero lo m√°s cerca posible de ellos: los llamados n√∫meros pseudoaleatorios (PSN).  El algoritmo en este caso se llama generador de n√∫meros pseudoaleatorios (PRNG). <br><br>  Existen varias opciones para crear un PRNG, pero para todo lo siguiente ser√° relevante: <br><br><ol><li>  La necesidad de preinicializaci√≥n. <br><br>  El PRNG carece de una fuente de entrop√≠a, por lo tanto, antes de usarlo, es necesario indicar el estado inicial.  Se especifica como un n√∫mero (o vector) y se llama semilla (semilla, semilla aleatoria).  A menudo, un contador de reloj del procesador o el equivalente num√©rico del tiempo del sistema se utiliza como semilla. </li><li> Reproducibilidad de la secuencia. <br><br>  El PRNG es completamente determinista, por lo que la semilla especificada durante la inicializaci√≥n determina de forma √∫nica la secuencia futura completa de n√∫meros.  Esto significa que un solo PRSP, inicializado con la misma semilla (en diferentes momentos, en diferentes programas, en diferentes dispositivos) generar√° la misma secuencia. </li></ol><br>  Tambi√©n necesita saber la distribuci√≥n de probabilidad que caracteriza al PRNG: qu√© n√∫meros generar√° y con qu√© probabilidad.  Muy a menudo, esta es una distribuci√≥n normal o una distribuci√≥n uniforme. <br><img src="https://habrastorage.org/webt/f7/2x/j9/f72xj9mz2s52w-ahiwp5uiuqzs0.png"><br>  <i>Distribuci√≥n normal (izquierda) y distribuci√≥n uniforme (derecha)</i> <br><br>  Digamos que tenemos un dado honesto con 24 caras.  Si lo suelta, la probabilidad de que una unidad se caiga ser√° 1/24 (as√≠ como la probabilidad de que se caiga cualquier otro n√∫mero).  Si realiza muchos lanzamientos y registra los resultados, notar√° que todas las caras se caen aproximadamente a la misma frecuencia.  De hecho, este dado puede considerarse un RNG con una distribuci√≥n uniforme. <br><br>  ¬øY si inmediatamente arrojas 10 de esos huesos y cuentas la cantidad total de puntos?  ¬øSe mantendr√° la uniformidad para ella?  No  Muy a menudo, la cantidad estar√° cerca de 125 puntos, es decir, a alg√∫n valor promedio.  Y como resultado, incluso antes de hacer un lanzamiento, puede estimar aproximadamente el resultado futuro. <br><br>  La raz√≥n es que para obtener la cantidad promedio de puntos hay la mayor cantidad de combinaciones.  Cuanto m√°s lejos, menos combinaciones, y, en consecuencia, menos posibilidades de p√©rdida.  Si visualiza estos datos, se parecer√° remotamente a la forma de una campana.  Por lo tanto, con algo de estiramiento, un sistema de 10 huesos puede llamarse RNG con una distribuci√≥n normal. <br><br>  Otro ejemplo, solo ya en el avi√≥n: tiro al blanco.  El tirador ser√° el RNG que genera un par de n√∫meros (x, y), que se muestran en el gr√°fico. <br><img src="https://habrastorage.org/webt/hs/o8/t3/hso8t3u11xkoyrp2slwjo4jvpic.png"><br>  Acuerde que la opci√≥n de la izquierda est√° m√°s cerca de la vida real: este es un RNG con una distribuci√≥n normal.  Pero si necesita dispersar estrellas en un cielo oscuro, entonces la opci√≥n correcta, obtenida con la ayuda de un RNG con una distribuci√≥n uniforme, es mejor.  En general, elija un generador seg√∫n la tarea. <br><br>  Ahora hablemos de la entrop√≠a de la secuencia de PSP.  Por ejemplo, hay una secuencia que comienza as√≠: <br><br>  89, 93, 33, 32, 82, 21, 4, 42, 11, 8, 60, 95, 53, 30, 42, 19, 34, 35, 62, 23, 44, 38, 74, 36, 52, 18, 58, 79, 65, 45, 99, 90, 82, 20, 41, 13, 88, 76, 82, 24, 5, 54, 72, 19, 80, 2, 74, 36, 71, 9, ... <br><br>  ¬øQu√© tan aleatorios son estos n√∫meros a primera vista?  Comencemos por verificar la distribuci√≥n. <br><img src="https://habrastorage.org/webt/pg/6h/nw/pg6hnwtyc2v9e8xx2-zurotlnsq.png"><br>  Parece casi uniforme, pero si lees la secuencia de dos n√∫meros y los interpretas como coordenadas en el avi√≥n, obtienes esto: <br><img src="https://habrastorage.org/webt/vd/3_/y2/vd3_y2eijwkjq47tbjsut-els-y.png"><br>  Los patrones son claramente visibles.  Y dado que los datos en la secuencia est√°n ordenados de cierta manera (es decir, tienen una baja entrop√≠a), esto puede conducir al mismo "sesgo".  Como m√≠nimo, tal PRNG no es muy adecuado para generar coordenadas en un plano. <br><br>  Otra secuencia: <br><br>  42, 72, 17, 0, 30, 0, 15, 9, 47, 19, 35, 86, 40, 54, 97, 42, 69, 19, 20, 88, 4, 3, 67, 27, 42, 56, 17, 14, 20, 40, 80, 97, 1, 31, 69, 13, 88, 89, 76, 9, 4, 85, 17, 88, 70, 10, 42, 98, 96, 53, ... <br><br>  Todo parece estar bien aqu√≠, incluso en el avi√≥n: <br><img src="https://habrastorage.org/webt/ou/kh/ec/oukhecshx_b1qwjmt73micdukry.png"><br>  Veamos en volumen (leemos tres n√∫meros cada uno): <br><img src="https://habrastorage.org/webt/ly/sy/08/lysy08ezn_tfyljmvlgjygp_xks.gif"><br>  Y de nuevo los patrones.  La visualizaci√≥n de compilaci√≥n en cuatro dimensiones no funcionar√°.  Pero los patrones pueden existir tanto en esta dimensi√≥n como en las grandes. <br><br>  En la misma criptograf√≠a, donde los requisitos m√°s estrictos se imponen al PRNG, tal situaci√≥n es categ√≥ricamente inaceptable.  Por lo tanto, para evaluar su calidad, se han desarrollado algoritmos especiales, que no tocaremos ahora.  El tema es extenso y se basa en un art√≠culo separado. <br><br><h2>  Prueba </h2><br>  Si no sabemos algo con certeza, ¬øc√≥mo trabajar con eso?  ¬øVale la pena cruzar la calle si no sabe qu√© se√±al de tr√°fico permite?  Las consecuencias pueden ser diferentes. <br><br>  Lo mismo ocurre con la notoria aleatoriedad en Unity.  Bueno, si la documentaci√≥n revela los detalles necesarios, pero la historia mencionada al principio del art√≠culo sucedi√≥ solo por la falta de detalles deseados. <br><br>  Y sin saber c√≥mo funciona la herramienta, no puede aplicarla correctamente.  En general, ha llegado el momento de verificar y llevar a cabo un experimento para finalmente asegurarse al menos a expensas de la distribuci√≥n. <br><br>  La soluci√≥n fue simple y efectiva: recopilar estad√≠sticas, obtener datos objetivos y observar los resultados. <br><br><h3>  Sujeto de investigaci√≥n </h3><br>  Hay varias formas de generar n√∫meros aleatorios en Unity: probamos cinco. <br><br><ol><li>  System.Random.Next ().  Genera enteros en un rango de valores dado. </li><li>  System.Random.NextDouble ().  Genera n√∫meros de doble precisi√≥n (doble) en el rango de [0;  1) </li><li>  UnityEngine.Random.Range ().  Genera n√∫meros de precisi√≥n √∫nicos (flotantes) en un rango de valores dado. </li><li>  UnityEngine.Random.value.  Genera n√∫meros de precisi√≥n √∫nicos (flotante) en el rango de [0;  1) </li><li>  Unity.Mathematics.Random.NextFloat ().  Parte de la nueva biblioteca de Unity.Mathematics.  Genera n√∫meros de precisi√≥n √∫nicos (flotantes) en un rango de valores dado. </li></ol><br>  Casi en todas partes de la documentaci√≥n, se indic√≥ una distribuci√≥n uniforme, con la excepci√≥n de UnityEngine.Random.value (donde la distribuci√≥n no se especifica, pero de manera similar a UnityEngine.Random.Range () tambi√©n se esperaba que fuera uniforme) y Unity.Mathematics.Random.NextFloat () (donde en la base es el algoritmo xorshift, lo que significa que nuevamente debe esperar una distribuci√≥n uniforme). <br><br>  Por defecto, los esperados en la documentaci√≥n fueron tomados para los resultados esperados. <br><br><h3>  Metodolog√≠a </h3><br>  Escribimos una peque√±a aplicaci√≥n que generaba secuencias de n√∫meros aleatorios en cada uno de los m√©todos presentados y guardaba los resultados para su posterior procesamiento. <br><br>  La longitud de cada secuencia es de 100,000 n√∫meros. <br>  El rango de n√∫meros aleatorios es [0, 100). <br><br>  Los datos se recopilaron de varias plataformas de destino: <br><br><ul><li>  Ventanas <br>  - Unity v2018.3.14f1, modo Editor, Mono, .NET Standard 2.0 </li><li>  macOS <br>  - Unity v2018.3.14f1, modo Editor, Mono, .NET Standard 2.0 <br>  - Unity v5.6.4p4, modo Editor, Mono, .NET Standard 2.0 </li><li>  Android <br>  - Unity v2018.3.14f1, ensamblaje en el dispositivo, Mono, .NET Standard 2.0 </li><li>  iOS <br>  - Unity v2018.3.14f1, compilaci√≥n en dispositivo, il2cpp, .NET Standard 2.0 </li></ul><br><h3>  Implementaci√≥n </h3><br>  Tenemos varias formas diferentes de generar n√∫meros aleatorios.  Para cada uno de ellos, escribiremos una clase de contenedor separada, que deber√≠a proporcionar: <br><br><ol><li>  Posibilidad de establecer el rango de valores [min / max).  Se establecer√° a trav√©s del constructor. </li><li>  M√©todo de retorno de rango medio.  Elegiremos float como el tipo, como uno m√°s general. </li><li>  El nombre del m√©todo de generaci√≥n para marcar los resultados.  Por conveniencia, devolveremos el nombre completo de la clase + el nombre del m√©todo utilizado para generar el rango medio como valor. </li></ol><br>  Primero, declare una abstracci√≥n, que estar√° representada por la interfaz IRandomGenerator: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">RandomDistribution</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IRandomGenerator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Generate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; } }</code> </pre> <br><h4>  Implementaci√≥n de System.Random.Next () </h4><br>  Este m√©todo le permite especificar un rango de valores, pero devuelve enteros y se necesita un flotante.  Simplemente puede interpretar el n√∫mero entero como flotante, o puede expandir el rango de valores en varios √≥rdenes de magnitud, compens√°ndolos cada vez que se genera el rango medio.  Resultar√° algo as√≠ como un punto fijo con la precisi√≥n especificada.  Utilizaremos esta opci√≥n, ya que est√° m√°s cerca del valor flotante real. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">RandomDistribution</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SystemIntegerRandomGenerator</span></span> : <span class="hljs-title"><span class="hljs-title">IRandomGenerator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> DefaultFactor = <span class="hljs-number"><span class="hljs-number">100000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Random _generator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Random(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _min; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _max; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _factor; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name =&gt; <span class="hljs-string"><span class="hljs-string">"System.Random.Next()"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SystemIntegerRandomGenerator</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> min, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> max, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> factor = DefaultFactor</span></span></span><span class="hljs-function">)</span></span> { _min = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)min * factor; _max = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)max * factor; _factor = factor; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Generate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)_generator.Next(_min, _max) / _factor; } }</code> </pre> <br><h4>  Implementaci√≥n de System.Random.NextDouble () </h4><br>  Aqu√≠ un rango fijo de valores [0;  1)  Para proyectarlo sobre el especificado en el constructor, usamos aritm√©tica simple: X * (max - min) + min. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">RandomDistribution</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SystemDoubleRandomGenerator</span></span> : <span class="hljs-title"><span class="hljs-title">IRandomGenerator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Random _generator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Random(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> _factor; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> _min; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name =&gt; <span class="hljs-string"><span class="hljs-string">"System.Random.NextDouble()"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SystemDoubleRandomGenerator</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> min, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> max</span></span></span><span class="hljs-function">)</span></span> { _factor = max - min; _min = min; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Generate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)(_generator.NextDouble() * _factor) + _min; } }</code> </pre> <br><h4>  Implementaci√≥n de UnityEngine.Random.Range () </h4><br>  Este m√©todo de la clase est√°tica UnityEngine.Random le permite especificar un rango de valores y devuelve un rango medio de tipo flotante.  No se necesitan transformaciones adicionales. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">RandomDistribution</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">UnityRandomRangeGenerator</span></span> : <span class="hljs-title"><span class="hljs-title">IRandomGenerator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> _min; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> _max; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name =&gt; <span class="hljs-string"><span class="hljs-string">"UnityEngine.Random.Range()"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UnityRandomRangeGenerator</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> min, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> max</span></span></span><span class="hljs-function">)</span></span> { _min = min; _max = max; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Generate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; Random.Range(_min, _max); } }</code> </pre> <br><h4>  Implementaci√≥n de UnityEngine.Random.value </h4><br>  La propiedad de valor de la clase est√°tica UnityEngine.Random devuelve un rango medio de tipo flotante de un rango fijo de valores [0;  1)  Lo proyectamos en un rango determinado de la misma manera que cuando implementamos System.Random.NextDouble (). <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">RandomDistribution</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">UnityRandomValueGenerator</span></span> : <span class="hljs-title"><span class="hljs-title">IRandomGenerator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> _factor; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> _min; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name =&gt; <span class="hljs-string"><span class="hljs-string">"UnityEngine.Random.value"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UnityRandomValueGenerator</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> min, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> max</span></span></span><span class="hljs-function">)</span></span> { _factor = max - min; _min = min; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Generate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)(Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * _factor) + _min; } }</code> </pre> <br><h4>  Implementaci√≥n de Unity.Mathematics.Random.NextFloat () </h4><br>  El m√©todo NextFloat () de la clase Unity.Mathematics.Random devuelve un rango medio de tipo flotante y le permite especificar un rango de valores.  El √∫nico matiz es que cada instancia de Unity.Mathematics.Random tendr√° que inicializarse con algo de semilla, de esta manera evitaremos generar secuencias repetidas. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Unity.Mathematics; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">RandomDistribution</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">UnityMathematicsRandomValueGenerator</span></span> : <span class="hljs-title"><span class="hljs-title">IRandomGenerator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Random _generator; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> _min; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> _max; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name =&gt; <span class="hljs-string"><span class="hljs-string">"Unity.Mathematics.Random.NextFloat()"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UnityMathematicsRandomValueGenerator</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> min, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> max</span></span></span><span class="hljs-function">)</span></span> { _min = min; _max = max; _generator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Random(); _generator.InitState(<span class="hljs-keyword"><span class="hljs-keyword">unchecked</span></span>((<span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>)System.DateTime.Now.Ticks)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Generate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; _generator.NextFloat(_min, _max); } }</code> </pre> <br><h4>  Implementaci√≥n de MainController </h4><br>  Varias implementaciones de IRandomGenerator est√°n listas.  A continuaci√≥n, debe generar secuencias y guardar el conjunto de datos resultante para su procesamiento.  Para hacer esto, cree una escena en Unity y un peque√±o script MainController, que realizar√° todo el trabajo necesario y simult√°neamente ser√° responsable de interactuar con la interfaz de usuario. <br><br>  Establecemos el tama√±o del conjunto de datos y el rango de valores de rango medio, y tambi√©n obtenemos un m√©todo que devuelve una matriz de generadores sintonizados y listos para usar. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">RandomDistribution</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MainController</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> DefaultDatasetSize = <span class="hljs-number"><span class="hljs-number">100000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> MinValue = <span class="hljs-number"><span class="hljs-number">0f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> MaxValue = <span class="hljs-number"><span class="hljs-number">100f</span></span>; ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IRandomGenerator[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateRandomGenerators</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IRandomGenerator[] { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SystemIntegerRandomGenerator(MinValue, MaxValue), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SystemDoubleRandomGenerator(MinValue, MaxValue), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UnityRandomRangeGenerator(MinValue, MaxValue), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UnityRandomValueGenerator(MinValue, MaxValue), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UnityMathematicsRandomValueGenerator(MinValue, MaxValue) }; } ... } }</code> </pre> <br>  Y ahora estamos formando un conjunto de datos.  En este caso, la generaci√≥n de datos se combinar√° con el registro de los resultados en una secuencia de texto (en formato csv).  Para almacenar los valores de cada IRandomGenerator, se asigna una columna separada y la primera l√≠nea contiene el nombre del generador. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">RandomDistribution</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MainController</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateCsvDataSet</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TextWriter writer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dataSetSize, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">params</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IRandomGenerator[] generators</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> separator = <span class="hljs-string"><span class="hljs-string">','</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lastIdx = generators.Length - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">// write header for (int j = 0; j &lt;= lastIdx; j++) { writer.Write(generators[j].Name); if (j != lastIdx) writer.Write(separator); } writer.WriteLine(); // write data for (int i = 0; i &lt;= dataSetSize; i++) { for (int j = 0; j &lt;= lastIdx; j++) { writer.Write(generators[j].Generate()); if (j != lastIdx) writer.Write(separator); } if (i != dataSetSize) writer.WriteLine(); } } ... } }</span></span></code> </pre> <br>  Queda por llamar al m√©todo GenerateCsvDataSet y guardar el resultado en un archivo, o transferir inmediatamente los datos a trav√©s de la red desde el dispositivo final al servidor receptor. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">RandomDistribution</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MainController</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateCsvDataSet</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> path, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dataSetSize, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">params</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IRandomGenerator[] generators</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> writer = File.CreateText(path)) { GenerateCsvDataSet(writer, dataSetSize, generators); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateCsvDataSet</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dataSetSize, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">params</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IRandomGenerator[] generators</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (StringWriter writer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringWriter(CultureInfo.InvariantCulture)) { GenerateCsvDataSet(writer, dataSetSize, generators); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> writer.ToString(); } } ... } }</code> </pre> <br>  Las fuentes del proyecto est√°n en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GitLab</a> . <br><br><h2>  Resultados </h2><br>  No sucedi√≥ ning√∫n milagro.  Lo que esperaban, lo obtuvieron: en todos los casos, una distribuci√≥n uniforme sin una pizca de conspiraciones.  No veo el punto de aplicar gr√°ficos separados en las plataformas: todos muestran aproximadamente los mismos resultados. <br><br>  La realidad es: <br><img src="https://habrastorage.org/webt/yr/cb/io/yrcbio95sz22zrzhszi1syge7o8.gif"><br><br>  Visualizaci√≥n de secuencias en un plano a partir de los cinco m√©todos de generaci√≥n: <br><img src="https://habrastorage.org/webt/zk/0s/lf/zk0slfejixlez-fp2x9prd19u_c.gif"><br><br>  Y visualizaci√≥n en 3D.  Dejar√© solo el resultado de System.Random.Next (), para no producir un mont√≥n del mismo contenido. <br><img src="https://habrastorage.org/webt/ao/pw/ud/aopwud2ll4sjvtcpj69p-v8or8s.gif"><br><br>  La historia contada en la introducci√≥n sobre la distribuci√≥n normal de UnityEngine.Random no se repiti√≥: al principio era err√≥nea o algo ha cambiado en el motor desde entonces.  Pero ahora estamos seguros. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/473880/">https://habr.com/ru/post/473880/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../473136/index.html">Simulaci√≥n virtual en el proyecto de dron StarLine</a></li>
<li><a href="../473140/index.html">Habr Weekly # 24 / C√≥mo conducir estafadores telef√≥nicos, un robot para 800k ‚ÇΩ, una competencia de autores en Habr√©, SSD casi ruso</a></li>
<li><a href="../473868/index.html">Nos fijamos en el chip chino novatek NT78820</a></li>
<li><a href="../473872/index.html">Plan de preparaci√≥n de la entrevista para desarrolladores de Java</a></li>
<li><a href="../473874/index.html">El resumen de los eventos de TI en noviembre (primera parte)</a></li>
<li><a href="../473882/index.html">Introducci√≥n a las dependencias funcionales</a></li>
<li><a href="../473884/index.html">C√≥mo descargar datos con una estructura anidada de Google BigQuery usando el ejemplo de par√°metros personalizados de Google Analytics</a></li>
<li><a href="../473886/index.html">Estaci√≥n de trabajo criptogr√°fica basada en est√°ndares de clave p√∫blica. Funciones para analizar y ver la estructura ASN1</a></li>
<li><a href="../473888/index.html">Noticias del mundo de OpenStreetMap No. 483 (15/10/2019 - 21/10/2019)</a></li>
<li><a href="../473890/index.html">Operaci√≥n Calypso: nuevo grupo APT ataca oficinas gubernamentales en todo el mundo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>