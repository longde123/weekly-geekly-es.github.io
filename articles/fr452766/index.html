<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üì≤ üë£ üë®‚Äç‚öïÔ∏è La technologie de streaming progressif, ou comment regarder des vid√©os 4k sur le r√©seau, sans frises üßëüèª‚Äçü§ù‚Äçüßëüèª üåª ü§™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aujourd'hui, on ne peut surprendre personne avec la vitesse d'Internet √† 100 Mbit / s, mais il y a un probl√®me pour l'utiliser. Toutes les op√©rations ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>La technologie de streaming progressif, ou comment regarder des vid√©os 4k sur le r√©seau, sans frises</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452766/"><img src="https://habrastorage.org/webt/3-/du/hu/3-duhuu-n4ijfxkww4tnjhgdvxy.jpeg"><br><br>  Aujourd'hui, on ne peut surprendre personne avec la vitesse d'Internet √† 100 Mbit / s, mais il y a un probl√®me pour l'utiliser.  Toutes les op√©rations de base ne chargent pas compl√®tement le r√©seau.  Dans le m√™me temps, les formats audio et vid√©o lourds 4k-8k que vous souhaitez regarder en ligne sont plus populaires.  Et en regardant la vitesse √©lev√©e d'Internet, une question logique se pose - pourquoi pas?  Comment ma√Ætriser la pleine vitesse fournie par le fournisseur?  Tant du c√¥t√© client que du c√¥t√© service.  Consid√©rez tous ces probl√®mes dans l'article. <br><a name="habracut"></a><br>  J'ai fait un tr√®s bon produit logiciel et je veux dire plus en d√©tail comment tout y est organis√©.  Il existe de nombreuses nouvelles technologies.  Peut-√™tre parce que personne n'a rien invent√© dans cette industrie depuis longtemps, et le moment est venu.  Cet article n'est pas seulement destin√© aux d√©veloppeurs, mais aussi aux gens ordinaires.  J'ai essay√© de tout expliquer le plus simplement possible. <br><br>  <b>1.</b> Commen√ßons par les bases de base des technologies de transfert de donn√©es d'aujourd'hui. <br>  Il y a une grande lacune dans la connaissance de nombreuses personnes sur les algorithmes de transfert de donn√©es √† haut d√©bit - plus de 10 Mbit / s ... Comblons ces lacunes: <br><br>  <b>Espace # 1.</b>  Le probl√®me est que la totalit√© des technologies de transmission radio se concentre d√©sormais sur la transmission continue de donn√©es, comme le meilleur sc√©nario. <br><br>  Tout ce qui est transmis via wi-fi \ 3G \ 4G et m√™me par fil sera transmis plus rapidement si la transmission est constante, m√™me √† une vitesse inf√©rieure au maximum.  Ce sera beaucoup plus rapide que la transmission intermittente, mais √† la vitesse maximale. <br><br>  Raisons: <br><br><ul><li>  pour reprendre la communication, plus d'informations de service sont ajout√©es au trafic; </li><li>  lors de la reprise de la communication, le serveur peut abaisser la note du client et fournir des donn√©es √† une vitesse inf√©rieure (peut-√™tre en raison de l'apparition d'autres clients), ou pas du tout.  M√™me dans un r√©seau wi-fi domestique, le routeur peut abaisser la cote, par exemple, en raison d'un aspirateur wi-fi.  C'est-√†-dire  cela s'applique √† tous les r√©seaux o√π il y a plus de 2 clients.  En g√©n√©ral, presque √† tout le monde :-) </li></ul><br>  <b>Espace # 2.</b>  Lors de la copie de donn√©es, tout programme utilise une sorte de ¬´compartiment¬ª qui extrait les donn√©es de la source et les transf√®re vers la destination.  Ainsi, ce compartiment, en fonction du taux de transfert de donn√©es, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">doit √™tre de tailles diff√©rentes</a> .  C'est facile √† comprendre: si vous prenez un seau d'eau avec une cuill√®re √† caf√©, cela prendra beaucoup plus de temps que de ramasser une tasse. <br><br>  <b>Espace # 3.</b>  Pour augmenter la vitesse de t√©l√©chargement des donn√©es sur le r√©seau, la RAM doit √™tre utilis√©e.  Les moindres millisecondes de retard lors de l'enregistrement des donn√©es entrantes sont ensuite vers√©es en secondes, minutes et heures.  Pour √©viter que cela ne se produise, vous devez d'abord √©crire des donn√©es dans la RAM, puis dans un ¬´compartiment¬ª plus volumineux sur un support permanent (disque dur).  Sinon, la vitesse de transfert de donn√©es diminuera consid√©rablement. <br><br>  <b>Cela suffit pour copier le fichier.</b> <br><br>  <b>2.</b> Ces lacunes ne sont que la pointe de l'iceberg.  Avec un transfert de fichier normal, cela suffit, mais que se passe-t-il si notre fichier est multim√©dia, et nous devons commencer √† le lire en ligne.  Un fichier multim√©dia moderne ne peut pas s'int√©grer compl√®tement dans la RAM, vous devez donc envisager de l'enregistrer sur le disque. <br><br>  La meilleure strat√©gie est construite √† partir de ce qui pr√©c√®de sur les espaces: <br><br><ul><li>  le chargement des donn√©es doit se produire ind√©pendamment de la lecture, en continu; </li><li>  pour assurer le rembobinage, il est n√©cessaire de cr√©er un autre flux de chargement de donn√©es; </li><li>  pour surmonter la frise au d√©marrage, du fait de la r√©ception des donn√©es techniques (codecs, etc.), un pr√©chargement est n√©cessaire.  Empiriquement, j'ai trouv√© la formule: la taille du fichier entier est de * 0,002 ou 0,2%. </li></ul><br>  <b>Cela suffit pour lire des fichiers Flac.</b> <br><br>  <b>3.</b> Il s'av√®re que pour le streaming en ligne, qui utilisera rationnellement et pleinement notre canal de communication, vous avez besoin de RAM et d'espace disque.  Sans cela, le canal ne sera pas pleinement utilis√©. <br><br>  Et ici commence la ramification des algorithmes de chargement de donn√©es!  Sans d√©tails techniques, je les donnerai dans un volume approximatif: <br><br><ul><li>  pour que les donn√©es ne soient pas t√©l√©charg√©es deux fois, il est n√©cessaire de faire une collision de flux.  C'est-√†-dire  si nous avons commenc√© la piste et rembobin√© rapidement au milieu, alors le premier flux, atteignant le milieu, devrait interrompre son travail. </li><li>  pour que les donn√©es ne soient pas t√©l√©charg√©es deux fois, un flux ne doit pas √™tre cr√©√© si les donn√©es sont d√©j√† charg√©es. </li><li>  Pour une lecture normale, une logique complexe d'interaction entre le flux du lecteur et les flux qui t√©l√©chargent les donn√©es est n√©cessaire. </li></ul><br>  J'ai fait tout cela et un peu plus.  Cela s'est av√©r√© absolument fabuleux.  Les donn√©es volent et la lecture n'est pas interrompue.  Les fichiers Flac ont √©t√© t√©l√©charg√©s compl√®tement √† 1-3 secondes de lecture.  <b>Et c'√©tait suffisant pour lire une vid√©o Full HD.</b> <br><br>  <b>4.</b> Le probl√®me est que nos fichiers multim√©dias sont de tailles tr√®s diff√©rentes.  Et avec les films Blu-ray 4K, qui p√®sent entre 80 et 120 Go, rien n'a fonctionn√©.  Le joueur a cr√©√© 15 threads au d√©but, et ils ont tous partag√© la vitesse, ce qui, bien s√ªr, n'√©tait pas suffisant pour le thread principal, que le joueur attendait.  Les donn√©es ont √©t√© charg√©es √† la vitesse maximale, oui ... ils ont t√©l√©charg√© la cha√Æne compl√®te, mais la vid√©o 4k a √©t√© suspendue et jou√©e plus lentement que le diaporama.  Il s'av√®re que beaucoup de flux sont nocifs pour la vid√©o 4k, mais o√π est la fronti√®re apr√®s laquelle les avantages en Full HD se sont transform√©s en dommages en 4k?! <br><br>  En cons√©quence, tout reposait sur la vitesse de la cha√Æne.  Afin d'optimiser les threads, vous devez savoir deux choses: <br><br>  a) La vitesse requise pour la lecture, qui est calcul√©e: (taille / dur√©e du fichier en secondes) * 8. <br><br>  b) La vitesse de chargement des donn√©es par le flux principal avec lequel le joueur travaille actuellement. <br><br>  Si nous g√©rons le chargement des donn√©es, nous avons d√©finitivement la possibilit√© de mesurer la vitesse de t√©l√©chargement.  D√©sormais, chaque thread connaissait sa vitesse (en Mbps) et cela n'impose pas de co√ªts suppl√©mentaires sur les performances.  Assurez-vous d'identifier le flux sur lequel le lecteur travaille actuellement.  Tout commence dans le mode multithread habituel.  Mais d√®s que le lecteur calcule la dur√©e du fichier multim√©dia en secondes et transmet ces donn√©es, tous les flux obtiennent une vitesse fixe et n√©cessaire pour la lecture.  Imm√©diatement apr√®s cela, tous les flux (sauf le principal) comparent la vitesse n√©cessaire avec la vitesse du flux principal et si sa vitesse est inf√©rieure, ils s'arr√™tent.  De plus, le thread principal augmente lentement sa vitesse, et d√®s qu'il d√©passe deux fois la vitesse n√©cessaire (comme je l'ai fait), il suspend tous les flux secondaires de la pause. <br><br>  Selon les observations, puis, apr√®s un certain temps, la vitesse du flux principal diminue √† nouveau et tous les flux secondaires se mettent √† nouveau en pause, et ainsi jusqu'√† ce que les donn√©es soient t√©l√©charg√©es ou la lecture termin√©e.  Une telle strat√©gie flexible, lorsque le chargement des donn√©es est parall√©lis√© et, si n√©cessaire, compress√© en un seul flux, t√©l√©charge enti√®rement le canal de communication et garantit en m√™me temps le t√©l√©chargement le plus rapide possible des donn√©es n√©cessaires √† la lecture des donn√©es.  Cette strat√©gie fonctionne aussi bien sur les fichiers de 10 Mo que sur 100 Go.  Pour jouer sur le r√©seau sans perte, il est impossible de trouver quelque chose de mieux.  Si vous avez des suggestions, je serai heureux d'en discuter dans les commentaires. <br><br>  <b>Convient pour la lecture de fichiers multim√©dias de tout volume 4k-8k.</b> <br><br><blockquote>  Le streaming progressif est le type de streaming le plus rapide lors de la transmission de donn√©es dans leur qualit√© d'origine.  Pour augmenter le taux de transfert de donn√©es, il utilise la RAM et le multi-threading.  Les donn√©es sont charg√©es de mani√®re asynchrone dans le flux de lecture, mais avec une interaction active avec celui-ci.  Pendant la lecture, la vitesse d'acquisition des donn√©es est mesur√©e et le nombre de flux actifs est adapt√© au canal de donn√©es disponible. </blockquote>  Actuellement, dans le monde, il y a une grande tendance √† augmenter le nombre de vid√©os haute r√©solution, et la popularit√© des appareils pour les lire augmente. <br><br><img src="https://habrastorage.org/webt/jt/-c/cv/jt-ccvuigi38b7q-pub-5ds3qqs.png"><br>  <i>Source <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.vox.com</a></i> <br><br>  La vid√©o Bitrate 4k est volumineuse, mais pas exorbitante.  Le codec VP9 le plus efficace compresse aujourd'hui la vid√©o 4k √† 15 Mbps.  avec audio sort environ 15,5.  Un film Blu-ray de 100 Go a un d√©bit d'environ 60 Mb / s ... <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Quiconque dans le monde</a> veut regarder des vid√©os 4K a ces vitesses Internet.  Cela signifie que les vid√©os 4K peuvent √™tre regard√©es en ligne maintenant! <br><br>  Malgr√© la simplicit√© de l'algorithme d√©crit ci-dessus, la mise en ≈ìuvre semble tr√®s compliqu√©e.  Les technologies de streaming avec d√©t√©rioration de la qualit√© de la vid√©o et de l'audio sont oblig√©es de g√¢cher le contenu en raison de l'absence de mise en ≈ìuvre de l'algorithme de transfert de donn√©es correct.  Je suppose que de nombreuses personnes et entreprises ont (ci-dessus) des lacunes dans les connaissances et, bien s√ªr, des difficult√©s √† mettre en ≈ìuvre cet algorithme.  Par cons√©quent, il a √©crit un article pour simplifier la compr√©hension de cette m√©thode de streaming. <br><br>  Il sera un peu plus difficile de rendre cet algorithme en utilisant le droit d'auteur, mais en g√©n√©ral c'est aussi possible.  Lors de l'enregistrement sur le disque et de la lecture, il est n√©cessaire de crypter les donn√©es.  Cela ressemble √† une action ennemie contre l'utilisateur, mais que faire.  Certaines entreprises le font. <br><br>  Voyons maintenant les inconv√©nients du streaming conventionnel, par rapport au progressif: <br><br><ul><li>  il est impossible de pr√©charger le fichier suivant \ pour pr√©voir et pr√©parer la prochaine action; </li><li>  m√™me avec une d√©connexion temporaire d'Internet / des interruptions de vitesse, une frise notable de son / image appara√Ætra; </li><li>  le canal de communication n'est pas pleinement utilis√© et la moiti√© du temps de lecture est inactif, √† un moment o√π il y a encore beaucoup de donn√©es √† charger; </li><li>  l'incapacit√© de lire des vid√©os 4k-8k, m√™me via wi-fi sans frises.  Des rafales de communication constantes et des sauts de vitesse au maximum ne peuvent pas le supporter, m√™me le Wi-Fi √† domicile tout au long du film est de 2 heures ou plus; </li><li>  cela impose une charge encore plus importante lors de la lecture de contenu 4k, car le lecteur doit conserver dans la RAM de 200 √† 300 Mo de donn√©es vid√©o (√† la vitesse requise de 60 Mo / s).  Lors de la lecture via un algorithme de streaming progressif, cela n'est plus n√©cessaire, car la lecture s'effectue √† partir d'un disque, et non via un r√©seau. </li></ul><br>  Selon ces points, il est clair que le streaming, comme auparavant, n'est plus possible.  Bien s√ªr, vous pouvez augmenter la vitesse \ m√©moire \ cache dix fois, mais pourquoi, si les vitesses d'aujourd'hui sont d√©j√† suffisantes et que le probl√®me r√©side dans les algorithmes.  T√¥t ou tard, les mauvais algorithmes s'arr√™tent.  Aujourd'hui, le streaming progressif est la seule technologie qui vous permet de regarder de mani√®re stable et confortable des films 4k 100 Gigabyte en ligne. <br><br>  Pour illustrer le fonctionnement de la technologie, j'ai √©crit une application multim√©dia - le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lecteur de biblioth√®que multim√©dia</a> .  Il prend en charge tous les formats.  Pour d√©montrer les capacit√©s dont vous avez besoin pour l'ex√©cuter.  Ouvrez le site de d√©monstration et acc√©dez √† l'arborescence du r√©pertoire "Films (TOP) / Films 4k".  L√†, vous pouvez s√©lectionner n'importe quel film et le regarder.  Pour prendre en charge tous les formats, vous devez basculer le module lecteur d'ExoPlayer vers VlcPlayer. <br>  Dans ce sc√©nario, tous les algorithmes d'acquisition de donn√©es ci-dessus seront utilis√©s.  Mon application prend en charge les protocoles suivants: nmdc \ http \ ftp \ samba, ainsi que le cloud Mega.nz. <br><br>  Les fichiers vid√©o 4K de 100 Go sont lus avec un minimum de d√©lais et t√©l√©charg√©s en m√©moire √† la vitesse la plus √©lev√©e possible.  Vous pouvez pr√©charger plus de donn√©es en faisant simplement une pause, mais cela n'est g√©n√©ralement pas n√©cessaire.  La lecture est toujours stable, sinon stable, la vitesse du canal est proche de la vitesse n√©cessaire pour la lecture. <br><br>  En raison des lacunes d√©crites ci-dessus, les politiques des plus grandes entreprises ne se d√©veloppent pas correctement, ce qui ralentit les progr√®s et emp√™che souvent l'utilisation compl√®te des appareils et des canaux de communication disponibles. <br><br>  L'application pr√©voit d'enregistrer le cache sur des supports externes, mais en raison de l'√©trange complication de l'acc√®s aux supports externes de Google, il est actuellement pris en charge principalement par les appareils Samsung et la version Android 5.0+.  √Ä l'avenir, une prise en charge compl√®te des supports USB externes appara√Ætra. <br><br>  En g√©n√©ral, l'algorithme am√©liore consid√©rablement la qualit√© et la vitesse de t√©l√©chargement des donn√©es lors de la diffusion, √† la fois de petits fichiers de 30 √† 50 Mo et de gros 50 √† 120 Go. <br><br>  En perspective, il peut √™tre utilis√©: <br><br><ul><li>  pour une lecture de haute qualit√© du contenu multim√©dia 4k-8k sur les t√©l√©phones mobiles, t√©l√©viseurs et autres appareils; </li><li>  en r√©alit√© virtuelle pour afficher des sc√®nes volum√©triques en haute r√©solution; </li><li>  en combinaison avec des protocoles peer-to-peer de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">type torrent</a> ; </li><li>  pour une lecture de musique de haute qualit√© en haute r√©solution sur n'importe quel appareil.  Des tests exp√©rimentaux ont montr√© que 2 Mbps d'un canal de communication instable suffisent pour cela. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr452766/">https://habr.com/ru/post/fr452766/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr452754/index.html">19% des images Docker les plus populaires n'ont pas de mot de passe root</a></li>
<li><a href="../fr452756/index.html">Cr√©ation de Tower Defense dans Unity: Enemies</a></li>
<li><a href="../fr452760/index.html">Vitamine D. Boire ou ne pas boire, telle est la question. (Ou une histoire sur la fa√ßon dont j'ai r√©ussi une analyse qui ne m'a pas √©t√© prescrite)</a></li>
<li><a href="../fr452762/index.html">MVCC-7. Nettoyage auto</a></li>
<li><a href="../fr452764/index.html">[Peter] Rencontre JUG.ru avec Sergei Melnikov - Profilage √† la vitesse supraluminique: th√©orie et pratique</a></li>
<li><a href="../fr452768/index.html">Comment concevoir un produit si vous d√©cidez d'entrer sur le march√© √©tranger</a></li>
<li><a href="../fr452772/index.html">5 techniques avanc√©es de test Go</a></li>
<li><a href="../fr452774/index.html">Dell XPS 13 9380: un ordinateur portable fiable et tr√®s compact pour les affaires s√©rieuses</a></li>
<li><a href="../fr452776/index.html">N.M.D. (Pas mon entreprise)</a></li>
<li><a href="../fr452778/index.html">Comment acc√©l√©rer le d√©chargement de LZ4 dans ClickHouse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>