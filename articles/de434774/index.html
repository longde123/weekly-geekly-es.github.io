<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📮 🍐 👩🏻‍🚀 5 Lektionen, die wir durch das Schreiben von über 300.000 Zeilen Infrastrukturcode gelernt haben 👩🏻‍🎨 💥 📂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eine kurze Meisterklasse zur Entwicklung von Infrastrukturcode 





 Im Oktober dieses Jahres hielt ich eine Präsentation auf der HashiConf 2018-Konf...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>5 Lektionen, die wir durch das Schreiben von über 300.000 Zeilen Infrastrukturcode gelernt haben</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/434774/"><h3 id="kratkiy-master-klass-po-razrabotke-infrastrukturnogo-koda">  Eine kurze Meisterklasse zur Entwicklung von Infrastrukturcode </h3><br><p><img src="https://habrastorage.org/getpro/habr/post_images/1f2/0b9/17f/1f20b917f7f598d845324b4b8ce18bbf.jpg" alt="Bild"></p><br><p>  Im Oktober dieses Jahres hielt ich eine Präsentation auf der HashiConf 2018-Konferenz, auf der ich über fünf wichtige Lektionen sprach, die ich und meine Gruntwork-Kollegen beim Erstellen und Verwalten einer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bibliothek mit mehr als 300.000 Zeilen Infrastrukturcode</a> gelernt haben, die von Hunderten von Unternehmen in Produktionssystemen verwendet werden.  In dieser Veröffentlichung werde ich Videos und Folien aus der Präsentation sowie eine gekürzte Textversion der Beschreibung der 5 Hauptlektionen veröffentlichen. </p><br><h3 id="video-i-slaydy">  Videos und Folien </h3><br><iframe width="560" height="315" src="https://www.youtube.com/embed/RTEgE2lcyk4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3 id="vstuplenie-devops-seychas--v-kamennom-veke">  Intro: DevOps jetzt in der Steinzeit </h3><br><p>  Trotz der Tatsache, dass die Branche voller modischer, fortschrittlicher Wörter ist: Kubernetes, Microservices, Service Grids, unveränderliche Infrastruktur, Big Data, Datenseen usw., ist die Realität, dass Sie sich nicht fühlen, wenn Sie in die Schaffung von Infrastruktur eintauchen so modisch und progressiv. </p><a name="habracut"></a><br><p>  Persönlich erinnert mich DevOps mehr daran: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/299/9f7/51e/2999f751eb309e5f9ee967deb56fb907.jpg" alt="Bild"></p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/2a0/ddc/a9d/2a0ddca9d9f1ee2f83e1130e84788fb2.jpg" alt="Bild"></p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/9d2/69e/1b4/9d269e1b44d8bd7bc65cc35accd2531f.jpg" alt="Bild"></p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/dad/458/a97/dad458a97d189cfad6ec939a535f1722.jpg" alt="Bild"></p><br><p>  Die Schaffung einer Infrastruktur auf Produktionsebene ist schwierig.  Das ist echter Stress.  Und isst viel Zeit.  Viel Zeit. </p><br><p>  Es zeigt, wie viel Zeit für die Implementierung des nächsten Infrastrukturprojekts benötigt wird.  Wir stützten uns auf empirische Daten, die wir im Rahmen der Arbeit mit Hunderten verschiedener Unternehmen gesammelt haben: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e1b/84c/72c/e1b84c72c3dfa22ddbe8653f94e38fa9.png" alt="Bild"></p><br><h3 id="urok-1-cheklist-dlya-infrastruktury-proizvodstvennogo-urovnya">  Lektion 1. Checkliste für die Fertigungsinfrastruktur </h3><br><p>  DevOps-Projekte dauern immer länger als erwartet.  Immer.  Warum so? <br>  Der erste Grund ist ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Yak-Haarschnitt</a> .  Unten finden Sie eine anschauliche Darstellung dieses Phänomens (dies ist ein Auszug aus der Serie „Malcolm im Rampenlicht“). </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Der zweite Grund ist, dass der Prozess der Erstellung einer Infrastruktur auf Produktionsebene (z. B. die Infrastruktur, auf die Sie Ihr Unternehmen setzen würden) aus Tausenden von Kleinteilen besteht.  Die überwiegende Mehrheit der Entwickler kennt diese Details nicht. Daher vergessen Sie bei der Bewertung eines Projekts normalerweise viele kritische (und zeitaufwändige) Aufgaben. <br>  Verwenden Sie die folgende Checkliste, um dies zu vermeiden, wenn Sie mit der Arbeit an einem neuen Abschnitt der Infrastruktur beginnen: </p><br><p> <a href=""><img src="https://habrastorage.org/webt/o2/xu/wu/o2xuwumkfwrh9epcydpmk-b76ru.jpeg"></a> </p><br><p>  Nicht alle Elemente der Liste werden für jede einzelne Infrastruktur benötigt, aber Sie müssen bewusst und explizit dokumentieren, welche Elemente Sie implementiert haben und welche Sie überspringen möchten und warum. </p><br><h3 id="urok-2-nabor-instrumentov">  Lektion 2. Toolbox </h3><br><p>  Wir listen die wichtigsten Tools auf, mit denen wir bei Gruntwork die Infrastruktur erstellen und verwalten (Stand 2018): </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b9c/656/c19/b9c656c197abcd9892102cc947e525fa.png" alt="Bild"></p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Terraform</a> .  Wir verwenden Terraform, um die gesamte zugrunde liegende Infrastruktur bereitzustellen, einschließlich des Netzwerks, der Lastausgleichssubsysteme, der Datenbanken, der Tools zur Verwaltung von Benutzern und Berechtigungen sowie aller unserer Server. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Packer</a> .  Wir verwenden Packer, um Images von virtuellen Maschinen zu konfigurieren und zu erstellen, die wir auf unseren Servern ausführen. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Docker</a> .  Einige unserer Server bilden Cluster, in denen wir Anwendungen als Docker-Container ausführen.  Für Docker-Cluster verwenden wir hauptsächlich die folgenden Tools: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kubernetes</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ECS</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fargate</a> . </li></ul><br><p>  Alle diese Tools sind nützlich, aber das ist nicht der Punkt.  Sie müssen verstehen, dass einige Tools nicht ausreichen.  Es ist auch notwendig, das Verhalten des Teams zu ändern. </p><br><p>  Insbesondere helfen selbst die besten Tools der Welt Ihrem Team nicht, wenn sie sie nicht verwenden möchten oder nicht genügend Zeit haben, um zu lernen, wie sie verwendet werden.  Die wichtigste Schlussfolgerung ist daher, dass die Verwendung von "Infrastruktur als Code" eine Investition ist, dh, dass bestimmte Anfangskosten von Ihnen verlangt werden.  Wenn Sie mit Bedacht investieren, erhalten Sie langfristig hohe Dividenden. </p><br><h3 id="urok-3-bolshie-moduli--eto-zlo">  Lektion 3. Große Module sind böse </h3><br><p>  Neulinge in der Anwendung von „Infrastruktur als Code“ definieren häufig ihre gesamte Infrastruktur für alle ihre Umgebungen (Entwicklungsumgebung, Zwischenumgebung, Produktionsumgebung usw.) in einer Datei oder einer Reihe von Dateien, die als Ganzes bereitgestellt werden.  Vergebens. </p><br><p>  Hier sind nur einige der Nachteile dieses Ansatzes: </p><br><ul><li> <strong>Niedrige Geschwindigkeit</strong>  Wenn die gesamte Infrastruktur an einem Ort definiert ist, nimmt die Ausführung eines Befehls viel Zeit in Anspruch.  Wir waren mit Situationen in Unternehmen konfrontiert, in denen das <code>terraform plan</code> Team 5-6 Minuten brauchte! </li><li>  <strong>Geringe Sicherheit</strong> .  Wenn Sie die gesamte Infrastruktur gemeinsam verwalten, benötigen Sie zum Ändern von Berechtigungen Berechtigungen, um auf alles zugreifen zu können.  Das heißt, fast jeder Benutzer sollte ein Administrator sein, und dies ist auch sehr unpraktisch. </li><li>  <strong>Hohe Risiken</strong> .  Wenn Sie alle Eier in einen Korb legen, entsteht eine Situation, in der ein lokaler Fehler den Betrieb der gesamten Infrastruktur stören kann.  Wenn Sie beispielsweise geringfügige Änderungen an einer externen Anwendung in der Entwicklungsumgebung vornehmen, kann ein einzelner Tippfehler oder ein falscher Befehl zum Löschen der Produktionsdatenbank führen. </li><li>  <strong>Es ist schwer zu verstehen</strong> .  Je mehr Code an einer Stelle platziert wird, desto schwieriger ist es für eine Person, all dies zu verstehen.  Und wenn all dies miteinander verbunden ist, werden unverständliche Teile einen grausamen Witz mit Ihnen spielen. </li><li>  <strong>Schwer zu testen</strong> .  Das Testen des Infrastrukturcodes ist schwierig.  Das Testen großer Mengen von Infrastrukturcode ist nahezu unmöglich.  Wir werden später darauf zurückkommen. </li><li>  <strong>Es ist schwer zu analysieren</strong> .  Die Ausgabe von Befehlen wie Terraform Plan wird unbrauchbar, da sich niemand die Mühe macht, Tausende von Zeilen anzuzeigen.  Darüber hinaus wird die Code-Analyse unbrauchbar. </li></ul><br><p>  Kurz gesagt, Sie müssen Ihren Code aus kleinen, eigenständigen und wiederverwendbaren Verbundmodulen erstellen.  Dies ist weder eine Neuigkeit noch eine Entdeckung.  Sie haben dies tausendmal gehört, allerdings in etwas anderen Situationen: </p><br><blockquote>  "Mach eins und mach es gut" - Unix-Philosophie. <br>  „Die erste Regel für Funktionen ist, dass sie klein sein sollten.  Die zweite Regel besagt, dass Funktionen noch kleiner sein sollten. "  - "Code reinigen" </blockquote><br><h3 id="urok-4-infrastrukturnyy-kod-bez-avtomaticheskih-testov-neispraven">  Lektion 4. Infrastrukturcode ohne automatische Tests ist fehlerhaft </h3><br><p>  Wenn Ihr Infrastrukturcode keine automatisierten Tests enthält, funktioniert er nicht ordnungsgemäß.  Du weißt es einfach noch nicht.  Das Testen des Infrastrukturcodes ist jedoch schwierig.  Sie haben weder einen „lokalen Host“ (z. B. können Sie keine virtuelle private AWS VPC-Cloud auf Ihrem Laptop bereitstellen) noch echte „Komponententests“ (z. B. können Sie Terraform-Code nicht von der „Außenwelt“ isolieren, da dies der Fall ist Zeiten und soll mit der Außenwelt kommunizieren). </p><br><p>  Um den Infrastrukturcode korrekt zu testen, müssen Sie ihn normalerweise in einer realen Umgebung bereitstellen, eine reale Infrastruktur ausführen, überprüfen, ob der Code funktioniert, und ihn dann beschädigen (eine Beschreibung dieses Teststils finden Sie unter Terratest. Dies ist eine Open Source-Bibliothek, die Tools zum Testen von Terraform-Code enthält , Packer und Docker, die mit AWS-, GCP- und Kubernetes-APIs arbeiten und Shell-Befehle lokal und auf Remote-Servern über SSH ausführen, sowie viele andere Funktionen).  Daher müssen Sie beim Testen der Infrastruktur die Bedingungen leicht neu definieren: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e38/f8a/24d/e38f8a24dedcc2de2eec19291f885ccd.png" alt="Bild"></p><br><p>  <strong>Unit-Tests</strong> stellen ein oder mehrere eng verwandte Infrastrukturmodule desselben Typs bereit und testen sie (z. B. Module für eine einzelne Datenbank). </p><br><p>  <strong>Integrationstests</strong> stellen mehrere Infrastrukturmodule verschiedener Typen bereit und testen sie, um sicherzustellen, dass sie zusammenarbeiten (z. B. Datenbankmodule und Webdienstmodule). </p><br><p>  <strong>End-to-End-Tests</strong> (e2e) stellen die gesamte Architektur bereit und testen sie. <br>  Bitte beachten Sie, dass das Diagramm eine Pyramide ist: Wir haben viele Komponententests, weniger Integrationstests und sehr wenige e2e-Tests.  Warum?  Dies hängt von der Dauer der einzelnen Testarten ab: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/071/040/730/07104073030dd617e05ad563d698e7b5.png" alt="Bild"></p><br><p>  Infrastrukturtests nehmen viel Zeit in Anspruch, insbesondere auf den oberen Ebenen der Pyramide, und natürlich möchten Sie ganz unten so viele Fehler wie möglich finden und beheben.  Dazu benötigen Sie: </p><br><ol><li>  Erstellen Sie kleine und einfache eigenständige Module (siehe Lektion 3) und schreiben Sie viele Komponententests für sie - stellen Sie sicher, dass sie ordnungsgemäß funktionieren. </li><li>  Kombinieren Sie diese kleinen, einfachen und bewährten Blöcke, um eine komplexere Infrastruktur zu erstellen, die Sie mit weniger Integrations- und E2E-Tests testen. </li></ol><br><h3 id="urok-5-process-reliza">  Lektion 5. Freigabeprozess </h3><br><p>  Um all das zusammenzufassen.  So erstellen und verwalten Sie jetzt Ihre Infrastruktur: </p><br><ul><li>  Überprüfen Sie die Checkliste für die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Infrastruktur in Produktionsqualität</a> und stellen Sie sicher, dass Sie in die richtige Richtung arbeiten. </li><li>  Definieren Sie Ihre „Infrastruktur als Code“ mit Tools wie Terraform, Packer und Docker.  Stellen Sie sicher, dass Ihr Team genügend Zeit hat, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">um</a> diese Tools zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">erlernen</a> (siehe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DevOps-Ressourcen</a> ). </li><li>  Erstellen Sie Code aus kleinen und eigenständigen Verbundmodulen (oder verwenden Sie Standardmodule aus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">der Infrastruktur als Codebibliothek</a> ). </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bereiten</a> Sie mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Terratest</a> automatisierte Tests für Ihre Module <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vor</a> . </li><li>  Vervollständigen Sie die Anforderung, um Ihre Änderungen zur Überprüfung Ihres Codes aufzunehmen. </li><li>  Geben Sie die neue Version des Codes frei. </li><li>  Kopieren Sie die neue Version des Codes von einer Umgebung in eine andere. </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/43f/57b/1b6/43f57b1b6721ef8dd14eb583ffca2d66.png" alt="Bild"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de434774/">https://habr.com/ru/post/de434774/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de434756/index.html">Die Zukunft von Kubernetes liegt bei virtuellen Maschinen</a></li>
<li><a href="../de434758/index.html">Facebook Moderator Guide: Über 1.400 Seiten mit widersprüchlichen Folien</a></li>
<li><a href="../de434760/index.html">PostgreSQL News Digest. Neujahr (verkürzt) Ausgabe Nr. 13</a></li>
<li><a href="../de434762/index.html">Notizen eines Phytochemikers. Grüne Banane oder denken Sie daran, die Mikrobiota zu füttern</a></li>
<li><a href="../de434770/index.html">Erneuerbare Energie: Wörter und ihre Bedeutung</a></li>
<li><a href="../de434776/index.html">VK berechnet Ihren Standort anhand der IP</a></li>
<li><a href="../de434780/index.html">Robotisierung kann zur Diktatur führen</a></li>
<li><a href="../de434782/index.html">Wie habe ich ein CRM-System ausgewählt?</a></li>
<li><a href="../de434784/index.html">So priorisieren Sie die Entwicklung. Erfahrung in der Implementierung von GIST + ICE in Yandex.Market</a></li>
<li><a href="../de434786/index.html">Sieben kostenlose automatisierte Problemlösungsplattformen zum Nivellieren von Programmierkenntnissen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>