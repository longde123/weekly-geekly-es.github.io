<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíò üì£ üìä Citymobil - um manual para melhorar a disponibilidade em meio ao crescimento dos neg√≥cios para startups. Parte 5 üë©üèø‚Äç‚úàÔ∏è üåú üåÜ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Esta √© a parte final da s√©rie que descreve como estamos aumentando nossa disponibilidade de servi√ßos no Citymobil (voc√™ pode ler a parte anterior aqui...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Citymobil - um manual para melhorar a disponibilidade em meio ao crescimento dos neg√≥cios para startups. Parte 5</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/450994/"><img src="https://habrastorage.org/getpro/habr/post_images/69d/ea9/db3/69dea9db332a69e8d7f992ab82102329.png"><br><br>  Esta √© a parte final da s√©rie que descreve como estamos aumentando nossa disponibilidade de servi√ßos no Citymobil (voc√™ pode ler a parte anterior <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> ).  Agora vou falar sobre mais um tipo de interrup√ß√µes e as conclus√µes que tiramos sobre elas, como modificamos o processo de desenvolvimento, que automa√ß√£o introduzimos. <br><a name="habracut"></a><br><h2>  1. Vers√£o ruim: bug </h2><br>  Esse √© o tipo mais desagrad√°vel de interrup√ß√µes e incidentes.  O √∫nico tipo que n√£o apresenta sintomas vis√≠veis al√©m das reclama√ß√µes de usu√°rios finais ou comerciais.  √â por isso que esse incidente, especialmente um pequeno, pode permanecer despercebido na produ√ß√£o por um tempo. <br><br>  Todos os outros tipos de interrup√ß√µes s√£o mais ou menos semelhantes a "Vers√£o ruim: 500 erros internos do servidor".  A √∫nica coisa √© que eles n√£o s√£o acionados por uma libera√ß√£o, mas por uma carga de trabalho, opera√ß√£o manual ou um problema de servi√ßo externo. <br><br>  Para descrever o m√©todo de lidar com esse tipo de interrup√ß√£o, devemos lembrar uma piada antiga: <br><br><blockquote>  Um matem√°tico e um f√≠sico recebem a mesma tarefa: ferver √°gua.  Eles recebem algumas ferramentas auxiliares: um fog√£o, uma chaleira, uma torneira com √°gua, f√≥sforos.  Ambos se revezam no enchimento da chaleira com √°gua, ligando o g√°s e come√ßando a aquecer a chaleira.  Depois, a tarefa √© simplificada: eles recebem uma chaleira, cheia de √°gua e um fog√£o que j√° est√° ligado.  A tarefa √© a mesma - ferver √°gua.  O f√≠sico coloca a chaleira no fog√£o.  O matem√°tico esvazia a chaleira, apaga o g√°s e diz: "O problema √© reduzido para um que j√° foi resolvido".  ¬© anekdotov.net </blockquote><br>  Esse tipo de interrup√ß√£o deve ser reduzido para "Vers√£o ruim: 500 erros internos do servidor" a todo custo.  Idealmente, os erros devem ser registrados da mesma maneira que 500 erros.  No entanto, √© claro, voc√™ n√£o pode registrar o evento de um bug porque, se pudesse, n√£o o faria em primeiro lugar. <br><br>  Uma das id√©ias para rastrear um bug √© procurar rastros no banco de dados.  Esses rastreamentos nos permitem ver que h√° um erro e enviar alertas.  Como podemos ajudar nisso?  Come√ßamos a investigar todos os grandes erros e a encontrar solu√ß√µes: que tipo de monitoramento / alerta por SMS pode ser criado para fazer com que esse erro se revele imediatamente como um erro 500?  Aqui est√£o alguns exemplos. <br><br><h4>  1.1  Exemplo de uma interrup√ß√£o causada por um bug </h4><br>  De repente, est√°vamos recebendo uma enorme quantidade de reclama√ß√µes de nossos usu√°rios: os pedidos pagos via Apple Pay n√£o podiam ser fechados.  Iniciamos nossa investiga√ß√£o;  o problema foi reproduzido no ambiente de teste.  A causa raiz foi encontrada: atualizamos o formato da data de validade dos cart√µes de cr√©dito porque ela foi alterada por um servi√ßo de processamento de pagamentos, mas n√£o foi feita corretamente para pagamentos via Apple Pay;  portanto, todos os pagamentos do Apple Pay foram recusados.  N√≥s o corrigimos assim que soubemos do problema, o implantamos e o problema desapareceu.  No entanto, esse problema permaneceu ativo por 45 minutos. <br><br>  Ap√≥s esse problema, monitoramos v√°rios pagamentos mal-sucedidos do Apple Pay e criamos alertas SMS e IVR com um limite diferente de zero (j√° que alguns pagamentos malsucedidos s√£o considerados normais pelo servi√ßo; por exemplo, se um cliente n√£o tem dinheiro em sua conta ou o cart√£o de cr√©dito dela est√° bloqueado).  Desde aquele momento, descobrir√≠amos imediatamente a passagem do limiar.  Se uma nova vers√£o causar algum problema no processamento do Apple Pay, descobriremos isso imediatamente devido ao monitoramento e reverter√° a vers√£o em 3 minutos (o processo de revers√£o manual √© descrito em um dos artigos anteriores).  Portanto, costumava ser 45 minutos de inatividade parcial e agora s√£o 3 minutos.  Lucro! <br><br><h4>  1.2  Outros exemplos </h4><br>  Um erro na lista de pedidos.  Implementamos uma lista de otimiza√ß√£o de pedidos no aplicativo de driver.  O c√≥digo teve um erro.  Como resultado, √†s vezes os motoristas viam a lista de pedidos vazia.  Descobrimos esse bug por acaso: um dos engenheiros estava brincando com o aplicativo do driver e nos deparamos com esse problema.  Identificamos rapidamente a vers√£o ruim e ela foi revertida imediatamente.  Consequentemente, criamos um gr√°fico de um n√∫mero m√©dio de pedidos na lista com base nas informa√ß√µes do banco de dados.  Em seguida, analisamos este gr√°fico retrospectivamente m√™s a m√™s.  Percebemos uma ravina recente causada por esse bug e criamos um alerta de SMS por meio de uma consulta SQL.  Ele cria esse gr√°fico quando um n√∫mero m√©dio de pedidos na lista ultrapassa o limite inferior que foi definido com base no m√≠nimo para o m√™s atual. <br><br>  Um bug no cachback.  Est√°vamos alterando a l√≥gica de distribui√ß√£o de cashback do usu√°rio.  Entre outras coisas, enviamos para o grupo errado de clientes.  O problema foi resolvido, o gr√°fico de reembolso foi criado;  vimos um aumento dr√°stico e tamb√©m notamos que isso nunca havia acontecido antes e criamos um alerta por SMS com um limite apropriado. <br><br>  Mais uma vez um erro nos pagamentos.  O novo lan√ßamento causou o erro - levaria uma eternidade para fazer um pedido, o pagamento com cart√£o n√£o funcionou, os motoristas solicitaram que os clientes pagassem em dinheiro.  Descobrimos o problema por meio de reclama√ß√µes de call center.  Implementamos uma corre√ß√£o e criamos um alerta para o hor√°rio de fechamento de pedidos com limites, descobertos por meio da an√°lise de gr√°ficos hist√≥ricos. <br><br>  Como voc√™ pode ver, estamos usando a mesma abordagem para lidar com todos os incidentes desse tipo: <br><br><ol><li>  Descobrimos um problema. </li><li>  N√≥s solucionamos o problema e encontramos um erro no c√≥digo. </li><li>  N√≥s consertamos isso. </li><li>  N√≥s descobrimos os rastreamentos no banco de dados (tamb√©m podem ser encontrados nos logs do servidor da Web ou no Kibana) que podem apontar para os sinais do problema. </li><li>  Constru√≠mos um gr√°fico desses tra√ßos. </li><li>  Voltamos no tempo e observamos os altos e baixos do gr√°fico. </li><li>  Selecionamos um bom limite para um alerta. </li><li>  Quando o problema surge novamente, n√≥s o descobrimos imediatamente atrav√©s de um alerta por SMS. </li></ol><br>  O que h√° de bom nesse m√©todo: um gr√°fico e um alerta resolvem todo o grande grupo de problemas (exemplos de grupos de problemas: pedidos n√£o podem ser fechados, b√¥nus extras, pagamentos do Apple Pay n√£o s√£o processados ‚Äã‚Äãetc.) <br><br>  Eventualmente, implementamos alertas e monitoramento para todos os grandes erros como parte de nossa cultura de engenharia.  Para n√£o perder essa cultura, formalizamos um pouco.  Come√ßamos a nos for√ßar a criar um relat√≥rio para cada interrup√ß√£o.  O relat√≥rio √© um formul√°rio preenchido com respostas para as seguintes perguntas: causa raiz, como a corrigimos, impacto nos neg√≥cios, sugest√µes.  Todos os campos s√£o de preenchimento obrigat√≥rio.  Ent√£o, tivemos que concluir se gostamos ou n√£o.  Essa mudan√ßa de processo foi obviamente escrita em fazer e n√£o fazer. <br><br><h2>  2. Kotan </h2><br>  Nosso n√≠vel de automa√ß√£o de processos estava aumentando e decidimos que era hora de criar uma interface da web que mostrasse o estado atual do processo de desenvolvimento.  Chamamos essa interface da web de "Kotan" (da palavra russa "roll", "roll out" :-) <br><br>  "Kotan" tem a seguinte funcionalidade: <br><br>  <b>Lista de incidentes</b> .  Ele cont√©m a lista de todos os alertas anteriores - o que exigiu uma rea√ß√£o humana imediata.  Para cada incidente, registramos a hora em que come√ßou, a hora em que acabou (se j√° acabou), o link para um relat√≥rio (se o incidente acabou e h√° um relat√≥rio) e o link do guia de alerta para ver que tipo de alerta esse incidente pertence a. <br><br>  <b>O diret√≥rio de alertas</b> .  Esta √© praticamente uma lista de todos os alertas.  Para deixar mais claro, a diferen√ßa entre um alerta e um incidente √© a seguinte: o alerta √© como uma classe, enquanto o incidente - √© um objeto.  Por exemplo, "n√∫mero de 500 erros √© maior que 1" √© o alerta.  E "n√∫mero de 500 erros √© maior que 1 e eles aconteceram nesta data, neste momento, duraram tanto tempo" - √© um incidente.  Todo alerta √© adicionado ao sistema manualmente atrav√©s do processo descrito acima, ap√≥s a resolu√ß√£o de um problema espec√≠fico que nunca foi detectado pelo sistema de alerta.  Essa abordagem iterativa garante um baixo risco de alertas falsos positivos (que n√£o requerem a√ß√£o).  O diret√≥rio cont√©m um hist√≥rico completo do relat√≥rio para todos os tipos de alerta;  que ajuda a diagnosticar um problema mais rapidamente: voc√™ recebe um alerta, acessa "Kotan", clica no diret√≥rio, verifica todo o hist√≥rico e tem uma id√©ia de onde mergulhar.  A chave para a solu√ß√£o de problemas bem-sucedida √© ter todas as informa√ß√µes em m√£os.  O link para alertar o c√≥digo-fonte (para saber com certeza sobre qual situa√ß√£o esse alerta indica).  Uma descri√ß√£o escrita dos melhores m√©todos atuais para combater esse alerta. <br><br>  <b>Relat√≥rios</b>  Estes s√£o todos os relat√≥rios da hist√≥ria.  Todo relat√≥rio possui links para todos os incidentes aos quais est√° associado (√†s vezes os incidentes ocorrem em grupos; a causa raiz √© a mesma e criamos um relat√≥rio para todo o grupo), a data em que este relat√≥rio foi gravado, o sinalizador de confirma√ß√£o da solu√ß√£o do problema e a maioria importante: a causa raiz, como foi corrigida, o impacto nos neg√≥cios, as conclus√µes. <br><br>  <b>Lista de t√≥picos</b> .  Todo take-away tem uma nota informando se foi implementado, a implementa√ß√£o ainda est√° chegando ou n√£o √© necess√°ria (com uma explica√ß√£o do por que n√£o). <br><br><h2>  3. O que mudou no processo de desenvolvimento de software? </h2><br>  Um componente cr√≠tico da melhoria da disponibilidade √© um processo de desenvolvimento de software.  O processo est√° mudando constantemente.  O objetivo de tais mudan√ßas √© diminuir a chance de incidentes.  As decis√µes para alterar o processo n√£o devem ser tomadas abstratamente, mas devem ser baseadas em experi√™ncias, fatos e n√∫meros.  O processo n√£o deve ser constru√≠do direcionalmente para baixo, mas de baixo para cima, com a participa√ß√£o ativa de todos os membros da equipe, uma vez que muitos chefes de toda a equipe s√£o melhores que um chefe de gerente.  O processo deve ser seguido e monitorado;  caso contr√°rio, n√£o faz sentido t√™-lo.  Os membros da equipe devem se corrigir em caso de diverg√™ncia: quem mais faria isso por eles?  Deve haver automa√ß√£o m√°xima cuidando das principais fun√ß√µes, pois um humano comete erros constantemente, principalmente no trabalho criativo. <br><br>  Para garantir que cada incidente tenha esclarecimentos, fizemos o seguinte: <br><br><ul><li>  Todo alerta bloqueia automaticamente os lan√ßamentos. </li><li>  Quando recebemos um alerta de fechamento (uma mensagem de texto informando que o incidente terminou), n√£o desbloqueamos as libera√ß√µes imediatamente, mas, em vez disso, somos oferecidos a criar um relat√≥rio sobre acidente. </li><li>  Um relat√≥rio deve conter as seguintes informa√ß√µes: a causa raiz de um acidente, como foi corrigido, o impacto nos neg√≥cios, as conclus√µes. </li><li>  O relat√≥rio √© escrito pela equipe que solucionou o acidente.  Aqueles armados com as informa√ß√µes completas sobre o acidente. </li><li>  As libera√ß√µes s√£o bloqueadas automaticamente at√© que esse relat√≥rio seja criado e aprovado.  Isso motiva a equipe a se concentrar rapidamente e criar um relat√≥rio logo ap√≥s a corre√ß√£o de um acidente. </li><li>  O relat√≥rio deve ser aprovado por algu√©m que n√£o faz parte da equipe, para garantir que o relat√≥rio contenha todas as informa√ß√µes necess√°rias para entend√™-lo. </li></ul><br>  Ao fazer isso, conseguimos, por um lado, autodisciplina ao salvar cada incidente na hist√≥ria e, por outro, fornecemos um controle automatizado.  Agora √© imposs√≠vel n√£o tirar conclus√µes ou n√£o escrever um relat√≥rio. <br><br><h2>  4. Em vez de um ep√≠logo </h2><br>  No lugar de um ep√≠logo, deixe-me resumir rapidamente o que mudamos no processo de desenvolvimento de software para diminuir v√°rias viagens perdidas. <br><br><div class="scrollable-table"><table><tbody><tr><th>  O que n√≥s mudamos? <br></th><th>  Por que n√≥s mudamos isso? <br></th></tr><tr><td>  Come√ßamos a manter o registro de acidentes. <br></td><td>  Ter takeaways e evitar futuros acidentes. <br></td></tr><tr><td>  Criamos um post-mortem para cada grande interrup√ß√£o (aquela com muitas viagens perdidas). <br></td><td>  Para saber como solucionar rapidamente e corrigir essas interrup√ß√µes no futuro. <br></td></tr><tr><td>  Criamos os arquivos do Do e Dont. <br></td><td>  Compartilhar as pepitas de sabedoria com todos os engenheiros. <br></td></tr><tr><td>  Apenas uma vers√£o a cada cinco minutos. <br></td><td>  Para reduzir a dura√ß√£o da solu√ß√£o de problemas. <br></td></tr><tr><td>  Primeiro, implantamos o c√≥digo em um servidor Web de baixa prioridade e somente ent√£o - em todos os outros. <br></td><td>  Reduzir o impacto de uma vers√£o ruim. <br></td></tr><tr><td>  Revers√£o automatizada de vers√£o ruim. <br></td><td>  Reduzir o impacto de uma vers√£o ruim. <br></td></tr><tr><td>  Nenhuma implanta√ß√£o durante uma interrup√ß√£o. <br></td><td>  Para acelerar a solu√ß√£o de problemas. <br></td></tr><tr><td>  Escrevemos sobre lan√ßamentos e acidentes em bate-papo em grupo. <br></td><td>  Para acelerar a solu√ß√£o de problemas. <br></td></tr><tr><td>  Monitoramos os gr√°ficos por 3 minutos ap√≥s cada vers√£o. <br></td><td>  Para acelerar a solu√ß√£o de problemas. <br></td></tr><tr><td>  Alertas por SMS e URA sobre problemas. <br></td><td>  Para acelerar a solu√ß√£o de problemas. <br></td></tr><tr><td>  Todo bug (especialmente um grande) √© seguido por monitoramento e alerta. <br></td><td>  Para acelerar a solu√ß√£o de problemas da situa√ß√£o semelhante em um futuro. <br></td></tr><tr><td>  Revis√£o de otimiza√ß√£o de c√≥digo. <br></td><td>  Reduzir a chance de acidentes devido √† sobrecarga de bancos de dados. <br></td></tr><tr><td>  Otimiza√ß√£o regular de c√≥digo (com o MySQL slow.log como entrada). <br></td><td>  Reduzir v√°rios acidentes devido a "ovos de P√°scoa". <br></td></tr><tr><td>  Todo acidente deve ter um take-away. <br></td><td>  Reduz a chance de um acidente no futuro. <br></td></tr><tr><td>  Todo acidente deve ter um alerta. <br></td><td>  Reduz a dura√ß√£o da solu√ß√£o de problemas e da corre√ß√£o desses acidentes no futuro. <br></td></tr><tr><td>  Bloqueio automatizado de novos lan√ßamentos ap√≥s um acidente antes que um relat√≥rio seja escrito e aprovado. <br></td><td>  Aumenta a chance de ter as devidas sugest√µes, reduzindo assim a chance de tais acidentes no futuro. <br></td></tr><tr><td>  "Kotan" - ferramenta de aprimoramento de servi√ßo automatizado. <br></td><td>  Reduz a dura√ß√£o das interrup√ß√µes;  reduz a chance de ocorr√™ncia de interrup√ß√µes. <br></td></tr><tr><td>  Diret√≥rio de incidentes. <br></td><td>  Reduz a dura√ß√£o da solu√ß√£o de problemas <br></td></tr></tbody></table></div><br>  Obrigado pela leitura at√© o fim.  Boa sorte para o seu neg√≥cio!  Desejo-lhe menos pedidos perdidos, transa√ß√µes, compras, viagens e tudo o que √© crucial para voc√™! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt450994/">https://habr.com/ru/post/pt450994/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt450984/index.html">Convidamos voc√™ para o segundo Camunda BPM Meetup Raiffeisenbank UPD Broadcast</a></li>
<li><a href="../pt450986/index.html">Nomes longos s√£o muito longos</a></li>
<li><a href="../pt450988/index.html">Atalhos de JavaScript: um guia b√°sico</a></li>
<li><a href="../pt450990/index.html">Ponte do mundo .NET para o mundo JavaScript</a></li>
<li><a href="../pt450992/index.html">Como baixar JDK 12? Explica√ß√£o de 7 caracteres</a></li>
<li><a href="../pt450996/index.html">Estruturas de jogos: tend√™ncias do JavaScript em 2019</a></li>
<li><a href="../pt450998/index.html">Uma breve hist√≥ria da texturiza√ß√£o 3D em jogos</a></li>
<li><a href="../pt451002/index.html">Conjunto de computador personalizado, parte 1</a></li>
<li><a href="../pt451004/index.html">Tecnosfera. Curso de palestra ‚ÄúGerenciamento de projetos e produtos de TI‚Äù</a></li>
<li><a href="../pt451006/index.html">Resumo de eventos para profissionais de RH na √°rea de TI de maio de 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>