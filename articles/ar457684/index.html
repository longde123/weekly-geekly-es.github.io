<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍠 🤙🏽 ⏯️ خبرة في دمج Atol cash desk مع تجارة CRM الخاصة 👇🏾 👳🏿 🈺</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="حول شباك التذاكر على الإنترنت مؤخرًا ، الإثارة الوحشية ، في 1 يوليو 2019 ، ينتهي التأجيل الأخير ، لذلك اضطررت إلى التعامل مع هذه المشكلة. لا يمكن لأول...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>خبرة في دمج Atol cash desk مع تجارة CRM الخاصة</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457684/" style=";text-align:right;direction:rtl">  حول شباك التذاكر على الإنترنت مؤخرًا ، الإثارة الوحشية ، في 1 يوليو 2019 ، ينتهي التأجيل الأخير ، لذلك اضطررت إلى التعامل مع هذه المشكلة.  لا يمكن لأولئك الذين لديهم 1C أو أي نظام آخر أن يجهدوا ، لكن إذا كان لديك نظام مكتوب ذاتيًا ، فإن التكامل مع سجلات النقد عبر الإنترنت يقع أيضًا على عاتقك. <br><br>  تجربتي مفيدة للتكامل مع مكاتب Atol النقدية في وضع تبادل بيانات الشبكة ، يمكن للبرنامج إرسال البيانات إلى خادم الويب Atol على المستضيف المحلي وعلى الشبكة المحلية ، ويمكنك إرسالها حتى من متصفح AJAX ، حتى من الخادم عبر CURL ، وبالتالي ، بغض النظر عن اللغة المكتوبة في برنامج شركتك ، فكل شيء متعدد المنصات. <br><a name="habracut"></a><br>  لقد واجهت مكتب التذاكر في Atol 30f - إنه آلة كاتبة بسيطة بها صندوق أسود (FN) ، يكون الأمر صحيحًا تمامًا عندما يكون كل منطق الطلب على برامج خارجية ، وليس على البرنامج المدمج في أمين الصندوق.  بالإضافة إلى ذلك ، تعتبر الأجهزة من هذا النوع غير مكلفة نسبيًا ، مقارنةً بنظيراتها العاملة بنظام أندرويد. <br><br>  أود أيضًا أن أشير إلى أن "المتخصصين" في بعض الشركات المشاركة في الدعم لا يعرفون مطلقًا أن Atoll مع الإصدار 10 يحتوي على خادم ويب مضمن في برنامج التشغيل الذي يقبل وظائف JSON ، علاوة على ذلك ، يمكن أيضًا تثبيت برنامج التشغيل هذا على نظام تشغيل linux من خلال عدد الحلول الجاهزة على التوت ، يمكنني أن أفترض أنه يمكن أيضًا تثبيتها هناك ، عند توزيع الإصدار العاشر من برنامج التشغيل ، يوجد مثبت الذراع. <br><br>  المخطط المخطط يشبه هذا - هناك CRM يتم تشغيله على الخادم على الشبكة المحلية ، ويتم فتحه من المتصفحات ، وسيتم إرسال الشيكات من جانب الخادم إلى PHP من خلال الضفيرة وطباعتها في السجل النقدي.  ومكتب النقدية نفسه متصل بأي كمبيوتر على Windows على نفس الشبكة. <br><br>  يقولون أنه إذا لم تقم بتنشيط أمين الصندوق ، فيمكنه العمل في وضع الطابعة وطباعة أن الشيك غير صالح ، لكني لم أتمكن من التحقق منه ، كان علي أن أقوم بمبيعات وعوائد بنس. <br><br>  يتم تنزيل برنامج تشغيل الإصدار العاشر من <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">هنا</a> . <br><br>  قبل التثبيت ، ستحتاج إلى تثبيت <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Java</a> بنفس عمق البت مثل برنامج التشغيل ، وإلا فلن يتوفر خادم الويب لخانة الاختيار ، إذا قمت بتثبيت برنامج تشغيل KKT 64 بت ، ثم Java x64. <br><br>  يبدو أنك تحتاج منطقياً إلى تثبيت برنامج تشغيل 64 بت على نظام 64 بت ، لكن بعض البرامج ذات 32 بت لن تكون قادرة على التعامل معها (مثل هذا ينطبق على 1C إذا كان 32 بت). <br><br><img src="https://habrastorage.org/webt/nf/fn/uk/nffnukvhkzk3za8vpcrn567wygi.png"><br><br>  في نهاية التثبيت ، توجد علامة اختيار - لتكوين خادم الويب ، إذا لم يكن مثبتًا ، فأنت بحاجة إلى الانتقال إلى المستعرض على <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">127.0.0.1</a> : 16732 / الإعدادات ، حدد مربع "تنشيط الخادم" وحفظه. <br><br><img src="https://habrastorage.org/webt/gv/fm/9l/gvfm9lfbrzxyntshlyhn7fmx-pc.png"><br><br><img src="https://habrastorage.org/webt/dy/so/pq/dysopqgomkepetfvn-de5vgdj3q.png"><br><br>  بعد ذلك ، تحتاج إلى إعادة تشغيل الخادم من خلال START-&gt; ATOL-&gt; إعادة التشغيل ... <br><br>  أريد أيضًا أن أحذرك فورًا أنه في حالة بدء تشغيل خادم الويب ، فلن تتمكن التطبيقات المحلية من الوصول إلى CCP ، وأكدح لفترة طويلة ، وقم بتثبيت برنامج التشغيل ، وقم بتشغيل اختبار برنامج تشغيل Cct ، وأخبرني أن المنفذ مشغول وهذا هو ، اتصلت بالدعم الفني للبائع المحلي ، وهناك قالوا إننا لا نعرف ما يجب القيام به ، ثم قمت بتحميل جهاز الكمبيوتر بعشر مرات ، وقمت بإعادة تثبيت برنامج التشغيل ، ولا شيء يساعد. <br><br>  بشكل عام ، بعد تنشيط الخادم وإعادة تشغيله ، وقبل أن تقوم بإيقاف تشغيل الخادم وتحقق من طباعة النص العادي من خلال الأداة المساعدة المتوفرة ، أو يمكنك فقط التحقق من الاتصال ، يمكنك المتابعة. <br><br>  لا تحتوي خدمة الويب هذه على أي حماية بكلمة مرور ، لذلك تحتاج إلى تكوين جدار حماية Windows أو البرامج الأخرى على الفور حتى يتمكن فقط أجهزة الكمبيوتر الضرورية من الوصول إلى المنفذ 16732 ، في موقفي هذا هو الخادم الذي يعمل عليه CRM. <br><br>  <b>التواصل مع خدمة الويب هو موضوع منفصل بشكل عام ومثير للاهتمام ...</b> <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  توليد uuid فريدة لهذا المنصب </li><li style=";text-align:right;direction:rtl">  نرسل المهمة باستخدام طريقة POST </li><li style=";text-align:right;direction:rtl">  نحن نتعطل في خدمة الويب ، في انتظار نتيجة المهمة من خلال UUID ، قد يكون لدينا لبضع ثوان حالة انتظار ، أو قد يحدث خطأ إذا حدث خطأ ما في الطلب ... </li></ol><br>  وبعد ذلك ، سأقدم نسخة صالحة للعمل ، وهي مناسبة للحالات التي يكون فيها الدفع طريقة واحدة فقط ، وليس جزءًا كبيرًا من النقد وجزء غير نقدي ، ويستخدم أيضًا نظام الضريبة الافتراضي ، ولا يتم حساب ضريبة القيمة المضافة بعد ، أردت إضافة الرمز ، ثم نشره ، ولكن أعتقد أنه لا يزال هناك أشخاص يحتاجون إلى هذه المعلومات قبل 1 تموز (يوليو) من بعد.  يجب أن أقول على الفور أن الفصل يحتاج إلى تحسين ، والكثير من الأخطاء ، لا معالجة للخطأ ، لقد تم كل شيء في بضع ساعات دون مراعاة قراءة الوثائق ، وهذا الرمز هو أكثر كمثال وأنا أنصحك بدراسة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الوثائق</a> بتفصيل كبير وتكييفها مع العمليات المحددة الخاصة بك. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">كود php كمثال للعمل مع api (يستخدم للأغراض التعليمية فقط)</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">Class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AtolWebDriver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $addr=<span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>,$port=<span class="hljs-string"><span class="hljs-string">"16732"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $timeout = <span class="hljs-number"><span class="hljs-number">30</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  public $operator; function __construct($addr=false,$port=false) { if ($addr!==false) $this-&gt;addr=$addr; if ($port!==false) $this-&gt;port=$port; } public function CallAPI($method, $data,$_url="/requests") { $url = "http://".$this-&gt;addr.":".$this-&gt;port.$_url; $curl = curl_init($url); curl_setopt($curl, CURLOPT_RETURNTRANSFER, true); curl_setopt($curl,CURLOPT_TIMEOUT, $this-&gt;timeout); $headers = ['Content-Type: application/json']; curl_setopt($curl,CURLOPT_HTTPHEADER, $headers); curl_setopt($curl, CURLOPT_CUSTOMREQUEST, $method); curl_setopt($curl, CURLOPT_POSTFIELDS, json_encode($data)); $resp = curl_exec($curl); $data = json_decode($resp,1); $code = curl_getinfo($curl, CURLINFO_HTTP_CODE); curl_close($curl); $res= [$data,$code,$resp]; print_r($res); return $res; } //   public function get_res($uuid) { $ready = false; $cnt=0; $res_url = '/requests/'.$uuid; while (!$ready &amp;&amp; ++$cnt&lt;60) { usleep(500000); // ,     list($res,$code,$resp) = $this-&gt;CallAPI('GET',[],$res_url); $ready = ($res['results'][0]['status'] == 'ready'); if ($ready) return $res; } return false; //    } //  public function add_req($uuid,$req) { return $this-&gt;CallAPI('POST', ['uuid'=&gt;$uuid,'request'=&gt;$req]); } //  id   public function gen_uuid() { return exec('uuidgen -r'); } //      public function atol_task($type,$req=[]) { $req['type'] = $type; $uuid = $this-&gt;gen_uuid(); $req = $this-&gt;add_req($uuid,$req); if ($req[1]!='201') return false; //  $res = $this-&gt;get_res($uuid); //  if ($res===false || !isset($res['results'][0])) return false; return $res['results'][0]; } /*    */ //  public function get_shift_status() { $res = $this-&gt;atol_task('getShiftStatus'); if ($res===false) return false; //closed / opened / expired return $res['result']['shiftStatus']['state']; } //  public function open_shift() { $status = $this-&gt;get_shift_status(); //e ,    if ($status=="expired") $this-&gt;close_shift(); if ($status=="opened") return "    "; $res = $this-&gt;atol_task('openShift',['operator'=&gt;$this-&gt;operator]); } //  public function close_shift() { $status = $this-&gt;get_shift_status(); if ($status=="closed") return "    "; $res = $this-&gt;atol_task('closeShift',['operator'=&gt;$this-&gt;operator]); } public function items_prepare($items) { $res_items = []; $summ = 0; while ($item = array_shift($items)) { $res_item = $item; if (!isset($item['type'])) $res_item['type']="position"; if (isset($item['price']) &amp;&amp; isset($item['quantity'])) { $res_item['amount'] = $item['price']*$item['quantity']; $res_item['tax'] = ['type'=&gt;'none']; $summ+=$res_item['amount']; } $res_items[] = $res_item; } return [$res_items,$summ]; } // sell,  sellReturn public function fiskal($type_op="sell",$items,$pay_type="cash") { $data = []; $data['operator'] = $this-&gt;operator; $data['payments'] = []; list($data['items'],$summ) = $this-&gt;items_prepare($items); //+++       $data['payments'][] = ['type'=&gt;$pay_type,'sum'=&gt;$summ]; $res = $this-&gt;atol_task($type_op,$data); } } //  ip   web-  ,      $atol = new AtolWebDriver('192.168.100.10'); //    $atol-&gt;operator = ['name'=&gt;'.']; //       $items = []; $items[] = ['name'=&gt;' ','price'=&gt;0.7,'quantity'=&gt;1]; $items[] = ['name'=&gt;' ','price'=&gt;0.4,'quantity'=&gt;1]; //  $atol-&gt;open_shift(); //  $atol-&gt;fiskal("sell",$items); sleep(10); // ,     //     , ..    $atol-&gt;fiskal("sellReturn",$items); //     sleep(20); // ,   $atol-&gt;close_shift();</span></span></code> </pre> <br></div></div><br>  هناك بعض العيوب التي سأصلحها هنا <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  تقريب الكسور عند حساب المبالغ ، تحتاج إلى التقريب إلى سنتات ، وإلا يمكنك الحصول على 1.000000001 أو 0.999999999 </li><li style=";text-align:right;direction:rtl">  مع الإملاء الصحيح لبقية منطق البرنامج ، لا يحدث هذا عادةً ، لكن خلال الاختبارات ، أدركت حقيقة أن المهمة أرجعت نتيجة خطأ ، وكنت أنتظر الاستعداد </li></ol><br>  حسنًا ، أثناء عملية التنفيذ ، أخشى أن ألحق الكثير من الأخطاء ، على سبيل المثال ، إذا كانت المهمة معلقة لفترة طويلة في حالة الانتظار ، فمن الأفضل إزالتها من قائمة الانتظار ، وإلا فإن المهام اللاحقة ستتوقف لعدة دقائق ، لقد اشتعلت خللًا مرة واحدة ، ولم أكن آمل أن تطبع وهنا أجلس ، لكنه قفز وطبعت على الفور اثنين من الشيكات في صف واحد أرسلت في وقت سابق ... <br><br>  بشكل عام ، من الممكن جمع عمليات الاستحواذ من الموقع في المستقبل ، إذا لم يكن لديهم شيكات عبر الإنترنت ، حتى تقرر أي شيء يمكن الاستحواذ عليه.  لكن الحل ، على الأرجح ، كالفكرة عن حل ما ، سيوضح الوقت كيف سيتجذر هذا الصندوق. <br><br>  <b>تحذير</b> ، بالنسبة لأولئك الذين قرأوا المقال عن غير قصد وليسوا مؤهلين جدًا في مسألة الأمان - <b>خدمة الويب هذه لا تحتوي على تشفير (https) ، لا تحصل على إذن</b> ، حتى لو تم استخدامه فقط على الشبكة المحلية - قم بتكوين الحماية للوصول إلى المنفذ. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar457684/">https://habr.com/ru/post/ar457684/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar457652/index.html">كيفية تنظيم 120،000 صورة وحتى لا يكون هناك tryndets ، مع مستويات وصول مختلفة ، للفريق</a></li>
<li><a href="../ar457658/index.html">الاتحاد MS-11: حادث لم يكن موجودا؟</a></li>
<li><a href="../ar457660/index.html">كيفية توفير 58 دولارًا في 5 دقائق: دعنا نستخدم أسعارًا مختلفة في كل بلد ضد المسوقين</a></li>
<li><a href="../ar457666/index.html">بدائل التوت بي</a></li>
<li><a href="../ar457680/index.html">الحد الأدنى من تثبيت CentOS / Fedora / RedHat</a></li>
<li><a href="../ar457686/index.html">كيف يجمع سبيربنك الموافقة على معالجة القياسات الحيوية</a></li>
<li><a href="../ar457690/index.html">فيديو بجنون العظمة من Yandex.Money metap</a></li>
<li><a href="../ar457692/index.html">تأملات في أنظمة الفواتير الوطنية القياسية و NB-Fi</a></li>
<li><a href="../ar457694/index.html">مخاطر استخدام ثوابت متعددة الشخصيات</a></li>
<li><a href="../ar457696/index.html">مخاطر استخدام ثوابت متعددة الشخصيات</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>