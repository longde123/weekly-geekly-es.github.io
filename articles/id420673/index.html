<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßõüèº üë∞üèø ü•ò Docker untuk Symfony 4 - dari LAN hingga produksi ü§üüèΩ üßë‚Äçü§ù‚Äçüßë üëßüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prasejarah 
 Suatu hari saya perlu menggunakan lingkungan pengembangan untuk proyek saya. Vagrant sudah muak dengan itu dan ingin memiliki lingkungan ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Docker untuk Symfony 4 - dari LAN hingga produksi</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420673/"><h2>  Prasejarah </h2><br>  Suatu hari saya perlu menggunakan lingkungan pengembangan untuk proyek saya.  Vagrant sudah muak dengan itu dan ingin memiliki lingkungan pengembangan tunggal untuk semua peserta proyek yang akan identik dengan server produksi.  Karena itu, setelah mendengarkan informasi tentang buruh pelabuhan hipster, saya memutuskan untuk mulai menanganinya.  Selanjutnya, saya akan mencoba menjelaskan sedetail mungkin semua langkah mulai dari memasang buruh pelabuhan di LAN hingga menggunakan produk ke KVM. <br><br>  <b>Tumpukan teknologi asli:</b> <br><br>  - buruh pelabuhan <br>  - symfony 4 <br>  - nginx <br>  - php-fpm <br>  - postgresql <br>  - Pencarian elastics <br>  - rabbitmq <br>  - Jenkins <br><br>  <b>Besi:</b> <br><br>  - laptop di bawah OS Ubuntu 16.04 <br>  - server produksi pada hosting KVM <br><br>  <i>Mengapa, selain tumpukan teknologi, saya juga mendaftarkan tumpukan besi?</i> <br><br>  Jika Anda belum pernah bekerja dengan buruh pelabuhan, maka Anda mungkin mengalami sejumlah masalah yang terkait dengan perangkat keras, sistem operasi laptop Anda, atau jenis virtualisasi hosting. <br><br>  Aspek pertama dan mungkin yang paling penting ketika mulai bekerja dengan buruh pelabuhan adalah sistem operasi laptop Anda.  Cara termudah untuk bekerja dengan buruh pelabuhan adalah pada sistem linux.  Jika Anda bekerja pada Windows atau Mac, maka Anda akan memiliki 100% kesulitan, tetapi kesulitan ini tidak akan menjadi kritis dan jika Anda ingin "google" bagaimana ini diperbaiki, tidak akan ada masalah. <br><br>  Pertanyaan kedua adalah hosting.  Mengapa Hosting diperlukan dengan tipe virtualisasi KVM?  Alasannya adalah bahwa virtualisasi VPS sangat berbeda dari KVM dan Anda tidak akan dapat menginstal buruh pelabuhan di VPS, karena VPS mengalokasikan sumber daya server secara dinamis. <br><br>  Subtotal: untuk permulaan tercepat pada buruh pelabuhan, paling masuk akal untuk memilih Ubuntu sebagai OS lokal dan hosting KVM (atau server Anda sendiri).  Selanjutnya, ceritanya akan bergantung pada dua komponen ini. <br><a name="habracut"></a><br><h2>  Docker-compose untuk LAN </h2><br><h3>  Instalasi </h3><br>  Pertama, Anda perlu menginstal buruh pelabuhan itu sendiri secara lokal.  Anda dapat melihat instruksi instalasi pada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tautan</a> situs web resmi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ke dokumentasi resmi untuk ubuntu</a> (Anda perlu menginstal buruh pelabuhan dan pekerja menulis), atau dengan menjalankan perintah di konsol: <br><br><pre><code class="bash hljs">curl -sSl https://get.docker.com/ | sh</code> </pre> <br>  Perintah ini akan menginstal docker dan docker-compose.  Setelah itu, periksa versi buruh pelabuhan dengan perintah: <br><br><pre> <code class="bash hljs">docker --version</code> </pre> <br>  Saya memulai semua ini pada versi buruh pelabuhan 18.06.0-ce. <br><br>  Instalasi selesai! <br><br><h3>  Kesadaran </h3><br>  Untuk bekerja dengan sesuatu yang kurang berhasil - Anda perlu memiliki ide tentang cara kerjanya.  Jika sebelumnya Anda hanya bekerja dengan Vagrant atau sesuatu yang serupa, maka itu akan sangat tidak biasa dan tidak bisa dipahami pada awalnya, tetapi ini hanya pada awalnya. <br><br>  Saya akan mencoba menggambar analogi untuk Vagrant.  Sekarang banyak yang bisa mengatakan bahwa membandingkan Vagrant dan Docker pada dasarnya salah.  Ya, saya setuju dengan ini, tetapi saya tidak akan membandingkan mereka, saya hanya akan mencoba menyampaikan kepada para pendatang baru yang hanya bekerja dengan Vagrant, sistem kerja Docker, menarik bagi apa yang diketahui oleh para pendatang baru. <br><br>  Visi saya tentang wadah "dengan jari" adalah sebagai berikut: setiap wadah adalah dunia kecil yang terisolasi.  Setiap wadah dapat dibayangkan seolah-olah itu adalah Vagrant kecil di mana hanya 1 alat diinstal, misalnya nginx atau php.  Awalnya, wadah umumnya terisolasi dari segala sesuatu di sekitarnya, tetapi dengan manipulasi rumit, Anda dapat mengonfigurasi semuanya sehingga mereka berkomunikasi satu sama lain dan bekerja bersama.  Ini tidak berarti bahwa masing-masing wadah adalah mesin virtual yang terpisah, bukan sama sekali.  Tapi itu lebih mudah untuk pemahaman awal, seperti yang menurut saya. <br><br>  Vagrant hanya menggigit bagian dari sumber daya komputer Anda, menciptakan mesin virtual, menginstal sistem operasi di atasnya, menginstal perpustakaan, menginstal semua yang Anda tulis dalam skrip setelah naik ke atas.  Pada akhirnya, akan terlihat seperti ini: <br><br>  ‚Üí <a href="">Lihat skema</a> <br><br>  Docker, pada gilirannya, bekerja sangat berbeda.  Itu tidak membuat mesin virtual.  Docker membuat wadah (untuk saat ini, Anda dapat menganggapnya sebagai mesin mikro-virtual) dengan sistem operasi Alpine dan 1-3 pustaka yang diperlukan agar aplikasi dapat berfungsi, misalnya php atau nginx.  Pada saat yang sama, Docker tidak memblokir sumber daya sistem Anda untuk dirinya sendiri, tetapi hanya menggunakannya sesuai kebutuhan.  Pada akhirnya, untuk menggambarkannya, akan terlihat seperti ini: <br><br>  ‚Üí <a href="">Lihat skema</a> <br><br>  Setiap wadah memiliki gambar dari mana itu dibuat.  Sebagian besar gambar adalah perpanjangan dari gambar lain, misalnya, Ubuntu xenial atau Alpine atau Debian, di mana driver tambahan dan komponen lainnya digulirkan di atas. <br><br>  Gambar pertama saya adalah untuk php-fpm.  Gambar saya memperluas gambar php resmi: 7.2-fpm-alpine3.6.  Artinya, pada dasarnya, ini mengambil gambar resmi dan memberikan komponen yang saya butuhkan, misalnya, pdo_pgsql, imagick, zip, dan sebagainya.  Dengan demikian, Anda dapat membuat gambar yang Anda butuhkan.  Jika mau, Anda bisa menggunakannya di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Dengan penciptaan gambar, semuanya cukup sederhana menurut saya jika mereka dibuat berdasarkan xenial misalnya, tetapi mereka memberikan sedikit wasir jika mereka dibuat berdasarkan Alpine.  Sebelum mulai bekerja dengan buruh pelabuhan, saya pada dasarnya tidak mendengar tentang Alpine, karena Vagrant selalu bekerja untuk saya di bawah Ubuntu xenial.  Alpine adalah sistem operasi Linux kosong, di mana pada dasarnya tidak ada sama sekali (minimum ekstrim).  Oleh karena itu, pada awalnya sangat tidak nyaman untuk bekerja dengannya, karena misalnya tidak ada instalasi apt-get yang sama (yang biasa Anda gunakan), tetapi hanya ada penambahan apk dan paket paket yang tidak cukup waras.  Nilai tambah besar Alpine adalah bobotnya, misalnya, jika Xenial menimbang (secara abstrak) 500 kantong, maka Alpine (secara abstrak) adalah sekitar 78 kantong.  Apa yang bahkan mempengaruhi ini?  Dan ini mempengaruhi kecepatan build dan bobot akhir semua gambar yang akan disimpan di server Anda pada akhirnya.  Katakanlah Anda memiliki 5 wadah berbeda dan semuanya berdasarkan xenial, berat totalnya akan lebih dari 2,5 gigs, dan alpine - sekitar 500 kantong saja.  Karena itu, idealnya, kita harus berusaha untuk memastikan bahwa wadah setipis mungkin.  (Tautan yang berguna untuk menginstal paket dalam paket Alpine - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Alpine</a> ). <br><br>  Di mana-mana di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">hub buruh pelabuhan mereka</a> menulis cara meluncurkan wadah menggunakan perintah <code>docker run</code> , dan untuk beberapa alasan mereka tidak menulis bagaimana itu dapat diluncurkan melalui komposisi buruh pelabuhan, dan melalui komposisi buruh pelabuhan itu akan memulai sebagian besar waktu, karena sangat sedikit perburuan secara manual mulai semua wadah, jaring, port terbuka dan banyak lagi.  Susunan Docker atas nama pengguna hanya terlihat seperti file yaml dengan pengaturan.  Ini termasuk deskripsi dari masing-masing layanan yang harus dimulai.  Bangunan saya untuk lingkungan lokal adalah sebagai berikut: <br><br><pre> <code class="hljs powershell">version: <span class="hljs-string"><span class="hljs-string">'3.1'</span></span> services: php<span class="hljs-literal"><span class="hljs-literal">-fpm</span></span>: image: otezvikentiy/php7.<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-literal"><span class="hljs-literal">-fpm</span></span>:<span class="hljs-number"><span class="hljs-number">0.0</span></span>.<span class="hljs-number"><span class="hljs-number">11</span></span> ports: - <span class="hljs-string"><span class="hljs-string">'9000:9000'</span></span> volumes: - ../:/app working_dir: /app container_name: <span class="hljs-string"><span class="hljs-string">'php-fpm'</span></span> nginx: image: nginx:<span class="hljs-number"><span class="hljs-number">1.15</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> container_name: <span class="hljs-string"><span class="hljs-string">'nginx'</span></span> working_dir: /app ports: - <span class="hljs-string"><span class="hljs-string">'7777:80'</span></span> volumes: - ../:/app - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf postgres: image: postgres:<span class="hljs-number"><span class="hljs-number">9.6</span></span> ports: - <span class="hljs-string"><span class="hljs-string">'5432:5432'</span></span> container_name: <span class="hljs-string"><span class="hljs-string">'postgresql'</span></span> working_dir: /app restart: always environment: POSTGRES_DB: <span class="hljs-string"><span class="hljs-string">'db_name'</span></span> POSTGRES_USER: <span class="hljs-string"><span class="hljs-string">'db_user'</span></span> POSTGRES_PASSWORD: <span class="hljs-string"><span class="hljs-string">'db_pass'</span></span> volumes: - ./<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>/dump:/app/dump - ./<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>/postgresql:/var/lib/postgresql/<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> rabbitmq: image: rabbitmq:<span class="hljs-number"><span class="hljs-number">3.7</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span><span class="hljs-literal"><span class="hljs-literal">-management</span></span> working_dir: /app hostname: rabbit<span class="hljs-literal"><span class="hljs-literal">-mq</span></span> container_name: <span class="hljs-string"><span class="hljs-string">'rabbit-mq'</span></span> ports: - <span class="hljs-string"><span class="hljs-string">'15672:15672'</span></span> - <span class="hljs-string"><span class="hljs-string">'5672:5672'</span></span> environment: RABBITMQ_DEFAULT_USER: user RABBITMQ_DEFAULT_PASS: password RABBITMQ_DEFAULT_VHOST: my_vhost elasticsearch: image: docker.elastic.co/elasticsearch/elasticsearch:<span class="hljs-number"><span class="hljs-number">6.3</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> container_name: <span class="hljs-string"><span class="hljs-string">'elastic-search'</span></span> environment: - discovery.type=single<span class="hljs-literal"><span class="hljs-literal">-node</span></span> - <span class="hljs-string"><span class="hljs-string">"discovery.zen.ping.unicast.hosts=elasticsearch"</span></span> - bootstrap.memory_lock=true - <span class="hljs-string"><span class="hljs-string">"ES_JAVA_OPTS=-Xms512m -Xmx512m"</span></span> ports: - <span class="hljs-number"><span class="hljs-number">9200</span></span>:<span class="hljs-number"><span class="hljs-number">9200</span></span> - <span class="hljs-number"><span class="hljs-number">9300</span></span>:<span class="hljs-number"><span class="hljs-number">9300</span></span> working_dir: /app volumes: - ../:/app - ./<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>/elasticsearch:/usr/share/elasticsearch/<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> volumes: elasticsearch: postgresql:</code> </pre><br>  docker-compose.yaml untuk SF4 adalah serangkaian layanan tertentu: nginx, php-fpm, postgresql, rabbitmq (jika Anda memerlukannya), elasticsearch (jika Anda membutuhkannya).  Untuk lingkungan setempat, ini sudah cukup.  Agar semuanya berfungsi - ada satu set minimal pengaturan, yang tanpanya tidak ada yang berfungsi.  Paling sering ini adalah gambar, volume, port, lingkungan, working_dir dan container_name.  Segala sesuatu untuk meluncurkan gambar ini atau itu dijelaskan dalam dokumentasinya di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">hub.docker.com</a> .  Tidak selalu ada deskripsi untuk komposisi buruh pelabuhan, tetapi ini tidak berarti bahwa itu tidak bekerja dengannya.  Anda hanya perlu mentransfer semua data yang masuk dari docker run command ke docker-compose dan semuanya akan berfungsi. <br><br>  Misalnya, ada gambar untuk RabbitMQ di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> .  Ketika Anda melihat INI untuk pertama kalinya, ini menimbulkan perasaan dan emosi yang campur aduk, tetapi tidak semuanya menakutkan.  Tag ditunjukkan dalam gambar ini.  Biasanya tag - mewakili gambar yang berbeda, versi aplikasi yang berbeda dengan gambar yang dapat diperluas yang berbeda.  Misalnya, tag 3.7.7-alpine berarti bahwa gambar ini lebih tipis daripada, misalnya, 3.7.7, karena didasarkan pada Alpine.  Baik dan juga di tag paling sering versi aplikasi ditunjukkan.  Saya biasanya memilih versi terbaru dan versi stabil dari aplikasi itu sendiri dan gambar alpine. <br><br>  Setelah Anda mempelajari dan memilih tag - maka sering Anda melihat sesuatu seperti ini: <br><br><pre> <code class="bash hljs">docker run -d --hostname my-rabbit --name some-rabbit -e RABBITMQ_DEFAULT_USER=user -e RABBITMQ_DEFAULT_PASS=password rabbitmq:3-management</code> </pre> <br>  Dan pikiran pertama adalah WTF?  Bagaimana cara mentransfer ini ke komposisi buruh pelabuhan? <br><br>  Semuanya sangat mudah.  Bahkan, baris ini menunjukkan semua parameter yang sama seperti pada file yaml, hanya disingkat.  Sebagai contoh, -e adalah lingkungan di mana berbagai parameter dilewatkan, mungkin juga ada entri seperti -p - ini adalah port yang disebut port di yaml.  Oleh karena itu, untuk menggunakan gambar yang tidak dikenal dengan cara yang berkualitas, Anda hanya perlu "google" buruh pelabuhan menjalankan singkatan dan menerapkan nama lengkap dalam file yaml. <br><br>  Sekarang kembali ke docker-compose.yml, yang saya kutip sebagai contoh di atas. <br><br>  Contoh ini menggunakan gambar php7.2 saya yang dibuat sebagai ekstensi untuk gambar php7.2-fpm-alpine resmi, tetapi jika Anda tidak membutuhkan begitu banyak pustaka tambahan, maka Anda dapat membangun ekstensi Anda untuk gambar resmi dan menggunakannya.  Sisa gambar untuk LAN sepenuhnya asli dan resmi. <br><br>  <b>gambar</b> - menunjukkan gambar yang akan diunduh.  Misalnya (rabbitmq: 3.7.7-management-alpine). <br><br>  <b>ports</b> - tentukan port yang akan digunakan wadah (lihat dokumentasi gambar).  Contoh port nginx adalah 80 secara default.  Karenanya, jika Anda ingin menggunakan port 80, Anda harus menentukan 80:80 di sini dan situs Anda akan tersedia di localhost.  Atau Anda dapat menentukan 7777: 80, dan kemudian situs Anda akan berada di url localhost: 7777.  Ini diperlukan agar beberapa proyek dapat digunakan pada host yang sama. <br><br>  <b>volume</b> - direktori bersama ditunjukkan di sini.  Sebagai contoh, proyek Anda terletak pada direktori ~ / projects / my-sf4-app, dan wadah php dikonfigurasikan untuk bekerja dengan direktori / app (sama dengan di / var / www / my-sf4-app).  Dengan demikian, akan lebih mudah bagi wadah untuk memiliki akses ke proyek.  Dengan demikian, dalam volume kita menulis <code>~/projects/my-sf4-app:/app</code> (lihat contoh ini di docker-compose.yml di atas (saya telah mengindikasikannya dengan cara yang relatif ../:/app)). <br><br>  Dengan demikian, folder tersebut akan dibagikan untuk wadah dan akan dapat melakukan berbagai tindakan di dalamnya seperti <code>php bin/console doctrine:migrations:migrate</code> .  Juga nyaman menggunakan direktori ini untuk menyimpan data aplikasi.  Sebagai contoh, postgresql, Anda dapat menentukan direktori untuk menyimpan data database, dan kemudian ketika Anda membuat ulang wadah, Anda tidak perlu menggulung dump atau fixture. <br><br>  <b>working_dir</b> - menunjukkan direktori kerja wadah.  Dalam hal ini, / app (atau dengan analogi dengan gelandangan / var / www / my-sf4-app). <br><br>  <b>lingkungan</b> - semua variabel untuk wadah dilewatkan di sini.  Sebagai contoh, untuk rabbitmq, nama pengguna dan kata sandi dikirimkan, untuk postgresql, nama dasar, nama pengguna, kata sandi dilewatkan. <br><br>  <b>container_name</b> adalah bidang opsional, tapi saya lebih suka menentukan, untuk kenyamanan menghubungkan ke wadah.  Jika tidak ditentukan, nama default dengan hash akan ditetapkan. <br><br>  Ini adalah parameter utama yang harus ditentukan.  Sisanya bisa opsional untuk pengaturan tambahan, atau sesuai dengan dokumentasi untuk wadah. <br><br>  Sekarang, untuk memulai semua ini, Anda perlu menjalankan perintah <code>docker-compose up -d</code> di direktori di mana file docker-compose berada. <br><br><h3>  Bagaimana dan di mana menyimpan semua ini untuk LAN? </h3><br>  Untuk LAN saya menggunakan folder buruh pelabuhan di root proyek. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pv/rg/a8/pvrga87xk7vcujz2-qwbjnqmtjk.png"></div><br>  Ini berisi folder data di mana saya menyimpan semua postgresql informasi dan elasticsearch, sehingga ketika Anda membuat ulang proyek, Anda tidak perlu menggulung perlengkapan dari awal.  Ada juga ayah nginx di mana saya menyimpan konfigurasi untuk wadah nginx lokal.  Saya menyinkronkan folder ini di docker-compose.yml dengan file dan folder yang sesuai dalam wadah.  Juga menurut saya sangat nyaman untuk menulis skrip bash untuk bekerja dengan buruh pelabuhan.  Misalnya, skrip start.sh meluncurkan wadah, lalu komposer memasang, membersihkan cache, dan bermigrasi.  Juga nyaman bagi rekan proyek, mereka tidak perlu melakukan apa pun, mereka hanya menjalankan skrip dan semuanya berfungsi. <br><br>  Contoh skrip Start.sh <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env bash green=$(tput setf 2) toend=$(tput hpa $(tput cols))$(tput cub 6) echo -n '   ?: ' read name echo "  $name!       tutmesto.ru" echo -n "$name,      ? (y/n): " read use_dump echo '    !' docker-compose up -d || exit echo -en '\n' echo -n "  ! ${green}${toend}[OK]" echo -en '\n' echo '    .' ./composer-install.sh echo -en '\n' echo -n "   ${green}${toend}[OK]" echo -en '\n' echo '     40 ,    postgres-' sleep 5 echo '  35 ...' sleep 5 echo '  30 ...' sleep 5 echo '  25 ...' sleep 5 echo '  20 ...' sleep 5 echo '  15 ...' sleep 5 echo '  10 ...' sleep 5 echo '  5 ...' sleep 5 echo ' .   postgres-        !' case "$use_dump" in y|Y) ./dump.sh echo -en '\n' echo -n "  ! ${green}${toend}[OK]" echo -en '\n' ;; *) echo "$name, ,   ! =)" ;; esac echo '    !' ./migrations-migrate.sh echo -en '\n' echo -n "  ! ${green}${toend}[OK]" echo -en '\n' echo '  !' ./php-fpm-command.sh rm -rf var/cache/* ./php-fpm-command.sh chmod 777 var/ -R ./cache-clear.sh echo -en '\n' echo -n "  ! ${green}${toend}[OK]" echo -en '\n' echo '    !' ./env.sh echo -en '\n' echo -n "   ! ${green}${toend}[OK]" echo -en '\n' echo ", $name,    !    localhost:7777  !" echo -en '\n' echo "------------------------------------------------------------------------------" echo -en '\n' echo "    :" echo "./cache-clear.sh |  symfony 4" echo "./composer.sh [command(ex. install)] |  " echo "./composer-install.sh | composer install" echo "./connect-to-php-fpm.sh |   php" echo "./console.sh [command(ex. cache:clear)] |  php bin/console" echo "./destroy.sh |  .    ." echo "./dump.sh | ,     (dump.sql)" echo "./env.sh |   " echo "./migrations-migrate.sh | " echo "./php-fpm-command.sh [command(ex. php -m)] |   php-fpm " echo "./start.sh |  ( )" echo "./stop.sh |Gracefull shutdown " echo -en '\n' echo "        :" echo "client@c.cc | QWEasd123" echo "admin@a.aa | QWEasd123" echo "moderator@m.mm | QWEasd123" echo -en '\n' echo "------------------------------------------------------------------------------" echo -en '\n' echo -en '\n' echo 'OtezVikentiy brain corporation!' echo -en '\n' echo -en '\n'</span></span></code> </pre><br>  <i>Contoh</i> skrip <i>Php-fpm-command.sh</i> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env bash cd "`dirname \"$0\"`" &amp;&amp; \ docker-compose exec -T "php-fpm" sh -c "cd /app &amp;&amp; $*"</span></span></code> </pre><br>  <i>Contoh</i> skrip <i>Connect-to-php-fpm.sh</i> <br><br><pre> <code class="bash hljs"><span class="hljs-meta"><span class="hljs-meta">#!/usr/bin/env bash docker exec -i -t --privileged php-fpm bash</span></span></code> </pre><br>  Lingkungan pengembangan lokal berakhir di sini.  Selamat, Anda bisa membagikan hasil yang sudah selesai dengan kolega Anda!  ) <br><br><h2>  Produktif </h2><br><h3>  Persiapan </h3><br>  Misalkan Anda sudah menulis sesuatu di LAN dan ingin meletakkannya di server produksi atau di server pengujian.  Anda memiliki hosting di virtualisasi KVM atau server Anda di kamar sebelah dengan AC. <br><br>  Untuk menggunakan produk atau beta - server harus memiliki sistem operasi (idealnya linux) dan buruh pelabuhan yang diinstal.  Docker dapat diinstal dengan cara yang sama seperti pada LAN, tidak ada perbedaan. <br><br>  Docker dalam produktivitas sedikit berbeda dari LAN.  Pertama, Anda tidak bisa hanya mengambil dan menentukan kata sandi dan informasi lainnya serta membuat dok.  Kedua, Anda tidak dapat menggunakan komposisi buruh pelabuhan secara langsung. <br><br>  Docker menggunakan docker swarm dan docker stack untuk produktivitas.  Jika tepat di jari, maka sistem ini hanya berbeda di perintah lain dan di dermaga buruh pelabuhan itu adalah penyeimbang beban untuk cluster (sekali lagi sedikit abstrak, tetapi akan lebih mudah untuk dipahami). <br><br>  PS: Saya menyarankan Anda untuk berlatih menyiapkan galangan buruh pelabuhan di Vagrant (tidak peduli seberapa paradoks ini terdengar).  Resep sederhana untuk pelatihan - mengambil Vagrant kosong dengan sistem operasi yang sama seperti pada produk dan mengkonfigurasinya untuk memulai. <br><br>  Untuk mengkonfigurasi docker swarm, Anda hanya perlu menjalankan beberapa perintah: <br><br><pre> <code class="bash hljs">docker swarm init --advertise-addr 192.168.***.** (ip-  ) mkdir /app (          app) chown docker /app (     ) docker stack deploy -c docker-compose.yml my-first-sf4-docker-app</code> </pre><br>  Mari kita bahas semua ini dengan sedikit lebih detail. <br><br>  <b>docker swarm init --advertise-addr</b> - meluncurkan docker swarm sendiri secara langsung dan <b>mencari-cari</b> tautan sehingga Anda bisa menghubungkan beberapa server lain ke "swarm" ini sehingga mereka bekerja di cluster. <br>  <b>mkdir / app &amp;&amp; chown ..</b> - Anda harus membuat semua direktori yang diperlukan agar buruh pelabuhan dapat bekerja terlebih dahulu sehingga selama pembuatannya tidak akan mengeluh tentang kurangnya direktori. <br>  <b>docker stack deploy -c docker-compose.yml my-first-sf4-docker-app</b> - perintah ini memulai perakitan aplikasi Anda sendiri, sebuah analog dari docker-menyusun -d hanya untuk gerombolan buruh pelabuhan. <br><br>  Untuk memulai perakitan apa pun, Anda memerlukan docker-compose.yaml yang sama, tetapi sudah sedikit dimodifikasi khusus untuk produktif / beta. <br><br><pre> <code class="hljs powershell">version: <span class="hljs-string"><span class="hljs-string">'3.1'</span></span> services: php<span class="hljs-literal"><span class="hljs-literal">-fpm</span></span>: image: otezvikentiy/php7.<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-literal"><span class="hljs-literal">-fpm</span></span>:<span class="hljs-number"><span class="hljs-number">0.0</span></span>.<span class="hljs-number"><span class="hljs-number">11</span></span> ports: - <span class="hljs-string"><span class="hljs-string">'9000:9000'</span></span> networks: - my<span class="hljs-literal"><span class="hljs-literal">-test</span></span><span class="hljs-literal"><span class="hljs-literal">-network</span></span> depends_on: - postgres - rabbitmq volumes: - /app:/app working_dir: /app deploy: replicas: <span class="hljs-number"><span class="hljs-number">1</span></span> restart_policy: condition: on<span class="hljs-literal"><span class="hljs-literal">-failure</span></span> placement: constraints: [<span class="hljs-type"><span class="hljs-type">node.role</span></span> == <span class="hljs-type"><span class="hljs-type">manager</span></span>] nginx: image: nginx:<span class="hljs-number"><span class="hljs-number">1.15</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> networks: - my<span class="hljs-literal"><span class="hljs-literal">-test</span></span><span class="hljs-literal"><span class="hljs-literal">-network</span></span> working_dir: /app ports: - <span class="hljs-string"><span class="hljs-string">'80:80'</span></span> depends_on: - php<span class="hljs-literal"><span class="hljs-literal">-fpm</span></span> volumes: - /app:/app - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf deploy: replicas: <span class="hljs-number"><span class="hljs-number">1</span></span> restart_policy: condition: on<span class="hljs-literal"><span class="hljs-literal">-failure</span></span> placement: constraints: [<span class="hljs-type"><span class="hljs-type">node.role</span></span> == <span class="hljs-type"><span class="hljs-type">manager</span></span>] postgres: image: postgres:<span class="hljs-number"><span class="hljs-number">9.6</span></span> ports: - <span class="hljs-string"><span class="hljs-string">'5432:5432'</span></span> working_dir: /app networks: - my<span class="hljs-literal"><span class="hljs-literal">-test</span></span><span class="hljs-literal"><span class="hljs-literal">-network</span></span> secrets: - postgres_db - postgres_user - postgres_pass environment: POSTGRES_DB_FILE: /run/secrets/postgres_db POSTGRES_USER_FILE: /run/secrets/postgres_user POSTGRES_PASSWORD_FILE: /run/secrets/postgres_pass volumes: - ./<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>/dump:/app/dump - ./<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>/postgresql:/var/lib/postgresql/<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> deploy: replicas: <span class="hljs-number"><span class="hljs-number">1</span></span> restart_policy: condition: on<span class="hljs-literal"><span class="hljs-literal">-failure</span></span> placement: constraints: [<span class="hljs-type"><span class="hljs-type">node.role</span></span> == <span class="hljs-type"><span class="hljs-type">manager</span></span>] rabbitmq: image: rabbitmq:<span class="hljs-number"><span class="hljs-number">3.7</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span><span class="hljs-literal"><span class="hljs-literal">-management</span></span> networks: - my<span class="hljs-literal"><span class="hljs-literal">-test</span></span><span class="hljs-literal"><span class="hljs-literal">-network</span></span> working_dir: /app hostname: my<span class="hljs-literal"><span class="hljs-literal">-test</span></span><span class="hljs-literal"><span class="hljs-literal">-sf4</span></span><span class="hljs-literal"><span class="hljs-literal">-app</span></span><span class="hljs-literal"><span class="hljs-literal">-rabbit</span></span><span class="hljs-literal"><span class="hljs-literal">-mq</span></span> volumes: - /app:/app ports: - <span class="hljs-string"><span class="hljs-string">'5672:5672'</span></span> - <span class="hljs-string"><span class="hljs-string">'15672:15672'</span></span> secrets: - rabbitmq_default_user - rabbitmq_default_pass - rabbitmq_default_vhost environment: RABBITMQ_DEFAULT_USER_FILE: /run/secrets/rabbitmq_default_user RABBITMQ_DEFAULT_PASS_FILE: /run/secrets/rabbitmq_default_pass RABBITMQ_DEFAULT_VHOST_FILE: /run/secrets/rabbitmq_default_vhost deploy: replicas: <span class="hljs-number"><span class="hljs-number">1</span></span> restart_policy: condition: on<span class="hljs-literal"><span class="hljs-literal">-failure</span></span> placement: constraints: [<span class="hljs-type"><span class="hljs-type">node.role</span></span> == <span class="hljs-type"><span class="hljs-type">manager</span></span>] elasticsearch: image: docker.elastic.co/elasticsearch/elasticsearch:<span class="hljs-number"><span class="hljs-number">6.3</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> networks: - my<span class="hljs-literal"><span class="hljs-literal">-test</span></span><span class="hljs-literal"><span class="hljs-literal">-network</span></span> depends_on: - postgres environment: - discovery.type=single<span class="hljs-literal"><span class="hljs-literal">-node</span></span> - discovery.zen.ping.unicast.hosts=elasticsearch - bootstrap.memory_lock=true - ES_JAVA_OPTS=<span class="hljs-literal"><span class="hljs-literal">-Xms512m</span></span> <span class="hljs-literal"><span class="hljs-literal">-Xmx512m</span></span> ports: - <span class="hljs-number"><span class="hljs-number">9200</span></span>:<span class="hljs-number"><span class="hljs-number">9200</span></span> - <span class="hljs-number"><span class="hljs-number">9300</span></span>:<span class="hljs-number"><span class="hljs-number">9300</span></span> working_dir: /app volumes: - /app:/app - ./<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>/elasticsearch:/usr/share/elasticsearch/<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> deploy: replicas: <span class="hljs-number"><span class="hljs-number">1</span></span> restart_policy: condition: on<span class="hljs-literal"><span class="hljs-literal">-failure</span></span> placement: constraints: [<span class="hljs-type"><span class="hljs-type">node.role</span></span> == <span class="hljs-type"><span class="hljs-type">manager</span></span>] jenkins: image: otezvikentiy/jenkins:<span class="hljs-number"><span class="hljs-number">0.0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span> networks: - my<span class="hljs-literal"><span class="hljs-literal">-test</span></span><span class="hljs-literal"><span class="hljs-literal">-network</span></span> ports: - <span class="hljs-string"><span class="hljs-string">'8080:8080'</span></span> - <span class="hljs-string"><span class="hljs-string">'50000:50000'</span></span> volumes: - /app:/app - ./<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>/jenkins:/var/jenkins_home - /var/run/docker.sock:/var/run/docker.sock - /usr/bin/docker:/usr/bin/docker deploy: replicas: <span class="hljs-number"><span class="hljs-number">1</span></span> restart_policy: condition: on<span class="hljs-literal"><span class="hljs-literal">-failure</span></span> placement: constraints: [<span class="hljs-type"><span class="hljs-type">node.role</span></span> == <span class="hljs-type"><span class="hljs-type">manager</span></span>] volumes: elasticsearch: postgresql: jenkins: networks: my<span class="hljs-literal"><span class="hljs-literal">-test</span></span><span class="hljs-literal"><span class="hljs-literal">-network</span></span>: secrets: rabbitmq_default_user: file: ./secrets/rabbitmq_default_user rabbitmq_default_pass: file: ./secrets/rabbitmq_default_pass rabbitmq_default_vhost: file: ./secrets/rabbitmq_default_vhost postgres_db: file: ./secrets/postgres_db postgres_user: file: ./secrets/postgres_user postgres_pass: file: ./secrets/postgres_pass</code> </pre><br>  Seperti yang Anda lihat, file pengaturan untuk produk sedikit berbeda dari file untuk LAN.  Itu menambahkan rahasia, penyebaran dan jaringan. <br><br>  <b>rahasia</b> - file untuk menyimpan kunci.  Kunci dibuat cukup sederhana.  Anda membuat file dengan nama kunci - tulis nilai di dalamnya.  Setelah itu, di docker-compose.yml Anda menentukan bagian rahasia dan mentransfer seluruh daftar file dengan kunci untuk itu.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Lebih detail</a> . <br>  <b>jaringan</b> - ini menciptakan jaringan internal tertentu di mana wadah saling berkomunikasi.  Pada LAN - ini dilakukan secara otomatis, tetapi pada produktif - ini perlu dilakukan sedikit secara manual.  Plus, Anda dapat menentukan pengaturan tambahan kecuali yang standar.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Lebih detail</a> . <br>  <b>menyebarkan</b> adalah perbedaan utama antara LAN dan Produk / Beta. <br><br><pre> <code class="hljs powershell"> deploy: replicas: <span class="hljs-number"><span class="hljs-number">1</span></span> restart_policy: condition: on<span class="hljs-literal"><span class="hljs-literal">-failure</span></span> placement: constraints: [<span class="hljs-type"><span class="hljs-type">node.role</span></span> == <span class="hljs-type"><span class="hljs-type">manager</span></span>]</code> </pre><br>  Perangkat tempur minimum: <br><br>  <b>replika</b> - menunjukkan jumlah replika yang perlu Anda jalankan (pada kenyataannya, ini digunakan jika Anda memiliki cluster dan Anda menggunakan penyeimbang beban dari buruh pelabuhan).  Misalnya, Anda memiliki dua server dan Anda menghubungkannya melalui docker swarm.  Menentukan angka 2 di sini, misalnya, 1 instance akan dibuat pada 1 server, dan yang kedua pada server kedua.  Dengan demikian, beban di server akan dibagi dua. <br>  <b>restart_policy</b> - kebijakan "menaikkan kembali" kontainer secara otomatis jika jatuh karena suatu alasan. <br>  <b>penempatan</b> - lokasi instance wadah.  Misalnya, ada saat-saat Anda ingin semua instance wadah berputar di hanya 1 dari 5 server, dan tidak didistribusikan di antara mereka. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Saya ingin membaca dokumentasinya!</a> <br><br>  Jadi, kami mendapat sedikit lebih baik tentang apa yang membedakan docker-compose.yaml untuk LAN dari produk / versi beta.  Sekarang mari kita coba menjalankan bisnis ini. <br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Misalkan Anda sedang berlatih tentang Vagrant dan di root server Anda sudah memiliki file yang dikonfigurasi untuk produk docker-compose.yml</font></font></i> <br><br><pre> <code class="bash hljs">sudo apt-get update sudo apt-get -y upgrade sudo apt-get install -y language-pack-en-base <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> LC_ALL=en_US.UTF-8 <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> LANGUAGE=en_US.UTF-8 <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> LANG=en_US.UTF-8 curl -sSl https://get.docker.com/ | sh sudo usermod -aG docker ubuntu sudo apt-get install git sudo docker swarm init --advertise-addr 192.168.128.77 sudo mkdir /app sudo chmod 777 /app -R docker stack deploy -c /docker-compose.yml my-app git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git@bitbucket.org:JohnDoe/my-app.git /app docker stack ps my-app docker stack ls docker stack services my-app</code> </pre><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> jangan menendang untuk sudo dan 777, tentu saja tidak layak melakukannya pada yang produktif. </font><font style="vertical-align: inherit;">Ini hanya untuk kecepatan belajar. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jadi, kami paling tertarik pada garis yang terkait dengan buruh pelabuhan. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pertama kita menginisialisasi "swarm" (buruh pelabuhan). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lalu kami membuat direktori yang diperlukan untuk bekerja. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unduh lobak dengan kode SF4 kami di direktori / app. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setelah itu ada tiga perintah: ps, ls dan layanan. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masing-masing berguna dengan caranya sendiri. </font><font style="vertical-align: inherit;">Saya paling sering menggunakan ps, karena menampilkan status wadah dan bagian dari kesalahan, jika ada.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Katakanlah kontainer telah meningkat, tetapi beberapa dari mereka terus-menerus crash dengan kesalahan dan di docker ps aplikasi saya Anda melihat banyak restart. </font><font style="vertical-align: inherit;">Untuk melihat alasan musim gugur, Anda perlu menjalankan docker container ps -a - dan di sana akan muncul wadah yang terus jatuh. </font><font style="vertical-align: inherit;">Akan ada banyak contoh dari wadah yang sama, misalnya my-app_php-fpm.1. * Beberapa hash *. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dengan demikian, sekarang, mengetahui nama wadah, jalankan log buruh pelabuhan my-app_php-fpm.1. * Beberapa hash * sengit dan melihat melalui log. </font><font style="vertical-align: inherit;">Perbaiki kesalahan dan mulai kembali SEMUANYA. </font><font style="vertical-align: inherit;">Untuk menggedor semua wadah, Anda dapat melakukan ini:</font></font><br><br><pre> <code class="bash hljs">docker stack rm my-app</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setelah itu, Anda akan memiliki gerombolan yang bersih tanpa wadah. </font><font style="vertical-align: inherit;">Perbaiki kesalahan - dan sekali lagi docker stack deploy -c docker-compose.yml my-app.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id420673/">https://habr.com/ru/post/id420673/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id420663/index.html">Metrik sederhana dan cara menghemat waktu saat mencari masalah di infrastruktur</a></li>
<li><a href="../id420665/index.html">Membangun Aplikasi di .NET Core dan Kubernetes: Pengalaman Kami</a></li>
<li><a href="../id420667/index.html">Prinsip-prinsip Operasi Protokol EIGRP</a></li>
<li><a href="../id420669/index.html">Tinjauan Pasar Otomasi Perusahaan: Solusi untuk Konstruksi dan Manajemen Perusahaan Perumahan dan Utilitas</a></li>
<li><a href="../id420671/index.html">[Ekaterinburg, pengumuman] UralJS # 9 - tiga laporan tentang layanan mikro, pengujian, dan pencatatan kesalahan di bagian depan</a></li>
<li><a href="../id420675/index.html">SOC adalah manusia. "Halo, kami mencari bakat" atau dari mana para analis dari pusat pemantauan dan respons serangan cyber berasal</a></li>
<li><a href="../id420677/index.html">Kisah bagaimana Epson memberi 30 juta "pabrik" bagi planet ini</a></li>
<li><a href="../id420679/index.html">Kursus Python baru dari Mail.Ru Group</a></li>
<li><a href="../id420681/index.html">AMD ThreadRipper 2: Pendahuluan Pertama</a></li>
<li><a href="../id420685/index.html">Memperbaiki dan menetralkan: bagaimana kita menjinakkan perak. Sepatah kata tentang bakterisida untuk air</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>