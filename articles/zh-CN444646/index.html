<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¢ ğŸŒ ğŸ’£ Rutokenï¼ŒOpenSSLå’Œç”¨äºç­¾åæ¶ˆæ¯çš„æœ¬åœ°CA ğŸ’… ğŸ‘©ğŸ¿â€ğŸ¤â€ğŸ‘¨ğŸ¼ ğŸš</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å‰ä¸€æ®µæ—¶é—´ï¼Œè¯¥é¡¹ç›®çš„æ¡†æ¶éœ€è¦é™åˆ¶åŒæ—¶è®¿é—®åœ¨å®¢æˆ·çš„å±€åŸŸç½‘ä¸­è¿è¡Œçš„Webåº”ç”¨ç¨‹åºçš„è®¡ç®—æœºçš„æ•°é‡ã€‚ 

 ä½¿ç”¨ç¡¬ä»¶USBä»¤ç‰Œæ¥è¯†åˆ«è®¡ç®—æœºçš„å†³å®šæ˜¯è‡ªå·±å†³å®šçš„ã€‚ é€‰æ‹©å–å†³äºRutoken EDSï¼šå®ƒæ— éœ€é©±åŠ¨ç¨‹åºå³å¯å·¥ä½œï¼Œè¦åœ¨Webåº”ç”¨ç¨‹åºä¸­å·¥ä½œï¼Œæ‚¨åªéœ€è¦å¼€å‘äººå‘˜å‘å¸ƒçš„æµè§ˆå™¨æ’ä»¶å³å¯ã€‚ ç”±äºä»¤ç‰Œåº”è¯¥è¯†åˆ«è®¡ç®—æœºï¼Œ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Rutokenï¼ŒOpenSSLå’Œç”¨äºç­¾åæ¶ˆæ¯çš„æœ¬åœ°CA</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444646/"> å‰ä¸€æ®µæ—¶é—´ï¼Œè¯¥é¡¹ç›®çš„æ¡†æ¶éœ€è¦é™åˆ¶åŒæ—¶è®¿é—®åœ¨å®¢æˆ·çš„å±€åŸŸç½‘ä¸­è¿è¡Œçš„Webåº”ç”¨ç¨‹åºçš„è®¡ç®—æœºçš„æ•°é‡ã€‚ <br><br> ä½¿ç”¨ç¡¬ä»¶USBä»¤ç‰Œæ¥è¯†åˆ«è®¡ç®—æœºçš„å†³å®šæ˜¯è‡ªå·±å†³å®šçš„ã€‚ é€‰æ‹©å–å†³äºRutoken EDSï¼šå®ƒæ— éœ€é©±åŠ¨ç¨‹åºå³å¯å·¥ä½œï¼Œè¦åœ¨Webåº”ç”¨ç¨‹åºä¸­å·¥ä½œï¼Œæ‚¨åªéœ€è¦å¼€å‘äººå‘˜å‘å¸ƒçš„æµè§ˆå™¨æ’ä»¶å³å¯ã€‚ ç”±äºä»¤ç‰Œåº”è¯¥è¯†åˆ«è®¡ç®—æœºï¼Œè€Œä¸æ˜¯ç”¨æˆ·ï¼Œå› æ­¤ä½¿ç”¨å®ƒåº”è¯¥æ˜¯å®Œå…¨â€œé€æ˜çš„â€ï¼šå¦‚æœå­˜åœ¨ï¼Œåˆ™ç³»ç»Ÿåªæ˜¯åœ¨ä¸è¯¢é—®ç”¨æˆ·ä¸å¿…è¦çš„é—®é¢˜çš„æƒ…å†µä¸‹ä»¥é™é»˜æ–¹å¼å·¥ä½œã€‚ <br><br> å†³å®šï¼šç™»å½•ç³»ç»Ÿæ—¶ï¼Œä½¿ç”¨Rootokenæ’ä»¶ä½¿ç”¨å­˜å‚¨åœ¨Rutokenä¸­çš„è¯ä¹¦çš„éé™å®šç­¾åå¯¹ç”¨æˆ·å‡­æ®è¿›è¡Œç­¾åï¼Œç„¶ååœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œæ£€æŸ¥ã€‚ ä½¿ç”¨æ’ä»¶æˆåŠŸç™»å½•åï¼Œæ£€æŸ¥åŒä¸€ä»¤ç‰Œçš„ç‰©ç†å­˜åœ¨ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æ³¨é”€ç³»ç»Ÿã€‚ åœ¨ä¸Šè¿°é¡¹ç›®çš„æ¡†æ¶å†…ï¼Œè¿™å°±è¶³å¤Ÿäº†ã€‚ <br><br> éœ€è¦åˆ›å»ºè‡ªå·±çš„è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰ï¼Œä»¥äº¤æ¢ç­¾åæ¶ˆæ¯ï¼Œæˆ–è€…æ›´ç¡®åˆ‡åœ°è¯´ï¼Œæ˜¯å°†ç­¾åæ¶ˆæ¯ä»å®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡å™¨ã€‚ å®¢æˆ·ç«¯è¯ä¹¦å¿…é¡»ä½äºç§é’¥å®¹å™¨ä¸­çš„USBä»¤ç‰Œä¸Šï¼Œå¹¶ä¸”å¿…é¡»ä½¿ç”¨OpenSSLåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œç­¾åéªŒè¯ <br><br> å› æ­¤ï¼Œä»»åŠ¡æ˜¯ï¼š <b>åœ¨CAçš„LinuxæœåŠ¡å™¨ä¸Šè¿›è¡Œå®‰è£…å’Œé…ç½®ã€‚</b>  <b>éƒ¨ç½²ç”¨äºè¯†åˆ«USBä»¤ç‰Œä¸Šçš„è®¡ç®—æœºçš„å®¢æˆ·ç«¯è¯ä¹¦</b> ã€‚ <br><br> è¦è§£å†³å®ƒï¼Œæ‚¨å°†éœ€è¦ï¼š <br><br><ul><li>  OpenSSL 1.1.0åŠæ›´é«˜ç‰ˆæœ¬ï¼Œæ”¯æŒGOSTç®—æ³• </li><li>  Rutoken EDS </li><li> æ¥è‡ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¼€å‘äººå‘˜ç«™ç‚¹çš„</a> OpenSSLé›†æˆæ¨¡å—ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PKCSï¼ƒ11åº“</a>ä»¥åŠ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç”¨äºç®¡ç†ä»¤ç‰Œ</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®ç”¨ç¨‹åº</a> ï¼ˆrtAdminï¼‰ </li><li>  openscï¼Œå®‰è£…äº†pcsc-lite-ccidè½¯ä»¶åŒ… </li></ul><a name="habracut"></a><br><ol><li> æˆ‘ä»¬åˆ›å»ºCAæ‰€åœ¨çš„ç›®å½•ï¼Œå¹¶å¤åˆ¶ç³»ç»Ÿéšé™„çš„OpenSSLé…ç½®ï¼ˆæœ€æ–°ç‰ˆæœ¬çš„Ubuntuä¸­æœ‰<b>/etc/ssl/openssl.cnf</b> ï¼‰ </li><li> æˆ‘ä»¬é…ç½®â€œæˆ‘ä»¬çš„â€ openssl.cnfï¼š <br><br>  aï¼‰åœ¨ç”¨äºè¿æ¥ä»¤ç‰Œå¼•æ“çš„æ–‡ä»¶æŒ‡ä»¤çš„å¼€å¤´æ·»åŠ ï¼š <br><br><pre><code class="plaintext hljs">openssl_conf = openssl_def [ openssl_def ] engines = engine_section [ engine_section ] rtengine = gost_section [ gost_section ] dynamic_path = /path/to/rutoken/openssl/connector/librtengine.so MODULE_PATH = /path/to/rutoken/pkcs11/librtpkcs11ecp.so RAND_TOKEN = pkcs11:manufacturer=Aktiv%20Co.;model=Rutoken%20ECP default_algorithms = CIPHERS, DIGEST, PKEY, RAND</code> </pre> <br>  bï¼‰å–æ¶ˆæ³¨é‡Šè¡Œ <br><br><pre> <b><code class="plaintext hljs"># req_extensions = v3_req # The extensions to add to a certificate request</code></b> </pre> <br>  cï¼‰åœ¨<b>[v3_req]</b>éƒ¨åˆ†ä¸­ï¼ŒæŒ‡å®šä»¥ä¸‹å‚æ•°ï¼š <br><br><pre> <b><code class="plaintext hljs">subjectSignTool = ASN1:FORMAT:UTF8,UTF8String:   extendedKeyUsage=emailProtection keyUsage=digitalSignature,nonRepudiation,keyEncipherment,dataEncipherment</code></b> </pre><br>  dï¼‰åœ¨[v3_ca]éƒ¨åˆ†ä¸­ï¼Œä»basicConstraintså‚æ•°ä¸­åˆ é™¤å…³é”®é€‰é¡¹ï¼š <br><br><pre> <code class="plaintext hljs">basicConstraints = CA:true</code> </pre> <br>  <i>ä¸ºäº†ä»€ä¹ˆ</i>  <i>è¯šå®çš„å›ç­”ï¼šæˆ‘ä¸çŸ¥é“ã€‚</i>  <i>ä½†æ˜¯ï¼Œæˆ‘è¯•å›¾å¼„æ¸…æ¥šè¯¥ä¸»é¢˜æ—¶ä¸‹è½½çš„æ‰€æœ‰æ ¹è¯ä¹¦ç¤ºä¾‹éƒ½æ²¡æœ‰å±é™©çš„è¿¹è±¡ã€‚</i>  <i>æˆ‘é—®çš„æ˜¯â€œä¸ºä»€ä¹ˆï¼Ÿâ€</i>  <i>æ¯”è¾ƒæœ‰ç»éªŒçš„åŒäº‹ã€‚</i> <i><br></i> <br><br>  eï¼‰ï¼ˆå¯é€‰ï¼‰è®¾ç½®åœ¨å‘å¸ƒè‡ªç­¾åè¯ä¹¦å’Œç”Ÿæˆç”¨äºå‘å¸ƒå®¢æˆ·ç«¯è¯ä¹¦çš„è¯·æ±‚æ—¶å°†æä¾›çš„é»˜è®¤å€¼ã€‚ è¿™äº›å‚æ•°åœ¨<b>[req_distinguished_name]</b>éƒ¨åˆ†ä¸­ <br><br> å¸¦æœ‰_defaultåç¼€çš„å‚æ•°æ˜¯é»˜è®¤å€¼ã€‚ ä¸€ä¸ªä¾‹å­ï¼š <br><br><pre> <b><code class="plaintext hljs">countryName = Country Name (2 letter code) countryName_default = AU countryName_min = 2 countryName_max = 2</code></b> </pre> <br>  <i>å½“ç³»ç»Ÿè¦æ±‚æ‚¨è¾“å…¥<b>countryName</b>å‚æ•°æ—¶ï¼Œå®ƒå°†åœ¨æ–¹æ‹¬å·ä¸­æŒ‡ç¤ºé»˜è®¤æƒ…å†µä¸‹å°†ä¿ç•™å€¼AUã€‚</i> <i><br></i> <br><br> è¿™æ ·å°±å®Œæˆäº†OpenSSLé…ç½®çš„é…ç½®ã€‚ å®ƒä»ç„¶å‘OpenSSLæŒ‡ç¤ºæœ‰å¿…è¦ä½¿ç”¨å®ƒã€‚ ä¸ºæ­¤ï¼Œè¯·è®¾ç½®ç¯å¢ƒå˜é‡OPENSSL_CONFï¼š <br><br><pre> <b><code class="plaintext hljs">export OPENSSL_CONF=/path/to/your/openssl.cnf</code></b> </pre> </li><li> æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç›®å½•ç»“æ„ï¼Œå…¶ä¸­å°†å­˜å‚¨æœ‰å…³æˆ‘ä»¬çš„CAçš„ä¿¡æ¯ã€‚ <br> ä¸ºæ­¤ï¼Œè¯·è½¬åˆ°åˆšåˆšç¼–è¾‘äº†openssl.cnfçš„åˆ›å»ºç›®å½•ï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š <br><br>  aï¼‰åœ¨å…¶ä¸­åˆ›å»ºå­ç›®å½•ï¼š <br><br>  <b>demoCA</b> <b><br></b>  <b>demoCA /ç§äºº</b> <b><br></b>  <b>demoCA /æ–°è¯ä¹¦</b> <b><br></b> <br>  <i><b>æ³¨æ„ï¼š</b> demoCAåç§°åœ¨<b>openssl.cnf</b>æ–‡ä»¶çš„<b>[CA_default]</b>éƒ¨åˆ†ä¸­é˜æ˜ã€‚</i>  <i>æ‚¨å¯ä»¥æ›´æ”¹å®ƒï¼ˆåœ¨æ­¥éª¤2ä¸­ï¼‰ï¼Œç„¶åä½¿ç”¨å®ƒä»£æ›¿demoCAã€‚</i> <br><br>  bï¼‰åœ¨demoCAç›®å½•ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªç©ºçš„<b>index.txt</b>æ–‡ä»¶å’Œä¸€ä¸ª<b>ä¸²è¡Œ</b>æ–‡ä»¶ï¼Œä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€è¯¥æ–‡ä»¶å¹¶åœ¨å…¶ä¸­å†™å…¥01è¡Œï¼Œè¿™æ˜¯å·²é¢å‘è¯ä¹¦çš„è®¡æ•°å™¨ã€‚ é¢å‘æ¯ä¸ªä¸‹ä¸€ä¸ªè¯ä¹¦åï¼Œæ­¤æ–‡ä»¶ä¸­çš„å€¼å¢åŠ ä¸€ã€‚ </li><li> æˆ‘ä»¬å¯ä»¥é€‰æ‹©ä½¿ç”¨rtAdminå®ç”¨ç¨‹åºæ ¼å¼åŒ–ä»¤ç‰Œï¼Œç°åœ¨ä¸€åˆ‡å°±ç»ªï¼Œå¯ä»¥éƒ¨ç½²CAã€‚ <br><br> åŠ¨ä½œç®—æ³•å¤§è‡´å¾ˆç®€å•ï¼š <br><br>  <i>aï¼‰æˆ‘ä»¬ä½¿ç”¨GOSTç®—æ³•é¢å‘è®¤è¯ä¸­å¿ƒçš„æ ¹è¯ä¹¦ï¼š</i> <i><br><br></i> <ul><li> ç”Ÿæˆç§é’¥ä»¥é¢å‘è‡ªç­¾åCAè¯ä¹¦ </li><li> ä½¿ç”¨ç”Ÿæˆçš„å¯†é’¥ç”Ÿæˆè‡ªç­¾åçš„X509è¯ä¹¦ </li></ul><br>  bï¼‰åœ¨æ¯ä¸ªUSBä»¤ç‰Œä¸Š <br><br><ul><li> ç”Ÿæˆå¯†é’¥å¯¹ï¼ˆæ‰€è°“çš„ç§é’¥å®¹å™¨ï¼‰ </li><li> ä½¿ç”¨ç”Ÿæˆçš„ä»¤ç‰Œå¯†é’¥ç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚ </li><li> ä¸ºæ­¤è¯·æ±‚ç­¾å‘è¯ä¹¦ </li><li> å°†è¯ä¹¦ä¿å­˜åœ¨ç§é’¥å®¹å™¨ä¸­çš„ä»¤ç‰Œä¸Š </li></ul><br> ä»¥ä¸‹æ˜¯é’ˆå¯¹å•ä¸ªä»¤ç‰Œçš„æ­¤ç®—æ³•çš„å®ç°ï¼š <br><br>  <i>CAè¯ä¹¦çš„ç§é’¥ç”Ÿæˆï¼ˆæˆ‘ä»¬ä½¿ç”¨GOSTç®—æ³•ï¼‰ï¼š</i> <br><br><pre> <code class="plaintext hljs">openssl genpkey -algorithm gost2012_256 -pkeyopt paramset:A -outform PEM -out demoCA/private/cakey.pem</code> </pre> <br>  <i>æˆ‘ä»¬ç­¾å‘è‡ªç­¾åçš„CAè¯ä¹¦ï¼š</i> <br><br><pre> <code class="plaintext hljs">&lt;b&gt;openssl req -new -x509 -key demoCA/private/cakey.pem -out demoCA/certs/cacert.pem -extensions v3_ca -days +3650 -outform PEM</code> </pre> <br> è¯·æ³¨æ„ï¼šæˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸ŠæŒ‡å‡ºï¼Œæœ‰å¿…è¦ä½¿ç”¨openssl_cnfé…ç½®ä¸­çš„<b>v3_ca</b>æ‰©å±•åã€‚ åœ¨é‚£é‡Œå°±æ˜¯æˆ‘ä»¬çš„CAã€‚ æœ‰æ•ˆæœŸä¸º10å¹´ã€‚  CAçš„å¸¸è¯†ã€‚ ä½†æ˜¯è¿˜æœ‰æ›´å¤šå¯èƒ½ã€‚ <br><br> åœ¨é¢å‘è¯ä¹¦çš„è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿå°†è¦æ±‚æ‚¨è¾“å…¥æˆ‘ä»¬çš„<b>openssl.cnf</b>æ–‡ä»¶çš„<b>[req_distinguished_name]</b>éƒ¨åˆ†ä¸­çš„å‚æ•°å€¼ <br><br> ç°åœ¨æˆ‘ä»¬å¼€å§‹ä»¤ç‰Œæ“ä½œã€‚ å¦‚æœä»¤ç‰Œæ˜¯æ–°ä»¤ç‰Œæˆ–å…·æœ‰é»˜è®¤å€¼çš„æ ¼å¼ï¼Œåˆ™å…¶ä¸Šçš„ç”¨æˆ·PINä¸º12345678ã€‚æˆ‘ä»è¿™æ ·çš„å‡è®¾å‡ºå‘ã€‚ å¦åˆ™ï¼Œæ‚¨å¿…é¡»æŒ‡å®šæ­£ç¡®çš„ç”¨æˆ·PINï¼Œå¹¶é€šå¸¸å°è¯•ç¡®ä¿åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œä»¤ç‰Œä¸Šå·²å­˜åœ¨çš„å¯¹è±¡çš„åç§°ä¸è¾“å…¥çš„å¯¹è±¡çš„åç§°ä¸é‡å ã€‚ <br><br> é¦–å…ˆï¼Œæˆ‘ä»¬å°†<i>ç”Ÿæˆä¸€ä¸ªå¯†é’¥å¯¹ã€‚</i>  OpenSSLæ— æ³•åœ¨Rutokenä¸Šæ‰§è¡Œæ­¤æ“ä½œï¼Œå› æ­¤æˆ‘ä»¬å°†ä½¿ç”¨OpenSCè½¯ä»¶åŒ…ä¸­çš„pkcs11-toolå®ç”¨ç¨‹åºï¼š <br><br><pre> <code class="plaintext hljs">pkcs11-tool --module /path/to/your/librtpkcs11ecp.so --login --pin 12345678 --keypairgen --key-type GOSTR3410:A --id 303030303031 --label 'client01'</code> </pre> <br>  <i><b>é‡è¦è¯´æ˜ï¼š</b>æˆ‘ä»¬æŒ‡å®šçš„IDä¸º303030303031ã€‚æ­¤IDçš„æ¯ä¸¤ä½ä»…æ˜¯å­—ç¬¦â€œ 0â€å’Œâ€œ 1â€çš„ASCIIç ã€‚</i>  <i>å¯¹äºä½¿ç”¨OpenSSLçš„æ“ä½œï¼Œå®ƒå°†çœ‹èµ·æ¥åƒâ€œ id = 000001â€</i> <i><br></i> <br> ç”Ÿæˆè¯ä¹¦è¯·æ±‚ï¼š <br><br><pre> <code class="plaintext hljs">openssl req -utf8 -new -keyform engine -key 'pkcs11:id=000001' -engine rtengine -out demoCA/newcerts/client01.csr</code> </pre> <br> å¦‚æœä¸€åˆ‡éƒ½æ­£ç¡®å®Œæˆï¼Œé‚£ä¹ˆç³»ç»Ÿ <br><br><ul><li> è¦æ±‚è¾“å…¥å¯†ç  </li><li> å°†è¯·æ±‚è¯ä¹¦åç§°å‚æ•°ï¼ˆæ¥è‡ª<b>[req_distinguished_name]</b>éƒ¨åˆ†ï¼‰ </li><li> å°†å‘å‡ºè¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶ </li></ul><br> ä½¿ç”¨æ­¤è¯·æ±‚ï¼Œæˆ‘ä»¬ç­¾ç½²äº†ä¸€ä¸ªå®¢æˆ·è¯ä¹¦ï¼ˆ <i>åœ¨ç¤ºä¾‹ä¸­ï¼Œè¯¥è¯ä¹¦çš„æœ‰æ•ˆæœŸä¸º1825å¤©ã€‚ <b>é‡è¦çš„</b>æ˜¯ï¼Œè¯¥æ—¶é—´æ®µä¸å¾—è¶…è¿‡æ‚¨çš„æ ¹è¯ä¹¦çš„æœ‰æ•ˆæœŸ</i> ï¼‰ï¼š <br><br><pre> <code class="plaintext hljs">openssl ca -utf8 -days +1825 -keyfile demoCA/private/cakey.pem -cert demoCA/certs/cacert.pem -in demoCA/newcerts/client01.csr -outdir demoCA/newcerts -out demoCA/certs/client01.pem</code> </pre> <br> ç³»ç»Ÿå°†æ˜¾ç¤ºè¯ä¹¦ï¼Œè¯¢é—®æœ‰å…³å¯¹å…¶è¿›è¡Œç­¾åçš„å†³å®šï¼ˆå›ç­”â€œ yâ€ï¼‰ï¼Œä»¥åŠæœ‰å…³ä¿å­˜æ–°è¯ä¹¦çš„å†³å®šï¼ˆå†æ¬¡å›ç­”â€œ yâ€ï¼‰ã€‚ <br><br> æˆ‘ä»¬å°†æ”¶åˆ°çš„è¯ä¹¦ä¿å­˜ä¸ºä»¤ç‰Œï¼š <br><br><pre> <code class="plaintext hljs">pkcs11-tool --module /path/to/your/librtpkcs11ecp.so --login --pin 12345678 --id=303030303031 -w demoCA/certs/client01.pem -y cert</code> </pre><br>  <b>ä»…æ­¤è€Œå·²ã€‚</b> <br><br> æµ‹è¯•åˆ›å»ºçš„â€œå¥‡è¿¹â€ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬ç­¾åå¹¶éªŒè¯çŸ­è¯­â€œ Helloï¼Œworldï¼â€çš„ç­¾åï¼š <br><br><pre> <code class="plaintext hljs">echo Hello,world! | openssl cms -nodetach -sign -signer demoCA/certs/client01.pem -keyform engine -inkey "pkcs11:id=000001" -engine rtengine -binary -noattr -outform PEM | openssl cms -verify -CAfile demoCA/certs/cacert.pem -inform PEM</code> </pre> <br> å¦‚æœä¸€åˆ‡éƒ½æ­£ç¡®å®Œæˆï¼Œç³»ç»Ÿå°†è¦æ±‚è¾“å…¥PINç ï¼Œå¯¹æ¶ˆæ¯ç­¾åï¼Œç„¶åéªŒè¯ç­¾åï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™å°†æ˜¾ç¤ºåŸå§‹æ¶ˆæ¯å’ŒéªŒè¯ç»“æœï¼ˆâ€œæˆåŠŸâ€ï¼‰ <br><br>  <i><b>å¤‡æ³¨</b></i> ã€‚ è¿”å›æ ‡é¢˜ä»»åŠ¡å¹¶ä½¿ç”¨æ’ä»¶ç­¾åï¼Œåº”æ³¨æ„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ’ä»¶æä¾›çš„ç­¾åç»“æœä¸æ˜¯PEMæ ¼å¼ï¼Œè€Œæ˜¯DERæ ¼å¼ï¼Œä»¥base64ç¼–ç ã€‚ å› æ­¤ï¼Œè¦éªŒè¯ç­¾åï¼Œå¿…é¡»é¦–å…ˆä»base64è§£ç ï¼Œç„¶ååœ¨æ£€æŸ¥æ—¶æŒ‡å®šè¾“å…¥DERæ ¼å¼ã€‚ <br><br> ç¥ä½ å¥½è¿ï¼ </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN444646/">https://habr.com/ru/post/zh-CN444646/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN444636/index.html">æˆ‘ä¸ºä»€ä¹ˆä¸èƒ½ä¸ºäº†é’±è€Œæˆé•¿</a></li>
<li><a href="../zh-CN444638/index.html">åœ¨CodeFestä¸Šè¿›è¡Œè´¨é‡æ£€æŸ¥ã€‚ è‡ªåŠ¨åŒ–ï¼Œç®¡ç†ï¼ŒåŸºç¡€è®¾æ–½ï¼Œå•†åº—ä¸­é¥ºå­çš„é”€å”®</a></li>
<li><a href="../zh-CN444640/index.html">å¯¹è®²æœºKostya Gorskyï¼šå…³äºåŸå¸‚å’Œé‡å¿ƒï¼Œäº§å“æ€ç»´ï¼Œè®¾è®¡å¸ˆæŠ€èƒ½å’Œè‡ªæˆ‘å‘å±•</a></li>
<li><a href="../zh-CN444642/index.html">ä½¿ç”¨é«˜è¾¾1080på’Œ4Kçš„ç¥ç»ç½‘ç»œé‡æ–°åˆ¶ä½œã€Šæ˜Ÿé™…è¿·èˆªã€‹</a></li>
<li><a href="../zh-CN444644/index.html">æœ€å°çš„VMware NSXã€‚ ç¬¬4éƒ¨åˆ†ã€‚é…ç½®è·¯ç”±</a></li>
<li><a href="../zh-CN444650/index.html">ç»†èŒé™¤è‡­å‰‚ï¼šæ ‘è›™ä¸å‡å•èƒèŒç»†èŒä¹‹é—´çš„å…±ç”Ÿå…³ç³»</a></li>
<li><a href="../zh-CN444652/index.html">â€œæ˜¯æ—¶å€™èµ°å‡ºå‰ç«¯äº†â€ï¼šAndrey Sitnikè®¨è®ºç¤¾åŒºåœæ»ï¼Œå¼€æºé—®é¢˜ï¼Œè€Œä¸ä»…ä»…æ˜¯</a></li>
<li><a href="../zh-CN444654/index.html">ç»æµçš„å–œæ‚¦ã€‚ æŒ‡å¯¼ä¸ºç‰¹ä¾‹ã€‚ ç™¾åˆ†ä¹‹ä¸‰å®šå¾‹</a></li>
<li><a href="../zh-CN444658/index.html">Badoo PHP Meetupï¼ƒ2çš„è§†é¢‘ï¼šå…³äºæµ‹è¯•å’Œä»£ç è´¨é‡</a></li>
<li><a href="../zh-CN444660/index.html">åœ¨Asp.Net Boilerplate 4.3 .Net Core 2.1ä¸­è®°å½•æ‰€æœ‰æ•°æ®åº“æŸ¥è¯¢</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>