<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💉 🦑 🚴🏿 7 Tage, 15 Ingenieure und 600 Server: Yandex.Money ist in ein neues Rechenzentrum umgezogen ☂️ 🤰🏼 🕴️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kürzlich fand in der Abteilung Yandex.Money Operations ein bedeutendes Ereignis statt. Unser Unternehmen wächst rasant und es stellte sich heraus, das...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>7 Tage, 15 Ingenieure und 600 Server: Yandex.Money ist in ein neues Rechenzentrum umgezogen</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yamoney/blog/481340/"><img src="https://habrastorage.org/webt/_d/ye/aq/_dyeaqhvhl5sh0awhpgw7t70b38.jpeg"><br><br>  Kürzlich fand in der Abteilung Yandex.Money Operations ein bedeutendes Ereignis statt.  Unser Unternehmen wächst rasant und es stellte sich heraus, dass sich nicht nur unsere Herzen, sondern auch die Anforderungen des Rechenzentrums ändern.  Genauer gesagt muss sich der Ort ändern.  Und jetzt, seit drei Monaten, lebt eines der Rechenzentren an einem neuen Ort. <br><br>  Über den Umzug von Yandex.Money in ein neues Rechenzentrum werde ich Ihnen, dem Leiter der Betriebsabteilung, und Ivan, dem Leiter der Abteilung für IT-Infrastruktur und interne Systeme, berichten. <br><br>  Unter dem Strich - eine Chronologie der Ereignisse, wichtige Meilensteine ​​des Umzugs, unerwartete Wendungen und Nachbesprechungen.  Wir teilen mit, wie wir das überstanden haben. <br><a name="habracut"></a><br><h2>  Voraussetzungen für den Umzug </h2><br>  Zuvor befand sich eines der Rechenzentren von Yandex.Money in einem Vorort von Moskau.  Die Realität ist, dass nicht alle Anbieter von optischen Kommunikationskanälen außerhalb der Stadt die Möglichkeit haben, Kabelstrecken unabhängig zu verlegen - das ist teuer.  Der erste Grund für unsere Entscheidung für den Umzug war die Tatsache, dass die Kommunikationskanäle im alten Rechenzentrum auf denselben Wegen verliefen, was mit zusätzlichen Risiken verbunden war. <br><blockquote> Innerhalb der Moskauer Ringstraße gibt es viele Anbieter, und das Kabelsystem ist gut entwickelt.  Sie können Kanäle von verschiedenen Anbietern kaufen, die unterschiedliche Vorgehensweisen aufweisen und sich nicht überschneiden.  In der Region besteht ein erhöhtes Risiko - zum Beispiel wird ein Bagger kommen und alle Gleise auf einmal ausheben. </blockquote><br>  Zweitens hatte das vorherige Rechenzentrum technologische Einschränkungen, einschließlich periodisch auftretender Probleme mit der Stromversorgung. <br><br>  Aber der Hauptgrund (= Schmerz) ist die Unfähigkeit zu expandieren.  Dies bedeutete, dass das Gebäude keinen Platz mehr für zusätzliche Gestelle hatte, in denen neue Geräte untergebracht werden konnten.  Dies steht in direktem Zusammenhang mit unserer produktiven Umgebung, da Yandex.Money über zwei Rechenzentren verfügt und diese in Bezug auf die Kapazitäten symmetrisch sein müssen. <br><br><h2>  Planung </h2><br>  Die Vorbereitung für den Umzug war in Phasen unterteilt: <br><br><ul><li>  Wettbewerbe: Gleichstrom, Kanäle, Netzwerke, Racks, PDUs, Kabel; </li><li>  Übertragen Sie Anwendungen und Datenbanken auf den 2. DC; </li><li>  Lehren - DC deaktivieren; </li><li>  Neue Architektur von Kernnetzen, IX; </li><li>  Einrichten eines neuen Netzwerkkerns im DC. </li></ul><br><br><h4>  Lieferantenauswahl </h4><br>  Das erste Yandex.Money-Rechenzentrum befindet sich in Moskau.  Um große Netzwerkverzögerungen zu vermeiden, haben wir beschlossen, das zweite Rechenzentrum in der Nähe des ersten zu platzieren. <br><blockquote>  Innerhalb des MKAD sollen Netzwerkverzögerungen minimiert und nicht näher als 20 km zur ersten Einrichtung sichergestellt werden, um die Unabhängigkeit beider Rechenzentren von der gleichen städtischen Infrastruktur und möglichen technologischen oder Naturkatastrophen sicherzustellen. </blockquote><br>  Bei der Analyse des Marktes haben wir uns von einem so wichtigen Kriterium wie der Zertifizierung von Rechenzentren hinsichtlich Verfügbarkeit und Zuverlässigkeit leiten lassen.  Der in Russland und der Welt am weitesten verbreitete Standard ist der vom Uptime Institute entwickelte Standard, der Rechenzentren auf der ganzen Welt überprüft.  Es ist anzumerken, dass es viele Rechenzentren gibt, die nur die Projektdokumentation zertifiziert haben. Dies bedeutet jedoch nicht, dass das Rechenzentrum selbst gemäß Standards gebaut, getestet und betrieben wird. <br><blockquote>  Ein Fall aus unserer Praxis: Ein Anbieter von Rechenzentrumsdiensten in Moskau gab uns bekannt, dass das Rechenzentrumsprojekt den Tier III-Standard erfüllt, und bot an, eine Vereinbarung mit dem Versprechen einer 100% igen Verfügbarkeit, dh 0 Minuten Ausfallzeit pro Jahr, abzuschließen!  Bei einem persönlichen Besuch der Website haben wir festgestellt, dass es keine offiziellen Zertifizierungen gibt, die das Qualitätsniveau garantieren, und die Infrastruktur greift eindeutig nicht auf Tier III zurück.  Das Rechenzentrum befand sich im Erdgeschoss eines Wohngebäudes, und der einzige Generatoranhänger stand ohne physischen Schutz auf der Straße. </blockquote><br>  Daher haben wir in die Wettbewerbsanforderungen nicht nur die Zertifizierung des Projekts, sondern auch die Zertifizierung der Implementierungs- und Managementprozesse aufgenommen. <br><br>  Des Weiteren haben wir mit Lieferanten von optischen Kommunikationskanälen zwischen unseren DCs und Kanälen Verkehrsknotenpunkte (IX) festgelegt, an denen wir Schnittstellen mit Anbietern oder unseren Partnern einrichten.  Das Hauptkriterium war, dass die optischen Kommunikationskanäle unabhängig sein sollten und unterschiedliche Wege gehen sollten. <br><br>  Natürlich gab es auch andere Anschaffungen - hauptsächlich Netzwerkgeräte, Racks (Spezialschränke für die Installation von Servern), Stromverteiler (intelligente Stromverteiler) sowie Kabel und Patchkabel. <br><br>  Es ist erwähnenswert, dass wir den Lieferanten, der das Gerät transportiert, besonders sorgfältig ausgewählt haben.  Es ist wichtig, dass das Unternehmen Erfahrung im Transport von Servern hat und die Umzugsunternehmen verstehen, dass dies nicht Möbel und Lasten sind. Sie sollten auch beim Fahren besonders vorsichtig sein.  Zusätzlich versicherten wir die transportierten Geräte bei Transportschäden. <br><br><h4>  Upgrade der Netzwerkinfrastruktur </h4><br>  In Bezug auf die Netzwerkinfrastruktur hatten wir zwei Möglichkeiten.  Die erste besteht darin, alte Netzwerkgeräte so zu transportieren, wie sie sind.  Die zweite besteht darin, zunächst eine neue Netzwerkinfrastruktur in einem neuen Rechenzentrum aufzubauen und erst dann die Serverausrüstung zu transportieren. <br><br>  Da wir verstanden haben, dass wir bereits auf die Netzwerkbandbreite im alten Rechenzentrum „gestoßen“ sind und die Reserve und die Skalierbarkeit für mindestens die nächsten 3-5 Jahre benötigen, wurde beschlossen, die Netzwerkinfrastruktur im neuen Rechenzentrum von Grund auf neu aufzubauen und auf eine neue Gerätegeneration aufzurüsten . <br><br>  Beim Aufbau eines Netzwerks in einem neuen Rechenzentrum haben wir uns an das klassische Modell gehalten.  In jedem Rack sind die Server mit zwei Zugriffsschaltern verbunden, die wiederum mit den zentralen Aggregationsschaltern verbunden sind (sie sind auch der Kern des Netzwerks). <br><br><img src="https://habrastorage.org/webt/wt/hw/mq/wthwmq0qnhd8bajvhxsu8fhzode.png"><br><br><h4>  Lehren </h4><br>  Beim Umzug haben wir beschlossen, das Rechenzentrum vollständig auszuschalten, um alles auf einmal zu transportieren und an einem neuen Ort einzuschalten.  Dazu musste das Unternehmen lernen, auf eines der beiden Rechenzentren zu verzichten.  Es erforderte die Teilnahme fast aller unserer Administratoren, damit Informationssysteme auf verschiedenen Plattformen, auf verschiedenen Betriebssystemen und mit verschiedenen Datenbanken auf der verbleibenden Site ununterbrochen funktionieren. <br><blockquote>  Für die kritischsten Dienste wurde eine Reserve bereitgestellt, die auch bei ausgeschaltetem Rechenzentrum verfügbar blieb. </blockquote><br>  Nach der Durchführung der Reservierungsarbeiten begannen die Übungen.  Zuerst haben wir einzelne Netzwerke, Segmente und erst dann das Rechenzentrum vollständig getrennt.  2019 haben wir das Rechenzentrum zehnmal testweise heruntergefahren - wir haben beobachtet, wie sich unsere 300 Informationssysteme verhalten.  Wir haben die Autonomie wiederholt überprüft und waren überzeugt, dass wir die Verbindung leicht trennen können. <br><br>  Und weiter… <br><br><h2>  Woche X </h2><br>  An einem der Freitage sollte die gesamte Ausrüstung im Rechenzentrum abgeschaltet werden. Die neuesten Versionen wurden am Morgen herausgebracht, und dann wurde ein Moratorium für sie angekündigt. <br><blockquote>  Yandex.Money kann 60 oder mehr Releases pro Tag haben, und alle werden an beide Rechenzentren weitergeleitet. </blockquote><br>  Wir haben die Releases gestoppt, um sicherzustellen, dass das System stabil funktioniert und keine Korrekturen in unseren Komponenten erforderlich sind.  Ab 15:00 Uhr löschten sie allmählich alle Anwendungen, Datenbanken und Server aus.  In der Nacht von Freitag auf Samstag warteten wir auf die Zeit, wir waren überzeugt, dass nichts Schlimmes passierte, was bedeutet, dass wir gehen können.  Am Samstagmorgen begann ein 15-köpfiges Team, die Geräte zu demontieren und in das neue Rechenzentrum zu transportieren. <br><br><img src="https://habrastorage.org/webt/aw/hb/oe/awhboefkhxui5klua789j7ec3nm.png"><br><br>  Wir haben den ganzen Samstag gebraucht, um die Ausrüstung zu zerlegen und zu transportieren.  Als nächstes begann der Prozess der Installation, des Umschaltens und des Anschlusses an die Stromversorgung. <br><br><img src="https://habrastorage.org/webt/ry/uz/h4/ryuzh4vxihy3vqokvj_ex2_-oam.png"><br><br>  Am Samstagabend haben wir den ersten Stapel Server montiert und verbunden.  Die Hauptarbeit begann am Sonntag - am Abend des Wochenendes war fast die gesamte Ausrüstung installiert.  Und wir haben die Kommutierung erst am Montagabend beendet. <br><br><img src="https://habrastorage.org/webt/bp/hz/ci/bphzci1xww3exwjgcnddnyhxvku.png"><br><br>  Am Dienstagmorgen haben wir die letzten Tests von Netzwerken und Kommunikationskanälen durchgeführt und waren bereit, unsere Systeme zu verbessern.  Sie haben angefangen, die ersten Server zu erhöhen, aber etwas ist schief gelaufen ... <br><br>  Von Administratoren erhielten wir Massenbeschwerden, dass das Netzwerk auf den Servern nicht funktionierte: entweder vollständig oder eine von zwei Schnittstellen.  Sie begannen, nach Problemen auf der Seite von Netzwerkgeräten, in Betriebssystemen und in den Einstellungen von Betriebssystemen zu suchen. <br><br>  Die Symptome waren ähnlich - sie begannen zu untersuchen, was der Grund sein könnte.  Wir haben festgestellt, dass es sich lohnt, die Patchkabel neben den Switch-Ports stärker zu verschieben, und einige der funktionierenden Verbindungen erlöschen. <br><br><img src="https://habrastorage.org/webt/r-/l8/mx/r-l8mxy3b8vndwvgcxu_572lfny.gif"><br><br>  Als wir dies entdeckten, stellten wir fest, dass ein erheblicher Teil dieser Patchkabel (etwa 40% von 2000 Stück) defekt war.  Wir verlegten alle verfügbaren Patchkabel eines anderen vertrauenswürdigen Herstellers in ein neues Rechenzentrum und begannen dringend, die kritischsten Server erneut zu verbinden.  Es dauerte noch einen Tag. <br><br>  Ab Mittwochabend am Donnerstagmorgen begann das Team, den Hauptblock der Informationssysteme zu heben. <br><br>  Nachdem wir wichtige Services erhöht und die Reserve des Zahlungssystems eingerichtet hatten, haben wir einen Teil der Teststände des neuen Rechenzentrums und die Reserve der Backoffice-Systeme einbezogen, sodass alle unsere internen Systeme mit zwei Rechenzentren arbeiten.  Ende der Woche wurde nahezu die gesamte IT-Infrastruktur des transportierten Rechenzentrums in Betrieb genommen. <br><br>  Ursprünglich gab es einen Plan für 5 Tage, aber mit einer Notfallsituation im Zusammenhang mit defekten Patchkabeln stellte sich heraus, dass es eine Woche war.  Im Folgenden haben wir die Zeitachse unserer Aktionen klar umrissen. <br><br>  <b>Umzugsplan - ausstehend:</b> <br><br><ul><li>  Freitag - wir löschen Netzwerke und Anwendungen; </li><li>  Samstag - wir tragen und beginnen die Montage; </li><li>  Sonntag - Installation von Servern, Start von Netzwerken; </li><li>  Montag - wir beenden das Netzwerk, starten Anwendungen; </li><li>  Dienstag - alles einschalten. </li></ul><br><br>  <b>Realität:</b> <br><br><ul><li>  Freitag - wir löschen Netzwerke und Anwendungen; </li><li>  Samstag - wir tragen und beginnen die Montage; </li><li>  Sonntag - Installation von Servern, Start von Netzwerken; </li><li>  <font color="red">Montag - Verkabelung, Netzwerkstart;</font> </li><li>  Dienstag - Server einschalten, <font color="red">100+ funktioniert nicht;</font> </li><li>  Mittwoch - <font color="red">Hochzeit in Drähten, Ersatz</font> , Einführung von App und DB; </li><li>  Donnerstag - beendet den Ersatz für PS, starten Sie die App. </li></ul><br><br><h2>  Das Leben nach dem Umzug </h2><br>  <b>Was haben wir vom Umzug mitbekommen?</b> <br>  Erstens haben beide Rechenzentren jetzt die Stufe III des Uptime Institute.  Lieferanten von Rechenzentren garantieren uns eine Verfügbarkeit von 99,982%, was 1,6 Stunden Ausfallzeit pro Jahr entspricht.  Wir sind von der Zuverlässigkeit der Kommunikationskanäle zwischen unseren Standorten überzeugt.  Auch jetzt gibt es keine Einschränkungen beim Ausbau unserer IT-Infrastruktur. <br><br>  Die Idee des Umzugs gab uns eine großartige Gelegenheit, die Netzwerkausrüstung in Bezug auf die Bandbreite zu verbessern.  Wir haben auch Stromversorgungen in Racks überarbeitet - installierte „Smart PDUs“, reservierte Stromserver. <br><br>  Und als wir umgezogen sind, konnten wir die Umschaltung „kämmen“, und jetzt sieht es ordentlicher aus. <br><br><img src="https://habrastorage.org/webt/si/er/bg/sierbgikqjvev60m0geubzlxjr0.png"><br><br>  Daher begann das System im Allgemeinen stabiler zu arbeiten, und unsere Kunden erhalten einen besseren Service. <br><br>  <b>Welche Schlussfolgerungen haben Sie für sich gezogen?</b> <br>  Wenn Sie große Projekte durchführen, müssen Sie über die Risiken nachdenken und sich vorstellen, welche Fallstricke auftreten können.  Unser Beispiel mit Ethernet-Kabeln hat gezeigt, dass es nicht ausreicht, einen Testkauf zu tätigen und die Kabelprodukte des ausgewählten Herstellers zu testen.  Um die Risiken zu verringern, war es erforderlich, eine Charge von 2000 Kabeln stichprobenartig zu testen. <br><br>  Es ist auch zu bedenken, dass einige Server den Umzug möglicherweise nicht überleben und sich aus verschiedenen Gründen einfach nicht einschalten lassen.  Auf die eine oder andere Weise wackelt die Straße und ist mechanisch belastet.  Von den 600 transportierten Geräten brachen 6 Blöcke.  Von einer ausreichend großen Anzahl von Servern hat nur 1% gelitten, keine einzige Festplatte ist abgestürzt - wir glauben, dass dies ein hervorragendes Ergebnis ist. <br><br><hr><br>  So zog das Rechenzentrum von Yandex.Money an einen neuen Ort.  Wir hoffen, dass unsere Erfahrung Ihnen hilft, mögliche Fehler zu vermeiden und Sie möglicherweise zu anderen interessanten Lösungen führt. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de481340/">https://habr.com/ru/post/de481340/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de481330/index.html">Der dritte Punkt ist nicht überflüssig: Wie wir die Produktlistenkette durch Hinzufügen eines weiteren Glieds verkürzt haben</a></li>
<li><a href="../de481332/index.html">Ankündigung des Buches "Maschinelles Lernen ohne zusätzliche Wörter"</a></li>
<li><a href="../de481334/index.html">Aufgabennummer 2. Bestimmung der Bevölkerungsstruktur</a></li>
<li><a href="../de481336/index.html">Wie Personen von "anonymen" Datensätzen erfasst werden</a></li>
<li><a href="../de481338/index.html">Xss-Schwachstellen ausnutzen</a></li>
<li><a href="../de481342/index.html">Freitagsumfrage: Über Sprachen sprechen</a></li>
<li><a href="../de481344/index.html">Pläne des IntelliJ Platform-Teams für 2020</a></li>
<li><a href="../de481346/index.html">5 große Veränderungen in der Automobilindustrie</a></li>
<li><a href="../de481348/index.html">Pentest Active Directory. Teil 1</a></li>
<li><a href="../de481350/index.html">Wer arbeitet am Kosmodrom Plesetsk?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>