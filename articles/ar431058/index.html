<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>โฝ๏ธ ๐ โ๏ธ ุงูุฎุทูุงุช ุงูุฃููู ูุน ูุญุฑู ููููููุฑู ๐จ๐พโ๐ผ ๐ โฐ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุนูุฏ ุงูุจุญุซ ุนู "Unicorn Engine" ุนูู Habr ุ ููุฌุฆุช ุนูุฏูุง ุงูุชุดูุช ุฃู ูุฐู ุงูุฃุฏุงุฉ ูู ุชุธูุฑ ูุท ูู ุงูููุงูุงุช. ุณุฃุญุงูู ููุก ูุฐุง ุงููุฑุงุบ. ููุจุฏุฃ ุจุงูุฃุณุงุณูุงุช ุ ููููู ูุธุฑุฉ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุงูุฎุทูุงุช ุงูุฃููู ูุน ูุญุฑู ููููููุฑู</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431058/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุนูุฏ ุงูุจุญุซ ุนู "Unicorn Engine" ุนูู Habr ุ ููุฌุฆุช ุนูุฏูุง ุงูุชุดูุช ุฃู ูุฐู ุงูุฃุฏุงุฉ ูู ุชุธูุฑ ูุท ูู ุงูููุงูุงุช.  ุณุฃุญุงูู ููุก ูุฐุง ุงููุฑุงุบ.  ููุจุฏุฃ ุจุงูุฃุณุงุณูุงุช ุ ููููู ูุธุฑุฉ ุนูู ูุซุงู ูุงุณุชุฎุฏุงู ุงููุญุงูู ูู ุงูุญูุงุฉ ุงููุงูุนูุฉ.  ููู ูุง ุฃุนูุฏ ุงุฎุชุฑุงุน ุงูุนุฌูุฉ ุ ูุฑุฑุช ุจุจุณุงุทุฉ ุชุฑุฌูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฐุง</a> ุงูุฏููู.  <em>ูุจู ุงูุจุฏุก ุ ุณุฃููู ุฃู ูู ุชุนูููุงุชู ุฃู ุชุนูููุงุชู ุณุชุจุฏู ููุฐุง</em> . </p><a name="habracut"></a><br><h1 id="chto-takoe-unicorn-engine" style=";text-align:right;direction:rtl">  ูุง ูู ูุญุฑู ููููููุฑูุ </h1><br><p style=";text-align:right;direction:rtl">  <em>ููุชุจ ุงููุทูุฑูู ุฃููุณูู ุนู</em> <del>  ูุญุฑู ููููููุฑู </del>  ูุญุฑู ููููููุฑู ูุซู ูุฐุง: </p><br><blockquote style=";text-align:right;direction:rtl">  Unicorn ูู ูุญุงูู ูุนุงูุฌ ุฎููู ุงููุฒู ููุชุนุฏุฏ ุงูููุตุงุช ูุจููุฉ ูุชุนุฏุฏุฉ. </blockquote><p style=";text-align:right;direction:rtl">  ูุฐุง ููุณ ูุญุงูููุง ููุงุณููุง.  ูุง ูุญุงูู ุชุดุบูู ุงูุจุฑูุงูุฌ ุจุฃูููู ุฃู ูุธุงู ุงูุชุดุบูู ุจุฃูููู.  ูุง ูุฏุนู ุฃูุงูุฑ ุงููุธุงู (ูุซู ูุชุญ ููู ุ ุฅุฎุฑุงุฌ ุญุฑู ุฅูู ูุญุฏุฉ ุงูุชุญูู ุ ุฅูุฎ).  ุณูููู ุนููู ุนูู ุชุฑููุฒ ุงูุฐุงูุฑุฉ ูุชุญููู ุงูุจูุงูุงุช ูููุง ุจููุณู ุ ุซู ุชุจุฏุฃ ุจุจุณุงุทุฉ ุงูุชูููุฐ ูู ุนููุงู ูุนูู. </p><br><p style=";text-align:right;direction:rtl">  ูููู ูู ูููุฏุฉุ </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุนูุฏ ุชุญููู ุงูููุฑูุณุงุช ุ ููููู ุงุณุชุฏุนุงุก ูุธุงุฆู ููุฑุฏุฉ ุฏูู ุฅูุดุงุก ุนูููุฉ ุถุงุฑุฉ. </li><li style=";text-align:right;direction:rtl">  ูุญู CTF. </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุชุดููุด</a> . </li><li style=";text-align:right;direction:rtl">  <a href="">ููููู ุฅุถุงูู ูู gdb</a> ููุชูุจุค ุจุงูุญุงูุฉ ุงููุณุชูุจููุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุงูููุฒุงุช ุงููุณุชูุจููุฉ ุฃู ููู ุงูุชุณุฌูู. </li><li style=";text-align:right;direction:rtl">  ูุถุงูุงุฉ ุฑูุฒ ุบูู ุจุงูููุฒุงุช. </li></ul><br><p style=";text-align:right;direction:rtl">  ูุงุฐุง ุชุญุชุงุฌุ </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุญุฑู Unicorn ูุซุจุช ุจุฑุจุท Python. </li><li style=";text-align:right;direction:rtl">  ุชูููู </li></ul><br><h1 id="primer" style=";text-align:right;direction:rtl">  ูุซุงู </h1><br><p style=";text-align:right;direction:rtl">  ููุซุงู ุ ุฎุฐ ูููุฉ ูุน hxp CTF 2017 ุชุญุช ุงุณู <strong><em>ููุจููุงุชุดู</em></strong> .  ูููู ุชูุฒูู ุงูุซูุงุฆู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> . </p><br><p style=";text-align:right;direction:rtl">  ุนูุฏ ุจุฏุก ุชุดุบูู ุงูุจุฑูุงูุฌ ุ ูุจุฏุฃ ูู ุนุฑุถ ุนูููุง ูู ูุญุฏุฉ ุงูุชุญูู ุ ูููู ุจุจุทุก ุดุฏูุฏ.  ูุนุชุจุฑ ูู ุจุงูุช ุนูู ูุงุญู ุฃุจุทุฃ ูุฃุจุทุฃ. </p><br><pre style=";text-align:right;direction:rtl"><code class="bash hljs">The flag is: hxp{F</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐุง ูุนูู ุฃูู ูู ุฃุฌู ุงูุญุตูู ุนูู ุงูุนูู ูู ูุชุฑุฉ ุฒูููุฉ ูุนูููุฉ ุ ูุญุชุงุฌ ุฅูู ุชุญุณูู ุชุดุบูู ูุฐุง ุงูุชุทุจูู. </p><br><p style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู IDA Pro ( <em>ุฃูุง ุดุฎุตูุงู ุงุณุชุฎุฏูุช radare2 + Cutter</em> ) ูููุง <em>ุจุชุฌููุน</em> ุงูุดูุฑุฉ ูู ููุฏ ุดุจู ููุฏู.  ุนูู ุงูุฑุบู ูู ุญูููุฉ ุฃูู ูู ูุชู ูู ุงูุดูุฑุฉ ุจุดูู ุตุญูุญ ุ ูุง ูุฒุงู ุจุฅููุงููุง ุงูุญุตูู ุนูู ูุนูููุงุช ูููุง ุญูู ูุง ูุญุฏุซ ูู ุงูุฏุงุฎู. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููุฏ ูู ุงูุดูุฑุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">__int64 __<span class="hljs-function"><span class="hljs-function">fastcall </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(__int64 a1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **a2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **a3)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *v3; <span class="hljs-comment"><span class="hljs-comment">// rbp@1 int v4; // ebx@1 signed __int64 v5; // r8@2 char v6; // r9@3 __int64 v7; // r8@3 char v8; // cl@3 __int64 v9; // r9@5 int a2a; // [sp+Ch] [bp-1Ch]@3 v3 = &amp;encrypted_flag; v4 = 0; setbuf(stdout, 0LL); printf("The flag is: ", 0LL); while ( 1 ) { LODWORD(v5) = 0; do { a2a = 0; fibonacci(v4 + v5, &amp;a2a); v8 = v7; v5 = v7 + 1; } while ( v5 != 8 ); v4 += 8; if ( (unsigned __int8)(a2a &lt;&lt; v8) == v6 ) break; v3 = (char *)v3 + 1; _IO_putc((char)(v6 ^ ((_BYTE)a2a &lt;&lt; v8)), stdout); v9 = *((char *)v3 - 1); } _IO_putc(10, stdout); return 0LL; }</span></span></code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> __<span class="hljs-function"><span class="hljs-function">fastcall </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fibonacci</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i, _DWORD *a2)</span></span></span><span class="hljs-function"> </span></span>{ _DWORD *v2; <span class="hljs-comment"><span class="hljs-comment">// rbp@1 unsigned int v3; // er12@3 unsigned int result; // eax@3 unsigned int v5; // edx@3 unsigned int v6; // esi@3 unsigned int v7; // edx@4 v2 = a2; if ( i ) { if ( i == 1 ) { result = fibonacci(0, a2); v5 = result - ((result &gt;&gt; 1) &amp; 0x55555555); v6 = ((result - ((result &gt;&gt; 1) &amp; 0x55555555)) &gt;&gt; 2) &amp; 0x33333333; } else { v3 = fibonacci(i - 2, a2); result = v3 + fibonacci(i - 1, a2); v5 = result - ((result &gt;&gt; 1) &amp; 0x55555555); v6 = ((result - ((result &gt;&gt; 1) &amp; 0x55555555)) &gt;&gt; 2) &amp; 0x33333333; } v7 = v6 + (v5 &amp; 0x33333333) + ((v6 + (v5 &amp; 0x33333333)) &gt;&gt; 4); *v2 ^= ((BYTE1(v7) &amp; 0xF) + (v7 &amp; 0xF) + (unsigned __int8)((((v7 &gt;&gt; 8) &amp; 0xF0F0F) + (v7 &amp; 0xF0F0F0F)) &gt;&gt; 16)) &amp; 1; } else { *a2 ^= 1u; result = 1; } return result; }</span></span></code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ููุง ูู ุฑูุฒ ุงููุฌูุน ูููุธุงุฆู <em>ุงูุฑุฆูุณูุฉ</em> ููุธุงุฆู <em>ููุจููุงุชุดู</em> : </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุงูุฑุฆูุณูุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">.text:0x4004E0 main proc near ; DATA XREF: start+1Do .text:0x4004E0 .text:0x4004E0 var_1C = dword ptr -1Ch .text:0x4004E0 .text:0x4004E0 push rbp .text:0x4004E1 push rbx .text:0x4004E2 xor esi, esi ; buf .text:0x4004E4 mov ebp, offset unk_4007E1 .text:0x4004E9 xor ebx, ebx .text:0x4004EB sub rsp, 18h .text:0x4004EF mov rdi, cs:stdout ; stream .text:0x4004F6 call _setbuf .text:0x4004FB mov edi, offset format ; "The flag is: " .text:0x400500 xor eax, eax .text:0x400502 call _printf .text:0x400507 mov r9d, 49h .text:0x40050D nop dword ptr [rax] .text:0x400510 .text:0x400510 loc_400510: ; CODE XREF: main+8Aj .text:0x400510 xor r8d, r8d .text:0x400513 jmp short loc_40051B .text:0x400513 ; --------------------------------------------------------------------------- .text:0x400515 align 8 .text:0x400518 .text:0x400518 loc_400518: ; CODE XREF: main+67j .text:0x400518 mov r9d, edi .text:0x40051B .text:0x40051B loc_40051B: ; CODE XREF: main+33j .text:0x40051B lea edi, [rbx+r8] .text:0x40051F lea rsi, [rsp+28h+var_1C] .text:0x400524 mov [rsp+28h+var_1C], 0 .text:0x40052C call fibonacci .text:0x400531 mov edi, [rsp+28h+var_1C] .text:0x400535 mov ecx, r8d .text:0x400538 add r8, 1 .text:0x40053C shl edi, cl .text:0x40053E mov eax, edi .text:0x400540 xor edi, r9d .text:0x400543 cmp r8, 8 .text:0x400547 jnz short loc_400518 .text:0x400549 add ebx, 8 .text:0x40054C cmp al, r9b .text:0x40054F mov rsi, cs:stdout ; fp .text:0x400556 jz short loc_400570 .text:0x400558 movsx edi, dil ; c .text:0x40055C add rbp, 1 .text:0x400560 call __IO_putc .text:0x400565 movzx r9d, byte ptr [rbp-1] .text:0x40056A jmp short loc_400510 .text:0x40056A ; --------------------------------------------------------------------------- .text:0x40056C align 10h .text:0x400570 .text:0x400570 loc_400570: ; CODE XREF: main+76j .text:0x400570 mov edi, 0Ah ; c .text:0x400575 call __IO_putc .text:0x40057A add rsp, 18h .text:0x40057E xor eax, eax .text:0x400580 pop rbx .text:0x400581 pop rbp .text:0x400582 retn .text:0x400582 main endp</code> </pre> </div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููุจููุงุชุดู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">.text:0x400670 fibonacci proc near ; CODE XREF: main+4Cp .text:0x400670 ; fibonacci+19p ... .text:0x400670 test edi, edi .text:0x400672 push r12 .text:0x400674 push rbp .text:0x400675 mov rbp, rsi .text:0x400678 push rbx .text:0x400679 jz short loc_4006F8 .text:0x40067B cmp edi, 1 .text:0x40067E mov ebx, edi .text:0x400680 jz loc_400710 .text:0x400686 lea edi, [rdi-2] .text:0x400689 call fibonacci .text:0x40068E lea edi, [rbx-1] .text:0x400691 mov r12d, eax .text:0x400694 mov rsi, rbp .text:0x400697 call fibonacci .text:0x40069C add eax, r12d .text:0x40069F mov edx, eax .text:0x4006A1 mov ebx, eax .text:0x4006A3 shr edx, 1 .text:0x4006A5 and edx, 55555555h .text:0x4006AB sub ebx, edx .text:0x4006AD mov ecx, ebx .text:0x4006AF mov edx, ebx .text:0x4006B1 shr ecx, 2 .text:0x4006B4 and ecx, 33333333h .text:0x4006BA mov esi, ecx .text:0x4006BC .text:0x4006BC loc_4006BC: ; CODE XREF: fibonacci+C2j .text:0x4006BC and edx, 33333333h .text:0x4006C2 lea ecx, [rsi+rdx] .text:0x4006C5 mov edx, ecx .text:0x4006C7 shr edx, 4 .text:0x4006CA add edx, ecx .text:0x4006CC mov esi, edx .text:0x4006CE and edx, 0F0F0F0Fh .text:0x4006D4 shr esi, 8 .text:0x4006D7 and esi, 0F0F0Fh .text:0x4006DD lea ecx, [rsi+rdx] .text:0x4006E0 mov edx, ecx .text:0x4006E2 shr edx, 10h .text:0x4006E5 add edx, ecx .text:0x4006E7 and edx, 1 .text:0x4006EA xor [rbp+0], edx .text:0x4006ED pop rbx .text:0x4006EE pop rbp .text:0x4006EF pop r12 .text:0x4006F1 retn .text:0x4006F1 ; --------------------------------------------------------------------------- .text:0x4006F2 align 8 .text:0x4006F8 .text:0x4006F8 loc_4006F8: ; CODE XREF: fibonacci+9j .text:0x4006F8 mov edx, 1 .text:0x4006FD xor [rbp+0], edx .text:0x400700 mov eax, 1 .text:0x400705 pop rbx .text:0x400706 pop rbp .text:0x400707 pop r12 .text:0x400709 retn .text:0x400709 ; --------------------------------------------------------------------------- .text:0x40070A align 10h .text:0x400710 .text:0x400710 loc_400710: ; CODE XREF: fibonacci+10j .text:0x400710 xor edi, edi .text:0x400712 call fibonacci .text:0x400717 mov edx, eax .text:0x400719 mov edi, eax .text:0x40071B shr edx, 1 .text:0x40071D and edx, 55555555h .text:0x400723 sub edi, edx .text:0x400725 mov esi, edi .text:0x400727 mov edx, edi .text:0x400729 shr esi, 2 .text:0x40072C and esi, 33333333h .text:0x400732 jmp short loc_4006BC .text:0x400732 fibonacci endp</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงููุฑุญูุฉ ุ ูุฏููุง ุงูุนุฏูุฏ ูู ุงููุฑุต ูุญู ูุฐู ุงููุดููุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ูููููุง ุงุณุชุนุงุฏุฉ ุงูุดูุฑุฉ ุจุงุณุชุฎุฏุงู ุฅุญุฏู ูุบุงุช ุงูุจุฑูุฌุฉ ูุชุทุจูู ุงูุชุญุณูู ููุงู ุ ูููู ุนูููุฉ ุงุณุชุนุงุฏุฉ ุงูุดูุฑุฉ ูู ูููุฉ ุตุนุจุฉ ููุบุงูุฉ ุ ูููููุง ุฎูุงููุง ุงุฑุชูุงุจ ุงูุฃุฎุทุงุก.  ุญุณููุง ุ ููุงุฑูุฉ ุงูุฑูุฒ ููุนุซูุฑ ุนูู ุงูุฎุทุฃ ูุง ูููุฉ ูู ุจุดูู ุนุงู.  ูููู ุ ุฅุฐุง ุงุณุชุฎุฏููุง ูุญุฑู ููููููุฑู ุ ููููููุง ุชุฎุทู ูุฑุญูุฉ ุฅุนุงุฏุฉ ุจูุงุก ุงูููุฏ ูุชุฌูุจ ุงููุดููุฉ ุงูููุถุญุฉ ุฃุนูุงู.  ุจุงูุทุจุน ุ ูููููุง ุชุฌูุจ ูุฐู ุงููุดุงูู ุจุงุณุชุฎุฏุงู ูุฑูุฏุง ุฃู ูุชุงุจุฉ ูุตูุต ูู gdb ุ ููู ูุฐุง ููุณ ุญูู ุฐูู. </p><br><p style=";text-align:right;direction:rtl">  ูุจู ุจุฏุก ุงูุชุญุณูู ุ ุณูููู ุจุชุดุบูู ุงููุถุงูุงุฉ ูู ูุญุฑู Unicorn ุฏูู ุชุบููุฑ ุงูุจุฑูุงูุฌ.  ูููุท ุจุนุฏ ุงูุฅุทูุงู ุงููุงุฌุญ ุ ุฏุนูุง ููุชูู ุฅูู ุงูุชุญุณูู. </p><br><h2 id="shag-1-da-priydet-virtualizaciya" style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 1: ุฏุนูุง ุงููุญุงูุงุฉ ุงูุงูุชุฑุงุถูุฉ ุชุฃุชู </h2><br><p style=";text-align:right;direction:rtl">  ูููู ุจุฅูุดุงุก ููู fibonacci.py ูุญูุธู ุจุฌูุงุฑ ุงูุซูุงุฆู. </p><br><p style=";text-align:right;direction:rtl">  ููุจุฏุฃ ุจุงุณุชูุฑุงุฏ ุงูููุชุจุงุช ุงููุทููุจุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> unicorn <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> unicorn.x86_const <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> struct</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ุงูุณุทุฑ ุงูุฃูู ุจุชุญููู ุซูุงุจุช ููููููุฑู ุงูุซูุงุฆูุฉ ุงูุฃุณุงุณูุฉ.  ูููู ุงูุณุทุฑ ุงูุซุงูู ุจุชุญููู ุงูุซูุงุจุช ูุจููุชู x86 ู x86_64. </p><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฐูู ุ ุฃุถู ุจุนุถ ุงููุธุงุฆู ุงูุถุฑูุฑูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(name) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f.read() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">u32</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> struct.unpack(<span class="hljs-string"><span class="hljs-string">"I"</span></span>, data)[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">p32</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(num)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> struct.pack(<span class="hljs-string"><span class="hljs-string">"I"</span></span>, num)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃุนูููุง ููุง ุนู ุงููุธุงุฆู ุงูุชู ุณูุญุชุงุฌูุง ูุงุญููุง: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>ุชูุฑุฃ</strong> ุจุจุณุงุทุฉ ุฅุฑุฌุงุน ูุญุชููุงุช ุงูููู ุ </li><li style=";text-align:right;direction:rtl">  ูุฃุฎุฐ <strong>u32</strong> ุณูุณูุฉ ูู 4 ุจุงูุช ูู ุชุดููุฑ LE <strong>ููุชุญูู</strong> ุฅูู int ุ </li><li style=";text-align:right;direction:rtl">  ููุนู <strong>p32</strong> ุงูุนูุณ - ูุฃุฎุฐ ุฑูููุง ููุญููู ุฅูู ุณูุณูุฉ ูู 4 ุจุงูุช ูู ุชุดููุฑ LE. </li></ul><br><p style=";text-align:right;direction:rtl">  ููุงุญุธุฉ: ุฅุฐุง ููุช ุจุชุซุจูุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">pwntools</a> ุ ูุฃูุช ูุณุช ุจุญุงุฌุฉ ุฅูู ุฅูุดุงุก ูุฐู ุงููุธุงุฆู ุ ูุง ุนููู ุณูู ุงุณุชูุฑุงุฏูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pwn <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> *</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฃุฎูุฑูุง ุ ูููุจุฏุฃ ูู ุชููุฆุฉ ูุฆุฉ Unicorn Engine ููู ุงูุนูุงุฑุฉ x86_64: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">mu = Uc (UC_ARCH_X86, UC_MODE_64)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุง ูุณูู ุฏุงูุงุช <strong>Uc</strong> ุจุงููุนููุงุช ุงูุชุงููุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงููุนููุฉ ุงูุฃููู ูู ุงูุนูุงุฑุฉ ุงูุฑุฆูุณูุฉ.  ุชุจุฏุฃ ุงูุซูุงุจุช ุจู <strong>UC_ARCH_</strong> ุ </li><li style=";text-align:right;direction:rtl">  ุงููุนููุฉ ุงูุซุงููุฉ ูู ููุงุตูุงุช ุงูุนูุงุฑุฉ.  ุชุจุฏุฃ ุงูุซูุงุจุช ุจู <strong>UC_MODE_</strong> . </li></ul><br><p style=";text-align:right;direction:rtl">  ููููู ุงูุนุซูุฑ ุนูู ุฌููุน ุงูุซูุงุจุช ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฑูุฉ ุงูุบุด</a> . </p><br><p style=";text-align:right;direction:rtl">  ููุง ูุชุจุช ุฃุนูุงู ุ ูุงุณุชุฎุฏุงู ูุญุฑู Unicorn ุ ูุญุชุงุฌ ุฅูู ุชููุฆุฉ ุงูุฐุงูุฑุฉ ุงูุงูุชุฑุงุถูุฉ ูุฏูููุง.  ูู ูุฐุง ุงููุซุงู ุ ูุญุชุงุฌ ุฅูู ูุถุน ุงูุดูุฑุฉ ูุงูููุฏุณ ูู ููุงู ูุง ูู ุงูุฐุงูุฑุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุจุฏุฃ ุงูุนููุงู ุงูุฃุณุงุณู (addr ุงูุฃุณุงุณู) ููุซูุงุฆู ูู 0x400000.  ุฏุนููุง ูุถุน ุงูููุฏุณ ุนูุฏ 0x0 ููุฎุตุต ุฐุงูุฑุฉ 1024 * 1024 ูุฐูู.  ุนูู ุงูุฃุฑุฌุญ ุ ูุง ูุญุชุงุฌ ุฅูู ูุณุงุญุฉ ูุจูุฑุฉ ุ ููููุง ูุง ุชุฒุงู ุบูุฑ ูุคููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูููููุง ุชุฑููุฒ ุงูุฐุงูุฑุฉ ุนู ุทุฑูู ุงุณุชุฏุนุงุก ุทุฑููุฉ <strong>mem_map</strong> . </p><br><p style=";text-align:right;direction:rtl">  ุฃุถู ูุฐู ุงูุฃุณุทุฑ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">BASE = <span class="hljs-number"><span class="hljs-number">0x400000</span></span> STACK_ADDR = <span class="hljs-number"><span class="hljs-number">0x0</span></span> STACK_SIZE = <span class="hljs-number"><span class="hljs-number">1024</span></span>*<span class="hljs-number"><span class="hljs-number">1024</span></span> mu.mem_map(BASE, <span class="hljs-number"><span class="hljs-number">1024</span></span>*<span class="hljs-number"><span class="hljs-number">1024</span></span>) mu.mem_map(STACK_ADDR, STACK_SIZE)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุญุชุงุฌ ุงูุขู ุฅูู ุชุญููู ุงูููู ุงูุซูุงุฆู ูู ุนููุงูู ุงูุฑุฆูุณู ุจููุณ ุงูุทุฑููุฉ ุงูุชู ูููู ุจูุง ูุญูู ุงูุฅููุงุน.  ุจุนุฏ ุฐูู ุ ูุญุชุงุฌ ุฅูู ุชุนููู <strong>RSP</strong> ุนูู ููุงูุฉ ุงูููุฏุณ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">mu.mem_write(BASE, read(<span class="hljs-string"><span class="hljs-string">"./fibonacci"</span></span>)) mu.reg_write(UC_X86_REG_RSP, STACK_ADDR + STACK_SIZE - <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููููุง ุงูุขู ุจุฏุก ุงููุถุงูุงุฉ ูุชุดุบูู ุงูููุฏ ุ ููููุง ุจุญุงุฌุฉ ููุนุฑูุฉ ุงูุนููุงู ุงูุฐู ูุจุฏุฃ ุงูุนูู ุจู ููุชู ูุฌุจ ุฃู ูุชููู ุงููุญุงูู. </p><br><p style=";text-align:right;direction:rtl">  ุฎุฐ ุนููุงู ุงูุฃูุฑ ุงูุฃูู ูู <strong>main ()</strong> ุ ูููููุง ุจุฏุก ูุถุงูุงุฉ ูู 0x004004e0.  ุณูุชู ุงุนุชุจุงุฑ ุงูููุงูุฉ ุฏุนูุฉ ุฅูู <strong>putc ("\ n")</strong> ุ ูุงูุชู ุชูุน ูู 0x00400575 ุ ุจุนุฏ ุนุฑุถ ุงูุนูู ุจุงููุงูู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">.text:0x400570 mov edi, 0Ah ; c .text:0x400575 call __IO_putc</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููููุง ุงูุจุฏุก ูู ูุญุงูุงุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">mu.emu_start(<span class="hljs-number"><span class="hljs-number">0x004004e0</span></span>,<span class="hljs-number"><span class="hljs-number">0x00400575</span></span>)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ูู ุจุชุดุบูู ุงูุจุฑูุงูุฌ ุงููุตู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">a@x:~/Desktop/unicorn_engine_lessons$ python solve.py Traceback (most recent call last): File <span class="hljs-string"><span class="hljs-string">"solve.py"</span></span>, line 32, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;module&gt; mu.emu_start(0x00000000004004E0, 0x0000000000400575) File <span class="hljs-string"><span class="hljs-string">"/usr/local/lib/python2.7/dist-packages/unicorn/unicorn.py"</span></span>, line 288, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> emu_start raise UcError(status) unicorn.unicorn.UcError: Invalid memory <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> (UC_ERR_READ_UNMAPPED)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนูููุง ุ ุญุฏุซ ุฎุทุฃ ูุง ุ ููููุง ูุง ูุนุฑู ุญุชู ูุงุฐุง.  ูุจู ุงูุงุชุตุงู ุจู <strong>mu.emu_start ุ</strong> ูููููุง ุฅุถุงูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hook_code</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mu, address, size, user_data)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">'&gt;&gt;&gt; Tracing instruction at 0x%x, instruction size = 0x%x'</span></span> %(address, size)) mu.hook_add(UC_HOOK_CODE, hook_code)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุถูู ูุฐุง ุงูุฑูุฒ ุฑุจุท.  ูุนูู ุนู ูุธููุฉ <strong>hook_code</strong> ุงูุฎุงุตุฉ <strong>ุจูุง</strong> ุ ูุงูุชู ูุชู ุงุณุชุฏุนุงุคูุง ุจูุงุณุทุฉ ุงููุญุงูู ูุจู ูู ุฃูุฑ.  ูุณุชุบุฑู ุงููุนููุงุช ุงูุชุงููุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>ูุณุฎุชูุง</strong> ูู <strong>Uc</strong> ุ </li><li style=";text-align:right;direction:rtl">  ุนููุงู ุงูุชุนูููุงุช </li><li style=";text-align:right;direction:rtl">  ุชุนูููุงุช ุงูุญุฌู </li><li style=";text-align:right;direction:rtl">  ุจูุงูุงุช ุงููุณุชุฎุฏู (ูููููุง ุชูุฑูุฑ ูุฐู ุงููููุฉ ุจุญุฌุฉ ุงุฎุชูุงุฑูุฉ ุฅูู <strong>hook_add ()</strong> ). <br>  ุงูุขู ุ ุฅุฐุง ูููุง ุจุชุดุบูู ุงูุจุฑูุงูุฌ ุงููุตู ุ ูุฌุจ ุฃู ูุฑู ุงูุฅุฎุฑุงุฌ ุงูุชุงูู: <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">a@x:~/Desktop/unicorn_engine_lessons$ python solve.py &gt;&gt;&gt; Tracing instruction at 0x4004e0, instruction size = 0x1 &gt;&gt;&gt; Tracing instruction at 0x4004e1, instruction size = 0x1 &gt;&gt;&gt; Tracing instruction at 0x4004e2, instruction size = 0x2 &gt;&gt;&gt; Tracing instruction at 0x4004e4, instruction size = 0x5 &gt;&gt;&gt; Tracing instruction at 0x4004e9, instruction size = 0x2 &gt;&gt;&gt; Tracing instruction at 0x4004eb, instruction size = 0x4 &gt;&gt;&gt; Tracing instruction at 0x4004ef, instruction size = 0x7 Traceback (most recent call last): File <span class="hljs-string"><span class="hljs-string">"solve.py"</span></span>, line 41, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;module&gt; mu.emu_start(0x00000000004004E0, 0x0000000000400575) File <span class="hljs-string"><span class="hljs-string">"/usr/local/lib/python2.7/dist-packages/unicorn/unicorn.py"</span></span>, line 288, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> emu_start raise UcError(status) unicorn.unicorn.UcError: Invalid memory <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> (UC_ERR_READ_UNMAPPED)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุงูุนููุงู ุงูุฐู ุญุฏุซ ููู ุงูุฎุทุฃ ุ ูููููุง ุฃู ูููู ุฃูู ูุง ูููู ููุจุฑูุงูุฌ ุงููุตู ูุนุงูุฌุฉ ูุฐุง ุงูุฃูุฑ: <br></p><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">.text:0x4004EF mov rdi, cs:stdout ; stream</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชูุฑุฃ ูุฐู ุงูุชุนูููุงุช ุงูุจูุงูุงุช ูู ุงูุนููุงู 0x601038 (ููููู ุฑุคูุชูุง ูู IDA Pro).  ูุฐุง ูู ูุณู <strong>.bss</strong> ุงูุฐู ูู <strong>ูุฑูุฒ</strong> ุฅููู.  ุณูููู ุงูุญู ูู ุจุจุณุงุทุฉ ุชุฎุทู ุฌููุน ุงูุชุนูููุงุช ุงูุฅุดูุงููุฉ ุฅุฐุง ูู ูุคุซุฑ ุฐูู ุนูู ููุทู ุงูุจุฑูุงูุฌ. <br>  ูููุง ููู ุชุนูููุงุช ุฅุดูุงููุฉ ุฃุฎุฑู: <br></p><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">.text:0x4004F6 call _setbuf</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุง ูููููุง ุงุณุชุฏุนุงุก ุฃู ูุธุงุฆู ุจุงุณุชุฎุฏุงู glibc ุ ุญูุซ ูุง ููุฌุฏ ุชุญููู glibc ูู ุงูุฐุงูุฑุฉ.  ุนูู ุฃู ุญุงู ุ ูุญู ูุณูุง ุจุญุงุฌุฉ ุฅูู ูุฐุง ุงูุฃูุฑ ุ ุญุชู ูุชููู ูู ุชุฎุทูู ุฃูุถูุง. <br>  ุฅููู ุงููุงุฆูุฉ ุงููุงููุฉ ููุฃูุงูุฑ ุงูุชู ูุฌุจ ุชุฎุทููุง: <br></p><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">.text:0x4004EF mov rdi, cs:stdout ; stream .text:0x4004F6 call _setbuf .text:0x400502 call _printf .text:0x40054F mov rsi, cs:stdout ; fp</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชุฎุทู ุงูุฃูุงูุฑ ุ ูุญุชุงุฌ ุฅูู ุฅุนุงุฏุฉ ูุชุงุจุฉ <strong>RIP</strong> ูุน ุงูุชุนูููุงุช ุงูุชุงููุฉ: <br></p><pre style=";text-align:right;direction:rtl"> <code class="python hljs">mu.reg_write(UC_X86_REG_RIP, address+size)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ูุฌุจ ุฃู ูุจุฏู <strong>hook_code</strong> ูุซู ูุฐุง: </p><br><p></p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">instructions_skip_list = [<span class="hljs-number"><span class="hljs-number">0x004004ef</span></span>,<span class="hljs-number"><span class="hljs-number">0x004004f6</span></span>,<span class="hljs-number"><span class="hljs-number">0x00400502</span></span>,<span class="hljs-number"><span class="hljs-number">0x0040054f</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hook_code</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mu, address, size, user_data)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">'&gt;&gt;&gt; Tracing instruction at 0x%x, instruction size = 0x%x'</span></span> %(address, size)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> address <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> instructions_skip_list: mu.reg_write(UC_X86_REG_RIP, address+size)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุญุชุงุฌ ุฃูุถูุง ุฅูู ุงูููุงู ุจุดูุก ูุง ุจุงุณุชุฎุฏุงู ุงูุฅุฑุดุงุฏุงุช ุงูุชู ุชุนุฑุถ ุงูุนูู ูู ูุญุฏุฉ ุชุญูู ุงูุจุงูุช. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">.text:0x400558 movsx edi, dil ; c .text:0x40055C add rbp, 1 .text:0x400560 call __IO_putc</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฃุฎุฐ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">__IO_putc</a> ูุญุฏุงุช ุงูุจุงูุช ููุฅุฎุฑุงุฌ <strong>ููุณูุทุฉ ุฃููู</strong> (ูุฐุง ูู ุณุฌู <strong>RDI</strong> ). </p><br><p style=";text-align:right;direction:rtl">  ูููููุง ูุฑุงุกุฉ ุงูุจูุงูุงุช ูุจุงุดุฑุฉ ูู ุงูุณุฌู ุ ูุฅุฎุฑุงุฌ ุงูุจูุงูุงุช ุฅูู ูุญุฏุฉ ุงูุชุญูู ูุชุฎุทู ูุฐู ุงููุฌููุนุฉ ูู ุงูุชุนูููุงุช.  ููุฑุฏ <strong>ุฑูุฒ_ุงูุฎุทุฃ</strong> ุงููุญุฏุซ ุฃุฏูุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">instructions_skip_list = [<span class="hljs-number"><span class="hljs-number">0x004004ef</span></span>,<span class="hljs-number"><span class="hljs-number">0x004004f6</span></span>,<span class="hljs-number"><span class="hljs-number">0x00400502</span></span>,<span class="hljs-number"><span class="hljs-number">0x0040054f</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hook_code</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mu, address, size, user_data)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#print('&gt;&gt;&gt; Tracing instruction at 0x%x, instruction size = 0x%x' %(address, size)) if address in instructions_skip_list: mu.reg_write(UC_X86_REG_RIP, address+size) elif address == 0x400560: # c = mu.reg_read(UC_X86_REG_RDI) print(chr(c),end="") mu.reg_write(UC_X86_REG_RIP, address+size)</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููููุง ุฃู ูุฑูุถ ูุณูุนูู ูู ุดูุก ุ ูููู ุจุจุทุก. </p><br><h1 id="shag-2-uvelichim-skorost" style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 2: ุฒูุงุฏุฉ ุงูุณุฑุนุฉ! </h1><br><p style=";text-align:right;direction:rtl">  ุฏุนููุง ูููุฑ ูู ุฒูุงุฏุฉ ุณุฑุนุฉ ุงูุนูู.  ููุงุฐุง ูุฐุง ุงูุจุฑูุงูุฌ ุจุทูุก ุฌุฏุงุ </p><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูุธุฑูุง ุฅูู ุงูุดูุฑุฉ ุงููุชุฑุฌูุฉ ุ ูุณูู ูุฑู ุฃู ุงูููุงููุงุช <strong>ุงูุฑุฆูุณูุฉ ()</strong> <strong>fibonacci ()</strong> ุนุฏุฉ ูุฑุงุช ู <strong>fibonacci ()</strong> ูู ุฏุงูุฉ ุนูุฏูุฉ.  ุฏุนููุง ูููู ูุธุฑุฉ ูุงุญุตุฉ ุนูู ูุฐู ุงููุธููุฉ ุ ููู ุชุฃุฎุฐ ูุณูุทุชูู ูุชุนูุฏููุง.  ูุชู ุชูุฑูุฑ ูููุฉ ุงูุฅุฑุฌุงุน ุงูุฃููู ูู ุฎูุงู ุณุฌู <strong>RAX</strong> ุ ููุชู ุฅุฑุฌุงุน ุงูุซุงููุฉ ูู ุฎูุงู ุงูุงุฑุชุจุงุท ุงูุฐู ุชู ุชูุฑูุฑู ูู ุฎูุงู ุงููุณูุทุฉ ุงูุซุงููุฉ ููุฏุงูุฉ.  ุฅุฐุง ูุธุฑูุง ุจุดูู ุฃุนูู ุฅูู ุงูุนูุงูุฉ ุจูู <strong>main ()</strong> ู <strong>fibonacci ()</strong> ุ ูุณูู ูุฑู ุฃู ุงููุณูุทุฉ ุงูุซุงููุฉ ุชุฃุฎุฐ ููุท ูููุชูู ูุญุชููุชูู: 0 ุฃู 1. ุฅุฐุง ููุช ูุง ุชุฒุงู ูุง ุชุฑู ูุฐุง ุ <strong>ููู</strong> ุจุชุดุบูู <strong>gdb</strong> ููุถุน ููุทุฉ ุชููู ูู ุจุฏุงูุฉ ุงูุฏุงูุฉ <strong>ููุจููุงุชุดู ()</strong> . </p><br><p style=";text-align:right;direction:rtl">  ูุชุญุณูู ุชุดุบูู ุงูุฎูุงุฑุฒููุฉ ุ ูููููุง ุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุจุฑูุฌุฉ ุงูุฏููุงููููุฉ</a> ูุชุฐูุฑ ุงููููุฉ ุงููุฑุฌุนุฉ ูููุนููุงุช ุงููุงุฑุฏุฉ.  ููุฑ ุจููุณู ุ ูููู ุฃู ุชุฃุฎุฐ ุงูุญุฌุฉ ุงูุซุงููุฉ ูููุชูู ููููุชูู ููุท ุ ูุฐูู ูู ูุง ุนูููุง ูุนูู ูู ุงูุชุฐูุฑ <math> </math> $ inline $ 2 * MAX \ _OF \ _FIRST \ _ARGUMENT $ ูุถููุฉ $   ุจุฎุงุฑ </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุจุงููุณุจุฉ ูุฃููุฆู ุงูุฐูู ูุง ูููููู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  <strong>ููุจููุงุชุดู</strong> ูู ุฏุงูุฉ ุชูุฑุงุฑูุฉ ุชุญุณุจ ุงููููุฉ ุงูุชุงููุฉ ููุฌููุน ูููููุชูู ุงูุณุงุจูุชูู.  ูู ูู ุฎุทูุฉ ุชุนูููุง.  ูู ูู ูุฑุฉ ุชุจุฏุฃ ูู ุฌุฏูุฏ ุ ุชุณูุฑ ุจููุณ ุงูุทุฑููุฉ ููุง ูุงูุช ูู ูุจู ุ ุจุงูุฅุถุงูุฉ ุฅูู ูุนูู ุฌุฏูุฏ. </p><br><p style=";text-align:right;direction:rtl">  ูุซุงู: <br>  ูููุชุฑุถ ุนูู = 6 ุ ุซู: <strong>1 1 2 3 5 8</strong> . <br>  ูุงูุขู ุนูู = 8 ุ ุซู: <strong>1 1 2 3 5 8</strong> 13 21. </p><br><p style=";text-align:right;direction:rtl">  ูููููุง ููุท ุฃู ูุชุฐูุฑ ุฃู ุงูุฃุนุถุงุก ุงูุณุชุฉ ุงูุฃูุงุฆู ูู <strong>1 1 2 3 5 8</strong> ุ ูุนูุฏูุง ูุทูุจูู ููุง ุฃู ูุญุณุจ ุฃูุซุฑ ููุง ูุชุฐูุฑ ุ ูุฅููุง ูุฃุฎุฐ ูุง ูุชุฐูุฑู ููุญุณุจ ููุท ูุง ูู ููููุฏ. </p></div></div><br><p style=";text-align:right;direction:rtl">  ุจูุฌุฑุฏ ุฃู ูููู <strong>RIP</strong> ูู ุจุฏุงูุฉ <strong>ููุจููุงุชุดู ()</strong> ุ ูููููุง ุงูุญุตูู ุนูู ูุณูุทุงุช ุงูุฏุงูุฉ.  ูุญู ูุนูู ุฃู ุงูุฏุงูุฉ ุชุฑุฌุน ูุชูุฌุฉ ุนูุฏูุง ุชุฎุฑุฌ ูู ุฏุงูุฉ.  ูุธุฑูุง ูุฃูู ูุง ูููููุง ุงูุนูู ูุน ูุนููุชูู ูู ููุช ูุงุญุฏ ุ ูุฅููุง ุจุญุงุฌุฉ ุฅูู ุชูุฏูุณ ูุฅุฑุฌุงุน ุงููุนููุงุช.  ุนูุฏูุง ูุฏุฎู <strong>ููุจููุงุชุดู () ุ</strong> ูุญุชุงุฌ ุฅูู ูุถุน ุงูุญุฌุฌ ุนูู ุงูููุฏุณ ุ ูููุชูุทูุง ุนูุฏ ุงูุฎุฑูุฌ.  ูุชุฎุฒูู ุงูุฃุฒูุงุฌ ุงููุญุณูุจุฉ ุ ูููููุง ุงุณุชุฎุฏุงู ุงููุงููุณ. </p><br><p style=";text-align:right;direction:rtl">  ููููุฉ ูุนุงูุฌุฉ ุฒูุฌ ูู ุงููููุ </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูู ุจุฏุงูุฉ ุงููุธููุฉ ุ ูููููุง ุงูุชุญูู ููุง ุฅุฐุง ูุงู ูุฐุง ุงูุฒูุฌ ูู ุงููุชุงุฆุฌ ุงูุชู ูุนุฑููุง ุจุงููุนู: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงู ููุงู ุ ููููููุง ุฅุฑุฌุงุน ูุฐุง ุงูุฒูุฌ.  ูุญุชุงุฌ ููุท ุฅูู ูุชุงุจุฉ ููู ุงูุฅุฑุฌุงุน ูู <strong>RAX</strong> ูุนูู ุนููุงู ุงูุงุฑุชุจุงุท ุ ุงูููุฌูุฏ ูู ุงููุณูุทุฉ ุงูุซุงููุฉ.  ูููู ุฃูุถูุง ุจุชุนููู ุนููุงู <strong>RIP</strong> ููุฎุฑูุฌ ูู ุงููุธููุฉ.  ูุง ูููููุง ุงุณุชุฎุฏุงู <strong>RET</strong> ูู <strong>ููุจููุงุชุดู ()</strong> ุ ูุธุฑูุง ูุฃู ูุฐู ุงูููุงููุงุช ููุตููุฉ ุ ูุฐุง ุณูุฃุฎุฐ ุจุนุถ <strong>RET</strong> ูู <strong>main ()</strong> ุ </li><li style=";text-align:right;direction:rtl">  ุฅุฐุง ูู ุชูู ูุฐู ุงูููู ุ ูุฅููุง ุจุจุณุงุทุฉ ูุถูููุง ุฅูู ุงูููุฏุณ. </li></ul></li><li style=";text-align:right;direction:rtl">  ูุจู ุงูุฎุฑูุฌ ูู ุงููุธููุฉ ุ ูููููุง ุญูุธ ุงูุฒูุฌ ุงูุฐู ุชู ุฅุฑุฌุงุนู.  ูุญู ูุนุฑู ุงูุญุฌุฌ ุงููุฏุฎูุงุช ุ ุญูุซ ูููููุง ูุฑุงุกุชูุง ูู ูุฌููุนุชูุง. </li></ul><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุชู ุชูุฏูู ูุฐุง ุงูุฑูุฒ ููุง.</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="python hljs">FIBONACCI_ENTRY = <span class="hljs-number"><span class="hljs-number">0x00400670</span></span> FIBONACCI_END = [ <span class="hljs-number"><span class="hljs-number">0x004006f1</span></span>, <span class="hljs-number"><span class="hljs-number">0x00400709</span></span>] instructions_skip_list = [<span class="hljs-number"><span class="hljs-number">0x004004ef</span></span>,<span class="hljs-number"><span class="hljs-number">0x004004f6</span></span>,<span class="hljs-number"><span class="hljs-number">0x00400502</span></span>,<span class="hljs-number"><span class="hljs-number">0x0040054f</span></span>] <span class="hljs-comment"><span class="hljs-comment">#     stack = [] # ,       d = {} def hook_code(mu, address, size, user_data): if address in instructions_skip_list: mu.reg_write(UC_X86_REG_RIP, address+size) #      elif address == 0x400560: c = mu.reg_read(UC_X86_REG_RDI) print(chr(c),end="") mu.reg_write(UC_X86_REG_RIP, address+size) #     ? elif address == FIBONACCI_ENTRY: #     RDI arg0 = mu.reg_read(UC_X86_REG_RDI) #    () r_rsi = mu.reg_read(UC_X86_REG_RSI) #   ,    arg1 = u32(mu.mem_read(r_rsi, 4)) # ,    ? if (arg0,arg1) in d: (ret_rax, ret_ref) = d[(arg0,arg1)] #     RAX mu.reg_write(UC_X86_REG_RAX, ret_rax) #     mu.mem_write(r_rsi, p32(ret_ref)) #  RIP  RET ,       fibonacci mu.reg_write(UC_X86_REG_RIP, 0x400582) else: #      ,      stack.append((arg0,arg1,r_rsi)) elif address in FIBONACCI_END: #     (arg0, arg1, r_rsi) = stack.pop() #     RAX ret_rax = mu.reg_read(UC_X86_REG_RAX) #  ,      ret_ref = u32(mu.mem_read(r_rsi,4)) #      d[(arg0, arg1)]=(ret_rax, ret_ref)</span></span></code> </pre></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููุง ูู ุงููุต ุจุฑูุชู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python # -*- coding: utf-8 -*- from __future__ import print_function from unicorn import * from unicorn.x86_const import * import struct def read(name): with open(name) as f: return f.read() def u32(data): return struct.unpack("I", data)[0] def p32(num): return struct.pack("I", num) FIBONACCI_ENTRY = 0x00400670 FIBONACCI_END = [ 0x004006f1, 0x00400709] instructions_skip_list = [0x004004ef,0x004004f6,0x00400502,0x0040054f] #     stack = [] # ,       d = {} def hook_code(mu, address, size, user_data): if address in instructions_skip_list: mu.reg_write(UC_X86_REG_RIP, address+size) #      elif address == 0x400560: c = mu.reg_read(UC_X86_REG_RDI) print(chr(c),end="") mu.reg_write(UC_X86_REG_RIP, address+size) #     ? elif address == FIBONACCI_ENTRY: #     RDI arg0 = mu.reg_read(UC_X86_REG_RDI) #    () r_rsi = mu.reg_read(UC_X86_REG_RSI) #   ,    arg1 = u32(mu.mem_read(r_rsi, 4)) # ,    ? if (arg0,arg1) in d: (ret_rax, ret_ref) = d[(arg0,arg1)] #     RAX mu.reg_write(UC_X86_REG_RAX, ret_rax) #     mu.mem_write(r_rsi, p32(ret_ref)) #  RIP  RET .     fibonacci mu.reg_write(UC_X86_REG_RIP, 0x400582) else: #      ,      stack.append((arg0,arg1,r_rsi)) elif address in FIBONACCI_END: #     (arg0, arg1, r_rsi) = stack.pop() #     RAX ret_rax = mu.reg_read(UC_X86_REG_RAX) #  ,      ret_ref = u32(mu.mem_read(r_rsi,4)) #      d[(arg0, arg1)]=(ret_rax, ret_ref) mu = Uc (UC_ARCH_X86, UC_MODE_64) BASE = 0x400000 STACK_ADDR = 0x0 STACK_SIZE = 1024*1024 mu.mem_map(BASE, 1024*1024) mu.mem_map(STACK_ADDR, STACK_SIZE) mu.mem_write(BASE, read("./fibonacci")) mu.reg_write(UC_X86_REG_RSP, STACK_ADDR + STACK_SIZE - 1) mu.hook_add(UC_HOOK_CODE, hook_code) mu.emu_start(0x004004e0, 0x00400575) print()</span></span></code> </pre></div></div><br><p style=";text-align:right;direction:rtl">  ุญุณููุง ุ ุชูููุง ุฃุฎูุฑูุง ูู ุชุญุณูู ุงูุชุทุจูู ุจุงุณุชุฎุฏุงู ูุญุฑู Unicorn.  ุนูู ุฌูุฏ! </p><br><h1 id="zametka" style=";text-align:right;direction:rtl">  ููุงุญุธุฉ </h1><br><p style=";text-align:right;direction:rtl">  ุงูุขู ูุฑุฑุช ุฃู ุฃุนุทูู ุงููููู ูู ุงููุงุฌุจุงุช ุงูููุฒููุฉ. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง ููููู ุงูุนุซูุฑ ุนูู</a> ุซูุงุซ ููุงู ุฃุฎุฑู ุ ููู ูููุง ุชูููุญ ูุญู ูุงูู.  ููููู ุฅููุงุก ูุธุฑุฉ ุฎุงุทูุฉ ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฑูุฉ ุงูุบุด</a> ุฃุซูุงุก ุญู ุงููุดููุงุช. </p><br><p style=";text-align:right;direction:rtl">  ูุงุญุฏุฉ ูู ุฃูุซุฑ ุงููุดุงูู ุงููุฒุนุฌุฉ ูู ุชุฐูุฑ ุงุณู ุงูุซุงุจุช ุงููุทููุจ.  ูู ุงูุณูู ุงูุชุนุงูู ูุน ูุฐุง ุฅุฐุง ููุช ุชุณุชุฎุฏู ุฅุถุงูุงุช Tab ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">IPython</a> .  ุนูุฏูุง ูููู ูุฏูู IPython ูุซุจุชูุง ุ ููููู ุงููุชุงุจุฉ <strong>ูู ุงุณุชูุฑุงุฏ unicorn UC_ARCH_</strong> ุงุถุบุท Tab ูุณุชุธูุฑ ูู ุฌููุน ุงูุซูุงุจุช ุงูุชู ุชุจุฏุฃ ุจููุณ ุงูุทุฑููุฉ. </p><p></p><p></p><p></p></li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar431058/">https://habr.com/ru/post/ar431058/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar431046/index.html">ููู ูุนูู ูุคุดุฑ Z ุจุงููุนู</a></li>
<li><a href="../ar431048/index.html">ุขูุฉ ุงูุญุฏุซ ุชุญุฑุณ ุฏูุฑุฉ ุงูุญูุงุฉ</a></li>
<li><a href="../ar431050/index.html">ููู ุงูููุงุก: ูู ุชูุนุฏู ุงูููุงู ูุคุซุฑ ุนูู ุฌูุฏุชู ุ ูููู ุณูุณุงุนุฏูุง ูููุงุณ TDSุ</a></li>
<li><a href="../ar431052/index.html">ุงููุงุฌูุฉ ุงูุฃูุงููุฉ DevDay: ุงูุฎุฑุงุฆุท ูุงููุฑู ูุงุณุชุนูุงูุงู</a></li>
<li><a href="../ar431056/index.html">USPACE: ุชูููุช ุงูุทุงุฆุฑุงุช ุจุฏูู ุทูุงุฑ</a></li>
<li><a href="../ar431060/index.html">ุงูุชุญุงู ุงููููุฉ ุงูุฃููุงููุฉ ูุน ุงููุตุงุฏูุฉ ุนุจุฑ ุงูุฅูุชุฑูุช ูุชูููู ุงููุงุฌุฆูู ูู ุฃููุงููุง</a></li>
<li><a href="../ar431064/index.html">ุจูุงู ูุจุฑูุฌ ุฌุงูุฏ</a></li>
<li><a href="../ar431066/index.html">DEFCON 16. ููู ูููููู ุงูุญุตูู ุนูููุ ุฏุนูู ุฃุณุฑุฏ ุงูุทุฑู. ุงูุฌุฒุก 2</a></li>
<li><a href="../ar431068/index.html">ูู ุงูุชุนููู: ุฃูุฏููููุฌูุฉ ูุงูููุงุช ุงูููุงุฑ</a></li>
<li><a href="../ar431070/index.html">ูุงุฑุง ุชุฃููุ ูุญู ูุชุญุฏุซ ุนู ุนุงุฏุงุช ุงูุฃูู ูุฃุฎุตุงุฆู ุชูููููุฌูุง ุงููุนูููุงุช ุงูุญุฏูุซ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>