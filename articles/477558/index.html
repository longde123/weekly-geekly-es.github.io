<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïö üë©üèº‚Äçü§ù‚Äçüë®üèΩ üÜï Huawei Cloud: Hoy est√° nublado en PVS-Studio üëé üòñ üòÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hoy en d√≠a todos conocen los servicios en la nube. Muchas empresas han descifrado este segmento del mercado y han creado sus propios servicios en la n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Huawei Cloud: Hoy est√° nublado en PVS-Studio</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/477558/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ac/bd2/47b/2acbd247b999e7f8e9e45f77181e2f06.png" alt="Imagen 2"></div><br>  Hoy en d√≠a todos conocen los servicios en la nube.  Muchas empresas han descifrado este segmento del mercado y han creado sus propios servicios en la nube con diversos fines.  Recientemente, nuestro equipo tambi√©n ha estado interesado en estos servicios en t√©rminos de integrar el analizador de c√≥digo PVS-Studio en ellos.  Lo m√°s probable es que nuestros lectores habituales ya hayan adivinado qu√© tipo de proyecto revisaremos esta vez.  La elecci√≥n recay√≥ en el c√≥digo de los servicios en la nube de Huawei. <br><a name="habracut"></a><br><h2>  Introduccion </h2><br>  Si est√° siguiendo las publicaciones del equipo PVS-Studio, probablemente haya notado que √∫ltimamente hemos estado profundizando en las tecnolog√≠as de la nube.  Ya hemos publicado varios art√≠culos sobre este tema: <br><br><ul><li>  <a href="https://www.viva64.com/en/b/0670/">PVS-Studio en las nubes: Azure DevOps</a> </li><li>  <a href="https://www.viva64.com/en/b/0636/">PVS-Studio en las nubes: Travis CI</a> </li><li>  <a href="https://www.viva64.com/en/b/0676/">PVS-Studio en las nubes: CircleCI</a> </li><li>  <a href="https://www.viva64.com/en/b/0686/">PVS-Studio en las nubes: GitLab CI / CD</a> </li></ul><br>  Justo cuando estaba buscando un proyecto inusual para el pr√≥ximo art√≠culo, recib√≠ un correo electr√≥nico con una oferta de trabajo de <a href="https://www.huawei.com/en/">Huawei</a> .  Despu√©s de recopilar informaci√≥n sobre esta compa√±√≠a, result√≥ que ten√≠an sus propios servicios en la nube, pero lo principal es que el c√≥digo fuente de estos servicios est√° disponible en GitHub.  Esta fue la raz√≥n principal para elegir esta compa√±√≠a para este art√≠culo.  Como dijo un sabio chino: "Los accidentes no son accidentales". <br><br>  D√©jame darte algunos detalles sobre nuestro analizador.  PVS-Studio es un analizador est√°tico para la detecci√≥n de errores en el c√≥digo fuente de los programas, escrito en C, C ++, C # y Java.  El analizador funciona en Windows, Linux y macOS.  Adem√°s de los complementos para entornos de desarrollo cl√°sicos, como Visual Studio o IntelliJ IDEA, el analizador tiene la capacidad de integrarse en SonarQube y Jenkins: <br><br><ul><li>  <a href="https://www.viva64.com/en/m/0037/">Integraci√≥n de los resultados del an√°lisis PVS-Studio en SonarQube</a> </li><li>  <a href="https://www.viva64.com/en/m/0048/">PVS-Studio corriendo en Jenkins</a> </li></ul><br><h2>  Analisis de proyecto </h2><br>  Cuando estaba investigando el art√≠culo, descubr√≠ que Huawei ten√≠a un <a href="https://developer.huaweicloud.com/en-us">centro de desarrolladores</a> con informaci√≥n disponible, manuales y fuentes de sus servicios en la nube.  Se utiliz√≥ una amplia variedad de lenguajes de programaci√≥n para crear estos servicios, pero los lenguajes m√°s populares fueron Go, Java y Python. <br><br>  Como me especializo en Java, los proyectos han sido seleccionados de acuerdo con mis conocimientos y habilidades.  Puede obtener fuentes de proyectos analizadas en el art√≠culo en un repositorio de GitHub <a href="https://github.com/huaweicloud/">huaweicloud</a> . <br><br>  Para analizar proyectos, solo necesitaba algunas cosas que hacer: <br><br><ul><li>  Obtenga proyectos del repositorio; </li><li>  Utilice las <a href="https://www.viva64.com/en/m/0044/">instrucciones de</a> inicio del analizador Java y ejecute el an√°lisis en cada proyecto. </li></ul><br>  Despu√©s de analizar los proyectos, seleccionamos solo tres de ellos, a los que nos gustar√≠a prestarles atenci√≥n.  Es por el hecho de que el tama√±o del resto de los proyectos de Java result√≥ ser demasiado peque√±o. <br><br>  Resultados del an√°lisis del proyecto (n√∫mero de advertencias y n√∫mero de archivos): <br><br><ul><li>  <a href="https://github.com/huaweicloud/huaweicloud-sdk-java">huaweicloud-sdk-java</a> : 31 - Alto, 2 - Medio y 16 - Bajo, m√°s de 2700 archivos. </li><li>  <a href="https://github.com/huaweicloud/huaweicloud-dis-agent">huaweicloud-dis-agent</a> : 7 - Alto, 6 - Medio y 6 - Bajo, m√°s de 100 archivos. </li><li>  <a href="https://github.com/huaweicloud/huaweicloud-sdk-java-dis">huaweicloud-sdk-java-dis</a> : 15 - Alto, 6 - Medio y 16 - Bajo, m√°s de 270 archivos. </li></ul><br>  Hubo pocas advertencias, lo que nos informa sobre la alta calidad del c√≥digo, sobre todo porque no todas las advertencias apuntan a errores reales.  Esto se debe al hecho de que el analizador a veces carece de informaci√≥n para distinguir el c√≥digo correcto del err√≥neo.  Por esta raz√≥n, ajustamos los diagn√≥sticos del analizador d√≠a a d√≠a recurriendo a la informaci√≥n de los usuarios.  Le invitamos a ver el art√≠culo " <a href="https://www.viva64.com/en/b/0488/">La forma en que los analizadores est√°ticos luchan contra los falsos positivos y por qu√© lo hacen</a> ". <br><br>  Al analizar el proyecto, eleg√≠ solo las advertencias m√°s populares, de las que hablar√© en este art√≠culo. <br><br><h2>  Orden de inicializaci√≥n de campos </h2><br>  El ciclo de inicializaci√≥n de la clase <a href="https://www.viva64.com/en/w/v6050/">V6050</a> est√° presente.  La inicializaci√≥n de 'INSTANCE' aparece antes de la inicializaci√≥n de 'LOG'.  UntrustedSSL.java (32), UntrustedSSL.java (59), UntrustedSSL.java (33) <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UntrustedSSL</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> UntrustedSSL INSTANCE = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UntrustedSSL(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger LOG = LoggerFactory.getLogger(UntrustedSSL.class); .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UntrustedSSL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { .... } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Throwable t) { LOG.error(t.getMessage(), t); <span class="hljs-comment"><span class="hljs-comment">// &lt;= } } }</span></span></code> </pre> <br>  Si hay alguna excepci√≥n en el constructor de la clase <i>UntrustedSSL</i> , la informaci√≥n sobre esta excepci√≥n se registra en el bloque <i>catch</i> utilizando el registrador <i>LOG</i> .  Sin embargo, debido al orden de inicializaci√≥n de los campos est√°ticos, en el momento de inicializar el campo <i>INSTANCE</i> , el <i>LOG</i> a√∫n no se ha inicializado.  Por lo tanto, si registra informaci√≥n sobre la excepci√≥n en el constructor, dar√° como resultado <i>NullPointerException</i> .  Esta excepci√≥n es la raz√≥n de otra excepci√≥n, <i>ExceptionInInitializerError</i> , que se genera si hubo una excepci√≥n cuando se inicializ√≥ el campo est√°tico.  Lo que necesita para resolver este problema es colocar la inicializaci√≥n de <i>LOG</i> antes de la inicializaci√≥n de <i>INSTANCE</i> <i>.</i> <br><br><h2>  Error tipogr√°fico discreto </h2><br>  <a href="https://www.viva64.com/en/w/v6005/">V6005</a> La variable 'this.metricSchema' se asigna a s√≠ misma.  OpenTSDBSchema.java (72) <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OpenTSDBSchema</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@JsonProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"metric"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;SchemaField&gt; metricSchema; .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setMetricsSchema</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;SchemaField&gt; metricsSchema)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.metricSchema = metricSchema; <span class="hljs-comment"><span class="hljs-comment">// &lt;= } public void setMetricSchema(List&lt;SchemaField&gt; metricSchema) { this.metricSchema = metricSchema; } .... }</span></span></code> </pre> <br>  Ambos m√©todos establecen el campo <i>metricSchema</i> , pero los nombres de los m√©todos difieren seg√∫n el s√≠mbolo 's'.  El programador nombr√≥ los argumentos de estos m√©todos de acuerdo con el nombre del m√©todo.  Como resultado, en la l√≠nea que se√±ala el analizador, el campo metricSchema se asigna a s√≠ mismo y no se utiliza el argumento del m√©todo metricsSchema. <br><br>  <a href="https://www.viva64.com/en/w/v6005/">V6005</a> La variable 'suspender' se asigna a s√≠ misma.  SuspendTransferTaskRequest.java (77) <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SuspendTransferTaskRequest</span></span></span><span class="hljs-class"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> suspend; .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setSuspend</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> suspend)</span></span></span><span class="hljs-function"> </span></span>{ suspend = suspend; } .... }</code> </pre> <br>  Aqu√≠ hay un error trivial relacionado con el descuido, debido a que el argumento de <i>suspensi√≥n</i> se asigna a s√≠ mismo.  Como resultado, al campo de <i>suspensi√≥n</i> no se le asignar√° el valor del argumento obtenido como est√° impl√≠cito.  La versi√≥n correcta: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setSuspend</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> suspend)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.suspend = suspend; }</code> </pre> <br><h2>  Condiciones predeterminadas </h2><br>  Como suele suceder, la regla <a href="https://www.viva64.com/en/w/v6007/">V6007</a> se rompe en t√©rminos de cantidad de advertencias. <br><br>  <a href="https://www.viva64.com/en/w/v6007/">V6007 La</a> expresi√≥n 'firewallPolicyId == null' siempre es falsa.  FirewallPolicyServiceImpl.java (125) <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> FirewallPolicy </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeFirewallRuleFromPolicy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String firewallPolicyId, String firewallRuleId)</span></span></span><span class="hljs-function"> </span></span>{ checkNotNull(firewallPolicyId); checkNotNull(firewallRuleId); checkState(!(firewallPolicyId == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; firewallRuleId == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>), <span class="hljs-string"><span class="hljs-string">"Either a Firewall Policy or Firewall Rule identifier must be set"</span></span>); .... }</code> </pre> <br>  En este m√©todo, el argumento <i>checkNotNull</i> verifica que los argumentos sean <i>nulos</i> : <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@CanIgnoreReturnValue</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkNotNull</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T reference)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (reference == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NullPointerException(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> reference; } }</code> </pre> <br>  Despu√©s de verificar el argumento mediante el m√©todo <i>checkNotNull</i> , puede estar 100% seguro de que el argumento pasado a este m√©todo no es igual a <i>nulo</i> .  Dado que ambos <i>m√©todos del</i> m√©todo <i>removeFirewallRuleFromPolicy</i> son verificados por el m√©todo <i>checkNotNull</i> , su verificaci√≥n adicional de <i>nulo</i> no tiene sentido.  Sin embargo, la expresi√≥n, donde los argumentos <i>firewallPolicyId</i> y <i>firewallRuleId</i> se vuelven a verificar para obtener un <i>valor nulo</i> , se pasa como primer argumento al m√©todo <i>checkState</i> . <br><br>  Tambi√©n se emite una advertencia similar para <i>firewallRuleId</i> : <br><br><ul><li>  V6007 La expresi√≥n 'firewallRuleId == null' siempre es falsa.  FirewallPolicyServiceImpl.java (125) </li></ul><br>  <a href="https://www.viva64.com/en/w/v6007/">V6007 La</a> expresi√≥n 'filteringParams! = Null' siempre es verdadera.  NetworkPolicyServiceImpl.java (60) <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Invocation&lt;NetworkServicePolicies&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildInvocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Map&lt;String, String&gt; filteringParams)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (filteringParams == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> servicePoliciesInvocation; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (filteringParams != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... } return servicePoliciesInvocation; }</span></span></code> </pre> <br>  En este m√©todo, si el argumento <i>filteringParams</i> es <i>nulo</i> , el m√©todo devuelve un valor.  Es por eso que la verificaci√≥n a la que apunta el analizador siempre ser√° verdadera, lo que, a su vez, significa que esta verificaci√≥n no tiene sentido. <br><br>  13 clases m√°s son similares: <br><br><ul><li>  V6007 La expresi√≥n 'filteringParams! = Null' siempre es verdadera.  PolicyRuleServiceImpl.java (58) </li><li>  V6007 La expresi√≥n 'filteringParams! = Null' siempre es verdadera.  GroupServiceImpl.java (58) </li><li>  V6007 La expresi√≥n 'filteringParams! = Null' siempre es verdadera.  ExternalSegmentServiceImpl.java (57) </li><li>  V6007 La expresi√≥n 'filteringParams! = Null' siempre es verdadera.  L3policyServiceImpl.java (57) </li><li>  V6007 La expresi√≥n 'filteringParams! = Null' siempre es verdadera.  PolicyRuleSetServiceImpl.java (58) </li><li>  y as√≠ sucesivamente ... </li></ul><br><h2>  Referencia nula </h2><br>  <a href="https://www.viva64.com/en/w/v6008/">V6008 Desreferencia</a> potencial nula de 'm.blockDeviceMapping'.  NovaServerCreate.java (390) <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ServerCreateBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">blockDevice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BlockDeviceMappingCreate blockDevice)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (blockDevice != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; m.blockDeviceMapping == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { m.blockDeviceMapping = Lists.newArrayList(); } m.blockDeviceMapping.add(blockDevice); <span class="hljs-comment"><span class="hljs-comment">// &lt;= return this; }</span></span></code> </pre> <br>  En este m√©todo, la inicializaci√≥n del campo de referencia <i>m.blockDeviceMapping</i> no ocurrir√° si el argumento <i>blockDevice</i> es <i>nulo</i> .  Este campo se inicializa solo en este m√©todo, por lo que al llamar al m√©todo <i>add</i> desde el campo <i>m.blockDeviceMapping</i> , se producir√° una <i>NullPointerException</i> . <br><br>  <a href="https://www.viva64.com/en/w/v6008/">V6008 Desreferencia</a> potencial nula de 'FileId.get (ruta)' en la funci√≥n '&lt;init&gt;'.  TrackedFile.java (140), TrackedFile.java (115) <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TrackedFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FileFlow&lt;?&gt; flow, Path path)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>(flow, path, FileId.get(path), ....); }</code> </pre> <br>  El constructor de la clase <i>TrackedFile</i> recibe el resultado del <i>m√©todo</i> est√°tico <i>FileId.get (ruta)</i> como un tercer argumento.  Pero este m√©todo puede devolver <i>nulo</i> : <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> FileId </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Path file)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Files.exists(file)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } .... }</code> </pre> <br>  En el constructor, llamado a trav√©s de <i>esto</i> , el argumento <i>id</i> no cambia hasta su primer uso: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TrackedFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...., ...., FileId id, ....)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ .... FileId newId = FileId.get(path); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!id.equals(newId)) { .... } }</code> </pre> <br>  Como podemos ver, si se pasa <i>nulo</i> como el tercer argumento del m√©todo, se producir√° una excepci√≥n. <br><br>  Aqu√≠ hay otro caso similar: <br><br><ul><li>  V6008 Desreferencia potencial nula de 'buffer'.  PublishingQueue.java (518) </li></ul><br>  <a href="https://www.viva64.com/en/w/v6008/">V6008 Desreferencia</a> potencial nula de 'dataTmpFile'.  CacheManager.java (91) <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">putToCache</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PutRecordsRequest putRecordsRequest)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dataTmpFile == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || !dataTmpFile.exists()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { dataTmpFile.createNewFile(); <span class="hljs-comment"><span class="hljs-comment">// &lt;= } catch (IOException e) { LOGGER.error("Failed to create cache tmp file, return.", e); return ; } } .... }</span></span></code> </pre> <br>  NPE nuevamente.  Una serie de comprobaciones en el operador condicional permite al objeto cero <i>dataTmpFile</i> para una mayor desreferencia.  Creo que hay dos errores tipogr√°ficos aqu√≠ y el cheque deber√≠a verse as√≠: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dataTmpFile != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; !dataTmpFile.exists())</code> </pre> <br><h2>  Subcadenas y n√∫meros negativos </h2><br>  <a href="https://www.viva64.com/en/w/v6009/">V6009</a> La funci√≥n 'subcadena' podr√≠a recibir el valor '-1' mientras se espera un valor no negativo.  Examine el argumento: 2. RemoveVersionProjectIdFromURL.java (37) <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String url)</span></span></span><span class="hljs-function"> </span></span>{ String urlRmovePojectId = url.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, url.lastIndexOf(<span class="hljs-string"><span class="hljs-string">"/"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> urlRmovePojectId.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, urlRmovePojectId.lastIndexOf(<span class="hljs-string"><span class="hljs-string">"/"</span></span>)); }</code> </pre> <br>  La implicaci√≥n es que este m√©todo obtiene una URL como una cadena, que no est√° validada de ninguna manera.  M√°s tarde, esta cadena se corta varias veces utilizando el m√©todo <i>lastIndexOf</i> .  Si el m√©todo <i>lastIndexOf</i> no encuentra una coincidencia en la cadena, devolver√° -1.  Esto conducir√° a <i>StringIndexOutOfBoundsException</i> , ya que los argumentos del m√©todo de <i>subcadena</i> tienen que ser n√∫meros no negativos.  Para la operaci√≥n correcta del m√©todo, uno tiene que agregar una validaci√≥n de argumento de entrada o verificar que los resultados del m√©todo <i>lastIndexOf</i> son n√∫meros no negativos. <br><br>  Aqu√≠ hay algunos otros fragmentos con una forma similar: <br><br><ul><li>  V6009 La funci√≥n 'subcadena' podr√≠a recibir el valor '-1' mientras se espera un valor no negativo.  Examine el argumento: 2. RemoveProjectIdFromURL.java (37) </li><li>  V6009 La funci√≥n 'subcadena' podr√≠a recibir el valor '-1' mientras se espera un valor no negativo.  Examine el argumento: 2. RemoveVersionProjectIdFromURL.java (38) </li></ul><br><h2>  Resultado olvidado </h2><br>  <a href="https://www.viva64.com/en/w/v6010/">V6010</a> Se requiere utilizar el valor de retorno de la funci√≥n 'concat'.  AKSK.java (278) <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildCanonicalHost</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(URL url)</span></span></span><span class="hljs-function"> </span></span>{ String host = url.getHost(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> port = url.getPort(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (port &gt; -<span class="hljs-number"><span class="hljs-number">1</span></span>) { host.concat(<span class="hljs-string"><span class="hljs-string">":"</span></span> + Integer.toString(port)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> host; }</code> </pre> <br>  Al escribir este c√≥digo, su autor no tuvo en cuenta que una llamada del m√©todo <i>concat</i> no cambiar√° la cadena de <i>host</i> debido a la inmutabilidad de los objetos de tipo <i>String</i> .  Para la operaci√≥n correcta del m√©todo, el resultado del m√©todo <i>concat</i> debe asignarse a la variable del <i>host</i> en el bloque <i>if</i> .  La versi√≥n correcta: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (port &gt; -<span class="hljs-number"><span class="hljs-number">1</span></span>) { host = host.concat(<span class="hljs-string"><span class="hljs-string">":"</span></span> + Integer.toString(port)); }</code> </pre> <br><h2>  Variables no utilizadas </h2><br>  <a href="https://www.viva64.com/en/w/v6021/">V6021 La</a> variable 'url' no se usa.  TriggerV2Service.java (95) <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deleteAllTriggersForFunction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String functionUrn)</span></span></span><span class="hljs-function"> </span></span>{ checkArgument(!Strings.isNullOrEmpty(functionUrn), ....); String url = ClientConstants.FGS_TRIGGERS_V2 + ClientConstants.URI_SEP + functionUrn; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> deleteWithResponse(uri(triggersUrlFmt, functionUrn)).execute(); }</code> </pre> <br>  En este m√©todo, la variable <i>url</i> no se usa despu√©s de su inicializaci√≥n.  Lo m√°s probable es que la variable <i>url</i> se pase al m√©todo <i>uri</i> como un segundo argumento en lugar de <i>functionUrn</i> , ya que la variable <i>functionUrn</i> participa en la inicializaci√≥n de la variable <i>url</i> . <br><br><h2>  Argumento no utilizado el constructor </h2><br>  <a href="https://www.viva64.com/en/w/v6022/">V6022 El</a> par√°metro 'returnType' no se usa dentro del cuerpo del constructor.  HttpRequest.java (68) <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HttpReQuest</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class">&gt; </span></span>{ .... Class&lt;R&gt; returnType; .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HttpRequest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...., Class&lt;R&gt; returnType)</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">// &lt;= { this.endpoint = endpoint; this.path = path; this.method = method; this.entity = entity; } .... public Class&lt;R&gt; getReturnType() { return returnType; } .... }</span></span></span></span></code> </pre> <br>  En este constructor, el programador olvid√≥ usar el argumento <i>returnType</i> y asign√≥ su valor al campo <i>returnType</i> .  Es por eso que al llamar al m√©todo <i>getReturnType</i> desde el objeto, creado por este constructor, se devolver√° <i>nulo</i> de forma predeterminada.  Pero lo m√°s probable es que el programador pretendiera obtener el objeto, previamente pasado al constructor. <br><br><h2>  La misma funcionalidad </h2><br>  <a href="https://www.viva64.com/en/w/v6032/">V6032</a> Es extra√±o que el cuerpo del m√©todo 'enable' sea completamente equivalente al cuerpo de otro m√©todo 'enable'.  ServiceAction.java (32), ServiceAction.java (36) <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceAction</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ModelEntity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String binary; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String host; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ServiceAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String binary, String host)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.binary = binary; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.host = host; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> ServiceAction </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">enable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String binary, String host)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// &lt;= return new ServiceAction(binary, host); } public static ServiceAction disable(String binary, String host) { // &lt;= return new ServiceAction(binary, host); } .... }</span></span></code> </pre> <br>  Tener dos m√©todos id√©nticos no es un error, pero el hecho de que dos m√©todos realicen la misma acci√≥n es al menos extra√±o.  Mirando los nombres de los m√©todos anteriores, podemos suponer que deben realizar las acciones opuestas.  De hecho, ambos m√©todos hacen lo mismo: crear y devolver el objeto <i>ServiceAction</i> .  Lo m√°s probable es que el m√©todo de <i>inhabilitaci√≥n</i> se haya creado copiando el c√≥digo del m√©todo de <i>habilitaci√≥n</i> , pero el cuerpo del m√©todo sigue siendo el mismo. <br><br><h2>  Olvid√© comprobar lo principal </h2><br>  <a href="https://www.viva64.com/en/w/v6060/">V6060</a> La referencia de 'params' se utiliz√≥ antes de que se verificara contra nulo.  DomainService.java (49), DomainService.java (46) <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Domains </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">list</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Map&lt;String, String&gt; params)</span></span></span><span class="hljs-function"> </span></span>{ Preconditions.checkNotNull(params.get(<span class="hljs-string"><span class="hljs-string">"page_size"</span></span>), ....); Preconditions.checkNotNull(params.get(<span class="hljs-string"><span class="hljs-string">"page_number"</span></span>), ....); Invocation&lt;Domains&gt; domainInvocation = get(Domains.class, uri(<span class="hljs-string"><span class="hljs-string">"/domains"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (params != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... } return domainInvocation.execute(this.buildExecutionOptions(Domains.class)); }</span></span></code> </pre> <br>  En este m√©todo, el autor decidi√≥ verificar el contenido de una estructura del tipo <i>Mapa</i> para <i>nulo</i> .  Para hacer esto, el m√©todo <i>get</i> se llama dos veces desde el argumento <i>params</i> .  El resultado del m√©todo <i>get</i> se pasa al m√©todo <i>checkNotNull</i> .  ¬°Todo parece l√≥gico, pero no es as√≠!  El argumento <i>params</i> se verifica para <i>nulo</i> en <i>if</i> .  Despu√©s de esto, se espera que el argumento de entrada sea <i>nulo</i> , pero antes de esta comprobaci√≥n, el m√©todo <i>get</i> ya se ha llamado dos veces desde <i>params.</i>  Si se pasa <i>nulo</i> como argumento a este m√©todo, la primera vez que llame al m√©todo <i>get</i> , se generar√° una excepci√≥n. <br><br>  Una situaci√≥n similar ocurre en otros tres lugares: <br><br><ul><li>  V6060 La referencia de 'params' se utiliz√≥ antes de que se verificara contra nulo.  DomainService.java (389), DomainService.java (387) </li><li>  V6060 La referencia de 'params' se utiliz√≥ antes de que se verificara contra nulo.  DomainService.java (372), DomainService.java (369) </li><li>  V6060 La referencia de 'params' se utiliz√≥ antes de que se verificara contra nulo.  DomainService.java (353), DomainService.java (350) </li></ul><br><h2>  Conclusi√≥n </h2><br>  Las grandes empresas de hoy no pueden prescindir del uso de servicios en la nube.  Una gran cantidad de personas utilizan estos servicios.  Desde este punto de vista, incluso un peque√±o error en un servicio puede generar problemas para muchas personas, as√≠ como p√©rdidas adicionales, acumuladas por una empresa para remediar las consecuencias adversas de este error.  Las fallas humanas siempre deben tenerse en cuenta, especialmente porque tarde o temprano todos cometen errores, como se describe en este art√≠culo.  Este hecho confirma el uso de todas las herramientas posibles para mejorar la calidad del c√≥digo. <br><br>  PVS-Studio definitivamente informar√° a la compa√±√≠a Huawei sobre los resultados de verificar sus servicios en la nube para que los desarrolladores de Huawei puedan detenerse en ellos, porque el uso √∫nico del an√°lisis de c√≥digo est√°tico cubierto por estos art√≠culos ( <a href="https://www.viva64.com/en/b/0594/">1</a> , <a href="https://www.viva64.com/en/b/0639/">2</a> ) no puede demostrar completamente Todas sus ventajas.  Puede descargar el analizador PVS-Studio <a href="https://www.viva64.com/en/pvs-studio-download/">aqu√≠</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/477558/">https://habr.com/ru/post/477558/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../477544/index.html">C√≥mo crear un juego 2D con Python y una biblioteca arcade</a></li>
<li><a href="../477548/index.html">Aprende Bootstrap con 10 consejos √∫tiles</a></li>
<li><a href="../477550/index.html">SPS-2019 en el Centro de Exposiciones de Nuremberg</a></li>
<li><a href="../477552/index.html">Las pruebas realizadas por Ryzen Threadripper 3960X y 3970X mostraron que son CPU realmente revolucionarias</a></li>
<li><a href="../477554/index.html">La zona de dominio .ORG se vende a una empresa privada. El p√∫blico llama a ICANN a rescindir el contrato</a></li>
<li><a href="../477560/index.html">Cambia tu mentalidad con SwiftUI</a></li>
<li><a href="../477562/index.html">Dise√±o de interfaz para el juego, dibuja un paquete de iconos</a></li>
<li><a href="../477564/index.html">Clientes complejos: c√≥mo proteger a su equipo de ellos</a></li>
<li><a href="../477566/index.html">Huawei Cloud: hoy est√° nublado en PVS-Studio</a></li>
<li><a href="../477568/index.html">El servicio es f√°cil devoluci√≥n incondicional. Correo ruso</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>