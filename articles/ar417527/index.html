<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ค๐ป ๐ค ๐ ูููู ุจุชุทููุฑ ุงูุฌูุจุฑู: ูุชุญูู ูู ุงูุทูุจุงุช ุงูููุงุฒูุฉ ุ ููููู ุจุชุณุฌูู ุงูุฏุฎูู ูู ุฎูุงู spdlog ูุงููุฒูุฏ ... ๐ฉ๐ปโโ๏ธ ๐ฉ๐ปโ๐ซ โน๐พ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูู ุงูุฃุณุจูุน ุงููุงุถู ุ ุชุญุฏุซูุง ุนู ูุดุฑูุนูุง ุงูุชุฌุฑูุจู ุงูุตุบูุฑ ุ Shrimp ุ ูุงูุฐู ููุถุญ ุจูุถูุญ ููู ููููู ุงุณุชุฎุฏุงู ููุชุจุงุช C ++ RESTinio ู SObjectizer ูู ุธุฑูู ูุดุงุจูุฉ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ูููู ุจุชุทููุฑ ุงูุฌูุจุฑู: ูุชุญูู ูู ุงูุทูุจุงุช ุงูููุงุฒูุฉ ุ ููููู ุจุชุณุฌูู ุงูุฏุฎูู ูู ุฎูุงู spdlog ูุงููุฒูุฏ ...</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417527/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/6p/er/na/6pernaqwjoqg3picsc4pz2d1xba.jpeg"><br><br>  ูู ุงูุฃุณุจูุน ุงููุงุถู ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุญุฏุซูุง ุนู ูุดุฑูุนูุง ุงูุชุฌุฑูุจู ุงูุตุบูุฑ ุ Shrimp</a> ุ ูุงูุฐู ููุถุญ ุจูุถูุญ ููู ููููู ุงุณุชุฎุฏุงู ููุชุจุงุช C ++ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">RESTinio</a> ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">SObjectizer</a> ูู ุธุฑูู ูุดุงุจูุฉ ุชูุฑูุจูุง.  Shrimp ูู ุชุทุจูู C ++ 17 ุตุบูุฑ ููุจู ูู ุฎูุงู RESTinio ุทูุจุงุช HTTP ูุชุบููุฑ ุญุฌู ุงูุตูุฑุฉ ููุฎุฏู ูุฐู ุงูุทูุจุงุช ูู ูุถุน ูุชุนุฏุฏ ุงูุฎููุท ูู ุฎูุงู SObjectizer ู ImageMagick ++. <br><br>  ุชุจูู ุฃู ุงููุดุฑูุน ุฃูุซุฑ ูู ูููุฏ ููุง.  ููุฏ ุชู ุชุฌุฏูุฏ ุจูู ุฃุตุจุน ุงููุงุฆูุฉ ุงูููุถูุฉ ูุชูุณูุน ูุธุงุฆู RESTinio ู SObjectizer ุจุดูู ูุจูุฑ.  ุดูุก ุชู ุชุฌุณูุฏู ุญุชู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฅุตุฏุงุฑ ุญุฏูุซ</a> ุฌุฏูุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูู RESTinio-0.4.7</a> .  ูุฐูู ูุฑุฑูุง ุนุฏู ุงูุชุทุฑู ุฅูู ุงูุฅุตุฏุงุฑ ุงูุฃูู ูุงูุฃูุซุฑ ุชุงูููุง ูู ุงูุฑูุจูุงู ุ ูููู ุงูููุงู ุจุชูุฑุงุฑ ุฃู ุงุซููู ุขุฎุฑูู ุญูู ูุฐุง ุงููุดุฑูุน.  ุฅุฐุง ูุงู ุดุฎุต ูุง ููุชููุง ุจูุง ูุนููุงู ูููู ูุนููุงู ุฎูุงู ูุฐุง ุงูููุช ุ ูุฃูุช ูุฑุญุจ ุจู ุชุญุช ุงููุท. <br><blockquote style=";text-align:right;direction:rtl">  ูููุณุฏ: ุณูููู ุงูุฃูุฑ ุญูู ููููุฉ ุงูุชุฎูุต ูู ุงููุนุงูุฌุฉ ุงููุชูุงุฒูุฉ ููุทูุจุงุช ุงููุชุทุงุจูุฉ ุ ูููู ุฃุถููุง ุชุณุฌูู ุงูุฏุฎูู ุฅูู Shrimp ุจุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุชุจุฉ spdlog ุงูููุชุงุฒุฉ ุ ูุฃุตุฏุฑูุง</a> ุฃูุถูุง ุฃูุฑูุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุจูุฑุถ</a> ุฅุนุงุฏุฉ ุชุนููู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ููุตูุฑ ุงููุญููุฉ. </blockquote><a name="habracut"></a><h1 style=";text-align:right;direction:rtl">  v0.3: ุงูุชุญูู ูู ุงููุนุงูุฌุฉ ุงููุชูุงุฒูุฉ ููุทูุจุงุช ุงููุชุทุงุจูุฉ </h1><br>  ุงููุณุฎุฉ ุงูุฃููู ูู ุงูุฑูุจูุงู ุ ุงูููุตููุฉ ูู ููุงู ุณุงุจู ุ ุชุญุชูู ุนูู ุชุจุณูุท ุฎุทูุฑ: ูู ููู ููุงู ุณูุทุฑุฉ ุนูู ูุง ุฅุฐุง ูุงู ููุณ ุงูุทูุจ ููุฏ ุงููุนุงูุฌุฉ ุญุงูููุง ุฃู ูุง. <br><br>  ุชุฎูู ุฃูู ูุฃูู ูุฑุฉ ูุชููู ุงูุฌูุจุฑู ุทูุจูุง ูู ุงููููุฐุฌ "/demo.jpgุop=resize&amp;max=1024".  ูุง ุชูุฌุฏ ูุซู ูุฐู ุงูุตูุฑุฉ ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ููุตูุฑ ุงููุญููุฉ ุจุนุฏ ุ ูุฐูู ุชุชู ูุนุงูุฌุฉ ุงูุทูุจ.  ูููู ุฃู ุชุณุชุบุฑู ุงููุนุงูุฌุฉ ููุชูุง ุทูููุงู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุจุถุน ูุฆุงุช ูู ุงููููู ุซุงููุฉ. <br><br>  ูู ุชูุชูู ูุนุงูุฌุฉ ุงูุทูุจ ุจุนุฏ ุ ููุชููู ุงูุฌูุจุฑู ูุฑุฉ ุฃุฎุฑู ููุณ ุงูุทูุจ "/demo.jpgุop=resize&amp;max=1024" ุ ูููู ูู ุนููู ุขุฎุฑ.  ูุง ุชูุฌุฏ ูุชุงุฆุฌ ุชุญููู ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุญุชู ุงูุขู ุ ูุจุงูุชุงูู ุณุชุชู ูุนุงูุฌุฉ ูุฐุง ุงูุทูุจ ุฃูุถูุง. <br><br>  ูู ููุชูู ุงูุทูุจ ุงูุฃูู ููุง ุงูุซุงูู ุญุชู ุงูุขู ุ ููููู ููุฑูุจูุงู ูุฑุฉ ุฃุฎุฑู ุชููู ููุณ ุงูุทูุจ "/demo.jpgุop=resize&amp;max=1024".  ูุณุชุชู ูุนุงูุฌุฉ ูุฐุง ุงูุทูุจ ุฃูุถูุง.  ุงุชุถุญ ุฃู ุงูุตูุฑุฉ ููุณูุง ูุชู ุชุญุฌูููุง ุฅูู ููุณ ุงูุญุฌู ุจุงูุชูุงุฒู ุนุฏุฉ ูุฑุงุช. <br><br>  ูุฐุง ููุณ ุฌูุฏูุง.  ูุฐูู ุ ูุงู ุฃูู ุดูุก ูุฑุฑูุงู ูู Shrimp ูู ุงูุชุฎูุต ูู ูุซู ูุฐู ุงูุฏุนุงูุฉ ุงูุฎุทูุฑุฉ.  ููุฏ ูุนููุง ุฐูู ุจุณุจุจ ุญุงููุชูู ุตุนุจุชูู ูู ูููู convert_manager.  ุงูุญุงููุฉ ุงูุฃููู ูู ูุงุฆูุฉ ุงูุชุธุงุฑ ุงูุชุธุงุฑ ุทูุจุงุช ุงููุญููุงุช ุงููุฌุงููุฉ.  ูุฐู ุญุงููุฉ ุจุงุณู m_pending_requests.  ูุฎุฒู ุงูุญุงููุฉ ุงูุซุงููุฉ ุงูุทูุจุงุช ุงูุชู ุชูุช ูุนุงูุฌุชูุง ุจุงููุนู (ุฃู ุชู ุชุฎุตูุต ูุญููุงุช ูุญุฏุฏุฉ ููุฐู ุงูุทูุจุงุช).  ูุฐู ุญุงููุฉ ุจุงุณู m_inprogress_requests. <br><br>  ุนูุฏูุง ูุชููู convert_manager ุงูุทูุจ ุงูุชุงูู ุ ูุฅูู ูุชุญูู ูู ูุฌูุฏ ุงูุตูุฑุฉ ุงูููุงุฆูุฉ ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ููุตูุฑ ุงููุญููุฉ.  ูู ุญุงูุฉ ุนุฏู ูุฌูุฏ ุตูุฑุฉ ูุญููุฉ ุ ูุชู ุงูุชุญูู ูู ุญุงููุงุช m_inprogress_requests ู m_pending_requests.  ูุฅุฐุง ูู ููู ููุงู ุทูุจ ุจูุซู ูุฐู ุงููุนููุงุช ูู ุฃู ูู ูุฐู ุงูุญุงููุงุช ุ ูุณูุชู ููุท ูุญุงููุฉ ููุถุน ุงูุทูุจ ูู ูุงุฆูุฉ ุงูุชุธุงุฑ m_pending_requests.  ูุจุฏู <a href="">ูุฐุง</a> : <br><br><pre style=";text-align:right;direction:rtl"><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">a_transform_manager_t</span></span>::handle_not_transformed_image( transform::<span class="hljs-keyword"><span class="hljs-keyword">resize_request_key_t</span></span> request_key, <span class="hljs-keyword"><span class="hljs-keyword">sobj_shptr_t</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">resize_request_t</span></span>&gt; cmd ) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> store_to = [&amp;](<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> &amp; <span class="hljs-built_in"><span class="hljs-built_in">queue</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">queue</span></span>.insert( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(request_key), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(cmd) ); }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( m_inprogress_requests.has_key( request_key ) ) { <span class="hljs-comment"><span class="hljs-comment">//    . //         . store_to( m_inprogress_requests ); } else if( m_pending_requests.has_key( request_key ) ) { //      . store_to( m_pending_requests ); } else if( m_pending_requests.unique_keys() &lt; max_pending_requests ) { //           . store_to( m_pending_requests ); //    transformer-     . try_initiate_pending_requests_processing(); } else { //  ,   . do_503_response( std::move(cmd-&gt;m_http_req) ); } }</span></span></code> </pre> <br>  ููู ุฃุนูุงู ุฃู m_inprogress_requests ู m_pending_requests ูู ุญุงููุงุช ุตุนุจุฉ.  ููู ูุง ูู ุงูุญููุฉุ <br><br>  ุงูุญููุฉ ูู ุฃู ูุฐู ุงูุญุงููุงุช ุชุฌูุน ุจูู ุฎุตุงุฆุต ูู ูู ูุงุฆูุฉ ุงูุชุธุงุฑ FIFO ุงูุนุงุฏูุฉ (ุงูุชู ูุชู ูููุง ุงูุญูุงุธ ุนูู ุงูุชุฑุชูุจ ุงูุฒููู ูุฅุถุงูุฉ ุงูุนูุงุตุฑ) ูุงูุฎุฑูุทุฉ ุงููุชุนุฏุฏุฉ ุ ุฃู  ุญุงููุฉ ุชุฌููุนูุฉ ูููู ูููุง ุชุนููู ููู ูุชุนุฏุฏุฉ ูููุชุงุญ ูุงุญุฏ. <br><br>  ูู ุงูููู ุงูุงุญุชูุงุธ ุจุงูุชุฑุชูุจ ุงูุฒููู ุ ูุฃู ุงูุนูุงุตุฑ ุงูุฃูุฏู ูู m_pending_requests ุชุญุชุงุฌ ุฅูู ูุญุต ุฏูุฑู ูุฅุฒุงูุชูุง ูู m_pending_requests ุชูู ุงูุทูุจุงุช ุงูุชู ุชู ุชุฌุงูุฒ ุงูุญุฏ ุงูุฃูุตู ูููููุฉ ุงูุฒูููุฉ ููุง.  ูููุงู ุญุงุฌุฉ ุฅูู ุงููุตูู ุงููุนุงู ููุนูุงุตุฑ ุนู ุทุฑูู ุงูููุชุงุญ ููุชุญูู ูู ูุฌูุฏ ุทูุจุงุช ูุชุทุงุจูุฉ ูู ููุงุฆู ุงูุงูุชุธุงุฑ ุ ูุจุงูุชุงูู ูููู ุฅุฒุงูุฉ ุฌููุน ุงูุทูุจุงุช ุงูููุฑุฑุฉ ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ูู ูู ูุฑุฉ. <br><br>  ูู Shrimp ุ ูููุง ุจุชุฏููุฑ <a href="">ุงูุญุงููุฉ ุงูุตุบูุฑุฉ</a> ุงูุฎุงุตุฉ ุจูุง ููุฐู ุงูุฃุบุฑุงุถ.  ุนูู ุงูุฑุบู ูู ุฃูู ุฅุฐุง ุชู ุงุณุชุฎุฏุงู Boost ูู ุงูุฑูุจูุงู ุ ููููู ุงุณุชุฎุฏุงู Boost.MultiIndex.  ูุฑุจูุง ุ ุจูุฑูุฑ ุงูููุช ุ ูุฌุจ ุชูุธูู ุงูุจุญุซ ุงููุนุงู ูู m_pending_requests ููููุง ูุจุนุถ ุงููุนุงููุฑ ุงูุฃุฎุฑู ุ ุซู ูุฌุจ ุชูุดูุท Boost.MultiIndex in Shrimp. <br><br><h1 style=";text-align:right;direction:rtl">  v0.4: ุชุณุฌูู ุงูุฏุฎูู ุจุงุณุชุฎุฏุงู spdlog </h1><br>  ุญุงูููุง ุชุฑู ุงููุณุฎุฉ ุงูุฃููู ูู ุงูุฌูุจุฑู ุจุณูุทุฉ ููุถุบูุทุฉ ูุฏุฑ ุงูุฅููุงู.  ุจุณุจุจ ูุง ูู ูุณุชุฎุฏูู ูู ุงูุฅุตุฏุงุฑ ุงูุฃูู ูู ุงูุฑูุจูุงู.  ุจุดูู ุนุงู. <br><br>  ูู ูุงุญูุฉ ุ ุฌุนู ูุฐุง ูู ุงููููู ุฅุจูุงุก ููุฏ ุงููุณุฎุฉ ุงูุฃููู ููุฌุฒุง ุ ูุงูุฐู ูุง ูุญุชูู ุณูู ุนูู ููุทู ุงูุฃุนูุงู ุงูุฌูุจุฑู ุงูุถุฑูุฑู.  ูููู ุ ูู ูุงุญูุฉ ุฃุฎุฑู ุ ูุฅู ุนุฏู ูุฌูุฏ ูุทุน ุงูุฃุดุฌุงุฑ ูุนูุฏ ุชุทูุฑ ุงูุฑูุจูุงู ูุชุดุบููู.  ูุฐูู ุ ุจูุฌุฑุฏ ุฃู ูุถุนูุง ุฃูุฏููุง ุนูููุง ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุณุญุจูุง</a> ุนูู ุงูููุฑ ุฅูู Shrimp ููุชุจุฉ ููุชุงุฒุฉ ุญุฏูุซุฉ C ++ ูุชุณุฌูู ุงูุฏุฎูู - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">spdlog</a> .  ุฃุตุจุญ ุงูุชููุณ ุฃุณูู ุนูู ุงูููุฑ ุ ุนูู ุงูุฑุบู ูู ููู ุญุฌู ุจุนุถ ุงูุทุฑู. <br><br>  ุนูู ุณุจูู ุงููุซุงู ุ ูุจุฏุฃ ุงูููุฏ ุฃุนูุงู ูุทุฑููุฉ handle_not_transformed_image () ูุน ุงูุชุณุฌูู ููุจุฏู ูุงูุชุงูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">a_transform_manager_t</span></span>::handle_not_transformed_image( transform::<span class="hljs-keyword"><span class="hljs-keyword">resize_request_key_t</span></span> request_key, <span class="hljs-keyword"><span class="hljs-keyword">sobj_shptr_t</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">resize_request_t</span></span>&gt; cmd ) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> store_to = [&amp;](<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> &amp; <span class="hljs-built_in"><span class="hljs-built_in">queue</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">queue</span></span>.insert( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(request_key), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(cmd) ); }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( m_inprogress_requests.has_key( request_key ) ) { <span class="hljs-comment"><span class="hljs-comment">//    . m_logger-&gt;debug( "same request is already in progress; request_key={}", request_key ); //         . store_to( m_inprogress_requests ); } else if( m_pending_requests.has_key( request_key ) ) { //      . m_logger-&gt;debug( "same request is already pending; request_key={}", request_key ); store_to( m_pending_requests ); } else if( m_pending_requests.unique_keys() &lt; max_pending_requests ) { //           . m_logger-&gt;debug( "store request to pending requests queue; request_key={}", request_key ); store_to( m_pending_requests ); //    transformer-     . try_initiate_pending_requests_processing(); } else { //  ,   . m_logger-&gt;warn( "request is rejected because of overloading; " "request_key={}", request_key ); do_503_response( std::move(cmd-&gt;m_http_req) ); } }</span></span></code> </pre> <br><h2 style=";text-align:right;direction:rtl">  ุชูููู ูุณุฌูุงุช spdlog </h2><br>  ูุชู ุชุณุฌูู ุงูุฑูุจูุงู ุนูู ูุญุฏุฉ ุงูุชุญูู (ุฃู ูู ุฏูู ุงูุฅุฎุฑุงุฌ ุงูููุงุณู).  ูู ุญูุซ ุงููุจุฏุฃ ุ ูููู ูููุฑุก ุฃู ูุณูุฑ ูู ูุณุงุฑ ุจุณูุท ููุบุงูุฉ ูุฃู ูุฎูู ูู Shrimp ุงููุซูู ุงููุญูุฏ ููุณุฌู spd.  ุนูู ุณุจูู ุงููุซุงู  ูููู ูููุฑุก ุงุณุชุฏุนุงุก <a href="">stdout_color_mt</a> (ุฃู <a href="">stdout_logger_mt</a> ) ุ ุซู ุชูุฑูุฑ ูุฐุง ุงููุณุฌู ุฅูู ุฌููุน ุงูููุงูุงุช ูู Shrimp.  ููููุง ุฐูุจูุง ุจุทุฑููุฉ ุฃูุซุฑ ุชุนููุฏูุง: ููุฏ ุฃูุดุฃูุง ูุง ูุณูู ูุฏูููุง  sink (ุฃู ุงูููุงุฉ ุญูุซ ุณุชุฎุฑุฌ spdlog ุงูุฑุณุงุฆู ุงูุชู ุชู ุฅูุดุงุคูุง) ุ ูููุงูุงุช ุงูุฑูุจูุงู ูุงููุง ุจุฅูุดุงุก ุณุฌูุงุช ูููุตูุฉ ููุญูุฉ ุจูุฐุง ุงูุญูุถ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//     . [[nodiscard]] spdlog::sink_ptr make_logger_sink() { auto sink = std::make_shared&lt; spdlog::sinks::ansicolor_stdout_sink_mt &gt;(); return sink; } [[nodiscard]] std::shared_ptr&lt;spdlog::logger&gt; make_logger( const std::string &amp; name, spdlog::sink_ptr sink, spdlog::level::level_enum level = spdlog::level::trace ) { auto logger = std::make_shared&lt; spdlog::logger &gt;( name, std::move(sink) ); logger-&gt;set_level( level ); logger-&gt;flush_on( level ); return logger; } //        : auto manager = coop.make_agent_with_binder&lt; a_transform_manager_t &gt;( create_one_thread_disp( "manager" )-&gt;binder(), make_logger( "manager", logger_sink ) ); ... const auto worker_name = fmt::format( "worker_{}", worker ); auto transformer = coop.make_agent_with_binder&lt; a_transformer_t &gt;( create_one_thread_disp( worker_name )-&gt;binder(), make_logger( worker_name, logger_sink ), app_params.m_storage );</span></span></code> </pre><br>  ููุงู ููุทุฉ ุฏูููุฉ ูุน ุชูููู ุฃุฏูุงุช ุชุณุฌูู ุงูุฏุฎูู ูู spdlog: ุงูุชุฑุงุถููุง ุ ูุชุฌุงูู ุงููุณุฌู ุงูุฑุณุงุฆู ุฐุงุช ูุณุชููุงุช ุฎุทูุฑุฉ ุงูุชุตุญูุญ ูุงูุชุชุจุน.  ููู ุฃุซุจุชุช ุฃููุง ูููุฏุฉ ููุบุงูุฉ ุนูุฏ ุชุตุญูุญ ุงูุฃุฎุทุงุก.  ูุฐูู ุ ูู make_logger ุ ูููู ุงูุชุฑุงุถููุง ุจุชูููู ุงูุชุณุฌูู ูุฌููุน ุงููุณุชููุงุช ุ ุจูุง ูู ุฐูู ุงูุชุชุจุน / ุงูุชุตุญูุญ. <br><br>  ูุธุฑูุง ูุญูููุฉ ุฃู ูู ููุงู ูู ุงูุฌูุจุฑู ูุฏูู ูุณุฌู ุฎุงุต ุจู ุจุงุณูู ุงูุฎุงุต ุ ูููููุง ุฃู ูุฑู ูู ููุนู ูุง ูู ุงูุณุฌู: <br><br><img src="https://habrastorage.org/webt/1o/jh/yx/1ojhyxgywovfstlfsybe19h0lb0.png"><br><br><h2 style=";text-align:right;direction:rtl">  ุชุชุจุน SObjectizer ูุน spdlog </h2><br>  ุฃููุงุช ุงูุชุณุฌูู ุ ุงูุชู ูุชู ุชูููุฐูุง ูุฌุฒุก ูู ููุทู ุงูุฃุนูุงู ุงูุฑุฆูุณู ูุชุทุจูู SObjectizer ุ ููุณุช ูุงููุฉ ูุชุตุญูุญ ุงูุชุทุจูู.  ููุณ ูู ุงููุงุถุญ ุณุจุจ ุจุฏุก ุฅุฌุฑุงุก ูุง ูู ุฃุญุฏ ุงูุนูุงูู ุ ูููู ูุง ูุชู ุชูููุฐู ูุนูููุง ูู ูููู ุขุฎุฑ.  ูู ูุฐู ุงูุญุงูุฉ ุ ุชุณุงุนุฏ ุขููุฉ msg_tracing ุงููุถููุฉ ูู SObjectizer ูุซูุฑูุง (ูุงูุฐู ุชุญุฏุซูุง ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูู ููุงูุฉ ูููุตูุฉ</a> ).  ูููู ูู ุจูู ุชุทุจููุงุช msg_tracing ุงูููุงุณูุฉ ูู SObjectizer ุ ูุง ููุฌุฏ ุชุทุจูู ูุณุชุฎุฏู spdlog.  ุณููุนู ูุฐุง ุงูุชูููุฐ ูุฑูุจูุงู ุฃููุณูุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">spdlog_sobj_tracer_t</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> so_5::msg_tracing::<span class="hljs-keyword"><span class="hljs-keyword">tracer_t</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;spdlog::logger&gt; m_logger; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">spdlog_sobj_tracer_t</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;spdlog::logger&gt; logger ) : m_logger{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(logger) } {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">trace</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; what )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> override </span></span>{ m_logger-&gt;trace( what ); } [[nodiscard]] <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> so_5::msg_tracing::<span class="hljs-keyword"><span class="hljs-keyword">tracer_unique_ptr_t</span></span> make( spdlog::sink_ptr sink ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::make_unique&lt;<span class="hljs-keyword"><span class="hljs-keyword">spdlog_sobj_tracer_t</span></span>&gt;( make_logger( <span class="hljs-string"><span class="hljs-string">"sobjectizer"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(sink) ) ); } };</code> </pre> <br>  ููุง ูุฑู ุชูููุฐ ูุงุฌูุฉ SObjectizer ุงูุฎุงุตุฉ tracer_t ุ ุญูุซ ูููู ุงูุดูุก ุงูุฑุฆูุณู ูู ุทุฑููุฉ ุงูุชุชุจุน ุงูุธุงูุฑู ().  ูู ุงูุฐู ูููู ุจุชุชุจุน ุงูุฃุฌุฒุงุก ุงูุฏุงุฎููุฉ ูู SObjectizer ุจุงุณุชุฎุฏุงู spdlog. <br><br>  ุจุนุฏ ุฐูู ุ ูุชู ุชุซุจูุช ูุฐุง ุงูุชุทุจูู ููุชุชุจุน ุนูุฏ ุจุฏุก SObjectizer: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">so_5::<span class="hljs-keyword"><span class="hljs-keyword">wrapped_env_t</span></span> sobj{ [&amp;]( so_5::<span class="hljs-keyword"><span class="hljs-keyword">environment_t</span></span> &amp; env ) {...}, [&amp;]( so_5::<span class="hljs-keyword"><span class="hljs-keyword">environment_params_t</span></span> &amp; params ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">sobj_tracing_t</span></span>::on == sobj_tracing ) params.message_delivery_tracer( <span class="hljs-keyword"><span class="hljs-keyword">spdlog_sobj_tracer_t</span></span>::make( logger_sink ) ); } };</code> </pre> <br><h2 style=";text-align:right;direction:rtl">  ุชุชุจุน RESTinio ูู ุฎูุงู spdlog </h2><br>  ุจุงูุฅุถุงูุฉ ุฅูู ุชุชุจุน ูุง ูุญุฏุซ ุฏุงุฎู SObjectizer ุ ูุฏ ูููู ูู ุงููููุฏ ุฌุฏูุง ูู ุจุนุถ ุงูุฃุญูุงู ุชุชุจุน ูุง ูุญุฏุซ ุฏุงุฎู RESTinio.  ูู ุงููุณุฎุฉ ุงููุญุฏุซุฉ ูู ุงูุฑูุจูุงู ุ ูุชู ุฅุถุงูุฉ ูุฐุง ุงูุชุชุจุน ุฃูุถูุง. <br><br>  ูุชู ุชูููุฐ ูุฐุง ุงูุชุชุจุน ูู ุฎูุงู ุชุนุฑูู ูุฆุฉ ุฎุงุตุฉ ูููููุง ุฅุฌุฑุงุก ุชุณุฌูู ุงูุฏุฎูู ูู RESTinio: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">http_server_logger_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">http_server_logger_t</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;spdlog::logger&gt; logger ) : m_logger{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move( logger ) } {} <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Builder &gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">trace</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Builder &amp;&amp; msg_builder )</span></span></span><span class="hljs-function"> </span></span>{ log_if_enabled( spdlog::level::trace, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::forward&lt;Builder&gt;(msg_builder) ); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Builder &gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">info</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Builder &amp;&amp; msg_builder )</span></span></span><span class="hljs-function"> </span></span>{ log_if_enabled( spdlog::level::info, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::forward&lt;Builder&gt;(msg_builder) ); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Builder &gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">warn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Builder &amp;&amp; msg_builder )</span></span></span><span class="hljs-function"> </span></span>{ log_if_enabled( spdlog::level::warn, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::forward&lt;Builder&gt;(msg_builder) ); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Builder &gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Builder &amp;&amp; msg_builder )</span></span></span><span class="hljs-function"> </span></span>{ log_if_enabled( spdlog::level::err, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::forward&lt;Builder&gt;(msg_builder) ); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Builder &gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">log_if_enabled</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( spdlog::level::level_enum lv, Builder &amp;&amp; msg_builder )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( m_logger-&gt;should_log(lv) ) { m_logger-&gt;<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>( lv, msg_builder() ); } } <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;spdlog::logger&gt; m_logger; };</code> </pre> <br>  ูุฐู ุงููุฆุฉ ููุณุช ููุฑูุซุฉ ูู ุฃู ุดูุก ุ ุญูุซ ุฃู ุขููุฉ ุงูุชุณุฌูู ูู RESTinio ูุจููุฉ ุนูู ุงูุจุฑูุฌุฉ ุงููุนููุฉ ุ ูููุณ ุนูู ุงูููุฌ ุงูุชูููุฏู ุงููุงุฆูู.  ูุณูุญ ูู ุฐูู ุจุงูุชุฎูุต ุชูุงููุง ูู ุฃู ุฒูุงุฏุฉ ูู ุงููููุงุช ูู ุงูุญุงูุงุช ุงูุชู ูุง ูููู ูููุง ุงูุชุณุฌูู ุถุฑูุฑููุง ุนูู ุงูุฅุทูุงู (ุชูุงูููุง ูุฐุง ุงูููุถูุน ุจูุฒูุฏ ูู ุงูุชูุงุตูู ุนูุฏูุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุญุฏุซูุง ุนู ุงุณุชุฎุฏุงู ุงูููุงูุจ ูู RESTinio</a> ). <br><br>  ุจุนุฏ ุฐูู ุ ูุญุชุงุฌ ุฅูู ุงูุฅุดุงุฑุฉ ุฅูู ุฃู ุฎุงุฏู HTTP ุณูุณุชุฎุฏู ูุฆุฉ http_server_logger_t ุงูููุถุญุฉ ุฃุนูุงู ููุณุฌู.  ูุชู ุฐูู ูู ุฎูุงู ุชูุถูุญ ุฎุตุงุฆุต ุฎุงุฏู HTTP: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">http_server_traits_t</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> restinio::<span class="hljs-keyword"><span class="hljs-keyword">default_traits_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">logger_t</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">http_server_logger_t</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">request_handler_t</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">http_req_router_t</span></span>; };</code> </pre> <br>  ุญุณููุง ุ ุฅุฐู ูู ูุจู ุดูุก ููููุงู ุจู - ุฃูุดุฆ ูุณุฎุฉ ูุญุฏุฏุฉ ูู spd-logger ูุฃุฑุณู ูุฐุง ุงููุณุฌู ุฅูู ุฎุงุฏู HTTP ุงูุฐู ุชู ุฅูุดุงุคู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> restinio_logger = make_logger( <span class="hljs-string"><span class="hljs-string">"restinio"</span></span>, logger_sink, <span class="hljs-keyword"><span class="hljs-keyword">restinio_tracing_t</span></span>::off == restinio_tracing ? spdlog::level::off : log_level ); restinio::run( asio_io_ctx, shrimp::make_http_server_settings( thread_count.m_io_threads, params, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(restinio_logger), manager_mbox_promise.get_future().get() ) );</code> </pre> <br><h1 style=";text-align:right;direction:rtl">  v0.5: ุฅุนุงุฏุฉ ุชุนููู ุฅุฌุจุงุฑู ูุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ููุตูุฑ ุงููุญููุฉ </h1><br>  ูู ุนูููุฉ ุชุตุญูุญ ุงูุฑูุจูุงู ุ ุชู ุงูุชุดุงู ุดูุก ุตุบูุฑ ูุงู ูุฒุนุฌูุง ุจุนุถ ุงูุดูุก: ูู ุฃุฌู ูุณุญ ูุญุชููุงุช ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ููุตูุฑ ุงููุญููุฉ ุ ูุงู ุนููู ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฑูุจูุงู ุจุฃูููู.  ูุฏ ูุจุฏู ุชุงููุง ุ ูููู ุบูุฑ ุณุงุฑุฉ. <br><br>  ุฅุฐุง ูุงูุช ุบูุฑ ุณุงุฑุฉ ุ ูุนููู ุงูุชุฎูุต ูู ูุฐุง ุงููุตูุฑ.  ูุญุณู ุงูุญุธ ุ ูุฐุง ููุณ ุจุงูุฃูุฑ ุงูุตุนุจ ุนูู ุงูุฅุทูุงู. <br><br>  ุฃููุงู ุ ุณูุญุฏุฏ ุนููุงู URL ุขุฎุฑ ูู Shrimp ููููู ุฅุฑุณุงู ุทูุจุงุช HTTP DELETE ุฅููู: "/ cache".  ููููุง ูุฐูู ุ ุณูุนูู ูุนุงูุฌูุง ุนูู ุนููุงู URL ูุฐุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">http_req_router_t</span></span> &gt; make_router( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">app_params_t</span></span> &amp; params, so_5::<span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> req_handler_mbox ) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> router = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::make_unique&lt; <span class="hljs-keyword"><span class="hljs-keyword">http_req_router_t</span></span> &gt;(); add_transform_op_handler( params, *router, req_handler_mbox ); add_delete_cache_handler( *router, req_handler_mbox ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> router; }</code> </pre> <br>  ุญูุซ ุชุจุฏู ุงููุธููุฉ add_delete_cache_handler () ููุง ููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add_delete_cache_handler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">http_req_router_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; router, so_5::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">mbox_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> req_handler_mbox )</span></span></span><span class="hljs-function"> </span></span>{ router.http_delete( <span class="hljs-string"><span class="hljs-string">"/cache"</span></span>, [req_handler_mbox]( <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> req, <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> <span class="hljs-comment"><span class="hljs-comment">/*params*/</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> qp = restinio::parse_query( req-&gt;header().query() ); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> token = qp.get_param( <span class="hljs-string"><span class="hljs-string">"token"</span></span>sv ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( !token ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> do_403_response( req, <span class="hljs-string"><span class="hljs-string">"No token provided\r\n"</span></span> ); } <span class="hljs-comment"><span class="hljs-comment">// Delegate request processing to transform_manager. so_5::send&lt; so_5::mutable_msg&lt;a_transform_manager_t::delete_cache_request_t&gt; &gt;( req_handler_mbox, req, restinio::cast_to&lt;std::string&gt;(*token) ); return restinio::request_accepted(); } ); }</span></span></code> </pre> <br>  ูุทููู ููููุงู ุ ูููู ูุง ุดูุก ูุนูุฏ.  ูุฌุจ ุฃู ุชุญุชูู ุณูุณูุฉ ุงูุงุณุชุนูุงู ุนูู ูุนููุฉ ุงูุฑูุฒ ุงููููุฒ.  ูุฌุจ ุฃู ุชุญุชูู ูุฐู ุงููุนููุฉ ุนูู ุณูุณูุฉ ุฐุงุช ูููุฉ ุฎุงุตุฉ ููุฑูุฒ ุงูุฅุฏุงุฑู.  ููููู ููุท ุฅุนุงุฏุฉ ุชุนููู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุฅุฐุง ูุงูุช ูููุฉ ุงูุฑูุฒ ุงููููุฒ ูู ูุนููุฉ ุงูุฑูุฒ ุงููููุฒ ุชุชุทุงุจู ูุน ูุง ุชู ุชุนูููู ุนูุฏ ุฅุทูุงู Shrimp.  ุฅุฐุง ูู ุชูู ููุงู ูุนููุฉ ุฑูุฒูุฉ ุ ููู ูุชู ูุจูู ุทูุจ ุงููุนุงูุฌุฉ.  ุฅุฐุง ูุงู ููุงู ุฑูุฒ ูููุฒ ุ ูุณูุชู ุฅุฑุณุงู ุฑุณุงูุฉ ุงูุชุญููู ุงูุฎุงุตุฉ ุฅูู ูููู transform_manager ุ ุงูุฐู ููุชูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุ ุนู ุทุฑูู ุชูููุฐ ุฃู ูุณูุท ูุณุชุฌูุจ ูููู convert_manager ููุณู ูุทูุจ HTTP. <br><br>  ุซุงูููุง ุ ูููุฐ ูุนุงูุฌ ุงูุฑุณุงุฆู ุงูุฌุฏูุฏ delete_cache_request_t ูู ูููู transform_manager_t: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">a_transform_manager_t</span></span>::on_delete_cache_request( <span class="hljs-keyword"><span class="hljs-keyword">mutable_mhood_t</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">delete_cache_request_t</span></span>&gt; cmd ) { m_logger-&gt;warn( <span class="hljs-string"><span class="hljs-string">"delete cache request received; "</span></span> <span class="hljs-string"><span class="hljs-string">"connection_id={}, token={}"</span></span>, cmd-&gt;m_http_req-&gt;connection_id(), cmd-&gt;m_token ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> delay_response = [&amp;]( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> response_text ) { so_5::send_delayed&lt; so_5::mutable_msg&lt;<span class="hljs-keyword"><span class="hljs-keyword">negative_delete_cache_response_t</span></span>&gt; &gt;( *<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::chrono::seconds{<span class="hljs-number"><span class="hljs-number">7</span></span>}, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(cmd-&gt;m_http_req), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(response_text) ); }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> * env_token = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::getenv( <span class="hljs-string"><span class="hljs-string">"SHRIMP_ADMIN_TOKEN"</span></span> ); <span class="hljs-comment"><span class="hljs-comment">// Token must be present and must not be empty. env_token &amp;&amp; *env_token ) { if( cmd-&gt;m_token == env_token ) { m_transformed_cache.clear(); m_logger-&gt;info( "cache deleted" ); do_200_plaintext_response( std::move(cmd-&gt;m_http_req), "Cache deleted\r\n" ); } else { m_logger-&gt;error( "invalid token value for delete cache request; " "token={}", cmd-&gt;m_token ); delay_response( "Token value mismatch\r\n" ); } } else { m_logger-&gt;warn( "delete cache can't performed because there is no " "admin token defined" ); // Operation can't be performed because admin token is not avaliable. delay_response( "No admin token defined\r\n" ); } }</span></span></code> </pre> <br>  ููุงู ููุทุชุงู ููุง ูุฌุจ ุชูุถูุญููุง. <br><br>  ุงูููุทุฉ ุงูุฃููู ูู ุชูููุฐ on_delete_cache_request () ูู ุงูุชุญูู ูู ูููุฉ ุงูุฑูุฒ ุงููููุฒ ููุณู.  ูุชู ุชุนููู ุงูุฑูุฒ ุงูุฅุฏุงุฑู ุนุจุฑ ูุชุบูุฑ ุงูุจูุฆุฉ SHRIMP_ADMIN_TOKEN.  ุฅุฐุง ุชู ุชุนููู ูุฐุง ุงููุชุบูุฑ ููููุชู ุชุชุทุงุจู ูุน ุงููููุฉ ูู ูุนููุฉ ุงูุฑูุฒ ุงููููุฒ ูุทูุจ HTTP DELETE ุ ูุณูุชู ูุณุญ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ููุชู ุฅูุดุงุก ุงุณุชุฌุงุจุฉ ุฅูุฌุงุจูุฉ ููุทูุจ ุนูู ุงูููุฑ. <br><br>  ูุงูููุทุฉ ุงูุซุงููุฉ ูู ุชูููุฐ on_delete_cache_request () ูู ุงูุชุฃุฎูุฑ ุงูุฅุฌุจุงุฑู ููุงุณุชุฌุงุจุฉ ุงูุณูุจูุฉ ูู HTTP DELETE.  ุฅุฐุง ุธูุฑุช ุงููููุฉ ุงูุฎุงุทุฆุฉ ููุฑูุฒ ุงููููุฒ ุงูุฅุฏุงุฑู ุ ููุฌุจ ุนููู ุชุฃุฎูุฑ ุงูุงุณุชุฌุงุจุฉ ุฅูู HTTP DELETE ุญุชู ูุง ุชููู ููุงู ุฑุบุจุฉ ูู ุชุญุฏูุฏ ูููุฉ ุงูุฑูุฒ ุงููููุฒ ุจุงูููุฉ ุงูุบุงุดูุฉ.  ููู ููู ุชุฌุนู ูุฐุง ุงูุชุฃุฎูุฑุ  ุจุนุฏ ูู ุดูุก ุ ุงุณุชุฏุนุงุก std :: thread :: sleep_for () ููุณ ุฎูุงุฑูุง. <br><br>  ูุฐุง ูู ุงูููุงู ุงูุฐู ุชุฃุชู ููู ุฑุณุงุฆู SObjectizer ุงููุนููุฉ ุฅูู ุงูุฅููุงุฐ.  ุจุฏูุงู ูู ุฅูุดุงุก ุฑุฏ ุณูุจู ุนูู ุงูููุฑ ุฏุงุฎู on_delete_cache_request () ุ ูุฑุณู ูููู transform_manager ูููุณู ุฑุณุงูุฉ ุณูุจููุฉ ูุนููุฉ deltete_cache_response_t ูุนููุฉ.  ุณูุญุณุจ ูุคูุช SObjectizer ุงูููุช ุงููุญุฏุฏ ูุณูุตู ูุฐู ุงูุฑุณุงูุฉ ุฅูู ุงููููู ุจุนุฏ ูุฑูุฑ ุงูุชุฃุฎูุฑ ุงููุญุฏุฏ.  ูุงูุขู ูู ุงููุนุงูุฌ ุณูุจู _ delete_cache_response_t ุ ููููู ุจุงููุนู ุฅูุดุงุก ุงุณุชุฌุงุจุฉ ุนูู ุงูููุฑ ูุทูุจ HTTP DELETE: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">a_transform_manager_t</span></span>::on_negative_delete_cache_response( <span class="hljs-keyword"><span class="hljs-keyword">mutable_mhood_t</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">negative_delete_cache_response_t</span></span>&gt; cmd ) { m_logger-&gt;debug( <span class="hljs-string"><span class="hljs-string">"send negative response to delete cache request; "</span></span> <span class="hljs-string"><span class="hljs-string">"connection_id={}"</span></span>, cmd-&gt;m_http_req-&gt;connection_id() ); do_403_response( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(cmd-&gt;m_http_req), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(cmd-&gt;m_response_text) ); }</code> </pre> <br>  ุนูู ุณุจูู ุงููุซุงู  ุงุชุถุญ ุงูุณููุงุฑูู ุงูุชุงูู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุชููู ุฎุงุฏู HTTP ุทูุจ HTTP DELETE ุ ููุญูู ูุฐุง ุงูุทูุจ ุฅูู ุฑุณุงูุฉ delete_cache_request_t ุฅูู ูููู transform_manager ุ </li><li style=";text-align:right;direction:rtl">  ูุชููู ูููู transform_manager ุฑุณุงูุฉ delete_cache_request_t ูุฅูุง ุฃู ูููุฏ ุฑุฏูุง ุฅูุฌุงุจููุง ุนูู ุงูููุฑ ุนูู ุงูุทูุจ ุ ุฃู ูุฑุณู ุฅูู ููุณู ุฑุณุงูุฉ ุณูุจููุฉ ูุนูููุฉ ุณูุจููุฉ ูุนูููุฉ ุ </li><li style=";text-align:right;direction:rtl">  ูุชููู transform_manager ุฑุณุงูุฉ ุณูุจูุฉ_delete_cache_response_t ููููู ุนูู ุงูููุฑ ุจุฅูุดุงุก ุฑุฏ ุณูุจู ุนูู ุทูุจ HTTP DELETE ุงูููุงุจู. </li></ul><br><h1 style=";text-align:right;direction:rtl">  ููุงูุฉ ุงูุฌุฒุก ุงูุซุงูู </h1><br>  ูู ููุงูุฉ ุงูุฌุฒุก ุงูุซุงูู ุ ูู ุงูุทุจูุนู ุฃู ุชุณุฃู ุงูุณุคุงู "ูุงุฐุง ุจุนุฏุ" <br><br>  ุนูุงูุฉ ุนูู ุฐูู ุ ุฑุจูุง ุณูููู ููุงู ุชูุฑุงุฑ ุขุฎุฑ ูุชุญุฏูุซ ุขุฎุฑ ููุดุฑูุนูุง ุงูุชุฌุฑูุจู.  ุฃูุฏ ุฃู ุฃูุนู ุดูุฆูุง ูุซู ุชุญููู ุตูุฑุฉ ูู ุชูุณูู ุฅูู ุขุฎุฑ.  ูููุชุฑุถ ุ ุนูู ุงูุฎุงุฏู ุ ุฃู ุงูุตูุฑุฉ ููุฌูุฏุฉ ุจุชูุณูู jpg ุ ูุจุนุฏ ุงูุชุญููู ุ ูุชู ุฅุฑุณุงููุง ุฅูู ุงูุนููู ูู ุตูุญุฉ ุงูููุจ. <br><br>  ุณูููู ูู ุงููุซูุฑ ููุงูุชูุงู ุฃูุถูุง ุฅุฑูุงู "ุตูุญุฉ" ูููุตูุฉ ูุน ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช ุงูุญุงููุฉ ุญูู ุนูู ุงูุฑูุจูุงู.  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ุฅูู ูุฌุฑุฏ ูุถูู.  ูููู ุ ูู ุญูุซ ุงููุจุฏุฃ ุ ูููู ุฃูุถูุง ุชูููู ูุฐู ุงูุตูุญุฉ ูุงุญุชูุงุฌุงุช ูุฑุงูุจุฉ ุตูุงุญูุฉ ุงูุฑูุจูุงู. <br><br>  ุฅุฐุง ูุงู ูุฏู ุดุฎุต ุขุฎุฑ ุงูุชุฑุงุญุงุช ุญูู ูุง ุฃูุฏ ุฑุคูุชู ูู Shrimp ุฃู ูู ููุงูุงุช ุญูู Shrimp ุ ูุณูู ูุณุนุฏูุง ุณูุงุน ุฃู ุฃููุงุฑ ุจูุงุกุฉ. <br><br>  ุจุดูู ูููุตู ุ ุฃูุฏ ุฃู ุฃุดูุฑ ุฅูู ุฌุงูุจ ูุงุญุฏ ูู ุชูููุฐ ุงูุฑูุจูุงู ุ ูุงูุฐู ูุงุฌุฃูุง ุฅูู ุญุฏ ูุง.  ูุฐุง ูู ุงูุงุณุชุฎุฏุงู ุงููุดุท ููุฑุณุงุฆู ุงููุงุจูุฉ ููุชุบููุฑ ุนูุฏ ุงูุชูุงุตู ูุน ุจุนุถูุง ุงูุจุนุถ ูุฎุงุฏู HTTP.  ุนุงุฏุฉ ุ ูู ููุงุฑุณุชูุง ุ ูุญุฏุซ ุงูุนูุณ - ูู ูุซูุฑ ูู ุงูุฃุญูุงู ูุชู ุชุจุงุฏู ุงูุจูุงูุงุช ูู ุฎูุงู ุงูุฑุณุงุฆู ุงูููุงุนูุฉ.  ููุณ ุงูุฃูุฑ ูุฐูู ููุง.  ูุดูุฑ ูุฐุง ุฅูู ุฃููุง ุงุณุชูุนูุง ุนู ุนูู ุฅูู ุฑุบุจุงุช ุงููุณุชุฎุฏููู ูู ุงูููุช ุงูููุงุณุจ ูุฃุถููุง ุฑุณุงุฆู ูุงุจูุฉ ููุชุบููุฑ ุฅูู SObjectizer.  ูุฐุง ุฅุฐุง ููุช ุชุฑุบุจ ูู ุฑุคูุฉ ุดูุก ูุง ูู RESTinio ุฃู SObjectizer ุ ููุง ุชุชุฑุฏุฏ ูู ูุดุงุฑูุฉ ุฃููุงุฑู.  ูุญู ุนูู ูููู ูู ุงูุงุณุชูุงุน ุฅูู ุงูุตุงูุญูู. <br><br>  ุญุณููุง ุ ููู ุงูุฎุชุงู ุ ุฃูุฏ ุฃู ุฃุดูุฑ ูู ูู ุฃุฎุฐ ุงูููุช ูุชุญุฏุซ ุนู ุงููุณุฎุฉ ุงูุฃููู ูู ุงูุฑูุจูุงู ุ ุณูุงุก ููุง ูู ุญุจุฑู ุฃู ูู ุฎูุงู ููุงุฑุฏ ุฃุฎุฑู.  ุดูุฑุง ูู! <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุชุจุน ...</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar417527/">https://habr.com/ru/post/ar417527/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar417511/index.html">ุฅูุชู ุชุณุชุญูุฐ ุนูู eASIC - ุงููุทูุฑ ุงูููููู ASIC</a></li>
<li><a href="../ar417513/index.html">ุงููุธูุฑ ูู ุจูุซูู ูุฌุงูุง ุณูุฑูุจุช. ุงูุฌุฒุก ุงูุซุงูู</a></li>
<li><a href="../ar417515/index.html">ูุง ุชุนููุชู ูู ุฎูุงู ุฅูุดุงุก 100 ูุนุจุฉ ูู 5 ุณููุงุช</a></li>
<li><a href="../ar417517/index.html">ุตูุญุงุช ุชุงุฑูุฎ ุฅูุชู. ุตูุฑ ููุงุฆุน ูุงุฎุชุจุงุฑ</a></li>
<li><a href="../ar417521/index.html">ูุฑุงุฌุนุฉ ุดูุงุฏุงุช SSL ูุฅุจุทุงููุง</a></li>
<li><a href="../ar417529/index.html">ุซูุงุซุฉ ุงุชุฌุงูุงุช ุชูููููุฌูุฉ ุชุบูุฑ ุงูุชุฌุงุฑุฉ ูุงููุณุชููู</a></li>
<li><a href="../ar417531/index.html">ููู ูุฒูุง ูู SmartMailHack 2</a></li>
<li><a href="../ar417533/index.html">ุชููู ุงููููุฑุฉ ุนูู Windows ุฃูู ุชุญุฏูุซ ููู ูู ุนูุฏูู</a></li>
<li><a href="../ar417535/index.html">ูู ุชุทููุฑ CUBA ุฎุทูุฉ ูุจูุฑุฉ ุจุนูุฏูุง ุนู ุงูุฑุจูุนุ</a></li>
<li><a href="../ar417537/index.html">"ูุนุจุชู ูููุฉ" ุฃู ููููุฉ ุฑูุน ูุณุจุฉ ุงูุงุญุชูุงุธ ุงูุนุงููุฉ ุจุงููุนู ูู ุงูููู ุงูุฃูู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>