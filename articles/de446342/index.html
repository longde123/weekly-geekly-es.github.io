<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí† ü§∞üèø ü§πüèº Der Einfluss transparenter gro√üer Seiten auf die Systemleistung üë∏ üë®‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë® üóΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Der Artikel wird im Auftrag von John Akhaltsev , Jiga , ver√∂ffentlicht 
 
 Tinkoff.ru ist heute nicht nur eine Bank, sondern ein IT-Unternehmen. Es bi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Der Einfluss transparenter gro√üer Seiten auf die Systemleistung</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/446342/"><p>  <i>Der Artikel wird im Auftrag von John <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Akhaltsev</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Jiga</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">ver√∂ffentlicht</a></i> <i><br></i> <br>  Tinkoff.ru ist heute nicht nur eine Bank, sondern ein IT-Unternehmen.  Es bietet nicht nur Bankdienstleistungen an, sondern baut auch ein √ñkosystem um sie herum auf. </p><br><p>  Wir bei Tinkoff.ru gehen eine Partnerschaft mit verschiedenen Diensten ein, um die Qualit√§t des Kundendienstes zu verbessern und zu besseren Diensten zu werden.  Zum Beispiel haben wir Lasttests und Leistungsanalysen f√ºr einen dieser Dienste durchgef√ºhrt, die dazu beigetragen haben, Engp√§sse im System zu finden - einschlie√ülich transparenter gro√üer Seiten in der Betriebssystemkonfiguration. </p><br><p>  Wenn Sie wissen m√∂chten, wie eine Analyse der Systemleistung durchgef√ºhrt wird und was daraus bei uns geworden ist, dann sind Sie bei cat willkommen. </p><a name="habracut"></a><br><h3 id="opisanie-problemy">  Problembeschreibung </h3><br><p>  Im Moment lautet die Servicearchitektur: </p><br><ul><li>  Nginx-Webserver f√ºr die Verarbeitung von http-Verbindungen </li><li>  PHP-fpm f√ºr die PHP-Prozesssteuerung </li><li>  Redis zum Zwischenspeichern </li><li>  PostgreSQL zur Datenspeicherung </li><li>  One-Stop-Shopping-L√∂sung </li></ul><br><p>  Das Hauptproblem, das wir beim n√§chsten Verkauf unter hoher Last fanden, war die hohe Auslastung der CPU, w√§hrend die Prozessorzeit im Kernelmodus (Systemzeit) zunahm und l√§nger war als die Zeit im Benutzermodus (Benutzerzeit). </p><br><ul><li>  Benutzerzeit - Die Zeit, die der Prozessor f√ºr die Aufgaben des Benutzers ben√∂tigt.  Dies ist die Hauptsache, f√ºr die Sie beim Kauf eines Prozessors bezahlen. </li><li>  Systemzeit - Die Zeit, die das System f√ºr Paging, das √Ñndern von Kontexten, das Starten geplanter Aufgaben und andere Systemaufgaben ben√∂tigt. </li></ul><br><h3 id="opredelenie-pervichnyh-harakteristik-sistemy">  Bestimmen der prim√§ren Eigenschaften des Systems </h3><br><p>  Zun√§chst haben wir einen Lastkreis mit nahezu produktiven Ressourcen gesammelt und ein Lastprofil erstellt, das einer normalen Last an einem typischen Tag entspricht. </p><br><p>  Gatling Version 3 wurde als Sch√§lwerkzeug ausgew√§hlt, und das Sch√§len selbst wurde innerhalb des lokalen Netzwerks √ºber Gitlab-Runner durchgef√ºhrt.  Der Standort von Agenten und Zielen im selben lokalen Netzwerk ist auf geringere Netzwerkkosten zur√ºckzuf√ºhren. Daher konzentrieren wir uns auf die √úberpr√ºfung der Ausf√ºhrung des Codes selbst und nicht auf die Leistung der Infrastruktur, in der das System bereitgestellt wird. </p><br><p>  Bei der Bestimmung der prim√§ren Eigenschaften des Systems ist ein Szenario mit einer linear ansteigenden Last mit einer http-Konfiguration geeignet: </p><br><pre><code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> httpConfig: <span class="hljs-type"><span class="hljs-type">HttpProtocolBuilder</span></span> = http .baseUrl(<span class="hljs-string"><span class="hljs-string">"https://test.host.ru"</span></span>) .inferHtmlResources() <span class="hljs-comment"><span class="hljs-comment">//      .disableCaching //  ,      "" . .disableFollowRedirect //   /// MULTIPLIER   JAVA_OPTS setUp( Scenario.inject( rampUsers(100 * MULTIPLIER) during (200 * MULTIPLIER seconds)) ).protocols(httpConfig) .maxDuration(1 hour)</span></span></code> </pre> <br><p>  Zu diesem Zeitpunkt haben wir ein Skript implementiert, um die Hauptseite zu √∂ffnen und alle Ressourcen herunterzuladen </p><br><p><img src="https://habrastorage.org/webt/6y/7s/dn/6y7sdnc1rymvwh6i9tbm1jnnmqk.png"></p><br><p>  Die Ergebnisse dieses Tests zeigten eine maximale Leistung von 1500 U / min. Eine weitere Erh√∂hung der Lastintensit√§t f√ºhrte zu einer Verschlechterung des Systems, die mit einer Erh√∂hung der Softirq-Zeit verbunden war. </p><br><p><img src="https://habrastorage.org/webt/pb/rn/st/pbrnstk2hbvjxehzazn6eklcbqs.png"></p><br><p><img src="https://habrastorage.org/webt/i4/kl/_o/i4kl_opztz6cszphnk8z7iti320.png"></p><br><p>  Softirq ist ein verz√∂gerter Interrupt-Mechanismus und wird in der Datei kernel / softirq.s beschrieben.  Gleichzeitig h√§mmern sie die Warteschlange mit Anweisungen an den Prozessor und verhindern so, dass sie im Benutzermodus n√ºtzliche Berechnungen durchf√ºhren k√∂nnen.  Interrupt-Handler k√∂nnen auch die zus√§tzliche Arbeit mit Netzwerkpaketen in Betriebssystem-Threads verz√∂gern (Systemzeit).  Kurz √ºber die Arbeit des Netzwerkstapels und Optimierungen finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in einem separaten Artikel</a> . </p><br><p>  Der Verdacht auf das Hauptproblem wurde nicht best√§tigt, da das Produkt eine viel l√§ngere Systemzeit mit weniger Netzwerkaktivit√§t aufwies. </p><br><h3 id="polzovatelskie-scenarii">  Benutzerskripte </h3><br><p>  Der n√§chste Schritt bestand darin, benutzerdefinierte Skripte zu entwickeln und mehr hinzuzuf√ºgen, als nur eine Seite mit Bildern zu √∂ffnen.  Das Profil enth√§lt umfangreiche Vorg√§nge, bei denen der Site-Code und die Datenbank vollst√§ndig einbezogen wurden, und keinen Webserver, der statische Ressourcen bereitstellt. </p><br><p>  Der Test mit stabiler Last wurde mit einer geringeren Intensit√§t als dem Maximum gestartet. Der Konfiguration wurde ein Umleitungs√ºbergang hinzugef√ºgt: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> httpConfig: <span class="hljs-type"><span class="hljs-type">HttpProtocolBuilder</span></span> = http .baseUrl(<span class="hljs-string"><span class="hljs-string">"https://test.host.ru"</span></span>) .inferHtmlResources() <span class="hljs-comment"><span class="hljs-comment">//      .disableCaching //  ,      "" . /// MULTIPLIER   JAVA_OPTS setUp( MainScenario .inject(rampUsers(50 * MULTIPLIER) during (200 * MULTIPLIER seconds)), SideScenario .inject(rampUsers(100 * MULTIPLIER) during (200 * MULTIPLIER seconds)) ).protocols(httpConfig) .maxDuration(2 hours)</span></span></code> </pre> <br><p><img src="https://habrastorage.org/webt/hz/re/ja/hzrejalbqq3ungtuzcxhxfmjypk.png"><br><img src="https://habrastorage.org/webt/28/vo/om/28voomhlbebmlu7p6tcyppt_boe.png"></p><br><p>  Die vollst√§ndigste Verwendung von Systemen zeigte eine Zunahme der Systemzeitmetrik sowie deren Wachstum w√§hrend des Stabilit√§tstests.  Das Problem mit der Produktionsumgebung wurde reproduziert. </p><br><h3 id="setevoe-vzaimodeystvie-s-redis">  Vernetzung mit Redis </h3><br><p>  Bei der Analyse von Problemen ist es sehr wichtig, alle Komponenten des Systems zu √ºberwachen, um zu verstehen, wie es funktioniert und welche Auswirkungen die zugef√ºhrte Last auf das System hat. </p><br><p>  Mit dem Aufkommen der Redis-√úberwachung wurde es m√∂glich, nicht die allgemeinen Metriken des Systems, sondern seine spezifischen Komponenten zu betrachten.  Das Szenario f√ºr Stresstests wurde ebenfalls ge√§ndert, was zusammen mit der zus√§tzlichen √úberwachung dazu beitrug, die Lokalisierung des Problems anzugehen. </p><br><p><img src="https://habrastorage.org/webt/8a/4n/c0/8a4nc0gvymij8dh0r0ihpxhrsjg.png"></p><br><p>  Bei der √úberwachung sah Redis ein √§hnliches Bild mit der CPU-Auslastung, oder besser gesagt, die Systemzeit ist erheblich l√§nger als die Benutzerzeit, w√§hrend die Hauptauslastung der CPU in der SET-Operation lag, dh der Zuweisung von RAM zum Speichern des Werts. </p><br><p><img src="https://habrastorage.org/webt/iy/ey/wn/iyeywnci02gnc2xrv71el7qtllu.png"></p><br><p>  Um den Effekt der Netzwerkinteraktion mit Redis zu eliminieren, wurde beschlossen, die Hypothese zu testen und Redis auf einen UNIX-Socket anstelle eines TCP-Sockets umzustellen.  Dies geschah direkt in dem Framework, √ºber das php-fpm eine Verbindung zur Datenbank herstellt.  In der Datei /yiisoft/yii/framework/caching/CRedisCache.php haben wir die Zeile von host: port durch den Hardcode redis.sock ersetzt.  Weitere <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Informationen</a> zur Socket-Leistung finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">im Artikel</a> . </p><br><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Establishes a connection to the redis server. * It does nothing if the connection has already been established. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> CException if connecting fails */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_socket=@stream_socket_client( <span class="hljs-comment"><span class="hljs-comment">// $this-&gt;hostname.':'.$this-&gt;port, "unix:///var/run/redis/redis.sock", $errorNumber, $errorDescription, $this-&gt;timeout ? $this-&gt;timeout : ini_get("default_socket_timeout"), $this-&gt;options ); if ($this-&gt;_socket) { if($this-&gt;password!==null) $this-&gt;executeCommand('AUTH',array($this-&gt;password)); $this-&gt;executeCommand('SELECT',array($this-&gt;database)); } else { $this-&gt;_socket = null; throw new CException('Failed to connect to redis: '.$errorDescription,(int)$errorNumber); } }</span></span></code> </pre> <br><p>  Dies hatte leider keine gro√üen Auswirkungen.  Die CPU-Auslastung hat sich etwas stabilisiert, aber unser Problem nicht gel√∂st - der gr√∂√üte Teil der CPU-Auslastung erfolgte im Kernel-Modus. </p><br><p><img src="https://habrastorage.org/webt/w7/8y/5r/w78y5rvvebeefe7r0t34w5lfi-u.png"></p><br><p><img src="https://habrastorage.org/webt/97/mv/y6/97mvy6jkpi8loxuw-dwq_7spfis.png"></p><br><h3 id="benchmark-s-pomoschyu-stress-i-vyyavlenie-problemy-thp">  Benchmark mit Stress und Identifizierung von THP-Problemen </h3><br><p>  Das Stress-Dienstprogramm half bei der Lokalisierung des Problems - ein einfacher Workload-Generator f√ºr POSIX-Systeme, mit dem einzelne Systemkomponenten wie CPU, Speicher und E / A geladen werden k√∂nnen. <br>  Das Testen soll auf der Hardware- und Betriebssystemversion erfolgen: </p><br><blockquote>  Ubuntu 18.04.1 LTS <br>  12 Intel¬Æ Xeon¬Æ CPU </blockquote><p>  Das Dienstprogramm wird mit dem folgenden Befehl installiert: </p><br><pre> <code class="bash hljs">sudo apt-get install stress</code> </pre> <br><p>  Wir sehen uns an, wie die CPU unter Last ausgelastet ist, und f√ºhren einen Test durch, bei dem Mitarbeiter f√ºr die Berechnung von Quadratwurzeln mit einer Dauer von 300 Sekunden erstellt werden: </p><br><pre> <code class="bash hljs">-c, --cpu N spawn N workers spinning on sqrt() &gt; stress --cpu 12 --timeout 300s stress: info: [39881] dispatching hogs: 12 cpu, 0 io, 0 vm, 0 hdd</code> </pre> <br><p><img src="https://habrastorage.org/webt/q2/fv/lz/q2fvlzxwmzo-qxvctkrizjjwykw.png"></p><br><p>  Die Grafik zeigt die vollst√§ndige Auslastung im Benutzermodus. Dies bedeutet, dass alle Prozessorkerne geladen und n√ºtzliche Berechnungen durchgef√ºhrt werden, keine Systemdienstaufrufe. </p><br><p>  Der n√§chste Schritt besteht darin, Ressourcen zu nutzen, wenn Sie intensiv mit io arbeiten.  F√ºhren Sie den Test 300 Sekunden lang aus, und erstellen Sie 12 Worker, die sync () ausf√ºhren.  Der Synchronisierungsbefehl schreibt im Speicher gepufferte Daten auf die Festplatte.  Der Kernel speichert Daten im Speicher, um h√§ufige (normalerweise langsame) Lese- und Schreibvorg√§nge auf der Festplatte zu vermeiden.  Der Befehl sync () stellt sicher, dass alles, was im Speicher gespeichert ist, auf die Festplatte geschrieben wird. </p><br><pre> <code class="bash hljs">-i, --io N spawn N workers spinning on sync() &gt; stress --io 12 --timeout 300s stress: info: [39907] dispatching hogs: 0 cpu, 0 io, 0 vm, 12 hdd</code> </pre> <br><p><img src="https://habrastorage.org/webt/zj/rq/f9/zjrqf9zvn9ejwhwgzogs-iwocyy.png"></p><br><p><img src="https://habrastorage.org/webt/zu/g4/1r/zug41ror5fyqgcduomicj0dpwcw.png"></p><br><p>  Wir sehen, dass der Prozessor haupts√§chlich mit der Verarbeitung von Aufrufen im Kernel-Modus und ein wenig in iowait besch√§ftigt ist. Sie k√∂nnen auch&gt; 35.000 Ops-Schreibvorg√§nge auf die Festplatte sehen.  Dieses Verhalten √§hnelt einem Problem mit hoher Systemzeit, dessen Ursachen wir analysieren.  Aber hier gibt es einige Unterschiede: Dies sind iowait und iops sind gr√∂√üer als auf der Produktivschaltung, dies passt nicht zu unserem Fall. </p><br><p>  Es ist Zeit, Ihr Ged√§chtnis zu √ºberpr√ºfen.  Wir starten 20 Mitarbeiter, die mit dem folgenden Befehl 300 Sekunden lang Speicher zuweisen und freigeben: </p><br><pre> <code class="bash hljs"> -m, --vm N spawn N workers spinning on malloc()/free() &gt; stress -m 20 --timeout 300s stress: info: [39954] dispatching hogs: 0 cpu, 0 io, 20 vm, 0 hdd</code> </pre> <br><p><img src="https://habrastorage.org/webt/fj/pt/q5/fjptq53tbw5s_s6ksdcr2on6eow.png"></p><br><p>  Sofort sehen wir die hohe Auslastung der CPU im Systemmodus und ein wenig im Benutzermodus sowie die Verwendung von RAM von mehr als 2 GB. </p><br><p>  Dieser Fall ist dem Problem mit dem Produkt sehr √§hnlich, was durch die gro√üe Verwendung von Speicher bei Lasttests best√§tigt wird.  Daher muss das Problem in der Speicheroperation gesucht werden.  Die Zuweisung und Freigabe von Speicher erfolgt √ºber Malloc- bzw. Free-Aufrufe, die schlie√ülich von den Kernel-Systemaufrufen verarbeitet werden. Dies bedeutet, dass sie in der CPU-Auslastung als Systemzeit angezeigt werden. </p><br><p>  In den meisten modernen Betriebssystemen wird der virtuelle Speicher mithilfe von Paging organisiert. Bei diesem Ansatz wird der gesamte Speicherbereich in Seiten mit fester L√§nge unterteilt, z. B. 4096 Byte (Standard f√ºr viele Plattformen). Wenn beispielsweise 2 GB Speicher zugewiesen werden, muss der Speichermanager ausgef√ºhrt werden mehr als 500.000 Seiten.  Bei diesem Ansatz entsteht ein hoher Overhead f√ºr die Verwaltung und f√ºr gro√üe Seiten. Es wurden Technologien f√ºr transparente gro√üe Seiten entwickelt, um diese zu reduzieren. Mit ihrer Hilfe k√∂nnen Sie die Seitengr√∂√üe beispielsweise auf bis zu 2 MB erh√∂hen, wodurch die Anzahl der Seiten im Speicherheap erheblich reduziert wird.  Der Unterschied in der Technologie besteht nur darin, dass wir f√ºr gro√üe Seiten die Umgebung explizit konfigurieren und dem Programm die Arbeit mit ihnen beibringen m√ºssen, w√§hrend transparente gro√üe Seiten f√ºr Programme ‚Äûtransparent‚Äú funktionieren. </p><br><h3 id="thp-i-reshenie-problemy">  THP und Probleml√∂sung </h3><br><p>  Wenn Sie Informationen zu transparenten riesigen Seiten googeln, sehen Sie in den Suchergebnissen viele Seiten mit den Fragen "So deaktivieren Sie THP". </p><br><p>  Wie sich herausstellte, wurde diese ‚Äûcoole‚Äú Funktion von der Red Hat Corporation in den Linux-Kernel eingef√ºhrt. Das Wesentliche an dieser Funktion ist, dass Anwendungen transparent mit dem Speicher arbeiten k√∂nnen, als ob sie mit echten Huge Page arbeiten w√ºrden.  Laut den Benchmarks beschleunigt THP die abstrakte Anwendung um 10%. Sie k√∂nnen mehr Details in der Pr√§sentation sehen, aber in Wirklichkeit ist alles anders.  In einigen F√§llen f√ºhrt THP zu einem unangemessenen Anstieg des CPU-Verbrauchs in Systemen.  Weitere Informationen finden Sie in den Empfehlungen von Oracle. </p><br><p>  Wir gehen und √ºberpr√ºfen unseren Parameter.  Wie sich herausstellte, ist THP standardm√§√üig aktiviert. Wir deaktivieren es mit dem folgenden Befehl: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled</code> </pre> <br><p>  Wir best√§tigen mit dem Test vor dem Ausschalten von THP und danach auf dem Lastprofil: </p><br><pre> <code class="scala hljs">setUp( <span class="hljs-type"><span class="hljs-type">MainScenario</span></span>.inject( rampUsers(<span class="hljs-number"><span class="hljs-number">150</span></span>) during (<span class="hljs-number"><span class="hljs-number">200</span></span> seconds)), <span class="hljs-type"><span class="hljs-type">Peak</span></span>.inject( nothingFor(<span class="hljs-number"><span class="hljs-number">20</span></span> minutes), rampUsers(<span class="hljs-number"><span class="hljs-number">5000</span></span>) during (<span class="hljs-number"><span class="hljs-number">30</span></span> minutes)) ).protocols(httpConfig)</code> </pre> <br><p><img src="https://habrastorage.org/webt/bx/zu/wj/bxzuwjbchq4rj4ckyog4e-9liis.png"></p><br><p>  Wir haben dieses Bild gesehen, bevor wir THP ausgeschaltet haben </p><br><p><img src="https://habrastorage.org/webt/pi/jo/si/pijosicrbyv3xukk3uv2babyyie.png"></p><br><p>  Nach dem Ausschalten von THP k√∂nnen wir eine bereits verringerte Ressourcennutzung beobachten. </p><br><p>  Das Hauptproblem wurde lokalisiert.  Der Grund war im Betriebssystem standardm√§√üig aktiviert <br>  Mechanismus der transparenten gro√üen Seiten.  Nach dem Deaktivieren der THP-Option verringerte sich die CPU-Auslastung im Systemmodus um mindestens das Zweifache, wodurch Ressourcen f√ºr den Benutzermodus freigesetzt wurden.  Bei der Analyse des Hauptproblems wurden auch ‚ÄûEngp√§sse‚Äú bei der Interaktion mit dem Netzwerkstapel von OS und Redis festgestellt, was der Grund f√ºr eine eingehendere Untersuchung ist.  Aber das ist eine ganz andere Geschichte. </p><br><h3 id="zaklyuchenie">  Fazit </h3><br><p>  Abschlie√üend m√∂chte ich einige Tipps f√ºr die erfolgreiche Suche nach Leistungsproblemen geben: </p><br><ul><li>  Bevor Sie die Systemleistung untersuchen, sollten Sie deren Architektur und Komponenteninteraktionen sorgf√§ltig verstehen. </li><li>  Konfigurieren Sie die √úberwachung f√ºr alle Systemkomponenten und verfolgen Sie sie. Wenn nicht gen√ºgend Standardmetriken vorhanden sind, gehen Sie tiefer und erweitern Sie sie. </li><li>  Lesen Sie die Handb√ºcher zu den verwendeten Systemen. </li><li>  √úberpr√ºfen Sie die Standardeinstellungen in den Konfigurationsdateien des Betriebssystems und der Systemkomponenten. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de446342/">https://habr.com/ru/post/de446342/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de446332/index.html">IBM System i (auch bekannt als AS / 400) - Wie wir automatische Tests f√ºr Green-Screen-Anwendungen durchgef√ºhrt haben</a></li>
<li><a href="../de446334/index.html">√úberlegungen zu einer Karriere in der IT und Tipps f√ºr Anf√§nger</a></li>
<li><a href="../de446336/index.html">Wie man Standardkennw√∂rter verbietet und alle dazu bringt, dich zu hassen</a></li>
<li><a href="../de446338/index.html">SVG 3D: Erstellen, Drehen und Animieren</a></li>
<li><a href="../de446340/index.html">Betriebssysteme: Drei einfache Teile. Teil 1: Intro (√úbersetzung)</a></li>
<li><a href="../de446344/index.html">Bausteine ‚Äã‚Äãverteilter Anwendungen. Zweite Ann√§herung</a></li>
<li><a href="../de446346/index.html">Das Entwickeln von Anwendungen f√ºr Android ist wie ein (d√§monisiertes) YouTube</a></li>
<li><a href="../de446348/index.html">Einfache JSON-RPC-√§hnliche API in PHP</a></li>
<li><a href="../de446350/index.html">Was letztendlich AirPower get√∂tet hat</a></li>
<li><a href="../de446352/index.html">Schutz ohne Schutz</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>