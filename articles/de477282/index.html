<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßîüèº üêπ üë©üèø‚Äçüîß Profiling Go-Projektcode und Beheben von Speicherzuordnungsproblemen ‚è¨ üö∂üèΩ ü¶ä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vielleicht kennt jeder Programmierer die Worte von Kent Beck: "Lass es funktionieren, mach es richtig, mach es schnell." Zuerst m√ºssen Sie das Program...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Profiling Go-Projektcode und Beheben von Speicherzuordnungsproblemen</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/477282/">  Vielleicht kennt jeder Programmierer die Worte von Kent Beck: "Lass es funktionieren, mach es richtig, mach es schnell."  Zuerst m√ºssen Sie das Programm zum Laufen bringen, dann m√ºssen Sie es zum Laufen bringen und erst dann k√∂nnen Sie mit der Optimierung fortfahren. <br><br><img src="https://habrastorage.org/webt/nz/-z/sh/nz-zsh2ilh_sy0-ib_6ydrcs9p0.png"><br><br>  Der Autor des Artikels, dessen √úbersetzung wir ver√∂ffentlichen, sagt, dass er k√ºrzlich beschlossen hat, die Profilerstellung f√ºr sein Open-Source-Go-Projekt <a href="https://github.com/markphelps/flipt">Flipt aufzunehmen</a> .  Er wollte Code im Projekt finden, der m√ºhelos optimiert werden konnte und dadurch das Programm beschleunigte.  W√§hrend der Profilerstellung entdeckte er einige unerwartete Probleme im beliebten Open-Source-Projekt, mit dem Flipt Routing und Middleware-Support organisierte.  Infolgedessen konnte die von der Anwendung w√§hrend des Betriebs zugewiesene Speichermenge um das 100-fache reduziert werden.  Dies wiederum f√ºhrte zu einer Verringerung der Anzahl der M√ºllsammelvorg√§nge und zu einer Verbesserung der Gesamtleistung des Projekts.  So war es. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Hohe Verkehrserzeugung</font> </h2><br>  Bevor ich mit der Profilerstellung beginnen konnte, wusste ich, dass ich zuerst eine gro√üe Menge an Datenverkehr generieren musste, die in die Anwendung eintrat, um einige Verhaltensmuster zu erkennen.  Hier stie√ü ich sofort auf ein Problem, da ich nichts habe, was Flipt in der Produktion verwenden und etwas Verkehr bekommen w√ºrde, der es mir erm√∂glicht, die Arbeit des Projekts unter Last zu bewerten.  Als Ergebnis fand ich ein gro√üartiges Tool f√ºr Lasttestprojekte.  Das ist <a href="https://github.com/tsenart/vegeta">Vegeta</a> .  Die Autoren des Projekts sagen, dass Vegeta ein universelles HTTP-Tool f√ºr Lasttests ist.  Dieses Projekt entstand aus der Notwendigkeit, HTTP-Dienste mit einer gro√üen Anzahl von Anforderungen zu laden, die mit einer bestimmten H√§ufigkeit an Dienste gesendet werden. <br><br>  Das Vegeta-Projekt erwies sich als genau das Werkzeug, das ich brauchte, da es mir erm√∂glichte, einen kontinuierlichen Strom von Anfragen an die Anwendung zu erstellen.  Mit diesen Anforderungen k√∂nnen Sie die Anwendung so oft "sch√§len", wie dies erforderlich ist, um Indikatoren wie Zuweisung / Speichernutzung auf dem Heap, Funktionen von Goroutinen und Zeitaufwand f√ºr die Speicherbereinigung zu ermitteln. <br><br>  Nachdem ich einige Experimente durchgef√ºhrt hatte, ging ich zur folgenden Konfiguration des Vegeta-Starts: <br><br><pre><code class="plaintext hljs">echo 'POST http://localhost:8080/api/v1/evaluate' | vegeta attack -rate 1000 -duration 1m -body evaluate.json</code> </pre> <br>  Dieser Befehl startet <a href="https://github.com/tsenart/vegeta">Vegeta</a> im <code>attack</code> und sendet eine Minute lang HTTP-POST-Anforderungen mit einer Geschwindigkeit von 1000 Anforderungen pro Sekunde (was zugegebenerma√üen eine ernsthafte Belastung darstellt) an das <a href="https://flipt.dev/architecture/">REST-API-Flipt</a> .  Von Flipt gesendete JSON-Daten sind nicht besonders wichtig.  Sie werden nur f√ºr die korrekte Bildung des Anforderungsk√∂rpers ben√∂tigt.  Eine solche Anforderung wurde vom Flipt-Server empfangen, der die Anforderungs√ºberpr√ºfung durchf√ºhren konnte. <br><br>  Bitte beachten Sie, dass ich mich zuerst entschlossen habe, den Flipt <code>/evaluate</code> Evaluate- <code>/evaluate</code> zu testen.  Tatsache ist, dass der gr√∂√üte Teil des Codes ausgef√ºhrt wird, der die Logik des Projekts implementiert, und dass "komplexe" Server-Berechnungen durchgef√ºhrt werden.  Ich dachte, die Analyse der Ergebnisse dieses Endpunkts w√ºrde mir die wertvollsten Daten zu Bereichen der Anwendung liefern, die verbessert werden k√∂nnten. <br><br><h2>  <font color="#3AC1EF">Messungen</font> </h2><br>  Nachdem ich ein Tool zum Generieren eines ausreichend gro√üen Datenverkehrs hatte, musste ich einen Weg finden, um die Auswirkungen dieses Datenverkehrs auf eine ausgef√ºhrte Anwendung zu messen.  Gl√ºcklicherweise verf√ºgt Go √ºber einen ziemlich guten Standardsatz von Tools, mit denen die Programmleistung gemessen werden kann.  Es geht um das <a href="https://golang.org/pkg/runtime/pprof/">pprof-</a> Paket. <br><br>  Ich werde nicht auf die Details der Verwendung von pprof eingehen.  Ich glaube nicht, dass ich es besser machen werde als Julia Evans, die <a href="https://jvns.ca/blog/2017/09/24/profiling-go-with-pprof/">diesen</a> wunderbaren Artikel √ºber das Profilieren von Go-Programmen mit pprof geschrieben hat (wenn Sie ihn nicht gelesen haben, empfehle ich Ihnen auf jeden Fall, ihn sich anzusehen). <br><br>  Da der HTTP-Router in Flipt mit <a href="https://github.com/go-chi/chi/">go-chi / chi</a> implementiert ist, war es f√ºr mich nicht schwierig, pprof mit dem <a href="">entsprechenden</a> Chi-Intermediate-Handler zu aktivieren. <br><br>  In einem Fenster arbeitete Flipt f√ºr mich, und Vegeta f√ºllte Flipt mit Anfragen und arbeitete in einem anderen Fenster.  Ich habe das dritte Terminalfenster gestartet, um Heap-Profildaten zu sammeln und zu untersuchen: <br><br><pre> <code class="plaintext hljs">pprof -http=localhost:9090 localhost:8080/debug/pprof/heap</code> </pre> <br>  Es verwendet das Google pprof-Tool, mit dem Profildaten direkt im Browser angezeigt werden k√∂nnen. <br><br>  Zuerst habe ich die <code>inuse_space</code> <code>inuse_objects</code> und <code>inuse_space</code> √ºberpr√ºft, um zu verstehen, was auf dem Heap passiert.  Ich konnte jedoch nichts Bemerkenswertes feststellen.  Als ich mich entschied, <code>alloc_space</code> <code>alloc_objects</code> und <code>alloc_space</code> , alarmierte mich etwas. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/12b/e26/640/12be2664018d279c2fcbc0fe4a0fcf2c.png"></div><br>  <i><font color="#999999">Analyse der Profilierungsergebnisse ( <a href="">Original</a> )</font></i> <br><br>  Es gab das Gef√ºhl, dass etwas namens <code>flate.NewWriter</code> 19370 MB Speicher f√ºr eine Minute reservierte.  Und das sind √ºbrigens mehr als 19 Gigabyte!  Hier geschah offensichtlich etwas Merkw√ºrdiges.  Aber was genau?  Wenn Sie sich das Original des obigen Diagramms genau ansehen, stellt sich heraus, dass <code>flate.NewWriter</code> von <code>gzip.(*Writer).Write</code> , der wiederum von <code>middleware.(*compressResponseWriter).Write</code> .  Mir wurde schnell klar, dass das, was geschah, nichts mit Flipt-Code zu tun hatte.  Das Problem lag irgendwo im <a href="https://github.com/go-chi/chi">Chi-</a> Middleware-Code, der zum Komprimieren der Antworten von der API verwendet wurde. <br><br><pre> <code class="plaintext hljs">//   r.Use(middleware.Compress(gzip.DefaultCompression))</code> </pre> <br>  Ich habe die obige Zeile auskommentiert und die Tests erneut ausgef√ºhrt.  Wie erwartet ist eine gro√üe Anzahl von Speicherzuweisungsoperationen verschwunden. <br><br>  Bevor ich anfing, eine L√∂sung f√ºr dieses Problem zu finden, wollte ich diese Speicherzuweisungsvorg√§nge von der anderen Seite betrachten und verstehen, wie sie sich auf die Leistung auswirken.  Insbesondere interessierte mich ihre Auswirkung auf die Zeit, die das Programm zum Sammeln von M√ºll ben√∂tigt.  Ich erinnere mich, dass Go immer noch ein <a href="https://golang.org/cmd/trace/">Trace-</a> Tool hat, mit dem Sie Programme w√§hrend ihrer Ausf√ºhrung analysieren und Informationen √ºber sie f√ºr bestimmte Zeitr√§ume sammeln k√∂nnen.  Die von trace erfassten Daten umfassen wichtige Indikatoren wie die Heap-Auslastung, die Anzahl der ausgef√ºhrten Goroutines, Informationen zu Netzwerk- und Systemanforderungen und, was f√ºr mich besonders wertvoll war, Informationen zu der im Garbage Collector verbrachten Zeit. <br><br>  Um effektiv Informationen √ºber ein laufendes Programm zu sammeln, musste ich die Anzahl der Anfragen pro Sekunde reduzieren, die mit Vegeta an die Anwendung gesendet wurden, da der Server mir regelm√§√üig <code>socket: too many open files</code> Fehler bei <code>socket: too many open files</code> .  Ich nahm an, dass dies darauf zur√ºckzuf√ºhren ist, dass <code>ulimit</code> auf meinem Computer zu niedrig <code>ulimit</code> war, aber ich wollte dann nicht darauf <code>ulimit</code> . <br><br>  Also habe ich Vegeta mit folgendem Befehl neu gestartet: <br><br><pre> <code class="plaintext hljs">echo 'POST http://localhost:8080/api/v1/evaluate' | vegeta attack -rate 100 -duration 2m -body evaluate.json</code> </pre> <br>  Wenn wir dies mit dem vorherigen Szenario vergleichen, wurde nur ein Zehntel der Anforderungen an den Server gesendet, dies wurde jedoch f√ºr einen l√§ngeren Zeitraum durchgef√ºhrt.  Dadurch konnte ich qualitativ hochwertige Daten √ºber die Arbeit des Programms sammeln. <br><br>  In einem anderen Terminalfenster habe ich den folgenden Befehl ausgef√ºhrt: <br><br><pre> <code class="plaintext hljs">wget 'http://localhost:8080/debug/pprof/trace?seconds=60' -O profile/trace</code> </pre> <br>  Als Ergebnis hatte ich eine Datei mit Trace-Daten zur Verf√ºgung, die in 60 Sekunden gesammelt wurden.  Sie k√∂nnen diese Datei mit dem folgenden Befehl untersuchen: <br><br><pre> <code class="plaintext hljs">go tool trace profile/trace</code> </pre> <br>  Die Ausf√ºhrung dieses Befehls f√ºhrte zur Entdeckung der gesammelten Informationen im Browser.  Sie wurden in einer praktischen grafischen Form f√ºr das Studium pr√§sentiert. <br><br>  Details zu <code>go tool trace</code> finden Sie in <a href="https://making.pusher.com/go-tool-trace/">diesem</a> guten Artikel. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6fd/490/4da/6fd4904daee72efc1d0bc86b71450cc9.png"></div><br>  <i><font color="#999999">Flipt Trace-Ergebnisse.</font></i>  <i><font color="#999999">Ein S√§gezahndiagramm der Speicherzuordnung auf dem Heap ist deutlich sichtbar ( <a href="">Original</a> )</font></i> <br><br>  In diesem Diagramm ist leicht zu erkennen, dass die auf dem Heap zugewiesene Speicherkapazit√§t in der Regel recht schnell zunimmt.  In diesem Fall sollte nach dem Wachstum ein starker Abfall sein.  Die Stellen, an denen der zugewiesene Speicherplatz abf√§llt, sind Speicherbereinigungsvorg√§nge.  Hier sehen Sie die ausgepr√§gten blauen Spalten im GC-Bereich, die die f√ºr die Garbage Collection aufgewendete Zeit darstellen. <br><br>  Jetzt habe ich alle Beweise f√ºr das ‚ÄûVerbrechen‚Äú gesammelt, das ich brauche, und k√∂nnte nach einer L√∂sung f√ºr das Problem der Speicherzuweisung suchen. <br><br><h2>  <font color="#3AC1EF">L√∂sung</font> </h2><br>  Um den Grund f√ºr den Aufruf von <code>flate.NewWriter</code> herauszufinden, musste ich mir den <a href="https://github.com/go-chi/chi/">Chi-</a> Quellcode ansehen.  Um herauszufinden, welche Chi-Version ich verwende, habe ich den folgenden Befehl ausgef√ºhrt: <br><br><pre> <code class="plaintext hljs">go list -m all | grep chi github.com/go-chi/chi v3.3.4+incompatible</code> </pre> <br>  Nachdem ich den Quellcode <a href="">chi / middleware / compress.go @ v3.3.4 erreicht hatte</a> , konnte ich die folgende Methode finden: <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encoderDeflate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, level </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">io</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Writer</span></span></span></span> {    dw, err := flate.NewWriter(w, level)    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>    }    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dw }</code> </pre> <br>  In weiteren Untersuchungen stellte ich fest, dass die Methode <code>flate.NewWriter</code> √ºber einen Intermediate-Handler f√ºr jede Antwort aufgerufen wurde.  Dies entsprach der enormen Menge an Speicherzuweisungsvorg√§ngen, die ich zuvor gesehen habe und die API mit tausend Anforderungen pro Sekunde geladen hat. <br><br>  Ich wollte weder die Komprimierung von API-Antworten verweigern noch nach einem neuen HTTP-Router und einer neuen Middleware-Unterst√ºtzungsbibliothek suchen.  Aus diesem Grund habe ich mich zun√§chst entschlossen herauszufinden, ob es m√∂glich ist, mein Problem einfach durch ein Update von Chi zu l√∂sen. <br><br>  Ich lie√ü <code>go get -u -v "github.com/go-chi/chi"</code> laufen, das auf Chi 4.0.2 aktualisiert wurde, aber der Middleware-Code f√ºr die Datenkomprimierung sah, wie es mir schien, genauso aus wie zuvor.  Als ich die Tests erneut durchf√ºhrte, verschwand das Problem nicht. <br><br>  Bevor ich dieses Problem beendete, entschied ich mich, im Chi-Repository nach Problemen oder PR-Nachrichten zu suchen, die so etwas wie ‚ÄûKomprimierungs-Middleware‚Äú erw√§hnen.  Ich bin auf eine PR mit der √úberschrift "Middleware-Komprimierungsbibliothek neu geschrieben" gesto√üen.  Der Autor dieses PR sagte Folgendes: "Dar√ºber hinaus wird sync.Pool f√ºr Encoder verwendet, die √ºber eine Reset-Methode (io.Writer) verf√ºgen, die die Speicherlast reduziert." <br><br>  Hier ist es!  Gl√ºcklicherweise wurde diese PR zum Hauptzweig hinzugef√ºgt, aber da kein neues Chi-Release erstellt wurde, musste ich folgenderma√üen aktualisieren: <br><br><pre> <code class="plaintext hljs">go get -u -v "github.com/go-chi/chi@master"</code> </pre> <br>  Dieses Update, das mich sehr gefreut hat, war abw√§rtskompatibel und erforderte keine √Ñnderungen im Code meiner Anwendung. <br><br><h2>  <font color="#3AC1EF">Ergebnisse</font> </h2><br>  Ich habe die Auslastungstests und die Profilerstellung erneut durchgef√ºhrt.  Dadurch konnte ich √ºberpr√ºfen, ob das Chi-Update das Problem behoben hat. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ff/600/1df/1ff6001df0eccef0aa5b9c11b80a5dc8.png"></div><br>  <i><font color="#999999">Jetzt verwendet flate.NewWriter ein Hundertstel des zuvor verwendeten zugewiesenen Speichers ( <a href="">Original</a> )</font></i> <br><br>  Ein erneuter Blick auf die Trace-Ergebnisse zeigt, dass die Heap-Gr√∂√üe jetzt viel langsamer w√§chst.  Au√üerdem wurde die f√ºr die Speicherbereinigung erforderliche Zeit verk√ºrzt. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/348/584/1fb/3485841fb721f8d31ff3a1bca04bea24.png"></div><br>  <i><font color="#999999">Auf Wiedersehen - "S√§ge" ( <a href="">Original</a> )</font></i> <br><br>  Nach einiger Zeit habe ich das Flipt-Repository <a href="https://github.com/markphelps/flipt/pull/170">aktualisiert</a> , da ich mehr Vertrauen habe als zuvor, dass mein Projekt in der Lage sein wird, mit der hohen Last angemessen umzugehen. <br><br><h2>  <font color="#3AC1EF">Zusammenfassung</font> </h2><br>  Hier sind die Schlussfolgerungen, die ich gezogen habe, nachdem ich die oben genannten Probleme gefunden und behoben habe: <br><br><ol><li>  Sie sollten sich nicht auf die Annahme verlassen, dass Open Source-Bibliotheken (auch popul√§re) optimiert wurden oder dass sie keine offensichtlichen Probleme haben. </li><li>  Ein unschuldiges Problem kann zu schwerwiegenden Konsequenzen f√ºhren, zu Manifestationen des "Domino-Effekts", insbesondere unter schwerer Last. </li><li>  Wenn m√∂glich, sollten Sie <a href="https://golang.org/pkg/sync/">sync.Pool verwenden</a> . </li><li>  Es ist hilfreich, die Tools zum Testen und Profilieren von Projekten unter Last bereitzuhalten. </li><li>  Go Toolkit und Open Source - Gro√üartig! </li></ol><br>  <b>Sehr geehrte Leser!</b>  Wie recherchieren Sie die Leistung Ihrer Go-Projekte? <br><br><div style="text-align:center;"> <a href="https://ruvds.com/vps_start/"><img src="https://habrastorage.org/webt/-o/2e/tu/-o2etuqogwhmdnmysb9_vivc9v4.png"></a> </div><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de477282/">https://habr.com/ru/post/de477282/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de477268/index.html">Suchl√∂sungsoptimierung auf Github</a></li>
<li><a href="../de477272/index.html">Erste Einf√ºhrung in AssemblyScript</a></li>
<li><a href="../de477274/index.html">Wie werden Sie nicht verwendeten CSS-Code los? Teil 1</a></li>
<li><a href="../de477276/index.html">Wie werden Sie nicht verwendeten CSS-Code los? Teil 2</a></li>
<li><a href="../de477278/index.html">Frontend-Test</a></li>
<li><a href="../de477284/index.html">Warum ist JavaScript im strikten Modus erforderlich?</a></li>
<li><a href="../de477286/index.html">Axios oder Fetch: Was im Jahr 2019 verwenden?</a></li>
<li><a href="../de477288/index.html">John Lewis auf der Undoing Aging Conference 2018</a></li>
<li><a href="../de477290/index.html">Digitale Veranstaltungen in Moskau vom 25. November bis 1. Dezember</a></li>
<li><a href="../de477292/index.html">Digitale Veranstaltungen in St. Petersburg vom 25. November bis 1. Dezember</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>