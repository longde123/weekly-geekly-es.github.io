<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌱 ☀️ 🥪 Akselerasi instagram.com. Bagian 1 🖥️ 🤧 🎃</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam beberapa tahun terakhir, banyak hal baru telah muncul di instagram.com . Banyak. Misalnya - alat mendongeng, filter, alat kreatif, pemberitahuan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Akselerasi instagram.com. Bagian 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/468227/">  Dalam beberapa tahun terakhir, banyak <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">hal</a> baru telah muncul di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">instagram.com</a> .  Banyak.  Misalnya - alat mendongeng, filter, alat kreatif, pemberitahuan, pesan langsung.  Namun, seiring pertumbuhan proyek, semua ini memberikan satu efek samping yang menyedihkan, yaitu kinerja instagram.com mulai menurun.  Selama setahun terakhir, tim pengembangan Instagram telah melakukan upaya berkelanjutan untuk memperbaikinya.  Hal ini menyebabkan fakta bahwa total waktu pemuatan umpan Instagram (halaman umpan) menurun hampir 50%. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/webt/wl/oy/ns/wloynshoivqpdf3vtudd3xypwxq.jpeg"></a> <br><br>  Hari ini kami menerbitkan terjemahan dari materi pertama dari serangkaian artikel yang ditujukan untuk kisah bagaimana percepatan instagram.com. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Tentang mengoptimalkan kinerja proyek web</font> </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/032/871/987/0328719872d42adf9b7690c1a6b63693.png"></div><br>  <i><font color="#999999">Peningkatan kinerja selama setahun terakhir (umpan Instagram, metrik Display Done, ms.)</font></i> <br><br>  Salah satu pendekatan paling penting untuk meningkatkan kinerja aplikasi web adalah memprioritaskan pemuatan dan pemrosesan sumber daya dengan benar dan mengurangi waktu henti peramban selama pemuatan halaman.  Dalam kasus kami, banyak dari optimasi ini telah terbukti lebih efektif daripada mengurangi ukuran kode.  Sebagai aturan, kami tidak memiliki keluhan tentang ukuran kode.  Itu cukup kompak.  Dimensinya mulai mengganggu kami hanya setelah banyak perbaikan kecil dilakukan untuk proyek (kami juga berencana untuk menceritakan tentang optimasi ukuran kode).  Perbaikan semacam itu, di samping itu, memiliki dampak yang lebih kecil pada proses pengembangan proyek.  Mereka membutuhkan lebih sedikit perubahan kode dan lebih sedikit refactoring.  Sebagai hasilnya, kami awalnya memusatkan upaya kami tepat pada bidang ini, dimulai dengan sumber daya prapembuatan. <br><br><h2>  <font color="#3AC1EF">Sebuah cerita tentang gambar prapembuat, kode JavaScript dan bahan-bahan yang dibutuhkan untuk menyelesaikan kueri, serta di mana harus berhati-hati</font> </h2><br>  Prinsip umum dari optimasi kami adalah untuk memberi tahu browser secepat mungkin tentang sumber daya apa yang diperlukan untuk memuat halaman.  Kami, sebagai pengembang proyek, dalam banyak kasus tahu sebelumnya apa sebenarnya yang dibutuhkan untuk ini.  Tetapi browser tidak dapat mengetahuinya sampai bagian tertentu dari materi halaman dimuat dan diproses.  Sumber daya yang dimaksud, sebagian besar, termasuk yang dimuat secara dinamis menggunakan JavaScript (misalnya, skrip lain, gambar, bahan yang diperlukan untuk menjalankan permintaan XHR).  Faktanya adalah bahwa browser tidak dapat mendeteksi sumber daya dependen ini hingga mem-parsing dan mengeksekusi beberapa kode JavaScript. <br><br>  Alih-alih menunggu hingga peramban itu sendiri menemukan sumber daya ini, kami dapat memberikannya petunjuk, berikut ini yang dapat segera mulai mengunduhnya.  Kami melakukan ini menggunakan atribut HTML <code>preload</code> .  Itu terlihat seperti ini: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"preload"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"my-js-file.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">as</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"script"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br>  Kami menggunakan petunjuk serupa untuk dua jenis sumber daya pada jalur pemuatan halaman penting.  Ini adalah kode JavaScript yang dimuat secara dinamis dan materi yang dimuat secara dinamis dari GraphQL XHR-request untuk data.  Skrip yang dimuat secara dinamis adalah skrip yang dimuat menggunakan konstruk dari form <code>import('...')</code> untuk rute klien tertentu.  Kami memelihara daftar korespondensi dari titik masuk server dan skrip rute klien.  Akibatnya, ketika kami, di server, menerima permintaan untuk memuat halaman, kami tahu tentang skrip untuk rute klien mana yang perlu Anda unduh.  Sebagai hasilnya, kita dapat, saat membuat kode HTML halaman, menambahkan petunjuk yang sesuai. <br><br>  Misalnya, ketika bekerja dengan titik masuk <code>FeedPage</code> kita tahu bahwa router klien pada akhirnya akan menyelesaikan permintaan untuk mengunduh <code>FeedPageContainer.js</code> .  Sebagai hasilnya, kita dapat menambahkan konstruksi berikut ke kode halaman: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"preload"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/static/FeedPageContainer.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">as</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"script"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br>  Demikian pula, jika kita tahu bahwa permintaan GraphQL direncanakan akan dieksekusi untuk titik masuk dari halaman tertentu, ini berarti bahwa kita perlu memuat bahan untuk mempercepat pelaksanaan permintaan ini.  Ini sangat penting karena fakta bahwa eksekusi permintaan GraphQL seperti itu kadang-kadang membutuhkan banyak waktu, dan halaman tidak dapat merender sampai hasil kueri dikembalikan.  Karena itu, kita perlu membuat server sedini mungkin terlibat dalam pembentukan tanggapan terhadap permintaan tersebut. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"preload"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/graphql/query?id=12345"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">as</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fetch"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"application/json"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br>  Perubahan fitur pemuatan halaman terutama terlihat pada koneksi yang lambat.  Dengan mensimulasikan koneksi 3G cepat (bagan air terjun pertama di bawah ini, yang menggambarkan situasi ketika preloading sumber daya tidak digunakan), kita dapat melihat bahwa memuat <code>FeedPageContainer.js</code> dan mengeksekusi permintaan GraphQL yang terkait dengannya mulai hanya setelah memuat <code>Consumer.js</code> .  Namun, dalam kasus di mana preloading digunakan, memuat skrip <code>FeedPageContainer.js</code> dan mengeksekusi permintaan GraphQL dapat dimulai segera setelah halaman HTML tersedia.  Ini, sebagai tambahan, mengurangi waktu yang diperlukan untuk mengunduh skrip minor apa pun yang menggunakan mekanisme pemuatan malas.  Di sini, <code>FeedSidebarContainer.js</code> dan <code>ActivityFeedBox.js</code> (yang bergantung pada <code>FeedPageContainer.js</code> ) mulai memuat segera setelah memproses <code>Consumer.js</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fe0/10c/222/fe010c2222b31034b109f5cc0d378613.png"></div><br>  <i><font color="#999999">Preload tidak digunakan</font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e3f/e33/b78/e3fe33b78b3b5fe1c04fa3175809e25d.png"></div><br>  <i><font color="#999999">Preload digunakan</font></i> <br><br><h2>  <font color="#3AC1EF">Manfaat memprioritaskan preload</font> </h2><br>  Selain menggunakan atribut <code>preload</code> untuk mulai memuat sumber daya lebih cepat, menggunakan mekanisme ini memiliki keunggulan lain.  Ini terdiri dalam meningkatkan prioritas jaringan pemuatan skrip asinkron.  Ini menjadi penting ketika menggunakan skrip yang dimuat secara tidak sinkron di jalur kritis untuk memuat halaman, karena secara default mereka memuat dengan prioritas rendah.  Akibatnya, prioritas permintaan dan gambar XHR yang terkait dengan area halaman yang terlihat oleh pengguna akan lebih tinggi daripada materi di luar area tampilan.  Tetapi ini dapat menyebabkan situasi di mana skrip kritis yang diperlukan untuk membuat halaman diblokir atau dipaksa untuk berbagi bandwidth dengan sumber daya lainnya.  Jika Anda tertarik, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">inilah</a> akun terperinci dari prioritas sumber daya Chrome.  Penggunaan mekanisme preload secara bijaksana (kami akan berbicara lebih banyak tentang ini di bawah) memberi pengembang tingkat kontrol tertentu atas bagaimana browser memprioritaskan proses awal memuat halaman.  Ini terutama berlaku untuk kasus-kasus ketika pengembang tahu sumber daya apa yang penting untuk tampilan halaman yang benar. <br><br><h2>  <font color="#3AC1EF">Preload Prioritas Masalah</font> </h2><br>  Masalah preloading sumber daya justru terletak pada fakta bahwa hal itu memberikan pengembang tambahan pengaruh untuk mempengaruhi prioritas pemuatan sumber daya.  Ini berarti bahwa pengembang memiliki lebih banyak tanggung jawab untuk penentuan prioritas yang tepat.  Misalnya, ketika menguji situs di wilayah di mana kecepatan jaringan seluler dan WiFi sangat rendah, dan di mana persentase besar dari hilangnya paket diamati, kami memperhatikan bahwa permintaan dieksekusi selama pemrosesan <code>&lt;link rel="preload" as="script"&gt;</code> mendapatkan prioritas yang lebih tinggi daripada permintaan yang dieksekusi saat memproses <code>&lt;script /&gt;</code> bundel JavaScript yang digunakan dalam jalur render halaman kritis.  Ini mengarah ke peningkatan waktu buka halaman keseluruhan. <br><br>  Sumber masalah ini adalah bagaimana kami menempatkan tag preload di halaman kami.  Yaitu, kami menambahkan petunjuk preload hanya untuk bundel, yang merupakan bagian dari halaman saat ini, yang akan kami muat secara asinkron dengan router klien. <br><br><pre> <code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!--   ,    --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"preload"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"SomeConsumerRoute.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">as</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"script"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"preload"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"..."</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">as</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"script"</span></span></span><span class="hljs-tag"> /&gt;</span></span> ... <span class="hljs-comment"><span class="hljs-comment">&lt;!-- ,      --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Common.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Consumer.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Misalnya, pada halaman logout, kami memuat <code>SomeConsumerRoute.js</code> ke <code>Common.js</code> dan <code>Consumer.js</code> , dan karena sumber daya preload dimuat dengan prioritas yang lebih tinggi, tetapi mereka tidak diuraikan, ini memblokir <code>Common.js</code> dan parsing <code>Consumer.js</code> .  Tim pengembangan Penghemat Data Chrome menemukan masalah pramuat yang serupa dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menjelaskan</a> solusi mereka untuk masalah ini.  Dalam kasus mereka, diputuskan untuk selalu menempatkan konstruksi untuk preloading sumber daya asinkron setelah <code>&lt;script /&gt;</code> sumber daya yang menggunakan sumber daya asinkron ini.  Kami memutuskan untuk memuat sebelumnya semua skrip dan menempatkan konstruksi yang sesuai dalam kode sesuai urutan yang dibutuhkan.  Ini memberi kita peluang untuk mulai melakukan preloading semua sumber skrip halaman secepat mungkin.  Ini termasuk tag untuk skrip yang memuat secara sinkron yang tidak dapat ditambahkan ke HTML sampai data server tertentu ditempatkan pada halaman.  Ini memungkinkan kami untuk mengontrol urutan pemuatan skrip. <br><br>  Ini adalah markup yang memuat semua bundel JavaScript. <br><br><pre> <code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!--      --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"preload"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Common.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">as</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"script"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"preload"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Consumer.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">as</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"script"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   ,    --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"preload"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"SomeConsumerRoute.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">as</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"script"</span></span></span><span class="hljs-tag"> /&gt;</span></span> ... <span class="hljs-comment"><span class="hljs-comment">&lt;!-- ,      --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Common.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Consumer.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"SomeConsumerRoute.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">async</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h2>  <font color="#3AC1EF">Preload gambar</font> </h2><br>  Salah satu area kerja utama instagram.com adalah Feed.  Ini adalah halaman gambar dan video yang mendukung pengguliran tanpa akhir.  Kami mengisi halaman ini seperti ini.  Pertama, unduh set publikasi awal, dan kemudian, saat pengguna menggulir halaman, muat set materi tambahan.  Namun, kami tidak ingin pengguna menunggu materi baru dimuat setiap kali ia mencapai bagian bawah kaset.  Akibatnya, agar nyaman untuk bekerja dengan halaman ini, kami mengunggah set materi baru sebelum pengguna mencapai akhir rekaman. <br><br>  Dalam praktiknya, ini, karena beberapa alasan, bukanlah tugas yang mudah: <br><br><ul><li>  Kita perlu mengunduh materi yang tidak terlihat oleh pengguna, sehingga mereka tidak mengambil sumber daya jaringan dan prosesor dari materi yang dia lihat. </li><li>  Kami tidak ingin mengirimkan data yang tidak perlu melalui jaringan, berusaha terlalu keras untuk memuat publikasi yang mungkin tidak dilihat pengguna.  Tetapi, di sisi lain, jika kita tidak memuat dalam jumlah yang cukup bahan, ini akan sering berarti risiko bahwa pengguna akan "mengalami" akhir dari rekaman itu. </li><li>  Proyek instagram.com dirancang untuk bekerja di berbagai perangkat dan di layar dengan berbagai ukuran.  Hasilnya, kami menampilkan gambar dalam rekaman menggunakan atribut <code>srcset</code> dari <code>&lt;img&gt;</code> .  Atribut ini memungkinkan browser, mengingat ukuran layar, untuk memutuskan resolusi gambar mana yang digunakan.  Ini berarti tidak mudah bagi kami untuk menentukan resolusi gambar yang perlu diunduh terlebih dahulu.  Selain itu, ada risiko preloading gambar yang tidak akan digunakan browser. </li></ul><br>  Pendekatan yang kami gunakan untuk menyelesaikan masalah ini adalah dengan membuat abstraksi dari tugas prioritisasi, yang bertanggung jawab untuk mengantri tugas-tugas yang tidak sinkron (dalam hal ini, ini adalah tugas untuk preloading set publikasi berikutnya untuk output dalam rekaman).  Tugas serupa pada awalnya antri dengan <code>idle</code> prioritas (di sini <code>requestIdleCallback</code> digunakan).  Ini berarti bahwa pelaksanaan tugas semacam itu tidak akan dimulai selama peramban sibuk dengan pekerjaan penting lainnya.  Namun, jika pengguna menggulir halaman cukup dekat ke tempat di mana kumpulan publikasi yang diunduh saat ini berakhir, prioritas tugas ini dari bahan preloading berubah menjadi <code>high</code> .  Ini dilakukan dengan membatalkan callback siaga, setelah itu proses preloading segera dimulai. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b62/701/f67/b62701f67c074ca53154fe434123c756.png"></div><br>  <i><font color="#999999">Di awal dan di tengah rekaman, tugas preload data memiliki prioritas idle, dan pada akhir rekaman, prioritas tinggi</font></i> <br><br>  Setelah pengunduhan data JSON selesai untuk kumpulan publikasi berikutnya, kami mengantre tugas latar yang berulang untuk preloading gambar dari kumpulan ini.  Preloading gambar dilakukan dalam urutan publikasi yang ditampilkan dalam umpan daripada secara paralel.  Ini memungkinkan kami untuk memprioritaskan tugas pemuatan data dan menampilkan gambar untuk publikasi yang paling dekat dengan tempat pada halaman yang dilihat pengguna.  Untuk mengunduh gambar dengan ukuran yang benar, kami menggunakan komponen media tersembunyi, yang parameternya sesuai dengan parameter rekaman saat ini.  Di dalam komponen ini ada elemen <code>&lt;img&gt;</code> yang menggunakan atribut <code>srcset</code> , yang sama yang digunakan untuk menampilkan publikasi nyata dalam umpan.  Ini berarti bahwa kami dapat menyediakan browser dengan kemampuan untuk membuat keputusan tentang gambar mana yang akan dimuat.  Akibatnya, browser akan menggunakan logika yang sama saat menampilkan gambar yang digunakan saat melakukan prapembuatan.  Ini juga berarti bahwa kami, menggunakan komponen media yang serupa, dapat memuat foto untuk area lain di situs.  Seperti halaman profil pengguna. <br><br>  Efek keseluruhan dari perbaikan di atas menghasilkan pengurangan 25% dalam waktu yang diperlukan untuk mengunggah foto.  Kita berbicara tentang lamanya waktu antara saat kode publikasi ditambahkan ke DOM dan saat gambar dari publikasi dimuat dan ditampilkan.  Selain itu, ini menyebabkan pengurangan 56% dalam waktu yang pengguna, setelah mencapai akhir umpan, dihabiskan menunggu untuk mengunduh materi baru. <br><br>  <b>Pembaca yang budiman!</b>  Apakah Anda menggunakan mekanisme preloading data untuk mengoptimalkan proyek web Anda? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/webt/it/t5/3p/itt53pns2iucwylb3bwn1fmmtnu.png"></a> </div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id468227/">https://habr.com/ru/post/id468227/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id468213/index.html">tinc-boot - jaringan full-mesh tanpa rasa sakit</a></li>
<li><a href="../id468217/index.html">Jekyll dan Mr. Hyde Corporate Culture</a></li>
<li><a href="../id468219/index.html">Mekanisme Ekstensibilitas yang Dapat Diperpanjang dalam JavaScript</a></li>
<li><a href="../id468223/index.html">Habr Weekly # 19 / BT-pintu untuk kucing, mengapa AI curang, apa yang harus ditanyakan majikan masa depan, sehari dengan iPhone 11 Pro</a></li>
<li><a href="../id468225/index.html">Mengurangi ukuran bundel dengan Webpack Analyzer dan React Lazy / Suspense</a></li>
<li><a href="../id468229/index.html">Catatan kosong pada JavaScript dan TypeScript</a></li>
<li><a href="../id468231/index.html">Apakah keamanan dalam AEM platform atau masalah implementasi?</a></li>
<li><a href="../id468233/index.html">Cara mengetik memeriksa 4 juta baris kode Python. Bagian 1</a></li>
<li><a href="../id468235/index.html">Cara mengetik memeriksa 4 juta baris kode Python. Bagian 2</a></li>
<li><a href="../id468237/index.html">Cara mengetik memeriksa 4 juta baris kode Python. Bagian 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>