<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçü§ù‚Äçüë®üèª üé© üÜí Documentos como c√≥digo. Parte 1: automatize a atualiza√ß√£o üò§ üë©‚Äçüî¨ üë©üèø‚Äçüîß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Em grandes projetos, consistindo em dezenas e centenas de servi√ßos em intera√ß√£o, uma abordagem √† documenta√ß√£o como c√≥digo - documentos como c√≥digo - e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Documentos como c√≥digo. Parte 1: automatize a atualiza√ß√£o</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/youla/blog/459640/"><p><img src="https://habrastorage.org/webt/cw/mu/zp/cwmuzpbeunmmybhxtwlffemf01k.gif"></p><br><p>  Em grandes projetos, consistindo em dezenas e centenas de servi√ßos em intera√ß√£o, uma abordagem √† documenta√ß√£o como c√≥digo - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documentos como c√≥digo</a> - est√° se tornando cada vez mais obrigat√≥ria. </p><br><p>  Mostrarei como voc√™ pode aplicar essa filosofia nas realidades do servi√ßo classificado, ou melhor, come√ßarei a partir do primeiro est√°gio de sua implementa√ß√£o: automa√ß√£o da atualiza√ß√£o de dados na documenta√ß√£o. </p><a name="habracut"></a><br><h2 id="nabor-instrumentov">  Kit de ferramentas </h2><br><p>  O princ√≠pio de ‚Äúdocumenta√ß√£o como c√≥digo‚Äù implica o uso das mesmas ferramentas ao escrever documenta√ß√£o e ao criar c√≥digo: linguagens de marca√ß√£o de texto, sistemas de controle de vers√£o, revis√£o de c√≥digo e testes autom√°ticos.  O objetivo principal: criar condi√ß√µes para que toda a equipe trabalhe em conjunto no resultado final - uma base de conhecimento completa e instru√ß√µes para o uso de servi√ßos de produtos individuais.  A seguir, falarei sobre ferramentas espec√≠ficas que escolhemos para resolver esse problema. </p><br><p>  Como uma linguagem de marca√ß√£o de texto, decidimos usar o mais universal - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reStructuredText</a> .  Al√©m de um grande n√∫mero de diretivas que fornecem todas as fun√ß√µes b√°sicas para estruturar o texto, essa linguagem suporta os principais formatos finais, incluindo o HTML necess√°rio para o nosso projeto. </p><br><p>  Os arquivos s√£o convertidos de .rst para .html atrav√©s do gerador de documenta√ß√£o do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sphinx</a> .  Permite criar sites est√°ticos para os quais voc√™ pode criar seus pr√≥prios ou usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">temas</a> prontos.  Nosso projeto usa dois temas prontos - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">stanford-theme</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bootstrap-theme</a> .  O segundo cont√©m subt√≥picos que permitem definir diferentes esquemas de cores para os principais elementos da interface. </p><br><p>  Para acesso r√°pido e conveniente √† vers√£o atual da documenta√ß√£o, usamos um site est√°tico, cujo host √© uma m√°quina virtual, acess√≠vel a partir da rede local da equipe de desenvolvimento. </p><br><p>  Os arquivos de origem do projeto s√£o armazenados no reposit√≥rio do Bitbucket e o site √© gerado apenas a partir dos arquivos contidos na ramifica√ß√£o principal.  A atualiza√ß√£o dos dados s√≥ √© poss√≠vel atrav√©s de solicita√ß√£o por solicita√ß√£o, que permite verificar todas as novas se√ß√µes da documenta√ß√£o antes de serem publicadas em dom√≠nio p√∫blico. </p><br><p>  Como entre a conclus√£o de uma nova se√ß√£o da documenta√ß√£o e o envio ao site, √© necess√°rio verificar seu conte√∫do, a chave em toda a cadeia √© o processo de constru√ß√£o do site e atualiza√ß√£o dos dados no host.  Este procedimento deve ser repetido sempre que a solicita√ß√£o de recebimento com a atualiza√ß√£o for mesclada com a ramifica√ß√£o principal do projeto. </p><br><p><img src="https://habrastorage.org/webt/z3/ua/e9/z3uae9eyv-lj3sipqmirpbpoony.png"></p><br><p>  A implementa√ß√£o dessa l√≥gica permite ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jenkins</a> - um sistema de integra√ß√£o cont√≠nua de desenvolvimento, no nosso caso - a documenta√ß√£o.  Vou falar mais sobre as configura√ß√µes nas se√ß√µes: </p><br><ol><li>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Adicionando um novo n√≥ ao Jenkins</a></em> </li><li>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Descri√ß√£o do Jenkinsfile</a></em> </li><li>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Integra√ß√£o Jenkins e Bitbucket</a></em> </li></ol><br><h2 id="dobavlenie-novogo-uzla-v-jenkins">  Adicionando um novo n√≥ ao Jenkins </h2><br><p>  Para criar e atualizar a documenta√ß√£o no site, voc√™ deve registrar uma m√°quina previamente preparada como agente da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jenkins</a> . </p><br><h4 id="podgotovka-mashiny">  Prepara√ß√£o da m√°quina </h4><br><p> De acordo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">com os requisitos da Jenkins</a> , todos os componentes inclu√≠dos no sistema, incluindo a m√°quina principal e todos os n√≥s do agente registrado, devem ter o JDK ou o JRE instalado.  No nosso caso, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JDK 8</a> ser√° usado, cuja instala√ß√£o √© suficiente para executar o comando: </p><br><pre><code class="plaintext hljs">sudo apt-get -y install java-1.8.0-openjdk git</code> </pre> <br><p>  A m√°quina principal se conectar√° ao agente para executar tarefas atribu√≠das nela.  Para fazer isso, voc√™ precisa criar um usu√°rio no agente sob o qual todas as opera√ß√µes ser√£o executadas e no qual todos os arquivos gerados pelo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jenkins</a> ser√£o armazenados na pasta pessoal.  Nos sistemas Linux, basta executar o comando: </p><br><pre> <code class="plaintext hljs">sudo adduser jenkins \--shell /bin/bash su jenkins</code> </pre> <br><p>  Para estabelecer uma conex√£o entre a m√°quina principal e o agente, voc√™ deve configurar o SSH e adicionar as chaves de autoriza√ß√£o necess√°rias.  Geraremos as chaves no agente, ap√≥s o que adicionaremos a chave p√∫blica ao arquivo <em>allowed_keys</em> para o usu√°rio <em>jenkins</em> . </p><br><p>  Criaremos o site com a documenta√ß√£o em um cont√™iner do Docker usando uma imagem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">python</a> pronta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">: 3.7</a> .  Siga as instru√ß√µes na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o oficial</a> para instalar o Docker no agente.  Para concluir o processo de instala√ß√£o, voc√™ deve se reconectar ao agente.  Verifique a instala√ß√£o executando o comando que carrega a imagem de teste: </p><br><pre> <code class="plaintext hljs">docker run hello-world</code> </pre> <br><p>  Para n√£o precisar executar comandos do Docker em nome do superusu√°rio (sudo), basta adicionar o grupo de janelas do usu√°rio criado no est√°gio de instala√ß√£o, em nome do qual os comandos ser√£o executados. </p><br><pre> <code class="plaintext hljs">sudo usermod -aG docker $USER</code> </pre> <br><h4 id="konfiguraciya-novogo-uzla-v-jenkins">  Configura√ß√£o do novo n√≥ Jenkins </h4><br><p>  Como a conex√£o ao agente requer autoriza√ß√£o, voc√™ deve adicionar as credenciais apropriadas nas configura√ß√µes do Jenkins.  Instru√ß√µes detalhadas sobre como fazer isso em m√°quinas Windows s√£o fornecidas na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o oficial do Jenkins</a> . </p><br><blockquote>  IMPORTANTE: O identificador especificado na se√ß√£o <em>Configurar Jenkins</em> -&gt; <em>Gerenciar ambientes de constru√ß√£o</em> -&gt; <strong>Nome do n√≥</strong> -&gt; <em>Configurar</em> no par√¢metro <strong>Tags</strong> √© usado no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jenkinsfile</a> para indicar o agente no qual todas as opera√ß√µes ser√£o executadas. </blockquote><br><h2 id="opisanie-jenkinsfile">  Descri√ß√£o do Jenkinsfile </h2><br><p>  A raiz do reposit√≥rio do projeto cont√©m o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jenkinsfile</a> , que cont√©m instru√ß√µes para: </p><br><ul><li>  Preparando o Ambiente de Constru√ß√£o e Instalando Depend√™ncias </li><li>  Crie um site usando o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sphinx</a> </li><li>  atualizando informa√ß√µes do host. </li></ul><br><p>  As instru√ß√µes s√£o definidas usando diretivas especiais, cuja aplica√ß√£o consideraremos mais adiante no exemplo do arquivo usado no projeto. </p><br><h4 id="ukazanie-agenta">  Indica√ß√£o do agente </h4><br><p>  No in√≠cio do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">arquivo Jenkins,</a> especifique o r√≥tulo do agente em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jenkins</a> , no qual todas as opera√ß√µes ser√£o executadas.  Para fazer isso, use a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">diretiva de agente</a> : </p><br><pre> <code class="plaintext hljs">agent { label '-' }</code> </pre> <br><h4 id="podgotovka-sredy">  Prepara√ß√£o do ambiente </h4><br><p>  Para executar o comando sphinx-build site build, √© necess√°rio definir vari√°veis ‚Äã‚Äãde ambiente nas quais os caminhos de dados reais ser√£o armazenados.  Al√©m disso, para atualizar as informa√ß√µes no host, voc√™ deve especificar antecipadamente os caminhos em que os dados do site com a documenta√ß√£o est√£o armazenados.  A <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">diretiva de ambiente</a> permite atribuir esses valores a vari√°veis: </p><br><pre> <code class="plaintext hljs">environment { SPHINX_DIR = '.' //,    Sphinx BUILD_DIR = 'project_home_built' //    SOURCE_DIR = 'project_home_source' //   .rst  .md  DEPLOY_HOST = 'username@127.1.1.0:/var/www/html/' //@IP__:__ }</code> </pre> <br><h4 id="osnovnye-deystviya">  Principais a√ß√µes </h4><br><p>  As principais instru√ß√µes que ser√£o executadas no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jenkinsfile</a> est√£o contidas na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">diretiva est√°gios</a> , que consiste nas diferentes etapas descritas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pelas diretivas do est√°gio</a> .  Um exemplo simples de um pipeline de IC em tr√™s est√°gios: </p><br><pre> <code class="plaintext hljs">pipeline { agent any stages { stage('Build') { steps { echo 'Building..' } } stage('Test') { steps { echo 'Testing..' } } stage('Deploy') { steps { echo 'Deploying....' } } } }</code> </pre> <br><h4 id="zapusk-konteynera-docker-i-ustanovka-zavisimostey">  Inicie o cont√™iner do Docker e instale depend√™ncias </h4><br><p>  Primeiro, execute o cont√™iner do Docker com a imagem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">python</a> conclu√≠da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">: 3.7</a> .  Para fazer isso, use o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">comando docker run</a> com os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sinalizadores --rm</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">-i</a> .  Em seguida, fa√ßa o seguinte: </p><br><ul><li>  instale o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">python virtualenv</a> ; </li><li>  criar e ativar um novo ambiente virtual; </li><li>  instalar nele todas as depend√™ncias necess√°rias listadas no arquivo <br>  requirements.txt, que √© armazenado na raiz do reposit√≥rio do projeto. </li></ul><br><pre> <code class="plaintext hljs">stage('Install Dependencies') { steps { sh ''' docker run --rm -i python:3.7 python3 -m pip install --user --upgrade pip python3 -m pip install --user virtualenv python3 -m virtualenv pyenv . pyenv/bin/activate pip install -r \${SPHINX\_DIR}/requirements.txt ''' } }</code> </pre> <br><h4 id="sborka-sayta-s-dokumentaciey">  Construa um site com documenta√ß√£o </h4><br><p>  Agora vamos construir um site.  Para fazer isso, execute o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">comando sphinx-build</a> com os seguintes sinalizadores: </p><br><p>  <code>-q</code> : apenas avisos e erros de log; <br>  <code>-w</code> : escreve um log no arquivo especificado ap√≥s o sinalizador; <br>  <code>-b</code> : nome do construtor do site; <br>  <code>-d</code> : especifique o diret√≥rio para armazenar arquivos em cache - pickles da doctree. </p><br><p>  Antes de iniciar a montagem, usando o <code>rm -rf</code> exclua a montagem e os logs anteriores do site.  Em caso de erro em um dos est√°gios, o log de execu√ß√£o do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sphinx-build</a> aparecer√° no console do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jenkins</a> . </p><br><pre> <code class="plaintext hljs">stage('Build') { steps { // clear out old files sh 'rm -rf ${BUILD_DIR}' sh 'rm -f ${SPHINX_DIR}/sphinx-build.log' sh ''' ${WORKSPACE}/pyenv/bin/sphinx-build -q -w ${SPHINX_DIR}/sphinx-build.log \ -b html \ -d ${BUILD_DIR}/doctrees ${SOURCE\_DIR} ${BUILD\_DIR} ''' } post { failure { sh 'cat ${SPHINX_DIR}sphinx-build.log' } } }</code> </pre> <br><h4 id="obnovlenie-sayta-na-hoste">  Atualiza√ß√£o do site host </h4><br><p>  E, finalmente, atualizaremos as informa√ß√µes no host que atende o site com a documenta√ß√£o do produto dispon√≠vel no ambiente local.  Na implementa√ß√£o atual, o host √© a mesma m√°quina virtual registrada como um agente Jenkins para a tarefa de montar e atualizar a documenta√ß√£o. </p><br><p>  Como ferramenta de sincroniza√ß√£o, usamos o utilit√°rio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rsync</a> .  Para que funcione corretamente, √© necess√°rio configurar uma conex√£o SSH entre o cont√™iner do Docker, no qual estava indo o site com a documenta√ß√£o, e o host. </p><br><p>  Para configurar a conex√£o SSH usando o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jenkinsfile</a> , os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">seguintes plug-ins</a> devem ser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">instalados</a> no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jenkins</a> : </p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SSH Agent Plugin</a> - permite que voc√™ use a etapa <code>sshagent</code> nos scripts para fornecer credenciais no formul√°rio <em>nome de usu√°rio / chave</em> . </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Plug</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">in de credenciais do SSH</a> - permite salvar credenciais do <em>nome de usu√°rio / chave</em> do formul√°rio nas configura√ß√µes do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jenkins</a> . </li></ol><br><p>  Ap√≥s instalar os plug-ins, voc√™ deve especificar as credenciais atuais para se conectar ao host, preenchendo o formul√°rio na se√ß√£o <strong>Credenciais</strong> : </p><br><ul><li>  <strong>ID</strong> : identificador que ser√° usado no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">arquivo Jenkins</a> na etapa <code>sshagent</code> para indicar credenciais espec√≠ficas ( <code>docs-deployer</code> ); </li><li>  <strong>Nome de usu√°rio</strong> : o nome do usu√°rio sob o qual as opera√ß√µes de atualiza√ß√£o de dados do site ser√£o executadas (o usu√°rio deve ter <strong><em>acesso de grava√ß√£o √†</em></strong> pasta <code>/var/html</code> do host); </li><li>  <strong>Chave privada</strong> : uma chave privada para acessar o host; </li><li>  <strong>Senha</strong> : senha da chave, se ela tiver sido definida no est√°gio de gera√ß√£o. </li></ul><br><p>  Abaixo est√° o c√≥digo de script que se conecta via SSH e atualiza as informa√ß√µes no host usando as vari√°veis ‚Äã‚Äãdo sistema especificadas no est√°gio de prepara√ß√£o do ambiente com os caminhos para os dados necess√°rios.  O resultado do comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rsync</a> √© gravado no log, que ser√° exibido no console do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jenkins</a> em caso de erros de sincroniza√ß√£o. </p><br><pre> <code class="plaintext hljs">stage('Deploy') { steps { sshagent(credentials: ['docs-deployer']) { sh ''' #!/bin/bash rm -f ${SPHINX_DIR}/rsync.log RSYNCOPT=(-aze 'ssh -o StrictHostKeyChecking=no') rsync "${RSYNCOPT[@]}" \ --delete \ ${BUILD_DIR_CI} ${DEPLOY_HOST}/ ''' } } post { failure { sh 'cat ${SPHINX_DIR}/rsync.log' } } }</code> </pre> <br><h2 id="integraciya-jenkins-i-bitbucket">  Integra√ß√£o Jenkins e Bitbucket </h2><br><p>  Existem v√°rias maneiras de organizar a intera√ß√£o de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jenkins</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Bitbucket</a> , mas em nosso projeto, decidimos usar o plug-in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parameterized Builds for Jenkins</a> .  A documenta√ß√£o oficial cont√©m <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">instru√ß√µes</a> detalhadas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">para a instala√ß√£o do</a> plug <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">-</a> in, bem como as configura√ß√µes que devem ser especificadas para os dois sistemas.  Para trabalhar com este plug-in, voc√™ precisa criar um usu√°rio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jenkins</a> e gerar um token especial para ele, que permitir√° que esse usu√°rio efetue login no sistema. </p><br><h4 id="sozdanie-polzovatelya-i-api-tokena">  Criando um Usu√°rio e um Token de API </h4><br><p>  Para criar um novo usu√°rio no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jenkins</a> , v√° para <em>Jenkins Configura√ß√µes</em> -&gt; <em>Gerenciamento de usu√°rios</em> -&gt; <em>Criar usu√°rio</em> e preencha todas as credenciais necess√°rias no formul√°rio. </p><br><p>  O mecanismo de autentica√ß√£o que permite que scripts ou aplicativos de terceiros usem a API do Jenkins sem transmitir a senha do usu√°rio √© um token de API especial que pode ser gerado para cada usu√°rio do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jenkins</a> .  Para fazer isso: </p><br><ul><li>  efetue login no console de gerenciamento usando os detalhes do usu√°rio criado anteriormente; </li><li>  v√° para <em>Configurar Jenkins</em> -&gt; <em>Gerenciamento de Usu√°rio</em> ; </li><li>  clique no √≠cone de engrenagem √† direita do nome do usu√°rio sob o qual eles est√£o autorizados no sistema; </li><li>  encontre <em>a API de token</em> na lista de par√¢metros e clique no bot√£o <em>Adicionar novo token</em> ; </li><li>  no campo exibido, especifique o identificador do token da API e clique no bot√£o <em>Gerar</em> ; </li><li>  seguindo o prompt na tela, copie e salve o token da API gerado. </li></ul><br><p>  Agora, nas configura√ß√µes do servidor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Bitbucket</a> , voc√™ pode especificar o usu√°rio padr√£o para se conectar ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jenkins</a> . </p><br><h2 id="zaklyuchenie">  Conclus√£o </h2><br><p>  Se anteriormente, o processo consistia em v√°rias etapas: </p><br><ul><li>  Fa√ßa o download da atualiza√ß√£o para o reposit√≥rio </li><li>  aguarde confirma√ß√£o de corre√ß√£o; </li><li>  montar um site com documenta√ß√£o; </li><li>  atualizar informa√ß√µes no host; </li></ul><br><p>  agora basta clicar em um bot√£o Mesclar no Bitbucket.  Se, ap√≥s a verifica√ß√£o, n√£o for necess√°rio fazer altera√ß√µes nos arquivos de origem, a vers√£o atual da documenta√ß√£o ser√° atualizada imediatamente ap√≥s a confirma√ß√£o da corre√ß√£o dos dados. </p><br><p>  Isso simplifica bastante a tarefa do redator t√©cnico, poupando-o de um grande n√∫mero de a√ß√µes manuais e os gerentes de projeto obt√™m uma ferramenta conveniente para rastrear adi√ß√µes e coment√°rios da documenta√ß√£o. </p><br><p>  Automatizar esse processo √© o primeiro passo na constru√ß√£o de uma infraestrutura de gerenciamento de documenta√ß√£o.  No futuro, planejamos adicionar testes autom√°ticos que verificar√£o a corre√ß√£o dos links externos usados ‚Äã‚Äãna documenta√ß√£o e tamb√©m queremos criar objetos de interface interativa que s√£o incorporados a temas prontos para o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sphinx</a> . </p><br><p>  Obrigado a quem leu isso por aten√ß√£o, em breve continuaremos compartilhando os detalhes da cria√ß√£o de documenta√ß√£o em nosso projeto! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt459640/">https://habr.com/ru/post/pt459640/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt459624/index.html">Drones militares</a></li>
<li><a href="../pt459626/index.html">Windows Notification Facility: a superf√≠cie de ataque n√£o documentada</a></li>
<li><a href="../pt459628/index.html">A Open Invention Network possui mais de tr√™s mil licenciados - o que significa para software de c√≥digo aberto</a></li>
<li><a href="../pt459630/index.html">Tic Tac Toe Parte 2: Desfazer / Refazer sem estado</a></li>
<li><a href="../pt459638/index.html">Criando uma base global de conhecimento sobre baterias</a></li>
<li><a href="../pt459642/index.html">Acesso seguro para registrar campos em C ++ sem sacrificar a efici√™ncia (usando o CortexM como exemplo)</a></li>
<li><a href="../pt459644/index.html">Dimmers LED</a></li>
<li><a href="../pt459648/index.html">Tudo deve estar bem no analisador: funcionalidade e interface ... Estamos explorando a nova interface Solar appScreener 3.1</a></li>
<li><a href="../pt459650/index.html">Como n√£o perder dinheiro na caixa preta: m√©todos de teste de cobran√ßa</a></li>
<li><a href="../pt459652/index.html">Abordagem de teste de regress√£o automatizada</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>