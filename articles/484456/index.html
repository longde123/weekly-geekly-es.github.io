<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üì° üë©üèΩ‚Äçü§ù‚Äçüë®üèæ üåñ ReactJS, representaci√≥n del lado del servidor y algunas sutilezas de procesamiento de metaetiquetas de p√°gina üÜî üíå üñïüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Uno de los problemas que tendr√° que resolver al escribir una aplicaci√≥n de representaci√≥n del lado del servidor es trabajar con las metaetiquetas que ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ReactJS, representaci√≥n del lado del servidor y algunas sutilezas de procesamiento de metaetiquetas de p√°gina</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484456/"> Uno de los problemas que tendr√° que resolver al escribir una aplicaci√≥n de representaci√≥n del lado del servidor es trabajar con las metaetiquetas que cada p√°gina deber√≠a tener, lo que ayuda a indexarlas por los motores de b√∫squeda. <br><br>  Comenzando a google, la primera soluci√≥n a la que se lo dirigir√° <a href="https://github.com/nfl/react-helmet" rel="nofollow">es</a> probablemente <a href="https://github.com/nfl/react-helmet" rel="nofollow">React Helmet</a> . <br><br>  Una de las ventajas de la biblioteca es que puede considerarse isom√≥rfica de alguna manera y puede usarse perfectamente tanto en el lado del cliente como en el lado del servidor. <br><a name="habracut"></a><br><pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Page</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Helmet</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Turbo Todo</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"theme-color"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"#008f68"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Helmet</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {/* ... */} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ); } }</span></span></code> </pre> <br>  En el servidor, el enrutador se ver√° as√≠: <br><br><pre> <code class="javascript hljs">app.get(<span class="hljs-string"><span class="hljs-string">'/*'</span></span>, (req, res) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> html = renderToString(<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">App</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">); const helmet = Helmet.renderStatic(); res.send(` </span><span class="hljs-meta"><span class="xml"><span class="hljs-meta">&lt;!doctype html&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag"> ${</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">helmet.htmlAttributes.toString</span></span></span></span><span class="xml"><span class="hljs-tag">()}&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ${helmet.title.toString()} ${helmet.meta.toString()} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag"> ${</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">helmet.bodyAttributes.toString</span></span></span></span><span class="xml"><span class="hljs-tag">()}&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"app"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">${html}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> `); });</span></span></code> </pre> <br>  Ambos fragmentos son completamente correctos y funcionales, pero hay un PERO, el c√≥digo anterior para el servidor es completamente sincr√≥nico y, por lo tanto, completamente seguro, pero si se vuelve as√≠ncrono, ocultar√° errores en s√≠ mismos dif√≠cilmente depurados: <br><br><pre> <code class="javascript hljs">app.get(<span class="hljs-string"><span class="hljs-string">'/*'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (req, res) =&gt; { <span class="hljs-comment"><span class="hljs-comment">// .... await anyAsyncAction(); //.... const helmet = Helmet.renderStatic(); // ... });</span></span></code> </pre><br>  El problema aqu√≠ est√° principalmente en la propia biblioteca React Helmet y, en particular, en que recopila todas las etiquetas dentro del √°rbol React y la pone de hecho en una variable global, y dado que el c√≥digo se ha vuelto as√≠ncrono, el c√≥digo puede mezclar simult√°neamente solicitudes procesadas de diferentes usuarios. <br><br>  La buena noticia aqu√≠ es que se hizo una bifurcaci√≥n sobre la base de esta biblioteca y ahora es mejor dar preferencia a la biblioteca <a href="https://github.com/staylor/react-helmet-async" rel="nofollow">react-helmet-async</a> .  El paradigma principal es que en este caso, el contexto del casco de reacci√≥n se aislar√° en el marco de una sola solicitud encapsulando la aplicaci√≥n React Tree en HelmetProvider: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Helmet, HelmetProvider } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-helmet-async'</span></span>; app.get(<span class="hljs-string"><span class="hljs-string">'/*'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (req, res) =&gt; {‚Äã <span class="hljs-comment"><span class="hljs-comment">// ... code may content any async actions const helmetContext = {}; const app = ( &lt;HelmetProvider context={helmetContext}&gt; &lt;App/&gt; &lt;/HelmetProvider&gt; ); // ...code may content any async actions const html = renderToString(app); const { helmet } = helmetContext; // ...code may content any async actions });</span></span></code> </pre><br>  Esto podr√≠a terminarse, pero tal vez ir√°s m√°s lejos en un intento de exprimir el m√°ximo rendimiento y mejorar algunas m√©tricas de SEO.  Por ejemplo, puede mejorar la m√©trica Tiempo hasta el primer byte (TTFB), cuando el servidor puede enviar el dise√±o de p√°gina con fragmentos a medida que se calculan, en lugar de esperar hasta que se calcule por completo.  Para hacer esto, comenzar√° a buscar el uso de <i>renderToNodeStream en</i> lugar de <i>renderToString</i> . <br><br>  Aqu√≠ nuevamente nos enfrentamos con un peque√±o problema.  Para obtener todas las metaetiquetas que necesita una p√°gina, debemos pasar por todo el √°rbol de reacci√≥n de la aplicaci√≥n, pero el problema es que las metaetiquetas deben enviarse antes del momento en que comenzamos a transmitir contenido usando renderToNodeStream.  De hecho, debemos calcular el React Tree dos veces y se ve as√≠: <br><br><pre> <code class="javascript hljs">app.get(<span class="hljs-string"><span class="hljs-string">'/*'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (req, res) =&gt; {‚Äã <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> helmetContext = {}; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> app = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;HelmetProvider context={helmetContext}&gt; &lt;App</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/&gt; &lt;/</span></span></span></span><span class="hljs-function"><span class="hljs-params">HelmetProvider&gt; </span></span></span><span class="hljs-function">); // </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">do</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">first</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pass</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">render</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">so</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">that</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">react</span></span></span><span class="hljs-function">-</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">helmet</span></span></span><span class="hljs-function">-</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">async</span></span></span><span class="hljs-function"> // </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">can</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">see</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">what</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">meta</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">tags</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">to</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">render</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ReactDOMServer</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">renderToString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">app</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">helmet</span></span></span><span class="hljs-function"> } = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">helmetContext</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">write</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">` &lt;html&gt; &lt;head&gt; </span></span></span><span class="hljs-subst"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string"><span class="hljs-subst">${helmet.title.toString()}</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">‚Äã </span></span></span><span class="hljs-subst"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string"><span class="hljs-subst">${helmet.meta.toString()}</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-string"> &lt;/head&gt; &lt;body&gt; `</span></span></span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">stream</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ReactDOMServer</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">renderToNodeStream</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">app</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">stream</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pipe</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response, { end: </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span><span class="hljs-function"><span class="hljs-params"> }</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">stream</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">on</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'end'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, (</span></span></span><span class="hljs-function">) =&gt;</span></span> response.end(<span class="hljs-string"><span class="hljs-string">'&lt;/body&gt;&lt;/html&gt;'</span></span>)); });</code> </pre><br>  Con este enfoque, la necesidad de dicha optimizaci√≥n se convierte en principio en una gran pregunta y es poco probable que mejoremos la m√©trica TTFB que queremos lograr. <br><br>  Aqu√≠ podemos jugar un poco de optimizaci√≥n y hay varias opciones <br><br><ul><li>  en lugar de renderToString, use renderToStaticMarkup, que probablemente ayudar√° en cierta medida a ganar algo de tiempo </li><li>  en lugar de utilizar los renderizadores que ofrece el react de la caja, cree su propia versi√≥n ligera del paso a trav√©s del √°rbol de reacci√≥n, por ejemplo, basado en la biblioteca <a href="https://github.com/ctrlplusb/react-tree-walker" rel="nofollow">react-tree-walker</a> , o rechace renderizar completamente el √°rbol y mire solo en el primer nivel del √°rbol, sin prestar atenci√≥n a los componentes integrados, por lo que decir representaci√≥n superficial </li><li>  considere un sistema de almacenamiento en cach√© que a veces puede saltear la primera caminata a trav√©s del √°rbol de reacci√≥n </li></ul><br>  Pero, en cualquier caso, todo lo descrito parece demasiado sofisticado y, en principio, arroja dudas sobre esta carrera por la eficiencia, cuando se construye una arquitectura anormalmente compleja en un par de milisegundos. <br><br>  Me parece en este caso, para aquellos que est√°n familiarizados con la forma de extraer datos para renderizar para el SSR (y si alguien no lo sabe, entonces este es un excelente <a href="https://alligator.io/react/react-router-ssr/" rel="nofollow">art√≠culo</a> sobre este tema), ayudaremos a extraer la metaetiqueta para la p√°gina. <br><br>  El concepto general es que tenemos un archivo de configuraci√≥n para enrutadores: esta es una estructura JS ordinaria, que es una matriz de objetos, cada uno de los cuales contiene varios campos del <i>componente</i> tipo, <i>ruta</i> .  En funci√≥n de la url de solicitud, encontramos el enrutador y el componente asociado desde el archivo de configuraci√≥n.  Para estos componentes, definimos un conjunto de m√©todos est√°ticos como <i>loadData</i> y, por ejemplo, <i>creaMetatags</i> para nuestras metaetiquetas. <br><br>  Por lo tanto, el componente de la p√°gina se convertir√° as√≠: <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductPage</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> createMetatags(store, request){ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> item = selectItem(store, request.params.product_id); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [] .concat({<span class="hljs-attr"><span class="hljs-attr">property</span></span>: <span class="hljs-string"><span class="hljs-string">'og:description'</span></span>, <span class="hljs-attr"><span class="hljs-attr">content</span></span>: item.desc}) .concat({<span class="hljs-attr"><span class="hljs-attr">property</span></span>: <span class="hljs-string"><span class="hljs-string">'og:title'</span></span>, <span class="hljs-attr"><span class="hljs-attr">content</span></span>: item.title}) } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> loadData(store, request){ <span class="hljs-comment"><span class="hljs-comment">// extract external data for SSR and return Promise } // the rest of component }</span></span></code> </pre> <br>  Hemos definido un m√©todo est√°tico createMetatags que crea el conjunto requerido de metaetiquetas.  Con esto en mente, el c√≥digo en el servidor ser√° as√≠: <br><br><pre> <code class="javascript hljs">app.get(<span class="hljs-string"><span class="hljs-string">'/*'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (req, res) =&gt; {‚Äã‚Äã <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = createStore(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> matchedRoutes = matchRoutes(routes, request.path); <span class="hljs-comment"><span class="hljs-comment">// load app state await Promise.all( matchedRoutes.reduce((promises, { route }) =&gt; { return route.component.loadData ? promises.concat(route.component.loadData(store, req)) : promises; }, []) ); // to get metatags const metaTags = matchedRoutes.reduce((tags, {route}) =&gt; { return route.component.createMetatags ? tags.concat(route.component.createMetatags(store, req)): tags }); res.write(`‚Äã &lt;html&gt;‚Äã &lt;head&gt;‚Äã ${ReactDOMServer.renderToString(() =&gt; metaTags.map(tag =&gt; &lt;meta {...tag}/&gt;) )}‚Äã‚Äã &lt;/head&gt;‚Äã &lt;body&gt;‚Äã `);‚Äã const stream = ReactDOMServer.renderToNodeStream(app);‚Äã stream.pipe(response, { end: false });‚Äã stream.on('end', () =&gt; response.end('&lt;/body&gt;&lt;/html&gt;'));‚Äã });</span></span></code> </pre> <br>  Es decir  Ahora no necesitamos renderizar el √°rbol React dos veces: podemos extraer inmediatamente todo lo que necesitamos para trabajar desde una aplicaci√≥n isomorfa, por analog√≠a con la extracci√≥n de datos para una ruta. </div></div><p>Source: <a href="https://habr.com/ru/post/484456/">https://habr.com/ru/post/484456/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../484442/index.html">Ejemplo SNMPv3</a></li>
<li><a href="../484444/index.html">C√≥mo las condiciones de funcionamiento afectan la bater√≠a o la historia de una resurrecci√≥n milagrosa</a></li>
<li><a href="../484446/index.html">Python 3.5 Implementando concurrencia usando asyncio</a></li>
<li><a href="../484448/index.html">Conferencia DEFCON 27. Hackea la polic√≠a. Parte 1</a></li>
<li><a href="../484454/index.html">Detective Habra: tu foto est√° perdida</a></li>
<li><a href="../484458/index.html">Este profesional independiente est√° roto, dame el siguiente</a></li>
<li><a href="../484462/index.html">Scraping Github: en busca de "secretos" para desarrollar</a></li>
<li><a href="../484464/index.html">Subastas de motocicletas japonesas, como sucede todo</a></li>
<li><a href="../484466/index.html">Las promesas comunes de JavaScript son importantes para todos</a></li>
<li><a href="../484468/index.html">La cultura corporativa roja es el principal problema de los negocios rusos (Parte 2)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>