<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚ÄçüöÄ üë©‚Äçüíº üèè Tarefas e solu√ß√µes para o lutador PostgreSQL üåÄ üë®‚Äçüë©‚Äçüëß üë®üèª‚Äçüè≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sauda√ß√µes a todos os amantes de SQL! 

 Na Internet, raramente vi artigos que cobrissem diferentes pontos de trabalho e sutilezas associados ao proces...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tarefas e solu√ß√µes para o lutador PostgreSQL</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423097/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/x3/ee/eo/x3eeeo65jv-nyf7mh9ks2dordqg.jpeg"></div><br>  Sauda√ß√µes a todos os amantes de SQL! <br><br>  Na Internet, raramente vi artigos que cobrissem diferentes pontos de trabalho e sutilezas associados ao <b>processamento de dados no SQL</b> . <br>  Gosto quando voc√™ pode aprender muitas coisas de um artigo de uma s√≥ vez, mesmo em termos gerais. <br>  Por isso, decidi escrever meu artigo contendo v√°rias tarefas e respostas com explica√ß√µes para eles. <br>  Adequado para quem domina bem todas as habilidades b√°sicas e deseja se desenvolver ainda mais. <br><br>  As respostas fornecidas s√£o adequadas para o <b>PostgreSQL</b> (a <u>maioria das tarefas ser√° adequada para outros DBMSs</u> , mas os resultados e solu√ß√µes podem ser diferentes. √â at√© interessante onde as diferen√ßas surgem) <br><br>  <i><u>Tente responder a si mesmo</u> antes de abrir o spoiler.</i> <i><br></i> <br>  Vamos l√°! <br><a name="habracut"></a><br><br>  Vou tentar marcar com um asterisco algo puramente para o PostgreSQL * (n√£o existem muitos momentos assim) <br><br><h4>  1. Um pouco sobre opera√ß√µes num√©ricas </h4><br>  <b>1.1</b> Essas solicita√ß√µes ser√£o atendidas?  Quais resultados eles retornar√£o? <br><br><pre><code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- )     SELECT 3/2; -- ) SELECT min('- '::TEXT), avg('- '::TEXT); -- )*      FALSE,     ? SELECT 7.2 = (3.8::FLOAT + 3.4) -- ) SELECT (20/25)*25.0;</span></span></code> </pre> <br><br><div class="spoiler">  <b class="spoiler_title">Respostas para 1.1</b> <div class="spoiler_text">  A) Resposta: <b>1</b> <br>  Somente a parte inteira ser√° mostrada, porque  a opera√ß√£o usa n√∫meros inteiros.  Isso geralmente √© encontrado em outros idiomas. <br><br>  B) Resposta: o pedido <b>n√£o ser√° executado</b> . <br><br>  <b>avg</b> dar√° um erro desde  aceita apenas n√∫meros e intervalos de tempo * <br><br>  No entanto, a fun√ß√£o <b>min / max</b> pode ser executada em dados de texto (de acordo com a classifica√ß√£o alfab√©tica no banco de dados). <br>  √Äs vezes, isso pode ser √∫til quando voc√™ precisa pelo menos olhar para uma coluna que n√£o est√° listada em <i>GROUP BY</i> <br>  Ou quando voc√™ precisar aplicar a classifica√ß√£o alfab√©tica aos n√∫meros, nos quais '10' &lt;'2' <br><br>  B) Resposta: <b>FALSO</b> <br><br>  Pode parecer estranho, mas isso √© <u>aceit√°vel</u> , porque  este √© um recurso de um computador que representa alguns n√∫meros de ponto flutuante; um n√∫mero pode assumir a forma 7.1 (9) <br>  Lembro-me de como lidei com um pedido por um longo tempo sem saber. <br><br>  D) Resposta: <b>0</b> .  o problema √© que a express√£o entre par√™nteses ser√° = 0 <br><br>  SELECT (20 / 25.0) * 25 funcionaria mais corretamente </div></div><br><br>  <b>1.2</b> Dada a tabela " <i>table_2</i> " (com uma √∫nica coluna " <i>value</i> " (INTEGER)) composta pelas 5 linhas a seguir: <br><table border="1" cellpadding="1"><tbody><tr><th width="120">  valor </th></tr><tr><td>  5 </td></tr><tr><td>  5 </td></tr><tr><td>  Nulo </td></tr><tr><td>  5 </td></tr><tr><td>  5 </td></tr></tbody></table><br>  Qual resultado retornar√° a consulta: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">avg</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)*<span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(*)) - <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> table_2;</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Op√ß√µes de resposta</b> <div class="spoiler_text"><ul><li>  -4 </li><li>  0 0 </li><li>  Nulo </li><li>  5 </li><li>  Isso causar√° um erro porque  n√£o especificado GROUP BY </li><li>  Nenhum dos listados </li></ul><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Resposta 1.2</b> <div class="spoiler_text">  resposta: <b>5</b> <br><br>  Fun√ß√µes agregadas aplicadas a uma coluna espec√≠fica ignoram <i>NULL</i> , no entanto count <b>(*)</b> contar√° todas as linhas <br>  5 * 5-20 </div></div><br><br><h4>  2. Quest√µes gerais </h4><br>  <b>2.1</b> Em que casos uma consulta pode retornar nem todo o conte√∫do de uma tabela?  ( <i>parent_id</i> INTEGER, a tabela √© preenchida com v√°rios dados) <br><br><pre> <code class="sql hljs"> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> any_table <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> parent_id = parent_id;</code> </pre><br>  Como o pedido abaixo se comportar√°?  Quais dados ser√£o gerados?  <i>* PostgreSQL</i> <br><br><pre> <code class="sql hljs"> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> any_table <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> parent_id <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> parent_id;</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Respostas para 2.1</b> <div class="spoiler_text">  A primeira consulta mostrar√° todas as entradas, exceto aquelas em que <i>parent_id</i> √© <b>NULL</b> <br><br>  A segunda consulta mostrar√° todas as entradas da tabela.  <u>IS DISTINCT FROM</u> √© logicamente semelhante ao operador <b>! =</b> Em que NULL √© id√™ntico a NULL <br>  <u><b>N√ÉO</b> √â DISTINTO DE</u> transforma logicamente desigualdade em igualdade <br></div></div><br>  <b>2.2</b>  Qual ser√° o resultado da solicita√ß√£o? <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- ) SELECT * FROM ( SELECT 1 UNION ALL SELECT 1 ) x(y) UNION ( SELECT 2 UNION ALL SELECT 2 );</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Responder para 2,2</b> <div class="spoiler_text">  O resultado ser√° 2 linhas com os valores <b>1</b> e <b>2</b> , <i>UNION</i> remover√° todas as duplicatas na sele√ß√£o <u>resultante</u> , e n√£o apenas entre as duas tabelas unidas.  Notei que isso n√£o √© √≥bvio para todos. </div></div><br>  <b>2.3</b> Escreva uma consulta que mostre a data de amanh√£. <br><br><div class="spoiler">  <b class="spoiler_title">Responda a 2.3</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>((<span class="hljs-keyword"><span class="hljs-keyword">now</span></span>()+ <span class="hljs-built_in"><span class="hljs-built_in">INTERVAL</span></span> <span class="hljs-string"><span class="hljs-string">'1 DAY'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span>)</code> </pre> <br>  Nem todo mundo costuma trabalhar com datas, mas vale a pena dominar um m√≠nimo <br>  * Solu√ß√£o Postgres, mas acho que outros DBMSs n√£o s√£o muito diferentes <br><br>  Se trabalhar com datas √© novo para voc√™, recomendo que experimente a solicita√ß√£o <br>  Por exemplo: <br>  - substitua DAY por (semana, m√™s, ano etc.) <br>  - substitua +1 por -9000 <br>  - substitua DATE por TIME <br>  - remover CAST <br>  - deixe apenas AGORA () <br>  etc. <br><br>  E, inspirado em alguns resultados, leia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MANUAL</a> , todos os t√≥picos descritos em detalhes <br><br></div></div><br>  <b>2.4</b> As <b>instru√ß√µes UPDATE</b> , <b>DELETE</b> , <b>INSERT</b> e <b>MERGE s√£o</b> projetadas para manipular dados em tabelas.  A execu√ß√£o do <b>SELECT .. √©</b> "segura"?  Qualquer consulta pode afetar os dados na tabela? <br><div class="spoiler">  <b class="spoiler_title">Responda a 2.4</b> <div class="spoiler_text">  A quest√£o pode parecer primitiva, no entanto ... <br><br>  No come√ßo do aprendizado de SQL, eu tinha a opini√£o de que essa declara√ß√£o s√≥ pode mostrar dados, mas: <br><br>  Al√©m do fato de que SELECT √© capaz de bloquear a tabela para altera√ß√£o (BEGIN; SELECT ... FOR UPDATE) * <br>  SELECT √© capaz de chamar fun√ß√µes que podem executar quase qualquer manipula√ß√£o. <br><br>  Os iniciantes precisam entender isso imediatamente, e n√£o depois de concluir a solicita√ß√£o "informativa pequena" no servidor de <s>Produ√ß√£o</s> </div></div><br><br><h4>  3. Somente PostgreSQL </h4><br>  <b>3.1</b> Descreva o que acontece quando esta consulta √© executada na caixa de di√°logo SQL: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> wtf <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_activity;</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Responder para 3,1</b> <div class="spoiler_text">  Normalmente, SELECT INTO √© usado nas fun√ß√µes <i>plpgsql</i> para gravar um valor em uma vari√°vel. <br><br>  Fora do plpgsql, o efeito do comando ser√° semelhante √† consulta abaixo: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> wtf <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_activity;</code> </pre> <br></div></div><br>  <b>3.2 o</b> que esse pedido "simples" mostrar√° <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> wtf_ <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_activity <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> wtf_ ;</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Responder para 3,2</b> <div class="spoiler_text">  Visualiza√ß√£o do sistema pg_stat_activity (VIEW) de processos ativos no banco de dados. <br><br>  A peculiaridade da consulta √© que uma coluna com linhas (ROW) com TYPE pg_stat_activity (ou outra tabela) ser√° exibida.  Voc√™ precisa saber isso mais cedo para quem escreve fun√ß√µes.Voc√™ pode ler mais no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">manual.</a> <br>  A pergunta foi adicionada porque um iniciante pode facilmente obter esse resultado por engano e n√£o entende qual √© o problema </div></div><br><h4>  4. Trabalhe com texto.  Express√µes regulares </h4><br>  Eu acho que voc√™ precisa n√£o apenas criar consultas, mas tamb√©m apresentar os resultados da maneira correta. <br>  Express√µes regulares s√£o um t√≥pico enorme separado, com muitos artigos de qualidade.  Portanto, mostrarei apenas exemplos, sem explica√ß√µes detalhadas. <br><br>  <b>4.1</b>  Suponha que exista uma tabela " <i>table_5</i> " com uma coluna de texto " <i>X</i> " e muitas linhas diferentes.  Qual consulta pode obter os √∫ltimos 10 caracteres de cada linha? <br><br><div class="spoiler">  <b class="spoiler_title">Responder para 4,1</b> <div class="spoiler_text">  O SQL permite que voc√™ encontre muitas solu√ß√µes para o mesmo problema, por exemplo: <br>  a coisa mais simples que vem √† mente √© <b>certa (X, 10)</b> <br>  regex pode ser usado: <b>substring (X, '. {0,10} $')</b> <br>  voc√™ pode at√© <s>nakostylyat</s> "esquivar" (em todos os sentidos) assim: <b>reverse (substring (reverse (X) for 10))</b> </div></div><br><br>  <b>4.2</b> Existe uma tabela "table_6" com uma coluna de texto "X".  A tabela cont√©m uma linha (todo o texto apenas em ingl√™s e russo): <br><pre> <code class="sql hljs">'Lorem 3 Ipsum 23 standard 7 dummy 17 text Ultimate Answer of Life ?? 777'</code> </pre> <br>  A) Escreva uma consulta que retorne os caracteres 42 a 68 dessa string <br>  B) Como extrair apenas letras mai√∫sculas (russo ou ingl√™s) em uma string usando SQL? <br>  C) Como calcular a soma dos n√∫meros ( <u>n√£o d√≠gitos</u> ) em uma string usando SQL <br><br><div class="spoiler">  <b class="spoiler_title">Esbo√ßo SQL</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> table_6(X) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'Lorem 3 Ipsum 23 standard 7 dummy 17 text Ultimate Answer of Life ?? 777'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> X <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> table_6</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Respostas para 4.2</b> <div class="spoiler_text"><pre> <code class="sql hljs"> <span class="hljs-comment"><span class="hljs-comment">--    WITH  "SQL " -- ) SELECT SUBSTRING(LEFT(X,68) FROM 42 ) FROM table_6 -- 1  SELECT SUBSTRING(X, 42, (68-42)+1) FROM table_6 -- 2  -- 3    -- )  ,        SELECT regexp_replace(X,'[^A-Z-]', '','g') FROM table_6 --  ''      - --   'g'    1  -- )        --   regexp_matches   **     ,      SELECT sum(x[1]::INT) FROM ( SELECT regexp_matches(X,'[0-9]+','g') FROM table_6 ) AS y(x) -- *        -- **   +,     (   1 ,     )</span></span></code> </pre> </div></div><br><br>  <b>4.3</b> Como substituir todos os espa√ßos duplos (triplos ou mais) por um √∫nico espa√ßo no texto (c√©lula da tabela)?  (por tradi√ß√£o: a tabela " <i>table_7</i> " com a coluna " <i>X</i> ") (PS, basta escrever <i>SELECT</i> retornando o resultado desejado, e n√£o <i>UPDATE table_7 ...</i> ) <br><br><div class="spoiler">  <b class="spoiler_title">Responder para 4,3</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> table_7(X) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'Lorem 3 Ipsum 23 standard 7 dummy 11 text'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span>) <span class="hljs-comment"><span class="hljs-comment">-- 1 .    (2   ) SELECT regexp_replace(X, '( ){2,}', ' ', 'g') FROM table_7 -- 2 .     (,  ,    ..)   ,      SELECT regexp_replace(X, '\s+', ' ', 'g') FROM table_7 --  !  ,  -    ,    "" .    .. --   ,    , ,        --    ,      ,    SELECT replace(replace(replace(X, ' ', '&lt;&gt;'), '&gt;&lt;', ''), '&lt;&gt;', ' ') FROM table_7</span></span></code> </pre><br></div></div><br>  <b>4.4</b> Existe uma string " <i>X</i> " na qual erros de digita√ß√£o s√£o permitidos.  Em vez de letras russas (e, o, s, C), eram usados ‚Äã‚Äãcaracteres externamente semelhantes do alfabeto ingl√™s.  Substitua esses caracteres pelo SQL. <br><br>  PS A linha deve conter apenas caracteres russos e voc√™ n√£o deve se preocupar com uma poss√≠vel altera√ß√£o nas palavras em ingl√™s. <br><br>  (Se estiver com dificuldades para substituir todos os caracteres, substitua pelo menos um) <br><br>  Linha de exemplo: <br><br> <code>X = 'Coeo  eoc oe'</code> <br> <br><div class="spoiler">  <b class="spoiler_title">Responder para 4,4</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- , Replace(Replace(Replace(..  ,  --        (1   1 ) SELECT TRANSLATE('Coeo  eoc oe', 'Cceo', '')</span></span></code> </pre> </div></div><br>  <b>4.5</b> Escreva uma consulta que converta uma string: <br>  <b>¬´</b> <b>Ivan Ivanov e Ivanovich¬ª</b> da esp√©cie <b>Ivan Ivanov</b> <br><br><div class="spoiler">  <b class="spoiler_title">Responder para 4,5</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--  ,     SELECT initcap('  ') *     </span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Busca de b√¥nus para quem lidou</b> <div class="spoiler_text">  <s>√ìtimo se houver uma fun√ß√£o pronta</s> <br>  Voc√™ pode converter o contr√°rio?  (de prefer√™ncia sem perder o preenchimento). <br>  Talvez a tarefa n√£o seja t√≠pica, mas ser√° √∫til para o desenvolvimento. <br><br>  <b>'IVANOV IVAN IVANOVICH'</b> converter em <b>'IVANOV IVAN IVANOVICH'</b> <br>  <s>e caso invertido?</s> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Resposta ao desafio de b√¥nus</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> string_agg(<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span>(x,<span class="hljs-number"><span class="hljs-number">1</span></span>)) || <span class="hljs-keyword"><span class="hljs-keyword">UPPER</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SUBSTRING</span></span>(x <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>)), <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> rn) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> regexp_split_to_table(<span class="hljs-string"><span class="hljs-string">'    4 TesT'</span></span>, <span class="hljs-string"><span class="hljs-string">'\y'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDINALITY</span></span> y(x, rn) ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> z <span class="hljs-comment"><span class="hljs-comment">-- *  PostgreSQL,      --    ,     --      ,      --      . -- WITH ORDINALITY      (   9.4) --      --          -- ..</span></span></code> </pre> </div></div><br><h4>  5. Um pouco sobre transa√ß√µes </h4><br>  As transa√ß√µes s√£o uma coisa muito importante em um SGBD; √© importante entender os pontos principais. <br><br>  Vou tentar simular um exemplo: <br><br>  Suponha que exista uma tabela de "mercadorias" com a qual dois usu√°rios ir√£o trabalhar. <br>  Possui uma coluna de <i>desconto</i> inteiro igual a <u>10</u> para todas as linhas. <br>  As configura√ß√µes do banco de dados s√£o padr√£o (READ COMMITTED - lendo dados confirmados). <br><br>  Usu√°rio <i>User_1</i> abre uma transa√ß√£o, executa a seguinte solicita√ß√£o: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> goods <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> discount = discount + <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> </pre><br>  Um segundo depois, outro usu√°rio ( <i>Usu√°rio_2</i> ) <br>  Ele executa quase a mesma solicita√ß√£o sem abrir uma transa√ß√£o: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> goods <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> discount = discount + <span class="hljs-number"><span class="hljs-number">10</span></span>;</code> </pre><br>  O que voc√™ acha que acontecer√° nas seguintes situa√ß√µes: <br><br>  <b>A)</b> Qual resultado o Usu√°rio_2 obter√° se o Usu√°rio_1 deixar a transa√ß√£o em aberto (ou seja, n√£o confirmar a transa√ß√£o / n√£o reverter as altera√ß√µes)? <br>  O que o usu√°rio_1 ver√° a pedido: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> discount <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> goods <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br>  <b>B)</b> O que acontece se o Usu√°rio_1 fizer ROLLBACK?  Quais resultados o User_2 obter√°? <br><br>  <b>Q)</b> O que acontece se o Usu√°rio_1 se comprometer?  Quais resultados o User_2 obter√°? <br><br><div class="spoiler">  <b class="spoiler_title">As respostas</b> <div class="spoiler_text">  At√© onde eu sei, READ <b>UN</b> COMMITTED n√£o √© suportado no PostgreSQL, e dados sujos (n√£o confirmados) n√£o podem ser lidos <br><br>  As respostas ser√£o as seguintes: <br><br>  A) A solicita√ß√£o do <u>usu√°rio_2</u> aguardar√° COMMIT ou ROLLBACK do usu√°rio_1.  (o pedido parece congelar) <br>  <u>O usu√°rio_1</u> em sua transa√ß√£o ver√° sua vers√£o do instant√¢neo do banco de dados, em que o <i>desconto</i> j√° <i>√©</i> igual a <b>15</b> <br><br>  B) Se o Usu√°rio_1 fizer ROLLBACK, o valor do <i>desconto</i> permanecer√° o mesmo e, em seguida, o Usu√°rio_2 ser√° executado, o que adicionar√° 10 ao <i>desconto</i> e o desconto ser√° <b>20.</b> <br><br>  C) Se o Usu√°rio_1 fizer COMMIT, o valor do <i>desconto</i> aumentar√° em 5 e, em seguida, o Usu√°rio_2 ser√° executado, o que adicionar√° 10 ao <i>desconto</i> e o desconto ser√° <b>25.</b> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Outra vers√£o desta tarefa</b> <div class="spoiler_text">  Uma vers√£o ligeiramente diferente da tarefa 13 do usu√°rio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">kirill_petrov</a> em READ COMMITTED <br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--      CREATE TABLE goods (discount) AS (SELECT 10::INT UNION ALL SELECT 15); -- 1. User_1   (  ): BEGIN; UPDATE goods SET discount = discount + 5; --2. User_2  : UPDATE goods SET discount = discount + 100 WHERE discount = 15 --3. User_1  COMMIT;</span></span></code> </pre>  Quais dados estar√£o na tabela? <br></div></div><br><h4>  Conclus√£o </h4><br>  Eu acho que isso tocou em pontos bastante interessantes. <br><br>  Espero que as tarefas ajudem a motivar os iniciantes, porque √© chato aprender algo sem metas / objetivos / orienta√ß√µes espec√≠ficas. <br><br>  Fico feliz por aqueles que foram f√°ceis de responder a todas as perguntas.  E aqueles que tiveram dificuldades, espero, deram um <s>chute na</s> dire√ß√£o do desenvolvimento.  Para quem n√£o entende muito, mas quer aprender SQL, convido o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">curso de lutador jovem</a> do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PostgreSQL</a> para o meu √∫ltimo artigo. <br><br>  Estou ansioso para quaisquer adi√ß√µes, solu√ß√µes para problemas especialmente interessantes (voc√™ pode os meus) e outros coment√°rios! <br><br>  Obrigado pela aten√ß√£o!  Desejo-lhe sucesso em aprender SQL! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt423097/">https://habr.com/ru/post/pt423097/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt423087/index.html">N√£o me empurre nos olhos</a></li>
<li><a href="../pt423089/index.html">Programadores na MBLT DEV 2018</a></li>
<li><a href="../pt423091/index.html">Flutter para desenvolvedores do Android. Como criar uma interface do usu√°rio para uma atividade usando o Flutter</a></li>
<li><a href="../pt423093/index.html">Aumentamos a aleatoriedade do fato de que [provavelmente] [quase] por acidente</a></li>
<li><a href="../pt423095/index.html">Novidades da apresenta√ß√£o da Apple</a></li>
<li><a href="../pt423101/index.html">Implantando o armazenamento LINSTOR para Proxmox</a></li>
<li><a href="../pt423103/index.html">Podcasts em Python: foi tudo o que descobrimos</a></li>
<li><a href="../pt423105/index.html">System.IO.Pipelines: E / S de alto desempenho no .NET</a></li>
<li><a href="../pt423107/index.html">Convidamos voc√™ para a reuni√£o Go in Production</a></li>
<li><a href="../pt423109/index.html">O que a Apple apresentou e o que os desenvolvedores do iOS pensam sobre isso</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>