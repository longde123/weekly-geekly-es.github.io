<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò£ üà∂ üë∂üèø Was Sie √ºber JavaScript Engine Switcher 3.0 wissen m√ºssen üïï üë©üèº‚Äç‚öïÔ∏è üå©Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Der JavaScript Engine Switcher wurde urspr√ºnglich als Hilfsbibliothek erstellt und seine Entwicklung wurde weitgehend von den Anforderungen der Biblio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Was Sie √ºber JavaScript Engine Switcher 3.0 wissen m√ºssen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439446/"><p><img src="https://habrastorage.org/webt/qo/zx/ss/qozxssedwxgcrteo4wnodfixdmy.png" alt="Logo f√ºr die dritte Version des JavaScript Engine Switcher"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Der JavaScript Engine Switcher</a> wurde urspr√ºnglich als Hilfsbibliothek erstellt und seine Entwicklung wurde weitgehend von den Anforderungen der Bibliotheken bestimmt, die ihn verwendeten.  Tats√§chlich l√∂ste jede ihrer Hauptversionen eine oder mehrere Hauptaufgaben, die f√ºr die weitere Entwicklung anderer Bibliotheken erforderlich sind: </p><br><ol><li> In der ersten Version bestand diese Aufgabe darin, so viele Adaptermodule wie m√∂glich f√ºr g√§ngige JS-Engines hinzuzuf√ºgen, die die .NET-Plattform unterst√ºtzen.  Dies gab den Benutzern von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bundle Transformer eine</a> gewisse Flexibilit√§t: Auf den Computern des Entwicklers konnten sie das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MSIE-</a> Modul verwenden, das das Debuggen von JS-Code mit Visual Studio unterst√ºtzt, und auf Servern, auf denen keine moderne Version von Internet Explorer vorhanden war oder die √ºberhaupt nicht installiert waren, konnten sie diese verwenden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V8-</a> Modul.  Einige haben es sogar geschafft, den Bundle Transformer in Mono unter Linux und Mac mit den Modulen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jurassic</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jint</a> auszuf√ºhren. </li><li>  Die Hauptaufgabe der zweiten Version war die Implementierung der .NET Core-Unterst√ºtzung, die f√ºr die neue Version der <a href="">ReactJS.NET-</a> Bibliothek erforderlich war.  Eine weitere wichtige Aufgabe war die Erstellung eines plattform√ºbergreifenden Moduls, mit dem gro√üe Mengen an JS-Code schnell verarbeitet werden k√∂nnen (Jurassic- und Jint-Module waren daf√ºr nicht geeignet). Nach einer Reihe von Verbesserungen wurde das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ChakraCore-</a> Modul zu einem solchen Modul. </li><li>  In der dritten Version lag der Schwerpunkt auf der Verbesserung der Integration in die ReactJS.NET-Bibliothek und der Verbesserung der Produktivit√§t. </li></ol><br><p> In diesem Artikel werden einige Neuerungen der dritten Version betrachtet, die sich f√ºr viele selbst nach dem Lesen des <a href="">Release-Textes</a> und des Dokumentationsabschnitts <a href="">‚ÄûSo aktualisieren Sie Anwendungen auf Version 3.X‚Äú</a> als nicht <code>JsEngineSwitcher</code> <a href="">erwiesen haben</a> : √Ñnderungen in der <code>JsEngineSwitcher</code> Klasse, Neuorganisation von Ausnahmen, informativere Fehlermeldungen, Unterbrechung und vorl√§ufige Zusammenstellung von Skripten, die M√∂glichkeit, die maximale Stapelgr√∂√üe in ChakraCore- und MSIE-Modulen zu √§ndern, sowie ein neues Modul basierend auf NiL.JS. </p><a name="habracut"></a><br><h2>  √Ñnderungen an der JsEngineSwitcher-Klasse </h2><br><p>  In der neuen Version implementiert die <code>JsEngineSwitcher</code> Klasse die <code>IJsEngineSwitcher</code> Schnittstelle und ist kein Singleton mehr (Sie k√∂nnen sie mit dem <code>new</code> Operator instanziieren).  Verwenden Sie die <code>Current</code> Eigenschaft, um anstelle der <code>Instance</code> Eigenschaft eine globale Instanz <code>Current</code> .  Die <code>Current</code> Eigenschaft hat im Gegensatz zur veralteten <code>Instance</code> Eigenschaft den R√ºckgabetyp <code>IJsEngineSwitcher</code> .  Au√üerdem verf√ºgt die <code>Current</code> Eigenschaft √ºber einen Setter, mit dem Sie die Standardimplementierung durch Ihre eigene ersetzen k√∂nnen: </p><br><pre> <code class="cs hljs">JsEngineSwitcher.Current = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyJsEngineSwitcher();</code> </pre> <br><p>  In ASP.NET Core-Webanwendungen, in denen das Paket <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">JavaScriptEngineSwitcher.Extensions.MsDependencyInjection</a> installiert ist, wird die Implementierung mithilfe der Erweiterungsmethode <code>AddJsEngineSwitcher</code> : </p><br><pre> <code class="cs hljs">‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> JavaScriptEngineSwitcher.Extensions.MsDependencyInjection; ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Startup</span></span> { ‚Ä¶ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConfigureServices</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IServiceCollection services</span></span></span><span class="hljs-function">)</span></span> { ‚Ä¶ services.AddJsEngineSwitcher(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyJsEngineSwitcher(), options =&gt; ‚Ä¶ ) ‚Ä¶ ; ‚Ä¶ } ‚Ä¶ } ‚Ä¶</code> </pre> <br><p>  Diese √Ñnderungen "brechen" fast immer Anwendungen oder Bibliotheken, die die vorherige Version des JavaScript Engine Switcher verwenden.  Daher m√ºssen Sie die folgenden √Ñnderungen an Ihrem Code vornehmen: </p><br><ol><li>  √Ñndern Sie den Typ der Variablen, Parameter oder Eigenschaften von <code>JsEngineSwitcher</code> in <code>IJsEngineSwitcher</code> . </li><li>  Verwenden Sie anstelle der <code>Instance</code> Eigenschaft √ºberall die <code>Current</code> Eigenschaft. </li></ol><br><p>  Es ist auch erw√§hnenswert, dass diese √Ñnderungen f√ºr die meisten Entwickler nicht von besonderem Nutzen sind, da ihr Hauptziel darin bestand, Komponententests zu vereinfachen (beispielsweise wurden zuvor in den Komponententests der ReactJS.NET-Bibliothek Sperren <a href="">verwendet</a> , jetzt k√∂nnen Sie <a href="">jedoch auf sie verzichten</a> ). </p><br><h2>  Neuordnung von Ausnahmen </h2><br><p>  Vor der dritten Version wurden die meisten JS-Engine-Fehler zu <code>JsRuntimeException</code> , und nur Fehler, die w√§hrend des Engine-Initialisierungsprozesses auftraten, wurden zu <code>JsEngineLoadException</code> .  Es gab auch eine Basisklasse <code>JsException</code> , von der zwei der oben genannten Arten von Ausnahmen geerbt wurden, wodurch es m√∂glich wurde, absolut alle Fehler abzufangen, die w√§hrend des Betriebs von JS-Engines auftraten.  Trotz der offensichtlichen Nachteile passt diese Organisation von Ausnahmen gut zum Konzept einer einheitlichen Schnittstelle f√ºr den Zugriff auf die grundlegenden Funktionen von JS-Engines. </p><br><p>  Mit der Implementierung der Unterbrechung und Vorkompilierung von Skripten (ich werde sie in den folgenden Abschnitten er√∂rtern) entstand jedoch die Notwendigkeit eines neuen Ansatzes zur Organisation von Ausnahmen.  Als erstes musste eine neue Art von Ausnahme <code>JsInterruptedException</code> - <code>JsInterruptedException</code> , die erforderlich war, um den Benutzer √ºber die Unterbrechung der Skriptausf√ºhrung zu benachrichtigen.  Dann war es notwendig, alle Fehler, die w√§hrend der Skriptverarbeitung auftraten, explizit in zwei Gruppen zu unterteilen: Kompilierungsfehler (Parsing) und Laufzeitfehler.  Es war auch erforderlich, alle Arten spezifischer Fehler von Chakra und V8 zu trennen, die nicht mit der Verarbeitung von Skripten zusammenh√§ngen.  Es war auch erforderlich, das Vorhandensein einer Ausnahme in der Jint-Engine zu ber√ºcksichtigen, die auftritt, wenn die Zeit√ºberschreitung f√ºr die Ausf√ºhrung eines Skripts (Timeout) abgelaufen ist.  Als Ergebnis wurde ein neuer Ansatz f√ºr die Organisation von Ausnahmen entwickelt, der als folgende hierarchische Struktur dargestellt werden kann: </p><br><ul><li> <code>JsException</code> <br> <ul><li> <code>JsEngineException</code> <br> <ul><li> <code>JsEngineLoadException</code> </li> </ul></li><li> <code>JsFatalException</code> </li> <li> <code>JsScriptException</code> <br> <ul><li> <code>JsCompilationException</code> </li> <li> <code>JsRuntimeException</code> <br> <ul><li> <code>JsInterruptedException</code> </li> <li> <code>JsTimeoutException</code> </li> </ul></li></ul></li><li> <code>JsUsageException</code> </li> </ul></li><li>  <code>JsEngineNotFoundException</code> <sup>*</sup> </li></ul><br><p>  * - Diese Ausnahme tritt nicht auf der Ebene der JS-Engine auf, sondern auf der Ebene des JavaScript Engine Switcher. </p><br><p>  Ich denke, dass die oben dargestellte Hierarchie der Ausnahmen keine Kommentare ben√∂tigt, da die Namen der Ausnahmen f√ºr sich selbst sprechen.  Mit diesem Ansatz erhalten wir nicht nur mehr Informationen √ºber die Fehlerursachen, sondern k√∂nnen auch bestimmte Arten von Ausnahmen flexibler behandeln. </p><br><h2>  Einheitliches Fehlermeldungsformat </h2><br><p>  Ein weiteres Problem mit fr√ºheren Versionen des JavaScript Engine Switcher war die Schwierigkeit, Fehler zu finden, die bei der Verarbeitung von Skripten aufgetreten sind.  Anhand der <code>Message</code> Ausnahmeeigenschaft war es schwierig, genau zu verstehen, wo der Fehler aufgetreten ist. Daher musste ich andere Ausnahmeeigenschaften analysieren, was nicht immer praktisch war.  Dar√ºber hinaus reichte die Menge der vorhandenen Eigenschaften auch nicht aus. </p><br><p>  Daher wurden der <code>JsScriptException</code> Klasse zwei neue Eigenschaften hinzugef√ºgt: </p><br><ol><li>  <strong>Typ</strong> - Typ des JavaScript-Fehlers (z. B. <code>SyntaxError</code> oder <code>TypeError</code> ); </li><li>  <strong>DocumentName</strong> - Der Name des Dokuments (normalerweise aus den Werten der folgenden Parameter extrahiert: <code>documentName</code> der <code>Execute</code> und <code>Evaluate</code> Methoden, <code>path</code> der <code>ExecuteFile</code> Methode, <code>resourceName</code> der <code>ExecuteResource</code> Methode usw.); </li></ol><br><p>  Eine neue Eigenschaft wurde auch zur <code>JsRuntimeException</code> Klasse hinzugef√ºgt - <strong>CallStack</strong> , die eine Zeichenfolgendarstellung des Aufrufstapels enth√§lt. </p><br><p>  Bisher wurde ein Wert aus einer √§hnlichen Eigenschaft der urspr√ºnglichen .NET-Ausnahme oder eine Zeichenfolgendarstellung eines JavaScript-Fehlers einfach in die <code>Message</code> Eigenschaft kopiert.  H√§ufig unterschieden sich Fehlermeldungen in verschiedenen JS-Engines nicht nur im Format, sondern auch in der Menge der darin enthaltenen n√ºtzlichen Informationen.  Aufgrund des Mangels an Informationen zu Zeilen- und Spaltennummern in einigen Fehlermeldungen mussten die Entwickler der ReactJS.NET-Bibliothek beispielsweise die vom JavaScript Engine Switcher empfangenen <a href="">Ausnahmen erneut</a> ausl√∂sen. </p><br><p>  Aus diesem Grund habe ich beschlossen, meine eigenen Fehlermeldungen auf der Ebene des Adaptermoduls zu generieren, die ein einziges (einheitliches) Format haben w√ºrden.  Dieses Format verwendet alle verf√ºgbaren Fehlerinformationen: Typ, Beschreibung, Dokumentname, Zeilennummer, Spaltennummer, Codefragment und Aufrufstapel.  Als Grundlage f√ºr das neue Format habe ich das Fehlerformat aus der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Microsoft ClearScript-</a> Bibliothek √ºbernommen. </p><br><p>  Nachfolgend finden Sie die Meldungen zu demselben Kompilierungsfehler, die von verschiedenen Adaptermodulen generiert wurden: </p><br><pre> <code class="plaintext hljs">ChakraCore ========== SyntaxError: Unexpected identifier after numeric literal at declinationOfSeconds.js:12:23 -&gt; caseIndex = number % 1O &lt; 5 ? number % 10 : 5; Jint ==== SyntaxError: Unexpected token ILLEGAL at declinationOfSeconds.js:12:25 Jurassic ======== SyntaxError: Expected operator but found 'O' at declinationOfSeconds.js:12 MSIE   Classic ===================== SyntaxError: Expected ';' at declinationOfSeconds.js:12:25 -&gt; caseIndex = number % 1O &lt; 5 ? number % 10 : 5; MSIE   Chakra ActiveScript ================================= SyntaxError: Expected ';' at declinationOfSeconds.js:12:25 -&gt; caseIndex = number % 1O &lt; 5 ? number % 10 : 5; MSIE   Chakra IE JsRT ============================ SyntaxError: Expected ';' at 12:25 -&gt; caseIndex = number % 1O &lt; 5 ? number % 10 : 5; MSIE   Chakra Edge JsRT ============================== SyntaxError: Unexpected identifier after numeric literal at declinationOfSeconds.js:12:23 -&gt; caseIndex = number % 1O &lt; 5 ? number % 10 : 5; NiL === SyntaxError: Unexpected token 'O' at 12:25 V8 == SyntaxError: Invalid or unexpected token at declinationOfSeconds.js:12:24 -&gt; caseIndex = number % 1O &lt; 5 ? number % 10 : 5; Vroom ===== SyntaxError: Unexpected token ILLEGAL at declinationOfSeconds.js:12:24</code> </pre> <br><p>  Ein √§hnliches Beispiel f√ºr einen Laufzeitfehler: </p><br><pre> <code class="plaintext hljs">ChakraCore ========== TypeError: Unable to get property '' of undefined or null reference at transliterate (russian-translit.js:929:4) -&gt; newCharValue = typeof charMapping[charValue] !== 'undefined' ? at Global code (Script Document:1:1) Jint ==== TypeError: charMapping is undefined at russian-translit.js:929:26 Jurassic ======== TypeError: undefined cannot be converted to an object at transliterate (russian-translit.js:929) at Global code (Script Document:1) MSIE   Classic ===================== TypeError: 'undefined' is null or not an object at russian-translit.js:929:4 MSIE   Chakra ActiveScript ================================= TypeError: Unable to get property '' of undefined or null reference at russian-translit.js:929:4 MSIE   Chakra IE JsRT ============================ TypeError: Unable to get property '' of undefined or null reference at transliterate (russian-translit.js:929:4) at Global code (Script Document:1:1) MSIE   Chakra Edge JsRT ============================== TypeError: Unable to get property '' of undefined or null reference at transliterate (russian-translit.js:929:4) at Global code (Script Document:1:1) NiL === TypeError: Can't get property "" of "undefined" V8 == TypeError: Cannot read property '' of undefined at transliterate (russian-translit.js:929:37) -&gt; newCharValue = typeof charMapping[charValue] !== 'undefined' ? at Script Document:1:1 Vroom ===== TypeError: Cannot read property '' of undefined at russian-translit.js:929:37</code> </pre> <br><p>  Wie Sie den Beispielen entnehmen k√∂nnen, geben uns einige JS-Engines v√∂llig andere Fehlerbeschreibungen und Spaltennummern, und wir k√∂nnen nicht immer einen vollst√§ndigen Satz von Fehlerdaten erhalten. Trotz dieser M√§ngel liefert uns das einheitliche Format mehr Informationen √ºber den Fehlerort als urspr√ºngliche Fehlermeldungen. </p><br><h2>  Tipps zur Bereitstellung nativer Assemblys </h2><br><p>  Die Hauptursache f√ºr Fehler bei der Arbeit mit der zweiten Version des JavaScript Engine Switcher war, dass viele Entwickler vergessen haben, NuGet-Pakete mit nativen Assemblys f√ºr ChakraCore- und V8-Module zu installieren.  Zu einer Zeit war auch ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Beitrag im ReactJS.NET-Bugtracker</a> diesem Problem gewidmet ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">russische √úbersetzung</a> ist ebenfalls verf√ºgbar).  Ein solcher Fehler tritt heute haupts√§chlich bei Anf√§ngern auf, die aus irgendeinem Grund die Dokumentation nicht gelesen haben. </p><br><p>  Die Autoren von ReactJS.NET haben versucht, die Anzahl solcher Fehler mithilfe der Hinweise in den Fehlermeldungen zu minimieren, aber die <a href="">nicht sehr erfolgreiche Implementierung</a> dieses Ansatzes f√ºhrte zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">noch mehr Verwirrung</a> .  Die Idee der Hinweise war gut, erforderte jedoch eine grundlegend andere Implementierung, n√§mlich die Implementierung auf der Ebene der Adaptermodule von JS-Engines.  In der neuen Version des JavaScript Engine Switcher werden solche Hinweise zur Fehlermeldung hinzugef√ºgt, wenn <code>DllNotFoundException</code> und <code>TypeLoadException</code> Ausnahmen <code>JsEngineLoadException</code> (siehe Implementierungsbeispiele f√ºr <a href="">ChakraCore-</a> , <a href="">V8-</a> und <a href="">Vroom-</a> Module).  Dar√ºber hinaus sind diese Tipps intelligent, weil  Ihre Generierung ber√ºcksichtigt eine Reihe von Faktoren: Betriebssystemtyp, Prozessorarchitektur und Laufzeit (.NET Framework, .NET Core oder Mono). </p><br><p>  Wenn Sie beispielsweise das ChakraCore-Modul ohne native Assembly in einem 64-Bit-Prozess unter dem Windows-Betriebssystem verwenden, sieht die Fehlermeldung folgenderma√üen aus: </p><br><blockquote>  Instanz der ChakraCoreJsEngine konnte nicht erstellt werden.  H√∂chstwahrscheinlich ist es passiert, weil die Assembly 'ChakraCore.dll' oder eine ihrer Abh√§ngigkeiten nicht gefunden wurde.  Versuchen Sie, das Paket JavaScriptEngineSwitcher.ChakraCore.Native.win-x64 √ºber NuGet zu installieren.  Dar√ºber hinaus m√ºssen Sie noch Microsoft Visual C ++ Redistributable f√ºr Visual Studio 2017 installieren ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://www.visualstudio.com/downloads/#microsoft-visual-c-redistributable-for-visual-studio-2017</a> ). </blockquote><br><p>  Die Fehlermeldung gibt einen Hinweis darauf, dass Sie das JavaScript NuGet packageEngineSwitcher.ChakraCore.Native.win-x64 installieren m√ºssen, und erw√§hnt auch, dass ChakraCore f√ºr Windows die umverteilbare Microsoft Visual C ++ - Komponente f√ºr Visual Studio 2017 ben√∂tigt, um zu funktionieren. Wenn dieser Fehler auftritt Wenn es in einem 32-Bit-Prozess auftritt, wird der Benutzer aufgefordert, das Paket JavaScriptEngineSwitcher.ChakraCore.Native.win-x86 zu installieren. </p><br><p>  Eine √§hnliche Fehlermeldung unter Linux in .NET Core w√ºrde folgenderma√üen aussehen: </p><br><blockquote>  Instanz der ChakraCoreJsEngine konnte nicht erstellt werden.  H√∂chstwahrscheinlich ist es passiert, weil die Assembly 'libChakraCore.so' oder eine ihrer Abh√§ngigkeiten nicht gefunden wurde.  Versuchen Sie, das Paket JavaScriptEngineSwitcher.ChakraCore.Native.linux-x64 √ºber NuGet zu installieren. </blockquote><br><p>  In diesem Fall wird empfohlen, das Paket JavaScriptEngineSwitcher.ChakraCore.Native.linux-x64 zu installieren. </p><br><p>  Beim Start in Mono wird eine weitere Eingabeaufforderung angezeigt: </p><br><blockquote>  ... JavaScriptEngineSwitcher.ChakraCore.Native.linux- * -Pakete unterst√ºtzen die Installation unter Mono nicht. Sie k√∂nnen die native Assembly jedoch manuell installieren ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/Taritsyn/JavaScriptEngineSwitcher/wiki/ChakraCore#linux</a> ). </blockquote><br><p>  Da das Paket JavaScriptEngineSwitcher.ChakraCore.Native.linux-x64 nur mit .NET Core kompatibel ist, enth√§lt der Tooltip einen Link zu Anweisungen zum manuellen Bereitstellen der nativen Assembly unter Linux. </p><br><p>  Es k√∂nnen noch viele weitere Beispiele angef√ºhrt werden, aber dies macht keinen Sinn. </p><br><h2>  Skriptausf√ºhrung abbrechen </h2><br><p>  Wenn wir Benutzern die M√∂glichkeit geben, beliebigen JS-Code auf dem Server auszuf√ºhren, stehen wir vor einem sehr schwerwiegenden Problem: Wir wissen nicht, wie lange die Ausf√ºhrung dieses Codes dauern wird.  Dies kann eine gro√üe Menge nicht optimalen Codes oder Codes sein, der eine Endlosschleife ausf√ºhrt.  In jedem Fall ist es unkontrollierter Code, der die Ressourcen unseres Servers auf unbestimmte Zeit verbraucht.  Um diesen Prozess irgendwie zu steuern, m√ºssen wir die Ausf√ºhrung von Skripten unterbrechen k√∂nnen.  Wenn Sie in reinem .NET geschriebene Engines verwenden (z. B. Jint, Jurassic oder NiL.JS), k√∂nnen Sie JS-Code immer als Task mit der F√§higkeit zum Abbrechen ausf√ºhren. Dieser Ansatz funktioniert jedoch nicht f√ºr andere Engines.  Zum Gl√ºck verf√ºgen C ++ - Engines √ºber integrierte Mechanismen zum Unterbrechen von Skripten. </p><br><p>  Um den Zugriff auf diese Mechanismen zu erm√∂glichen, wurden der <code>IJsEngine</code> Schnittstelle die <code>SupportsScriptInterruption</code> Eigenschaft und die <code>Interrupt</code> Methode hinzugef√ºgt.  Da diese Funktion nicht von allen Engines unterst√ºtzt wird, sollten Sie vor dem Aufrufen der <code>Interrupt</code> Methode immer den Wert der <code>SupportsScriptInterruption</code> Eigenschaft √ºberpr√ºfen (wenn Sie in fr√ºheren Versionen des JavaScript Engine Switcher den Garbage Collector manuell ausf√ºhren mussten, werden Sie sofort verstehen, wovon ich spreche): </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (engine.SupportsScriptInterruption) { engine.Interrupt(); }</code> </pre> <br><p>  Und Sie m√ºssen diese Methode in einem separaten Thread aufrufen, der sich von dem Thread unterscheidet, in dem die Skripte ausgef√ºhrt werden.  Nach dem Aufrufen der <code>Interrupt</code> Methode enden alle zuvor ausgef√ºhrten <code>Evaluate</code> , <code>Execute*</code> und <code>CallFunction</code> mit einer <code>JsInterruptedException</code> . </p><br><p>  Da diese API auf niedriger Ebene ausgef√ºhrt wird, wird empfohlen, f√ºr die am Anfang des Abschnitts beschriebenen Aufgaben Erweiterungsmethoden wie die folgenden zu verwenden: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> !NET40 using System.Runtime.ExceptionServices; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> using System.Threading; using System.Threading.Tasks; using JavaScriptEngineSwitcher.Core; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> NET40 using JavaScriptEngineSwitcher.Core.Extensions; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> using JavaScriptEngineSwitcher.Core.Resources; ‚Ä¶ /// &lt;summary&gt; /// Extension methods for &lt;see cref="IJsEngine"/&gt; /// &lt;/summary&gt; public static class JsEngineExtensions { /// &lt;summary&gt; /// Evaluates an expression within a specified time interval /// &lt;/summary&gt; /// &lt;typeparam name="T"&gt;Type of result&lt;/typeparam&gt; /// &lt;param name="engine"&gt;JS engine&lt;/param&gt; /// &lt;param name="expression"&gt;JS expression&lt;/param&gt; /// &lt;param name="timeoutInterval"&gt;Interval to wait before the /// script execution times out&lt;/param&gt; /// &lt;param name="documentName"&gt;Document name&lt;/param&gt; /// &lt;returns&gt;Result of the expression&lt;/returns&gt; /// &lt;exception cref="ObjectDisposedException"/&gt; /// &lt;exception cref="ArgumentNullException"/&gt; /// &lt;exception cref="ArgumentException"/&gt; /// &lt;exception cref="JsCompilationException"/&gt; /// &lt;exception cref="JsTimeoutException"/&gt; /// &lt;exception cref="JsRuntimeException"/&gt; /// &lt;exception cref="JsException"/&gt; public static T Evaluate&lt;T&gt;(this IJsEngine engine, string expression, TimeSpan timeoutInterval, string documentName) { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (engine == null) { throw new ArgumentNullException(nameof(engine)); } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (engine.SupportsScriptInterruption) { using (var timer = new Timer(state =&gt; engine.Interrupt(), null, timeoutInterval, #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> NET40 new TimeSpan(0, 0, 0, 0, -1))) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> Timeout.InfiniteTimeSpan)) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> { try { return engine.Evaluate&lt;T&gt;(expression, documentName); } catch (JsInterruptedException e) { throw new JsTimeoutException( Strings.Runtime_ScriptTimeoutExceeded, e.EngineName, e.EngineVersion, e ); } } } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> NET40 Task&lt;T&gt; task = Task.Factory.StartNew(() =&gt; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> Task&lt;T&gt; task = Task.Run(() =&gt; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> { return engine.Evaluate&lt;T&gt;(expression, documentName); }); bool isCompletedSuccessfully = false; try { isCompletedSuccessfully = task.Wait(timeoutInterval); } catch (AggregateException e) { Exception innerException = e.InnerException; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (innerException != null) { #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> NET40 innerException.PreserveStackTrace(); throw innerException; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> ExceptionDispatchInfo.Capture(innerException).Throw(); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { throw; } } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (isCompletedSuccessfully) { return task.Result; } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { throw new JsTimeoutException( Strings.Runtime_ScriptTimeoutExceeded, engine.Name, engine.Version ); } } } ‚Ä¶ } ‚Ä¶</span></span></code> </pre> <br><p>  Diese Methode ist ein Add-On zur Engine-Methode <code>Evaluate&lt;T&gt;</code> , mit der mithilfe des Parameters <code>timeoutInterval</code> das Zeitlimit f√ºr das Warten auf die Ausf√ºhrung des Skripts festgelegt werden kann.  Das Funktionsprinzip dieser Erweiterungsmethode ist sehr einfach.  Zun√§chst pr√ºfen wir, ob unser Motor den eingebauten Interrupt-Mechanismus unterst√ºtzt.  In diesem <code>timeoutInterval</code> erstellen wir eine Instanz der <code>Timer</code> Klasse, die nach dem im Parameter <code>timeoutInterval</code> angegebenen <code>timeoutInterval</code> die <code>Interrupt</code> Methode startet. Anschlie√üend rufen wir die Engine-Methode <code>Evaluate&lt;T&gt;</code> Fehlerfall wird die <code>JsInterruptedException</code> und in eine <code>JsTimeoutException</code> .  Wenn die Engine keine Interrupts unterst√ºtzt, erstellen Sie eine Instanz der <code>Task</code> Klasse, in der die <code>Evaluate&lt;T&gt;</code> -Methode der Engine ausgef√ºhrt wird, und <code>timeoutInterval</code> das <code>timeoutInterval</code> die <code>timeoutInterval</code> Task auf den Wert des Parameters <code>timeoutInterval</code> Wenn die Task durch <code>JsTimeoutException</code> abgeschlossen wird, <code>JsTimeoutException</code> Typ <code>JsTimeoutException</code> .  Das Folgende ist ein Beispiel f√ºr die Verwendung dieser Erweiterungsmethode: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> JavaScriptEngineSwitcher.Core; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> JavaScriptEngineSwitcher.Core.Helpers; ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { ‚Ä¶ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> expression = <span class="hljs-string"><span class="hljs-string">@"function getRandomInt(minValue, maxValue) { minValue = Math.ceil(minValue); maxValue = Math.floor(maxValue); return Math.floor(Math.random() * (maxValue - minValue + 1)) + minValue; } function sleep(millisecondsTimeout) { var totalMilliseconds = new Date().getTime() + millisecondsTimeout; while (new Date().getTime() &lt; totalMilliseconds) { } } var randomNumber = getRandomInt(1, 10); sleep(randomNumber * 1000); randomNumber;"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (IJsEngine engine = JsEngineSwitcher.Current.CreateDefaultEngine()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = engine.Evaluate&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(expression, TimeSpan.FromSeconds(<span class="hljs-number"><span class="hljs-number">3</span></span>), <span class="hljs-string"><span class="hljs-string">"randomNumber.js"</span></span>); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">" = {0}"</span></span>, result); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (JsTimeoutException) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"    JavaScript "</span></span> + <span class="hljs-string"><span class="hljs-string">"   !"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (JsException e) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"   JavaScript-  "</span></span> + <span class="hljs-string"><span class="hljs-string">"!"</span></span>); Console.WriteLine(); Console.WriteLine(JsErrorHelpers.GenerateErrorDetails(e)); } } } ‚Ä¶ } ‚Ä¶</code> </pre> <br><p>  Mit der Erweiterungsmethode berechnen wir das Ergebnis des JS-Ausdrucks.  Das Ergebnis des Ausdrucks ist eine zuf√§llige Ganzzahl, und diese Zahl ist auch die Anzahl der Sekunden, um die dieser Ausdruck verz√∂gert wird.  Au√üerdem geben wir beim Aufrufen der Erweiterungsmethode ein Warteintervall von 3 Sekunden an.  Da die Zeit f√ºr die Berechnung des Ausdrucks zwischen 1 und 10 Sekunden variiert, wird in einem Fall das Ergebnis des Ausdrucks auf der Konsole angezeigt und in einem anderen Fall eine Meldung √ºber das Zeitlimit. </p><br><p>  Es sollte f√ºr Sie nicht schwierig sein, diese Erweiterungsmethode zu wiederholen, um andere Methoden der Engine aufzurufen (z. B. <code>Execute*</code> , <code>CallFunction</code> oder andere √ºberladene Versionen der <code>Evaluate</code> Methode).  Bisher habe ich nicht entschieden, ob ich der Bibliothek selbst solche Erweiterungsmethoden hinzuf√ºgen werde, da noch nicht klar ist, wie stark sie nachgefragt werden. </p><br><h2>  Skript-Vorkompilierung </h2><br><p>  Ich wurde <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">gebeten,</a> Unterst√ºtzung f√ºr die vorl√§ufige Kompilierung von Skripten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">im Jahr 2015</a> hinzuzuf√ºgen.  Zu diesem Zeitpunkt war nicht klar, wie eine solche Funktion in das Konzept einer einheitlichen Schnittstelle passen k√∂nnte.  Mit der Zeit wurde jedoch allm√§hlich Unterst√ºtzung f√ºr Eingabehilfen wie Speicherbereinigung und Skriptunterbrechung im JavaScript Engine Switcher angezeigt.  In den letzten Phasen der Arbeit an der dritten Version kam es zur vorl√§ufigen Zusammenstellung. </p><br><p>  Mithilfe der Vorkompilierung k√∂nnen Sie ein Skript einmal kompilieren und dann mehrmals zum Initialisieren von JS-Engines verwenden.  Aufgrund der Tatsache, dass f√ºr das vorkompilierte Skript keine Analyse erforderlich ist, erfolgt die Initialisierung der Engines schneller. </p><br><p>  Derzeit wird die Vorkompilierung von 5 Adaptermodulen unterst√ºtzt: ChakraCore, Jint, Jurassic, MSIE (nur im JsRT-Modus) und V8.  Um den Zugriff auf die entsprechenden Engine-Mechanismen zu erm√∂glichen, wurden der <code>IJsEngine</code> Schnittstelle die Eigenschaft <code>SupportsScriptPrecompilation</code> und drei neue Methoden hinzugef√ºgt: <code>Precompile</code> , <code>PrecompileFile</code> und <code>PrecompileResource</code> .  <code>Precompile*</code> -Methoden geben eine Instanz eines Objekts zur√ºck, das die <code>IPrecompiledScript</code> Schnittstelle implementiert.  Dieses Objekt ist ein vorkompiliertes Skript, das von verschiedenen Instanzen der Engines verwendet werden kann (eine √ºberladene Version der <code>Execute</code> Methode dient zu diesem Zweck).  Betrachten Sie ein einfaches Beispiel f√ºr die Verwendung dieser API: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> JavaScriptEngineSwitcher.Core; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> JavaScriptEngineSwitcher.Core.Helpers; ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { ‚Ä¶ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> sourceCode = <span class="hljs-string"><span class="hljs-string">@"function declinationOfSeconds(number) { var result, titles = ['', '', ''], titleIndex, cases = [2, 0, 1, 1, 1, 2], caseIndex ; if (number % 100 &gt; 4 &amp;&amp; number % 100 &lt; 20) { titleIndex = 2; } else { caseIndex = number % 10 &lt; 5 ? number % 10 : 5; titleIndex = cases[caseIndex]; } result = number + ' ' + titles[titleIndex]; return result; }"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> functionName = <span class="hljs-string"><span class="hljs-string">"declinationOfSeconds"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> itemCount = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] inputSeconds = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[itemCount] { <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>, <span class="hljs-number"><span class="hljs-number">600</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] outputStrings = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[itemCount]; IJsEngineSwitcher engineSwitcher = JsEngineSwitcher.Current; IPrecompiledScript precompiledCode = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> engine = engineSwitcher.CreateDefaultEngine()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!engine.SupportsScriptPrecompilation) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"{0}  {1}   "</span></span> + <span class="hljs-string"><span class="hljs-string">"  !"</span></span>, engine.Name, engine.Version); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { precompiledCode = engine.Precompile(sourceCode, <span class="hljs-string"><span class="hljs-string">"declinationOfSeconds.js"</span></span>); engine.Execute(precompiledCode); outputStrings[<span class="hljs-number"><span class="hljs-number">0</span></span>] = engine.CallFunction&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(functionName, inputSeconds[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (JsCompilationException e) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"     "</span></span> + <span class="hljs-string"><span class="hljs-string">" !"</span></span>); Console.WriteLine(); Console.WriteLine(JsErrorHelpers.GenerateErrorDetails(e)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (JsException e) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"   JavaScript-  "</span></span> + <span class="hljs-string"><span class="hljs-string">"!"</span></span>); Console.WriteLine(); Console.WriteLine(JsErrorHelpers.GenerateErrorDetails(e)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> itemIndex = <span class="hljs-number"><span class="hljs-number">1</span></span>; itemIndex &lt; itemCount; itemIndex++) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> engine = engineSwitcher.CreateDefaultEngine()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { engine.Execute(precompiledCode); outputStrings[itemIndex] = engine.CallFunction&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;( functionName, inputSeconds[itemIndex]); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (JsException e) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"   JavaScript- "</span></span> + <span class="hljs-string"><span class="hljs-string">" !"</span></span>); Console.WriteLine(); Console.WriteLine(JsErrorHelpers.GenerateErrorDetails(e)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> itemIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; itemIndex &lt; itemCount; itemIndex++) { Console.WriteLine(outputStrings[itemIndex]); } } ‚Ä¶ } ‚Ä¶</code> </pre> <br><p>    ,         .     <code>SupportsScriptPrecompilation</code>  ,       ,  ,     .     <code>Precompile</code>  ,      ,      <code>JsCompilationException</code> . C   <code>Execute</code>      , ..   .     <code>CallFunction</code>   <code>declinationOfSeconds</code>      .     .   ,    ,           .     3        .  ,        ,        .         ,    ,      . </p><br><p>      ,     ,    .   ,  ,           .       ReactJS.NET.        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">JSPool</a> ,         ( <code>System.Runtime.Caching.MemoryCache</code>  .NET Framework 4.X, <code>System.Web.Caching.Cache</code>  ASP.NET 4.X  <code>Microsoft.Extensions.Caching.Memory.IMemoryCache</code>  ASP.NET Core).      ,        (       <a href=""> </a> ).    ,       ReactJS.NET. </p><br><p>      ReactJS.NET .              .        <code>AllowJavaScriptPrecompilation</code>   <code>true</code> . </p><br><p>  ASP.NET 4.X       <code>App_Start/ReactConfig.cs</code> : </p><br><pre> <code class="cs hljs">‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ReactConfig</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Configure</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ReactSiteConfiguration.Configuration ‚Ä¶ .SetAllowJavaScriptPrecompilation(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) ‚Ä¶ ; ‚Ä¶ } } ‚Ä¶</code> </pre> <br><p>  ASP.NET Core      <code>Startup.cs</code> : </p><br><pre> <code class="cs hljs">‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Startup</span></span> { ‚Ä¶ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Configure</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IApplicationBuilder app, IHostingEnvironment env</span></span></span><span class="hljs-function">)</span></span> { ‚Ä¶ app.UseReact(config =&gt; { config ‚Ä¶ .SetAllowJavaScriptPrecompilation(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) ‚Ä¶ ; }); app.UseStaticFiles(); ‚Ä¶ } } ‚Ä¶</code> </pre> <br><p>       ,      .       <a href="">JsExecutionBenchmark</a> ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">BenchmarkDotNet</a> .        JS-     .    14,9 ,     ,       .          JavaScript Engine Switcher ( 3.0.4). </p><br><p>   ,      .NET Framework 4.7.2: </p><br><table><thead><tr><th align="left"> <sup> </sup> </th><th align="left"> <sup>. </sup> </th><th align="left"> <sup> . </sup> </th><th align="left"> <sup>Gen 0  . .</sup> </th><th align="left"> <sup>Gen 1  . .</sup> </th><th align="left"> <sup>Gen 2  . .</sup> </th><th align="left"> <sup>    .</sup> </th></tr></thead><tbody><tr><td rowspan="2"> <sup>ChakraCore</sup> </td><td>  <sup>Nein</sup> </td><td align="right"> <sup>41,72 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>74,46 </sup> </td></tr><tr><td>  <sup>Ja</sup> </td><td align="right"> <sup>35,07 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>91,79 </sup> </td></tr><tr><td rowspan="2"> <sup>Jint</sup> </td><td>  <sup>Nein</sup> </td><td align="right"> <sup>27,19 </sup> </td><td align="right"> <sup>2 812,50</sup> </td><td align="right"> <sup>1 343,75</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>16 374,58 </sup> </td></tr><tr><td>  <sup>Ja</sup> </td><td align="right"> <sup>15,54 </sup> </td><td align="right"> <sup>1 296,88</sup> </td><td align="right"> <sup>640,63</sup> </td><td align="right"> <sup>31,25</sup> </td><td align="right"> <sup>7 521,49 </sup> </td></tr><tr><td rowspan="2"> <sup>Jurassic</sup> </td><td>  <sup>Nein</sup> </td><td align="right"> <sup>455,70 </sup> </td><td align="right"> <sup>2 000,00</sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>15 575,28 </sup> </td></tr><tr><td>  <sup>Ja</sup> </td><td align="right"> <sup>78,70 </sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>7 892,94 </sup> </td></tr><tr><td rowspan="2"> <sup>MSIE   Chakra IE JsRT</sup> </td><td>  <sup>Nein</sup> </td><td align="right"> <sup>30,97 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>77,75 </sup> </td></tr><tr><td>  <sup>Ja</sup> </td><td align="right"> <sup>24,40 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>90,58 </sup> </td></tr><tr><td rowspan="2"> <sup>MSIE   Chakra Edge JsRT</sup> </td><td>  <sup>Nein</sup> </td><td align="right"> <sup>33,14 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>78,40 </sup> </td></tr><tr><td>  <sup>Ja</sup> </td><td align="right"> <sup>32,86 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>95,48 </sup> </td></tr><tr><td rowspan="2"> <sup>V8</sup> </td><td>  <sup>Nein</sup> </td><td align="right"> <sup>41,10 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>79,33 </sup> </td></tr><tr><td>  <sup>Ja</sup> </td><td align="right"> <sup>39,25 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>96,17 </sup> </td></tr></tbody></table><br><p>         ,    .NET ‚Äî     Jurassic  5,79 ,   Jint  1,75 a.      2     ,      2       .                .      Jurassic,          : Jurassic   JS-  IL-  Reflection.Emit,    .        ,          ,      . Jint           .NET-,    .    Jint      ,             .      ,  Jint    ,    ,            .  Jint  Jurassic        . </p><br><p>      ,   C++,  MSIE   Chakra IE JsRT ‚Äî     26,93%.    ChakraCore (18,96%),  V8 (4,71%)  MSIE   Chakra Edge JsRT    (0,85%).           Internet Explorer    Edge.            .          (   )      .   ,      -         12-17  (       ).         .       .         . </p><br><p>     .NET Core 2.0    ( V8 ,    Microsoft ClearScript,    ,   .NET Core): </p><br><table><thead><tr><th align="left"> <sup> </sup> </th><th align="left"> <sup>. </sup> </th><th align="left"> <sup> . </sup> </th><th align="left"> <sup>Gen 0  . .</sup> </th><th align="left"> <sup>Gen 1  . .</sup> </th><th align="left"> <sup>Gen 2  . .</sup> </th><th align="left"> <sup>    .</sup> </th></tr></thead><tbody><tr><td rowspan="2"> <sup>ChakraCore</sup> </td><td>  <sup>Nein</sup> </td><td align="right"> <sup>43,65 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>18,07 </sup> </td></tr><tr><td>  <sup>Ja</sup> </td><td align="right"> <sup>36,37 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>16,59 </sup> </td></tr><tr><td rowspan="2"> <sup>Jint</sup> </td><td>  <sup>Nein</sup> </td><td align="right"> <sup>24,87 </sup> </td><td align="right"> <sup>2 750,00</sup> </td><td align="right"> <sup>1 375,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>16 300,25 </sup> </td></tr><tr><td>  <sup>Ja</sup> </td><td align="right"> <sup>15,25 </sup> </td><td align="right"> <sup>1 281,25</sup> </td><td align="right"> <sup>593,75</sup> </td><td align="right"> <sup>62,50</sup> </td><td align="right"> <sup>7 447,44 </sup> </td></tr><tr><td rowspan="2"> <sup>Jurassic</sup> </td><td>  <sup>Nein</sup> </td><td align="right"> <sup>469,97 </sup> </td><td align="right"> <sup>2 000,00</sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>15 511,70 </sup> </td></tr><tr><td>  <sup>Ja</sup> </td><td align="right"> <sup>80,72 </sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>7 845,98 </sup> </td></tr><tr><td rowspan="2"> <sup>MSIE   Chakra IE JsRT</sup> </td><td>  <sup>Nein</sup> </td><td align="right"> <sup>31,50 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>20,28 </sup> </td></tr><tr><td>  <sup>Ja</sup> </td><td align="right"> <sup>24,52 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>18,78 </sup> </td></tr><tr><td rowspan="2"> <sup>MSIE   Chakra Edge JsRT</sup> </td><td>  <sup>Nein</sup> </td><td align="right"> <sup>35,54 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>20,45 </sup> </td></tr><tr><td>  <sup>Ja</sup> </td><td align="right"> <sup>31,44 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>18,99 </sup> </td></tr></tbody></table><br><p>      . ,     ‚Äî  MSIE   Chakra Edge JsRT  (7,69%).           Chakra    . </p><br><h2>        ChakraCore  MSIE </h2><br><p>    ,  Microsoft,    ,    .     IIS    (256   32-   512   64-),     ASP.NET  JS- (,  TypeScript)   .       JavaScript Engine Switcher        .             ,        Node.js (492   32-   984   64-).   ,      ,  -    .        ChakraCore  MSIE    <code>MaxStackSize</code> ,          .         Node.js.       ,             . </p><br><h2>     NiL.JS </h2><br><p>      - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">NiL</a> ,      <a href="">NiL.JS</a> . NiL.JS ‚Äî    JS-,    .NET.      2014 ,        Jurassic  Jint.    ‚Äî  .         ,       . </p><br><p>     .NET Framework 4.7.2    : </p><br><table><thead><tr><th align="left"> <sup> </sup> </th><th align="left"> <sup> . </sup> </th><th align="left"> <sup>Gen 0  . .</sup> </th><th align="left"> <sup>Gen 1  . .</sup> </th><th align="left"> <sup>Gen 2  . .</sup> </th><th align="left"> <sup>    .</sup> </th></tr></thead><tbody><tr><td> <sup>Jint</sup> </td><td align="right"> <sup>27,19 </sup> </td><td align="right"> <sup>2 812,50</sup> </td><td align="right"> <sup>1 343,75</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>16 374,58 </sup> </td></tr><tr><td> <sup>Jurassic</sup> </td><td align="right"> <sup>455,70 </sup> </td><td align="right"> <sup>2 000,00</sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>15 575,28 </sup> </td></tr><tr><td> <sup>NiL</sup> </td><td align="right"> <sup>17,80 </sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>4 424,09 </sup> </td></tr></tbody></table><br><p>     .NET Core 2.0  : </p><br><table><thead><tr><th align="left"> <sup> </sup> </th><th align="left"> <sup> . </sup> </th><th align="left"> <sup>Gen 0  . .</sup> </th><th align="left"> <sup>Gen 1  . .</sup> </th><th align="left"> <sup>Gen 2  . .</sup> </th><th align="left"> <sup>    .</sup> </th></tr></thead><tbody><tr><td> <sup>Jint</sup> </td><td align="right"> <sup>24,87 </sup> </td><td align="right"> <sup>2 750,00</sup> </td><td align="right"> <sup>1 375,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>16 300,25 </sup> </td></tr><tr><td> <sup>Jurassic</sup> </td><td align="right"> <sup>469,97 </sup> </td><td align="right"> <sup>2 000,00</sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>15 511,70 </sup> </td></tr><tr><td> <sup>NiL</sup> </td><td align="right"> <sup>19,67 </sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>4 419,95 </sup> </td></tr></tbody></table><br><p>       .        ,     (     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">   </a> ).   ,   Jint        2016       ,       .   <a href="">   3.0.0 Beta 1353</a> ,    Jint    2,4  ,  NiL.JS  2.5.1200,        . </p><br><p>   NiL.JS  .         -  ,      -  ,    .    Bundle Transformer,  JavaScript Engine Switcher,     Hogan  Handlebars,      ReactJS.NET.              NiL.JS. </p><br><h2>  Referenzen </h2><br><ol><li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">JavaScript Engine Switcher</a>  GitHub </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> JavaScript Engine Switcher</a> </li><li>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">¬´  JavaScript Engine Switcher 2.X¬ª</a> </li><li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">JSPool</a>  GitHub </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  ReactJS.NET</a> </li><li>   <a href="">ReactJS.NET</a>  GitHub </li></ol><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de439446/">https://habr.com/ru/post/de439446/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de439432/index.html">Wie man in 1,5 Jahren Java-Entwickler wird</a></li>
<li><a href="../de439434/index.html">NestJS - das gleiche echte Backend f√ºr NodeJS</a></li>
<li><a href="../de439436/index.html">Kostensenkung bei kleinen Elektronikserien in Russland. WOLNA Internet Radio Fall</a></li>
<li><a href="../de439440/index.html">Implementieren Sie Zimbra Collaboration Open Source, autorisieren Sie √ºber AD und erstellen Sie automatisch Postf√§cher</a></li>
<li><a href="../de439442/index.html">Julia. Berichts- und Dokumentgeneratoren</a></li>
<li><a href="../de439448/index.html">Welche Fragen zur Virtualisierung erwarten Sie von einem Absolventen?</a></li>
<li><a href="../de439450/index.html">RS-485 auf inl√§ndischen Mikrocontrollern der Firma Milander</a></li>
<li><a href="../de439454/index.html">Programm als Kunst - Ein neues Software-Management-Paradigma</a></li>
<li><a href="../de439456/index.html">Hipster Podcasts # 2</a></li>
<li><a href="../de439458/index.html">Wie wir die Website der Republik in Kubernetes √ºbersetzt haben</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>