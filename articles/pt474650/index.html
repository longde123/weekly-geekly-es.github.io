<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëçüèø ‚úäüèΩ ‚úíÔ∏è Carrinho de caminh√£o ROS. Parte 8. Controlamos a partir do controle ROS do telefone, n√≥ GPS üè† üí† üìõ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continua√ß√£o da s√©rie de artigos. 

 Posts da s√©rie: 
 8. N√≥s controlamos a partir do telefone-ROS Control, GPS-node 
 7. Localiza√ß√£o do rob√¥: gmapping...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Carrinho de caminh√£o ROS. Parte 8. Controlamos a partir do controle ROS do telefone, n√≥ GPS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474650/">  Continua√ß√£o da s√©rie de artigos. <br><br>  Posts da s√©rie: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">8. N√≥s controlamos a partir do telefone-ROS Control, GPS-node</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">7. Localiza√ß√£o do rob√¥: gmapping, AMCL, pontos de refer√™ncia no mapa da sala</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">6. Odometria com codificadores de roda, mapa da sala, lidar</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">5. Trabalhamos em rviz e gazebo: xacro, novos sensores.</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4. Crie uma simula√ß√£o de rob√¥ usando os editores rviz e gazebo.</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">3. Acelere, troque a c√¢mera, conserte a marcha</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2. Software</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1. Ferro</a> <br><br>  Ao criar mapas em um rob√¥ em um espa√ßo limitado, n√£o h√° problemas.  Ao controlar o rob√¥ a partir do teclado a partir da esta√ß√£o de controle ou no pr√≥prio rob√¥, voc√™ pode observar visualmente seus movimentos e evitar obst√°culos indesejados no tempo.  A situa√ß√£o √© complicada se houver v√°rios quartos.  E aqui h√° v√°rias op√ß√µes para observar um rob√¥ construindo um mapa se ele sair da sala do operador: <br>  - conecte a c√¢mera diretamente ao rob√¥; <br>  - use o sistema de vigil√¢ncia por v√≠deo existente fora do rob√¥; <br>  - controle com wi-fi, teclado bluetooth, estando perto do rob√¥ <br>  - ‚Äúcarregue o rob√¥ em seus bra√ßos‚Äù para que o lidar colete dados; <br>  - controle o rob√¥ pelo telefone. <br><a name="habracut"></a><br>  A √∫ltima op√ß√£o pode parecer conveniente.  Para controlar o rob√¥ pelo telefone, basta inclin√°-lo (o telefone) na dire√ß√£o certa enquanto o rob√¥ est√° construindo um mapa.  Tal miss√£o √© poss√≠vel. <br>  Vamos considerar como direcionar o rob√¥ a partir do telefone, enviando as mensagens apropriadas para os t√≥picos do ROS no rob√¥. <br><br>  N√£o √© necess√°rio escrever um aplicativo separado no telefone para os fins declarados.  Para tirar proveito das pr√°ticas existentes, basta fazer o download para o seu telefone e instalar o aplicativo Android do mercado - ‚ÄúROS Control‚Äù. <br><br><h3>  Configure o aplicativo ROS Control no seu telefone. </h3><br>  A aplica√ß√£o √© intuitiva - um rob√¥ √© adicionado com um sinal "+", seu ip √© definido: <br><div class="spoiler">  <b class="spoiler_title">quadro</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/po/3v/9a/po3v9av548trasyybv9wis4sqxo.jpeg"><br></div></div><br>  Em seguida, selecione "Mostrar op√ß√µes avan√ßadas" e prescreva t√≥picos para o carrinho de rob√¥: <br><div class="spoiler">  <b class="spoiler_title">quadro</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/0e/hf/ke/0ehfkefnorviylss6zea5hyphry.jpeg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">quadro</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/it/vh/2m/itvh2mtm6neqjlq7eoxy21ekqpy.jpeg"><br></div></div><br>  As mensagens do telefone ser√£o direcionadas para esses t√≥picos e tamb√©m ser√£o aceitas em um formato que o ROS entende. <br>  No aplicativo, os t√≥picos est√£o dispon√≠veis para n√≥s: <br>  - t√≥pico do joystick - controle do telefone; <br>  - t√≥pico de varredura a laser - dados do lidar; <br>  - nav sat topic - dados do rob√¥ gps; <br>  - odom - odometria (tudo o que chega dos codificadores e / ou imu e / ou lidar); <br>  - pose - "position", a localiza√ß√£o do rob√¥. <br><br><h3>  Domine o t√≥pico do joystick. </h3><br>  O rob√¥ em si n√£o funciona, portanto, lan√ßaremos um t√≥pico no rob√¥ com um driver de movimento, que j√° foi apresentado em posts anteriores: <br>  1¬∫ terminal: <br> <code>rosrun rosbots_driver part2_cmr.py</code> <br> <br>  No telefone no aplicativo ROS Control, clique na linha com o nome do rob√¥ e falhe no menu de controle do rob√¥: <br><div class="spoiler">  <b class="spoiler_title">quadro</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/7t/r7/47/7tr747_em8xzhfageitu3ouixwc.jpeg"><br></div></div><br>  Agora, se voc√™ puxar o joystick com o dedo (em qualquer dire√ß√£o), o carrinho ir√° embora.Tudo √© simples aqui. <br>  Se voc√™ observar o que acontece com o t√≥pico do driver do mecanismo em execu√ß√£o no raspberry, ver√° que o telefone publica e o driver recebe mensagens no formato apropriado: <br><img src="https://habrastorage.org/webt/5n/5q/cg/5n5qcgrnjkmnsoiaysvtlvj3bai.jpeg"><br><br>  Todos os outros t√≥picos funcionam com o mesmo princ√≠pio. <br><br>  * Se, no entanto, algo deu errado, √© necess√°rio, estando no modo de controle do rob√¥, clique em tr√™s faixas paralelas no canto superior esquerdo da tela do aplicativo.  Falha nas "Prefer√™ncias" e selecione "T√≥picos": <br><br><div class="spoiler">  <b class="spoiler_title">quadro</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/xs/g3/rb/xsg3rbk8-brl1beefsvz5bmfoju.jpeg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">quadro</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/vu/zn/wl/vuznwlax_iokh-2vvxgg-hinneg.jpeg"><br></div></div><br>  Em seguida, clicando no t√≥pico apropriado, registre o caminho (Valor): <br><div class="spoiler">  <b class="spoiler_title">quadro</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/v2/bx/i8/v2bxi8zehxlcdiwd94z3yf4_zgg.jpeg"><br></div></div><br><br><h3>  Vamos ver o que o lidar est√° no aplicativo. </h3><br>  No rob√¥, execute o n√≥ lidar: <br> <code>roslaunch rplidar_ros rplidar.launch</code> <br>  Se voc√™ entrar novamente no aplicativo, na tela de controle do rob√¥, veremos pontos caracter√≠sticos e uma seta azul: <br><div class="spoiler">  <b class="spoiler_title">quadro</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/da/1q/gv/da1qgv-soj6pzwmwtbqqvzd4_ii.jpeg"><br></div></div><br><br>  * Voc√™ tamb√©m pode andar inclinando o telefone em diferentes dire√ß√µes e selecionando o Modo de controle de inclina√ß√£o: <br><div class="spoiler">  <b class="spoiler_title">quadro</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/bl/yq/eh/blyqehz414a4d9lbii_lduqcdm4.jpeg"><br></div></div><br>  Existem outros modos de "dirigir", mesmo com a capacidade de indicar um ponto no mapa, diretamente no telefone, mas como o mapa √© muito arbitr√°rio, a viagem tamb√©m ser√° condicional, ou seja, n√£o vai a lugar nenhum. <br><br><h3>  Com t√≥picos de movimento, como c√¢meras (n√£o consideraremos isso), tudo fica mais ou menos claro, trataremos de gps. </h3><br>  H√° pouco sentido na sala dos gps, mas √© interessante ver como funciona. <br>  Para testes, qualquer apito de GPS √© adequado.  Minha op√ß√£o √© a seguinte - <br><div class="spoiler">  <b class="spoiler_title">quadro</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/zv/nh/vt/zvnhvtxhlggsnpcl-k2ivylmj14.jpeg"><br></div></div><br>  Para faz√™-lo funcionar, primeiro voc√™ precisa instalar o n√≥ gps no raspberry. <br>  Mas primeiro, vamos verificar se o apito do GPS funciona, caso contr√°rio, todas as outras conversas ser√£o a favor dos pobres. <br>  Colocamos pacotes em framboesa: <br> <code>sudo apt-get install gpsd <br> sudo apt-get install gpsd-clients</code> <br>  Verifique se o apito do GPS est√° definido entre os dispositivos USB: <br> <code>lsusb</code> <br> <img src="https://habrastorage.org/webt/c_/yz/9b/c_yz9bousjkzjz-lwlsedxyboj8.jpeg"><br><br>  Agora, verifique se o GPS est√° aceitando algo: <br> <code>gpscat -s 9600 /dev/ttyACM1</code> <br>  * Em vez de ttyACM1, pode haver outros valores (ttyACM0, ttyUSB0, ttyAMA0), dependendo da porta em que o apito do GPS est√° ativado. <br>  As mensagens GPS piscar√£o no terminal: <br><div class="spoiler">  <b class="spoiler_title">quadro</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/zx/4m/ur/zx4murhdyoa_m-pxcnkshg5ri9u.jpeg"><br></div></div><br>  Dados mais estruturados (agrad√°veis ‚Äã‚Äãaos olhos) podem ser obtidos da seguinte maneira: <br> <code>gpsmon /dev/ttyACM1</code> <br> <div class="spoiler">  <b class="spoiler_title">quadro</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/hl/nv/e4/hlnve4ngkqckcwl5cbgpjcugq30.jpeg"><br></div></div><br>  * as coordenadas n√£o s√£o minhas, o que √© estranho.  N√£o est√° claro com o que isso est√° conectado. <br><br>  Instale o n√≥ gps no raspberry: <br> <code>sudo apt-get install libgps-dev <br> cd catkin_ws/src <br> git clone https://github.com/ros-drivers/nmea_navsat_driver <br> git clone https://github.com/ros/roslint <br> cd /home/pi/rosbots_catkin_ws <br> catkin_make</code> <br> <br>  Agora que montamos o n√≥ do GPS, execute-o (no rob√¥): <br> <code>rosrun nmea_navsat_driver nmea_serial_driver _port:=/dev/ttyACM1 _baud:=9600</code> <br> <br>  Se voc√™ observar os t√≥picos (em outro terminal do rob√¥), poder√° ver que o telefone est√° inscrito em um t√≥pico e a publica√ß√£o de um n√≥ gps vai para outro: <br><div class="spoiler">  <b class="spoiler_title">quadro</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/up/5l/rc/up5lrcvdckrdta_jie9wchgrk40.jpeg"><br></div></div><br>  Altere o t√≥pico de recebimento no telefone para / fix fix atrav√©s das configura√ß√µes descritas acima. <br>  Ap√≥s a altera√ß√£o, a publica√ß√£o e recep√ß√£o em um t√≥pico: <br><div class="spoiler">  <b class="spoiler_title">quadro</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/6a/sj/xp/6asjxparvnohhh5zqrmlqtbwfqu.jpeg"><br></div></div><br>  E no telefone voc√™ pode observar as coordenadas: <br><div class="spoiler">  <b class="spoiler_title">quadro</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/9e/e7/xl/9ee7xlxsche7eqca4xfcw0ye904.jpeg"><br></div></div><br><br><h3>  Odometria (t√≥pico / odom). </h3><br>  Se voc√™ executar o n√≥ de odometria de postagens anteriores, quando o rob√¥ se mover, tamb√©m ser√° poss√≠vel obter as velocidades linear e angular do rob√¥ no telefone (as velocidades n√£o s√£o calculadas usando gps). <br>  No rob√¥: <br> <code>cd /home/pi/rosbots_catkin_ws/src/rosbots_driver/scripts/rosbots_driver <br> python diff_tf.py <br></code> <br>  No telefone: <br><div class="spoiler">  <b class="spoiler_title">quadro</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/x7/or/qc/x7orqct4jsqn7cnab_v8unl4nna.jpeg"><br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt474650/">https://habr.com/ru/post/pt474650/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt474630/index.html">Semana de seguran√ßa 45: vulnerabilidades nos animais selvagens do Chrome e do BlueKeep</a></li>
<li><a href="../pt474632/index.html">"Chacal": espreme o frontend</a></li>
<li><a href="../pt474642/index.html">A m√°quina universal para a realiza√ß√£o de testes de bricolage, parte 2</a></li>
<li><a href="../pt474646/index.html">Sobre as perspectivas do formato 360 Reality Audio, fotos de ouvido e m√∫sicas antigas esquecidas</a></li>
<li><a href="../pt474648/index.html">Recrutamento de TI. Como encontrar um equil√≠brio de processo / resultado</a></li>
<li><a href="../pt474652/index.html">Pare de n√£o fazer o seu trabalho</a></li>
<li><a href="../pt474654/index.html">Aperto de m√£o SSH em palavras simples.</a></li>
<li><a href="../pt474656/index.html">Revers√£o MIPS e Golang - o b√°sico do reverso. Resolvendo problemas para reverter com r0ot-mi. Parte 2</a></li>
<li><a href="../pt474658/index.html">Dor no pulso e ratos de computador</a></li>
<li><a href="../pt474662/index.html">Teste Beta: Devo√ß√£o para Desenvolvedores - uma plataforma para aprender ingl√™s</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>