<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒ• ğŸ§‘ğŸ¾â€ğŸ¤â€ğŸ§‘ğŸ» ğŸ¤´ğŸ¿ ç†ŠçŒ«å¤§æ•°æ®åˆ†ææŒ‡å— ğŸ‘©â€ğŸ¨ ğŸ†• ğŸ›„</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å½“ä½¿ç”¨pandasåº“åˆ†æå¤§å°ä¸è¶…è¿‡100 MBçš„å°å‹æ•°æ®é›†æ—¶ï¼Œæ€§èƒ½å¾ˆå°‘ä¼šæˆä¸ºé—®é¢˜ã€‚ ä½†æ˜¯ï¼Œå½“ç ”ç©¶æ•°æ®é›†çš„å¤§å°å¯èƒ½è¾¾åˆ°æ•°GBæ—¶ï¼Œæ€§èƒ½é—®é¢˜å¯èƒ½å¯¼è‡´æ•°æ®åˆ†æçš„æŒç»­æ—¶é—´æ˜¾ç€å¢åŠ ï¼Œç”šè‡³ç”±äºå†…å­˜ä¸è¶³è€Œå¯¼è‡´æ— æ³•è¿›è¡Œåˆ†æã€‚ 

 å°½ç®¡Sparkä¹‹ç±»çš„å·¥å…·å¯ä»¥æœ‰æ•ˆåœ°å¤„ç†å¤§å‹æ•°æ®é›†ï¼ˆä»æ•°ç™¾GBåˆ°å‡ TBï¼‰ï¼Œä½†æ˜¯ä¸ºäº†å……åˆ†åˆ©...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ç†ŠçŒ«å¤§æ•°æ®åˆ†ææŒ‡å—</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/442516/">å½“ä½¿ç”¨pandasåº“åˆ†æå¤§å°ä¸è¶…è¿‡100 MBçš„å°å‹æ•°æ®é›†æ—¶ï¼Œæ€§èƒ½å¾ˆå°‘ä¼šæˆä¸ºé—®é¢˜ã€‚ ä½†æ˜¯ï¼Œå½“ç ”ç©¶æ•°æ®é›†çš„å¤§å°å¯èƒ½è¾¾åˆ°æ•°GBæ—¶ï¼Œæ€§èƒ½é—®é¢˜å¯èƒ½å¯¼è‡´æ•°æ®åˆ†æçš„æŒç»­æ—¶é—´æ˜¾ç€å¢åŠ ï¼Œç”šè‡³ç”±äºå†…å­˜ä¸è¶³è€Œå¯¼è‡´æ— æ³•è¿›è¡Œåˆ†æã€‚ <br><br> å°½ç®¡Sparkä¹‹ç±»çš„å·¥å…·å¯ä»¥æœ‰æ•ˆåœ°å¤„ç†å¤§å‹æ•°æ®é›†ï¼ˆä»æ•°ç™¾GBåˆ°å‡ TBï¼‰ï¼Œä½†æ˜¯ä¸ºäº†å……åˆ†åˆ©ç”¨å®ƒä»¬çš„åŠŸèƒ½ï¼Œæ‚¨é€šå¸¸éœ€è¦åŠŸèƒ½å¼ºå¤§ä¸”æ˜‚è´µçš„ç¡¬ä»¶ã€‚ è€Œä¸”ï¼Œä¸å¤§ç†ŠçŒ«ç›¸æ¯”ï¼Œå®ƒä»¬åœ¨ä¸°å¯Œçš„å·¥å…·é›†ï¼ˆç”¨äºé«˜è´¨é‡æ¸…æ´ï¼Œç ”ç©¶å’Œæ•°æ®åˆ†æï¼‰æ–¹é¢æ²¡æœ‰å·®å¼‚ã€‚ å¯¹äºä¸­å‹æ•°æ®é›†ï¼Œæœ€å¥½å°è¯•æ›´æœ‰æ•ˆåœ°ä½¿ç”¨ç†ŠçŒ«ï¼Œè€Œä¸æ˜¯åˆ‡æ¢åˆ°å…¶ä»–å·¥å…·ã€‚ <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/gd/jg/60/gdjg60abxgti2otxocpd0ct2uci.jpeg"></a> <br><br> åœ¨ä»Šå¤©è¦ç¿»è¯‘çš„ææ–™ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºä½¿ç”¨ç†ŠçŒ«æ—¶ä½¿ç”¨å†…å­˜çš„åŠŸèƒ½ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡ç®€å•åœ°é€‰æ‹©å­˜å‚¨åœ¨<code>DataFrame</code>çš„è¡¨æ•°æ®ç»“æ„çš„åˆ—ä¸­çš„é€‚å½“æ•°æ®ç±»å‹æ¥ç®€å•åœ°å°†å†…å­˜æ¶ˆè€—å‡å°‘è¿‘90ï¼…ã€‚ <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">å¤„ç†æ£’çƒæ¯”èµ›æ•°æ®</font> </h2><br> æˆ‘ä»¬å°†ä½¿ç”¨130å¹´æ¥ä»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Retrosheet</a>æ”¶é›†çš„æœ‰å…³ç¾å›½èŒæ£’å¤§è”ç›Ÿçš„æ¯”èµ›æ•°æ®ã€‚ <br><br> æœ€åˆï¼Œæ­¤æ•°æ®æ˜¾ç¤ºä¸º127ä¸ªCSVæ–‡ä»¶ï¼Œä½†æˆ‘ä»¬ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">csvkit</a>å°†å®ƒä»¬ç»„åˆä¸ºä¸€ä¸ªæ•°æ®é›†ï¼Œå¹¶åœ¨ç»“æœè¡¨çš„ç¬¬ä¸€è¡Œä¸­æ·»åŠ äº†å…·æœ‰åˆ—åçš„è¡Œã€‚ å¦‚æœéœ€è¦ï¼Œæ‚¨å¯ä»¥ä¸‹è½½æ­¤æ•°æ®çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æˆ‘ä»¬çš„ç‰ˆæœ¬</a>å¹¶è¿›è¡Œè¯•éªŒï¼Œé˜…è¯»æœ¬æ–‡ã€‚ <br><br> è®©æˆ‘ä»¬ä»å¯¼å…¥æ•°æ®é›†å¼€å§‹ï¼Œç„¶åçœ‹ä¸€ä¸‹å®ƒçš„å‰äº”è¡Œã€‚ æ‚¨å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤</a>è¡¨<code>   </code>è¡¨çš„â€œ <code>   </code>æ‰¾åˆ°å®ƒä»¬ã€‚ <br><br><pre> <code class="plaintext hljs">import pandas as pd gl = pd.read_csv('game_logs.csv') gl.head()</code> </pre> <br> ä»¥ä¸‹æ˜¯æœ‰å…³æ­¤æ•°æ®è¡¨ä¸­æœ€é‡è¦çš„åˆ—çš„ä¿¡æ¯ã€‚ å¦‚æœè¦é˜…è¯»æ‰€æœ‰åˆ—çš„è¯´æ˜ï¼Œåˆ™å¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨æ­¤å¤„</a>æ‰¾åˆ°æ•´ä¸ªæ•°æ®é›†çš„æ•°æ®å­—å…¸ã€‚ <br><br><ul><li>  <code>date</code> -æ¸¸æˆçš„æ—¥æœŸã€‚ </li><li>  <code>v_name</code>æ¥å®¾å›¢é˜Ÿçš„åç§°ã€‚ </li><li>  <code>v_league</code>å®¢é˜Ÿè”èµ›ã€‚ </li><li>  <code>h_name</code>çš„åç§°ã€‚ </li><li>  <code>h_league</code>ä¸»é˜Ÿè”èµ›ã€‚ </li><li>  <code>v_score</code>å¾—åˆ†ã€‚ </li><li>  <code>h_score</code>å¾—åˆ†ã€‚ </li><li>  <code>v_line_score</code>ç§¯åˆ†çš„æ‘˜è¦ï¼Œä¾‹å¦‚<code>010000(10)00</code> ã€‚ </li><li>  <code>h_line_score</code>çš„æ‘˜è¦ï¼Œä¾‹å¦‚<code>010000(10)0X</code> ã€‚ </li><li>  <code>park_id</code>è¿›è¡Œæ¸¸æˆçš„å­—æ®µçš„æ ‡è¯†ç¬¦ã€‚ </li><li>  <code>attendance</code> -è§‚ä¼—äººæ•°ã€‚ </li></ul><br> ä¸ºäº†æ‰¾åˆ°æœ‰å…³<code>DataFrame</code>å¯¹è±¡çš„å¸¸è§„ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">DataFrame.infoï¼ˆï¼‰</a>æ–¹æ³•ã€‚ é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæ‚¨å¯ä»¥äº†è§£å¯¹è±¡çš„å¤§å°ï¼Œæ•°æ®ç±»å‹ä»¥åŠå†…å­˜ä½¿ç”¨æƒ…å†µã€‚ <br><br> é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸ºäº†èŠ‚çœæ—¶é—´ï¼Œpandas <code>DataFrame</code>äº†æœ‰å…³<code>DataFrame</code>å†…å­˜ä½¿ç”¨æƒ…å†µçš„å¤§æ¦‚ä¿¡æ¯ã€‚ æˆ‘ä»¬å¯¹å‡†ç¡®çš„ä¿¡æ¯æ„Ÿå…´è¶£ï¼Œå› æ­¤æˆ‘ä»¬å°†<code>memory_usage</code>å‚æ•°è®¾ç½®ä¸º<code>'deep'</code> ã€‚ <br><br><pre> <code class="plaintext hljs">gl.info(memory_usage='deep')</code> </pre> <br> ä»¥ä¸‹æ˜¯æˆ‘ä»¬è®¾æ³•è·å¾—çš„ä¿¡æ¯ï¼š <br><br><pre> <code class="plaintext hljs">&lt;class 'pandas.core.frame.DataFrame'&gt; RangeIndex: 171907 entries, 0 to 171906 Columns: 161 entries, date to acquisition_info dtypes: float64(77), int64(6), object(78) memory usage: 861.6 MB</code> </pre> <br> äº‹å®è¯æ˜ï¼Œæˆ‘ä»¬æœ‰171,907è¡Œå’Œ161åˆ—ã€‚ ç†ŠçŒ«åº“è‡ªåŠ¨æ£€æµ‹åˆ°æ•°æ®ç±»å‹ã€‚ æœ‰83åˆ—åŒ…å«æ•°å€¼æ•°æ®ï¼Œ78åˆ—åŒ…å«å¯¹è±¡ã€‚ å¯¹è±¡åˆ—ç”¨äºå­˜å‚¨å­—ç¬¦ä¸²æ•°æ®ï¼Œå¹¶ä¸”åœ¨è¯¥åˆ—åŒ…å«ä¸åŒç±»å‹çš„æ•°æ®çš„æƒ…å†µä¸‹ã€‚ <br><br> ç°åœ¨ï¼Œä¸ºäº†æ›´å¥½åœ°ç†è§£å¦‚ä½•ä½¿ç”¨æ­¤<code>DataFrame</code>ä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œè®©æˆ‘ä»¬è®¨è®ºä¸€ä¸‹ç†ŠçŒ«å¦‚ä½•å°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚ <br><br><h2>  <font color="#3AC1EF">æ•°æ®æ¡†çš„å†…éƒ¨è§†å›¾</font> </h2><br> åœ¨å¤§ç†ŠçŒ«å†…éƒ¨ï¼Œæ•°æ®åˆ—è¢«åˆ†ç»„ä¸ºå…·æœ‰ç›¸åŒç±»å‹å€¼çš„å—ã€‚ è¿™æ˜¯ä¸€ä¸ªå¦‚ä½•å°†<code>DataFrame</code>çš„å‰12åˆ—å­˜å‚¨åœ¨ç†ŠçŒ«ä¸­çš„<code>DataFrame</code> ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d35/c70/c63/d35c70c635289a5cecc520c58e662e9a.png"></div><br>  <i><font color="#999999">ç†ŠçŒ«ä¸­ä¸åŒç±»å‹æ•°æ®çš„å†…éƒ¨è¡¨ç¤º</font></i> <br><br> æ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œå—ä¸å­˜å‚¨åˆ—åä¿¡æ¯ã€‚ è¿™æ˜¯ç”±äºå¯¹æ•°æ®å—è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä»¥å°†å¯ç”¨å€¼å­˜å‚¨åœ¨<code>DataFrame</code>å¯¹è±¡çš„è¡¨å•å…ƒæ ¼ä¸­ã€‚  <code>BlockManager</code>ç±»è´Ÿè´£å­˜å‚¨æœ‰å…³æ•°æ®é›†çš„è¡Œç´¢å¼•å’Œåˆ—ç´¢å¼•ä¹‹é—´çš„å¯¹åº”å…³ç³»ä»¥åŠå­˜å‚¨åœ¨ç›¸åŒç±»å‹æ•°æ®å—ä¸­çš„å†…å®¹çš„ä¿¡æ¯ã€‚ å®ƒå……å½“æä¾›å¯¹åŸºæœ¬æ•°æ®çš„è®¿é—®çš„APIçš„è§’è‰²ã€‚ å½“æˆ‘ä»¬è¯»å–ï¼Œç¼–è¾‘æˆ–åˆ é™¤å€¼æ—¶ï¼Œ <code>DataFrame</code>ç±»ä¸<code>BlockManager</code>ç±»è¿›è¡Œäº¤äº’ä»¥å°†æˆ‘ä»¬çš„è¯·æ±‚è½¬æ¢ä¸ºå‡½æ•°å’Œæ–¹æ³•è°ƒç”¨ã€‚ <br><br> æ¯ä¸ªæ•°æ®ç±»å‹åœ¨<code>pandas.core.internals</code>æ¨¡å—ä¸­éƒ½æœ‰ä¸€ä¸ªä¸“é—¨çš„ç±»ã€‚ ä¾‹å¦‚ï¼Œpandasä½¿ç”¨<code>ObjectBlock</code>ç±»è¡¨ç¤ºåŒ…å«å­—ç¬¦ä¸²åˆ—çš„å—ï¼Œä½¿ç”¨<code>FloatBlock</code>ç±»è¡¨ç¤ºåŒ…å«åŒ…å«æµ®ç‚¹æ•°çš„åˆ—çš„å—ã€‚ å¯¹äºä»£è¡¨çœ‹èµ·æ¥åƒæ•´æ•°æˆ–æµ®ç‚¹æ•°çš„æ•°å€¼çš„å—ï¼Œpandas <code>ndarray</code>åˆ—å¹¶å°†å…¶å­˜å‚¨ä¸ºNumPyåº“çš„<code>ndarray</code>æ•°æ®<code>ndarray</code> ã€‚ è¯¥æ•°æ®ç»“æ„åŸºäºæ•°ç»„Cï¼Œå…¶å€¼å­˜å‚¨åœ¨è¿ç»­çš„å†…å­˜å—ä¸­ã€‚ ç”±äºé‡‡ç”¨äº†è¿™ç§æ•°æ®å­˜å‚¨æ–¹æ¡ˆï¼Œå› æ­¤å¯ä»¥å¿«é€Ÿè®¿é—®æ•°æ®ç‰‡æ®µã€‚ <br><br> ç”±äºä¸åŒç±»å‹çš„æ•°æ®æ˜¯åˆ†å¼€å­˜å‚¨çš„ï¼Œå› æ­¤æˆ‘ä»¬æ£€æŸ¥äº†ä¸åŒç±»å‹æ•°æ®çš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚ è®©æˆ‘ä»¬ä»ä¸åŒç±»å‹æ•°æ®çš„å¹³å‡å†…å­˜ä½¿ç”¨é‡å¼€å§‹ã€‚ <br><br><pre> <code class="plaintext hljs">for dtype in ['float','int','object']:   selected_dtype = gl.select_dtypes(include=[dtype])   mean_usage_b = selected_dtype.memory_usage(deep=True).mean()   mean_usage_mb = mean_usage_b / 1024 ** 2   print("Average memory usage for {} columns: {:03.2f} MB".format(dtype,mean_usage_mb))</code> </pre> <br> ç»“æœï¼Œäº‹å®è¯æ˜ï¼Œä¸åŒç±»å‹æ•°æ®çš„å†…å­˜ä½¿ç”¨é‡çš„å¹³å‡æŒ‡æ ‡å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="plaintext hljs">Average memory usage for float columns: 1.29 MB Average memory usage for int columns: 1.12 MB Average memory usage for object columns: 9.53 MB</code> </pre> <br> è¿™äº›ä¿¡æ¯ä½¿æˆ‘ä»¬äº†è§£åˆ°ï¼Œå¤§å¤šæ•°å†…å­˜éƒ½èŠ±åœ¨å­˜å‚¨å¯¹è±¡å€¼çš„78åˆ—ä¸Šã€‚ ç¨åæˆ‘ä»¬å°†è¯¦ç»†è®¨è®ºï¼Œä½†ç°åœ¨è®©æˆ‘ä»¬è€ƒè™‘æ˜¯å¦å¯ä»¥é€šè¿‡å­˜å‚¨æ•°å­—æ•°æ®çš„åˆ—æ¥æé«˜å†…å­˜ä½¿ç”¨ç‡ã€‚ <br><br><h2>  <font color="#3AC1EF">äºšå‹</font> </h2><br> æ­£å¦‚æˆ‘ä»¬å·²ç»è¯´è¿‡çš„ï¼Œç†ŠçŒ«å°†æ•°å€¼è¡¨ç¤ºä¸º<code>ndarray</code> NumPyæ•°æ®ç»“æ„å¹¶å°†å…¶å­˜å‚¨åœ¨è¿ç»­çš„å†…å­˜å—ä¸­ã€‚ è¯¥æ•°æ®å­˜å‚¨æ¨¡å‹ä½¿æ‚¨å¯ä»¥èŠ‚çœå†…å­˜å¹¶å¿«é€Ÿè®¿é—®å€¼ã€‚ ç”±äºç†ŠçŒ«ä½¿ç”¨ç›¸åŒæ•°é‡çš„å­—èŠ‚è¡¨ç¤ºç›¸åŒç±»å‹çš„æ¯ä¸ªå€¼ï¼Œå¹¶ä¸”<code>ndarray</code>ç»“æ„å­˜å‚¨æœ‰å…³å€¼æ•°é‡çš„ä¿¡æ¯ï¼Œå› æ­¤ç†ŠçŒ«å¯ä»¥å¿«é€Ÿï¼Œå‡†ç¡®åœ°æ˜¾ç¤ºæœ‰å…³å­˜å‚¨æ•°å€¼çš„åˆ—æ‰€æ¶ˆè€—çš„å†…å­˜é‡çš„ä¿¡æ¯ã€‚ <br><br> å¤§ç†ŠçŒ«ä¸­çš„è®¸å¤šæ•°æ®ç±»å‹éƒ½æœ‰è®¸å¤šå­ç±»å‹ï¼Œè¿™äº›å­ç±»å‹å¯ä»¥ä½¿ç”¨æ›´å°‘çš„å­—èŠ‚æ¥è¡¨ç¤ºæ¯ä¸ªå€¼ã€‚ ä¾‹å¦‚ï¼Œ <code>float</code>ç±»å‹å…·æœ‰å­ç±»å‹<code>float16</code> ï¼Œ <code>float32</code>å’Œ<code>float64</code> ã€‚ ç±»å‹åç§°ä¸­çš„æ•°å­—è¡¨ç¤ºè¯¥å­ç±»å‹ç”¨æ¥è¡¨ç¤ºå€¼çš„ä½æ•°ã€‚ ä¾‹å¦‚ï¼Œåœ¨åˆšåˆ—å‡ºçš„å­ç±»å‹ä¸­ï¼Œåˆ†åˆ«å°†2ã€4ã€8å’Œ16ä¸ªå­—èŠ‚ç”¨äºæ•°æ®å­˜å‚¨ã€‚ ä¸‹è¡¨æ˜¾ç¤ºäº†ç†ŠçŒ«ä¸­æœ€å¸¸ç”¨çš„æ•°æ®ç±»å‹çš„å­ç±»å‹ã€‚ <br><table><tbody><tr><td>  <sup>å†…å­˜ä½¿ç”¨é‡ï¼ˆå­—èŠ‚ï¼‰</sup> <sup><br></sup> </td><td>  <sup>æµ®ç‚¹æ•°</sup> <sup><br></sup> </td><td>  <sup>æ•´æ•°</sup> <sup><br></sup> </td><td>  <sup>æ— ç¬¦å·æ•´æ•°</sup> <sup><br></sup> </td><td>  <sup>æ—¥æœŸå’Œæ—¶é—´</sup> <sup><br></sup> </td><td>  <sup>å¸ƒå°”å€¼</sup> <sup><br></sup> </td><td width="75">  <sup>å¯¹è±¡</sup> <sup><br></sup> </td></tr><tr><td>  <sup>1ä¸ª</sup> <sup><br></sup> </td><td></td><td>  <sup>int8</sup> <sup><br></sup> </td><td>  <sup>uint8</sup> <sup><br></sup> </td><td></td><td>  <sup>å¸ƒå°”</sup> <sup><br></sup> </td><td></td></tr><tr><td>  <sup>2</sup> <sup><br></sup> </td><td>  <sup>float16</sup> <sup><br></sup> </td><td>  <sup>int16</sup> <sup><br></sup> </td><td>  <sup>uint16</sup> <sup><br></sup> </td><td></td><td></td><td></td></tr><tr><td>  <sup>4</sup> <sup><br></sup> </td><td>  <sup>float32</sup> <sup><br></sup> </td><td>  <sup>int32</sup> <sup><br></sup> </td><td>  <sup>uint32</sup> <sup><br></sup> </td><td></td><td></td><td></td></tr><tr><td>  <sup>8</sup> <sup><br></sup> </td><td>  <sup>float64</sup> <sup><br></sup> </td><td>  <sup>int64</sup> <sup><br></sup> </td><td>  <sup>uint64</sup> <sup><br></sup> </td><td>  <sup>æ—¥æœŸæ—¶é—´64</sup> <sup><br></sup> </td><td></td><td></td></tr><tr><td>  <sup>å¯å˜å­˜å‚¨å®¹é‡</sup> <sup><br></sup> </td><td></td><td></td><td></td><td></td><td></td><td>  <sup>å¯¹è±¡</sup> <sup><br></sup> </td></tr></tbody></table><br>  <code>int8</code>ç±»å‹çš„å€¼ä½¿ç”¨1ä¸ªå­—èŠ‚ï¼ˆ8ä½ï¼‰å­˜å‚¨ä¸€ä¸ªæ•°å­—ï¼Œå¯ä»¥è¡¨ç¤º256ä¸ªäºŒè¿›åˆ¶å€¼ï¼ˆ2åˆ°8çš„å¹‚ï¼‰ã€‚ è¿™æ„å‘³ç€è¯¥å­ç±»å‹å¯ç”¨äºå­˜å‚¨-128åˆ°127ï¼ˆåŒ…æ‹¬0ï¼‰èŒƒå›´å†…çš„å€¼ã€‚ <br><br> è¦æ£€æŸ¥é€‚ç”¨äºä½¿ç”¨æ¯ä¸ªæ•´æ•°å­ç±»å‹å­˜å‚¨çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ï¼Œå¯ä»¥ä½¿ç”¨<code>numpy.iinfo()</code>æ–¹æ³•ã€‚ è€ƒè™‘ä¸€ä¸ªä¾‹å­ï¼š <br><br><pre> <code class="plaintext hljs">import numpy as np int_types = ["uint8", "int8", "int16"] for it in int_types:   print(np.iinfo(it))</code> </pre> <br> é€šè¿‡æ‰§è¡Œæ­¤ä»£ç ï¼Œæˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹æ•°æ®ï¼š <br><br><pre> <code class="plaintext hljs">Machine parameters for uint8 --------------------------------------------------------------- min = 0 max = 255 --------------------------------------------------------------- Machine parameters for int8 --------------------------------------------------------------- min = -128 max = 127 --------------------------------------------------------------- Machine parameters for int16 --------------------------------------------------------------- min = -32768 max = 32767 ---------------------------------------------------------------</code> </pre> <br> åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥æ³¨æ„<code>uint</code> ï¼ˆæ— ç¬¦å·æ•´æ•°ï¼‰å’Œ<code>int</code> ï¼ˆæœ‰ç¬¦å·æ•´æ•°ï¼‰ç±»å‹ä¹‹é—´çš„åŒºåˆ«ã€‚ ä¸¤ç§ç±»å‹å…·æœ‰ç›¸åŒçš„å®¹é‡ï¼Œä½†æ˜¯å½“ä»…åœ¨åˆ—ä¸­å­˜å‚¨æ­£å€¼æ—¶ï¼Œæ— ç¬¦å·ç±»å‹å¯ä»¥æ›´æœ‰æ•ˆåœ°ä½¿ç”¨å†…å­˜ã€‚ <br><br><h2>  <font color="#3AC1EF">ä½¿ç”¨å­ç±»å‹ä¼˜åŒ–æ•°å­—æ•°æ®çš„å­˜å‚¨</font> </h2><br>  <code>pd.to_numeric()</code>å‡½æ•°å¯ç”¨äºä¸‹è½¬æ¢æ•°å­—ç±»å‹ã€‚ è¦é€‰æ‹©æ•´æ•°åˆ—ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>DataFrame.select_dtypes()</code>æ–¹æ³•ï¼Œç„¶åå¯¹å…¶è¿›è¡Œä¼˜åŒ–å¹¶æ¯”è¾ƒä¼˜åŒ–å‰åçš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚ <br><br><pre> <code class="plaintext hljs">#     ,   , #   ,      . def mem_usage(pandas_obj):   if isinstance(pandas_obj,pd.DataFrame):       usage_b = pandas_obj.memory_usage(deep=True).sum()   else: #     ,     DataFrame,   Series       usage_b = pandas_obj.memory_usage(deep=True)   usage_mb = usage_b / 1024 ** 2 #       return "{:03.2f} MB".format(usage_mb) gl_int = gl.select_dtypes(include=['int']) converted_int = gl_int.apply(pd.to_numeric,downcast='unsigned') print(mem_usage(gl_int)) print(mem_usage(converted_int)) compare_ints = pd.concat([gl_int.dtypes,converted_int.dtypes],axis=1) compare_ints.columns = ['before','after'] compare_ints.apply(pd.Series.value_counts)</code> </pre> <br> è¿™æ˜¯å†…å­˜æ¶ˆè€—ç ”ç©¶çš„ç»“æœï¼š <br><br> <code>7.87 MB <br> 1.48 MB</code> <br> <table><tbody><tr><td></td><td> åˆ° <br></td><td> ä¹‹å <br></td></tr><tr><td>  uint8 <br></td><td>  N <br></td><td>  5.0 <br></td></tr><tr><td>  uint32 <br></td><td>  N <br></td><td>  1.0 <br></td></tr><tr><td>  int64 <br></td><td>  6.0 <br></td><td>  N <br></td></tr></tbody></table><br> ç»“æœï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å†…å­˜ä½¿ç”¨é‡ä»7.9å…†å­—èŠ‚å‡å°‘åˆ°1.5å…†å­—èŠ‚ï¼Œå³-æˆ‘ä»¬å°†å†…å­˜æ¶ˆè€—é™ä½äº†80ï¼…ä»¥ä¸Šã€‚ ä½†æ˜¯ï¼Œæ­¤ä¼˜åŒ–å¯¹åŸå§‹<code>DataFrame</code>çš„æ€»ä½“å½±å“ä¸æ˜¯ç‰¹åˆ«å¼ºçƒˆï¼Œå› ä¸ºå®ƒå…·æœ‰å¾ˆå°‘çš„æ•´æ•°åˆ—ã€‚ <br><br> è®©æˆ‘ä»¬å¯¹åŒ…å«æµ®ç‚¹æ•°çš„åˆ—è¿›è¡Œç›¸åŒçš„æ“ä½œã€‚ <br><br><pre> <code class="plaintext hljs">gl_float = gl.select_dtypes(include=['float']) converted_float = gl_float.apply(pd.to_numeric,downcast='float') print(mem_usage(gl_float)) print(mem_usage(converted_float)) compare_floats = pd.concat([gl_float.dtypes,converted_float.dtypes],axis=1) compare_floats.columns = ['before','after'] compare_floats.apply(pd.Series.value_counts)</code> </pre> <br> ç»“æœå¦‚ä¸‹ï¼š <br><br> <code>100.99 MB <br> 50.49 MB</code> <br> <table><tbody><tr><td></td><td> åˆ° <br></td><td> ä¹‹å <br></td></tr><tr><td>  float32 <br></td><td>  N <br></td><td>  77.0 <br></td></tr><tr><td>  float64 <br></td><td>  77.0 <br></td><td>  N <br></td></tr></tbody></table><br> ç»“æœï¼Œæ‰€æœ‰å­˜å‚¨æµ®ç‚¹æ•°ä¸”æ•°æ®ç±»å‹ä¸º<code>float64</code>ç°åœ¨éƒ½å­˜å‚¨äº†<code>float32</code>ç±»å‹çš„æ•°å­—ï¼Œè¿™ä½¿æˆ‘ä»¬çš„å†…å­˜ä½¿ç”¨é‡å‡å°‘äº†50ï¼…ã€‚ <br><br> åˆ›å»ºåŸå§‹<code>DataFrame</code>çš„å‰¯æœ¬ï¼Œä½¿ç”¨è¿™äº›ä¼˜åŒ–çš„æ•°å­—åˆ—è€Œä¸æ˜¯å…¶ä¸­æœ€åˆå­˜åœ¨çš„æ•°å­—åˆ—ï¼Œå¹¶æŸ¥çœ‹ä¼˜åŒ–åçš„æ•´ä½“å†…å­˜ä½¿ç”¨æƒ…å†µã€‚ <br><br><pre> <code class="plaintext hljs">optimized_gl = gl.copy() optimized_gl[converted_int.columns] = converted_int optimized_gl[converted_float.columns] = converted_float print(mem_usage(gl)) print(mem_usage(optimized_gl))</code> </pre> <br> è¿™æ˜¯æˆ‘ä»¬å¾—åˆ°çš„ï¼š <br><br> <code>861.57 MB <br> 804.69 MB</code> <br> <br> å°½ç®¡æˆ‘ä»¬é€šè¿‡å­˜å‚¨æ•°å­—æ•°æ®çš„åˆ—æ˜¾ç€å‡å°‘äº†å†…å­˜æ¶ˆè€—ï¼Œä½†æ˜¯é€šå¸¸ï¼Œåœ¨æ•´ä¸ª<code>DataFrame</code> ï¼Œå†…å­˜æ¶ˆè€—ä»…å‡å°‘äº†7ï¼…ã€‚ å¯¹è±¡ç±»å‹å­˜å‚¨çš„ä¼˜åŒ–å¯ä»¥æˆä¸ºæƒ…å†µä¸¥é‡æ”¹å–„çš„æºæ³‰ã€‚ <br><br> åœ¨è¿›è¡Œä¼˜åŒ–ä¹‹å‰ï¼Œæˆ‘ä»¬å°†ä»”ç»†ç ”ç©¶ç†ŠçŒ«ä¸­å­—ç¬¦ä¸²çš„å­˜å‚¨æ–¹å¼ï¼Œå¹¶å°†å…¶ä¸æ•°å­—åœ¨æ­¤å¤„çš„å­˜å‚¨æ–¹å¼è¿›è¡Œæ¯”è¾ƒã€‚ <br><br><h2>  <font color="#3AC1EF">æ¯”è¾ƒå­˜å‚¨æ•°å­—å’Œå­—ç¬¦ä¸²çš„æœºåˆ¶</font> </h2><br>  <code>object</code>ç±»å‹ä½¿ç”¨Pythonå­—ç¬¦ä¸²å¯¹è±¡è¡¨ç¤ºå€¼ã€‚ éƒ¨åˆ†åŸå› æ˜¯NumPyä¸æ”¯æŒç¼ºå°‘å­—ç¬¦ä¸²å€¼çš„è¡¨ç¤ºã€‚ ç”±äºPythonæ˜¯ä¸€ç§é«˜çº§è§£é‡Šè¯­è¨€ï¼Œå› æ­¤å®ƒæ²¡æœ‰ä¸ºç¨‹åºå‘˜æä¾›ç”¨äºå¾®è°ƒæ•°æ®åœ¨å†…å­˜ä¸­å­˜å‚¨æ–¹å¼çš„å·¥å…·ã€‚ <br><br> æ­¤é™åˆ¶å¯¼è‡´ä»¥ä¸‹äº‹å®ï¼šå­—ç¬¦ä¸²æœªå­˜å‚¨åœ¨è¿ç»­çš„å†…å­˜ç¢ç‰‡ä¸­ï¼›å®ƒä»¬åœ¨å†…å­˜ä¸­çš„è¡¨ç¤ºæ˜¯ç¢ç‰‡åŒ–çš„ã€‚ è¿™å¯¼è‡´å†…å­˜æ¶ˆè€—å¢åŠ ï¼Œå¹¶ä¸”å¤„ç†å­—ç¬¦ä¸²å€¼çš„é€Ÿåº¦å˜æ…¢ã€‚ å®é™…ä¸Šï¼Œå­˜å‚¨å¯¹è±¡æ•°æ®ç±»å‹çš„åˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆåŒ…å«å®é™…åœ°å€ä½äºå†…å­˜ä¸­çš„â€œåœ°å€â€ã€‚ <br><br> ä¸‹å›¾æ˜¯åŸºäº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤</a>ææ–™çš„å›¾ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¯¥</a>å›¾æ¯”è¾ƒäº†ä½¿ç”¨NumPyæ•°æ®ç±»å‹å­˜å‚¨æ•°å­—æ•°æ®å’Œä½¿ç”¨Pythonçš„å†…ç½®æ•°æ®ç±»å‹å­˜å‚¨å­—ç¬¦ä¸²ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d80/66f/54b/d8066f54b091531c120b94c90f698236.png"></div><br>  <i><font color="#999999">å­˜å‚¨æ•°å­—å’Œå­—ç¬¦ä¸²æ•°æ®</font></i> <br><br> åœ¨è¿™é‡Œæ‚¨å¯ä»¥å›æƒ³èµ·ï¼Œåœ¨ä¸Šé¢çš„è¡¨ä¹‹ä¸€ä¸­ï¼Œæ˜¾ç¤ºäº†ä½¿ç”¨å¯å˜æ•°é‡çš„å†…å­˜æ¥å­˜å‚¨å¯¹è±¡ç±»å‹çš„æ•°æ®ã€‚ å°½ç®¡æ¯ä¸ªæŒ‡é’ˆå ç”¨1ä¸ªå­—èŠ‚çš„å†…å­˜ï¼Œä½†æ˜¯æ¯ä¸ªç‰¹å®šçš„å­—ç¬¦ä¸²å€¼å ç”¨çš„å†…å­˜é‡ä¸åœ¨Pythonä¸­ç”¨äºå­˜å‚¨å•ä¸ªå­—ç¬¦ä¸²çš„å†…å­˜é‡ç›¸åŒã€‚ ä¸ºäº†ç¡®è®¤è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<code>sys.getsizeof()</code>æ–¹æ³•ã€‚ é¦–å…ˆï¼ŒæŸ¥çœ‹å„ä¸ªè¡Œï¼Œç„¶åæŸ¥çœ‹å­˜å‚¨å­—ç¬¦ä¸²æ•°æ®çš„<code>Series</code> pandaså¯¹è±¡ã€‚ <br><br> å› æ­¤ï¼Œé¦–å…ˆæˆ‘ä»¬æ£€æŸ¥é€šå¸¸çš„å‡ è¡Œï¼š <br><br><pre> <code class="plaintext hljs">from sys import getsizeof s1 = 'working out' s2 = 'memory usage for' s3 = 'strings in python is fun!' s4 = 'strings in python is fun!' for s in [s1, s2, s3, s4]:   print(getsizeof(s))</code> </pre> <br> åœ¨è¿™é‡Œï¼Œå†…å­˜ä½¿ç”¨æƒ…å†µæ•°æ®å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br> <code>60 <br> 65 <br> 74 <br> 74</code> <br> <br> ç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>Series</code>å¯¹è±¡ä¸­å­—ç¬¦ä¸²çš„ç”¨æ³•ï¼š <br><br><pre> <code class="plaintext hljs">obj_series = pd.Series(['working out',                         'memory usage for',                         'strings in python is fun!',                         'strings in python is fun!']) obj_series.apply(getsizeof)</code> </pre> <br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹å†…å®¹ï¼š <br><br><pre> <code class="plaintext hljs">0    60 1    65 2    74 3    74 dtype: int64</code> </pre> <br> åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥çœ‹åˆ°<code>Series</code> pandaså¯¹è±¡ä¸­å­˜å‚¨çš„è¡Œçš„å¤§å°ä¸åœ¨Pythonä¸­ä½¿ç”¨å®ƒä»¬å¹¶å°†å®ƒä»¬è¡¨ç¤ºä¸ºå•ç‹¬çš„å®ä½“æ—¶çš„å¤§å°ç›¸ä¼¼ã€‚ <br><br><h2>  <font color="#3AC1EF">ä½¿ç”¨åˆ†ç±»å˜é‡ä¼˜åŒ–å¯¹è±¡ç±»å‹æ•°æ®çš„å­˜å‚¨</font> </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åˆ†ç±»å˜é‡</a>å‡ºç°åœ¨ç†ŠçŒ«0.15ç‰ˆä¸­ã€‚ å¯¹åº”çš„ç±»å‹<code>category</code> ï¼Œåœ¨å…¶å†…éƒ¨æœºåˆ¶ä¸­ä½¿ç”¨æ•´æ•°å€¼ï¼Œè€Œä¸æ˜¯å­˜å‚¨åœ¨è¡¨åˆ—ä¸­çš„åŸå§‹å€¼ã€‚ ç†ŠçŒ«ä½¿ç”¨å•ç‹¬çš„å­—å…¸æ¥è®¾ç½®æ•´æ•°å’Œåˆå§‹å€¼çš„å¯¹åº”å…³ç³»ã€‚ å½“åˆ—åŒ…å«æœ‰é™é›†ä¸­çš„å€¼æ—¶ï¼Œæ­¤æ–¹æ³•å¾ˆæœ‰ç”¨ã€‚ å½“å°†å­˜å‚¨åœ¨åˆ—ä¸­çš„æ•°æ®è½¬æ¢ä¸º<code>category</code>ç±»å‹æ—¶ï¼Œpandasä½¿ç”¨<code>int</code>å­ç±»å‹ï¼Œè¯¥å­ç±»å‹å¯ä»¥æœ€æœ‰æ•ˆåœ°ä½¿ç”¨å†…å­˜ï¼Œå¹¶ä¸”èƒ½å¤Ÿè¡¨ç¤ºåœ¨è¯¥åˆ—ä¸­æ‰¾åˆ°çš„æ‰€æœ‰å”¯ä¸€å€¼ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1f5/48d/59c/1f548d59c9b41fd906d038c19d3a2da2.png"></div><br>  <i><font color="#999999">ä½¿ç”¨int8å­ç±»å‹çš„æºæ•°æ®å’Œåˆ†ç±»æ•°æ®</font></i> <br><br> ä¸ºäº†å‡†ç¡®äº†è§£æˆ‘ä»¬å¯ä»¥åœ¨ä½•å¤„ä½¿ç”¨åˆ†ç±»æ•°æ®æ¥å‡å°‘å†…å­˜æ¶ˆè€—ï¼Œæˆ‘ä»¬åœ¨å­˜å‚¨å¯¹è±¡ç±»å‹å€¼çš„åˆ—ä¸­æ‰¾åˆ°å”¯ä¸€å€¼çš„æ•°é‡ï¼š <br><br><pre> <code class="plaintext hljs">gl_obj = gl.select_dtypes(include=['object']).copy() gl_obj.describe()</code> </pre> <br> æ‚¨å¯ä»¥åœ¨è¡¨æ ¼<code>    </code>ä¸Šæ‰¾åˆ°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¯¥</a>è¡¨<code>    </code> ã€‚ <br><br> ä¾‹å¦‚ï¼Œåœ¨<code>day_of_week</code>åˆ—ï¼ˆå³ç©æ¸¸æˆçš„æ˜ŸæœŸå‡ ï¼‰ä¸­ï¼Œæœ‰171907ä¸ªå€¼ã€‚ å…¶ä¸­åªæœ‰7ä¸ªæ˜¯å”¯ä¸€çš„ã€‚ æ€»ä½“è€Œè¨€ï¼Œå•çœ‹æ­¤æŠ¥å‘Šå°±è¶³ä»¥ç†è§£ï¼Œè®¸å¤šåˆ—ä¸­ä½¿ç”¨äº†è®¸å¤šå”¯ä¸€å€¼æ¥è¡¨ç¤ºå¤§çº¦172,000ä¸ªæ¸¸æˆçš„æ•°æ®ã€‚ <br><br> åœ¨è¿›è¡Œå…¨é¢ä¼˜åŒ–ä¹‹å‰ï¼Œè®©æˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªè‡³å°‘å­˜å‚¨å¯¹è±¡æ•°æ®çš„åˆ—ï¼ˆè‡³å°‘<code>day_of_week</code> ï¼Œå¹¶æŸ¥çœ‹å°†å…¶è½¬æ¢ä¸ºåˆ†ç±»ç±»å‹æ—¶ç¨‹åºå†…éƒ¨å‘ç”Ÿçš„æƒ…å†µã€‚ <br><br> å¦‚å‰æ‰€è¿°ï¼Œè¯¥åˆ—ä»…åŒ…å«7ä¸ªå”¯ä¸€å€¼ã€‚ è¦å°†å…¶è½¬æ¢ä¸ºåˆ†ç±»ç±»å‹ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>.astype()</code>æ–¹æ³•ã€‚ <br><br><pre> <code class="plaintext hljs">dow = gl_obj.day_of_week print(dow.head()) dow_cat = dow.astype('category') print(dow_cat.head())</code> </pre> <br> è¿™æ˜¯æˆ‘ä»¬å¾—åˆ°çš„ï¼š <br><br><pre> <code class="plaintext hljs">0    Thu 1    Fri 2    Sat 3    Mon 4    Tue Name: day_of_week, dtype: object 0    Thu 1    Fri 2    Sat 3    Mon 4    Tue Name: day_of_week, dtype: category Categories (7, object): [Fri, Mon, Sat, Sun, Thu, Tue, Wed]</code> </pre> <br> å¦‚æ‚¨æ‰€è§ï¼Œå°½ç®¡åˆ—çš„ç±»å‹å·²æ›´æ”¹ï¼Œä½†å­˜å‚¨åœ¨å…¶ä¸­çš„æ•°æ®çœ‹èµ·æ¥ä¸ä»¥å‰ç›¸åŒã€‚ ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ç¨‹åºå†…éƒ¨æ­£åœ¨å‘ç”Ÿä»€ä¹ˆã€‚ <br><br> åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>Series.cat.codes</code>å±æ€§æ¥æ‰¾å‡º<code>category</code>ç±»å‹ç”¨æ¥è¡¨ç¤ºä¸€å‘¨ä¸­æ¯ä¸€å¤©çš„æ•´æ•°å€¼ï¼š <br><br><pre> <code class="plaintext hljs">dow_cat.head().cat.codes</code> </pre> <br> æˆ‘ä»¬è®¾æ³•æ‰¾å‡ºä»¥ä¸‹å†…å®¹ï¼š <br><br><pre> <code class="plaintext hljs">0    4 1    0 2    2 3    1 4    5 dtype: int8</code> </pre> <br> åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ä¸ºæ¯ä¸ªå”¯ä¸€å€¼åˆ†é…äº†ä¸€ä¸ªæ•´æ•°å€¼ï¼Œå¹¶ä¸”è¯¥åˆ—ç°åœ¨ä¸º<code>int8</code>ç±»å‹ã€‚ æ²¡æœ‰ä¸¢å¤±çš„å€¼ï¼Œä½†æ˜¯å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œåˆ™å°†ä½¿ç”¨-1è¡¨ç¤ºè¿™æ ·çš„å€¼ã€‚ <br><br> ç°åœ¨ï¼Œæˆ‘ä»¬æ¯”è¾ƒå°†<code>day_of_week</code>åˆ—è½¬æ¢ä¸º<code>category</code>ç±»å‹ä¹‹å‰å’Œä¹‹åçš„å†…å­˜æ¶ˆè€—ã€‚ <br><br><pre> <code class="plaintext hljs">print(mem_usage(dow)) print(mem_usage(dow_cat))</code> </pre> <br> ç»“æœå¦‚ä¸‹ï¼š <br><br> <code>9.84 MB <br> 0.16 MB</code> <br> <br> å¦‚æ‚¨æ‰€è§ï¼Œæœ€åˆæ¶ˆè€—äº†9.84å…†å­—èŠ‚çš„å†…å­˜ï¼Œä¼˜åŒ–åä»…æ¶ˆè€—äº†0.16å…†å­—èŠ‚ï¼Œè¿™æ„å‘³ç€è¯¥æŒ‡æ ‡æé«˜äº†98ï¼…ã€‚ è¯·æ³¨æ„ï¼Œå½“åœ¨åŒ…å«å¤§çº¦172,000ä¸ªå…ƒç´ çš„åˆ—ä¸­ä»…ä½¿ç”¨7ä¸ªå”¯ä¸€å€¼æ—¶ï¼Œä½¿ç”¨æ­¤åˆ—å¯èƒ½è¯æ˜æ˜¯æœ€æœ‰åˆ©å¯å›¾çš„ä¼˜åŒ–æ–¹æ¡ˆä¹‹ä¸€ã€‚ <br><br> å°½ç®¡å°†æ‰€æœ‰åˆ—è½¬æ¢ä¸ºè¯¥æ•°æ®ç±»å‹çš„æƒ³æ³•çœ‹èµ·æ¥å¾ˆå¸å¼•äººï¼Œä½†æ˜¯åœ¨æ‰§è¡Œæ­¤æ“ä½œä¹‹å‰ï¼Œè¯·è€ƒè™‘è¿™ç§è½¬æ¢çš„è´Ÿé¢å½±å“ã€‚ å› æ­¤ï¼Œæ­¤è½¬æ¢æœ€ä¸¥é‡çš„ç¼ºç‚¹æ˜¯ä¸å¯èƒ½å¯¹åˆ†ç±»æ•°æ®æ‰§è¡Œç®—æœ¯è¿ç®—ã€‚ è¿™ä¹Ÿé€‚ç”¨äºæ™®é€šçš„ç®—æœ¯è¿ç®—ï¼Œä»¥åŠä½¿ç”¨<code>Series.min()</code>å’Œ<code>Series.max()</code>è€Œæ— éœ€å…ˆå°†æ•°æ®è½¬æ¢ä¸ºå®æ•°ç±»å‹çš„æƒ…å†µã€‚ <br><br> æˆ‘ä»¬åº”è¯¥å°†<code>category</code>ç±»å‹çš„ä½¿ç”¨é™åˆ¶ä¸ºä¸»è¦å­˜å‚¨ç±»å‹ä¸º<code>object</code>æ•°æ®çš„åˆ—ï¼Œå…¶ä¸­å°‘äº50ï¼…çš„å€¼æ˜¯å”¯ä¸€çš„ã€‚ å¦‚æœåˆ—ä¸­çš„æ‰€æœ‰å€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œåˆ™ä½¿ç”¨<code>category</code>ç±»å‹å°†å¢åŠ å†…å­˜ä½¿ç”¨é‡ã€‚ è¿™æ˜¯ç”±äºä»¥ä¸‹äº‹å®ï¼šé™¤äº†æ•°å­—ç±»åˆ«ä»£ç ä¹‹å¤–ï¼Œæ‚¨è¿˜å¿…é¡»åœ¨å†…å­˜ä¸­å­˜å‚¨åŸå§‹å­—ç¬¦ä¸²å€¼ã€‚ æœ‰å…³<code>category</code>ç±»å‹é™åˆ¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§pandas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡æ¡£</a> ã€‚ <br><br> è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¾ªç¯ï¼Œå¾ªç¯è®¿é—®å­˜å‚¨ç±»å‹ä¸º<code>object</code>æ•°æ®çš„æ‰€æœ‰åˆ—ï¼Œæ‰¾å‡ºåˆ—ä¸­å”¯ä¸€å€¼çš„æ•°é‡æ˜¯å¦è¶…è¿‡50ï¼…ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å°†å…¶è½¬æ¢ä¸º<code>category</code>ç±»å‹ã€‚ <br><br><pre> <code class="plaintext hljs">converted_obj = pd.DataFrame() for col in gl_obj.columns:   num_unique_values = len(gl_obj[col].unique())   num_total_values = len(gl_obj[col])   if num_unique_values / num_total_values &lt; 0.5:       converted_obj.loc[:,col] = gl_obj[col].astype('category')   else:       converted_obj.loc[:,col] = gl_obj[col]</code> </pre> <br> ç°åœ¨å°†ä¼˜åŒ–åå‘ç”Ÿçš„äº‹æƒ…ä¸ä¹‹å‰å‘ç”Ÿçš„äº‹æƒ…è¿›è¡Œæ¯”è¾ƒï¼š <br><br><pre> <code class="plaintext hljs">print(mem_usage(gl_obj)) print(mem_usage(converted_obj)) compare_obj = pd.concat([gl_obj.dtypes,converted_obj.dtypes],axis=1) compare_obj.columns = ['before','after'] compare_obj.apply(pd.Series.value_counts)</code> </pre> <br> æˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹å†…å®¹ï¼š <br><br> <code>752.72 MB <br> 51.67 MB</code> <br> <table><tbody><tr><td></td><td> åˆ° <br></td><td> ä¹‹å <br></td></tr><tr><td> å¯¹è±¡ <br></td><td>  78.0 <br></td><td>  N <br></td></tr><tr><td> ç±»åˆ« <br></td><td>  N <br></td><td>  78.0 <br></td></tr></tbody></table><br>           <code>category</code> ,     ,          , ,      ,     ,    ,  ,     . <br><br>  ,  ,     ,    <code>object</code> ,   752   52 ,    93%.     ,          .  ,       ,   ,  ,     891 . <br><br><pre> <code class="plaintext hljs">optimized_gl[converted_obj.columns] = converted_obj mem_usage(optimized_gl)</code> </pre> <br>     : <br><br> <code>'103.64 MB'</code> <br> <br>  .     - .    ,       <code>datetime</code> , ,  ,        . <br><br><pre> <code class="plaintext hljs">date = optimized_gl.date print(mem_usage(date)) date.head()</code> </pre> <br>       : <br><br> <code>0.66 MB</code> <br> <br>    : <br><br><pre> <code class="plaintext hljs">0    18710504 1    18710505 2    18710506 3    18710508 4    18710509 Name: date, dtype: uint32</code> </pre> <br>  ,               <code>uint32</code> . -       <code>datetime</code>     ,         64 .       <code>datetime</code> ,  ,  ,          . <br><br>      <code>to_datetime()</code> ,  <code>format</code>    ,      <code>YYYY-MM-DD</code> . <br><br><pre> <code class="plaintext hljs">optimized_gl['date'] = pd.to_datetime(date,format='%Y%m%d') print(mem_usage(optimized_gl)) optimized_gl.date.head()</code> </pre> <br>    : <br><br> <code>104.29 MB</code> <br> <br>    : <br><br><pre> <code class="plaintext hljs">0   1871-05-04 1   1871-05-05 2   1871-05-06 3   1871-05-08 4   1871-05-09 Name: date, dtype: datetime64[ns]</code> </pre> <br><h2> <font color="#3AC1EF">    </font> </h2><br>            <code>DataFrame</code> .        , , ,   ,  ,  ,  ,  .       ,        .    ,     ,     ,     .        ,        ,      <code>DataFrame</code> ,   . <br><br>  ,             .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">pandas.read_csv()</a>   ,   . ,  <code>dtype</code>  ,   ,   ,   ,     â€”  NumPy. <br><br>      ,          ,   .         ,      . <br><br><pre> <code class="plaintext hljs">dtypes = optimized_gl.drop('date',axis=1).dtypes dtypes_col = dtypes.index dtypes_type = [i.name for i in dtypes.values] column_types = dict(zip(dtypes_col, dtypes_type)) #    161 ,  #  10  /   #     preview = first2pairs = {key:value for key,value in list(column_types.items())[:10]} import pprint pp = pp = pprint.PrettyPrinter(indent=4) pp.pprint(preview)     : {   'acquisition_info': 'category',   'h_caught_stealing': 'float32',   'h_player_1_name': 'category',   'h_player_9_name': 'category',   'v_assists': 'float32',   'v_first_catcher_interference': 'float32',   'v_grounded_into_double': 'float32',   'v_player_1_id': 'category',   'v_player_3_id': 'category',   'v_player_5_id': 'category'}</code> </pre> <br>          ,      ,    . <br><br>    - : <br><br><pre> <code class="plaintext hljs">read_and_optimized = pd.read_csv('game_logs.csv',dtype=column_types,parse_dates=['date'],infer_datetime_format=True) print(mem_usage(read_and_optimized)) read_and_optimized.head()</code> </pre> <br>       : <br><br> <code>104.28 MB</code> <br> <br>    ,     <code>   </code>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> . <br><br>  ,    <code>   </code>  <code>   </code> ,     ,  ,       .      pandas       861.6   104.28 ,     88% . <br><br><h2> <font color="#3AC1EF">  </font> </h2><br> ,  ,    ,     .     . <br><br><pre> <code class="plaintext hljs">optimized_gl['year'] = optimized_gl.date.dt.year games_per_day = optimized_gl.pivot_table(index='year',columns='day_of_week',values='date',aggfunc=len) games_per_day = games_per_day.divide(games_per_day.sum(axis=1),axis=0) ax = games_per_day.plot(kind='area',stacked='true') ax.legend(loc='upper right') ax.set_ylim(0,1) plt.show()</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b2/699/6a2/3b26996a26b73e9a3ce87f3ff22dcf34.png"></div><br> <i><font color="#999999">,    </font></i> <br><br>  ,  1920-      ,  ,    50 ,        . <br><br>  ,  ,    ,      50 ,   . <br><br>    ,      . <br><br><pre> <code class="plaintext hljs">game_lengths = optimized_gl.pivot_table(index='year', values='length_minutes') game_lengths.reset_index().plot.scatter('year','length_minutes') plt.show()</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a6d/6db/5d2/a6d6db5d2e6bdb7330ac8a0ff2a6febd.png"></div><br> <i><font color="#999999"> </font></i> <br><br>   ,   1940-         . <br><br><h2>  <font color="#3AC1EF">æ€»ç»“</font> </h2><br>            pandas,         ,     <code>DataFrame</code> ,   90%.       : <br><br><ul><li>       ,   ,   ,    , . </li><li>        . </li></ul><br>  ,            , ,         ,    ,  ,       pandas,    ,    . <br><br>  <b>äº²çˆ±çš„è¯»è€…ä»¬ï¼</b>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">eugene_bb</a> .    -  ,    â€”    . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN442516/">https://habr.com/ru/post/zh-CN442516/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN442504/index.html">PHP Xdebugä»£ç†ï¼šå½“Xdebugçš„æ ‡å‡†åŠŸèƒ½ä¸å¤Ÿç”¨æ—¶</a></li>
<li><a href="../zh-CN442506/index.html">ä¿„ç½—æ–¯æ˜¯å¦å› éæ³•äº¤æ˜“ä¸ªäººæ•°æ®è€Œå—åˆ°æƒ©ç½šï¼Ÿ</a></li>
<li><a href="../zh-CN442508/index.html">udalenkaå¦‚ä½•åŠ é€ŸGitLabçš„åˆ›æ–°</a></li>
<li><a href="../zh-CN442512/index.html">åœ¨ZomboDBçš„ç¤ºä¾‹ä¸Šè‡ªå®šä¹‰Django ORM</a></li>
<li><a href="../zh-CN442514/index.html">åˆ†å¸ƒå¼ç³»ç»Ÿã€‚ è®¾è®¡æ¨¡å¼ã€‚ ä¹¦è¯„</a></li>
<li><a href="../zh-CN442518/index.html">2018å¹´åå¤§ç½‘ç»œé»‘å®¢æŠ€æœ¯</a></li>
<li><a href="../zh-CN442520/index.html">æ¡ˆä¾‹ èŠ‚çœ30ä¸‡ç¾½ æ¯æœˆè¿›è¡Œå†…å®¹ç›¸å…³å¹¿å‘Š</a></li>
<li><a href="../zh-CN442522/index.html">ç›´è§‚çš„RLï¼ˆå¼ºåŒ–å­¦ä¹ ï¼‰ï¼šä¼˜åŠ¿æ¼”å‘˜å…³é”®è¯„è®ºï¼ˆA2Cï¼‰ç®€ä»‹</a></li>
<li><a href="../zh-CN442524/index.html">å¦‚ä½•æé«˜ä¸ªäººè¯†åˆ«å’Œè®¿é—®æ§åˆ¶ç³»ç»Ÿçš„å®‰å…¨æ€§</a></li>
<li><a href="../zh-CN442526/index.html">è‹è”ç›’å¼ç£å¸¦æ’­æ”¾å™¨çš„å†å²ï¼ˆç¬¬äºŒéƒ¨åˆ†ï¼‰ï¼šéšèº«å¬çš„çƒ­æ½®ï¼Œå…‹æ ¼å‹ƒçš„å°å·¥å…·å’Œå½•éŸ³æœº</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>