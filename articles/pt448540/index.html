<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õÖÔ∏è üë©üèø‚Äç‚öïÔ∏è ü§∞üèæ VMware NSX para o menor. Parte 5. Configurando o Balanceador de Carga ‚ö°Ô∏è üåå üë∂üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Parte I Introdut√≥rio 
 Parte Dois Configurar regras de firewall e NAT 
 Parte tr√™s. Configura√ß√£o DHCP 
 Parte Quatro Configura√ß√£o de roteamento 

 A √∫...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>VMware NSX para o menor. Parte 5. Configurando o Balanceador de Carga</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataline/blog/448540/"><img src="https://habrastorage.org/webt/cs/bv/4v/csbv4vf7zldwjd6etj65xyw309o.png"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte I</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Introdut√≥rio</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte Dois</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Configurar regras de firewall e NAT</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte tr√™s.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Configura√ß√£o DHCP</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte Quatro</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Configura√ß√£o de roteamento</a> <br><br>  A √∫ltima vez que falamos sobre os recursos do NSX Edge em termos de roteamento est√°tico e din√¢mico, e hoje trataremos do balanceador. <br><br>  Antes de prosseguir com a instala√ß√£o, gostaria de lembrar brevemente os principais tipos de balanceamento. <br><a name="habracut"></a><br><h3>  Teoria </h3><br>  Todas as solu√ß√µes atuais de balanceamento de carga √∫til costumam ser divididas em duas categorias: balanceamento no quarto (transporte) e s√©timo (aplicado) n√≠veis do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">modelo OSI</a> .  O modelo OSI n√£o √© o melhor ponto de refer√™ncia ao descrever m√©todos de balanceamento.  Por exemplo, se o balanceador L4 tamb√©m suportar a termina√ß√£o TLS, ele se tornar√° um balanceador L7?  Mas √© isso, √© isso. <br><br><ul><li>  <b>O balanceador L4</b> geralmente <b>√©</b> aquele que fica entre o cliente e o conjunto de back-end de proxy intermedi√°rio dispon√≠vel, que finaliza as conex√µes TCP (ou seja, responde independentemente ao SYN), seleciona um back-end e inicia uma nova sess√£o TCP em sua dire√ß√£o, enviando o pr√≥prio SYN.  Este tipo √© um dos b√°sicos, outras op√ß√µes s√£o poss√≠veis. </li><li>  <b>O balanceador L7</b> distribui o tr√°fego para os back-end dispon√≠veis "mais sofisticados" do que o balanceador L4.  Ele pode decidir sobre um back-end com base, por exemplo, no conte√∫do de uma mensagem HTTP (URL, cookie, etc.). </li></ul><br>  Independentemente do tipo, o balanceador pode suportar as seguintes fun√ß√µes: <br><br><ul><li>  A descoberta de servi√ßo √© o processo de determinar o conjunto de back-end dispon√≠veis (Est√°tico, DNS, Consul, Etcd etc.). </li><li>  Verificando a integridade dos back-ends detectados ("ping" ativo do back-end usando uma solicita√ß√£o HTTP, detec√ß√£o passiva de problemas nas conex√µes TCP, presen√ßa de v√°rios c√≥digos HTTP 503 nas respostas seguidas, etc.). </li><li>  Balanceamento pr√≥prio (round robin, sele√ß√£o aleat√≥ria, hash de IP de origem, URI). </li><li>  Termina√ß√£o TLS e verifica√ß√£o de certificado. </li><li>  Op√ß√µes relacionadas √† seguran√ßa (autentica√ß√£o, preven√ß√£o de ataques de DoS, limite de velocidade) e muito mais. </li></ul><br>  O NSX Edge oferece suporte para dois modos de implanta√ß√£o do balanceador: <br><br>  <b>Modo proxy ou com um bra√ßo</b> .  Nesse modo, ao enviar uma solicita√ß√£o para um dos back-end, o NSX Edge usa seu endere√ßo IP como endere√ßo de origem.  Portanto, o balanceador executa as fun√ß√µes NAT de origem e destino.  O back-end v√™ todo o tr√°fego como enviado do balanceador e responde diretamente a ele.  Nesse esquema, o balanceador deve estar no mesmo segmento de rede que os servidores internos. <br><br>  Aqui est√° como vai: <br><br><ol><li>  O usu√°rio envia uma solicita√ß√£o para o endere√ßo VIP (endere√ßo do balanceador) configurado no Edge. </li><li>  O Edge seleciona um dos back-end e executa o NAT de destino, substituindo o endere√ßo VIP pelo endere√ßo do back-end selecionado. </li><li>  O Edge executa o NAT de origem, substituindo o endere√ßo do usu√°rio que enviou a solicita√ß√£o pelo seu. </li><li>  O pacote √© enviado para o back-end selecionado. </li><li>  O back-end n√£o responde diretamente ao usu√°rio, mas o Edge, pois o endere√ßo original do usu√°rio foi alterado para o endere√ßo do balanceador. </li><li>  O Edge envia a resposta do servidor ao usu√°rio. </li></ol><br>  Esquema abaixo. <br><br><img src="https://habrastorage.org/webt/ta/jx/m5/tajxm5nceoc5z9oeea0_apjftvs.png"><br><br>  <b>Modo transparente ou embutido.</b>  Nesse cen√°rio, o balanceador possui interfaces na rede interna e externa.  No entanto, n√£o h√° acesso direto √† rede interna a partir do externo.  O balanceador de carga interno atua como um gateway NAT para m√°quinas virtuais na rede interna. <br><br>  O mecanismo √© o seguinte: <br><br><ol><li>  O usu√°rio envia uma solicita√ß√£o para o endere√ßo VIP (endere√ßo do balanceador) configurado no Edge. </li><li>  O Edge seleciona um dos back-end e executa o NAT de destino, substituindo o endere√ßo VIP pelo endere√ßo do back-end selecionado. </li><li>  O pacote √© enviado para o back-end selecionado. </li><li>  O back-end recebe uma solicita√ß√£o com o endere√ßo original do usu√°rio (o NAT de origem n√£o foi executado) e responde diretamente a ele. </li><li>  O tr√°fego √© novamente aceito pelo balanceador de carga, pois no esquema embutido geralmente atua como o gateway padr√£o para o farm de servidores. </li><li>  O Edge executa o NAT de origem para enviar tr√°fego ao usu√°rio, usando seu VIP como o endere√ßo IP de origem. </li></ol><br>  Esquema abaixo. <br><br><img src="https://habrastorage.org/webt/w0/su/z0/w0suz0nii_gq5r4qcmibzge0zja.png"><br><br><h3>  Pr√°tica </h3><br>  Na minha mesa de teste, est√£o configurados 3 servidores com Apache, os quais est√£o configurados para funcionar em HTTPS.  O Edge equilibrar√° as solicita√ß√µes HTTPS usando o m√©todo round robin, fazendo proxy de cada nova solicita√ß√£o para um novo servidor. <br><br>  Vamos come√ßar. <br><br><h4>  Gerando um certificado SSL que usar√° o NSX Edge </h4><br>  Voc√™ pode importar um certificado CA v√°lido ou usar um certificado autoassinado.  Neste teste, usarei autoassinado. <br><br><ol><li>  Na interface do vCloud Director, acesse as configura√ß√µes de servi√ßos de Borda. <br><br><img src="https://habrastorage.org/webt/i-/dq/th/i-dqthihewvxbuenqctf75z02nw.png"></li><li>  V√° para a guia Certificados.  Na lista de a√ß√µes, selecione a adi√ß√£o de um novo CSR. <br><br><img src="https://habrastorage.org/webt/zw/jz/zy/zwjzzymdjpgwylcdi93pus7wmrk.png"></li><li>  Preencha os campos obrigat√≥rios e clique em Manter. <br><br><img src="https://habrastorage.org/webt/c6/bj/zo/c6bjzodgmz0yepyhwdy00_dhoqg.png"></li><li>  Selecione o CSR rec√©m-criado e selecione a op√ß√£o CSR de autoassinatura. <br><br><img src="https://habrastorage.org/webt/z2/2k/sg/z22ksgjo22tjo1dpgfr-gvutbhu.png"></li><li>  Selecione o per√≠odo de validade do certificado e clique em Manter <br><br><img src="https://habrastorage.org/webt/nl/wh/1w/nlwh1wu3amwefnuies4jxj0tiry.png"></li><li>  Um certificado autoassinado apareceu na lista de dispon√≠veis. <br><br><img src="https://habrastorage.org/webt/r9/u5/1q/r9u51qb5gt-rsf0ysyzx4byeezg.png"></li></ol><br><h4>  Configurar perfil de aplicativo </h4><br>  Os perfis de aplicativos oferecem mais controle sobre o tr√°fego da rede e tornam o gerenciamento simples e eficiente.  Com a ajuda deles, voc√™ pode determinar o comportamento para tipos espec√≠ficos de tr√°fego. <br><br><ol><li>  V√° para a guia Load Balancer e ligue o balancer.  A op√ß√£o Acelera√ß√£o ativada aqui permite que o balanceador use um balanceamento L4 mais r√°pido em vez de L7. <br><br><img src="https://habrastorage.org/webt/tr/gy/vb/trgyvbidsrd3xyyh-g6gis9igms.png"></li><li>  V√° para a guia Perfil do aplicativo para definir o perfil do aplicativo.  Clique em +. <br><br><img src="https://habrastorage.org/webt/nm/ng/aq/nmngaqjer2nwulb1mtrqttk0s0u.png"></li><li>  Defina o nome do perfil e selecione o tipo de tr√°fego ao qual o perfil ser√° aplicado.  Vou explicar alguns par√¢metros. <br><br>  <b>Persist√™ncia</b> - salva e rastreia os dados da sess√£o, por exemplo: qual servidor espec√≠fico do pool est√° atendendo a uma solicita√ß√£o do usu√°rio.  Isso garante que as solicita√ß√µes do usu√°rio sejam enviadas ao mesmo membro do pool durante toda a vida √∫til da sess√£o ou das sess√µes subseq√ºentes. <br><br>  <b>Ativar passagem SSL</b> - quando essa op√ß√£o √© selecionada, o NSX Edge para de encerrar o SSL.  Em vez disso, a finaliza√ß√£o ocorre diretamente nos servidores para os quais o balanceamento √© realizado. <br><br>  <b>Inserir cabe√ßalho HTTP X-Forwarded-For</b> - permite determinar o endere√ßo IP de origem do cliente que est√° se conectando ao servidor da Web por meio do balanceador. <br><br>  <b>Ativar SSL do lado do pool</b> - permite especificar que o pool selecionado consiste em servidores HTTPS. <br><br><img src="https://habrastorage.org/webt/ah/bm/i9/ahbmi974xepvaiwrqwtxy4uio6u.png"></li><li>  Como equilibrarei o tr√°fego HTTPS, preciso ativar o SSL do lado do pool e selecionar o certificado gerado anteriormente na guia Certificados do servidor virtual -&gt; guia Certificado de servi√ßo. <br><br><img src="https://habrastorage.org/webt/w2/ij/jn/w2ijjndohiaackavyj05iwjudpg.png"></li><li>  Da mesma forma para certificados de pool -&gt; certificado de servi√ßo. <br><br><img src="https://habrastorage.org/webt/hn/5j/sy/hn5jsy5-tnudpfdcpome_wqwu0i.png"></li></ol><br><h4>  Criamos um pool de servidores, o tr√°fego no qual os pools ser√£o equilibrados </h4><br><ol><li>  V√° para a guia Pools.  Clique em +. <br><br><img src="https://habrastorage.org/webt/1x/2c/e-/1x2ce--4asvoflplvlaiklfukhc.png"></li><li>  Defina o nome do pool, selecione o algoritmo (usarei round robin) e o tipo de monitoramento para a verifica√ß√£o de sa√∫de do back-end.A op√ß√£o Transparente indica se os clientes IP de origem iniciais est√£o vis√≠veis para os servidores internos. <br><br><ul><li>  Se essa op√ß√£o estiver desativada, o tr√°fego para servidores internos ser√° proveniente do IP de origem do balanceador. <br></li><li>  Se essa op√ß√£o estiver ativada, os servidores internos ver√£o os clientes IP de origem.  Nessa configura√ß√£o, o NSX Edge deve atuar como o gateway padr√£o para garantir que os pacotes retornados passem pelo NSX Edge. </li></ul><br>  O NSX suporta os seguintes algoritmos de balanceamento: <br><br><ul><li>  <b>IP_HASH</b> - sele√ß√£o de servidor com base nos resultados da fun√ß√£o hash para o IP de origem e destino de cada pacote. </li><li>  <b>LEASTCONN</b> - balanceamento de conex√µes de entrada, dependendo do n√∫mero de j√° dispon√≠veis em um servidor espec√≠fico.  Novas conex√µes ser√£o direcionadas ao servidor com o menor n√∫mero de conex√µes. </li><li>  <b>ROUND_ROBIN</b> - novas conex√µes s√£o enviadas para cada servidor por vez, de acordo com o peso especificado. </li><li>  <b>URI</b> - a parte esquerda do URI (antes do ponto de interroga√ß√£o) √© dividida em hash e dividida pelo peso total dos servidores no pool.  O resultado indica qual servidor recebe a solicita√ß√£o, garantindo que ela sempre seja roteada para o mesmo servidor, desde que todos os servidores permane√ßam dispon√≠veis. </li><li>  <b>HTTPHEADER</b> - balanceamento com base em um cabe√ßalho HTTP espec√≠fico, que pode ser especificado como um par√¢metro.  Se o cabe√ßalho estiver ausente ou n√£o tiver nenhum significado, o algoritmo ROUND_ROBIN ser√° usado. </li><li>  <b>URL</b> - cada solicita√ß√£o HTTP GET procura o par√¢metro URL especificado como argumento.  Se o par√¢metro for seguido por um sinal de igual e um valor, o valor ser√° hash e dividido pelo peso total dos servidores em execu√ß√£o.  O resultado indica qual servidor recebe a solicita√ß√£o.  Esse processo √© usado para rastrear identificadores de usu√°rios em solicita√ß√µes e para garantir que o mesmo ID de usu√°rio seja sempre enviado ao mesmo servidor, desde que todos os servidores permane√ßam dispon√≠veis. </li></ul><br><img src="https://habrastorage.org/webt/ru/a-/w1/rua-w1fjpzumfbu92ujeakfw0hm.png"></li><li>  No bloco Membros, clique em + para adicionar servidores ao pool. <br><br><img src="https://habrastorage.org/webt/qd/io/cf/qdiocfo-f-kjw6aot0q9ekbd37i.png"><br><br>  Aqui voc√™ precisa especificar: <br><br><ul><li>  nome do servidor </li><li>  Endere√ßo IP do servidor; </li><li>  a porta para a qual o servidor receber√° tr√°fego; </li><li>  porta para verifica√ß√£o de integridade (Monitor de verifica√ß√£o de sa√∫de); </li><li>  Peso - com esse par√¢metro, voc√™ pode ajustar a quantidade proporcional de tr√°fego recebido para um membro espec√≠fico do pool; </li><li>  Max Connections - o n√∫mero m√°ximo de conex√µes com o servidor; </li><li>  Conex√µes m√≠nimas - o n√∫mero m√≠nimo de conex√µes que o servidor deve processar antes que o tr√°fego seja redirecionado para o pr√≥ximo membro do pool. </li></ul><br><img src="https://habrastorage.org/webt/wi/re/hv/wirehvt2ivslsykeopxoeuvrhky.png"><br><br>  √â assim que parece o pool final de tr√™s servidores. <br><br><img src="https://habrastorage.org/webt/u1/t1/xs/u1t1xsnzgp9-zs4odzuklgark30.png"></li></ol><br><h4>  Adicionar servidor virtual </h4><br><ol><li>  V√° para a guia Servidores Virtuais.  Clique em +. <br><br><img src="https://habrastorage.org/webt/k5/pt/j0/k5ptj0t6ziwg25ec17vcjntpgzm.png"></li><li>  Ativamos o servidor virtual usando Ativar servidor virtual. <br><br>  Atribu√≠mos um nome a ele, selecione o Perfil de Aplicativo, Pool criado anteriormente e especifique o endere√ßo IP para o qual o Servidor Virtual aceitar√° solicita√ß√µes externas.  Especifique o protocolo HTTPS e a porta 443. <br>  Par√¢metros opcionais aqui: <br><br>  <b>Limite de conex√£o</b> - o n√∫mero m√°ximo de conex√µes simult√¢neas que um servidor virtual pode manipular; <br>  <b>Limite da taxa de conex√£o (CPS)</b> - O n√∫mero m√°ximo de novas solicita√ß√µes recebidas por segundo. <br><br><img src="https://habrastorage.org/webt/xa/rp/xu/xarpxupxblhb_tt0qsatlfn5b-m.png"></li></ol><br><br>  Isso completa a configura√ß√£o do balanceador, voc√™ pode verificar seu desempenho.  Os servidores t√™m a configura√ß√£o mais simples, o que permite entender qual servidor do pool processou a solicita√ß√£o.  Durante a instala√ß√£o, selecionamos o algoritmo de balanceamento Round Robin, e o par√¢metro Weight para cada servidor √© igual a um, portanto, cada pr√≥xima solicita√ß√£o ser√° processada pelo pr√≥ximo servidor do pool. <br><br>  Digite o endere√ßo externo do balanceador no navegador e consulte: <br><br><img src="https://habrastorage.org/webt/nt/he/7u/nthe7uim5gmdqb9odzyub_hdkeq.png"><br><br>  Ap√≥s atualizar a p√°gina, a solicita√ß√£o ser√° processada pelo seguinte servidor: <br><br><img src="https://habrastorage.org/webt/ke/d1/xf/ked1xfdi_nmdye9ci5nswvgzjaq.png"><br><br>  E novamente - para verificar o terceiro servidor da piscina: <br><br><img src="https://habrastorage.org/webt/nu/uo/8u/nuuo8uvhb1dq2tozx2nrtjwfo68.png"><br><br>  Ao verificar, voc√™ pode ver que o certificado que o Edge nos envia √© o mesmo que geramos desde o in√≠cio. <br><br>  Verifique o status do balanceador no console do gateway Edge.  Para fazer isso, insira <b>show service loadbalancer pool</b> . <br><br><img src="https://habrastorage.org/webt/ba/_6/jq/ba_6jqyhlyemoguhvwshmhgabbq.png"><br><br><h4>  Configure o Service Monitor para verificar o status dos servidores no pool </h4><br>  Usando o Service Monitor, podemos monitorar o status dos servidores no pool de back-end.  Se a resposta √† solicita√ß√£o n√£o corresponder ao esperado, o servidor poder√° ser retirado do pool para n√£o receber novas solicita√ß√µes. <br><br>  Por padr√£o, tr√™s m√©todos de verifica√ß√£o est√£o configurados: <br><br><ul><li>  Monitor TCP </li><li>  Monitor HTTP </li><li>  Monitor HTTPS. </li></ul><br>  Crie um novo. <br><br><ol><li>  V√° para a guia Monitoramento de Servi√ßo, clique em +. <br><br><img src="https://habrastorage.org/webt/i_/ca/e4/i_cae4kdihjj0ewts1v1d-yeeog.png"></li><li>  Escolha: <br><br><ul><li>  nome para o novo m√©todo; </li><li>  intervalo no qual as solicita√ß√µes ser√£o enviadas, </li><li>  tempo limite de resposta </li><li>  o tipo de monitoramento √© uma solicita√ß√£o HTTPS usando o m√©todo GET, o c√≥digo de status esperado √© 200 (OK) e o URL da solicita√ß√£o. </li></ul></li><li>  Isso completa a configura√ß√£o do novo Monitor de Servi√ßo, agora podemos us√°-lo ao criar um pool. <br><br><img src="https://habrastorage.org/webt/by/vj/ea/byvjea2dm23pabgtmueiedehzhq.png"></li></ol><br><h4>  Configurar regras de aplicativo </h4><br>  Regras de aplica√ß√£o √© uma maneira de manipular o tr√°fego com base em gatilhos espec√≠ficos.  Usando essa ferramenta, podemos criar regras avan√ßadas de balanceamento de carga, que podem n√£o ser poss√≠veis de serem configuradas por meio de perfis de aplicativos ou usando outros servi√ßos dispon√≠veis no Edge Gateway. <br><br><ol><li>  Para criar uma regra, v√° para a guia Regras do Aplicativo do balanceador. <br><br><img src="https://habrastorage.org/webt/lc/ff/uw/lcffuwfhhtf6nn1emi7_e-3cjdu.png"></li><li>  Escolha um nome, um script que usar√° a regra e clique em Manter. <br><br><img src="https://habrastorage.org/webt/1y/a-/o0/1ya-o0rss2uga8gzuasij20yd70.png"></li><li>  Ap√≥s a regra ser criada, precisamos editar o servidor virtual j√° configurado. <br><br><img src="https://habrastorage.org/webt/xg/ha/jf/xghajfs-6ntwycerfn_nun0wvlq.png"></li><li>  Na guia Avan√ßado, adicione a regra que criamos. <br><br><img src="https://habrastorage.org/webt/le/zv/vs/lezvvste4xmuvdzj4l8jrp5trbq.png"></li></ol><br><br>  No exemplo acima, inclu√≠mos o suporte ao tlsv1. <br><br>  Mais alguns exemplos: <br><br>  Redirecione o tr√°fego para outro pool. <br><br>  Com esse script, podemos redirecionar o tr√°fego para outro pool de balanceamento se o pool principal n√£o funcionar.  Para que a regra funcione, v√°rios conjuntos devem ser configurados no balanceador e todos os membros do conjunto principal devem estar no estado inativo.  Especifique o nome do pool, n√£o seu ID. <br><br><pre><code class="plaintext hljs">acl pool_down nbsrv(PRIMARY_POOL_NAME) eq 0 use_backend SECONDARY_POOL_NAME if PRIMARY_POOL_NAME</code> </pre> <br>  Redirecione o tr√°fego para um recurso externo. <br><br>  Aqui, redirecionamos o tr√°fego para um site externo se todos os membros do pool principal estiverem no estado inativo. <br><br><pre> <code class="plaintext hljs">acl pool_down nbsrv(NAME_OF_POOL) eq 0 redirect location http://www.example.com if pool_down</code> </pre> <br>  Mais exemplos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br>  Isso √© tudo sobre o balanceador.  Se voc√™ tiver alguma d√∫vida, pergunte, estou pronto para responder. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt448540/">https://habr.com/ru/post/pt448540/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt448530/index.html">Como o Megafone dormiu em assinaturas m√≥veis</a></li>
<li><a href="../pt448532/index.html">Centro de Dados Espaciais. Resumindo o experimento</a></li>
<li><a href="../pt448534/index.html">Por que precisamos de comutadores industriais com EMC aprimorado?</a></li>
<li><a href="../pt448536/index.html">Transpar√™ncia - Panac√©ia dos Butcherts</a></li>
<li><a href="../pt448538/index.html">Crie uma solu√ß√£o de failover baseada na arquitetura Oracle RAC e AccelStor Shared-Nothing</a></li>
<li><a href="../pt448546/index.html">Tamanhos autom√°ticos de cabe√ßalho e rodap√© do UITableView com AutoLayout</a></li>
<li><a href="../pt448548/index.html">Constru√ß√£o na arte: de Brueghel a Vasya Lozhkin</a></li>
<li><a href="../pt448550/index.html">Inaugura√ß√£o do Concurso de Reportagens no #PAYMENTSECURITY 2019</a></li>
<li><a href="../pt448552/index.html">ProLiant Series 100 - O irm√£o mais novo perdido</a></li>
<li><a href="../pt448558/index.html">√â poss√≠vel renderizar imagens realistas sem n√∫meros de ponto flutuante?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>