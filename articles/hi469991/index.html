<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯд╕ЁЯП╝ ЁЯЦия╕П ЁЯСиЁЯП╝тАНЁЯН│ рд╣рдо RabbitMQ рдФрд░ TypeScript рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдСрдирд▓рд╛рдЗрди рд╕реНрдЯреЛрд░ рд╕реЗ рдСрд░реНрдбрд░ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рддреЗ рд╣реИрдВ ЁЯХЙя╕П ЁЯСЭ ЁЯПА</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╕рднреА рдХреЛ рдирдорд╕реНрдХрд╛рд░! рдЗрдВрдЯрд░рдиреЗрдЯ рд╡рд╛рдгрд┐рдЬреНрдп рдХреА рд▓реЛрдХрдкреНрд░рд┐рдпрддрд╛ рд▓рдЧрд╛рддрд╛рд░ рдмрдврд╝ рд░рд╣реА рд╣реИ, рдЬреИрд╕рд╛ рдХрд┐ рд╡реНрдпрд╛рдкрд╛рд░ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреА рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рдЕрдиреМрдкрдЪрд╛рд░рд┐рдХрдХрд░рдг рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИред рдЗрд╕рдХ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рд╣рдо RabbitMQ рдФрд░ TypeScript рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдСрдирд▓рд╛рдЗрди рд╕реНрдЯреЛрд░ рд╕реЗ рдСрд░реНрдбрд░ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рддреЗ рд╣реИрдВ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/469991/"><p><img src="https://habrastorage.org/webt/wh/2y/cv/wh2ycv5atat_nuru35jo5pwfo08.jpeg"></p><br><p>  рд╕рднреА рдХреЛ рдирдорд╕реНрдХрд╛рд░!  рдЗрдВрдЯрд░рдиреЗрдЯ рд╡рд╛рдгрд┐рдЬреНрдп рдХреА рд▓реЛрдХрдкреНрд░рд┐рдпрддрд╛ рд▓рдЧрд╛рддрд╛рд░ рдмрдврд╝ рд░рд╣реА рд╣реИ, рдЬреИрд╕рд╛ рдХрд┐ рд╡реНрдпрд╛рдкрд╛рд░ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреА рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рдЕрдиреМрдкрдЪрд╛рд░рд┐рдХрдХрд░рдг рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИред  рдЗрд╕рдХреЗ рд╕рд╛рде рд╣реА рд╕реВрдЪрдирд╛ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреА рдЬрдЯрд┐рд▓рддрд╛ рдмрдврд╝ рд░рд╣реА рд╣реИред  рдСрдирд▓рд╛рдЗрди рд╕реНрдЯреЛрд░ рдХреЗ рдЧреНрд░рд╛рд╣рдХ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдкреНрд░рддреНрдпреЗрдХ рдСрд░реНрдбрд░ рд╡рд┐рднрд┐рдиреНрди рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд╕рд╛рде рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдПрдХреАрдХрд░рдг рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИред  рдРрд╕реА рд╕реЗрд╡рд╛рдУрдВ рдореЗрдВ рднреБрдЧрддрд╛рди рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг, рд╡рд┐рддрд░рдг, рд▓реЗрдЦрд╛рдВрдХрди рдФрд░ рд╡рдлрд╛рджрд╛рд░реА рд╕реЗрд╡рд╛рдПрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛ рд╕рдХрддреА рд╣реИрдВред  рдкреНрд░рддреНрдпреЗрдХ рдЖрджреЗрд╢ рдХрд╛ рднреБрдЧрддрд╛рди, рд░рд┐рдХреЙрд░реНрдб, рдЗрдХрдЯреНрдард╛ рдФрд░ рд╡рд┐рддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдФрд░ рдЖрдЧреЗ рдХреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЗ рд▓рд┐рдП рднреА рдЙрдкрд▓рдмреНрдз рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред  рдпрд╣ рдФрд░ рдЗрд╕рд▓рд┐рдП рдПрдХ рд╕рд╛рдзрд╛рд░рдг рд╕реНрдерд┐рддрд┐ рдирд╣реАрдВ рд╣реИ, рдЗрд╕ рддрдереНрдп рд╕реЗ рдЬрдЯрд┐рд▓ рд╣реИ рдХрд┐ рдПрдХ рдСрдирд▓рд╛рдЗрди рд╕реНрдЯреЛрд░ рдХрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдСрд░реНрдбрд░ рджреЗрддреЗ рд╕рдордп рдХрд┐рд╕реА рдЪреАрдЬ рдХреЗ рд▓рд┐рдП рд▓рдВрдмреЗ рд╕рдордп рддрдХ рдФрд░ рджрд░реНрджрдирд╛рдХ рд░реВрдк рд╕реЗ рдЗрдВрддрдЬрд╛рд░ рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИред  рдСрдирд▓рд╛рдЗрди рд╕реНрдЯреЛрд░ рд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рддреНрд╡рд░рд┐рдд рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП, рдХреНрдпреЛрдВрдХрд┐ рджреЗрд░реА рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдорд┐рд▓реАрд╕реЗрдХрдВрдб рд╕реЗ рдЧреНрд░рд╛рд╣рдХ рдХреЛ рдЦреЛрдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдмрдврд╝ рдЬрд╛рддреА рд╣реИ, рдФрд░ рдмрд╛рдж рдореЗрдВ рд▓рд╛рдн рд╣реЛрддрд╛ рд╣реИред  рдЗрд╕ рдЖрд▓реЗрдЦ рдореЗрдВ рдореИрдВ RabbitMQ рд╕рдВрджреЗрд╢ рдмреНрд░реЛрдХрд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдВ рдФрд░ рдЗрд╕реЗ рдХреИрд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИ рддрд╛рдХрд┐ рдСрд░реНрдбрд░ рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдХреЛ Node.js рдФрд░ рдЯрд╛рдЗрдкрд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред  рдмрд┐рд▓реНрд▓реА рдХреЗ рд▓рд┐рдП рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИред </p><a name="habracut"></a><br><h2 id="neobhodimaya-teoriya">  рдЖрд╡рд╢реНрдпрдХ рд╕рд┐рджреНрдзрд╛рдВрдд </h2><br><p>  рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдХрдИ рд▓реЛрдЧреЛрдВ рдиреЗ RabbitMQ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реБрдирд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕ рд╕рдВрджреЗрд╢ рдмреНрд░реЛрдХрд░ рдХрд╛ рдкрд╣рд▓рд╛ рдУрдкрди рд╕реЛрд░реНрд╕ рд╕рдВрд╕реНрдХрд░рдг, AMQP рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ, рдЬреЛ рдкрд╣рд▓реЗ рд╣реА 2007 рдореЗрдВ рдЬрд╛рд░реА рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рдПрдХ рд╕рдВрджреЗрд╢ рдмреНрд░реЛрдХрд░ рдХреЛ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд╡рд┐рднрд┐рдиреНрди рдШрдЯрдХреЛрдВ рдХреЛ рдПрдХ рдкреВрд░реЗ рдореЗрдВ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЯреВрдЯреА рд╣реБрдИ рдлреВрд▓рджрд╛рди рдХреЛ рдлрд┐рд░ рд╕реЗ рдЬреАрд╡рдВрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЧреЛрдВрдж рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рд╕рдВрджреЗрд╢ рдмреНрд░реЛрдХрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдЖрдк рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рдШрдЯрдирд╛рдУрдВ рдХреЗ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдпрд╣ рд╕рд┐рд░реНрдл рдПрдХ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдСрд░реНрдбрд░ рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рд╣реИ рдЬреЛ рдСрдирд▓рд╛рдЗрди рд╕реНрдЯреЛрд░ рдХреЛ рдЪрд╛рд╣рд┐рдПред  рд▓реЗрдХрд┐рди рдкрд╣рд▓реЗ рдЖрдкрдХреЛ RabbitMQ рдХреЗ рдмреБрдирд┐рдпрд╛рджреА рдШрдЯрдХреЛрдВ рдХреЛ рд╕рдордЭрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЗрд╕ рдмреНрд░реЛрдХрд░ рдХреЗ рддреАрди рдореБрдЦреНрдп рдШрдЯрдХ рд╣реИрдВ рдЬрд┐рдирдХреЗ рд╕рд╛рде рд╣рдо рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдВрдЧреЗ: </p><br><ul><li>  <strong>рд╕рдВрджреЗрд╢ред</strong>  рдпрд╣ рд╕рдВрджреЗрд╢ рдмреНрд░реЛрдХрд░ рдФрд░ рд╣рдорд╛рд░реА рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рд╕реЗрд╡рд╛ рдХреЗ рднреАрддрд░ рд╕реВрдЪрдирд╛ рдХреА рд╕рдмрд╕реЗ рдЫреЛрдЯреА рдЗрдХрд╛рдИ рд╣реИ рдЬрд┐рд╕реЗ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  RabbitMQ рд╕реНрд╡рдпрдВ рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рдмрд╛рдЗрдирд░реА рд░реВрдк рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдорд╛рд░реЗ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд▓рд┐рдП рдФрд░ рд▓реЗрдЦ рдХреЗ рд▓рд┐рдП рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдирд╣реАрдВ рд╣реИред  рд╣рдо JSON рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рдФрд░ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░реЗрдВрдЧреЗред  рдпрд╣ рднреА рдЙрд▓реНрд▓реЗрдЦрдиреАрдп рд╣реИ рдХрд┐ рд░реИрдмрд┐рдЯрдХреНрдпреВ рдореЗрдВ рд╕рдВрджреЗрд╢ рд╣реЗрдбрд░ рд╣реИрдВред  рд╡реЗ http рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рд╢реАрд░реНрд╖рдХреЛрдВ рдХреЗ рд╕рдорд╛рди рд╣реИрдВред  рдпрд╣ рдПрдХ рд╕рд╛рд╣рдЪрд░реНрдп рд╕рд░рдгреА рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЖрдк рдЖрд╡рд╢реНрдпрдХ рдЬрд╛рдирдХрд╛рд░реА рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВред </li><li>  <strong>рд╕рдВрджреЗрд╢ рдХреА рдХрддрд╛рд░</strong> ред  рдпрд╣ рд╡рд╣ рдХрддрд╛рд░ рд╣реИ рдЬрд┐рд╕рдореЗрдВ RabbitMQ рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИред  рдПрдХ рд╕рдВрджреЗрд╢ рдХрддрд╛рд░ рдПрдХ рдпрд╛ рдЕрдзрд┐рдХ рдЙрдкрднреЛрдХреНрддрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рд╕рджрд╕реНрдпрддрд╛ рд▓реА рдЬрд╛ рд╕рдХрддреА рд╣реИред  рдЦрд░рдЧреЛрд╢ рдХрддрд╛рд░ рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рд╕рдВрджреЗрд╢ рдХреЛ рд░рд╛рдЙрдВрдб-рд░реЙрдмрд┐рди рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрдкрднреЛрдХреНрддрд╛рдУрдВ рдХреЛ рд╡рд┐рддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </li><li>  <strong>рдПрдХреНрд╕рдЪреЗрдВрдЬред</strong>  рдпрд╣, рдЬреИрд╕рд╛ рдХрд┐ рдирд╛рдо рд╕реЗ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ, рдПрдХ рд╡рд┐рдирд┐рдордп рдмрд┐рдВрджреБ рд╣реИред  рдХрддрд╛рд░ рдпрд╛ рдЕрдиреНрдп рдПрдХреНрд╕рдЪреЗрдВрдЬрд░реНрд╕ рдХреЛ рдЗрд╕ рдмрд┐рдВрджреБ рд╕реЗ рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдПрдХ рд╡рд┐рдирд┐рдордп рдмрд┐рдВрджреБ рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рдХрд╛ рдореБрдЦреНрдп рдХрд╛рд░реНрдп рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рдПрдХ рдпрд╛ рдХрдИ рдХрддрд╛рд░реЛрдВ, рдпрд╛ рдПрдХ рд╣реА рд╡рд┐рдирд┐рдордп рдмрд┐рдВрджреБрдУрдВ рдкрд░ рд░реВрдЯ рдХрд░рдирд╛ рд╣реИред  рдкреНрд░рддреНрдпреЗрдХ рдХрддрд╛рд░ рдпрд╛ рдПрдХреНрд╕рдЪреЗрдВрдЬрд░ рдПрдХ рд░реВрдЯрд┐рдВрдЧ рдХреБрдВрдЬреА рджреНрд╡рд╛рд░рд╛ рдмрд╛рдзреНрдп рд╣реИред  RabMMQ рдореЗрдВ рдХрдИ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдкреНрд░рдХрд╛рд░ рдХреЗ рдПрдХреНрд╕рдЪреЗрдВрдЬрд░реНрд╕ рд╣реИрдВ рдЬреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдХреИрд╕реЗ рдПрдХреНрд╕рдЪреЗрдВрдЬ рдЗрд╕рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рд╕рдВрджреЗрд╢ рдХреЛ рд░реВрдЯ рдХрд░реЗрдЧрд╛ред </li></ul><br><p>  рдпрд╣ рд╡рд░реНрдгрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреЗ рдПрдХреНрд╕рдЪреЗрдВрдЬрд░реНрд╕ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рдпрд╣ рд╕рдордЭрдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдХрд┐ рд░реВрдЯрд┐рдВрдЧ рдХреБрдВрдЬреА рдХреНрдпрд╛ рд╣реИрдВред  рд░реВрдЯрд┐рдВрдЧ рдХреБрдВрдЬреА рджреЛрдиреЛрдВ рдХрддрд╛рд░ рд╕реЗ рдПрдХреНрд╕рдЪреЗрдВрдЬрд░ рддрдХ рдФрд░ рд╕рдВрджреЗрд╢ рдореЗрдВ рд╣реА рд╣реЛрддреА рд╣реИред  <strong>рд░реВрдЯрд┐рдВрдЧ рдХреБрдВрдЬреА</strong> рдмрд╕ рдПрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╣реИ рдЬрд┐рд╕реЗ рдмреНрд▓реЙрдХреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдкреНрд░рддреНрдпреЗрдХ рдмреНрд▓реЙрдХ рдХреЛ рдПрдХ рдмрд┐рдВрджреА рджреНрд╡рд╛рд░рд╛ рдЕрд▓рдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, "inform.sendEmail.sendSms"ред  рдЙрд╕реА рд╕рдордп, рд╡рд┐рд╢реЗрд╖ рд╡рд░реНрдг # рдФрд░ * рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдВрджреЗрд╢ рдорд╛рд░реНрдЧ рдХреБрдВрдЬреА рдХреЗ рд▓рд┐рдП рдкреИрдЯрд░реНрди рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  * - рдХрд╣рддреЗ рд╣реИрдВ рдХрд┐ рдПрдХ рдмрд┐рдВрджреБ рдХреЗ рдмрд╛рдж рдХреЛрдИ рднреА рдмреНрд▓реЙрдХ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди # рдмреНрд▓реЙрдХ рдХреЗ рдмрд╛рдж рдХреЛрдИ рднреА рдирдВрдмрд░ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, "inform.sendSmsред *" рдпрд╛ "рд╕реВрдЪрд┐рдд рдХрд░реЗрдВред #"ред  рдЕрдм рдЖрдк рд╡рд┐рдирд┐рдордп рдмрд┐рдВрджреБрдУрдВ рдХреЗ рдкреНрд░рдХрд╛рд░реЛрдВ рдкрд░ рдЖрдЧреЗ рдмрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдПрдХреНрд╕рдЪреЗрдВрдЬрд░реНрд╕ рдХреЗ рдЪрд╛рд░ рдкреНрд░рдХрд╛рд░ рд╣реИрдВ: </p><br><ul><li>  <strong>рдлреИрдирдЖрдЙрдЯред</strong>  рдЗрд╕ рдПрдХреНрд╕рдЪреЗрдВрдЬ рдХрд╛ рд░реВрдЯрд┐рдВрдЧ рд▓реЙрдЬрд┐рдХ рд╕рд░рд▓ рд╣реИ; рдпрд╣ рдПрдХ рдЖрдиреЗ рд╡рд╛рд▓реЗ рд╕рдВрджреЗрд╢ рдХреЛ рд╕рднреА рдХрддрд╛рд░реЛрдВ рдпрд╛ рдПрдХреНрд╕рдЪреЗрдВрдЬреЛрдВ рд╕реЗ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЗрд╕рд╕реЗ рдЬреБрдбрд╝реЗ рд╣реЛрддреЗ рд╣реИрдВред </li></ul><br><p><img src="https://habrastorage.org/webt/iw/f5/ib/iwf5ibz1b-6-qqhby_z_kqope9e.png"></p><br><ul><li>  <strong>рдкреНрд░рддреНрдпрдХреНрд╖ред</strong>  рдпрд╣ рд╡рд┐рдирд┐рдордп рд╕рдВрджреЗрд╢ рдХреЛ рдЗрд╕ рдЖрдзрд╛рд░ рдкрд░ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рд╕рдВрджреЗрд╢ рдХреА рд░реВрдЯрд┐рдВрдЧ рдХреБрдВрдЬреА рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рдХреА рд░реВрдЯрд┐рдВрдЧ рдХреБрдВрдЬреА рд╕реЗ рдореЗрд▓ рдЦрд╛рддреА рд╣реИ рдпрд╛ рдирд╣реАрдВред </li></ul><br><p><img src="https://habrastorage.org/webt/vu/pm/ia/vupmiavbtemxaxoecqcuklmpvqe.png"></p><br><ul><li>  <strong>рд╡рд┐рд╖рдпред</strong>  рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХрд╛ рдЖрджрд╛рди-рдкреНрд░рджрд╛рди рдФрд░ рд╕рд╛рде рд╣реА рд╕рдВрджреЗрд╢ рд░реВрдЯ рд░реВрдЯ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдПрдХ рдкреИрдЯрд░реНрди рдПрдХ рд░реВрдЯрд┐рдВрдЧ рдХреБрдВрдЬреА рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░ рд╕рдХрддрд╛ рд╣реИред </li></ul><br><p><img src="https://habrastorage.org/webt/yz/h4/ug/yzh4ug3abx7ywf9ex-bei3k20oe.png"></p><br><ul><li>  <strong>рдореБрдЦрд┐рдпрд╛</strong> ред  рдпрд╣ рдПрдХреНрд╕рдЪреЗрдВрдЬ, рджреВрд╕рд░реЛрдВ рдХреЗ рд╡рд┐рдкрд░реАрдд, рд░реВрдЯрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рд╕рдВрджреЗрд╢ рд╣реЗрдбрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред  рдЙрд╕реА рд╕рдордп, рдПрдХреНрд╕рдЪреЗрдВрдЬрд░реНрд╕ рдХреА рдХрддрд╛рд░реЗрдВ рднреА рдПрдХ рд╕рд╛рд╣рдЪрд░реНрдп рд╕рд░рдгреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрд╛рдзреНрдп рд╣реЛрддреА рд╣реИрдВред  рд╡рд╣ рддрд░реНрдХ рдЬрд┐рд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ рдПрдХреНрд╕рдЪреЗрдВрдЬрд░ рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рд░реВрдЯ рдХрд░реЗрдЧрд╛ рд╡рд┐рд╢реЗрд╖ "x-match" рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрджрд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рд╕рд╛рд╣рдЪрд░реНрдп рдмрдВрдзрди рд╕рд░рдгреА рдореЗрдВ рд╕реЗрдЯ рд╣реИред  рдХреБрдВрдЬреА рдХреЛ рд╕рднреА рдпрд╛ рдХрд┐рд╕реА рднреА рджреЛ рдорд╛рдиреЛрдВ рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдпрджрд┐ рдорд╛рди рд╕рднреА рд╣реИ, рддреЛ рд╕рдВрджреЗрд╢ рд╣реЗрдбрд░ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рд╛рд╣рдЪрд░реНрдп рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рд╕рд░рдгреА рд╕реЗ рдореЗрд▓ рдЦрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП; рдпрджрд┐ рдорд╛рди рдХрд┐рд╕реА рднреА рд╣реИ, рддреЛ рдорд╛рди рдХрдо рд╕реЗ рдХрдо рдПрдХ рдХреБрдВрдЬреА рд╕реЗ рдореЗрд▓ рдЦрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </li></ul><br><p><img src="https://habrastorage.org/webt/gq/pd/gm/gqpdgmxxipjwviioorrzouqdj0o.png"></p><br><p>  рдпреЗ RabbitMQ рдХреЗ рдореБрдЦреНрдп рдШрдЯрдХ рд╣реИрдВред  рдЖрдк рдЗрди рдШрдЯрдХреЛрдВ рдХреЗ рдмрд╛рд░реЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдореЗрдВ рдПрдПрдордХреНрдпреВрдкреА рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╡рд┐рдирд┐рд░реНрджреЗрд╢</a> рдореЗрдВ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред  рдЗрд╕рдХреЗ рдмрд╛рдж, рд╣рдо рдПрдХ рдШрдЯрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдЯрд╛рдЗрдкрд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдСрд░реНрдбрд░ рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдбрд┐рдЬрд╝рд╛рдЗрди рдФрд░ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХрд░реЗрдВрдЧреЗ, рд╕рд╛рде рд╣реА рд╕рд╛рде рдкреНрд░рддреНрдпреЗрдХ рдШрдЯрдХ рдХреА рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЛ рд╕рдордЭреЗрдВрдЧреЗред </p><br><h2 id="proektirovanie">  рдбрд┐рдЬрд╝рд╛рдЗрди </h2><br><p>  рдЙрджрд╛рд╣рд░рдг рдХреЛ рд╕рд░рд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдорд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдСрдирд▓рд╛рдЗрди рдСрд░реНрдбрд░ рдХреЗ рд╕рдлрд▓ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП: </p><br><ul><li>  рдЖрдиреЗ рд╡рд╛рд▓реЗ рдЖрджреЗрд╢реЛрдВ рдХреЛ рд╕рд╣реЗрдЬреЗрдВ </li><li>  рдСрд░реНрдбрд░ рдирдВрдмрд░ рдХреЗ рд╕рд╛рде рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ рдПрд╕рдПрдордПрд╕ рднреЗрдЬреЗрдВ, рд╕рд╛рде рд╣реА рдСрд░реНрдбрд░ рдХреА рд╕реНрдерд┐рддрд┐ рднреА </li><li>  рдпрджрд┐ рд╣рдорд╛рд░реЗ рдЧреНрд░рд╛рд╣рдХ рдиреЗ рдЗрд╕ рд╡рд┐рддрд░рдг рд╡рд┐рдзрд┐ рдХреЛ рдЪреБрдирд╛ рд╣реИ, рддреЛ рд╣рдорд╛рд░реЗ рдСрдирд▓рд╛рдЗрди рд╕реНрдЯреЛрд░ рд╕реЗ рдПрдХ рдирдП рдСрд░реНрдбрд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреВрд░рд┐рдпрд░ рдбрд┐рд▓реАрд╡рд░реА рд╕реЗрд╡рд╛ рдХреЛ рд╕рдВрджреЗрд╢ рднреЗрдЬреЗрдВ </li></ul><br><p>  рд▓реЗрдХрд┐рди рдпрд╣ рдЗрд╕ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╣рдорд╛рд░реА рдСрдирд▓рд╛рдЗрди рд╕реНрдЯреЛрд░ рдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд░рдиреЗ рдФрд░ рднрд╡рд┐рд╖реНрдп рдореЗрдВ рдЕрдкрдиреЗ рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЛ рдФрд░ рдЕрдзрд┐рдХ рдЕрд╡рд╕рд░ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреА рдпреЛрдЬрдирд╛ рд╣реИ (рдФрд░ рдпрд╣ рд╣рдореЗрд╢рд╛ рд╣реЛрддрд╛ рд╣реИ)ред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдИрдореЗрд▓ рджреНрд╡рд╛рд░рд╛ рдЧреНрд░рд╛рд╣рдХ рдХреЛ рд╕реВрдЪрд┐рдд рдХрд░реЗрдВ рдпрд╛ рдСрд░реНрдбрд░ рдХреЗ рд▓рд┐рдП рдХрдИ рдбрд┐рд▓реАрд╡рд░реА рд╡рд┐рдзрд┐рдпреЛрдВ рдХрд╛ рд╡рд┐рдХрд▓реНрдк рдкреНрд░рджрд╛рди рдХрд░реЗрдВред  рдпрд╣ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИ рдХрд┐ рд╣рдореЗрдВ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдбрд┐рдЬрд╛рдЗрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдЬреЛрдбрд╝рдирд╛ рд╕рд░рд▓ рдерд╛ред </p><br><p>  рдпрд╣ рднреА рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ рдореИрдВ рд╕реНрдердЧрд┐рдд рд╕рдВрджреЗрд╢реЛрдВ рдХреЗ рд▓рд┐рдП рдЯреЗрдореНрдкрд▓реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реВрдВрдЧрд╛ рддрд╛рдХрд┐ рдпрд╣ рд╕рдВрднрд╡ рд╣реЛ, рдпрджрд┐ рдмрд╛рд╣рд░реА рд╕реЗрд╡рд╛ рдЕрдиреБрдкрд▓рдмреНрдз рд╣реИ, рддреЛ рдХрдИ рдмрд╛рд░ рддрд░реНрдХ рдХреЛ рджреЛрд╣рд░рд╛рдиреЗ рдХреЗ рд▓рд┐рдПред  рдЖрдк рдЗрд╕ рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдБ</a> рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">ред</a> </p><br><p>  рдЕрдВрддрд┐рдо рд▓рдХреНрд╖реНрдп рдХрд╛ рдЕрдзрд┐рдХ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдореИрдВ рдПрдХ рдЖрд░реЗрдЦ рдмрдирд╛рдКрдВрдЧрд╛ред </p><br><p><img src="https://habrastorage.org/webt/mu/bz/ji/mubzjikeu0b35eac4e_qj0rxdt4.png"></p><br><p>  рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рдЗрд╕ рдЖрд░реЗрдЦ рдкрд░ рдСрд░реНрдбрд░ рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддреА рд╣реИред  рдпреЛрдЬрдирд╛ рдХреЛ рдмреНрд▓реЙрдХреЛрдВ рдФрд░ рд╡рд┐рднрд┐рдиреНрди рд░рдВрдЧреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рд╕рдлреЗрдж рдмреНрд▓реЙрдХ рдмрд╛рд╣рд░реА рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рд╣рдо рд╡рд┐рдЪрд╛рд░ рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗред  рдЧреНрд░реЗ рдмреНрд▓реЙрдХ RabbitMQ рддрддреНрд╡реЛрдВ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддреЗ рд╣реИрдВред  рдХрддрд╛рд░реЛрдВ рдФрд░ рдПрдХреНрд╕рдЪреЗрдВрдЬреЛрдВред  рд╣рд░рд╛ рд░рдВрдЧ рд╡реНрдпрд╛рдкрд╛рд░ рддрд░реНрдХ рдХреЗ рдмреНрд▓реЙрдХ рдХреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдорд╛рд░реЗ рддрд░реНрдХ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдкреНрд░рддреНрдпреЗрдХ рдмреНрд▓реЙрдХ рдХреЛ рдЧрд┐рдирд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╕рдВрдЦреНрдпрд╛рдПрдБ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдФрд░ рдХреНрд░рдо рдореЗрдВ рдЙрдкрдкреНрд░рдХреНрд░рдо рджрд░реНрд╢рд╛рддреА рд╣реИрдВред </p><br><p>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, HTTP рдПрдкреАрдЖрдИ рд╕рдВрджреЗрд╢ рд╣рдорд╛рд░реА рд╕реЗрд╡рд╛ рдореЗрдВ рдЬрд╛рддрд╛ рд╣реИред  рдЙрд╕рдХреЗ рдмрд╛рдж, рд╣рдореЗрдВ рдСрд░реНрдбрд░ рдХреЛ рдПрдХ рдирдВрдмрд░ рдЕрд╕рд╛рдЗрди рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдСрд░реНрдбрд░ рдХреЛ "рдирдпрд╛" рдХреЗ рд╕рд╛рде рд╕реЗрд╡ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдСрд░реНрдбрд░ рдХреЗ рд╕рдлрд▓ рдирд┐рд░реНрдорд╛рдг рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рднреЗрдЬрдиреА рдЪрд╛рд╣рд┐рдП, рдЗрд╕рдХреЗ рдирдВрдмрд░ рдХреЗ рд╕рд╛рде, рдкреАрдЫреЗред  рдХреНрд▓рд╛рдЗрдВрдЯ, рдСрд░реНрдбрд░ рдХреЗ рд╕рдлрд▓ рдирд┐рд░реНрдорд╛рдг рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ, рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рд╡реНрдпрд╡рд╕рд╛рдп рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рддрд╛ рд╣реИред  рдПрдХ рд╕рдХрд╛рд░рд╛рддреНрдордХ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рднреЗрдЬрдХрд░, рд╣рдо рдСрд░реНрдбрд░ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдкреЛрд╕реНрдЯ-рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдПрдХреНрд╕рдЪреЗрдВрдЬ рдореЗрдВ рднреЗрдЬрддреЗ рд╣реИрдВ, рдЬрд╣рд╛рдВ рд╕реЗ рдпрд╣ рд░реВрдЯрд┐рдВрдЧ рдХреБрдВрдЬреА рдмрдирд╛рдиреЗ рд╡рд╛рд▓реЗ рдХрд░реНрдордЪрд╛рд░реА рдореЗрдВ рдЧрд┐рд░ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕ рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдХреЛ рдХрддрд╛рд░ рд╕реЗ рдСрд░реНрдбрд░ рдСрдмреНрдЬреЗрдХреНрдЯ рдорд┐рд▓рд╛ рд╣реИ, рдЗрд╕рдХреЗ рдЖрдзрд╛рд░ рдкрд░ (рдЪрд╛рд╣реЗ рдСрд░реНрдбрд░ рдореЗрдВ рдХреЛрдИ рдИрдореЗрд▓ рдпрд╛ рдЧреНрд░рд╛рд╣рдХ рдХрд╛ рдлреЛрди рд╣реЛ, рдЬрд┐рд╕реЗ рдбрд┐рд▓реАрд╡рд░реА рд╡рд┐рдзрд┐ рдЪреБрдирд╛ рдЧрдпрд╛ рдерд╛) рдХреЛ рдСрд░реНрдбрд░ рд░рд╛рдЙрдЯрд┐рдВрдЧ рдХреБрдВрдЬреА рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛ред  рд░реВрдЯрд┐рдВрдЧ рдХреБрдВрдЬреА рдмрдирд╛рдиреЗ рдХреЗ рдмрд╛рдж, рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдкреЛрд╕реНрдЯ-рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдПрдХреНрд╕рдЪреЗрдВрдЬ рдХреЛ рдПрдХ рд╕рдВрджреЗрд╢ рднреЗрдЬрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдм рдСрд░реНрдбрд░ рдХреА рд░реВрдЯрд┐рдВрдЧ рдХреБрдВрдЬреА рдмрджрд▓ рдЧрдИ рд╣реИ рдФрд░ рдПрдХреНрд╕рдЪреЗрдВрдЬрд░ рд╡рд╛рдВрдЫрд┐рдд рдорд╛рд░реНрдЧ рдкрд░ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рднреЗрдЬ рд╕рдХрддрд╛ рд╣реИред  рдХреБрдВрдЬреА рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдСрд░реНрдбрд░ рдХреЛ рдПрдХреНрд╕рдЪреЗрдВрдЬ рдХреЛ рднреЗрдЬрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рд╕реВрдЪрдирд╛рдУрдВ, рдПрдХреНрд╕рдЪреЗрдВрдЬ рдЗрдВрдЯреАрдЧреНрд░реЗрд╢рди рдпрд╛ рдПрдХ рд╕рд╛рде рджреЛрдиреЛрдВ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИред  рдФрд░ рдЖрдЧреЗ рдПрдХ рдХрддрд╛рд░ рдореЗрдВ рдПрдХ рд╣реА рддрд░реНрдХ рдФрд░ рдХрд╛рд░реНрдпрдХрд░реНрддрд╛рдУрдВ рдкрд░ред </p><br><p>  рдПрд╕рдПрдордПрд╕ рднреЗрдЬрдиреЗ рд╡рд╛рд▓реЗ рд╢реНрд░рдорд┐рдХ рдФрд░ рд╡рд┐рддрд░рдг рд╕реЗрд╡рд╛рдПрдВ рд╕рдВрджреЗрд╢ рдХреЛ рдХрдИ рдмрд╛рд░ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВрдЧреАред  рдЗрд╕ рддрд░рд╣ рдХреЗ рдкреНрд░рдпрд╛рд╕реЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдПрдХ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рдореЗрдВ рдкрд╛рд░рд┐рдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред  рд▓реЗрдХрд┐рди рдЖрдкрдХреЛ рд╕рдВрджреЗрд╢ рдХреЛ рдЕрдВрддрд╣реАрди рд░реВрдк рд╕реЗ рд╕рдВрд╕рд╛рдзрд┐рдд рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдХреНрдпреЛрдВрдХрд┐ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдпрд╛ рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдХреЗ рддрд░реНрдХ рдореЗрдВ рд╣реА рдирд┐рд╣рд┐рдд рд╣реЛ рд╕рдХрддреА рд╣реИред  рдЗрд╕рд▓рд┐рдП, рдЕрдиреБрдордд рдкреНрд░рдпрд╛рд╕реЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рд╕реЗ рдЕрдзрд┐рдХ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж, рд╕рдВрджреЗрд╢ рдХреЛ рдХрддрд╛рд░реЛрдВ рд╕реЗ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рддреНрд░реБрдЯрд┐ рд╕реНрдЯреЛрд░ рдореЗрдВ рднреЗрдЬ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЬрд╣рд╛рдВ рд╕реЗ рдЗрд╕реЗ рд╡рд╛рдВрдЫрд┐рдд рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рд╕реНрддрд░ рдкрд░ рд╡рд╛рдкрд╕ рднреЗрдЬрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p><br><h2 id="realizaciya">  рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди </h2><br><p>  рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЦрд░рдЧреЛрд╢ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред  рдореИрдВ рдЗрд╕ рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рд▓рд┐рдП рдбреЙрдХрдЯрд░ рдФрд░ рдПрдХ рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдмреНрд░реЛрдХрд░ рдЫрд╡рд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рджреЗрддрд╛ рд╣реВрдВред  рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде рдХрдВрдЯреЗрдирд░ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ рдФрд░ рдЪрд▓рд╛рдПрдВред </p><br><pre><code class="bash hljs">docker run -d --name rabbit -p 5672:5672 -e rabbitmq:3.7.15-management-alpine</code> </pre> <br><p>  рдпрд╣ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдбрд┐рдмрдЧрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдкреЛрд░реНрдЯ 15672 рдкрд░ рдЙрдкрд▓рдмреНрдз рд╡реЗрдм рдЗрдВрдЯрд░рдлреЗрд╕ рдХреЗ рд╕рд╛рде рдПрдХ рдЫрд╡рд┐ рд╣реИред </p><br><p>  рд╣рдо рдЯрд╛рдЗрдкрд╕реНрдХреНрд░рд┐рдкреНрдЯ рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдордХреНрд▓рд┐рдм</a> рд▓рд╛рдЗрдмреНрд░реЗрд░реА (Node.js рдХреЗ рд▓рд┐рдП RabbitMQ рдХреНрд▓рд╛рдЗрдВрдЯ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди) рдХреЗ рд╕рд╛рде рдЕрдкрдиреА рдпреЛрдЬрдирд╛рдУрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░реЗрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП рдПрдХ рд╢реБрд░реБрдЖрдд рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдХрдИ рдЗрдВрдЯрд░рдлреЗрд╕ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рд╣рдо рдСрд░реНрдбрд░ рдХреЗ рдЗрдВрдЯрд░рдлреЗрд╕ рдФрд░ рдЙрди рд╕рдВрджреЗрд╢реЛрдВ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рд╣рдо рдЦрд░рдЧреЛрд╢ рдХреЛ рднреЗрдЬреЗрдВрдЧреЗред </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//    export interface Product { id: string; name: string; price: number; } //    export interface Order { clientName: string; city: string; email?: string; phone?: string; products: Product[]; totalSum: number; deliveryAddress?: string; } //         export interface OrderWithPhone extends Order { phone: string; } //        export interface OrderWithDeliveryAddress extends Order { deliveryAddress: string; } // Types Guard'        export const isOrderWithPhone = (order: Order): order is OrderWithPhone =&gt; Boolean(order.phone); export const isOrderWithDeliveryAddress = (order: Order): order is OrderWithDeliveryAddress =&gt; Boolean(order.deliveryAddress); //    . export interface Message&lt;O extends Order&gt; { errors: string[]; retry: number; order: O; //         export interface FailOrder extends Message&lt;Order&gt; { exchange: string; routingKey: string; }</span></span></code> </pre> <br><p>  рдЕрдм рд╣рдореЗрдВ рдХрддрд╛рд░реЛрдВ рдФрд░ рдПрдХреНрд╕рдЪреЗрдВрдЬреЛрдВ рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╣рдо рдЦрд░рдЧреЛрд╢ рдореЗрдВ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдВрдЧреЗред </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Types, ExchangeTypes } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../constants'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Options } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'amqplib'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   RabbitMQ       export enum Types { QUEUE = 'queue', EXCHANGE = 'exchange', } //      export enum ExchangeTypes { TOPIC = 'topic', } //    export interface Queue { name: string; options: Options.AssertQueue; } //    export interface Exchange { name: string; type: ExchangeTypes; } //    export interface Binding { type: Types; destination: string; source: string; routingKey: string; } //   RabbitMQ export interface PipelineConfig { queues: Queue[]; exchanges: Exchange[]; bindings: Binding[]; }</span></span></code> </pre> <br><p>  рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдореБрдЦреНрдп рдШрдЯрдХреЛрдВ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдЙрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрд╛ рд╡рд░реНрдгрди рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рдСрдмреНрдЬреЗрдХреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрд░реЗрдЦ рдкрд░ рдЦреАрдВрдЪрд╛ рдЧрдпрд╛ рдерд╛ред </p><br><p>  рдХрддрд╛рд░ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> [ <span class="hljs-comment"><span class="hljs-comment">//        routingKey { name: 'generateRoutingKey', options: { durable: true, }, }, //   sms { name: 'sendSms', options: { durable: true, }, }, //      { name: 'delivery', options: { durable: true, }, }, //         sms { name: 'sendSmsHold', options: { durable: true, deadLetterExchange: 'notify', deadLetterRoutingKey: 'sendSms', messageTtl: 60000, }, }, //            { name: 'deliveryHold', options: { durable: true, deadLetterExchange: 'integrates', deadLetterRoutingKey: 'delivery', messageTtl: 60000, }, }, ];</span></span></code> </pre> <br><p>  рдХрддрд╛рд░реЛрдВ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рддреЗ рд╕рдордп, рдХрддрд╛рд░ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><ul><li>  <strong>рдЯрд┐рдХрд╛рдК</strong> ред  рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рд╕рднреА рдХрддрд╛рд░ рд╕рдВрджреЗрд╢ рдореЗрдореЛрд░реА рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреЗ рд╣реИрдВред  рдЗрд╕рд▓рд┐рдП, рдЬрдм рдмреНрд░реЛрдХрд░ рд░рд┐рдмреВрдЯ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╕рдВрджреЗрд╢ рдЧрд╛рдпрдм рд╣реЛ рдЬрд╛рдПрдВрдЧреЗред  рдЗрд╕рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдЗрд╕ рд╡рд┐рдХрд▓реНрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЗрд╕ рд╕реЗрдЯрд┐рдВрдЧ рдХреЗ рд╕рд╛рде, рдЦрд░рдЧреЛрд╢ рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рдбрд┐рд╕реНрдХ рдореЗрдВ рдлреНрд▓рд╢ рдХрд░ рджреЗрдЧрд╛ред  рд▓реЗрдХрд┐рди рдПрдХ рдХреИрд╡рд┐рдПрдЯ рд╣реИред  рдмреНрд░реЛрдХрд░ рдХреЗ рдкреБрдирд░рд╛рд░рдВрдн рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рд╕рд╣реЗрдЬреЗ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╕рдВрджреЗрд╢реЛрдВ рдХреЗ рд▓рд┐рдП, рдпрд╣ рд╕реЗрдЯрд┐рдВрдЧ рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИ, рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рд▓рдЧрд╛рддрд╛рд░ рд╡рд┐рдХрд▓реНрдк рдХреЗ рд╕рд╛рде рдХрддрд╛рд░ рдореЗрдВ рднреЗрдЬрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </li><li>  <strong>messageTtl</strong>  рд╕рдВрджреЗрд╢ рдЬреАрд╡рди рднрд░ред  рдорд┐рд▓реАрд╕реЗрдХрдВрдб рдореЗрдВ рджрд┐рдпрд╛ рдЧрдпрд╛ </li><li>  <strong>deadLetterExchange</strong> ред  рдПрдХреНрд╕рдЪреЗрдВрдЬрд░ рдХрд╛ рдирд╛рдо рдЬрд╣рд╛рдВ рд╕рдВрджреЗрд╢ рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рдкрд░ рдХрддрд╛рд░ рд╕реЗ рднреЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛ </li><li>  <strong>deadLetterRoutingKey</strong> ред  RoutingKey рдЬрд┐рд╕рдХреЗ рд╕рд╛рде рдкрд┐рдЫрд▓реЗ рд╡рд┐рдХрд▓реНрдк рд╕реЗ рдПрдХреНрд╕рдЪреЗрдВрдЬ рдХреЛ рд╕рдВрджреЗрд╢ рднреЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛ </li></ul><br><p>  рдПрдХреНрд╕рдЪреЗрдВрдЬреЛрдВ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ExchangeTypes } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../constants'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> [ { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'postprocessing'</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: ExchangeTypes.TOPIC, }, { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'notify'</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: ExchangeTypes.TOPIC, }, { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'integrates'</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: ExchangeTypes.TOPIC, }, ];</code> </pre> <br><p>  рдмрд╛рдЗрдВрдбрд┐рдВрдЧ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Types } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../constants'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> [ { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: Types.EXCHANGE, <span class="hljs-attr"><span class="hljs-attr">destination</span></span>: <span class="hljs-string"><span class="hljs-string">'notify'</span></span>, <span class="hljs-attr"><span class="hljs-attr">source</span></span>: <span class="hljs-string"><span class="hljs-string">'postprocessing'</span></span>, <span class="hljs-attr"><span class="hljs-attr">routingKey</span></span>: <span class="hljs-string"><span class="hljs-string">'#.notify.#'</span></span>, }, { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: Types.EXCHANGE, <span class="hljs-attr"><span class="hljs-attr">destination</span></span>: <span class="hljs-string"><span class="hljs-string">'integrates'</span></span>, <span class="hljs-attr"><span class="hljs-attr">source</span></span>: <span class="hljs-string"><span class="hljs-string">'postprocessing'</span></span>, <span class="hljs-attr"><span class="hljs-attr">routingKey</span></span>: <span class="hljs-string"><span class="hljs-string">'#.integrates.#'</span></span>, }, { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: Types.QUEUE, <span class="hljs-attr"><span class="hljs-attr">destination</span></span>: <span class="hljs-string"><span class="hljs-string">'generateRoutingKey'</span></span>, <span class="hljs-attr"><span class="hljs-attr">source</span></span>: <span class="hljs-string"><span class="hljs-string">'postprocessing'</span></span>, <span class="hljs-attr"><span class="hljs-attr">routingKey</span></span>: <span class="hljs-string"><span class="hljs-string">'generateRoutingKey'</span></span>, }, { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: Types.QUEUE, <span class="hljs-attr"><span class="hljs-attr">destination</span></span>: <span class="hljs-string"><span class="hljs-string">'sendSms'</span></span>, <span class="hljs-attr"><span class="hljs-attr">source</span></span>: <span class="hljs-string"><span class="hljs-string">'notify'</span></span>, <span class="hljs-attr"><span class="hljs-attr">routingKey</span></span>: <span class="hljs-string"><span class="hljs-string">'#.sendSms.#'</span></span>, }, { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: Types.QUEUE, <span class="hljs-attr"><span class="hljs-attr">destination</span></span>: <span class="hljs-string"><span class="hljs-string">'delivery'</span></span>, <span class="hljs-attr"><span class="hljs-attr">source</span></span>: <span class="hljs-string"><span class="hljs-string">'integrates'</span></span>, <span class="hljs-attr"><span class="hljs-attr">routingKey</span></span>: <span class="hljs-string"><span class="hljs-string">'#.delivery.#'</span></span>, }, { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: Types.QUEUE, <span class="hljs-attr"><span class="hljs-attr">destination</span></span>: <span class="hljs-string"><span class="hljs-string">'sendSmsHold'</span></span>, <span class="hljs-attr"><span class="hljs-attr">source</span></span>: <span class="hljs-string"><span class="hljs-string">'notify'</span></span>, <span class="hljs-attr"><span class="hljs-attr">routingKey</span></span>: <span class="hljs-string"><span class="hljs-string">'sendSmsHold'</span></span>, }, { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: Types.QUEUE, <span class="hljs-attr"><span class="hljs-attr">destination</span></span>: <span class="hljs-string"><span class="hljs-string">'deliveryHold'</span></span>, <span class="hljs-attr"><span class="hljs-attr">source</span></span>: <span class="hljs-string"><span class="hljs-string">'integrates'</span></span>, <span class="hljs-attr"><span class="hljs-attr">routingKey</span></span>: <span class="hljs-string"><span class="hljs-string">'deliveryHold'</span></span>, }, ];</code> </pre> <br><p>  рдкреВрд░реНрдг рд╡рд┐рдиреНрдпрд╛рд╕ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { PipelineConfig } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../interfaces'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> exchanges <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./exchanges'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> queues <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./queues'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> bindings <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./bindigs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pipelineConfig: PipelineConfig = { exchanges, queues, bindings, };</code> </pre> <br><p>  рдЦрд░рдЧреЛрд╢ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдПрдХ рд╡рд░реНрдЧ рд▓рд┐рдЦреЗрдВред </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { connect, Connection, Channel } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'amqplib'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RabbitConnect</span></span></span><span class="hljs-class"> </span></span>{ private _uri: string; private _connection: Connection; private _chanel: Channel; <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-comment"><span class="hljs-comment">//    rabbit     this._uri = process.env.RABBIT_URI || 'amqp://localhost'; } protected async connect() { this._connection = await connect(this._uri); this._chanel = await this._connection.createChannel(); } protected async disconnect() { await this._chanel.close(); return this._connection.close(); } protected get chanel() { return this._chanel; } }</span></span></code> </pre> <br><p>  рдЖрдЗрдП, рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреНрд▓рд╛рд╕ рд▓рд┐рдЦреЗрдВ, рдЬреЛ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдкрд░ рдкрд╣рд▓реЗ рд╡рд░реНрдгрд┐рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдЦрд░рдЧреЛрд╢ рдореЗрдВ рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рдмреБрдирд┐рдпрд╛рджреА рдврд╛рдВрдЪреЗ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдЧрд╛ред </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { RabbitConnect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./RabbitConnect'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { PipelineConfig } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./interfaces'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Types } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./constants'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pipeline</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RabbitConnect</span></span></span><span class="hljs-class"> </span></span>{ private _pipeline: PipelineConfig; <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(pipelineConfig: PipelineConfig) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._pipeline = pipelineConfig; } public <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> create() { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.connect(); <span class="hljs-comment"><span class="hljs-comment">//   const createQueues = this._pipeline.queues.map(queue =&gt; this.chanel.assertQueue(queue.name, queue.options), ) as PromiseLike&lt;any&gt;[]; //   const createExchanges = this._pipeline.exchanges.map(exchange =&gt; this.chanel.assertExchange(exchange.name, exchange.type), ) as PromiseLike&lt;any&gt;[]; await Promise.all([...createQueues, ...createExchanges]); //       const createBindings = this._pipeline.bindings.map(binding =&gt; { if (binding.type === Types.QUEUE) { return this.chanel.bindQueue(binding.destination, binding.source, binding.routingKey); } return this.chanel.bindExchange(binding.destination, binding.source, binding.routingKey); }); await Promise.all(createBindings); return this.disconnect(); } catch (error) { console.error(error); throw new Error(error); } } }</span></span></code> </pre> <br><p>  рдЕрдм рд╣рдо рд╕рднреА рд╢реНрд░рдорд┐рдХреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдХрд╛рд░реНрдпрд╢реАрд▓рддрд╛ рдХреЗ рд╕рд╛рде рдПрдХ рдЕрдореВрд░реНрдд рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рд╡рд░реНрдЧ рд▓рд┐рдЦреЗрдВрдЧреЗ, рдЬрд┐рд╕рдореЗрдВ рд╕реЗ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдпрд╣ рд╕рдВрднрд╡ рд╣реЛрдЧрд╛ред </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { RabbitConnect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./RabbitConnect'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Message, Order, FailOrder } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./interfaces'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ConsumeMessage } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'amqplib'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface WorkerParams { maxRetry?: number; <span class="hljs-comment"><span class="hljs-comment">//     active: string; //    exchange: string; //       holdKey?: string; //      } export abstract class Worker&lt;M extends Order&gt; extends RabbitConnect { private _maxRetry: number; private _active: string; private _holdKey: string | undefined; protected exchange: string; private _currentMessage: Message&lt;M&gt;; private _currentConsumeMessage: ConsumeMessage; constructor({ active, holdKey, exchange, maxRetry }: WorkerParams) { super(); this._maxRetry = maxRetry || 0; this._active = active; this._holdKey = holdKey; this.exchange = exchange; } public async subscribe() { await this.connect(); this.chanel.consume(this._active, this.checkMessage.bind(this)); } //          private async checkMessage(message: ConsumeMessage) { this._currentConsumeMessage = message; const orderMessage: Message&lt;M&gt; = JSON.parse(message.content.toString()); if (orderMessage.retry &gt;= this._maxRetry) { await this.sendToErrorStorage('  '); } this._currentMessage = orderMessage; //           await this.handler(orderMessage.order || orderMessage); } //       protected async sendToErrorStorage(error: string) { const message: FailOrder = { order: this._currentMessage.order, errors: [...this._currentMessage.errors, error], retry: this._currentMessage.retry + 1, exchange: this.exchange, routingKey: this._active }; console.log('   ', message); this.ack(); } //       protected async hold(error: string) { if (!this._holdKey) { return; } const orderMessage = { order: this._currentMessage.order, errors: [...this._currentMessage.errors, error], retry: this._currentMessage.retry + 1, }; const orderData = Buffer.from(JSON.stringify(orderMessage)); return this.chanel.publish(this.exchange, this._holdKey, orderData); } //      protected async ack() { return this.chanel.ack(this._currentConsumeMessage); } protected abstract handler(message: M): void; }</span></span></code> </pre> <br><p>  рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдЦрд░рдЧреЛрд╢ рдХреЛ рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рд╕реЗ рдПрдХ рд╕рдлрд▓ рд╕рдВрджреЗрд╢ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреА рдкреБрд╖реНрдЯрд┐ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдЗрд╕рдХреЗ рд▓рд┐рдП, рдХрдиреЗрдХреНрд╢рди рдЪреИрдирд▓ рдореЗрдВ рдПрдХ рдРрдХ рд╡рд┐рдзрд┐ рд╣реИред  рдпрджрд┐ рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рд╕рдВрджреЗрд╢ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рдЕрд╕рдорд░реНрде рдерд╛, рддреЛ рдПрдХ рд╢реВрдиреНрдп рд╡рд┐рдзрд┐ рд╣реИ рдЬреЛ рдЦрд░рдЧреЛрд╢ рдХреЛ рд╕рдВрджреЗрд╢ рдХреЛ рджреВрд╕рд░реЗ рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдХреЛ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣рддреА рд╣реИред </p><br><p>  рдЕрдм рд╣рдо рдЖрд░реЗрдЦ рд╕реЗ рдХреБрдЫ рд╕рд░рд▓ рд╢реНрд░рдорд┐рдХреЛрдВ рдХреЛ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдПрдХ рд░реВрдЯрд┐рдВрдЧ рдХреБрдВрдЬреА рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ред </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Worker } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../Worker'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { isOrderWithPhone, isOrderWithDeliveryAddress, Order, Message, } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../interfaces'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Keys } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../constants'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GenerateRoutingKey</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Worker</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Order</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>({ <span class="hljs-attr"><span class="hljs-attr">active</span></span>: <span class="hljs-string"><span class="hljs-string">'generateRoutingKey'</span></span>, <span class="hljs-attr"><span class="hljs-attr">exchange</span></span>: <span class="hljs-string"><span class="hljs-string">'postprocessing'</span></span>, }); } protected <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> handler(order: Order) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> routingKey: string[] = []; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isOrderWithPhone(order)) { routingKey.push(Keys.SEND_SMS); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isOrderWithDeliveryAddress(order)) { routingKey.push(Keys.SEND_TO_DELIVERY); } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> message: Message&lt;Order&gt; = { <span class="hljs-attr"><span class="hljs-attr">retry</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">errors</span></span>: [], order, }; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.chanel.publish( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.exchange, routingKey.join(<span class="hljs-string"><span class="hljs-string">'.'</span></span>), Buffer.from(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(message)), ); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ack(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (error) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(error); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.sendToErrorStorage(error); } } }</code> </pre> <br><p>  рдПрд╕рдПрдордПрд╕ рднреЗрдЬрдиреЗ рд╡рд╛рд▓реЗ рдордЬрджреВрд░ред </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Worker } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../Worker'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { OrderWithPhone } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../interfaces'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SendSms</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Worker</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OrderWithPhone</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>({ <span class="hljs-attr"><span class="hljs-attr">active</span></span>: <span class="hljs-string"><span class="hljs-string">'sendSms'</span></span>, <span class="hljs-attr"><span class="hljs-attr">exchange</span></span>: <span class="hljs-string"><span class="hljs-string">'notify'</span></span>, <span class="hljs-attr"><span class="hljs-attr">holdKey</span></span>: <span class="hljs-string"><span class="hljs-string">'sendSmsHold'</span></span>, <span class="hljs-attr"><span class="hljs-attr">maxRetry</span></span>: process.env.MAX_RETRY ? <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(process.env.MAX_RETRY) : <span class="hljs-number"><span class="hljs-number">5</span></span>, }); } protected <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> handler(message: OrderWithPhone) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">' sms  : '</span></span>, message.phone); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ack(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (error) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(error); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hold(error); } } }</code> </pre> <br><p>  рд╡рд┐рддрд░рдг рд╕реЗрд╡рд╛ рдХреЗ рд╕рд╛рде рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдПрдХреАрдХрд░рдгред </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Worker } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../Worker'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { OrderWithDeliveryAddress } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../interfaces'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Delivery</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Worker</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OrderWithDeliveryAddress</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>({ <span class="hljs-attr"><span class="hljs-attr">active</span></span>: <span class="hljs-string"><span class="hljs-string">'delivery'</span></span>, <span class="hljs-attr"><span class="hljs-attr">exchange</span></span>: <span class="hljs-string"><span class="hljs-string">'interates'</span></span>, <span class="hljs-attr"><span class="hljs-attr">holdKey</span></span>: <span class="hljs-string"><span class="hljs-string">'deliveryHold'</span></span>, <span class="hljs-attr"><span class="hljs-attr">maxRetry</span></span>: process.env.MAX_RETRY ? <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(process.env.MAX_RETRY) : <span class="hljs-number"><span class="hljs-number">5</span></span>, }); } protected <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> handler(message: OrderWithDeliveryAddress) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'      : '</span></span>, message.deliveryAddress); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ack(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (error) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(error); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hold(error); } } }</code> </pre> <br><p>  рдЖрд╡реЗрджрди рдХреЗ рд▓рд┐рдП рдкреНрд░рд╡реЗрд╢ рдмрд┐рдВрджреБред </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Pipeline } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Pipeline'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { pipelineConfig } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./pipeline'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { GenerateRoutingKey } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./workers/GenerateRoutingKey'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { SendSms } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./workers/SendSms'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Delivery } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./workers/Delivery'</span></span>; <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">async</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pipeline = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pipeline(pipelineConfig); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> generateRoutingKey = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GenerateRoutingKey(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> sendSms = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SendSms(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> delivery = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Delivery(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> pipeline.create(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.all([generateRoutingKey.subscribe(), sendSms.subscribe(), delivery.subscribe()]); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (error) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(error); process.exit(<span class="hljs-number"><span class="hljs-number">1</span></span>); } })();</code> </pre> <br><p>  рдореИрдВ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЛ рдСрд░реНрдбрд░ рд▓рд┐рдЦрдиреЗ рдФрд░ рдЗрдВрдЯрд░рдиреЗрдЯ рдСрд░реНрдбрд░ рдирдВрдмрд░ рдЬрдирд░реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдХреЛрдб рдХреНрд▓рд╛рд╕ рдХрд╛ рдЙрджрд╛рд╣рд░рдг рдирд╣реАрдВ рджреВрдВрдЧрд╛ред  рдпрд╣ рдЗрд╕ рд▓реЗрдЦ рдХреЗ рджрд╛рдпрд░реЗ рд╕реЗ рдкрд░реЗ рд╣реИред  рдХреЛрдб рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдПрдХреНрд╕рдЪреЗрдВрдЬ рдкреЙрд╕рд░рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдХреЛ рдСрд░реНрдбрд░ рдЬрд╕рди рднреЗрдЬрдХрд░ рдЦрд░рдЧреЛрд╢ рд╡реЗрдм рдЗрдВрдЯрд░рдлреЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><h2 id="zaklyuchenie">  рдирд┐рд╖реНрдХрд░реНрд╖ </h2><br><p>  рдСрдирд▓рд╛рдЗрди рдСрд░реНрдбрд░ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рддрд░рд╣ рдХреА рдПрдХ рдирд┐рд░реНрдорд╛рдг рдпреЛрдЬрдирд╛ рдкреНрд░рдгрд╛рд▓реА рдХреЛ рд╕реНрдХреЗрд▓ рдХрд░рдирд╛ рдЖрд╕рд╛рди рдмрдирд╛рддреА рд╣реИред  рдЖрд╡рд╢реНрдпрдХ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рдпреЛрдЬрдирд╛ рдореЗрдВ рдХрдИ рдХрддрд╛рд░реЛрдВ рдФрд░ рд╢реНрд░рдорд┐рдХреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдирд╛ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдореБрд╢реНрдХрд┐рд▓ рдирд╣реАрдВ рд╣реЛрдЧрд╛ред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рдИрдореЗрд▓ рджреНрд╡рд╛рд░рд╛ рд╕реВрдЪрдирд╛рдПрдВ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ 1 рд╕реА рдореЗрдВ рд▓реЗрдЦрд╛рдВрдХрди рдХреЗ рд▓рд┐рдП рдПрдХ рдЖрджреЗрд╢ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВред  рдкрд░рд┐рд╡рд░реНрддрд┐рдд рд╕рд░реНрдХрд┐рдЯ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦреЗрдЧрд╛: </p><br><p><img src="https://habrastorage.org/webt/id/rt/7j/idrt7j5jx9zmzcma6axa3st7-nq.png"></p><br><p>  рдореБрдЭреЗ рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рд▓реЗрдЦ рдкрд╕рдВрдж рдЖрдпрд╛ рд╣реЛрдЧрд╛ред  рдореБрдЭреЗ рдХрд┐рд╕реА рднреА рдЯрд┐рдкреНрдкрдгреА рдФрд░ рдЖрд▓реЛрдЪрдирд╛ рдкрд░ рдЦреБрд╢реА рд╣реЛрдЧреАред  рд╕рднреА рдкреНрд░рд╕реНрддреБрдд рдХреЛрдб <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЬреАрдердм рдкрд░ рдкрд╛рдП</a> рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi469991/">https://habr.com/ru/post/hi469991/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi469977/index.html">рдХреИрд╕реЗ рддреАрди рд╕рд╣рдкрд╛рдареА рдмрдиреЗ рдлреЗрд╕рдмреБрдХ рдХреЗ рд╕рд╛рдереА - рд░реЗрд╡рд▓реЗрдмреЛрдЯ рдХрд╣рд╛рдиреА</a></li>
<li><a href="../hi469979/index.html">рджреВрд╕рд░реЗ рдЖрдИрдУрдПрд╕ рдорд╛рдЗрдЯреИрдк рд░реЗрдбрдорд╛рдбреНрд░реЛрдмреЛрдЯ рд╕реЗ рд░рд┐рдкреЛрд░реНрдЯ рдХрд╛ рд░рд┐рдХреЙрд░реНрдб</a></li>
<li><a href="../hi469981/index.html">рдЪреИрдЯ рдмреЙрдЯ рдХреЗ рдЕрдВрджрд░ рдХреНрдпрд╛ рд╣реИ?</a></li>
<li><a href="../hi469985/index.html">рдЕрдиреБрдХреВрд▓рди рдХреЗ рдмрд┐рдирд╛ Redd рд╕рд┐рдВрдереЗрд╕рд╛рдЗрдЬреНрдб рдкреНрд░реЛрд╕реЗрд╕рд░ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдореЗрдВ рддреЗрдЬреА рд▓рд╛рдирд╛: рдПрдХ рдШрдбрд╝реА рдХреА рдЬрдЧрд╣</a></li>
<li><a href="../hi469987/index.html">рджреБрдирд┐рдпрд╛ рднрд░ рд╕реЗ рд╢реАрд░реНрд╖ 20 рдорд╛рд░реНрдХреЗрдЯрдкреНрд▓реЗрд╕ рдбреЗрд╡рд▓рдкрдореЗрдВрдЯ рдХрдВрдкрдирд┐рдпрд╛рдВ</a></li>
<li><a href="../hi469995/index.html">рдЕрдЬрдЧрд░ SAX рдкрд╛рд░реНрд╕рд░ рдмрдирд╛рдо рдЕрдЬрдЧрд░ рдбреЛрдо рдкрд╛рд░реНрд╕рд░ред рдкрд╛рд░рд╕рд┐рдо FIAS- рдордХрд╛рди</a></li>
<li><a href="../hi469997/index.html">рдзреНрдпрд╛рди рдЖрдХрд░реНрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рдХреНрдпрд╛ рд╣реИ рдпрд╛ рд╣реИрдмрд░рд╣реИрдм рд╡рд┐рд╢реНрд▓реЗрд╖рдг</a></li>
<li><a href="../hi469999/index.html">рд╕рд░реНрд╡рд░ рдПрдХ-рджреВрд╕рд░реЗ рдХреЗ рд╕рд╛рде рдХреИрд╕реЗ рдмрд╛рддрдЪреАрдд рдХрд░рддреЗ рд╣реИрдВ: рд░рдлрд╝ рдиреЗ рдЖрдо рд╕рд╣рдорддрд┐ рдПрд▓реНрдЧреЛрд░рд┐рдердо рд╡рд┐рддрд░рд┐рдд рдХрд┐рдпрд╛</a></li>
<li><a href="../hi470001/index.html">рд▓рд┐рдирдХреНрд╕ рдЯрд┐рдкреНрд╕ рдПрдВрдб рдЯреНрд░рд┐рдХреНрд╕: рд╕рд░реНрд╡рд░, рдУрдкрди</a></li>
<li><a href="../hi470003/index.html">рдПрдл # 1: рд╣реИрд▓реЛ рд╡рд░реНрд▓реНрдб</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>