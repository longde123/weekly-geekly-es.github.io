<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>憋  锔 M贸dulos Laurent y Smart Home (Parte 1). Mayordomo   叼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quiero llamar su atenci贸n sobre una serie de art铆culos sobre los m贸dulos de control Laurent de KernelChip . En esta serie, le contar茅 sobre c贸mo integ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>M贸dulos Laurent y Smart Home (Parte 1). Mayordomo</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/384485/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quiero llamar su atenci贸n sobre una serie de art铆culos sobre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">los</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> m贸dulos de control Laurent </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">de KernelChip</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">En esta serie, le contar茅 sobre c贸mo integrar estos m贸dulos en su Smart Home, c贸mo aprender a administrarlos desde el popular </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sistema de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> automatizaci贸n del hogar </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">MajorDoMo</font></a><font style="vertical-align: inherit;"> , desde bocetos de Arduino, desde el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sistema Arduino Mega Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e incluso c贸mo usar estos m贸dulos para un prop贸sito completamente inesperado, para ense帽ando a tus hijos a programar en Processing. </font></font><br>
<br>
<img src="https://habrastorage.org/files/915/0cb/0cb/9150cb0cbde940e588d1badce05af5bb.jpg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En general, los m贸dulos que son bastante interesantes en s铆 mismos pueden ser inesperadamente muy 煤tiles en los hogares si los aborda con cierta imaginaci贸n y creatividad.</font></font><br>
<a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驴Por qu茅 Laurent?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Debido a que estos m贸dulos han funcionado con 茅xito en mi sistema Smart Home durante mucho tiempo (m谩s de tres a帽os) y he adquirido cierta experiencia en su uso y tengo algo que contar sobre ellos. </font><font style="vertical-align: inherit;">Y tambi茅n tengo algo de experiencia y un c贸digo probado y listo para administrar estos m贸dulos, que quiero compartir con ustedes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y podr谩 desarrollar sus soluciones de software basadas en este c贸digo, ser谩 bastante simple, porque ya he hecho la mayor parte del trabajo. </font><font style="vertical-align: inherit;">Adem谩s, el c贸digo se explicar谩 en detalle, lo que sin duda contribuye a su comprensi贸n de c贸mo funciona, aprender a programar y construir sistemas dom茅sticos inteligentes.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M贸dulos en s铆</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando eleg铆 una soluci贸n ya preparada para administrar las cargas el茅ctricas a trav茅s de la red, Laurent me soborn贸 con la integridad y simplicidad de la soluci贸n. Para comenzar a controlar los dispositivos de encendido y apagado de la red y la iluminaci贸n, no se necesitaba casi nada. No fue necesario aprender el lenguaje de programaci贸n, no fue necesario soldar nada, fue suficiente para conectar el m贸dulo a la red local, conectar la carga a los terminales del rel茅 (y no olvidar aplicar energ铆a al m贸dulo en s铆) y eso fue todo. Despu茅s de eso, fue posible enviar comandos directamente desde la computadora (desde el programa del terminal). El m贸dulo inmediatamente comenz贸 a encender y apagar obedientemente la luz de acuerdo con mis 贸rdenes. En ese momento, no necesitaba m谩s.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puedo decir acerca de los m贸dulos en s铆 mismos que durante todo el per铆odo de operaci贸n no hubo fallas ni bloqueos, todo funcion贸 y funciona "como un reloj", que, de hecho, se requiere de dichos m贸dulos para que simplemente funcione.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dise帽o y calidad de construcci贸n.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Basta con mirar el m贸dulo para dejar en claro que fue desarrollado por una raz贸n, "si solo", pero que intent贸 hacer algo realmente valioso. </font><font style="vertical-align: inherit;">Tampoco tengo quejas sobre la calidad de construcci贸n, todo se hace con cuidado y como debe ser: sin partes torcidas, manchas de soldadura o algo as铆, todo est谩 claro y ordenado. </font><font style="vertical-align: inherit;">En general, la calidad de construcci贸n no difiere de los componentes inform谩ticos "de marca" y del Arduino "de f谩brica". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo 煤nico que har铆a si lanzara estos m贸dulos yo mismo ser铆a instalar terminales multicolores en lugar de terminales de un solo color para conectar los cables, al menos resaltar los terminales de conexi贸n de alimentaci贸n, pero esto es as铆, una peque帽a selecci贸n (todo, por supuesto, est谩 perfectamente firmado).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驴De qu茅 trata el primer art铆culo de la serie?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toda la informaci贸n se divide en tres art铆culos terminados l贸gicamente. El primer art铆culo se centrar谩 en la integraci贸n de los m贸dulos Laurent con MajorDoMo, una popular plataforma de automatizaci贸n del hogar de c贸digo abierto. Se dar谩n ejemplos espec铆ficos y c贸digo PHP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El segundo art铆culo trata sobre la integraci贸n con el ecosistema Arduino. Puede administrar los m贸dulos desde sus bocetos individuales o integrar Laurent con el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arduino Mega Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (que tambi茅n se basa en el c贸digo Arduino) y administrar los Laurents desde una interfaz conveniente o autom谩tica, de acuerdo con el programa. Tambi茅n se dar谩n soluciones listas para usar y c贸digo probado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y en el tercero, sobre la gesti贸n de m贸dulos Laurent a partir de bocetos en Processing. Es decir, directamente desde el escritorio de la computadora de su hogar. El mismo art铆culo describir谩 c贸mo aumentar el inter茅s de los ni帽os en la programaci贸n de aprendizaje y qu茅 papel pueden desempe帽ar estos m贸dulos en este asunto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La serie est谩 dedicada a la integraci贸n de los m贸dulos Laurent con los sistemas de automatizaci贸n del hogar y no considera la arquitectura y el funcionamiento de los m贸dulos en s铆. Esto se describi贸 en otros art铆culos con los que puede leer </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y se discutir谩 m谩s adelante. Aqu铆 nos centramos solo en la integraci贸n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el proceso de redacci贸n de los art铆culos, se utiliz贸 el m贸dulo Laurent con firmware La01 y la versi贸n de interfaz web LW1.0, es decir, el m贸dulo de "combate" que ha estado funcionando durante tres a帽os. </font><font style="vertical-align: inherit;">En las nuevas versiones de m贸dulos, los detalles de implementaci贸n pueden diferir ligeramente, pero se preserva la compatibilidad con los equipos de control, por lo que todo lo dicho aqu铆 tambi茅n es cierto para las modificaciones m谩s recientes.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C贸mo funciona la gesti贸n de m贸dulos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo el intercambio de informaci贸n con los m贸dulos se realiza a trav茅s de la red y para comenzar a trabajar con ellos, debe establecer una conexi贸n TCP / IP en el puerto 2424. </font><font style="vertical-align: inherit;">Una vez establecida la conexi贸n, puede enviar comandos de texto (los llamados comandos KE) que controlan el m贸dulo. </font><font style="vertical-align: inherit;">El </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sitio web KernelChip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tiene documentaci贸n detallada, que incluye una descripci贸n accesible de los comandos KE. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
KernelChip se ocup贸 de los usuarios y proporcion贸 a sus m贸dulos una interfaz web conveniente, pero esto es un "control manual", y la conveniencia, el valor y la utilidad de la soluci贸n aumentar谩n en un pedido si aprendemos a administrar el m贸dulo desde nuestra casa inteligente. </font></font><br>
<br>
<img src="https://habrastorage.org/files/0ad/e7b/6e3/0ade7b6e3ff2446e969b922121a3c87d.jpg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La interfaz web est谩 protegida por contrase帽a de forma predeterminada y para ver el contenido de la p谩gina web debe ingresar el nombre de usuario "admin" y la contrase帽a "Laurent".</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mayordomo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El sistema </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MajorDoMo es</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bastante popular y no me </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">detendr茅</font></a><font style="vertical-align: inherit;"> aqu铆 en detalle. </font><font style="vertical-align: inherit;">Se supone que ya instal贸 este sistema y trabaj贸 con 茅l durante alg煤n tiempo. </font><font style="vertical-align: inherit;">Para aquellos que no est谩n actualizados, les explicar茅 que esta es una plataforma abierta de automatizaci贸n del hogar que se ejecuta en Windows y Linux y se basa en un servidor web y es una especie de CMS (sistema de gesti贸n de contenido) especializado con amplias capacidades y "perfeccionado" para automatizaci贸n del hogar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las posibilidades de MajorDoMo son realmente infinitas y administrar m贸dulos Laurent es solo uno de los talentos de este sistema.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detalles t茅cnicos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MajorDoMo incorpora el archivo laurent.class.php, que se encuentra en el directorio</font></font><br>
<br>
<pre><code class="dos hljs">\htdocs\lib\<font></font>
<font></font>
</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C贸digo completo laurent.class.php</font></font></b><div class="spoiler_text">&lt;?<br>
<br>
function laurent_command($host, $command, $password='Laurent') {<br>
<br>
$socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);<br>
 if ($socket === false) {<br>
 echo 芦socket_create() failed: reason: 禄. socket_strerror(socket_last_error()). "\n";<br>
 return 0;<br>
 }<br>
<br>
$result = socket_connect($socket, $host, 2424);<br>
 if ($result === false) {<br>
 echo 芦socket_connect( $socket, $host, 2424) failed.\nReason: ($result) 禄. socket_strerror(socket_last_error($socket)). "\n";<br>
 return 0;<br>
 }<br>
<br>
$in='$KE'."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
$in='$KE,PSW,SET,'.$password."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
$in=$command."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
socket_close($socket);<br>
 return trim($res);<br>
 <br>
 }<br>
<br>
function laurent_getStat($host, $password='Laurent') {<br>
<br>
$socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);<br>
 if ($socket === false) {<br>
 echo 芦socket_create() failed: reason: 禄. socket_strerror(socket_last_error()). "\n";<br>
 return 0;<br>
 }<br>
<br>
$result = socket_connect($socket, $host, 2424);<br>
 if ($result === false) {<br>
 echo 芦socket_connect( $socket, $host, 2424) failed.\nReason: ($result) 禄. socket_strerror(socket_last_error($socket)). "\n";<br>
 return 0;<br>
 }<br>
<br>
$in='$KE'."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
$in='$KE,PSW,SET,'.$password."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
$command='$KE,DAT,ON';<br>
 $in=$command."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 $started=0;<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "#TIME,"))) {<br>
 if (!$started) {<br>
 $started=1;<br>
 } else {<br>
 break;<br>
 }<br>
 }<br>
 }<br>
<br>
$command='$KE,DAT,OFF';<br>
 $in=$command."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
 sleep(1);<br>
 socket_write($socket, $in, strlen($in));<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
socket_close($socket);<br>
 return trim($res);<br>
 <br>
 }<br>
<br>
?&gt;<br>
<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
y contiene todo lo que necesita para trabajar con los m贸dulos Laurent. </font><font style="vertical-align: inherit;">Este archivo contiene funciones en el lenguaje de programaci贸n PHP y, probablemente, en forma terminada o con modificaciones m铆nimas, puede transferirse a cualquier sistema que use este lenguaje de programaci贸n. </font><font style="vertical-align: inherit;">Por lo tanto, si tiene un proyecto Smart Home en una plataforma diferente, puede intentar integrar Laurent con su sistema utilizando este archivo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La funci贸n principal utilizada para controlar el m贸dulo es</font></font><br>
<br>
<pre><code class="php hljs">laurent_command(<span class="hljs-string">'&lt; &gt;'</span>, <span class="hljs-string">'&lt;&gt;'</span>, <span class="hljs-string">'&lt;  &gt;'</span>);<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
p.ej,</font></font><br>
<br>
<pre><code class="php hljs">$result = laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,INF'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
, donde '192.168.2.19' es la direcci贸n IP del m贸dulo, '$ KE, INF' es el comando en s铆, 'Laurent' es la contrase帽a (predeterminada). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El resultado del trabajo de la funci贸n entra en la variable $ resultado, es decir, la respuesta del m贸dulo, que puede analizar e interpretar utilizando herramientas de lenguaje PHP est谩ndar. La contrase帽a se especifica como est谩 por defecto. En caso de que haya cambiado la contrase帽a para acceder a su m贸dulo, deber谩 reemplazarla por una nueva y en la llamada a la funci贸n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo debe estar claro con el equipo, puede tomar cualquier comando del directorio y administrar el m贸dulo como desee. La direcci贸n IP tampoco deber铆a causar ning煤n problema. Simplemente especifique la direcci贸n IP que tiene realmente su m贸dulo Laurent.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede terminar la teor铆a con esto y ahora le mostrar茅 con un ejemplo pr谩ctico c贸mo hacer que la luz (o un dispositivo) controle directamente desde el men煤 MajorDoMo.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo pr谩ctico</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como ejemplo pr谩ctico, veamos la creaci贸n de dos botones "Activar" y "Desactivar" en el men煤 principal del sistema MajorDoMo. Con estos botones puede encender o apagar la luz o cualquier aparato el茅ctrico (aqu铆 solo debe recordar que los rel茅s instalados en el m贸dulo no pueden controlar directamente una carga potente como una estufa el茅ctrica o un calentador de agua). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, creamos el bot贸n "Activar", para esto vamos al panel de administraci贸n de MajorDoMo e ingresamos el nombre de usuario y la contrase帽a (admin / admin por defecto) y hacemos clic en "OBJETOS / Men煤 de control" y luego en el gran bot贸n verde "Agregar una nueva secci贸n". </font></font><br>
<br>
<img src="https://habrastorage.org/files/fb3/4af/d8b/fb34afd8babe4df5a78392f9b6025857.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci贸n, encontramos la lista desplegable "Tipo" y seleccionamos "Bot贸n" de toda la variedad de tipos presentados y hacemos clic en "Guardar".</font></font><br>
<br>
<img src="https://habrastorage.org/files/2de/95f/137/2de95f13747c4887b12cc1a6b51315ae.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci贸n, seleccione "Elemento del men煤 principal" es el lugar donde nuestro bot贸n "engancha". </font><font style="vertical-align: inherit;">Lo tengo Laurent, y puedes tener cualquier art铆culo de men煤 conveniente. </font><font style="vertical-align: inherit;">Por defecto, hay "ROOT", lo que significa que el bot贸n ser谩 visible de inmediato, sin hacer clic en ning煤n elemento del men煤. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el campo de entrada "T铆tulo" escriba lo que desea que se escriba en el bot贸n. </font><font style="vertical-align: inherit;">Y, por 煤ltimo, en el campo C贸digo, escriba el c贸digo de funci贸n laurent_command que ya nos es familiar:</font></font><br>
<br>
<pre><code class="php hljs">laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,REL,2,1'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu铆 es lo mismo que en el ejemplo te贸rico, solo falta la variable $ result (no la necesitamos) y el comando se reemplaza por '$ KE, REL, 2,1', lo que significa habilitar el rel茅 No. 2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hacemos lo mismo con el bot贸n "Apagar", simplemente no olvide cambiar el nombre del bot贸n y en lugar de '$ KE, REL, 2.1' escriba '$ KE, REL, 2.0', lo que significa apagar el rel茅 No. 2:</font></font><br>
<br>
<pre><code class="php hljs">laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,REL,2,0'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eso es todo. </font><font style="vertical-align: inherit;">Recargamos la p谩gina con la interfaz MajorDoMo, aparecen dos botones nuevos que encienden y apagan las luces (o el dispositivo) directamente desde la interfaz MajorDoMo de manera hermosa y casi sin demora. </font><font style="vertical-align: inherit;">Lo que quer铆amos lograr.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Control autom谩tico</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora intentemos controlar el m贸dulo autom谩ticamente, sin intervenci贸n humana. </font><font style="vertical-align: inherit;">Ahora ver谩 que es a煤n m谩s f谩cil que usar los botones para controlar el m贸dulo. </font></font><br>
<br>
<img src="https://habrastorage.org/files/13a/34b/f74/13a34bf74e8943b5a0613e972ef09b85.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encontramos en el men煤 principal del panel de administraci贸n de MajorDoMo el elemento "Objetos", hacemos clic en 茅l, luego encontramos el objeto "ClockChime" y su m茅todo "onNewMinute". </font><font style="vertical-align: inherit;">Lo necesitamos a el. </font><font style="vertical-align: inherit;">Para aquellos que no est谩n al tanto, este es el m茅todo "central" MajorDoMo, que se llama cada minuto y es muy popular. </font><font style="vertical-align: inherit;">Es en este m茅todo que hay muchas funciones y llamadas de script que proporcionan la funcionalidad del sistema al usuario.</font></font><br>
<br>
<img src="https://habrastorage.org/files/1c6/88b/2ea/1c688b2ead4642b4934a67a00b19d9d2.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y todo lo que necesitamos hacer es agregar nuestro c贸digo a este m茅todo. </font><font style="vertical-align: inherit;">Por ejemplo, considere esta situaci贸n. </font><font style="vertical-align: inherit;">Su m贸dulo Laurent controla la iluminaci贸n nocturna en el patio de su hogar. </font><font style="vertical-align: inherit;">Y usted, por ejemplo, quiere que la luz se encienda a las 21.00 y que se apague a las 7.30 de la ma帽ana. </font><font style="vertical-align: inherit;">Nada es m谩s simple, aqu铆 est谩 el c贸digo que debe agregar al m茅todo onNewMinute:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">if</span> (timeIs(<span class="hljs-string">'21:00'</span>)) {<font></font>
  laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,REL,2,1'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">if</span> (timeIs(<span class="hljs-string">'7:30'</span>)) {<font></font>
  laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,REL,2,0'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
}<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
隆Y eso es! </font><font style="vertical-align: inherit;">Debes admitir que no es dif铆cil en absoluto. </font><font style="vertical-align: inherit;">Esto es solo un ejemplo, la l贸gica del trabajo puede ser absolutamente cualquiera y muy sofisticada. </font><font style="vertical-align: inherit;">Y el talento de los m贸dulos Laurent no termina con el encendido y apagado de las cargas, su funcionalidad es mucho m谩s amplia, pero este no es el tema de este art铆culo, aqu铆 solo consideramos los problemas de integraci贸n con ejemplos simples.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recepci贸n y salida de datos del m贸dulo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y el 煤ltimo ejemplo ser谩 c贸mo obtener y mostrar la informaci贸n recibida del m贸dulo Laurent en la p谩gina web de MajorDoMo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MajorDoMo es un sistema orientado a objetos y todo el trabajo se lleva a cabo a trav茅s de la creaci贸n de objetos y el uso de sus datos (variables) y m茅todos (c贸digo de programa). Un poco dificil? En realidad, est谩 bien y ahora lo ver谩s por ti mismo. </font></font><br>
<br>
<img src="https://habrastorage.org/files/adc/f9a/1c0/adcf9a1c0940400798e8392da8690c52.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, por ejemplo, usaremos el objeto ya existente "ThisComputer" y le agregaremos una nueva propiedad "test". Para hacer esto, haga clic en el elemento del men煤 "Objetos" que ya nos es familiar en el 谩rea de administraci贸n de MajorDoMo, busque el objeto "ThisComputer" y haga clic en el elemento "Propiedades", despl谩cese hasta la parte inferior y busque el campo de entrada "Agregar nueva propiedad", ingrese "prueba" y haga clic "Actualizar" (deje el valor vac铆o).</font></font><br>
<br>
<img src="https://habrastorage.org/files/81a/bd8/8f8/81abd88f8596487ca7415eb6526d6d40.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En esto, las operaciones preparatorias pueden considerarse completadas, agregamos una nueva "prueba" de propiedad al objeto "ThisComputer", que utilizaremos en nuestros experimentos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora nuestra tarea es solicitar la informaci贸n necesaria del m贸dulo Laurent y ponerla en la propiedad (variable) de la "prueba" del objeto "ThisComputer". </font><font style="vertical-align: inherit;">驴Como hacer esto? </font><font style="vertical-align: inherit;">Muy simple. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregue este c贸digo al m茅todo onNewMinute que ya conocemos:</font></font><br>
<br>
<pre><code class="php hljs">$result = laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,INF'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
setGlobal(<span class="hljs-string">'ThisComputer.test'</span>, $result); <font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y cada minuto MajorDoMo le pedir谩 al m贸dulo la informaci贸n necesaria y actualizar谩 la variable "prueba", que podemos usar cuando lo necesitemos. </font><font style="vertical-align: inherit;">Por ejemplo, mostrar en una p谩gina web. </font><font style="vertical-align: inherit;">Para hacer esto, colocamos el siguiente c贸digo en cualquier lugar de la p谩gina que necesitemos:</font></font><br>
<br>
<pre><code class="php hljs">%ThisComputer.test%<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este es el llamado. </font><font style="vertical-align: inherit;">una macro que, al cargar una p谩gina, sustituye el valor de la variable en lugar de s铆 misma, almacenada en la propiedad "prueba" del objeto "ThisComputer". </font><font style="vertical-align: inherit;">Y como resultado, ver谩 la informaci贸n transmitida por el m贸dulo Laurent en respuesta a su solicitud en la p谩gina web. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
驴C贸mo agregar una macro a la p谩gina? </font><font style="vertical-align: inherit;">Vamos al men煤 de administraci贸n y seleccionamos el elemento "P谩ginas de inicio" y seleccionamos cualquier p谩gina que desee o creamos una nueva usando el bot贸n verde grande "Nueva p谩gina". </font><font style="vertical-align: inherit;">Y agregue la macro a cualquier ubicaci贸n deseada en la p谩gina.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total parcial</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces eso es todo. </font><font style="vertical-align: inherit;">Armado con la informaci贸n de este art铆culo, puede sentirse un verdadero maestro de los Laurents e integrar estos m贸dulos en su sistema Smart Home. </font><font style="vertical-align: inherit;">Y en el pr贸ximo art铆culo de la serie, aprender谩 a administrar m贸dulos a partir de sus bocetos en Arduino y del </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sistema Arduino Mega Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es384485/">https://habr.com/ru/post/es384485/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es384475/index.html">La revisi贸n no es un gadget. Elegir el mejor estuche de entrenamiento y otros accesorios para tel茅fonos inteligentes: ap贸sitos, bolsos y bolsillo de silicona</a></li>
<li><a href="../es384477/index.html">La NASA probar谩 la tecnolog铆a de desarrollo de asteroides usando luz solar</a></li>
<li><a href="../es384479/index.html">Desarrollo de juegos en Procesamiento con control a trav茅s del tablero Arduino Uno</a></li>
<li><a href="../es384481/index.html">La guerra oblig贸 a los cient铆ficos sirios a reponer las existencias de semillas de la "B贸veda del Juicio Final"</a></li>
<li><a href="../es384483/index.html">Un tel茅fono experimental alimentado por paneles solares. RC 1.0</a></li>
<li><a href="../es384487/index.html">Canci贸n "Happy Birthday To You" por orden judicial anunciada p煤blicamente</a></li>
<li><a href="../es384489/index.html">Nueva unidad de estado s贸lido m谩s r谩pida del fabricante coreano: Samsung 950 Pro</a></li>
<li><a href="../es384491/index.html">Los robots se estacionan mejor que los humanos</a></li>
<li><a href="../es384493/index.html">Reloj electr贸nico estilo Qlocktwo</a></li>
<li><a href="../es384499/index.html">Acer Revo One: una computadora en miniatura con un amplio espectro de acci贸n</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>