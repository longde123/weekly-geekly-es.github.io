<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⛱️ 🏽 ⚜️ Módulos Laurent y Smart Home (Parte 1). Mayordomo 🍥 👣 🕵🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quiero llamar su atención sobre una serie de artículos sobre los módulos de control Laurent de KernelChip . En esta serie, le contaré sobre cómo integ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Módulos Laurent y Smart Home (Parte 1). Mayordomo</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/384485/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quiero llamar su atención sobre una serie de artículos sobre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">los</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> módulos de control Laurent </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">de KernelChip</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">En esta serie, le contaré sobre cómo integrar estos módulos en su Smart Home, cómo aprender a administrarlos desde el popular </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sistema de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> automatización del hogar </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">MajorDoMo</font></a><font style="vertical-align: inherit;"> , desde bocetos de Arduino, desde el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sistema Arduino Mega Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e incluso cómo usar estos módulos para un propósito completamente inesperado, para enseñando a tus hijos a programar en Processing. </font></font><br>
<br>
<img src="https://habrastorage.org/files/915/0cb/0cb/9150cb0cbde940e588d1badce05af5bb.jpg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En general, los módulos que son bastante interesantes en sí mismos pueden ser inesperadamente muy útiles en los hogares si los aborda con cierta imaginación y creatividad.</font></font><br>
<a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¿Por qué Laurent?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Debido a que estos módulos han funcionado con éxito en mi sistema Smart Home durante mucho tiempo (más de tres años) y he adquirido cierta experiencia en su uso y tengo algo que contar sobre ellos. </font><font style="vertical-align: inherit;">Y también tengo algo de experiencia y un código probado y listo para administrar estos módulos, que quiero compartir con ustedes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y podrá desarrollar sus soluciones de software basadas en este código, será bastante simple, porque ya he hecho la mayor parte del trabajo. </font><font style="vertical-align: inherit;">Además, el código se explicará en detalle, lo que sin duda contribuye a su comprensión de cómo funciona, aprender a programar y construir sistemas domésticos inteligentes.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Módulos en sí</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando elegí una solución ya preparada para administrar las cargas eléctricas a través de la red, Laurent me sobornó con la integridad y simplicidad de la solución. Para comenzar a controlar los dispositivos de encendido y apagado de la red y la iluminación, no se necesitaba casi nada. No fue necesario aprender el lenguaje de programación, no fue necesario soldar nada, fue suficiente para conectar el módulo a la red local, conectar la carga a los terminales del relé (y no olvidar aplicar energía al módulo en sí) y eso fue todo. Después de eso, fue posible enviar comandos directamente desde la computadora (desde el programa del terminal). El módulo inmediatamente comenzó a encender y apagar obedientemente la luz de acuerdo con mis órdenes. En ese momento, no necesitaba más.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puedo decir acerca de los módulos en sí mismos que durante todo el período de operación no hubo fallas ni bloqueos, todo funcionó y funciona "como un reloj", que, de hecho, se requiere de dichos módulos para que simplemente funcione.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diseño y calidad de construcción.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Basta con mirar el módulo para dejar en claro que fue desarrollado por una razón, "si solo", pero que intentó hacer algo realmente valioso. </font><font style="vertical-align: inherit;">Tampoco tengo quejas sobre la calidad de construcción, todo se hace con cuidado y como debe ser: sin partes torcidas, manchas de soldadura o algo así, todo está claro y ordenado. </font><font style="vertical-align: inherit;">En general, la calidad de construcción no difiere de los componentes informáticos "de marca" y del Arduino "de fábrica". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo único que haría si lanzara estos módulos yo mismo sería instalar terminales multicolores en lugar de terminales de un solo color para conectar los cables, al menos resaltar los terminales de conexión de alimentación, pero esto es así, una pequeña selección (todo, por supuesto, está perfectamente firmado).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¿De qué trata el primer artículo de la serie?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toda la información se divide en tres artículos terminados lógicamente. El primer artículo se centrará en la integración de los módulos Laurent con MajorDoMo, una popular plataforma de automatización del hogar de código abierto. Se darán ejemplos específicos y código PHP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El segundo artículo trata sobre la integración con el ecosistema Arduino. Puede administrar los módulos desde sus bocetos individuales o integrar Laurent con el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arduino Mega Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (que también se basa en el código Arduino) y administrar los Laurents desde una interfaz conveniente o automática, de acuerdo con el programa. También se darán soluciones listas para usar y código probado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y en el tercero, sobre la gestión de módulos Laurent a partir de bocetos en Processing. Es decir, directamente desde el escritorio de la computadora de su hogar. El mismo artículo describirá cómo aumentar el interés de los niños en la programación de aprendizaje y qué papel pueden desempeñar estos módulos en este asunto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La serie está dedicada a la integración de los módulos Laurent con los sistemas de automatización del hogar y no considera la arquitectura y el funcionamiento de los módulos en sí. Esto se describió en otros artículos con los que puede leer </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y se discutirá más adelante. Aquí nos centramos solo en la integración.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el proceso de redacción de los artículos, se utilizó el módulo Laurent con firmware La01 y la versión de interfaz web LW1.0, es decir, el módulo de "combate" que ha estado funcionando durante tres años. </font><font style="vertical-align: inherit;">En las nuevas versiones de módulos, los detalles de implementación pueden diferir ligeramente, pero se preserva la compatibilidad con los equipos de control, por lo que todo lo dicho aquí también es cierto para las modificaciones más recientes.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cómo funciona la gestión de módulos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo el intercambio de información con los módulos se realiza a través de la red y para comenzar a trabajar con ellos, debe establecer una conexión TCP / IP en el puerto 2424. </font><font style="vertical-align: inherit;">Una vez establecida la conexión, puede enviar comandos de texto (los llamados comandos KE) que controlan el módulo. </font><font style="vertical-align: inherit;">El </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sitio web KernelChip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tiene documentación detallada, que incluye una descripción accesible de los comandos KE. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
KernelChip se ocupó de los usuarios y proporcionó a sus módulos una interfaz web conveniente, pero esto es un "control manual", y la conveniencia, el valor y la utilidad de la solución aumentarán en un pedido si aprendemos a administrar el módulo desde nuestra casa inteligente. </font></font><br>
<br>
<img src="https://habrastorage.org/files/0ad/e7b/6e3/0ade7b6e3ff2446e969b922121a3c87d.jpg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La interfaz web está protegida por contraseña de forma predeterminada y para ver el contenido de la página web debe ingresar el nombre de usuario "admin" y la contraseña "Laurent".</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mayordomo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El sistema </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MajorDoMo es</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bastante popular y no me </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">detendré</font></a><font style="vertical-align: inherit;"> aquí en detalle. </font><font style="vertical-align: inherit;">Se supone que ya instaló este sistema y trabajó con él durante algún tiempo. </font><font style="vertical-align: inherit;">Para aquellos que no están actualizados, les explicaré que esta es una plataforma abierta de automatización del hogar que se ejecuta en Windows y Linux y se basa en un servidor web y es una especie de CMS (sistema de gestión de contenido) especializado con amplias capacidades y "perfeccionado" para automatización del hogar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las posibilidades de MajorDoMo son realmente infinitas y administrar módulos Laurent es solo uno de los talentos de este sistema.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detalles técnicos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MajorDoMo incorpora el archivo laurent.class.php, que se encuentra en el directorio</font></font><br>
<br>
<pre><code class="dos hljs">\htdocs\lib\<font></font>
<font></font>
</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Código completo laurent.class.php</font></font></b><div class="spoiler_text">&lt;?<br>
<br>
function laurent_command($host, $command, $password='Laurent') {<br>
<br>
$socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);<br>
 if ($socket === false) {<br>
 echo «socket_create() failed: reason: ». socket_strerror(socket_last_error()). "\n";<br>
 return 0;<br>
 }<br>
<br>
$result = socket_connect($socket, $host, 2424);<br>
 if ($result === false) {<br>
 echo «socket_connect( $socket, $host, 2424) failed.\nReason: ($result) ». socket_strerror(socket_last_error($socket)). "\n";<br>
 return 0;<br>
 }<br>
<br>
$in='$KE'."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
$in='$KE,PSW,SET,'.$password."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
$in=$command."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
socket_close($socket);<br>
 return trim($res);<br>
 <br>
 }<br>
<br>
function laurent_getStat($host, $password='Laurent') {<br>
<br>
$socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);<br>
 if ($socket === false) {<br>
 echo «socket_create() failed: reason: ». socket_strerror(socket_last_error()). "\n";<br>
 return 0;<br>
 }<br>
<br>
$result = socket_connect($socket, $host, 2424);<br>
 if ($result === false) {<br>
 echo «socket_connect( $socket, $host, 2424) failed.\nReason: ($result) ». socket_strerror(socket_last_error($socket)). "\n";<br>
 return 0;<br>
 }<br>
<br>
$in='$KE'."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
$in='$KE,PSW,SET,'.$password."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
$command='$KE,DAT,ON';<br>
 $in=$command."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 $started=0;<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "#TIME,"))) {<br>
 if (!$started) {<br>
 $started=1;<br>
 } else {<br>
 break;<br>
 }<br>
 }<br>
 }<br>
<br>
$command='$KE,DAT,OFF';<br>
 $in=$command."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
 sleep(1);<br>
 socket_write($socket, $in, strlen($in));<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
socket_close($socket);<br>
 return trim($res);<br>
 <br>
 }<br>
<br>
?&gt;<br>
<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
y contiene todo lo que necesita para trabajar con los módulos Laurent. </font><font style="vertical-align: inherit;">Este archivo contiene funciones en el lenguaje de programación PHP y, probablemente, en forma terminada o con modificaciones mínimas, puede transferirse a cualquier sistema que use este lenguaje de programación. </font><font style="vertical-align: inherit;">Por lo tanto, si tiene un proyecto Smart Home en una plataforma diferente, puede intentar integrar Laurent con su sistema utilizando este archivo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La función principal utilizada para controlar el módulo es</font></font><br>
<br>
<pre><code class="php hljs">laurent_command(<span class="hljs-string">'&lt; &gt;'</span>, <span class="hljs-string">'&lt;&gt;'</span>, <span class="hljs-string">'&lt;  &gt;'</span>);<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
p.ej,</font></font><br>
<br>
<pre><code class="php hljs">$result = laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,INF'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
, donde '192.168.2.19' es la dirección IP del módulo, '$ KE, INF' es el comando en sí, 'Laurent' es la contraseña (predeterminada). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El resultado del trabajo de la función entra en la variable $ resultado, es decir, la respuesta del módulo, que puede analizar e interpretar utilizando herramientas de lenguaje PHP estándar. La contraseña se especifica como está por defecto. En caso de que haya cambiado la contraseña para acceder a su módulo, deberá reemplazarla por una nueva y en la llamada a la función. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo debe estar claro con el equipo, puede tomar cualquier comando del directorio y administrar el módulo como desee. La dirección IP tampoco debería causar ningún problema. Simplemente especifique la dirección IP que tiene realmente su módulo Laurent.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede terminar la teoría con esto y ahora le mostraré con un ejemplo práctico cómo hacer que la luz (o un dispositivo) controle directamente desde el menú MajorDoMo.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo práctico</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como ejemplo práctico, veamos la creación de dos botones "Activar" y "Desactivar" en el menú principal del sistema MajorDoMo. Con estos botones puede encender o apagar la luz o cualquier aparato eléctrico (aquí solo debe recordar que los relés instalados en el módulo no pueden controlar directamente una carga potente como una estufa eléctrica o un calentador de agua). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, creamos el botón "Activar", para esto vamos al panel de administración de MajorDoMo e ingresamos el nombre de usuario y la contraseña (admin / admin por defecto) y hacemos clic en "OBJETOS / Menú de control" y luego en el gran botón verde "Agregar una nueva sección". </font></font><br>
<br>
<img src="https://habrastorage.org/files/fb3/4af/d8b/fb34afd8babe4df5a78392f9b6025857.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuación, encontramos la lista desplegable "Tipo" y seleccionamos "Botón" de toda la variedad de tipos presentados y hacemos clic en "Guardar".</font></font><br>
<br>
<img src="https://habrastorage.org/files/2de/95f/137/2de95f13747c4887b12cc1a6b51315ae.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuación, seleccione "Elemento del menú principal" es el lugar donde nuestro botón "engancha". </font><font style="vertical-align: inherit;">Lo tengo Laurent, y puedes tener cualquier artículo de menú conveniente. </font><font style="vertical-align: inherit;">Por defecto, hay "ROOT", lo que significa que el botón será visible de inmediato, sin hacer clic en ningún elemento del menú. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el campo de entrada "Título" escriba lo que desea que se escriba en el botón. </font><font style="vertical-align: inherit;">Y, por último, en el campo Código, escriba el código de función laurent_command que ya nos es familiar:</font></font><br>
<br>
<pre><code class="php hljs">laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,REL,2,1'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquí es lo mismo que en el ejemplo teórico, solo falta la variable $ result (no la necesitamos) y el comando se reemplaza por '$ KE, REL, 2,1', lo que significa habilitar el relé No. 2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hacemos lo mismo con el botón "Apagar", simplemente no olvide cambiar el nombre del botón y en lugar de '$ KE, REL, 2.1' escriba '$ KE, REL, 2.0', lo que significa apagar el relé No. 2:</font></font><br>
<br>
<pre><code class="php hljs">laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,REL,2,0'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eso es todo. </font><font style="vertical-align: inherit;">Recargamos la página con la interfaz MajorDoMo, aparecen dos botones nuevos que encienden y apagan las luces (o el dispositivo) directamente desde la interfaz MajorDoMo de manera hermosa y casi sin demora. </font><font style="vertical-align: inherit;">Lo que queríamos lograr.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Control automático</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora intentemos controlar el módulo automáticamente, sin intervención humana. </font><font style="vertical-align: inherit;">Ahora verá que es aún más fácil que usar los botones para controlar el módulo. </font></font><br>
<br>
<img src="https://habrastorage.org/files/13a/34b/f74/13a34bf74e8943b5a0613e972ef09b85.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encontramos en el menú principal del panel de administración de MajorDoMo el elemento "Objetos", hacemos clic en él, luego encontramos el objeto "ClockChime" y su método "onNewMinute". </font><font style="vertical-align: inherit;">Lo necesitamos a el. </font><font style="vertical-align: inherit;">Para aquellos que no están al tanto, este es el método "central" MajorDoMo, que se llama cada minuto y es muy popular. </font><font style="vertical-align: inherit;">Es en este método que hay muchas funciones y llamadas de script que proporcionan la funcionalidad del sistema al usuario.</font></font><br>
<br>
<img src="https://habrastorage.org/files/1c6/88b/2ea/1c688b2ead4642b4934a67a00b19d9d2.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y todo lo que necesitamos hacer es agregar nuestro código a este método. </font><font style="vertical-align: inherit;">Por ejemplo, considere esta situación. </font><font style="vertical-align: inherit;">Su módulo Laurent controla la iluminación nocturna en el patio de su hogar. </font><font style="vertical-align: inherit;">Y usted, por ejemplo, quiere que la luz se encienda a las 21.00 y que se apague a las 7.30 de la mañana. </font><font style="vertical-align: inherit;">Nada es más simple, aquí está el código que debe agregar al método onNewMinute:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">if</span> (timeIs(<span class="hljs-string">'21:00'</span>)) {<font></font>
  laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,REL,2,1'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">if</span> (timeIs(<span class="hljs-string">'7:30'</span>)) {<font></font>
  laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,REL,2,0'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
}<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¡Y eso es! </font><font style="vertical-align: inherit;">Debes admitir que no es difícil en absoluto. </font><font style="vertical-align: inherit;">Esto es solo un ejemplo, la lógica del trabajo puede ser absolutamente cualquiera y muy sofisticada. </font><font style="vertical-align: inherit;">Y el talento de los módulos Laurent no termina con el encendido y apagado de las cargas, su funcionalidad es mucho más amplia, pero este no es el tema de este artículo, aquí solo consideramos los problemas de integración con ejemplos simples.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recepción y salida de datos del módulo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y el último ejemplo será cómo obtener y mostrar la información recibida del módulo Laurent en la página web de MajorDoMo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MajorDoMo es un sistema orientado a objetos y todo el trabajo se lleva a cabo a través de la creación de objetos y el uso de sus datos (variables) y métodos (código de programa). Un poco dificil? En realidad, está bien y ahora lo verás por ti mismo. </font></font><br>
<br>
<img src="https://habrastorage.org/files/adc/f9a/1c0/adcf9a1c0940400798e8392da8690c52.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, por ejemplo, usaremos el objeto ya existente "ThisComputer" y le agregaremos una nueva propiedad "test". Para hacer esto, haga clic en el elemento del menú "Objetos" que ya nos es familiar en el área de administración de MajorDoMo, busque el objeto "ThisComputer" y haga clic en el elemento "Propiedades", desplácese hasta la parte inferior y busque el campo de entrada "Agregar nueva propiedad", ingrese "prueba" y haga clic "Actualizar" (deje el valor vacío).</font></font><br>
<br>
<img src="https://habrastorage.org/files/81a/bd8/8f8/81abd88f8596487ca7415eb6526d6d40.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En esto, las operaciones preparatorias pueden considerarse completadas, agregamos una nueva "prueba" de propiedad al objeto "ThisComputer", que utilizaremos en nuestros experimentos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora nuestra tarea es solicitar la información necesaria del módulo Laurent y ponerla en la propiedad (variable) de la "prueba" del objeto "ThisComputer". </font><font style="vertical-align: inherit;">¿Como hacer esto? </font><font style="vertical-align: inherit;">Muy simple. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregue este código al método onNewMinute que ya conocemos:</font></font><br>
<br>
<pre><code class="php hljs">$result = laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,INF'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
setGlobal(<span class="hljs-string">'ThisComputer.test'</span>, $result); <font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y cada minuto MajorDoMo le pedirá al módulo la información necesaria y actualizará la variable "prueba", que podemos usar cuando lo necesitemos. </font><font style="vertical-align: inherit;">Por ejemplo, mostrar en una página web. </font><font style="vertical-align: inherit;">Para hacer esto, colocamos el siguiente código en cualquier lugar de la página que necesitemos:</font></font><br>
<br>
<pre><code class="php hljs">%ThisComputer.test%<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este es el llamado. </font><font style="vertical-align: inherit;">una macro que, al cargar una página, sustituye el valor de la variable en lugar de sí misma, almacenada en la propiedad "prueba" del objeto "ThisComputer". </font><font style="vertical-align: inherit;">Y como resultado, verá la información transmitida por el módulo Laurent en respuesta a su solicitud en la página web. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¿Cómo agregar una macro a la página? </font><font style="vertical-align: inherit;">Vamos al menú de administración y seleccionamos el elemento "Páginas de inicio" y seleccionamos cualquier página que desee o creamos una nueva usando el botón verde grande "Nueva página". </font><font style="vertical-align: inherit;">Y agregue la macro a cualquier ubicación deseada en la página.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total parcial</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces eso es todo. </font><font style="vertical-align: inherit;">Armado con la información de este artículo, puede sentirse un verdadero maestro de los Laurents e integrar estos módulos en su sistema Smart Home. </font><font style="vertical-align: inherit;">Y en el próximo artículo de la serie, aprenderá a administrar módulos a partir de sus bocetos en Arduino y del </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sistema Arduino Mega Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es384485/">https://habr.com/ru/post/es384485/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es384475/index.html">La revisión no es un gadget. Elegir el mejor estuche de entrenamiento y otros accesorios para teléfonos inteligentes: apósitos, bolsos y bolsillo de silicona</a></li>
<li><a href="../es384477/index.html">La NASA probará la tecnología de desarrollo de asteroides usando luz solar</a></li>
<li><a href="../es384479/index.html">Desarrollo de juegos en Procesamiento con control a través del tablero Arduino Uno</a></li>
<li><a href="../es384481/index.html">La guerra obligó a los científicos sirios a reponer las existencias de semillas de la "Bóveda del Juicio Final"</a></li>
<li><a href="../es384483/index.html">Un teléfono experimental alimentado por paneles solares. RC 1.0</a></li>
<li><a href="../es384487/index.html">Canción "Happy Birthday To You" por orden judicial anunciada públicamente</a></li>
<li><a href="../es384489/index.html">Nueva unidad de estado sólido más rápida del fabricante coreano: Samsung 950 Pro</a></li>
<li><a href="../es384491/index.html">Los robots se estacionan mejor que los humanos</a></li>
<li><a href="../es384493/index.html">Reloj electrónico estilo Qlocktwo</a></li>
<li><a href="../es384499/index.html">Acer Revo One: una computadora en miniatura con un amplio espectro de acción</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>