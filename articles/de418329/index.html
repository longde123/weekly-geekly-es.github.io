<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèñÔ∏è üôáüèº üöü Organisation sicherer Tests in der Produktion. Teil 2 üåµ „ÄΩÔ∏è ü§∂üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Teil des Artikels werden wir weiterhin verschiedene Arten von Tests in der Produktion betrachten. Wer den ersten Teil √ºbersprungen hat, kann...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Organisation sicherer Tests in der Produktion. Teil 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/funcorp/blog/418329/"><img src="https://habrastorage.org/webt/ht/ra/sh/htrashsucmi8c4a6nok7rihdoay.png"><br><br>  In diesem Teil des Artikels werden wir weiterhin verschiedene Arten von Tests in der Produktion betrachten.  Wer den ersten Teil √ºbersprungen hat, kann ihn <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> lesen.  F√ºr den Rest - willkommen bei Katze. <br><a name="habracut"></a><br><h2>  Produktionstests: Freigabe </h2><br>  Nach dem Testen des Dienstes nach der <i>Bereitstellung</i> muss er f√ºr die <i>Freigabe</i> vorbereitet werden. <br>  Es ist wichtig zu beachten, dass zu diesem Zeitpunkt das Zur√ºcksetzen von √Ñnderungen nur in Situationen eines <i>nachhaltigen</i> Scheiterns m√∂glich ist, zum Beispiel: <br><br><ul><li>  Service Failure Looping; </li><li>  √úberschreiten der Wartezeit f√ºr eine signifikante Anzahl von Verbindungen im Upstream, was zu einem starken Anstieg der Fehlerh√§ufigkeit f√ºhrt; </li><li>  Inakzeptable Konfigurations√§nderungen, z. B. das Fehlen eines geheimen Schl√ºssels in einer Umgebungsvariablen, der eine Fehlfunktion des Dienstes verursacht (Umgebungsvariablen sind im Allgemeinen besser zu vermeiden, dies ist jedoch ein Thema f√ºr eine andere Diskussion). </li></ul><br>  Durch gr√ºndliche Tests in der <i>Bereitstellungsphase</i> kann ich unangenehme √úberraschungen in der <i>Release-</i> Phase idealerweise minimieren oder vollst√§ndig vermeiden.  Es gibt jedoch eine Reihe von Empfehlungen f√ºr die sichere Freigabe von neuem Code. <br><br><h3>  Kanarische Bereitstellung </h3><br>  <i>Canary Deployment</i> ist eine teilweise <i>Freigabe eines</i> Dienstes in der Produktion.  W√§hrend der grundlegenden Integrit√§tspr√ºfung werden die kleinen Teile des aktuellen Verkehrs in der Produktionsumgebung an die freigegebenen Teile gesendet.  Die Ergebnisse der Teile des Dienstes werden √ºberwacht, w√§hrend der Verkehr verarbeitet wird, die Indikatoren werden mit den Referenzindikatoren verglichen (die sich nicht auf kanarische beziehen), und wenn sie au√üerhalb der akzeptablen Schwellenwerte liegen, wird ein Rollback auf den vorherigen Zustand durchgef√ºhrt.  Obwohl dieser Ansatz normalerweise bei der Freigabe von Serversoftware verwendet wird, werden auch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">kanarische Tests von Client-Software</a> immer h√§ufiger. <br><br>  Verschiedene Faktoren beeinflussen, welcher Verkehr f√ºr den Einsatz auf Kanarienv√∂geln verwendet wird.  In einer Reihe von Unternehmen erhalten die freigegebenen Teile des Dienstes zun√§chst nur internen Benutzerverkehr (sogenanntes Hundefutter).  Wenn keine Fehler festgestellt werden, wird ein kleiner Teil des Datenverkehrs in der Produktionsumgebung hinzugef√ºgt. Anschlie√üend wird eine vollst√§ndige Bereitstellung durchgef√ºhrt.  Es wird <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">empfohlen,</a> bei ung√ºltigen Ergebnissen der kanarischen Bereitstellung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">automatisch</a> auf den vorherigen Status zur√ºckzusetzen, und Tools wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Spinnaker bieten</a> integrierte Unterst√ºtzung f√ºr automatisierte Analyse- und Rollback-Funktionen. <br><br>  Es gibt einige Probleme mit Kanarientests, und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=http://">dieser Artikel</a> bietet einen ziemlich vollst√§ndigen √úberblick √ºber sie. <br><br><h3>  √úberwachung </h3><br>  Die √úberwachung ist in <i>jeder</i> Phase der Produktbereitstellung in der Produktion ein absolut notwendiges Verfahren. Diese Funktion ist jedoch in der <i>Release-</i> Phase besonders wichtig.  Die √úberwachung eignet sich gut, um Informationen √ºber die allgemeine Systemleistung zu erhalten.  Die √úberwachung aller Daten auf der Welt ist jedoch m√∂glicherweise nicht die beste L√∂sung.  <i>Eine effektive</i> √úberwachung wird punktweise durchgef√ºhrt, sodass Sie eine kleine Anzahl von Modi f√ºr einen nachhaltigen Ausfall des Systems oder eine Reihe grundlegender Indikatoren identifizieren k√∂nnen.  Beispiele f√ºr solche Fehlermodi k√∂nnen sein: <br><br><ul><li>  Erh√∂hung der Fehlerrate; </li><li>  eine Verringerung der Gesamtgeschwindigkeit der Bearbeitung von Anfragen w√§hrend des gesamten Dienstes an einem bestimmten Endpunkt oder, noch schlimmer, eine vollst√§ndige Einstellung der Arbeit; </li><li>  erh√∂hte Verz√∂gerung. </li></ul><br>  Die Beobachtung eines dieser Modi f√ºr nachhaltiges Versagen ist die Grundlage f√ºr ein sofortiges Zur√ºcksetzen auf einen fr√ºheren Status oder ein Zur√ºcksetzen neuer <i>ver√∂ffentlichter</i> Softwareversionen.  Es ist wichtig zu bedenken, dass die √úberwachung in dieser Phase wahrscheinlich nicht vollst√§ndig und indikativ ist.  Viele glauben, dass die ideale Anzahl von Signalen, die w√§hrend der √úberwachung √ºberwacht werden, zwischen 3 und 5 liegt, aber <i>definitiv</i> nicht mehr als 7 bis 10.  Das Kraken Facebook Whitepaper bietet folgende L√∂sung: <br><br>  <i>"Das Problem wird mithilfe einer einfach konfigurierbaren √úberwachungskomponente gel√∂st, die √ºber zwei grundlegende Indikatoren (das 99. Perzentil der Antwortzeit des Webservers und die H√§ufigkeit des Auftretens schwerwiegender HTTP-Fehler) informiert ist, die die Qualit√§t der Benutzerinteraktion objektiv beschreiben."</i> <br><br>  Der Satz von System- und Anwendungsindikatoren, die w√§hrend der Freigabephase √ºberwacht werden, wird am besten w√§hrend des Systemdesigns bestimmt. <br><br><h3>  Ausnahmeverfolgung </h3><br>  Wir sprechen √ºber das Verfolgen von Ausnahmen in der Release-Phase, obwohl es den Anschein hat, dass dies in der <i>Bereitstellungsphase</i> und nach der Ver√∂ffentlichung nicht weniger n√ºtzlich w√§re.  Tools zur Ausnahmeverfolgung garantieren h√§ufig nicht die gleiche Gr√ºndlichkeit, Genauigkeit und Massenabdeckung wie einige andere Tools zur System√ºberwachung, k√∂nnen jedoch dennoch sehr n√ºtzlich sein. <br><br>  Open Source-Tools (wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sentry</a> ) zeigen erweiterte Informationen zu eingehenden Anforderungen an und erstellen Stapel von Trace-Daten und lokalen Variablen. Dies vereinfacht den Debugging-Prozess, der normalerweise aus dem Anzeigen von Ereignisprotokollen besteht, erheblich.  Die Ausnahmeverfolgung ist auch n√ºtzlich, wenn Probleme sortiert und priorisiert werden, f√ºr die kein vollst√§ndiger Rollback auf einen vorherigen Status erforderlich ist (z. B. ein Grenzfall, der eine Ausnahme ausl√∂st). <br><br><h3>  Verkehrsgestaltung </h3><br>  Die Gestaltung des Verkehrs (Verkehrsumverteilung) ist weniger eine eigenst√§ndige Form des Testens als vielmehr ein Instrument zur Unterst√ºtzung des kanarischen Ansatzes und der schrittweisen Ver√∂ffentlichung neuen Codes.  Tats√§chlich wird die Verkehrsformung durch Aktualisieren der Load-Balancer-Konfiguration sichergestellt, sodass Sie schrittweise mehr Verkehr auf die neue <i>ver√∂ffentlichte</i> Version umleiten k√∂nnen. <br><br>  Diese Methode ist auch n√ºtzlich f√ºr die schrittweise Bereitstellung neuer Software (getrennt von der regul√§ren Bereitstellung).  Betrachten Sie ein Beispiel.  Imgix musste im Juni 2016 eine grundlegend neue Infrastrukturarchitektur bereitstellen.  Nach dem ersten Testen der neuen Infrastruktur mit einer bestimmten Menge an dunklem Datenverkehr wurde mit der Bereitstellung in der Produktion begonnen, wobei zun√§chst etwa 1% des Datenverkehrs in der Produktionsumgebung auf einen neuen Stapel umgeleitet wurde.  Im Laufe mehrerer Wochen wurde dann das auf dem neuen Stapel ankommende Datenvolumen erh√∂ht (um Probleme auf dem Weg zu l√∂sen), bis 100% des Datenverkehrs verarbeitet wurden. <br><br>  Die Popularit√§t der Service-Mesh-Architektur hat ein neues Interesse an Proxy-Servern ausgel√∂st.  Infolgedessen unterst√ºtzten sowohl die alten (nginx, HAProxy) als auch die neuen (Envoy, Conduit) Proxys neue Funktionen, um die Konkurrenz zu √ºberholen.  Es scheint mir, dass die Zukunft, in der die Verkehrsumverteilung von 0 auf 100% in der Phase der Produktfreigabe automatisch durchgef√ºhrt wird, vor der T√ºr steht. <br><br><h2>  Produktionstests: Nach der Freigabe </h2><br>  Tests <i>nach der</i> Freigabe werden als √úberpr√ºfung durchgef√ºhrt, die <i>nach einer</i> erfolgreichen <i>Freigabe des</i> Codes durchgef√ºhrt wird.  Zu diesem Zeitpunkt k√∂nnen Sie sicher sein, dass der gesamte Code korrekt ist, erfolgreich in der Produktion <i>freigegeben</i> wurde und den Datenverkehr ordnungsgem√§√ü verarbeitet.  Der bereitgestellte Code wird direkt oder indirekt unter realen Bedingungen verwendet, um echte Kunden zu bedienen oder Aufgaben auszuf√ºhren, die erhebliche Auswirkungen auf das Gesch√§ft haben. <br><br>  Das Ziel aller Tests in dieser Phase besteht haupts√§chlich darin, die Funktionsf√§higkeit des Systems unter Ber√ºcksichtigung verschiedener m√∂glicher Lasten und Verkehrsmuster zu √ºberpr√ºfen.  Der beste Weg, dies zu tun, besteht darin, dokumentarische Beweise f√ºr alles zu sammeln, was in der Produktion passiert, und sie sowohl zum Debuggen als auch zum Erhalten eines vollst√§ndigen Bildes des Systems zu verwenden. <br><br><h3>  Feature-Flagging oder Dark Launch </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=http://">Die √§lteste Ver√∂ffentlichung</a> √ºber die erfolgreiche Verwendung von Feature-Flags, die ich gefunden habe, wurde vor fast zehn Jahren ver√∂ffentlicht.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Featureflags.io</a> bietet hierf√ºr den umfassendsten Leitfaden. <br><br>  <i>‚ÄûFeature-Flagging ist eine Methode, mit der Entwickler eine neue Funktion mithilfe von if-then-Anweisungen markieren, um mehr Kontrolle √ºber ihre Ver√∂ffentlichung zu erhalten.</i>  <i>Durch Markieren und Isolieren einer Funktion auf diese Weise kann der Entwickler diese Funktion unabh√§ngig vom Bereitstellungsstatus ein- und ausschalten.</i>  <i>Dies trennt die Freigabe der Funktion effektiv von der Bereitstellung des Codes. "</i> <br><br>  Durch Markieren des neuen Codes k√∂nnen Sie dessen Leistung und Leistung in der Produktion nach Bedarf testen.  Das Kennzeichnen von Merkmalen ist eine der allgemein akzeptierten Arten von Tests in der Produktion. Es ist allgemein bekannt und wird h√§ufig in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">verschiedenen Quellen beschrieben</a> .  Die Tatsache, dass diese Methode beim Testen der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">√úbertragung von Datenbanken</a> oder Software f√ºr pers√∂nliche Systeme verwendet werden kann, ist viel weniger bekannt. <br><br>  Was Autoren von Artikeln selten schreiben, sind die besten Methoden zum Entwickeln und Verwenden von Funktionsflags.  Die unkontrollierte Verwendung von Flags kann ein ernstes Problem sein.  Der Mangel an Disziplin beim Entfernen nicht verwendeter Flaggen nach einem bestimmten Zeitraum f√ºhrt manchmal dazu, dass Sie eine vollst√§ndige Pr√ºfung durchf√ºhren und veraltete Flaggen l√∂schen m√ºssen, die sich √ºber Monate (wenn nicht √ºber Jahre) der Arbeit angesammelt haben. <br><br><h3>  A / B-Tests </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">A / B-Tests werden</a> h√§ufig im Rahmen einer experimentellen Analyse durchgef√ºhrt und gelten nicht als Tests in der Produktion.  Aus diesem Grund werden A / B-Tests nicht nur h√§ufig (manchmal sogar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zweifelhaft</a> ) verwendet, sondern auch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">aktiv</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=http://">untersucht</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">beschrieben</a> (einschlie√ülich Artikeln dar√ºber, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">was eine effektive Scorecard</a> f√ºr Online-Experimente bestimmt).  Viel seltener werden A / B-Tests verwendet, um verschiedene Hardwarekonfigurationen oder virtuelle Maschinen zu testen.  Sie werden oft als "Tuning" bezeichnet (z. B. JVM-Tuning), werden jedoch nicht als typische A / B-Tests eingestuft (obwohl das Tuning als eine Art A / B-Test angesehen werden kann, der bei Messungen mit der gleichen Genauigkeit durchgef√ºhrt wird). . <br><br><h3>  Protokolle, Ereignisse, Indikatoren und Ablaufverfolgung </h3><br>  Hier <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">k√∂nnen Sie</a> √ºber die sogenannten ‚Äûdrei Wale der Beobachtbarkeit‚Äú <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">lesen</a> - Protokolle, Indikatoren und verteilte Verfolgung. <br><br><h3>  Profilerstellung </h3><br>  In einigen F√§llen ist es zur Diagnose von Leistungsproblemen erforderlich, Anwendungsprofile in der Produktion zu verwenden.  Abh√§ngig von den unterst√ºtzten Sprachen und Laufzeiten kann die Profilerstellung ein relativ einfaches Verfahren sein, bei dem der Anwendung nur eine Codezeile hinzugef√ºgt wird ( <code>import _ "net/http/pprof"</code> im Fall von Go).  Andererseits kann es erforderlich sein, viele Werkzeuge zu verwenden oder den Prozess mit der Black-Box-Methode zu testen und die Ergebnisse mit Werkzeugen wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Flammengraphen zu √ºberpr√ºfen</a> . <br><br><h3>  Tee-Test </h3><br>  Viele Leute betrachten solche Tests als eine Art Schattenverdoppelung von Daten, da in beiden F√§llen der Datenverkehr in der Produktionsumgebung an Cluster oder Prozesse au√üerhalb der Produktion gesendet wird.  Meiner Meinung nach unterscheidet sich die Verwendung von Datenverkehr zu Testzwecken etwas von der Verwendung zu <i>Debugging-</i> Zwecken. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=http://">Etsy schrieb in seinem Blog</a> √ºber die Verwendung von Tee-Tests als Verifizierungswerkzeug (dieses Beispiel √§hnelt wirklich der Schattenverdoppelung von Daten). <br>  <i>‚ÄûHier kann <b>Tee</b> als <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tee-</a> Befehl in der Befehlszeile verstanden werden.</i>  <i>Wir haben eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=http://devcentral.f5.com/articles/">iRule-</a> Regel geschrieben, die auf einem vorhandenen F5-Load-Balancer basiert, um den an einen der Pools gerichteten HTTP-Verkehr zu klonen und in einen anderen Pool umzuleiten.</i>  <i>Auf diese Weise konnten wir den Datenverkehr in der Produktionsumgebung verwenden, der an unseren API-Cluster geleitet wurde, und eine Kopie davon zum Vergleich an den experimentellen HHVM-Cluster sowie an einen isolierten PHP-Cluster senden.</i> <i><br></i>  <i>Diese Technik hat sich als sehr effektiv erwiesen.</i>  <i>Er erlaubte uns, die Leistung der beiden Konfigurationen anhand identischer Verkehrsprofile zu vergleichen. ‚Äú</i> <br><br>  Manchmal ist zum <i>Debuggen</i> jedoch ein Abschlagstest erforderlich, der auf dem Datenverkehr in der Produktionsumgebung in einem autonomen System basiert.  In solchen F√§llen kann das autonome System ge√§ndert werden, um die Ausgabe zus√§tzlicher Diagnoseinformationen oder ein anderes Kompilierungsverfahren (z. B. mithilfe des Stream-Bereinigungstools) zu konfigurieren, was den Fehlerbehebungsprozess erheblich vereinfacht.  In solchen F√§llen sollten Tee-Tests eher als <i>Debugging-Tools</i> als als <i>Verifizierung betrachtet werden</i> . <br><br>  Bisher waren solche Debugging-Arten in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">imgix</a> relativ selten, wurden jedoch weiterhin verwendet, insbesondere bei Problemen mit verz√∂gerungsempfindlichen Debugging-Anwendungen. <br><br>  Im Folgenden finden Sie beispielsweise eine analytische Beschreibung eines dieser Vorf√§lle im Jahr 2015.  Fehler 400 trat so selten auf, dass er beim Versuch, das Problem zu reproduzieren, fast nicht gesehen wurde.  Sie erschien in nur wenigen F√§llen von einer Milliarde.  Tags√ºber gab es nur sehr wenige.  Infolgedessen stellte sich heraus, dass es einfach unm√∂glich war, das Problem zuverl√§ssig zu reproduzieren. Daher war es erforderlich, das Debuggen mithilfe des Arbeitsverkehrs durchzuf√ºhren, um das Auftreten dieses Fehlers verfolgen zu k√∂nnen.  Das hat mein ehemaliger Kollege dazu geschrieben: <br><br>  <i>‚ÄûIch habe eine Bibliothek ausgew√§hlt, die intern sein sollte, aber letztendlich musste ich meine eigene basierend auf der vom System bereitgestellten Bibliothek erstellen.</i>  <i>In der vom System bereitgestellten Version trat regelm√§√üig ein Fehler auf, der bei geringem Datenverkehr in keiner Weise auftrat.</i>  <i>Der abgeschnittene Name im Titel war jedoch das eigentliche Problem.</i> <i><br><br></i>  <i>In den n√§chsten zwei Tagen habe ich das Problem im Zusammenhang mit der erh√∂hten H√§ufigkeit falscher Fehler 400 eingehend untersucht. Der Fehler hat sich in einer sehr geringen Anzahl von Anforderungen manifestiert, und Probleme dieser Art sind schwer zu diagnostizieren.</i>  <i>All dies sah aus wie die ber√ºchtigte Nadel im Heuhaufen: Das Problem trat in einem Fall pro Milliarde auf.</i> <i><br><br></i>  <i>Der erste Schritt beim Auffinden der Fehlerquelle bestand darin, alle HTTP-Rohanforderungsdaten abzurufen, die zu einer falschen Antwort f√ºhrten.</i>  <i>Um einen Tee-Test des eingehenden Datenverkehrs bei Verbindung mit einem Socket durchzuf√ºhren, habe ich dem Render-Server den Unix-Domain-Socket-Endpunkt hinzugef√ºgt.</i>  <i>Die Idee war, es uns zu erm√∂glichen, den Fluss des dunklen Verkehrs schnell und einfach ein- und auszuschalten und Tests direkt auf dem Computer des Entwicklers durchzuf√ºhren.</i>  <i>Um Produktionsprobleme zu vermeiden, musste die Verbindung unterbrochen werden, wenn ein Gegendruckproblem auftrat.</i>  <i>Das hei√üt,</i>  <i>Wenn das Duplikat die Aufgabe nicht bew√§ltigen konnte, wurde die Verbindung getrennt.</i>  <i>Dieser Sockel war in einigen F√§llen w√§hrend der Entwicklung sehr n√ºtzlich.</i>  <i>Dieses Mal haben wir es jedoch verwendet, um eingehenden Datenverkehr auf den ausgew√§hlten Servern zu sammeln, in der Hoffnung, gen√ºgend Anforderungen zu erhalten, um das Muster aufzudecken, das zum Auftreten falscher Fehler 400 f√ºhrte. Mit dsh und netcat konnte ich den eingehenden Datenverkehr relativ einfach in eine lokale Datei ausgeben .</i> <i><br><br></i>  <i>Der gr√∂√üte Teil der Umgebung wurde f√ºr das Sammeln dieser Daten aufgewendet.</i>  <i>Sobald wir genug Daten hatten, konnte ich Netcat verwenden, um sie auf dem lokalen System abzuspielen, dessen Konfiguration ge√§ndert wurde, um eine gro√üe Menge an Debugging-Informationen anzuzeigen.</i>  <i>Und alles lief perfekt.</i>  <i>Der n√§chste Schritt besteht darin, die Daten mit der h√∂chstm√∂glichen Geschwindigkeit abzuspielen.</i>  <i>In diesem Fall hat die Schleife mit der Bedingungspr√ºfung die Rohanforderungen einzeln gesendet.</i>  <i>Nach ungef√§hr zwei Stunden gelang es mir, das gew√ºnschte Ergebnis zu erzielen.</i>  <i>Die Daten in den Protokollen zeigten das Fehlen eines Headers!</i> <i><br><br></i>  <i>Ich benutze rot-schwarzes Holz, um die √úberschriften zu √ºbermitteln.</i>  <i>Solche Strukturen betrachten Vergleichbarkeit als Identit√§t, was an sich sehr n√ºtzlich ist, wenn besondere Anforderungen an Schl√ºssel gestellt werden: In unserem Fall wurde bei den HTTP-Headern nicht zwischen Gro√ü- und Kleinschreibung unterschieden.</i>  <i>Zuerst dachten wir, dass das Problem im Blattknoten der verwendeten Bibliothek liegt.</i>  <i>Die Reihenfolge der Addition wirkt sich wirklich auf die Reihenfolge der Konstruktion des Basisbaums aus, und das Ausbalancieren des rot-schwarzen Baums ist ein ziemlich komplizierter Prozess.</i>  <i>Und obwohl diese Situation unwahrscheinlich war, war es nicht unm√∂glich.</i>  <i>Ich wechselte zu einer anderen Implementierung aus rotem Ebenholz.</i>  <i>Es wurde vor einigen Jahren behoben, daher habe ich beschlossen, es direkt in die Quelle einzubetten, um genau die Version zu erhalten, die ben√∂tigt wurde.</i>  <i>Trotzdem hat die Baugruppe eine andere Version gew√§hlt, und da ich mit einer neueren Version gerechnet habe, habe ich am Ende ein falsches Verhalten festgestellt.</i> <i><br><br></i>  <i>Aus diesem Grund erzeugte das Visualisierungssystem 500 Fehler, die zur Unterbrechung des Zyklus f√ºhrten.</i>  <i>Aus diesem Grund trat der Fehler nur im Laufe der Zeit auf.</i>  <i>Nach der zyklischen Verarbeitung mehrerer Assemblys wurde der Datenverkehr von diesen auf eine andere Route umgeleitet, was das Ausma√ü des Problems auf diesem Server erh√∂hte.</i>  <i>Meine Annahme, dass das Problem in der Bibliothek lag, stellte sich als falsch heraus, und der R√ºckw√§rtsschalter l√∂ste 500 Fehler.</i> <i><br><br></i>  <i>Ich kehrte zu 400 Fehlern zur√ºck: Es gab immer noch ein Problem mit dem Fehler, dessen Erkennung etwa zwei Stunden dauerte.</i>  <i>Das √Ñndern der Bibliothek l√∂ste das Problem offensichtlich nicht, aber ich war mir sicher, dass die ausgew√§hlte Bibliothek zuverl√§ssig genug war.</i>  <i>Da ich den Irrtum der Wahl nicht erkannte, √§nderte ich nichts.</i>  <i>Nachdem ich die Situation genauer untersucht hatte, stellte ich fest, dass der richtige Wert in einem einstelligen Header gespeichert war (z. B. ‚Äûh: 12345‚Äú).</i>  <i>Endlich wurde mir klar, dass h das nachfolgende Zeichen des Content-Length-Headers ist.</i>  <i>Beim erneuten Betrachten der Daten stellte ich fest, dass der Header f√ºr die Inhaltsl√§nge leer war.</i> <i><br><br></i>  <i>Infolgedessen war das Ganze beim Lesen der Header ein Bias-Fehler von eins.</i>  <i>Der nginx / joyent HTTP-Analysator erstellt Teildaten, und jedes Mal, wenn sich herausstellte, dass das Teilheaderfeld ein Zeichen k√ºrzer als erforderlich war, habe ich den Header ohne Wert gesendet und anschlie√üend ein einstelliges Headerfeld mit dem richtigen Wert empfangen.</i>  <i>Dies ist eine eher seltene Kombination, daher dauert der Betrieb so lange.</i>  <i>Daher habe ich die Datenerfassung jedes Mal erh√∂ht, wenn ein Header mit einem Zeichen angezeigt wurde, den vorgeschlagenen Fix angewendet und das Skript mehrere Stunden lang erfolgreich ausgef√ºhrt.</i> <i><br></i>  <i>Nat√ºrlich konnten einige andere Fallstricke mit der erw√§hnten Fehlfunktion der Bibliothek erkannt werden, aber beide Fehler wurden behoben. ‚Äú</i> <i><br></i> <br><br>  Ingenieure, die an der Entwicklung verz√∂gerungsempfindlicher Anwendungen beteiligt sind, m√ºssen in der Lage sein, mithilfe des erfassten dynamischen Datenverkehrs zu debuggen, da h√§ufig Fehler auftreten, die beim Testen von Einheiten nicht reproduziert oder mit einem √úberwachungstool erkannt werden k√∂nnen (insbesondere, wenn die Protokollierung erheblich verz√∂gert wird). <br><br><h3>  Chaos Engineering Ansatz </h3><br>  <i>Chaos Engineering ist ein Ansatz, der auf Experimenten mit einem verteilten System basiert, um seine F√§higkeit zu best√§tigen, den chaotischen Bedingungen der Produktionsumgebung standzuhalten.</i> <br><br>  Die Chaos Engineering-Methode, die erstmals durch Netflix ' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Chaos Monkey bekannt wurde</a> , ist jetzt eine eigenst√§ndige Disziplin.  Der Begriff Chaos Engineering tauchte k√ºrzlich auf, aber Fehlertests sind eine langj√§hrige Praxis. <br><br>  Der Begriff "chaotisches Testen" bezieht sich auf die folgenden Techniken: <br><br><ul><li>  Deaktivieren Sie beliebige Knoten, um festzustellen, wie widerstandsf√§hig das System gegen Ausf√§lle ist. </li><li>  Einf√ºhren von Fehlern (z. B. Erh√∂hen der Verz√∂gerung), um zu best√§tigen, dass das System sie korrekt verarbeitet; </li><li>  erzwungene Verletzung des Netzwerks, um die Antwort des Dienstes zu bestimmen. </li></ul><br>  Die meisten Unternehmen verwenden eine unzureichend komplexe und abgestufte Betriebsumgebung, um chaotische Tests effektiv durchzuf√ºhren.  Es ist wichtig zu betonen, dass die Einf√ºhrung von Fehlern im System am besten nach dem Einstellen der Grundfunktionen der Fehlertoleranz erfolgt.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dieses</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Gremlin-</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Whitepaper</a> enth√§lt eine ziemlich umfassende Beschreibung der chaotischen Testprinzipien sowie Anweisungen zur Vorbereitung auf dieses Verfahren. <br><br>  <i>‚ÄûBesonders wichtig ist die Tatsache, dass Chaos Engineering als wissenschaftliche Disziplin gilt.</i>  <i>Innerhalb dieser Disziplin werden hochpr√§zise technische Verfahren angewendet.</i> <i><br></i>  <i>Die Aufgabe von Chaos Engineering ist <b>es,</b> Benutzern durch Experimente etwas Neues √ºber die Schwachstellen des Systems <b>zu erz√§hlen</b> .</i>  <i>Es ist notwendig, alle versteckten Probleme zu identifizieren, die in der Produktion auftreten k√∂nnen, noch bevor sie einen massiven Ausfall verursachen.</i>  <i>Erst danach k√∂nnen Sie alle Schwachstellen im System effektiv beseitigen und es wirklich fehlertolerant machen. ‚Äú</i> <br><br><h2>  Fazit </h2><br>  Der Zweck des Testens in der Produktion besteht nicht darin <i>,</i> alle m√∂glichen Fehler im System vollst√§ndig zu <i>beseitigen</i> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">John Allspaw</a> sagt: <br>  <i>‚Äû <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wir sehen, dass</a> Systeme fehlertoleranter werden - und das ist gro√üartig.</i>  <i>Aber wir m√ºssen zugeben: "mehr und mehr" ist nicht gleich "absolut".</i>  <i>In jedem komplexen System kann (und wird) ein Fehler auf unvorhersehbare Weise auftreten. ‚Äú</i> <i><br></i> <br>  Das Testen in der Produktion scheint auf den ersten Blick eine ziemlich komplizierte Aufgabe zu sein, die weit √ºber die Kompetenz der meisten Ingenieurb√ºros hinausgeht.  Und obwohl solche Tests <i>keine leichte</i> Aufgabe sind, die mit einigen Risiken verbunden ist, hilft es, wenn Sie alle Regeln befolgen, die Zuverl√§ssigkeit komplexer verteilter Systeme zu erreichen, die heute √ºberall zu finden sind. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de418329/">https://habr.com/ru/post/de418329/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de418317/index.html">2048 ist verboten. Nicht RosKomNadzor</a></li>
<li><a href="../de418319/index.html">Gau√ü-LED-Lampen 2017-2018</a></li>
<li><a href="../de418321/index.html">Photonen-Zufallszahlengenerator: Die zuverl√§ssigste Verschl√ºsselung?</a></li>
<li><a href="../de418323/index.html">Ein wenig √ºber die Attribute der Hosts, Tastatur, Code und SCS in der Serie "World of the Wild West" (Westworld)</a></li>
<li><a href="../de418327/index.html">Schuhmacher mit Stiefeln: Welche Smartphones w√§hlen Experten f√ºr sich</a></li>
<li><a href="../de418331/index.html">Meister der Server und Netzwerke - sch√∂ne Ferien</a></li>
<li><a href="../de418333/index.html">Uber-Roboter kehren auf die Stra√üe zur√ºck, aber die Leute werden sie fahren</a></li>
<li><a href="../de418335/index.html">Konfrontation bei Positive Hack Days 8: Parsen von Angriffsketten</a></li>
<li><a href="../de418337/index.html">Hei√ü, Summer DataGrip 2018.2</a></li>
<li><a href="../de418339/index.html">"Manueller" Manipulator</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>