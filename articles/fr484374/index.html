<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚ÄçüöÄ üç≠ üë®üèª‚Äçüéì Voyage au centre ... image docker. Ou comment t√©l√©charger une image du registre sans docker üëü üç© üë¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="3 jours avant la nouvelle ann√©e il y avait une t√¢che pour transf√©rer notre logiciel au client via le manager, sur un lecteur flash. Le logiciel est un...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Voyage au centre ... image docker. Ou comment t√©l√©charger une image du registre sans docker</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484374/"><p>  3 jours avant la nouvelle ann√©e il y avait une t√¢che pour transf√©rer notre logiciel au client via le manager, sur un lecteur flash.  Le logiciel est une plate-forme de microservice avec des dizaines d'images Docker avec de nombreux param√®tres et un graphique de barre d'un kilom√®tre.  Ce que nous avions: </p><br><ul><li>  Manager √† Moscou (je ne suis pas de l√†) </li><li>  Windows </li><li>  Il n'y a pas d'interaction directe (et si c'√©tait le cas, cela n'a pas vraiment aid√©) </li><li>  docker non </li></ul><br><p>  Pff, je pensais!  Je vais prendre Golang, √©crire un programme, compiler pour Windows. <br>  ... et 5 heures plus tard, j'ai r√©alis√© la h√¢te de mes conclusions.  √Ä ce moment, le rire de Nelson se rappela pour la premi√®re fois.  HA HA  Ce qui m'a hant√© tout le temps que j'ai pass√© √† √©tudier la question. <a name="habracut"></a></p><br><p>  La plupart des exemples que j'ai trouv√©s n√©cessitent dockerd.  Deux scripts qui n'utilisent pas dockerd, qui ont √©t√© trouv√©s apr√®s une heure de recherche sur Google, <a href="" rel="nofollow">un</a> et <a href="https://github.com/NotGlop/docker-drag" rel="nofollow">deux</a> .  La premi√®re option m'a aid√© √† comprendre le processus d'obtention de toutes les couches d'images et des fichiers de configuration, mais il est impossible de l'utiliser avec Windows.  Et la deuxi√®me option a indiqu√© que ce n'√©tait pas seulement que divers hachages scintillaient sur l'√©cran, en particulier ce <a href="https://github.com/NotGlop/docker-drag/blob/69b2bae59c6c0a5cbdf224feb9c067e3edcc6068/docker_pull.py" rel="nofollow">FIXME</a> .  On pourrait bien s√ªr s'arr√™ter l√†, √ßa marche!  Le transfert pour aller n'est pas difficile.  Mais comment v√©rifier que les images du gestionnaire se sont r√©v√©l√©es √™tre sous la m√™me forme que dans notre registre?  Mais pas question!  Par cons√©quent, je viens de t√©l√©charger des images vers le stockage partag√©, t√©l√©charg√©es √† l'aide de la commande docker save et partag√© le lien.  Et calm√© √† ce sujet. </p><br><p>  Le quatri√®me jour des vacances, assez fatigu√© d'eux, l'id√©e de t√©l√©charger et d'assembler correctement l'image docker m'a de nouveau d√©pass√©, et j'ai plong√© dans le code <a href="https://github.com/moby/moby" rel="nofollow">moby</a> pendant quelques heures. </p><br><p>  Ce que j'avais cette fois: </p><br><ul><li>  Comprendre comment obtenir toutes les couches </li></ul><br><p>  Prenant Python "en main" et bas√© sur ce <a href="https://github.com/NotGlop/docker-drag" rel="nofollow">script</a> , j'ai d√©cid√© de le corriger.  Le deuxi√®me jour, j'ai d√©cid√© d'√©crire un script √† partir de z√©ro.  En me souvenant de mon artisanat pour l'oaut-autorisation, j'ai simplement copi√© une partie du code √† partir de l√†, ainsi que les d√©veloppements d√©j√† effectu√©s par moi lors de l'√©dition du script.  Il n'y a eu aucun probl√®me d'autorisation et de t√©l√©chargement de ces donn√©es, mais des questions se sont pos√©es: </p><br><ul><li>  quels sont les hachages affich√©s lors de l'ex√©cution de la commande docker pull? </li><li>  quels sont les hachages utilis√©s pour nommer les r√©pertoires √† l'int√©rieur de l'archive d'image? </li><li>  Comment construire une archive tar pour que la somme de contr√¥le corresponde √† l'image d'origine? </li></ul><br><p> Pour √©tudier, j'ai choisi une image ubuntu: 18.04 <br>  image sha256sum enregistr√©e via <code>docker save</code> - 257cab9137419a53359d0ed76f680fe926ed3645238357bdcdb84070a8f26cd0. </p><br><pre> <code class="plaintext hljs">&gt; docker pull ubuntu:18.04 18.04: Pulling from library/ubuntu 2746a4a261c9: Downloading [==============&gt; ] 6.909MB/26.69MB 4c1d20cdee96: Download complete 0d3160e1d0de: Download complete c8e37668deea: Download complete Digest: sha256:250cc6f3f3ffc5cdaa9d8f4946ac79821aafb4d3afc93928f0de9336eba21aa4 Status: Downloaded newer image for ubuntu:18.04 docker.io/library/ubuntu:18.04</code> </pre> <br><p>  <strong>Contenu de l'archive d'images</strong> </p><br><pre> <code class="plaintext hljs">tar tvf ubuntu.tar drwxr-xr-x 0 root root 0 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/ -rw-r--r-- 0 root root 3 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/VERSION -rw-r--r-- 0 root root 477 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/json -rw-r--r-- 0 root root 991232 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/layer.tar drwxr-xr-x 0 root root 0 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/ -rw-r--r-- 0 root root 3 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/VERSION -rw-r--r-- 0 root root 477 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/json -rw-r--r-- 0 root root 15872 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/layer.tar -rw-r--r-- 0 root root 3411 Dec 19 11:21 549b9b86cb8d75a2b668c21c50ee092716d070f129fd1493f95ab7e43767eab8.json drwxr-xr-x 0 root root 0 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/ -rw-r--r-- 0 root root 3 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/VERSION -rw-r--r-- 0 root root 1264 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/json -rw-r--r-- 0 root root 3072 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/layer.tar drwxr-xr-x 0 root root 0 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/ -rw-r--r-- 0 root root 3 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/VERSION -rw-r--r-- 0 root root 401 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/json -rw-r--r-- 0 root root 65571328 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/layer.tar -rw-r--r-- 0 root root 432 Jan 1 1970 manifest.json -rw-r--r-- 0 root root 88 Jan 1 1970 repositories</code> </pre> <br><p>  <strong>Configuration d'image</strong> </p><br><pre> <code class="json hljs">{ ... <span class="hljs-attr"><span class="hljs-attr">"rootfs"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"layers"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"diff_ids"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"sha256:2dc9f76fb25b31e0ae9d36adce713364c682ba0d2fa70756486e5cedfaf40012"</span></span>, <span class="hljs-string"><span class="hljs-string">"sha256:9f3bfcc4a1a8a676da07287a1aa6f2dcc8e869ea6f054c337593481a5bb1345e"</span></span>, <span class="hljs-string"><span class="hljs-string">"sha256:27dd43ea46a831c39d224e7426794145fba953cd7309feccf4d5ea628072f6a2"</span></span>, <span class="hljs-string"><span class="hljs-string">"sha256:918efb8f161b4cbfa560e00e8e0efb737d7a8b00bf91bb77976257cd0014b765"</span></span> ] } ... }</code> </pre> <br><p>  La premi√®re question a √©t√© r√©gl√©e assez rapidement, la documentation <a href="" rel="nofollow">https://github.com/opencontainers/image-spec/blob/master/config.md a</a> aid√©.  Les hachages qui apparaissent lorsque vous ex√©cutez la commande docker pull sont des identificateurs de cha√Æne calcul√©s √† partir de la liste diff_ids du manifeste image-config, o√π le premier chainID est toujours le premier de la liste diff_ids et les suivants sont des sommes de hachage de la cha√Æne <code>(chain_id[i-1] + " " + diff_id[i])</code> .  Code pour construire chainID chainID: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chain_ids</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ids: list)</span></span></span><span class="hljs-function"> -&gt; list:</span></span> chain = list() chain.append(ids[<span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(ids) &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ids nxt = list() nxt.append(<span class="hljs-string"><span class="hljs-string">"sha256:"</span></span> + hashlib.sha256(<span class="hljs-string"><span class="hljs-string">f'</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{ids[</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">0</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{ids[</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">1</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">'</span></span>.encode()).hexdigest()) nxt.extend(ids[<span class="hljs-number"><span class="hljs-number">2</span></span>:]) chain.extend(chain_ids(nxt)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> chain</code> </pre> <br><p>  L'ajout d'un pr√©fixe avec le nom de l'algorithme, dans ce cas "sha256:", est obligatoire et est inclus dans les exigences de la norme opencontainers, c'est-√†-dire  la cha√Æne doit √™tre de la forme "algorithme: hachage". </p><br><p>  Il a pass√© deux soir√©es sur une question sur la fa√ßon de nommer un r√©pertoire.  Pendant assez longtemps, j'ai regard√© le code source de docker-daemon et Oh!  un miracle!  J'ai r√©ussi √† trouver le code de g√©n√©ration <a href="" rel="nofollow">ici</a> et <a href="" rel="nofollow">ici</a> .  Pour g√©n√©rer le nom du r√©pertoire, vous devez calculer le hachage √† partir de la configuration de la couche json.  Docker a plusieurs versions de configuration et avant le moteur Docker 1.9, les configurations de la version v1 √©taient utilis√©es.  Aussit√¥t dit, aussit√¥t fait!  Et encore une fois, la silhouette de Nelson se pose.  Apr√®s un bref d√©bogage, j'ai r√©alis√© que le probl√®me se cachait dans la g√©n√©ration de json.  En Python, l'ordre des donn√©es dans un dictionnaire peut diff√©rer de l'ordre des donn√©es dans json g√©n√©r√© √† partir de ce dictionnaire.  L'ordre des donn√©es dans json sera diff√©rent et, par cons√©quent, son hachage sera √©galement diff√©rent.  Je devais aller √† OrderedDict, pr√©-enregistrer la commande de donn√©es souhait√©e en eux.  Cela a augment√© la taille du code d'une fois et demie. </p><br><p>  Il semble que tout soit corrig√©, je lance le script et ... quelque part au fond, le fameux HA-HA appara√Æt!  Le dernier hachage ne correspond pas.  Encore une fois, j'√©tudie le code et <a href="" rel="nofollow">vois</a> , et ceci est une autre v1-config contenant toutes les informations sur l'image, qui peuvent √™tre vues en utilisant la <code>docker inspect</code> .  Ajoutez un autre OrderDict sp√©cialement pour lui, compl√©tez le code et ... HA HA! <br>  Il √©tait d√©j√† 5 heures du matin et ma t√™te ne r√©fl√©chissait pas vraiment, donc apr√®s le sommeil, je suis retourn√© voir le code.  La lecture r√©p√©t√©e du code de g√©n√©ration est tomb√©e sur une <a href="" rel="nofollow">ligne</a> .  Comme j'√©tais content de voir √ßa.  Avant de la voir, j'avais pens√© √† construire mon docker avec <del>  Jack noir et </del>  enregistrement des donn√©es.  J'active le d√©bogage, j'ex√©cute la <code>docker save</code> et ... ce n'est pas du tout ridicule, dans docker-desktop pour mac os il y a une limite sur la longueur de la ligne dans le journal de 947 caract√®res et la configuration g√©n√©r√©e passe √† <code>\"</code> . Apr√®s avoir effectu√© toutes ces √©tapes sous Linux, j'ai r√©ussi √† obtenir la configuration couche de la premi√®re version, sur la base de laquelle j'ai √©crit le code, et j'ai r√©ussi √† obtenir le hachage souhait√© de la derni√®re couche. Les hachages pour tous les fichiers sont les m√™mes, les r√©pertoires sont nomm√©s de la m√™me mani√®re que l'image d'origine. Il est temps de collecter l'archive tar ... </p><br><p>  La taille du fichier ne correspond pas, lisez <a href="" rel="nofollow">https://github.com/opencontainers/image-spec/blob/master/layer.md</a> et le format d' <a href="https://www.gnu.org/software/tar/manual/html_node/Standard.html" rel="nofollow">archive tar</a> .  <a href="https://github.com/python/cpython/blob/f04750bb7af45cb6efab8d92d1ff063f0bf2833d/Lib/tarfile.py" rel="nofollow">La valeur par d√©faut est</a> 10240 octets, et la taille de l'archive que j'ai collect√©e est sup√©rieure de 9216 octets.  Au d√©but, je pensais qu'il √©tait n√©cessaire de r√©duire la taille du bloc √† 1024 octets, ce qui s'est av√©r√© incorrect et, par cons√©quent, la taille du bloc de 512 octets √©galisait la taille des archives. </p><br><pre> <code class="python hljs">tarfile.RECORDSIZE = <span class="hljs-number"><span class="hljs-number">512</span></span></code> </pre> <br><p>  La premi√®re ligne de l'archive nouvellement cr√©√©e contient le dossier racine "/".  Cette option ne convient pas, par cons√©quent, je compl√®te le code en scannant le contenu du dossier et en l'ajoutant individuellement √† l'archive, apr√®s l'avoir pr√©alablement tri√©. </p><br><p>  Enfin, nous avons r√©ussi √† obtenir la m√™me taille de fichier, un aspect uniforme des r√©pertoires, mais ce n'est pas tout.  Les fichiers et r√©pertoires, √† l'exception de manifest.json et respoitories, dans l'archive doivent avoir des attributs st_atime, st_mtime √©gal √† st_ctime.  Pour les fichiers manifest.json et respoitories, les attributs st_atime, st_mtime et st_ctime doivent √™tre dat√©s du d√©but de l'√®re <code>1970-01-01 00:00</code> .  Toutes les dates doivent √™tre d√©finies en fonction du fuseau horaire, respectivement.  Depuis que j'ai effectu√© tout le travail sous mac os, j'ai remarqu√© une diff√©rence.  Lors de l'enregistrement de l'image sous Linux, la liste des fichiers dans l'archive ressemblait √† ceci: </p><br><pre> <code class="plaintext hljs">tar tvf ubuntu.tar drwxr-xr-x 0/0 0 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/ -rw-r--r-- 0/0 3 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/VERSION -rw-r--r-- 0/0 477 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/json -rw-r--r-- 0/0 991232 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/layer.tar drwxr-xr-x 0/0 0 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/ -rw-r--r-- 0/0 3 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/VERSION -rw-r--r-- 0/0 477 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/json -rw-r--r-- 0/0 15872 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/layer.tar -rw-r--r-- 0/0 3411 Dec 19 11:21 549b9b86cb8d75a2b668c21c50ee092716d070f129fd1493f95ab7e43767eab8.json drwxr-xr-x 0/0 0 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/ -rw-r--r-- 0/0 3 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/VERSION -rw-r--r-- 0/0 1264 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/json -rw-r--r-- 0/0 3072 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/layer.tar drwxr-xr-x 0/0 0 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/ -rw-r--r-- 0/0 3 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/VERSION -rw-r--r-- 0/0 401 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/json -rw-r--r-- 0/0 65571328 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/layer.tar -rw-r--r-- 0/0 432 Jan 1 1970 manifest.json -rw-r--r-- 0/0 88 Jan 1 1970 repositories</code> </pre> <br><p>  Contrairement √† la liste au d√©but de l'article, sous Linux, l'archive est enregistr√©e avec l'indicateur num√©rique uniquement.  Il y a deux variables dans l'objet tarinfo responsables de cela, tarinfo.uname et tarinfo.gname.  Et le deuxi√®me probl√®me avec mac os est l'absence d'un groupe racine, il est corrig√© en utilisant la variable tarinfo.gid dans le m√™me objet tarinfo.  Eh bien, tout semble cr√©er une archive ... </p><br><p><img src="https://habrastorage.org/webt/hp/p8/pl/hpp8plcgi09ybuarim4bb5awcga.jpeg"></p><br><p>  Pour tous les fichiers, le hachage converge, les noms des r√©pertoires et des fichiers sont les m√™mes, les attributs st_atime, st_mtime et st_ctime convergent avec l'original, les droits sur les fichiers sont exactement les m√™mes.  L'ouverture des deux archives dans un √©diteur hexad√©cimal a vu une l√©g√®re diff√©rence: </p><br><p><img src="https://habrastorage.org/webt/qc/j6/xm/qcj6xmv9ghzaesgeaaq5owvaxnm.png"><br>  La fen√™tre sup√©rieure est l'original, l'archive inf√©rieure que j'ai collect√©e. </p><br><p>  Comprendre le format tar.  Apr√®s le nom du r√©pertoire est la valeur des droits sur le fichier (rectangle orange).  La diff√©rence est que les informations sur l'objet ajout√© √† l'archive ne sont pas ajout√©es aux droits de r√©pertoire.  Une valeur de 40755 indiqu√©e dans les droits indique qu'il s'agit d'un r√©pertoire avec des autorisations de 755 et 100644 est un fichier avec des autorisations de 644. Le rectangle rouge est une cha√Æne magique et √† en juger par le code <code>ustar\000</code> cha√Æne magique <code>ustar\000</code> , il est utilis√© uniquement aux formats PAX et USTAR.  Le format PAX ne convient pas du tout, il utilise un type sp√©cial d'en-t√™te.  Le rectangle bleu est une somme de contr√¥le et il diff√®re en raison de l'utilisation de diff√©rents formats pour les droits d'√©criture sur un fichier et un en-t√™te magique. </p><br><p>  Je mets le format d'archive sur USTAR, mais on ne sait pas quoi faire avec l'enregistrement des autorisations de fichier.  Ici et <a href="https://github.com/python/cpython/blob/f04750bb7af45cb6efab8d92d1ff063f0bf2833d/Lib/tarfile.py" rel="nofollow">ici, la</a> magie op√®re pour moi, je n'ai jamais travaill√© avec le syst√®me octal et je ne comprends pas pourquoi l'esperluette est n√©cessaire ici (peut-√™tre que quelqu'un dans les commentaires partagera ses connaissances).  J'ai d√ª ajouter plusieurs impressions pour voir quelles donn√©es arrivent avec des arguments et quelles donn√©es sont utilis√©es pour former le bloc d'archives.  Prenant un entier de la deuxi√®me position du bloc de donn√©es, il √©tait 16877, et le menant au calcul octal, il s'est av√©r√© que cette valeur est <code>0o40755</code> , ce qui est <code>0o40755</code> ce dont j'ai besoin.  En rempla√ßant simplement les fonctions get_info et _create_header, en supprimant <code>&amp; 0o7777</code> (rien d'autre ne m'est venu √† l'esprit), j'ai r√©ussi √† collecter une archive tar avec un hachage sha256 qui co√Øncidait avec l'original. </p><br><p>  PS Lors de la r√©daction d'un article, l'image d'ubuntu a √©t√© mise √† jour: 18.04 sur hub.docker.com.  J'ai donc d√ª t√©l√©charger l'image sur Digest.  Les sommes de hachage ne correspondent plus √† l'original car Digest a √©t√© √©crit √† la place de la balise, sinon ce sont des images identiques. </p><br><p>  La deuxi√®me d√©couverte pour moi a √©t√© l'absence d'un fichier de r√©f√©rentiels dans l'archive lors de l'enregistrement d'une image avec une balise manquante √† l'aide de la <code>docker save</code> . </p><br><p>  Code de travail complet ici: <a href="https://github.com/myback/docker_pull" rel="nofollow">https://github.com/myback/docker_pull</a> </p><br><p>  L'image de Nelson Manz, ainsi que son rire ¬´HA-HA¬ª est la propri√©t√© de FOX :) </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr484374/">https://habr.com/ru/post/fr484374/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr484358/index.html">Gestion de portefeuille en R</a></li>
<li><a href="../fr484364/index.html">√Ä 26 ans, Yana Harlan dirige le d√©veloppement d'un moteur spatial. L'ann√©e prochaine, ils pr√©voient de le lancer.</a></li>
<li><a href="../fr484368/index.html">Comment j'ai fait un moteur de recherche pour Telegram</a></li>
<li><a href="../fr484370/index.html">Slurm SRE - apprenez √† assurer le bonheur des utilisateurs</a></li>
<li><a href="../fr484372/index.html">Maison intelligente avec Xiaomi sur l'exemple d'un sauna</a></li>
<li><a href="../fr484376/index.html">Samsung Moscow Center for Artificial Intelligence in stories des employ√©s</a></li>
<li><a href="../fr484378/index.html">SwayWM - UnixPorn vous-m√™me</a></li>
<li><a href="../fr484380/index.html">D√©m√©nagement - le si√®cle dernier! Alternatives √† std :: move dans ¬´C ++ of the Future¬ª</a></li>
<li><a href="../fr484382/index.html">Algorithme de Bellman-Ford</a></li>
<li><a href="../fr484386/index.html">Meetup AWS_Ru √† Raiffeisenbank</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>