<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßïüèæ üë®‚Äçüë©‚Äçüëß‚Äçüë¶ ü§∏üèº TDE en Apache Ignite: una historia importante en un gran proyecto de c√≥digo abierto ü•ù ü§∞üèº üå∞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Muchas organizaciones, especialmente las financieras, tienen que lidiar con varios est√°ndares de seguridad, por ejemplo, PCI DSS. Dichas certificacion...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>TDE en Apache Ignite: una historia importante en un gran proyecto de c√≥digo abierto</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440808/">  Muchas organizaciones, especialmente las financieras, tienen que lidiar con varios est√°ndares de seguridad, por ejemplo, PCI DSS.  Dichas certificaciones requieren cifrado de datos.  Cifrado de datos transparente en el disco El cifrado de datos transparente se implementa en muchos DBMS industriales. <br><br>  Apache Ignite se usa en bancos, por lo tanto, se decidi√≥ implementar TDE en √©l. <br><br>  Describir√© c√≥mo desarrollamos TDE a trav√©s de la comunidad, p√∫blicamente, a trav√©s de los procesos de Apachev. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/BOJ-0N8VnDw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  A continuaci√≥n se muestra una versi√≥n de texto del informe: <br><br>  Tratar√© de hablar sobre arquitectura, sobre la complejidad del desarrollo, c√≥mo se ve realmente en c√≥digo abierto. <br><br><h3>  ¬øQu√© se ha hecho y qu√© queda por hacer? </h3><br>  Actualmente implementado Apache Ignite TDE.  Fase 1 <br><br>  Incluye las caracter√≠sticas b√°sicas de trabajar con cach√©s cifradas: <br><br><ul><li> Gesti√≥n de claves </li><li>  Crear cach√©s cifrados </li><li>  Guardar todos los datos de cach√© en el disco en forma cifrada </li></ul><br>  En la Fase 2, se planea habilitar la posibilidad de rotaci√≥n (cambio) de la clave maestra. <br>  En la Fase 3, la capacidad de rotar claves de cach√©. <br><br><h3>  Terminolog√≠a </h3><br><ul><li>  Cifrado de datos transparente: cifrado de datos transparente (para el usuario) cuando se guarda en el disco.  En el caso de Ignite, cifrado de cach√©, porque Ignite se trata de cach√©s. </li><li>  Encender cach√©: cach√© de valor clave en Apache Ignite.  Los datos de cach√© se pueden guardar en el disco </li><li>  P√°ginas: p√°ginas de datos.  En Ignite, todos los datos est√°n paginados.  Las p√°ginas se escriben en el disco y deben estar encriptadas. </li><li>  WAL: escribe el registro con antelaci√≥n.  Todos los cambios de datos en Ignite se guardan all√≠, todas las acciones que realizamos para todos los cach√©s. </li><li>  Keystore: almac√©n de claves est√°ndar de Java, generado por Keytool Javascript.  Funciona y est√° certificado en todas partes, lo usamos. </li><li>  Master key - llave maestra.  Al usarlo, las claves de las tablas se cifran, las claves de cifrado de cach√©.  Almacenado en el almac√©n de claves de Java. </li><li>  Claves de cach√©: claves con las que los datos se cifran realmente.  Junto con la clave maestra, se obtiene una estructura de dos niveles.  La clave maestra se almacena por separado del cach√© de claves y los datos maestros, por motivos de seguridad, separaci√≥n de derechos de acceso, etc. </li></ul><br><h3>  Arquitectura </h3><br>  Todo se implementa de acuerdo con el siguiente esquema: <br><br><ul><li>  Todos los datos de cach√© se cifran con la nueva SPI de cifrado. </li><li>  Por defecto, se utiliza AES, un algoritmo de cifrado industrial. </li><li>  La clave maestra se almacena en un archivo JKS, un archivo est√°ndar de Java para claves. </li></ul><br>  Los bancos y otras organizaciones usan sus propios algoritmos de cifrado: GOST y otros.  Est√° claro que hemos brindado la oportunidad de deslizar nuestro SPI de cifrado, la implementaci√≥n de cifrado que un usuario espec√≠fico necesita. <br><br><h3>  Esquema de trabajo </h3><br><img src="https://habrastorage.org/webt/fr/mv/4v/frmv4vrfmccufua78ppdj4ikj1s.png" alt="imagen"><br><br>  Entonces, tenemos RAM - memoria de acceso aleatorio con p√°ginas que contienen datos puros.  El uso de RAM implica que no estamos protegidos de un pirata inform√°tico que obtuvo acceso de root y descarg√≥ toda la memoria.  Nos protegemos del administrador que toma el disco duro y lo vende en el mercado de Tushino (o donde actualmente se venden datos similares). <br><br>  Adem√°s de las p√°ginas con un cach√©, los datos tambi√©n se almacenan en el registro de escritura anticipada, que escribe en el disco el delta de los registros modificados en la transacci√≥n.  El metastore almacena claves de cifrado de cach√©.  Y en un archivo separado: una clave maestra. <br><br>  Cada vez que se crea una clave para el cach√©, antes de escribir o transferir a la red, encriptamos esta clave utilizando una clave maestra.  Para que nadie pueda obtener la clave de cach√© despu√©s de recibir los datos de Ignite.  Solo robando la clave maestra y los datos puede acceder a ellos.  Esto es poco probable, ya que el acceso a estos archivos requiere varios derechos. <br><br>  El algoritmo de acciones es el siguiente: <br><br><ul><li>  Al comienzo del nodo, reste la clave maestra de jks. </li><li>  Al comienzo de los nodos, lea la meta-tienda y descifre las claves de cach√©. </li><li>  Cuando une nodos en un cl√∫ster: <br>  - Verifique los hashes de la clave maestra. <br>  - Revise las claves para cach√©s compartidos. <br>  - Guardar claves para nuevas cach√©s. <br></li><li>  Al crear una memoria cach√© de forma din√°mica, generamos una clave y la guardamos en la meta tienda. </li><li>  Al leer / escribir una p√°gina, la desciframos / ciframos. </li><li>  Cada entrada WAL para el cach√© encriptado tambi√©n est√° encriptada. </li></ul><br>  Ahora con m√°s detalle: <br><br>  Al comienzo del nodo, tenemos una devoluci√≥n de llamada que inicia nuestro EncryptionSPI.  De acuerdo con los par√°metros, restamos la clave maestra del archivo jks. <br><br>  Luego, cuando metastore est√° listo, obtenemos las claves de cifrado almacenadas.  En este caso, ya tenemos una clave maestra, para que podamos descifrar las claves y obtener acceso a los datos de la cach√©. <br><br>  Por separado, hay un proceso muy interesante: c√≥mo unimos un nuevo nodo en un cl√∫ster.  Ya tenemos un sistema distribuido que consta de varios nodos.  ¬øC√≥mo asegurarse de que el nuevo nodo est√© configurado correctamente, que no sea un atacante? <br><br>  Realizamos estas acciones: <br><br><ul><li>  Cuando llega un nuevo nodo, env√≠a un hash desde la clave maestra.  Parece que coincide con el existente. </li><li>  Luego verificamos las claves para cach√©s compartidas.  Del nodo proviene el identificador de cach√© y la clave de cach√© cifrada.  Los verificamos para asegurarnos de que todos los datos en todos los nodos est√©n encriptados con la misma clave.  Si esto no es as√≠, simplemente no tenemos derecho a dejar que el nodo entre en el cl√∫ster; de lo contrario, viajar√° por claves y datos. </li><li>  Si hay nuevas claves y cach√©s en el nuevo nodo, gu√°rdelas para usarlas en el futuro. </li><li>  Al crear una memoria cach√© din√°micamente, se proporciona una funci√≥n de generaci√≥n de claves.  Lo generamos, lo guardamos en la meta tienda y podemos continuar realizando las operaciones descritas. </li></ul><br>  La segunda parte es una superestructura sobre las operaciones de E / S.  Las p√°ginas se escriben en el archivo de partici√≥n.  Nuestro complemento analiza qu√© cach√© de p√°gina, los encripta en consecuencia y los guarda. <br><br>  Lo mismo vale para WAL.  Hay un serializador que serializa objetos de registro WAL.  Y si el registro es para cach√©s cifradas, entonces debemos cifrarlo y solo luego guardarlo en el disco. <br><br><h3>  Dificultades de desarrollo </h3><br>  Dificultades comunes a todos los proyectos de c√≥digo abierto m√°s o menos complejos: <br><br><ol><li>  Primero debe comprender el dispositivo Ignite por completo.  Por qu√©, qu√© y c√≥mo se hizo all√≠, c√≥mo y en qu√© lugares colocar sus controladores. </li><li>  Es necesario proporcionar compatibilidad con versiones anteriores.  Esto puede ser bastante dif√≠cil, no obvio.  Al desarrollar un producto que otros usan, debe tener en cuenta que los usuarios desean actualizarse sin problemas.  La compatibilidad con versiones anteriores es correcta y buena.  Cuando realiza una mejora tan grande como TDE, cambia las reglas para guardar en el disco, cifra algo.  Y la compatibilidad con versiones anteriores debe ser trabajada. </li><li>  Otro punto no obvio est√° relacionado con la distribuci√≥n de nuestro sistema.  Cuando diferentes clientes intentan crear el mismo cach√©, debe aceptar la clave de cifrado, ya que de forma predeterminada se generar√°n dos diferentes.  Hemos resuelto este problema.  No me detendr√© en m√°s detalles: la soluci√≥n merece una publicaci√≥n separada.  Ahora estamos garantizados para usar una clave. </li><li>  La siguiente cosa importante condujo a grandes mejoras, cuando parec√≠a que todo estaba listo (¬øuna historia familiar?) :).  El cifrado tiene sobrecarga.  Tenemos un vector de inicio: cero datos aleatorios que se utilizan en el algoritmo AES.  Se almacenan en forma abierta, y con su ayuda aumentamos la entrop√≠a: los mismos datos se cifrar√°n de manera diferente en diferentes sesiones de cifrado.  En t√©rminos generales, incluso si tenemos dos Ivan Petrovs con el mismo apellido, cada vez que ciframos, recibiremos diferentes datos cifrados.  Esto reduce la posibilidad de pirater√≠a. <br><br>  El cifrado se realiza en bloques de 16 bytes, y si los datos no est√°n alineados por 16 bytes, entonces agregamos informaci√≥n de relleno: la cantidad de datos que realmente hemos cifrado.  En un disco, debe escribir una p√°gina que sea m√∫ltiplo de 2 Kb.  Estos son los requisitos de rendimiento: debemos usar el b√∫fer de disco.  Si escribimos no 2 Kb (no 4 o no 8, dependiendo del b√∫fer de disco), inmediatamente obtenemos un gran rendimiento de ca√≠da. <br><br>  ¬øC√≥mo resolvimos el problema?  Tuve que arrastrarme a PageIO, en RAM y cortar 16 bytes de cada p√°gina, que se cifrar√≠an cuando se escribieran en el disco.  En estos 16 bytes escribimos el vector init. <br></li><li>  Otra dificultad es no romper nada.  Esto es algo com√∫n cuando vienes y haces algunos cambios.  En realidad, no es tan simple como parece. <br></li><li>  En MVP result√≥ 6 mil l√≠neas.  Es dif√≠cil de revisar, y pocas personas quieren hacer esto, especialmente de expertos que ya no tienen tiempo.  Tenemos varias partes: API p√∫blica, parte central, administradores SPI, almac√©n persistente de p√°ginas, administradores WAL.  Los cambios en varios subsistemas requieren que sean revisados ‚Äã‚Äãpor diferentes personas.  Y esto tambi√©n impone dificultades adicionales.  Especialmente cuando trabajas en una comunidad donde todas las personas est√°n ocupadas con sus tareas.  Sin embargo, todo funcion√≥ para nosotros. <br></li></ol><br><h3>  Lo que suceder√° en TDE. Fase 2 y 3 </h3><br>  Ahora se implementa la Fase 1. Usted, como desarrollador, puede ayudar con la Fase 2. Los desaf√≠os futuros son interesantes.  PCI DSS, como otros est√°ndares, requiere caracter√≠sticas adicionales del sistema de encriptaci√≥n.  Nuestro sistema deber√≠a poder cambiar la clave maestra.  Por ejemplo, si se vio comprometido o ha llegado el momento de acuerdo con la pol√≠tica de seguridad.  Ahora Ignite no sabe c√≥mo.  Pero en futuras versiones, ense√±aremos a TDE a cambiar la clave maestra. <br><br>  Lo mismo con la capacidad de cambiar la clave de cach√© sin detener el cl√∫ster y trabajar con datos.  Si el cach√© es de larga duraci√≥n y al mismo tiempo almacena algunos datos (financieros, m√©dicos), Ignite deber√≠a poder cambiar la clave de cifrado del cach√© y volver a cifrar todo sobre la marcha.  Resolveremos este problema en la tercera fase. <br><br><h3>  Total: ¬øC√≥mo implementar una gran caracter√≠stica en un proyecto de c√≥digo abierto? </h3><br>  Para resumir.  Ser√°n relevantes para cualquier fuente abierta.  Particip√© en Kafka y en otros proyectos, en todas partes la historia es la misma. <br><br><ol><li>  Comience con peque√±as tareas.  Nunca intente resolver un problema s√∫per grande de inmediato.  Es necesario comprender lo que est√° sucediendo, c√≥mo est√° sucediendo, c√≥mo se est√° realizando.  ¬øQui√©n te ayudar√°?  Y en general, de qu√© lado abordar este proyecto. </li><li>  Comprende el proyecto.  Por lo general, todos los desarrolladores, al menos yo, vienen y dicen: todo debe reescribirse.  Todo estaba mal antes que yo, y ahora lo reescribir√©, y todo estar√° bien.  Es aconsejable posponer tales declaraciones, para determinar qu√© es exactamente malo y si es necesario cambiarlo. </li><li>  Discuta si se necesitan mejoras.  He tenido casos en los que vine a varias comunidades con experiencia, por ejemplo, en Spark.  Me lo dijo, pero la comunidad no estaba interesada por alguna raz√≥n.  En cualquier caso sucede.  Necesita esta revisi√≥n, pero la comunidad dice: no, no estamos interesados, no nos fusionaremos ni ayudaremos. </li><li>  Haz un dise√±o.  Hay proyectos de c√≥digo abierto en los que esto es obligatorio.  No puede comenzar a codificar sin un dise√±o acordado por el comit√© y las personas con experiencia.  En Ignite, esto no es formalmente cierto, pero en general es una parte importante del desarrollo.  Es necesario hacer una descripci√≥n en ingl√©s o ruso competente, seg√∫n el proyecto.  Para que el texto se pueda leer y quede claro qu√© es exactamente lo que va a hacer. </li><li>  Discuta la API p√∫blica.  El argumento principal: si hay una API p√∫blica hermosa y comprensible que sea f√°cil de usar, entonces el dise√±o es correcto.  Estas cosas suelen ser adyacentes entre s√≠. </li></ol><br>  M√°s consejos m√°s obvios que no son tan f√°ciles de seguir: <br><br><ul><li>  Implemente la funci√≥n sin romper nada.  Haz las pruebas. </li><li>  Pida y espere (esto es lo m√°s dif√≠cil) una revisi√≥n de los tipos correctos, de los miembros correctos de la comunidad. </li><li>  Haga puntos de referencia, descubra si tiene una ca√≠da en el rendimiento.  Esto es especialmente importante al finalizar algunos subsistemas cr√≠ticos. </li><li>  Espere la fusi√≥n, haga algunos ejemplos y documentaci√≥n. </li></ul><br>  Gracias por leer! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/440808/">https://habr.com/ru/post/440808/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../440796/index.html">Conferencia DEFCON 19. Tres generaciones de ataques DoS (involucrando a la audiencia como v√≠ctimas). Parte 2</a></li>
<li><a href="../440800/index.html">Lanzado Kali Linux 2019.1</a></li>
<li><a href="../440802/index.html">WearMouse, un mouse de aire para relojes Wear OS</a></li>
<li><a href="../440804/index.html">Opci√≥n de clonaci√≥n de base de datos para desarrollo / prueba</a></li>
<li><a href="../440806/index.html">Dark Mobile en CodeFest: Swift funcional, conceptos err√≥neos Clean Architecture y #Of courseZheKotlin</a></li>
<li><a href="../440810/index.html">Talos - "Una distribuci√≥n moderna de Linux para Kubernetes" introducida</a></li>
<li><a href="../440814/index.html">Soberana LPWAN, Parte 1: Licencias y operaci√≥n de redes LPWAN en Rusia - Requisitos de un nuevo estado antiguo</a></li>
<li><a href="../440816/index.html">Git y desarrollo de equipo (para tontos)</a></li>
<li><a href="../440818/index.html">Realizamos una auditoria de errores</a></li>
<li><a href="../440820/index.html">Control y control nuevamente: cambio en la direcci√≥n magn√©tica debido al voltaje en Fe / BaTiO3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>