<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🦌 👐🏾 🤽🏿 Aber das Wesentliche ist etwas, oder das Minimieren des Quellcodes ist einfacher als es sich anhört. 🗡️ 🎴 🤚🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesen wunderbaren Januartagen sind wir natürlich alle besorgt über das Problem der Minimierung des Quellcodes bei gleichzeitiger Beibehaltung der ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aber das Wesentliche ist etwas, oder das Minimieren des Quellcodes ist einfacher als es sich anhört.</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482634/"><img src="https://habrastorage.org/webt/ls/g9/gy/lsg9gy2nbzs5m0redadf6s3sqjc.png"><br><p>  In diesen wunderbaren Januartagen sind wir natürlich alle besorgt über das Problem der Minimierung des Quellcodes bei gleichzeitiger Beibehaltung der Invariante.  Ich meine, egal?!?  Vergebens ... Hier ist der Compiler abgestürzt, und das Programm ist gigantisch - es ist für die Entwickler irgendwie unpraktisch, so etwas zu senden.  Und dann beginnt der Spaß: Was passiert, wenn Sie es wegwerfen?  Oh, es fällt nicht - okay, wir gehen, aber was ist, wenn es fällt?  - stürzt immer noch ab, und dies und das ... Oh, ich habe den Compiler auf den alten Quellen gestartet. </p><br><p>  Gleichzeitig ist die Automatisierung der Suche nach Fehlern eine Frage des Lebens: Git Bisect, Llvm-Bugpoint, Creduce, ... In diesem Artikel beschreibe ich einen weiteren Weg, um das Problem der Vereinfachung des Testfalls zu lösen, der in Bezug auf die Programmiersprache mehr oder weniger universell ist, und zeige einige Anwendungsbeispiele. </p><a name="habracut"></a><br><p> Universal, sag mal ... Vielleicht wurde es natürlich schon zehnmal umgesetzt, aber würde das einen erfahrenen Radfahrer aufhalten?  <em>Und in den Händen eines Mikroskops scheinen alle Probleme Nägel zu sein.</em>  In der Rolle eines Mikroskops - <a href="https://pmd.github.io/" rel="nofollow">PMD</a> . </p><br><p>  Im Allgemeinen gibt es eine solche Sprache zum Schreiben von Modellen, die durch Differentialgleichungen beschrieben werden - Modelica.  Es ist ziemlich weit fortgeschritten, es gibt eine sehr coole offene Implementierung und im Allgemeinen.  Es gibt jedoch ein kleines Problem: Manchmal tritt im Compiler ein interner Compilerfehler auf.  In einem <a href="https://habr.com/ru/post/474920/">früheren Artikel habe</a> ich bereits gezeigt, wie man dem statischen PMD-Analysator zusätzlich zu den zehn vorhandenen Sprachmodulen die Modela-Unterstützung hinzufügt (einige meiner Fehler sind übrigens während des Überprüfungsprozesses aufgetreten).  Nun entschied ich mich - was nützt es, zu verschwinden - und schickte ein Proof-of-Concept-Tool namens Source Code Minimizer, das die vorhandenen Sprachmodule PMD wiederverwendete.  Leider haben sie mich - wenn auch nicht weit entfernt - in das benachbarte Depot geschickt: Der Menter sagte, er entscheide sich immer noch nicht, dies bis zum Ende des Jahrhunderts zu unterstützen, und es geht in der allgemeinen Codebasis verloren, sodass ich bald eine Einladung zur Mitarbeit in meinem Posteingang fand ist frisch erstellt <a href="https://github.com/pmd/pmd-scm" rel="nofollow">pmd / pmd-scm</a> . </p><br><p>  Was ist die Erklärung des Problems?  Es ist erforderlich, die Größe des Quellcodes zu reduzieren, wobei ein Teil seiner Eigenschaften erhalten bleibt.  Genauer gesagt, ich möchte </p><br><ul><li>  Der resultierende Code war vorhersehbar <br><ul><li>  Es muss nicht so <strong>minimal wie möglich sein</strong> . Die Vervollständigung von Dateien ist zulässig, sollte jedoch nicht zu Qual werden </li><li>  automatische Verschleierung wird nicht berücksichtigt </li></ul></li><li>  Das minimierte Programm kann in mehrere Dateien mit Quellcode unterteilt werden <br><ul><li> In Java muss sich beispielsweise jede <code>public</code> Klasse in einer separaten Datei mit dem richtigen Namen usw. befinden. </li><li>  Ich möchte, dass jede Datei am Ende sichtbar bleibt </li></ul></li><li>  Bei Transformationen muss die angegebene Invariante erhalten bleiben </li></ul><br><h2 id="vnutrennee-ustroystvo">  Internes Gerät </h2><br><p>  In diesem Abschnitt werde ich die Implementierung grob beschreiben.  Zunächst stelle ich noch einmal fest, dass diese Idee, gelinde gesagt, nicht neu ist.  Und wenn ich Git-Bisect nur als Beispiel für den "automatischen Debugging-Mechanismus" zitiert habe, bin ich über <a href="https://github.com/csmith-project/creduce" rel="nofollow">längere</a> Zeit auf <a href="https://github.com/csmith-project/creduce" rel="nofollow">Creduce</a> oder ähnliches <a href="https://github.com/csmith-project/creduce" rel="nofollow">gestoßen</a> (obwohl ich es nicht verwendet habe).  Aber ich musste <a href="https://llvm.org/docs/Bugpoint.html" rel="nofollow">llvm-bugpoint verwenden</a> - es ist beeindruckend: Sie sitzen, debuggen Ihren LLVM-Pass und es - eine solche Infektion - stürzt auf einigen Dateisystemen ab.  Sie können diese Datei also in LLVM-Bitcode kompilieren, <code>opt</code> für die .bc-Datei mit Ihrem Plugin ausführen und sicherstellen, dass sie abstürzt.  Und dann habe ich grob gesagt nur <code>opt</code> durch <code>llvm-bugpoint</code> und in einer Minute ein umfangreiches „Skelett“ einer der Funktionen erhalten, das aus einer Wolke von Basisblöcken und Übergängen zwischen ihnen besteht.  Alles außer Zweigen wurde erfolgreich weggeworfen.  Übrigens, wie in meiner Aussage zum Problem, kam es nach einem Dutzend Minuten manueller Vereinfachung darauf an, dass ich einen der Verzweigungstypen falsch verarbeitete und alles andere nur Kulisse war.  Im Allgemeinen ist die Idee nicht neu. </p><br><p>  Und jetzt zur Umsetzung.  Da es ein mehr oder weniger universelles Tool sein sollte, wollte ich eine Art Framework erstellen, in das wir für verschiedene Sprachen optimierte Implementierungen einbinden können.  Als Ergebnis stachen zwei recht orthogonale Konzepte heraus: </p><br><ul><li>  invariant unterstützt </li><li>  Minimierungsstrategie </li></ul><br><h2 id="invariant">  Invariante </h2><br><p>  Eine der Optionen für die Eigenschaft, die Sie möglicherweise speichern möchten, habe ich bereits beschrieben: „Der Compiler hat einen Ausdruck auf die Konsole gedruckt“ (z. B. „Interner Compilerfehler“).  Ideen können auch aus einer Vielzahl von Fuzzern gewonnen werden: <a href="https://github.com/google/AFL" rel="nofollow">AFL</a> , <a href="https://github.com/grimm-co/killerbeez" rel="nofollow">Killerbeez</a> und andere: </p><br><ul><li>  Der Prozess endete mit einem Return-Code (insbesondere "Crash on Signal" unter Linux). </li><li>  Der Vorgang dauerte mehr als T Millisekunden.  Hier kann leider Instabilität aufgrund der schwebenden Last des Systems auftreten.  Um die Genauigkeit zu erhöhen, können Sie die CPU-Zeit verwenden. Im Idealfall sind jedoch Leistungsindikatoren hilfreich </li><li>  Der Compiler kann eine Ausgabedatei (nicht) generieren </li><li>  ... </li></ul><br><p>  Ich habe bereits einige davon implementiert (Rückkehrcode, gedruckte Zeile), einige nicht, einige sind möglicherweise spezifisch für einzelne Sprachen.  Im Allgemeinen handelt es sich hierbei um einen ziemlich autonomen Teil der Aufgabe, der oft völlig unabhängig von einer bestimmten Sprache ist. </p><br><h2 id="strategiya-minimizacii">  Minimierungsstrategie </h2><br><p>  Auf den ersten Blick ist hier alles rein sprachabhängig.  Irgendwo müssen Sie Variablen zusammen mit Anwendungsfällen wegwerfen - um die gleiche Anzahl von Gleichungen und Unbekannten beizubehalten.  Umso wichtiger ist es, diesen Teil des Codes zu abstrahieren.  Es kann jedoch für jeden etwas Grundlegendes gelten: Beispielsweise dreht sich die XPath-Rules-Engine mit einer leichten Bewegung der Hand ... dreht sich ... ... oh, bei XPath Version 1.0 dreht sie sich nicht.  Sorry, ein kleines technisches Problem - in ein universelles Tool zum Trimmen von Syntaxbäumen <del>  für den winter </del>  .  Im Allgemeinen ist die Minimierungsstrategie-API recht einfach: Im Großen und Ganzen hat die Funktion eine Sprungfunktion (sie enthält eine Liste der Wurzelknoten der Syntaxbäume), die über die Operationsschnittstelle die Frage stellen kann, ob diese Verzweigungen entfernt werden sollen.  Wenn die Invariante verletzt wird, gibt die Funktion die Kontrolle zurück, andernfalls dreht sie den Stapel, indem sie eine spezielle Ausnahme auslöst, und die resultierende Version wird als nächste Annäherung verwendet.  Ein Prozess gilt als abgeschlossen, wenn die Schrittfunktion die Steuerung nicht über eine Ausnahme zurückgegeben hat.  Sie können sagen, dass dies schrecklich unwirksam ist - vielleicht so, <del>  ZATO NÜTZLICH !! 111 </del>  , aber worum geht es, wenn der externe Compiler-Prozess regelmäßig hunderte Male in einem Zyklus gestartet werden soll. </p><br><p>  Dies wirft die Frage auf: Wie erhält man die Quelle vom verdünnten AST zurück?  Natürlich können Sie versuchen, für jede Sprache, die eine Textdatei generiert, einen speziellen Code zu schreiben.  Aber wie Sie wissen, sollte ein Programmierer faul sein.  Es wird also nicht funktionieren - es ist eindeutig nicht aus der Serie "Bestehende Implementierungen aufgreifen und loslegen".  Glücklicherweise gibt es in den Knoten des Baums Informationen über die Anfangs- und Endzeilen und -spalten für diesen Knoten. Das heißt, wenn das Sprachmodul diese Informationen korrekt anzeigt, können Sie den Quelltext entnehmen und sorgfältig Teile daraus ausschneiden (daher nebenbei bemerkt und einige Schwierigkeiten mit der Verschleierung: Es reicht nicht aus, etwas wegzuwerfen, aber Sie müssen es ersetzen (z. B. Bezeichner).  Übrigens haben wir in der PMD-Codebasis sogar eine Klasse zum Bearbeiten einer Datei gefunden, bei der sich nicht schneidende Textausschnitte verwendet werden (und zwar auch zum Hinzufügen, was für diese bestimmte Aufgabe jedoch nicht so interessant ist). </p><br><h2 id="teoriya-itog">  Theorie: Zusammenfassung </h2><br><p>  Im Moment habe ich zwei Strategien umgesetzt.  Eine davon ist das XPath-Trimmen, was in gewisser Weise ein entarteter Fall ist, da es das Ergebnis zwangsweise schreibt, auch wenn es keine syntaktisch korrekte Quelle mehr ist.  Die zweite ist bereits „ehrlich“ iterativ und interaktiv (in dem Sinne, dass sie wirklich mit dem Compiler interagiert und die Invariante überprüft): Sie versucht nur, Zweige nacheinander in eine Schleife zu werfen.  Hier ist ein bisschen mehr dazu: </p><br><ul><li>  Im Prinzip macht die Überprüfung der Invariante für die Quelle, die nicht analysiert wird, für eine "ehrliche" Strategie wenig Sinn: Selbst wenn der Compiler dies überlebt, muss der Minimizer die Quelle neu starten.  Daher ist es sinnvoll, die "defekten" Dateien im Voraus zu löschen: Das Parsen in Ihrem Prozess ist schneller als das Ausführen des gesamten Compilers </li><li>  im allgemeinen Fall wäre es wahrscheinlich zweckmäßig, hier Coroutinen zu verwenden (naja, oder den Kontrollfluss umzukehren), aber da dies weit von dem rechnerisch schwierigsten Teil der Arbeit entfernt ist, gehe ich bei jedem Schritt in der Schrittfunktion einfach um den Baum herum und zähle die Entfernung Oberteile.  Ich erinnere mich nur an die Theke.  Also dachte ich zuerst, das Oberteil sei größer, das Oberteil weniger - welchen Unterschied macht es, heuristisch jedenfalls!  Es stellte sich heraus, dass der Fehler pro Einheit die Konvergenzrate zeitweise ändern kann.  Im Wesentlichen ist dies logisch: Es ist oft eine effektive Strategie, ganze Funktionen aus der Klasse in die richtige Reihenfolge zu bringen.  Aber ein bisschen zu überspringen und jedes Mal <strong>in die</strong> Funktion <strong>zu gehen</strong> , was in den meisten Fällen nichts mit dem Problem zu tun hat, sieht nach einer so lala Idee aus. </li><li>  Übrigens über Coroutinen und die Bereitstellung des Kontrollflusses: Es würde einige Probleme geben, da sich der AST nach dem Neustart des geänderten Textes möglicherweise nicht auf sehr offensichtliche Weise ändert (dh nicht nur die angegebenen Zweige werden zurückgeworfen, sondern die Knoten, die leer werden, verschwinden irgendwo, irgendwo Im Allgemeinen wird das Parsen in die andere Richtung gehen.  Ganz zu schweigen davon, dass die Knoten des neuen AST in Bezug auf die alten nicht identisch sein werden, und logische Übereinstimmung durch <code>equals</code> - sieht ebenfalls nach einer schwierigen Aufgabe aus </li><li>  Im Prinzip können Sie die Funktionen von PMD in unterschiedlichem Maße nutzen: Sie können berechnete Typen, Abhängigkeiten für die Verwendung von Definitionen usw. verwenden.  und etwas sehr Kluges tun (aber Sie müssen eine universelle API in Betracht ziehen).  Andererseits ist es für die beschriebene Strategie ausreichend, einen Analysebaum zu erhalten.  Und hier könnten Sie sogar <a href="https://github.com/kaitai-io/kaitai_struct" rel="nofollow">Kaitai Struct einbinden</a> und versuchen, <a href="https://github.com/google/AFL" rel="nofollow">afl-tmin</a> zu drücken, um <a href="https://github.com/google/AFL" rel="nofollow">Binärdateien</a> zu minimieren :) </li></ul><br><h2 id="praktika">  Übe </h2><br><p>  Erstellen wir zunächst einen Minimierer: </p><br><pre> <code class="plaintext hljs">git clone https://github.com/pmd/pmd-scm.git cd pmd-scm ./mvnw clean verify unzip pmd-scm-dist/target/pmd-scm-bin-1.0.0-SNAPSHOT.zip</code> </pre> <br><p>  Jetzt brauchst du eine Quelle.  Nehmen <a href="" rel="nofollow">wir</a> zum Beispiel <a href="" rel="nofollow">GreedyStrategy.java</a> . </p><br><p>  Finden Sie mit <a href="https://github.com/pmd/pmd-designer" rel="nofollow">Rule Designer</a> heraus, wie ein typischer AST für Java aussieht, und führen Sie ihn aus </p><br><pre> <code class="plaintext hljs">$ ./bin/run.sh scm --language java \ --input-file ../pmd-scm/src/main/java/net/sourceforge/pmd/scm/strategies/GreedyStrategy.java \ --output-file GreedyStrategy-min.java \ --strategy xpath \ --xpath-expression '//BlockStatement[count(../BlockStatement) &gt; 1]' Original file(s): 6155 bytes, 1099 nodes. After initial white-space cleanup: size 4548 bytes (73%), 1099 nodes (100%) After pass #1: size 1984 bytes (32%), 1099 nodes (100%) After final white-space cleanup: size 1984 bytes (32%), 325 nodes (29%) After blank line clean up: size 1767 bytes (28%), 325 nodes (29%)</code> </pre> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> net.sourceforge.pmd.scm.strategies; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Collections; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.HashMap; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.HashSet; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.List; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Map; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Set; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> net.sourceforge.pmd.lang.ast.Node; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GreedyStrategy</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractMinimizationStrategy</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Configuration</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> MinimizationStrategy </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createStrategy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GreedyStrategy(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> MinimizationStrategyConfigurationFactory FACTORY = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AbstractFactory(<span class="hljs-string"><span class="hljs-string">"greedy"</span></span>) { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> MinimizationStrategyConfiguration </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createConfiguration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Configuration(); } }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GreedyStrategy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Configuration configuration)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(configuration); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Map&lt;Node, HashSet&lt;Node&gt;&gt; directlyDependingNodes = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Map&lt;Node, Set&lt;Node&gt;&gt; transitivelyDependingNodes = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchDirectDependentsFromSubtree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Node node)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// process depending nodes } private Set&lt;Node&gt; indirectlyDependentNodesFor(Node currentNode) { } private void collectNodesToRemove(Set&lt;Node&gt; result, Node node) { } private int previousPosition = 0; private int positionCountdown; private void findNodeToRemove(Node currentNode) throws Exception { } private void processSingleRoot(Node currentRoot) throws Exception { // cannot remove root for (int i = 0; i &lt; currentRoot.jjtGetNumChildren(); ++i) { findNodeToRemove(currentRoot.jjtGetChild(i)); } } @Override public void performSinglePass(List&lt;Node&gt; roots) throws Exception { } }</span></span></code> </pre> <br><p>  Das heißt, wir haben alle Funktionen geleert, die <em>direkt mehr als eine Anweisung enthalten</em> .  Löschen von Kommentaren, Leerzeilen usw.  Ich habe es nicht spezifiziert - schließlich ist dies (bisher?) In erster Linie ein Tool zum <strong>Debuggen von Compilern</strong> , anstatt schöne Schnittstellenbeschreibungen zu erstellen. </p><br><p>  Schauen wir uns jetzt etwas interessanteres an: Versuchen Sie, zwei Dateien mit dem Feedback des Compilers gleichzeitig zu minimieren: </p><br><p>  <strong>orig / TestResource.java:</strong> </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestResource</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ System.err.println(<span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">123</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unused</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// unused } }</span></span></code> </pre> <br><p>  <strong>orig / Main.java:</strong> </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ String str = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TestResource().func(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">123</span></span>; } }</code> </pre> <br><p>  Wie Sie sehen können, kompilieren sie nicht: </p><br><pre> <code class="plaintext hljs">$ javac orig/TestResource.java orig/Main.java orig/Main.java:3: error: incompatible types: int cannot be converted to String String str = new TestResource().func(); ^ orig/Main.java:5: error: incompatible types: unexpected return value return 123; ^ 2 errors</code> </pre> <br><p>  Stellen wir uns vor, dass mit dem ersten Fehler etwas nicht stimmt, und versuchen Sie, ein minimales Beispiel zu erstellen, das produziert </p><br><pre> <code class="plaintext hljs">error: incompatible types: int cannot be converted to String</code> </pre> <br><p>  Führen Sie dazu aus </p><br><pre> <code class="plaintext hljs">$ bin/run.sh scm --language java \ --input-file orig/TestResource.java orig/Main.java \ --output-file TestResource.java Main.java \ --invariant message \ --printed-message "error: incompatible types: int cannot be converted to String"\ --command-line "javac TestResource.java Main.java" \ --strategy greedy Original file(s): 290 bytes, 77 nodes. After initial white-space cleanup: size 258 bytes (88%), 77 nodes (100%) After pass #1: size 255 bytes (87%), 64 nodes (83%) After pass #2: size 244 bytes (84%), 57 nodes (74%) After pass #3: size 205 bytes (70%), 51 nodes (66%) After pass #4: size 192 bytes (66%), 46 nodes (59%) After pass #5: size 181 bytes (62%), 39 nodes (50%) After pass #6: size 179 bytes (61%), 39 nodes (50%) After final white-space cleanup: size 149 bytes (51%), 39 nodes (50%) After blank line clean up: size 147 bytes (50%), 39 nodes (50%)</code> </pre> <br><p>  Als Ergebnis bekommen wir </p><br><p>  <strong>TestResource.java:</strong> </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestResource</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre> <br><p>  <strong>Main.java:</strong> </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ String str = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TestResource().func(); } }</code> </pre> <br><pre> <code class="plaintext hljs">$ javac TestResource.java Main.java TestResource.java:3: error: missing return statement } ^ Main.java:3: error: incompatible types: int cannot be converted to String String str = new TestResource().func(); ^ 2 errors</code> </pre> <br><p>  Alles wie bestellt! </p><br><h2 id="itog">  Zusammenfassung </h2><br><p>  Bisher befindet sich das Projekt noch in einem relativ frühen Stadium, aber es gibt bereits etwas zu demonstrieren.  In Zukunft gibt es Ideen, eine API für sprachunabhängige Indikatoren für Abhängigkeiten zwischen AST-Knoten zu entwickeln, um sprachspezifische Strategien bereitzustellen.  Es wäre auch schön, eine universelle Strategie zu entwickeln, die das Groovy / Kotlin / -Skript ausführt - schließlich haben es Menschen, die Java verwenden, vielleicht noch nie gesehen, aber sie kennen sich zum Beispiel mit Modelika und Modelika bestens aus haben ihre fortgeschrittenen Möglichkeiten im Kopf, die Quelle zu quetschen. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de482634/">https://habr.com/ru/post/de482634/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de482614/index.html">Ist die Verwendung von BSP in Doom wirklich ein genialer Schritt?</a></li>
<li><a href="../de482616/index.html">Foreve Elon 2019/2020 (NY2020 Online-Meeting)</a></li>
<li><a href="../de482620/index.html">Slurm: Habr, schöne Ferien ...</a></li>
<li><a href="../de482626/index.html">Überwachen von Anwendungen mit Logger.Backends</a></li>
<li><a href="../de482628/index.html">Schau "Kleine grüne Spinne der Zeit"</a></li>
<li><a href="../de482636/index.html">Erfahrung in der Zulassung zu einem Amtsgericht in Deutschland (detaillierte Analyse)</a></li>
<li><a href="../de482642/index.html">OSCD: Threat Detection Sprint # 1, Ergebnisse</a></li>
<li><a href="../de482644/index.html">Keylogger für Windows mit Rechteänderung in DACL</a></li>
<li><a href="../de482646/index.html">Verbessern Sie die SPA-Leistung, indem Sie Ihre Angular-Bibliotheken in mehrere Teile aufteilen</a></li>
<li><a href="../de482648/index.html">Arthur Khachuyan: "Real Big Data in der Werbung"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>