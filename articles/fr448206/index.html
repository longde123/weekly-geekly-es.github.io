<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕑 🚸 👨🏼‍🏫 Développement modulaire ou chemin, pas retour 🔋 🙋 🤙🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Comment nous sommes arrivés à une nouvelle approche pour travailler avec des modules dans l'application iOS RaiffeisenBank. 

 Le problème 
 Dans les ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Développement modulaire ou chemin, pas retour</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/raiffeisenbank/blog/448206/"><img src="https://habrastorage.org/webt/0s/ef/oc/0sefoclv1-emulwycp9cfr6ccoo.jpeg"><br>  <i>Comment nous sommes arrivés à une nouvelle approche pour travailler avec des modules dans l'application iOS RaiffeisenBank.</i> <br><br><h3>  Le problème </h3><br>  Dans les applications Raiffeisenbank, chaque écran est composé de plusieurs modules aussi indépendants que possible les uns des autres.  «Module», nous appelons un composant visuel qui a sa propre idée.  Lors de la conception d'une application, il est très important d'écrire une logique afin que les modules soient indépendants et qu'ils puissent être facilement ajoutés ou supprimés sans recourir à une refactorisation. <br><a name="habracut"></a><br><h3>  Quelles difficultés nous avons rencontrées: </h3><br>  <b>Mettre en évidence l'abstraction sur les modèles architecturaux</b> <br>  Déjà au premier stade de développement, il est devenu clair que nous ne voulions pas être liés à un modèle architectural spécifique.  MVC est bon si vous devez afficher une page contenant des informations.  Dans le même temps, l'interaction avec l'utilisateur est minime ou pas du tout.  Par exemple: la page «à propos de l'entreprise» ou «accord d'utilisation».  VIPER est un bon outil pour les modules complexes qui ont leur propre logique de travail avec les services, le routage et beaucoup de tout. <br><br>  <b>Le problème de l'interaction et de l'encapsulation</b> <br>  Chaque modèle architectural a sa propre structure de construction et ses propres protocoles, qui imposent des restrictions sur l'utilisation du module.  Pour résumer le module, vous devez mettre en évidence les principales interfaces d'interaction <b>entrée / sortie</b> . <br><br>  <b>Mise en évidence de la logique de routage</b> <br>  Un module en tant qu'unité visuelle ne doit pas et ne peut pas savoir où et comment il est affiché.  Un même module doit et peut être implémenté en tant qu'unité indépendante sur n'importe quel écran ou en tant que composition.  La responsabilité de cela ne peut être imputée au module lui-même. <br><br><h3>  Solution précédente: // Mauvaises affaires </h3><br>  La première solution que nous avons écrite dans Objective-C, et elle était basée sur NSProxy.  Le problème de l'encapsulation du modèle architectural a été résolu par la défenition, qui a été déterminée par les conditions données, c'est-à-dire l' <font color="#cc0000"><b>entrée / sortie du</b></font> module, qui a permis de proxyer tous les appels vers le module vers son <font color="#cc0000"><b>entrée</b></font> et de recevoir des messages via la <font color="#cc0000"><b>sortie</b></font> , le cas échéant. <br><br>  C'était un pas en avant, mais de nouvelles difficultés sont apparues: <br><br><ul><li>  L'interface <font color="#cc0000"><b>proxy</b></font> ne garantissait pas la mise en œuvre du protocole d' <font color="#cc0000"><b>entrée</b></font> ; </li><li>  <font color="#cc0000"><b>Les résultats</b></font> devaient être décrits, même s'ils n'étaient pas nécessaires; </li><li>  Il était nécessaire d'ajouter la propriété de <font color="#cc0000"><b>sortie</b></font> à l'interface d' <font color="#cc0000"><b>entrée</b></font> . </li></ul><br>  En plus de <font color="#cc0000">NSProxy,</font> nous avons également implémenté le routage en examinant l'idée de ViperMcFlurry: nous avons créé une catégorie sur <font color="#cc0000">ViewController</font> , qui a commencé à croître à mesure que différentes options pour afficher le module à l'écran sont apparues.  Bien sûr, nous avons divisé la catégorie, mais c'était encore loin d'être une bonne solution. <br><br>  En général ... la première crêpe est grumeleuse, il est devenu clair que vous devez résoudre le problème différemment. <br><br><h3>  Solution: // finale </h3><br>  Réalisant qu'il n'y avait <font color="#cc0000">rien de</font> plus avec <font color="#cc0000">NSProxy</font> , nous avons pris des marqueurs et sommes allés tirer.  En conséquence, nous avons isolé le protocole <font color="#cc0000"><b>RFModule</b></font> : <br><br><pre><code class="javascript hljs">@objc protocol RFModule { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> view: ViewController { get } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> input: AnyObject? { get } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> output: AnyObject? { get set } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> transition: Transitioning { get set } }</code> </pre> <br>  Nous avons délibérément abandonné les types associés au niveau du protocole, et il y avait une bonne raison à cela: à cette époque, 90% du code était en Objective-C.  L'interopérabilité entre les modules ObjC ← → Swift ne serait pas possible. <br><br>  Afin d'utiliser toujours des génériques et d'assurer une utilisation typée des modules, nous avons introduit la classe <font color="#cc0000">Module</font> qui satisfait le protocole <br>  <font color="#cc0000">RFModule</font> : <br><br><pre> <code class="javascript hljs">final <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">I</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Any</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">O</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Any</span></span></span><span class="hljs-class">&gt;: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RFModule</span></span></span><span class="hljs-class"> </span></span>{ public typealias Input = I public typealias Output = O public <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> setOutput: ((O?) -&gt; Void)? <span class="hljs-comment"><span class="hljs-comment">//... public var input: I? { get { return inputObjc as? I} set { inputObjc = newValue as AnyObject } } public var output: O? { get { return outputObjc as? O} set { outputObjc = newValue as AnyObject } } @objc(input) public weak var inputObjc: AnyObject? @objc(moduleOutput) public weak var outputObjc: AnyObject? { didSet{ setOutput?(output) } } } @objc protocol RFModule { var view: ViewController { get } @objc(input) var inputObjc: AnyObject? { get } @objc(moduleOutput) var outputObjc: AnyObject? { get set } var transition: Transitioning { get set } } public extension RFModule { public var input: AnyObject? { return inputObjc } public var output: AnyObject? { get { return outputObjc } set { outputObjc = newValue} } }</span></span></code> </pre><br>  Nous avons donc obtenu un module tapé.  Et en fait, Swift utilise le <font color="#cc0000">module de</font> classe, et dans le <font color="#cc0000">RFModule</font> Objective-C.  De plus, il s'est avéré être un outil pratique pour écraser les types à l'endroit où vous devez créer des tableaux: par exemple, <font color="#cc0000">TabContainer</font> . <br><br>  Étant donné que la création de module DI se trouve dans la <b>portée</b> UserStory et attribue la valeur de sortie à l'endroit où elle sera utilisée, il est impossible de décrire un simple compteur.  <b>"SetOutput"</b> est, par essence, une <i>défenition</i> qui, au stade de l'attribution de la <font color="#cc0000">sortie, la</font> transmettra au responsable, selon la logique du module. <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ModuleInput</span></span></span><span class="hljs-class"> </span></span>{ weak <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delegate: ModuleOutput } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Assembly</span></span></span><span class="hljs-class"> </span></span>{ func someModule() -&gt; Module&lt;ModuleInput, ModuleOutput&gt; { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> view = SomeViewController() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> = Module&lt;ModuleInput, ModuleOutput&gt;(view: view, <span class="hljs-attr"><span class="hljs-attr">input</span></span>: view) { [weak view] output <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> view?.delegate = output } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> } } ... let assembly: Assembly <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> = assembly.someModule() <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.output = self</code> </pre> <br>  <font color="#cc0000">La transition</font> est un protocole dont les implémentations, comme son nom l'indique, sont responsables de la logique d'affichage et de masquage du module. <br><br><pre> <code class="javascript hljs">protocol Transitioning { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> destination: ViewController? { get } <span class="hljs-comment"><span class="hljs-comment">// should be weak func perform(_ completion: (()-&gt;())?) // present func reverse(_ completion: (()-&gt;())?) // dissmiss }</span></span></code> </pre> <br>  Pour l'affichage, il est provoqué - <font color="#cc0000">effectuer</font> , pour masquer - <font color="#cc0000">inverser</font> .  Malgré le fait qu'il y ait une <font color="#cc0000">destination</font> dans le protocole et au début, il semble qu'il devrait y avoir une <font color="#cc0000">source</font> .  En fait, la <font color="#cc0000">source</font> peut ne pas l'être et son type n'est pas toujours <font color="#cc0000">ViewController</font> .  Par exemple, si nous avons besoin que le module s'ouvre dans une nouvelle fenêtre, c'est <font color="#cc0000">Window</font> , et si nous avons besoin d' <font color="#cc0000">incorporer</font> , nous avons besoin de ET parent: <font color="#cc0000">ViewController</font> AND conteneur: <font color="#cc0000">UIView</font> . <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PresentTransition</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Transitioning</span></span></span><span class="hljs-class"> </span></span>{ weak <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> source: ViewController? weak <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> destination: ViewController? ... func perform(_ completion: (()-&gt;())?) { source.present(viewController: self.destinaton) } }</code> </pre> <br>  Ainsi, nous nous sommes débarrassés de l'idée d'écrire des extensions sur le <font color="#cc0000">ViewController</font> et <font color="#cc0000">avons</font> décrit la logique de la façon dont nous <font color="#cc0000">affichons</font> nos modules dans divers objets.  Cela nous a donné une flexibilité dans le routage, c'est-à-dire  maintenant, nous pouvons afficher n'importe quel module à la fois de manière indépendante et complexe, et également varier entre la façon dont tout est affiché à l'écran: dans la fenêtre, Présent, dans la navigation (pousser à la navigation), incorporer, dans le rideau (couverture) . <br><br><h3>  <b>C'est tout?</b> </h3><br>  Il y a encore une chose qui hante jusqu'à présent.  Pour avoir la possibilité de choisir facilement la façon dont le module est affiché et d'en supprimer cette logique, nous avons payé la perte de la possibilité de définir les propriétés d'apparence.  Par exemple, si nous le montrons dans Navigation, nous devons spécifier quelle couleur <font color="#cc0000">barTintColor</font> doit être;  ou, si nous montrons le module dans le rideau, il est nécessaire de définir la couleur du <i>gestionnaire</i> . <br><br>  Jusqu'à présent, nous avons résolu ce problème avec l'apparence non typée: toute propriété, et la transition lors de l'ouverture du module conduit au type avec lequel il fonctionne, et s'il réussit, il enlève les propriétés nécessaires. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr448206/">https://habr.com/ru/post/fr448206/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr448194/index.html">Expérience du candidat dans le recrutement de développeurs de logiciels. 2e partie</a></li>
<li><a href="../fr448196/index.html">L'avenir (ou le présent secret) des moteurs à plasma ou comment atteindre une oscillation maximale de 27 dans l'atmosphère</a></li>
<li><a href="../fr448198/index.html">Transfert de données sécurisé entre deux applications</a></li>
<li><a href="../fr448202/index.html">Nous contrôlons le générateur ou la lutte contre l'ADC dans le STM32F030</a></li>
<li><a href="../fr448204/index.html">Îles de Bohême</a></li>
<li><a href="../fr448208/index.html">20, 100, 3, 19 - InoThings en chiffres</a></li>
<li><a href="../fr448210/index.html">Canon pour satellites, blaster et vaisseau solaire: des projets curieux et paradoxaux</a></li>
<li><a href="../fr448212/index.html">Protocole chinois AIBUS et réacteur chimique de laboratoire</a></li>
<li><a href="../fr448214/index.html">Proxy ES6 en pratique</a></li>
<li><a href="../fr448216/index.html">Configurer un assemblage pratique de projets dans Visual Studio</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>