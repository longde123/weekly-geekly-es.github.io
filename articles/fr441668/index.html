<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üß† üë®üèº‚Äç‚öïÔ∏è üë®‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë® STM32. Pratique de perte de poids ou r√©gime pour le contr√¥leur ü§∑üèø üßìüèª ü§¶üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quel genre de non-sens, certains lecteurs penseront probablement quand ils verront le titre de la publication. L'auteur a-t-il fait une erreur sur la ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>STM32. Pratique de perte de poids ou r√©gime pour le contr√¥leur</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/441668/"><img src="https://habrastorage.org/webt/u0/9v/yw/u09vyw-escpdlkeezud4cab8trw.jpeg"><br><br><p>  Quel genre de non-sens, certains lecteurs penseront probablement quand ils verront le titre de la publication.  L'auteur a-t-il fait une erreur sur la ressource?  Ou √©tait-il pr√©vu de le placer dans le hub "Geek Health"?  Et ils auront raison en partie, mais seulement en partie ... Sous la coupe, nous parlerons d'une m√©thode pour r√©duire et optimiser la consommation d'√©nergie des appareils √©lectroniques. </p><a name="habracut"></a><br><p>  Il y a quelque temps, la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">carte X-NUCLEO-LPM01A</a> est tomb√©e entre mes mains, qui √©tait pour le moment inactive jusqu'√† ce que je d√©cide d'√©tudier la consommation d'√©nergie d'un appareil con√ßu avec une alimentation autonome. </p><br><img src="https://habrastorage.org/webt/v-/ma/qp/v-maqpklxovwalvp3dc_99ireja.jpeg"><br><p>  Cette carte a √©t√© d√©velopp√©e par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">STMicroelectronics</a> et se positionne comme "Power shield, carte d'extension Nucleo pour la mesure de la consommation √©lectrique".  Je n'ai pas trouv√© de description explicative en russe sur le r√©seau pour travailler avec ce devkit et j'ai d√©cid√© de le d√©couvrir moi-m√™me, et en m√™me temps de partager des informations avec la communaut√© respect√©e. </p><br><p>  Si nous mettons en √©vidence la principale, la carte d'extension est une source d'alimentation programmable de 1,8 √† 3,3 volts avec la possibilit√© de mesurer le courant de charge en temps r√©el (en mode dynamique jusqu'√† <br>  50 mA) avec une fr√©quence d'√©chantillonnage jusqu'√† 100 kHz.  L'appareil peut fonctionner √† la fois ind√©pendamment et dans le cadre d'un complexe mat√©riel-logiciel.  Pour afficher graphiquement les valeurs mesur√©es, l'utilitaire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">STM32Cube MonitorPower est utilis√©</a> .  Ce logiciel vous permet √©galement de d√©finir tous les param√®tres n√©cessaires et d'effectuer un traitement lors de la survenance d'un √©v√©nement (d√©clenchement d√©clencheur).  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">X-NUCLEO-LPM01A est</a> affin√© pour fonctionner avec les cartes Nucleo-32 (64, 144), Arduino Nano (Uno), √† cet effet, les blindages correspondants sont plac√©s dessus, mais il est possible de travailler avec des cartes arbitraires.  La photo ci-dessous montre la connexion de l'appareil √† l'√©tude √† l'un des connecteurs de la carte. </p><br><img src="https://habrastorage.org/webt/3p/o-/ll/3po-lljw_abqlzhztomwkzncw0i.jpeg"><br><br><p>  En plus du logiciel d'application, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">X-NUCLEO-LPM01A</a> prend en charge le mode de commande, pour lequel <s>tout programme de terminal doit</s> fonctionner.  (Ici, je semble √™tre un peu excit√©, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://">HTerm a</a> commenc√© avec un demi-coup, mais j'ai d√ª jouer un peu avec ma ZOC pr√©f√©r√©e).  De plus, √† en juger par la description, gr√¢ce √† l'utilisation du pilote VCP, l'appareil peut verser des donn√©es dans le port COM √† une vitesse pouvant atteindre 3686400 bauds.  Une telle vitesse √©lev√©e est assur√©e notamment par la transmission d'un flux de donn√©es binaires (pour des fr√©quences d'√©chantillonnage sup√©rieures √† 50 KHz), pour les caract√®res ASCII la vitesse est l√©g√®rement inf√©rieure. </p><br><p>  Plus pr√©cis√©ment, la t√¢che que j'essaierai de r√©soudre en utilisant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">X-NUCLEO-LPM01A</a> est: </p><ol><li><p>  Pour obtenir des informations sur la consommation d'√©nergie dynamique des n≈ìuds d'int√©r√™t dans le produit con√ßu en utilisant le d√©clencheur d√©clencheur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">X-NUCLEO-LPM01A</a> dans les endroits √©tudi√©s du code de programme. </p></li><li><p>  Dans le processus de fonctionnement continu de l'appareil pour organiser l'accumulation des fragments n√©cessaires pour une analyse g√©n√©ralis√©e ult√©rieure. </p></li></ol><br><p>  La capture d'√©cran ci-dessous montre le journal actuel de la carte SD pendant l'enregistrement des donn√©es. </p><br> <a href=""><img src="https://habrastorage.org/webt/_g/t6/3h/_gt63h_pmhohs4w_q-higuefp8k.jpeg"></a> <br><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">STM32Cube MonitorPower</a> permet non seulement d'√©valuer qualitativement, mais aussi quantitativement la consommation d'√©nergie de l'appareil √©tudi√©.  Les valeurs minimales, maximales et moyennes du courant consomm√© et de la valeur d'√©nergie int√©gr√©e sont indiqu√©es dans la partie inf√©rieure de l'image.  Ces donn√©es sont disponibles √† la fois pour toute la mesure et pour le fragment s√©lectionn√©. </p><br><p>  Dans le manuel de l'utilisateur, il est √† noter que le d√©clenchement du d√©clenchement de la mesure est effectu√© par une impulsion sur la jambe du bouclier arduino D7.  Il s'est av√©r√© qu'un seul d√©marrage du processus avec des enregistrements subs√©quents en continu fonctionne.  Une tentative d'organiser un mode marche-arr√™t pour enregistrer le courant (sur les deux fronts de l'impulsion) a √©chou√©.  Autrement dit, une fois que l'enregistrement a commenc√© au bon endroit sur le front montant, il n'est pas possible de ralentir le processus avec un front descendant de l'impulsion.  Et ce n'est pas tout √† fait ce que j'attendais de cet appareil. </p><br><div class="spoiler">  <b class="spoiler_title">Un mode marche-arr√™t enti√®rement contr√¥l√© peut √™tre d√©fini √† l'aide de la s√©quence de commandes du programme du terminal</b> <div class="spoiler_text"><table cellpadding="2"><tbody><tr><td><p>  l'√©quipe </p></td><td><p>  la description </p></td></tr><tr><td><p>  htc </p></td><td><p>  capture du contr√¥le de l'h√¥te </p></td></tr><tr><td><p>  volt 3300-03 </p></td><td><p>  tension d'alimentation sur le canal mesur√© 3300 mV </p></td></tr><tr><td><p>  acqtime 0 </p></td><td><p>  mesure continue sans limite de temps </p></td></tr><tr><td><p>  freq 10000 </p></td><td><p>  fr√©quence d'√©chantillonnage 10 kHz </p></td></tr><tr><td><p>  commencer </p></td><td><p>  d√©but de la mesure </p></td></tr><tr><td><p>  ... </p></td><td><p>  mesure (les donn√©es sont vers√©es dans le terminal) </p></td></tr><tr><td><p>  arr√™ter </p></td><td><p>  fin de mesure </p></td></tr></tbody></table></div></div><br><p>  Le probl√®me est qu'il s'agit d'un contr√¥le manuel qui n'est pas synchronis√© avec les √©v√©nements du contr√¥leur cible.  Bien s√ªr, vous pouvez essayer de former la s√©quence de commandes indiqu√©e du c√¥t√© de l'appareil √† l'√©tude, pas l'h√¥te, mais le flux de sortie de donn√©es de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">X-NUCLEO-LPM01A</a> sera √©galement saupoudr√© dans le contr√¥leur et on ne sait pas quoi faire avec eux, et la redirection de la sortie "quelque part_√†_autre_place_" n'est √©galement pas disponible, ( bien qu'il y ait des broches UART Tx, Rx sur la carte, elles apparaissent comme "r√©serv√©es" dans le manuel et ne sont probablement pas impliqu√©es dans la version actuelle du firmware).  Je suis sorti de cette situation comme suit: </p><br><div class="spoiler">  <b class="spoiler_title">La s√©quence de commandes suivante est form√©e c√¥t√© h√¥te (ordinateur)</b> <div class="spoiler_text"><table cellpadding="4"><tbody><tr><td><p>  l'√©quipe </p></td><td><p>  la description </p></td></tr><tr><td><p>  htc </p></td><td><p>  capture du contr√¥le de l'h√¥te </p></td></tr><tr><td><p>  volt 3300-03 </p></td><td><p>  tension d'alimentation sur le canal mesur√© 3300 mV </p></td></tr><tr><td><p>  <em><strong>acqtime 1</strong></em> </p></td><td><p>  dur√©e de mesure <br>  (une plage de 10 Œºs √† 10 secondes peut √™tre utilis√©e) </p></td></tr><tr><td><p>  <em><strong>trigsrc d7</strong></em> </p></td><td><p>  synchronisation du d√©but de la mesure avec un front montant <br>  impulsion sur la broche D7 </p></td></tr><tr><td><p>  freq 10000 </p></td><td><p>  fr√©quence d'√©chantillonnage 10 kHz </p></td></tr><tr><td><p>  commencer </p></td><td><p>  d√©but de la mesure </p></td></tr><tr><td><p>  ... </p></td><td><p>  mesure (les donn√©es commencent au bord de l'impulsion et s'arr√™tent <br>  verser apr√®s le temps sp√©cifi√© dans acqtime) </p></td></tr></tbody></table></div></div><br><p>  Maintenant, les donn√©es seront captur√©es par lots, plut√¥t que dans un flux continu.  Cette approche vous permet d'explorer la consommation du circuit √† diff√©rents endroits du programme et √† diff√©rents intervalles de temps assez √©loign√©s les uns des autres.  Autrement dit, s'il est n√©cessaire de collecter des informations sur la consommation d'√©nergie d'un appareil qui fonctionne une heure (jour, semaine), vous n'avez pas besoin d'√©crire un flux continu, et m√™me avec une fr√©quence d'√©chantillonnage maximale, puis de comprendre ce g√¢chis, mais fournissez simplement l'algorithme de travail ci-dessus.  Et si le programme du terminal √©crit des marqueurs temporels dans son journal, comme indiqu√© dans l'image ci-dessous, il sera assez simple d'analyser l'historique des √©v√©nements √† partir d'un tel fichier. </p><br> <a href=""><img src="https://habrastorage.org/webt/pu/0j/cp/pu0jcpgvy-7wnmcgipzauzjjlw0.jpeg"></a> <br><br><p>  C'est comme un enregistreur vid√©o avec d√©tection de mouvement et horodatage. </p><br><p>  Permettez-moi de vous donner quelques captures d'√©cran obtenues √† l'aide de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">X-NUCLEO-LPM01A</a> .  Le premier est la consommation d'√©nergie du contr√¥leur lors de la lecture des donn√©es de l'ADC int√©gr√©.  32 valeurs sont lues par temporisation avec une fr√©quence de 4 KHz et sont stock√©es en m√©moire. </p><br> <a href=""><img src="https://habrastorage.org/webt/yu/d-/lz/yud-lz-ormre9rvdr9pqklka9e4.jpeg"></a> <br><br><p>  Sur la seconde - lecture et sauvegarde similaires des donn√©es, mais seul le contr√¥leur "se permet de dormir" apr√®s chaque mesure, jusqu'√† ce que la prochaine interruption de minuterie se produise, en utilisant l'un des modes d'√©conomie d'√©nergie disponibles. </p><br> <a href=""><img src="https://habrastorage.org/webt/zb/ze/zu/zbzezucrkjdtpxou_jll9hk3owm.jpeg"></a> <br><br><p>  Un delta significatif de la consommation de courant pendant la mesure, ~ 6 mA, est imm√©diatement perceptible.  Ces deux exemples ne pr√©tendent pas optimiser la consommation d'√©nergie des appareils basse consommation, mais d√©montrent seulement les capacit√©s du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">X-NUCLEO-LPM01A</a> , qui est capable de mesurer des courants √† partir de 1 nA. </p><br><p>  En conclusion, je dirai que, √† mon humble avis, ce devkit semble √™tre un outil parfaitement adapt√© qui peut prendre la place qui lui revient √† c√¥t√© de l'oscilloscope et de l'analyseur de signal logique sur la table d'int√©gration.  Et l'utilisation de l'approche d√©crite permettra non seulement de ¬´mod√©rer l'app√©tit du contr√¥leur¬ª dans le d√©veloppement de dispositifs √† puissance critique, mais aussi de mieux comprendre la dynamique des processus dans les divers modes d'√©conomie d'√©nergie activement utilis√©s par les d√©veloppeurs d'appareils √©lectroniques modernes. </p><br><p>  Le co√ªt de la carte - plus de 7 000 roubles, √©clipse l'arc-en-ciel de l'image, mais un montant aussi insignifiant √† l'heure actuelle peut-il emp√™cher un vrai geek d'avoir ce merveilleux kit de d√©veloppement? </p><br><p>  PS Malgr√© l'indication dans UM que UART est r√©serv√© pour de futures applications, je l'ai toujours coll√© et j'ai constat√© qu'il vivait comme une deuxi√®me interface (les E / S sont dupliqu√©es √† partir de VCP) √† une vitesse de 921600 8N1 et peuvent √™tre utilis√©es comme commande, formant commencer et arr√™ter pour le d√©but - la fin de la mesure.  L'inconv√©nient de cette approche sera la disponibilit√© obligatoire d'UART gratuit du c√¥t√© du contr√¥leur √† l'√©tude, sans parler du fait que 921600 bauds sont souvent impossibles √† basse fr√©quence d'horloge. </p><br><p>  PPS D√©j√† apr√®s avoir √©crit l'article, j'ai remarqu√© une diff√©rence dans les derni√®res photos de ~ 2 mA √† l'entr√©e de la mesure et √† la fin de celle-ci.  Je n'ai probablement pas d√©sactiv√© la synchronisation ADC, ou j'ai laiss√© la minuterie fonctionner, mais c'est, comme Leonid Kanevsky aime √† le dire: "une histoire compl√®tement diff√©rente" ... </p><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr441668/">https://habr.com/ru/post/fr441668/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr441648/index.html">Pr√©sentation de Microsoft HoloLens 2</a></li>
<li><a href="../fr441650/index.html">Webinar Group-IB ¬´Vue m√©dico-l√©gale sur la protection des objets CII en 2019¬ª</a></li>
<li><a href="../fr441654/index.html">Comment partir en stage dans une grande entreprise informatique</a></li>
<li><a href="../fr441660/index.html">STM32F103C8T6 en tant que lecteur flash avec syst√®me de fichiers FAT12</a></li>
<li><a href="../fr441664/index.html">Linus Torvalds ne pense pas que les serveurs de l'architecture ARM remplaceront x86. ¬´Vendre un mod√®le 64 bits - idiotie¬ª</a></li>
<li><a href="../fr441674/index.html">Disposition de test? Facile</a></li>
<li><a href="../fr441676/index.html">Comment se faire des amis PLUTO et HDSDR</a></li>
<li><a href="../fr441678/index.html">Jeu physique des tornades: comment l'a√©rodynamique est impl√©ment√©e dans Just Cause 4 (trafic)</a></li>
<li><a href="../fr441680/index.html">Programme de la conf√©rence Lua √† Moscou 2019</a></li>
<li><a href="../fr441682/index.html">HyperX Fury 3D - SSD avec un pedigree clair</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>