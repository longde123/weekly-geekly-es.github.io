<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåï üßñ üë©üèæ‚Äçü§ù‚Äçüë®üèø Establecimos un proyecto conveniente de npm para nosotros y para el equipo o un poco sobre herramientas modernas üïäÔ∏è ‚òÄÔ∏è üëéüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos Recientemente me encontr√© con la tarea de configurar paquetes privados npm. Todo sonaba muy interesante y prometedor hasta que result√≥ qu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Establecimos un proyecto conveniente de npm para nosotros y para el equipo o un poco sobre herramientas modernas</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417429/"><p><img src="https://habrastorage.org/webt/de/cu/3u/decu3uxv998uiwmqbioi99ojnfi.png"></p><br><p>  Hola a todos  Recientemente me encontr√© con la tarea de configurar paquetes privados npm.  Todo sonaba muy interesante y prometedor hasta que result√≥ que no hab√≠a mucho que hacer all√≠.  Todo habr√≠a terminado aqu√≠, pero surgi√≥ la segunda tarea: escribir un repositorio de demostraci√≥n para el paquete npm, que podr√≠a tomarse, clonarse y basarse en √©l para crear r√°pidamente algo √∫til y con el mismo estilo. </p><br><p> El resultado fue un proyecto con formato personalizado, estilo de c√≥digo, pruebas para cada grupo, l√≠mites de cobertura de c√≥digo, informe de cobertura de c√≥digo y documentaci√≥n autom√°tica.  M√°s publicaci√≥n conveniente en npm.  Detalles sobre la configuraci√≥n: debajo del corte. </p><a name="habracut"></a><br><h2 id="trebovaniya">  Requisitos </h2><br><p>  Primero, descubr√≠ lo que ya tenemos: </p><br><ul><li>  Los nuevos proyectos se escriben en TypeScript </li><li>  Adem√°s de nuevos proyectos, hay un mont√≥n de proyectos en JavaScript puro </li><li>  Hay requisitos para escribir pruebas y los resultados deben enviarse para su an√°lisis. </li></ul><br><p>  Luego estim√≥ su lista de deseos, ya que hay tiempo y deseo, ¬øpor qu√© no tomarlo con calma?  Lo que m√°s quiero: </p><br><ul><li>  Quiero un estilo de formato uniforme </li><li>  Quiero un estilo unificado de TypeScript </li><li>  Quiero documentaci√≥n, pero no quiero escribirla. </li><li>  En general, quiero automatizar todo al m√°ximo.  ¬øQu√© ser√≠a fyr-fyr-fyr y en producci√≥n </li></ul><br><p>  Como resultado, los requisitos tomaron forma en lo siguiente: </p><br><ul><li>  El m√≥dulo debe ser TypeScript y probado con TsLint </li><li>  El m√≥dulo debe usarse desde TypeScript y desde JavaScript </li><li>  Las pruebas deben configurarse en git hook, la cobertura m√≠nima del c√≥digo tambi√©n debe configurarse, las estad√≠sticas deben ser </li><li>  El formato debe estar configurado </li><li>  La documentaci√≥n debe crearse a partir del c√≥digo. </li><li>  La publicaci√≥n debe ser conveniente y consistente. </li><li>  Todo lo que se puede automatizar. </li></ul><br><p>  Parece agradable, debes intentarlo. </p><br><h2 id="predvaritelnye-telodvizheniya">  Gestos preliminares </h2><br><p>  Creamos (clonamos) el repositorio, inicializamos package.json, establecemos TypeScript localmente.  En general, establecemos todas las dependencias localmente, porque  todo ir√° al servidor.  No olvides <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">arreglar las dependencias de la versi√≥n</a> . </p><br><pre><code class="hljs swift">git <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> npm <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> npm i -<span class="hljs-type"><span class="hljs-type">D</span></span> typescript ./node_modules/.bin/tsc --<span class="hljs-keyword"><span class="hljs-keyword">init</span></span></code> </pre> <br><p>  Inmediatamente en el acto, necesita ajustar tsconfig.json por usted mismo: establezca el objetivo, libs, include / exclude, outDir y otras opciones. </p><br><h2 id="stil-formatirovaniya">  Estilo de formato </h2><br><p>  Para mantener un formato uniforme, tom√© dos herramientas.  El primero es el archivo .editorconfig.  Lo entienden todos los IDE principales (WebStorm, VSCode, Visual Studio, etc.), no requiere la instalaci√≥n de nada superfluo y funciona con una gran cantidad de tipos de archivos: js, ts, md, etc. </p><br><pre> <code class="hljs vbscript">#root = <span class="hljs-literal"><span class="hljs-literal">true</span></span> [*] indent_style = <span class="hljs-built_in"><span class="hljs-built_in">space</span></span> end_of_line = lf charset = utf<span class="hljs-number"><span class="hljs-number">-8</span></span> trim_trailing_whitespace = <span class="hljs-literal"><span class="hljs-literal">true</span></span> insert_final_newline = <span class="hljs-literal"><span class="hljs-literal">true</span></span> max_line_length = <span class="hljs-number"><span class="hljs-number">100</span></span> indent_size = <span class="hljs-number"><span class="hljs-number">4</span></span> [*.md] trim_trailing_whitespace = <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br><p>  Ahora, el autoformato se comportar√° m√°s o menos igual con mis colegas. </p><br><p>  La segunda herramienta es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">m√°s bonita</a> .  Este es un paquete npm que verifica y, si es posible, corrige autom√°ticamente el formato de texto.  Inst√°lelo localmente y agregue el primer comando a package.json </p><br><pre> <code class="hljs matlab">npm <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> -D prettier</code> </pre> <br><p>  package.json </p><br><pre> <code class="hljs css">"<span class="hljs-selector-tag"><span class="hljs-selector-tag">prettier</span></span>": "<span class="hljs-selector-tag"><span class="hljs-selector-tag">prettier</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--config</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.prettierrc</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.json</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--write</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">src</span></span><span class="hljs-comment"><span class="hljs-comment">/**/</span></span>*<span class="hljs-selector-class"><span class="hljs-selector-class">.ts</span></span>"</code> </pre> <br><p>  Prettier no tiene un comando init, por lo que debe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">configurarlo</a> manualmente.  Cree .prettierrc.json en la ra√≠z del proyecto con algo como este contenido controvertido (en todo caso, la publicaci√≥n no trata sobre qu√© citas son mejores, pero puede intentarlo) </p><br><p>  .prettierrc.json </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"tabWidth"</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">"useTabs"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"semi"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"singleQuote"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"trailingComma"</span></span>: <span class="hljs-string"><span class="hljs-string">"es5"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"arrowParens"</span></span>: <span class="hljs-string"><span class="hljs-string">"always"</span></span> }</code> </pre> <br><p>  Ahora cree la carpeta src, cree index.ts con alg√∫n contenido condicional e intente ejecutar m√°s bonito.  Si no le gusta su formato, lo arreglar√° autom√°ticamente.  Muy comodo  Si no desea recordar esto solo durante un commit / push, puede <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">configurarlo para que se ejecute autom√°ticamente</a> o instalar una extensi√≥n para el estudio. </p><br><h2 id="stil-koda">  Estilo de c√≥digo </h2><br><p>  Con el estilo de c√≥digo, tampoco todo es complicado.  Para JavaScript, hay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">eslint</a> ; para TypeScript, hay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tslint</a> .  Ponemos tslint y creamos tsconfig.js para almacenar la configuraci√≥n </p><br><pre> <code class="hljs coffeescript"><span class="hljs-built_in"><span class="hljs-built_in">npm</span></span> i -D tslint .<span class="hljs-regexp"><span class="hljs-regexp">/node_modules/</span></span>.bin/tslint --init</code> </pre> <br><p>  package.json </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"lint"</span></span>: <span class="hljs-string"><span class="hljs-string">"tslint -c tslint.json 'src/**/*.ts' 'tests/**/*.spec.ts'"</span></span></code> </pre> <br><p>  Puede escribir sus propias reglas o puede usar las reglas existentes usando el par√°metro extender.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Aqu√≠</a> , por ejemplo, una configuraci√≥n de airbnb. </p><br><div class="spoiler">  <b class="spoiler_title">Los desarrolladores de Tslint est√°n bromeando</b> <div class="spoiler_text"><pre> <code class="hljs powershell">module.exports = { extends: <span class="hljs-string"><span class="hljs-string">"./tslint-base.json"</span></span>, rules: { <span class="hljs-string"><span class="hljs-string">"no-excessive-commenting"</span></span>: [<span class="hljs-type"><span class="hljs-type">true</span></span>, {<span class="hljs-type"><span class="hljs-type">maxComments</span></span>: <span class="hljs-type"><span class="hljs-type">Math.random</span></span>() * <span class="hljs-number"><span class="hljs-number">10</span></span>}] } };</code> </pre> <br><p>  Bueno, ¬øno es eso bonito? </p></div></div><br><p>  Hay un punto importante: tslint y la intersecci√≥n m√°s bonita en la funcionalidad (por ejemplo, en la longitud de una cadena o comas "colgantes").  Por lo tanto, si usa ambos, deber√° supervisar el cumplimiento o abandonar algo. </p><br><p>  Y, sin embargo, para aquellos que desean verificar no todos los archivos, sino solo los organizados, hay un paquete con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pelusas</a> . </p><br><h2 id="testy">  Pruebas </h2><br><p>  ¬øQu√© necesitamos de las pruebas sobre todo?  En primer lugar, para que comiencen autom√°ticamente, en segundo lugar, el control de cobertura, en tercer lugar, algunos informes, preferiblemente en formato lcov (en todo caso, lcov es bien entendido por diferentes analizadores, desde SonarQube hasta CodeCov).  Nos ocuparemos de la automatizaci√≥n un poco m√°s tarde, mientras configuramos las pruebas ellos mismos. </p><br><p>  Ponemos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">karma</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">jazm√≠n</a> y todo el kit de cuerpo correspondiente. </p><br><pre> <code class="hljs powershell">npm i <span class="hljs-literal"><span class="hljs-literal">-D</span></span> karma karma<span class="hljs-literal"><span class="hljs-literal">-jasmine</span></span> jasmine karma<span class="hljs-literal"><span class="hljs-literal">-typescript</span></span> karma<span class="hljs-literal"><span class="hljs-literal">-chrome</span></span><span class="hljs-literal"><span class="hljs-literal">-launcher</span></span> @types/jasmine ./node_modules/.bin/karma init</code> </pre> <br><p>  Modificamos un poco karma.conf.js e inmediatamente configuramos el trabajo con cobertura </p><br><div class="spoiler">  <b class="spoiler_title">karma.conf.js</b> <div class="spoiler_text"><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">karmaTypescriptConfig</span></span> : { <span class="hljs-attribute"><span class="hljs-attribute">include</span></span>: [<span class="hljs-string"><span class="hljs-string">"./src/**/*.ts"</span></span>, <span class="hljs-string"><span class="hljs-string">"./tests/**/*.spec.ts"</span></span>], tsconfig: <span class="hljs-string"><span class="hljs-string">"./tsconfig.json"</span></span>, reports: { <span class="hljs-string"><span class="hljs-string">"html"</span></span>: <span class="hljs-string"><span class="hljs-string">"coverage"</span></span>, <span class="hljs-string"><span class="hljs-string">"lcovonly"</span></span>: { directory: <span class="hljs-string"><span class="hljs-string">'./coverage'</span></span>, filename: <span class="hljs-string"><span class="hljs-string">'../lcov.dat'</span></span> } }, <span class="hljs-selector-tag"><span class="hljs-selector-tag">coverageOptions</span></span>: { <span class="hljs-attribute"><span class="hljs-attribute">threshold</span></span>: { global: { statements: <span class="hljs-number"><span class="hljs-number">60</span></span>, branches: <span class="hljs-number"><span class="hljs-number">60</span></span>, functions: <span class="hljs-number"><span class="hljs-number">60</span></span>, lines: <span class="hljs-number"><span class="hljs-number">60</span></span>, excludes: [] }, <span class="hljs-selector-tag"><span class="hljs-selector-tag">file</span></span>: { <span class="hljs-attribute"><span class="hljs-attribute">statements</span></span>: <span class="hljs-number"><span class="hljs-number">60</span></span>, branches: <span class="hljs-number"><span class="hljs-number">60</span></span>, functions: <span class="hljs-number"><span class="hljs-number">60</span></span>, lines: <span class="hljs-number"><span class="hljs-number">60</span></span>, excludes: [], overrides: {} } } }, }</code> </pre> </div></div><br><p>  Y, por supuesto, no olvide agregar un nuevo comando a package.json </p><br><p>  package.json </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"test"</span></span>: <span class="hljs-string"><span class="hljs-string">"karma start"</span></span></code> </pre> <br><p>  Si est√° usando o planea usar CI, entonces es mejor poner <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">HeadlessChrome</a> : </p><br><pre> <code class="hljs matlab">npm <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> -D puppeteer</code> </pre> <br><p>  Y preconfigure Karma (correcci√≥n de Chrome en ChromeHeadless) m√°s algo m√°s.  Las ediciones se pueden ver en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">repositorio de demostraci√≥n</a> . </p><br><p>  Ejecute las pruebas, verifique que todo funcione.  Al mismo tiempo, verifique el informe de cobertura (est√° en la carpeta de cobertura) y elim√≠nelo del control de versiones, no es necesario en el repositorio. </p><br><p>  Informe: </p><br><p><img src="https://habrastorage.org/webt/9h/0l/pi/9h0lpiplvfhu8pxbrawnnwysdw4.png"></p><br><h2 id="stil-kommitov">  Comprometer estilo </h2><br><p>  Los commits tambi√©n se pueden unificar (y al mismo tiempo llevar a alguien al rojo vivo, si se excede, por lo que es mejor sin fanatismo).  Para esto, me <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">compromet√≠</a> .  Funciona en forma de di√°logo, admite el formato convencional de registro de cambios (puede crear un registro de cambios a partir de sus confirmaciones) y hay un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">complemento</a> VsCode para ello. </p><br><pre> <code class="hljs powershell">npm i <span class="hljs-literal"><span class="hljs-literal">-D</span></span> commitizen npm i <span class="hljs-literal"><span class="hljs-literal">-D</span></span> cz<span class="hljs-literal"><span class="hljs-literal">-conventional</span></span><span class="hljs-literal"><span class="hljs-literal">-changelog</span></span></code> </pre> <br><p>  cz-convencional-changelog es un adaptador que se encarga de las preguntas y, como resultado, del formato de sus confirmaciones </p><br><p>  Agregue un nuevo comando a la secci√≥n de secuencias de comandos </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"commit"</span></span>:<span class="hljs-string"><span class="hljs-string">"git-cz"</span></span></code> </pre> <br><p>  Y una nueva secci√≥n package.json - config para commitizen </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"config"</span></span>: { <span class="hljs-string"><span class="hljs-string">"commitizen"</span></span>: { <span class="hljs-string"><span class="hljs-string">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"./node_modules/cz-conventional-changelog"</span></span> } }</code> </pre> <br><p>  El di√°logo con commitizen se ve as√≠: </p><br><p><img src="https://habrastorage.org/webt/tn/xk/_l/tnxk_ll7a-chazpw8p0a2fnl3wk.png"></p><br><h2 id="dokumentaciya">  La documentaci√≥n </h2><br><p>  Ahora a la documentaci√≥n.  Tendremos dos tipos de documentaci√≥n: de c√≥digo y de confirmaciones.  Para la documentaci√≥n del c√≥digo, tom√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">typedoc</a> (an√°logo a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">esdoc</a> pero para TypeScript).  Es muy sencillo de configurar y trabajar.  Lo principal es no olvidar eliminar los resultados de su trabajo del control de versiones. </p><br><pre> <code class="hljs matlab">npm <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> typedoc -D</code> </pre> <br><p>  y actualice package.json </p><br><p>  package.json </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"doc"</span></span>: <span class="hljs-string"><span class="hljs-string">"typedoc --out docs/src/ --readme ./README.md"</span></span></code> </pre> <br><p>  El indicador --readme forzar√° la inclusi√≥n del archivo readme en la p√°gina principal de documentaci√≥n, lo cual es conveniente. </p><br><p>  El segundo tipo de documentaci√≥n es changelog, y el paquete <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">convencional-changelog-cli</a> nos ayudar√° con √©l. </p><br><pre> <code class="hljs powershell">npm i <span class="hljs-literal"><span class="hljs-literal">-D</span></span> conventional<span class="hljs-literal"><span class="hljs-literal">-changelog</span></span><span class="hljs-literal"><span class="hljs-literal">-cli</span></span></code> </pre> <br><p>  package.json </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"changelog"</span></span>: <span class="hljs-string"><span class="hljs-string">"conventional-changelog -p angular -i CHANGELOG.md -s"</span></span></code> </pre> <br><p>  Desde angular solo hay formato y nada m√°s.  Ahora para actualizar el registro de cambios simplemente ejecute npm run changelog.  Lo principal es escribir cuidadosamente commits.  Bueno, siempre escribimos commits perfectos, por lo que esto no deber√≠a ser un problema. </p><br><h2 id="bild">  Construir </h2><br><p>  Dado que nuestro paquete tambi√©n deber√≠a funcionar para JavaScript, necesitamos convertir TypeScript en JavaScript.  Adem√°s, ser√≠a bueno hacer un paquete minificado, por si acaso.  Para esto necesitamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">uglifyjs</a> y un peque√±o paquete de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ajustes.json</a> </p><br><pre> <code class="hljs matlab">npm <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> -D uglifyjs</code> </pre> <br><p>  package.json </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"clean"</span></span>:<span class="hljs-string"><span class="hljs-string">"rmdir dist /S /Q"</span></span>, <span class="hljs-string"><span class="hljs-string">"build"</span></span>: <span class="hljs-string"><span class="hljs-string">"tsc --p ./ --sourceMap false"</span></span>, <span class="hljs-string"><span class="hljs-string">"bundle"</span></span>: <span class="hljs-string"><span class="hljs-string">"uglifyjs ./dist/*.js --compress --mangle --output ./dist/index.min.js"</span></span></code> </pre> <br><p>  Por cierto, si desea controlar el tama√±o de su proyecto, hay dos paquetes m√°s interesantes </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">paquete</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sizelimit</a> : lo mismo pero en webpack </li></ul><br><p>  Tambi√©n se pueden integrar en el proceso de confirmaci√≥n / env√≠o / publicaci√≥n para mantenerse en el tama√±o de paquete aceptable.  Muy, muy servicial. </p><br><h2 id="avtomatizaciya">  Automatizaci√≥n </h2><br><p>  Bueno, ya hemos tomado los pasos b√°sicos, ahora todo necesita ser automatizado, de lo contrario ser√° francamente inconveniente trabajar. </p><br><p>  Para esto necesitamos un paquete m√°s: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">husky</a> .  Reescribe git hooks y llama a los comandos asociados desde package.json.  Por ejemplo, cuando se compromete, el precompromiso funcionar√°, push - prepush, etc.  Si el script devuelve un error, la confirmaci√≥n fallar√°. </p><br><pre> <code class="hljs matlab">npm <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> -D husky</code> </pre> <br><p>  package.json </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"precommit"</span></span>:<span class="hljs-string"><span class="hljs-string">"npm run prettier"</span></span>, <span class="hljs-string"><span class="hljs-string">"prepush"</span></span>: <span class="hljs-string"><span class="hljs-string">"call npm run lint &amp;&amp; call npm run test"</span></span></code> </pre> <br><p>  Aqu√≠ hay un matiz importante, el uso de la sintaxis de llamadas no es multiplataforma y no despegar√° en sistemas Unix.  Entonces, si desea hacer todo honestamente, tambi√©n debe instalar el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">paquete npm-run-all</a> , lo mismo pero multiplataforma. </p><br><h2 id="publikaciya">  Publicar </h2><br><p>  Bueno, aqu√≠ llegamos a la publicaci√≥n de nuestro paquete (aunque vac√≠o).  Pensemos lo que queremos de la publicaci√≥n? </p><br><ul><li>  Prueba todo de nuevo </li><li>  Recoge artefactos de construcci√≥n </li><li>  Recopilar documentaci√≥n </li><li>  Elevar versi√≥n </li><li>  Disparar etiquetas </li><li>  Enviar a npm </li></ul><br><p>  Las manos lo hacen todo, triste.  O te olvidas de algo, o necesitas escribir una lista de verificaci√≥n.  Tambi√©n es necesario automatizar.  Puede poner otro paquete: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">desatar</a> .  Y puede usar los ganchos nativos de npm: preversi√≥n, versi√≥n, postversi√≥n, por ejemplo, as√≠: </p><br><pre> <code class="hljs sql">"preversion": "npm run test", "version": "<span class="hljs-keyword"><span class="hljs-keyword">call</span></span> npm run clean &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> npm run <span class="hljs-keyword"><span class="hljs-keyword">build</span></span> &amp;&amp; npm run bundle &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> npm run doc &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> npm run changelog &amp;&amp; git <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> . &amp;&amp; git <span class="hljs-keyword"><span class="hljs-keyword">commit</span></span> -m <span class="hljs-string"><span class="hljs-string">'changelogupdate'</span></span> <span class="hljs-comment"><span class="hljs-comment">--no-verify", "postversion": "git add . &amp;&amp; git push &amp;&amp; git push --tags",</span></span></code> </pre> <br><p>  Queda por especificar para package.json qu√© incluir en el paquete, el punto de entrada y la ruta a nuestros tipos (no olvide especificar el indicador --declaration en tsconfig.json para obtener archivos d.ts) </p><br><p>  package.json </p><br><pre> <code class="hljs powershell"><span class="hljs-string"><span class="hljs-string">"main"</span></span>: <span class="hljs-string"><span class="hljs-string">"./dist/index.min.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"types"</span></span>: <span class="hljs-string"><span class="hljs-string">"./dist/index.d.ts"</span></span>, <span class="hljs-string"><span class="hljs-string">"files"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"dist/"</span></span>, <span class="hljs-string"><span class="hljs-string">"src/"</span></span>, <span class="hljs-string"><span class="hljs-string">"tests/"</span></span> ]</code> </pre> <br><p>  Bueno, eso parece ser todo.  Ahora es suficiente hacer </p><br><pre> <code class="hljs coffeescript"><span class="hljs-built_in"><span class="hljs-built_in">npm</span></span> version ... <span class="hljs-built_in"><span class="hljs-built_in">npm</span></span> publish</code> </pre> <br><p>  Y todo lo dem√°s se har√° autom√°ticamente. </p><br><h2 id="bonus">  Bono </h2><br><p>  Como beneficio adicional, hay un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">repositorio de demostraci√≥n</a> que admite todo esto + CI usando travis-ci.  Perm√≠teme recordarte que HeadlessChrome est√° configurado all√≠, as√≠ que si esto es importante para ti, te aconsejo que busques all√≠. </p><br><h2 id="blagodarnosti">  Agradecimientos </h2><br><p>  Muchas gracias a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Alexei Volkov</a> por su informe sobre JsFest, que se convirti√≥ en la base de este art√≠culo. </p><br><p>  Gracias a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">max7z</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">indestructible</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">justboris</a> por aclarar que se pueden omitir rutas a dependencias locales. </p><br><h2 id="i-nemnogo-statistiki">  Y algunas estad√≠sticas </h2><br><ul><li>  Tama√±o de nodos_m√≥dulos: 444 MB (NTFS) </li><li>  N√∫mero de dependencias del primer nivel: 17 </li><li>  Total de paquetes utilizados: 643 </li></ul><br><h2 id="poleznye-ssylki">  Enlaces utiles </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">.editorconfig</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">m√°s bonita</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tslint</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">eslint</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">typedoc</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">esdoc</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el ciudadano</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">plugin de compromiso para vscode</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">registro de cambios convencional</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">uglifyjs</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">paquete</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sizelimit</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ronca</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">npm-run-all</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">desatar</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">repositorio de demostraci√≥n</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es417429/">https://habr.com/ru/post/es417429/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es417415/index.html">Lecciones de impresi√≥n 3D. Impresi√≥n de piezas con diferentes grosores de capa de 3Dtool</a></li>
<li><a href="../es417419/index.html">[Ekaterimburgo, anuncio] Alice visitando Kontur - hackathon para crear habilidades para asistentes de voz</a></li>
<li><a href="../es417421/index.html">Volverse dalt√≥nico: un experimento de empat√≠a</a></li>
<li><a href="../es417423/index.html">33 consejos para el marketing de ICO</a></li>
<li><a href="../es417427/index.html">Video de UralJS # 8 mitap: trabajando con datos sin procesar en un navegador y habilidades de escritura para Alice</a></li>
<li><a href="../es417431/index.html">Anti-entrevista</a></li>
<li><a href="../es417435/index.html">Se encontr√≥ un error tipogr√°fico en la configuraci√≥n de Aliens: Colonial Marines, debido a que la IA del juego estuvo defectuosa durante cuatro a√±os</a></li>
<li><a href="../es417437/index.html">Proyector vs panel plano. Nos probamos la bata de un oftalm√≥logo y descubrimos por qu√© el tama√±o importa</a></li>
<li><a href="../es417439/index.html">El Intel Core i7-8086K (parte 1)</a></li>
<li><a href="../es417441/index.html">C√≥mo detuvimos a jugadores comunes y para DDoS o nuestros servidores: una gu√≠a pr√°ctica</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>