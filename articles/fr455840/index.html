<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§† üé® üöÖ Comment travailler avec plusieurs requ√™tes. Composition, r√©ducteur, FP üë®‚ÄçüöÄ üí™ ‚ò¢Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut, Habr. Je m'appelle Maxim, je suis d√©veloppeur iOS chez FINCH. Aujourd'hui, je vais vous montrer quelques pratiques d'utilisation de la programm...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment travailler avec plusieurs requ√™tes. Composition, r√©ducteur, FP</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455840/">  Salut, Habr.  Je m'appelle Maxim, je suis d√©veloppeur iOS chez FINCH.  Aujourd'hui, je vais vous montrer quelques pratiques d'utilisation de la programmation fonctionnelle que nous avons d√©velopp√©es dans notre d√©partement. <br><a name="habracut"></a><br>  Je tiens √† noter tout de suite que je ne vous exhorte pas √† utiliser la programmation fonctionnelle partout - ce n'est pas une panac√©e pour tous les probl√®mes.  Mais il me semble, dans certains cas, que FP peut fournir les solutions les plus flexibles et √©l√©gantes √† des probl√®mes non standard. <br><br>  FP est un concept populaire, donc je ne vais pas expliquer les bases.  Je suis s√ªr que vous utilisez d√©j√† map, r√©duire, compactMap, d'abord (o√π :) et des technologies similaires dans vos projets.  L'article se concentrera sur la r√©solution du probl√®me des requ√™tes multiples et sur l'utilisation du r√©ducteur. <br><br><h3>  Probl√®me de requ√™te multiple </h3><br>  Je travaille dans l'externalisation de la production, et il y a des situations o√π un client avec ses sous-traitants s'occupe de cr√©er un backend.  C'est loin d'√™tre le backend le plus pratique et vous devez faire des requ√™tes multiples et parall√®les. <br><br>  Parfois, je pouvais √©crire quelque chose comme: <br><br><pre><code class="swift hljs">networkClient.sendRequest(request1) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .success(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> response1): <span class="hljs-comment"><span class="hljs-comment">// ... self.networkClient.sendRequest(request2) { result in // ... switch result { case .success(let response2): // ...  -     response self.networkClient.sendRequest(request3) { result in switch result { case .success(let response3): // ...  -     completion(Result.success(response3)) case .failure(let error): completion(Result.failure(.description(error))) } } case .failure(let error): completionHandler(Result.failure(.description(error))) } } case .failure(let error): completionHandler(Result.failure(.description(error))) } }</span></span></code> </pre> <br>  D√©go√ªtant, non?  Mais c'est la r√©alit√© avec laquelle j'avais besoin de travailler. <br><br>  J'ai d√ª envoyer trois demandes d'autorisation cons√©cutives.  Lors de la refactorisation, j'ai pens√© que ce serait une bonne id√©e de diviser chaque demande en m√©thodes distinctes et de les appeler √† l'int√©rieur de l'ach√®vement, d√©chargeant ainsi une √©norme m√©thode.  Il s'est av√©r√© quelque chose comme: <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">obtainUserStatus</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(completion: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(Result&lt;AuthResponse&gt;)</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> endpoint= <span class="hljs-type"><span class="hljs-type">AuthEndpoint</span></span>.loginRoute networkService.request(endpoint: endpoint, cachingEnabled: <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] (result: <span class="hljs-type"><span class="hljs-type">Result</span></span>&lt;<span class="hljs-type"><span class="hljs-type">LoginRouteResponse</span></span>&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .success(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> response): <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>?.obtainLoginResponse(response: response, completion: completion) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .failure(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error): completion(.failure(error)) } } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">obtainLoginResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> response: LoginRouteResponse, completion: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(Result&lt;AuthResponse&gt;)</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> endpoint= <span class="hljs-type"><span class="hljs-type">AuthEndpoint</span></span>.login networkService.request(endpoint: endpoint, cachingEnabled: <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] (result: <span class="hljs-type"><span class="hljs-type">Result</span></span>&lt;<span class="hljs-type"><span class="hljs-type">LoginResponse</span></span>&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .success(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> response): <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>?.obtainAuthResponse(response: response, completion: completion) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .failure(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error): completion(.failure(error)) } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">obtainAuthResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> response: LoginResponse, completion: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(Result&lt;AuthResponse&gt;)</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> endpoint= <span class="hljs-type"><span class="hljs-type">AuthEndpoint</span></span>.auth networkService.request(endpoint: endpoint, cachingEnabled: <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { (result: <span class="hljs-type"><span class="hljs-type">Result</span></span>&lt;<span class="hljs-type"><span class="hljs-type">AuthResponse</span></span>&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> completion(result) } }</code> </pre> <br>  On peut voir que dans chacune des m√©thodes priv√©es, je dois proxy <br><br><pre> <code class="swift hljs">completion: @escaping (<span class="hljs-type"><span class="hljs-type">Result</span></span>&lt;<span class="hljs-type"><span class="hljs-type">AuthResponse</span></span>&gt;) -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span></code> </pre> <br>  et je n'aime pas vraiment √ßa. <br><br>  Puis la pens√©e m'est venue √† l'esprit - ¬´pourquoi ne pas recourir √† une programmation fonctionnelle?¬ª  De plus, swift, avec son sucre magique et syntaxique, permet de d√©composer le code en √©l√©ments individuels de mani√®re int√©ressante et digeste. <br><br><h2>  Composition et r√©ducteur </h2><br>  La programmation fonctionnelle est √©troitement li√©e au concept de composition - m√©langer, combiner quelque chose.  Dans la programmation fonctionnelle, la composition sugg√®re que nous combinions le comportement de blocs individuels, puis, √† l'avenir, travailler avec lui. <br><br>  La composition d'un point de vue math√©matique est quelque chose comme: <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compose</span></span></span><span class="hljs-function">&lt;A,B,C&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(A)</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">B</span></span>, and g: @escaping (<span class="hljs-type"><span class="hljs-type">B</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">C</span></span>) -&gt; (<span class="hljs-type"><span class="hljs-type">A</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">C</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { a <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> g(f(a)) } }</code> </pre> <br>  Il existe des fonctions f et g qui sp√©cifient en interne les param√®tres de sortie et d'entr√©e.  Nous voulons obtenir une sorte de comportement r√©sultant de ces m√©thodes d'entr√©e. <br><br>  Par exemple, vous pouvez effectuer deux fermetures, dont l'une augmente le nombre d'entr√©e de 1 et la seconde se multiplie par elle-m√™me. <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> increment: (<span class="hljs-type"><span class="hljs-type">Int</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">Int</span></span> = { value <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value + <span class="hljs-number"><span class="hljs-number">1</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> multiply: (<span class="hljs-type"><span class="hljs-type">Int</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">Int</span></span> = { value <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value * value }</code> </pre> <br>  Par cons√©quent, nous voulons appliquer ces deux op√©rations: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> result = compose(multiply, and: increment) result(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-comment"><span class="hljs-comment">//     101</span></span></code> </pre><br><br>  Malheureusement mon exemple n'est pas associatif <br>  (si nous √©changeons incr√©ment et multiplions, nous obtenons le nombre 121), mais pour l'instant, omettons ce moment. <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> result = compose(increment, and: multiply) result(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-comment"><span class="hljs-comment">//     121</span></span></code> </pre><br>  PS J'essaie sp√©cifiquement de simplifier mes exemples pour que ce soit aussi clair que possible) <br><br>  En pratique, vous devez souvent faire quelque chose comme ceci: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> value: <span class="hljs-type"><span class="hljs-type">Int?</span></span> = array .<span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> .<span class="hljs-built_in"><span class="hljs-built_in">filter</span></span> { $<span class="hljs-number"><span class="hljs-number">0</span></span> % <span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">1</span></span> } .first(<span class="hljs-keyword"><span class="hljs-keyword">where</span></span>: { $<span class="hljs-number"><span class="hljs-number">0</span></span> &gt; <span class="hljs-number"><span class="hljs-number">10</span></span> })</code> </pre><br>  Telle est la composition.  Nous d√©finissons l'action d'entr√©e et obtenons un effet de sortie.  Mais ce n'est pas seulement l'ajout de certains objets - c'est l'ajout de tout un comportement. <br><br><h3>  Et maintenant, r√©fl√©chissons de mani√®re plus abstraite :) </h3><br>  Dans notre application, nous avons une sorte d'√©tat.  Cela peut √™tre l'√©cran que l'utilisateur voit actuellement ou les donn√©es actuelles qui sont stock√©es dans l'application, etc. <br>  De plus, nous avons une action - c'est l'action que l'utilisateur peut faire (cliquer sur le bouton, faire d√©filer la collection, fermer l'application, etc.).  En cons√©quence, nous op√©rons sur ces deux concepts et les relions l'un √† l'autre, c'est-√†-dire que nous combinons, hmmm, nous combinons (quelque part je l'ai d√©j√† entendu). <br><br>  Mais que se passe-t-il si vous cr√©ez une entit√© qui combine simplement mon √©tat et mon action ensemble? <br><br>  Nous obtenons donc un r√©ducteur <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Reducer</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">S</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-built_in"><span class="hljs-built_in">reduce</span></span>: (<span class="hljs-type"><span class="hljs-type">S</span></span>, <span class="hljs-type"><span class="hljs-type">A</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">S</span></span> }</code> </pre><br>  Nous donnerons l'√©tat et l'action actuels √† l'entr√©e de la m√©thode de r√©duction, et √† la sortie, nous obtiendrons un nouvel √©tat, qui a √©t√© form√© √† l'int√©rieur de r√©duire. <br><br>  Nous pouvons d√©crire cette structure de plusieurs mani√®res: en d√©finissant un nouvel √©tat, en utilisant une m√©thode fonctionnelle ou en utilisant des mod√®les mutables. <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Reducer</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">S</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-built_in"><span class="hljs-built_in">reduce</span></span>: (<span class="hljs-type"><span class="hljs-type">S</span></span>, <span class="hljs-type"><span class="hljs-type">A</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">S</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Reducer</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">S</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-built_in"><span class="hljs-built_in">reduce</span></span>: (<span class="hljs-type"><span class="hljs-type">S</span></span>) -&gt; (<span class="hljs-type"><span class="hljs-type">A</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">S</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Reducer</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">S</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-built_in"><span class="hljs-built_in">reduce</span></span>: (<span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> <span class="hljs-type"><span class="hljs-type">S</span></span>, <span class="hljs-type"><span class="hljs-type">A</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span> }</code> </pre> <br>  La premi√®re option est ¬´classique¬ª. <br><br>  Le second est plus fonctionnel.  Le fait est que nous ne renvoyons pas l'√©tat, mais une m√©thode qui prend des mesures, qui retourne d√©j√† √† son tour l'√©tat.  Il s'agit essentiellement du curry de la m√©thode de r√©duction. <br><br>  La troisi√®me option consiste √† utiliser l'√©tat par r√©f√©rence.  Avec cette approche, nous n'√©mettons pas seulement l'√©tat, mais travaillons avec une r√©f√©rence √† l'objet qui entre.  Il me semble que cette m√©thode n'est pas tr√®s bonne, car de tels mod√®les (mutables) sont mauvais.  Il est pr√©f√©rable de reconstruire le nouvel √©tat (instance) et de le renvoyer.  Mais pour des raisons de simplicit√© et de d√©monstration d'autres exemples, nous acceptons d'utiliser cette derni√®re option. <br><br><h3>  Appliquer un r√©ducteur </h3><br>  Nous appliquons le concept Reducer au code existant - cr√©ez un RequestState, puis initialisez-le et d√©finissez-le. <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RequestState</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// MARK: - Private properties private let semaphore = DispatchSemaphore(value: 0) private let networkClient: NetworkClient = NetworkClientImp() // MARK: - Public methods func sendRequest&lt;Response: Codable&gt;(_ request: RequestProtocol, completion: ((Result&lt;Response&gt;) -&gt; Void)?) { networkClient.sendRequest(request) { (result: Result&lt;Response&gt;) in completion?(result) self.semaphore.signal() } semaphore.wait() } }</span></span></code> </pre> <br>  Pour la synchronisation des demandes, j'ai ajout√© DispatchSemaphore <br><br>  Allez-y.  Nous devons maintenant cr√©er une RequestAction avec, disons, trois requ√™tes. <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RequestAction</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> sendFirstRequest(<span class="hljs-type"><span class="hljs-type">FirstRequest</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> sendSecondRequest(<span class="hljs-type"><span class="hljs-type">SecondRequest</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> sendThirdRequest(<span class="hljs-type"><span class="hljs-type">ThirdRequest</span></span>) }</code> </pre> <br>  Cr√©ez maintenant un r√©ducteur qui a un RequestState et RequestAction.  Nous d√©finissons le comportement - que voulons-nous faire avec la premi√®re, deuxi√®me, troisi√®me demande. <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> requestReducer = <span class="hljs-type"><span class="hljs-type">Reducer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">RequestState</span></span>, <span class="hljs-type"><span class="hljs-type">RequestAction</span></span>&gt; { state, action <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> action { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .sendFirstRequest(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> request): state.sendRequest(request) { (result: <span class="hljs-type"><span class="hljs-type">Result</span></span>&lt;<span class="hljs-type"><span class="hljs-type">FirstResponse</span></span>&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-comment"><span class="hljs-comment">// 1 Response } case .sendSecondRequest(let request): state.sendRequest(request) { (result: Result&lt;SecondResponse&gt;) in // 2 Response } case .sendThirdRequest(let request): state.sendRequest(request) { (result: Result&lt;ThirdResponse&gt;) in // 3 Response } } }</span></span></code> </pre> <br>  En fin de compte, nous appelons ces m√©thodes.  Il s'av√®re un style plus d√©claratif, dans lequel il est clair que les premi√®re, deuxi√®me et troisi√®me demandes arrivent.  Tout est lisible et clair. <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state = <span class="hljs-type"><span class="hljs-type">RequestState</span></span>() requestReducer.<span class="hljs-built_in"><span class="hljs-built_in">reduce</span></span>(&amp;state, .sendFirstRequest(<span class="hljs-type"><span class="hljs-type">FirstRequest</span></span>())) requestReducer.<span class="hljs-built_in"><span class="hljs-built_in">reduce</span></span>(&amp;state, .sendSecondRequest(<span class="hljs-type"><span class="hljs-type">SecondRequest</span></span>())) requestReducer.<span class="hljs-built_in"><span class="hljs-built_in">reduce</span></span>(&amp;state, .sendThirdRequest(<span class="hljs-type"><span class="hljs-type">ThirdRequest</span></span>()))</code> </pre><br><h3>  Conclusion </h3><br>  N'ayez pas peur d'apprendre de nouvelles choses et n'ayez pas peur d'apprendre la programmation fonctionnelle.  Je pense que les meilleures pratiques sont au carrefour de la technologie.  Essayez de combiner et de mieux tirer parti des diff√©rents paradigmes de programmation. <br><br>  S'il y a une t√¢che non triviale, il est logique de la regarder sous un angle diff√©rent. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr455840/">https://habr.com/ru/post/fr455840/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr455826/index.html">Arrosage automatique t√©l√©command√©</a></li>
<li><a href="../fr455828/index.html">Les scientifiques ont d√©couvert de nouvelles formes de synchronisation exotiques</a></li>
<li><a href="../fr455830/index.html">Un regard sur Passer par les yeux d'un d√©veloppeur .NET. Semaine # 1</a></li>
<li><a href="../fr455832/index.html">Historique d'une seule enqu√™te SQL</a></li>
<li><a href="../fr455834/index.html">Benchmarks pour les serveurs Linux: 5 outils ouverts</a></li>
<li><a href="../fr455842/index.html">R√©partissez une liste li√©e individuellement. √âdition Swift</a></li>
<li><a href="../fr455844/index.html">Cr√©ation d'un analyseur Roslyn en utilisant les tests d'encapsulation comme exemple</a></li>
<li><a href="../fr455846/index.html">Informatique distribu√©e dans Julia</a></li>
<li><a href="../fr455848/index.html">Technique pour √©viter un comportement ind√©fini lors de l'acc√®s √† un singleton</a></li>
<li><a href="../fr455850/index.html">Bo√Æte √† outils pour les chercheurs - Troisi√®me √©dition: recherche et utilisation de sources</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>