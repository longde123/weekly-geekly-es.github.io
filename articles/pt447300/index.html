<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ΩüèΩ üë©üèª‚ÄçüöÄ ü§öüèº Criando o VirtualBox para Windows üåê üë®üèø‚Äçüöí üèáüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introdu√ß√£o 
 √â um fato bem conhecido para muitos usu√°rios da vers√£o Windows do VirtualBox (a partir de agora, VB ; n√£o deve ser confundido com o Visua...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Criando o VirtualBox para Windows</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447300/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2f6/4c2/1ba/2f64c21bac5d7f0c050e7442bd08960e.png"></div><br><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Introdu√ß√£o </h4><br>  √â um fato bem conhecido para muitos usu√°rios da vers√£o Windows do VirtualBox (a partir de agora, <em>VB</em> ; n√£o deve ser confundido com o Visual Basic) que, come√ßando com 4.3.14, os desenvolvedores adicionaram o chamado "refor√ßo" projetado para evitar inje√ß√µes maliciosas no VB.  Embora as inten√ß√µes fossem boas, a implementa√ß√£o causou numerosos conflitos com produtos totalmente leg√≠timos, como antiv√≠rus, m√≥dulos criptogr√°ficos e at√© algumas atualiza√ß√µes do pr√≥prio Windows, e quando esse conflito ocorre, o VB simplesmente para de funcionar.  Os usu√°rios precisam esperar pelo menos um m√™s at√© que a nova vers√£o do VB seja lan√ßada com as exclus√µes apropriadas adicionadas.  O pior √© que o aplicativo ou atualiza√ß√£o conflitante deve ser desinstalado ou o pr√≥prio VB deve ser rebaixado para a vers√£o 4.3.12, que foi a mais recente sem prote√ß√£o.  In√∫meras solicita√ß√µes para adicionar uma lista de exclus√£o controlada pelo usu√°rio ou uma op√ß√£o para desativar o fortalecimento s√£o deixadas sem resposta.  A √∫nica resposta dos desenvolvedores soa como "se voc√™ n√£o quiser, construa a partir do c√≥digo-fonte".  Bem, parece que vamos precisar. <br><br>  Embora as instru√ß√µes de compila√ß√£o sejam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">descritas</a> no Wiki oficial do projeto, elas est√£o incompletas e um pouco desatualizadas, enquanto o procedimento de compila√ß√£o geralmente falha com vagas mensagens de erro.  Ent√£o, quando, no final, o fiz funcionar, pensei que valeria a pena documentar em detalhes todos os detalhes em um artigo separado.  Esta instru√ß√£o est√° sendo atualizada periodicamente e, no momento, est√° adaptada para a cria√ß√£o do VB vers√£o 6.0.4.  No entanto, se voc√™ precisar de informa√ß√µes sobre a cria√ß√£o de vers√µes anteriores do VB ou de bibliotecas auxiliares, sempre poder√° obt√™-lo do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">hist√≥rico de altera√ß√µes</a> . <br><br><a name="habracut"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Sum√°rio </h4><blockquote>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Declara√ß√£o do Problema</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Uma palavra de advert√™ncia</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Prepara√ß√£o do ambiente de constru√ß√£o</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Peculiaridades de Instala√ß√£o de Aplicativos</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Toques Finais</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Criando o VirtualBox</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ep√≠logo</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Altera√ß√µes</a> <br></blockquote><br><a name="task"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Declara√ß√£o do Problema </h4><br>  No come√ßo, eu queria simplific√°-lo, apenas reconstruindo os componentes bin√°rios e copiando-os na parte superior da vers√£o instalada na distribui√ß√£o oficial.  No entanto, isso parece estar longe de ser simples, porque a instala√ß√£o depende de alguma API obscura do sistema e requer instala√ß√£o de drivers e registro de componentes COM.  Eu me perguntava se era vi√°vel aprender como tudo isso funcionava e escrever um script para automatizar essas tarefas, mas, ap√≥s algumas considera√ß√µes, decidi aumentar e construir uma distribui√ß√£o completa que fosse o mais pr√≥xima poss√≠vel da oficial, apenas sem endurecimento. <br><br>  Devo dizer que essa tarefa se mostrou muito dif√≠cil e n√£o consegui cumpri-la em 100%.  O que eu encontrei foram as Adi√ß√µes de Convidados, fornecidas para Windows (32 e 64 bits), OS / 2, Linux e alguns outros sistemas * NIX.  Os coment√°rios no Makefile correspondente mencionam que todos eles s√£o constru√≠dos em m√°quinas remotas diferentes, e eu definitivamente n√£o estava ansioso para gerenciar uma f√°brica de constru√ß√£o.  Portanto, minha solu√ß√£o final foi criar tudo a partir dos c√≥digos-fonte, exceto os Additions, mas levar a imagem ISO oficial com eles e colocar na minha distribui√ß√£o como est√°.  N√£o verifiquei se as adi√ß√µes t√™m o mesmo mecanismo de prote√ß√£o, mas mesmo que nunca tenham ouvido alguma reclama√ß√£o. <br><br><a name="warnings"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Uma palavra de aviso </h4><br><h5>  ‚Ä¢ Considera√ß√µes de seguran√ßa </h5><br>  O endurecimento n√£o foi adicionado por capricho, era uma solu√ß√£o para fechar uma vulnerabilidade no VB.  Infelizmente, a Oracle se recusa a fornecer a descri√ß√£o detalhada do problema, mesmo que ele tenha sido corrigido h√° muitos anos.  Geralmente, ele tem algo a ver com o mecanismo de inje√ß√£o de DLL no Windows que, no caso do VB, pode levar √† eleva√ß√£o de privil√©gios n√£o autorizados no computador host, e existem explora√ß√µes de trabalho para esta vulnerabilidade.  Portanto, esteja avisado se voc√™ decidir usar a vers√£o menos r√≠gida de qualquer maneira. <br><br><h5>  ‚Ä¢ assinatura de drivers </h5><br>  A partir do Vista, nas vers√µes de 64 bits do Windows, os usu√°rios n√£o podem mais carregar drivers arbitr√°rios.  Os drivers devem ser assinados por um certificado com uma cadeia de certificados cruzados que v√° at√© a CA raiz da Microsoft (e no Windows 10 com a Inicializa√ß√£o segura ativada, os drivers devem ser assinados pela pr√≥pria Microsoft).  Antes de iniciar a jornada de constru√ß√£o do VB, voc√™ precisa decidir como resolver esse problema.  Voc√™ pode gastar algum dinheiro e comprar seu pr√≥prio certificado ou tentar entrar em contato com empresas terceirizadas que fornecem servi√ßos de assinatura para projetos de c√≥digo aberto (se eles concordarem em assinar drivers vulner√°veis) ou definir seu Windows no modo de teste que permite carregar drivers assinado com um certificado de teste gerado localmente. <br><br>  No artigo, vou sugerir principalmente o √∫ltimo cen√°rio, mas mencionarei como o procedimento muda se voc√™ tiver um certificado comercial "completo". <br><br><a name="environment"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Prepara√ß√£o do ambiente de constru√ß√£o </h4><br>  O guia oficial recomenda usar o Windows 7 a 10 como um sistema de compila√ß√£o.  Fiz todo o trabalho no Windows 7 SP1 x64 e n√£o acho que a vers√£o do sistema operacional afete muito o procedimento.  Lembre-se de que a m√°quina (real ou virtual) que voc√™ usar√° para criar o VB deve ter conex√£o com a Internet. <br><br>  O ambiente de compila√ß√£o requer v√°rias ferramentas.  Se algum programa tiver uma vers√£o port√°til, prefiro us√°-lo em vez de usar o instalador. <br><br>  Agora, os seguintes programas podem ser obtidos apenas como distribui√ß√µes instal√°veis ‚Äã‚Äã(pelo menos oficialmente).  Para o Visual Studio e SDK / WDK, √© importante seguir a ordem de instala√ß√£o conforme especificado abaixo.  Depois de terminar, recomendo executar o Windows Update e buscar as atualiza√ß√µes mais recentes para todos os produtos da Microsoft. <br><ul><li>  <b>Visual Studio 2010 Professional</b> <br>  Voc√™ precisa exatamente da vers√£o 2010 e ela deve ser profissional ou superior.  A vers√£o 2010 Express n√£o possui ATL, necess√°ria para criar a API COM, usada por todos os front-ends para comunica√ß√£o.  Tentei mudar para o VS 2013 ou 2015 Community Edition para que n√£o fosse um requisito ter um programa pago (que nem √© mais vendido), mas falhou at√© agora. </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Windows SDK v7.1</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Visual Studio 2010 SP1</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Atualiza√ß√£o do compilador do Visual C ++ 2010 SP1 para SDK 7.1</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Kit de Desenvolvimento de Driver do Windows (WDK) v7.1</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Windows SDK v8.1</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Activeperl</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ActivePython 2.7</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cygwin</a></b> </li></ul><br>  Os outros programas s√£o baixados como arquivos port√°teis ou c√≥digos-fonte: <br><ul><li>  <b><a href="">Qt 5.6.3</a></b> (c√≥digo fonte) </li><li>  <b>MinGW-w64 4.5.4</b> : <ul><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Vers√£o de 32 bits</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Vers√£o de 64 bits</a></b> </li></ul></li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SDL v1.2.x</a></b> (biblioteca de desenvolvimento para Visual C ++) </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cURL</a></b> (c√≥digo fonte) </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">OpenSSL 1.1.1</a></b> (c√≥digo fonte) </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">gSOAP 2.8.x</a></b> (vers√£o 2.8.41 ou superior √© recomendada) </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">libvpx 1.7.0</a></b> (c√≥digo fonte; vers√µes mais recentes n√£o suportam o VS 2010) </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">libopus 1.3</a></b> (c√≥digo fonte) </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MiKTeX Portable</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">NASM</a></b> <br>  Eu recomendo usar a vers√£o port√°til de 64 bits. </li><li> <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">WiX</a></b> <br>  Eu recomendo usar o arquivo port√°til (nomeado como <code>wix311-binaries.zip</code> ). </li></ul><br>  Voc√™ tamb√©m precisar√° dos seguintes arquivos: <br><ul><li>  <b><a href="">DocBook XML DTD 4.5</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Folhas de estilo DocBook XSL 1.69.1</a></b> </li></ul><br><div class="spoiler">  <b class="spoiler_title">Para que voc√™ quer tudo isso?</b> <div class="spoiler_text">  Se voc√™ n√£o quiser criar exatamente o mesmo pacote que eu, poder√° se livrar de algumas das ferramentas mencionadas acima.  Ent√£o, aqui vou dar alguns detalhes para sua finalidade no processo de compila√ß√£o. <br><br><ul><li>  <b>SDK 8.1</b> <br>  A compila√ß√£o real √© realizada usando o SDK 7.1, mas voc√™ precisar√° do programa SignTool da 8.1, porque a vers√£o 7.1 n√£o pode executar a assinatura dupla SHA-1 / SHA-256.  Se voc√™ tiver o SDK 8.1 instalado em outro lugar, basta copiar o <code>signtool.exe</code> com todas as suas depend√™ncias e especificar o caminho no arquivo <code>LocalConfig.kmk</code> (veja <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">abaixo</a> ). </li><li>  <b>WiX</b> <br>  Essa √© a estrutura para criar pacotes MSI.  Embora a distribui√ß√£o final do VB seja um EXE, ela cont√©m dois arquivos MSI, portanto, voc√™ precisa do WiX para constru√≠-los.  No entanto, se voc√™ pretender criar apenas os arquivos bin√°rios do VB sem empacot√°-los, poder√° faz√™-lo sem o WiX. </li><li>  <b>Sdl</b> <br>  Essa biblioteca √© usada para um <code>VBoxSDL.exe</code> simplista adicional de front-end, que pode ser usado em vez do <code>VirtualBox.exe</code> .  Em teoria, se voc√™ n√£o precisar desse componente, poder√° executar a compila√ß√£o sem ter SDL, mas eu n√£o tentei isso. </li><li>  <b>gSOAP</b> <br>  Essa biblioteca √© usada para criar o <code>VBoxWebSrv.exe</code> , servi√ßo de gerenciamento remoto do VB.  Se voc√™ n√£o possui o gSOAP, esse componente ser√° ignorado silenciosamente durante a compila√ß√£o. </li><li>  <b>libvpx</b> , <b>libopus</b> <br>  Estes s√£o os codecs de v√≠deo e √°udio usados ‚Äã‚Äãpara gravar a tela da VM.  Se voc√™ n√£o os tiver, a compila√ß√£o ainda ser√° conclu√≠da com √™xito e o VB ainda ter√° todas as op√ß√µes para captura de v√≠deo, mas essas op√ß√µes ser√£o ignoradas (mesmo que a anima√ß√£o da captura seja reproduzida, nenhuma grava√ß√£o real ser√° salva) . </li><li>  <b>Cygwin</b> <br>  Necess√°rio para construir a libvpx. </li><li>  <b>MiKTeX</b> <br>  O MiKTeX √© usado para compilar a documenta√ß√£o em PDF ( <code>doc\UserManual.pdf</code> ).  Sem esse programa, o PDF ser√° omitido silenciosamente da constru√ß√£o e embalagem. </li><li>  <b>NASM</b> <br>  O assembler usado durante a constru√ß√£o do OpenSSL.  Voc√™ pode constru√≠-lo tamb√©m sem usar o assembler, mas eu ainda recomendo us√°-lo para gerar um c√≥digo mais otimizado. </li></ul></div></div><br>  Aqui est√° o resumo de todas as ferramentas e bibliotecas que estou usando, incluindo suas vers√µes exatas (sempre que poss√≠vel) e os caminhos de instala√ß√£o que escolhi no meu sistema de compila√ß√£o.  A designa√ß√£o " <code>{x32|x64}</code> " √© usada para locais separados de instala√ß√£o das vers√µes de 32 e 64 bits. <table><tbody><tr><th>  Programa / ferramenta </th><th>  Vers√£o </th><th>  Caminho da instala√ß√£o </th></tr><tr><td>  Visual studio </td><td>  Profissional de 2010 </td><td> <code>C:\Program Files (x86)\Microsoft Visual Studio 10.0\</code> </td> </tr><tr><td>  SDK </td><td>  7.1 </td><td> <code>C:\Program Files\Microsoft SDKs\Windows\v7.1\</code> </td> </tr><tr><td>  SDK </td><td>  8.1 </td><td> <code>C:\Programs\DevKits\8.1\</code> </td> </tr><tr><td>  Wdk </td><td>  7.1.0 </td><td> <code>C:\WinDDK\7600.16385.1\</code> </td> </tr><tr><td>  Activeperl </td><td>  5.26.1 Build 2601 x64 </td><td> <code>C:\Programs\Perl\</code> </td> </tr><tr><td>  ActivePython </td><td>  2.7.14.2717 x64 </td><td> <code>C:\Programs\Python\</code> </td> </tr><tr><td>  WiX </td><td>  3.11.1.2318 </td><td> <code>C:\Programs\WiX\</code> </td> </tr><tr><td>  Qt </td><td>  5.6.3 </td><td> <code>C:\Programs\Qt\5.6.3-{x32|x64}\</code> </td> </tr><tr><td>  MinGW-32 </td><td>  4.5.4 </td><td> <code>C:\Programs\mingw32\</code> </td> </tr><tr><td>  MinGW-64 </td><td>  4.5.4 </td><td> <code>C:\Programs\mingw64\</code> </td> </tr><tr><td>  Cygwin </td><td>  - </td><td> <code>C:\Programs\cygwin64\</code> </td> </tr><tr><td>  Sdl </td><td>  1.2.15 </td><td> <code>C:\Programs\SDL\{x32|x64}\</code> </td> </tr><tr><td>  cURL </td><td>  7.64.1 </td><td> <code>C:\Programs\curl\{x32|x64}\</code> </td> </tr><tr><td>  Openssl </td><td>  1.1.1b </td><td> <code>C:\Programs\OpenSSL\{x32|x64}\</code> </td> </tr><tr><td>  gSOAP </td><td>  2.8.82 </td><td> <code>C:\Programs\gSOAP\</code> </td> </tr><tr><td>  libvpx </td><td>  1.7.0 </td><td> <code>C:\Programs\libvpx\</code> </td> </tr><tr><td>  libopus </td><td>  1.3 </td><td> <code>C:\Programs\libopus\</code> </td> </tr><tr><td>  MiKTeX Portable </td><td>  2.9.6942 </td><td> <code>C:\Programs\MiKTeX\</code> </td> </tr><tr><td>  NASM </td><td>  2.14.02 x64 </td><td> <code>C:\Programs\nasm\</code> </td> </tr><tr><td>  DocBook XML DTD </td><td>  4.5 </td><td> <code>C:\Programs\DocBook\xml\</code> </td> </tr><tr><td>  Folhas de estilo DocBook XSL </td><td>  1.69.1 </td><td> <code>C:\Programs\DocBook\xsl\</code> </td> </tr></tbody></table><a name="environment-inst"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Peculiaridades de Instala√ß√£o de Aplicativos </h4><br>  Aqui, forne√ßo algumas instru√ß√µes sobre a instala√ß√£o de algumas das ferramentas mencionadas acima, onde o procedimento n√£o √© √≥bvio ou requer a√ß√µes adicionais. <br><br><h5>  ‚Ä¢ Windows SDK v7.1 </h5>  A instala√ß√£o deste SDK provavelmente falhar√° porque inclui as vers√µes desatualizadas das bibliotecas do compilador e do tempo de execu√ß√£o.  Depois de instalar o VS 2010, h√° vers√µes mais novas das presentes no sistema, portanto, as mais antigas n√£o s√£o instaladas e o instalador principal considera um erro cr√≠tico.  Para contornar esse problema, desmarque as caixas de sele√ß√£o correspondentes ou, antes da instala√ß√£o do SDK, desinstale os pacotes denominados <i>"Microsoft Visual C ++ 2010 &lt;arch&gt; Redistributable"</i> , <i>"Microsoft Visual C ++ 2010 &lt;arch&gt; Runtime"</i> , <i>"Microsoft Compiladores Visual C ++ ... ‚Äù</i>  Deixe o SDK instalar as vers√µes mais antigas e execute o Windows Update para obter as vers√µes dispon√≠veis mais recentes. <br><br>  Ao instalar o SDK, verifique as amostras do programa (Windows Native Code Development -&gt; Samples): elas cont√™m alguns scripts usados ‚Äã‚Äãpelas regras de cria√ß√£o do VB.  Sem eles, voc√™ n√£o poder√° criar os pacotes MSI. <br><br><h5>  ‚Ä¢ Windows SDK v8.1 </h5>  Voc√™ s√≥ precisa instalar o componente "Windows Software Development Kit". <br><br><h5>  ‚Ä¢ WDK v7.1 </h5>  Voc√™ s√≥ precisa instalar o componente "Build Ambientes". <br><br><h5>  ‚Ä¢ Qt 5.6.3 </h5>  A partir do Qt 5.7.0, para constru√≠-lo, voc√™ precisa do Visual Studio 2012 ou posterior, por isso estamos presos ao 5.6.x. <br>  Como n√£o h√° compila√ß√µes oficiais para o Visual Studio 2010, teremos que construir o Qt a partir do c√≥digo-fonte. <br><br><ol><li>  Descompacte o arquivo de c√≥digo-fonte Qt em <code>C:\Programs\Qt\</code> e renomeie o diret√≥rio <code>qt-everywhere-opensource-src-5.6.3</code> para <code>5.6.3-src</code> . </li><li>  Ao lado, crie um diret√≥rio <code>build-x32</code> onde a compila√ß√£o ocorrer√°. </li><li>  Abra o console e execute os seguintes comandos para preparar o ambiente: <pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\Qt\build-x32 <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> QTVER=<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span> "C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x86 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> QTDIR=C:\Programs\Qt\<span class="hljs-variable"><span class="hljs-variable">%QTVER%</span></span>-x32 <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> <span class="hljs-built_in"><span class="hljs-built_in">PATH</span></span>=<span class="hljs-variable"><span class="hljs-variable">%QTDIR%</span></span>\bin;<span class="hljs-variable"><span class="hljs-variable">%PATH%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> QMAKESPEC=win32-msvc2010</code> </pre>  O comando <code>color</code> √© opcional, ele se livra da cor verde que foi definida pelo script <code>SetEnv.Cmd</code> . </li><li>  Agora precisamos executar o script <code>configure.bat</code> partir da <code>5.6.3-src</code> .  O VB n√£o usa grande parte do que o Qt inclui, portanto, podemos reduzir significativamente o tempo de compila√ß√£o desativando v√°rios componentes, mas observe que algumas op√ß√µes s√£o cruciais para o VB.  Particularmente, descobri que: <ul><li>  O OpenGL ES 2 n√£o √© suportado (ao criar o VB, o compilador falha ao encontrar alguns arquivos de cabe√ßalho). </li><li>  O suporte ao FreeType deve estar ativado (caso contr√°rio, o plugin <code>qoffscreen</code> n√£o ser√° criado e √© necess√°rio para o VB). </li></ul>  Esta √© a linha de comando completa com a qual acabei: <pre> <code class="dos hljs">..\<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>-src\configure.bat -prefix c:\Programs\Qt\<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>-x32 -mp -opensource -confirm-license -nomake tests -nomake examples -no-compile-examples -release -shared -pch -no-ltcg -accessibility -no-sql-sqlite -opengl desktop -no-openvg -no-nis -no-iconv -no-evdev -no-mtdev -no-inotify -no-eventfd -largefile -no-system-proxies -qt-zlib -qt-pcre -no-icu -qt-libpng -qt-libjpeg -qt-freetype -no-fontconfig -qt-harfbuzz -no-angle -incredibuild-xge -no-plugin-manifests -qmake -qreal double -rtti -strip -no-ssl -no-openssl -no-libproxy -no-dbus -no-audio-backend -no-wmf-backend -no-qml-debug -no-direct2d -directwrite -no-style-fusion -native-gestures -skip qt3d -skip qtactiveqt -skip qtandroidextras -skip qtcanvas3d -skip qtconnectivity -skip qtdeclarative -skip qtdoc -skip qtenginio -skip qtgraphicaleffects -skip qtlocation -skip qtmacextras -skip qtmultimedia -skip qtquickcontrols -skip qtquickcontrols2 -skip qtscript -skip qtsensors -skip qtserialbus -skip qtserialport -skip qtwayland -skip qtwebchannel -skip qtwebengine -skip qtwebsockets -skip qtwebview -skip qtx11extras -skip qtxmlpatterns</code> </pre> </li><li>  O caminho de instala√ß√£o do Qt especificado aqui (na op√ß√£o <code>-prefix</code> ) √© codificado nos arquivos de c√≥digo-fonte intermedi√°rios pelo script configure, para que os arquivos bin√°rios tamb√©m se lembrem dele.  Qualquer aplicativo baseado em Qt criado usando esta biblioteca procurar√° primeiro os plug-ins necess√°rios nesse caminho e, somente se n√£o puderem ser encontrados, ele usar√° seu pr√≥prio local atual.  Na maioria dos casos, isso √© bom, mas suponha que no computador em que o nosso VB esteja instalado, haja outra compila√ß√£o do Qt localizada em <code>c:\Programs\Qt\5.6.3-x32</code> , mas compilada com op√ß√µes diferentes ou por um compilador diferente?  Em seguida, o VB tentar√° carregar esses plugins (incompat√≠veis) e travar√°. <br>  Existem duas maneiras poss√≠veis de evitar esse problema.  Primeiro, adicione √† instala√ß√£o um arquivo adicional chamado <code>qt.conf</code> com o seguinte texto: <pre> <code class="plaintext hljs">[Paths] Plugins=.</code> </pre>  A outra √© corrigir o caminho de instala√ß√£o salvo antes da cria√ß√£o do Qt, para que ele aponte para o diret√≥rio do aplicativo.  Decidi seguir pela √∫ltima maneira, n√£o gostei da id√©ia de ter arquivos adicionais para o que a distribui√ß√£o Oracle VB possu√≠a.  Voc√™ precisa abrir o arquivo <code>C:\Programs\Qt\build-x32\qtbase\src\corelib\global\qconfig.cpp</code> criado pelo script configure, localize a seguinte linha: <pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> qt_configure_prefix_path_str [<span class="hljs-number"><span class="hljs-number">512</span></span> + <span class="hljs-number"><span class="hljs-number">12</span></span>] = <span class="hljs-string"><span class="hljs-string">"qt_prfxpath=c:/Programs/Qt/5.6.3-x32"</span></span>;</code> </pre>  e substitua o caminho por um √∫nico ponto, para que esta linha fique assim: <pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> qt_configure_prefix_path_str [<span class="hljs-number"><span class="hljs-number">512</span></span> + <span class="hljs-number"><span class="hljs-number">12</span></span>] = <span class="hljs-string"><span class="hljs-string">"qt_prfxpath=."</span></span>;</code> </pre>  Essa altera√ß√£o afetar√° apenas o comportamento do tempo de execu√ß√£o do VB.  A etapa de instala√ß√£o do Qt em si usar√° o caminho original, porque agora est√° armazenado nos Makefiles que n√£o modificamos. </li><li>  Em seguida, execute a constru√ß√£o usando o comando <code>nmake</code> </li><li>  E instale a biblioteca constru√≠da usando o <code>nmake install</code> </li></ol><br>  Agora abra uma nova janela do console e fa√ßa o mesmo para a vers√£o de 64 bits.  Voc√™ precisar√° substituir "x32" por "x64" em todos os caminhos, e os comandos de prepara√ß√£o do ambiente ter√£o a seguinte apar√™ncia: <pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">md</span></span> C:\Programs\Qt\build-x64 <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\Qt\build-x64 <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> QTVER=<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span> "C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x64 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> QTDIR=C:\Programs\Qt\<span class="hljs-variable"><span class="hljs-variable">%QTVER%</span></span>-x64 <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> <span class="hljs-built_in"><span class="hljs-built_in">PATH</span></span>=<span class="hljs-variable"><span class="hljs-variable">%QTDIR%</span></span>\bin;<span class="hljs-variable"><span class="hljs-variable">%PATH%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> QMAKESPEC=win32-msvc2010</code> </pre> <br>  Ap√≥s concluir a instala√ß√£o, os diret√≥rios <code>build-x32</code> , <code>build-x64</code> e <code>5.6.3-src</code> podem ser exclu√≠dos. <br><br><h5>  ‚Ä¢ MinGW </h5>  Simplesmente descompacte os arquivos de 32 e 64 bits nos respectivos diret√≥rios de instala√ß√£o. <br><br><h5>  ‚Ä¢ Cygwin </h5>  Durante a instala√ß√£o, voc√™ precisa escolher os pacotes <code>make</code> e <code>yasm</code> . <br><br><h5>  ‚Ä¢ SDL </h5><ol><li>  Descompacte o arquivo SDL duas vezes em caminhos separados: <code>C:\Programs\SDL\x32\</code> e <code>C:\Programs\SDL\x64\</code> . </li><li>  Mova todo o conte√∫do do subdiret√≥rio <code>C:\Programs\SDL\x64\lib\x64\</code> para o diret√≥rio pai (ou seja, em <code>C:\Programs\SDL\x64\lib\</code> ) e exclua os subdiret√≥rios <code>C:\Programs\SDL\x64\lib\x86</code> e <code>x64</code> . </li><li>  Fa√ßa o mesmo para a vers√£o de 32 bits: mova o conte√∫do de <code>C:\Programs\SDL\x32\lib\x86\</code> para <code>C:\Programs\SDL\x32\lib\</code> e exclua <code>C:\Programs\SDL\x64\lib\x86</code> e <code>x64</code> . </li></ol><br><h5>  ‚Ä¢ NASM </h5>  Descompacte o archive <code>nasm-2.14.02-win64.zip</code> em <code>C:\Programs\</code> e renomeie o diret√≥rio resultante <code>nasm-2.14.02</code> como <code>nasm</code> . <br><br><h5>  ‚Ä¢ OpenSSL </h5><ol><li>  Descompacte o arquivo OpenSSL em <code>C:\Programs\OpenSSL\</code> duas vezes, renomeando as c√≥pias do diret√≥rio <code>openssl-1.1.1b</code> como <code>openssl-1.1.1b-x32</code> e <code>openssl-1.1.1b-x64</code> . </li><li>  Abra o console, construa e instale a vers√£o de 32 bits executando: <pre> <code class="dos hljs">"C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x86 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-built_in"><span class="hljs-built_in">PATH</span></span>=<span class="hljs-variable"><span class="hljs-variable">%PATH%</span></span>;C:\Programs\nasm <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\OpenSSL\openssl-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>b-x32\ perl Configure VC-WIN32 no-shared --prefix=C:\Programs\OpenSSL\x32 --openssldir=C:\Programs\OpenSSL\x32\ssl nmake nmake test nmake install</code> </pre>  Se a etapa de configura√ß√£o emitir um aviso assustador sobre um compilador ausente, desconsidere esta mensagem, est√° mentindo escandalosamente. <br>  Se voc√™ n√£o quiser usar o NASM, pule o comando com a modifica√ß√£o <code>PATH</code> e, para o script <code>Configure</code> especifique o par√¢metro adicional <code>no-asm</code> . </li><li>  Agora abra uma nova janela do console e fa√ßa o mesmo para a vers√£o de 64 bits: <pre> <code class="dos hljs">"C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x64 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-built_in"><span class="hljs-built_in">PATH</span></span>=<span class="hljs-variable"><span class="hljs-variable">%PATH%</span></span>;C:\Programs\nasm <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\OpenSSL\openssl-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>b-x64\ perl Configure VC-WIN64A no-shared --prefix=C:\Programs\OpenSSL\x64 --openssldir=C:\Programs\OpenSSL\x64\ssl nmake nmake test nmake install</code> </pre>  Desativar o NASM √© o mesmo que em 32 bits. </li><li>  Agora voc√™ pode excluir os diret√≥rios <code>C:\Programs\OpenSSL\openssl-1.1.1b-x32</code> e <code>openssl-1.1.1b-x64</code> . </li></ol><br><h5>  ‚Ä¢ cURL </h5><ol><li>  Descompacte o arquivo cURL em <code>C:\Programs\curl\</code> e renomeie o subdiret√≥rio resultante <code>curl-7.64.1</code> para <code>curl-7.64.1-x32</code> . </li><li>  Abra o arquivo <code>C:\Programs\curl\curl-7.64.1-x32\winbuild\MakefileBuild.vc</code> em um editor de texto e procure o seguinte bloco de c√≥digo (ao redor das linhas No.61 a 69): <pre> <code class="plaintext hljs">!IF "$(VC)"=="6" CC_NODEBUG = $(CC) /O2 /DNDEBUG CC_DEBUG = $(CC) /Od /Gm /Zi /D_DEBUG /GZ CFLAGS = /I. /I../lib /I../include /nologo /W4 /wd4127 /GX /DWIN32 /YX /FD /c /DBUILDING_LIBCURL !ELSE CC_NODEBUG = $(CC) /O2 /DNDEBUG CC_DEBUG = $(CC) /Od /D_DEBUG /RTC1 /Z7 /LDd CFLAGS = /I. /I ../lib /I../include /nologo /W4 /wd4127 /EHsc /DWIN32 /FD /c /DBUILDING_LIBCURL !ENDIF</code> </pre>  Ap√≥s essas linhas, adicione a nova diretiva: <pre> <code class="plaintext hljs">CFLAGS = $(CFLAGS) /DCURL_DISABLE_LDAP</code> </pre>  Caso contr√°rio, a constru√ß√£o do VB falhar√° com erros de link. </li><li>  Agora abra o arquivo <code>C:\Programs\curl\curl-7.64.1-x32\winbuild\gen_resp_file.bat</code> e, ap√≥s a primeira linha ( <code>@echo OFF</code> ), insira este comando: <pre> <code class="plaintext hljs">cd .</code> </pre>  Ele n√£o faz nada, exceto redefinir o c√≥digo <code>ERRORLEVEL</code> .  O script √© t√£o simples que √© poss√≠vel concluir sem executar nenhum comando que altere o c√≥digo de erro.  Portanto, se esse c√≥digo for diferente de zero antes de iniciar o script, ele manter√° seu valor na sa√≠da do script, e o <code>nmake</code> pensaria que foi o script que retornou esse c√≥digo de erro e encerrou a compila√ß√£o com falha.  A adi√ß√£o desse <code>cd</code> falso corrige o problema. </li><li>  Agora fa√ßa uma c√≥pia completa do <code>curl-7.64.1-x32</code> sob o nome <code>curl-7.64.1-x64</code> . </li><li>  Abra o console, construa a vers√£o de 32 bits e copie os arquivos que precisamos: <pre> <code class="dos hljs">"C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x86 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\curl\curl-<span class="hljs-number"><span class="hljs-number">7</span></span>.<span class="hljs-number"><span class="hljs-number">64</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>-x32\winbuild <span class="hljs-built_in"><span class="hljs-built_in">md</span></span> C:\Programs\curl\x32 nmake /f Makefile.vc <span class="hljs-built_in"><span class="hljs-built_in">mode</span></span>=static WITH_SSL=static DEBUG=no MACHINE=x86 SSL_PATH=C:\Programs\OpenSSL\x32 ENABLE_SSPI=no ENABLE_WINSSL=no ENABLE_IDN=no <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> ..\builds\libcurl-vc-x86-release-static-ssl-static-ipv6\lib\libcurl_a.lib ..\..\x32\libcurl.lib <span class="hljs-built_in"><span class="hljs-built_in">xcopy</span></span> /E ..\builds\libcurl-vc-x86-release-static-ssl-static-ipv6\include\curl ..\..\x32\include\curl\</code> </pre> </li><li>  Abra outra janela do console e construa a vers√£o de 64 bits: <pre> <code class="dos hljs">"C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x64 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\curl\curl-<span class="hljs-number"><span class="hljs-number">7</span></span>.<span class="hljs-number"><span class="hljs-number">64</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>-x64\winbuild <span class="hljs-built_in"><span class="hljs-built_in">md</span></span> C:\Programs\curl\x64 nmake /f Makefile.vc <span class="hljs-built_in"><span class="hljs-built_in">mode</span></span>=static WITH_SSL=static DEBUG=no MACHINE=x64 SSL_PATH=C:\Programs\OpenSSL\x64 ENABLE_SSPI=no ENABLE_WINSSL=no ENABLE_IDN=no <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> ..\builds\libcurl-vc-x64-release-static-ssl-static-ipv6\lib\libcurl_a.lib ..\..\x64\libcurl.lib <span class="hljs-built_in"><span class="hljs-built_in">xcopy</span></span> /E ..\builds\libcurl-vc-x64-release-static-ssl-static-ipv6\include\curl ..\..\x64\include\curl\ <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> ..\builds\libcurl-vc-x64-release-static-ssl-static-ipv6\bin\curl.exe ..\..\x64\curl.exe</code> </pre>  Observe que, al√©m do que fizemos na vers√£o de 32 bits, tamb√©m <code>curl.exe</code> o arquivo <code>curl.exe</code> .  N√≥s o usaremos mais tarde, para baixar a imagem de adi√ß√µes de convidados. </li><li>  Os diret√≥rios <code>C:\Programs\curl\curl-7.64.1-x32</code> e <code>curl-7.64.1-x64</code> n√£o s√£o mais necess√°rios e podem ser removidos. </li></ol><br><h5>  Libvpx </h5><ol><li>  Descompacte o arquivo libvpx em <code>C:\Programs\libvpx-build\</code> . </li><li>  Inicie o terminal Cygwin, a compila√ß√£o ser√° realizada l√°.  Nossa plataforma de destino √© o Visual Studio 2010;  o sistema de compila√ß√£o oferece suporte apenas parcialmente: ele tentar√° executar a compila√ß√£o real usando o <code>msbuild.exe</code> mas n√£o funciona por algum motivo;  N√£o consegui descobrir o porqu√™.  Em vez disso, podemos simplesmente executar o pr√≥prio Visual Studio e us√°-lo para criar o projeto.  Felizmente, ele pode ser usado na linha de comando, portanto, n√£o √© necess√°rio iniciar o IDE real (embora voc√™ possa, se desejar, nesse caso, voc√™ precisar√° modificar a vari√°vel <code>PATH</code> e adicionar o caminho <code>C:\Programs\cygwin64\bin</code> , ou de qualquer outra forma, permita que o VS encontre o <code>yasm.exe</code> localizado l√° e necess√°rio para a compila√ß√£o).  Portanto, para executar a constru√ß√£o de ambas as arquiteturas, execute os seguintes comandos no terminal Cygwin: <pre> <code class="bash hljs">mkdir -p /cygdrive/c/Programs/libvpx-build/build32 <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /cygdrive/c/Programs/libvpx-build/build32 ../libvpx-1.7.0/configure --target=x86-win32-vs10 --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-install-bins --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-examples --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-tools --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-docs --prefix=../../libvpx make <span class="hljs-string"><span class="hljs-string">"/cygdrive/c/Program Files (x86)/Microsoft Visual Studio 10.0/Common7/IDE/devenv.com"</span></span> vpx.sln /Project vpx.vcxproj /Rebuild <span class="hljs-string"><span class="hljs-string">"Release|Win32"</span></span> make install mkdir -p /cygdrive/c/Programs/libvpx-build/build64 <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /cygdrive/c/Programs/libvpx-build/build64 ../libvpx-1.7.0/configure --target=x86_64-win64-vs10 --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-install-bins --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-examples --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-tools --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-docs --prefix=../../libvpx make <span class="hljs-string"><span class="hljs-string">"/cygdrive/c/Program Files (x86)/Microsoft Visual Studio 10.0/Common7/IDE/devenv.com"</span></span> vpx.sln /Project vpx.vcxproj /Rebuild <span class="hljs-string"><span class="hljs-string">"Release|x64"</span></span> make install</code> </pre> </li><li>  Feche o Cygwin, n√£o precisaremos mais dele.  O diret√≥rio <code>C:\Programs\libvpx-build</code> pode ser removido. </li></ol><br><h5>  Libopus </h5><ol><li>  Descompacte o arquivo opus em <code>C:\Programs\libopus-build\</code> , v√° para o subdiret√≥rio <code>opus-1.3\win32\VS2015</code> . </li><li>  Este projeto foi desenvolvido para a vers√£o mais recente do Visual Studio, portanto, precisamos modific√°-lo para compil√°-lo em nossa vers√£o 2010. Voc√™ pode faz√™-lo usando o IDE ou um editor de texto sem formata√ß√£o.  Eu escolhi o √∫ltimo.  Abra o arquivo <code>opus.vcxproj</code> e fa√ßa o seguinte: <ol><li>  Encontre todas as linhas que cont√™m o texto <pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PlatformToolset</span></span></span><span class="hljs-tag">&gt;</span></span>v140<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PlatformToolset</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  e substitua a <code>v140</code> pela <code>v100</code> .  Se voc√™ estiver usando o IDE, esta √© a op√ß√£o de configura√ß√£o "Platrofm Toolset" localizada na p√°gina Propriedades de configura√ß√£o -&gt; Geral.  N√£o se esque√ßa dos seletores de configura√ß√£o e plataforma na parte superior da caixa de di√°logo. </li><li>  Em seguida, procure este bloco de c√≥digo: <pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemDefinitionGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ClCompile</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  e adicione uma nova tag dentro dela: <pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DebugInformationFormat</span></span></span><span class="hljs-tag">&gt;</span></span>ProgramDatabase<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DebugInformationFormat</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  No IDE, voc√™ pode fazer isso abrindo a p√°gina Propriedades de configura√ß√£o -&gt; C / C ++ -&gt; Geral e definindo "Debug Information Format" em "ProgramDatabase (/ Zi)".  Na verdade, voc√™ pode configur√°-lo com qualquer outro valor v√°lido, n√£o precisamos do banco de dados de depura√ß√£o, mas com um valor inv√°lido, o projeto falhar√° ao criar. </li></ol></li><li>  Agora vamos criar a vers√£o Release para ambas as plataformas (usando o VS IDE ou a linha de comando) e copie a biblioteca <code>opus.lib</code> e o subdiret√≥rio <code>include\</code> no caminho de destino: <pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\libopus-build\opus-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>\win32\VS2015 <span class="hljs-built_in"><span class="hljs-built_in">md</span></span> C:\Programs\libopus\lib\x64 <span class="hljs-built_in"><span class="hljs-built_in">md</span></span> C:\Programs\libopus\lib\Win32 <span class="hljs-built_in"><span class="hljs-built_in">xcopy</span></span> /EC:\Programs\libopus-build\opus-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>\include C:\Programs\libopus\include\ "C:\Program Files (x86)\Microsoft Visual Studio <span class="hljs-number"><span class="hljs-number">10</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>\Common7\IDE\devenv.com" opus.sln /Project opus.vcxproj /Rebuild "Release|x64" <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> x64\Release\opus.lib C:\Programs\libopus\lib\x64\ "C:\Program Files (x86)\Microsoft Visual Studio <span class="hljs-number"><span class="hljs-number">10</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>\Common7\IDE\devenv.com" opus.sln /Project opus.vcxproj /Rebuild "Release|Win32" <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> Win32\Release\opus.lib C:\Programs\libopus\lib\Win32\</code> </pre> </li><li>  O diret√≥rio <code>C:\Programs\libopus-build</code> pode ser removido. </li></ol><br><h5>  ‚Ä¢ gSOAP </h5>  Abra o arquivo <code>gsoap-2.8\gsoap</code> , v√° para o subdiret√≥rio <code>gsoap-2.8\gsoap</code> e descompacte seu conte√∫do em <code>C:\Programs\gSOAP\</code> .  O OpenSSL 1.1.x requer o gSOAP vers√£o 2.8.41 ou superior.  Se, por algum motivo, voc√™ quiser usar uma vers√£o mais antiga, precisar√° aplicar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">patch</a> criado por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mattias Ellert</a> .  A aplica√ß√£o de um patch pode ser feita manualmente (o formato √© f√°cil: abra os arquivos mencionados, exclua as linhas marcadas com menos, adicione linhas marcadas com mais; o resto √© contexto) ou obtenha a ferramenta de <code>patch</code> portada para Windows e use-a. <br><br><h5>  ‚Ä¢ MiKTeX </h5><ol><li>  Descompacte o arquivo em <code>C:\Programs\MiKTeX\</code> . </li><li>  Abra o console e instale m√≥dulos adicionais: <pre> <code class="dos hljs">"C:\Programs\MiKTeX\texmfs\install\miktex\bin\mpm.exe" --verbose --install=koma-script --install=ucs --install=tabulary --install=url --install=fancybox --install=fancyvrb --install=bera --install=charter --install=mptopdf</code> </pre> </li></ol><br><h5>  ‚Ä¢ DocBook </h5>  Para XML DTD, voc√™ precisa criar um diret√≥rio e descompactar o conte√∫do do arquivo.  Para folhas de estilo XSL, todo o conte√∫do j√° est√° em um √∫nico diret√≥rio, portanto, √© necess√°rio extrair isso e renome√°-lo posteriormente. <br><br><a name="final-touches"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Toques finais </h4><br>  O ambiente de constru√ß√£o est√° quase pronto, s√£o necess√°rias mais algumas etapas.  Fa√ßa o download do arquivo de c√≥digo-fonte do VirtualBox (se ainda n√£o o tiver feito) e descompacte-o no local em que voc√™ deseja trabalhar.  Eu escolhi <code>C:\Devel\</code> para esse fim, coloquei os c√≥digos-fonte descompactados e renomeei o subdiret√≥rio para <code>VirtualBox-src</code> . <br><br><h5>  Adicionando certificados </h5><br>  Se voc√™ n√£o possui um certificado pago, recomendo que voc√™ crie pelo menos um certificado pessoal autoassinado: √© mais f√°cil fazer o Windows carregar drivers autoassinados do que os n√£o assinados.  Para fazer isso, abra o console com privil√©gios elevados e execute os seguintes comandos que adicionam dois certificados (SHA-1 e SHA-256) e os importam para seu armazenamento pessoal: <pre> <code class="dos hljs">"C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x64 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> makecert.exe -a sha1 -r -pe -ss my -n "CN=Roga and Kopyta Ltd" C:\Devel\testcert_1.cer makecert.exe -a sha256 -r -pe -ss my -n "CN=Roga and Kopyta Ltd" C:\Devel\testcert_256.cer certmgr.exe -add C:\Devel\testcert_1.cer -s -r localMachine root certmgr.exe -add C:\Devel\testcert_256.cer -s -r localMachine root</code> </pre>  Voc√™ pode, √© claro, escolher seu pr√≥prio nome para os certificados, em vez de "Roga and Kopyta Ltd", e o caminho para armazenar os arquivos.  Agora precisamos obter as impress√µes digitais dos certificados gerados.  Abra o console de gerenciamento de Certificados (executando <code>certmgr.msc</code> ) e navegue at√© o armazenamento Pessoal.  Voc√™ ver√° os dois novos certificados denominados "Roga e Kopyta Ltd" l√°.  Clique duas vezes no primeiro;  na caixa de di√°logo exibida, v√° para a guia <i>Detalhes</i> .  O campo "Algoritmo de assinatura" cont√©m o nome do algoritmo: sha256RSA ou sha1RSA.  Role para baixo at√© o campo "Impress√£o digital", que cont√©m a sequ√™ncia de n√∫meros hexadecimais.  Copie esse valor completo e anote-o em algum lugar.  Fa√ßa o mesmo para o segundo certificado;  n√£o esque√ßa de marcar qual impress√£o digital era para o SHA-1 e qual era para o SHA-256. <br><br><h5>  ‚Ä¢ Construindo xmllint </h5><br>  Uma das etapas de compila√ß√£o precisar√° do programa <code>xmllint</code> .  Eu n√£o o coloquei na lista de requisitos de compila√ß√£o porque suas fontes est√£o agrupadas no arquivo VirtualBox.  Mas voc√™ ainda precisar√° constru√≠-lo, porque as regras de compila√ß√£o do VB n√£o o fazem.  Eu escolhi <code>C:\Programs\xmllint</code> como diret√≥rio de destino. <ol><li>  Copie o diret√≥rio <code>C:\Devel\VirtualBox-src\src\libs\libxml2-2.9.4</code> em <code>C:\Programs\</code> para garantir que sua compila√ß√£o n√£o afete o VB de nenhuma maneira. </li><li>  Abra o console e execute os seguintes comandos: <pre> <code class="dos hljs">"C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x64 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\libxml2-<span class="hljs-number"><span class="hljs-number">2</span></span>.<span class="hljs-number"><span class="hljs-number">9</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>\win32 cscript.exe configure.js cruntime=/MT prefix=C:\Programs\xmllint iconv=no nmake /f Makefile.msvc nmake /f Makefile.msvc install</code> </pre> </li><li>  Remova o diret√≥rio <code>C:\Programs\libxml2-2.9.4</code> . </li></ol><br><h5>  ‚Ä¢ Modifica√ß√µes de arquivos VB </h5><br>  Antes de iniciar a compila√ß√£o, tamb√©m precisamos trazer algumas altera√ß√µes no c√≥digo-fonte do VB.  O conjunto completo deles √© apresentado aqui como um arquivo de patch para download que pode ser aplicado manualmente ou usando a ferramenta de <code>patch</code> (que voc√™ precisa baixar separadamente): <br><br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b>Vbox_build.patch</b></a> <br><br>  Se n√£o houver problemas ao aplicar o patch, voc√™ pode pular para a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pr√≥xima etapa</a> .  No entanto, se voc√™ tiver alguns problemas e precisar de mais informa√ß√µes sobre altera√ß√µes espec√≠ficas, ou se simplesmente quiser entender o que est√° sendo alterado e o motivo, poder√° continuar e ler os detalhes fornecidos abaixo.  Observe que as altera√ß√µes v√™m aqui em uma ordem diferente em compara√ß√£o ao arquivo de corre√ß√£o.  Os caminhos para os arquivos s√£o especificados em rela√ß√£o ao diret√≥rio de c√≥digo-fonte do VB <code>C:\Devel\VirtualBox-src</code> . <ol><li>  Arquivo <code>configure.vbs</code> : <ul><li>  A linha de c√≥digo: <pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Shell(DosSlashes(strPathVC &amp; <span class="hljs-string"><span class="hljs-string">"/bin/cl.exe"</span></span>), <span class="hljs-literal"><span class="hljs-literal">True</span></span>) &lt;&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code> </pre>  √© substitu√≠do por: <pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Shell(DosSlashes(strPathVC &amp; <span class="hljs-string"><span class="hljs-string">"/bin/cl.exe"</span></span>) &amp; <span class="hljs-string"><span class="hljs-string">" /?"</span></span>, <span class="hljs-literal"><span class="hljs-literal">True</span></span>) &lt;&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code> </pre>  Essa linha executa a verifica√ß√£o do compilador, mas esquece que o <code>cl.exe</code> sem nenhum argumento retorna um erro e, portanto, √© considerado um compilador inv√°lido.  Adicionando o " <code>/?</code>  "O argumento torna a sa√≠da da ajuda e a sa√≠da com o c√≥digo n√£o de erro 0. </li><li>  Agora vamos pular para a fun√ß√£o <code>CheckForMinGW32Sub</code> .  Como o nome indica, ele verifica a validade do MinGW de 32 bits.  No entanto, ele foi projetado para a vers√£o 3.3.3, enquanto estou usando o 4.5.4, que possui uma estrutura de arquivo / diret√≥rio diferente, ent√£o substitu√≠ toda a fun√ß√£o pelo c√≥digo a seguir (que √© basicamente apenas uma c√≥pia do <code>CheckForMinGWw64Sub</code> adaptada para o Variante de 32 bits): <pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> CheckForMinGW32Sub(strPathMingW32, strPathW32API) g_strSubOutput = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> strPathW32API = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> strPathW32API = strPathMingW32 LogPrint <span class="hljs-string"><span class="hljs-string">"trying: strPathMingW32="</span></span> &amp;strPathMingW32 &amp; <span class="hljs-string"><span class="hljs-string">" strPathW32API="</span></span> &amp; strPathW32API <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"bin/gcc.exe"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"bin/ld.exe"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"bin/objdump.exe"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"bin/dllwrap.exe"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"bin/dlltool.exe"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"bin/as.exe"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"include/bfd.h"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"lib32/libgcc_s.a"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/lib/dllcrt1.o"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/lib/dllcrt2.o"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/lib/libmsvcrt.a"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/lib/libmsvcr100.a"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/include/_mingw.h"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/include/stdint.h"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/include/windows.h"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Shell(DosSlashes(strPathMingW32 &amp; <span class="hljs-string"><span class="hljs-string">"/bin/gcc.exe"</span></span>) &amp; <span class="hljs-string"><span class="hljs-string">" -dumpversion"</span></span>, <span class="hljs-literal"><span class="hljs-literal">True</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">dim</span></span> offVer, iMajor, iMinor, iPatch, strVer <span class="hljs-comment"><span class="hljs-comment">' extract the version. strVer = Trim(Replace(Replace(g_strShellOutput, vbCr, ""), vbLf, "")) if (Mid(strVer, 2, 1) = ".") _ And (Mid(strVer, 4, 1) = ".") then iMajor = Int(Left(strVer, 1)) ' Is Int() the right thing here? I want atoi()!!! iMinor = Int(Mid(strVer, 3, 1)) iPatch = Int(Mid(strVer, 5)) else LogPrint "Malformed version: '" &amp; strVer &amp; "'" strVer = "" end if if strVer &lt;&gt; "" then if (iMajor = 4) And (iMinor &gt;= 4) then CheckForMinGW32Sub = True g_strSubOutput = strVer else LogPrint "MinGW32 version '" &amp; iMajor &amp; "." &amp; iMinor &amp; "." &amp; iPatch &amp; "' is not supported (or configure.vbs failed to parse it correctly)." end if else LogPrint "Couldn't locate the GCC version in the output!" end if else LogPrint "Failed to run gcc.exe!" end if end if end function</span></span></code> </pre> </li><li>  Nossa pr√≥xima fun√ß√£o √© <code>CheckForCurlSub</code> , e o bloco de c√≥digo a ser editado √©: <pre> <code class="vbscript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> LogFileExists(strPathCurl, <span class="hljs-string"><span class="hljs-string">"include/curl/curl.h"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFindFile(strPathCurl, <span class="hljs-string"><span class="hljs-string">"libcurl.dll"</span></span>) &lt;&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFindFile(strPathCurl, <span class="hljs-string"><span class="hljs-string">"libcurl.lib"</span></span>) &lt;&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> _</code> </pre>  Ele verifica a validade do libcurl, mas requer uma vers√£o vinculada dinamicamente e falha se nenhum arquivo DLL puder ser encontrado.  Estamos usando a vers√£o vinculada estaticamente, portanto, infelizmente, a verifica√ß√£o da DLL precisa ser executada e nos deixar: <pre> <code class="vbscript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> LogFileExists(strPathCurl, <span class="hljs-string"><span class="hljs-string">"include/curl/curl.h"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFindFile(strPathCurl, <span class="hljs-string"><span class="hljs-string">"libcurl.lib"</span></span>) &lt;&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> _</code> </pre> </li><li>  Agora entre na fun√ß√£o <code>CheckForPython</code> onde a vari√°vel <code>VBOX_BLD_PYTHON</code> √© gerada: <pre> <code class="vbscript hljs"> CfgPrint <span class="hljs-string"><span class="hljs-string">"VBOX_BLD_PYTHON := "</span></span> &amp; strPathPython &amp; <span class="hljs-string"><span class="hljs-string">"\python.exe"</span></span></code> </pre>  A barra invertida na frente do <code>python.exe</code> deve ser substitu√≠da pela anterior: <code>"/python.exe"</code> (sem essa corre√ß√£o, algumas verifica√ß√µes durante o processo de compila√ß√£o falhar√£o; n√£o notei outros efeitos negativos, mas √© mais bonito sem mensagens de falha e, em qualquer caso, melhor prevenir do que remediar). </li><li>  A vers√£o do Windows do script de configura√ß√£o n√£o suporta libvpx e libopus, ent√£o eu as adicionei.  Obviamente, a maneira mais simples era apenas codificar os caminhos para as bibliotecas, mas eu preferia implement√°-lo como todos os demais componentes, passando o caminho na linha de comando e verifica√ß√µes de validade adequadas.  O c√≥digo principal para isso consiste nas duas fun√ß√µes de verifica√ß√£o: <pre> <code class="vbscript hljs"><span class="hljs-comment"><span class="hljs-comment">'' ' Checks for libvpx sub CheckForVpx(strOptVpx) dim strPathVpx, str strVpx = "libvpx" PrintHdr strVpx if strOptVpx = "" then MsgError "Invalid path specified!" exit sub end if if g_strTargetArch = "amd64" then strVsBuildArch = "x64" else strVsBuildArch = "Win32" end if strLibPathVpx = "lib/" &amp; strVsBuildArch &amp; "/vpxmd.lib" strPathVpx = "" if LogFileExists(strOptVpx, "include/vpx/vpx_encoder.h") _ And LogFileExists(strOptVpx, strLibPathVpx) _ then strPathVpx = UnixSlashes(PathAbs(strOptVpx)) CfgPrint "SDK_VBOX_VPX_INCS := " &amp; strPathVpx &amp; "/include" CfgPrint "SDK_VBOX_VPX_LIBS := " &amp; strPathVpx &amp; "/" &amp; strLibPathVpx else MsgError "Can't locate " &amp; strVpx &amp; ". " _ &amp; "Please consult the configure.log and the build requirements." exit sub end if PrintResult strVpx, strPathVpx end sub '' ' Checks for libopus sub CheckForOpus(strOptOpus) dim strPathOpus, str strOpus = "libopus" PrintHdr strOpus if strOptOpus = "" then MsgError "Invalid path specified!" exit sub end if if g_strTargetArch = "amd64" then strVsBuildArch = "x64" else strVsBuildArch = "Win32" end if strLibPathOpus = "lib/" &amp; strVsBuildArch &amp; "/opus.lib" strPathOpus = "" if LogFileExists(strOptOpus, "include/opus.h") _ And LogFileExists(strOptOpus, strLibPathOpus) _ then strPathOpus = UnixSlashes(PathAbs(strOptOpus)) CfgPrint "SDK_VBOX_OPUS_INCS := " &amp; strPathOpus &amp; "/include" CfgPrint "SDK_VBOX_OPUS_LIBS := " &amp; strPathOpus &amp; "/" &amp; strLibPathOpus else MsgError "Can't locate " &amp; strOpus &amp; ". " _ &amp; "Please consult the configure.log and the build requirements." exit sub end if PrintResult strOpus, strPathOpus end sub</span></span></code> </pre>  O <code>usage</code> fun√ß√£o √© usado para imprimir a lista de argumentos da linha de comando;  anexamos nossos dois novos argumentos aqui: <pre> <code class="vbscript hljs"> Print <span class="hljs-string"><span class="hljs-string">" --with-libvpx=PATH "</span></span> Print <span class="hljs-string"><span class="hljs-string">" --with-libopus=PATH "</span></span></code> </pre>  No in√≠cio da fun√ß√£o <code>Main</code> vari√°veis ‚Äã‚Äãs√£o definidas para armazenar caminhos para os componentes, precisamos adicionar dois novos l√°: <pre> <code class="vbscript hljs"> strOptVpx = <span class="hljs-string"><span class="hljs-string">""</span></span> strOptOpus = <span class="hljs-string"><span class="hljs-string">""</span></span></code> </pre>  Um pouco mais abaixo, segue o bloco de <code>select-case</code> que processa os argumentos e preenche as vari√°veis;  adicionando nossa contribui√ß√£o: <pre> <code class="vbscript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"--with-libvpx"</span></span> strOptVpx = strPath <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"--with-libopus"</span></span> strOptOpus = strPath</code> </pre>  E, finalmente, quase no final do arquivo existe a cadeia de todas essas chamadas de fun√ß√£o de verifica√ß√£o, √© aqui que adicionamos a chamada de nossas duas novas fun√ß√µes: <pre> <code class="vbscript hljs"> CheckForVpx strOptVpx CheckForOpus strOptOpus</code> </pre> </li></ul></li><li>  O pr√≥ximo arquivo √© <code>src\VBox\Runtime\Makefile.kmk</code> .  Precisamos encontrar as defini√ß√µes das vari√°veis <code>VBoxRT_LIBS.win</code> e <code>VBoxRT-x86_LIBS.win</code> e adicionar duas novas bibliotecas a elas, <code>bcrypt.lib</code> e <code>bcrypt.lib</code> .  Portanto, o seguinte c√≥digo: <pre> <code class="plaintext hljs">VBoxRT_LIBS.win = \ $(PATH_SDK_$(VBOX_WINDDK)_LIB)/vccomsup.lib \ $(PATH_SDK_$(VBOX_WINDDK)_LIB)/wbemuuid.lib \ $(PATH_TOOL_$(VBOX_VCC_TOOL)_LIB)/delayimp.lib</code> </pre>  se transforma em: <pre> <code class="plaintext hljs">VBoxRT_LIBS.win = \ $(PATH_SDK_$(VBOX_WINDDK)_LIB)/vccomsup.lib \ $(PATH_SDK_$(VBOX_WINDDK)_LIB)/wbemuuid.lib \ $(PATH_TOOL_$(VBOX_VCC_TOOL)_LIB)/delayimp.lib \ $(PATH_SDK_$(VBOX_WINPSDK)_LIB)/crypt32.lib \ $(PATH_SDK_$(VBOX_WINPSDK)_LIB)/bcrypt.lib</code> </pre>  (n√£o perca a barra invertida ap√≥s <code>delayimp.lib</code> !);  e, respectivamente, este bloco: <pre> <code class="plaintext hljs">VBoxRT-x86_LIBS.win = \ $(PATH_SDK_$(VBOX_WINDDK)_LIB.x86)/vccomsup.lib \ $(PATH_SDK_$(VBOX_WINDDK)_LIB.x86)/wbemuuid.lib \ $(PATH_TOOL_$(VBOX_VCC_TOOL_STEM)X86_LIB)/delayimp.lib</code> </pre>  torna-se: <pre> <code class="plaintext hljs">VBoxRT-x86_LIBS.win = \ $(PATH_SDK_$(VBOX_WINDDK)_LIB.x86)/vccomsup.lib \ $(PATH_SDK_$(VBOX_WINDDK)_LIB.x86)/wbemuuid.lib \ $(PATH_TOOL_$(VBOX_VCC_TOOL_STEM)X86_LIB)/delayimp.lib \ $(PATH_SDK_$(VBOX_WINPSDK)_LIB.x86)/crypt32.lib \ $(PATH_SDK_$(VBOX_WINPSDK)_LIB.x86)/bcrypt.lib</code> </pre>  Essa altera√ß√£o √© necess√°ria para vincular com √™xito o <code>VBoxRT.dll</code> .  N√£o tenho 100% de certeza do motivo, a vers√£o do Oracle n√£o depende do tempo de carregamento do <code>crypt32.dll</code> , √© carregada em tempo de execu√ß√£o, portanto, o arquivo LIB n√£o deve ser necess√°rio.  No entanto, sem ele, o vinculador n√£o consegue encontrar algumas fun√ß√µes e falha.  Suspeito que possa estar relacionado √†s op√ß√µes de compila√ß√£o do OpenSSL, mas n√£o verifiquei isso, adicionar a depend√™ncia √© mais f√°cil.  E a segunda depend√™ncia, <code>bcrypt.dll</code> , √© um requisito para o novo OpenSSL 1.1.1. </li><li>  Se voc√™ possui o gSOAP da vers√£o 2.8.79 ou superior, edite o arquivo <code>src\VBox\Runtime\r3\win\VBoxRT-openssl-1.1plus.def</code> e adicione as seguintes linhas √† lista de exporta√ß√µes: <pre> <code class="plaintext hljs"> OpenSSL_version_num DH_generate_parameters_ex DH_new ASN1_STRING_get0_data</code> </pre>  Esta lista define quais fun√ß√µes s√£o exportadas pela biblioteca <code>VBoxRT.dll</code> (que cont√©m o OpenSSL dentro).  Quando a ferramenta <code>VBoxWebSrv.exe</code> est√° sendo vinculada, dependendo da vers√£o do gSOAP, ela pode exigir fun√ß√µes adicionais do OpenSSL.  Como est√£o ausentes na lista de exporta√ß√µes, o vinculador adiciona o pr√≥prio OpenSSL e imediatamente reclama de <code>VBoxRT</code> conflitos entre esse OpenSSL externo e sua pr√≥pria c√≥pia j√° incorporada ao <code>VBoxRT</code> .  A adi√ß√£o das exporta√ß√µes mencionadas corrige o problema. </li><li>  Como mencionei no come√ßo, n√£o construo as adi√ß√µes de convidados, mas preciso ter sua imagem ISO como parte da distribui√ß√£o.  As regras de compila√ß√£o foram projetadas para esse cen√°rio, mas esperam que a imagem ISO pronta apare√ßa magicamente no lugar certo e na hora certa.  Adicionei essa m√°gica ao arquivo <code>src\VBox\Makefile.kmk</code> .  Procure o seguinte c√≥digo: <pre> <code class="plaintext hljs"> ifdef VBOX_WITH_ADDITIONS include $(PATH_SUB_CURRENT)/Additions/Makefile.kmk endif</code> </pre>  e logo abaixo segue a regra para o download autom√°tico do arquivo de imagem: <pre> <code class="plaintext hljs"> ifndef VBOX_WITHOUT_ADDITIONS_ISO $(VBOX_PATH_ADDITIONS_ISO)/VBoxGuestAdditions.iso: $(QUIET)$(MKDIR) -p $(@D) $(VBOX_RETRY) $(TOOL_CURL_FETCH) http://download.virtualbox.org/virtualbox/$(VBOX_VERSION_STRING_RAW)/VBoxGuestAdditions_$(VBOX_VERSION_STRING_RAW).iso -o $@ endif</code> </pre>  Se voc√™ editar os arquivos manualmente, em vez de aplicar o patch, observe que os comandos da regra devem come√ßar com o caractere de tabula√ß√£o. </li><li>  Antes da vers√£o 6.0, a documenta√ß√£o era um dos subsistemas criados com √™xito sem nenhuma altera√ß√£o.  N√£o sei o que havia de errado nisso, mas foi redesenhado significativamente de tal maneira que n√£o funciona mais no meu sistema de compila√ß√£o.  N√£o tenho id√©ia de como o pr√≥prio Oracle constr√≥i a documenta√ß√£o (talvez em um sistema * NIX), mas para mim as regras de constru√ß√£o continuavam perdendo barras nos caminhos ou adicionando um excesso delas e, como resultado, n√£o conseguiram encontrar os arquivos de destino. devido a incompatibilidades nos arquivos de cat√°logo.  Finalmente consegui combinar algumas mudan√ßas que permitiram construir a documenta√ß√£o sem erros.  Primeiro, um dos diret√≥rios de destino estava ausente, portanto, alguns dos arquivos intermedi√°rios n√£o puderam ser criados.  Esse problema foi corrigido no arquivo <code>doc\manual\Makefile.kmk</code> , dentro do seguinte bloco de c√≥digo: <pre> <code class="plaintext hljs">define def_vbox_refentry_to_user_sect1 $$(VBOX_PATH_MANUAL_OUTBASE)/$(1)/user_$(2): $(3) \ $$(VBOX_PATH_MANUAL_SRC)/docbook-refentry-to-manual-sect1.xsl \ $$(VBOX_XML_CATALOG) $$(VBOX_XML_CATALOG_DOCBOOK) $$(VBOX_XML_CATALOG_MANUAL) \ $$(VBOX_VERSION_STAMP) | $$(dir $$@) $$(call MSG_TOOL,xsltproc $$(notdir $$(filter %.xsl,$$^)),,$$(filter %.xml,$$^),$$@) $$(QUIET)$$(RM) -f "$$@" $$(QUIET)$$(call VBOX_XSLTPROC_WITH_CAT) --output $$@ $$(VBOX_PATH_MANUAL_SRC)/docbook-refentry-to-manual-sect1.xsl $$&lt; endef</code> </pre>  Logo ap√≥s o <code>$$(RM)</code> , adicionei um comando para criar o diret√≥rio ausente: <pre> <code class="plaintext hljs"> $$(QUIET)$$(MKDIR) -p "$$(@D)"</code> </pre> <br>  Quanto √†s barras, as corre√ß√µes est√£o localizadas no arquivo <code>doc\manual\Config.kmk</code> .  N√£o consegui encontrar uma solu√ß√£o "normal" para isso, mas h√° uma solu√ß√£o alternativa boa o suficiente para fins pr√°ticos, o que implica duplicar as regras de substitui√ß√£o de caminho para caminhos incorretos.  Primeiro, abaixo da linha: <pre> <code class="plaintext hljs"> VBOX_FILE_URL_MAYBE_SLASH = $(if $(eq $(KBUILD_HOST),win),/,)</code> </pre> I've created two new variables which basically contain the same paths as their origins, but with triple slash after the disk letter instead of a single slash: <pre> <code class="plaintext hljs"> VBOX_PATH_MANUAL_SRC_SLASHED = $(subst :/,:///,$(VBOX_PATH_MANUAL_SRC)) VBOX_PATH_MANUAL_OUTBASE_SLASHED = $(subst :/,:///,$(VBOX_PATH_MANUAL_OUTBASE))</code> </pre> A little bit below that, there is a rule for creating the catalog file: <pre> <code class="plaintext hljs"> $(VBOX_XML_CATALOG): $(MAKEFILE_CURRENT) | $$(dir $$@) $(call MSG_L1,Creating catalog $@) $(QUIET)$(APPEND) -tn "$@" \ '&lt;?xml version="1.0"?&gt;' \ '&lt;!DOCTYPE catalog PUBLIC "-//OASIS//DTD Entity Resolution XML Catalog V1.0//EN" "http://www.oasis-open.org/committees/entity/release/1.0/catalog.dtd"&gt;' \ '&lt;catalog xmlns="urn:oasis:names:tc:entity:xmlns:xml:catalog"&gt;' \ ' &lt;delegatePublic publicIdStartString="-//OASIS/ENTITIES DocBook XML" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegatePublic publicIdStartString="-//OASIS/DTD DocBook XML" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegateSystem systemIdStartString="http://www.oasis-open.org/docbook/" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegateURI uriStartString="http://www.oasis-open.org/docbook/" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegateSystem systemIdStartString="$(VBOX_PATH_MANUAL_SRC)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="$(VBOX_PATH_MANUAL_SRC)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_PATH_MANUAL_SRC)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="$(VBOX_PATH_MANUAL_OUTBASE)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ '&lt;/catalog&gt;'</code> </pre> For each line which contains the variable <code>VBOX_PATH_MANUAL_SRC</code> or <code>VBOX_PATH_MANUAL_OUTBASE</code> (except for the line with the <code>file://</code> prefix), I've appended the copy of the whole line, but with the variable replaced with its triple-slash counterpart. The result looks like this: <pre> <code class="plaintext hljs"> $(VBOX_XML_CATALOG): $(MAKEFILE_CURRENT) | $$(dir $$@) $(call MSG_L1,Creating catalog $@) $(QUIET)$(APPEND) -tn "$@" \ '&lt;?xml version="1.0"?&gt;' \ '&lt;!DOCTYPE catalog PUBLIC "-//OASIS//DTD Entity Resolution XML Catalog V1.0//EN" "http://www.oasis-open.org/committees/entity/release/1.0/catalog.dtd"&gt;' \ '&lt;catalog xmlns="urn:oasis:names:tc:entity:xmlns:xml:catalog"&gt;' \ ' &lt;delegatePublic publicIdStartString="-//OASIS/ENTITIES DocBook XML" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegatePublic publicIdStartString="-//OASIS/DTD DocBook XML" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegateSystem systemIdStartString="http://www.oasis-open.org/docbook/" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegateURI uriStartString="http://www.oasis-open.org/docbook/" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegateSystem systemIdStartString="$(VBOX_PATH_MANUAL_SRC)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateSystem systemIdStartString="$(VBOX_PATH_MANUAL_SRC_SLASHED)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="$(VBOX_PATH_MANUAL_SRC)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="$(VBOX_PATH_MANUAL_SRC_SLASHED)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_PATH_MANUAL_SRC)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="$(VBOX_PATH_MANUAL_OUTBASE)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="$(VBOX_PATH_MANUAL_OUTBASE_SLASHED)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ '&lt;/catalog&gt;'</code> </pre> Even further down, there is another rule for creating an auxiliary catalog file; the starting line is: <pre> <code class="plaintext hljs"> $(VBOX_XML_CATALOG_MANUAL): $(MAKEFILE_CURRENT) | $$(dir $$@)</code> </pre> Here I'm doing the same operation as above. In addition, in the beginning of the generated file there are several lines defining the entries in the <code>common/</code> subdirectory: <pre> <code class="plaintext hljs"> ' &lt;system systemId="$(VBOX_PATH_MANUAL_SRC)/common/oracle-accessibility-en.xml" uri="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_PATH_MANUAL_SRC)/en_US/oracle-accessibility-en.xml"/&gt;' \ ' &lt;system systemId="$(VBOX_PATH_MANUAL_SRC)/common/oracle-support-en.xml" uri="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_PATH_MANUAL_SRC)/en_US/oracle-support-en.xml"/&gt;' \</code> </pre> With these we have the opposite problem: triple slash after the <code>file</code> is replaced with a single slash. I worked this around by getting rid of the <code>file</code> protocol altogether and replacing those URIs with direct file system paths in the target address (the <code>uri</code> attribute). The result for these lines looks like this (including the aforementioned fix): <pre> <code class="plaintext hljs"> ' &lt;system systemId="$(VBOX_PATH_MANUAL_SRC)/common/oracle-accessibility-en.xml" uri="$(VBOX_PATH_MANUAL_SRC)/en_US/oracle-accessibility-en.xml"/&gt;' \ ' &lt;system systemId="$(VBOX_PATH_MANUAL_SRC_SLASHED)/common/oracle-accessibility-en.xml" uri="$(VBOX_PATH_MANUAL_SRC)/en_US/oracle-accessibility-en.xml"/&gt;' \ ' &lt;system systemId="$(VBOX_PATH_MANUAL_SRC)/common/oracle-support-en.xml" uri="$(VBOX_PATH_MANUAL_SRC)/en_US/oracle-support-en.xml"/&gt;' \ ' &lt;system systemId="$(VBOX_PATH_MANUAL_SRC_SLASHED)/common/oracle-support-en.xml" uri="$(VBOX_PATH_MANUAL_SRC)/en_US/oracle-support-en.xml"/&gt;' \</code> </pre> </li><li> When VB is built with signing, most of its binaries receive the integrity check flag (the linker option <code>/IntegrityCheck</code> ) which forces Windows to check digital signatures and forbids launching applications which are signed incorrectly. If you have a valid paid certificate that's not a problem; however with a self-signed certificate VB will refuse to start, even if Windows is booted in the test mode. I've modified the file <code>Config.kmk</code> in such a way that this flag is only added when you have a full-grown certificate (the criterion of that is presence of a cross-certificate in <code>LocalConfig.kmk</code> ; see <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">below</a> ). The changes look like this: <ul><li> A new variable <code>VBOX_INTEGRITY_CHECK</code> is added, which contains the desired value of the option: <pre> <code class="plaintext hljs">if defined(VBOX_SIGNING_MODE) &amp;&amp; defined(VBOX_CROSS_CERTIFICATE_FILE) VBOX_INTEGRITY_CHECK := /IntegrityCheck else VBOX_INTEGRITY_CHECK := /IntegrityCheck:NO endif</code> </pre> </li><li> Below that there is the <code>editbin</code> call: <pre> <code class="plaintext hljs"> $(VBOX_VCC_EDITBIN) /LargeAddressAware /DynamicBase /NxCompat /Release /IntegrityCheck \ /Version:$(VBOX_VERSION_MAJOR)0$(VBOX_VERSION_MINOR).$(VBOX_VERSION_BUILD) \ "$@"</code> </pre> Here I've replaced the unconditional <code>/IntegrityCheck</code> with the new variable <code>$(VBOX_INTEGRITY_CHECK)</code> . </li><li> Next, look for the blocks of the following kinds: <pre> <code class="plaintext hljs">ifdef VBOX_SIGNING_MODE TEMPLATE_XXXXXX_LDFLAGS += -IntegrityCheck endif</code> </pre> or <pre> <code class="plaintext hljs">if defined(VBOX_SIGNING_MODE) &amp;&amp; defined(VBOX_WITH_HARDENING) TEMPLATE_XXXXXX_LDFLAGS += -IntegrityCheck endif</code> </pre> where ¬´ <code>XXXXXX</code> ¬ª stands for various component names. There are 6 such blocks in total, 3 of each kind. Here I've modified the condition by adding a check for cross-certificate. The first line then turns into, respectively: <pre> <code class="plaintext hljs">if defined(VBOX_SIGNING_MODE) &amp;&amp; defined(VBOX_CROSS_CERTIFICATE_FILE)</code> </pre> or <pre> <code class="plaintext hljs">if defined(VBOX_SIGNING_MODE) &amp;&amp; defined(VBOX_CROSS_CERTIFICATE_FILE) &amp;&amp; defined(VBOX_WITH_HARDENING)</code> </pre> </li></ul></li><li> Two more files modified by me do not take immediate part in building of VB: <code>src\VBox\Installer\win\Scripts\PackDriversForSubmission.cmd</code> and <code>UnpackBlessedDrivers.cmd</code> . These auxiliary scripts can be used if you intend to send the drivers into Microsoft for Windows 10 signing. The first script prepares a CAB archive for sending; the second one unpacks the resultant ZIP archive with the signed drivers and verifies the signatures. In the packing script all I did was just fixing several typos. In the unpacking script I added ability to specify path to the <code>signtool</code> program, and got rid of the <code>unzip</code> tool by replacing it with a small Perl script. The signing procedure is described below. If you don't plan to get the Microsoft signature you can simply ignore all these changes in the scripts. </li></ol><br><a name="final-touches-localconfig"></a><h5> ‚Ä¢ VB build configuration file </h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora precisamos criar o arquivo </font></font><code>LocalConfig.kmk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no diret√≥rio de fontes VB e escrever l√° todos os caminhos e construir par√¢metros. </font><font style="vertical-align: inherit;">Voc√™ pode usar o seguinte texto como modelo:</font></font><pre> <code class="plaintext hljs">VBOX_WITH_HARDENING := VBOX_PATH_WIX := C:\Programs\WiX VBOX_GSOAP_INSTALLED := 1 VBOX_PATH_GSOAP := C:\Programs\gSOAP VBOX_WITH_COMBINED_PACKAGE := 1 VBOX_WITH_QT_PAYLOAD := 1 VBOX_WITH_QTGUI_V5 := 1 VBOX_SIGNING_MODE := release VBOX_CERTIFICATE_SUBJECT_NAME := Roga and Kopyta Ltd VBOX_CERTIFICATE_FINGERPRINT := XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX VBOX_CERTIFICATE_SHA2_SUBJECT_NAME := Roga and Kopyta Ltd VBOX_CERTIFICATE_SHA2_FINGERPRINT := XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX VBOX_TSA_URL := http://timestamp.digicert.com VBOX_TSA_SHA2_URL := http://timestamp.digicert.com VBOX_TSA_URL_ARGS := /t "$(VBOX_TSA_URL)" VBOX_TSA_SHA2_URL_ARGS := /tr "$(VBOX_TSA_SHA2_URL)" /td sha256 VBOX_CROSS_CERTIFICATE_FILE := VBOX_CROSS_CERTIFICATE_FILE_ARGS := VBOX_CROSS_CERTIFICATE_SHA2_FILE := VBOX_CROSS_CERTIFICATE_SHA2_FILE_ARGS := VBOX_PATH_SIGN_TOOLS := C:\Programs\DevKits\8.1\bin\x64 VBOX_PATH_SELFSIGN := C:\WinDDK\7600.16385.1\bin\selfsign VBOX_PATH_WISUMINFO := "C:\Program Files\Microsoft SDKs\Windows\v7.1\Samples\sysmgmt\msi\scripts\WiSumInf.vbs" VBOX_PATH_WISUBSTG := "C:\Program Files\Microsoft SDKs\Windows\v7.1\Samples\sysmgmt\msi\scripts\WiSubStg.vbs" VBOX_WITH_DOCS := 1 VBOX_WITH_DOCS_CHM := 1 VBOX_WITH_DOCS_PACKING := 1 VBOX_WITH_ADDITIONS := VBOX_WITH_ADDITIONS_PACKING := 1 VBOX_HAVE_XMLLINT := 1 VBOX_XMLLINT := C:\Programs\xmllint\bin\xmllint.exe VBOX_PATH_DOCBOOK := C:/Programs/DocBook/xsl VBOX_PATH_DOCBOOK_DTD := C:/Programs/DocBook/xml VBOX_PATH_HTML_HELP_WORKSHOP := "C:\Program Files (x86)\HTML Help Workshop" VBOX_PDFLATEX := C:\Programs\MiKTeX\texmfs\install\miktex\bin\pdflatex.exe VBOX_PDFLATEX_CMD := $(VBOX_PDFLATEX) -halt-on-error -interaction batchmode TOOL_CURL_FETCH := C:\Programs\curl\x64\curl.exe PATH_TOOL_NASM := C:/Programs/nasm VBOX_INSTALLER_LANGUAGES := en_US VBOX_WITH_TESTCASES := VBOX_WITH_VALIDATIONKIT := VBOX_WITH_VBOX_IMG := 1 VBOX_WITH_RECORDING := 1 VBOX_WITH_AUDIO_RECORDING := 1 SDK_VBOX_VPX := 1 VBOX_WITH_LIBVPX := 1 SDK_VBOX_OPUS := 1 VBOX_WITH_LIBOPUS := 1 VBOX_BUILD_PUBLISHER := _OSE</code> </pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Voc√™ precisar√° editar este modelo: </font></font><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As vari√°veis </font></font><code>VBOX_CERTIFICATE_SUBJECT_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>VBOX_CERTIFICATE_SHA2_SUBJECT_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devem conter os nomes dos certificados SHA-1 e SHA-256, respectivamente.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As vari√°veis </font></font><code>VBOX_CERTIFICATE_FINGERPRINT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>VBOX_CERTIFICATE_SHA2_FINGERPRINT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devem conter as impress√µes digitais desses certificados; </font><font style="vertical-align: inherit;">voc√™ os copiou anteriormente do console de gerenciamento de certificados.</font></font></li><li> If you have a paid certificate you should delete the lines defining the variables <code>VBOX_CROSS_CERTIFICATE_FILE_ARGS</code> and <code>VBOX_CROSS_CERTIFICATE_SHA2_FILE_ARGS</code> , then in the variables <code>VBOX_CROSS_CERTIFICATE_FILE</code> and <code>VBOX_CROSS_CERTIFICATE_SHA2_FILE</code> (without ¬´ <code>_ARGS</code> ¬ª) put the full path to the cross-certificate (without it the drivers will not be accepted). You can download it from the web site of the company that issued the certificate, or <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">from Microsoft</a> . </li><li> You can fine-tune the signing process using various additional variables and macros to redefine the certificate storage, timestamp server, or even construct a full command line for the <code>signtool</code> program. You can take a look into the file <code>Config.kmk</code> below the comment ¬´Code Signing¬ª, there you'll find which variables are defined and how they are used. </li><li> If you've installed some of the programs into paths different from mine, you need to fix those paths in the template. It's strongly recommended to keep the path style for each variable (forward/backward slashes), sometimes it's critical for successful build. </li><li> Fox WiX you need to specify the path to its binaries. With the portable version, it is just the directory where you unpacked it; if you used the installer, the binaries will be located in the subdirectory <code>bin</code> . Please, note, that the path must not contain spaces! If it does you have to convert it into the 8.3 format (you can use <code>dir /x</code> for that). Unfortunately, enclosing the path in quotes does not work with this variable. </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A vari√°vel </font></font><code>VBOX_BUILD_PUBLISHER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">especifica o sufixo da marca no n√∫mero da vers√£o. </font><font style="vertical-align: inherit;">Por padr√£o, √© "_OSE" (ou seja, a vers√£o completa do produto √© "6.0.4_OSE"). </font><font style="vertical-align: inherit;">Voc√™ pode especificar qualquer outro sufixo aqui ou configur√°-lo como vazio para se livrar dele completamente. </font><font style="vertical-align: inherit;">Mas se voc√™ excluir a vari√°vel completamente, ela usar√° o padr√£o "_OSE".</font></font></li></ul><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O restante das vari√°veis ‚Äã‚Äã√© usado principalmente para declarar quais componentes devem ser constru√≠dos. </font><font style="vertical-align: inherit;">E, √© claro, a declara√ß√£o principal est√° no topo: desligue o endurecimento.</font></font><br><br><a name="build-vb"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Criando virtualbox </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finalmente, agora podemos come√ßar a criar o VirtualBox. </font><font style="vertical-align: inherit;">Se voc√™ normalmente prefere construir para diferentes plataformas em paralelo, voc√™ ter√° que ficar sem ela por enquanto ou usar duas c√≥pias separadas da √°rvore de origem, porque o VB tem um arquivo de configura√ß√£o comum que √© gerado antes da constru√ß√£o e cont√©m dados dependentes da plataforma. </font><font style="vertical-align: inherit;">N√£o seria bom para o compilador lan√ß√°-lo de repente do ambiente de compila√ß√£o de 64 bits para o de 32 bits no meio do processo de compila√ß√£o. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ precisar de assinaturas de drivers compat√≠veis com o Windows 10, consulte as informa√ß√µes fornecidas ap√≥s a descri√ß√£o do procedimento principal.</font></font><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos come√ßar com a vers√£o de 64 bits. </font><font style="vertical-align: inherit;">Abra o console e execute os seguintes comandos:</font></font><pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Devel\VirtualBox-src "C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x64 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> BUILD_TARGET_ARCH=amd64 cscript configure.vbs --with-DDK=C:\WinDDK\<span class="hljs-number"><span class="hljs-number">7600</span></span>.<span class="hljs-number"><span class="hljs-number">16385</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> --with-MinGW-w64=C:\Programs\mingw64 --with-MinGW32=C:\Programs\mingw32 --with-libSDL=C:\Programs\SDL\x64 --with-openssl=C:\Programs\OpenSSL\x64 --with-openssl32=C:\Programs\OpenSSL\x32 --with-libcurl=C:\Programs\curl\x64 --with-libcurl32=C:\Programs\curl\x32 --with-Qt5=C:\Programs\Qt\<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>-x64 --with-libvpx=C:\Programs\libvpx --with-libopus=C:\Programs\libopus --with-python=C:/Programs/Python env.bat kmk kmk C:/Devel/VirtualBox-src/out/win.x86/release/obj/Installer/VirtualBox-<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>_OSE-r128164-MultiArch_amd64.msi</code> </pre> The <code>configure.vbs</code> script verifies the environment and generates configuration files ( <code>AutoConfig.kmk</code> and <code>env.bat</code> ). The first <code>kmk</code> command builds the binaries and collect them into <code>out\win.amd64\bin\</code> . And the last command packs them all into the intermediate MSI package. Important notes: <ul><li> You must use forward slashes in the last command. With backslashes, <code>kmk</code> would fail to find the build rules. </li><li> Even though we are building the 64-bit version, the target package is located in <code>out\win.x86\‚Ä¶</code> , because the final stage of the build will be performed from the 32-bit build environment. </li><li> If you've changed the branding suffix you need to change the name of the target package by replacing the ¬´_OSE¬ª with what you specified in the variable <code>VBOX_BUILD_PUBLISHER</code> . </li><li> The revision number in the MSI package name (128164) can be found in the file <code>Config.kmk</code> inside the <code>VBOX_SVN_REV_FALLBACK</code> variable definition. Please, note, that this value may be different from revisions of the official distribution (for instance, the version 6.0.4 has release number 128413). Unfortunately, I have no idea why. </li></ul></li><li> Now we need to build the 32-bit version and pack everything together. For that, open a new console window, and run the following commands: <pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Devel\VirtualBox-src "C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x86 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> BUILD_TARGET_ARCH=x86 cscript configure.vbs --with-DDK=C:\WinDDK\<span class="hljs-number"><span class="hljs-number">7600</span></span>.<span class="hljs-number"><span class="hljs-number">16385</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> --with-MinGW-w64=C:\Programs\mingw64 --with-MinGW32=C:\Programs\mingw32 --with-libSDL=C:\Programs\SDL\x32 --with-openssl=C:\Programs\OpenSSL\x32 --with-libcurl=C:\Programs\curl\x32 --with-Qt5=C:\Programs\Qt\<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>-x32 --with-libvpx=C:\Programs\libvpx --with-libopus=C:\Programs\libopus --with-python=C:/Programs/Python env.bat kmk kmk C:/Devel/VirtualBox-src/out/win.x86/release/bin/VirtualBox-<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>_OSE-r128164-MultiArch.exe</code> </pre> Same as with the 64-bit, you need to replace the ¬´_OSE¬ª suffix with what you have. <br> Notice how in the last command we are building an <code>EXE</code> , and not an <code>MSI</code> . This is the final installer which will cause the 32-bit package to be built automatically, from dependencies. </li><li> Even if you have a paid certificate you will find that you cannot install this distribution into Windows 10 booted with Secure Boot enabled. This OS has stricter requirements, and the drivers must be signed by none other than Microsoft themselves. The procedure is explained in details on various Internet resources and is unrelated to this article, so I'm not going to go deep into this topic. Instead I'll outline the main steps you need to take for integrating this task with the VB build procedure. <ul><li> The main requirement here is that you must have not just a normal code signing certificate, but an EV one (Extended Validation). Also you need to register an account at <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Hardware Dev Center</a> and add your certificate there. </li><li> Now, during building the 64-bit version of VB, just after you've got all binary components (that is, after the first <code>kmk</code> run which was without arguments), you need to create a CAB archive with the drivers. There is a batch script template for that; the build system modifies it according to the current task and puts it into <code>out\win.amd64\release\repack\</code> . Go into this path and run the following command: <pre> <code class="dos hljs">PackDriversForSubmission.<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> -x</code> </pre> When the script finishes, the file <code>VBoxDrivers-6.0.4r128164-amd64.cab</code> will appear in the same directory. </li><li> You need to sign this CAB archive with your EV certificate. Then go to the Microsoft Hardware Dev Center, create a new submission, upload your signed archive, select the desired target OS version (make sure it's 64-bit) and send the submission. </li><li> It will take several minutes to process, after which you will have a ZIP archive where all the drivers have been signed by Microsoft in addition to your signature, and all the CAT files generated anew. Download this archive and place it somewhere so that the build system had access to it. </li><li> Unpack the archive and put all the files from the subdirectories directly into <code>out\win.amd64\release\bin\</code> overwriting the existing files. You can do it either manually or using another script from the same path <code>out\win.amd64\release\repack\</code> by running the following commands: <pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> _MY_SIGNTOOL=C:\Programs\DevKits\<span class="hljs-number"><span class="hljs-number">8</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>\bin\x64\signtool.exe UnpackBlessedDrivers.<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> -n -i <span class="hljs-built_in"><span class="hljs-built_in">path</span></span>\to\signed.zip</code> </pre> Of course, you need to put here the correct paths to <code>signtool.exe</code> and the ZIP archive. </li><li> Now you can run the second <code>kmk</code> command which packs all the components into an MSI installer. If you were doing all this in the same console window, don't forget to switch back to the base directory of the VB project. </li><li> Finally, proceed with building of the 32-bit version of VB, and perform all the same additional steps: after the first <code>kmk</code> switch to <code>out\win.x86\release\repack\</code> , create the CAB archive, sign it, send to Microsoft (now choosing the 32-bit OS version), replace the drivers with their counter-signed versions, and run the final <code>kmk</code> for building the complete VB distribution. </li></ul></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se nenhum de n√≥s estragou tudo, toda essa longa cadeia deve oferecer a voc√™ um novo e brilhante instalador do VirtualBox que difere do Oracle apenas pelo seu √≠cone, a imagem About e, √© claro, a profunda falta de prote√ß√£o. N√£o √© dif√≠cil substituir tamb√©m o √≠cone e a imagem, mas n√£o vou entrar neste t√≥pico aqui. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por conveni√™ncia, criei um </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√∫nico arquivo em lote</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que automatiza a compila√ß√£o completa do VB. Voc√™ pode us√°-lo se precisar criar o instalador completo regularmente.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apenas mais algumas palavras sobre a instala√ß√£o da distribui√ß√£o resultante, se voc√™ estiver usando um certificado autoassinado. </font><font style="vertical-align: inherit;">Como foi descoberto subitamente, no Windows 8/10 n√£o √© suficiente inicializar no modo de teste, a instala√ß√£o ainda falha, alegando que as assinaturas do driver s√£o inv√°lidas. </font><font style="vertical-align: inherit;">Voc√™ pode solucionar esse problema adicionando os certificados ao armazenamento raiz da CA:</font></font><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abra a caixa de di√°logo Propriedades do instalador do VB clicando com o bot√£o direito do mouse e selecionando </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Propriedades</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , depois mude para a </font><font style="vertical-align: inherit;">guia </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assinaturas digitais</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Voc√™ encontrar√° duas assinaturas l√°, ambas nomeadas "Roga e Kopyta Ltd", uma √© sha1, a outra sha256. </font><font style="vertical-align: inherit;">Selecione o primeiro, clique em </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detalhes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outra caixa de di√°logo √© exibida, na qual voc√™ precisa clicar no bot√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exibir certificado</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li><li> One more dialog, click <i>Install Certificate</i> . </li><li> In the Import wizard, select the location ¬´Local Machine¬ª, click <i>Next</i> . After UAC confirmation (if needed), there's the certificate store selection. Select ¬´Place all certificates in the following store¬ª, then click <i>Browse</i> and choose the store named ¬´Trusted Root Certification Authorities¬ª. Then <i>Next</i> , <i>Finish</i> . You're done, the certificate is installed. </li><li> Close all the dialogs but the very first one, select the second signature (sha256) and repeat the steps 2 to 4 for it too. </li><li> Close all the dialogs, run the installer. Now it should work fine. </li></ol><br><a name="afterword"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png"> Epilogue </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando terminei de escrever o artigo, fiquei surpreso com seu volume. No come√ßo, eu estava planejando entrar em muitos detalhes sobre as raz√µes para escolher esta ou aquela maneira de resolver cada problema, explicar qual √© exatamente o problema e quais solu√ß√µes alternativas podem ser aplic√°veis. Mas muito em breve ficou claro que, se carregado com todos esses detalhes, o texto seria monstruosamente enorme. Tenho que me desculpar pelas receitas parecidas com "apenas fa√ßa isso e n√£o fa√ßa perguntas". Eu tenho uma forte antipatia por eles, mas simplesmente n√£o consegui encontrar outra maneira. Ocasionalmente, eu ainda tentava descrever o que estava acontecendo, para suavizar a impress√£o.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma grande quantidade de detalhes sobre o sistema de compila√ß√£o VB teve que permanecer nos bastidores; pois ambos me senti relutante em inchar o texto e, √†s vezes, estava com pregui√ßa de procurar uma abordagem diferente e mais eficiente para resolver um problema. Afinal, meu principal objetivo, inicialmente, era conseguir uma vers√£o funcional da vers√£o atual do VirtualBox. O 4.3.12 j√° estava desatualizado nessa √©poca, mas n√£o corria o risco de atualizar uma das minhas ferramentas mais ativamente usadas para a vers√£o mais avan√ßada, que poderia simplesmente parar de funcionar a qualquer momento. Embora, de tempos em tempos, eu volte e, tendo encontrado algo novo, adicione-o a este artigo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espero que este artigo encontre seu p√∫blico. Se voc√™ estiver interessado em ver e analisar o resultado final, mas n√£o quiser configurar toda a pilha de programas, poder√° obter minha vers√£o da distribui√ß√£o aqui:</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vers√£o 6.0.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Todos os drivers (e outros arquivos) s√£o assinados com um certificado autoassinado n√£o confi√°vel; portanto, para instalar isso na vers√£o de 64 bits do Windows, voc√™ precisar√° reiniciar o modo de teste. </font><font style="vertical-align: inherit;">Se voc√™ tiver alguma d√∫vida, sugest√£o, recomenda√ß√£o, sinta-se √† vontade para me escrever aqui nos coment√°rios ou atrav√©s de mensagens pessoais. </font><font style="vertical-align: inherit;">Que o C√≥digo Aberto esteja com voc√™!</font></font><br><br><a name="history"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Altera√ß√µes </font></font></h4><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arquivo</font></font></b> <div class="spoiler_text"><h5> ‚Ä¢ Russian article published, 21.01.2016 </h5><ol><li> VirtualBox 5.0.12. </li></ol><br><h5> ‚Ä¢ Update of 24.05.2016 </h5><ol><li> The article is updated for VB 5.0.20, one of the main changes being SHA-1/SHA-256 dual-signing. </li><li> Added disabling of forced signature checks if self-signed certificates are used. </li><li> Added information about workaround for installation failure of the self-signed distribution. </li><li> Library versions were updated. </li><li> Disabled some unused components for speeding up the build process. </li><li> Minor fixes and improvements. </li></ol><br><h5> ‚Ä¢ Update of 29.07.2016 </h5><ol><li> The article is updated for VB 5.1.2; the most important change is upgrading to Qt5. The differences from VB 5.0.x procedure are specified where applicable. </li><li> Library versions were updated. </li><li> The full build batch was updated to check error codes after each operation. </li><li> Minor fixes and improvements. </li></ol><br><h5> ‚Ä¢ Update of 15.09.2016 </h5><ol><li> The article is updated for VB 5.1.6. </li><li> Library versions were updated. </li><li> Added NASM for building OpenSSL. </li><li> Added OpenSSL into cURL; this fixes the broken function of checking for updates and downloading the Extension Pack. </li><li> The full build batch now reads the VB version automatically. </li><li> Various minor fixes and improvements. </li></ol><br><h5> ‚Ä¢ Update of 30.11.2016 </h5><ol><li> The article is updated for VB 5.1.10. </li><li> Library versions were updated; particularly OpenSSL was upgraded to version 1.1.x. </li><li> Fixed some installation errors: <ul><li> path to the Qt plugins now points to the installation directory; </li><li> added forgotten OpenSSL libraries to the 32-bit components of the 64-bit VB version. </li></ul></li><li> The article no longer contains information about building older VB versions. If needed, the previous versions of it are available in the <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub project</a> . </li></ol><br><h5> ‚Ä¢ Update of 2.12.2016 </h5><ol><li> Switched to using statically linked OpenSSL. </li></ol><br><h5> ‚Ä¢ Update of 20.06.2017 </h5><ol><li> The article is updated for VB 5.1.22. </li><li> cURL, OpenSSL, and gSOAP were updated; adapted the build instructions for cURL, gSOAP and VB. </li></ol><br><h5> ‚Ä¢ Update of 1.12.2017 </h5><ol><li> The article is updated for VB 5.2.2. </li><li> Switched from MinGW-32 3.3.3 to 4.5.4. </li><li> Qt, cURL, OpenSSL, gSOAP, and some build tools were updated; adapted the build instructions for cURL, gSOAP and VB. </li><li> Switched to using local archives of DocBook XML/XSL instead of online versions. </li><li> Using cURL program instead of wget for downloading the Guest Additions ISO image. </li><li> Various minor fixes and improvements. </li></ol><br><h5> ‚Ä¢ Update of 4.12.2017 </h5><ol><li> The libxml version was fixed in the build instructions. </li></ol><br><h5> ‚Ä¢ Update of 4.09.2018 </h5><ol><li> The article is updated for VB 5.2.18. </li><li> cURL, OpenSSL, gSOAP and some build tools were updated; adapted the build instructions for cURL. </li></ol><br><h5> ‚Ä¢ Update of 12.12.2018 </h5><ol><li> The article is updated for VB 5.2.22. </li><li> Enabled screen recording functionality which is disabled in OSE version by default; added libraries libopus and libvpx for encoding. </li><li> cURL, OpenSSL, and gSOAP were updated. </li><li> The full set of VirtualBox source code changes is now published as a single patch file for easier application. </li></ol></div></div><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Ä¢ Atualiza√ß√£o de 25/01/2019 </font></font></h5><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O artigo √© atualizado para o VB 6.0.2. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Constru√ß√£o aprimorada de desativa√ß√£o de adi√ß√µes de convidados. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cURL e gSOAP foram atualizados; </font><font style="vertical-align: inherit;">As folhas de estilo DocBook XSL foram rebaixadas para a vers√£o 1.69.1 (a documenta√ß√£o √© mais adequada para essa vers√£o).</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O lote de compila√ß√£o completo foi dividido do texto do artigo em um arquivo para download. </font></font></li></ol><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Ä¢ Atualiza√ß√£o de 08/04/2019 </font></font></h5><ol><li> The article has been translated into English for the first time. Also numerous minor changes were introduced into the Russian version. </li><li> Added information about drivers signing for Windows 10. </li><li> The article is updated for VB 6.0.4. </li><li> cURL, OpenSSL, gSOAP, and some tools were updated. </li><li> The full build batch no longer has to be placed at the specific path. Also, it now contains the basic template for automated Windows 10 drivers signing. </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt447300/">https://habr.com/ru/post/pt447300/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt447288/index.html">Top 5 stablecoins. Tudo o que voc√™ precisa saber</a></li>
<li><a href="../pt447290/index.html">Passeios de m√©dico, passeios</a></li>
<li><a href="../pt447292/index.html">14 novos produtos no Visual Studio 2019</a></li>
<li><a href="../pt447294/index.html">Live Share agora inclu√≠do no Visual Studio 2019</a></li>
<li><a href="../pt447298/index.html">Gest√£o do conhecimento atrav√©s de modelos de compet√™ncia</a></li>
<li><a href="../pt447302/index.html">Sistema operacional de fim de semana</a></li>
<li><a href="../pt447304/index.html">Avaricious n√£o paga duas vezes - configuramos mem√≥ria na plataforma AMD B450 e obtemos desempenho gratuito</a></li>
<li><a href="../pt447306/index.html">Transformador de Tesla em uma placa de uma polegada quadrada</a></li>
<li><a href="../pt447308/index.html">Design instant√¢neo</a></li>
<li><a href="../pt447310/index.html">Como passamos do desenvolvimento web para o desenvolvimento de jogos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>