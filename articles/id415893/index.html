<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📌 📲 🧖🏾 Cara membuat proses Java berjalan di Linux / Docker sederhana dan mudah 🚀 💅 🎇</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sebagai seorang insinyur DevOps, saya sering bekerja untuk mengotomatisasi pemasangan dan konfigurasi berbagai sistem TI di berbagai lingkungan: dari ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cara membuat proses Java berjalan di Linux / Docker sederhana dan mudah</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415893/"><p>  Sebagai seorang insinyur DevOps, saya sering bekerja untuk mengotomatisasi pemasangan dan konfigurasi berbagai sistem TI di berbagai lingkungan: dari wadah ke cloud.  Saya harus bekerja dengan banyak sistem berdasarkan Java stack: dari yang kecil (seperti Tomcat) hingga skala besar (Hadoop, Cassandra, dll.). </p><br><p> Selain itu, hampir setiap sistem seperti itu, bahkan yang paling sederhana, untuk beberapa alasan memiliki sistem peluncuran unik yang kompleks.  Paling tidak, ini adalah skrip shell multi-line, seperti di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tomcat</a> , dan bahkan seluruh kerangka kerja, seperti di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Hadoop</a> .  "Pasien" saya saat ini dalam seri ini, yang mengilhami saya untuk menulis artikel ini, adalah repositori artefak <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Nexus OSS 3</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">skrip peluncuran</a> yang membutuhkan ~ 400 baris kode. </p><br><p>  Opacity, redundansi, dan kompleksitas skrip startup menciptakan masalah bahkan ketika secara manual menginstal satu komponen pada sistem lokal.  Sekarang bayangkan bahwa Anda perlu mengemas satu set komponen dan layanan tersebut dalam wadah Docker, menulis lapisan abstraksi lain di sepanjang garis orkestrasi yang memadai, menyebarkannya dalam kluster Kubernetes dan mengimplementasikan proses ini sebagai pipa CI / CD ... </p><br><p> Singkatnya, mari kita lihat contoh Nexus 3 yang disebutkan di atas, bagaimana mengembalikan dari labirin skrip shell ke sesuatu yang lebih mirip dengan <code>java -jar &lt;program.jar&gt;</code> , mengingat ketersediaan alat-alat DevOps modern yang nyaman. </p><a name="habracut"></a><br><h1 id="otkuda-takaya-slozhnost">  Dari mana datangnya kompleksitas ini? </h1><br><p>  Singkatnya, di zaman kuno, ketika UNIX tidak ditanya lagi: "dalam arti Linux?", Tidak ada Systemd dan Docker dan yang lainnya, skrip shell portabel (skrip init) dan PID- digunakan untuk mengontrol proses file.  Skrip init mengatur pengaturan lingkungan yang diperlukan, yang berbeda di UNIX yang berbeda, dan, tergantung pada argumen, memulai proses atau memulai kembali / menghentikannya menggunakan ID dari file PID.  Pendekatannya sederhana dan jelas, tetapi skrip ini berhenti bekerja di setiap situasi yang tidak biasa, membutuhkan intervensi manual, tidak memungkinkan Anda untuk menjalankan beberapa salinan dari proses ... tetapi bukan itu intinya. </p><br><p>  Jadi, jika Anda hati-hati melihat skrip startup yang disebutkan di atas dalam proyek Java, Anda dapat melihat tanda-tanda yang jelas dari pendekatan prasejarah ini, termasuk bahkan penyebutan SunOS, HP-UX dan UNIX lainnya.  Biasanya, skrip tersebut melakukan sesuatu seperti ini: </p><br><ul><li>  gunakan sintaks POSIX shell dengan semua kruknya untuk portabilitas UNIX / Linux </li><li>  tentukan versi OS dan lepaskan melalui rilis <code>uname</code> , <code>/etc/*release</code> , dll. </li><li>  mereka mencari JRE / JDK di sudut sistem file dan memilih versi yang paling "cocok" sesuai dengan aturan yang cerdas, kadang-kadang juga spesifik untuk setiap OS </li><li>  Parameter numerik JVM dihitung, misalnya, ukuran memori ( <code>-Xms</code> , <code>-Xms</code> ), jumlah benang GC, dll. </li><li>  mengoptimalkan JVM melalui <code>-XX</code> parameter dengan mempertimbangkan spesifikasi versi JRE / JDK yang dipilih </li><li>  cari komponen, pustaka, jalurnya di direktori di sekitarnya, file konfigurasi, dll. </li><li>  menyesuaikan lingkungan: ulimit, variabel lingkungan, dll. </li><li>  menghasilkan CLASSPATH dengan loop seperti: <code>for f in $path/*.jar; do CLASSPATH="${CLASSPATH}:$f"; done</code> <code>for f in $path/*.jar; do CLASSPATH="${CLASSPATH}:$f"; done</code> </li><li>  argumen baris perintah parsed: <code>start|stop|restart|reload|status|...</code> </li><li>  kompilasi perintah Java yang pada akhirnya harus Anda jalankan dari atas </li><li>  dan akhirnya <strong>jalankan perintah java ini</strong> .  Seringkali, file PID terkenal yang sama, <code>&amp;</code> , <code>nohup</code> , port TCP khusus dan trik lainnya dari abad terakhir digunakan secara eksplisit atau implisit (lihat <a href="">contoh dari Karaf</a> ) </li></ul><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Skrip peluncuran Nexus 3 yang</a> disebutkan di atas adalah contoh yang cocok untuk skrip semacam itu. </p><br><p>  Bahkan, semua logika skrip yang tercantum di atas, seolah-olah, sedang mencoba untuk mengganti administrator sistem, yang akan menginstal dan mengkonfigurasi semuanya secara manual untuk sistem tertentu dari awal hingga akhir.  Tetapi secara umum, tidak mungkin untuk memperhitungkan persyaratan dari sistem yang paling beragam.  Karena itu, ternyata, sebaliknya, sakit kepala, baik untuk pengembang yang perlu mendukung skrip ini, dan untuk insinyur sistem yang perlu memahami skrip ini nanti.  Dari sudut pandang saya, jauh lebih mudah bagi seorang insinyur sistem untuk memahami parameter JVM sekali dan mengkonfigurasinya sebagaimana mestinya, daripada memahami seluk-beluk skrip startupnya setiap kali Anda menginstal sistem baru. </p><br><h1 id="chto-zhe-delat">  Apa yang harus dilakukan </h1><br><p>  Maafkan  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">KISS</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">YAGNI</a> ada di tangan kita.  Apalagi tahun 2018 ada di halaman, artinya: </p><br><ul><li>  dengan sedikit pengecualian, UNIX == Linux </li><li>  masalah kontrol proses diselesaikan baik untuk server terpisah ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Systemd</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Docker</a> ), dan untuk kluster ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kubernetes</a> , dll.) </li><li>  Ada banyak alat manajemen konfigurasi yang mudah digunakan ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kemungkinan</a> , dll.) </li><li>  otomatisasi total telah sampai pada administrasi dan telah memantapkan dirinya secara menyeluruh: alih-alih secara manual membuat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">"server kepingan salju" yang</a> rapuh secara unik <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">,</a> sekarang dimungkinkan untuk secara otomatis merakit mesin virtual terpadu dan wadah menggunakan sejumlah alat yang mudah digunakan, termasuk Ansible and Docker yang disebutkan di atas. </li><li>  alat untuk mengumpulkan statistik runtime banyak digunakan, baik untuk JVM itu sendiri ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">contoh</a> ) dan untuk aplikasi Java ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">contoh</a> ) </li><li>  dan, yang paling penting, para ahli muncul: insinyur sistem dan DevOps yang dapat menggunakan teknologi yang tercantum di atas dan memahami cara memasang JVM dengan benar pada sistem tertentu dan kemudian menyesuaikannya berdasarkan statistik runtime yang dikumpulkan </li></ul><br><p>  Jadi mari kita kembali ke fungsionalitas skrip startup, dengan mempertimbangkan poin-poin yang tercantum di atas, tanpa mencoba melakukan pekerjaan untuk insinyur sistem, dan menghapus semua yang "tidak perlu" dari sana. </p><br><ul><li><del>  Sintaks shell POSIX </del>  ⇒ <code>/bin/bash</code> </li><li><del>  Deteksi versi OS </del>  ⇒ UNIX == Linux, jika ada parameter khusus OS, Anda dapat menggambarkannya dalam dokumentasi </li><li><del>  Pencarian JRE / JDK </del>  ⇒ kami memiliki satu-satunya versi, dan ini adalah OpenJDK (yah, atau Oracle JDK, jika Anda benar-benar membutuhkannya), <code>java</code> dan perusahaan berada di jalur sistem standar </li><li><del>  perhitungan parameter numerik JVM, tuning JVM </del>  ⇒ ini dapat dijelaskan dalam dokumentasi penskalaan aplikasi </li><li><del>  cari komponen dan pustaka Anda </del>  ⇒ jelaskan struktur aplikasi dan cara mengkonfigurasinya dalam dokumentasi </li><li><del>  pengaturan lingkungan </del>  ⇒ menjelaskan persyaratan dan fitur dalam dokumentasi </li><li><del>  Generasi CLASSPATH </del>  ⇒ <code>-cp path/to/my/jars/*</code> atau bahkan, secara umum, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Uber-JAR</a> </li><li><del>  parsing argumen baris perintah </del>  ⇒ tidak akan ada argumen, karena  manajer proses akan mengurus semuanya kecuali peluncuran </li><li>  Perakitan perintah Java </li><li>  eksekusi perintah java </li></ul><br><p>  Sebagai hasilnya, kita hanya perlu merakit dan menjalankan perintah Java dari bentuk <code>java &lt;opts&gt; -jar &lt;program.jar&gt;</code> menggunakan manajer proses yang dipilih (Systemd, Docker, dll.).  Semua parameter dan opsi ( <code>&lt;opts&gt;</code> ) diserahkan pada kebijaksanaan insinyur sistem, yang akan menyesuaikannya dengan lingkungan tertentu.  Jika daftar opsi <code>&lt;opts&gt;</code> cukup panjang, Anda dapat kembali lagi ke ide skrip startup, tetapi, dalam hal ini, <strong>sekompak dan seringkas mungkin</strong> , mis.  tidak mengandung logika perangkat lunak apa pun. </p><br><h1 id="primer">  Contoh </h1><br><p>  Sebagai contoh, mari kita lihat bagaimana Anda dapat menyederhanakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">skrip startup Nexus 3</a> . </p><br><p>  Opsi termudah, agar tidak masuk ke dalam hutan skrip ini - jalankan saja dalam kondisi nyata ( <code>./nexus start</code> ) dan lihat hasilnya.  Misalnya, Anda dapat menemukan daftar lengkap argumen dari aplikasi yang berjalan di tabel proses (via <code>ps -ef</code> ), atau menjalankan skrip dalam mode debug ( <code>bash -x ./nexus start</code> ) untuk mengamati seluruh proses eksekusi dan, pada akhirnya, perintah peluncuran. </p><br><div class="spoiler">  <b class="spoiler_title">Saya berakhir dengan perintah Java berikut</b> <div class="spoiler_text"><pre> <code class="bash hljs">/usr/java/jdk1.8.0_171-amd64/bin/java -server -Dinstall4j.jvmDir=/usr/java/jdk1.8.0_171-amd64 -Dexe4j.moduleName=/home/nexus/nexus-3.12.1-01/bin/nexus -XX:+UnlockDiagnosticVMOptions -Dinstall4j.launcherId=245 -Dinstall4j.swt=<span class="hljs-literal"><span class="hljs-literal">false</span></span> -Di4jv=0 -Di4jv=0 -Di4jv=0 -Di4jv=0 -Di4jv=0 -Xms1200M -Xmx1200M -XX:MaxDirectMemorySize=2G -XX:+UnlockDiagnosticVMOptions -XX:+UnsyncloadClass -XX:+LogVMOutput -XX:LogFile=../sonatype-work/nexus3/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/jvm.log -XX:-OmitStackTraceInFastThrow -Djava.net.preferIPv4Stack=<span class="hljs-literal"><span class="hljs-literal">true</span></span> -Dkaraf.home=. -Dkaraf.base=. -Dkaraf.etc=etc/karaf -Djava.util.logging.config.file=etc/karaf/java.util.logging.properties -Dkaraf.data=../sonatype-work/nexus3 -Djava.io.tmpdir=../sonatype-work/nexus3/tmp -Dkaraf.startLocalConsole=<span class="hljs-literal"><span class="hljs-literal">false</span></span> -Di4j.vpt=<span class="hljs-literal"><span class="hljs-literal">true</span></span> -classpath /home/nexus/nexus-3.12.1-01/.install4j/i4jruntime.jar:/home/nexus/nexus-3.12.1-01/lib/boot/nexus-main.jar:/home/nexus/nexus-3.12.1-01/lib/boot/org.apache.karaf.main-4.0.9.jar:/home/nexus/nexus-3.12.1-01/lib/boot/org.osgi.core-6.0.0.jar:/home/nexus/nexus-3.12.1-01/lib/boot/org.apache.karaf.diagnostic.boot-4.0.9.jar:/home/nexus/nexus-3.12.1-01/lib/boot/org.apache.karaf.jaas.boot-4.0.9.jar com.install4j.runtime.launcher.UnixLauncher start 9d17dc87 <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> org.sonatype.nexus.karaf.NexusMain</code> </pre> </div></div><br><p>  Pertama, terapkan beberapa trik sederhana untuk itu: </p><br><ul><li>  ubah <code>/the/long/and/winding/road/to/my/java</code> ke <code>java</code> , karena berada di jalur sistem </li><li>  letakkan daftar parameter Java dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">larik</a> terpisah, urutkan dan hapus duplikat </li></ul><br><div class="spoiler">  <b class="spoiler_title">Kami sudah mendapatkan sesuatu yang lebih mudah dicerna</b> <div class="spoiler_text"><pre> <code class="bash hljs">JAVA_OPTS = ( <span class="hljs-string"><span class="hljs-string">'-server'</span></span> <span class="hljs-string"><span class="hljs-string">'-Dexe4j.moduleName=/home/nexus/nexus-3.12.1-01/bin/nexus'</span></span> <span class="hljs-string"><span class="hljs-string">'-Di4j.vpt=true'</span></span> <span class="hljs-string"><span class="hljs-string">'-Di4jv=0'</span></span> <span class="hljs-string"><span class="hljs-string">'-Dinstall4j.jvmDir=/usr/java/jdk1.8.0_171-amd64'</span></span> <span class="hljs-string"><span class="hljs-string">'-Dinstall4j.launcherId=245'</span></span> <span class="hljs-string"><span class="hljs-string">'-Dinstall4j.swt=false'</span></span> <span class="hljs-string"><span class="hljs-string">'-Djava.io.tmpdir=../sonatype-work/nexus3/tmp'</span></span> <span class="hljs-string"><span class="hljs-string">'-Djava.net.preferIPv4Stack=true'</span></span> <span class="hljs-string"><span class="hljs-string">'-Djava.util.logging.config.file=etc/karaf/java.util.logging.properties'</span></span> <span class="hljs-string"><span class="hljs-string">'-Dkaraf.base=.'</span></span> <span class="hljs-string"><span class="hljs-string">'-Dkaraf.data=../sonatype-work/nexus3'</span></span> <span class="hljs-string"><span class="hljs-string">'-Dkaraf.etc=etc/karaf'</span></span> <span class="hljs-string"><span class="hljs-string">'-Dkaraf.home=.'</span></span> <span class="hljs-string"><span class="hljs-string">'-Dkaraf.startLocalConsole=false'</span></span> <span class="hljs-string"><span class="hljs-string">'-XX:+LogVMOutput'</span></span> <span class="hljs-string"><span class="hljs-string">'-XX:+UnlockDiagnosticVMOptions'</span></span> <span class="hljs-string"><span class="hljs-string">'-XX:+UnlockDiagnosticVMOptions'</span></span> <span class="hljs-string"><span class="hljs-string">'-XX:+UnsyncloadClass'</span></span> <span class="hljs-string"><span class="hljs-string">'-XX:-OmitStackTraceInFastThrow'</span></span> <span class="hljs-string"><span class="hljs-string">'-XX:LogFile=../sonatype-work/nexus3/log/jvm.log'</span></span> <span class="hljs-string"><span class="hljs-string">'-XX:MaxDirectMemorySize=2G'</span></span> <span class="hljs-string"><span class="hljs-string">'-Xms1200M'</span></span> <span class="hljs-string"><span class="hljs-string">'-Xmx1200M'</span></span> <span class="hljs-string"><span class="hljs-string">'-classpath /home/nexus/nexus-3.12.1-01/.install4j/i4jruntime.jar:/home/nexus/nexus-3.12.1-01/lib/boot/nexus-main.jar:/home/nexus/nexus-3.12.1-01/lib/boot/org.apache.karaf.main-4.0.9.jar:/home/nexus/nexus-3.12.1-01/lib/boot/org.osgi.core-6.0.0.jar:/home/nexus/nexus-3.12.1-01/lib/boot/org.apache.karaf.diagnostic.boot-4.0.9.jar:/home/nexus/nexus-3.12.1-01/lib/boot/'</span></span> ) java <span class="hljs-variable"><span class="hljs-variable">${JAVA_OPTS[*]}</span></span> com.install4j.runtime.launcher.UnixLauncher start 9d17dc87 <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> org.sonatype.nexus.karaf.NexusMain</code> </pre> </div></div><br><p>  Sekarang Anda bisa masuk lebih dalam. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Install4j</a> adalah installer Java yang grafis.  Tampaknya digunakan untuk instalasi awal sistem.  Kami tidak membutuhkannya di server, kami menghapusnya. </p><br><p>  Kami menyetujui penempatan komponen Nexus dan data pada sistem file: </p><br><ul><li>  letakkan aplikasi itu sendiri di <code>/opt/nexus-&lt;version&gt;</code> </li><li>  untuk kenyamanan, buat tautan simbolis <code>/opt/nexus -&gt; /opt/nexus-&lt;version&gt;</code> </li><li>  tempatkan skrip itu sendiri dan bukan yang asli sebagai <code>/opt/nexus/bin/nexus</code> </li><li>  semua data Nexus kami akan terletak pada sistem file terpisah yang dipasang sebagai <code>/data/nexus</code> </li></ul><br><p>  Penciptaan direktori dan tautan adalah tujuan dari sistem manajemen konfigurasi (untuk segala hal tentang semua 5-10 baris dalam Ansible), jadi mari kita serahkan tugas ini kepada teknisi sistem. </p><br><p>  Biarkan skrip kami saat startup mengubah direktori kerja ke <code>/opt/nexus</code> - maka kita dapat mengubah jalur ke komponen Nexus ke yang relatif. </p><br><p>  Opsi bentuk <code>-Dkaraf.*</code> pengaturan untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Apache Karaf</a> , wadah OSGi yang menjadi tempat Nexus kami jelas "dikemas".  Ubah <code>karaf.home</code> , <code>karaf.base</code> , <code>karaf.etc</code> dan <code>karaf.data</code> sesuai penempatan komponen, menggunakan jalur relatif jika memungkinkan. </p><br><p>  Melihat bahwa CLASSPATH terdiri dari daftar file jar yang terletak di direktori <code>lib/</code> sama, ganti seluruh daftar ini dengan <code>lib/*</code> (Anda juga harus mematikan ekspansi wildcard dengan <code>set -o noglob</code> ). </p><br><p>  Ubah <code>java</code> menjadi <code>exec java</code> sehingga skrip kami tidak memulai <code>java</code> sebagai proses anak (manajer proses tidak akan melihat proses anak ini), tetapi "ganti" itu sendiri dengan <code>java</code> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">deskripsi exec</a> ). </p><br><p>  Mari kita lihat apa yang terjadi: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash JAVA_OPTS=( '-Xms1200M' '-Xmx1200M' '-XX:+UnlockDiagnosticVMOptions' '-XX:+LogVMOutput' '-XX:+UnsyncloadClass' '-XX:LogFile=/data/nexus/log/jvm.log' '-XX:MaxDirectMemorySize=2G' '-XX:-OmitStackTraceInFastThrow' '-Djava.io.tmpdir=/data/nexus/tmp' '-Djava.net.preferIPv4Stack=true' '-Djava.util.logging.config.file=etc/karaf/java.util.logging.properties' '-Dkaraf.home=.' '-Dkaraf.base=.' '-Dkaraf.etc=etc/karaf' '-Dkaraf.data=/data/nexus/data' '-Dkaraf.startLocalConsole=false' '-server' '-cp lib/boot/*' ) set -o noglob cd /opt/nexus \ &amp;&amp; exec java ${JAVA_OPTS[*]} org.sonatype.nexus.karaf.NexusMain</span></span></code> </pre> <br><p>  Total 27 baris alih-alih&gt; 400, transparan, jelas, deklaratif, tidak ada logika yang tidak perlu.  Jika perlu, skrip ini dapat dengan mudah diubah menjadi templat untuk Ansible / Puppet / Chef dan hanya menambahkan logika yang diperlukan untuk situasi tertentu. </p><br><p>  Script ini dapat digunakan sebagai ENTRYPOINT di Dockerfile atau dipanggil dalam file-sistem Systemd, pada saat yang sama menyetel ulimit dan parameter sistem lainnya di sana, misalnya: </p><br><pre> <code class="hljs powershell">[<span class="hljs-type"><span class="hljs-type">Unit</span></span>] Description=Nexus After=network.target [<span class="hljs-type"><span class="hljs-type">Service</span></span>] Type=simple LimitNOFILE=<span class="hljs-number"><span class="hljs-number">1048576</span></span> ExecStart=/opt/nexus/bin/nexus User=nexus Restart=on<span class="hljs-literal"><span class="hljs-literal">-abort</span></span> [<span class="hljs-type"><span class="hljs-type">Install</span></span>] WantedBy=multi<span class="hljs-literal"><span class="hljs-literal">-user</span></span>.target</code> </pre> <br><h1 id="zaklyuchenie">  Kesimpulan </h1><br><p>  Kesimpulan apa yang bisa ditarik dari artikel ini?  Pada prinsipnya, ada beberapa poin: </p><br><ol><li>  Setiap sistem memiliki tujuannya sendiri, yaitu, tidak perlu memalu paku dengan mikroskop. </li><li>  Aturan Kesederhanaan (KISS, YAGNI) - untuk hanya menerapkan apa yang diperlukan untuk situasi tertentu. </li><li>  Dan yang paling penting: keren bahwa ada spesialis TI dari berbagai profil.  Mari berinteraksi dan membuat sistem IT kami lebih sederhana, lebih jelas, dan lebih baik!  :) </li></ol><br><p>  Terima kasih atas perhatian anda!  Saya akan dengan senang hati memberi tanggapan dan diskusi yang membangun dalam komentar. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id415893/">https://habr.com/ru/post/id415893/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id415875/index.html">Sepatah kata untuk ahli bahasa: bagaimana jika komputer berbicara lebih baik</a></li>
<li><a href="../id415879/index.html">Acara digital di Moskow 2-8 Juli</a></li>
<li><a href="../id415881/index.html">Bagaimana JS Bekerja: Shadow DOM Technology dan Komponen Web</a></li>
<li><a href="../id415887/index.html">Robot laba-laba macam apa yang terbang di atas stadion dan menembak bola. Wawancara dengan pencipta Robycam</a></li>
<li><a href="../id415891/index.html">Apa saja game sekuel yang keren?</a></li>
<li><a href="../id415895/index.html">Pola paling penting dalam pemrograman</a></li>
<li><a href="../id415897/index.html">Fungsi untuk mendokumentasikan database PostgreSQL. Bagian dua</a></li>
<li><a href="../id415899/index.html">Office 365 Outlook menemukan API tidak berdokumen dengan log aktivitas pengguna terperinci</a></li>
<li><a href="../id415901/index.html">Komisi Dewan Federasi mendukung gagasan untuk menciptakan basis IMEI untuk semua telepon putih</a></li>
<li><a href="../id415903/index.html">Selamat datang di Pertemuan DIYorDIE musim panas pada 7 Juli</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>