<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçâ üíÜüèΩ ‚ñ∂Ô∏è Logiciel de s√©curit√© suppl√©mentaire pour NAS ‚úèÔ∏è üîΩ üàµ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La s√©rie d'articles s'intitule Construire un NAS s√©curis√© . Par cons√©quent, cet article envisagera d'augmenter le niveau de s√©curit√©. De plus, ces out...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Logiciel de s√©curit√© suppl√©mentaire pour NAS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421279/"><p><img src="https://habrastorage.org/webt/39/ch/xl/39chxldtklziggqygx3wgmom0ky.png"></p><br><p>  La s√©rie d'articles s'intitule <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Construire un NAS s√©curis√©</a> .  Par cons√©quent, cet article envisagera d'augmenter le niveau de s√©curit√©.  De plus, ces outils que je n'ai pas utilis√©s, mais qu'il est possible d'appliquer, seront d√©crits. </p><a name="habracut"></a><br><h2 id="kto-i-kak">  Qui et comment? </h2><br><p>  Qui va attaquer le syst√®me et comment le fera-t-il? </p><br><p>  C'est g√©n√©ralement la premi√®re question √† laquelle il faut r√©pondre avant de parler de s√©curit√©. <br>  Au moins dans le cas des NAS, une telle r√©ponse est d√©j√† implicite.  Mais pour r√©pondre pleinement √† cette question, un mod√®le de menace et un mod√®le d'intrus sont en cours de construction. </p><br><p>  Les entreprises entament une phase de mod√©lisation des menaces dans leurs cycles de d√©veloppement. <br>  Microsoft a un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SDL</a> pour cela, les gens <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ont d'autres mod√®les</a> . </p><br><p>  Ils impliquent l'utilisation de certaines techniques, comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">STRIDE</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DREAD</a> (STRIDE est encore plus g√©n√©ral et bien support√© instrumentalement). </p><br><p>  Dans STRIDE, par exemple, un mod√®le est construit sur des flux de donn√©es et est g√©n√©ralement volumineux, lourd et mal compris.  N√©anmoins, l'outil fournit une liste des menaces potentielles, ce qui facilite leur prise en compte. </p><br><p>  Le mod√®le de menace est une information classifi√©e car il permet √† un attaquant d'analyser plus facilement le syst√®me et de trouver des faiblesses.  S'il re√ßoit un mod√®le, il n'aura pas √† le construire lui-m√™me, car les analystes se sont d√©j√† occup√©s de tout. </p><br><p>  <strong>C'√©tait une minute de publicit√©.</strong> </p><br><p><img src="https://habrastorage.org/webt/w4/ye/cz/w4yeczwns0wzroeq-ufxttf9yhm.jpeg"></p><br><p>  C'est ainsi que les entreprises s√©rieuses construisent le mod√®le.  Et si cela est int√©ressant, je peux en quelque sorte d√©crire dans un article s√©par√©. </p><br><p>  Je d√©crirai ici ce qu'on appelle le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´durcissement¬ª</a> en anglais et traiterai des failles de s√©curit√© qui ont √©t√© faites lors de la construction du syst√®me. </p><br><p>  Fondamentalement, le maintien de la s√©curit√© √† ce niveau se fait en fermant les vuln√©rabilit√©s connues du syst√®me, en le surveillant et en le v√©rifiant p√©riodiquement. </p><br><h2 id="literatura-po-teme">  Litt√©rature connexe </h2><br><p>  Que lire: </p><br><ul><li>  Cela vaut la peine de commencer avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le projet Linux durci</a> , o√π tout le monde trouvera <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">beaucoup de choses utiles</a> . </li><li>  Le paquet harden-doc contient <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">S√©curisation du manuel Debian datant</a> de 2012, mais courir ne g√™ne pas la compr√©hension du probl√®me. </li><li>  Ensuite, lisez la br√®ve proc√©dure de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">renforcement de Debian 8</a> . </li><li>  Et enfin, un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">petit guide pour renforcer les packages deb</a> et le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">code C / C ++</a> dont vous n'aurez probablement pas besoin. </li></ul><br><h2 id="snapshoty-i-doker">  Instantan√©s et Docker </h2><br><p>  Auparavant, zfs-autosnapshot √©tait install√©.  Il m'a aid√© √† plusieurs reprises, car  Je pouvais restaurer des configurations corrompues (pour Nextcloud, par exemple) √† partir d'instantan√©s. <br>  Cependant, au fil du temps, le syst√®me a commenc√© √† ralentir et plusieurs milliers de clich√©s se sont multipli√©s. </p><br><p> Il <code>com.sun:auto-snapshot=false</code> av√©r√© que lors de la cr√©ation du syst√®me de fichiers parent pour les conteneurs, j'ai oubli√© de d√©finir l'indicateur <code>com.sun:auto-snapshot=false</code> . </p><br><p>  Dans l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article d'origine,</a> ce probl√®me a d√©j√† √©t√© corrig√©, je vais montrer ici comment se d√©barrasser des instantan√©s suppl√©mentaires. </p><br><div class="spoiler">  <b class="spoiler_title">D√©tails sur la fa√ßon de corriger l'erreur.</b> <div class="spoiler_text"><p>  Tout d'abord, d√©sactivez zfs-auto-snapshot sur le syst√®me de fichiers parent du docker: </p><br><pre> <code class="plaintext hljs">zfs set com.sun:auto-snapshot=false tank0/docker/lib</code> </pre> <br><p>  Maintenant, supprimez les conteneurs et les images inutilis√©s: </p><br><pre> <code class="plaintext hljs">docker container prune docker image prune</code> </pre> <br><p>  Supprimer des instantan√©s: </p><br><pre> <code class="plaintext hljs">zfs list -t snapshot -o name -S creation | grep -e ".*docker/lib.*@zfs-auto-snap" | tail -n +1500 | xargs -n 1 zfs destroy -vr</code> </pre> <br><p>  Et d√©sactivez-les sur tous les syst√®mes de fichiers image: </p><br><pre> <code class="plaintext hljs">zfs list -t filesystem -o name -S creation | grep -e "tank0/docker/lib" | xargs -n 1 zfs set com.sun:auto-snapshot=false</code> </pre> <br><p>  Plus de d√©tails peuvent √™tre lus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </p></div></div><br><h2 id="ldap">  LDAP </h2><br><p>  La derni√®re fois, un seul utilisateur LDAP avec un r√¥le d'administrateur a √©t√© cr√©√©. </p><br><p>  Mais la plupart des services n'ont rien √† changer dans la base de donn√©es des utilisateurs.  Par cons√©quent, il serait int√©ressant d'ajouter un utilisateur en lecture seule.  Afin de ne pas cr√©er de r√¥les manuellement, il est possible d'utiliser un script d'initialisation de conteneur. </p><br><p>  Tout d'abord, ajoutez les param√®tres dans <code>docker-compose.yml</code> pour activer l'utilisateur en lecture seule: </p><br><pre> <code class="plaintext hljs">- "LDAP_READONLY_USER=true" - "LDAP_READONLY_USER_USERNAME=readonly" - "LDAP_READONLY_USER_PASSWORD=READONLY_PASSWORD"</code> </pre> <br><p>  Dossier complet sous le spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">docker-compose.yml</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">version: "2" networks: ldap: docker0: external: name: docker0 services: open-ldap: image: "osixia/openldap" hostname: "open-ldap" restart: always environment: - "LDAP_ORGANISATION=NAS" - "LDAP_DOMAIN=nas.nas" - "LDAP_ADMIN_PASSWORD=ADMIN_PASSWORD" - "LDAP_CONFIG_PASSWORD=CONFIG_PASSWORD" - "LDAP_READONLY_USER=true" - "LDAP_READONLY_USER_USERNAME=readonly" - "LDAP_READONLY_USER_PASSWORD=READONLY_PASSWORD" - "LDAP_TLS=true" - "LDAP_TLS_ENFORCE=false" - "LDAP_TLS_CRT_FILENAME=ldap_server.crt" - "LDAP_TLS_KEY_FILENAME=ldap_server.key" - "LDAP_TLS_CA_CRT_FILENAME=ldap_server.crt" volumes: - ./certs:/container/service/slapd/assets/certs - ./ldap_data/var/lib:/var/lib/ldap - ./ldap_data/etc/ldap/slapd.d:/etc/ldap/slapd.d networks: - ldap ports: - 172.21.0.1:389:389 - 172.21.0.1:636:636 phpldapadmin: image: "osixia/phpldapadmin:0.7.1" hostname: "nas.nas" restart: always networks: - ldap - docker0 expose: - 443 links: - open-ldap:open-ldap-server volumes: - ./certs:/container/service/phpldapadmin/assets/apache2/certs environment: - VIRTUAL_HOST=ldap.* - VIRTUAL_PORT=443 - VIRTUAL_PROTO=https - CERT_NAME=NAS.cloudns.cc - "PHPLDAPADMIN_LDAP_HOSTS=open-ldap-server" #- "PHPLDAPADMIN_HTTPS=false" - "PHPLDAPADMIN_HTTPS_CRT_FILENAME=certs/ldap_server.crt" - "PHPLDAPADMIN_HTTPS_KEY_FILENAME=private/ldap_server.key" - "PHPLDAPADMIN_HTTPS_CA_CRT_FILENAME=certs/ldap_server.crt" - "PHPLDAPADMIN_LDAP_CLIENT_TLS_REQCERT=allow" ldap-ssp: image: openfrontier/ldap-ssp:https volumes: - /etc/ssl/certs/ssl-cert-snakeoil.pem:/etc/ssl/certs/ssl-cert-snakeoil.pem - /etc/ssl/private/ssl-cert-snakeoil.key:/etc/ssl/private/ssl-cert-snakeoil.key restart: always networks: - ldap - docker0 expose: - 80 links: - open-ldap:open-ldap-server environment: - VIRTUAL_HOST=ssp.* - VIRTUAL_PORT=80 - VIRTUAL_PROTO=http - CERT_NAME=NAS.cloudns.cc - "LDAP_URL=ldap://open-ldap-server:389" - "LDAP_BINDDN=cn=admin,dc=nas,dc=nas" - "LDAP_BINDPW=ADMIN_PASSWORD" - "LDAP_BASE=ou=users,dc=nas,dc=nas" - "MAIL_FROM=admin@nas.nas" - "PWD_MIN_LENGTH=8" - "PWD_MIN_LOWER=3" - "PWD_MIN_DIGIT=2" - "SMTP_HOST=" - "SMTP_USER=" - "SMTP_PASS="</code> </pre> </div></div><br><p>  Ensuite, vous devez vider et supprimer: </p><br><pre> <code class="plaintext hljs">$ cd /tank0/docker/services/ldap $ tar czf ~/ldap_backup.tgz . $ ldapsearch -Wx -D "cn=admin,dc=nas,dc=nas" -b "dc=nas,dc=nas" -H ldap://172.21.0.1 -LLL &gt; ldap_dump.ldif $ docker-compose down $ rm -rf ldap_data $ docker-compose up -d</code> </pre> <br><p>  Pour emp√™cher le serveur de r√©cup√©rer d'un vidage de jurer sur les √©l√©ments en double, supprimez les lignes du fichier: </p><br><pre> <code class="plaintext hljs">dn: dc=nas,dc=nas objectClass: top objectClass: dcObject objectClass: organization o: NAS dc: nas dn: cn=admin,dc=nas,dc=nas objectClass: simpleSecurityObject objectClass: organizationalRole cn: admin description: LDAP administrator userPassword:: PASSWORD_BASE64</code> </pre><br><p>  Et restaurez les utilisateurs et les groupes: </p><br><pre> <code class="plaintext hljs">$ ldapadd -Wx -D "cn=admin,dc=nas,dc=nas" -H ldap://172.21.0.1 -f ldap_dump.ldif</code> </pre> <br><p>  Une telle b√™te appara√Ætra dans la base de donn√©es: </p><br><pre> <code class="plaintext hljs">dn: cn=readonly,dc=nas,dc=nas cn: readonly objectClass: simpleSecurityObject objectClass: organizationalRole userPassword:: PASSWORD_BASE64 description: LDAP read only user</code> </pre> <br><p>  Les r√¥les dans la configuration du serveur LDAP seront cr√©√©s par le conteneur. <br>  Effectuez des v√©rifications apr√®s la r√©cup√©ration et supprimez la sauvegarde: </p><br><pre> <code class="plaintext hljs">$ rm ~/ldap_backup.tgz</code> </pre> <br><h3 id="dobavlenie-grupp-v-ldap">  Ajout de groupes √† LDAP </h3><br><p>  Pratique est la s√©paration des utilisateurs LDAP en groupes similaires aux groupes POSIX sur Linux. <br>  Par exemple, il est possible de cr√©er des groupes dont les utilisateurs auront acc√®s aux r√©f√©rentiels, l'acc√®s au cloud ou l'acc√®s √† la biblioth√®que. </p><br><p>  Les groupes sont facilement ajout√©s √† phpLDAPAdmin, et je ne me concentrerai pas l√†-dessus. </p><br><p>  Je note seulement ce qui suit: </p><br><ul><li>  Le groupe est cr√©√© √† partir du mod√®le "Par d√©faut".  Ce n'est <strong>pas un</strong> groupe <strong>POSIX</strong> , mais un groupe de noms. </li><li>  Par cons√©quent, le groupe poss√®de un attribut <code>objectClass</code> qui inclut la valeur de <code>groupOfUniqueNames</code> . </li></ul><br><p> <a href=""><img src="https://habrastorage.org/webt/tx/i8/yj/txi8yjxxtbvlzynr1yttkn-ddgc.png" alt="Ajouter un groupe √† phpLDAPAdmin"></a> </p><br><h2 id="docker">  Docker </h2><br><p>  Dans Docker, presque tout a √©t√© fait pour vous. <br>  Par d√©faut, il utilise <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la restriction d'appel syst√®me</a> , qui est incluse dans le noyau OMV: </p><br><pre> <code class="plaintext hljs"># grep SECCOMP /boot/config-4.16.0-0.bpo.2-amd64 CONFIG_HAVE_ARCH_SECCOMP_FILTER=y CONFIG_SECCOMP_FILTER=y CONFIG_SECCOMP=y</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ici, vous</a> pouvez lire plus en d√©tail les r√®gles de base de la s√©curit√© Docker. <br>  De plus, si AppArmor est activ√©, Docker peut l'int√©grer et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">transmettre ses profils au conteneur</a> . </p><br><h2 id="set">  R√©seau </h2><br><h3 id="ustranenie-vozmozhnosti-obnaruzheniya-os">  √âliminez la d√©couverte du syst√®me d'exploitation </h3><br><p>  Le r√©seau est situ√© derri√®re le routeur, mais il est possible de faire un exercice curieux en modifiant certains param√®tres de la pile r√©seau afin que le syst√®me d'exploitation ne puisse pas √™tre identifi√© par les r√©ponses. <br>  Il y a peu d'avantages r√©els √† cela, car l'attaquant √©tudiera les banni√®res de service et comprendra toujours le syst√®me d'exploitation que vous utilisez. </p><br><div class="spoiler">  <b class="spoiler_title">Nmap montre quel syst√®me d'exploitation fonctionne sur l'appareil.</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># nmap -O localhost Starting Nmap 7.40 ( https://nmap.org ) at 2018-08-26 14:39 MSK Nmap scan report for localhost (127.0.0.1) Host is up (0.000015s latency). Other addresses for localhost (not scanned): ::1 Not shown: 992 closed ports PORT STATE SERVICE 53/tcp open domain 80/tcp open http 443/tcp open https 5432/tcp open postgresql Device type: general purpose Running: Linux 3.X|4.X OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4 OS details: Linux 3.8 - 4.6 Network Distance: 0 hops OS detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 4.07 seconds</code> </pre> </div></div><br><p>  T√©l√©chargez les param√®tres depuis sysctl.conf: </p><br><pre> <code class="plaintext hljs"># sysctl -p /etc/sysctl.conf net.ipv4.conf.all.accept_redirects = 0 net.ipv6.conf.all.accept_redirects = 0 net.ipv4.conf.all.send_redirects = 0 net.ipv4.conf.all.accept_source_route = 0 net.ipv6.conf.all.accept_source_route = 0 net.ipv4.tcp_rfc1337 = 1 net.ipv4.ip_default_ttl = 128 net.ipv4.icmp_ratelimit = 900 net.ipv4.tcp_synack_retries = 7 net.ipv4.tcp_syn_retries = 7 net.ipv4.tcp_window_scaling = 1 net.ipv4.tcp_timestamps = 1</code> </pre> <br><p>  Et donc ... </p><br><div class="spoiler">  <b class="spoiler_title">Nmap ne peut pas d√©terminer le syst√®me d'exploitation.</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># nmap -O localhost Starting Nmap 7.40 ( https://nmap.org ) at 2018-08-26 14:40 MSK Nmap scan report for localhost (127.0.0.1) Host is up (0.000026s latency). Other addresses for localhost (not scanned): ::1 Not shown: 992 closed ports PORT STATE SERVICE 53/tcp open domain 80/tcp open http 443/tcp open https 5432/tcp open postgresql No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ). TCP/IP fingerprint: OS:SCAN(V=7.40%E=4%D=8/26%OT=53%CT=1%CU=43022%PV=N%DS=0%DC=L%G=Y%TM=5B8291C OS:3%P=x86_64-pc-linux-gnu)SEQ(SP=FA%GCD=1%ISR=105%TI=Z%CI=I%TS=8)OPS(O1=MF OS:FD7ST11NW7%O2=MFFD7ST11NW7%O3=MFFD7NNT11NW7%O4=MFFD7ST11NW7%O5=MFFD7ST11 OS:NW7%O6=MFFD7ST11)WIN(W1=AAAA%W2=AAAA%W3=AAAA%W4=AAAA%W5=AAAA%W6=AAAA)ECN OS:(R=Y%DF=Y%T=80%W=AAAA%O=MFFD7NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=80%S=O%A=S+%F= OS:AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=80%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5( OS:R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=80%W=0%S=A%A=Z% OS:F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N OS:%T=80%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=80%C OS:D=S) Network Distance: 0 hops OS detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 19.52 seconds</code> </pre> </div></div><br><p>  Ces param√®tres doivent √™tre √©crits dans <code>/etc/sysctl.conf</code> , puis √† chaque red√©marrage, ils seront lus automatiquement. </p><br><div class="spoiler">  <b class="spoiler_title">/Etc/sysctl.conf complet</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">################################################################### # Additional settings - these settings can improve the network # security of the host and prevent against some network attacks # including spoofing attacks and man in the middle attacks through # redirection. Some network environments, however, require that these # settings are disabled so review and enable them as needed. # # Do not accept ICMP redirects (prevent MITM attacks) net.ipv4.conf.default.accept_redirects = 0 net.ipv6.conf.default.accept_redirects = 0 net.ipv4.conf.all.accept_redirects = 0 net.ipv6.conf.all.accept_redirects = 0 # _or_ # Accept ICMP redirects only for gateways listed in our default # gateway list (enabled by default) # net.ipv4.conf.all.secure_redirects = 1 # # Do not send ICMP redirects (we are not a router) net.ipv4.conf.all.send_redirects = 0 # # Do not accept IP source route packets (we are not a router) net.ipv4.conf.all.accept_source_route = 0 net.ipv6.conf.all.accept_source_route = 0 ## protect against tcp time-wait assassination hazards ## drop RST packets for sockets in the time-wait state ## (not widely supported outside of linux, but conforms to RFC) net.ipv4.tcp_rfc1337 = 1 # # Log Martian Packets #net.ipv4.conf.all.log_martians = 1 # ################################################################### # Magic system request Key # 0=disable, 1=enable all # Debian kernels have this set to 0 (disable the key) # See https://www.kernel.org/doc/Documentation/sysrq.txt # for what other values do #kernel.sysrq=1 ################################################################### # Protected links # # Protects against creating or following links under certain conditions # Debian kernels have both set to 1 (restricted) # See https://www.kernel.org/doc/Documentation/sysctl/fs.txt #fs.protected_hardlinks=0 #fs.protected_symlinks=0 vm.overcommit_memory = 1 vm.swappiness = 10 ################################################################### # Anti-fingerprinting. # # Def: 64. net.ipv4.ip_default_ttl = 128 #   ICMP  (  1000) net.ipv4.icmp_ratelimit = 900 #    ,     . # Def: 5. net.ipv4.tcp_synack_retries = 7 # Def: 5. net.ipv4.tcp_syn_retries = 7 #   TCP window  timespamp    1323. net.ipv4.tcp_window_scaling = 1 net.ipv4.tcp_timestamps = 1 # Redis requirement. net.core.somaxconn = 511</code> </pre> </div></div><br><p>  La protection contre la d√©finition des versions de service est plus utile, pour laquelle un attaquant peut √©galement utiliser Nmap: </p><br><pre> <code class="plaintext hljs"># nmap -sV -sR --allports --version-trace 127.0.0.1</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Le r√©sultat n'est pas tr√®s bon pour le syst√®me.</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Not shown: 991 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u3 (protocol 2.0) 25/tcp open smtp Postfix smtpd 80/tcp open http nginx 1.13.12 111/tcp open rpcbind 2-4 (RPC #100000) 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 443/tcp open ssl/http nginx 1.13.12 445/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 3493/tcp open nut Network UPS Tools upsd 8000/tcp open http Icecast streaming media server 2.4.2 Service Info: Hosts: nas.localdomain, NAS; OS: Linux; CPE: cpe:/o:linux:linux_kernel Final times for host: srtt: 22 rttvar: 1 to: 100000</code> </pre> </div></div><br><p>  Mais avec le d√©guisement de services, tout ne se passe pas bien: </p><br><ul><li>  Pour chaque service, une approche individuelle est n√©cessaire ici. </li><li>  La possibilit√© de supprimer la version n'est pas toujours disponible. </li></ul><br><p>  Par exemple, pour SSH, il est possible d'ajouter l'option <code>DebianBanner no</code> √† <code>/etc/ssh/sshd_confg</code> . </p><br><p>  En cons√©quence: </p><br><pre> <code class="plaintext hljs">22/tcp open ssh OpenSSH 7.4p1 (protocol 2.0)</code> </pre> <br><p>  Mieux, h√©las, cela ne fonctionnera pas: la version est utilis√©e par SSH pour √©tablir quelles fonctionnalit√©s sont prises en charge, et il est possible de la changer uniquement en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">corrigeant le serveur</a> . </p><br><h3 id="port-knocking">  Coup de port </h3><br><p>  Pas la technique de s√©curit√© la plus connue, permettant √† un utilisateur distant qui conna√Æt le secret de se connecter √† un port ferm√©. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le travail ressemble √† un verrou de code</a> : tout le monde sait que les d√©mons de service fonctionnent sur le serveur, mais "ils ne sont pas l√†" jusqu'√† ce que le code soit compos√©. <br>  Par exemple, pour se connecter √† un serveur SSH, un utilisateur doit frapper sur les ports UDP 7000, TCP 7007 et UDP 7777. <br>  Apr√®s cela, avec son IP, le pare-feu d√©marrera sur un port TCP <strong>ferm√©</strong> 22. </p><br><p>  Vous pouvez en savoir plus sur la fa√ßon dont cela fonctionne <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dans le manuel de Debian</a> . </p><br><p>  Je ne recommande pas d'utiliser, car  fail2ban est g√©n√©ralement suffisant. </p><br><h3 id="fayrvoll">  Pare-feu </h3><br><p>  Je configure le pare-feu via l'interface graphique Web OpenMediaVault, que je vous recommande. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/cv/a9/eo/cva9eoxcbu4h8ut8cwrwczkjop8.png"></a> </p><br><p>  Ouvrez les ports n√©cessaires, tels que 443 et 22, le reste au go√ªt.  Il est √©galement conseill√© d'activer la journalisation des paquets perdus. </p><br><h3 id="ssh">  Ssh </h3><br><div class="spoiler">  <b class="spoiler_title">Si SSH se bloque sur le port 22, qui est ouvert sur Internet, vous recevrez de nombreux messages int√©ressants ...</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># grep "invalid user" /var/log/auth.log|head Aug 26 00:07:57 nas sshd[29786]: input_userauth_request: invalid user test [preauth] Aug 26 00:07:59 nas sshd[29786]: Failed password for invalid user test from 185.143.160.137 port 51268 ssh2 Aug 26 00:11:01 nas sshd[5641]: input_userauth_request: invalid user 0 [preauth] Aug 26 00:11:01 nas sshd[5641]: Failed none for invalid user 0 from 5.188.10.180 port 49025 ssh2 Aug 26 00:11:04 nas sshd[5644]: input_userauth_request: invalid user 0101 [preauth] Aug 26 00:11:06 nas sshd[5644]: Failed password for invalid user 0101 from 5.188.10.180 port 59867 ssh2 Aug 26 00:32:55 nas sshd[20367]: input_userauth_request: invalid user ftp [preauth] Aug 26 00:32:56 nas sshd[20367]: Failed password for invalid user ftp from 5.188.10.144 port 47981 ssh2 Aug 26 00:32:57 nas sshd[20495]: input_userauth_request: invalid user guest [preauth] Aug 26 00:32:59 nas sshd[20495]: Failed password for invalid user guest from 5.188.10.144 port 34202 ssh2</code> </pre> </div></div><br><p>  Au risque de para√Ætre banal, je rappelle encore qu'il faut: </p><br><ul><li>  Interdisez strictement la connexion root. </li><li>  Limitez la connexion aux utilisateurs sp√©cifi√©s uniquement. </li><li>  Changez le port en non standard. </li><li>  Il est conseill√© de d√©sactiver l'authentification par mot de passe, en ne laissant que la cl√©. </li></ul><br><p>  En savoir plus est possible, par exemple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </p><br><p>  Tout cela se fait facilement depuis l'interface OpenMediaVault via le menu "Services -&gt; SSH". <br>  Sauf que je n'ai pas chang√© le port en non standard, en laissant 22 sur le r√©seau local et en rempla√ßant simplement le port dans le routeur NAT. </p><br><div class="spoiler">  <b class="spoiler_title">Voici une liste int√©ressante de comptes que j'ai essay√© de compiler, jusqu'√† ce que je change le port SSHD en un autre que 22.</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># grep "invalid user" /var/log/auth.log|sed 's/.*invalid user \([^ ]*\) .*/\1/'|sort|uniq 0 0101 1234 22 admin ADMIN administrateur administrator admins alfred amanda amber Anonymous apache avahi backup@network bcnas benjamin bin cacti callcenter camera cang castis charlotte clamav client cristina cron CSG cvsuser cyrus david db2inst1 debian debug default denis elvira erik fabio fax ftp ftpuser gary gast GEN2 guest I2b2workdata2 incoming jboss john juan matilda max mia miner muhammad mysql nagios nginx noc office oliver operator oracle osmc pavel pi pmd postgres PROCAL prueba RSCS sales sales1 scaner selena student07 sunos support sybase sysadmin teamspeak telecomadmin test test1 test2 test3 test7 tirocu token tomcat tplink ubnt ubuntu user1 vagrant victor volition www-data xghwzp xxx zabbix zimbra</code> </pre> </div></div><br><p>  Une fois cela fait, les tentatives de connexion non autoris√©es seront effectu√©es beaucoup moins fr√©quemment. </p><br><p>  Pour am√©liorer encore la situation, il est possible de bloquer les attaquants de certaines adresses IP apr√®s plusieurs tentatives de connexion. </p><br><p>  Ce qui peut √™tre utilis√© pour: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Fail2ban</a> .  Un utilitaire populaire qui fonctionne non seulement pour SSH, mais aussi pour de nombreuses autres applications. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Denyhosts</a>  Ressemble √† fail2ban. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sshguard</a> , si vous le souhaitez, vous pouvez essayer de l'utiliser, mais cela ne m'int√©ressait pas en d√©tail. </li></ul><br><p>  J'utilise fail2ban.  Il surveillera les journaux pour diverses actions ind√©sirables de la part de certaines adresses IP et les interdira si le nombre de r√©ponses est d√©pass√©: </p><br><div class="spoiler">  <b class="spoiler_title">/var/log/fail2ban.log.</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">2018-08-29 21:17:25,351 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.144 2018-08-29 21:17:25,473 fail2ban.actions [8650]: NOTICE [sshd] Ban 5.188.10.144 2018-08-29 21:17:27,359 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.144 2018-08-29 21:28:13,128 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.176 2018-08-29 21:28:13,132 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.176 2018-08-29 21:28:15,137 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.176 2018-08-29 21:28:20,145 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.176 2018-08-29 21:28:25,153 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.176 2018-08-29 21:28:25,421 fail2ban.actions [8650]: NOTICE [sshd] Ban 5.188.10.176 2018-08-29 21:30:05,272 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.180 2018-08-29 21:30:05,274 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.180 2018-08-29 21:30:13,285 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.180 2018-08-29 21:30:13,286 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.180 2018-08-29 21:30:15,289 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.180 2018-08-29 21:30:15,803 fail2ban.actions [8650]: NOTICE [sshd] Ban 5.188.10.180</code> </pre> </div></div><br><p>  Une interdiction est faite en ajoutant une r√®gle de pare-feu.  Apr√®s un d√©lai sp√©cifi√©, la r√®gle est supprim√©e et l'utilisateur peut √† nouveau essayer de se connecter. </p><br><p>  Initialement, seul SSH est activ√©, mais il est possible d'activer le contr√¥le des journaux du serveur Web et d'autres services, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">au moins du m√™me OMV</a> . <br>  Et aussi, retirez les journaux des conteneurs et d√©finissez √©galement fail2ban sur eux. </p><br><p>  Je recommande d'ajouter des services au go√ªt. <br>  Vous pouvez en savoir plus sur la configuration, par exemple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> ou sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">wiki natif</a> . </p><br><h2 id="logi">  Journaux </h2><br><h3 id="lwatchhttpspackagesdebianorgstretchadminlwatch">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lwatch</a> </h3><br><p>  Un petit utilitaire qui doit √™tre install√© pour plus de commodit√©.  Il mettra en √©vidence les journaux et les montrera sous une belle forme. <br>  Il est possible d'utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un tel utilitaire</a> , l'essentiel est que les erreurs et les zones probl√©matiques des journaux soient mises en √©vidence afin de faciliter leur analyse visuelle. </p><br><h3 id="logcheckhttplogcheckorg">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Logcheck</a> </h3><br><p>  Il vaut la peine d'installer et de configurer logcheck simplement pour que lorsque vous identifiez les probl√®mes de configuration signal√©s dans les journaux, vous le voyez imm√©diatement dans l'e-mail. <br>  Cela aide beaucoup √† voir ce qui ne va pas, m√™me si cela n√©cessite un r√©glage. </p><br><p>  Installation: </p><br><pre> <code class="plaintext hljs"># apt-get install logcheck</code> </pre> <br><p>  Imm√©diatement apr√®s l'installation, il enverra des rapports. </p><br><div class="spoiler">  <b class="spoiler_title">Exemple de rapport.</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">System Events =-=-=-=-=-=-= Oct 2 02:02:15 nas kernel: [793847.981226] [DROPPED] IN=br-ce OUT= PHYSIN=veth6c2a68e MAC=ff:ff:ff:ff:ff:ff: SRC=172.22.0.11 DST=255.255.255.255 LEN=29 TOS=0x00 PREC=0x00 TTL=64 ID=40170 DF PROTO=UDP SPT=35623 DPT=35622 LEN=9 Oct 2 02:02:20 nas hddtemp[13791]: /dev/sdh: Micron_1100 N #020–Ç: 32 C Oct 2 02:02:37 nas kernel: [793869.247128] [DROPPED] IN=br-7ba OUT= MAC= SRC=172.31.0.1 DST=172.31.255.255 LEN=239 TOS=0x00 PREC=0x00 TTL=128 ID=23017 DF PROTO=UDP SPT=138 DPT=138 LEN=219 Oct 2 02:02:37 nas kernel: [793869.247174] [DROPPED] IN=br-7ba OUT= MAC= SRC=172.31.0.1 DST=172.31.255.255 LEN=232 TOS=0x00 PREC=0x00 TTL=128 ID=23018 DF PROTO=UDP SPT=138 DPT=138 LEN=212 Oct 2 02:02:37 nas kernel: [793869.247195] [DROPPED] IN=br-673 OUT= MAC= SRC=192.168.224.1 DST=192.168.239.255 LEN=239 TOS=0x00 PREC=0x00 TTL=128 ID=8959 DF PROTO=UDP SPT=138 DPT=138 LEN=219 Oct 2 02:02:37 nas kernel: [793869.247203] [DROPPED] IN=br-673 OUT= MAC= SRC=192.168.224.1 DST=192.168.239.255 LEN=232 TOS=0x00 PREC=0x00 TTL=128 ID=8960 DF PROTO=UDP SPT=138 DPT=138 LEN=212 Oct 2 02:02:50 nas hddtemp[13791]: /dev/sdh: Micron_1100 N #020–Ç: 32 C</code> </pre> </div></div><br><p>  On peut voir qu'il y a beaucoup de superflu, et un r√©glage ult√©rieur se r√©sumera √† le filtrer. </p><br><p>  Tout d'abord, d√©sactivez hddtemp, qui ne fonctionne pas correctement en raison de caract√®res non ASCII dans le nom SSD. <br>  Apr√®s avoir corrig√© le fichier hddtemp, les messages ont cess√© de venir: </p><br><div class="spoiler">  <b class="spoiler_title">/etc/logcheck/ignore.d.server/hddtemp</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">^\w{3} [ :0-9]{11} [._[:alnum:]-]+ hddtemp\[[0-9]+\]: /dev/([hs]d[az]|sg[0-9]):.*[0-9]+.*[CF] ^\w{3} [ :0-9]{11} [._[:alnum:]-]+ hddtemp\[[0-9]+\]: /dev/([hs]d[az]|sg[0-9]):.*drive is sleeping</code> </pre> </div></div><br><p>  Ensuite, il est possible de voir ce que Logcheck dit bloquer le trafic de diffusion par le pare-feu: </p><br><pre> <code class="plaintext hljs">[793869.247128] [DROPPED] IN=br-7ba OUT= MAC= SRC=172.31.0.1 DST=172.31.255.255 LEN=239 TOS=0x00 PREC=0x00 TTL=128 ID=23017 DF PROTO=UDP SPT=138 DPT=138 LEN=219</code> </pre> <br><p>  Par cons√©quent, vous devez activer le trafic de diffusion √† partir du routeur et des conteneurs: </p><br><ul><li>  Port 35622 du conteneur avec urbackup. </li><li>  Le port 5678 du routeur est la d√©couverte du voisin RouterOS.  Il peut √™tre d√©sactiv√© sur le routeur. </li><li>  Le port 5353 pour l'adresse 224.0.0.251 est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mDNS</a> . </li></ul><br><p>  V√©rifier le logcheck: </p><br><pre> <code class="plaintext hljs">sudo -u logcheck logcheck -t -d</code> </pre> <br><p>  Enfin, les probl√®mes deviennent visibles: </p><br><pre> <code class="plaintext hljs">Oct 21 21:58:18 nas systemd[1]: Removed slice User Slice of user. Oct 21 21:58:31 nas systemd[1]: smbd.service: Unit cannot be reloaded because it is inactive. Oct 21 21:58:31 nas root: /etc/dhcp/dhclient-enter-hooks.d/samba returned non-zero exit status 1</code> </pre> <br><p>  Il s'av√®re que SAMBA ne d√©marre pas.  En effet, l'analyse a montr√© que je l'ai d√©guis√© via systemctl, et OMV essayait de le d√©marrer. </p><br><p>  Logcheck continuera de spammer avec divers messages. <br>  Ici, par exemple, zfs-auto-snapshot est pass√©: </p><br><pre> <code class="plaintext hljs">Oct 21 22:00:57 nas zfs-auto-snap: @zfs-auto-snap_frequent-2018-10-21-1900, 16 created, 16 destroyed, 0 warnings.</code> </pre> <br><p>  Pour ignorer: </p><br><div class="spoiler">  <b class="spoiler_title">/etc/logcheck/ignore.d.server/zfs-auto-snapshot</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">^\w{3} [ :0-9]{11} [._[:alnum:]-]+ zfs-auto-snap: \@zfs-auto-snap_[[:alnum:]-]+, [0-9]+ created, [0-9]+ destroyed, 0 warnings.$</code> </pre> </div></div><br><p>  rrdcached est √©galement ignor√©: </p><br><div class="spoiler">  <b class="spoiler_title">/etc/logcheck/ignore.d.server/rrdcached</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">^\w{3} [ :[:digit:]]{11} [._[:alnum:]-]+ rrdcached\[[0-9]+\]: flushing old values$ ^\w{3} [ :[:digit:]]{11} [._[:alnum:]-]+ rrdcached\[[0-9]+\]: rotating journals$ ^\w{3} [ :[:digit:]]{11} [._[:alnum:]-]+ rrdcached\[[0-9]+\]: started new journal [./[:alnum:]]+$ ^\w{3} [ :[:digit:]]{11} [._[:alnum:]-]+ rrdcached\[[0-9]+\]: removing old journal [./[:alnum:]]+$</code> </pre> </div></div><br><p>  De plus, il est conseill√© de supprimer zed s'il n'est toujours pas supprim√©: </p><br><div class="spoiler">  <b class="spoiler_title">/etc/logcheck/ignore.d.server/zed</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">^\w{3} [ :0-9]{11} [._[:alnum:]-]+ (/usr/bin/)?zed: .*$ ^\w{3} [ :0-9]{11} [._[:alnum:]-]+ (/usr/bin/)?zed\[[0-9]+\]: .*$</code> </pre> </div></div><br><p>  Eh bien et ainsi de suite.  Beaucoup de gens pensent que logcheck est un utilitaire assez inutile. <br>  Cela est vrai si vous l'utilisez comme quelque chose que vous d√©finissez et oubliez. </p><br><p>  N√©anmoins, si vous comprenez que logcheck n'est qu'un filtre de journal personnalis√©, sans heuristique, magie et algorithmes adaptatifs, la question de sa n√©cessit√© ne se pose pas.  It√©rativement, en analysant ce qu'il envoie et, soit en l'ajoutant pour l'ignorer, soit en le corrigeant, il est progressivement possible d'obtenir des rapports informatifs. </p><br><p>  L'utilisation d'un outil automatis√© pour l'analyse est beaucoup mieux que d'ex√©cuter les journaux via les m√™mes expressions r√©guli√®res avec vos mains, et souvent mieux que d'utiliser un syst√®me d'analyse de donn√©es complet comme Splunk. </p><br><p>  Logcheck et sa configuration peuvent √™tre lus sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Wiki Gentoo</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </p><br><h2 id="ids-urovnya-uzla">  IDS au niveau du n≈ìud </h2><br><p>  Je me r√©f√©rerai ici √† mon propre article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Une br√®ve analyse des solutions dans le domaine du SOC et le d√©veloppement d'un d√©tecteur d'anomalie de r√©seau neuronal dans les r√©seaux de transmission de donn√©es"</a> , dans lequel il existe plusieurs exemples. </p><br><p>  Vous pouvez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lire un</a> examen et une comparaison plus complets d'IDS similaires <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur le Wiki</a> . </p><br><h3 id="stig-4httpswwwstigviewercomstigred_hat_enterprise_linux_6">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">STIG-4</a> </h3><br><p>  Un script complexe et volumineux pour l'analyse statique des lacunes connues de RedHat. <br>  Il y a son <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">port dans Debian</a> , que je recommande de t√©l√©charger et de lancer au moins une fois. </p><br><div class="spoiler">  <b class="spoiler_title">Exemple de fonctionnement STIG-4</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># cd root@nas:~# git clone https://github.com/hardenedlinux/STIG-4-Debian Cloning into 'STIG-4-Debian'... remote: Enumerating objects: 572, done. remote: Total 572 (delta 0), reused 0 (delta 0), pack-reused 572 Receiving objects: 100% (572/572), 634.37 KiB | 0 bytes/s, done. Resolving deltas: 100% (316/316), done. root@nas:~# cd STIG-4-Debian/ root@nas:~/STIG-4-Debian# bash stig-4-debian.sh -H Script Run: Mon Nov 12 23:58:34 MSK 2018 Start checking process... [ FAIL ] The cryptographic hash of system files and commands must match vendor values. ... Pass Count: 54 Failed Count: 137</code> </pre> </div></div><br><p>  Le processus de travail avec ce script est approximativement le suivant: </p><br><ul><li>  D√©barrassez-vous du script. </li><li>  Recherchez sur Internet chaque ligne avec <code>[ FAIL ]</code> . </li><li>  En r√®gle g√©n√©rale, un lien vers la base de donn√©es en ligne STIG sera trouv√©. </li><li>  Corrigez, en suivant les instructions de la base de donn√©es, en faisant une remise sur le fait qu'il s'agit de Debian. </li><li>  Ex√©cutez √† nouveau le script. </li></ul><br><h3 id="rkhunterhttprkhuntersourceforgenet">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Rkhunter</a> </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Trop de choses ont √©t√©</a> √©crites sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RkHunter</a> . <br>  Utilis√© depuis longtemps, largement, toujours en d√©veloppement.  Il existe un r√©f√©rentiel Debian. </p><br><h3 id="tigerhttpswwwnongnuorgtiger">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tiger</a> </h3><br><p>  Un script shell modulaire qui effectue un audit syst√®me et une d√©tection d'intrusion. <br>  Il est quelque peu similaire √† STIG-4. <br>  Il peut utiliser des utilitaires tiers pour analyser les journaux, pour d√©tecter les violations de somme de contr√¥le. </p><br><p>  Se compose d'un grand nombre de modules diff√©rents. </p><br><p>  Par exemple, il existe un module qui d√©tecte les services qui utilisent des fichiers supprim√©s, ce qui se produit lorsque les biblioth√®ques utilis√©es par le service ont √©t√© modifi√©es au cours du processus de mise √† niveau du syst√®me, mais le service n'a pas √©t√© red√©marr√© pour une raison quelconque. </p><br><p>  Il existe des modules pour rechercher les utilisateurs de services qui ne sont plus utilis√©s, v√©rifier le syst√®me pour l'absence de correctifs de s√©curit√©, v√©rifier umask, etc. </p><br><p>  Plus de d√©tails <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">chez l'homme</a> . </p><br><p>  Il ne se d√©veloppe pas depuis 10 ans (oui, je ne suis pas le seul √† abandonner les logiciels). </p><br><h3 id="samhainhttpswwwla-samhnadesamhain">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Samhain</a> </h3><br><p>  HIDS typiques qui peuvent: </p><br><ul><li>  V√©rifiez l'int√©grit√© de l'ensemble du syst√®me par des hachages cryptographiques. </li><li>  Recherchez divers ex√©cutables avec le SUID install√©, qui ne doivent pas √™tre install√©s. </li><li>  D√©tectez les processus cach√©s. </li><li>  Signer les journaux et les bases de donn√©es. </li></ul><br><p>  De plus, il a une surveillance centralis√©e avec une interface Web et l'envoi centralis√© de journaux au serveur. <br>       ,        . <br>       . </p><br><p> ,  ,           . ,  ,    ,    ,         . </p><br><p> -     HIDS:        . <br>     Samhain,      . </p><br><h3 id="tripwirehttpssourceforgenetprojectstripwire"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tripwire</a> </h3><br><p>   ,   Samhain,  Tripwire ‚Äî    . <br>    ,   . </p><br><h3 id="lynishttpscisofycomlynis"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lynis</a> </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  RkHunter</a> . </p><br><p>  ,    . <br>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>     . <br>   Tiger       ,     ,  . <br>   ,  .    ,       , Lynix    Tripwire. </p><br><h3 id="chkrootkithttpwwwchkrootkitorg"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Chkrootkit</a> </h3><br><p>     .    . <br> : </p><br><ul><li>   ,  . </li><li>       . </li><li> ,     latslog, wtmp  utmp. </li><li>     ,   ,     . </li></ul><br><p>      . </p><br><h3 id="ninjahttpforkbomborgninja"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ninja</a> </h3><br><p>        Linux. </p><br><p>      ninja-build. </p><br><p> ,      .      UID/GID, Ninja      ,         ,    (,     , ). <br>          (, su). <br>   ,     . </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  Ubuntu</a> ,     Debian. </p><br><h2 id="skanery-bezopasnosti">   </h2><br><p>       .   .    ,    ,    ,   . <br>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nmap</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">W3af</a>  Web-. </p><br><h2 id="sistemy-alternativnyh-modeley-bezopasnosti">     </h2><br><p>  Linux  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> (  )  </a> . <br>      .  ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> . </p><br><p>   ,  ,   ,    . </p><br><p>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  " Linux"  IBM</a> . </p><br><p>  NAS        ,    AppArmor. <br>  ,       ,     . <br> ,          ,          ,         . </p><br><h3 id="access-control-listshttpsdocsoraclecomcde19253-01820-0836ftyxiindexhtml"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Access Control Lists</a> </h3><br><p>     ,     . <br>  , ZFS       . </p><br><div class="spoiler"> <b class="spoiler_title">   ACL  ZFS.</b> <div class="spoiler_text"><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Autorisation d'ajouter un nouveau fichier au r√©pertoire. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Autorisation de cr√©er un sous-r√©pertoire dans un r√©pertoire. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Autorisation de supprimer un fichier. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Autorisation de supprimer un fichier ou un r√©pertoire dans un r√©pertoire. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Autorisation d'ex√©cuter un fichier ou de rechercher le contenu d'un r√©pertoire. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Autorisation de r√©pertorier le contenu du r√©pertoire. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Autorisation de lecture des ACL (commande ls). </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Permission de lire les attributs de fichier de base (autres que les ACL, les attributs au niveau de la commande "stat"). </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Autorisation de lire le contenu du fichier. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Autorisation de lire les attributs de fichier √©tendus ou de rechercher dans le r√©pertoire des attributs de fichier √©tendus. </font></font></li><li>           . </li><li>       . </li><li>      ,     ,   . </li><li>       ACL    chmod. </li><li>        .        chown  chgrp . </li><li>           ,     .               PRIV_FILE_CHOWN. </li><li>      ACL   . </li><li>   ACL      . </li><li>   ACL   ,         ,     .     ACL    file_inherit,  dir_inherit   . </li><li>   ACL       ,      . </li></ul></div></div><br><p>  ACL    , ,     ,   .         . </p><br><p>    EXT ,  ZFS  ACL      <code>setfacl/getfacl</code> ,    <code>chmod</code>  <code>ls</code> . </p><br><h3 id="apparmorhttpsgitlabcomapparmorapparmorwikishome"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AppArmor</a> </h3><br><p><img src="https://habrastorage.org/webt/p2/yt/br/p2ytbr0l4cq_ujt9sh_njrh1t7k.jpeg"></p><br><p>         . </p><br><p> ,         ,     <code>exec</code> ,  ,      <code>open</code> , <code>exec</code>  . <br>      ,     . <br> AppArmor ,       . <br>  ,      . <br>     capabilites. </p><br><p>     ,    .       ,   ,      ,   . </p><br><div class="spoiler"> <b class="spoiler_title">     ping.</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#include &lt;tunables/global&gt; profile ping /{usr/,}bin/ping flags=(complain) { #include &lt;abstractions/base&gt; #include &lt;abstractions/consoles&gt; #include &lt;abstractions/nameservice&gt; capability net_raw, capability setuid, network inet raw, network inet6 raw, /{,usr/}bin/ping mixr, /etc/modules.conf r, # Site-specific additions and overrides. See local/README for details. #include &lt;local/bin.ping&gt; }</code> </pre> </div></div><br><p> ,       , ..     . ,  ,           ( <code>local/bin.ping</code> ),    ,     . </p><br><p>     deb-based . <br>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  firejail</a> ,    . </p><br><p>      ,   ,      . </p><br><p>    Debian, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> . </p><br><h3 id="selinuxhttpselinuxprojectorgpagemain_page"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SELinux</a> </h3><br><p> <a href=""><img src="https://habrastorage.org/webt/uk/8e/_4/uk8e_4yzmie_mnhkeak2sxxztem.png" alt="Architecture SELinux"></a> </p><br><p>    . <br>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NSA</a> ,      Debian   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> . </p><br><p>   SELinux   " " (type enforcement). </p><br><p>  , , ,      SELinux .      "". </p><br><p> ,    ,   <code>firefox_t</code> . <br> SELinux         ,     . </p><br><p>  Un exemple: </p><br><pre> <code class="plaintext hljs">allow firefox_t user_home_t : file { read write };</code> </pre> <br><p>     , ,  <code>firefox_t</code>         , ,  <code>user_home_t</code> . </p><br><p>  Un exemple: </p><br><pre> <code class="plaintext hljs">allow user_t user_home_t:file { create read write unlink };</code> </pre> <br><p>    <code>user_t</code>  , ,       <code>user_home_t</code> .  <code>user_t</code> ,  ,  . </p><br><p> ,      . </p><br><p>     AppArmor -,  ,   ,        . </p><br><div class="spoiler"> <b class="spoiler_title">     SELinux   .</b> <div class="spoiler_text"><ul><li> <strong></strong>  SELinux     Linux.     su  sudo,  SELinux  .   Linux    SELinux ,     1:1,     root. </li><li> <strong></strong> ,   ,   .  " ", "Web-", " ".     ,     <code>object_r</code> . <br>      ,  . </li><li> <strong></strong>  <strong></strong>      .  ‚Äî    ,  . </li><li> <strong></strong>  <strong></strong>     .  ,   ,        . ,     <code>user_u:user_r:user_t</code> ,        <code>user_u:object_r:user_home_t</code> .     : </li></ul><br><pre> <code class="plaintext hljs">user:role:type:range</code> </pre> <br><p>   ‚Äî SELinux user.    ‚Äî   , .  ‚Äî   MLS . </p><br><p> ,     ,  ,  <code>user_home_t.</code> <code>user_home_t</code> ‚Äî  ,         ,     . </p><br><ul><li> <strong> </strong>  <strong> </strong> ,   <code>dir</code>    <code>file</code>     ,    ,    .      ,     . , <code>file</code>     (create),  (read),  (write)   (unlink),   <code>unix_stream_socket object</code> ( UNIX)     (create),   (connect),    (sendto). </li></ul></div></div><br><p>     ,        . <br>     . ,    (,     ),    . </p><br><p> ,   AppArmor,  permissive ,       ,    . <br>       . <br>   ,       ,    AppArmor       . </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   SELinux</a>   . <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a> . <br>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  IBM</a> . </p><br><h3 id="grsecurityhttpswwwgrsecuritynet"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GrSecurity</a> </h3><br><p>    Debian -  .  ,    ,   . <br> ,   (     ), ‚Äî <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> Gentoo</a> .     : hardening <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a> . </p><br><p> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   </a> . </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  Debian</a>  ,    GrSecurity  PaX. </p><br><h3 id="tomoyohttptomoyoosdnjp"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tomoyo</a> </h3><br><p> Tomoyo  Debian   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> . </p><br><p>        .   AppArmor,   .   2003 . <br>   ,    ,  . <br>    ,    AppArmor,     . </p><br><h2 id="melochi">  </h2><br><p>        <code>/etc/securetty</code>  ,  root       ( ),        . </p><br><p>       PAM,       <code>/etc/security</code> . </p><br><p>    ,  Samhain  Tripwire,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">debsums</a> ,      . </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>    .     ,      . </p><br><p>  ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> Github </a> ,   . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr421279/">https://habr.com/ru/post/fr421279/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr421267/index.html">Refroidissement PSU de l'ordinateur semi-passif</a></li>
<li><a href="../fr421269/index.html">Le syst√®me de reconnaissance faciale install√© √† l'a√©roport am√©ricain a permis d'attraper l'attaquant</a></li>
<li><a href="../fr421271/index.html">Une s√©lection de documents utiles sur Azure. Partie 2 - cours</a></li>
<li><a href="../fr421275/index.html">Ce que j'ai compris apr√®s avoir vendu deux startups en 12 mois</a></li>
<li><a href="../fr421277/index.html">Segmentation d'images satellite en utilisant la reconnaissance d'arbre comme exemple</a></li>
<li><a href="../fr421281/index.html">R√©ponses du support technique 3CX: installation de votre propre logo sur l'√©cran du t√©l√©phone IP</a></li>
<li><a href="../fr421283/index.html">Le livre sur "Paragraphe" sur Habr√©. Chapitre un: Le savant gardien</a></li>
<li><a href="../fr421285/index.html">Trackers optiques: ASEF et MOSSE</a></li>
<li><a href="../fr421287/index.html">Briques de lune d'un four solaire</a></li>
<li><a href="../fr421289/index.html">Le nombre de voitures √©lectriques en Russie est pass√© de 920 √† 2500 en un an et demi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>