<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úÖ ‚òÄÔ∏è üèçÔ∏è So analysieren Sie das mobile MMORPG-Netzwerkprotokoll üöö ‚úàÔ∏è ‚úñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Im Laufe der Jahre, in denen ich ein mobiles MMORPG gespielt habe, habe ich einige Erfahrungen im Reverse Engineering gesammelt, die ich in einer Reih...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>So analysieren Sie das mobile MMORPG-Netzwerkprotokoll</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451512/">  Im Laufe der Jahre, in denen ich ein mobiles MMORPG gespielt habe, habe ich einige Erfahrungen im Reverse Engineering gesammelt, die ich in einer Reihe von Artikeln teilen m√∂chte.  Beispielthemen: <br><br><ol><li>  Analysieren Sie das Nachrichtenformat zwischen Server und Client. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Schreiben einer H√∂ranwendung, um den Spielverkehr auf bequeme Weise anzuzeigen.</a> </li><li>  Abfangen des Datenverkehrs und dessen √Ñnderung mithilfe eines Nicht-HTTP-Proxyservers. </li><li>  Die ersten Schritte zu Ihrem eigenen ("Raubkopien") Server. </li></ol><br>  In diesem Artikel werde ich das <b>Parsen des Nachrichtenformats zwischen dem Server und dem Client erl√§utern</b> .  Interessiert frage ich nach Katze. <br><a name="habracut"></a><br><h3>  Erforderliche Werkzeuge </h3><br>  Um die unten beschriebenen Schritte wiederholen zu k√∂nnen, ben√∂tigen Sie: <br><br><ul><li>  PC (habe ich unter Windows 7/10 gemacht, aber MacOS funktioniert m√∂glicherweise auch, wenn die folgenden Elemente dort verf√ºgbar sind); </li><li>  Wireshark f√ºr die Paketanalyse; </li><li>  010Editor zum Parsen von Paketen nach Vorlage (optional, erm√∂glicht jedoch die schnelle und einfache Beschreibung des Nachrichtenformats); </li><li>  das mobile Ger√§t selbst mit dem Spiel. </li></ul><br>  Dar√ºber hinaus ist es sehr w√ºnschenswert, lesbare Daten aus dem Spiel zur Hand zu haben, z. B. eine Liste von Objekten, Kreaturen usw. mit ihren Kennungen.  Dies vereinfacht die Suche nach Schl√ºsselpunkten in Paketen erheblich und erm√∂glicht es Ihnen manchmal, die gew√ºnschte Nachricht in einem konstanten Datenstrom zu filtern. <br><br><h3><anchor>  Parsen </anchor>  Nachrichtenformat zwischen Server und Client </h3><br>  Um loszulegen, m√ºssen wir den Datenverkehr des Mobilger√§ts sehen.  Dies ist ganz einfach (obwohl ich diese offensichtliche Entscheidung schon sehr lange getroffen habe): Auf unserem PC erstellen wir einen Wi-Fi-Zugangspunkt, stellen von einem mobilen Ger√§t aus eine Verbindung her, w√§hlen die gew√ºnschte Schnittstelle in Wireshark aus - und wir haben den gesamten mobilen Verkehr vor Augen. <br><br>  Nachdem Sie das Spiel betreten und einige Zeit gewartet haben, damit Anforderungen, die nicht mit dem Spielserver selbst zusammenh√§ngen, gestoppt werden, k√∂nnen Sie das folgende Bild sehen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/in/ye/61/inye619dyp2vh8iq8nvncdb25u0.png"></div><br>  Zu diesem Zeitpunkt k√∂nnen wir bereits Wireshark-Filter verwenden, um nur Pakete zwischen dem Spiel und dem Server sowie nur die Nutzdaten anzuzeigen: <br><br><pre><code class="plaintext hljs">tcp &amp;&amp; tcp.payload &amp;&amp; tcp.port == 44325</code> </pre> <br>  Wenn Sie an einem ruhigen Ort stehen, fern von anderen Spielern und dem NPC, und nichts tun, k√∂nnen Sie st√§ndig wiederholte Nachrichten vom Server und Client sehen (Gr√∂√üe 76 bzw. 84 Byte).  In meinem Fall wurde die Mindestanzahl verschiedener Pakete auf dem Zeichenauswahlbildschirm gesendet. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/u-/n9/su/u-n9sutlnqod9lbgttfuon6g1ue.png"></div><br>  Die H√§ufigkeit der Anforderung vom Client ist der von Ping sehr √§hnlich.  Nehmen wir ein paar Nachrichten zur √úberpr√ºfung (3 Gruppen, oben eine Anfrage eines Clients, unten die Antwort eines Servers): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/v3/z9/3e/v3z93eejzkii_hh6di5dwvbowfi.png"></div><br>  Das erste, was auff√§llt, ist die Identit√§t der Pakete.  Die 8 zus√§tzlichen Bytes in der Antwort bei der Konvertierung in das Dezimalsystem sind dem Zeitstempel in Sekunden sehr √§hnlich: <code>5CD008F8 <sub>16</sub> = 1557137656 <sub>10</sub></code> (vom ersten Paar).  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wir schauen auf die Uhr</a> - ja, das ist es.  Die vorherigen 4 Bytes stimmen mit den letzten 4 Bytes in der Anforderung √ºberein.  Bei der √úbersetzung erhalten wir: <code>A4BB <sub>16</sub> = 42171 <sub>10</sub></code> , was ebenfalls der Zeit sehr √§hnlich ist, jedoch in Millisekunden.  Es stimmt ungef√§hr mit der Zeit seit dem Start des Spiels √ºberein, und h√∂chstwahrscheinlich ist es das auch. <br><br>  Es bleiben die ersten 6 Bytes der Anforderung und Antwort zu ber√ºcksichtigen.  Es ist leicht zu bemerken, dass der Wert der ersten vier Bytes der Nachricht (nennen wir diesen Parameter <code>L</code> ) von der Gr√∂√üe der Nachricht abh√§ngt: Die Antwort vom Server betr√§gt mehr als 8 Bytes, der Wert von <code>L</code> ebenfalls um 8 erh√∂ht, die Paketgr√∂√üe ist jedoch in beiden F√§llen um 6 Bytes gr√∂√üer als der Wert von <code>L</code>  Sie k√∂nnen auch feststellen, dass die beiden Bytes nach <code>L</code> ihren Wert sowohl bei Anforderungen vom Client als auch vom Server beibehalten. Da sich ihr Wert um eins unterscheidet, k√∂nnen wir mit Sicherheit sagen, dass dies der Nachrichtencode <code>C</code> (die zugeh√∂rigen Nachrichtencodes werden h√∂chstwahrscheinlich bestimmt nacheinander).  Die allgemeine Struktur ist klar genug, um eine minimale Vorlage f√ºr 010Editor zu schreiben: <br><br><ul><li>  erste 4 Bytes - <code>L</code> - Nachrichtennutzlastgr√∂√üe; </li><li>  n√§chste 2 Bytes - <code>C</code> - Nachrichtencode; </li><li>  Nutzlast selbst. </li></ul><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Event</span></span></span><span class="hljs-class"> {</span></span> uint payload_length &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0xFFFF00</span></span>, name=<span class="hljs-string"><span class="hljs-string">"Payload Length"</span></span>&gt;; ushort event_code &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0xFF9988</span></span>, name=<span class="hljs-string"><span class="hljs-string">"Event Code"</span></span>&gt;; byte payload[payload_length] &lt;name=<span class="hljs-string"><span class="hljs-string">"Event Payload"</span></span>&gt;; };</code> </pre><br>  Daher das Format der Client-Ping-Nachricht: lokale Ping-Zeit senden;  Server-Antwortformat: Senden Sie dieselbe Zeit und Uhrzeit des Sendens der Antwort in Sekunden.  Es scheint nicht schwierig zu sein, oder? <br><br>  Versuchen wir, ein Beispiel komplizierter zu machen.  Wenn Sie an einem ruhigen Ort stehen und die Ping-Pakete verstecken, k√∂nnen Sie Nachrichten teleportieren und Gegenst√§nde (Fahrzeuge) erstellen.  Beginnen wir mit dem ersten.  Ich besa√ü die Spieldaten und wusste, nach welchem ‚Äã‚ÄãWert des Teleportpunkts ich suchen musste.  F√ºr Tests habe ich Punkte mit den Werten <code>0x2B</code> , <code>0x67</code> , <code>0x6B</code> und <code>0x1AF</code> .  Vergleichen Sie mit den Werten in den Nachrichten: <code>0x2B</code> , <code>0x67</code> , <code>0x6B</code> und <code>0x3AF</code> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/y7/7r/qs/y77rqsd0mxecueorqwdip3ow3r8.png"></div><br>  Das Durcheinander.  Zwei Probleme sind sichtbar: <br><br><ol><li>  Werte sind nicht 4 Bytes, sondern unterschiedlich gro√ü; </li><li>  Nicht alle Werte stimmen mit den Daten aus den Dateien √ºberein. In diesem Fall betr√§gt der Unterschied 128. </li></ol><br>  Beim Vergleich mit dem Ping-Format k√∂nnen Sie au√üerdem einen Unterschied feststellen: <br><br><ul><li>  unverst√§ndlich <code>0x08</code> vor dem erwarteten Wert; </li><li>  Ein 4-Byte-Wert, 4 kleiner als <code>L</code> (nennen wir es <code>D</code> Dieses Feld erscheint nicht in allen Nachrichten, was etwas seltsam ist, aber wo es ist, bleibt die Abh√§ngigkeit <code>L - 4 = D</code> erhalten. Zum einen f√ºr Nachrichten mit eine einfache Struktur (wie Ping) ist nicht erforderlich, aber auf der anderen Seite - es sieht nutzlos aus). </li></ul><br>  Ich denke, einige von Ihnen h√§tten den Grund f√ºr die Nicht√ºbereinstimmung der erwarteten Werte bereits erraten k√∂nnen, aber ich werde fortfahren.  Mal sehen, was im Handwerk passiert: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8f/zk/vs/8fzkvsleifr5b1yodx6a77ggx_g.png"></div><br>  Die erwarteten Werte von 14183 und 14285 entsprechen ebenfalls nicht den tats√§chlichen 28391 und 28621, aber der Unterschied ist hier bereits viel gr√∂√üer als 128. Nach vielen Tests (auch bei anderen Arten von Nachrichten) stellte sich heraus, dass der Unterschied zwischen dem Wert im Paket umso gr√∂√üer ist, je gr√∂√üer die erwartete Anzahl ist.  Was seltsam war, war, dass die Werte bis zu 128 f√ºr sich blieben.  Verstanden, was ist los?  Die offensichtliche Situation ist f√ºr diejenigen, die dies bereits erlebt haben, und ich musste diese ‚ÄûChiffre‚Äú unwissentlich zwei Tage lang zerlegen (am Ende half die Analyse der Werte in bin√§rer Form beim ‚ÄûHacken‚Äú).  Das oben beschriebene Verhalten wird als <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Variable Length Quantity bezeichnet</a></i> - eine Darstellung einer Zahl, die eine unbestimmte Anzahl von Bytes verwendet, wobei das achte Bit eines Bytes (Fortsetzungsbit) das Vorhandensein des n√§chsten Bytes bestimmt.  Aus der Beschreibung geht hervor, dass das Lesen von VLQ nur in Little-Endian-Reihenfolge m√∂glich ist.  Zuf√§lligerweise sind alle Werte in den Paketen in dieser Reihenfolge. <br><br>  Nachdem wir nun wissen, wie der Anfangswert ermittelt wird, k√∂nnen wir eine Vorlage f√ºr den Typ schreiben: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VLQ</span></span></span><span class="hljs-class"> {</span></span> local <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> size = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { byte obf_byte; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((obf_byte &amp; <span class="hljs-number"><span class="hljs-number">0x80</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) { size++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } FSeek(FTell() - size); byte bytes[size]; local uint64 _ = FromVLQ(bytes, size); };</code> </pre><br>  Und die Funktion, ein Array von Bytes in einen ganzzahligen Wert umzuwandeln: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">uint64 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FromVLQ</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(byte bytes[], </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size)</span></span></span><span class="hljs-function"> </span></span>{ local uint64 source = <span class="hljs-number"><span class="hljs-number">0</span></span>; local <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; local byte x; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; size; i++) { x = bytes[i]; source |= (x &amp; <span class="hljs-number"><span class="hljs-number">0x7F</span></span>) * Pow(<span class="hljs-number"><span class="hljs-number">2</span></span>, i * <span class="hljs-number"><span class="hljs-number">7</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   &lt;&lt;   , ..     ,  uint32,        uint64 if ((x &amp; 0x80) != 0x80) { break; } } return source; };</span></span></code> </pre><br>  Aber zur√ºck zur Schaffung des Themas.  Wieder erscheint <code>D</code> und wieder <code>0x08</code> vor dem sich √§ndernden Wert.  Die letzten zwei Bytes der <code>0x10 0x01</code> Nachricht √§hneln verd√§chtig der Anzahl der Handwerksgegenst√§nde, wobei <code>0x10</code> eine √§hnliche Rolle wie <code>0x08</code> aber immer noch unverst√§ndlich ist.  Aber jetzt k√∂nnen Sie eine Vorlage f√ºr dieses Ereignis schreiben: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CraftEvent</span></span></span><span class="hljs-class"> {</span></span> uint data_length &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FF00</span></span>, name=<span class="hljs-string"><span class="hljs-string">"Data Length"</span></span>&gt;; byte marker1; VLQ craft_id &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FF00</span></span>, name=<span class="hljs-string"><span class="hljs-string">"Craft ID"</span></span>&gt;; byte marker2; VLQ quantity &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FF00</span></span>, name=<span class="hljs-string"><span class="hljs-string">"Craft Quantity"</span></span>&gt;; };</code> </pre><br>  Welches w√ºrde so aussehen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ex/sl/y1/exsly1e_f3_3dtj4mhyzryehzou.png"></div><br>  Und dennoch waren dies einfache Beispiele.  Es wird schwieriger sein, das Ereignis der Bewegung des Charakters zu analysieren.  Welche Informationen erwarten wir?  Zumindest die Koordinaten des Charakters, wo er hinschaut, Geschwindigkeit und Zustand (Stehen, Laufen, Springen usw.).  Da in der Nachricht keine Zeilen sichtbar sind, wird der Status h√∂chstwahrscheinlich durch <code>enum</code> .  Durch Auflisten der Optionen, gleichzeitiges Vergleichen mit den Daten aus den Spieledateien sowie durch zahlreiche Tests k√∂nnen Sie drei XYZ-Vektoren mithilfe dieser umst√§ndlichen Vorlage finden: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MoveEvent</span></span></span><span class="hljs-class"> {</span></span> uint data_length &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FF00</span></span>, name=<span class="hljs-string"><span class="hljs-string">"Data Length"</span></span>&gt;; byte marker; VLQ move_time &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FFFF</span></span>&gt;; FSkip(<span class="hljs-number"><span class="hljs-number">2</span></span>); byte marker; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> position_x &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FF00</span></span>&gt;; byte marker; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> position_y &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FF00</span></span>&gt;; byte marker; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> position_z &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FF00</span></span>&gt;; FSkip(<span class="hljs-number"><span class="hljs-number">2</span></span>); byte marker; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> direction_x &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FFFF</span></span>&gt;; byte marker; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> direction_y &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FFFF</span></span>&gt;; byte marker; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> direction_z &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FFFF</span></span>&gt;; FSkip(<span class="hljs-number"><span class="hljs-number">2</span></span>); byte marker; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> speed_x &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FFFF</span></span>&gt;; byte marker; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> speed_y &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FFFF</span></span>&gt;; byte marker; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> speed_z &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FFFF</span></span>&gt;; byte marker; VLQ character_state &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FF00</span></span>&gt;; };</code> </pre><br>  Visuelles Ergebnis: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/aw/wn/rz/awwnrzzruq2wtcnmwbpkho3q1x8.png"></div><br>  Die gr√ºnen drei erwiesen sich als die Koordinaten des Ortes, die gelben drei zeigen h√∂chstwahrscheinlich, wohin der Charakter schaut und der Vektor seiner Geschwindigkeit, und die letzte einzelne ist der Zustand des Charakters.  Sie k√∂nnen konstante Bytes (Markierungen) zwischen den Koordinatenwerten ( <code>0x0D</code> vor dem <code>X</code> Wert, <code>0x015</code> vor <code>Y</code> und <code>0x1D</code> vor <code>Z</code> ) und vor dem Zustand ( <code>0x30</code> ) <code>0x30</code> , die in ihrer Bedeutung verd√§chtig √§hnlich zu <code>0x08</code> und <code>0x10</code> .  Nachdem viele Marker von anderen Ereignissen analysiert worden waren, stellte sich heraus, dass sie die Art des darauf folgenden Wertes (die ersten drei Bits) und die semantische Bedeutung bestimmen, d. H.  Wenn Sie im obigen Beispiel die Vektoren <code>0x120F</code> w√§hrend Sie ihre Markierungen beibehalten ( <code>0x120F</code> vor den Koordinaten usw.), sollte das Spiel (theoretisch) normalerweise die Nachricht analysieren.  Basierend auf diesen Informationen k√∂nnen Sie einige neue Typen hinzuf√ºgen: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Packed</span></span></span><span class="hljs-class"> {</span></span> VLQ marker &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0xFFBB00</span></span>&gt;; <span class="hljs-comment"><span class="hljs-comment">//    VLQ! local uint size = marker.size; //       ( , )          switch (marker._ &amp; 0x7) { case 1: double v; size += 8; break; //     case 5: float v; size += 4; break; default: VLQ v; size += v.size; break; } }; struct PackedVector3 { Packed marker &lt;name="Marker"&gt;; Packed x &lt;name="X"&gt;; Packed y &lt;name="Y"&gt;; Packed z &lt;name="Z"&gt;; };</span></span></code> </pre><br>  Jetzt wurde unsere Vorlage f√ºr Bewegungsnachrichten erheblich reduziert: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MoveEvent</span></span></span><span class="hljs-class"> {</span></span> uint data_length &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FF00</span></span>, name=<span class="hljs-string"><span class="hljs-string">"Data Length"</span></span>&gt;; Packed move_time &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FFFF</span></span>&gt;; PackedVector3 position &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FF00</span></span>&gt;; PackedVector3 direction &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FF00</span></span>&gt;; PackedVector3 speed &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FF00</span></span>&gt;; Packed state &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FF00</span></span>&gt;; };</code> </pre><br>  Ein weiterer Typ, den wir im n√§chsten Artikel m√∂glicherweise ben√∂tigen, sind die Zeilen, denen der <code>Packed</code> Wert ihrer Gr√∂√üe vorangestellt ist: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PackedString</span></span></span><span class="hljs-class"> {</span></span> Packed length; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> str[length.v._]; };</code> </pre><br>  Wenn Sie das Beispielnachrichtenformat kennen, k√∂nnen Sie Ihre Abh√∂ranwendung schreiben, um Nachrichten bequem zu filtern und zu analysieren. Dies ist jedoch das Thema f√ºr den n√§chsten Artikel. <br><br>  <b>Upd:</b> danke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">aml</a> f√ºr den Hinweis, dass die oben beschriebene Nachrichtenstruktur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Protocol Buffer ist</a> , und auch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Tatikoma</a> f√ºr einen Link zu einem n√ºtzlichen verwandten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de451512/">https://habr.com/ru/post/de451512/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de451502/index.html">Digitale Veranstaltungen in Moskau vom 13. bis 19. Mai</a></li>
<li><a href="../de451504/index.html">Bilder im Web 2019</a></li>
<li><a href="../de451506/index.html">Wie DNSCrypt das abgelaufene Zertifikatproblem durch Eingabe eines G√ºltigkeitszeitraums von 24 Stunden l√∂ste</a></li>
<li><a href="../de451508/index.html">Dummy-Handbuch: Erstellen von DevOps-Ketten mit Open Source-Tools</a></li>
<li><a href="../de451510/index.html">Ein paar technische Texte √ºber C ++ Tools von JetBrains und was Einh√∂rner damit zu tun haben</a></li>
<li><a href="../de451514/index.html">CSS Subgrid News</a></li>
<li><a href="../de451516/index.html">Im Spring Framework verwendete Entwurfsmuster</a></li>
<li><a href="../de451518/index.html">Unsere abgespeckten mobilen Websites</a></li>
<li><a href="../de451520/index.html">VDI: Billig und fr√∂hlich</a></li>
<li><a href="../de451522/index.html">Wir stellen die Automatisierung in wenigen Stunden bereit: TypeScript, Protractor, Jasmine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>