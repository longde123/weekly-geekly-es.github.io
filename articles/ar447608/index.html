<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐮 🏳️ ⭕️ تطور CI في فريق تطوير الأجهزة المحمولة 〰️ 🧓 🥠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="اليوم ، يتم تطوير معظم منتجات البرمجيات في فرق. يمكن تقديم شروط النجاح لتطوير الفريق في شكل مخطط بسيط. 



 بعد كتابة الكود ، يجب عليك التأكد من أنه: ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>تطور CI في فريق تطوير الأجهزة المحمولة</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/447608/" style=";text-align:right;direction:rtl">  اليوم ، يتم تطوير معظم منتجات البرمجيات في فرق.  يمكن تقديم شروط النجاح لتطوير الفريق في شكل مخطط بسيط. <br><br><img src="https://habrastorage.org/webt/wd/yv/we/wdyvwe6jcuq9yygmffhk5-eqnlo.png"><br><br>  بعد كتابة الكود ، يجب عليك التأكد من أنه: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  إنه يعمل. </li><li style=";text-align:right;direction:rtl">  إنه لا يكسر أي شيء ، بما في ذلك الكود الذي كتبه زملاؤك. </li></ol><br>  إذا تم استيفاء الشرطين ، فأنت في طريق النجاح.  من أجل التحقق بسهولة من هذه الشروط وعدم إيقاف مسار مربح ، توصلوا إلى التكامل المستمر. <br><br>  CI هو سير عمل تقوم فيه بدمج الكود الخاص بك في رمز المنتج العام كلما كان ذلك ممكنًا.  وليس فقط دمج ، ولكن أيضا التحقق باستمرار من أن كل شيء يعمل.  نظرًا لأنك تحتاج إلى التحقق كثيرًا وفي كثير من الأحيان ، يجب أن تفكر في التشغيل الآلي.  يمكنك التحقق من كل شيء على الجر اليدوي ، ولكن لا يستحق كل هذا العناء ، وهذا هو السبب. <br><a name="habracut"></a><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>الناس غالية الثمن</strong> .  ساعة عمل أي مبرمج أغلى من ساعة عمل أي خادم. </li><li style=";text-align:right;direction:rtl">  <strong>الناس مخطئون</strong> .  لذلك ، قد تنشأ المواقف عندما يجرون اختبارات على الفرع الخطأ أو يجمعون الالتزام الخطأ للمختبرين. </li><li style=";text-align:right;direction:rtl">  <strong>الناس كسول</strong> .  بشكل دوري ، عندما أنتهي من مهمة ما ، لدي فكرة: "لكن ما الذي يجب التحقق منه؟  كتبت سطرين - كل شيء يعمل!  أعتقد بالنسبة لبعضكم أن هذه الأفكار تتبادر إلى الذهن في بعض الأحيان.  ولكن عليك دائما أن تحقق. </li></ul><br>  يقول نيكولاي نيستيروف ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">nnesterov</a> ) - مشارك في جميع التغييرات التطورية لتطبيق CI / CD Android: تم تقديم وتطوير التكامل المستمر في فريق تطوير Avito المحمول ، وكيف حصلوا على 0 إلى 450 مجموعة في اليوم ، وأن آلات البناء تجمع 200 ساعة في اليوم. . <br><br>  تم بناء القصة على مثال فريق Android ، ولكن معظم النهج تنطبق على نظام iOS أيضًا. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/lz8MNATTUCU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  ذات مرة ، عمل شخص واحد في فريق Avito Android.  بحكم التعريف ، لم يكن بحاجة إلى أي شيء من التكامل المستمر: لم يكن هناك أحد للتكامل معه. <br><br>  ولكن نما التطبيق ، ظهرت المزيد والمزيد من المهام الجديدة ، على التوالي ، نما الفريق.  في وقت ما ، حان الوقت لتأسيس عملية دمج الكود بشكل رسمي.  تقرر استخدام تدفق جيت. <br><br><img src="https://habrastorage.org/webt/rv/qa/jd/rvqajd0kgcao3w0-vw6lnomjpc8.png"><br><br>  يُعرف مفهوم تدفق Git: يوجد فرع تطوير مشترك واحد في المشروع ، ولكل ميزة جديدة ، يقوم المطورون بقطع فرع منفصل ، والالتزام به ، ودفعه ، وعندما يرغبون في ضخ الشفرة الخاصة بهم في فرع التطوير ، فتح طلب السحب.  لمشاركة المعرفة ومناقشة الطرق ، قدمنا ​​مراجعة للشفرة ، أي أنه يجب على الزملاء التحقق من كود بعضهم البعض وتأكيده. <br><br><h2 style=";text-align:right;direction:rtl">  الشيكات </h2><br>  مشاهدة الكود بعينيك أمر رائع ، لكن ليس كافيًا.  لذلك ، يتم تقديم الشيكات التلقائية. <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  بادئ ذي بدء ، نتحقق من <strong>تجميع ARC</strong> . </li><li style=";text-align:right;direction:rtl">  الكثير من <strong>اختبارات Junit</strong> . </li><li style=";text-align:right;direction:rtl">  <strong>نحن نعتبر تغطية الشفرة</strong> ، لأننا نجري الاختبارات. </li></ul><br>  لفهم كيفية تشغيل هذه الاختبارات ، دعنا ننظر إلى عملية التطوير في Avito. <br><br>  من الناحية التخطيطية ، يمكن تمثيلها على النحو التالي: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  المطور يكتب الكود على حاسوبه المحمول.  يمكنك تشغيل اختبارات التكامل هنا - إما من خلال ربط الالتزام ، أو مجرد تشغيل الاختبارات في الخلفية. </li><li style=";text-align:right;direction:rtl">  بعد قيام المطور بتشغيل الكود ، يفتح طلب السحب.  من أجل الوصول إلى رمز التطوير الخاص به ، يجب عليك مراجعة التعليمات البرمجية وجمع العدد المطلوب من التأكيدات.  يمكنك تمكين عمليات التحقق والبناء هنا: حتى يتم نجاح جميع عمليات الإنشاء ، لا يمكن دمج طلب السحب. </li><li style=";text-align:right;direction:rtl">  بعد دمج طلب السحب والرمز قيد التطوير ، يمكنك اختيار وقت مناسب: على سبيل المثال ، في الليل ، عندما تكون جميع الخوادم مجانية ، ويتحقق محرك الأقراص حسب رغبتك. </li></ul><br>  لا أحد يحب تشغيل الاختبارات على الكمبيوتر المحمول.  عندما ينتهي المطور من الميزة ، يريد تشغيلها بسرعة وفتح طلب السحب.  إذا تم إطلاق بعض عمليات الفحص الطويلة في تلك اللحظة ، فليس هذا أمرًا ممتعًا فحسب ، بل إنه يؤدي أيضًا إلى إبطاء عملية التطوير: بينما يتحقق الكمبيوتر المحمول من شيء ما ، فمن المستحيل العمل عليه بشكل طبيعي. <br><br>  لقد أحببنا حقًا تشغيل الشيكات في الليل ، لأنه يوجد الكثير من الوقت والخوادم ، يمكنك المشي.  ولكن ، لسوء الحظ ، عندما تطورت شفرة الميزات ، فإن المطور لديه بالفعل حافز أقل بكثير لإصلاح الأخطاء التي وجدتها CI.  لقد أدركت بشكل دوري أنني أفكر عندما بحثت في التقرير الصباحي عن جميع الأخطاء التي وجدت أنني سأصلحها في وقت لاحق ، لأن الآن في Jira تكمن مهمة جديدة رائعة أريد فقط أن أبدأ بها. <br><br>  إذا كانت عمليات الفحص تمنع طلب السحب ، فهناك دافع كافٍ ، لأنه حتى تتحول البنى إلى اللون الأخضر ، لن يتم تطوير الرمز ، مما يعني أن المهمة لن تكتمل. <br><br>  نتيجةً لذلك ، اخترنا هذه الاستراتيجية: في الليل ، نقوم بقيادة أقصى مجموعة ممكنة من الشيكات ، والأكثر أهمية منها ، والأهم من ذلك بسرعة ، تشغيلها بناءً على طلب سحب.  لكننا لا نتوقف عند هذا الحد - وبالتوازي مع ذلك ، نقوم بتحسين سرعة تمرير الشيكات بحيث يتم نقلها من الوضع الليلي إلى الشيكات عند طلب السحب. <br><br>  في ذلك الوقت ، سارت جميع مجموعاتنا بسرعة كافية ، لذلك قمنا فقط بتضمين تجميع ARC واختبارات Junit وحساب تغطية الشفرة مع مانع طلب السحب.  لقد قاموا بتشغيله وفكروا فيه وتخلوا عن تغطية الرمز لأنهم اعتقدوا أننا لسنا في حاجة إليها. <br><br>  <strong><em>استغرقنا يومين لاستكمال إعداد CI الأساسي (فيما يلي ، تقدير مؤقت تقريبي ، مطلوب للقياس).</em></strong> <br><br>  بعد ذلك ، بدأوا يفكرون أكثر - هل نتحقق منه بشكل صحيح؟  هل نطلق برامج بناء على طلب السحب بشكل صحيح؟ <br><br>  لقد بدأنا الإنشاء على الالتزام الأخير للفرع الذي به طلب سحب مفتوح.  لكن عمليات التحقق من هذا الالتزام يمكن أن تظهر فقط أن التعليمات البرمجية التي كتبها المطور تعمل.  لكنهم لم يثبتوا أنه لم يكسر أي شيء.  في الواقع ، تحتاج إلى التحقق من حالة فرع التطوير بعد حقن الميزة فيه. <br><br><img src="https://habrastorage.org/webt/g7/sw/gn/g7swgnopkxqajjm-73mz9oxwbng.png"><br><br>  للقيام بذلك ، كتبنا <strong>premerge.sh</strong> النصي باش بسيط <strong>:</strong> <br><br><pre style=";text-align:right;direction:rtl"><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env bash set -e git fetch origin develop git merge origin/develop</span></span></code> </pre> <br>  هنا ، يتم سحب كل التغييرات الأخيرة من التطوير ودمجها في الفرع الحالي.  أضفنا البرنامج النصي premerge.sh كخطوة أولى لجميع عمليات البناء وبدأنا في التحقق من ما نريده بالضبط ، أي <strong>التكامل</strong> . <br><br>  <strong><em>استغرق الأمر ثلاثة أيام لترجمة المشكلة وإيجاد حل لكتابة هذا البرنامج النصي.</em></strong> <br><br>  تم تطوير التطبيق ، وظهور المزيد والمزيد من المهام ، ونما الفريق ، وبدأت في بعض الأحيان تهدئة premerge.sh.  في تطوير اخترقت التغييرات المتعارضة التي كسرت التجمع. <br><br>  مثال على كيفية حدوث ذلك: <br><br><img src="https://habrastorage.org/webt/xc/dm/e-/xcdme-bg7rwxkmgip5pgh4hlc8u.png"><br><br>  يبدأ مطوران في نفس الوقت ببدء نشر الميزات A و B. يكتشف مطور الميزة A وظيفة <code>answer()</code> غير المستخدمة في المشروع ، ويؤدي إلى إزالتها ، مثل الكشف الجيد.  في الوقت نفسه ، يضيف مطور الميزة ب مكالمة جديدة لهذه الوظيفة في فرعه. <br><br>  المطورين الانتهاء من العمل وفي الوقت نفسه فتح طلب السحب.  يبني البداية ، يقوم premerge.sh بالتحقق من كلا طلب السحب لحالة تطوير جديدة - كل عمليات الفحص باللون الأخضر.  بعد أن يتم دمج ميزات طلب السحب A ، يتم دمج ميزات طلب السحب B ... Boom!  تطوير فواصل لأنه في رمز التطوير هناك دعوة إلى وظيفة غير موجودة. <br><br><img src="https://habrastorage.org/webt/zk/im/_r/zkim_rji20ahq4fyztlnc-twxwi.png"><br><br>  عندما لا تتطور ، هذه <strong>كارثة محلية</strong> .  لا يمكن للفريق بأكمله جمع وإعطاء أي شيء للاختبار. <br><br>  لقد حدث أنني كنت غالبًا ما أشارك في مهام البنية الأساسية: التحليلات والشبكات وقواعد البيانات.  هذا هو ، كتبت الوظائف والفئات التي يستخدمها مطورو البرامج الآخرون.  ولهذا السبب ، غالبًا ما حصلت في مثل هذه الحالات.  كان لدي حتى مثل هذه الصورة في وقت واحد. <br><br><img src="https://habrastorage.org/webt/xo/vj/6e/xovj6ea0xjjvuoxfgnrrhbskxta.jpeg"><br><br>  نظرًا لأن هذا لم يناسبنا ، بدأنا في إعداد خيارات حول كيفية منع ذلك. <br><br><h2 style=";text-align:right;direction:rtl">  كيف لا كسر تطوير </h2><br>  الخيار الأول: <strong>إعادة إنشاء كل طلب سحب عند تطوير الترقية.</strong>  إذا تم تطوير طلب السحب مع الميزة A في المثال الخاص بنا أولاً ، فسيتم إعادة بناء طلب السحب للميزة B ، وبالتالي ، ستفشل عمليات الفحص بسبب خطأ في الترجمة. <br><br>  لفهم المدة التي سيستغرقها الأمر ، فكر في مثال مع اثنين من الممثلين.  نفتح اثنين من العلاقات العامة: اثنين يبني ، واثنين من إطلاق الاختبار.  بعد سكب العلاقات العامة الأولى في التطوير ، يجب إعادة بناء الثانية.  في المجموع ، تستغرق عمليتا إطلاق الشيكتان PR ثلاثة PRS: 2 + 1 = 3. <br><br>  من حيث المبدأ ، هذا طبيعي.  لكننا نظرنا إلى الإحصاءات ، وكان الوضع المعتاد في فريقنا هو 10 مستفيدين أساسيين مفتوحين ، ثم عدد الشيكات هو مجموع التقدم: 10 + 9 + ... + 1 = 55. وهذا يعني ، من أجل قبول 10 PRS ، تحتاج إلى إعادة بناء 55 مرة.  وهذا في وضع مثالي ، عندما تمر جميع الشيكات في المرة الأولى ، عندما لا يفتح أي شخص طلب سحب إضافي أثناء معالجة هذه الشيكات. <br><br>  تخيل نفسك مطورًا يحتاج إلى وقت للضغط على زر "دمج" أولاً ، لأنه إذا تم القيام بذلك من قِبل أحد الجيران ، فسيتعين عليك الانتظار حتى تمر جميع المجموعات مرة أخرى ... لا ، هذا لن ينجح ، وسيؤدي ذلك إلى إبطاء عملية التطوير بشكل خطير. <br><br>  الطريقة الثانية الممكنة: <strong>لجمع طلب السحب بعد مراجعة الكود.</strong>  أي ، افتح طلب السحب ، وجمع العدد الضروري من التحديثات من الزملاء ، وقم بتصحيح ما تحتاج إليه ، ثم قم بتشغيل الإنشاءات.  إذا كانت ناجحة ، اسحب طلب دمج مع تطوير.  في هذه الحالة ، لا توجد عمليات إعادة تشغيل إضافية ، لكن التغذية الراجعة تبطئ كثيرًا.  كمطور ، عندما أفتح طلب سحب ، أريد على الفور معرفة ما إذا كان سيقوم بذلك.  على سبيل المثال ، إذا تعطل الاختبار ، فأنت بحاجة إلى إصلاحه بسرعة.  في حالة الإنشاء المتأخر ، تبطئ الملاحظات ، مما يعني التطوير بالكامل.  هذا لم يناسبنا أيضًا. <br><br>  ونتيجة لذلك ، بقي الخيار الثالث فقط - إلى <strong>دورة</strong> .  جميع الكود لدينا ، يتم تخزين جميع مصادرنا في المستودع في خادم Bitbucket.  وفقا لذلك ، كان لدينا لتطوير البرنامج المساعد ل Bitbucket. <br><br><img src="https://habrastorage.org/webt/kf/ye/yx/kfyeyxalmkommukvjics9uvinn4.png"><br><br>  يتجاوز هذا البرنامج المساعد آلية دمج طلب السحب.  البداية قياسية: يتم فتح PR ، وتبدأ جميع التجميعات ، ومراجعة الكود.  ولكن بعد انقضاء مراجعة الشفرة ، وقرر المطور النقر فوق "دمج" ، يتحقق المكون الإضافي لمعرفة الحالة التي تم فيها إجراء اختبارات التطوير.  إذا نجح التطوير في التحديث بعد الإنشاءات ، فلن يسمح لك المكون الإضافي بدمج طلب السحب هذا في الفرع الرئيسي.  سيتم ببساطة إعادة تشغيل البنيات نسبة إلى تطوير جديدة. <br><br><img src="https://habrastorage.org/webt/_v/_s/0z/_v_s0zaf1bjvxn8oiwekagtj37a.png"><br><br>  في مثالنا مع التغييرات المتعارضة ، ستفشل مثل هذه الإنشاءات بسبب خطأ في الترجمة.  وفقًا لذلك ، سيتعين على مطور الميزة B تصحيح الكود ، وإعادة تشغيل الشيكات ، ثم سيقوم المكوّن الإضافي بتطبيق طلب السحب تلقائيًا. <br><br>  قبل تنفيذ هذا البرنامج المساعد ، كان لدينا متوسط ​​2.7 اختبار تشغيل لكل طلب سحب.  مع البرنامج المساعد كان هناك 3.6 إطلاق.  انها مناسبة لنا. <br><br>  تجدر الإشارة إلى أن هذا البرنامج المساعد له عيب: فهو يعيد تشغيل البناء مرة واحدة فقط.  أي ، على أي حال ، تظل نافذة صغيرة يمكن من خلالها تطوير التغييرات المتعارضة.  لكن احتمال ذلك ليس مرتفعًا ، وقد توصلنا إلى حل وسط بين عدد مرات البدء واحتمال الفشل.  لمدة عامين ، أطلق النار مرة واحدة فقط ، وبالتالي ، ربما لم تذهب سدى. <br><br>  <strong><em>استغرقنا أسبوعين لكتابة الإصدار الأول من البرنامج المساعد لـ Bitbucket.</em></strong> <br><br><h3 style=";text-align:right;direction:rtl">  الشيكات الجديدة </h3><br>  وفي الوقت نفسه ، واصل فريقنا النمو.  تم إضافة الشيكات الجديدة. <br><br>  فكرنا: لماذا إصلاح الأخطاء إذا كان يمكن الوقاية منها؟  وهكذا قدموا <strong>تحليل الكود الثابت</strong> .  لقد بدأنا باستخدام الوبر ، والذي تم تضمينه في Android SDK.  لكن في ذلك الوقت لم يكن يعرف كيفية التعامل مع كود Kotlin على الإطلاق ، ولدينا بالفعل 75 ٪ من التطبيق المكتوب في Kotlin.  لذلك ، تمت إضافة اختبارات <strong>Android Studio</strong> المدمجة إلى الوبر <strong>.</strong> <br><br>  للقيام بذلك ، كان عليّ أن أكون منحرفًا جدًا: خذ Android Studio ، وحزمه في Docker وقم بتشغيله على CI بجهاز عرض افتراضي حتى ظن أنه يعمل على كمبيوتر محمول حقيقي.  لكنها نجحت. <br><br>  أيضًا في هذا الوقت ، بدأنا في كتابة الكثير من <strong>اختبارات الأجهزة</strong> وتنفيذ <strong>اختبار لقطة الشاشة</strong> .  يحدث هذا عندما يتم إنشاء لقطة شاشة مرجعية لعرض صغير منفصل ، ويتمثل الاختبار في أخذ لقطة شاشة من العرض ومقارنتها مباشرةً مع وحدة البكسل المرجعية بالبكسل.  إذا كان هناك تباين ، فهذا يعني أن التصميم قد ذهب إلى مكان ما أو حدث خطأ ما في الأنماط. <br><br>  لكن اختبارات الأجهزة واختبارات لقطة الشاشة يجب أن يتم تشغيلها على الأجهزة: على أجهزة محاكاة أو على أجهزة حقيقية.  نظرًا لوجود العديد من الاختبارات وغالبًا ما تطاردها ، فأنت بحاجة إلى مزرعة كاملة.  إن بدء المزرعة الخاصة بك أمر شاق للغاية ، لذلك وجدنا خيارًا جاهزًا - Firebase Test Lab. <br><br><h3 style=";text-align:right;direction:rtl">  مختبر اختبار Firebase </h3><br>  تم اختياره لأن Firebase هو منتج من منتجات Google ، أي أنه يجب أن يكون موثوقًا به ومن غير المرجح أن يموت.  الأسعار معقولة: 5 دولارات في الساعة لجهاز حقيقي ، 1 دولار في الساعة لمحاكي. <br><br>  <strong><em>استغرق الأمر حوالي ثلاثة أسابيع لتنفيذ مختبر اختبار Firebase في CI.</em></strong> <br><br>  لكن الفريق استمر في النمو وبدأت قاعدة Firebase ، للأسف ، في إسقاطنا.  في ذلك الوقت ، لم يكن لديه جيش تحرير السودان.  في بعض الأحيان ، جعلنا Firebase ننتظر حتى يصبح العدد المطلوب من الأجهزة للاختبارات مجانيًا ، ولم نبدأ في تنفيذها على الفور ، كما أردنا ذلك.  استغرق الانتظار في الطابور مدة تصل إلى نصف ساعة ، وهذا وقت طويل جدًا.  امتدت اختبارات الأجهزة إلى كل علاقات عامة ، وأبطأت عملية التطوير كثيراً ، ثم جاءت فاتورة شهرية مع مبلغ مستدير.  بشكل عام ، تقرر التخلي عن Firebase ورؤيته في المنزل ، حيث نما الفريق بما فيه الكفاية. <br><br><h3 style=";text-align:right;direction:rtl">  عامل الميناء + بيثون + باش </h3><br>  لقد أخذنا عامل الميناء ، المحاكيات المحشوة فيه ، إلى برنامج Python بسيط يقوم في الوقت المناسب برفع العدد الصحيح من المحاكيات في الإصدار الصحيح ويوقفها عند الضرورة.  وبطبيعة الحال ، اثنين من البرامج النصية باش - أين بدونهم؟ <br><br>  <strong><em>استغرق الأمر خمسة أسابيع لإنشاء بيئة الاختبار الخاصة بنا.</em></strong> <br><br>  نتيجةً لذلك ، كان لكل طلب سحب قائمة فحص دمج شاملة وممنوعة: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  جمعية ARC ؛ </li><li style=";text-align:right;direction:rtl">  اختبارات Junit </li><li style=";text-align:right;direction:rtl">  الوبر. </li><li style=";text-align:right;direction:rtl">  الشيكات ستوديو أندرويد ؛ </li><li style=";text-align:right;direction:rtl">  اختبارات الأجهزة </li><li style=";text-align:right;direction:rtl">  اختبارات لقطة الشاشة. </li></ul><br>  هذا يمنع العديد من الأعطال المحتملة.  من الناحية الفنية ، نجح كل شيء ، لكن المطورين اشتكوا من أن انتظار النتائج طويل جدًا. <br><br>  كم طويل؟  قمنا بتحميل البيانات من Bitbucket و TeamCity إلى نظام التحليل وأدركنا أن <strong>متوسط ​​وقت الانتظار هو 45 دقيقة</strong> .  وهذا هو ، المطور ، فتح طلب سحب ، في المتوسط ​​تتوقع نتائج البناء من 45 دقيقة.  في رأيي ، هذا كثير ، ولا يمكنك العمل بهذه الطريقة. <br><br>  بالطبع ، قررنا تسريع جميع بنينا. <br><br><h2 style=";text-align:right;direction:rtl">  تسريع </h2><br>  إذا رأينا أن البنى تتماشى في كثير من الأحيان ، فإن أول شيء <strong>اشتريناه هو الحديد</strong> - التطوير الشامل هو الأبسط.  توقف Builds عن الوقوف في الطابور ، لكن وقت الانتظار انخفض قليلاً ، لأن بعض عمليات الفحص بحد ذاتها كانت تطاردها لفترة طويلة جدًا. <br><br><h3 style=";text-align:right;direction:rtl">  نزيل الشيكات الطويلة جدا </h3><br>  تكاملنا المستمر يمكن أن يصاب بهذه الأنواع من الأخطاء والمشكلات. <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>لن</strong> .  يمكن أن يحدث CI خطأ في التحويل البرمجي عندما لا يحدث شيء بسبب التغييرات المتعارضة.  كما قلت ، لا يمكن لأحد جمع أي شيء ، والتنمية ترتفع ، والجميع يشعرون بالتوتر. </li><li style=";text-align:right;direction:rtl">  <strong>خطأ في السلوك</strong> .  على سبيل المثال ، عند إنشاء التطبيق ، ولكن عند النقر فوق الزر ، فإنه يتعطل ، أو لا يتم الضغط على الزر على الإطلاق.  هذا أمر سيء لأن مثل هذا الخطأ يمكن أن يصل إلى المستخدم. </li><li style=";text-align:right;direction:rtl">  <strong>علة في التصميم</strong> .  على سبيل المثال ، يتم الضغط على زر ، لكنه نقل 10 بكسل إلى اليسار. </li><li style=";text-align:right;direction:rtl">  <strong>زيادة الدين الفني</strong> . </li></ul><br>  بالنظر إلى هذه القائمة ، أدركنا أن النقطتين الأوليين فقط هما أمران حاسمان.  نحن نريد للقبض على مثل هذه المشاكل أولا وقبل كل شيء.  يتم اكتشاف الأخطاء في التخطيط في مرحلة مراجعة التصميم ثم إصلاحها بسهولة.  يتطلب التعامل مع الديون الفنية عملية وتخطيط منفصلين ، لذلك قررنا عدم التحقق من طلب السحب. <br><br>  بناءً على هذا التصنيف ، هزنا قائمة الشيكات بأكملها.  <strong>شطب Lint</strong> وأرجأ إطلاقه ليلا: فقط بحيث يقدم تقريرا عن عدد المشاكل في المشروع.  اتفقنا على العمل بشكل منفصل مع الدين الفني ، لكننا <strong>رفضنا تمامًا الشيكات Android Studio</strong> .  يبدو أن تطبيق Android Studio لتشغيل Docker مثير للاهتمام ، لكنه يثير الكثير من المتاعب في الدعم.  أي تحديث لإصدارات Android Studio هو معركة ضد الأخطاء الغامضة.  كان من الصعب أيضًا الحفاظ على اختبارات لقطات الشاشة ، لأن المكتبة لم تعمل بثبات شديد ، فقد كانت هناك إيجابيات كاذبة.  <strong>تمت إزالة اختبارات لقطة الشاشة من قائمة الشيكات</strong> . <br><br>  نتيجة لذلك ، غادرنا: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  جمعية ARC ؛ </li><li style=";text-align:right;direction:rtl">  اختبارات Junit </li><li style=";text-align:right;direction:rtl">  اختبارات الأجهزة. </li></ul><br><br><h3 style=";text-align:right;direction:rtl">  التخزين المؤقت عن بعد </h3><br>  بدون عمليات تفتيش ثقيلة ، تحسنت الأمور.  ولكن ليس هناك حد الكمال! <br><br>  تم بالفعل تقسيم طلبنا إلى حوالي 150 وحدة تمهيد.  في العادة ، في هذه الحالة ، تعمل ذاكرة التخزين المؤقت عن بعد Gradle بشكل جيد ، وقررنا تجربتها. <br><br>  ذاكرة التخزين المؤقت عن بُعد Gradle هي خدمة يمكنها إنشاء أدوات تشفير مؤقتة للمهام الفردية في وحدات منفصلة.  Gradle ، بدلاً من تجميع الشفرة فعليًا ، يقرع ذاكرة التخزين المؤقت عن بُعد عبر HTTP ويسأل عما إذا كان شخص ما قد قام بهذه المهمة بالفعل.  إذا كان الأمر كذلك ، فما عليك سوى تنزيل النتيجة. <br><br>  <strong><em>يعد بدء التخزين المؤقت عن بعد Gradle أمرًا سهلاً لأن Gradle يوفر صورة Docker.</em></strong>  <strong><em>تمكنا من القيام بذلك في ثلاث ساعات.</em></strong> <br><br>  كل ما كان مطلوبًا هو إطلاق Docker وتسجيل سطر واحد في المشروع.  ولكن على الرغم من أنه يمكنك تشغيله بسرعة حتى يعمل كل شيء بشكل جيد ، إلا أن الأمر سيستغرق الكثير من الوقت. <br><br>  يوجد أدناه رسم بياني لتفقد ذاكرة التخزين المؤقت. <br><br><img src="https://habrastorage.org/webt/je/0j/an/je0jansmt1nkhgiqhwybnmc2_fs.png"><br><br>  في البداية ، كانت النسبة المئوية للمخططات التي تجاوزت ذاكرة التخزين المؤقت حوالي 65. وبعد ثلاثة أسابيع ، تمكنا من رفع هذه القيمة إلى 20٪.  اتضح أن المهام التي يجمعها تطبيق أندرويد لها تبعيات متعدية غريبة ، بسبب غاب عن Gradle ذاكرة التخزين المؤقت. <br><br>  من خلال ربط ذاكرة التخزين المؤقت ، قمنا بتسريع التجميع بشكل كبير.  لكن بصرف النظر عن التجميع ، لا تزال اختبارات الأجهزة تطارد ، وهي مطاردة لفترة طويلة.  ربما لا يجب مطاردة جميع الاختبارات لكل طلب سحب.  لمعرفة ذلك ، نستخدم تحليل التأثير. <br><br><h3 style=";text-align:right;direction:rtl">  تحليل التأثير </h3><br>  بناءً على طلب السحب ، نبني فرق git ونجد وحدات Gradle المعدلة. <br><br><img src="https://habrastorage.org/webt/yg/xn/ki/ygxnkisjdskb-qkqxoccaywcu5a.png"><br><br>  من المنطقي إجراء اختبارات الأجهزة فقط التي تختبر الوحدات المعدلة وجميع الوحدات التي تعتمد عليها.  لا يوجد أي نقطة في إجراء اختبارات للوحدات النمطية المجاورة: لم يتغير الرمز هناك ، ولا يمكن كسر أي شيء. <br><br>  اختبارات الأجهزة ليست بهذه البساطة ، لأنها يجب أن تكون موجودة في وحدة التطبيق ذات المستوى الأعلى.  قمنا بتطبيق تحليل الكشف عن كود البايت كود لفهم الوحدة التي ينتمي إليها كل اختبار. <br><br>  <strong><em>استغرق الأمر حوالي ثمانية أسابيع لتحديث اختبارات الأجهزة لاختبار فقط الوحدات المعنية.</em></strong> <br><br>  لقد عملت تدابير تسريع التحقق بنجاح.  من 45 دقيقة وصلنا إلى ما يقرب من 15. ربع ساعة في انتظار بناء أمر طبيعي بالفعل. <br><br>  لكن الآن بدأ المطورون في الشكوى من أنه ليس من الواضح لهم أي من البنايات التي يتم إطلاقها ، وأين سيبدو السجل ، ولماذا اللون أحمر ، وأي اختبار سقط ، إلخ. <br><br><img height="487" src="https://habrastorage.org/webt/ez/ev/wl/ezevwlalp50tf9bcret2aff7fte.png"><br><br>  تؤدي مشكلات التعليقات إلى إبطاء عملية التطوير ، لذا حاولنا تقديم أكثر المعلومات المفصلة والمفصلة حول كل العلاقات العامة والبناء.  لقد بدأنا بتعليقات على Bitbucket للعلاقات العامة ، مع الإشارة إلى البناء الذي وقع ولماذا ، وكتب رسائل مستهدفة في Slack.  في النهاية ، قاموا بإنشاء لوحة معلومات لصفحة العلاقات العامة مع قائمة بجميع الإنشاءات التي تعمل حاليًا وحالتها: في السطر ، أو تبدأ ، أو تعطل ، أو نهايات.  يمكنك النقر فوق الإنشاء والوصول إلى سجله. <br><br><img src="https://habrastorage.org/webt/d5/hu/fr/d5hufrypmfupj3g8k4snhrksy9w.png"><br><br>  <strong><em>أمضيت ستة أسابيع على ردود فعل مفصلة.</em></strong> <br><br><h2 style=";text-align:right;direction:rtl">  خطط </h2><br>  نمر إلى آخر التاريخ.  بعد حل مسألة التعليقات ، انتقلنا إلى مستوى جديد - قررنا إنشاء مزرعة خاصة بنا من المحاكيات.  عندما يكون هناك العديد من الاختبارات والمحاكيات ، يصعب إدارتها.  نتيجةً لذلك ، انتقلت جميع برامج المحاكاة لدينا إلى مجموعة k8s مع إدارة مرنة للموارد. <br><br>  بالإضافة إلى ذلك ، هناك خطط أخرى. <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>عودة ينت</strong> (والتحليلات الساكنة الأخرى).  نحن نعمل بالفعل في هذا الاتجاه. </li><li style=";text-align:right;direction:rtl">  قم <strong>بإجراء جميع الاختبارات</strong> الشاملة على مانع العلاقات العامة على جميع إصدارات SDK. </li></ul><br>  لذلك ، تتبعنا تاريخ تطور التكامل المستمر في Avito.  الآن أريد أن أقدم بعض النصائح من وجهة نظر ذوي الخبرة. <br><br><h1 style=";text-align:right;direction:rtl">  نصائح </h1><br>  إذا أمكنني تقديم نصيحة واحدة فقط ، فستكون هذه هي: <br><br><blockquote style=";text-align:right;direction:rtl">  يرجى توخي الحذر مع البرامج النصية قذيفة! </blockquote><br>  باش أداة مرنة وقوية للغاية ، وهي مريحة وسريعة للغاية لكتابة النصوص على ذلك.  لكن معه يمكنك الوقوع في الفخ ، ولسوء الحظ وقعنا فيه. <br><br>  بدأ كل شيء بنصوص بسيطة تم تشغيلها على آلات الإنشاء الخاصة بنا: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env bash ./gradlew assembleDebug</span></span></code> </pre> <br>  ولكن ، كما تعلمون ، كل شيء يتطور ويزداد تعقيدًا بمرور الوقت - فلنشغل نصًا واحدًا من الآخر ، فلننقل بعض المعلمات إلى هناك - في النهاية ، كان عليّ أن أكتب وظيفة تحدد ما هو مستوى تداخل التعشش الذي نحن عليه الآن ، لاستبدال الاقتباسات اللازمة ، بحيث يبدأ كل شيء. <br><br><img src="https://habrastorage.org/webt/rt/o6/vp/rto6vp4hs-ucbefd_3pbzehvx0a.png"><br><br>  يمكنك أن تتخيل العمل الذي ينطوي عليه تطوير هذه النصوص.  أنصحك بعدم الوقوع في هذا الفخ. <br><br>  ما يمكن استبداله؟ <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  أي لغة البرمجة.  تعد الكتابة في <strong>Python أو Kotlin Script</strong> أكثر ملاءمة لأنها برمجة وليست نصوص برمجية. </li><li style=";text-align:right;direction:rtl">  أو <strong>صف</strong> كل منطق <strong>الإنشاء</strong> في شكل <strong>مهام gradle المخصصة لمشروعك</strong> . </li></ul><br>  قررنا اختيار الخيار الثاني ، والآن نقوم بحذف جميع البرامج النصية للباش بشكل منهجي ونكتب الكثير من المراوغات المخصصة للعرض. <br><br>  <strong>نصيحة رقم 2: حافظ على البنية الأساسية الخاصة بك في رمز.</strong> <br><br>  يكون ملائمًا عندما لا يتم تخزين تكوين التكامل المستمر في واجهة Jenkins أو TeamCity UI وما إلى ذلك ، ولكن كملفات نصية مباشرة في مستودع المشروع.  وهذا يعطي قابلية الإصدار.  لن يكون من الصعب استرجاع أو جمع الكود في فرع آخر. <br><br>  يمكن تخزين البرامج النصية في المشروع.  وماذا تفعل مع البيئة؟ <br><br>  <strong>نصيحة رقم 3: عامل الميناء يمكن أن تساعد في البيئة.</strong> <br><br>  بالتأكيد سوف يساعد مطوري Android ، iOS ، لسوء الحظ. <br><br>  هذا مثال على ملف عامل ميناء بسيط يحتوي على jdk و android-sdk: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">FROM openjdk:8 ENV SDK_URL="https://dl.google.com/android/repository/sdk-tools-linux-3859397.zip" \ ANDROID_HOME="/usr/local/android-sdk" \ ANDROID_VERSION=26 \ ANDROID_BUILD_TOOLS_VERSION=26.0.2 # Download Android SDK RUN mkdir "$ANDROID_HOME" .android \ &amp;&amp; cd "$ANDROID_HOME" \ &amp;&amp; curl -o sdk.zip $SDK_URL \ &amp;&amp; unzip sdk.zip \ &amp;&amp; rm sdk.zip \ &amp;&amp; yes | $ANDROID_HOME/tools/bin/sdkmanager --licenses # Install Android Build Tool and Libraries RUN $ANDROID_HOME/tools/bin/sdkmanager --update RUN $ANDROID_HOME/tools/bin/sdkmanager "build-tools;${ANDROID_BUILD_TOOLS_VERSION}" \ "platforms;android-${ANDROID_VERSION}" \ "platform-tools" RUN mkdir /application WORKDIR /application</code> </pre><br>  بعد كتابة ملف عامل الإرساء هذا (سوف أخبرك بسر ، لا يمكنك كتابته ، ولكن سحبه جاهزًا من GitHub) وجمع الصورة ، يمكنك الحصول على جهاز افتراضي يمكنك بناء التطبيق عليه وتشغيل اختبارات Junit. <br><br>  الحجتين الرئيسيتين لماذا هذا منطقي هي التدرجية والتكرار.  باستخدام عامل ميناء ، يمكنك بسرعة جمع عشرة عوامل بناء سيكون لها نفس البيئة تمامًا مثل البيئة القديمة.  هذا يجعل الحياة أسهل لمهندسي CI.  إن عملية دفع android-sdk إلى docker بسيطة للغاية ، حيث تكون المحاكاة أكثر تعقيدًا: يجب عليك التدرب قليلاً (جيدًا ، أو تنزيل المكالمة النهائية مرة أخرى من GitHub). <br><br>  <strong>نصيحة رقم 4: لا تنس أن الشيكات تتم ليس من أجل الشيكات ، ولكن للناس.</strong> <br><br>  تعد التعليقات السريعة والأهم من ذلك مهمة جدًا للمطورين: ما الذي تم كسره ، وما الاختبار الذي وقع ، حيث سجل الإنشاء. <br><br>  <strong>نصيحة رقم 5: كن براغماتية مع التكامل المستمر.</strong> <br><br>  افهم بوضوح أنواع الأخطاء التي تريد منعها ، ومقدار ما ترغب في إنفاقه على الموارد ، والوقت ، ووقت الكمبيوتر.  الشيكات الطويلة جدًا يمكن ، على سبيل المثال ، إعادة جدولتها بين عشية وضحاها.  وأولئك الذين لا يرتكبون أخطاء مهمة للغاية يجب التخلي عنهم تمامًا. <br><br>  <strong>نصيحة رقم 6: استخدام الأدوات الجاهزة.</strong> <br><br>  الآن هناك العديد من الشركات التي توفر سحابة CI. <br><br><img src="https://habrastorage.org/webt/7a/dr/k3/7adrk3z_1xnccybehwal8sfi-pi.png"><br><br>  بالنسبة للفرق الصغيرة ، هذه طريقة جيدة للخروج.  لا تحتاج إلى الحفاظ على أي شيء ، فقط دفع بعض المال ، وجمع طلبك وحتى قيادة اختبارات الأجهزة. <br><br>  <strong>نصيحة رقم 7: في فريق كبير ، تكون الحلول الداخلية أكثر ربحية.</strong> <br><br>  ولكن عاجلاً أم آجلاً ، مع نمو الفريق ، ستصبح حلولًا أكثر ربحية في الشركة.  هناك نقطة واحدة مع هذه القرارات.  في الاقتصاد ، يوجد قانون يتناقص فيه العائد: في أي مشروع ، يتم إعطاء كل تحسين لاحق المزيد والمزيد من الصعوبة ، ويتطلب المزيد والمزيد من الاستثمار. <br><br>  يصف الاقتصاد حياتنا كلها ، بما في ذلك التكامل المستمر.  لقد قمت ببناء جدول عمل لكل مرحلة من مراحل تطوير التكامل المستمر. <br><br><img src="https://habrastorage.org/webt/es/za/8w/esza8woeimanj5auez2iz9js7di.png"><br><br>  يمكن أن نرى أن أي تحسن يتم إعطاء أكثر وأكثر صعوبة.  بالنظر إلى هذا الرسم البياني ، يمكننا أن نفهم أن تطوير التكامل المستمر يجب أن يكون متسقًا مع نمو حجم الفريق.  بالنسبة لفريق يتكون من شخصين ، فإن قضاء 50 يومًا في تطوير مزرعة مقلدة داخلية فكرة جيدة جدًا.  ولكن في الوقت نفسه ، فإن عدم قيام فريق كبير بالتكامل المستمر على الإطلاق هو فكرة سيئة أيضًا ، بسبب مشاكل التكامل وإصلاح الاتصالات وما إلى ذلك.  سوف يستغرق المزيد من الوقت. <br><br>  لقد بدأنا بحقيقة أن الأتمتة مطلوبة لأن الناس غاليون ، فهم مخطئون وكسلون.  لكن الناس أيضا أتمتة.  لذلك ، كل هذه المشاكل نفسها تنطبق على الأتمتة. <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  أتمتة مكلفة.  تذكر جدول العمل. </li><li style=";text-align:right;direction:rtl">  في الأتمتة ، يرتكب الناس أخطاء. </li><li style=";text-align:right;direction:rtl">  الأتمتة في بعض الأحيان كسول للغاية ، لأن كل شيء يعمل هكذا.  لماذا تحسين آخر ، لماذا كل هذا التكامل المستمر؟ </li></ul><br>     :  20%   .     ,      .  ,   , ,    - ,     develop,    . ,           ,    -   . <br><br> <strong> Continuous Integration.   .</strong> <br><br><blockquote style=";text-align:right;direction:rtl"> ,        ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">AppsConf</a>        .            <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> .     22-23   . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar447608/">https://habr.com/ru/post/ar447608/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar447592/index.html">WhatsApp في راحة يدك: أين وكيف يمكنك اكتشاف التحف الجنائية؟</a></li>
<li><a href="../ar447594/index.html">أدوات مخصصة: عندما لا تكون الإشارة كافية</a></li>
<li><a href="../ar447598/index.html">كتابة لعبة بطاقة الذاكرة على سويفت</a></li>
<li><a href="../ar447604/index.html">الأسنان الملساء ، C ++ والرياضيات - كيف ترتبط؟ المحادثة مع محاذاة</a></li>
<li><a href="../ar447606/index.html">CLRium # 5 جامع القمامة: Peter - Sold Out</a></li>
<li><a href="../ar447610/index.html">كيفية السيطرة على البنية التحتية للشبكة الخاصة بك. الفصل الثالث أمن الشبكة. الجزء الثالث</a></li>
<li><a href="../ar447612/index.html">مركز بيانات الفضاء. ترجمة نصية لإطلاق الخادم في الستراتوسفير</a></li>
<li><a href="../ar447614/index.html">لن تكون قادرًا على حل هذه المشكلة في المقابلة</a></li>
<li><a href="../ar447616/index.html">ربط Aquastorozh إلى المنزل الذكي على Z- الموجة</a></li>
<li><a href="../ar447618/index.html">تسربت قاعدة بيانات خدمة دفق Kanopy ما يصل إلى 40 مليون إدخالات سجل حول الأفلام التي شاهدها المستخدمون</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>