<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ° ğŸ˜† ğŸ§ğŸ¾ LINSTORå­˜å‚¨åº“åŠå…¶ä¸OpenNebulaçš„é›†æˆ ğŸ‘©ğŸ¿â€ğŸŒ¾ ğŸ‘§ğŸ¼ ğŸ¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ä¸ä¹…å‰ï¼ŒLINBITå›¢é˜Ÿå±•ç¤ºäº†ä»–ä»¬çš„æ–°SDSè§£å†³æ–¹æ¡ˆ-Linstorã€‚ è¿™æ˜¯ä¸€ä¸ªå®Œå…¨å…è´¹çš„å­˜å‚¨ï¼ŒåŸºäºæˆç†Ÿçš„æŠ€æœ¯ï¼šDRBDï¼ŒLVMï¼ŒZFSã€‚ Linstorç»“åˆäº†ç®€å•æ€§å’Œç²¾å¿ƒè®¾è®¡çš„ä½“ç³»ç»“æ„ï¼Œå¯å®ç°ç¨³å®šæ€§å’Œä»¤äººå°è±¡æ·±åˆ»çš„ç»“æœã€‚ 


 ä»Šå¤©ï¼Œæˆ‘æƒ³å‘æ‚¨è¯¦ç»†ä»‹ç»ä¸€ä¸‹ï¼Œå¹¶å±•ç¤ºå¦‚ä½•ä½¿ç”¨linstor_unï¼ˆå®ƒæ˜¯...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>LINSTORå­˜å‚¨åº“åŠå…¶ä¸OpenNebulaçš„é›†æˆ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451186/"><p><img src="https://habrastorage.org/webt/e-/3z/h-/e-3zh-bbwjnljyazm68edln7muw.png"></p><br><p> ä¸ä¹…å‰ï¼ŒLINBITå›¢é˜Ÿå±•ç¤ºäº†ä»–ä»¬çš„æ–°SDSè§£å†³æ–¹æ¡ˆ-Linstorã€‚ è¿™æ˜¯ä¸€ä¸ªå®Œå…¨å…è´¹çš„å­˜å‚¨ï¼ŒåŸºäºæˆç†Ÿçš„æŠ€æœ¯ï¼šDRBDï¼ŒLVMï¼ŒZFSã€‚  Linstorç»“åˆäº†ç®€å•æ€§å’Œç²¾å¿ƒè®¾è®¡çš„ä½“ç³»ç»“æ„ï¼Œå¯å®ç°ç¨³å®šæ€§å’Œä»¤äººå°è±¡æ·±åˆ»çš„ç»“æœã€‚ </p><br><p> ä»Šå¤©ï¼Œæˆ‘æƒ³å‘æ‚¨è¯¦ç»†ä»‹ç»ä¸€ä¸‹ï¼Œå¹¶å±•ç¤ºå¦‚ä½•ä½¿ç”¨linstor_unï¼ˆå®ƒæ˜¯æˆ‘ä¸“é—¨ä¸ºæ­¤ç›®çš„å¼€å‘çš„æ–°é©±åŠ¨ç¨‹åºï¼‰å°†å…¶ä¸OpenNebulaé›†æˆçš„å®¹æ˜“ç¨‹åº¦ã€‚ </p><br><p>  Linstorä¸OpenNebulaç»“åˆä½¿ç”¨ï¼Œå¯ä»¥æ„å»ºå¿«é€Ÿå¯é çš„äº‘ï¼Œå¹¶å¯ä»¥è½»æ¾åœ°å°†å…¶éƒ¨ç½²åœ¨è‡ªå·±çš„åŸºç¡€æ¶æ„ä¸Šã€‚ </p><a name="habracut"></a><br><h2 id="arhitektura-linstor"> æ—æ–¯ç‰¹å»ºç­‘ </h2><br><p> Linstoræœ¬èº«æ—¢ä¸æ˜¯æ–‡ä»¶ç³»ç»Ÿä¹Ÿä¸æ˜¯å—å­˜å‚¨åº“ï¼› Linstoræ˜¯ä¸€ä¸ªåè°ƒå™¨ï¼Œå®ƒæä¾›ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œè¯¥æŠ½è±¡å±‚å¯è‡ªåŠ¨åœ¨LVMæˆ–ZFSä¸­åˆ›å»ºå·å¹¶ä½¿ç”¨DRBD9å¤åˆ¶å®ƒä»¬ã€‚ </p><br><h5 id="lomaem-stereotipy"> åˆ»æ¿å°è±¡ </h5><br><p> ä½†æ˜¯ï¼Œç­‰ç­‰ï¼ŒDRBDï¼Ÿ  â€œä¸ºä»€ä¹ˆè¦ä½¿å…¶è‡ªåŠ¨åŒ–ï¼Œç”šè‡³å¦‚ä½•å·¥ä½œï¼Ÿâ€ </p><br><p> å›æƒ³ä¸€ä¸‹DRBD8å¹¿å—æ¬¢è¿çš„è¿‡å»ã€‚ å®ƒçš„æ ‡å‡†ç”¨æ³•æ„å‘³ç€ä½¿ç”¨ç›¸åŒçš„LVMåˆ›å»ºä¸€ä¸ªå¤§å—è®¾å¤‡å¹¶å°†å…¶åˆ‡æˆè®¸å¤šå°å—ã€‚ ä¸€ç§mdadm RAID-1ï¼Œä½†å¯ä»¥é€šè¿‡ç½‘ç»œè¿›è¡Œå¤åˆ¶ã€‚ </p><br><p> è¿™ç§æ–¹æ³•å¹¶éæ²¡æœ‰ç¼ºç‚¹ï¼Œå› æ­¤ï¼Œéšç€DRBD9çš„å‡ºç°ï¼Œå­˜å‚¨ç»“æ„çš„åŸç†å·²ç»å‘ç”Ÿäº†å˜åŒ–ï¼Œç°åœ¨ä¸ºæ¯ä¸ªè™šæ‹Ÿæœºåˆ›å»ºäº†ä¸€ä¸ªå•ç‹¬çš„DRBDè®¾å¤‡ã€‚ </p><br><p> é‡‡ç”¨ç‹¬ç«‹å—è®¾å¤‡çš„æ–¹æ³•å¯è®©æ‚¨æ›´å¥½åœ°åˆ©ç”¨ç¾¤é›†ä¸­çš„ç©ºé—´ï¼Œå¹¶ä¸”è¿˜æ·»åŠ äº†è®¸å¤šå…¶ä»–åŠŸèƒ½ã€‚ ä¾‹å¦‚ï¼Œå¯¹äºæ¯ä¸ªæ­¤ç±»è®¾å¤‡ï¼Œæ‚¨å¯ä»¥ç¡®å®šå‰¯æœ¬çš„æ•°é‡ï¼Œå‰¯æœ¬çš„ä½ç½®å’Œå•ç‹¬çš„è®¾ç½®ã€‚ å®ƒä»¬å¾ˆå®¹æ˜“åˆ›å»º/åˆ é™¤ï¼Œåˆ›å»ºå¿«ç…§ï¼Œè°ƒæ•´å¤§å°ï¼Œå¯ç”¨åŠ å¯†ç­‰ç­‰ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒDRBD9è¿˜æ”¯æŒä»²è£ï¼Œä»è€Œé¿å…äº†è£‚è„‘æƒ…å†µã€‚ </p><br><h5 id="resursy-i-bekendy"> èµ„æºå’Œåç«¯ </h5><br><p> åˆ›å»ºä¸€ä¸ªæ–°çš„å—è®¾å¤‡åï¼ŒLinstorå°†æ‰€éœ€æ•°é‡çš„å‰¯æœ¬æ”¾ç½®åœ¨é›†ç¾¤ä¸­çš„ä¸åŒèŠ‚ç‚¹ä¸Šã€‚ æˆ‘ä»¬å°†æ¯ä¸ªè¿™æ ·çš„å‰¯æœ¬ç§°ä¸ºDRBDèµ„æºã€‚ </p><br><p> èµ„æºæœ‰ä¸¤ç§ç±»å‹ï¼š </p><br><ul><li>  <strong>æ•°æ®èµ„æº</strong> -æ˜¯ä½äºLVMæˆ–ZFSæ± ä¸­çš„èŠ‚ç‚¹ä¸Šçš„DRBDè®¾å¤‡ã€‚ <br> ç›®å‰ï¼Œæœ‰å¤šä¸ªåç«¯çš„æ”¯æŒï¼Œå¹¶ä¸”å®ƒä»¬çš„æ•°é‡æ­£åœ¨ä¸æ–­å¢é•¿ã€‚ æ”¯æŒLVMï¼ŒThinLVMå’ŒZFSã€‚ æœ€åä¸¤ä¸ªå…è®¸æ‚¨åˆ›å»ºå’Œä½¿ç”¨å¿«ç…§ã€‚ </li><li>  <strong>æ— ç›˜èµ„æº</strong> -æ˜¯æ— èŠ‚ç‚¹çš„DRBDè®¾å¤‡ï¼Œæ²¡æœ‰åç«¯ï¼Œä½†æ˜¯å…è®¸åƒå¯¹å¾…æ™®é€šå—è®¾å¤‡ä¸€æ ·å¯¹å¾…å®ƒï¼Œæ‰€æœ‰è¯»/å†™æ“ä½œéƒ½å°†é‡å®šå‘åˆ°æ•°æ®èµ„æºã€‚ ä¸æ— ç›˜èµ„æºæœ€æ¥è¿‘çš„ç­‰æ•ˆé¡¹æ˜¯iSCSI LUNã€‚ </li></ul><br><p> æ¯ä¸ªDRBDèµ„æºæœ€å¤šå¯ä»¥æœ‰8ä¸ªå‰¯æœ¬ï¼Œå¹¶ä¸”é»˜è®¤æƒ…å†µä¸‹åªèƒ½æ¿€æ´»å…¶ä¸­ä¸€ä¸ªå‰¯æœ¬-Primaryï¼Œå…¶ä½™æ‰€æœ‰å‰¯æœ¬éƒ½å°†æ˜¯<strong>Secondary</strong> ï¼Œé™¤éæœ‰è‡³å°‘ä¸€ä¸ªPrimaryï¼Œå¦åˆ™å®ƒä»¬çš„ä½¿ç”¨å°†æ˜¯ä¸å¯èƒ½çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬åªä¼šå¤åˆ¶ä½ ä»¬ä¹‹é—´çš„æ•°æ®ã€‚ </p><br><p> å½“å°†DRBDè®¾å¤‡å®‰è£…åˆ°ç³»ç»Ÿä¸­æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å˜ä¸º<strong>Primary</strong> ï¼Œå› æ­¤ï¼Œå³ä½¿åœ¨DRBDæœ¯è¯­ä¸­ï¼Œæ— ç›˜èµ„æºä¹Ÿå¯ä»¥æ˜¯Primaryã€‚ </p><br><h5 id="tak-zachem-nuzhen-linstor"> é‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦Linstorï¼Ÿ </h5><br><p> é€šè¿‡å°†æ‰€æœ‰èµ„æºå¯†é›†å‹ä»»åŠ¡ä¿¡ä»»å†…æ ¸ï¼ŒLinstoræœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¸¸è§„Javaåº”ç”¨ç¨‹åºï¼Œå¯è½»æ¾å®ç°DRBDèµ„æºçš„è‡ªåŠ¨åˆ›å»ºã€‚ <br> æ­¤å¤–ï¼Œç”±ä»–åˆ›å»ºçš„æ¯ä¸ªèµ„æºå°†æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„DRBDç¾¤é›†ï¼Œè¯¥ç¾¤é›†å°†ç‹¬ç«‹å·¥ä½œï¼Œè€Œä¸ç®¡æ§åˆ¶å¹³é¢å’Œå…¶ä»–DRBDèµ„æºçš„çŠ¶æ€å¦‚ä½•ã€‚ </p><br><p>  <strong>Linstorä»…åŒ…å«ä¸¤ä¸ªç»„ä»¶ï¼š</strong> </p><br><ul><li>  <strong>Linstor-controller-</strong>ä¸»æ§åˆ¶å™¨ï¼Œæä¾›ç”¨äºåˆ›å»ºå’Œç®¡ç†èµ„æºçš„APIã€‚ ä»–è¿˜ä¸å«æ˜Ÿé€šä¿¡ï¼Œæ£€æŸ¥å«æ˜Ÿä¸Šçš„å¯ç”¨ç©ºé—´ï¼Œå¹¶å‘é€ä»»åŠ¡ä»¥åˆ›å»ºå’Œåˆ é™¤æ–°èµ„æºã€‚ å®ƒåœ¨å•ä¸ªå®ä¾‹ä¸­å¯åŠ¨ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªæ•°æ®åº“ï¼Œè¯¥æ•°æ®åº“å¯ä»¥æ˜¯å†…éƒ¨ï¼ˆH2ï¼‰æˆ–å¤–éƒ¨ï¼ˆPostgreSQLï¼ŒMySQLï¼ŒMariaDBï¼‰ </li><li>  <strong>å«æ˜ŸLinstor-</strong>å®‰è£…åœ¨æ‰€æœ‰å­˜å‚¨èŠ‚ç‚¹ä¸Šï¼Œä¸ºæ§åˆ¶å™¨æä¾›æœ‰å…³å¯ç”¨ç©ºé—´çš„ä¿¡æ¯ï¼Œè¿˜æ‰§è¡Œä»æ§åˆ¶å™¨æ¥æ”¶çš„ä»»åŠ¡ï¼Œä»¥åœ¨å…¶ä¸Šåˆ›å»ºå’Œåˆ é™¤æ–°å·å’ŒDRBDè®¾å¤‡ã€‚ </li></ul><br><p>  <strong>Linstorå…·æœ‰ä»¥ä¸‹å…³é”®æ¦‚å¿µï¼š</strong> </p><br><ul><li>  <strong>èŠ‚ç‚¹</strong>æ˜¯å°†åœ¨å…¶ä¸Šåˆ›å»ºå’Œä½¿ç”¨DRBDèµ„æºçš„ç‰©ç†æœåŠ¡å™¨ã€‚ </li><li>  <strong>å­˜å‚¨æ± </strong> -åœ¨å°†æ”¾ç½®DRBDèµ„æºçš„èŠ‚ç‚¹ä¸Šåˆ›å»ºçš„LVMæˆ–ZFSæ± ã€‚ ä¹Ÿå¯ä»¥ä½¿ç”¨æ— ç›˜æ± -è¿™æ˜¯ä¸€ä¸ªä»…å¯å®¹çº³æ— ç›˜èµ„æºçš„æ± ã€‚ </li><li>  <strong>èµ„æºå®šä¹‰</strong> -èµ„æºå®šä¹‰æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæè¿°åç§°åŠå…¶æ‰€æœ‰å±æ€§çš„åŸå‹ã€‚ </li><li>  <strong>éŸ³é‡å®šä¹‰</strong> - <strong>éŸ³é‡å®šä¹‰</strong> ã€‚ æ¯ä¸ªèµ„æºå¯ä»¥åŒ…å«å¤šä¸ªå·ï¼Œæ¯ä¸ªå·å¿…é¡»æœ‰ä¸€ä¸ªå¤§å°ã€‚ </li><li>  <strong>èµ„æº</strong> -åˆ›å»ºçš„å—è®¾å¤‡å®ä¾‹ï¼Œæ¯ä¸ªèµ„æºå¿…é¡»ä½äºç‰¹å®šèŠ‚ç‚¹ä¸Šå’ŒæŸä¸ªå­˜å‚¨æ± ä¸­ã€‚ </li></ul><br><h2 id="ustanovka-linstor"> å®‰è£…Linstor </h2><br><p> æˆ‘å»ºè®®ä½¿ç”¨Ubuntuä½œä¸ºç³»ç»Ÿï¼Œå› ä¸º æœ‰ä¸€ä¸ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç°æˆçš„PPA</a> ï¼š </p><br><pre><code class="bash hljs">add-apt-repository ppa:linbit/linbit-drbd9-stack apt-get update</code> </pre> <br><p> æˆ–Debianï¼Œå¯ä»¥ä»Proxmoxçš„å®˜æ–¹å­˜å‚¨åº“ä¸­å®‰è£…Linstorï¼š </p><br><pre> <code class="bash hljs">wget -O- https://packages.linbit.com/package-signing-pubkey.asc | apt-key add - PVERS=5 &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"deb http://packages.linbit.com/proxmox/ proxmox-</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$PVERS</span></span></span><span class="hljs-string"> drbd-9.0"</span></span> &gt; \ /etc/apt/sources.list.d/linbit.list apt-get update</code> </pre> <br><h5 id="controller"> æ§åˆ¶è€… </h5><br><p> è¿™é‡Œçš„ä¸€åˆ‡éƒ½å¾ˆç®€å•ï¼š </p><br><pre> <code class="bash hljs">apt-get install linstor-controller linstor-client systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> linstor-controller systemctl start linstor-controller</code> </pre> <br><h5 id="storage-nody"> å‚¨å­˜èŠ‚ç‚¹ </h5><br><p> å½“å‰ï¼Œæ ‘å†…<strong>DRBD8</strong>å†…æ ¸æ¨¡å—æ˜¯Linuxå†…æ ¸ä¸­æä¾›çš„ï¼Œä¸å¹¸çš„æ˜¯å®ƒä¸é€‚åˆæˆ‘ä»¬ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…<strong>DRBD9</strong> ï¼š </p><br><pre> <code class="bash hljs">apt-get install drbd-dkms</code> </pre> <br><p> å¦‚å®è·µæ‰€ç¤ºï¼Œå¤§å¤šæ•°å›°éš¾çš„äº§ç”Ÿæ°æ°æ˜¯å› ä¸ºå°†DRBD8æ¨¡å—è€Œä¸æ˜¯DRBD9åŠ è½½åˆ°äº†ç³»ç»Ÿä¸­ã€‚ å¹¸è¿çš„æ˜¯ï¼Œé€šè¿‡æ‰§è¡Œä»¥ä¸‹æ“ä½œå¾ˆå®¹æ˜“éªŒè¯ï¼š </p><br><pre> <code class="bash hljs">modprobe drbd cat /proc/drbd</code> </pre> <br><p> å¦‚æœçœ‹åˆ°<strong>ç‰ˆæœ¬ï¼š9-</strong>åˆ™ä¸€åˆ‡æ­£å¸¸ï¼Œå¦‚æœçœ‹åˆ°<strong>ç‰ˆæœ¬ï¼š</strong> <strong>8-</strong>åˆ™å‡ºé—®é¢˜äº†ï¼Œæ‚¨éœ€è¦é‡‡å–å…¶ä»–æ­¥éª¤ä»¥æ‰¾å‡ºåŸå› ã€‚ </p><br><p> ç°åœ¨å®‰è£…<strong>linstor-satellite</strong>å’Œ<strong>drbd-utils</strong> ï¼š </p><br><pre> <code class="bash hljs">apt-get install linstor-satellite drbd-utils systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> linstor-satellite systemctl start linstor-satellite</code> </pre> <br><h2 id="sozdanie-klastera"> é›†ç¾¤åˆ›å»º </h2><br><p>  <strong>å­˜å‚¨æ± å’ŒèŠ‚ç‚¹</strong> </p><br><p> æˆ‘ä»¬å°†æŠŠ<strong>ThinLVM</strong>ä½œä¸º<strong>åç«¯</strong> ï¼Œå› ä¸º å®ƒæ˜¯æœ€ç®€å•çš„ï¼Œå¹¶ä¸”æ”¯æŒå¿«ç…§ã€‚ <br> å¦‚æœå°šæœªå®‰è£…<strong>lvm2</strong> ï¼Œè¯·å®‰è£…å®ƒï¼Œè®©æˆ‘ä»¬åœ¨æ‰€æœ‰å­˜å‚¨èŠ‚ç‚¹ä¸Šåˆ›å»ºä¸€ä¸ªThinLVMæ± ï¼š </p><br><pre> <code class="bash hljs">sudo vgcreate drbdpool /dev/sdb sudo lvcreate -L 800G -T drbdpool/thinpool</code> </pre> <br><p> æ‰€æœ‰å…¶ä»–æ“ä½œéƒ½å¯ä»¥ç›´æ¥åœ¨æ§åˆ¶å™¨ä¸Šæ‰§è¡Œï¼š </p><br><p> æ·»åŠ æˆ‘ä»¬çš„èŠ‚ç‚¹ï¼š </p><br><pre> <code class="bash hljs">linstor node create node1 127.0.0.11 linstor node create node2 127.0.0.12 linstor node create node3 127.0.0.13</code> </pre> <br><p> åˆ›å»ºå­˜å‚¨æ± ï¼š </p><br><pre> <code class="bash hljs">linstor storage-pool create lvmthin node1 data drbdpool/thinpool linstor storage-pool create lvmthin node2 data drbdpool/thinpool linstor storage-pool create lvmthin node3 data drbdpool/thinpool</code> </pre> <br><p> ç°åœ¨æ£€æŸ¥åˆ›å»ºçš„æ± ï¼š </p><br><pre> <code class="bash hljs">linstor storage-pool list</code> </pre> <br><p> å¦‚æœä¸€åˆ‡éƒ½æ­£ç¡®å®Œæˆï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹å†…å®¹çš„å†…å®¹ï¼š </p><br><pre>  + ------------------------------------------------- -------------------------------------------------- ---- +
 | å‚¨å­˜æ± | èŠ‚ç‚¹| é©±åŠ¨ç¨‹åº æ± å| å…è´¹å®¹é‡| æ€»å®¹é‡| æ”¯æŒå¿«ç…§|
 | ------------------------------------------------- -------------------------------------------------- ---- |
 | æ•°æ® èŠ‚ç‚¹1 |  LVM_THIN |  drbdpool / Thinpool |  64 GiB |  64 GiB | çœŸå®|
 | æ•°æ®  node2 |  LVM_THIN |  drbdpool / Thinpool |  64 GiB |  64 GiB | çœŸå®|
 | æ•°æ® èŠ‚ç‚¹3 |  LVM_THIN |  drbdpool / Thinpool |  64 GiB |  64 GiB | çœŸå®|
 + ------------------------------------------------- -------------------------------------------------- ---- + </pre><br><p>  <strong>DRBDèµ„æº</strong> </p><br><p> ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°è¯•åˆ›å»ºæ–°çš„DRBDèµ„æºï¼š </p><br><pre> <code class="bash hljs">linstor resource-definition create myres linstor volume-definition create myres 1G linstor resource create myres --auto-place 2</code> </pre> <br><p> è®©æˆ‘ä»¬æ£€æŸ¥åˆ›å»ºçš„èµ„æºï¼š </p><br><pre> <code class="bash hljs">linstor volume list</code> </pre> <br><pre>  + ------------------------------------------------- -------------------------------------------------- -+
 | èŠ‚ç‚¹| èµ„æº| å‚¨å­˜æ± |  VolumeNr |  MinorNr | è®¾å¤‡å| å·²åˆ†é… ä½¿ç”¨ä¸­| å·|
 | ------------------------------------------------- -------------------------------------------------- --- |
 | èŠ‚ç‚¹1 | è¿ˆå°”æ–¯| æ•°æ®  0 |  1084 |  / dev / drbd1084 |  52 KiB | æœªä½¿ç”¨ æ›´æ–°æ—¥æœŸ|
 |  node2 | è¿ˆå°”æ–¯| æ•°æ®  0 |  1084 |  / dev / drbd1084 |  52 KiB | æœªä½¿ç”¨ æ›´æ–°æ—¥æœŸ|
 + ------------------------------------------------- -------------------------------------------------- -+ </pre><br><p> å¤ªå¥½äº†ï¼  -æˆ‘ä»¬çœ‹åˆ°èµ„æºæ˜¯åœ¨å‰ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šåˆ›å»ºçš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°è¯•åœ¨ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šåˆ›å»ºæ— ç›˜èµ„æºï¼š </p><br><pre> <code class="bash hljs">linstor resource create --diskless node3 myres</code> </pre> <br><p> åœ¨èŠ‚ç‚¹ä¸Šï¼Œæ‚¨æ€»æ˜¯ä¼šå‘ç°æ­¤è®¾å¤‡ä¸º<code>/dev/drbd1084</code>æˆ–<code>/dev/drbd/by-res/myres/0</code> </p><br><p> è¿™æ˜¯Linstorçš„å·¥ä½œæ–¹å¼ï¼Œæ‚¨å¯ä»¥ä»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®˜æ–¹æ–‡æ¡£ä¸­</a>è·å–æ›´å¤šä¿¡æ¯ã€‚ </p><br><p> ç°åœ¨æˆ‘å°†è®¨è®ºå¦‚ä½•å°†å…¶ä¸OpenNebulaé›†æˆ </p><br><h2 id="nastroyka-opennebula"> é…ç½®OpenNebula </h2><br><p> æˆ‘å°†ä¸æ·±å…¥è®¾ç½®OpenNebulaçš„è¿‡ç¨‹ï¼Œå› ä¸º æ‰€æœ‰æ­¥éª¤å‡åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®˜æ–¹æ–‡æ¡£</a>ä¸­è¿›è¡Œäº†è¯¦ç»†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¯´æ˜</a> ï¼Œæˆ‘å»ºè®®æ‚¨å‚è€ƒè¯¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡æ¡£</a> ã€‚æˆ‘ä»…å‘æ‚¨ä»‹ç»OpenNebulaä¸Linstorçš„é›†æˆã€‚ </p><br><h5 id="linstor_un">  linstor_un </h5><br><p> ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ç¼–å†™äº†è‡ªå·±çš„é©±åŠ¨ç¨‹åº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">linstor_un</a> ï¼Œç›®å‰è¯¥é©±åŠ¨ç¨‹åºå¯ä»¥ä½œä¸ºæ’ä»¶ä½¿ç”¨ï¼Œå¿…é¡»å•ç‹¬å®‰è£…ã€‚ </p><br><p> æ‰€æœ‰å®‰è£…å‡åœ¨å‰ç«¯OpenNebulaèŠ‚ç‚¹ä¸Šè¿›è¡Œï¼Œä¸éœ€è¦åœ¨è®¡ç®—èŠ‚ç‚¹ä¸Šæ‰§è¡Œå…¶ä»–æ“ä½œã€‚ </p><br><p> é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿æ‹¥æœ‰<strong>jq</strong>å’Œ<strong>linstor-client</strong> ï¼š </p><br><pre> <code class="plaintext hljs">apt-get install jq linstor-client</code> </pre> <br><p>  <code>linstor node list</code>å‘½ä»¤åº”åˆ—å‡ºèŠ‚ç‚¹ã€‚ å¿…é¡»å°†OpenNebulaçš„æ‰€æœ‰è®¡ç®—èŠ‚ç‚¹æ·»åŠ åˆ°Linstorç¾¤é›†ä¸­ã€‚ </p><br><p> ä¸‹è½½å¹¶å®‰è£…æ’ä»¶ï¼š </p><br><pre> <code class="bash hljs">curl -L https://github.com/OpenNebula/addon-linstor_un/archive/master.tar.gz | tar -xzvf - -C /tmp mv /tmp/addon-linstor_un-master/vmm/kvm/* /var/lib/one/remotes/vmm/kvm/ mkdir -p /var/lib/one/remotes/etc/datastore/linstor_un mv /tmp/addon-linstor_un-master/datastore/linstor_un/linstor_un.conf /var/lib/one/remotes/etc/datastore/linstor_un/linstor_un.conf mv /tmp/addon-linstor_un-master/datastore/linstor_un /var/lib/one/remotes/datastore/linstor_un mv /tmp/addon-linstor_un-master/tm/linstor_un /var/lib/one/remotes/tm/linstor_un rm -rf /tmp/addon-linstor_un-master</code> </pre> <br><p> ç°åœ¨æˆ‘ä»¬éœ€è¦å°†å…¶æ·»åŠ åˆ°OpenNebulaé…ç½®ä¸­ï¼Œä¸ºæ­¤æˆ‘ä»¬æ‰§è¡Œ<strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„</a></strong>æè¿°çš„ç®€å•æ­¥éª¤ã€‚ </p><br><p> ç„¶åé‡æ–°å¯åŠ¨OpenNebulaï¼š </p><br><pre> <code class="bash hljs">systemctl restart opennebula</code> </pre> <br><p> å¹¶æ·»åŠ æˆ‘ä»¬çš„æ•°æ®å­˜å‚¨ç³»ç»Ÿï¼š </p><br><pre> <code class="bash hljs">cat &gt; system-ds.conf &lt;&lt;EOT NAME=<span class="hljs-string"><span class="hljs-string">"linstor-system"</span></span> TYPE=<span class="hljs-string"><span class="hljs-string">"SYSTEM_DS"</span></span> STORAGE_POOL=<span class="hljs-string"><span class="hljs-string">"data"</span></span> AUTO_PLACE=<span class="hljs-string"><span class="hljs-string">"2"</span></span> CLONE_MODE=<span class="hljs-string"><span class="hljs-string">"snapshot"</span></span> CHECKPOINT_AUTO_PLACE=<span class="hljs-string"><span class="hljs-string">"1"</span></span> BRIDGE_LIST=<span class="hljs-string"><span class="hljs-string">"node1 node2 node3"</span></span> TM_MAD=<span class="hljs-string"><span class="hljs-string">"linstor_un"</span></span> EOT onedatastore create system-ds.conf</code> </pre> <br><p> å’Œå›¾åƒå­˜å‚¨ï¼š </p><br><pre> <code class="bash hljs">cat &gt; images-ds.conf &lt;&lt;EOT NAME=<span class="hljs-string"><span class="hljs-string">"linstor-images"</span></span> TYPE=<span class="hljs-string"><span class="hljs-string">"IMAGE_DS"</span></span> STORAGE_POOL=<span class="hljs-string"><span class="hljs-string">"data"</span></span> AUTO_PLACE=<span class="hljs-string"><span class="hljs-string">"2"</span></span> BRIDGE_LIST=<span class="hljs-string"><span class="hljs-string">"node1 node2 node3"</span></span> DISK_TYPE=<span class="hljs-string"><span class="hljs-string">"BLOCK"</span></span> DS_MAD=<span class="hljs-string"><span class="hljs-string">"linstor_un"</span></span> TM_MAD=<span class="hljs-string"><span class="hljs-string">"linstor_un"</span></span> EOT onedatastore create images-ds.conf</code> </pre> <br><ul><li>  <code>AUTO_PLACE</code>å‚æ•°æ˜¾ç¤ºå°†ä¸ºOpenNebulaä¸­çš„æ¯ä¸ªæ–°æ˜ åƒåˆ›å»ºçš„æ•°æ®å‰¯æœ¬çš„æ•°é‡ã€‚ </li><li>  <code>CLONE_MODE</code>å‚æ•°æŒ‡ç¤ºåœ¨åˆ›å»ºæ–°çš„è™šæ‹Ÿæœºæ—¶å¦‚ä½•å…‹éš†æ˜ åƒï¼Œ <code>snapshot</code> -å°†åˆ›å»ºæ˜ åƒçš„å¿«ç…§å¹¶ä»å¿«ç…§éƒ¨ç½²è™šæ‹Ÿæœºï¼Œ <code>copy</code> -å°†ä¸ºæ¯ä¸ªè™šæ‹Ÿæœºåˆ¶ä½œæ˜ åƒçš„å®Œæ•´å‰¯æœ¬ã€‚ </li><li>  <code>BRIDGE_LIST</code>å»ºè®®æŒ‡å®šæ‰€æœ‰å°†ç”¨äºæ‰§è¡Œå›¾åƒå…‹éš†æ“ä½œçš„èŠ‚ç‚¹ã€‚ </li></ul><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">README</a>é¡¹ç›®ä¸­æä¾›äº†å—æ”¯æŒå‚æ•°çš„å®Œæ•´åˆ—è¡¨ã€‚ </p><br><p> è®¾ç½®å®Œæˆåï¼Œç°åœ¨æ‚¨å¯ä»¥ä»å®˜æ–¹çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">OpenNebula Marketplace</a>ä¸‹è½½ä¸€äº›è®¾å¤‡ï¼Œå¹¶ä»ä¸­åˆ›å»ºè™šæ‹Ÿæœºã€‚ </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é“¾æ¥åˆ°é¡¹ç›®</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN451186/">https://habr.com/ru/post/zh-CN451186/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN451176/index.html">æ¥è‡ªOpenStreetMap 458ä¸–ç•Œçš„æ–°é—»ï¼ˆ04/23/2019-04/09/2019ï¼‰</a></li>
<li><a href="../zh-CN451178/index.html">ä¹˜å‘˜é¾™é™è½ä¼ç€é™†æµ‹è¯•</a></li>
<li><a href="../zh-CN451180/index.html">PCBæ›¿ä»£äº†ä¸¤ä¸ªç›´çº¿ç”µæœº</a></li>
<li><a href="../zh-CN451182/index.html">Cæ•°ç»„çš„å¤§å°å¦‚ä½•æˆä¸ºåº“äºŒè¿›åˆ¶æ¥å£çš„ä¸€éƒ¨åˆ†</a></li>
<li><a href="../zh-CN451184/index.html">è“è‰²èµ·æºè“è‰²æœˆäº®è®¡åˆ’ï¼š2024å¹´ä¹‹å‰çš„æœˆçƒäºº</a></li>
<li><a href="../zh-CN451188/index.html">Sberbankæˆ–é‚£é‡Œç„¶åå›æ¥</a></li>
<li><a href="../zh-CN451196/index.html">å®¢æˆ·å’Œè‡ªç”±èŒä¸šè€…èµ„æ–™çš„åˆ†ç¦»</a></li>
<li><a href="../zh-CN451198/index.html">å¢å¼ºç°å®å’Œè™šæ‹Ÿç°å®åœ¨NBAä¸­çš„ä½œç”¨</a></li>
<li><a href="../zh-CN451200/index.html">è®©æˆ‘ä»¬é€šè¿‡ä½¿ç”¨DNS-01æŒ‘æˆ˜å’ŒAWSè¿›è¡ŒåŠ å¯†è‡ªåŠ¨è·å–SSLè¯ä¹¦</a></li>
<li><a href="../zh-CN451204/index.html">å…è´¹æ–‡æœ¬ç¼–è¾‘å™¨è¿›è¡Œåä½œ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>