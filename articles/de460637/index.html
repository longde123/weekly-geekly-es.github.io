<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÉüèΩ üö∂üèø üíÇ Lichtsteuerung auf ZigBee üßëüèª‚Äçü§ù‚Äçüßëüèª üìø üôä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Freunde! Heute m√∂chte ich Ihnen √ºber eine interessante Entwicklung eines Fernsteuerungssystems f√ºr die Beleuchtung berichten. 



 Ein modernes ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lichtsteuerung auf ZigBee</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460637/">  Hallo Freunde!  Heute m√∂chte ich Ihnen √ºber eine interessante Entwicklung eines Fernsteuerungssystems f√ºr die Beleuchtung berichten. <br><br><img src="https://habrastorage.org/webt/ro/yx/l6/royxl62-z2oqpfn6hwt5izou3_y.jpeg" alt="Bild"><br><br>  Ein modernes Haus ist eine gro√üe Anzahl von Kabeln, um zumindest irgendwie die Anzahl ihrer Funkger√§te zu reduzieren und zu rationalisieren.  In Wirklichkeit ist ein solches System nicht neu, aber im Kontext eines begrenzten Budgets hat es sich voll und ganz gerechtfertigt. <br><br>  Mit Blick auf die Zukunft m√∂chte ich sofort das Funktionsdiagramm des Steuerungssystems zeigen. <br><br><img src="https://habrastorage.org/webt/fh/ey/gj/fheygj8s-fn_phg3oqnva6ajrye.jpeg" alt="Bild"><br>  <i>Abb.</i>  <i>1</i> <br><br>  Ich interessiere mich f√ºr jemanden unter Katze. <br><a name="habracut"></a><br>  Die logische Frage ist, warum dies alles ben√∂tigt wird.  Die Verwendung eines drahtlosen Lichtsteuersystems bietet: <br><br><ul><li>  Reduzieren Sie die Anzahl der Dr√§hte, die von jedem Schalter zur Anschlussdose im Raum f√ºhren. </li><li>  M√∂glichkeit der Implementierung von Durchgangsschaltern. </li><li>  Die Flexibilit√§t, Lasten von jedem Schalter aus zu steuern, sowie die Verwendung von normalerweise geschlossenen, normalerweise ge√∂ffneten Tasten. </li><li>  Die M√∂glichkeit, eine beliebige Zeitverz√∂gerung f√ºr den Ein- / Ausschalten des Betriebs zu implementieren. </li></ul><br>  Die technische Aufgabe bestand am Anfang nur aus Worten und sah sehr schlammig und unverst√§ndlich aus.  Der Punkt ist, dass in einem zweist√∂ckigen Cottage mit einer Fl√§che von 208 m¬≤ das Ein- und Ausschalten der Innenbeleuchtung erforderlich ist. Das System sollte mit 220 V betrieben werden und zwischen 21 und 23 St√ºck geschaltet werden.  Lasten (Lampen) mit einer Leistung von nicht mehr als 200W.  Zum Zeitpunkt der ersten Inspektion des Objekts sah alles so aus <br><br><img src="https://habrastorage.org/webt/cz/bi/_b/czbi_bdenvipzshelqjbmh0himq.jpeg"><br>  <i>Abb.</i>  <i>2. Der Hauptteil der Kommunikation wird in den Boden gelegt, dann wird alles mit Betonestrich gegossen</i> <br><br><img src="https://habrastorage.org/webt/sh/h-/7m/shh-7mxsspyefbi-nlti3wisn8m.jpeg"><br>  <i>Abb.</i>  <i>3. Platz f√ºr die Installation eines Verteilerschranks im zweiten Stock</i> <br><br>  Die starke Empfehlung war, so wenig Dr√§hte wie m√∂glich zu verwenden.  Im Idealfall gelangen nur diejenigen, die bereits in Boden, W√§nden und Decke verlegt sind, vom Installationsort der Schalttafel zu jeder Gl√ºhbirne.  Aufgrund der elektromagnetischen Vertr√§glichkeit aller Ger√§te im Haus wurde die Verwendung von normalem WLAN nicht empfohlen, da  Es gibt unz√§hlige solcher Ger√§te, und der Kunde hat aus diesem Grund eine Modeerscheinung im Kopf, dass die Ger√§te im Haus ihr eigenes Leben f√ºhren und der mitgelieferte Slow Cooker das Licht im Bad oder in der Toilette beeinflusst.  Als erstes habe ich das Blockdiagramm skizziert, da ich mir die L√∂sung f√ºr dieses Problem vorstelle.  Auf fig_4 diese Option. <br><br><img src="https://habrastorage.org/webt/80/wk/x2/80wkx2kcoelxunryvcivzi8n7e8.jpeg"><br>  <i>Abb.</i>  <i>4. Funktionsdiagramm der Lichtsteuerung.</i> <br><br>  Grundlage war das Funkmodul CC2530 von Texas Instruments, das die ZiegBee-Technologie unterst√ºtzt und mit IAR-Studio 5.5 ganz einfach in C ++ programmiert wird.  Das direkte Schalten von Lasten erfolgt √ºber die WB-MR6-Relaismodule (Wirenboard). Ich habe dieses Element gew√§hlt, da in einem kompakten Geh√§use auf einer Din-Rail sechs Relais mit unabh√§ngigen Kan√§len auf der 16A-Steuerung installiert sind und alle Merkmale des Schaltens von Allzweck-Leistungslasten in t ber√ºcksichtigt werden. h  mit hohen Anlaufstr√∂men: Steuerung von LED-Lampen, Gl√ºhlampen, Schaltnetzteilen.  Au√üerdem ist jeder Relaiskontakt durch einen Varistor gegen √úberspannung gesch√ºtzt.  Sechs dieser Module mussten installiert werden, um eine bestimmte Anzahl von Lasten ruhig verwalten zu k√∂nnen.  Alle WB-MR6 sind √ºber die ModBus-Schnittstelle in einem einzigen Netzwerk verbunden.  Jedes Relaismodul ist auf eine Adresse eingestellt, die dem Anschlussplan entspricht, und das gesamte System mit Eingangsbl√∂cken, Sicherungen und Leistungsschaltern ist in zwei Schalttafeln SHCHMP2-1 500x400x450 ziemlich fest montiert.  F√ºr die kompakte Platzierung der 46 Eingangskabel 3x1,5 (einadriges Kupfer) war es erforderlich, die traditionelle Position der Din-Schienen auf vertikal zu √§ndern. <br><br><img src="https://habrastorage.org/webt/xv/fx/mn/xvfxmnadqjpt8l0wy8jtzxmaopo.jpeg"><br>  <i>Abb.</i>  <i>5. Schalttafel mit Platzierung der Lichtsteuerger√§te.</i> <br><br>  Es sollte beachtet werden, dass sich die unglaublich n√ºtzliche Funktion des WB-MR6 als die F√§higkeit herausstellte, Relaisausg√§nge durch einfaches Anschlie√üen normal ge√∂ffneter Tasten an den unteren Klemmenblock zu steuern. Dies ist das, was Sie f√ºr einen tempor√§ren Schaltplan ben√∂tigen.  T.K.  Die ModBus-Steuerung erschien f√ºnf Monate sp√§ter nach der Montage und Installation der Schalttafeln.  W√§hrend dieser Zeit wurden alle Kabel, die zu jeder Last f√ºhren, vollst√§ndig getestet und nummeriert.  Mit der Steuerlogik des Schalters - der Gl√ºhbirne in Abb. 6 - wurde ein detailliertes Schaltschema erstellt. <br><br><img src="https://habrastorage.org/webt/59/ca/lj/59caljsa6bx9fv1bkzm6x9cgz2g.jpeg"><br>  <i>Abb.</i>  <i>6. Beleuchtungssteuerungsschema und Lastplatzierungs- und Abfragemodule.</i> <br><br>  Was die Umfragemodule betrifft, kann ich Folgendes sagen: Das in Abb. 7 gezeigte Funktionsdiagramm hat sich als recht funktionell erwiesen.  Es war praktisch nicht n√∂tig, etwas zu wiederholen. Mit dem RF-Modul ss2530 k√∂nnen Sie beliebigen Eing√§ngen beliebige Ausg√§nge zuweisen.  Die einzige Ausnahme ist UART (Pin20-Tx, Pin21-Rx). Der gr√∂√üte Teil der Liste der Elemente wurde auf Ali gekauft. Leiterplatten wurden auf Resonanz bestellt. Ich habe alle zwanzig Teile mit meinen H√§nden gel√∂tet. Es ist schwer, es hat eine Woche gedauert, es hat nicht sofort geklappt m√ºssen.  Aber wertvolle Erfahrungen bei der Installation von SMD-Komponenten gesammelt. <br><br><img src="https://habrastorage.org/webt/vv/a3/d6/vva3d686ixu6dxa3rh-fxmemqig.jpeg"><br>  <i>Abb.</i>  <i>7. Funktionsplan des Button Polling Moduls</i> <br><br>  Der Prozess des Debuggens und des Vollbetriebs des Systems dauerte etwas mehr als drei Monate.  Der erste Schritt nach dem Zusammenbau der Rice_8-Karten, der √úberpr√ºfung der Stromversorgung und der Verbindung zum Programmierer bestand darin, ein Tastenabrufprogramm zu schreiben und Steuerbefehle f√ºr die WB-MR6-Relaismodule √ºber den ModBus-Bus zu generieren. <br><br><img src="https://habrastorage.org/webt/zj/qq/cg/zjqqcgo-dewjpy6dpqvydmmjpu4.jpeg"><br>  <i>Abb.</i>  <i>8. Tastenabfragemodul</i> <br><br>  Es stellte sich ziemlich schnell und einfach heraus.  Ein Tastenabfragemodul ist bisher √ºber RS485 ohne Netzwerkschnittstelle mit einem Relaismodul verbunden.  Sofort gelang es, den erzielten Erfolg auf das Objekt pic_9 anzuwenden, wurde Twisted Pair UTP von den Kn√∂pfen im Schlafzimmer im Voraus gelegt.  Mit der Befestigung der Module bin ich nicht sehr raffiniert geworden, selbstklebende Pads und Kunststoffklammern helfen sehr. <br><br><img src="https://habrastorage.org/webt/qq/2m/f2/qq2mf2-bsvhphquu_bb_bikcajw.jpeg"><br>  <i>Abb.</i>  <i>9. Anh√§ngen von Tastenabfragemodulen.</i> <br><br>  Anschlie√üend f√ºgte er programmgesteuert die Adresse jedes Moduls hinzu, die mit dem DIP-Schalter und der entsprechenden Schaltkarte, der Master / Slave-Betriebsart und der √úbertragung von Befehlen per Funk eingestellt wurde.  Ein Schritt nach vorne war ernst und daher gab es viele Schwierigkeiten beim Debuggen.  Am schwerwiegendsten ist die √úbertragung von Informationen √ºber die gedr√ºckte Taste an das an den Modbus-Bus angeschlossene Master-Modul, sobald das Zig-Bee-Daten√ºbertragungsprotokoll aktiviert wurde. Alles stellte sich als viel komplizierter heraus.  F√ºr diejenigen, die bis hierher gelesen haben, kann ich sagen, dass das Problem darin bestand, dass die Timer im Prozessorkern unvorhersehbar funktionieren, genauer gesagt im IAR-Compiler. Sie m√ºssen seine Einstellungen beim Aufrufen der Zeitz√§hlprozedur st√§ndig angeben.  Um einen Weg zur L√∂sung dieses Problems zu finden, wurden √úberwachungs- und Steuerfunktionen f√ºr per Funk gesendete Daten hinzugef√ºgt.  Die Steuerung des Tastendrucks im Servicemodus wurde sofort im Hyperterminal des Computers angezeigt, der √ºber den RS485-USB-Adapter mit dem Abfragemodul verbunden ist.  Ein weiteres ernstes Problem bei der Organisation des Lichtsteuerungsnetzwerks war die unzureichende Reichweite der Funkschnittstelle.  Mehr oder weniger, mit Zuversicht, wechselte alles nur innerhalb der Grenzen der Tabelle, auf der das Layout zusammengestellt wurde.  Dies ist eine Folge der Energiesparmodus-Funktion SS2530, bei der standardm√§√üig die Funktion zur Reduzierung der Strahlungsleistung verwendet wurde. Nachdem die Verbindung hergestellt wurde, wei√ü ich nicht, warum dies geschehen ist, aber dies wurde √ºber jtag im schrittweisen Debugging-Modus herausgefunden.  Nach dem Ausschalten dieses Modus begann das Netzwerk innerhalb einer Etage in der H√ºtte zu arbeiten. Tats√§chlich wurden die Ein / Aus-Lichtbefehle vom Server nur von den Abfragemodulen verarbeitet, die sich in einem Radius von 12 bis 14 m befanden.  Vorausgesetzt, es gab keine W√§nde.  Um dieses Problem zu l√∂sen, haben wir uns daf√ºr entschieden, das CC2530-Modul durch eine Planarantenne durch ein Modul mit einer externen Antenne (mit IPEX-Anschluss) zu ersetzen. Dies gilt umso mehr, als es sehr erfolgreich war, drei Module in der E18-MSI-IPX-Version sowie eine Antenne und ein Kabel in einem von St. Petersburg zu kaufen Online-Shops.  All dies wurde schnell verl√∂tet, die Ecken f√ºr die Montage der Antennen wurden hergestellt und mit den Adapterplatten Abb. 10 verschraubt. <br><br><img src="https://habrastorage.org/webt/es/20/je/es20jewxb7gxff5iefdsr9uzmbu.jpeg"><br>  <i>Abb.</i>  <i>10. Verwendung einer externen Antenne</i> <br><br>  Das Ergebnis eines solchen Upgrades war f√ºr mich sehr r√§tselhaft - da sich die Reichweite nicht wesentlich ge√§ndert hat, w√ºrde ich sogar sagen, dass sie leicht abgenommen hat.  Ich begann nach einem Ausweg aus dieser Situation zu suchen, um die Algorithmen des Programms zu optimieren. Die anf√§nglichen Einstellungen des SS2530 mussten das Datenblatt Auto und die Foren zu diesem Thema erneut lesen.  Ziel war es, jedes Modul im Netzwerk als Repeater zu verwenden, zumal eine solche Funktion standardm√§√üig aktiviert ist und von jedem Ger√§t unterst√ºtzt wird, auf dem das Zig-Bee-Protokoll ausgef√ºhrt wird.  Aber in meinem Fall war es nicht offensichtlich.  Aus diesem Grund habe ich beschlossen, ein zus√§tzliches Modul in das System einzuf√ºhren, bei dem eine eindeutige Firmware aktiviert wird, indem nur Pin_6 am DIP-Schalter ausgel√∂st wird.  Er musste, war an der Decke des ersten Stocks und sendete nur die empfangenen Befehle, d.h.  ein Signalverst√§rker sein. <br><br>  Ich werde sofort sagen, dass dies eine Sackgasse war.  Bei der Umsetzung dieser Idee habe ich jedoch versehentlich die Parameter der ‚Äûschwarzen‚Äú Antenne gemessen, die ich zusammen mit dem CC2530 und dem Kabel in einem Online-Shop verkauft habe.  Der Netzwerkanalysator zeigte ein SWR von 1,9 bei einer Frequenz von 2,4 GHz - Kommentare sind nicht erforderlich, Sie m√ºssen Ihre eigene Antenne herstellen.  Eine Anfrage an die Suchmaschine gibt sofort die richtige Antwort, die Kleeantenne und detaillierte Herstellungsanweisungen. <br><br><img src="https://habrastorage.org/webt/8f/fo/2s/8ffo2soyaf4iikrhcw75ymoxwwi.jpeg"><br>  <i>Abb.</i>  <i>11. Antenne und Ger√§t zur Herstellung.</i> <br><br>  Buchst√§blich am Abend habe ich drei Teile dieser Antennen hergestellt und deren SWR auf nicht schlechter als 1,2 √ºberpr√ºft.  Ich kann nicht √ºber die anderen Eigenschaften, Strahlungsmuster und Verst√§rkung sagen.  Tatsache ist jedoch, dass sich die Reichweite des zuverl√§ssigen Empfangs und Sendens von Befehlen verdoppelt hat.  Abb_12 <br><br><img src="https://habrastorage.org/webt/ye/ba/bd/yebabdzcf80hy4yoaoilnapxxz4.jpeg"><br>  <i>Abb.</i>  <i>12. Antennenmessung</i> <br><br>  Infolgedessen gelang es uns, auf allen 12 in der H√ºtte installierten Abfragemodulen einen normalen Serversignalempfang zu erreichen.  T.O.  Die Anforderung an TK ist p√ºnktlich vollst√§ndig erf√ºllt, ich habe die Fristen praktisch eingehalten.  Der Kunde ist zufrieden. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de460637/">https://habr.com/ru/post/de460637/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de460627/index.html">vGPU - Verwendung kann nicht ignoriert werden</a></li>
<li><a href="../de460629/index.html">Die Wahrscheinlichkeit, dass 2 Bergleute dieselbe Welt haben</a></li>
<li><a href="../de460631/index.html">In 80 Tagen um das Abzeichen: auf der anderen Seite OFFZONE</a></li>
<li><a href="../de460633/index.html">Implementierungsdetails f√ºr RSTP und Proprietary Extended Ring Redundancy</a></li>
<li><a href="../de460635/index.html">CLRium # 6: Parallelit√§t und Parallelit√§t. Zwei Tage: vom Prozessor zum Async / Warten</a></li>
<li><a href="../de460641/index.html">YouTokenToMe: Ein Tool zur schnellen Tokenisierung von Text aus dem VKontakte-Team</a></li>
<li><a href="../de460643/index.html">Gleichm√§√üige Verteilung der Punkte auf einer Kugel</a></li>
<li><a href="../de460645/index.html">Gutes tun, schlechtes tun: Schlechten Code mit Go schreiben, Teil 1</a></li>
<li><a href="../de460647/index.html">L√∂sen eines Jobs mit pwnable.kr 05 - Passcode. Schreiben Sie die Prozedur-Link-Tabelle √ºber die Sicherheitsanf√§lligkeit bez√ºglich Formatzeichenfolgen neu</a></li>
<li><a href="../de460651/index.html">Treffen der Society of Anonymous Testers: TMS, √úberwachung, √úberwachung der Bewertung der Suchqualit√§t und native iOS-Tests</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>