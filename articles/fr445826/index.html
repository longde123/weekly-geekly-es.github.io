<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😖 😚 🚯 On marche sagement autour de la ville - 2: on fait le tour de la ville en rond en utilisant l'algorithme génétique 🎦 👨🏽‍🚀 👨‍👩‍👧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans un dernier article, j'ai décrit un algorithme qui vous permet de construire des itinéraires de marche plus intéressants (par opposition à plus co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>On marche sagement autour de la ville - 2: on fait le tour de la ville en rond en utilisant l'algorithme génétique</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445826/"><p>  Dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dernier article,</a> j'ai décrit un algorithme qui vous permet de construire des itinéraires de marche plus intéressants (par opposition à plus courts, comme toutes les marques Yandex-Google) entre deux points.  L'algorithme a chargé des vues, des parcs et d'autres objets agréables et intéressants pour les piétons de l'Open Street Map et a tracé un itinéraire à travers eux.  En conséquence, le chemin pourrait être 10 à 20% plus long, mais beaucoup plus pittoresque et intéressant. </p><br><p><img src="https://habrastorage.org/webt/7v/ye/5s/7vye5swlpwzjmg1we1zfwnncqws.png"><br>  <em>Photos de la ville - Alex 'Florstein' Fedorov</em> </p><br><p>  Dans les commentaires, beaucoup ont écrit qu'en plus des itinéraires entre deux points, ils seraient intéressés à construire des itinéraires circulaires qui commenceraient et se termineraient au même point et s'inscriraient dans un délai donné.  Par exemple, si vous avez deux heures de train ou pour rencontrer des amis, vous n'aurez pas le temps d'aller quelque part loin pendant cette période, mais il est tout à fait possible de faire une promenade et de voir la beauté à proximité. </p><br><p>  Après un certain nombre d'expériences, j'ai composé un algorithme génétique qui construit de très bonnes routes (pour moi) dans cette situation.  Sous cat description du principe de fonctionnement et quelques exemples. <a name="habracut"></a></p><br><p>  Ainsi, les utilisateurs veulent pouvoir faire un petit tour des environs et revenir au point de départ dans le délai spécifié (généralement 1-2 heures).  Il s'est avéré que ce type de promenade est très demandé.  Par exemple, l'article "Schémas de déplacement des touristes dans une destination" décrit l'étude des traces de 250 touristes à Hong Kong, tandis que 40% des touristes ont commencé à explorer la ville à partir d'un itinéraire circulaire dans un rayon de 500 mètres de l'hôtel.  Cependant, souvent, les gens traînent, ne sachant pas ce qui est intéressant peut être vu à proximité. </p><br><p>  La tâche est compliquée si ce n'est pas dans le centre touristique (où que vous alliez - vous trouverez quelque chose d'intéressant partout), mais quelque part à la périphérie où vous devez chercher des sites touristiques. </p><br><h3 id="radius-i-otbor-dostoprimechatelnostey">  Rayon et sélection d'attractions </h3><br><p>  Pour construire un itinéraire, nous devons d'abord sélectionner les attractions que nous voulons visiter.  Et pour cela, vous devez déterminer la zone de leur recherche autour du point de départ.  Si l'utilisateur définit le temps de marche maximum en M minutes, le point le plus éloigné auquel vous pouvez atteindre et avoir le temps de revenir est le point à distance (V * M / 2), où V est la vitesse du piéton. </p><br><p>  La vitesse moyenne préférée d'un piéton peut être considérée comme 1,4 mètre par seconde.  Cependant, lors de visites touristiques, une personne va un peu plus lentement, car elle consacre plus de temps à une visite.  J'ai construit des itinéraires autour de la ville et les ai parcourus, en comparant le moment de la promenade avec ce que l'application avait prédit.  En conséquence, il s'est avéré que ma vitesse de marche moyenne était d'environ 20% inférieure, c'est-à-dire  environ 1,1 m / s.  Comme je m'arrêtais périodiquement pour prendre des photos, consultez la carte, parfois je traversais à nouveau la route pour choisir le meilleur angle ou acheter des glaces. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/40b/6db/87c/40b6db87c8de70b0018f7c4d457a6eb3.jpg" alt="image"><br>  <em>J'ai mené des expériences dans des quartiers inconnus de la ville, en utilisant mon algorithme, vous pouvez trouver toutes sortes de choses intéressantes dont je n'avais jamais entendu parler auparavant.</em>  <em>Par exemple, un monument à la première brochure.</em> </p><br><p>  Le choix d'un point d'intérêt à une distance maximale conduira à la construction d'un itinéraire circulaire dégénéré.  Comme le piéton n'aura plus le temps de sortir du chemin le plus court en ligne droite, il ne pourra visiter que cette attraction, y aller et revenir le long de la même rue, comme indiqué par la flèche rouge. </p><br><p><img src="https://habrastorage.org/webt/d9/rg/8m/d9rg8madwzn71bz22hl9bea1iou.png" alt="Ici, nous pouvons soit aller au parc plus loin, soit visiter plusieurs points à la fois plus près"><br>  <em>Ici, nous pouvons soit aller au parc plus loin, soit visiter plusieurs points à la fois plus près</em> </p><br><p>  Mais cette situation contredit l'idée de circuits circulaires intéressants, car en fait nous n'avons vu qu'une seule rue et un seul objet, mais je veux voir le plus.  Par conséquent, selon les résultats des expériences, un rayon égal au tiers de la distance maximale a été choisi.  Avec ce rayon de recherche, le piéton aura suffisamment de temps pour atteindre le point d'intérêt le plus éloigné le long du rayon, puis, si nécessaire, parcourra la même distance le long de l'accord à la recherche d'autres objets intéressants, puis reviendra dans le temps. </p><br><h3 id="problemy-lobovogo-podhoda">  Problèmes d'approche frontale </h3><br><p>  D'accord, nous avons dressé une liste des attractions candidates.  Reste maintenant à choisir lequel d'entre eux et dans quel ordre nous voulons inspecter.  Très probablement, nous n'aurons pas le temps de les visiter, nous devons donc choisir le sous-ensemble le plus intéressant d'entre eux. </p><br><p>  Tout d'abord, j'ai essayé de formuler et de construire un algorithme séquentiel simple.  Cependant, j'ai rapidement rencontré un certain nombre de problèmes. </p><br><p>  Si nous considérons la situation de la figure ci-dessus, il n'est pas clair par où commencer la construction de l'itinéraire.  Si le parc est l'attraction la plus importante mais la plus éloignée, nous commencerons par une version dégénérée, dont nous avons parlé plus tôt. </p><br><p>  La prochaine solution évidente consiste à regrouper les sites et à essayer de trouver le chemin vers le cluster le plus rentable, puis à l'intérieur.  Mais là encore, tout n'est pas clair: à partir de quel cluster commencer, quelle direction prendre.  Vous pouvez toujours tomber dans le piège du type où nous nous sommes trompés et avons couru dans le «désert» - une zone sans vues que nous n'avons pas assez de temps pour parcourir et revenir au point de départ. </p><br><p>  À un moment donné, il est devenu clair pour moi que je faisais pratiquement le travail de l'algorithme génétique: je dessine différentes routes sur la carte et j'essaie de déterminer à quel point je les aimerais personnellement. </p><br><h3 id="geneticheskiy-algoritm">  Algorithme génétique </h3><br><p>  Après avoir reçu une liste numérotée d'attractions, l'algorithme doit choisir un sous-ensemble ordonné, qui constituera la base de l'itinéraire circulaire.  L'itinéraire final dans ce cas est l'un des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">emplacements de</a> nombreuses attractions clés (nous ne voulons pas de répétitions et ne sommes pas tenus d'utiliser tous les objets possibles). </p><br><p>  Connaissant la formule du nombre de placements de n à k, nous pouvons estimer le nombre possible d'options.  Si nous considérons l'itinéraire d'une heure autour de la place du Palais à Saint-Pétersbourg, il y aura 54 candidats pour des attractions clés après filtrage et regroupement dans un rayon de 1320 mètres (défini comme décrit ci-dessus). </p><br><p><img src="https://habrastorage.org/webt/2v/i5/ow/2vi5owwajn0z61qp3eafx7b9jwy.png"><br>  <em>Bouillie infernale d'un tas de vues au centre, sortie de débogage des zones de visibilité calculées selon l'algorithme de l'article précédent</em> </p><br><p>  Le principe de sélection et de tri est décrit dans un article précédent, et nous supprimons en outre les objets ayant un intérêt inférieur à 3 (pour des objets aussi mineurs, il est peu probable qu'une personne soit prête à aller loin, sauf s'il n'y a rien d'autre à proximité).  Ainsi, le nombre possible d'itinéraires peut être calculé par la formule du nombre d'emplacements de 54 à 5, il est de 379501200. Pour un itinéraire de 2 heures, dans le rayon duquel 151 points d'intérêt tombent déjà, ce nombre sera égal à 73423236600. Eh bien, c'est trop pour une simple recherche. </p><br><h4 id="hromosomy-i-geneticheskie-operatory">  Chromosomes et opérateurs génétiques </h4><br><p>  Les chromosomes dans ce cas sont une ligne dans laquelle chaque élément est le numéro de l'attraction clé correspondante.  Pour de telles tâches dans lesquelles les chromosomes sont des permutations ou des arrangements, il existe des variantes optimisées spéciales d'opérateurs génétiques.  Ces opérateurs conservent la propriété du chromosome pour rester une permutation ou un placement de l'ensemble initial d'éléments. </p><br><ul><li>  Le crossover partiellement cartographié (PMX) est utilisé pour le croisement. </li><li>  Pour la mutation, l'échange de places de deux gènes aléatoires (Swap Mutator) est utilisé. </li></ul><br><p>  Une description du fonctionnement de ces opérateurs avec des exemples peut être trouvée, par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dans l'ouvrage</a> "Algorithmes génétiques pour le problème du voyageur de commerce: une revue des représentations et des opérateurs". </p><br><h4 id="fitnes-funkciya">  Fonction fitness </h4><br><p>  La fonction fitness doit prendre en compte les facteurs suivants pour construire un itinéraire circulaire intéressant: </p><br><ol><li>  L'intérêt total de toutes les attractions clés visitées doit être aussi grand que possible. </li><li>  Le temps de trajet total doit être aussi proche que possible de celui spécifié par l'utilisateur, l'itinéraire ne doit être ni beaucoup plus long ni beaucoup plus court.  Les itinéraires courts ne sont autorisés que lorsqu'il n'y a pas suffisamment d'attractions à proximité. </li><li>  L'itinéraire ne doit pas se croiser.  Pour chaque auto-intersection, nous ajoutons des pourcentages de pénalité à la valeur totale de la fonction. </li><li>  La forme de l'itinéraire doit être proche du cercle, elle doit capturer la plus grande zone possible de la ville et éviter les cas dégénérés.  Pour ce faire, nous avons mis dans la fonction le rapport de l'aire de la figure décrite par l'itinéraire à l'aire du cercle dans lequel les vues ont été recherchées. </li></ol><br><p>  Voici un exemple d'un bon aller-retour.  Il traverse deux parcs et ne visite jamais le même endroit deux fois </p><br><p><img src="https://habrastorage.org/webt/1e/8d/zj/1e8dzjfdf9elzvwgjmrturtta3k.jpeg" alt="Bon itinéraire"></p><br><p>  Voici un exemple d'un itinéraire clairement infructueux.  Il contient des branches sans issue, où le piéton devra revenir en arrière le long du chemin examiné, et des auto-intersections.  Aux intersections, le temps est généralement perdu en vain pour réexaminer des sections déjà vues de la ville. </p><br><p><img src="https://habrastorage.org/webt/zq/ut/sc/zqutscgqnaputqgahe7d3f0feka.png"></p><br><p>  La mauvaise route a en fait été obtenue par la génétique, dans laquelle les points 3 et 4 ont été désactivés pour la fonction fitness (amendes pour auto-franchissement et pour une petite zone) </p><br><h3 id="nyuansy">  Nuances </h3><br><p>  Pendant les tests, quelques nuances supplémentaires sont apparues. </p><br><h4 id="prevyshenie-limita-vremeni">  Délai dépassé </h4><br><p>  Lors des travaux de génétique, nous comptons la longueur de l'itinéraire le long de lignes droites entre des points.  Et après avoir sélectionné des objets pour la communication en utilisant l'algorithme génétique, nous recherchons le chemin entre eux en utilisant l'algorithme de l'article précédent.  Dans ce cas, le chemin peut devenir plus long et ramper hors du temps.  Après tout, dans la ville, le chemin le plus court le long de la rue peut être plusieurs fois plus long qu'une ligne droite. </p><br><p>  En moyenne, la différence est généralement d'environ 10 à 20% et nous l'intégrons dans la fonction fitness (c'est-à-dire que la génétique recherche une route avec une marge de temps, qui est ensuite consommée lors de la pose d'une route détaillée).  Parfois, cela ne suffit pas - vous devez recalculer à nouveau l'itinéraire.  Nous avons de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tels endroits</a> dans les villes où la différence entre les itinéraires «comme un oiseau» et «comme un piéton» est de kilomètres. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/7db/7f2/bbc/7db7f2bbc139de84050ebf84b33b7913.jpg" alt="image"></p><br><p>  Entre les points de 50 mètres en ligne droite, mais un kilomètre et demi le long des trottoirs et des passages contournant. </p><br><p>  Cependant, tout de même, l'algorithme dépasse parfois le temps défini par l'utilisateur, mais ici, tout le monde peut décider lui-même s'il a 10-15 minutes supplémentaires ou s'il devra terminer la marche plus tôt. </p><br><h4 id="veneciya">  Venise </h4><br><p>  Lorsque l'algorithme était prêt, j'ai décidé d'ajouter les meilleures villes touristiques d'Europe pour le plaisir.  Cela s'est avéré intéressant: les villes sont différentes partout, les fonctionnalités de la cartographie dans OSM aussi, par conséquent, j'ai dû constamment terminer quelque chose. </p><br><p>  Plus précisément, la recherche d'itinéraires circulaires s'est interrompue à Venise.  Comme il s'agit d'un exemple unique d'une ville avec des zones indépendantes - les îles sont séparées par le Grand Canal, à travers lequel il n'y a pas de ponts, la traversée n'est possible que par ferry. </p><br><p><img src="https://habrastorage.org/webt/3s/lw/kq/3slwkqxpkhzj4dbhb184dyshjzy.png"></p><br><p>  En conséquence, l'algorithme a sélectionné une partie des objets d'un côté du détroit, une partie de l'autre, puis n'a pas pu trouver un chemin terrestre entre eux et est tombé.  J'ai dû ajouter un contrôle sur l'accessibilité de toutes les attractions depuis le point de départ. </p><br><h4 id="inogda-vse-taki-prihoditsya-vozvraschatsya-toy-zhe-dorogoy">  Parfois, vous devez toujours revenir de la même manière </h4><br><p>  Dans l'exemple avec le parc ci-dessus, il y a une partie de l'itinéraire où vous devez revenir en arrière de la même manière - c'est une petite péninsule sur laquelle se dresse un monument avec un avion.  Le seul chemin mène à cette péninsule, et il faudra y revenir.  De tels remboursements ne peuvent donc pas être totalement interdits.  L'algorithme pour cela augmente le poids de tous les bords qui ont déjà été parcourus, réduisant la probabilité d'un retour le long d'eux, mais rend cela encore possible. </p><br><p>  Bien que parfois cela fonctionne toujours mal.  Par exemple, ils se plaignent de la cathédrale principale de Kaliningrad.  Il est situé sur une île au milieu de la rivière par laquelle passe le pont.  De ce pont, il y a une descente et un chemin vers la cathédrale, apparemment l'algorithme augmente trop le poids de ce seul chemin, ce qui rend le retour sur celui-ci peu rentable.  En conséquence, il ne mène presque jamais à la cathédrale, bien que ce soit l'une des principales attractions de la ville.  Cela nécessite encore une sorte de raffinement. </p><br><h3 id="rezultaty">  Résultats </h3><br><p>  L'algorithme génétique est un peu imprévisible, il est donc parfois bogué et dessine d'étranges zigzags.  Mais en général, je suis satisfait du résultat.  Ce qui est particulièrement agréable, l'algorithme fonctionne non seulement dans le centre touristique (où ce n'est pas un problème pour s'amuser), mais aussi à la périphérie de la ville.  Où, souvent, sans indices, trouver quelque chose d'intéressant est très difficile. </p><br><p><img src="https://habrastorage.org/webt/4f/fj/8p/4ffj8p19g48zihh3eubkvzusuga.png"><br>  <em>Même dans les sacs de couchage du sud-ouest de Saint-Pétersbourg, vous pouvez trouver suffisamment de monuments pour une promenade de deux heures</em> </p><br><p>  Vous pouvez essayer l'algorithme vous-même dans l'une des 77 villes prises en charge sur notre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site Web Sight Safari</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dans notre application Android</a> (oui, nous l'avons finalement terminé). </p><br><p>  Il est particulièrement intéressant de voir comment l'algorithme fonctionnera dans les villes avec un terrain et des élévations complexes.  Nous avons ajouté la prise en charge de l'analyse d'élévation à la bibliothèque de sondeurs Graphopper, mais nous ne pouvons pas vérifier comment cela devrait être - Peter est une ville trop plate. </p><br><p>  En général, essayez, écrivez des avis, les itinéraires sont-ils correctement construits.  Vous pouvez immédiatement demander l'ajout de nouvelles villes. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr445826/">https://habr.com/ru/post/fr445826/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr445814/index.html">Comment un robot de livraison a changé les habitudes culinaires des étudiants américains</a></li>
<li><a href="../fr445816/index.html">Comment nous avons vu le rendu du serveur et ce qui en est ressorti</a></li>
<li><a href="../fr445820/index.html">MVCC-3. Versions en ligne</a></li>
<li><a href="../fr445822/index.html">Pourquoi Jaop? Pourquoi raquette?</a></li>
<li><a href="../fr445824/index.html">Génération de code dans Dart. Partie 1. Bases</a></li>
<li><a href="../fr445828/index.html">Spectre solaire chinois</a></li>
<li><a href="../fr445832/index.html">Rayonnement: le tueur invisible et ses filles ou un peu sur le radon</a></li>
<li><a href="../fr445834/index.html">Développer les compétences d'utilisation du regroupement et de la visualisation des données en Python</a></li>
<li><a href="../fr445838/index.html">Robotique pour les enfants: yeux de robot</a></li>
<li><a href="../fr445844/index.html">GitLab 11.9 publié avec des règles de détection de secrets et de résolution de demandes de marges multiples</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>