<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äçü§ù‚Äçüë®üèº üëÉüèø üë©üèø‚Äçüç≥ (in) Guerre finie üë©üèª‚Äçüè≠ üòÅ üî∫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nous avons un probl√®me. Le probl√®me avec les tests. Le probl√®me avec les tests des composants React, et c'est assez fondamental. Il s'agit de la diff√©...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>(in) Guerre finie</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436692/"><p><img src="https://habrastorage.org/webt/4w/m4/cc/4wm4ccdyq2tqs2giqspeys3e9sa.jpeg" alt="infitite war"></p><br><p> Nous avons un probl√®me.  Le probl√®me avec les tests.  Le probl√®me avec les tests des composants React, et c'est assez fondamental.  Il s'agit de la diff√©rence entre les <code>unit testing</code> et <code>integration testing</code> .  Il s'agit de la diff√©rence entre ce que nous appelons les tests unitaires et ce que nous appelons les tests d'int√©gration, la taille et la port√©e. </p><br><p>  Il ne s'agit pas de se tester, mais de l'architecture des composants.  √Ä propos de la diff√©rence entre les <strong>composants de</strong> test, les biblioth√®ques autonomes et les <strong>applications</strong> finales. </p><br><p>  Tout le monde sait comment tester des composants simples (ils sont simples), sait probablement comment tester des applications (E2E).  Comment tester des choses <em>finies</em> et <em>infinies</em> ... </p><a name="habracut"></a><br><h2 id="define-the-problem">  D√©finissez le probl√®me </h2><br><p>  Il existe 2 fa√ßons diff√©rentes de tester le composant React - <code>shallow</code> et tout le reste, y compris le <code>mount</code> , la <code>react-testing-library</code> <code>webdriver</code> , le <code>webdriver</code> , etc.  Seul <code>shallow</code> est sp√©cial - les autres se comportent de la m√™me mani√®re. </p><br><p>  Et cette diff√©rence concerne <em>la taille et la port√©e</em> - ce qui serait test√©, et juste partiellement <em>comment</em> . </p><br><p>  En bref - <code>shallow</code> enregistrera uniquement les appels √† React.createElement, mais sans ex√©cuter d'effets secondaires, y compris le rendu des √©l√©ments DOM - c'est un effet secondaire (alg√©brique) de React.createElement. </p><br><p>  Toute autre commande ex√©cutera le code que vous avez fourni, chaque effet secondaire √©tant √©galement ex√©cut√©.  Comme ce serait en r√©alit√©, et c'est le but. </p><br><p>  Et <strong>le probl√®me</strong> est le suivant: <code>you can NOT run each and every side effect</code> . </p><br><h3 id="why-not">  Pourquoi pas? </h3><br><p>  Puret√© fonctionnelle?  Puret√© et immuabilit√© - les vaches sacr√©es d'aujourd'hui.  Et vous en abattez un.  Les axiomes des tests unitaires - aucun effet secondaire, isolement, moquerie, tout sous contr√¥le. </p><br><ul><li><p>  Mais ce n'est <em>pas un probl√®me</em> pour ... <code>dumb components</code> .  Ils sont stupides, ne contiennent que la couche de pr√©sentation, mais pas les "effets secondaires". </p><br></li><li><p>  Mais c'est <em>un probl√®me</em> pour les <code>Containers</code> .  Tant qu'ils ne sont pas stupides, contiennent tout ce qu'ils veulent et enti√®rement sur les effets secondaires.  Ils sont le probl√®me! </p><br></li></ul><br><p>  Probablement, si nous d√©finissons les r√®gles de "The Right Component", nous pourrions facilement tester - cela nous guidera et nous aidera. </p><br><blockquote>  TRDL: le composant fini </blockquote><br><h2 id="smart-and-dumb-components">  Composants intelligents et stupides </h2><br><p>  Selon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dan Abramov, les</a> composants de pr√©sentation d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> sont: </p><br><ul><li>  Sont pr√©occup√©s par l'apparence des choses. </li><li>  Peut contenir √† la fois des composants de pr√©sentation et de conteneur <code>**</code> int√©rieur, et poss√®de g√©n√©ralement un balisage DOM et des styles qui leur sont propres. </li><li>  Autorisez souvent le confinement via this.props.children. </li><li>  N'ayez aucune d√©pendance vis-√†-vis du reste de l'application, comme les actions Flux ou les magasins. </li><li>  Ne sp√©cifiez pas comment les donn√©es sont charg√©es ou mut√©es. </li><li>  Recevez des donn√©es et des rappels exclusivement via des accessoires. </li><li>  Ils ont rarement leur propre √©tat (lorsqu'ils le font, c'est l'√©tat de l'interface utilisateur plut√¥t que les donn√©es). </li><li>  Sont √©crits en tant que composants fonctionnels √† moins qu'ils n'aient besoin de crochets d'√©tat, de cycle de vie ou d'optimisation des performances. </li><li>  Exemples: Page, Sidebar, Story, UserInfo, List. </li><li>  .... </li><li>  Et les conteneurs ne sont que des fournisseurs de donn√©es / accessoires pour ces composants. </li></ul><br><p>  Selon les origines: <strong>Dans l'application id√©ale ...</strong> <strong><br></strong>  <strong>Les conteneurs sont l'Arbre.</strong>  <strong>Les composants sont des feuilles d'arbre.</strong> </p><br><h4 id="find-the-black-cat-in-the-dark-room">  Trouvez le chat noir dans la pi√®ce sombre </h4><br><p>  La sauce secr√®te ici, un changement que nous devons modifier dans cette d√©finition, est cach√©e √† l'int√©rieur <em>"Peut contenir √† la fois des composants de pr√©sentation et des conteneurs <code>**</code> "</em> , permettez-moi de citer l'article original: </p><br><blockquote>  Dans une version ant√©rieure de cet article, j'ai affirm√© que les composants de pr√©sentation ne devraient contenir que d'autres composants de pr√©sentation.  Je ne pense plus que ce soit le cas.  Qu'un composant soit un composant de pr√©sentation ou un conteneur est son d√©tail d'impl√©mentation.  Vous devriez pouvoir remplacer un composant de pr√©sentation par un conteneur sans modifier aucun des sites d'appel.  Par cons√©quent, les composants de pr√©sentation et de conteneur peuvent contenir tr√®s bien d'autres composants de pr√©sentation ou de conteneur. </blockquote><p>  D'accord, mais qu'en est-il de la r√®gle, qui rend l'unit√© de composants de pr√©sentation testable - <em>¬´N'a pas de d√©pendances sur le reste de l'application¬ª</em> ? </p><br><p>  Malheureusement, en incluant des conteneurs dans les composants de pr√©sentation, vous rendez les seconds <strong>infinis</strong> et injectez des d√©pendances dans le reste de l'application. </p><br><p>  Ce n'est probablement pas quelque chose que vous √©tiez cens√© faire.  Donc, je n'ai pas d'autre choix, mais pour rendre le composant stupide fini: </p><br><p>  <strong>LES COMPOSANTS DE PR√âSENTATION NE DOIVENT CONTENIR QUE D'AUTRES COMPOSANTS DE PR√âSENTATION</strong> </p><br><p>  Et la seule question que vous devriez poser (en examinant votre base de code actuelle): <em>comment?</em>  : tableflip:?! </p><br><p>  Aujourd'hui, les composants et les conteneurs de pr√©sentation ne sont pas seulement enchev√™tr√©s, mais parfois simplement non extraits en tant qu'entit√©s ¬´pures¬ª (bonjour GraphQL). </p><br><h4 id="solution-1---di">  Solution 1 - DI </h4><br><p>  La solution 1 est simple - ne contient pas de conteneurs imbriqu√©s dans le composant stupide - contient des <code>slots</code> .  Acceptez simplement le "contenu" (enfants), comme accessoires, et cela r√©soudrait le probl√®me: </p><br><ul><li>  vous pouvez tester un composant stupide sans "le reste de votre application" </li><li>  vous pouvez tester l'int√©gration avec le test smoke / integration / e2e, pas les tests. </li></ul><br><pre> <code class="plaintext hljs">// Test me with mount, with "slots emty". const PageChrome = ({children, aside}) =&gt; ( &lt;section&gt; &lt;aside&gt;{aside}&lt;/aside&gt; {children} &lt;/section&gt; ); // test me with shallow, or real integration test const PageChromeContainer = () =&gt; ( &lt;PageChrome aside={&lt;ASideContainer /&gt;}&gt; &lt;Page /&gt; &lt;/PageChrome&gt; );</code> </pre> <br><p>  Approuv√© par Dan lui-m√™me: <br>  {% twitter 1021850499618955272%} </p><br><p>  DI (Dependecy Injection et Dependency Inversion), probablement, est une technique la plus r√©utilisable ici, capable de vous rendre la vie beaucoup plus facile. </p><br><blockquote>  Pointez ici - Les composants stupides sont stupides! </blockquote><br><h4 id="solution-2---boundaries">  Solution 2 - Limites </h4><br><p>  Il s'agit d'une solution assez d√©clarative, et pourrait √©tendre la <code>Solution 1</code> - il suffit de d√©clarer tous les points d' <em>extension</em> .  Enveloppez-les simplement avec ... </p><br><pre> <code class="plaintext hljs">const Boundary = ({children}) =&gt; ( process.env.NODE_ENV === 'test' ? null : children // or `jest.mock` ); const PageChrome = () =&gt; ( &lt;section&gt; &lt;aside&gt;&lt;Boundary&gt;&lt;ASideContainer /&gt;&lt;/Boundary&gt;&lt;/aside&gt; &lt;Boundary&gt;&lt;Page /&gt;&lt;/Boundary&gt; &lt;/section&gt; );</code> </pre> <br><p>  Ensuite, vous pouvez d√©sactiver, juste z√©ro, la <code>Boundary</code> pour r√©duire la port√©e du composant et la rendre <em>finie</em> . </p><br><blockquote>  Pointez ici - La limite est au niveau de la composante Dumb.  Le composant stupide contr√¥le √† quel point il est stupide. </blockquote><br><h3 id="solution-3---tier">  Solution 3 - Niveau </h3><br><p>  Est la m√™me que la solution 2, mais avec une fronti√®re plus intelligente, capable de se moquer de la <em>couche</em> ou du <em>niveau</em> , ou tout ce que vous dites: </p><br><pre> <code class="plaintext hljs">const checkTier = tier =&gt; tier === currentTier; const withTier = tier =&gt; WrapperComponent =&gt; (props) =&gt; ( (process.env.NODE_ENV !== 'test' || checkTier(tier)) &amp;&amp; &lt;WrapperComponent{...props} /&gt; ); const PageChrome = () =&gt; ( &lt;section&gt; &lt;aside&gt;&lt;ASideContainer /&gt;&lt;/aside&gt; &lt;Page /&gt; &lt;/section&gt; ); const ASideContainer = withTier('UI')(...) const Page = withTier('Page')(...) const PageChromeContainer = withTier('UI')(PageChrome);</code> </pre> <br><blockquote>  M√™me si cela est presque similaire √† l'exemple Boundary - le composant Dumb est Dumb et les conteneurs contr√¥lent la visibilit√© des autres conteneurs. </blockquote><br><h4 id="solution-4---separate-concerns">  Solution 4 - Pr√©occupations distinctes </h4><br><p>  Une autre solution consiste simplement √† s√©parer les pr√©occupations!  Je veux dire - vous l'avez d√©j√† fait, et il est probablement temps de l'utiliser. </p><br><blockquote>  En <code>connect</code> le composant √† Redux ou GQL, vous produisez des conteneurs <em>bien connus</em> .  Je veux dire - avec <em>des</em> noms <em>bien connus</em> - <code>Container(WrapperComponent)</code> .  Vous pouvez vous moquer d'eux par leurs noms </blockquote><br><pre> <code class="plaintext hljs">const PageChrome = () =&gt; ( &lt;section&gt; &lt;aside&gt;&lt;ASideContainer /&gt;&lt;/aside&gt; &lt;Page /&gt; &lt;/section&gt; ); // remove all components matching react-redux pattern reactRemock.mock(/Connect\(\w\)/) // all any other container reactRemock.mock(/Container/)</code> </pre> <br><p>  Cette approche est un peu grossi√®re - elle effacera <em>tout</em> , ce qui rendra plus difficile le test des Contaiers eux-m√™mes, et vous pouvez utiliser un mocking un peu plus complexe pour garder le "premier": </p><br><pre> <code class="plaintext hljs">import {createElement, remock} from 'react-remock'; // initially "open" const ContainerCondition = React.createContext(true); reactRemock.mock(/Connect\(\w\)/, (type, props, children) =&gt; ( &lt;ContainerCondition.Consumer&gt; { opened =&gt; ( opened ? ( // "close" and render real component &lt;ContainerCondition.Provider value={false}&gt; {createElement(type, props, ...children)} &lt;ContainerCondition.Provider&gt; ) // it's "closed" : null )} &lt;/ContainerCondition.Consumer&gt; )</code> </pre> <br><blockquote>  Pointez ici: il n'y a pas de logique √† l'int√©rieur ni de pr√©sentation, pas de conteneur - toute logique est √† l'ext√©rieur. </blockquote><br><h4 id="bonus-solution---separate-concerns">  Solution bonus - Pr√©occupations distinctes </h4><br><p>  Vous pouvez garder <em>un couplage serr√© en</em> utilisant <code>defaultProps</code> et annuler ces accessoires dans les tests ... </p><br><pre> <code class="plaintext hljs">const PageChrome = ({Content = Page, Aside = ASideContainer}) =&gt; ( &lt;section&gt; &lt;aside&gt;&lt;Aside/&gt;&lt;/aside&gt; &lt;Content/&gt; &lt;/section&gt; );</code> </pre> <br><h2 id="so">  Alors? </h2><br><p>  Je viens donc de publier quelques fa√ßons de r√©duire la port√©e de n'importe quel composant et de les rendre beaucoup plus testables.  Le moyen simple de sortir un <code>gear</code> de la <code>gearbox</code> .  Un mod√®le simple pour vous faciliter la vie. </p><br><p>  Les tests E2E sont excellents, mais il est difficile de simuler certaines conditions, qui pourraient se produire dans une fonction profond√©ment imbriqu√©e et √™tre pr√™tes pour elles.  Vous devez avoir des tests unitaires pour pouvoir simuler diff√©rents sc√©narios.  Vous devez avoir des tests d'int√©gration pour vous assurer que tout est correctement c√¢bl√©. </p><br><p>  Vous savez, comme Dan l'a √©crit dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">son autre article</a> : </p><br><blockquote>  Par exemple, si un bouton peut √™tre dans l'un des 5 √©tats diff√©rents (normal, actif, en vol stationnaire, danger, d√©sactiv√©), le code de mise √† jour du bouton doit √™tre correct pour 5 √ó 4 = 20 transitions possibles - ou interdire certaines d'entre elles.  Comment apprivoiser l'explosion combinatoire d'√©tats possibles et rendre la sortie visuelle pr√©visible? </blockquote><p>  Bien que la bonne solution ici soit les machines √† √©tats, √™tre en mesure de choisir un seul atome ou une seule mol√©cule et de jouer avec - est l'exigence de base. </p><br><h3 id="the-main-points-of-this-article">  Les principaux points de cet article </h3><br><ol><li>  Les composants de pr√©sentation ne doivent contenir que d'autres composants de pr√©sentation. </li><li>  Les conteneurs sont l'Arbre.  Les composants sont des feuilles d'arbre. </li><li>  Vous ne devez pas <em>toujours</em> contenir de conteneurs √† l'int√©rieur des conteneurs de pr√©sentation, mais <em>pas</em> uniquement dans les tests. </li></ol><br><blockquote>  Vous pouvez plonger plus profond√©ment dans le probl√®me en lisant l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article moyen</a> , mais ici, sautons tout le sucre. </blockquote><p>  PS: Il s'agit d'une traduction de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">version</a> <em>habr de l'</em> article <em>ru-habr</em> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr436692/">https://habr.com/ru/post/fr436692/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr436682/index.html">Ne cr√©ez pas votre propre JL (DSL) pour √©tendre les fonctionnalit√©s de l'application</a></li>
<li><a href="../fr436684/index.html">Anniversaire Android 10 (Q). Que sait-on maintenant?</a></li>
<li><a href="../fr436686/index.html">JPEG du monde 3D. Qu'est-ce que glTF?</a></li>
<li><a href="../fr436688/index.html">Le g√©ant informatique quitte le march√© des puces pour les centres de donn√©es - dites-nous ce que cela signifie pour l'industrie</a></li>
<li><a href="../fr436690/index.html">[Demande - r√©ponse] sur la propri√©t√© intellectuelle et la protection des donn√©es</a></li>
<li><a href="../fr436694/index.html">My Pascal Compiler et l'art contemporain polonais</a></li>
<li><a href="../fr436696/index.html">Comment g√©n√©rer du son binaural sur une piste audio mono-canal - la vid√©o vous aidera</a></li>
<li><a href="../fr436698/index.html">De combien de fa√ßons puis-je √©crire factorielle dans Scheme?</a></li>
<li><a href="../fr436700/index.html">Anti-spoofing: comment les syst√®mes de reconnaissance faciale r√©sistent-ils aux escrocs?</a></li>
<li><a href="../fr436704/index.html">L'histoire de la fa√ßon dont nous avons choisi les balances pour l'automatisation des caisses enregistreuses</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>