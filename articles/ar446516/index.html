<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ด ๐ฆ ๐คพ๐พ ุฑูุดุงู ููุช ููุงุฏุฉ ุฌุฏูุฏุฉ ุงูุชุตูุฑ ๐ต ๐ ๐ง</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุชุชูุงูู ูุฐู ุงูููุงูุฉ ุงุนุชุฑุงุถ ูุธุงุฆู API ุงูุฑุณูููุฉ ุจุงุณุชุฎุฏุงู ูุซุงู DirectX 9 ูู x64 ูููุง ูุชุนูู ุจูุนุจุฉ Dota 2 . 

 ุณูุชู ูุตูู ุจุงูุชูุตูู ููููุฉ ุงุฎุชุฑุงู ุนูููุฉ ุงููุนุจุฉ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุฑูุดุงู ููุช ููุงุฏุฉ ุฌุฏูุฏุฉ ุงูุชุตูุฑ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446516/" style=";text-align:right;direction:rtl">  ุชุชูุงูู ูุฐู ุงูููุงูุฉ ุงุนุชุฑุงุถ ูุธุงุฆู API ุงูุฑุณูููุฉ ุจุงุณุชุฎุฏุงู ูุซุงู DirectX 9 ูู x64 ูููุง ูุชุนูู ุจูุนุจุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Dota 2</a> . <br><br>  ุณูุชู ูุตูู ุจุงูุชูุตูู ููููุฉ ุงุฎุชุฑุงู ุนูููุฉ ุงููุนุจุฉ ุ ูููููุฉ ุชุบููุฑ ุชุฏูู ุงูุชูููุฐ ุ ููุฑุฏ ูุตู ููุฌุฒ ููููุทู ุงููููุฐ.  ูู ุงูููุงูุฉ ุ ุณูุชุญุฏุซ ุนู ููุฒุงุช ุงูุชูุฏูู ุงูุฃุฎุฑู ุงูุชู ูููุฑูุง ุงููุญุฑู. <br><br><img src="https://habrastorage.org/webt/b0/rp/kn/b0rpknk7iobhh3darfcrte8ncmo.jpeg"><br><br><blockquote style=";text-align:right;direction:rtl">  <b>ุฅุฎูุงุก ุงููุณุฆูููุฉ: ุงููุคูู ุบูุฑ ูุณุคูู ุนู ุงุณุชุฎุฏุงูู ูููุนุฑูุฉ ุงูููุชุณุจุฉ ูู ูุฐู ุงูููุงูุฉ ุฃู ุงูุถุฑุฑ ุงููุงุฌู ุนู ุงุณุชุฎุฏุงููุง.</b>  <b>ุฌููุน ุงููุนูููุงุช ุงูููุฏูุฉ ููุง ูู ููุฃุบุฑุงุถ ุงูุชุนููููุฉ ููุท.</b>  <b>ุฎุงุตุฉ ุจุงููุณุจุฉ ููุดุฑูุงุช ุงูุชู ุชุทูุฑ ููุจุง ููุณุงุนุฏุชูุง ูู ุงูุชุนุงูู ูุน ุงูุบุดุงุดูู.</b>  <b>ูุจุงูุทุจุน ุ ูุฅู ูุงุชุจ ุงูููุงู ูู ุณุงุฆู ุฑูุจูุช ุ ูุบุดุงุด ุ ููุงู ุฏุงุฆููุง ูุฐูู.</b> </blockquote><a name="habracut"></a>  ุงูุฌููุฉ ุงูุฃุฎูุฑุฉ ุชุณุชุญู ุงูุชูุถูุญ - ุฃูุง ูู ุฃุฌู ุงูููุงูุณุฉ ุงูุนุงุฏูุฉ.  ุฃูุง ูุง ุฃุณุชุฎุฏู ุงูุบุด ุฅูุง ูุงูุชูุงู ุจุงูุฑูุงุถุฉ ุ ุฃุญุณู ุงูููุงุฑุงุช ุงูุนูุณูุฉ ุ ุฃุฏุฑุณ ุฃุนูุงู ููุงูุญุฉ ุงูุบุด ูููุท ุฎุงุฑุฌ ูุณุงุจูุงุช ุงูุชุตููู. <br><br><h2 style=";text-align:right;direction:rtl">  1. ููุฏูุฉ </h2><br>  ุชู ุงูุชุฎุทูุท ููุฐู ุงูููุงูุฉ ุจุงุนุชุจุงุฑูุง ุงูุฃููู ูู ุณูุณูุฉ ูุชุนุทู ููุฑุฉ ุนู ููููุฉ ุงุณุชุฎุฏุงู API ุงูุฑุณูููุฉ ูุฃุบุฑุงุถู ุงูุฎุงุตุฉ ุ ูุชุตู ุงููุธููุฉ ุงููุทููุจุฉ ูููู ุงูุฌุฒุก ุงูุชุงูู.  ุฃุฎุทุท ูุชุฎุตูุต ุงูููุงูุฉ ุงูุซุงููุฉ ููุจุญุซ ุนู ูุคุดุฑ ุฅูู ูุงุฆูุฉ ุงูููุงูุงุช ูู ุงููุตุฏุฑ 2 (ุฃูุถูุง ุจุงุณุชุฎุฏุงู Dota 2 ููุซุงู) ูุงุณุชุฎุฏุงูู ุจุงูุงูุชุฑุงู ูุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Source2Gen</a> ููุชุงุจุฉ ููุทู "ุฅุถุงูู" (ุณูุธูุฑ ุดูุก ูุซู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฐุง</a> "ุฎุฑูุทุฉ ุงูุงุฎุชุฑุงู" (ุฑุงุฌุน ุงูุงูุชุจุงู ุฅูู ุงูุชุจุงุณุงุช ุ ูุง ูู ุนูู ุงููุญู ูููู ุฃู ููุธุฑ ุฅููู ูู ุงูููุฏูู) ุ ุฃู ุฃุชูุชุฉ ุงูููุงู ุงูุฃูู).  ุชู ุงูุชุฎุทูุท ูููุงุฏุฉ ุงูุซุงูุซุฉ ูู ุดูู ูุชุงุจุฉ ุจุฑูุงูุฌ ุชุดุบูู ุ ูุงูุชูุงุตู ูุนู (IOCTL) ุ ูุงุณุชุฎุฏุงูู ูุชุฌุงูุฒ ุญูุงูุฉ VAC (ุดูุก ูุดุงุจู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุฐุง</a> ). <br><br><h2 style=";text-align:right;direction:rtl">  2. ููุงุฐุง ุฃุญุชุงุฌู </h2><br>  ููุช ุจุญุงุฌุฉ ุฅูู ุงุณุชุฎุฏุงู ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงูุฑุณูููุฉ ูุชุตุญูุญ ุจุตุฑู ููุฑูุจูุช ุ ูุงูุฐู ูุชุจุชู ูู Dota 2 (ุงููุนูููุงุช ุงููุฑุฆูุฉ ูู ุงูููุช ุงููุนูู ูุฑูุญุฉ ููุบุงูุฉ).  ุฃูุง ุทุงูุจ ุฏุฑุงุณุงุช ุนููุง ูุฃุดุงุฑู ูู ุฅุนุงุฏุฉ ุจูุงุก ุงูุฑุคูุณ ุซูุงุซูุฉ ุงูุฃุจุนุงุฏ ูุงูุชุญูู ุจุงุณุชุฎุฏุงู ุงูุตูุฑ ููุงููุฑุง ุงูุนูู - ุงูููุถูุน ูุซูุฑ ุฌุฏูุง ููุงูุชูุงู ุ ูููู ููุณ ุงูููุถู ูุฏู.  ูุธุฑูุง ูุฃููู ููุช ุฃูุนู ุฐูู ููุนุงู ุงูุฎุงูุณ (ุจุฏุกูุง ูู ุจุฑูุงูุฌ ุงููุงุฌุณุชูุฑ) ุ ูููุช ุดูุฆูุง ูุงุญุฏูุง - ูุนู ุ ููุฏ ุฏุฑุณุช ูุฐุง ุงููุฌุงู ุฌูุฏูุง ุ ูููููู ุจุณูููุฉ ุฏุฑุงุณุฉ ุงูููุงูุงุช ุจุงุณุชุฎุฏุงู ุงูุทุฑู ูุงูููุงูุฌ ุ ูุชูููุฐูุง.  ููู ูุฐุง ูู ุดูุก ุ ุฃูุง ุดุฎุตูุงู ูุง ูููููู ุฅูุง ุชุญุณูู ุงูุฎูุงุฑุฒููุฉ ุงููุณุชูุงุฏุฉ ุงูุชุงููุฉ ุ ูููุงุฑูุชูุง ุจุงูุฎูุงุฑุฒ ุงูุชู ุชูุช ุฏุฑุงุณุชูุง ูุชูููุฐูุง ุจุงููุนู ุ ูุชุญุฏูุฏ ูุง ุฅุฐุง ููุช ุณุชุณุชุฎุฏููุง ูู ูููุฉ ูุนููุฉ.  ุฅููุง ููุงูุฉ ุงูุชุญุณูู ุ ูููุณ ูู ุงููููู ุงูุชูุตู ุฅูู ุดูุก ุฌุฏูุฏ ุ ููู ุฃูุฑ ููู ููุบุงูุฉ ุจุงููุณุจุฉ ููุฏุฑุณุฉ ุงูุฏุฑุงุณุงุช ุงูุนููุง (ุญุฏุงุซุฉ ุงูุฏุฑุงุณุฉ).  ุจุฏุฃุช ุฃููุฑ - ุจูููุง ููุฌุฏ ููุช ุ ููููู ุงูุนุซูุฑ ุนูู ููุถูุน ุฌุฏูุฏ.  ุชุญุชุงุฌ ุจุงููุนู ุฅูู ููู ุงูููุถูุน ุฌูุฏูุง (ุนูู ุงููุณุชูู ุงูุญุงูู) ุฃู ููููู ุณุญุจู ุจุณุฑุนุฉ. <br><br>  ูู ููุงุฒุงุฉ ุฐูู ุ ุนููุช ูู ูุนุจุฉ dev ุ ูุฑุจูุง ูุฐุง ูู ุงูุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู ูููุง ูููู ูููุจุฑูุฌ ุงูููุงู ุจู (ุงูุฑุฃู ุงูุดุฎุตู) ููุงู ููุชููุง ุฌุฏูุง ุจููุถูุน ุงูุฑูุจูุชุงุช AI.  ูู ุฐูู ุงูููุช ุ ูุงู ููุงู ููุถูุนุงู ููุช ุฃุนุฑูููุง ุฌูุฏูุง - ุซู ููุช ุฃููู ุจุฅูุดุงุก ุดุจูุฉ ุชููู ุฏููุงููููุฉ (ุฎุงุฏู ุนููู) ูุฃุฏุฑุณ ุฌุฒุก ุงูุดุจูุฉ ูู ุฃุฏุงุฉ ุฅุทูุงู ุงููุงุฑ ุงูุฏููุงููููุฉ.  ูู ููู ุงูููุถูุน ุงูุฐู ูุชุถูู ูุชุตูุญูุง ุฏููุงูููููุง ููุงุณุจูุง ุนูู ุงูููุฑ - ููุฏ ูุนูุช ุฐูู ุฃุซูุงุก ุณุงุนุงุช ุงูุนูู ุ ููุงู ุนูู ุฃู ุฃุทูุจ ูู ุงูุฅุฏุงุฑุฉ ุงูุญุตูู ุนูู ุฅุฐู ูุงุณุชุฎุฏุงูู ูู ุดูุงุฏุชู ุ ุฅูู ุฌุงูุจ ุฃู ููุถูุน ุงูุฌุฏุฉ ูุงู ููุชูุญูุง - ููุฏ ููุช ุฃูุถูุง ุจุฏุฑุงุณุฉ ูุชุทุจูู ุงูููุฌ ุงูุญุงููุฉ ุฌูุฏูุง ุญุณุจ ุงูููุงูุฉ ุ ูููู ูุฐุง ูู ููู ุฌุฏูุฏุง.  ุงูููุถูุน ูุน ุฌุฒุก ุงูุดุจูุฉ ูู ูุทูู ุงููุงุฑ ุงูุฏููุงูููู (ููุช ุฃุฎุทุท ูุงุณุชุฎุฏุงูู ููุชูุงุนู ูู ุงููุงูุน ุงูุงูุชุฑุงุถู) ุชุนุทู ูุฑุฉ ุฃุฎุฑู ุญูู ุญูููุฉ ุฃููู ููุช ุฃูุนู ุฐูู ุฃุซูุงุก ุณุงุนุงุช ุงูุนูู ุ ูุนู ุงูุฌุฏุฉ ุ ููููู ูุฑุงุกุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุณูุณูุฉ ูู ุงูููุงูุงุช</a> ูู Pixonic ุ ุญูุซ ูููู ุงููุคูู ููุณู ุฃู ุงูููุถูุน ูุฐุง ูุซูุฑ ููุงูุชูุงู ุ ุญูุซ ุชู ุงุจุชูุงุฑ ุงูุฃุณุงููุจ ููุท ููุฐ 30 ุนุงููุง ููู ุชุชุบูุฑ ูุซูุฑูุง. <br><br>  ุญูู ูุฐุง ุงูููุช ุ ุฃุทูู OpenAI ุฑูุจูุชูู.  ูุฐุง ุจุงูุชุฃููุฏ ููุณ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">5 ูู 5</a> ุ ูููู ูุงู ุฑุงุฆุน!  ูู ุฃุชููู ูู ุทุฑุญ ุงูุฃููุงุฑ ููุญุงููุฉ ุตูุน ุฑูุจูุช ุ ููุจู ูู ุดูุก ุจุฏุฃุช ุฃููุฑ ูู ููููุฉ ุงุณุชุฎุฏุงูู ูุฑุณุงูุฉ ุ ุนู ุงูุฌุฏุฉ ุ ูููููุฉ ุชูุฏูููุง ุฅูู ูุงุฆุฏ.  ูุน ุงูุญุฏุงุซุฉ ูู ูุฐุง ุงูุตุฏุฏ ุ ูุงู ูู ุดูุก ุฃูุถู ุจูุซูุฑ - ุจุงูุชุฃููุฏ ูุงู ูู ุงููููู ุงูุชูุตู ุฅูู ุดูุก ููููุถูุนูู ุงูุณุงุจููู ุ ูููู ูุจุฏู ุฃู ุงูุฑูุจูุช ุฌุนููู ุฃููุฑ ูุฃุชุดุจุซ ูุฃุทูุฑ ูุฃุจุญุซ ุนู ุฃููุงุฑ ุฃููู ุจูุซูุฑ.  ูุฐูู ุ ูุฑุฑุช ุฅูุดุงุก ุฑูุจูุช ูุงุญุฏ ุนูู ูุงุญุฏ (ูุนุฑูุฉ ูู ุงูููุชุตู ุ ูุซู OpenAI) ุ ูุชูุฏูููุง ูููุงุฆุฏ ุ ูุฅุฎุจุงุฑ ูุฏู ุฑูุนุชูุง ุ ูุนุฏุฏ ุงูููุงูุฌ ุงููุฎุชููุฉ ุ ูุงูุฑูุงุถูุงุช ุ ูุงูุฃูู ูู ุฐูู ุ ุงููุนุฑูุฉ ุงูุฌุฏูุฏุฉ. <br><br>  ุงูุดูุก ุงูุฃูุซุฑ ุฃูููุฉ ุงูุฐู ูุญุชุงุฌู ุงูุฑูุจูุช ูู ุงููุฑุญูุฉ ุงูุฃููู ูู ูุนุฑูุฉ ุงูุจูุฆุฉ ุงูููุฌูุฏุฉ ููู - ููุช ุฃููู ุฃุฎุฐ ุญุงูุฉ ุงูุนุงูู ูู ุฐุงูุฑุฉ ุงููุนุจุฉ ููุถูุช ุงููุฑุญูุฉ ุงูุฃููู ูู ุงูุจุญุซ ุนู ูุคุดุฑ ุฅูู ูุงุฆูุฉ ุงูููุงูุงุช ูุงูุชูุงูู ูุน ุจูุงุช ุฃููุงุฑ ุงูุตูุงุฉ Dog2 Source2Gen - ูุฐุง ุงูุดูุก ูููุฏ ูููู ูุญุฑู Source2 ุ ูุงูุฐู ูุฃุฎุฐ ูู ุงูุฏูุงุฆุฑ.  ุฅู ุงูููุฑุฉ ุงูุฑุฆูุณูุฉ ูุงูุดุฑุท ุงูุฃุณุงุณู ูุธููุฑ ุงููุฎุทุทุงุช ูู ุชูุฑุงุฑ ุงูุญุงูุฉ ุจูู ุงูุนููู ูุงูุฎุงุฏู ุ ูููู ูุจุฏู ุฃู ุงููุทูุฑูู ูุฏ ุฃุญุจูุง ุงูููุฑุฉ ุจุงููุนู ููุงููุง ุจุชูุฒูุนูุง ุนูู ูุทุงู ุฃูุณุน ูุซูุฑูุง ุ ุฃูุตุญู ุจูุฑุงุกุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> . <br><br>  ูุงูุช ูุฏู ุชุฌุฑุจุฉ ููุฏุณูุฉ ูุนููุณุฉ: ููุฏ ููุช ุจุงูุบุด ูู Silent Storm ุ ูุตูุนุช ูููุฏุงุช ุฑุฆูุณูุฉ (ูุงู ุงูุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู ุจุงููุณุจุฉ ูู Black &amp; White) - ูุง ูููู ูุฑุงุกุฉ keygen ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">DrMefistO</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> ุ ุชูููุฐ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">combo</a> ูู Cabal Online (ูู ุดูุก ูุนูุฏ ุจุณุจุจ ุญูููุฉ ุฃู Game Guard ูุงูุช ูุญููุฉ ุ ูุญูุงูุชูุง ูู ring0 (ุชุญุช ุจุฑูุงูุฌ ุงูุชุดุบูู ูู ูุถุน kernel) ุ ูุฅุฎูุงุก ุงูุนูููุฉ (ูุงูุชู ุนูู ุงูุฃูู ูุง ุชุฌุนู ูู ุงูุณูู ุงูุชุณูู ุฅูููุง) - ูููู ูุฑุงุกุฉ ุงููุฒูุฏ ูู ุงูุชูุงุตูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> ). <br>  ููููุง ูุฐูู ุ ุญุฏุซุช ุชุทูุฑุงุช ูู ูุฐุง ุงููุฌุงู ุ ุญูุซ ูุตู ุงูุฑูุจูุช ุฅูู ุงูุจูุฆุฉ ูู ุงูููุช ุงููุฎุทุท ูู.  ุฅูู ูุฃูุฑ ูุฏูุด ููุฏุงุฑ ุงููุนูููุงุช ุงูุชู ููุณุฎูุง ุฎุงุฏู ุงููุณุชูุฏุนุงุช ุนุจุฑ ุงูุฏูุชุง ุฅูู ุงูุนููู ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุฏู ุงูุนููู ูุนูููุงุช ุญูู ุฃู ูุงูููู ุนู ุจูุนุฏ ุ ุงูุตุญุฉ ูุชุบููุฑุงุชู ุจูู ุงููููุงุก (ุจุงุณุชุซูุงุก ุฑูุดุงู ุ ููู ูุง ููุฑุฑ) - โโูู ูุฐุง ูู ุถุจุงุจ ุงูุญุฑุจ.  ุนูู ุงูุฑุบู ูู ุฃููู ูุงุฌูุช ุจุนุถ ุงูุตุนูุจุงุช ุ ุฅูุง ุฃู ูุฐุง ูุง ุณุฃุชุญุฏุซ ุนูู ูู ุงูููุงูุฉ ุงูุชุงููุฉ. <br>  ุฅุฐุง ูุงู ูุฏูู ุณุคุงู ููุงุฐุง ูู ุฃุณุชุฎุฏู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Dota Bot Scripting</a> ุ ูุณูู ุฃุฌูุจ ูุน ููุชุทู ูู ุงููุซุงุฆู: <br><blockquote style=";text-align:right;direction:rtl">  ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ูููุฏุฉ ุจุญูุซ ูุง ูููู ููุบุด ูู ุงูุจุฑุงูุฌ ุงููุตูุฉ - ูุง ูููู ุงูุงุณุชุนูุงู ุนู ุงููุญุฏุงุช ูู FoW ุ ููุง ูููู ุฅุตุฏุงุฑ ุงูุฃูุงูุฑ ุฅูู ุงููุญุฏุงุช ุงูุชู ูุง ูุชุญูู ุงูุจุฑูุงูุฌ ุงููุตู ูููุง ุ ุฅูุฎ. </blockquote>  ูุฐู ุงูุณูุณูุฉ ูู ุงูููุงูุงุช ููุฌูุฉ ูููุจุชุฏุฆูู ุงูููุชููู ุจููุถูุน ุงูููุฏุณุฉ ุงูุนูุณูุฉ. <br><br><h2 style=";text-align:right;direction:rtl">  3. ููุงุฐุง ุฃูุง ุฃูุชุจ ุนู ูุฐุง </h2><br>  ูุชูุฌุฉู ูุฐูู ุ ูุงุฌูุช ุงูุนุฏูุฏ ูู ุงููุดููุงุช ูู ุชูููุฐ ุจุฑูุงูุฌ ุงูุฑูุจูุช ูู ml ุ ูุงูุฐู ูุถูุช ููุชูุง ูุงูููุง ูุฃุฏุฑู ุฃูู ูุจู ุนุงููู ูู ุงูุชูุงุก ุงูุชุฏุฑูุจ ูู ุฃุชููู ูู ุชุฌุงูุฒ ูุนุฑูุชู ูุฎุจุฑุชู ูู ุงูููุถูุน ุงูุญุงูู.  ูู Dota 2 ูุง ุฃูุนุจ ูู ุฎูุงู ุฅุตุฏุงุฑ Dota Auto Chess ุงููุฎุตุต ุ ุฃูุถู ุงูุขู ููุช ูุฑุงุบู ูู ุฏุจููู ูุนูุณ Apex Legend (ูููููุง ูุดุจู ุฅูู ุญุฏ ูุจูุฑ Dota 2 ุ ููุง ูุจุฏู ูู).  ููููุง ูุฐูู ุ ูุฅู ุงููุงุฆุฏุฉ ุงููุญูุฏุฉ ูู ุงูุนูู ุงูููุฌุฒ ูู ูุดุฑ ููุงูุฉ ูููุฉ ุญูู ูุฐุง ุงูููุถูุน. <br><br><h2 style=";text-align:right;direction:rtl">  4. ุฏูุชุง 2 </h2><br>  ุฃุฎุทุท ูุฅุธูุงุฑ ูุฐู ุงููุจุงุฏุฆ ูู ูุนุจุฉ ุญููููุฉ - Dota 2. ุชุณุชุฎุฏู ุงููุนุจุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุงูุญุฉ</a> ุงูุบุด <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Valve Anti Cheat</a> .  ุฃูุง ุญููุง ุฃุญุจ Valve ูุดุฑูุฉ: ููุชุฌุงุช ุฑุงุฆุนุฉ ุฌุฏูุง ุ ูุฏูุฑ ุ ูููู ุงููุงุนุจูู ุ Steam ุ Source Engine 2 ุ ... VAC.  ุชุนูู VAC ูู ูุถุน ุงููุณุชุฎุฏู (ring3) ุ ููุง ุชูุญุต ูู ุดูุก ูุบูุฑ ุถุงุฑุฉ ููุงุฑูุฉู ุจูุถุงุฏุงุช ุงูุบุด ุงูุฃุฎุฑู (ูู ูุง ุชูุนูู esea (ุนูู ูุฌู ุงูุชุญุฏูุฏ ููุงูุญุฉ ุงูุบุด) ูุฌุนู ูู ุงูุฑุบุจุฉ ูู ุงุณุชุฎุฏุงู ูุฐู ุงูููุตุฉ ุชุฎุชูู).  ุฃูุง ูุชุฃูุฏ ูู ุฃู VAC ุชููู ุจุนูููุง ุจุทุฑููุฉ ูุชูุฑูุฉ - ููู ูุง ุชุฑุงูุจ ูู ูุถุน kernel ุ ููุง ุชุญุธุฑ ุงูุฃุฌูุฒุฉ (ููุท ุญุณุงุจ) ุ ููุง ุชุฏุฎู ุนูุงูุงุช ูุงุฆูุฉ ูู ููุทุงุช ุงูุดุงุดุฉ - ุจูุถู ูููู Valve ุชุฌุงู ุงููุงุนุจูู ุ ูุง ูููููู ุจุชุซุจูุช ุจุฑูุงูุฌ ููุงูุญุฉ ููุฑูุณุงุช ูุงูู ูู Game Guard ู BattlEye ู Warden ูุบูุฑูุง ุ ูุฃูู ุชู ุงุฎุชุฑุงููุง ูุชููู ููุงุฑุฏ ุงููุนุงูุฌ ุงูุชู ูุฏ ุชุฃุฎุฐูุง ุงููุนุจุฉ (ุญุชู ูู ุชู ุฐูู ุจุดูู ุฏูุฑู) ุ ููุงู ุฅูุฌุงุจูุงุช ูุงุฐุจุฉ (ุฎุงุตุฉ ููุงุนุจูู ุนูู ุฃุฌูุฒุฉ ุงูููุจููุชุฑ ุงููุญูููุฉ).  ููุณ ููุงู ุงุฎุชุฑุงู ููุฌุฏุงุฑ ุ aimbot ุ ุงุฎุชุฑุงู ุงูุณุฑุนุฉ ุ ESP ูู PUBG ุ Apex ุ Fortniteุ <br><br>  ูู ุงููุงูุน ุญูู Dota 2. ูุชู ุชุดุบูู ุงููุนุจุฉ ุนูู ุชุฑุฏุฏ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">40 ูุฑุชุฒ</a> (25 ูููู ุซุงููุฉ) ุ ูููู ุงูุนููู ุจุชุญุฑูู ุญุงูุฉ ุงููุนุจุฉ ุ ููุง ูุชู ุงุณุชุฎุฏุงู ุงูุชูุจุค ุจุงูุฅุฏุฎุงู - ุฅุฐุง ูุงู ูุฏูู ุชุฃุฎุฑ ุ ูุนุจุฉ - ูู ุงูููู ุฃูุง ูุชู ุชุฌููุฏ ุงููุนุจุฉ ุชูุงููุง.  ูููู ุฎุงุฏู ูููุงูููุง ุงููุนุจุฉ ุจุชุจุงุฏู ุงูุฑุณุงุฆู ุงููุดูุฑุฉ ูุน ุงูุนููู ุนุจุฑ RUDP (UDP ุงูููุซูู) ุ ุญูุซ ูุฑุณู ุงูุนููู ุฃุณุงุณูุง ุงููุฏุฎูุงุช (ุฅุฐุง ููุช ุชุณุชุถูู ุงูููุจู ุ ูููู ุฅุฑุณุงู ุงูุฃูุงูุฑ) ุ ูุฑุณู ุงูุฎุงุฏู ูุณุฎุฉ ุทุจู ุงูุฃุตู ูู ุนุงูู ุงููุนุจุฉ ููุฑููุง.  ูุชู ุงูุชููู ุนูู ุดุจูุฉ ุซูุงุซูุฉ ุงูุฃุจุนุงุฏ ุ ูููู ุฎููุฉ ููุน ูู ุฃููุงุน ุงููุจุงุญ ุงูุฎุงุตุฉ ุจูุง.  ุชุชู ุงูุญุฑูุฉ ุจุงุณุชุฎุฏุงู ุงูููุงุญุฉ ูุงูููุฒูุงุก (ุงุณุชุญุงูุฉ ุงููุฑูุฑ ูู ุดู ุงูุดุงูุฑ ุ kogi clokverka ุ ุฅูุฎ). <br><br>  ุญุงูุฉ ุงูุนุงูู ูุน ุฌููุน ุงูููุงูุงุช ููุฌูุฏุฉ ูู ุงูุฐุงูุฑุฉ ูู ุฃููู ุตูุฑูุง ุฏูู ุชุดููุฑ - ููููู ุฏุฑุงุณุฉ ุฐุงูุฑุฉ ุงููุนุจุฉ ุจุงุณุชุฎุฏุงู ูุญุฑู ุงูุบุด.  ูุง ููุทุจู ุงูุชุนุชูู ุนูู ุงูุฃูุชุงุฑ ูุงูููุฏ. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุชุชููุฑ DirectX9 ู DirectX11 ู Vulkan ู OpenGL ูู ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงูุฑุณูููุฉ.</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/xc/xq/kl/xcxqkl2qpwy3gved7_jblzsqumo.png"><br></div></div><br><h2 style=";text-align:right;direction:rtl">  5. ุจูุงู ุงููุดููุฉ </h2><br>  ูู ูุนุจุฉ Dota 2 ุ ููุงู "ูุฏูู" ูุญุงูุฏ ุ ูุนุทู ูุชูู ููุงูุฃุฉ ุฌูุฏุฉ: ุงูุฎุจุฑุฉ ุ ูุงูุฐูุจ ุ ูุงููุฏุฑุฉ ุนูู ุงูุชุฑุงุฌุน ุนู ุงูุชุฒุงูุฌ ุจูู ุงูููุงุฑุงุช ูุงูุฃุดูุงุก ุ ุงูุฌูุณ (ุงูุญูุงุฉ ุงูุซุงููุฉ) ุ ุงุณูู ุฑูุดุงู.  ูููู ูู Getting Aegis ุฃู ูููุจ ุงููุนุจุฉ ุจุดูู ุฃุณุงุณู ุฃู ูุนุทู ููุฒุฉ ุฃูุจุฑ ููุฌุงูุจ ุงูุฃููู ุ ุนูู ุงูุชูุงูู ุ ูุญุงูู ุงููุงุนุจูู ุฃู ูุชุฐูุฑูุง / ูุณุฌููุง ููุช ููุงุชู ูู ุฃุฌู ุงูุชุฎุทูุท ูููุนุฏ ุงูููุงุก ูููุงุฌูุชู ุ ุฃู ุฃู ูููููุง ูุฑูุจูู ูุญูุงูุชู.  ูุชู ุฅุฎุทุงุฑ ุฌููุน ุงููุงุนุจูู ุงูุนุดุฑุฉ ุจููุงุฉ ุฑูุดุงู ุ ุจุบุถ ุงููุธุฑ ุนูุง ุฅุฐุง ูุงู ูุฎููุงู ูู ุถุจุงุจ ุงูุญุฑุจ.  ูููู ููุช ุงูุงุณุชุฑุงุญุฉ ุซูุงูู ุฏูุงุฆู ุฅูุฒุงููุฉ ุ ูุจุนุฏูุง ูุฏ ูุธูุฑ ุฑูุดุงู ุจุดูู ุนุดูุงุฆู ูู ูุชุฑุฉ ุซูุงุซ ุฏูุงุฆู. <br><br>  <i>ุงููููุฉ ูุงูุชุงูู</i> : ูุชุฒููุฏ ุงููุงุนุจ ุจูุนูููุงุช ุนู ุญุงูุฉ ุฑูุดุงู ุงูุญุงููุฉ (ุนูู ููุฏ ุงูุญูุงุฉ ุ ressurect_base-revives ุงูููุช ุงูุฃุณุงุณู ุ ressurect_extra-revives ููุช ุฅุถุงูู). <br><br> <a href=""><img src="https://habrastorage.org/webt/qf/ef/3s/qfef3s2h4a6l_pfageiblxwqhd8.png"></a> <br>  <i>ุงูุดูู 1 - ุดุฑูุท ุงูุงูุชูุงู ุจูู ุงูุฏูู ูุงูุฅุฌุฑุงุกุงุช ุฃุซูุงุก ุงูุงูุชูุงู</i> <br><br>  ุจุงููุณุจุฉ ููุธุฑูู ุงูุชู ูุงุช ูููุง ุฑูุดุงู ุ ุงุนุฑุถ ููุช ุงูุชูุงุก ุงูุฅูุงูุฉ ูู ูุฐู ุงูุญุงูุฉ.  ูุฌุจ ุฃู ูุชู ุงูุงูุชูุงู ูู ุงูุญุงูุฉ ุงููุจุงุดุฑุฉ ุฅูู ressurect_base ุจูุงุณุทุฉ ุงููุดุบู ูู ุงููุถุน ุงููุฏูู ุจูุงุณุทุฉ ุงูุฒุฑ.  ูู ุญุงูุฉ ุงูุชุดุงู / ููุงุฉ ุฑูุดุงู ูู ุญุงูุฉ ressurect_extra (ุนูู ุณุจูู ุงููุซุงู ุ ุชุณูู ูุฑูู ุนุฏู ุณุฑูุง ุฅูู ุงูุนุฑูู ููุชููู) ุ ูุชู ุฃูุถูุง ุงูุงูุชูุงู ุฅูู ุญุงูุฉ alive / ressurect_base ูุฏูููุง ุจุงุณุชุฎุฏุงู ุงูุฒุฑ.  ูุฌุจ ุฃู ุชุธูุฑ ุญุงูุฉ ุฑูุดุงู (ูููุช ุงูุงูุชูุงุก ูู ููููุง ูู ุญุงูุฉ ุฅุญูุงุก) ูู ุดูู ูุต ุ ููุฌุจ ุชูููุฑ ุงููุฏุฎูุงุช ุงููุงุฒูุฉ (ูุชู ูุงููุทุงุน ุญุงูุฉ ressurect_extra) ูุน ุฒุฑ. <br><br><img src="https://habrastorage.org/webt/cb/xw/ne/cbxwneudadwlvbx4ch2gwumlona.png"><br>  <i>ุงูุดูู 2 - ุนูุงุตุฑ ูุงุฌูุฉ - ุงูุชุณููุฉ ุ ุฒุฑ ูููุงุด</i> <br><br>  ูุฐู ูู ุงููููุฉ ุงููุญูุฏุฉ ุงูุชู ูููู ุฃู ุฃุชูุตู ุฅูููุง ุญุชู ูุง ุฃุญุชุงุฌ ููุนูู ูุน ุฐุงูุฑุฉ ุงููุนุจุฉ ููุงู ููุงู ุจุนุถ ุงููููุฉ ุนูู ุงูุฃูู ุจุงููุณุจุฉ ููุงุนุจ - ุญุชู ูุงุดุชูุงู ุฃู ุฎุตุงุฆุต ุฃูููุฉ ุ ูุซู ุงูุตุญุฉ ูุงููุงูุง ูููุงูู ุงูููุงูุงุช ุ ูุฃูุช ุจุญุงุฌุฉ ุฅูู ุงูุนุซูุฑ ุนูููุง ูุณุจููุง. ุณุงุนุฏ ูุญุฑู ุงูุบุด ูู ุฐุงูุฑุฉ ุงููุนุจุฉ ุ ูุงูุฐู ูุญุชุงุฌ ุฅูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุดุฑุญ</a> ุฅุถุงูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุชุฑุฉ</a> ุทูููุฉ ุฅูู ุญุฏ ูุง ุ ุฃู ุจูุณุงุนุฏุฉ Source2Gen ุ ูุงูุชู ุณุชุชู ููุงูุดุชูุง ูู ุงูููุงูุฉ ุงูุชุงููุฉ.  ููุฑุถ ุจูุงู ุงููุดููุฉ ุนูู ุงููุงุนุจ ุงุชุจุงุน ุฑูุดุงู ุ ูููู ุงููุซูุฑ ูู ุงูุฅุฌุฑุงุกุงุช ุฅููู ุ ููู ุฃูุฑ ุบูุฑ ูุฑูุญ ุฅูู ุญุฏ ูุง - ูููู ุณูููู ููุงู ุดูุก ูููู ุงูุงุนุชูุงุฏ ุนููู ูู ุงูุฌุฒุก ุงูุซุงูู. <br><br>  ุณููุชุจ injected.dll ุ ูุงูุฐู ุณูุญุชูู ุนูู ููุทู ุงูุฃุนูุงู ุงููุณุชูุฏุฉ ุฅูู MVC ูุชุทุจููู ูู ุนูููุฉ Dota 2. ุณูู ุชุณุชุฎุฏู ููุชุจุฉ DLL ุงูุฎุงุตุฉ ุจูุง silk_way.lib ุ ูุงูุชู ุณุชุญุชูู ุนูู ููุทู ุงูููุงุกูุฉ ูุชุบููุฑ ุชุฏูู ุงูุชูููุฐ ูุงููุณุฌู ููุงุณุญ ุงูุฐุงูุฑุฉ ูููุงูู ุงูุจูุงูุงุช . <br><br><h2 style=";text-align:right;direction:rtl">  6. ุญุงูู </h2><br>  ุฅูุดุงุก ูุดุฑูุน C ++ ูุงุฑุบุฉ ุ ุงุณุชุฏุนุงุก NativeInjector.  ุงูููุฏ ุงูุฑุฆูุณู ูู ูู ูุธููุฉ ุงูุญูู. <br><br><pre style=";text-align:right;direction:rtl"><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Inject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; dllPath, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; processName)</span></span></span><span class="hljs-function"> </span></span>{ DWORD processId = GetProcessIdentificator(processName); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (processId == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> invalid_argument(<span class="hljs-string"><span class="hljs-string">"Process dont existed"</span></span>); HANDLE hProcess = OpenProcess(PROCESS_CREATE_THREAD | PROCESS_QUERY_INFORMATION | PROCESS_VM_OPERATION | PROCESS_VM_READ | PROCESS_VM_WRITE, FALSE, processId); HMODULE hModule = GetModuleHandle(<span class="hljs-string"><span class="hljs-string">"kernel32.dll"</span></span>); FARPROC address = GetProcAddress(hModule, <span class="hljs-string"><span class="hljs-string">"LoadLibraryA"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> payloadSize = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) * dllPath.length() + <span class="hljs-number"><span class="hljs-number">1</span></span>; LPVOID allocAddress = VirtualAllocEx( hProcess, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, payloadSize, MEM_COMMIT | MEM_RESERVE, PAGE_READWRITE); SIZE_T written; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> writeResult = WriteProcessMemory(hProcess, allocAddress, dllPath.c_str(), payloadSize, &amp; written); DWORD treadId; CreateRemoteThread(hProcess, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, (LPTHREAD_START_ROUTINE) address, allocAddress, <span class="hljs-number"><span class="hljs-number">0</span></span>, &amp; treadId); CloseHandle(hProcess); }</code> </pre> <br>  ุชุญุตู ุงููุธููุฉ ุนูู ูุณุงุฑ ุงูุนูููุฉ ูุงุณููุง ุ ูุชุจุญุซ ุนู ุงููุนุฑู ุงูุฎุงุต ุจูุง ุจุงุณู ุงูุนูููุฉ ุจุงุณุชุฎุฏุงู GetProcessIdentificator. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุธููุฉ GetProcessIdentificator</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">DWORD </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetProcessIdentificator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; processName)</span></span></span><span class="hljs-function"> </span></span>{ PROCESSENTRY32 processEntry; processEntry.dwSize = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(PROCESSENTRY32); HANDLE snapshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); DWORD processId = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Process32First(snapshot, &amp; processEntry)) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Process32Next(snapshot, &amp; processEntry)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_stricmp(processEntry.szExeFile, processName.c_str())) { processId = processEntry.th32ProcessID; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } CloseHandle(snapshot); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> processId; }</code> </pre> <br></div></div><br>  ุจุงุฎุชุตุงุฑ ุ ูุนูู GetProcessIdentificator ูู ุฎูุงู ุฌููุน ุงูุนูููุงุช ุงูุฌุงุฑูุฉ ููุจุญุซ ุนู ุนูููุฉ ุจุงูุงุณู ุงูููุงุณุจ. <br><br><img src="https://habrastorage.org/webt/du/za/p1/duzap1ptnhys_gyk_e1zrjm436e.png"><br>  <i>ุงูุดูู 3 - ุงูุญุงูุฉ ุงูุฃูููุฉ ููุนูููุฉ</i> <br><br>  ุจุนุฏ ุฐูู ุ ุงูุชูููุฐ ุงููุจุงุดุฑ ููููุชุจุฉ ุนู ุทุฑูู ุฅูุดุงุก ุฏูู ุจุนูุฏ. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุดุฑุญ ููุตู ููุธููุฉ ุงูุญูู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl">  ุงุณุชูุงุฏูุง ุฅูู ุงููุนุฑู ุงูุฐู ุชู ุงูุนุซูุฑ ุนููู ุ ูุชู ูุชุญ ุงูุนูููุฉ ุจุงุณุชุฎุฏุงู ูุธููุฉ OpenProcess ูุน ุญููู ุฅูุดุงุก ุณูุณูุฉ ุฑุณุงุฆู ุ ูุชููู ูุนูููุงุช ุงูุนูููุฉ ุ ููุฏุฑุงุช ุงููุชุงุจุฉ ูุงููุฑุงุกุฉ.  ุชููู ุงูุฏุงูุฉ GetModuleHandle ุจุงุณุชุฑุฏุงุฏ ุงููุญุฏุฉ ุงูููุทูุฉ ูููุชุจุฉ kernel32 ุ ููุชู ุฐูู ููุญุตูู ุนูู ุนููุงู ูุธููุฉ LoadLibraryA ุงูููุฌูุฏุฉ ููู ุจูุงุณุทุฉ ุฏุงูุฉ GetProcAddress.  ุงูุบุฑุถ ูู LoadLibrary ูู ุชุญููู injected.dll ุงูุฎุงุต ุจูุง ูู ุงูุนูููุฉ ุงููุญุฏุฏุฉ.  ุจูุนูู ุ ูุญู ุจุญุงุฌุฉ ุฅูู ุงุณุชุฏุนุงุก LoadLibrary ูู ุงูุนูููุฉ ุงูุชู ุชูููุง ("Dota2.exe") ุ ูุฐูู ููุดุฆ ุนู ุจุนุฏ ููุถูุนูุง ุฌุฏูุฏูุง ุจุงุณุชุฎุฏุงู CreateRemoteThread.  ููุคุดุฑ ุฅูู ุงููุธููุฉ ุงูุชู ูุจุฏุฃ ูููุง ูุคุดุฑ ุงูุชุฑุงุจุท ุงูุฌุฏูุฏ ุ ูููู ุจุชูุฑูุฑ ุนููุงู ุฏุงูุฉ LoadLibraryA.  ุฅุฐุง ูุธุฑุช ุฅูู ุชูููุน ุงูุฏุงูุฉ LoadLibraryA ุ ูุฅููุง ุชุชุทูุจ ุงููุณุงุฑ ุฅูู ุงูููุชุจุฉ ุงููุญููุฉ ููุณูุทุฉ - HMODULE LoadLibraryA (LPCSTR lpLibFileName).  ููุฏู ูุฐู ุงููุณูุทุฉ ููุง ููู: CreateRemoteThread ูู ุงููุนููุงุช ุจุนุฏ ุฃู ูุฃุฎุฐ ุนููุงู ุงูุฏุงูุฉ start ูุคุดุฑูุง ุฅูู ุงููุนููุงุช ุงูุฎุงุตุฉ ุจู ุ ููููู ุจุชูููู ูุคุดุฑ ุฅูู lpLibFileName ุนู ุทุฑูู ูุชุงุจุฉ ุงููููุฉ ุฅูู ุฐุงูุฑุฉ ุงูุนูููุฉ ุจุงุณุชุฎุฏุงู ุฏุงูุฉ WriteProcessMemory (ุจุนุฏ ุชุฎุตูุต ุงูุฐุงูุฑุฉ ุจุงุณุชุฎุฏุงู VirtualAllocEx). <br></div></div><br><img src="https://habrastorage.org/webt/wx/8r/5v/wx8r5viycrlhjarivk-02dgh124.png"><br>  <i>ุงูุดูู 4 - ุฅูุดุงุก ุชูุงุฑ ุจุนูุฏ</i> <br><br>  ุชุฃูุฏ ูู ุฅุบูุงู ูุนุงูุฌ ุงูุนูููุฉ ูู ุงูููุงูุฉ ุจูุธููุฉ CloseHandle ุ ููุง ููููู ุชุญุฑูุฑ ุงูุฐุงูุฑุฉ ุงููุฎุตุตุฉ.  ุญุงูููุง ุฌุงูุฒ ูููุชุธุฑ ููุง ุฃู ููุชุจ ููุทู ุงูุนูู ูู injected.dll ูุน ููุชุจุฉ silk_way.lib. <br><br><img src="https://habrastorage.org/webt/no/8c/tr/no8ctrxtn_vz31nad0uj25tb8zs.png"><br>  <i>ุงูุดูู 5 - ุงุณุชููุงู ุชูููุฐ ุงูููุชุจุฉ</i> <br><br>  ููุญุตูู ุนูู ููู ุฃูุถู ูููุจุฏุฃ ุ ููููู ูุดุงูุฏุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูููุฏูู</a> .  ูู ุงูุฎุชุงู ุ ุณุฃููู ุฅูู ููุฌ ุฃูุซุฑ ุฃูุงููุง ูุน ุงูุชูููุฐ ุงููุจุงุดุฑ ููุฑูุฒ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฎูุท ุงูุฑุฆูุณู</a> ููุนูููุฉ. <br><br><h2 style=";text-align:right;direction:rtl">  7. ุทุฑูู ุงูุญุฑูุฑ </h2><br>  ููุจุฏุฃ ูู ุชุทุจูู silk_way.lib ุ ููู ููุชุจุฉ ุซุงุจุชุฉ ุชุญุชูู ุนูู ููุงูู ุจูุงูุงุช ููุณุฌู ููุงุณุญ ุถูุฆู ููุฐุงูุฑุฉ ููุฎุงุฎ.  ูู ุงููุงูุน ุ ุฃุฎุฐุช ุฌุฒุกูุง ุตุบูุฑูุง ูู ุนููู ุ ููู ุดูุก ูููู ุดุฑุญู ุจุฃูุซุฑ ุจุณุงุทุฉ ุ ููู ุบูุฑ ูุฑุชุจุท ุจุงูุจุงูู ุ ููููู ูู ุงูููุช ููุณู ูุญู ุงููุดููุฉ. <br><br><h3 style=";text-align:right;direction:rtl">  7.1.  ููุงูู ุงูุจูุงูุงุช. </h3><br>  ุจุงุฎุชุตุงุฑ ุญูู ุจููุงุช ุงูุจูุงูุงุช: Vector - ุงููุงุฆูุฉ ุงูููุงุณูููุฉ ุ ููุช ุงูุฅุฏุฑุงุฌ ูุงูุญุฐู O (N) ุ ุงูุจุญุซ O (N) ุ ุงูุฐุงูุฑุฉ O (N) ุ  ูุงุฆูุฉ ุงูุงูุชุธุงุฑ - ูุงุฆูุฉ ุงูุชุธุงุฑ ุฏุงุฆุฑูุฉ ุ ููุช ุงูุฅุฏุฑุงุฌ ูุญุฐู O (1) ุ ูุง ุจุญุซ ุ ุฐุงูุฑุฉ O (N) ุ  RBTree - ุดุฌุฑุฉ ุงูุฃุญูุฑ ูุงูุฃุณูุฏ ุ ููุช ุงูุฅุฏุฑุงุฌ ูุงูุญุฐู O (logN) ุ ุงูุจุญุซ O (logN) ุ ุงูุฐุงูุฑุฉ O (N).  ุฃูุถูู ุงูุชุฌุฒุฆุฉ ุงููุณุชุฎุฏูุฉ ูู ุชูููุฐ ุงูููุงููุณ ูู C # ู Python ุ ุงูุฃุดุฌุงุฑ ุงูุญูุฑุงุก ุงูุณูุฏุงุก ุงูุชู ุชุณุชุฎุฏููุง ููุชุจุฉ C ++ ุงูููุงุณูุฉ.  ูุงูุณุจุจ ูู ุฐูู ูู ุฃูู ูู ุงูุตุนุจ ุชูููุฐ ุชุฌุฒุฆุฉ ุจุดูู ุตุญูุญ ุฃูุซุฑ ูู ุงูุดุฌุฑุฉ (ุชูุฑูุจูุง ูู ูุตู ุนุงู ุฃุฌุฏู ูุฃุฌุฑูุจ ุฃููุงุนูุง ูู ุงูุชุฌุฒุฆุงุช) ุ ูุนุงุฏุฉ ูุง ุชุฃุฎุฐ ุงูุชุฌุฒุฆุฉ ุงููุฒูุฏ ูู ุงูุฐุงูุฑุฉ (ุนูู ุงูุฑุบู ูู ุฃููุง ุชุนูู ุจุดูู ุฃุณุฑุน).  ูุชู ุงุณุชุฎุฏุงู ูุฐู ุงูููุงูู ูุฅูุดุงุก ูุฌููุนุงุช ุณูุงุก ูู ููุทู ุงูุนูู ุฃู ูู ุงููุฎุงุฎ. <br><br>  ุฃุญุงูู ุนุฏู ุงุณุชุฎุฏุงู ููุงูู ูู ุงูููุชุจุฉ ุงูููุงุณูุฉ ูุฃููุฐูุง ุจููุณู ุ ูุง ููู ูุฐุง ุงูุฃูุฑ ุนูู ูุฌู ุงูุชุญุฏูุฏ ูู ุญุงูุชูุง ุ ูููู ูู ุงูููู ุฃู ูุชู ุชุตุญูุญ ููู dll ุงูุฎุงุต ุจู ุฃู ุฃู ุงูุชุฌูุน ูู ูุถุน ุตุฑูุญ (ููุฐุง ุนูู ุงูุฃุฑุฌุญ ูู ุงูุบุด ุงูุชุฌุงุฑู ุงูุฐู ูุฏููู ).  ุฃูุตุญู ุจูุชุงุจุฉ ุฌููุน ุงูููุงูู ุจููุณู ุ ููุฐุง ูููุญู ุงููุฒูุฏ ูู ุงููุฑุต. <br>  ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ููุช ุจุฅุฌุฑุงุก ูุนุจุฉ ููู ุชุฑุบุจ ูู ุฃู ูููู "ุชูุงููุฐ ุงููุฏุงุฑุณ" ุจูุณุญูุง ุถูุฆููุง ุจุงุณุชุฎุฏุงู ูุญุฑู ุงูุบุด ุ ูููููู ุนูู ุบูุงูุงุช ูุฃููุงุน ุจุฏุงุฆูุฉ ูุชุฎุฒูู ุงููููุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุดูุฑุฉ</a> ูู ุงูุฐุงูุฑุฉ.  ูู ุงูุญูููุฉ ุ ูุฐุง ููุณ ุฎูุงุตูุง ุ ูููู ูุฏ ููุบู ุจุนุถ ูู ูุญุงูููู ูุฑุงุกุฉ ูุชุบููุฑ ุฐุงูุฑุฉ ุงููุนุจุฉ. <br><br><h3 style=";text-align:right;direction:rtl">  7.2.  ูุณุฌู </h3><br>  ููุฐุช ุงูุฅุฎุฑุงุฌ ุฅูู ูุญุฏุฉ ุงูุชุญูู ูุงููุชุงุจุฉ ุฅูู ููู.  ุงูุชูุงุนู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ILogger</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: ILogger(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> * _path) { path = path; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~ILogger() {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * format, ...)</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> * path; };</code> </pre> <br>  ุชูููุฐ ุงูุฅุฎุฑุงุฌ ุฅูู ููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MemoryLogger</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ILogger { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: MemoryLogger(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> * _path): ILogger(_path) { fopen_s( &amp; fptr, _path, <span class="hljs-string"><span class="hljs-string">"w+"</span></span>); } ~MemoryLogger() { fclose(fptr); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * format, ...)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>[MAX_LOG_SIZE]; <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>[MAX_LOG_SIZE - <span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; va_list args; va_start(args, format); vsprintf_s(<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>, MAX_LOG_SIZE, format, args); va_end(args); <span class="hljs-built_in"><span class="hljs-built_in">fprintf</span></span>(fptr, <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: FILE * fptr; };</code> </pre> <br>  ุชูููุฐ ุงูุฅุฎุฑุงุฌ ุฅูู ูุญุฏุฉ ุงูุชุญูู ูู ููุณู.  ุฅุฐุง ุฃุฑุฏูุง ุงุณุชุฎุฏุงู ุงูุชุณุฌูู ุ ููู ุงูุถุฑูุฑู ุชุญุฏูุฏ ูุงุฌูุฉ ILogger * ุ ูุงูุฅุนูุงู ุนู ุงููุณุฌู ุงูุถุฑูุฑู ุ ูุงุณุชุฏุนุงุก ูุธููุฉ ุงูุณุฌู ุจุงูุชูุณูู ุงููุทููุจ ุ ุนูู ุณุจูู ุงููุซุงู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">ILogger* logger = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MemoryLogger(filename); logger-&gt;Log(<span class="hljs-string"><span class="hljs-string">"(%llu)%s: %d\n"</span></span>, GetCurrentThreadId(), <span class="hljs-string"><span class="hljs-string">"EnumerateThread result"</span></span>, result);</code> </pre> <br><h3 style=";text-align:right;direction:rtl">  7.3.  ุงููุงุณุญ ุงูุถูุฆู </h3><br>  ูุดุงุฑู ุงููุงุณุญ ุงูุถูุฆู ูู ุญูููุฉ ุฃูู ูุนุฑุถ ูููุฉ ุงูุฐุงูุฑุฉ ุงูุชู ูุดูุฑ ุฅูููุง ุงููุคุดุฑ ุงูููููู ูููุงุฑููุง ุจุงูุนููุฉ ุงูููุฌูุฏุฉ ูู ุงูุฐุงูุฑุฉ.  ููุงุฑูุฉ ูุธูููุฉ ูุน ููุท ุณูุชู ุงููุธุฑ ูู ููุช ูุงุญู. <br><br>  ุงูุชูุงุนู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IScanner</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: IScanner() {} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~IScanner() {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrintMemory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * title, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * memPointer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size)</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; };</code> </pre> <br>  ุชุทุจูู ููู ุงูุฑุฃุณ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FileScanner</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IScanner { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: FileScanner(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* _path) : IScanner() { fopen_s(&amp;fptr, _path, <span class="hljs-string"><span class="hljs-string">"w+"</span></span>); } ~FileScanner() { fclose(fptr); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrintMemory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* title, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* memPointer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: FILE* fptr; };</code> </pre> <br>  ุชุทุจูู ููู ุงููุตุฏุฑ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> FileScanner::PrintMemory(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* title, <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* memPointer, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size) { <span class="hljs-built_in"><span class="hljs-built_in">fprintf</span></span>(fptr, <span class="hljs-string"><span class="hljs-string">"%s:\n"</span></span>, title); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; size; i++) <span class="hljs-built_in"><span class="hljs-built_in">fprintf</span></span>(fptr, <span class="hljs-string"><span class="hljs-string">"%x "</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(*(memPointer + i))); <span class="hljs-built_in"><span class="hljs-built_in">fprintf</span></span>(fptr, <span class="hljs-string"><span class="hljs-string">"\n"</span></span>, title); }</code> </pre> <br>  ูุงุณุชุฎุฏุงููุง ุ ุชุญุชุงุฌ ุฅูู ุชุญุฏูุฏ ูุงุฌูุฉ IScanner * ุ ูุงูุฅุนูุงู ุนู ุงููุงุณุญ ุงูุถูุฆู ุงููุทููุจ ูุงุณุชุฏุนุงุก ูุธููุฉ PrintMemory ุ ุญูุซ ููููู ุชุนููู ุงูุนููุงู ูุงููุคุดุฑ ูุงูุทูู ุ ุนูู ุณุจูู ุงููุซุงู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">IScanner* scan = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConsoleScanner(); scan-&gt;PrintMemory(<span class="hljs-string"><span class="hljs-string">"source orig"</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*)source, <span class="hljs-number"><span class="hljs-number">30</span></span>);</code> </pre> <br><h3 style=";text-align:right;direction:rtl">  7.4.  ุงููุฎุงุฎ </h3><br>  ุงูุฌุฒุก ุงูุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู ูู ููุชุจุฉ silk_way.lib.  ุชุณุชุฎุฏู ุงูุณูุงููุฑ ูุชุบููุฑ ุชุฏูู ุชูููุฐ ุงูุจุฑูุงูุฌ.  ุฅูุดุงุก ูุดุฑูุน ูุงุจู ููุชูููุฐ ูุณูู Sandbox. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุฆุฉ ุงูุฌูุงุฒ ุณุชููู ุฏููุฉ ูุฏููุง ููุชุญููู ูู ุชุดุบูู ุงููุฎุงุฎ.</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Unknown</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: Unknown() {} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: ~Unknown() {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> HRESULT </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">QueryInterface</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> ULONG </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddRef</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> ULONG </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Release</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Device</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Unknown { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Device() : Unknown() {} ~Device() {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> HRESULT </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">QueryInterface</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> ULONG </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddRef</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> ULONG </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Release</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Present</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Present()"</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">" "</span></span> &lt;&lt; i &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EndScene</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> j)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"EndScene()"</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">" "</span></span> &lt;&lt; i &lt;&lt; <span class="hljs-string"><span class="hljs-string">" "</span></span> &lt;&lt; j &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dispose</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Dispose()"</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">" "</span></span> &lt;&lt; i &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; };</code> </pre> <br></div></div><br>  ูุชู ุชูุฑูุซ ูุฆุฉ ุงูุฌูุงุฒ ูู ูุงุฌูุฉ IUnknown ุ ููููุชูุง ูู ุงุนุชุฑุงุถ ุงุณุชุฏุนุงุก ูุธุงุฆู Present ู EndScene ูุฃู ูุซูู ูุฌูุงุฒ ุ ูุงุณุชุฏุนุงุก ุงููุธุงุฆู ุงูุฃุตููุฉ ูู ุฌูุงุฒ ุงูุงุณุชูุจุงู.  ูุญู ูุง ูุนุฑู ุงูููุงู ูู ุงูููุฏ ุญูุซ ูุฃูู ูุชู ุงุณุชุฏุนุงุก ูุฐู ุงููุธุงุฆู ุ ูู ุฃู ููุถูุน. <br><br>  ุจุงููุธุฑ ุฅูู ูุธุงุฆู Present ู EndScene ุ ูุฑู ุฃููุง ุธุงูุฑูุฉ.  ููุงู ุญุงุฌุฉ ุฅูู ูุธุงุฆู ุงูุชุฑุงุถูุฉ ูุชุฌุงูุฒ ุณููู ุงููุฆุฉ ุงูุฃุตู.  ุชุนุชุจุฑ ุงูุฏุงูุงุช ุงูุงูุชุฑุงุถูุฉ ุ ุจุงูุฅุถุงูุฉ ุฅูู ุงูุฏูุงู ุบูุฑ ุงูุงูุชุฑุงุถูุฉ ุ ูุคุดุฑูุง ุนูู ุฐุงูุฑุฉ ูุชู ูููุง ูุชุงุจุฉ ุฑููุฒ ุงูุดูุฑุฉ ูููู ุงููุณูุทุฉ.  ูุธุฑูุง ูุงุฎุชูุงู ุงููุธุงุฆู ุงูุงูุชุฑุงุถูุฉ ุจูู ุงููุฑุซุฉ ูุงูุขุจุงุก ุ ูุฅู ูุฏููู ูุคุดุฑุงุช ูุฎุชููุฉ (ูุฐู ูุธุงุฆู ูุฎุชููุฉ ุชูุงููุง) ููุชู ุชุฎุฒูููุง ูู ุฌุฏูู ุงูุฃุณุงููุจ ุงูุงูุชุฑุงุถูุฉ (VMT).  ูุชู ุชุฎุฒูู ูุฐุง ุงูุฌุฏูู ูู ุงูุฐุงูุฑุฉ ููู ูุคุดุฑ ููุคุดุฑ ุงููุตู ุ ููุฌุฏู ููุฌูุงุฒ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">Device* device = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Device(); <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> vmt = **(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>**)&amp;device;</code> </pre> <br>  ูุฎุฒู VMT ุงููุคุดุฑุงุช ุฅูู ูุธุงุฆู ุงูุชุฑุงุถูุฉ ุ ุฅุฐุง ููุง ูุฑูุฏ ุฃู ูุฑุซ ูู ุงูุฌูุงุฒ ุ ูุฅู ุงููุฑูุซ ุณูุญุชูู ุนูู VMT.  ูุฎุฒู VMT ูุคุดุฑุงุช ุงูุฏุงูุฉ ุจุงูุชุชุงุจุน ุจุฎุทูุฉ ูุณุงููุฉ ูุญุฌู ุงููุคุดุฑ (ุจุงููุณุจุฉ ุฅูู x86 ุ ูููู 4 ุจุงูุช ุ ุจุงููุณุจุฉ ุฅูู x64 ูู 8) ุ ุจูุง ูุชูุงูู ูุน ุงูุชุฑุชูุจ ุงูุฐู ุชู ุชุนุฑูู ุงููุธููุฉ ุจู ูู ุงููุตู.  ุงุจุญุซ ุนู ุงููุคุดุฑุงุช ุฅูู ุงูุฏุงูุชูู ุงูุญุงููุฉ ู EndScene ุ ูุงูููุฌูุฏุฉ ูู ุงูููุงููู ุงูุซุงูุซ ูุงูุฑุงุจุน: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">typedef</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*pPresent)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Device*)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">typedef</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*pEndScene)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Device*, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> j)</span></span></span></span>; pPresent ptrPresent = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; pEndScene ptrEndScene = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//declare Device and find pointer vmt ptrPresent = (pPresent)(*(unsigned long long*)(vmt + 8 * 3)); ptrEndScene = (pEndScene)(*(unsigned long long*)(vmt + 8 * 4)); }</span></span></code> </pre> <br>  ูู ุงูููู ุฃูุถูุง ุฃู ูุญุชูู ูุคุดุฑ ุฃุณููุจ ุงููุฆุฉ ุนูู ุงููุณูุทุฉ ุงูุฃููู ููุฑุฌุน ุฅูู ูุซูู ุงููุฆุฉ.  ูู C ++ ุ C # ุ ูุชู ุฅุฎูุงุก ูุฐุง ููุง ุ ูุงููุนูู ูุนุฑู ุนูู - ูู ุจูุซูู ุชุชู ุงูุฅุดุงุฑุฉ ุฅูู ุงูููุณ ุตุฑุงุญุฉ ุจูุงุณุทุฉ ุงููุนููุฉ ุงูุฃููู ูู ุทุฑููุฉ ุงููุตู.  ุงููุฒูุฏ ุนู ุงุชูุงููุฉ ุงูุงุชุตุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> ุ ุชุญุชุงุฌ ุฅูู ุงูุจุญุซ ุนู ูุฐุง ุงูุงุชุตุงู. <br><br>  ุถุน ูู ุงุนุชุจุงุฑู ุงูุชุนูููุงุช e9 ff 3a fd ff - ููุง e9 ูู ุดูุฑุฉ ุชุดุบูู (ูุน ุฑููุฒ ุชุนุจูุฑ JMP) ุชุฎุจุฑ ุงููุนุงูุฌ ุจุชุบููุฑ ุงููุคุดุฑ ุฅูู ุงูุชุนูููุงุช (EIP for x86 ุ RIP ูู x64) ุ ุงูุชูู ูู ุงูุนููุงู ุงูุญุงูู ุฅูู FFFD3AFF (4294785791).  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฃูุถูุง ุฅูู ุฃู ุฃุฑูุงู ุงูุฐุงูุฑุฉ ูุชู ุชุฎุฒูููุง "ุจุงูุนูุณ".  ูุธุงุฆู ููุง ููุฏูุฉ ู epilogue ููุชู ุชุฎุฒูููุง ูู ูุณู .code.  ุฏุนููุง ูุฑู ูุง ูุชู ุชุฎุฒููู ูุน ุงููุคุดุฑ ุฅูู ูุธููุฉ ุงูุญุงุถุฑ ุจุงุณุชุฎุฏุงู ุงููุงุณุญ ุงูุถูุฆู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">IScanner* scan = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConsoleScanner(); scan-&gt;PrintMemory(<span class="hljs-string"><span class="hljs-string">"Present"</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*)ptrPresent, <span class="hljs-number"><span class="hljs-number">30</span></span>);</code> </pre> <br>  ูู ูุญุฏุฉ ุงูุชุญูู ูุฑู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Present: 48 89 4c 24 8 48 83 ec 28 48 8d 15 40 4a 0 0 48 8b d 71 47 0 0 e8 64 10 0 0 48 8d</code> </pre> <br>  ูููู ูุฌููุนุฉ ูุฐู ุงูุฑููุฒ ุ ููููู ุฅููุงุก ูุธุฑุฉ ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฌุฏูู</a> ุ ุฃู ุงุณุชุฎุฏุงู ุฃุฏูุงุช ุงูุชูููู ุงููุชุงุญุฉ.  ุณูู ูุฃุฎุฐ ูููู ุชูููู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฌุงูุฒ</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">hde</a> (ูุญุฑู ูุฑุตุงู ูุชุณูู).  ููููู ุฃูุถูุง ุฅููุงุก ูุธุฑุฉ ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุชุดููุด ูุงูุชุชููุฌ</a> ููููุงุฑูุฉ.  ูู ุจุชูุฑูุฑ ูุคุดุฑ ุฅูู ุฅุญุฏู ุงููุธุงุฆู ุฅูู ุฃู ุฃุฏุงุฉ ูู ุงูุดูุฑุฉ ูุณูู ูุญุฏุฏ ูุงููุฉ ุงูุดูุฑุงุช ุงูุชู ูุณุชุฎุฏููุง ุ ูููู ุงููุณุงุฆุท ุ ููุง ุฅูู ุฐูู. <br><br><h4 style=";text-align:right;direction:rtl">  7.4.1 ุดูุฑุฉ ุงูุชุดุบูู </h4><br>  ุงูุขู ูุญู ุนูู ุงุณุชุนุฏุงุฏ ููุฐูุงุจ ูุจุงุดุฑุฉ ุฅูู ุงููุฎุงุฎ.  ุณูู ูููู ูุธุฑุฉ ุนูู Opcode Hook ู Hardware Breakpoint.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุฎุงุฎ</a> ุงูุฃูุซุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุดููุนูุง</a> ุงูุชู ุฃูุตู ุจุชูููุฐูุง ูุงุณุชูุดุงููุง. <br><br>  ุฑุจูุง ูููู ูุตูุฏุฉ Opcode Hook ุงูุฃูุซุฑ ุงุณุชุฎุฏุงููุง ูุจุณูุทุฉ (ูู ูุตุงุฆุฏ ููุงุฆู ุงูููุงูุงุช ุ ูุทูู ุนููู Byte patching) - ูุงุญุธ ุฃูู ูููู ุงูุชุนุฑู ุนููู ุจุณูููุฉ ุนู ุทุฑูู ููุงูุญุฉ ุงูุบุด ุนูุฏ ุณูุก ุงูุงุณุชุฎุฏุงู (ุฏูู ููู ููููุฉ ุนูู ูุถุงุฏุงุช ุงูุบุด ุ ุฏูู ูุนุฑูุฉ ูุง ูู ูุฌุงู ููุณู ุงูุฐุงูุฑุฉ ุงูุฐู ูููู ุจูุณุญูุง ูู ุงููุญุธุฉ ุงูุญุงููุฉ ูุฃุดูุงุก ุฃุฎุฑู ุงูุญุธุฑ ูู ุชุจุทุฆ ูู ุงูุงูุชุธุงุฑ).  ุนูุฏ ุงุณุชุฎุฏุงูู ุจููุงุฑุฉ ุ ูุฐุง ูุฎ ูุจูุฑ ูุณุฑูุน ูุณูู ุงูููู. <br>  ุฅุฐุง ููุช ุชูุฑุฃ ููุงูุงู ุชููู ุจุชุดุบูู ุงูููุฏ ุนููู ูู ููุณ ุงูููุช ูููุช ูู ูุถุน ุงูุชุตุญูุญ ุ ูุงูุชูู ุฅูู ุงูุฅุตุฏุงุฑ - ูุฐุง ุฃูุฑ ููู. <br><br>  ูุฐูู ุ ุงุณูุญูุง ูู ุฃู ุฃุฐูุฑู ุ ูุญู ุจุญุงุฌุฉ ุฅูู ุงุนุชุฑุงุถ ุชูููุฐ ูุธุงุฆู Present ู EndScene. <br>  ูุญู ูุทุจู ุงุนุชุฑุงุถ - ูุธุงุฆู ุญูุซ ูุฑูุฏ ููู ุงูุณูุทุฑุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PresentHook</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Device* device)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"PresentHook"</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EndSceneHook</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Device* device, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> j)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"EndSceneHook"</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">" "</span></span> &lt;&lt; j &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; }</code> </pre> <br>  ุฏุนููุง ูููุฑ ูู ุงูุชุฌุฑูุฏุงุช ุงูุชู ูุญุชุงุฌูุง.  ูุญุชุงุฌ ุฅูู ูุงุฌูุฉ ุณุชููููุง ูู ุชุนููู ูุฎ ูุฅุฒุงูุชู ูุชูุฏูู ูุนูููุงุช ุนูู.  ูุฌุจ ุฃู ุชุญุชูู ูุนูููุงุช ุญูู ุงูููุงุกูุฉ ุนูู ูุคุดุฑ ููุงุนุชุฑุงุถ ุนูู ุงููุธููุฉ ุ ูุงููุชููู ููุธุงุฆู ููุทุฉ ุงูุงูุทูุงู (ุญูููุฉ ุฃููุง ุงุนุชุฑุถูุง ูุฐู ุงููุธููุฉ ูุง ุชุนูู ุฃูู ูู ุชุนุฏ ููุงู ุญุงุฌุฉ ุฅูููุง ุ ููุญู ูุฑูุฏ ุฃูุถูุง ุฃู ูููู ูุงุฏุฑูู ุนูู ุงุณุชุฎุฏุงููุง - ูุฅู ููุทุฉ ุงูุงูุทูุงู ุณุชุณุงุนุฏ ูู ุงุณุชุฏุนุงุก ุงููุธููุฉ ุงููุนุชุฑุถุฉ ุงูุฃุตููุฉ). <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> pack(push, 1) struct HookRecord { HookRecord() { reservationLen = 0; sourceReservation = new void*[RESERV_SIZE](); } ~HookRecord() { reservationLen = 0; delete[] sourceReservation; } void* source; void* destination; void* pTrampoline; int reservationLen; void* sourceReservation; }; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> pack(pop) class IHook { protected: IHook() {} public: virtual ~IHook() {} virtual void SetExceptionHandler( PVECTORED_EXCEPTION_HANDLER pVecExcHandler) = 0; virtual int SetHook(void* source, void* destination) = 0; virtual int UnsetHook(void* source) = 0; virtual silk_data::Vector</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;HookRecord*&gt;* GetInfo() = 0; virtual HookRecord* GetRecordBySource(void* source) = 0; };</span></span></span></span></code> </pre> <br>  ุชููุฑ ููุง ูุงุฌูุฉ IHook ูุฐู ุงููุฏุฑุงุช.  ูุฑูุฏ ุฃูู ุนูุฏูุง ูุณุชุฏุนู ุฃู ูุซูู ููุฆุฉ ุงูุฌูุงุฒ ุงูุฏุงูุชูู Present ู EndScene (ุฃู ุฃู ูุคุดุฑ RIP ููุชูู ุฅูู ูุฐูู ุงูุนููุงููู) ุ ูุชู ุชูููุฐ ุงูุฏุงูุชูู PresentHook ู EndSceneHook ูุฏููุง ููููุง ูุฐูู. <br><br>  ุชุฎูู ุจุตุฑููุง ููู ุชูุฌุฏ ุงููุธููุฉ ุงููุนุชุฑุถุฉ ูุงููุณุชูุจู ูุงูููุญุฉ ุงูุฑุฆูุณูุฉ ูู ุงูุฐุงูุฑุฉ (ูุณู ุงูุฑูุฒ.) ูู ุงูููุช ุงูุฐู ูุฏุฎู ููู ุนูุตุฑ ุงูุชุญูู ุงููุธููุฉ ุงููุนุชุฑุถุฉ: <br><br><img src="https://habrastorage.org/webt/rc/sz/dw/rcszdw_mh77t0jlxithbmseq5i8.png"><br>  <i>ุงูุดูู 6 - ุงูุญุงูุฉ ุงูุฃูููุฉ ููุฐุงูุฑุฉ ุ ูุฐูุจ ุงูุชูููุฐ ุฅูู ุงููุธููุฉ ุงููุนุชุฑุถุฉ</i> <br><br>  ุงูุขู ูุฑูุฏ ุฃู ููุชูู RIP (ุงูุณูู ุงูุฃุญูุฑ) ูู ุงููุตุฏุฑ ุฅูู ุจุฏุงูุฉ ุงููุฌูุฉ.  ููู ููุนู ุฐููุ  ููุง ุฐูุฑูุง ุฃุนูุงู ุ ุชุญุชูู ุงูุฐุงูุฑุฉ ุงููุตุฏุฑ ุนูู ุดูุฑุฉ ุชุดุบูู ุณูู ูููุฐูุง ุงููุนุงูุฌ ุนูุฏูุง ูุตู ุงูุชูููุฐ ุฅูู ุงููุตุฏุฑ.  ูู ุฌููุฑ ุงูุฃูุฑ ุ ูุญุชุงุฌ ุฅูู ุงูุงูุชูุงู ูู ุฌุฒุก ุฅูู ุขุฎุฑ ุ ูุฅุนุงุฏุฉ ุชูุฌูู ูุคุดุฑ RIP.  ููุง ูุฏ ุชููู ุฎููุช ุ ููุงู ุดูุฑุฉ ุชุดุบูู ุชุณูุญ ูู ุจููู ุงูุชุญูู ูู ุงูุนููุงู ุงูุญุงูู ุฅูู ุงูุนููุงู ุงููุฑุบูุจ ููู ุ ููุฐุง ูุง ูุณูู ุงุฎุชุตุงุฑุงุช JMP. <br><br>  ููููู ุงูุงูุชูุงู ูุจุงุดุฑุฉ ุฅูู ุงูุนููุงู ุงููุทููุจ ุ ุฃู ุจุงููุณุจุฉ ุฅูู ุงูุนููุงู ุงูุญุงูู ุ ูููู ุงูุนุซูุฑ ุนูู ูุฐู ุงูููุฒุงุช ูู ุงูููุญุฉ - ff ู e9 ุ ุนูู ุงูุชูุงูู.  ุฅูุดุงุก ููุงูู ููุฐู ุงูุชุนูููุงุช: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> pack(push, 1) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// 32-bit relative jump. typedef struct { unsigned char opcode; unsigned int delta; } JMP_REL; // 64-bit absolute jump. typedef struct { unsigned char opcode1; unsigned char opcode2; unsigned int dummy; unsigned long long address; } JMP_ABS; #pragma pack(pop)</span></span></span></span></code> </pre> <br>  ุชุนูููุงุช ุงูููุฒ ุงููุณุจู ุฃูุตุฑ ุ ูููู ููุงู ูููุฏ - ูููู int ุบูุฑ ุงููููุนุฉ ุฃูู ููููู ุงูููุฒ ูู ุญุฏูุฏ 4ุ294ุ967ุ295 ุ ููู ูุง ูุง ูููู ูู x64. <br>  ููููุง ูุฐูู ุ ูููู ุฃู ูุชุฌุงูุฒ ุนููุงู ูุธููุฉ ุงููุฌูุฉ ูู ุฌูุงุฒ ุงูุงุณุชูุจุงู ุงููุฌูุฉ ูุฐู ุงููููุฉ ุจุณูููุฉ ูุฃู ูููู ุฎุงุฑุฌ ุนูุงูุฉ int ุบูุฑ ุงููููุนุฉ ุ ููู ุฃูุฑ ูููู ุชูุงููุง ูุนูููุฉ x64 (ูุฃู x86 ูู ุดูุก ุฃุจุณุท ุจูุซูุฑ ูููููู ุชูููุฏ ููุณู ุจูุฐู ุงูููุฒุฉ ุงููุณุจูุฉ ููุบุงูุฉ ูุชูููุฐ ุฑุจุท Opcode).  ุชุณุชุบุฑู ุงูููุฒุฉ ุงููุจุงุดุฑุฉ 14 ุจุงูุชูุง ุ ููููุงุฑูุฉ ุ ุงูููุฒุฉ ุงููุณุจูุฉ ูู 5 ููุท (ูููุง ุจุชุนุจุฆุฉ ุงูููุงูู ุ ูุน ุงูุงูุชุจุงู ุฅูู # pragma pack (push ุ 1)). <br><br>  ูุญุชุงุฌ ุฅูู ุฅุนุงุฏุฉ ูุชุงุจุฉ ุงููููุฉ ูู ุงููุตุฏุฑ ุฅูู ุฃุญุฏ ุฅุฑุดุงุฏุงุช ุงูููุฒุงุช ูุฐู. <br>  ูุจู ุฃู ุชุญุตู ุนูู ูุธููุฉ ุ ูุฌุจ ุฃู ุชุฏุฑุณูุง - ุฃุณูู ุทุฑููุฉ ููููุงู ุจุฐูู ูู ูุน ูุตุญุญ ุฃุฎุทุงุก (ุณุฃุฑููู ููููุฉ ุงูููุงู ุจุฐูู ุจุงุณุชุฎุฏุงู x64dbg ูุงุญููุง) ุ ุฃู ูุน ุฃุฏุงุฉ ูู ุชุฌููุน.  ูู ุงูููุช ุงูุญุงุถุฑ ุ ูุฎุฑุฌ ุจุงููุนู 30 ุจุงูุช ูู ุจุฏุงูุชูุง ุ ุชุญุชู ุงูุชุนูููุงุช 48 89 4c 24 8 5 ุจุงูุช. <br>  ุฏุนูุง ูููุฐ ููุฒุฉ ูุณุจูุฉ.  ุฃูุง ุฃุญุจ ูุฐุง ุงูุฎูุงุฑ ุฃูุซุฑ ุจุณุจุจ ุทูู ุงูุชุนูููุงุช.  ุงูููุฑุฉ ูู: ูุญู ูุณุชุจุฏู ุงูุจุงูุชุงุช ุงูุฎูุณุฉ ุงูุฃููู ูู ุงููุธููุฉ ุงูุฃุตููุฉ ุ ูุน ุงูุญูุงุธ ุนูู ุงูุจุงูุชุงุช ุงูุชู ุชู ุชุบููุฑูุง ุ ูุงุณุชุจุฏุงููุง ุจููุทุฉ ูุณุจูุฉ ุฅูู ุนููุงู ุงูุชุนูููุงุช ุ ูุงูุชู ุชูุน ุฏุงุฎู int ุบูุฑ ุงููููุนุฉ. <br><br><img src="https://habrastorage.org/webt/sp/vm/gs/spvmgsf5iymwkeyncackpgaldty.png"><br>  <i>ุงูุดูู 7 - ูุชู ุงุณุชุจุฏุงู ูุตุฏุฑ 5 ุจุงูุช ูู ูุธููุฉ ุงููุตุฏุฑ ุจูุงุณุทุฉ ููุฒุฉ ูุณุจูุฉ</i> <br><br>  ูุง ุงูุฐู ูุนุทููุง ููุฒุฉ ุฅูู ุงูุฐุงูุฑุฉ ุงููุฎุตุตุฉ (ุงูููุทูุฉ ุงูุฃุฑุฌูุงูู) ุ ููู ุงูุชุฑุจูุง ูู ููู ุงูุชุญูู ุฅูู ุงููุฌูุฉ ุจุงุณุชุฎุฏุงู ูุฐุง ุงูุฅุฌุฑุงุกุ  ูู ุงูุฐุงูุฑุฉ ุงููุฎุตุตุฉ ูู ูุจููุง ุ ููุงู ููุฒุฉ ูุจุงุดุฑุฉ ุ ูุงูุชู ุณูู ุชููู RIP ุฅูู ุงููุฌูุฉ. <br><br><img src="https://habrastorage.org/webt/nl/-c/u2/nl-cu2sfhlsg-7nvfdmkzmlz8fq.png"><br>  <i>ุงูุดูู 8 - ุชุญููู RIP ุฅูู ูุธููุฉ ุงููุณุชูุจู</i> <br><br>  ูุจูู ููุนุฑูุฉ ููููุฉ ุงุณุชุฏุนุงุก ูุธููุฉ ุงุดุชุนูุช.  ูุญุชุงุฌ ุฅูู ุชูููุฐ ุงูุชุนูููุงุช ุงููุญุดูุฑุฉ ูุจุฏุก ุงูุชูููุฐ ูู ุงูุฌุฒุก ุงูุฐู ูู ููุณูุง ุงููุตุฏุฑ.  ููุถู ุนูู ุงููุญู ุงูุชุงูู - ุงุญูุธ ุงูุฅุฑุดุงุฏุงุช ุงูุชุงููุฉ ุฅูู ุจุฏุงูุฉ ุงูุชุฑุงูุจูููู ุ ูุชุฐูุฑ ุนุฏุฏ ุงูุจุงูุชุงุช ุงูุชู ุชุนุฑุถุช ููุชูู ูุงูููุฒ ูุจุงุดุฑุฉ ุฅูู ุงููุตุฏุฑ + ุงููุงุณุฏูู ุ ุฅูู ุงูุฅุฑุดุงุฏุงุช "ุงูุตุญูุฉ". <br><br>  ุชูููุฐ ุงูุชุนูููุงุช ุงููุญููุธุฉ ุชูุญู ุจูุงุณุทุฉ ููุฒุฉ ูุณุจูุฉ: <br><br><img src="https://habrastorage.org/webt/ea/yt/yc/eaytyckn1czk5ud3iid3fagbey0.png"><br>  <i>ุงูุดูู 9 - ุงุณุชุฎุฏุงู ููุทุฉ ุงูุทูุงู ูุงุณุชุฏุนุงุก ุฏุงูุฉ ุชู ุงุนุชุฑุงุถูุง</i> <br><br>  ุชูููุฐ ุฅุถุงูู ููุชุนูููุงุช ุงูุชู ูู ุชุคุซุฑ ุนูู ุงููุฒุฌ: <br><br><img src="https://habrastorage.org/webt/mh/7f/-w/mh7f-wck4tzh20cj7jefie3yl3q.png"><br>  <i>ุงูุดูู 10 - ุงุณุชูุฑุงุฑ ุชูููุฐ ุชุนูููุงุช ุงููุธููุฉ ุงููุนุชุฑุถุฉ</i> <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุฏููุฉ ุชูููุฐ ุงูููุฑุฉ ุงููุฐููุฑุฉ ุฃุนูุงู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> OpcodeHook::SetHook(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* source, <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* destination) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> record = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HookRecord(); record-&gt;source = source; record-&gt;destination = destination; info-&gt;PushBack(record); JMP_ABS pattern = {<span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x25</span></span>, <span class="hljs-number"><span class="hljs-number">0x00000000</span></span>, <span class="hljs-comment"><span class="hljs-comment">// JMP[RIP + 6] empty 0x0000000000000000 }; // absolute address pattern.address = (ULONG_PTR)source; int currentLen = 0; int redLine = sizeof(JMP_REL); while (currentLen &lt; redLine) { hde64s context; const void* pSource = (void*)((unsigned char*)source + currentLen); hde64_disasm(pSource, &amp;context); memcpy((unsigned char*)record-&gt;sourceReservation + currentLen, pSource, context.len); record-&gt;reservationLen += context.len; currentLen += context.len; } int trampolineMemorySize = 2 * sizeof(JMP_ABS) + record-&gt;reservationLen; record-&gt;pTrampoline = AllocateMemory(source, trampolineMemorySize); pattern.address = (unsigned long long)(unsigned char*)source + record-&gt;reservationLen; memcpy((unsigned char*)record-&gt;pTrampoline, record-&gt;sourceReservation, record-&gt;reservationLen); int offset = record-&gt;reservationLen; memcpy((unsigned char*)record-&gt;pTrampoline + offset, &amp;pattern, sizeof(JMP_ABS)); pattern.address = (ULONG_PTR)destination; ULONG_PTR relay = (ULONG_PTR)record-&gt;pTrampoline + sizeof(pattern) + record-&gt;reservationLen; memcpy((void*)relay, &amp;pattern, sizeof(pattern)); DWORD oldProtect = 0; VirtualProtect(source, sizeof(JMP_REL), PAGE_EXECUTE_READWRITE, &amp;oldProtect); JMP_REL* pJmpRelPattern = (JMP_REL*)source; pJmpRelPattern-&gt;opcode = 0xE9; pJmpRelPattern-&gt;delta = (unsigned int)((LPBYTE)relay - ((LPBYTE)source + sizeof(JMP_REL))); VirtualProtect(source, sizeof(JMP_REL), oldProtect, &amp;oldProtect); return SUCCESS_CODE; }</span></span></code> </pre> <br></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุดุฑุญ ูุธููุฉ SetHook</b> <div class="spoiler_text" style=";text-align:right;direction:rtl">  ูุชู ุฅูุดุงุก ุณุฌู ูุฎุฒูู ูุนูููุงุช ุญูู ุงูููุงุกูุฉ ุ ูุจุนุฏ ุฐูู ูุถุงู ุงูุณุฌู ุฅูู ุงููุฌููุนุฉ.  ูุชู ุงูุฒุญู ุฅูู ุงูุชุนูููุงุช ูู ุจุฏุงูุฉ ุนููุงู ุงููุตุฏุฑ ุญุชู ูููู ุฅุฏุฎุงู ุชุนูููุฉ ุงูุงูุชูุงู ุงููุณุจูุฉ ุจุงููุงูู (5 ุจุงูุช) ุ ููุชู ูุณุฎ ุงูุชุนูููุงุช ุงููุญุดูุฑุฉ ุฅูู ุงูุญุฌุฒ ุ ูููุฐูุฑ ุทูููุง. <br><blockquote style=";text-align:right;direction:rtl">  ููุงู ููุทุฉ ูููุฉ ููุบุงูุฉ ููู ุฃููุง ูุญุชุงุฌ ุฅูู ุชุฎุตูุต ุฐุงูุฑุฉ ููููุฒุฉ ูุงูุชุฑุญูู ุ ุญูุซ ุณูููู ุจุชุฎุฒูู ุงูุฅุฑุดุงุฏุงุช ุงูุฎุงุตุฉ ุจุฅุนุงุฏุฉ ุชูุฌูู ุงูุฏูู ูู ุงููุตุฏุฑ ุฅูู ุงููุฌูุฉ ุ ููุฌุจ ุฃู ูููู ุนููุงู ูุฐู ุงูุฐุงูุฑุฉ ุถูู ุงูุญุฏูุฏ ุงูุชู ูููู ููููุฒุฉ ุงููุณุจูุฉ ุงูุงูุชูุงู ุฅูููุง (ุบูุฑ ูููุนุฉ) ุงูุจุงุญุซ). </blockquote><br>  ุชุทุจู ูุฐู ุงููุธููุฉ ุงูุฏุงูุฉ AllocateMemory. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* OpcodeHook::AllocateMemory(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* origin, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> MEMORY_RANGE = <span class="hljs-number"><span class="hljs-number">0x40000000</span></span>; SYSTEM_INFO sysInfo; GetSystemInfo(&amp;sysInfo); ULONG_PTR minAddr = (ULONG_PTR)sysInfo.lpMinimumApplicationAddress; ULONG_PTR maxAddr = (ULONG_PTR)sysInfo.lpMaximumApplicationAddress; ULONG_PTR castedOrigin = (ULONG_PTR)origin; ULONG_PTR minDesired = castedOrigin - MEMORY_RANGE; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (minDesired &gt; minAddr &amp;&amp; minDesired &lt; castedOrigin) minAddr = minDesired; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> test = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(ULONG_PTR); ULONG_PTR maxDesired = castedOrigin + MEMORY_RANGE - size; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maxDesired &lt; maxAddr &amp;&amp; maxDesired &gt; castedOrigin) maxAddr = maxDesired; DWORD granularity = sysInfo.dwAllocationGranularity; ULONG_PTR freeMemory = <span class="hljs-number"><span class="hljs-number">0</span></span>; ULONG_PTR ptr = castedOrigin; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (ptr &gt;= minAddr) { ptr = FindPrev(ptr, minAddr, granularity, size); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ptr == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; LPVOID pAlloc = VirtualAlloc((LPVOID)ptr, size, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pAlloc != <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> pAlloc; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (ptr &lt; maxAddr) { ptr = FindNext(ptr, maxAddr, granularity, size); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ptr == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; LPVOID pAlloc = VirtualAlloc((LPVOID)ptr, size, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pAlloc != <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> pAlloc; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; }</code> </pre> <br>  ุงูููุฑุฉ ุจุณูุทุฉ - ุณููุชูู ูู ุงูุฐุงูุฑุฉ ุ ุจุฏุกูุง ูู ุนููุงู ูุนูู (ูู ุญุงูุชูุง ุ ูุคุดุฑ ุฅูู ุงููุตุฏุฑ) ูุฃุนูู ููุฃุณูู ุญุชู ูุนุซุฑ ุนูู ุญุฌู ููุงุณุจ ูุฌุงูู. <br><br>  ุงูุนูุฏุฉ ุฅูู ูุธููุฉ SetHook.  ุงูุณุฎ ุงูุจุงูุชุงุช ุงูุจุงููุฉ ูู ุงููุตุฏุฑ ุฅูู ุงูุฐุงูุฑุฉ ุงููุฎุตุตุฉ ูุฃุฏุฎู ุนูู ุงูููุฑ ููุฒุฉ ูุจุงุดุฑุฉ ุฅูู ุงููุตุฏุฑ + ุชุงููุฉ ูููุงุตูุฉ ุงูุชูููุฐ ุจุชุนูููุงุช ุบูุฑ ุชุงููุฉ. <br><br>  ุงูุชุงูู ูู ุชุซุจูุช ูุคุดุฑ ุงูุชุฑุญูู ุ ููู ุงููุณุคูู ุนู ุฅุนุงุฏุฉ ุชูุฌูู ูุคุดุฑ ุชุฑุงุจุท ุงูุชูููุฐ ุฅูู ุงููุฌูุฉ ูู ุฎูุงู ุงูููุฒ ูุจุงุดุฑุฉ ุฅูู ุนููุงู ุงููุณุชูุจู.  ูู ุงูููุงูุฉ ุ ูููู ุจุชุบููุฑ ุงููุตุฏุฑ - ูููู ุจุชุนููู ุฃุฐููุงุช ุงููุชุงุจุฉ ุฅูู ููุงู ุงูุฐุงูุฑุฉ ุญูุซ ุชูุฌุฏ ุงููุธููุฉ ูุงุณุชุจุฏุงู ุงูุจุงูุชุงุช ุงูุฎูุณุฉ ุงูุฃููู ุจููุฒุฉ ูุณุจูุฉ ุชุคุฏู ุฅูู ุนููุงู ุงูุชุฑุญูู. <br></div></div><br>  ูุถุนูุง ูุฎูุง ุ ูููู ูุญุชุงุฌ ุฃูุถูุง ุฅูู ุฃู ูููู ูุงุฏุฑูุง ุนูู ุงูุชูุธูู.  ุงูููุฑ - ูููุณ ุงูุจูุงุก ุ ุงูููุฑุฉ ุจุณูุทุฉ - ุณูููู ุจุฅุฑุฌุงุน ุงูุจุงูุชุงุช ุงููุชูุงููุฉ ูููุตุฏุฑ ุ ูุญุฐู ุงูุณุฌู ุงูุฎุงุต ุจุงููุตูุฏุฉ ูู ุงููุฌููุนุฉ ุ ูุชุญุฑูุฑ ุงูุฐุงูุฑุฉ ุงููุฎุตุตุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> OpcodeHook::UnsetHook(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* source) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> record = GetRecordBySource(source); DWORD oldProtect = <span class="hljs-number"><span class="hljs-number">0</span></span>; VirtualProtect(source, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(JMP_REL), PAGE_EXECUTE_READWRITE, &amp;oldProtect); <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(source, record-&gt;sourceReservation, record-&gt;reservationLen); VirtualProtect(source, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(JMP_REL), oldProtect, &amp;oldProtect); info-&gt;Erase(record); FreeMemory(record); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> SUCCESS_CODE; }</code> </pre> <br>  ุงุฎุชุจุงุฑ ุงูุนูู.  ูู ุจุชุบููุฑ ุฃุฌูุฒุฉ ุงูุงุณุชูุจุงู ุงูุฎุงุตุฉ ุจูุง ุนูู ุงูููุฑ ุญุชู ูุชููููุง ูู ุงุณุชุฏุนุงุก ุงููุธุงุฆู ุงููุนุชุฑุถุฉ ุจุงุณุชุฎุฏุงู ููุทุฉ ุงูุงูุทูุงู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PresentHook</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Device* device)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> record = hook-&gt;GetRecordBySource(ptrPresent); pPresent pTrampoline = (pPresent)record-&gt;pTrampoline; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> result = pTrampoline(device); <span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"PresentHook"</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EndSceneHook</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Device* device, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> j)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> record = hook-&gt;GetRecordBySource(ptrEndScene); pEndScene pTrampoline = (pEndScene)record-&gt;pTrampoline; pTrampoline(device, <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"EndSceneHook"</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">" "</span></span> &lt;&lt; j &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; }</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุญู ูุฎุชุจุฑ ูุง ุฅุฐุง ููุง ูุฏ ูุนููุง ูู ุดูุก ุจุดูู ุตุญูุญ ุ ููุง ุฅุฐุง ูุงูุช ุงูุฐุงูุฑุฉ ุชุชุฏูู ุ ููุง ุฅุฐุง ูุงู ูุชู ุชูููุฐ ูู ุดูุก ุจุดูู ุตุญูุญ.</font></font></b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { Device* device = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Device(); device-&gt;i = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> vmt = **(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>**)&amp;device; ptrPresent = (pPresent)(*(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>*)(vmt + <span class="hljs-number"><span class="hljs-number">8</span></span> * <span class="hljs-number"><span class="hljs-number">3</span></span>)); ptrEndScene = (pEndScene)(*(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>*)(vmt + <span class="hljs-number"><span class="hljs-number">8</span></span> * <span class="hljs-number"><span class="hljs-number">4</span></span>)); IScanner* scan = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConsoleScanner(); scan-&gt;PrintMemory(<span class="hljs-string"><span class="hljs-string">"Present"</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*)ptrPresent, <span class="hljs-number"><span class="hljs-number">30</span></span>); hook = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OpcodeHook(); hook-&gt;SetHook(ptrPresent, &amp;PresentHook); hook-&gt;SetHook(ptrEndScene, &amp;EndSceneHook); device-&gt;Present(); device-&gt;EndScene(<span class="hljs-number"><span class="hljs-number">7</span></span>); device-&gt;Present(); device-&gt;EndScene(<span class="hljs-number"><span class="hljs-number">7</span></span>); device-&gt;i = <span class="hljs-number"><span class="hljs-number">5</span></span>; ptrPresent(device); ptrEndScene(device, <span class="hljs-number"><span class="hljs-number">9</span></span>); hook-&gt;UnsetHook(ptrPresent); hook-&gt;UnsetHook(ptrEndScene); ptrPresent(device); ptrEndScene(device, <span class="hljs-number"><span class="hljs-number">7</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> hook; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> device; } }</code> </pre> <br></div></div><br>  ุฅูู ูุนูู.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููููู ุฃูุถูุง ุงูุชุญูู ูู x64dgb. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุฐูุฑ ุ ูู ุงูุจุฏุงูุฉ ุทูุจุช ููู ุงูุนูู ูู ุฅุตุฏุงุฑ ุงูุฅุตุฏุงุฑุ </font><font style="vertical-align: inherit;">ุงุฐูุจ ุงูุขู ุฅูู Debug ููู ุจุชุดุบูู ุงูุจุฑูุงูุฌ. </font><font style="vertical-align: inherit;">ุชุนุทู ุงูุจุฑูุงูุฌ ... ูุชู ุชุดุบูู ุงููุตูุฏุฉ ุ ููู ูุญุงููุฉ ุงุณุชุฏุนุงุก ููุทุฉ ุงูุงูุทูุงู ุชุซูุฑ ุงุณุชุซูุงุกู ุ ุญูุซ ูุดูุฑ ุฅูู ุฃู ุงูุนููุงู ุงูุฐู ูุณููู ููุทุฉ ุงูุทูุงู ููุณ ููุชูููุฐ ุนูู ุงูุฅุทูุงู. </font><font style="vertical-align: inherit;">ูุงุฐุง ุงูุชูุฏูุงุ </font><font style="vertical-align: inherit;">ูุง ูู ูุดููุฉ ุจูุงุก Debugุ </font><font style="vertical-align: inherit;">ูุจุฏุฃ ูููุธุฑ ุฅูู ุดูุฑุฉ ุชุดุบูู ุงููุธููุฉ ุงูุญุงููุฉ:</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Present: e9 f4 36 0 0 e9 df 8d 0 0 e9 aa b0 0 0 e9 75 3e 0 0 e9 80 38 0 0 e9 da 81 0 0</code> </pre> <br>    x64dbg   . <br><br> <a href=""><img src="https://habrastorage.org/webt/sq/ql/ea/sqqlealqgipytxtvqo65agm9ky8.png"></a> <br> <i> 11 โ  Debug </i> <br><br>  Debug  ,      e9 f4 36 0.     ,  main      mainCRTStartup.  ,   ,      ,         ,       source. <br><br>   ,       ,        ,      , source  trampoline,  RIP    . <br><br>    ,       99% .    ,    . ,   ,     ,      .           100   ( ,    ),      ,   ,            โ    ,     ,     . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูููุฒุฉ ุงููุณุจูุฉ ุดุงุฆุนุฉ ุฌุฏูุง ุ ูุฐุง ุฃูุชุฑุญ ุชูููุฐูุง. </font><font style="vertical-align: inherit;">ุชุชููู ุงูููุฒุฉ ุงููุณุจูุฉ ูู ุดูุฑุฉ ุงูุชุดุบูู e9 ูุงููููุฉ ุงูุชู ุชุญุชุงุฌ ุฅูู ุงูุงูุชูุงู ุฅูููุง ุจุงููุณุจุฉ ุฅูู ุงูุนููุงู ุงูุญุงูู. </font><font style="vertical-align: inherit;">ููููุง ูุฐูู ุ ููููู ููุท ูุนุฑูุฉ ููุงู ุงูููุฒ ุ ูุงูููุฒ ููุงู ูุจุงุดุฑุฉู ูู ููุทุฉ ุงูุงูุทูุงู ุจุงุณุชุฎุฏุงู ููุฒุฉ ูุจุงุดุฑุฉ. </font><font style="vertical-align: inherit;">ุญุชู ูู ูุงุฌููุง ููุฒุฉ ูุณุจูุฉ ุฌุฏูุฏุฉ ููุงู ุ ูุณูููู ุฐูู ุจุงููุนู ูู ุงูุนููุงู ุงูุตุญูุญ.</font></font><br><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูููุฐ ุชุฑููุจ ุงููุฎ ูุน ูุฑุงุนุงุฉ ุงูููุฒุฉ ุงููุณุจูุฉ</font></font></b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> OpcodeHook::SetHook(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* source, <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* destination) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> record = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HookRecord(); record-&gt;source = source; record-&gt;destination = destination; info-&gt;PushBack(record); JMP_ABS pattern = {<span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x25</span></span>, <span class="hljs-number"><span class="hljs-number">0x00000000</span></span>, <span class="hljs-comment"><span class="hljs-comment">// JMP[RIP + 6] empty 0x0000000000000000 }; // address pattern.address = (ULONG_PTR)source; int currentLen = 0; bool isJmpOpcode = false; int redLine = sizeof(JMP_REL); while (currentLen &lt; redLine &amp;&amp; !isJmpOpcode) { hde64s context; const void* pSource = (void*)((unsigned char*)source + currentLen); hde64_disasm(pSource, &amp;context); if (context.opcode == 0xE9) { ULONG_PTR ripPtr = (ULONG_PTR)pSource + context.len + (INT32)context.imm.imm32; pattern.address = ripPtr; isJmpOpcode = true; } memcpy((unsigned char*)record-&gt;sourceReservation + currentLen, pSource, context.len); record-&gt;reservationLen += context.len; currentLen += context.len; } int trampolineMemorySize = isJmpOpcode ? 2 * sizeof(JMP_ABS) : 2 * sizeof(JMP_ABS) + record-&gt;reservationLen; record-&gt;pTrampoline = AllocateMemory(source, trampolineMemorySize); if (!isJmpOpcode) { pattern.address = (unsigned long long)(unsigned char*)source + record-&gt;reservationLen; memcpy((unsigned char*)record-&gt;pTrampoline, record-&gt;sourceReservation, record-&gt;reservationLen); } int offset = isJmpOpcode ? 0 : record-&gt;reservationLen; memcpy((unsigned char*)record-&gt;pTrampoline + offset, &amp;pattern, sizeof(JMP_ABS)); pattern.address = (ULONG_PTR)destination; ULONG_PTR relay = (ULONG_PTR)record-&gt;pTrampoline + sizeof(pattern) + record-&gt;reservationLen; memcpy((void*)relay, &amp;pattern, sizeof(pattern)); DWORD oldProtect = 0; VirtualProtect(source, sizeof(JMP_REL), PAGE_EXECUTE_READWRITE, &amp;oldProtect); JMP_REL* pJmpRelPattern = (JMP_REL*)source; pJmpRelPattern-&gt;opcode = 0xE9; pJmpRelPattern-&gt;delta = (unsigned int)((LPBYTE)relay - ((LPBYTE)source + sizeof(JMP_REL))); VirtualProtect(source, sizeof(JMP_REL), oldProtect, &amp;oldProtect); return SUCCESS_CODE; }</span></span></code> </pre> <br></div></div><br>      ,      e9,   ,     (ULONG_PTR ripPtr = (ULONG_PTR)pSource + context.len + (INT32)context.imm.imm32),          . <br><br>  ,       ,    /        ,    โ    .         Hardware Breakpoint. <br><br>     ,    ,    ,             โ   ,  Microsoft    Detour.            ,    - ,     ,       -      : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">PolyHook</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">MinHook</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">EasyHook</a> (     C#). <br><br><h4 style=";text-align:right;direction:rtl"> 7.4.2. Hardware Breakpoint </h4><br> Opcode Hook     ,    .       ,  Opcode Hook           ( NtSetInformationThread),   . Hardware Breakpoint  ,     .     ,  ,   VAC   โ   .   VAC          (     ,  - ). <br><blockquote style=";text-align:right;direction:rtl">    ,   ,  VAC   DR      /,  -      ,    .    HWBP  ,  -  ,     ,   ,        DR0-DR7    . </blockquote> HWBP        .         DR0-DR7  RIP      ,   DR0-DR3,  ,   ,       ,          โ    .      ,               ,      ,       /   ,   .          BaseThreadInitThunk,    4      .     ,     PageGuard. <br><br> ,      โ     ( Sandbox),     Device Present  EndScene,     .        โ IHook,     ยซยป  . <br><br>  :   ยซยป  DR0-DR3,     ,       DR7   ,           EXCEPTION_SINGLE_STEP,        .    SEH ,   VEH โ   ,      . <br><br>   : <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> HardwareBPHook::SetHook(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* source, <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* destination, HANDLE* hThread, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* reg) { CONTEXT context; ZeroMemory(&amp;context, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(context)); context.ContextFlags = CONTEXT_DEBUG_REGISTERS; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!GetThreadContext(*hThread, &amp;context)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ERROR_GET_CONTEXT; *(&amp;context.Dr0 + *reg) = (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)source; context.Dr7 |= <span class="hljs-number"><span class="hljs-number">1U</span></span>LL &lt;&lt; (<span class="hljs-number"><span class="hljs-number">2</span></span> * (*reg)); context.Dr7 |= HW_EXECUTE &lt;&lt; ((*reg) * <span class="hljs-number"><span class="hljs-number">4</span></span> + <span class="hljs-number"><span class="hljs-number">16</span></span>); context.Dr7 |= HW_LENGTH &lt;&lt; ((*reg) * <span class="hljs-number"><span class="hljs-number">4</span></span> + <span class="hljs-number"><span class="hljs-number">18</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!SetThreadContext(*hThread, &amp;context)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ERROR_SET_CONTEXT; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> SUCCESS_CODE; }</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">   </b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชููู ูุฐุง ุงูุฑูุฒ ุณูุงู ุณูุณูุฉ ุฑุณุงุฆู ูุญุฏุฏุฉ ุ ุนูุฏ ุงูุงุณุชูุงู ุงููุงุฌุญ ุ ูุฏุฑุฌ ุนููุงู ุงููุธููุฉ ุงูุชู ูุชู ุงุนุชุฑุงุถูุง ูู ุณุฌู ูุฌุงูู ุ ููููู ุจุชุนููู ุณุฌู ุงูุชุญูู DR7. </font><font style="vertical-align: inherit;">ุฃุฎูุฑูุง ุ ูุชู ุชุนููู ุงูุณูุงู ุงูุฐู ุชู ุชุบููุฑู.</font></font><br></div></div><br>   ,     DR6  DR7,     PageGuard    Gray Hat Python: Python Programming for Hackers and Reverse Engineers. , DR7 /  ยซยป  โ   -   DR0-DR3   ,   DR7     ,     .  DR7     ,      โ   ,           (   ). <br><br>           DR7. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> HardwareBPHook::UnsetHook(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* source, HANDLE* hThread) { CONTEXT context; ZeroMemory(&amp;context, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(context)); context.ContextFlags = CONTEXT_DEBUG_REGISTERS; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!GetThreadContext(*hThread, &amp;context)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ERROR_GET_CONTEXT; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; DEBUG_REG_COUNT; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)source == *(&amp;context.Dr0 + i)) { info-&gt;GetItem(i)-&gt;source = <span class="hljs-number"><span class="hljs-number">0</span></span>; *(&amp;context.Dr0 + i) = <span class="hljs-number"><span class="hljs-number">0</span></span>; context.Dr7 &amp;= ~(<span class="hljs-number"><span class="hljs-number">1U</span></span>LL &lt;&lt; (<span class="hljs-number"><span class="hljs-number">2</span></span> * i)); context.Dr7 &amp;= ~(<span class="hljs-number"><span class="hljs-number">3</span></span> &lt;&lt; (i * <span class="hljs-number"><span class="hljs-number">4</span></span> + <span class="hljs-number"><span class="hljs-number">16</span></span>)); context.Dr7 &amp;= ~(<span class="hljs-number"><span class="hljs-number">3</span></span> &lt;&lt; (i * <span class="hljs-number"><span class="hljs-number">4</span></span> + <span class="hljs-number"><span class="hljs-number">18</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!SetThreadContext(*hThread, &amp;context)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ERROR_SET_CONTEXT; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> SUCCESS_CODE; }</code> </pre> <br>     โ       ,    .       . <br><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">     .</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> HardwareBPHook::SetHook(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* source, <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* destination) { THREADENTRY32 te32; HANDLE hThread = CreateToolhelp32Snapshot(TH32CS_SNAPTHREAD, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hThread == INVALID_HANDLE_VALUE) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ERROR_ENUM_THREAD_START; te32.dwSize = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(THREADENTRY32); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Thread32First(hThread, &amp;te32)) { CloseHandle(hThread); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ERROR_ENUM_THREAD_START; } DWORD dwOwnerPID = GetCurrentProcessId(); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isRegDefined = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> freeReg = <span class="hljs-number"><span class="hljs-number">-1</span></span>; Freeze(); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (te32.th32OwnerProcessID == dwOwnerPID) { HANDLE openThread = OpenThread(THREAD_ALL_ACCESS, FALSE, te32.th32ThreadID); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isRegDefined) { CONTEXT context; ZeroMemory(&amp;context, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(context)); context.ContextFlags = CONTEXT_DEBUG_REGISTERS; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!GetThreadContext(openThread, &amp;context)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ERROR_GET_CONTEXT; freeReg = GetFreeReg(&amp;context.Dr7); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (freeReg == <span class="hljs-number"><span class="hljs-number">-1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ERROR_GET_FREE_REG; isRegDefined = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } SetHook(source, destination, &amp;openThread, &amp;freeReg); CloseHandle(openThread); } } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Thread32Next(hThread, &amp;te32)); CloseHandle(hThread); Unfreeze(); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> record = info-&gt;GetItem(freeReg); record-&gt;source = source; record-&gt;destination = destination; record-&gt;pTrampoline = source; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> SUCCESS_CODE; }</code> </pre> <br></div></div><br>          .         ,         .      Freeze  Unfreeze โ  ,     Opcode Hook    โ        ( ),    ,        . <br><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">     </b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> IHook::Freeze() { THREADENTRY32 te32; HANDLE hThread = CreateToolhelp32Snapshot(TH32CS_SNAPTHREAD, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hThread == INVALID_HANDLE_VALUE) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ERROR_ENUM_THREAD_START; te32.dwSize = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(THREADENTRY32); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Thread32First(hThread, &amp;te32)) { CloseHandle(hThread); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ERROR_ENUM_THREAD_START; } DWORD dwOwnerPID = GetCurrentProcessId(); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (te32.th32OwnerProcessID == dwOwnerPID &amp;&amp; te32.th32ThreadID != GetCurrentThreadId()) { HANDLE openThread = OpenThread(THREAD_ALL_ACCESS, FALSE, te32.th32ThreadID); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (openThread != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { SuspendThread(openThread); CloseHandle(openThread); } } } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Thread32Next(hThread, &amp;te32)); CloseHandle(hThread); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> SUCCESS_CODE; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> IHook::Unfreeze() { <span class="hljs-comment"><span class="hljs-comment">// equal { HANDLE openThread = OpenThread(THREAD_ALL_ACCESS, FALSE, te32.th32ThreadID); if (openThread != NULL) { ResumeThread(openThread); CloseHandle(openThread); } } // equal return 0; }</span></span></code> </pre> <br></div></div><br>       . <br><br>     VEH.      AddVectoredExceptionHandler  RemoveVectoredExceptionHandler   . <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> HardwareBPHook::SetExceptionHandler(PVECTORED_EXCEPTION_HANDLER pVecExcHandler) { pException = AddVectoredExceptionHandler(<span class="hljs-number"><span class="hljs-number">1</span></span>, pVecExcHandler); } ~HardwareBPHook() { info-&gt;Clear(); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> info; RemoveVectoredExceptionHandler(pException); }</code> </pre> <br>      ( EXCEPTION_SINGLE_STEP),   ,      ,             RIP   .   ,            . <br><br>     : <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">LONG </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnExceptionHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( EXCEPTION_POINTERS* exceptionPointers)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exceptionPointers-&gt;ExceptionRecord-&gt;ExceptionCode != EXCEPTION_SINGLE_STEP) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> EXCEPTION_CONTINUE_EXECUTION; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; DEBUG_REG_COUNT; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exceptionPointers-&gt;ContextRecord-&gt;Rip == (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)hook-&gt;GetInfo()-&gt;GetItem(i)-&gt;source) { exceptionPointers-&gt;ContextRecord-&gt;Rip = (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)hook-&gt;GetInfo()-&gt;GetItem(i)-&gt;destination; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> EXCEPTION_CONTINUE_EXECUTION; }</code> </pre> <br>    ,  ,     ,   OpcodeHook. <br>   ,    โ      PresentHook    ,    ,   .   ,  ยซยป     ,      (   ยซยป      )         .   โ           ,      .       . <br><br>     โ          ,          .      . <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">IDeferredCommands* hookCommands; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PresentHook</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Device* device)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> record = hook-&gt;GetRecordBySource(ptrPresent); pPresent pTrampoline = (pPresent)record-&gt;pTrampoline; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> result = pTrampoline(device); <span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"PresentHook"</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; hookCommands-&gt;Run(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EndSceneHook</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Device* device, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> j)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> record = hook-&gt;GetRecordBySource(ptrEndScene); pEndScene pTrampoline = (pEndScene)record-&gt;pTrampoline; pTrampoline(device, <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"EndSceneHook"</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">" "</span></span> &lt;&lt; j &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; hookCommands-&gt;Run(); } <span class="hljs-function"><span class="hljs-function">LONG </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnExceptionHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EXCEPTION_POINTERS* exceptionPointers)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exceptionPointers-&gt;ExceptionRecord-&gt;ExceptionCode != EXCEPTION_SINGLE_STEP) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> EXCEPTION_CONTINUE_EXECUTION; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; DEBUG_REG_COUNT; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exceptionPointers-&gt;ContextRecord-&gt;Rip == (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)hook-&gt;GetInfo()-&gt;GetItem(i)-&gt;source) { exceptionPointers-&gt;ContextRecord-&gt;Dr7 &amp;= ~(<span class="hljs-number"><span class="hljs-number">1U</span></span>LL &lt;&lt; (<span class="hljs-number"><span class="hljs-number">2</span></span> * i)); exceptionPointers-&gt;ContextRecord-&gt;Rip = (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)hook-&gt;GetInfo()-&gt;GetItem(i)-&gt;destination; IDeferredCommand* cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SetD7Command(hook, GetCurrentThreadId(), i); hookCommands-&gt;Enqueue(cmd); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> EXCEPTION_CONTINUE_EXECUTION; }</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">  </b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> silk_way { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IDeferredCommand</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: IDeferredCommand(silk_way::IHook* _hook) { hook = _hook; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~IDeferredCommand() { hook = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: silk_way::IHook* hook; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SetD7Command</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IDeferredCommand { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: SetD7Command(silk_way::IHook* _hook, <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> _threadId, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _reg) : IDeferredCommand(_hook) { threadId = _threadId; reg = _reg; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ HANDLE hThread = OpenThread(THREAD_ALL_ACCESS, FALSE, threadId); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hThread != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> res = SetD7(&amp;hThread); CloseHandle(hThread); } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetD7</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HANDLE* hThread)</span></span></span><span class="hljs-function"> </span></span>{ CONTEXT context; ZeroMemory(&amp;context, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(context)); context.ContextFlags = CONTEXT_DEBUG_REGISTERS; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!GetThreadContext(*hThread, &amp;context)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; *(&amp;context.Dr0 + reg) = (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)hook-&gt;GetInfo()-&gt;GetItem(reg)-&gt;source; context.Dr7 |= <span class="hljs-number"><span class="hljs-number">1U</span></span>LL &lt;&lt; (<span class="hljs-number"><span class="hljs-number">2</span></span> * reg); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!SetThreadContext(*hThread, &amp;context)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> threadId; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> reg; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IDeferredCommands</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> silk_data::Queue&lt;IDeferredCommand*&gt;, <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IDeferredCommand { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: IDeferredCommands() : Queue(), IDeferredCommand(<span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>) {} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~IDeferredCommands() {} }; }</code> </pre> <br></div></div><br>    ยซยป  . <br><br><img src="https://habrastorage.org/webt/jv/p-/zz/jvp-zzjqnzwyp2ykl_99ujnhw0y.png"><br> <i> 12 โ  </i> <br><br>  ,  VEH , ,     -: <br><br><img src="https://habrastorage.org/webt/5q/-e/eu/5q-eeucl59ysseiioktygfzl9bc.png"><br> <i> 13 โ   </i> <br><br>  ,  ,   RIP      : <br><br><img src="https://habrastorage.org/webt/te/rv/iw/terviwiealxn6xn1xvylzvfuhfe.png"><br> <i> 14 โ      </i> <br><br>      ,   silk_way.lib .     ,     OpcodeHook, VMT Hook, Forced Exception Hook (,  ยซยป ), HardwareBreakpoint  PageGuard (    ,  ). <br><br><h2 style=";text-align:right;direction:rtl"> 8.   </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชู ุชูุฏูู ุฃุณุงุณ ุงูููุทู ูู ุดูู MVC (ูููุฐุฌ ุนุฑุถ ูุญุฏุฉ ุชุญูู). ุชุฑุซ ุฌููุน ุงูููุงูุงุช ุงูุฃุณุงุณูุฉ ูู ูุงุฌูุฉ ISilkObject.</font></font><br><br><h3 style=";text-align:right;direction:rtl">  8.1.  ูููุฐุฌ </h3><br>         ECS (     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> ).   ,         ,   ,   ml  (     (Dota 2    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">3D </a>  )   2D   ).        ,    ,      ,  ECS           (   ,      SkyForge, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> ยซ  ยป</a> ),  ,  ,     Source2Gen.             .   Schema,      (           ,     (    ,   ) โ         xml/json). <br><br>      : <br><br> <a href=""><img src="https://habrastorage.org/webt/ci/of/ip/ciofipyg9fa-rcm0bavzy4ninb0.png"></a> <br> <i> 15 โ   </i> <br><br>   : <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">S</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SILK_OBJ</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IModel</span></span></span><span class="hljs-class">) {</span></span> ACCESSOR(IIdentity, Id) ACCESSOR(S, Schema) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: IModel(IIdentity * id, ISchema * schema) { Id = id; Schema = <span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;S*&gt;(schema); components = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> silk_data::RBTree&lt;SILK_STRING*, IComponent&gt;( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringCompareStrategy()); } ~IModel() { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> Id; Schema = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; components-&gt;Clear(); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> components; } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Get</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SILK_STRING</span></span></span><span class="hljs-class"> * </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class">) {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (T*)components-&gt;Find(key); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: silk_data::RBTree&lt;SILK_STRING*, IComponent&gt;* components; };</code> </pre> <br>          ,    . <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IModelSchema</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> BaseSchema { ACCESSOR(ModelContext, Context) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: IModelSchema(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* type, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* name, IContext* context) : BaseSchema(type, name) { Context = <span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;ModelContext*&gt;(context); } ~IModelSchema() { Context = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; } }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ModelContext</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> SilkContext { ACCESSOR(ILogger, Logger) ACCESSOR(IChrono, Clock) ACCESSOR(GigaFactory, Factory) ACCESSOR(IGameModel*, Model) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: ModelContext(SILK_GUID* guid, ILogger* logger, IChrono* clock, GigaFactory* factory, IGameModel** model) : SilkContext(guid) { Logger = logger; Clock = clock; Factory = factory; Model = model; } ~ModelContext() { Logger = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; Clock = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; Factory = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; Model = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; } };</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">    </b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">S</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IModelCollection</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> silk_data::Vector&lt;T*&gt;, <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IModel&lt;S&gt; { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: IModelCollection(IIdentity* id, ISchema* schema) : Vector(), IModel(id, schema) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> factory = Schema-&gt;GetContext()-&gt;GetFactory(); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> guid = Schema-&gt;GetContext()-&gt;GetGuid(); foreach (Schema-&gt;Length()) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> itemSchema = Schema-&gt;GetItem(i); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> item = factory-&gt;Build&lt;T&gt;(itemSchema-&gt;GetType()-&gt;GetValue(), guid-&gt;Get(), itemSchema); PushBack(item); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: ~IModelCollection() { Clear(); } <span class="hljs-function"><span class="hljs-function">T* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetByName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* name)</span></span></span><span class="hljs-function"> </span></span>{ foreach (Length()) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GetItem(i)-&gt;GetSchema()-&gt;CheckName(name)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetItem(i); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; } };</code> </pre> <br></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">       ,    </b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">DEFINE_IMODEL(IRoshanStatusModel, IRoshanStatusSchema) { VIRTUAL_COMPONENT(IStatesModel, States) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Resolve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: IRoshanStatusModel(IIdentity * id, ISchema * schema) : IModel(id, schema) {} }; DEFINE_MODEL(RoshanStatusModel, IRoshanStatusModel) { COMPONENT(IStatesModel, States) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> : RoshanStatusModel(IIdentity * id, ISchema* schema) : IRoshanStatusModel( id, schema) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> factory = Schema-&gt;GetContext()-&gt;GetFactory(); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> guid = Schema -&gt; GetContext() -&gt; GetGuid(); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> statesSchema = Schema -&gt; GetStates(); States = factory-&gt;Build&lt;IStatesModel&gt;( statesSchema-&gt;GetType()-&gt;GetValue(), guid-&gt;Get(), statesSchema); } ~RoshanStatusModel() { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> States; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Resolve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> currentStateSchema = States-&gt;GetCurrent()-&gt;GetSchema(); Schema-&gt;GetContext()-&gt;GetLogger()-&gt;Log(<span class="hljs-string"><span class="hljs-string">"RESOLVE\n"</span></span>); foreach (currentStateSchema-&gt;GetTransitions()-&gt;Length()) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> transition = currentStateSchema-&gt;GetTransitions()-&gt;GetItem(i); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (transition-&gt;GetRequirement()-&gt;Check()) { transition-&gt;GetAction()-&gt;Make(); States-&gt;SetCurrent(States-&gt;GetByName( transition-&gt;GetTo()-&gt;GetValue())); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } };</code> </pre> <br></div></div><br><h3 style=";text-align:right;direction:rtl">  8.2. ,     </h3><br>  ,       ,    .       .       Canvas, ViewCollection, Label  Button,      ,  ,    . <br><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">  </b> <div class="spoiler_text" style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/an/l2/_n/anl2_n7qxsihaoohxu4oa-kq2jm.png"></a> <br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุดูู 16 - ุชูุซูู ุชุฎุทูุทู ููุฑุฃู</font></font></i> <br></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">   </b> <div class="spoiler_text" style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/zi/mz/pi/zimzpip_arq-gwgl87-lwriknmq.png"></a> <br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุดูู 17 - ุงูุชูุซูู ุงูุชุฎุทูุทู ูุฏููุฉ ุงููุดุงูุฏุฉ</font></font></i> <br></div></div><br><h3 style=";text-align:right;direction:rtl">  8.3.  </h3><br>     .       ,      typeid(T).raw_name(). ,   ,        Andrei Alexandrescu, Modern C++ Design: Generic Programming.  : <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SilkFactory</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: SilkFactory() { items = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> silk_data::RBTree&lt;SILK_STRING*, IImplementator&gt;( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringCompareStrategy()); } ~SilkFactory() { items-&gt;Clear(); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> items; } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">... </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Args</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ISILK_WAY_OBJECT</span></span></span><span class="hljs-class">* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Build</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">char</span></span></span><span class="hljs-class">* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Args</span></span></span><span class="hljs-class">... </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">args</span></span></span><span class="hljs-class">) {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> key = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_STRING(type); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> impl = items-&gt;Find(key)-&gt;payload; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> impl-&gt;Build(args...); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Register</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* type, IImplementator* impl)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> key = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_STRING(type); items-&gt;Insert(*items-&gt;MakeNode(key, impl)); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: silk_data::RBTree&lt;SILK_STRING*, IImplementator&gt;* items; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GigaFactory</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: GigaFactory() { items = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> silk_data::RBTree&lt;SILK_STRING*, SilkFactory&gt;( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringCompareStrategy()); } ~GigaFactory() { items-&gt;Clear(); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> items; } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">... </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Args</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Build</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">char</span></span></span><span class="hljs-class">* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">concreteType</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Args</span></span></span><span class="hljs-class">... </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">args</span></span></span><span class="hljs-class">) {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> key = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_STRING(<span class="hljs-keyword"><span class="hljs-keyword">typeid</span></span>(T).raw_name()); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> factory = items-&gt;Find(key)-&gt;payload; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (T*)factory-&gt;Build(concreteType, args...); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Register</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SilkFactory</span></span></span><span class="hljs-class">* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">factory</span></span></span><span class="hljs-class">) {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> key = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_STRING(<span class="hljs-keyword"><span class="hljs-keyword">typeid</span></span>(T).raw_name()); items-&gt;Insert(*items-&gt;MakeNode(key, factory)); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: silk_data::RBTree&lt;SILK_STRING*, SilkFactory&gt;* items; };</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุจู ุงุณุชุฎุฏุงู ุงููุตูุน ูุจูุงุก ุงููุงุฆูุงุช ุ ุชุญุชุงุฌ ุฅูู ุงูุชุณุฌูู. </font></font><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุซุงู ุนูู ูููุฐุฌ ุงูุชุณุฌูู</font></font></b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> ModelRegistrator::Register( GigaFactory* factory) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> requirement = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SilkFactory(); requirement-&gt;Register(<span class="hljs-string"><span class="hljs-string">"true"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SchemaImplementator&lt;TrueRequirement&gt;); requirement-&gt;Register(<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SchemaImplementator&lt;FalseRequirement&gt;); requirement-&gt;Register(<span class="hljs-string"><span class="hljs-string">"roshan_killed"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SchemaImplementator&lt;RoshanKilledRequirement&gt;); requirement-&gt;Register(<span class="hljs-string"><span class="hljs-string">"roshan_alive_manual"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SchemaImplementator&lt;RoshanAliveManualRequirement&gt;); requirement-&gt;Register(<span class="hljs-string"><span class="hljs-string">"time"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SchemaImplementator&lt;TimeRequirement&gt;); requirement-&gt;Register(<span class="hljs-string"><span class="hljs-string">"roshan_state"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SchemaImplementator&lt;RoshanStateRequirement&gt;); factory-&gt;Register&lt;IRequirement&gt;(requirement); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> action = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SilkFactory(); action-&gt;Register(<span class="hljs-string"><span class="hljs-string">"action"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SchemaImplementator&lt;EmptyAction&gt;); action-&gt;Register(<span class="hljs-string"><span class="hljs-string">"set_current_time"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SchemaImplementator&lt;SetCurrentTimeAction&gt;); factory-&gt;Register&lt;IAction&gt;(action); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> transition = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SilkFactory(); transition-&gt;Register(<span class="hljs-string"><span class="hljs-string">"transition"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SchemaImplementator&lt;TransitionSchema&gt;); factory-&gt;Register&lt;ITransitionSchema&gt;(transition); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> transitions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SilkFactory(); transitions-&gt;Register(<span class="hljs-string"><span class="hljs-string">"transitions"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SchemaImplementator&lt;TransitionsSchema&gt;); factory-&gt;Register&lt;ITransitionsSchema&gt;(transitions); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> stateSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SilkFactory(); stateSchema-&gt;Register(<span class="hljs-string"><span class="hljs-string">"state"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SchemaImplementator&lt;StateSchema&gt;); factory-&gt;Register&lt;IStateSchema&gt;(stateSchema); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> statesSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SilkFactory(); statesSchema-&gt;Register(<span class="hljs-string"><span class="hljs-string">"states"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SchemaImplementator&lt;StatesSchema&gt;); factory-&gt;Register&lt;IStatesSchema&gt;(statesSchema); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> roshanStatusSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SilkFactory(); roshanStatusSchema-&gt;Register(<span class="hljs-string"><span class="hljs-string">"roshan_status"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SchemaImplementator&lt;RoshanStatusSchema&gt;); factory-&gt;Register&lt;IRoshanStatusSchema&gt;(roshanStatusSchema); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> triggerSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SilkFactory(); triggerSchema-&gt;Register(<span class="hljs-string"><span class="hljs-string">"trigger"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SchemaImplementator&lt;TriggerSchema&gt;); factory-&gt;Register&lt;ITriggerSchema&gt;(triggerSchema); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> triggersSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SilkFactory(); triggersSchema-&gt;Register(<span class="hljs-string"><span class="hljs-string">"triggers"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SchemaImplementator&lt;TriggersSchema&gt;); factory-&gt;Register&lt;ITriggersSchema&gt;(triggersSchema); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> resourceSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SilkFactory(); resourceSchema-&gt;Register(<span class="hljs-string"><span class="hljs-string">"resource"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SchemaImplementator&lt;ResourceSchema&gt;); factory-&gt;Register&lt;IResourceSchema&gt;(resourceSchema); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> resourcesSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SilkFactory(); resourcesSchema-&gt;Register(<span class="hljs-string"><span class="hljs-string">"resources"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SchemaImplementator&lt;ResourcesSchema&gt;); factory-&gt;Register&lt;IResourcesSchema&gt;(resourcesSchema); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> gameSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SilkFactory(); gameSchema-&gt;Register(<span class="hljs-string"><span class="hljs-string">"game"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SchemaImplementator&lt;GameSchema&gt;); factory-&gt;Register&lt;IGameSchema&gt;(gameSchema); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> gameModel = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SilkFactory(); gameModel-&gt;Register(<span class="hljs-string"><span class="hljs-string">"game"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcreteImplementator&lt;GameModel&gt;); factory-&gt;Register&lt;IGameModel&gt;(gameModel); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> resources = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SilkFactory(); resources-&gt;Register(<span class="hljs-string"><span class="hljs-string">"resources"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcreteImplementator&lt;ResourceCollection&gt;); factory-&gt;Register&lt;IResourceCollection&gt;(resources); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> resource = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SilkFactory(); resource-&gt;Register(<span class="hljs-string"><span class="hljs-string">"resource"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcreteImplementator&lt;Resource&gt;); factory-&gt;Register&lt;IResource&gt;(resource); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> triggers = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SilkFactory(); triggers-&gt;Register(<span class="hljs-string"><span class="hljs-string">"triggers"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcreteImplementator&lt;TriggerCollection&gt;); factory-&gt;Register&lt;ITriggerCollection&gt;(triggers); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> trigger = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SilkFactory(); trigger-&gt;Register(<span class="hljs-string"><span class="hljs-string">"trigger"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcreteImplementator&lt;Trigger&gt;); factory-&gt;Register&lt;ITrigger&gt;(trigger); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> roshanStatus = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SilkFactory(); roshanStatus-&gt;Register(<span class="hljs-string"><span class="hljs-string">"roshan_status"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcreteImplementator&lt;RoshanStatusModel&gt;); factory-&gt;Register&lt;IRoshanStatusModel&gt;(roshanStatus); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> states = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SilkFactory(); states-&gt;Register(<span class="hljs-string"><span class="hljs-string">"states"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcreteImplementator&lt;StatesModel&gt;); factory-&gt;Register&lt;IStatesModel&gt;(states); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> state = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SilkFactory(); state-&gt;Register(<span class="hljs-string"><span class="hljs-string">"state"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcreteImplementator&lt;StateModel&gt;); factory-&gt;Register&lt;IStateModel&gt;(state); }</code> </pre> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูููู ููุก ุงููุฎุทุท ุจุฃู ุทุฑููุฉ - ููููู ุงุณุชุฎุฏุงู json ุ ููููู ูุจุงุดุฑุฉ ูู ุงูููุฏ. </font></font><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฎูุงุฑ ูููุก ูุฎุทุท ุงูููุงุฐุฌ ูู json</font></font></b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"game"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"roshan_status"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"states"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"alive"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"transitions"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"from"</span></span>: <span class="hljs-string"><span class="hljs-string">"alive"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"to"</span></span>: <span class="hljs-string"><span class="hljs-string">"ressurect_base"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"requirement"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"roshan_killed"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"action"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"set_current_time"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"resource"</span></span>: <span class="hljs-string"><span class="hljs-string">"roshan_killed_ts"</span></span> } } } ] }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"ressurect_base"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"transitions"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"from"</span></span>: <span class="hljs-string"><span class="hljs-string">"ressurect_base"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"to"</span></span>: <span class="hljs-string"><span class="hljs-string">"ressurect_extra"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"requirement"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"time"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"resource"</span></span>: <span class="hljs-string"><span class="hljs-string">"roshan_killed_ts"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"offset"</span></span>: <span class="hljs-number"><span class="hljs-number">480</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"action"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"action"</span></span> } } ] }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"ressurect_extra"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"transitions"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"from"</span></span>: <span class="hljs-string"><span class="hljs-string">"ressurect_extra"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"to"</span></span>: <span class="hljs-string"><span class="hljs-string">"alive"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"requirement"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"time"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"resource"</span></span>: <span class="hljs-string"><span class="hljs-string">"roshan_killed_ts"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"offset"</span></span>: <span class="hljs-number"><span class="hljs-number">660</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"action"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"action"</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"from"</span></span>: <span class="hljs-string"><span class="hljs-string">"ressurect_extra"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"to"</span></span>: <span class="hljs-string"><span class="hljs-string">"alive"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"requirement"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"roshan_alive_manual"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"action"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"action"</span></span> } } ] } ] }, <span class="hljs-attr"><span class="hljs-attr">"triggers"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"roshan_killed"</span></span>: {}, <span class="hljs-attr"><span class="hljs-attr">"roshan_alive_manual"</span></span>: {} }, <span class="hljs-attr"><span class="hljs-attr">"resources"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"roshan_killed_ts"</span></span>: {} } } }</code> </pre> <br></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฎูุงุฑ ูููุก ูุฎุทุท ูุชูุฏูู ุงูููุฏ</font></font></b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> GameController::InitViewSchema(ICanvasSchema** schema) { *schema = factory-&gt;Build&lt;ICanvasSchema&gt;(<span class="hljs-string"><span class="hljs-string">"canvas_d9"</span></span>, <span class="hljs-string"><span class="hljs-string">"canvas_d9"</span></span>, <span class="hljs-string"><span class="hljs-string">"canvas_d9"</span></span>, viewContext); IViewCollectionSchema* elements = factory-&gt;Build&lt;IViewCollectionSchema&gt;( <span class="hljs-string"><span class="hljs-string">"elements"</span></span>, <span class="hljs-string"><span class="hljs-string">"elements"</span></span>, <span class="hljs-string"><span class="hljs-string">"elements"</span></span>, viewContext); (*schema)-&gt;SetElements(elements); ILabelSchema* labelSchema = factory-&gt;Build&lt;ILabelSchema&gt;( <span class="hljs-string"><span class="hljs-string">"label_d9"</span></span>, <span class="hljs-string"><span class="hljs-string">"label_d9"</span></span>, <span class="hljs-string"><span class="hljs-string">"roshan_status_label"</span></span>, viewContext); labelSchema-&gt;SetRecLeft(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_INT(<span class="hljs-number"><span class="hljs-number">30</span></span>)); labelSchema-&gt;SetRecTop(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_INT(<span class="hljs-number"><span class="hljs-number">100</span></span>)); labelSchema-&gt;SetRecRight(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_INT(<span class="hljs-number"><span class="hljs-number">230</span></span>)); labelSchema-&gt;SetRecDown(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_INT(<span class="hljs-number"><span class="hljs-number">250</span></span>)); labelSchema-&gt;SetColorR(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_FLOAT(<span class="hljs-number"><span class="hljs-number">1.0f</span></span>)); labelSchema-&gt;SetColorG(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_FLOAT(<span class="hljs-number"><span class="hljs-number">1.0f</span></span>)); labelSchema-&gt;SetColorB(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_FLOAT(<span class="hljs-number"><span class="hljs-number">1.0f</span></span>)); labelSchema-&gt;SetColorA(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_FLOAT(<span class="hljs-number"><span class="hljs-number">1.0f</span></span>)); labelSchema-&gt;SetText(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_STRING(<span class="hljs-string"><span class="hljs-string">"Roshan status: alive\0"</span></span>)); elements-&gt;PushBack((IViewSchema*&amp;)labelSchema); IButtonSchema* buttonSchema = factory-&gt;Build&lt;IButtonSchema&gt;( <span class="hljs-string"><span class="hljs-string">"button_d9"</span></span>, <span class="hljs-string"><span class="hljs-string">"button_d9"</span></span>, <span class="hljs-string"><span class="hljs-string">"roshan_kill_button"</span></span>, viewContext); ILabelSchema* buttonLabelSchema = factory-&gt;Build&lt;ILabelSchema&gt;( <span class="hljs-string"><span class="hljs-string">"label_d9"</span></span>, <span class="hljs-string"><span class="hljs-string">"label_d9"</span></span>, <span class="hljs-string"><span class="hljs-string">"button_text"</span></span>, viewContext); buttonLabelSchema-&gt;SetRecLeft(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_INT(<span class="hljs-number"><span class="hljs-number">30</span></span>)); buttonLabelSchema-&gt;SetRecTop(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_INT(<span class="hljs-number"><span class="hljs-number">115</span></span>)); buttonLabelSchema-&gt;SetRecRight(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_INT(<span class="hljs-number"><span class="hljs-number">110</span></span>)); buttonLabelSchema-&gt;SetRecDown(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_INT(<span class="hljs-number"><span class="hljs-number">130</span></span>)); buttonLabelSchema-&gt;SetColorR(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_FLOAT(<span class="hljs-number"><span class="hljs-number">1.0f</span></span>)); buttonLabelSchema-&gt;SetColorG(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_FLOAT(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>)); buttonLabelSchema-&gt;SetColorB(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_FLOAT(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>)); buttonLabelSchema-&gt;SetColorA(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_FLOAT(<span class="hljs-number"><span class="hljs-number">1.0f</span></span>)); buttonLabelSchema-&gt;SetText(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_STRING(<span class="hljs-string"><span class="hljs-string">"Kill Roshan\0"</span></span>)); buttonSchema-&gt;SetLabel(buttonLabelSchema); buttonSchema-&gt;SetBorderColorR(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_INT(<span class="hljs-number"><span class="hljs-number">0</span></span>)); buttonSchema-&gt;SetBorderColorG(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_INT(<span class="hljs-number"><span class="hljs-number">0</span></span>)); buttonSchema-&gt;SetBorderColorB(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_INT(<span class="hljs-number"><span class="hljs-number">0</span></span>)); buttonSchema-&gt;SetBorderColorA(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_INT(<span class="hljs-number"><span class="hljs-number">70</span></span>)); buttonSchema-&gt;SetFillColorR(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_INT(<span class="hljs-number"><span class="hljs-number">255</span></span>)); buttonSchema-&gt;SetFillColorG(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_INT(<span class="hljs-number"><span class="hljs-number">119</span></span>)); buttonSchema-&gt;SetFillColorB(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_INT(<span class="hljs-number"><span class="hljs-number">0</span></span>)); buttonSchema-&gt;SetFillColorA(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_INT(<span class="hljs-number"><span class="hljs-number">150</span></span>)); buttonSchema-&gt;SetPushColorR(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_INT(<span class="hljs-number"><span class="hljs-number">0</span></span>)); buttonSchema-&gt;SetPushColorG(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_INT(<span class="hljs-number"><span class="hljs-number">0</span></span>)); buttonSchema-&gt;SetPushColorB(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_INT(<span class="hljs-number"><span class="hljs-number">0</span></span>)); buttonSchema-&gt;SetPushColorA(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_INT(<span class="hljs-number"><span class="hljs-number">70</span></span>)); buttonSchema-&gt;SetBorder(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SILK_FLOAT(<span class="hljs-number"><span class="hljs-number">5</span></span>)); elements-&gt;PushBack((IViewSchema*&amp;)buttonSchema); }</code> </pre> <br></div></div><br><h3 style=";text-align:right;direction:rtl">  8.4.  ุฃุญุฏุงุซ </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุนุฑู ุงูุนุฑุถ ุนูู ุงูุชุบููุฑ ูู ุงููููุฐุฌ ูู ุฎูุงู ุงูุฃุญุฏุงุซ. </font><font style="vertical-align: inherit;">ููููู ุงูุญุตูู ุนูู ููุงุญุธุงุช ูู ุฃุณุงููุจ ุงููุตู ูุงููุธุงุฆู ุงูุนุงุฏูุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> VIRTUAL_EVENT(e) public: virtual IEvent* Get##e() = 0; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> EVENT(e) private: IEvent* e; public: IEvent* Get##e() { return e; } const int MAX_EVENT_CALLBACKS = 1024; class IEventArgs {}; class ICallback { public: virtual void Invoke(IEventArgs* args) = 0; }; template </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;class A&gt; class Callback : public ICallback { typedef void (*f)(A*); public: Callback(f _pFunc) { ptr = _pFunc; } ~Callback() { delete ptr; } void Invoke(IEventArgs* args) { ptr((A*)args); } private: f ptr = nullptr; }; template &lt;typename T, class A&gt; class MemberCallback : public ICallback { typedef void (T::*f)(A*); public: MemberCallback(f _pFunc, T* _obj) { ptr = _pFunc; obj = _obj; } ~MemberCallback() { delete ptr; obj = nullptr; } void Invoke(IEventArgs* args) { (obj-&gt;*(ptr))((A*)args); } private: f ptr = nullptr; T* obj; }; class IEvent { public: virtual void Invoke(IEventArgs* args) = 0; virtual void Add(ICallback* callback) = 0; virtual bool Remove(ICallback* callback) = 0; virtual ~IEvent() {} };</span></span></span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุฐุง ุฃุฑุงุฏ ูุงุฆู ุงูุฅุจูุงุบ ุนู ุงูุฃุญุฏุงุซ ุงูุชู ุชุญุฏุซ ุจุฏุงุฎูู ุ ูุฃูุช ุจุญุงุฌุฉ ุฅูู ุฅุถุงูุฉ IEvent * ููู ุญุฏุซ. </font><font style="vertical-align: inherit;">ูุงุฆู ุขุฎุฑ ููุชู ุจุงูุฃุญุฏุงุซ ุงูุชู ุชุญุฏุซ ุฏุงุฎู ูุฐุง ุงููุงุฆู ูุฌุจ ุฃู ููุดุฆ ICallback * ูููุฑุฑู ุฏุงุฎู IEvent * (ุงูุงุดุชุฑุงู ูู ุงูุญุฏุซ).</font></font><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุดุชุฑุงูุงุช ุงููุซุงู ุงูุชู ุชุญุฏุซ ูู ูุญุฏุฉ ุงูุชุญูู</font></font></b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Attach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ statesChangedCallback = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MemberCallback&lt;GameController, IEventArgs&gt;( &amp;GameController::OnStatesChanged, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); Model-&gt;GetRoshanStatus()-&gt;GetStates()-&gt;GetCurrentChanged()-&gt;Add( statesChangedCallback); buttonClickedCallback = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MemberCallback&lt;GameController, IEventArgs&gt;( &amp;GameController::OnKillRoshanClicked, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); killButton-&gt;GetClickedEvent()-&gt;Add(buttonClickedCallback); }</code> </pre> <br></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุซุงู ุนูู ุงูุฅุนูุงู ุนู ุญุฏุซ ุฏุงุฎู ุงููุตู - ูุน ูู ููุฑุฉ ุนูู ูุฏุงุฑ ุงูุณุงุนุฉ (ุงุณุชุฏุนุงุก ุทุฑููุฉ ุงูุชุฌุฒุฆุฉ) ุ ูุชู ุฑูุน ุญุฏุซ StruckEvent</font></font></b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IChrono</span></span></span><span class="hljs-class"> {</span></span> VIRTUAL_EVENT(Struck) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetStamp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetDiffS</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ts)</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Chrono</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IChrono { EVENT(Struck) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Chrono() { start = time(<span class="hljs-number"><span class="hljs-number">0</span></span>); Struck = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Event(); } ~Chrono() { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> Struck; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> cur = clock(); worked += cur - savepoint; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isStriking = savepoint &lt; cur; savepoint = cur; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isStriking) Struck-&gt;Invoke(<span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetStamp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> start * CLOCKS_PER_SEC + worked; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetDiffS</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ts)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (GetStamp() - ts) / CLOCKS_PER_SEC; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> worked = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">time_t</span></span> start; <span class="hljs-keyword"><span class="hljs-keyword">time_t</span></span> savepoint; };</code> </pre> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุชู ุชุทุจูู ุงูุฃููุงุน ุงูุจุฏุงุฆูุฉ ุงูุฃุณุงุณูุฉ (SILK_INT ู SILT_FLOAT ู SILK_STRING ุ ...) ูู Core.h. </font></font><br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 9. ุฏุงูุฑูุช 9 </font></font></h2><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">DirectX 9</a>     API,  Dota 2. Device    ,   IUnknown    . ,      ,        .             .code,     ,   .  ,  OpenGL  Vulkan     ,           GetProcAddress().  DirectX 11  9,   . <br><br>      (   )     ,  .              .       โ   . <br><br>         IDirect3D9    Direct3DCreate9,           CreateDevice.         DirectX,        .    d3d9.h, Direct3DCreate9            GetProcAddress (  ,     NativeInjector     LoadLibrary). <br><br> <a href=""><img src="https://habrastorage.org/webt/nr/fq/ai/nrfqai6vps7fc9lx_crerpvsbhq.png"></a> <br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุดูู 18 - ูุตู CreateDevice ูู d3d9.h</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ุจุฅูุดุงุก ูุซูู IDirect3D9:</font></font><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> IDirect3D9* (WINAPI *SILK_Direct3DCreate9) (UINT SDKVersion); <span class="hljs-comment"><span class="hljs-comment">//IDirect3D9* pD3D = Direct3DCreate9(D3D_SDK_VERSION); SILK_Direct3DCreate9 Silk_Direct3DCreate9 = (SILK_Direct3DCreate9)GetProcAddress(GetModuleHandle("d3d9.dll"), "Direct3DCreate9"); IDirect3D9* pD3D = Silk_Direct3DCreate9(D3D_SDK_VERSION);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงุณุชุฎุฏุงู IDirect3D9 ุ ูููููุง ุฅูุดุงุก ุฌูุงุฒ ุนู ุทุฑูู ุงุณุชุฏุนุงุก pD3D-&gt; CreateDevice (...). </font><font style="vertical-align: inherit;">ููุญุตูู ุนูู ูุคุดุฑ ุฅูู ุงููุธุงุฆู ุงูุถุฑูุฑูุฉ ูู VMT ุ ูุญุชุงุฌ ุฅูู ูุนุฑูุฉ ุงูุฅุฌุฑุงุก ุงูุฎุงุต ุจุชุญุฏูุฏ ูุฐู ุงูุทุฑู. </font><i><font style="vertical-align: inherit;">ุงูุดูู 19 - ุงูุจุญุซ ูู ุงูููุฑุณ ุนู ุทุฑููุฉ CreateDevice ูููุงุฌูุฉ IDirect3D9 ุ ุงุญุตู ุนูู</font></i><font style="vertical-align: inherit;"> ุงูููุฑุณ ุงูุณุงุฏุณ ุนุดุฑ. </font><font style="vertical-align: inherit;">ุจุงูุฅุถุงูุฉ ุฅูู CreateDevice ุ ูุญุชุงุฌ ุฃูุถูุง ุฅูู ุฃุณุงููุจ ุงูุชุญุฑูุฑ ู GetAdapterDisplayMode.</font></font><br><br> <a href=""><img src="https://habrastorage.org/webt/ro/ap/ug/roapuggoav9xtztltqu8gs6zqiw.png"></a> <br> <i><font style="vertical-align: inherit;"></font></i> <br><br><font style="vertical-align: inherit;"></font><br><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุฐ ุฅูุดุงุก ุงูุฌูุงุฒ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ</font></font></b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">typedef</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HRESULT</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(WINAPI *SILK_GetAdapterDisplayMode)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IDirect3D9* direct3D9, UINT Adapter, D3DDISPLAYMODE* pMode)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">typedef</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HRESULT</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(WINAPI *SILK_CreateDevice)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IDirect3D9* direct3D9, UINT Adapter, D3DDEVTYPE DeviceType, HWND hFocusWindow, DWORD BehaviorFlags, D3DPRESENT_PARAMETERS* pPresentationParameters, IDirect3DDevice9** ppReturnedDeviceInterface)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">typedef</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ULONG</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(WINAPI *SILK_Release)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IDirect3D9* direct3D9)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> RELEASE_INDEX = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> GET_ADAPTER_DISPLAY_MODE_INDEX = <span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CREATE_DEVICE_INDEX = <span class="hljs-number"><span class="hljs-number">16</span></span>; <span class="hljs-function"><span class="hljs-function">BOOL </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateSearchDevice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IDirect3D9** d3d, IDirect3DDevice9** device)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!d3d || !device) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FALSE; *d3d = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; *device = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-comment"><span class="hljs-comment">//IDirect3D9* pD3D = Direct3DCreate9(D3D_SDK_VERSION); SILK_Direct3DCreate9 Silk_Direct3DCreate9 = (SILK_Direct3DCreate9)GetProcAddress(GetModuleHandle("d3d9.dll"), "Direct3DCreate9"); IDirect3D9* pD3D = Silk_Direct3DCreate9(D3D_SDK_VERSION); if (!pD3D) return FALSE; D3DDISPLAYMODE displayMode; int pointerSize = sizeof(unsigned long long); unsigned long long vmt = **(unsigned long long **)&amp;pD3D; SILK_GetAdapterDisplayMode pGetAdapderDisplayMode = (SILK_GetAdapterDisplayMode)((*(unsigned long long *) (vmt + pointerSize * GET_ADAPTER_DISPLAY_MODE_INDEX))); pGetAdapderDisplayMode(pD3D, D3DADAPTER_DEFAULT, &amp;displayMode); //pD3D-&gt;GetAdapterDisplayMode(D3DADAPTER_DEFAULT, &amp;displayMode); HWND hWindow = GetDesktopWindow(); D3DPRESENT_PARAMETERS pp; ZeroMemory(&amp;pp, sizeof(pp)); pp.Windowed = TRUE; pp.hDeviceWindow = hWindow; pp.BackBufferCount = 0; pp.BackBufferWidth = 0; pp.BackBufferHeight = 0; pp.BackBufferFormat = displayMode.Format; pp.SwapEffect = D3DSWAPEFFECT_DISCARD; IDirect3DDevice9* pDevice = NULL; SILK_CreateDevice pCreateDevice = (SILK_CreateDevice) ((*(unsigned long long *)(vmt + pointerSize * CREATE_DEVICE_INDEX))); if(SUCCEEDED(pCreateDevice(pD3D, D3DADAPTER_DEFAULT, D3DDEVTYPE_HAL, hWindow, D3DCREATE_SOFTWARE_VERTEXPROCESSING | D3DCREATE_DISABLE_DRIVER_MANAGEMENT, &amp;pp, &amp;pDevice))) { //if (SUCCEEDED(pD3D-&gt;CreateDevice(D3DADAPTER_DEFAULT, D3DDEVTYPE_HAL, hWindow, D3DCREATE_SOFTWARE_VERTEXPROCESSING | D3DCREATE_DISABLE_DRIVER_MANAGEMENT, &amp;pp, &amp;pDevice))) { if (pDevice != NULL) { *d3d = pD3D; *device = pDevice; } } BOOL result = (*d3d != NULL); if (result == FALSE) if (pD3D) { SILK_Release pRelease= (SILK_Release)((*(unsigned long long *)(vmt + pointerSize * RELEASE_INDEX))); pRelease(pD3D); //pD3D-&gt;Release(); } return result; }</span></span></code> </pre> <br></div></div><br> ,    DirectX 9,   ,      ,    .     : ยซ DirectX 9   ?ยป.      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Present</a> .     ,  front buffer (,   ,   ( )  ), back buffer โ  ,        front buffer, swap chain โ   ,    (flipping)  front  back (DirectX 9   1 swap chain).  ,   Present,    BeginScene  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">EndScene</a> ,    back buffer. <br><br>     (          ): EndScene  Present.          IDirect3DDevice9 <br><br> <a href=""><img src="https://habrastorage.org/webt/xa/ev/tk/xaevtkzg4h4whv7aejsfp025yr0.png"></a> <br> <i> 20 โ   IDirect3DDevice9</i> <br><br>      : <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">typedef</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HRESULT</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*VirtualOverloadPresent)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IDirect3DDevice9* pd3dDevice, CONST RECT* pSourceRect, CONST RECT* pDestRect, HWND hDestWindowOverride, CONST RGNDATA* pDirtyRegion)</span></span></span></span>; VirtualOverloadPresent oOverload = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">typedef</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HRESULT</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*VirtualOverloadEndScene)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IDirect3DDevice9* pd3dDevice)</span></span></span></span>; VirtualOverloadEndScene oOverloadEndScene = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> PRESENT_INDEX = <span class="hljs-number"><span class="hljs-number">17</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> END_SCENE_INDEX = <span class="hljs-number"><span class="hljs-number">42</span></span>;</code> </pre> <br>      ,   HardwareBreakpoint         ,    VAC (    Opcode Hook,       ): <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">silk_way::IDeferredCommands* deferredCommands; silk_way::IHook* hook; <span class="hljs-function"><span class="hljs-function">LONG </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnExceptionHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EXCEPTION_POINTERS* exceptionPointers)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exceptionPointers-&gt;ExceptionRecord-&gt;ExceptionCode != EXCEPTION_SINGLE_STEP) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> EXCEPTION_EXIT_UNWIND; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; silk_way::DEBUG_REG_COUNT; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exceptionPointers-&gt;ContextRecord-&gt;Rip == (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>) hook-&gt;GetInfo()-&gt;GetItem(i)-&gt;source) { exceptionPointers-&gt;ContextRecord-&gt;Dr7 &amp;= ~(<span class="hljs-number"><span class="hljs-number">1U</span></span>LL &lt;&lt; (<span class="hljs-number"><span class="hljs-number">2</span></span> * i)); exceptionPointers-&gt;ContextRecord-&gt;Rip = (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>) hook-&gt;GetInfo()-&gt;GetItem(i)-&gt;destination; silk_way::IDeferredCommand* cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> silk_way::SetD7Command(hook, GetCurrentThreadId(), i); deferredCommands-&gt;Enqueue(cmd); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> EXCEPTION_CONTINUE_EXECUTION; }</code> </pre> <br>        : <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">BOOL </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HookDevice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IDirect3DDevice9* pDevice)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> vmt = **(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> **)&amp;pDevice; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pointerSize = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>); VirtualOverloadPresent pointerPresent= (VirtualOverloadPresent) ((*(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> *)(vmt + pointerSize * PRESENT_INDEX))); VirtualOverloadEndScene pointerEndScene = (VirtualOverloadEndScene) ((*(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> *)(vmt + pointerSize * END_SCENE_INDEX))); oOverload = pointerPresent; oOverloadEndScene = pointerEndScene; deferredCommands = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> silk_way::DeferredCommands(); <span class="hljs-comment"><span class="hljs-comment">//hook = new silk_way::HardwareBPHook(); hook = new silk_way::OpcodeHook(); hook-&gt;SetExceptionHandler(OnExceptionHandler); hook-&gt;SetHook(pointerPresent, &amp;PresentHook); hook-&gt;SetHook(pointerEndScene, &amp;EndSceneHook); return TRUE; }</span></span></code> </pre> <br>  : <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">HRESULT WINAPI </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PresentHook</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IDirect3DDevice9* pd3dDevice, CONST RECT* pSourceRect, CONST RECT* pDestRect, HWND hDestWindowOverride, CONST RGNDATA* pDirtyRegion)</span></span></span><span class="hljs-function"> </span></span>{ Capture(pd3dDevice); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> record = hook-&gt;GetRecordBySource(oOverload); VirtualOverloadPresent pTrampoline = (VirtualOverloadPresent) record-&gt;pTrampoline; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> result = pTrampoline(pd3dDevice, pSourceRect, pDestRect, hDestWindowOverride, pDirtyRegion); deferredCommands-&gt;Run(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-function"><span class="hljs-function">HRESULT WINAPI </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EndSceneHook</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IDirect3DDevice9* pd3dDevice)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (controller == <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>) { controller = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GameController(); controller-&gt;SetDevice(pd3dDevice); } controller-&gt;Update(); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> record = hook-&gt;GetRecordBySource(oOverloadEndScene); VirtualOverloadEndScene pTrampoline = (VirtualOverloadEndScene) record-&gt;pTrampoline; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> result = pTrampoline(pd3dDevice); deferredCommands-&gt;Run(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"> Present        ( )    Capture</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">VOID WINAPI </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Capture</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IDirect3DDevice9* pd3dDevice)</span></span></span><span class="hljs-function"> </span></span>{ IDirect3DSurface9 *renderTarget = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; IDirect3DSurface9 *destTarget = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; HRESULT res1 = pd3dDevice-&gt;GetRenderTarget(<span class="hljs-number"><span class="hljs-number">0</span></span>, &amp;renderTarget); D3DSURFACE_DESC descr; HRESULT res2 = renderTarget-&gt;GetDesc(&amp;descr); HRESULT res3 = pd3dDevice-&gt;CreateOffscreenPlainSurface( descr.Width, descr.Height, <span class="hljs-comment"><span class="hljs-comment">/*D3DFMT_A8R8G8B8*/</span></span>descr.Format, D3DPOOL_SYSTEMMEM, &amp;destTarget, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); HRESULT res4 = pd3dDevice-&gt;GetRenderTargetData(renderTarget, destTarget); D3DLOCKED_RECT lockedRect; ZeroMemory(&amp;lockedRect, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(lockedRect)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (destTarget == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; HRESULT res5 = destTarget-&gt;LockRect(&amp;lockedRect, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, D3DLOCK_READONLY); HRESULT res7 = destTarget-&gt;UnlockRect(); HRESULT res6 = D3DXSaveSurfaceToFile(screenshootPath, D3DXIFF_BMP, destTarget, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); renderTarget-&gt;Release(); destTarget-&gt;Release(); }</code> </pre> <br></div></div><br>  EndScene    .     ,    . <br><br> ,       DirectX 9.       ,    โ     API.  ,       ,   UI,        โ ,      . <br><br>   ,      EndScene()    โ            .      EndScene ,      lockstep. <br><br>    ,  . <br><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">  </b> <div class="spoiler_text" style=";text-align:right;direction:rtl">       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">DirectX SDK</a> ,    ,  DirectX 9  DirectX 11.           DirectX 11,    -      SDK,     (  ,         )   ,     ,     DXUT,      ,      โ   ,   FPS   . <br><br> <a href=""><img src="https://habrastorage.org/webt/o-/hq/zg/o-hqzgthdamhzrum5h8upaenqly.png"></a> <br> <i> 21 โ     DirectX SDK   StateManager.exe</i> <br></div></div><br>          injected.dll   Dota 2. <b> ,   ,        ยซยป   โ   Opcode Hook (,       )    .       โ   Hardware Breakpoint  ,        .          Opcode Hook  HWBP  ,     (  2- ),   ( 3 ).      ,      .   ,              โ         .</b> <br><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">    ( )</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/d9/tw/44/d9tw44gqefmz8pvwr1c7y-ppbhq.png"><br> <i> 22 โ  </i> <br></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">     </b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/nk/v4/za/nkv4zafl57fjog_vqnsf5k1q-va.png"><br> <i> 23 โ    </i> <br></div></div><br>    1x1. <br> <a href=""><img src="https://habrastorage.org/webt/r2/6v/ix/r26vixlwxtaspaykchnffmpwexm.png"></a> <br> <i> 24 โ   </i> <br><br>   ,      โ         .  ,             ,            ,      - . <br><br>   UI      ,    DirectX 9 โ  ,      .        API,        ,     โ  , UI  . ,   2D. <br><br><h2 style=";text-align:right;direction:rtl"> 10.    </h2><br>         API  ,    ,    , UI  ,    .  Valve   Dota 2 API  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Javascript</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Lua</a> .    ,       ,   C++  (   C++,      ).      ,     โ    , ,  ,    . ,      . <br><br>     DoIncludeScript,       Lua    Scripting API.       ,       ,     C++,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">or_75</a>     .     ,          ,       . <br><br>  ููุจุฏุฃ.   :      DoIncludeScript,      ,  .           silk_way.lib. ,    ,        โ            .      ,        . <br><br>            ,     (    client.dll,        ).      tlHelp32       ,          GetModuleInfo. <br><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">  GetModuleInfo</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> IScanner::GetModuleInfo(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* name, MODULEENTRY32* entry) { HANDLE snapshot = CreateToolhelp32Snapshot(TH32CS_SNAPMODULE32 | TH32CS_SNAPMODULE, GetCurrentProcessId()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (snapshot == INVALID_HANDLE_VALUE) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; entry-&gt;dwSize = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(MODULEENTRY32); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Module32First(snapshot, entry)) { CloseHandle(snapshot); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_stricmp(entry-&gt;szModule, name)) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Module32Next(snapshot, entry)); CloseHandle(snapshot); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br></div></div><br>        ,     ยซ??ยป โ  โj9 ??  ุุ  ุุ  ุุ 48 03 08 ?? f1 ffโ. <br><br>  ,          unsigned char ,    . <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* IScanner::Parse(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&amp; len, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* strPattern, <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* skipByteMask) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> strPatternLen = <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(strPattern); <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* pattern = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[strPatternLen]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; strPatternLen; i++) pattern[i] = <span class="hljs-number"><span class="hljs-number">0</span></span>; len = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; strPatternLen; i += <span class="hljs-number"><span class="hljs-number">2</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> code = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPattern[i] == SKIP_SYMBOL) skipByteMask[len] = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> code = Parse(strPattern[i]) * <span class="hljs-number"><span class="hljs-number">16</span></span> + Parse(strPattern[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]); i++; pattern[len++] = code; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> pattern; } <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> IScanner::Parse(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> byte) { <span class="hljs-comment"><span class="hljs-comment">// some magic values if (byte &gt;= '0' &amp;&amp; byte &lt;= '9') return byte - '0'; else if (byte &gt;= 'a' &amp;&amp; byte &lt;= 'f') return byte - 'a' + 10; else if (byte &gt;= 'A' &amp;&amp; byte &lt;= 'F') return byte - 'A' + 10; return 0; }</span></span></code> </pre> <br>      FindPattern,            .   ,     ,   VirtualQuery,      โ     (     ),    ,      PageGuard: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* pStart = moduleEntry.modBaseAddr; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* pFinish = moduleEntry.modBaseAddr + moduleEntry.modBaseSize; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* current = (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*)pStart; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; current &lt; pFinish &amp;&amp; j &lt; patternLen; current++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!VirtualQuery((LPCVOID)current, &amp;info, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(info))) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> protectMask = PAGE_READONLY | PAGE_READWRITE | PAGE_EXECUTE_READWRITE | PAGE_EXECUTE | PAGE_EXECUTE_READ; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (info.State == MEM_COMMIT &amp;&amp; info.Protect &amp; protectMask &amp;&amp; !(info.Protect &amp; PAGE_GUARD)) { <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> finish = (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)pFinish &lt; (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)info.BaseAddress + info.RegionSize ? (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)pFinish : (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>) info.BaseAddress + info.RegionSize; current = (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*)info.BaseAddress; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* rip = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> k = (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)info.BaseAddress; k &lt; finish &amp;&amp; j &lt; patternLen; k++, current++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (skipByteMask[j] || pattern[j] == *current) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (j == <span class="hljs-number"><span class="hljs-number">0</span></span>) rip = current; j++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { j = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pattern[<span class="hljs-number"><span class="hljs-number">0</span></span>] == *current) { rip = current; j = <span class="hljs-number"><span class="hljs-number">1</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (j == patternLen) { current = rip; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> current += sysInfo.dwPageSize; }</code> </pre> <br>         ,    ,   .  Steam        (,      x64dbg      โ    IDA Pro   ),    dota2.exe   ...\Steam\steamapps\common\dota 2 beta\game\bin\win64.    ,  VAC    Cheat Engine  x64dbg,  ,       .  ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ScyllaHide</a> ,       NtCreateThreadEx, NtSetInformationThread  . .,    ,    . <br><br>    (  10-15)     Run (F9).   ,        .        (Search for-&gt;All Modules-&gt;String References),   โDoIncludeScriptโ. <br><br> <a href=""><img src="https://habrastorage.org/webt/nl/t2/x7/nlt2x7qovaunasqqpd6hqojgclw.png"></a> <br> <i> 25 โ       </i> <br><br>    ( CPU)     .      ,      client.dll,     server.dll  animationsystem.dll. <br><br>      . <br><br> <a href=""><img src="https://habrastorage.org/webt/om/os/zo/omoszo_tqtleqsulp5c97sp7iwo.png"></a> <br> <i> 26 โ  </i> <br><br>     ,   DoIncludeScript โ   . ,  . <br><br> <a href=""><img src="https://habrastorage.org/webt/ja/pp/zo/jappzokowbi-si2zm8zchka3pjk.png"></a> <br> <i> 27 โ  DoIncludeScript</i> <br><br> . <br><br> <a href=""><img src="https://habrastorage.org/webt/ji/q0/w9/jiq0w96b8mmvbuh7un7iyiffq_8.png"></a> <br> <i> 28 โ    DoIncludeScript</i> <br><br>           (   ,   ). <br><br> <a href=""><img src="https://habrastorage.org/webt/pb/rl/8h/pbrl8hdsnnowxoyfq-lz1xbq3xg.png"></a> <br> <i> 29 โ    DoIncludeScript</i> <br><br>       27   DoIncludeScript.   ,         ,   ยซ??ยป.    : 40 57 48 81 EC ??  ุุ  ุุ  ุุ 48 83 3D ??  ุุ  ุุ  ุุ  ุุ 48 8B F9 0F 84.          28,       27. <br><br>    Lua silk_way.lua,    ยซ...\Steam\steamapps\common\dota 2 beta\game\dota\scripts\vscriptsยป. <br><br><pre style=";text-align:right;direction:rtl"> <code class="lua hljs"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"SILK_WAY START"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> first = Entities:First() <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (first ~= <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> position = first:GetAbsOrigin() <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> strInfo = <span class="hljs-string"><span class="hljs-string">"["</span></span> .. <span class="hljs-string"><span class="hljs-string">"pos:"</span></span> .. <span class="hljs-built_in"><span class="hljs-built_in">tostring</span></span>(position.x) .. <span class="hljs-string"><span class="hljs-string">","</span></span> .. <span class="hljs-built_in"><span class="hljs-built_in">tostring</span></span>(position.y) .. <span class="hljs-string"><span class="hljs-string">","</span></span> .. <span class="hljs-built_in"><span class="hljs-built_in">tostring</span></span>(position.z) .. <span class="hljs-string"><span class="hljs-string">"]"</span></span> DebugDrawText(position, strInfo, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-number"><span class="hljs-number">300.0</span></span>) first = Entities:Next(first) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"SILK_WAY FINISH"</span></span>) <span class="hljs-comment"><span class="hljs-comment">--[[ListenToGameEvent("dota_roshan_kill",roshan_kill,nil)]]</span></span></code> </pre> <br>             . <br><br>  ,          29. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">typedef</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*fDoIncludeScript)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">*, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>;</code> </pre> <br><br>  . <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">HRESULT WINAPI </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EndSceneHook</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IDirect3DDevice9* pd3dDevice)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (controller == <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>) { controller = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GameController(); controller-&gt;SetDevice(pd3dDevice); fDoIncludeScript DoIncludeScript = (fDoIncludeScript) scanner-&gt;FindPattern(<span class="hljs-string"><span class="hljs-string">"client.dll"</span></span>, <span class="hljs-string"><span class="hljs-string">"40 57 48 81 EC ?? ?? ?? ?? 48 83 3D ?? ?? ?? ?? ?? 48 8B F9 0F 84"</span></span>); DoIncludeScript(<span class="hljs-string"><span class="hljs-string">"silk_way"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-comment"><span class="hljs-comment">//... }</span></span></code> </pre> <br>        . <br><br> <a href=""><img src="https://habrastorage.org/webt/en/x2/4l/enx24lrbff5j_6l0v4ydxhecm84.png"></a> <br> <i> 30 โ  </i> <br><br>      .     Lua,  ,   ,   ,    C++  (        ),  ?         (     DoIncludeScript),          Source SDK  Source2Gen.      ,               .       ,  ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> . <br><br><h2 style=";text-align:right;direction:rtl"> 11.  </h2><br>        ,         ,    .    Dota 2  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">praydog</a>     ,    Cheat Engine    ,         Valve .      ,      .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">or75</a>     DoIncludeScript           . <br><br>        - ,   ,    ,  ,   โ      ,       .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> . <br><br>  ,      . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar446516/">https://habr.com/ru/post/ar446516/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar446504/index.html">ุงูุงุณุชุฎุฏุงู ุงูุนููู ูุฌูุงุฒ D-Wave 2000Q: ููุญูู ุชุนูููู ุญุงุฏ ููุญูุณุจุฉ ุงููููููุฉ</a></li>
<li><a href="../ar446506/index.html">ุฎูุณุฉ ุฃุณุฆูุฉ ุฑุฆูุณูุฉ ููุจูุน ุจุงูุชุฌุฒุฆุฉ ุนูุฏ ุงูุงูุชูุงู ุฅูู ุงูุณุญุจ</a></li>
<li><a href="../ar446508/index.html">. NET ุงูุนูุงู ุงูุฃุณุงุณูุฉ ูุซู ุฎุฏูุงุช ูููุฏูุฒ</a></li>
<li><a href="../ar446510/index.html">CLRium # 5: ุฌุงูุน ุงูููุงูุฉ. ุฃูุจุฑ ูุฑุดุฉ ุนูู</a></li>
<li><a href="../ar446514/index.html">ูุจูุบ ุนูุฑ Gmail 15 ุนุงููุง</a></li>
<li><a href="../ar446518/index.html">ุฌุฏุฑุงู ุญูุงูุฉ ุชุทุจูู ุงูููุจ</a></li>
<li><a href="../ar446522/index.html">ุณูููุช 5.1 - ูุง ุงูุฌุฏูุฏุ</a></li>
<li><a href="../ar446530/index.html">Word2vec ูู ุงูุตูุฑ</a></li>
<li><a href="../ar446532/index.html">Upwork ููุฏู ุฑุณูููุง ููุงุจู ุญู ุงููุชุงุจุฉ ุฅูู ุนููู ูุญุชูู</a></li>
<li><a href="../ar446534/index.html">ุงูุจุตุฑูุฉ ุณุชูุฏูู 2019 ุฃุทูู ุณุฑุงุญู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>