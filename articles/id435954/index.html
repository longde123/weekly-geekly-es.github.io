<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎂 🏴 🛀🏿 Mengembangkan modul untuk boneka dengan kit pengembangan boneka ⚡️ 👨‍🚀 🗞️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sekitar sebulan yang lalu, saya punya pilihan: apakah akan menulis modul untuk boneka "to the table" (yaitu, untuk infrastruktur internal) atau membua...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mengembangkan modul untuk boneka dengan kit pengembangan boneka</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435954/"><p>  Sekitar sebulan yang lalu, saya punya pilihan: apakah akan menulis modul untuk boneka "to the table" (yaitu, untuk infrastruktur internal) atau membuatnya universal, buka sumbernya dan publikasikan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">boneka wayang</a> .  Tentu saja, akan lebih cepat dan lebih mudah untuk membuat sketsa 2-3 kelas untuk diri sendiri dan tenang, tetapi pengalaman yang diperoleh dalam proses penerbitan modul ini berharga dan saya ingin membaginya.  Di RuNet, tidak ada informasi tentang penggunaan kit pengembangan boneka (selanjutnya disebut <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PDK</a> ), sehingga Anda dapat menganggap ini semacam tutorial. </p><br><h2 id="o-chyom-statya">  Tentang apa artikel itu </h2><br><p>  Dalam proses mengembangkan modul (atau lebih tepatnya, dua), saya menemukan PDK, yang sangat memudahkan pengembangan dan pemeliharaan modul.  Yaitu: </p><br><ul><li> Secara otomatis memformat <code>metadata.json</code> saat memperbarui terakhir </li><li>  Pembuatan konfigurasi untuk berbagai sistem CI yang dapat melakukan hal berikut: <br><ul><li>  Memeriksa kode ruby ​​dengan rubocop linter </li><li>  Tes Unit Menjalankan </li><li>  Dalam kondisi tertentu - pengisian otomatis kode kerja boneka tempa </li></ul></li><li>  Membuat dokumentasi berbasis tag dalam komentar menggunakan halaman </li><li>  Piring <code>[PDK]</code> untuk modul di boneka wayang.  Agak, tapi bagus! </li></ul><br><p>  Semua tertarik <a name="habracut"></a>  Saya minta kucing! </p><br><h4 id="v-kachestve-primerov">  Sebagai contoh </h4><br><p>  Jika Anda ingin melihat dan merasakan apa yang dimaksud selama proses membaca, Anda dapat membuka salah satu dari dua (atau keduanya) modul yang disebutkan: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">clickhouse</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">xmlsimple</a> .  Keduanya dikembangkan menggunakan PDK dan alat-alat lain yang dijelaskan dalam artikel. </p><br><h2 id="soderzhanie">  Isi </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tentang apa artikel itu</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Sebagai contoh</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Apa itu PDK?</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Instalasi</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Konten PDK</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Buat modul</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kelas baru</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">type_type baru</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">penyedia &amp; tugas baru</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Menghasilkan dokumentasi dengan string boneka</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kustomisasi template</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Menjalankan berbagai CI</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bonus: kami menulis unit test untuk kelas, tipe dan fungsi</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Alih-alih output</a> </li></ul><br><h1 id="chto-zhe-takoe-pdk">  Apa itu PDK? </h1><br><p>  Dari dokumentasi resmi: </p><br><blockquote>  Buat modul lengkap dengan kelas, tipe yang ditentukan, dan tugas, dan uji dan validasi pekerjaan Anda saat Anda pergi.  PDK menyediakan struktur modul yang lengkap, templat untuk kelas, tipe yang ditentukan, dan tugas, dan infrastruktur pengujian.  Anda dapat memvalidasi dan menguji modul Anda terhadap berbagai sistem operasi dan beberapa versi Wayang. </blockquote><p>  Dalam terjemahan gratis saya: </p><br><blockquote>  Memungkinkan Anda membuat modul lengkap dengan kelas, jenis, tugas, dan tes untuk memverifikasi operasi modul.  PDK menyediakan struktur dan template lengkap untuk semua hal di atas.  Dengan menggunakan alat ini, Anda dapat memeriksa pengoperasian modul dengan berbagai versi boneka, serta dalam berbagai OS. </blockquote><p>  Kedengarannya bagus?  Ya, begitulah sebenarnya.  Sampai saat ketika saya mulai mengerjakan modul, yang diputuskan untuk menulis segera untuk open source, saya tidak mencurigai alat ini, dan sekarang saya bermaksud untuk mentransfer seluruh infrastruktur internal untuk menggunakan PDK. </p><br><p>  Saya akan menjelaskan cara memasukkannya, dan alat serta perintah apa yang dikandungnya. </p><br><h2 id="ustanovka">  Instalasi </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Halaman instalasi resmi</a> .  Dengan menggunakan tautan ini, Anda hampir dijamin menemukan cara yang tepat untuk memasang PDK di host Anda.  Jika karena alasan tertentu Anda tidak beruntung dan OS Anda tidak ada, selalu ada bundaran di formulir: </p><br><pre> <code class="bash hljs">gem install pdk</code> </pre> <br><p>  Faktanya, PDK hanyalah permata, dan sudah diatur seperti itu. </p><br><h2 id="soderzhimoe-pdk">  Konten PDK </h2><br><p>  Secara umum, PDK tidak lebih dari satu set permata untuk memfasilitasi pengembangan modul.  Ini berisi alat-alat berikut: </p><br><table><thead><tr><th>  Utilitas </th><th>  Deskripsi </th></tr></thead><tbody><tr><td>  metadata-json-lint </td><td>  Periksa metadata.json untuk panduan gaya boneka yang cocok </td></tr><tr><td>  pdk </td><td>  Alat untuk membuat dan menguji modul dan isinya (kelas, tipe, dll.) Dari baris perintah </td></tr><tr><td>  kain boneka </td><td>  Periksa kode boneka untuk panduan gaya Bahasa Wayang </td></tr><tr><td>  sintaksis boneka </td><td>  Verifikasi sintaks manifes </td></tr><tr><td>  puppetlabs_spec_helper </td><td>  Menyediakan kelas Rake, metode, dan tugas untuk tes spesifikasi kode boneka </td></tr><tr><td>  rspec-boneka </td><td>  Menguji perilaku boneka saat menyusun manifes ke direktori sumber daya (?) </td></tr><tr><td>  rspec-boneka-fakta </td><td>  Memungkinkan Anda menjalankan boneka-rspec dengan fakta boneka-pengguna yang ditentukan </td></tr></tbody></table><br><h2 id="sozdayom-modul">  Buat modul </h2><br><p>  PDK terpasang, sekarang Anda bisa bermain-main.  Perintah <code>pdk help</code> paling sederhana <code>pdk help</code> menampilkan perintah yang tersedia.  Misalkan kita berada di folder tempat Anda memiliki semua modul lainnya.  Lalu mari kita buat yang baru: </p><br><pre> <code class="plaintext hljs">$ pdk new module --template-url=https://github.com/puppetlabs/pdk-templates.git *** We need to create the metadata.json file for this module, so we're going to ask you 5 questions. *** [Q 1/5] If you have a name for your module, add it here. --&gt; dummy [Q 2/5] If you have a Puppet Forge username, add it here. --&gt; felixoid [Q 3/5] Who wrote this module? --&gt; Mikhail f. Shiryaev [Q 4/5] What license does this module code fall under? --&gt; MIT [Q 5/5] What operating systems does this module support? --&gt; RedHat based Linux, Debian based Linux, Windows Metadata will be generated based on this information, continue? Yes pdk (INFO): Module 'dummy' generated at path '/tmp/dummy', from template 'https://github.com/puppetlabs/pdk-templates.git'.</code> </pre> <br><p>  Utilitas ini mengajukan pertanyaan untuk mengisi file metadata.json, dan hasilnya persis seperti yang ditunjukkan: modul dan file tambahan dikompilasi dari template dari git. </p><br><p>  Sebuah komentar kecil - templite sering berubah, termasuk beberapa bug kritis yang telah diperbaiki baru-baru ini.  Karena itu, lebih baik menggunakan bukan default dari PDK yang diinstal, tetapi versi terbaru.  Benar, ada sisi lain: ketika menggunakan argumen <code>--template-url</code> , PDK menambahkan parameter ini ke file <code>~.pdk/cache/answers.json</code> dan, dilihat dari keterlambatan dalam eksekusi lebih lanjut dari perintah <code>pdk</code> , ia mencoba untuk mengunduhnya.  Jadi hapus parameter ini dari <code>answers.json</code> , atau jangan gunakan saat membuat modul dan ubah di <code>metadata.json</code> . </p><br><p>  Mari kita lanjutkan langkah-langkah selanjutnya yang bisa dilakukan menggunakan PDK. </p><br><h3 id="new-class">  kelas baru </h3><br><pre> <code class="plaintext hljs">$ pdk new class dummy::class pdk (INFO): Creating '/tmp/dummy/manifests/class.pp' from template. pdk (INFO): Creating '/tmp/dummy/spec/classes/class_spec.rb' from template. $ cat manifests/class.pp # A description of what this class does # # @summary A short summary of the purpose of this class # # @example # include dummy::class class dummy::class { } $ cat spec/classes/class_spec.rb require 'spec_helper' describe 'dummy::class' do on_supported_os.each do |os, os_facts| context "on #{os}" do let(:facts) { os_facts } it { is_expected.to compile } end end end</code> </pre> <br><p>  Perintah ini menciptakan 2 file: manifes itu sendiri untuk kelas dan file spesifikasi untuk mengujinya.  Saya akan membahas tag untuk dokumentasi nanti secara lebih rinci. </p><br><h3 id="new-defined_type">  type_type baru </h3><br><pre> <code class="plaintext hljs">$ pdk new defined_type type pdk (INFO): Creating '/tmp/dummy/manifests/type.pp' from template. pdk (INFO): Creating '/tmp/dummy/spec/defines/type_spec.rb' from template.</code> </pre> <br><p>  Semua sama: manifes untuk jenis sumber daya dan file spesifikasi. </p><br><h4 id="new-provider--task">  penyedia &amp; tugas baru </h4><br><p>  PDK juga dapat membuat penyedia atau tugas baru, tetapi saya tidak bekerja sama dengan mereka, jadi saya akan dengan jujur ​​mengatakan bahwa lebih baik mempelajari topik ini lebih dalam jika perlu. </p><br><h2 id="generaciya-dokumentacii-pri-pomoschi-puppet-strings">  Menghasilkan dokumentasi dengan string boneka </h2><br><p>  Saya tidak benar-benar mengerti mengapa <code>puppet strings</code> bukan bagian dari toolkit PDK, tapi ini a la vie.  Jika selama pengembangan Anda menempatkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tag</a> dengan benar untuk halaman, maka ada 2 cara utama untuk memberikan dokumentasi kepada pengguna: </p><br><ul><li>  Hasilkan sebagai HTML / Markdown / JSON dan letakkan di sebelah kode.  Ini dilakukan dengan perintah <code>puppet string generate [--format FORMAT]</code> , di mana formatnya dapat dihilangkan atau diatur ke <code>json</code> / <code>markdown</code> . <br><ul><li>  Sebagai standar untuk dokumentasi, biasanya memiliki file <code>REFERENCE.md</code> di root repositori, yang dihasilkan oleh <code>puppet strings generate --format markdown</code> . </li></ul></li><li>  Publikasikan ke repositori dengan kode (asalkan ada di github) github-pages.  Ini cukup sederhana, Anda memerlukan 3 perintah: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  Gemfile.lock,    PDK rm -f Gemfile.lock #     Gemfile   bundle bundle install --path vendor/bundle #   gh-pages   rake-task bundle exec rake strings:gh_pages:update</span></span></code> </pre> </li></ul><br><p>  Tampaknya tidak ada keajaiban, tetapi pada output kita memiliki modul dengan instruksi.  Nilai tambahnya adalah bahwa meskipun Anda tidak menjelaskan, katakanlah, masing-masing parameter menggunakan tag <code>@param</code> , output akan tetap berupa kelas / tipe / fungsi dengan deskripsi parameter yang minimal dengan jenis dan nilai default.  Menurut pendapat saya, bahkan ini lebih baik daripada tidak sama sekali, dan akan membuat modul lebih menarik untuk digunakan. </p><br><p>  Tentu saja, semua ini dapat diotomatisasi dan ditambahkan sebagai tahap CI.  Itu akan sempurna.  Tangan saya belum mencapai, tetapi sedang mengumpulkan debu di tumpukan.  Jika tiba-tiba seseorang mengatakan sesuatu tentang topik ini - saya akan berterima kasih.  Sebagai pemikiran: setidaknya tambahkan tanda centang untuk melihat apakah REFERENSI.md berubah setelah menjalankan string-boneka.  Dan jika demikian, anggap tes gagal. </p><br><h2 id="nastroyka-shablonov">  Kustomisasi template </h2><br><p>  Dokumentasi untuk templat terletak di repositori <a href="">pdk-templates</a> .  Singkatnya, semuanya dikonfigurasi menggunakan file <code>.sync.yml</code> di direktori root modul, dan perubahan diterapkan menggunakan perintah <code>pdk update</code> .  Setiap parameter file ini adalah nama file lain di direktori modul, yang harus diubah dengan satu atau lain cara.  Sebagian besar parameter untuk masing-masing templat saya harus memilih "dengan sentuhan", melihat kode sumber, sering - dengan coba-coba.  Dokumentasi di sini terkadang jauh tertinggal.  Sayangnya, hampir tidak ada lagi yang bisa dikatakan, kecuali untuk memberikan tautan ke <a href="">contoh</a> dari repositori Anda sendiri. </p><br><p>  Saya akan dengan cepat menggambarkan beberapa parameter yang saya ubah menggunakan <code>.sync.yml</code> dari contoh di atas: </p><br><ul><li>  <code>Gemfile</code> : dua <code>Gemfile</code> ditambahkan sebagai dependensi dalam grup yang berbeda: pdk dalam grup pengembangan;  xml-sederhana di grup dependensi.  Saat memulai tes, grup system_tests tidak diinstal, jadi saya menambahkan ketergantungan ke grup lain. </li><li>  <code>spec/spec_helper.rb</code> : metode moking telah diubah, ambang batas cakupan tes minimum telah ditambahkan, di bawah ini pengujian dianggap gagal. </li><li>  <code>.travis.yml</code> : file ini telah dipoles sejak lama, karena digunakan untuk memeriksa basis kode dan memuat modul yang sudah selesai pada puppet-forge.  Perubahan: <br><ul><li>  Pengguna dan kata sandi terenkripsi untuk mengisi modul pada boneka-menempa.  Anda dapat membaca lebih lanjut tentang menggunakan boneka-forge dengan Travis di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . </li><li>  Urutan tes telah dibuat → penyebaran dengan peluncuran yang terakhir hanya dengan tes yang berhasil. </li><li>  Menambahkan tahap penerapan modul ke puppet-forge, asalkan CI diluncurkan dari tag dimulai dengan karakter "v". </li></ul></li><li>  <code>Rakefile</code> : menambahkan beberapa pengecualian untuk linter. </li></ul><br><h2 id="zapusk-razlichnyh-ci">  Menjalankan berbagai CI </h2><br><p>  Semuanya cukup sederhana di sini.  Segera setelah membuat modul menggunakan PDK, validasi dimulai di appveyor, travis, dan gitlab-ci.  Untuk menjalankan tes, semuanya siap langsung dari kotak, untuk penyetelan, <code>.sync.yml</code> sama <code>.sync.yml</code> .  Saya tidak punya preferensi tertentu, jadi saya tidak akan merekomendasikan apa pun.  Cukup gunakan apa pun yang lebih nyaman. </p><br><h2 id="bonus-pishem-yunit-testy-dlya-klassov-tipov-i-funkciy">  Bonus: kami menulis unit test untuk kelas, tipe dan fungsi </h2><br><p>  Poin ini melampaui sedikit bahan dasar yang saya rencanakan untuk dijelaskan, tetapi bagi saya tampaknya sangat berguna. </p><br><p>  Jadi, kami memiliki modul dengan manifes dan perpustakaan, yang, pada gilirannya, berisi kelas, jenis dan fungsi (kami juga tidak melupakan tugas dan penyedia, tetapi di bagian ini saya tidak memiliki keahlian).  Karena ada kode apa pun untuk tujuan perubahan, alangkah baiknya, tentu saja, overlay dengan tes untuk memastikan 2 hal: </p><br><ul><li>  Perubahan tidak merusak perilaku saat ini (atau perubahan perilaku dengan tes) </li><li>  Manifes Anda melakukan persis apa yang Anda harapkan dan menggunakan semua sumber daya yang Anda harapkan. </li></ul><br><p>  Puppetlabs menyediakan ekstensi untuk kerangka rspec yang disebut <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">puppet-rspec</a> .  Tautan ke dokumentasi untuk menguji <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kelas</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tipe,</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">fungsi</a> .  Jangan terlalu malas melihat dari dekat, ada bagian lain. </p><br><p>  Untuk mulai menggunakannya cukup sederhana, tanpa tahu ruby.  Jika kelas atau tipe dibuat, seperti yang ditunjukkan di atas, menggunakan <code>pdk new &lt;thing&gt;</code> , maka file <code>*_spec.rb</code> juga sudah ada.  Jadi, misalkan kita memiliki <code>dummy::class</code> .  Untuk mengujinya, file <code>spec/classes/class_spec.rb</code> harus dibuat dengan konten berikut: </p><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'spec_helper'</span></span> describe <span class="hljs-string"><span class="hljs-string">'dummy::class'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> on_supported_os.each <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|os, os_facts|</span></span> context <span class="hljs-string"><span class="hljs-string">"on </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{os}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> let(<span class="hljs-symbol"><span class="hljs-symbol">:facts</span></span>) { os_facts } it { is_expected.to compile } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Anda dapat memverifikasi dengan menjalankan <code>pdk test unit</code> dari direktori root modul. </p><br><p>  Itu hampir semua yang kita butuhkan.  Sekarang tinggal menambahkan <code>class_spec.rb</code> <code>is_expected</code> dengan kondisi yang sesuai.  Misalnya, untuk memeriksa bahwa kelas berisi sumber daya <code>file {'/file/path': }</code> dengan parameter tertentu, Anda dapat melakukan ini: </p><br><pre> <code class="ruby hljs">it <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> is_expected.to contain_file(<span class="hljs-string"><span class="hljs-string">'/file/path'</span></span>).with( <span class="hljs-string"><span class="hljs-string">'ensure'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'file'</span></span>, <span class="hljs-string"><span class="hljs-string">'mode'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'0644'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Anda dapat mengatur parameter kelas menggunakan <code>let(:params) { {'param1' =&gt; 'value'} }</code> , dimungkinkan untuk melakukan pengujian di bawah berbagai kondisi input dengan menempatkan masing-masing di dalam bagian <code>context 'some description' {}</code> dipilih <code>context 'some description' {}</code> .  Dimungkinkan untuk memeriksa kedua dependensi antara sumber daya dan antara kelas: jika diasumsikan, misalnya, bahwa deklarasi kelas berisi <code>inherits</code> , maka Anda dapat menambahkan <code>is_expected.to contain_class('parent_class_name')</code> .  Perlu memeriksa perilaku di OS yang berbeda?  Itu juga mungkin: kami hanya menunjukkan dalam konteks terpisah fakta-fakta yang diperlukan: </p><br><pre> <code class="ruby hljs">context <span class="hljs-string"><span class="hljs-string">'with Debian'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> let(<span class="hljs-symbol"><span class="hljs-symbol">:facts</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">os:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">architecture:</span></span> <span class="hljs-string"><span class="hljs-string">'amd64'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">distro:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">codename:</span></span> <span class="hljs-string"><span class="hljs-string">'stretch'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">id:</span></span> <span class="hljs-string"><span class="hljs-string">'Debian'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">release:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">full:</span></span> <span class="hljs-string"><span class="hljs-string">'9.6'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">major:</span></span> <span class="hljs-string"><span class="hljs-string">'9'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">minor:</span></span> <span class="hljs-string"><span class="hljs-string">'6'</span></span>, }, }, <span class="hljs-symbol"><span class="hljs-symbol">family:</span></span> <span class="hljs-string"><span class="hljs-string">'Debian'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">name:</span></span> <span class="hljs-string"><span class="hljs-string">'Debian'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">release:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">full:</span></span> <span class="hljs-string"><span class="hljs-string">'9.6'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">major:</span></span> <span class="hljs-string"><span class="hljs-string">'9'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">minor:</span></span> <span class="hljs-string"><span class="hljs-string">'6'</span></span>, }, <span class="hljs-symbol"><span class="hljs-symbol">selinux:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">enabled:</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>, }, }, <span class="hljs-symbol"><span class="hljs-symbol">osfamily:</span></span> <span class="hljs-string"><span class="hljs-string">'Debian'</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> it { is_expected.to something } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Secara umum, sejauh yang saya berhasil perhatikan dalam proses menulis tes, kerangka ini memungkinkan Anda untuk memeriksa hampir semua yang mungkin diperlukan.  Dan kehadiran tes pernah membantu saya ketika beberapa parameter dipindahkan dari kelas anak ke kelas atas modul: mereka menunjukkan bahwa refactoring tidak merusak apa pun, dan perilaku seluruh modul tidak berubah. </p><br><h1 id="vmesto-vyvoda">  Alih-alih output </h1><br><p>  Karena sudah dapat dipahami dari intonasi umum artikel, saya sangat terdorong oleh seberapa banyak Wayang bekerja dengan modul dan memanifestasikan lebih mudah berkat PDK.  Tindakan rutin dilakukan secara otomatis, templat digunakan sedapat mungkin, konfigurasi untuk CI populer tersedia di luar kotak.  Ini mungkin tampak seperti semacam overhead, dan penggunaannya mungkin tidak menghasilkan buah yang diharapkan, tetapi itu pasti sepadan.  Jika Anda membandingkan cara mengembangkan modul tanpa dan dengan PDK, maka bagi saya tampilannya seperti ini: </p><br><table><thead><tr><th>  Pengembangan tanpa <del>  jenggot </del>  PDK </th><th>  Pengembangan PDK </th></tr></thead><tbody><tr><td><img src="https://habrastorage.org/webt/hb/gg/xd/hbggxdj1znic1fgofyl-sb3oz0c.jpeg" width="300"></td><td><img src="https://habrastorage.org/webt/rw/4n/j-/rw4nj-vux8ricpk46hih5iu_3js.jpeg" width="300"></td></tr></tbody></table><br><p>  Coba, letakkan, buat hidup lebih mudah untuk Anda dan kolega Anda.  Saya akan dengan senang hati menjawab pertanyaan potensial. </p><br><p>  Semoga atomisasi bersama kita! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id435954/">https://habr.com/ru/post/id435954/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id435944/index.html">Intisari Desain Makanan, Desember 2018</a></li>
<li><a href="../id435946/index.html">Imager termal DIY di Raspberry PI atau "Sepertinya sekarang saya tahu apa yang akan saya lakukan musim panas ini"</a></li>
<li><a href="../id435948/index.html">Kursus MIT "Keamanan Sistem Komputer". Kuliah 23: Ekonomi Keamanan, Bagian 3</a></li>
<li><a href="../id435950/index.html">Pusat data modular dalam layanan Large Hadron Collider</a></li>
<li><a href="../id435952/index.html">Siapa "tuan rumah yang tidak dicuci"?</a></li>
<li><a href="../id435956/index.html">PHP Digest No. 147 (1 - 14 Januari 2019)</a></li>
<li><a href="../id435958/index.html">Intisari bahan-bahan segar dari dunia frontend selama minggu terakhir No. 347 (7 - 13 Januari 2019)</a></li>
<li><a href="../id435960/index.html">Eksperimen Pikiran: Berkibar saat Pergi</a></li>
<li><a href="../id435962/index.html">Peringatan 25 tahun Aeron: sensasi dan kesan versi Aeron Remastered yang diperbarui</a></li>
<li><a href="../id435964/index.html">Ethereum berencana menjadi 99% lebih ekonomis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>