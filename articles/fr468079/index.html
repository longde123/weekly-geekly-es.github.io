<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸƒ ğŸ™ ğŸ•µğŸ» Dimensions personnalisÃ©es dans Google Analytics qui nous ont fait Ã©conomiser plus d'une fois ğŸ”½ ğŸ‘©â€ğŸš’ ğŸ¤·ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lors de la configuration de l'analyse via Google Analytics (GA), les paramÃ¨tres utilisateur ou le CD ( dimensions personnalisÃ©es ) sont souvent ignorÃ©...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dimensions personnalisÃ©es dans Google Analytics qui nous ont fait Ã©conomiser plus d'une fois</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468079/">  Lors de la configuration de l'analyse via Google Analytics (GA), les paramÃ¨tres utilisateur ou le CD ( <i>dimensions personnalisÃ©es</i> ) sont souvent ignorÃ©s.  Cela est dÃ» Ã  la difficultÃ© de comprendre leur portÃ©e: on ne sait pas exactement comment les CD peuvent aider Ã  collecter et analyser les donnÃ©es et comment ils sont configurÃ©s.  Cet article dÃ©crit les principaux CD que nous utilisons dans Adventum sur de nombreux projets et le processus d'installation. <br><br><h1>  Quelles sont les options utilisateur </h1><br>  Pour crÃ©er un rapport dans Google Analytics, plus de 200 paramÃ¨tres et mesures diffÃ©rents sont disponibles, tels que Â«sourceÂ», Â«villeÂ», Â«navigateurÂ», Â«systÃ¨me d'exploitationÂ» et bien d'autres.  Mais les paramÃ¨tres standard ne sont pas toujours suffisants pour l'analyse, Google a donc donnÃ© aux utilisateurs la possibilitÃ© de crÃ©er les leurs.  La valeur du CD peut Ãªtre transfÃ©rÃ©e avec n'importe quel coup de l'utilisateur.  Par exemple, Ã  l'aide de paramÃ¨tres personnalisÃ©s, vous pouvez analyser les performances du site dans le contexte des adaptatifs. <br><br>  Il y a 4 domaines d'action CD au total: <br><br><ul><li>  Hit </li><li>  SÃ©ance </li><li>  Utilisateur </li><li>  Produit </li></ul><br>  Par exemple, nous avons un CD dans lequel le paramÃ¨tre d'autorisation utilisateur est stockÃ© (0 - non autorisÃ©, 1 - autorisÃ©).  Au dÃ©but de la session, tous les utilisateurs ne sont pas autorisÃ©s.  Voyons ce qui se passe lorsque ce paramÃ¨tre change aprÃ¨s l'entrÃ©e, selon la portÃ©e du CD. <br><br><img src="https://habrastorage.org/webt/yo/ef/tr/yoeftruoaljptzlnl3xtngigfbq.jpeg"><br><br><ul><li>  pour un CD avec la portÃ©e de hit, l'unitÃ© est affectÃ©e au paramÃ¨tre d'autorisation dans le hit dans lequel l'autorisation s'est produite; </li><li>  pour un CD avec la portÃ©e de la session, le paramÃ¨tre d'autorisation deviendra Ã©gal Ã  1 pour tous les hits de la session dans laquelle l'Ã©vÃ©nement s'est produit (Ã©crasement des anciennes valeurs du CD dans cette session); </li><li>  pour un CD avec la portÃ©e de l'utilisateur, le paramÃ¨tre d'autorisation deviendra Ã©gal Ã  1 pour toutes les sessions utilisateur, Ã  partir de celui dans lequel la connexion a Ã©tÃ© effectuÃ©e. </li></ul><a name="habracut"></a><br>  Parfois, vous devez analyser les caractÃ©ristiques d'un produit dont le support n'est pas dÃ©fini dans les paramÃ¨tres de base de Google Analytics: par exemple, le poids.  Ã‰tant donnÃ© que les informations sur plusieurs produits peuvent Ãªtre transmises en une seule fois, nous aurons besoin d'un champ d'application supplÃ©mentaire avec des dÃ©tails plus approfondis.  C'est pour cette granularitÃ© que le pÃ©rimÃ¨tre Â«ProduitÂ» est utilisÃ©: <br><br><img src="https://habrastorage.org/webt/me/9m/s4/me9ms4-kjwvsn-pgj1yzdn6uxbi.jpeg"><br><br><h1>  Configuration du CD </h1><br>  La configuration d'un paramÃ¨tre utilisateur comprend deux Ã©tapes: la crÃ©ation d'un paramÃ¨tre dans GA et l'envoi de donnÃ©es depuis le site.  Ensuite, nous dÃ©crivons la sÃ©quence des Ã©tapes de configuration du CD. <br><br><h2>  CrÃ©ation d'un CD dans Google Analytics </h2><br><ol><li>  AccÃ©dez Ã  la section Â«AdministrateurÂ» </li><li>  Dans les paramÃ¨tres de ressources de la section Â«ParamÃ¨tres utilisateurÂ», sÃ©lectionnez la sous-section Â«ParamÃ¨tres spÃ©ciauxÂ»: <br><img src="https://habrastorage.org/webt/pc/b3/pp/pcb3ppb_6lwiyyxpe8ctui2qe18.jpeg"></li><li>  Cliquez sur le bouton Â«+ ParamÃ¨tre spÃ©cialÂ» <br><img src="https://habrastorage.org/webt/ak/k8/iy/akk8iyzg0rbrvrq-tawj3u-uwue.jpeg"></li><li>  Le formulaire s'ouvre: <br><img src="https://habrastorage.org/webt/82/jf/3o/82jf3oy-kbvheuwjrntj4ooxecw.jpeg"><br>  SÃ©lectionnez la portÃ©e du paramÃ¨tre: <br><br><ul><li>  Hit </li><li>  SÃ©ance </li><li>  Utilisateur </li><li>  Produit </li></ul><br>  Et laissez la coche en face de Â«ActifÂ» afin que les donnÃ©es commencent Ã  Ãªtre collectÃ©es et que le CD soit reflÃ©tÃ© dans les rapports. </li></ol><blockquote>  <b>Recommandations de titres de CD</b> <br>  Nous avons dÃ©veloppÃ© notre propre systÃ¨me pour nommer les paramÃ¨tres utilisateur. <br>  Au dÃ©but de chaque CD, nous ajoutons un symbole pour la portÃ©e.  Pour hit, il s'agit de h_ (par exemple, h_hitId), pour la session - s_ (par exemple, s_sessionId).  Cela nous aide Ã  naviguer dans les paramÃ¨tres utilisateur et Ã  toujours connaÃ®tre leur portÃ©e, sans vÃ©rifier les paramÃ¨tres du compteur.  Parfois, il devient nÃ©cessaire de crÃ©er deux paramÃ¨tres avec le mÃªme nom, mais avec une portÃ©e diffÃ©rente.  Par exemple, nous effectuons un test A / B et voulons vÃ©rifier s'il est configurÃ© correctement, la variante de test change-t-elle pendant la session.  Pour ce faire, crÃ©ez deux paramÃ¨tres avec la mÃªme valeur: nom + version de test, dans laquelle l'utilisateur est entrÃ©, mais l'un d'eux est atteint, la deuxiÃ¨me session.  Dans ce cas, la dÃ©nomination proposÃ©e sera trÃ¨s pratique. <br></blockquote><br><h2>  Configuration de Google Tag Manager </h2><br>  Il existe deux faÃ§ons de configurer l'envoi des paramÃ¨tres Ã  partir du site: <br><br><ul><li>  directement via le code HTML du site. </li><li>  via Google Tag Manager (GTM). </li></ul><br>  Pour les deux mÃ©thodes, nous avons besoin de l'index du CD dans Google Analytics.  Vous pouvez le voir dans la section "ParamÃ¨tres spÃ©ciaux": <br><br><img src="https://habrastorage.org/webt/z3/el/gs/z3elgs7abwc7vnaibkvlssffe08.jpeg"><br><br>  <b>Envoi via HTML sur le site</b> <br><br>  Mettez Ã  jour la configuration de la ressource dans le code de suivi Google Analytics en y ajoutant <font color="green">custom_map</font> (vous devez ajouter ce qui est mis en Ã©vidence des deux cÃ´tÃ©s par des commentaires): <br><br><pre><code class="javascript hljs">gtag(<span class="hljs-string"><span class="hljs-string">'config'</span></span>, <span class="hljs-string"><span class="hljs-string">'GA_MEASUREMENT_ID'</span></span> , <span class="hljs-comment"><span class="hljs-comment">//  { 'custom_map': {'dimension&lt;Index&gt;': 'dimension_name'} } //  );</span></span></code> </pre> <br>  oÃ¹ <font color="green">GA_MEASUREMENT_ID</font> est votre identifiant de compteur Analytics.  Remplacez <font color="green">&lt;Index&gt;</font> par l'index du paramÃ¨tre dans GA, et au lieu de <font color="green">dimension_name,</font> spÃ©cifiez son nom. <br><br>  Si vous avez plusieurs paramÃ¨tres utilisateur, alors <font color="green">'dimension &lt;Index&gt;'</font> : <font color="green">'nom_dimension'</font> doit Ãªtre spÃ©cifiÃ© avec une virgule pour chacun d'eux. <br><br>  Par exemple: <br><br><pre> <code class="javascript hljs">gtag(<span class="hljs-string"><span class="hljs-string">'config'</span></span>, <span class="hljs-string"><span class="hljs-string">'UA-XXXXXXXXX'</span></span>, { <span class="hljs-string"><span class="hljs-string">'custom_map'</span></span>: {<span class="hljs-string"><span class="hljs-string">'dimension1'</span></span>: <span class="hljs-string"><span class="hljs-string">'projectName'</span></span>, <span class="hljs-string"><span class="hljs-string">'dimension2'</span></span>: <span class="hljs-string"><span class="hljs-string">'hitId'</span></span>, <span class="hljs-string"><span class="hljs-string">'dimension3'</span></span>: <span class="hljs-string"><span class="hljs-string">'sessionId'</span></span>, <span class="hljs-string"><span class="hljs-string">'dimension4'</span></span>: <span class="hljs-string"><span class="hljs-string">'screenWindow'</span></span>} });</code> </pre> <br>  Afin d'envoyer un CD avec une vue de page, vous devez affecter ces paramÃ¨tres Ã  la valeur souhaitÃ©e <b>avant le code indiquÃ© ci-dessus</b> : <br><br><pre> <code class="javascript hljs">gtag(<span class="hljs-string"><span class="hljs-string">'set'</span></span>, { <span class="hljs-string"><span class="hljs-string">'dimension_name'</span></span>: <span class="hljs-string"><span class="hljs-string">'dimension_value'</span></span>});</code> </pre> <br>  oÃ¹ <font color="green">dimension_name</font> doit correspondre Ã  ceux que vous avez spÃ©cifiÃ©s dans <font color="green">'custom_map'</font> , et <font color="green">dimension_value doit</font> Ãªtre la valeur que vous souhaitez transfÃ©rer sur le CD. <br><br>  Par exemple: <br><br><pre> <code class="javascript hljs">gtag(<span class="hljs-string"><span class="hljs-string">'set'</span></span>, {<span class="hljs-string"><span class="hljs-string">'projectName'</span></span>: <span class="hljs-string"><span class="hljs-string">'shop'</span></span>, <span class="hljs-string"><span class="hljs-string">'hitId'</span></span>: <span class="hljs-string"><span class="hljs-string">'1121243'</span></span>});</code> </pre> <br>  Lors de l'envoi d'une valeur de CD avec l'Ã©vÃ©nement, vous devez envoyer le code: <br><pre> <code class="javascript hljs">gtag(<span class="hljs-string"><span class="hljs-string">'event'</span></span>, <span class="hljs-string"><span class="hljs-string">'action_value'</span></span>, {<span class="hljs-string"><span class="hljs-string">'event_category'</span></span>: <span class="hljs-string"><span class="hljs-string">'category_value'</span></span>, <span class="hljs-string"><span class="hljs-string">'event_label'</span></span>: <span class="hljs-string"><span class="hljs-string">'label_value'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-string"><span class="hljs-string">'event_value'</span></span>, <span class="hljs-string"><span class="hljs-string">'dimension_name'</span></span>: <span class="hljs-string"><span class="hljs-string">'dimension_value'</span></span>});</code> </pre> <br>  oÃ¹ au lieu de: <br><br>  <font color="green">action_value</font> - action d'Ã©vÃ©nement <br>  <font color="green">category_value</font> - catÃ©gorie d'Ã©vÃ©nement <br>  <font color="green">label_value</font> - Ã©tiquette d'Ã©vÃ©nement <br>  <font color="green">event_value</font> - valeur d'Ã©vÃ©nement (entier non nÃ©gatif) <br>  <font color="green">dimension_name</font> - le nom du paramÃ¨tre que nous avons spÃ©cifiÃ© dans le code prÃ©cÃ©dent <br>  <font color="green">dimension_value</font> - valeur du CD <br><br>  Un exemple: <br><br><pre> <code class="javascript hljs">gtag(<span class="hljs-string"><span class="hljs-string">'event'</span></span>, <span class="hljs-string"><span class="hljs-string">'clickButton'</span></span>, {<span class="hljs-string"><span class="hljs-string">'event_category'</span></span>: <span class="hljs-string"><span class="hljs-string">'conversion'</span></span>, <span class="hljs-string"><span class="hljs-string">'event_label'</span></span>: <span class="hljs-string"><span class="hljs-string">'registration'</span></span>, <span class="hljs-string"><span class="hljs-string">'projectName'</span></span>: <span class="hljs-string"><span class="hljs-string">'shop'</span></span>, <span class="hljs-string"><span class="hljs-string">'hitId'</span></span>: <span class="hljs-string"><span class="hljs-string">'1121243'</span></span>});</code> </pre> <br>  Sur nos projets, nous utilisons la deuxiÃ¨me option - le rÃ©glage via GTM.  Examinons-le plus en dÃ©tail. <br><br>  <b>Envoi de CD avec Hits Ã  GA via GTM</b> <br><br>  La configuration de l'envoi de CD avec les hits (pages vues, Ã©vÃ©nements) dans GA se fait dans une variable de type "ParamÃ¨tres Google Analytics".  Si vous avez dÃ©jÃ  configurÃ© cette variable, ouvrez-la.  Sinon, vous devez le crÃ©er.  AccÃ©dez Ã  la section "ParamÃ¨tres avancÃ©s", Ã  la sous-section "ParamÃ¨tres spÃ©ciaux".  Ici, vous devez ajouter tous les paramÃ¨tres utilisateur que vous avez crÃ©Ã©s prÃ©cÃ©demment dans GA: <br><br><img src="https://habrastorage.org/webt/v5/u2/jc/v5u2jc6kqqsi7e1zwozl71iy2yc.jpeg"><br><br>  L'ID de suivi doit inclure le numÃ©ro de compteur GA.  Dans le champ "Index", Ã©crivez l'identifiant du CD de GA vers lequel vous souhaitez transfÃ©rer les donnÃ©es. <br><br>  Dans le champ "Parameter Value", vous devez spÃ©cifier la valeur qui sera transfÃ©rÃ©e sur le CD avec l'index spÃ©cifiÃ©.  Cette valeur peut Ãªtre spÃ©cifiÃ©e de deux maniÃ¨res: <br><br><ul><li>  manuellement, si ce sera le mÃªme pour tous les Ã©vÃ©nements; </li><li>  en utilisant la variable dans laquelle la valeur de ce paramÃ¨tre est stockÃ©e (son nom est Ã©crit entre crochets doubles).  Par exemple, {{SCREEN_WINDOW}} - "Taille de la fenÃªtre du navigateur". </li></ul><br><img src="https://habrastorage.org/webt/ov/we/fi/ovwefildb093dmfjzur0duaxfvk.jpeg"><br><br>  Avec ce rÃ©glage des paramÃ¨tres utilisateur, il est important de considÃ©rer: <br><br><ol><li>  Lorsque la balise est traitÃ©e pour la premiÃ¨re fois, un cookie avec l'ID utilisateur Google (clientID) n'est pas encore crÃ©Ã©.  Si nous voulons configurer le transfert de ce paramÃ¨tre sur CD, nous ne pourrons pas le faire pour la premiÃ¨re visualisation des pages. </li><li>  Si nous voulons utiliser la mÃªme variable lors de l'envoi de donnÃ©es Ã  diffÃ©rents paramÃ¨tres utilisateur, cette variable sera Ã  nouveau calculÃ©e pour chaque paramÃ¨tre utilisateur.  Par exemple, lorsque vous envoyez un horodatage de balise Ã  deux paramÃ¨tres utilisateur diffÃ©rents, vous pouvez remarquer une diffÃ©rence de valeurs de quelques millisecondes. </li></ol><br>  Vous pouvez Ã©viter ces difficultÃ©s avec customTask. <br><br><h3>  Utilisation de customTask </h3><br>  customTask est la fonction avec la plus haute prioritÃ©, dont vous dÃ©finissez vous-mÃªme le code et la logique.  Il n'y a pas si longtemps, Google a donnÃ© la possibilitÃ© d'utiliser cette fonctionnalitÃ© dans GTM. <br><br>  customTask utilise les donnÃ©es de l'objet modÃ¨le (qui inclut tous les champs du compteur de suivi), des cookies, etc.  La prioritÃ© de cette fonction est plus Ã©levÃ©e que celle de toutes les autres, et cela fonctionne pour le tag.  GrÃ¢ce Ã  cela, vous pouvez configurer l'envoi de l'ID utilisateur dÃ¨s la premiÃ¨re visualisation de la page. <br><br>  Pour configurer le CD via customTask, crÃ©ez une variable GTM avec le nom JS_customTask et le type Â«code JavaScript natifÂ»: <br><br><img src="https://habrastorage.org/webt/mt/xt/m3/mtxtm3rarxslutrgoniz_ynobig.jpeg"><br><br>  Ajoutez maintenant la JS_customTask que nous avons crÃ©Ã©e Ã  la variable ParamÃ¨tres de Google Analytics, dans la section "Champs Ã  dÃ©finir": <br><br><ul><li>  Dans Â«Nom du champÂ», Ã©crivez <b>customTask</b> ; </li><li>  Dans la Â«valeurÂ», Ã©crivez le nom de la variable que nous avons crÃ©Ã©e ci-dessus.  Toutes les variables doivent Ãªtre Ã©crites en double accolades. </li></ul><br><img src="https://habrastorage.org/webt/qp/tg/pc/qptgpciskueuoh_81xbxicmdjbi.jpeg"><br><br>  Une seule tÃ¢che personnalisÃ©e peut Ãªtre dÃ©finie dans une balise GTM.  Par consÃ©quent, tous les CD pouvant Ãªtre dÃ©terminÃ©s par cette mÃ©thode seront Ã©crits dans la variable JS_customTask crÃ©Ã©e prÃ©cÃ©demment. <br><br><h1>  CD frÃ©quemment utilisÃ©s </h1><br><h2>  Identifiant utilisateur </h2><br>  <b>DÃ©fi.</b>  Le compteur a enregistrÃ© une forte augmentation du nombre de sessions.  Dans le mÃªme temps, le nombre d'utilisateurs a lÃ©gÃ¨rement augmentÃ©.  Il y avait une hypothÃ¨se sur le trafic de robots provenant de certains utilisateurs.  Par dÃ©faut, il n'est pas possible d'afficher les caractÃ©ristiques des utilisateurs individuels dans GA dans un format pratique. <br><br>  <b>Solution.</b>  Google Analytics attribue un identifiant unique Ã  chaque visiteur du site - l'identifiant client.  Vous ne pouvez le voir dans l'interface de Google Analytics que dans un seul rapport - Â«Statistiques utilisateurÂ» (Explorateur d'utilisateurs).  Il n'est pas pratique de l'utiliser, car sur un Ã©cran, vous pouvez voir la sÃ©quence d'actions d'un seul utilisateur et vous ne pouvez pas ajouter de paramÃ¨tres supplÃ©mentaires au rapport. <br><br>  Une solution idÃ©ale serait la possibilitÃ© d'afficher l'ID client en tant que paramÃ¨tre distinct dans un rapport standard ou utilisateur.  Et cela peut Ãªtre fait en utilisant GTM. <br><br>  <b>ParamÃ¨tres techniques.</b>  En tant que ClientId, nous utilisons la sÃ©quence de chiffres de l'ID utilisateur dans GA (il est stockÃ© dans un cookie avec le nom _ga. Par exemple, _ga = GA1.2.1111111111.111111111, oÃ¹ ClientId = 111111111.11111111111).  Pour voir cette valeur, faites un clic droit sur la page du site et sÃ©lectionnez Â«Afficher le codeÂ»: <br><br><img src="https://habrastorage.org/webt/e2/fn/ew/e2fnewovy0uvqtij9k4krzez1ve.jpeg"><br><br>  Ensuite, dans l'onglet Application, dans le menu de gauche, sÃ©lectionnez Cookies et le nom du site et recherchez la variable _ga dans le tableau: <br><br><img src="https://habrastorage.org/webt/g8/gs/qi/g8gsqiboktqwl0qw0bdmvzabn64.jpeg"><br><br>  En plus du cookie, l'ID utilisateur GA est stockÃ© dans l'objet modÃ¨le et peut Ãªtre rÃ©cupÃ©rÃ© Ã  l'aide de la mÃ©thode .get ('clientId').  Nous utilisons customTask pour rÃ©cupÃ©rer cette valeur et la transmettre Ã  GA.  Ajoutez le code suivant Ã  la variable nommÃ©e JS_customTask: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> customDimensionIndex_client = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">model</span></span></span><span class="hljs-function">) </span></span>{ model.set(<span class="hljs-string"><span class="hljs-string">'dimension'</span></span> + customDimensionIndex_client, model.get(<span class="hljs-string"><span class="hljs-string">'clientId'</span></span>)); } }</code> </pre> <br>  AprÃ¨s le signe Ã©gal pour la variable customDimensionIndex_client, vous devez spÃ©cifier l'index du CD correspondant Ã  ClientId dans GA.  De cette faÃ§on, nous avons obtenu l'ID client du compteur et l'avons envoyÃ© au paramÃ¨tre utilisateur. <br><br>  <b>RÃ©sultat.</b>  Nous avons construit un rapport sur les utilisateurs individuels et avons constatÃ© que certains d'entre eux avaient en fait un millier de sessions.  Toutes les sÃ©ances ont eu un taux de rebond de 100% et n'ont manifestement aucune valeur pour nous.  Nous avons mis en place un segment pour exclure ces utilisateurs et avons pu analyser la dynamique du trafic sans visites inutiles. <br><br><h2>  Hit id </h2><br>  <b>DÃ©fi.</b>  Vous devez voir comment l'utilisateur se comporte sur le site, quelles actions il effectue et dans quel ordre.  Sur la base de ces donnÃ©es, des hypothÃ¨ses de dÃ©veloppement commercial pourraient Ãªtre avancÃ©es. <br><br>  <b>Solution.</b>  CrÃ©ez votre propre CD avec le numÃ©ro d'accÃ¨s de l'utilisateur Ã  chaque session.  Triant par ordre croissant de visites, nous pouvons voir les faÃ§ons dont les utilisateurs. <br><br>  <b>ParamÃ¨tres techniques.</b>  Pour plus de commoditÃ©, en tant que HitId, nous transmettons ClientId + hit time au format timestamp.  Ainsi, pour chaque Ã©vÃ©nement, page vue, transaction, il y aura une valeur.  Ce paramÃ¨tre peut Ãªtre configurÃ© via customTask (similaire Ã  ClientId). <br><br>  Une seule tÃ¢che personnalisÃ©e peut Ãªtre dÃ©finie dans une seule balise GTM.  Par consÃ©quent, nous ajoutons Ã  la variable Â«JavaScript personnalisÃ©Â» prÃ©cÃ©demment crÃ©Ã©e le code mis en Ã©vidence des deux cÃ´tÃ©s par des commentaires, oÃ¹ l'index du CD nommÃ© h_HitId de GA sera stockÃ© dans la variable customDimensionIndex_hit: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> customDimensionIndex_client = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    var customDimensionIndex_hit = 2; var now = new Date(); //    return function(model) { model.set('dimension' + customDimensionIndex_client, model.get('clientId')); //    model.set('dimension' + customDimensionIndex_hit, model.get('clientId').concat('_', now.getTime())); //    } }</span></span></code> </pre> <br>  Le type de paramÃ¨tre est atteint.  Du fait qu'il contient Ã©galement de l'heure au format d'horodatage, tous les accÃ¨s utilisateur / session peuvent Ãªtre triÃ©s par ordre d'exÃ©cution, sans utiliser de paramÃ¨tres supplÃ©mentaires. <br><br>  Si vous effectuez exactement les mÃªmes rÃ©glages, uniquement dans GA choisissez la portÃ©e du paramÃ¨tre - session, alors nous obtenons un CD qui stockera l'identifiant de session de l'utilisateur. <br><br>  <b>RÃ©sultat.</b>  Construit deux rapports: <br><br><ul><li>  Identifiant utilisateur, identifiant de hit, catÃ©gorie d'Ã©vÃ©nement, action d'Ã©vÃ©nement, Ã©tiquette d'Ã©vÃ©nement, ajouter.  paramÃ¨tres. </li><li>  ID utilisateur, appuyez sur ID, ajoutez.  paramÃ¨tres. </li></ul><br>  Ensuite, ils ont dÃ©chargÃ© ces donnÃ©es de GA, les ont combinÃ©es dans Excel (ou une base de donnÃ©es).  Si nous trions les lignes par ClientId, puis par HitId, nous obtenons le chemin de chaque utilisateur sur le site.  Nous pouvons maintenant crÃ©er des tableaux croisÃ©s dynamiques et les visualiser. <br><br><h2>  Tests A / B </h2><br>  <b>DÃ©fi.</b>  L'entreprise a dÃ©cidÃ© de rÃ©aliser un test AB.  Les paramÃ¨tres ont Ã©tÃ© dÃ©finis par les dÃ©veloppeurs, sans utiliser Google Optimize.  La question s'est posÃ©e: comment transfÃ©rer les options de test vers Google Analytics afin d'analyser l'efficacitÃ© de l'expÃ©rience. <br><br>  <b>Solution.</b>  Dans ce cas, les CD nous aideront Ã  comparer les rÃ©sultats des tests en GA.  Il suffit de configurer un paramÃ¨tre utilisateur, qui prendra des valeurs avec l'identifiant du test et l'option dans laquelle l'utilisateur est tombÃ©.  Nous pouvons donc diviser le public en groupes selon les options de test et comparer les rÃ©sultats. <br><br>  <b>ParamÃ¨tres techniques.</b>  CrÃ©ez un paramÃ¨tre personnalisÃ© dans GA, similaire Ã  ce que nous avons configurÃ© prÃ©cÃ©demment.  Nous sÃ©lectionnons comme Â«ScopeÂ» - un hit, afin qu'il soit possible de diviser les Ã©vÃ©nements en Ã©vÃ©nements validÃ©s par l'utilisateur avant et aprÃ¨s le dÃ©but du test.  Appelez-le, par exemple, h_AB-Test.  Il est possible de transfÃ©rer des donnÃ©es sur un CD par plusieurs tests Ã  la fois.  Vous pouvez les sÃ©parer avec un symbole qui n'apparaÃ®t pas dans le nom et la version du test, par exemple, Â«|Â». <br><br>  Si vous faites le test vous-mÃªme et stockez les donnÃ©es Ã  ce sujet dans un cookie, vous aurez besoin d'une variable comme Â«Code JavaScript natifÂ» pour les extraire: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cookie_name =<span class="hljs-string"><span class="hljs-string">'{{test_variant}}'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> matches = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.cookie.match(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">RegExp</span></span>( <span class="hljs-string"><span class="hljs-string">"(?:^|; )"</span></span> + cookie_name.replace(<span class="hljs-regexp"><span class="hljs-regexp">/([\.$?*|{}\(\)\[\]\\\/\+^])/g</span></span>, <span class="hljs-string"><span class="hljs-string">'\\$1'</span></span>) + <span class="hljs-string"><span class="hljs-string">"=([^;]*)"</span></span> )); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> matches ? <span class="hljs-built_in"><span class="hljs-built_in">decodeURIComponent</span></span>(matches[<span class="hljs-number"><span class="hljs-number">1</span></span>]) : <span class="hljs-string"><span class="hljs-string">'(not set)'</span></span>; }</code> </pre> <br>  oÃ¹ au lieu de {{test_variant}}, vous devez spÃ©cifier le nom du cookie dans lequel le nom et la variante du test sont stockÃ©s.  N'oubliez pas de l'ajouter Ã  la variable des paramÃ¨tres GA. <br><br>  En ajoutant le paramÃ¨tre h_AB-Test au rapport, nous verrons dans Google Analytics Ã  quelle option de test la session appartient.  Selon la valeur de ce paramÃ¨tre, vous pouvez segmenter les utilisateurs. <br><br>  <b>RÃ©sultat.</b>  Nous crÃ©ons autant de segments qu'il y a de cas de test avec la condition h_AB-Test.  Il doit correspondre Ã  la valeur "nom + scÃ©nario de test".  Nous examinons les Ã©vÃ©nements qui nous intÃ©ressent dans les rapports. <br><br><h2>  Adresse pleine page </h2><br>  <b>DÃ©fi.</b>  Le responsable de la publicitÃ© contextuelle a lancÃ© une campagne publicitaire dans Yandex.Direct.  Quelques jours plus tard, il est entrÃ© dans le rapport des sources GA et a constatÃ© que le nombre de sessions utilisateur issues de la campagne publicitaire qu'il avait crÃ©Ã©e Ã©tait bien infÃ©rieur aux clics sur les annonces dans Yandex.Direct. <br><br>  <b>Solution.</b>  Google Analytics a un paramÃ¨tre requis pour le suivi des annonces - utm_source.  Si tel est le cas, sa valeur sera ajoutÃ©e au paramÃ¨tre standard "Source de la campagne".  De mÃªme, Google le fait avec d'autres balises UTM pour l'enregistrement dans les paramÃ¨tres correspondants. <br><br>  Tous les tags UTM sont automatiquement supprimÃ©s du rapport sur les pages du site et vous ne pouvez pas les analyser lÃ -bas.  Dans ce cas, si le libellÃ© utm_source n'a pas Ã©tÃ© dÃ©fini, Google supprimera simplement toutes les balises UTM trouvÃ©es dans le rapport sur les pages et n'enregistrera pas leur contenu dans les paramÃ¨tres intÃ©grÃ©s correspondants. <br><br>  Nous allons configurer le paramÃ¨tre avec l'adresse de page complÃ¨te pour voir toutes les balises, mÃªme si la publicitÃ© n'est pas configurÃ©e correctement.  Appelons-le h_fullPage. <br><br>  <b>ParamÃ¨tres techniques.</b>  CrÃ©ons une variable avec le type "variable JavaScript" dans la section "Nom de variable globale" et spÃ©cifions document.URL: <br><br><img src="https://habrastorage.org/webt/bp/pw/ww/bppwwwv7021ewdjqxxhaymypmzs.jpeg"><br><br>  Comme la portÃ©e de la variable set - hit. <br><br>  <b>RÃ©sultat.</b>  La sÃ©quence de balises UTM suivante a Ã©tÃ© utilisÃ©e tout au long de la campagne publicitaire: utm_medium, utm_source, utm_campaign.  AprÃ¨s avoir examinÃ© l'adresse complÃ¨te des pages, nous avons remarquÃ© qu'une esperluette Ã©tait ignorÃ©e entre les annonces entre utm_medium et utm_source.  Ã‰tant donnÃ© que utm_source est une balise utm obligatoire pour toute campagne publicitaire et que Google Analytics ne l'a pas trouvÃ©e aprÃ¨s les caractÃ¨res spÃ©ciaux (?, &amp;), Le clic sur cette publicitÃ© a Ã©tÃ© enregistrÃ© dans le trafic direct.  GrÃ¢ce au paramÃ¨tre h_fullPage, il a Ã©tÃ© possible de dÃ©tecter le problÃ¨me et de le corriger dans les paramÃ¨tres du panneau publicitaire. <br><br><h2>  Options d'Ã©vÃ©nement </h2><br>  Deux paramÃ¨tres plus utiles (sans description de leurs rÃ©glages): <br><br><ul><li>  <b>DÃ©fi.</b>  Nous marquons le site par nous-mÃªmes via GTM.  A trouvÃ© une erreur, l'a rapidement corrigÃ©e, mais les Ã©vÃ©nements avec l'erreur continuent d'arriver en GA. <br><br>  <b>Solution.</b>  Pour trouver rapidement la racine du problÃ¨me, vous pouvez transfÃ©rer un CD avec chaque Ã©vÃ©nement: <br>  Le nom du conteneur (s'il y en a plusieurs sur le site) - la variable intÃ©grÃ©e GTM; <br>  La version conteneur est la variable intÃ©grÃ©e GTM; <br>  Nom du tag - vous devez le configurer vous-mÃªme. <br><br>  Vous pouvez passer ces trois paramÃ¨tres Ã  travers n'importe quel sÃ©parateur dans une variable de type "Constante": <br><br><img src="https://habrastorage.org/webt/2m/j4/dp/2mj4dpgyy_ierrk8-ndngyd17rk.jpeg"><br><br>  La portÃ©e du paramÃ¨tre est atteinte. <br><br>  <b>RÃ©sultat.</b>  En utilisant la variable configurÃ©e, nous avons dÃ©couvert que certains utilisateurs ont toujours l'ancienne version du conteneur, donc les Ã©vÃ©nements continuent d'Ãªtre envoyÃ©s.  TrÃ¨s probablement, les utilisateurs n'ont tout simplement pas actualisÃ© la page ou elle a Ã©tÃ© mise en cache, vous devez donc attendre un peu. </li><li>  <b>DÃ©fi.</b>  Nous marquons le site via les dÃ©veloppeurs.  Ils ont introduit une nouvelle instruction Ã©crite par nous.  AprÃ¨s vÃ©rification, il s'est avÃ©rÃ© que certains Ã©vÃ©nements ont Ã©tÃ© envoyÃ©s avec une erreur. <br><blockquote>  <b>Important:</b> <br><br><ul><li>  N'envoyez pas d'Ã©vÃ©nements de test Ã  la vue de travail GA lorsque nous vÃ©rifions les Ã©vÃ©nements sur le site de test; </li><li>  si aprÃ¨s avoir commencÃ© la bataille, nous avons remarquÃ© que nous avons vÃ©rifiÃ© les Ã©vÃ©nements marquÃ©s de maniÃ¨re incorrecte / aprÃ¨s la mise Ã  jour du site, quelque chose s'est cassÃ©, il est important d'arrÃªter rapidement d'envoyer des Ã©vÃ©nements Ã  la vue de travail. </li></ul><br></blockquote>  <b>Solution.</b>  Nous diviserons les Ã©vÃ©nements en nouveaux / fonctionnant incorrectement et correctement marquÃ©s.  Le premier peut Ãªtre marquÃ© comme test, le second - prod. <br><br>  Pour ce faire, laissez les dÃ©veloppeurs ajouter des donnÃ©es Ã  la couche de donnÃ©es, et nous les obtiendrons et les enverrons Ã  GA.  Toute poussÃ©e ressemblera Ã  ceci: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> dataLayer.push({ </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'event'</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'{{ }}'</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'event_id'</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'{{id }}'</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'eventCategory'</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'{{ }}'</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'eventAction'</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'{{  }}'</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'eventLabel'</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'{{ }}'</span></span></span><span class="actionscript">, }); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  oÃ¹ entre crochets doubles sont les noms des variables dans lesquelles les donnÃ©es sont stockÃ©es du cÃ´tÃ© des dÃ©veloppeurs. <br><br>  Nous devrons crÃ©er la variable Â«Table de consultationÂ» pour sÃ©parer les Ã©vÃ©nements: <br><br><img src="https://habrastorage.org/webt/uz/ct/9j/uzct9jqlhgg1u0neld1n9zljzao.jpeg"><br><br>  {{event_id}} est une variable qui rÃ©cupÃ¨re l'identifiant d'Ã©vÃ©nement du DataLayer. <br><br>  Nous mettons une coche devant Â«DÃ©finir la valeur par dÃ©fautÂ» et dans la colonne Â«Valeur par dÃ©fautÂ» test d'Ã©criture.  Ainsi, initialement pour tous les Ã©vÃ©nements, cette variable sera Ã©gale Ã  test.  AprÃ¨s vous Ãªtre assurÃ© que l'Ã©vÃ©nement est correctement marquÃ©, ajoutez son event_id Ã  la cellule "Input".  Dans le champ Â«RÃ©sultatÂ», nous envoyons prod. <br><br>  Nous avons donc divisÃ© tous les Ã©vÃ©nements en marquÃ©s correctement et en nouveaux / incorrectement marquÃ©s.  Nous vous conseillons de crÃ©er une vue distincte dans Google Analytics, oÃ¹ il n'y aura des Ã©vÃ©nements qu'avec l'Ã©tiquette prod (cela peut Ãªtre fait en utilisant le filtre Vues). LÃ , vous ne verrez que les Ã©vÃ©nements correctement marquÃ©s. <br><br>  <b>RÃ©sultat.</b>  Comme les erreurs dans le balisage des Ã©vÃ©nements des instructions ont Ã©tÃ© Ã©liminÃ©es, nous avons changÃ© la valeur du paramÃ¨tre pour ces Ã©vÃ©nements dans GTM de test en prod.  GrÃ¢ce Ã  ce paramÃ¨tre, nous n'incluons dans les rapports que les Ã©vÃ©nements correctement marquÃ©s avec le label prod. </li></ul><br>  La fonctionnalitÃ© des dimensions personnalisÃ©es est large et ne se limite pas aux mÃ©thodes de configuration et d'application dÃ©crites.  Pour chaque type d'entreprise, d'analyse et d'hypothÃ¨se, vous pouvez trouver votre propre application de paramÃ¨tres dÃ©finis par l'utilisateur, et les mÃ©thodes de personnalisation dÃ©crites faciliteront ce processus. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr468079/">https://habr.com/ru/post/fr468079/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr468067/index.html">Fonctionnement de la composition alpha</a></li>
<li><a href="../fr468071/index.html">Eduard Medvedev, CTO chez Tungsten Labs: Â«Nous avons grandi au point oÃ¹ la technologie peut causer des dommages considÃ©rablesÂ»</a></li>
<li><a href="../fr468073/index.html">Andrei Terekhov: "Vous pouvez dire autant que vous le souhaitez que l'AmÃ©ricain est meilleur, mais notre voiture ne tombe jamais en panne"</a></li>
<li><a href="../fr468075/index.html">L'utilisation des rÃ©seaux de neurones siamois dans la recherche</a></li>
<li><a href="../fr468077/index.html">Posit les tests de faÃ§on adulte. Analyse spectrale</a></li>
<li><a href="../fr468081/index.html">Â«DonnÃ©es anonymesÂ» ou ce qui est prÃ©vu dans 152-FZ</a></li>
<li><a href="../fr468083/index.html">API Android Camera2 depuis la bouilloire</a></li>
<li><a href="../fr468085/index.html">Le livre "Safe DevOps. Fonctionnement efficace du systÃ¨me</a></li>
<li><a href="../fr468087/index.html">MÃ©thode de division bisectionnelle dans les tests</a></li>
<li><a href="../fr468089/index.html">RedÃ©finition basÃ©e sur l'Ã©dition: est-il possible en production?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>