<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎃 🙏 🕵🏻 Dimensions personnalisées dans Google Analytics qui nous ont fait économiser plus d'une fois 🔽 👩‍🚒 🤷🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lors de la configuration de l'analyse via Google Analytics (GA), les paramètres utilisateur ou le CD ( dimensions personnalisées ) sont souvent ignoré...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dimensions personnalisées dans Google Analytics qui nous ont fait économiser plus d'une fois</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468079/">  Lors de la configuration de l'analyse via Google Analytics (GA), les paramètres utilisateur ou le CD ( <i>dimensions personnalisées</i> ) sont souvent ignorés.  Cela est dû à la difficulté de comprendre leur portée: on ne sait pas exactement comment les CD peuvent aider à collecter et analyser les données et comment ils sont configurés.  Cet article décrit les principaux CD que nous utilisons dans Adventum sur de nombreux projets et le processus d'installation. <br><br><h1>  Quelles sont les options utilisateur </h1><br>  Pour créer un rapport dans Google Analytics, plus de 200 paramètres et mesures différents sont disponibles, tels que «source», «ville», «navigateur», «système d'exploitation» et bien d'autres.  Mais les paramètres standard ne sont pas toujours suffisants pour l'analyse, Google a donc donné aux utilisateurs la possibilité de créer les leurs.  La valeur du CD peut être transférée avec n'importe quel coup de l'utilisateur.  Par exemple, à l'aide de paramètres personnalisés, vous pouvez analyser les performances du site dans le contexte des adaptatifs. <br><br>  Il y a 4 domaines d'action CD au total: <br><br><ul><li>  Hit </li><li>  Séance </li><li>  Utilisateur </li><li>  Produit </li></ul><br>  Par exemple, nous avons un CD dans lequel le paramètre d'autorisation utilisateur est stocké (0 - non autorisé, 1 - autorisé).  Au début de la session, tous les utilisateurs ne sont pas autorisés.  Voyons ce qui se passe lorsque ce paramètre change après l'entrée, selon la portée du CD. <br><br><img src="https://habrastorage.org/webt/yo/ef/tr/yoeftruoaljptzlnl3xtngigfbq.jpeg"><br><br><ul><li>  pour un CD avec la portée de hit, l'unité est affectée au paramètre d'autorisation dans le hit dans lequel l'autorisation s'est produite; </li><li>  pour un CD avec la portée de la session, le paramètre d'autorisation deviendra égal à 1 pour tous les hits de la session dans laquelle l'événement s'est produit (écrasement des anciennes valeurs du CD dans cette session); </li><li>  pour un CD avec la portée de l'utilisateur, le paramètre d'autorisation deviendra égal à 1 pour toutes les sessions utilisateur, à partir de celui dans lequel la connexion a été effectuée. </li></ul><a name="habracut"></a><br>  Parfois, vous devez analyser les caractéristiques d'un produit dont le support n'est pas défini dans les paramètres de base de Google Analytics: par exemple, le poids.  Étant donné que les informations sur plusieurs produits peuvent être transmises en une seule fois, nous aurons besoin d'un champ d'application supplémentaire avec des détails plus approfondis.  C'est pour cette granularité que le périmètre «Produit» est utilisé: <br><br><img src="https://habrastorage.org/webt/me/9m/s4/me9ms4-kjwvsn-pgj1yzdn6uxbi.jpeg"><br><br><h1>  Configuration du CD </h1><br>  La configuration d'un paramètre utilisateur comprend deux étapes: la création d'un paramètre dans GA et l'envoi de données depuis le site.  Ensuite, nous décrivons la séquence des étapes de configuration du CD. <br><br><h2>  Création d'un CD dans Google Analytics </h2><br><ol><li>  Accédez à la section «Administrateur» </li><li>  Dans les paramètres de ressources de la section «Paramètres utilisateur», sélectionnez la sous-section «Paramètres spéciaux»: <br><img src="https://habrastorage.org/webt/pc/b3/pp/pcb3ppb_6lwiyyxpe8ctui2qe18.jpeg"></li><li>  Cliquez sur le bouton «+ Paramètre spécial» <br><img src="https://habrastorage.org/webt/ak/k8/iy/akk8iyzg0rbrvrq-tawj3u-uwue.jpeg"></li><li>  Le formulaire s'ouvre: <br><img src="https://habrastorage.org/webt/82/jf/3o/82jf3oy-kbvheuwjrntj4ooxecw.jpeg"><br>  Sélectionnez la portée du paramètre: <br><br><ul><li>  Hit </li><li>  Séance </li><li>  Utilisateur </li><li>  Produit </li></ul><br>  Et laissez la coche en face de «Actif» afin que les données commencent à être collectées et que le CD soit reflété dans les rapports. </li></ol><blockquote>  <b>Recommandations de titres de CD</b> <br>  Nous avons développé notre propre système pour nommer les paramètres utilisateur. <br>  Au début de chaque CD, nous ajoutons un symbole pour la portée.  Pour hit, il s'agit de h_ (par exemple, h_hitId), pour la session - s_ (par exemple, s_sessionId).  Cela nous aide à naviguer dans les paramètres utilisateur et à toujours connaître leur portée, sans vérifier les paramètres du compteur.  Parfois, il devient nécessaire de créer deux paramètres avec le même nom, mais avec une portée différente.  Par exemple, nous effectuons un test A / B et voulons vérifier s'il est configuré correctement, la variante de test change-t-elle pendant la session.  Pour ce faire, créez deux paramètres avec la même valeur: nom + version de test, dans laquelle l'utilisateur est entré, mais l'un d'eux est atteint, la deuxième session.  Dans ce cas, la dénomination proposée sera très pratique. <br></blockquote><br><h2>  Configuration de Google Tag Manager </h2><br>  Il existe deux façons de configurer l'envoi des paramètres à partir du site: <br><br><ul><li>  directement via le code HTML du site. </li><li>  via Google Tag Manager (GTM). </li></ul><br>  Pour les deux méthodes, nous avons besoin de l'index du CD dans Google Analytics.  Vous pouvez le voir dans la section "Paramètres spéciaux": <br><br><img src="https://habrastorage.org/webt/z3/el/gs/z3elgs7abwc7vnaibkvlssffe08.jpeg"><br><br>  <b>Envoi via HTML sur le site</b> <br><br>  Mettez à jour la configuration de la ressource dans le code de suivi Google Analytics en y ajoutant <font color="green">custom_map</font> (vous devez ajouter ce qui est mis en évidence des deux côtés par des commentaires): <br><br><pre><code class="javascript hljs">gtag(<span class="hljs-string"><span class="hljs-string">'config'</span></span>, <span class="hljs-string"><span class="hljs-string">'GA_MEASUREMENT_ID'</span></span> , <span class="hljs-comment"><span class="hljs-comment">//  { 'custom_map': {'dimension&lt;Index&gt;': 'dimension_name'} } //  );</span></span></code> </pre> <br>  où <font color="green">GA_MEASUREMENT_ID</font> est votre identifiant de compteur Analytics.  Remplacez <font color="green">&lt;Index&gt;</font> par l'index du paramètre dans GA, et au lieu de <font color="green">dimension_name,</font> spécifiez son nom. <br><br>  Si vous avez plusieurs paramètres utilisateur, alors <font color="green">'dimension &lt;Index&gt;'</font> : <font color="green">'nom_dimension'</font> doit être spécifié avec une virgule pour chacun d'eux. <br><br>  Par exemple: <br><br><pre> <code class="javascript hljs">gtag(<span class="hljs-string"><span class="hljs-string">'config'</span></span>, <span class="hljs-string"><span class="hljs-string">'UA-XXXXXXXXX'</span></span>, { <span class="hljs-string"><span class="hljs-string">'custom_map'</span></span>: {<span class="hljs-string"><span class="hljs-string">'dimension1'</span></span>: <span class="hljs-string"><span class="hljs-string">'projectName'</span></span>, <span class="hljs-string"><span class="hljs-string">'dimension2'</span></span>: <span class="hljs-string"><span class="hljs-string">'hitId'</span></span>, <span class="hljs-string"><span class="hljs-string">'dimension3'</span></span>: <span class="hljs-string"><span class="hljs-string">'sessionId'</span></span>, <span class="hljs-string"><span class="hljs-string">'dimension4'</span></span>: <span class="hljs-string"><span class="hljs-string">'screenWindow'</span></span>} });</code> </pre> <br>  Afin d'envoyer un CD avec une vue de page, vous devez affecter ces paramètres à la valeur souhaitée <b>avant le code indiqué ci-dessus</b> : <br><br><pre> <code class="javascript hljs">gtag(<span class="hljs-string"><span class="hljs-string">'set'</span></span>, { <span class="hljs-string"><span class="hljs-string">'dimension_name'</span></span>: <span class="hljs-string"><span class="hljs-string">'dimension_value'</span></span>});</code> </pre> <br>  où <font color="green">dimension_name</font> doit correspondre à ceux que vous avez spécifiés dans <font color="green">'custom_map'</font> , et <font color="green">dimension_value doit</font> être la valeur que vous souhaitez transférer sur le CD. <br><br>  Par exemple: <br><br><pre> <code class="javascript hljs">gtag(<span class="hljs-string"><span class="hljs-string">'set'</span></span>, {<span class="hljs-string"><span class="hljs-string">'projectName'</span></span>: <span class="hljs-string"><span class="hljs-string">'shop'</span></span>, <span class="hljs-string"><span class="hljs-string">'hitId'</span></span>: <span class="hljs-string"><span class="hljs-string">'1121243'</span></span>});</code> </pre> <br>  Lors de l'envoi d'une valeur de CD avec l'événement, vous devez envoyer le code: <br><pre> <code class="javascript hljs">gtag(<span class="hljs-string"><span class="hljs-string">'event'</span></span>, <span class="hljs-string"><span class="hljs-string">'action_value'</span></span>, {<span class="hljs-string"><span class="hljs-string">'event_category'</span></span>: <span class="hljs-string"><span class="hljs-string">'category_value'</span></span>, <span class="hljs-string"><span class="hljs-string">'event_label'</span></span>: <span class="hljs-string"><span class="hljs-string">'label_value'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-string"><span class="hljs-string">'event_value'</span></span>, <span class="hljs-string"><span class="hljs-string">'dimension_name'</span></span>: <span class="hljs-string"><span class="hljs-string">'dimension_value'</span></span>});</code> </pre> <br>  où au lieu de: <br><br>  <font color="green">action_value</font> - action d'événement <br>  <font color="green">category_value</font> - catégorie d'événement <br>  <font color="green">label_value</font> - étiquette d'événement <br>  <font color="green">event_value</font> - valeur d'événement (entier non négatif) <br>  <font color="green">dimension_name</font> - le nom du paramètre que nous avons spécifié dans le code précédent <br>  <font color="green">dimension_value</font> - valeur du CD <br><br>  Un exemple: <br><br><pre> <code class="javascript hljs">gtag(<span class="hljs-string"><span class="hljs-string">'event'</span></span>, <span class="hljs-string"><span class="hljs-string">'clickButton'</span></span>, {<span class="hljs-string"><span class="hljs-string">'event_category'</span></span>: <span class="hljs-string"><span class="hljs-string">'conversion'</span></span>, <span class="hljs-string"><span class="hljs-string">'event_label'</span></span>: <span class="hljs-string"><span class="hljs-string">'registration'</span></span>, <span class="hljs-string"><span class="hljs-string">'projectName'</span></span>: <span class="hljs-string"><span class="hljs-string">'shop'</span></span>, <span class="hljs-string"><span class="hljs-string">'hitId'</span></span>: <span class="hljs-string"><span class="hljs-string">'1121243'</span></span>});</code> </pre> <br>  Sur nos projets, nous utilisons la deuxième option - le réglage via GTM.  Examinons-le plus en détail. <br><br>  <b>Envoi de CD avec Hits à GA via GTM</b> <br><br>  La configuration de l'envoi de CD avec les hits (pages vues, événements) dans GA se fait dans une variable de type "Paramètres Google Analytics".  Si vous avez déjà configuré cette variable, ouvrez-la.  Sinon, vous devez le créer.  Accédez à la section "Paramètres avancés", à la sous-section "Paramètres spéciaux".  Ici, vous devez ajouter tous les paramètres utilisateur que vous avez créés précédemment dans GA: <br><br><img src="https://habrastorage.org/webt/v5/u2/jc/v5u2jc6kqqsi7e1zwozl71iy2yc.jpeg"><br><br>  L'ID de suivi doit inclure le numéro de compteur GA.  Dans le champ "Index", écrivez l'identifiant du CD de GA vers lequel vous souhaitez transférer les données. <br><br>  Dans le champ "Parameter Value", vous devez spécifier la valeur qui sera transférée sur le CD avec l'index spécifié.  Cette valeur peut être spécifiée de deux manières: <br><br><ul><li>  manuellement, si ce sera le même pour tous les événements; </li><li>  en utilisant la variable dans laquelle la valeur de ce paramètre est stockée (son nom est écrit entre crochets doubles).  Par exemple, {{SCREEN_WINDOW}} - "Taille de la fenêtre du navigateur". </li></ul><br><img src="https://habrastorage.org/webt/ov/we/fi/ovwefildb093dmfjzur0duaxfvk.jpeg"><br><br>  Avec ce réglage des paramètres utilisateur, il est important de considérer: <br><br><ol><li>  Lorsque la balise est traitée pour la première fois, un cookie avec l'ID utilisateur Google (clientID) n'est pas encore créé.  Si nous voulons configurer le transfert de ce paramètre sur CD, nous ne pourrons pas le faire pour la première visualisation des pages. </li><li>  Si nous voulons utiliser la même variable lors de l'envoi de données à différents paramètres utilisateur, cette variable sera à nouveau calculée pour chaque paramètre utilisateur.  Par exemple, lorsque vous envoyez un horodatage de balise à deux paramètres utilisateur différents, vous pouvez remarquer une différence de valeurs de quelques millisecondes. </li></ol><br>  Vous pouvez éviter ces difficultés avec customTask. <br><br><h3>  Utilisation de customTask </h3><br>  customTask est la fonction avec la plus haute priorité, dont vous définissez vous-même le code et la logique.  Il n'y a pas si longtemps, Google a donné la possibilité d'utiliser cette fonctionnalité dans GTM. <br><br>  customTask utilise les données de l'objet modèle (qui inclut tous les champs du compteur de suivi), des cookies, etc.  La priorité de cette fonction est plus élevée que celle de toutes les autres, et cela fonctionne pour le tag.  Grâce à cela, vous pouvez configurer l'envoi de l'ID utilisateur dès la première visualisation de la page. <br><br>  Pour configurer le CD via customTask, créez une variable GTM avec le nom JS_customTask et le type «code JavaScript natif»: <br><br><img src="https://habrastorage.org/webt/mt/xt/m3/mtxtm3rarxslutrgoniz_ynobig.jpeg"><br><br>  Ajoutez maintenant la JS_customTask que nous avons créée à la variable Paramètres de Google Analytics, dans la section "Champs à définir": <br><br><ul><li>  Dans «Nom du champ», écrivez <b>customTask</b> ; </li><li>  Dans la «valeur», écrivez le nom de la variable que nous avons créée ci-dessus.  Toutes les variables doivent être écrites en double accolades. </li></ul><br><img src="https://habrastorage.org/webt/qp/tg/pc/qptgpciskueuoh_81xbxicmdjbi.jpeg"><br><br>  Une seule tâche personnalisée peut être définie dans une balise GTM.  Par conséquent, tous les CD pouvant être déterminés par cette méthode seront écrits dans la variable JS_customTask créée précédemment. <br><br><h1>  CD fréquemment utilisés </h1><br><h2>  Identifiant utilisateur </h2><br>  <b>Défi.</b>  Le compteur a enregistré une forte augmentation du nombre de sessions.  Dans le même temps, le nombre d'utilisateurs a légèrement augmenté.  Il y avait une hypothèse sur le trafic de robots provenant de certains utilisateurs.  Par défaut, il n'est pas possible d'afficher les caractéristiques des utilisateurs individuels dans GA dans un format pratique. <br><br>  <b>Solution.</b>  Google Analytics attribue un identifiant unique à chaque visiteur du site - l'identifiant client.  Vous ne pouvez le voir dans l'interface de Google Analytics que dans un seul rapport - «Statistiques utilisateur» (Explorateur d'utilisateurs).  Il n'est pas pratique de l'utiliser, car sur un écran, vous pouvez voir la séquence d'actions d'un seul utilisateur et vous ne pouvez pas ajouter de paramètres supplémentaires au rapport. <br><br>  Une solution idéale serait la possibilité d'afficher l'ID client en tant que paramètre distinct dans un rapport standard ou utilisateur.  Et cela peut être fait en utilisant GTM. <br><br>  <b>Paramètres techniques.</b>  En tant que ClientId, nous utilisons la séquence de chiffres de l'ID utilisateur dans GA (il est stocké dans un cookie avec le nom _ga. Par exemple, _ga = GA1.2.1111111111.111111111, où ClientId = 111111111.11111111111).  Pour voir cette valeur, faites un clic droit sur la page du site et sélectionnez «Afficher le code»: <br><br><img src="https://habrastorage.org/webt/e2/fn/ew/e2fnewovy0uvqtij9k4krzez1ve.jpeg"><br><br>  Ensuite, dans l'onglet Application, dans le menu de gauche, sélectionnez Cookies et le nom du site et recherchez la variable _ga dans le tableau: <br><br><img src="https://habrastorage.org/webt/g8/gs/qi/g8gsqiboktqwl0qw0bdmvzabn64.jpeg"><br><br>  En plus du cookie, l'ID utilisateur GA est stocké dans l'objet modèle et peut être récupéré à l'aide de la méthode .get ('clientId').  Nous utilisons customTask pour récupérer cette valeur et la transmettre à GA.  Ajoutez le code suivant à la variable nommée JS_customTask: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> customDimensionIndex_client = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">model</span></span></span><span class="hljs-function">) </span></span>{ model.set(<span class="hljs-string"><span class="hljs-string">'dimension'</span></span> + customDimensionIndex_client, model.get(<span class="hljs-string"><span class="hljs-string">'clientId'</span></span>)); } }</code> </pre> <br>  Après le signe égal pour la variable customDimensionIndex_client, vous devez spécifier l'index du CD correspondant à ClientId dans GA.  De cette façon, nous avons obtenu l'ID client du compteur et l'avons envoyé au paramètre utilisateur. <br><br>  <b>Résultat.</b>  Nous avons construit un rapport sur les utilisateurs individuels et avons constaté que certains d'entre eux avaient en fait un millier de sessions.  Toutes les séances ont eu un taux de rebond de 100% et n'ont manifestement aucune valeur pour nous.  Nous avons mis en place un segment pour exclure ces utilisateurs et avons pu analyser la dynamique du trafic sans visites inutiles. <br><br><h2>  Hit id </h2><br>  <b>Défi.</b>  Vous devez voir comment l'utilisateur se comporte sur le site, quelles actions il effectue et dans quel ordre.  Sur la base de ces données, des hypothèses de développement commercial pourraient être avancées. <br><br>  <b>Solution.</b>  Créez votre propre CD avec le numéro d'accès de l'utilisateur à chaque session.  Triant par ordre croissant de visites, nous pouvons voir les façons dont les utilisateurs. <br><br>  <b>Paramètres techniques.</b>  Pour plus de commodité, en tant que HitId, nous transmettons ClientId + hit time au format timestamp.  Ainsi, pour chaque événement, page vue, transaction, il y aura une valeur.  Ce paramètre peut être configuré via customTask (similaire à ClientId). <br><br>  Une seule tâche personnalisée peut être définie dans une seule balise GTM.  Par conséquent, nous ajoutons à la variable «JavaScript personnalisé» précédemment créée le code mis en évidence des deux côtés par des commentaires, où l'index du CD nommé h_HitId de GA sera stocké dans la variable customDimensionIndex_hit: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> customDimensionIndex_client = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    var customDimensionIndex_hit = 2; var now = new Date(); //    return function(model) { model.set('dimension' + customDimensionIndex_client, model.get('clientId')); //    model.set('dimension' + customDimensionIndex_hit, model.get('clientId').concat('_', now.getTime())); //    } }</span></span></code> </pre> <br>  Le type de paramètre est atteint.  Du fait qu'il contient également de l'heure au format d'horodatage, tous les accès utilisateur / session peuvent être triés par ordre d'exécution, sans utiliser de paramètres supplémentaires. <br><br>  Si vous effectuez exactement les mêmes réglages, uniquement dans GA choisissez la portée du paramètre - session, alors nous obtenons un CD qui stockera l'identifiant de session de l'utilisateur. <br><br>  <b>Résultat.</b>  Construit deux rapports: <br><br><ul><li>  Identifiant utilisateur, identifiant de hit, catégorie d'événement, action d'événement, étiquette d'événement, ajouter.  paramètres. </li><li>  ID utilisateur, appuyez sur ID, ajoutez.  paramètres. </li></ul><br>  Ensuite, ils ont déchargé ces données de GA, les ont combinées dans Excel (ou une base de données).  Si nous trions les lignes par ClientId, puis par HitId, nous obtenons le chemin de chaque utilisateur sur le site.  Nous pouvons maintenant créer des tableaux croisés dynamiques et les visualiser. <br><br><h2>  Tests A / B </h2><br>  <b>Défi.</b>  L'entreprise a décidé de réaliser un test AB.  Les paramètres ont été définis par les développeurs, sans utiliser Google Optimize.  La question s'est posée: comment transférer les options de test vers Google Analytics afin d'analyser l'efficacité de l'expérience. <br><br>  <b>Solution.</b>  Dans ce cas, les CD nous aideront à comparer les résultats des tests en GA.  Il suffit de configurer un paramètre utilisateur, qui prendra des valeurs avec l'identifiant du test et l'option dans laquelle l'utilisateur est tombé.  Nous pouvons donc diviser le public en groupes selon les options de test et comparer les résultats. <br><br>  <b>Paramètres techniques.</b>  Créez un paramètre personnalisé dans GA, similaire à ce que nous avons configuré précédemment.  Nous sélectionnons comme «Scope» - un hit, afin qu'il soit possible de diviser les événements en événements validés par l'utilisateur avant et après le début du test.  Appelez-le, par exemple, h_AB-Test.  Il est possible de transférer des données sur un CD par plusieurs tests à la fois.  Vous pouvez les séparer avec un symbole qui n'apparaît pas dans le nom et la version du test, par exemple, «|». <br><br>  Si vous faites le test vous-même et stockez les données à ce sujet dans un cookie, vous aurez besoin d'une variable comme «Code JavaScript natif» pour les extraire: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cookie_name =<span class="hljs-string"><span class="hljs-string">'{{test_variant}}'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> matches = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.cookie.match(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">RegExp</span></span>( <span class="hljs-string"><span class="hljs-string">"(?:^|; )"</span></span> + cookie_name.replace(<span class="hljs-regexp"><span class="hljs-regexp">/([\.$?*|{}\(\)\[\]\\\/\+^])/g</span></span>, <span class="hljs-string"><span class="hljs-string">'\\$1'</span></span>) + <span class="hljs-string"><span class="hljs-string">"=([^;]*)"</span></span> )); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> matches ? <span class="hljs-built_in"><span class="hljs-built_in">decodeURIComponent</span></span>(matches[<span class="hljs-number"><span class="hljs-number">1</span></span>]) : <span class="hljs-string"><span class="hljs-string">'(not set)'</span></span>; }</code> </pre> <br>  où au lieu de {{test_variant}}, vous devez spécifier le nom du cookie dans lequel le nom et la variante du test sont stockés.  N'oubliez pas de l'ajouter à la variable des paramètres GA. <br><br>  En ajoutant le paramètre h_AB-Test au rapport, nous verrons dans Google Analytics à quelle option de test la session appartient.  Selon la valeur de ce paramètre, vous pouvez segmenter les utilisateurs. <br><br>  <b>Résultat.</b>  Nous créons autant de segments qu'il y a de cas de test avec la condition h_AB-Test.  Il doit correspondre à la valeur "nom + scénario de test".  Nous examinons les événements qui nous intéressent dans les rapports. <br><br><h2>  Adresse pleine page </h2><br>  <b>Défi.</b>  Le responsable de la publicité contextuelle a lancé une campagne publicitaire dans Yandex.Direct.  Quelques jours plus tard, il est entré dans le rapport des sources GA et a constaté que le nombre de sessions utilisateur issues de la campagne publicitaire qu'il avait créée était bien inférieur aux clics sur les annonces dans Yandex.Direct. <br><br>  <b>Solution.</b>  Google Analytics a un paramètre requis pour le suivi des annonces - utm_source.  Si tel est le cas, sa valeur sera ajoutée au paramètre standard "Source de la campagne".  De même, Google le fait avec d'autres balises UTM pour l'enregistrement dans les paramètres correspondants. <br><br>  Tous les tags UTM sont automatiquement supprimés du rapport sur les pages du site et vous ne pouvez pas les analyser là-bas.  Dans ce cas, si le libellé utm_source n'a pas été défini, Google supprimera simplement toutes les balises UTM trouvées dans le rapport sur les pages et n'enregistrera pas leur contenu dans les paramètres intégrés correspondants. <br><br>  Nous allons configurer le paramètre avec l'adresse de page complète pour voir toutes les balises, même si la publicité n'est pas configurée correctement.  Appelons-le h_fullPage. <br><br>  <b>Paramètres techniques.</b>  Créons une variable avec le type "variable JavaScript" dans la section "Nom de variable globale" et spécifions document.URL: <br><br><img src="https://habrastorage.org/webt/bp/pw/ww/bppwwwv7021ewdjqxxhaymypmzs.jpeg"><br><br>  Comme la portée de la variable set - hit. <br><br>  <b>Résultat.</b>  La séquence de balises UTM suivante a été utilisée tout au long de la campagne publicitaire: utm_medium, utm_source, utm_campaign.  Après avoir examiné l'adresse complète des pages, nous avons remarqué qu'une esperluette était ignorée entre les annonces entre utm_medium et utm_source.  Étant donné que utm_source est une balise utm obligatoire pour toute campagne publicitaire et que Google Analytics ne l'a pas trouvée après les caractères spéciaux (?, &amp;), Le clic sur cette publicité a été enregistré dans le trafic direct.  Grâce au paramètre h_fullPage, il a été possible de détecter le problème et de le corriger dans les paramètres du panneau publicitaire. <br><br><h2>  Options d'événement </h2><br>  Deux paramètres plus utiles (sans description de leurs réglages): <br><br><ul><li>  <b>Défi.</b>  Nous marquons le site par nous-mêmes via GTM.  A trouvé une erreur, l'a rapidement corrigée, mais les événements avec l'erreur continuent d'arriver en GA. <br><br>  <b>Solution.</b>  Pour trouver rapidement la racine du problème, vous pouvez transférer un CD avec chaque événement: <br>  Le nom du conteneur (s'il y en a plusieurs sur le site) - la variable intégrée GTM; <br>  La version conteneur est la variable intégrée GTM; <br>  Nom du tag - vous devez le configurer vous-même. <br><br>  Vous pouvez passer ces trois paramètres à travers n'importe quel séparateur dans une variable de type "Constante": <br><br><img src="https://habrastorage.org/webt/2m/j4/dp/2mj4dpgyy_ierrk8-ndngyd17rk.jpeg"><br><br>  La portée du paramètre est atteinte. <br><br>  <b>Résultat.</b>  En utilisant la variable configurée, nous avons découvert que certains utilisateurs ont toujours l'ancienne version du conteneur, donc les événements continuent d'être envoyés.  Très probablement, les utilisateurs n'ont tout simplement pas actualisé la page ou elle a été mise en cache, vous devez donc attendre un peu. </li><li>  <b>Défi.</b>  Nous marquons le site via les développeurs.  Ils ont introduit une nouvelle instruction écrite par nous.  Après vérification, il s'est avéré que certains événements ont été envoyés avec une erreur. <br><blockquote>  <b>Important:</b> <br><br><ul><li>  N'envoyez pas d'événements de test à la vue de travail GA lorsque nous vérifions les événements sur le site de test; </li><li>  si après avoir commencé la bataille, nous avons remarqué que nous avons vérifié les événements marqués de manière incorrecte / après la mise à jour du site, quelque chose s'est cassé, il est important d'arrêter rapidement d'envoyer des événements à la vue de travail. </li></ul><br></blockquote>  <b>Solution.</b>  Nous diviserons les événements en nouveaux / fonctionnant incorrectement et correctement marqués.  Le premier peut être marqué comme test, le second - prod. <br><br>  Pour ce faire, laissez les développeurs ajouter des données à la couche de données, et nous les obtiendrons et les enverrons à GA.  Toute poussée ressemblera à ceci: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> dataLayer.push({ </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'event'</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'{{ }}'</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'event_id'</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'{{id }}'</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'eventCategory'</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'{{ }}'</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'eventAction'</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'{{  }}'</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'eventLabel'</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'{{ }}'</span></span></span><span class="actionscript">, }); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  où entre crochets doubles sont les noms des variables dans lesquelles les données sont stockées du côté des développeurs. <br><br>  Nous devrons créer la variable «Table de consultation» pour séparer les événements: <br><br><img src="https://habrastorage.org/webt/uz/ct/9j/uzct9jqlhgg1u0neld1n9zljzao.jpeg"><br><br>  {{event_id}} est une variable qui récupère l'identifiant d'événement du DataLayer. <br><br>  Nous mettons une coche devant «Définir la valeur par défaut» et dans la colonne «Valeur par défaut» test d'écriture.  Ainsi, initialement pour tous les événements, cette variable sera égale à test.  Après vous être assuré que l'événement est correctement marqué, ajoutez son event_id à la cellule "Input".  Dans le champ «Résultat», nous envoyons prod. <br><br>  Nous avons donc divisé tous les événements en marqués correctement et en nouveaux / incorrectement marqués.  Nous vous conseillons de créer une vue distincte dans Google Analytics, où il n'y aura des événements qu'avec l'étiquette prod (cela peut être fait en utilisant le filtre Vues). Là, vous ne verrez que les événements correctement marqués. <br><br>  <b>Résultat.</b>  Comme les erreurs dans le balisage des événements des instructions ont été éliminées, nous avons changé la valeur du paramètre pour ces événements dans GTM de test en prod.  Grâce à ce paramètre, nous n'incluons dans les rapports que les événements correctement marqués avec le label prod. </li></ul><br>  La fonctionnalité des dimensions personnalisées est large et ne se limite pas aux méthodes de configuration et d'application décrites.  Pour chaque type d'entreprise, d'analyse et d'hypothèse, vous pouvez trouver votre propre application de paramètres définis par l'utilisateur, et les méthodes de personnalisation décrites faciliteront ce processus. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr468079/">https://habr.com/ru/post/fr468079/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr468067/index.html">Fonctionnement de la composition alpha</a></li>
<li><a href="../fr468071/index.html">Eduard Medvedev, CTO chez Tungsten Labs: «Nous avons grandi au point où la technologie peut causer des dommages considérables»</a></li>
<li><a href="../fr468073/index.html">Andrei Terekhov: "Vous pouvez dire autant que vous le souhaitez que l'Américain est meilleur, mais notre voiture ne tombe jamais en panne"</a></li>
<li><a href="../fr468075/index.html">L'utilisation des réseaux de neurones siamois dans la recherche</a></li>
<li><a href="../fr468077/index.html">Posit les tests de façon adulte. Analyse spectrale</a></li>
<li><a href="../fr468081/index.html">«Données anonymes» ou ce qui est prévu dans 152-FZ</a></li>
<li><a href="../fr468083/index.html">API Android Camera2 depuis la bouilloire</a></li>
<li><a href="../fr468085/index.html">Le livre "Safe DevOps. Fonctionnement efficace du système</a></li>
<li><a href="../fr468087/index.html">Méthode de division bisectionnelle dans les tests</a></li>
<li><a href="../fr468089/index.html">Redéfinition basée sur l'édition: est-il possible en production?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>