<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òëÔ∏è üç∏ üòó TelegramBot. Die Grundfunktionalit√§t. Aufkleber und Emoticons. (Teil 3) „Ä∞Ô∏è ‚òÑÔ∏è üë©üèΩ‚Äçüè´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eine der Fragen, die in PM h√§ufig gestellt werden, ist, wie mit L√§cheln (Emojis) und Aufklebern gearbeitet wird. 

 Wie man damit arbeitet, welche Too...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>TelegramBot. Die Grundfunktionalit√§t. Aufkleber und Emoticons. (Teil 3)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482260/"> Eine der Fragen, die in PM h√§ufig gestellt werden, ist, wie mit L√§cheln (Emojis) und Aufklebern gearbeitet wird. <br><br>  Wie man damit arbeitet, welche Tools ich benutze, etc. <br><br>  In diesem Teil werden wir solche Dinge betrachten: wie man eine Nachricht mit einem Sticker erstellt, wie man eine empfangene Nachricht mit einem Sticker verarbeitet, wie man alle Emoticons (Emoji) im Nachrichtentext findet, wie man eine Nachricht mit Emoticons erstellt. <br><br>  Wen k√ºmmert es, bitte, unter der Katze. <br><a name="habracut"></a><br>  Aus Tradition beginnen wir den Artikel mit einem Link zur Quelle daf√ºr :) <br><br>  Der gesamte im Artikel beschriebene Code wird im <a href="https://github.com/dp-ua/TelegramBotBase/tree/Part3-Stick_and_Emoji">Zweig Part3-Stick_and_Emoji</a> kompiliert. <br><br><h3>  Aufkleber </h3><br>  Eines der Dinge, die mir im Telegramm so gut gefallen haben, als es erschien, waren Aufkleber.  Sie sind cool, bequem, frei.  Und all diese Vielzahl von Aufklebern, die wir nat√ºrlich im Bot verwenden m√∂chten.  In der Tat ist dieses Verfahren sehr einfach.  Um einem Benutzer einen Aufkleber zu senden, m√ºssen wir nur die ID des Aufklebers kennen und sonst nichts. <br>  Normalerweise erstelle ich mir f√ºr Sticker eine solche Assistenzklasse, in der ich Daten √ºber die im Bot verwendeten Sticker speichere: <br><br>  <a href="">Stickers.java</a> <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.telegram.telegrambots.api.methods.send.SendSticker; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Stickers { FUNNY_JIM_CARREY(<span class="hljs-string"><span class="hljs-string">"CAADBQADiQMAAukKyAPZH7wCI2BwFxYE"</span></span>), ; String stickerId; Stickers(String stickerId) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stickerId = stickerId; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> SendSticker </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSendSticker</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String chatId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">""</span></span>.equals(chatId)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"ChatId cant be null"</span></span>); SendSticker sendSticker = getSendSticker(); sendSticker.setChatId(chatId); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sendSticker; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> SendSticker </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSendSticker</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ SendSticker sendSticker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SendSticker(); sendSticker.setSticker(stickerId); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sendSticker; } }</code> </pre> <br>  Hier ist alles einfach.  Wir geben dem Aufkleber einen f√ºr uns verst√§ndlichen Namen.  Und mit Hilfe einiger Methoden erhalten wir ein fertiges Objekt zum Versenden an den Benutzer. <br><br>  Um die Frage zu beantworten: ‚ÄûWoher bekomme ich die Sticker-ID?‚Äú, Schreiben wir einen Assistenten, der uns diese Daten in unserem Bot zur Verf√ºgung stellt. <br><br>  Wir haben die grundlegenden Funktionen, die wir hier erstellt haben: <br>  <a href="https://habr.com/ru/post/481354/">TelegramBot.</a>  <a href="https://habr.com/ru/post/481354/">Die Grundfunktionalit√§t.</a>  <a href="https://habr.com/ru/post/481354/">(Teil 2)</a> <br>  Damit unser Bot die akzeptierten Aufkleber irgendwie verarbeiten kann, ben√∂tigen wir: <br><br><ul><li>  Stellen Sie fest, dass sie uns einen Aufkleber geschickt haben </li><li>  Geben Sie an, welcher Handler f√ºr die Verarbeitung von Nachrichten mit Aufklebern verantwortlich ist </li><li>  F√ºhren Sie einen Handler aus, der als Antwort eine Nachricht an den Benutzer generiert </li></ul><br>  <b>Aufgabe</b> : Beim Empfang eines Aufklebers im Chat sollte der Bot eine Textnachricht mit der Aufkleber-ID als Antwort senden. <br><br>  Wir haben den Befehl <a href="">STICKER</a> zur Liste der Befehle hinzugef√ºgt <br><br>  Im Analyzer des gesendeten Updates werden wir versuchen festzustellen, ob wir eine Textnachricht haben oder ob sie einen Aufkleber enth√§lt: <br><br>  <a href="">MessageReciever.java Zeile 57</a> <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (message.hasText()) { parsedCommand = parser.getParsedCommand(message.getText()); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Sticker sticker = message.getSticker(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sticker != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { parsedCommand = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ParsedCommand(Command.STICKER, sticker.getFileId()); } }</code> </pre> <br>  Weil  Wir m√ºssen keine komplexe Verarbeitung der gesendeten Nachricht vornehmen. Dann werden wir die Verarbeitung der Nachrichten mit dem Aufkleber dem vorhandenen Handler anvertrauen, der f√ºr die Verarbeitung der sogenannten "Systemnachrichten" verantwortlich ist: <br>  <a href="">MessageReciever.java Zeile 86</a> <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> START: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> HELP: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ID: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> STICKER: SystemHandler systemHandler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SystemHandler(bot); log.info(<span class="hljs-string"><span class="hljs-string">"Handler for command["</span></span> + command.toString() + <span class="hljs-string"><span class="hljs-string">"] is: "</span></span> + systemHandler); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> systemHandler;</code> </pre> <br>  Dementsprechend <b>m√ºssen</b> wir in <b>SystemHandler</b> angeben, wie der empfangene <b>STICKER-</b> Befehl verarbeitet werden soll: <br>  <a href="">SystemHandler.java Zeile 31</a> <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> STICKER: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"StickerID: "</span></span> + parsedCommand.getText();</code> </pre> <br>  Als Ergebnis erhalten wir beim Senden eines Aufklebers an unseren Bot die ID als Antwort: <br><br><img src="https://habrastorage.org/webt/3i/56/dy/3i56dyf1gkch2j-xgy9o-gjk8si.png"><br><br><h3>  Emoticons oder Emoji </h3><br>  Sie waren standardisiert, fast alle Ger√§te und Betriebssysteme verstehen und k√∂nnen sie anzeigen.  Sie sind sehr praktisch, um Nachrichten zu dekorieren.  Sie sehen kurz und b√ºndig auf den Schaltfl√§chen unter den Nachrichten.  Ob es Ihnen gef√§llt oder nicht - einige Vorteile. <br><br>  Zum Beispiel im <a href="https://t.me/EventCheckPlanner_Bot">Event Scheduler Bot</a> <br><br><img src="https://habrastorage.org/webt/r3/bq/bd/r3bqbdspnrch4-qy28vppzwxiks.png"><br><br>  Mithilfe der gleichen Symbole auf den Schaltfl√§chen und im Text der Nachricht k√∂nnen Sie dem Benutzer erm√∂glichen, Ihre Benutzeroberfl√§che intuitiv und verst√§ndlich zu gestalten und die Nachricht und die Schaltfl√§chen mit √ºbersch√ºssigem Text zu √ºberf√ºllen. <br><br>  Um Emojis in einer Nachricht oder auf einer Schaltfl√§che anzuzeigen, m√ºssen Sie deren Unicode kennen.  Das Internet ist voll von Quellen, in denen Sie alle aufgelisteten Emoticons finden, deren Tags und Codes angezeigt werden. <br>  F√ºr mich selbst habe ich diese Art der Arbeit mit Emojis gew√§hlt: Es ist bequemer, Emoticons im Telegramm selbst zu sehen und auszuw√§hlen. <br><br>  Nun, nat√ºrlich, analog zu den Aufklebern, schreiben wir einen kleinen Helfer f√ºr uns, der uns die notwendigen Codes zeigt und auch, damit wir sie garantiert korrekt verarbeiten k√∂nnen. <br><br>  <a href="">F√ºgen Sie zuallererst</a> die folgende Abh√§ngigkeit zu <a href="">pom.xml hinzu</a> : <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.vdurmont<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>emoji-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>3.3.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Ehrlich gesagt, ich kann mich nicht erinnern, wo ich darauf gesto√üen bin, aber seitdem benutze ich es nur, wenn ich etwas mit Emoticons in meinem Bot machen muss. <br><br>  Die Bibliothek enth√§lt viele verschiedene Tools: <br><br><img src="https://habrastorage.org/webt/ri/4e/qm/ri4eqmdo2uiyrnwoxck1trfklim.png"><br><br>  Neugierig und neugierig wird sein, wo man sich umdrehen kann :) <br><br>  Was braucht es, um ein Emoticon mit einem Bot zu senden?  Sie m√ºssen das gew√ºnschte Emoji in den Text der Unicode-Nachricht einbetten. <br><br>  Ja, Sie k√∂nnen Ressourcen finden, die Unicode-Listen mit Emojis enthalten, und verschiedene √úbersichtstabellen dar√ºber anzeigen, wie Emoticons auf verschiedenen Smartphones aussehen. <br><br>  Ich m√∂chte Ihnen einen Weg zeigen, der sich f√ºr mich als der geeignetste herausgestellt hat, mit einem L√§cheln umzugehen. <br><br>  Lassen Sie uns zun√§chst sehen, wie Sie L√§cheln im Telegramm selbst verwenden k√∂nnen.  Sie k√∂nnen ein Dialogfeld aufrufen, in dem alle Emoticons aufgelistet sind, und sie der Nachricht hinzuf√ºgen, indem Sie einfach auf die entsprechenden Symbole klicken.  Emoticons k√∂nnen der Nachricht auch mithilfe von Tags hinzugef√ºgt werden. <br><br>  Tags sollten mit Doppelpunkten umrahmt sein und einen eindeutigen Text enthalten, der den gew√ºnschten Smiley angibt. <br><br>  Wenn Sie in das Feld f√ºr die Eingabe einer Nachricht eine Nachricht eingeben, die mit einem Doppelpunkt beginnt, zeigt das Telegramm selbst an, welche Emojis den eingegebenen Text des Tags enthalten: <br><br><img src="https://habrastorage.org/webt/hr/s4/1o/hrs41orsvl1k4mkpt7mxlja-bnm.png"><br><br>  Und wenn Sie das richtige Emoticon-Tag eingeben und einen weiteren Doppelpunkt einf√ºgen, verwandelt sich der Text in einen Smiley.  Tags werden auch angezeigt, wenn Sie die linke Maustaste auf dem Emoticon gedr√ºckt halten. <br><br><img src="https://habrastorage.org/webt/t-/ib/ya/t-ibya9mw4829qau8wnz9h8uxwq.png"><br><br>  Und jetzt kommt uns die Bibliothek zu Hilfe, deren Abh√§ngigkeit wir oben hinzugef√ºgt haben.  Sie wei√ü, wie man mit Emoticon-Tags arbeitet.  Dies ist in erster Linie f√ºr Sie von Vorteil, da Tags besser lesbar sind und eine Bedeutung haben. <br><br>  Und wenn wir das Tag kennen, k√∂nnen wir das Unicode-Emoticon folgenderma√üen erhalten: <br><br><pre> <code class="java hljs">String emoji_kissing = EmojiParser.parseToUnicode(<span class="hljs-string"><span class="hljs-string">":kissing:"</span></span>);</code> </pre> <br>  Sie k√∂nnen sich eine separate Klasse erstellen, in der Sie die im Bot verwendeten Emoticons behalten.  Am Beispiel desselben <a href="https://t.me/EventCheckPlanner_Bot">Veranstaltungsplaners</a> hat er dieses L√§cheln in seinem Arsenal: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.vdurmont.emoji.EmojiParser; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Icon { PLUS(<span class="hljs-string"><span class="hljs-string">":heavy_plus_sign:"</span></span>), MINUS(<span class="hljs-string"><span class="hljs-string">":heavy_minus_sign:"</span></span>), CHECK(<span class="hljs-string"><span class="hljs-string">":white_check_mark:"</span></span>), NOT(<span class="hljs-string"><span class="hljs-string">":x:"</span></span>), DOUBT(<span class="hljs-string"><span class="hljs-string">":zzz:"</span></span>), FLAG(<span class="hljs-string"><span class="hljs-string">":checkered_flag:"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String value; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> EmojiParser.parseToUnicode(value); } Icon(String value) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.value = value; } }</code> </pre> <br>  Und so sieht der Code mit dieser Klasse und einem bestimmten Emoticon aus: <br><br><pre> <code class="java hljs"> row.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InlineKeyboardButton() .setText(Icon.CHECK.get() + <span class="hljs-string"><span class="hljs-string">" I'm going"</span></span>)</code> </pre> <br>  Dies ist der Code f√ºr diese Schaltfl√§che: <br><br><img src="https://habrastorage.org/webt/bc/lw/ou/bclwou1ukoe0nosc7iyfnqw6zki.png"><br><br>  Ich habe eine Nuance dieser Bibliothek bemerkt.  Nicht alle Emoticons, die sich in einem Telegramm befinden, k√∂nnen die Bibliothek erkennen.  Achten Sie daher auf neue Versionen der Bibliothek. <br><br>  Um sicherzugehen, welches L√§cheln wir zeigen k√∂nnen und welches nicht, werden wir diese Aufgabe unserem Assistenten anvertrauen. <br><br>  <b>Aufgabe:</b> Wenn die gesendete Nachricht keinen bestimmten Befehl enth√§lt, aber Emoticons im Text enth√§lt, zeigen Sie diese Emoticons dem Benutzer auf dem Bildschirm in Form einer Nachricht an und geben Sie deren Attribute (Tag und Beschreibung) an. <br><br>  F√ºgen Sie der Befehlsliste den Befehl <b>TEXT_CONTAIN_EMOJI hinzu</b> <br>  <a href="">Command.java Zeile 8</a> <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Command { ... TEXT_CONTAIN_EMOJI, ... }</code> </pre> <br>  F√ºgen Sie im Parser, der bestimmt, welche Art von Befehl in unserer Nachricht enthalten ist, den folgenden Text hinzu: <br><br>  <a href="">Parser.java Zeile 38</a> <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.getCommand() == Command.NONE) { List&lt;String&gt; emojiContainsInText = EmojiParser.extractEmojis(result.getText()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (emojiContainsInText.size() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) result.setCommand(Command.TEXT_CONTAIN_EMOJI); }</code> </pre> <br>  Wenn wir feststellen, dass die Nachricht keinen bestimmten Befehl enth√§lt, sich jedoch Emoticons darin befinden, geben wir zur√ºck, dass wir den Befehl TEXT_CONTAIN_EMOJI analysiert haben. <br><br>  Erstellen Sie einen separaten Handler, der nur diesen Befehl verarbeitet: <br>  <a href="">EmojiHandler.java</a> <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.example.telegrambot.bot.Bot; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.example.telegrambot.command.ParsedCommand; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.vdurmont.emoji.Emoji; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.vdurmont.emoji.EmojiManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.vdurmont.emoji.EmojiParser; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.log4j.Logger; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.telegram.telegrambots.api.objects.Update; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.HashSet; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Set; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EmojiHandler</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger log = Logger.getLogger(EmojiHandler.class); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EmojiHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bot bot)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(bot); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String chatId, ParsedCommand parsedCommand, Update update)</span></span></span><span class="hljs-function"> </span></span>{ String text = parsedCommand.getText(); StringBuilder result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); Set&lt;String&gt; emojisInTextUnique = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;&gt;(EmojiParser.extractEmojis(text)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (emojisInTextUnique.size() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) result.append(<span class="hljs-string"><span class="hljs-string">"Parsed emojies from message:"</span></span>).append(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (String emojiUnicode : emojisInTextUnique) { Emoji byUnicode = EmojiManager.getByUnicode(emojiUnicode); log.debug(byUnicode.toString()); String emoji = byUnicode.getUnicode() + <span class="hljs-string"><span class="hljs-string">" "</span></span> + byUnicode.getAliases() + <span class="hljs-string"><span class="hljs-string">" "</span></span> + byUnicode.getDescription(); result.append(emoji).append(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result.toString(); } }</code> </pre> <br>  Dieser Code w√§hlt nur Emoticons aus dem Nachrichtentext aus, bildet eine Gruppe mit eindeutigen, w√§hlt Tags und Beschreibungen aus ihren Eigenschaften aus und generiert daraus eine Textnachricht. <br><br>  Das Ergebnis der Arbeit sieht so aus: <br><br><img src="https://habrastorage.org/webt/ia/wy/sx/iawysxkxh3utfud9znjifqrgosm.png"><br><br>  In eckigen Klammern erhalten wir Tags, mit denen wir Emoticons einf√ºgen k√∂nnen.  Sie k√∂nnen sehen, dass sich mehr als ein Tag manchmal auf ein Emoticon bezieht. <br><br>  Mithilfe dieses Assistenten k√∂nnen wir au√üerdem genau nachvollziehen, welche Emoticons unsere Bibliothek versteht und welche ignoriert. <br><br>  Wie Sie zum Beispiel hier sehen k√∂nnen: <br><br><img src="https://habrastorage.org/webt/bz/f9/5i/bzf95i9alj3uqweuzdxfqg9ost0.png"><br><br>  <i>L√§chle</i> mit dem Code <i>: face_with_monocle:</i> aus irgendeinem Grund wird es von dieser Bibliothek nicht erkannt. <br><br>  Also haben wir einen Handler.  Wie geben wir die Aufgabe an ihn weiter? <br><br>  Weil  Wir wissen bereits, dass eine Textnachricht mit Emoticons als TEXT_CONTAIN_EMOJI-Befehl erkannt wird. In MessageReciever m√ºssen wir angeben, dass ein separater EmojiHandler-Handler f√ºr die Verarbeitung dieses Befehls verantwortlich ist. <br><br>  <a href="">MessageReciever.java Zeile 94</a> <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TEXT_CONTAIN_EMOJI: EmojiHandler emojiHandler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmojiHandler(bot); log.info(<span class="hljs-string"><span class="hljs-string">"Handler for command["</span></span> + command.toString() + <span class="hljs-string"><span class="hljs-string">"] is: "</span></span> + emojiHandler); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> emojiHandler;</code> </pre> <br>  Programmieren Sie gerne und z√∂gern Sie nicht, Fragen zu stellen :) <br><br>  PS <br>  Sie k√∂nnen den Bot mit dieser Funktionalit√§t hier f√ºhlen: <a href="https://t.me/test_habr_bot">https://t.me/test_habr_bot</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de482260/">https://habr.com/ru/post/de482260/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de482250/index.html">Eine einfache Zustandsmaschine f√ºr VueJS</a></li>
<li><a href="../de482252/index.html">Automatische Katzentoilette - Fortsetzung</a></li>
<li><a href="../de482254/index.html">VonmoTrade-Experiment. Teil 3: Optionsscheinheft. Verarbeitung und Speicherung von Handelsinformationen</a></li>
<li><a href="../de482256/index.html">KI und die Zukunft der Arbeit: Besch√§ftigungsaussichten in naher Zukunft</a></li>
<li><a href="../de482258/index.html">Wie neuronale Netze funktionieren und warum sie anfingen, viel Geld zu bringen</a></li>
<li><a href="../de482262/index.html">So melden Sie sich bei Talend Open Studio an</a></li>
<li><a href="../de482264/index.html">Brasilien, dunkle Magie, Mortal Kombat, Mars und 15.000 Menschen. Ontiko Jahresergebnisse</a></li>
<li><a href="../de482268/index.html">Megastrukturen der Zukunft: Die Dyson-Kugel, der Sternmotor und die ‚ÄûSchwarze-Loch-Bombe‚Äú</a></li>
<li><a href="../de482270/index.html">WebRTC-Streaming in und um die virtuelle Realit√§t</a></li>
<li><a href="../de482272/index.html">Auswahl eines Data Warehouse f√ºr Prometheus: Thanos vs VictoriaMetrics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>