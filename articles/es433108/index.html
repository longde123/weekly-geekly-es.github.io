<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>游띏游낖 游낶 游돗游낗 ld -z c칩digo separado 游빁游 游뗾游 鮫勇</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este art칤culo se centrar치 en una peque침a caracter칤stica de seguridad agregada en GNU ld a la versi칩n 2.30 en diciembre de 2018. En ruso, esta mejora s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ld -z c칩digo separado</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/433108/"><p><img src="https://habrastorage.org/webt/mz/nr/5c/mznr5cswg58pumrqbt60sjacvg4.png"></p><br><p>  Este art칤culo se centrar치 en una peque침a caracter칤stica de seguridad agregada en GNU ld a la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">versi칩n 2.30</a> en diciembre de 2018.  En ruso, esta mejora se mencion칩 en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">opennet</a> con la siguiente anotaci칩n: </p><br><blockquote>  Modo "-z c칩digo separado", que aumenta la seguridad de los archivos ejecutables a costa de un peque침o aumento en el tama침o y el consumo de memoria </blockquote><p>  Vamos a resolverlo.  Para explicar de qu칠 tipo de problema de seguridad estamos hablando y cu치l es la soluci칩n, comencemos con las caracter칤sticas generales de las vulnerabilidades de vulnerabilidad binaria. </p><a name="habracut"></a><br><h1 id="problemy-perehvata-potoka-upravleniya-v-eksploytah">  Explotar problemas de control de flujo </h1><br><p>  Un atacante puede transferir datos al programa y manipularlos de esta manera con la ayuda de varias vulnerabilidades: escribir por 칤ndice m치s all치 del l칤mite de la matriz, copiar de forma insegura las cadenas, usar objetos despu칠s del lanzamiento.  Tales errores son t칤picos para el c칩digo del programa C y C ++ y pueden provocar da침os en la memoria con ciertos datos de entrada para el programa. </p><br><div class="spoiler">  <b class="spoiler_title">Vulnerabilidades de corrupci칩n de memoria</b> <div class="spoiler_text"><p> CWE-20: Validaci칩n de entrada incorrecta <br>  CWE-118: Acceso incorrecto de recurso indexable ('Error de rango') <br>  CWE-119: Restricci칩n incorrecta de operaciones dentro de los l칤mites de un b칰fer de memoria <br>  CWE-120: Copia de b칰fer sin verificar el tama침o de la entrada ('Desbordamiento de b칰fer cl치sico') <br>  CWE-121: desbordamiento de b칰fer basado en pila <br>  CWE-122: desbordamiento de b칰fer basado en el mont칩n <br>  CWE-123: Condici칩n de escribir qu칠-d칩nde <br>  CWE-124: Buffer Underwrite ('Buffer Underflow') <br>  CWE-125: Lectura fuera de l칤mites <br>  CWE-126: Lectura excesiva del b칰fer <br>  CWE-127: Buffer Under-read <br>  CWE-128: error de ajuste <br>  CWE-129: Validaci칩n incorrecta del 칤ndice de matriz <br>  CWE-130: Manejo incorrecto de la inconsistencia del par치metro de longitud <br>  CWE-131: C치lculo incorrecto del tama침o del b칰fer <br>  CWE-134: Uso de cadenas de formato controladas externamente <br>  CWE-135: C치lculo incorrecto de la longitud de cadena de varios bytes <br>  CWE-170: Terminaci칩n nula incorrecta <br>  CWE-190: Desbordamiento de enteros o envolvente <br>  CWE-415: Doble gratis <br>  CWE-416: Uso despu칠s de gratis <br>  CWE-476: Desreferencia de puntero nulo <br>  CWE-787: Escritura fuera de l칤mites <br>  CWE-824: Acceso del puntero no inicializado <br>  ... </p></div></div><br><p>  El elemento de explotaci칩n cl치sico de las vulnerabilidades similares a la corrupci칩n de la memoria es sobrescribir un puntero en la memoria.  Luego, el programa utilizar치 el puntero para transferir el control a otro c칩digo: para llamar a un m칠todo o funci칩n de clase desde otro m칩dulo, para regresar desde una funci칩n.  Y como el puntero se sobrescribi칩, el atacante interceptar치 el control, es decir, se ejecutar치 el c칩digo preparado por 칠l.  Si est치 interesado en variaciones y detalles de estas t칠cnicas, le recomendamos leer el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documento</a> . </p><br><p>  Este momento com칰n de la operaci칩n de tales exploits es conocido, y aqu칤 para el atacante las barreras se han colocado durante mucho tiempo: </p><br><ol><li>  Comprobaci칩n de la integridad de los punteros antes de pasar el control: cookies de pila, protecci칩n de flujo de control, autenticaci칩n de puntero </li><li>  Aleatorizaci칩n de direcciones de segmento con c칩digo y datos: aleatorizaci칩n del dise침o del espacio de direcciones </li><li>  Evitar que el c칩digo ejecute segmentos de c칩digo externos: protecci칩n de espacio ejecutable </li></ol><br><p>  A continuaci칩n, nos centraremos en proteger este 칰ltimo tipo. </p><br><h1 id="executable-space-protection">  protecci칩n de espacio ejecutable </h1><br><p>  La memoria del programa es heterog칠nea y est치 dividida en segmentos con diferentes derechos: leer, escribir y ejecutar.  Esto est치 garantizado por la capacidad del procesador para marcar p치ginas de memoria con marcas de acceso en las tablas de p치ginas.  La idea de protecci칩n se basa en una estricta separaci칩n de c칩digo y datos: los datos recibidos del atacante en el proceso de procesamiento deben colocarse en segmentos <strong>no ejecutables</strong> (pila, mont칩n) y el c칩digo del programa en s칤, en segmentos separados <strong>inmutables</strong> .  Por lo tanto, esto deber칤a privar al atacante de la capacidad de colocar y ejecutar c칩digo extra침o en la memoria. </p><br><p>  Para evitar la prohibici칩n de la ejecuci칩n de c칩digo en segmentos de datos, se utilizan t칠cnicas de reutilizaci칩n de c칩digo.  Es decir, el atacante transfiere el control a los fragmentos de c칩digo (en lo sucesivo denominados gadgets) ubicados en las p치ginas ejecutables.  Las t칠cnicas de este tipo son de diversa dificultad, en orden creciente: </p><br><ul><li>  pasar el control a una funci칩n que hace lo suficiente para el atacante: a la funci칩n system () con un argumento controlado para ejecutar comandos de shell arbitrarios (ret2libc) </li><li> transferir el control a una funci칩n o cadena de dispositivos que deshabilitar치n la protecci칩n o har치n que parte de la memoria sea ejecutable (por ejemplo, llamando a <code>mprotect()</code> ), seguido de la ejecuci칩n de c칩digo arbitrario </li><li>  ejecuci칩n de todas las acciones deseadas utilizando una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=http://web.archive.org/web/20170325014927/">larga cadena de gadgets</a> </li></ul><br><p>  Por lo tanto, el atacante se enfrenta a la tarea de reutilizar el c칩digo existente en un volumen u otro.  Si esto es algo m치s complicado que volver a una sola funci칩n, se requerir치 una <em>cadena de gadgets</em> .  Para buscar gadgets por segmentos ejecutables, hay herramientas: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ropper</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ropgadget</a> . </p><br><h2 id="dyra-read_implies_exec">  Hoyo READ_IMPLIES_EXEC </h2><br><p>  Sin embargo, a veces las 치reas de memoria con datos pueden ser ejecutables, y los principios de separaci칩n de c칩digo y datos descritos anteriormente se violan claramente.  En tales casos, el atacante se ahorra la molestia de encontrar dispositivos o funciones para reutilizar el c칩digo.  Un hallazgo interesante de este tipo fue la pila ejecutable y todos los segmentos de datos en el mismo "firewall industrial". </p><br><p>  Listado <code>/proc/$pid/maps</code> : </p><br><pre> <code class="plaintext hljs">00008000-00009000 r-xp 00000000 08:01 10 /var/flash/dmt/nx_test/a.out 00010000-00011000 rwxp 00000000 08:01 10 /var/flash/dmt/nx_test/a.out 00011000-00032000 rwxp 00000000 00:00 0 [heap] 40000000-4001f000 r-xp 00000000 1f:02 429 /lib/ld-linux.so.2 4001f000-40022000 rwxp 00000000 00:00 0 40027000-40028000 r-xp 0001f000 1f:02 429 /lib/ld-linux.so.2 40028000-40029000 rwxp 00020000 1f:02 429 /lib/ld-linux.so.2 4002c000-40172000 r-xp 00000000 1f:02 430 /lib/libc.so.6 40172000-40179000 ---p 00146000 1f:02 430 /lib/libc.so.6 40179000-4017b000 r-xp 00145000 1f:02 430 /lib/libc.so.6 4017b000-4017c000 rwxp 00147000 1f:02 430 /lib/libc.so.6 4017c000-40b80000 rwxp 00000000 00:00 0 be8c2000-be8d7000 rwxp 00000000 00:00 0 [stack]</code> </pre> <br><p>  Aqu칤 puede ver la tarjeta de memoria del proceso de utilidad de prueba.  Un mapa consta de 치reas de memoria: filas de tabla.  Primero, preste atenci칩n a la columna derecha: explica el contenido del 치rea (segmentos de c칩digo, datos de las bibliotecas de funciones o el programa en s칤) o su tipo (mont칩n, pila).  A la izquierda, en orden, se encuentra el rango de direcciones que ocupa cada 치rea de memoria y, adem치s, las banderas de derechos de acceso: r (lectura), w (escritura), x (ejecuci칩n).  Estas banderas determinan el comportamiento del sistema cuando se intenta leer, escribir y ejecutar memoria en estas direcciones.  Si se viola el modo de acceso designado, se produce una excepci칩n. </p><br><p>  Tenga en cuenta que casi toda la memoria dentro del proceso es ejecutable: la pila, el mont칩n y todos los segmentos de datos.  Esto es un problema  Obviamente, la presencia de p치ginas de memoria rwx facilitar치 la vida de un atacante, ya que podr치 ejecutar libremente <strong>su</strong> c칩digo en dicho proceso en cualquier lugar donde su c칩digo llegue al transferir datos (paquetes, archivos) a dicho programa para su procesamiento. </p><br><p>  쯇or qu칠 surgi칩 tal situaci칩n en un dispositivo moderno que admite la prohibici칩n de la ejecuci칩n de c칩digo en p치ginas de datos con hardware, la seguridad de las redes corporativas e industriales depende del dispositivo y el problema sonoro y su soluci칩n se conocen desde hace mucho tiempo? </p><br><p>  Esta imagen est치 determinada por el comportamiento del n칰cleo durante la inicializaci칩n del proceso (asignaci칩n de una pila, mont칩n, carga del ELF principal, etc.) y durante la ejecuci칩n de las llamadas al proceso nuclear.  El atributo clave que afecta esto es el indicador de personalidad <code>READ_IMPLIES_EXEC</code> .  El efecto de este indicador es que cualquier memoria legible tambi칠n se vuelve ejecutable.  Se puede establecer un indicador en su proceso por varias razones: </p><br><ol><li>  El indicador de software en el encabezado ELF puede solicitar expl칤citamente Legacy para implementar un mecanismo muy interesante: un trampol칤n en la pila ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">2</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">3</a> ). </li><li>  Puede ser heredado por procesos hijos del padre. </li><li>  춰Puede ser instalado por el kernel independientemente para todos los procesos!  Primero, si la arquitectura no admite memoria no ejecutable.  En segundo lugar, por si acaso, para soportar otras <a href="">muletas antiguas</a> .  Este c칩digo est치 en el kernel 2.6.32 (ARM), que tuvo una vida 칰til muy larga.  Este fue solo nuestro caso. </li></ol><br><h1 id="prostranstvo-dlya-poiska-gadzhetov-v-obraze-elf">  Espacio para encontrar gadgets en una imagen ELF </h1><br><p>  Las bibliotecas de funciones y los ejecutables del programa est치n en formato ELF.  El compilador gcc traduce las construcciones de lenguaje en c칩digo m치quina y lo coloca en una secci칩n, y los datos que este c칩digo opera en otras secciones.  Hay muchas secciones y el enlazador ld las agrupa en segmentos.  Por lo tanto, ELF contiene una imagen de programa que tiene dos representaciones: una tabla de secciones y una tabla de segmentos. </p><br><pre> <code class="plaintext hljs">$ readelf -l /bin/ls Elf file type is EXEC (Executable file) Entry point 0x804bee9 There are 9 program headers, starting at offset 52 Program Headers: Type Offset VirtAddr PhysAddr FileSiz MemSiz Flg Align PHDR 0x000034 0x08048034 0x08048034 0x00120 0x00120 RE 0x4 INTERP 0x000154 0x08048154 0x08048154 0x00013 0x00013 R 0x1 [Requesting program interpreter: /lib/ld-linux.so.2] LOAD 0x000000 0x08048000 0x08048000 0x1e40c 0x1e40c RE 0x1000 LOAD 0x01ef00 0x08067f00 0x08067f00 0x00444 0x01078 RW 0x1000 DYNAMIC 0x01ef0c 0x08067f0c 0x08067f0c 0x000f0 0x000f0 RW 0x4 NOTE 0x000168 0x08048168 0x08048168 0x00044 0x00044 R 0x4 GNU_EH_FRAME 0x018b74 0x08060b74 0x08060b74 0x00814 0x00814 R 0x4 GNU_STACK 0x000000 0x00000000 0x00000000 0x00000 0x00000 RW 0x10 GNU_RELRO 0x01ef00 0x08067f00 0x08067f00 0x00100 0x00100 R 0x1 Section to Segment mapping: Segment Sections... 00 01 .interp 02 .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rel.dyn .rel.plt .init .plt .plt.got .text .fini .rodata .eh_frame_hdr .eh_frame 03 .init_array .fini_array .jcr .dynamic .got .got.plt .data .bss 04 .dynamic 05 .note.ABI-tag .note.gnu.build-id 06 .eh_frame_hdr 07 08 .init_array .fini_array .jcr .dynamic .got</code> </pre> <br><p>  Aqu칤 puede ver la asignaci칩n de secciones a segmentos en una imagen ELF. </p><br><p>  Las utilidades utilizan la tabla de <strong>secciones</strong> para analizar programas y bibliotecas, pero los cargadores no la utilizan para proyectar archivos ELF en la memoria de proceso.  La tabla de secci칩n describe la estructura ELF con m치s detalle que la tabla de segmentos.  Varias secciones pueden estar dentro de un segmento. </p><br><p>  Los cargadores ELF crean una imagen ELF en memoria basada en el contenido de la tabla de <strong>segmentos</strong> .  La tabla de <strong>particiones</strong> ya no se usa para cargar ELF en la memoria. </p><br><div class="spoiler">  <b class="spoiler_title">Pero hay excepciones a esta regla.</b> <div class="spoiler_text"><p>  Por ejemplo, en la naturaleza, hay un parche de desarrolladores de Debian para el cargador ELF ld.so para la arquitectura ARM, que busca una secci칩n especial ".ARM.attributes" como <a href="">SHT_ARM_ATTRIBUTES</a> y binarios con una tabla de secci칩n <a href="">recortada</a> en dicho sistema. </p></div></div><br><p>  Un segmento ELF tiene banderas que determinan qu칠 permisos tendr치 el segmento en la memoria.  Tradicionalmente, la mayor칤a del software para GNU / Linux se organiz칩 de tal manera que se <code>PT_LOAD</code> dos <code>PT_LOAD</code> (cargables en memoria) en la tabla de segmentos, como en la lista anterior: </p><br><ol><li><p>  Segmento con banderas <code>RE</code> </p><br><p>  1.1.  C칩digo <strong>ejecutable</strong> ELF: secciones <code>.init</code> , <code>.text</code> , <code>.fini</code> </p><br><p>  1.2.  Datos <strong>inmutables</strong> en ELF: <code>.symtab</code> , <code>.rodata</code> </p><br></li><li><p>  Segmento de banderas <code>RW</code> </p><br><p>  2.1.  Datos <strong>variables</strong> en ELF: secciones <code>.plt</code> , <code>.got</code> , <code>.data</code> , <code>.bss</code> </p><br></li></ol><br><p>  Si presta atenci칩n a la composici칩n del primer segmento y sus banderas de acceso, queda claro que tal dise침o expande el espacio para buscar dispositivos para t칠cnicas de reutilizaci칩n de c칩digo.  En ELF grandes, como libcrypto, las tablas de servicio y otros <strong>datos</strong> inmutables pueden ocupar hasta el 40% del segmento <strong>ejecutable</strong> .  La presencia de algo similar a piezas de c칩digo en estos datos se confirma por los intentos de desmontar dichos archivos binarios con una gran cantidad de datos en el segmento ejecutable sin tablas de secci칩n y s칤mbolos.  Cada secuencia de bytes en este 칰nico segmento ejecutable puede considerarse 칰til para el fragmento de ataque del c칩digo de m치quina y el trampol칤n, ya sea esta secuencia de bytes con al menos una parte de la l칤nea del mensaje de depuraci칩n del programa, parte del nombre de la funci칩n en la tabla de s칤mbolos o el n칰mero constante del algoritmo criptogr치fico ... </p><br><div class="spoiler">  <b class="spoiler_title">Encabezados ejecutables de PE</b> <div class="spoiler_text"><p>  Los encabezados y tablas ejecutables al comienzo del primer segmento de la imagen ELF se parecen a la situaci칩n de Windows hace aproximadamente 15 a침os.  Hubo una serie de virus que infectaron archivos, escribiendo su c칩digo en su encabezado PE, que tambi칠n era ejecutable all칤.  Logr칠 desenterrar tal muestra en el archivo: </p><br><p><img src="https://habrastorage.org/webt/gy/kt/7t/gykt7t5znycwstjaek_cdoo_xvm.png" alt="Virus.Win32.Haless.1127"></p><br><p>  Como puede ver, el cuerpo del virus se aprieta justo despu칠s de la tabla de secciones en el 치rea de los encabezados de PE.  En una proyecci칩n de un archivo en la memoria virtual, generalmente hay alrededor de 3 KB de espacio libre aqu칤.  Despu칠s del cuerpo del virus hay un espacio vac칤o y luego la primera secci칩n comienza con el c칩digo del programa. </p><br><p>  Sin embargo, para Linux hubo trabajos mucho m치s interesantes de la escena VX: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Represalias</a> . </p></div></div><br><h1 id="reshenie">  Soluci칩n </h1><br><ul><li>  El problema descrito anteriormente se conoce desde hace <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mucho tiempo</a> . </li><li>  Corregido <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el 12 de enero de 2018</a> : se agrega la clave `ld -z separate-code: encabezado de segmento" Crear c칩digo separado "PT_LOAD" en el objeto. Esto especifica un segmento de memoria que debe contener solo instrucciones y debe estar en p치ginas totalmente separadas de cualquier otro dato. No cree un segmento de c칩digo separado "PT_LOAD" si se usa el c칩digo noseparate ").  La caracter칤stica fue <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">lanzada</a> en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">versi칩n 2.30</a> . </li><li>  Adem치s, esta caracter칤stica se incluy칩 de manera predeterminada en la pr칩xima <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">versi칩n 2.31</a> . </li><li>  Presente en paquetes <code>binutils</code> nuevos, por ejemplo, en los repositorios Ubuntu 18.10.  Muchos paquetes ya se han ensamblado con esta nueva caracter칤stica, que el investigador de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ElfMaster</a> encontr칩 y document칩 </li></ul><br><p>  Como resultado de los cambios en el algoritmo de dise침o, se obtiene una nueva imagen ELF: </p><br><pre> <code class="plaintext hljs">$ readelf -l ls Elf file type is DYN (Shared object file) Entry point 0x41aa There are 11 program headers, starting at offset 52 Program Headers: Type Offset VirtAddr PhysAddr FileSiz MemSiz Flg Align PHDR 0x000034 0x00000034 0x00000034 0x00160 0x00160 R 0x4 INTERP 0x000194 0x00000194 0x00000194 0x00013 0x00013 R 0x1 [Requesting program interpreter: /lib/ld-linux.so.2] LOAD 0x000000 0x00000000 0x00000000 0x01e6c 0x01e6c R 0x1000 LOAD 0x002000 0x00002000 0x00002000 0x14bd8 0x14bd8 RE 0x1000 LOAD 0x017000 0x00017000 0x00017000 0x0bf80 0x0bf80 R 0x1000 LOAD 0x0237f8 0x000247f8 0x000247f8 0x0096c 0x01afc RW 0x1000 DYNAMIC 0x023cec 0x00024cec 0x00024cec 0x00100 0x00100 RW 0x4 NOTE 0x0001a8 0x000001a8 0x000001a8 0x00044 0x00044 R 0x4 GNU_EH_FRAME 0x01c3f8 0x0001c3f8 0x0001c3f8 0x0092c 0x0092c R 0x4 GNU_STACK 0x000000 0x00000000 0x00000000 0x00000 0x00000 RW 0x10 GNU_RELRO 0x0237f8 0x000247f8 0x000247f8 0x00808 0x00808 R 0x1 Section to Segment mapping: Segment Sections... 00 01 .interp 02 .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rel.dyn .rel.plt 03 .init .plt .plt.got .text .fini 04 .rodata .eh_frame_hdr .eh_frame 05 .init_array .fini_array .data.rel.ro .dynamic .got .data .bss 06 .dynamic 07 .note.ABI-tag .note.gnu.build-id 08 .eh_frame_hdr 09 10 .init_array .fini_array .data.rel.ro .dynamic .got</code> </pre> <br><p>  El l칤mite entre el c칩digo y los datos ahora es m치s preciso.  El 칰nico segmento ejecutable realmente contiene solo secciones de c칩digo: .init, .plt, .plt.got, .text, .fini. </p><br><div class="spoiler">  <b class="spoiler_title">쯈u칠 ha cambiado exactamente dentro de ld?</b> <div class="spoiler_text"><p>  Como sabe, la <a href="">secuencia de comandos del vinculador</a> describe la estructura del archivo ELF de salida.  Puede ver el script predeterminado como este: </p><br><pre> <code class="plaintext hljs">$ ld --verbose GNU ld (GNU Binutils for Ubuntu) 2.26.1 * * * using internal linker script: ================================================== /* Script for -z combreloc: combine and sort reloc sections */ /* Copyright (C) 2014-2015 Free Software Foundation, Inc. * * *</code> </pre> <br><p>  Muchos otros scripts para diferentes plataformas y combinaciones de opciones se encuentran en el directorio <code>ldscripts</code> .  Se han creado nuevos scripts para la opci칩n de <code>separate-code</code> . </p><br><pre> <code class="plaintext hljs">$ diff elf_x86_64.x elf_x86_64.xe 1c1 &lt; /* Default linker script, for normal executables */ --- &gt; /* Script for -z separate-code: generate normal executables with separate code segment */ 46a47 &gt; . = ALIGN(CONSTANT (MAXPAGESIZE)); 70a72,75 &gt; . = ALIGN(CONSTANT (MAXPAGESIZE)); &gt; /* Adjust the address for the rodata segment. We want to adjust up to &gt; the same address within the page on the next page up. */ &gt; . = SEGMENT_START("rodata-segment", ALIGN(CONSTANT (MAXPAGESIZE)) + (. &amp; (CONSTANT (MAXPAGESIZE) - 1)));</code> </pre> <br><p>  Aqu칤 puede ver que se ha agregado una directiva para declarar un nuevo segmento con secciones de solo lectura que siguen al segmento de c칩digo. </p><br><p>  Sin embargo, adem치s de los scripts, se realizaron cambios en las fuentes del vinculador.  A saber, en la funci칩n <code>_bfd_elf_map_sections_to_segments</code> - vea <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">commit</a> .  Ahora, al seleccionar segmentos para secciones, se agregar치 un nuevo segmento cuando la secci칩n difiera por el indicador <code>SEC_CODE</code> de la secci칩n anterior. </p></div></div><br><h1 id="vyvod">  Conclusi칩n </h1><br><p>  Como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">antes</a> , recomendamos que los desarrolladores no se olviden de utilizar los indicadores de seguridad integrados en el compilador y el vinculador al desarrollar software.  Un cambio tan peque침o puede complicar en gran medida la vida del atacante y hacer que la suya sea mucho m치s tranquila. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es433108/">https://habr.com/ru/post/es433108/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es433098/index.html">La historia de DDR3, SPD y fabricantes chinos originales</a></li>
<li><a href="../es433100/index.html">Trabajando con una base de datos desde una aplicaci칩n</a></li>
<li><a href="../es433102/index.html">쯇or qu칠 los cient칤ficos creen que el Noveno Planeta no existe?</a></li>
<li><a href="../es433104/index.html">El desaf칤o de Foobar: la prueba secreta de Google para desarrolladores</a></li>
<li><a href="../es433106/index.html">SpaceX y NASA reafirman sus intenciones de lanzar el lanzamiento debut de la nave Crew Dragon en enero de 2019</a></li>
<li><a href="../es433112/index.html">JavaScript entretenido: Snow Day</a></li>
<li><a href="../es433114/index.html">Certificaci칩n PMP: preparaci칩n para el examen de estilo de cercan칤as</a></li>
<li><a href="../es433116/index.html">Lanzallamas, Santa Claus en un tanque, Bigfoot, Baba Yaga en Endurica (y, posiblemente, un jetpack): todo para ni침os para el nuevo a침o</a></li>
<li><a href="../es433118/index.html">Pruebas de referencia y an치lisis r치pido de algoritmos de permutaciones</a></li>
<li><a href="../es433122/index.html">React-Hot-Loader v4.6</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>