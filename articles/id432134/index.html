<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÜóÔ∏è ü§æ üë©üèº‚Äçüç≥ Generasi lingkungan berbasis suara dan musik di Unity3D. Bagian 2. Membuat trek 2D dari musik ü•™ üë©üèΩ‚Äçüè≠ ‚öóÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Anotasi 


 Halo semuanya. Baru-baru ini, saya menulis sebuah artikel Menghasilkan lingkungan berdasarkan suara dan musik di Unity3D , di mana saya me...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Generasi lingkungan berbasis suara dan musik di Unity3D. Bagian 2. Membuat trek 2D dari musik</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/digital-ecosystems/blog/432134/"><h2 id="annotaciya">  Anotasi </h2><br><p>  Halo semuanya.  Baru-baru ini, saya menulis sebuah artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Menghasilkan lingkungan berdasarkan suara dan musik di Unity3D</a> , di mana saya memberikan beberapa contoh permainan yang menggunakan mekanisme menghasilkan konten berdasarkan musik, dan juga berbicara tentang aspek-aspek dasar dari permainan tersebut.  Praktis tidak ada kode dalam artikel itu dan saya berjanji akan ada sekuelnya.  Dan ini dia, di depanmu.  Kali ini kami akan mencoba membuat trek untuk balapan 2D, dengan gaya Hill Climb, dari musik Anda.  Mari kita lihat apa yang kita dapatkan .. </p><br><p><img src="https://habrastorage.org/webt/wp/6y/jk/wp6yjkpyoal7a3bzsg0ugeiuyvs.png"></p><a name="habracut"></a><br><h2 id="vvedenie">  Pendahuluan </h2><br><p>  Saya mengingatkan Anda bahwa seri artikel ini dirancang untuk pengembang pemula dan bagi mereka yang baru saja mulai bekerja dengan suara.  Jika Anda melakukan transformasi Fourier cepat dalam pikiran Anda, maka Anda mungkin akan bosan. </p><br><p>  Berikut adalah Peta Jalan kami untuk hari ini: </p><br><ol><li>  Pertimbangkan diskritisasi itu. </li><li>  Cari tahu data apa yang bisa kita dapatkan dari Audio Clip Unity </li><li>  Pahami bagaimana kami dapat bekerja dengan data ini. </li><li>  Cari tahu apa yang bisa kita hasilkan dari data ini. </li><li>  Pelajari cara membuat game dari semua ini (baik, atau yang serupa dengan game) </li></ol><br><p>  Jadi ayo pergi! </p><br><h2 id="diskretizaciya-analogovogo-singala">  Diskretisasi Analog Sinhala </h2><br><p>  Seperti yang diketahui banyak orang, untuk menggunakan sinyal dalam sistem digital, kita perlu mengubahnya.  Salah satu langkah konversi adalah pengambilan sampel sinyal, di mana sinyal analog dibagi menjadi beberapa bagian (laporan sementara), setelah itu setiap laporan diberikan nilai amplitudo yang ada pada saat yang dipilih. <br><img src="https://habrastorage.org/webt/k-/r4/_0/k-r4_0pvvu8sxhcdxaybjnpsn0q.png"></p><br><p>  Huruf T menunjukkan periode pengambilan sampel.  Semakin pendek periode, semakin akurat konversi sinyal.  Tetapi paling sering mereka berbicara tentang kebalikannya: Tingkat sampel (logis bahwa ini adalah F = 1 / T).  8.000 Hz cukup untuk panggilan telepon, dan, misalnya, salah satu opsi untuk format DVD-Audio memerlukan frekuensi sampling 192.000 Hz.  Standar dalam perekaman digital (dalam editor game, editor musik) adalah 44 100 Hz - ini adalah frekuensi CD Audio. </p><br><p>  Nilai numerik dari amplitudo disimpan dalam apa yang disebut sampel dan bersama mereka kita akan bekerja.  Nilai sampel mengambang dan dapat dari -1 hingga 1. Sederhana, terlihat seperti ini. </p><br><p><img src="https://habrastorage.org/webt/sj/rg/r7/sjrgr7njjj7iwmyi6nebdtpfxze.png"></p><br><h2 id="otrisovka-zvukovoy-volny-statichno">  Render gelombang suara (statis) </h2><br><h3 id="bazovaya-informaciya">  Informasi dasar </h3><br><p>  Bentuk gelombang (atau bentuk audio, dan pada umumnya orang - "ikan") adalah representasi visual dari sinyal suara dari waktu ke waktu.  Bentuk gelombang dapat menunjukkan kepada kita pada titik apa dalam suara fase aktif terjadi, dan di mana redaman terjadi.  Seringkali bentuk gelombang disajikan untuk setiap saluran secara terpisah, misalnya, seperti ini: </p><br><p><img src="https://habrastorage.org/webt/hj/xr/vm/hjxrvm-bdrgt-myieappnmqxgb0.png"></p><br><p>  Bayangkan kita sudah memiliki AudioSource dan skrip tempat kita bekerja.  Mari kita lihat apa yang bisa diberikan Unity kepada kita. </p><br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//  AudioSource    AudioSource myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); //     .     44100. int freq = myAudio.clip.frequency;</span></span></code> </pre> <br><h3 id="vybor-kol-va-otchetov">  Pilih Jumlah Laporan </h3><br><p>  Sebelum kita melangkah lebih jauh, kita perlu berbicara sedikit tentang kedalaman render suara kita.  Dengan frekuensi pengambilan sampel 44100 Hz per detik, kami dapat memproses 44100 laporan.  Katakanlah kita perlu membuat trek berdurasi 10 detik.  Kami akan menggambar setiap laporan dengan garis dalam lebar piksel.  Ternyata bentuk gelombang kami akan mencapai 441.000 piksel.  Anda mendapatkan gelombang suara yang sangat panjang, memanjang dan sedikit dipahami.  Tetapi, di dalamnya Anda dapat melihat setiap laporan spesifik!  Dan Anda akan sangat memuat sistem, tidak peduli bagaimana Anda menggambarnya. </p><br><p><img src="https://habrastorage.org/webt/qr/yf/j6/qryfj6qyv0v5mrbzjfqz6qcws_y.png"></p><br><p>  Jika Anda tidak membuat perangkat lunak audio profesional, Anda tidak perlu keakuratan tersebut.  Untuk gambar audio umum, kami dapat memecah semua sampel menjadi periode yang lebih besar dan mengambil, misalnya, rata-rata masing-masing 100 sampel.  Maka gelombang kita akan memiliki bentuk yang sangat berbeda: </p><br><p><img src="https://habrastorage.org/webt/2v/yk/kz/2vykkzw2wtewvjzcwsfsz_h1zvq.png"></p><br><p>  Tentu saja, ini tidak sepenuhnya akurat, karena Anda dapat melewati puncak volume yang mungkin Anda butuhkan, jadi Anda dapat mencoba bukan nilai rata-rata, tetapi maksimum dari segmen ini.  Ini akan memberikan gambaran yang sedikit berbeda, tetapi puncak Anda tidak akan hilang. </p><br><h3 id="podgotovka-k-polucheniyu-audiodannyh">  Bersiap menerima audio </h3><br><p>  Mari kita tentukan keakuratan sampel kami sebagai kualitas, dan jumlah laporan akhir sebagai sampleCount. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; sampleCount = freq / quality;</code> </pre> <br><p>  Contoh penghitungan semua angka akan di bawah. </p><br><p>  Selanjutnya, kita perlu mengambil sampel sendiri.  Ini dapat dilakukan dari klip audio menggunakan metode <strong>GetData</strong> . </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offsetSamples</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br><p>  Metode ini mengambil array ke mana ia menulis sampel.  offsetSamples - parameter yang bertanggung jawab untuk titik awal membaca array data.  Jika Anda membaca array dari awal, maka harus ada nol. </p><br><p>  Untuk merekam sampel, kita perlu menyiapkan array untuknya.  Misalnya, seperti ini: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-comment"><span class="hljs-comment">//      samples = new float[myAudio.clip.samples * myAudio.clip.channels];</span></span></code> </pre> <br><p>  Mengapa kami mengalikan panjangnya dengan jumlah saluran?  Sekarang saya akan memberitahu ... </p><br><h3 id="informaciya-ob-audiokanalah-v-unity">  Informasi Saluran Audio Unity </h3><br><p>  Banyak orang tahu bahwa dalam suara kita biasanya menggunakan dua saluran: kiri dan kanan.  Seseorang tahu bahwa ada sistem 2.1, serta 5.1, 7.1 di mana sumber suara mengelilingi dari semua sisi.  Tema saluran dijelaskan dengan baik <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di wiki</a> .  Bagaimana cara kerjanya di Unity? </p><br><p>  Saat mengunduh file, saat membuka klip, Anda dapat menemukan gambar berikut: </p><br><p><img src="https://habrastorage.org/webt/us/hy/tu/ushytu2q3jhyyl8sbx9tclnaf9i.png"></p><br><p>  Hanya ditampilkan di sini bahwa kami memiliki dua saluran, dan Anda bahkan dapat melihat bahwa mereka berbeda satu sama lain.  Unity merekam sampel saluran-saluran ini satu demi satu.  Ternyata gambar ini: <br><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-mo" id="MJXp-Span-2" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-3"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4" style="margin-right: 0.05em;">L</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-5" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-6" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-7"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-8" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-9" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-10" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-11"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12" style="margin-right: 0.05em;">L</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-13" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-14" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-15"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-16" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-17" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-18" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-19"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-20" style="margin-right: 0.05em;">L</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-21" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-22" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-23"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-24" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-25" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-26" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-27"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-28" style="margin-right: 0.05em;">L</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-29" style="vertical-align: -0.4em;">4</span></span><span class="MJXp-mo" id="MJXp-Span-30" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-31"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-32" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-33" style="vertical-align: -0.4em;">4</span></span><span class="MJXp-mo" id="MJXp-Span-34" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-35"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-36" style="margin-right: 0.05em;">L</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-37" style="vertical-align: -0.4em;">5</span></span><span class="MJXp-mo" id="MJXp-Span-38" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-39"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-40" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-41" style="vertical-align: -0.4em;">5</span></span><span class="MJXp-mo" id="MJXp-Span-42" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-43"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44" style="margin-right: 0.05em;">L</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-45" style="vertical-align: -0.4em;">6</span></span><span class="MJXp-mo" id="MJXp-Span-46" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-47"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-48" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-49" style="vertical-align: -0.4em;">6</span></span><span class="MJXp-mo" id="MJXp-Span-50" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-51"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-52" style="margin-right: 0.05em;">L</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-53" style="vertical-align: -0.4em;">7</span></span><span class="MJXp-mo" id="MJXp-Span-54" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-55"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-56" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-57" style="vertical-align: -0.4em;">7</span></span><span class="MJXp-mo" id="MJXp-Span-58" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-59"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60" style="margin-right: 0.05em;">L</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-61" style="vertical-align: -0.4em;">8</span></span><span class="MJXp-mo" id="MJXp-Span-62" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-63"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-64" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-65" style="vertical-align: -0.4em;">8</span></span><span class="MJXp-mo" id="MJXp-Span-66" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mo" id="MJXp-Span-67" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mo" id="MJXp-Span-68" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mo" id="MJXp-Span-69" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-1"> [L_1, R_1, L_2, R_2, L_3, R_3, L_4, R_4, L_5, R_5, L_6, R_6, L_7, R_7, L_8, R_8 ...] </script></p><br><p>  Itu sebabnya kita membutuhkan ruang dua kali lebih banyak dalam array daripada hanya untuk jumlah sampel. </p><br><p>  Jika Anda memilih opsi klip Force To Mono, saluran akan menjadi satu dan semua suara akan berada di tengah.  Pratinjau wave Anda akan segera berubah. </p><br><p><img src="https://habrastorage.org/webt/fx/pk/-f/fxpk-fvqtdsvhfvfyyvl1mjrjla.png"></p><br><p><img src="https://habrastorage.org/webt/po/62/s8/po62s86xpcbainozvupbpekwdig.png"></p><br><h3 id="poluchenie-audiodannyh">  Terima data audio </h3><br><p>  Inilah yang kami dapatkan: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource myAudio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> freq = myAudio.clip.frequency; sampleCount = freq / quality; samples = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[myAudio.clip.samples * myAudio.clip.channels]; myAudio.clip.GetData(samples,<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  ,    .       waveFormArray = new float[(samples.Length / sampleCount)]; //             for (int i = 0; i &lt; waveFormArray.Length; i++) { waveFormArray[i] = 0; for (int j = 0; j &lt; sampleCount; j++) { //Abs     ""    . .  waveFormArray[i] += Mathf.Abs(samples[(i * sampleCount) + j]); } waveFormArray[i] /= sampleCount; } }</span></span></code> </pre> <br><p>  Total, jika trek berjalan 10 detik dan ini adalah dua saluran, maka kita mendapatkan yang berikut: </p><br><ul><li>  Jumlah sampel dalam klip (myAudio.clip.sample) = 44100 * 10 = 441000 </li><li>  Susunan sampel untuk dua saluran panjang (sampel. Panjang) = 441000 * 2 = 882000 </li><li>  Jumlah laporan (sampleCount) = 44100/100 = 441 </li><li>  Panjang array akhir = sampel. Panjang / sampleCount = 2000 </li></ul><br><p>  Sebagai hasilnya, kami akan bekerja dengan 2000 poin, yang cukup bagi kami untuk menggambar gelombang.  Sekarang Anda perlu memasukkan imajinasi dan berpikir tentang bagaimana kami dapat menggunakan data ini. </p><br><h3 id="otrisovka-audioinformacii">  Rendering Informasi Audio </h3><br><h4 id="sozdanie-prostoy-audiodorozhki-s-pomoschyu-debug-sredstv">  Buat trek audio sederhana menggunakan alat Debug </h4><br><p>  Seperti yang diketahui banyak orang, Unity memiliki cara yang nyaman untuk menampilkan semua jenis informasi Debug.  Pengembang cerdas berdasarkan pada alat-alat ini dapat membuat, misalnya, ekstensi yang sangat kuat untuk editor.  Kasus kami menunjukkan penggunaan metode Debug yang sangat tidak lazim. </p><br><p>  Untuk menggambar, kita perlu garis.  Kita dapat melakukannya dengan bantuan vektor yang akan dibuat dari nilai-nilai array kita.  Harap dicatat, untuk membuat bentuk audio cermin yang indah, kita perlu "merekatkan" dua bagian dari visualisasi kita. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; waveFormArray.Length - <span class="hljs-number"><span class="hljs-number">1</span></span>; i++) { <span class="hljs-comment"><span class="hljs-comment">//      Vector3 upLine = new Vector3(i * .01f, waveFormArray[i] * 10, 0); //      Vector3 downLine = new Vector3(i * .01f, -waveFormArray[i] * 10, 0); }</span></span></code> </pre> <br><p>  Selanjutnya, cukup gunakan Debug.DrawLine untuk menggambar vektor kita.  Warna apa pun dapat memilih.  Semua metode ini harus dipanggil dalam Pembaruan, jadi kami akan memperbarui informasi setiap frame. </p><br><pre> <code class="cs hljs">Debug.DrawLine(upLine, downLine, Color.green);</code> </pre> <br><p>  Jika mau, Anda dapat menambahkan "slider" yang akan menunjukkan posisi trek saat ini sedang diputar.  Informasi ini dapat diperoleh dari bidang "AudioSource.timeSamples". </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> debugLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ""  .       int currentPosition = (myAudio.timeSamples / quality) * 2; Vector3 drawVector = new Vector3(currentPosition * 0.01f, 0, 0); Debug.DrawLine(drawVector - Vector3.up * debugLineWidth, drawVector + Vector3.up * debugLineWidth, Color.white);</span></span></code> </pre> <br><p>  Total, ini skrip kami: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WaveFormDebug</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> freq; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> debugLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource myAudio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); <span class="hljs-comment"><span class="hljs-comment">//  freq = myAudio.clip.frequency; sampleCount = freq / quality; //  samples = new float[myAudio.clip.samples * myAudio.clip.channels]; myAudio.clip.GetData(samples, 0); //       waveFormArray = new float[(samples.Length / sampleCount)]; for (int i = 0; i &lt; waveFormArray.Length; i++) { waveFormArray[i] = 0; for (int j = 0; j &lt; sampleCount; j++) { waveFormArray[i] += Mathf.Abs(samples[(i * sampleCount) + j]); } waveFormArray[i] /= sampleCount; } } private void Update() { for (int i = 0; i &lt; waveFormArray.Length - 1; i++) { //      Vector3 upLine = new Vector3(i * 0.01f, waveFormArray[i] * 10, 0); //      Vector3 downLine = new Vector3(i * 0.01f, -waveFormArray[i] * 10, 0); // Debug  Debug.DrawLine(upLine, downLine, Color.green); } // ""  .       int currentPosition = (myAudio.timeSamples / quality) * 2; Vector3 drawVector = new Vector3(currentPosition * 0.01f, 0, 0); Debug.DrawLine(drawVector - Vector3.up * debugLineWidth, drawVector + Vector3.up * debugLineWidth, Color.white); } }</span></span></code> </pre> <br><p>  Dan inilah hasilnya: </p><br><p><img src="https://habrastorage.org/webt/gq/ij/fd/gqijfdc9d3b6t1nemd-wqsxqn70.png"></p><br><h4 id="sozdanie-plavnogo-zvukovogo-landshafta-s-pomoschyu-polygoncollider2d">  Buat soundscape yang halus dengan PolygonCollider2D </h4><br><p>  Sebelum melanjutkan ke bagian ini, saya ingin mencatat yang berikut: tentu saja, mengemudi di sepanjang trek yang dihasilkan dari musik itu menyenangkan, tetapi dari sudut pandang gameplay itu praktis tidak berguna.  Dan inilah alasannya: </p><br><ol><li>  Agar lintasan dapat dilewati, kita perlu memuluskan data kita.  Semua puncak menghilang dan Anda praktis berhenti "merasakan musik Anda" </li><li>  Biasanya, trek musik sangat dikompresi dan mewakili batu bata suara, yang kurang cocok untuk game 2D. </li><li>  Masalah kecepatan transportasi kami yang belum terselesaikan, yang harus sesuai untuk kecepatan lintasan.  Saya ingin mempertimbangkan masalah ini di artikel selanjutnya. </li></ol><br><p>  Oleh karena itu, sebagai percobaan, jenis generasi ini cukup lucu, tetapi sulit untuk membuat fitur gameplay yang nyata berdasarkan itu.  Bagaimanapun, kami melanjutkan. </p><br><p>  Jadi, kita perlu membuat PolygonCollider2D menggunakan data kami.  Ini mudah dilakukan.  PolygonCollider2D memiliki bidang poin publik yang menerima Vector2 [].  Pertama, kita perlu mentransfer poin kita ke vektor dari tipe yang diinginkan.  Mari kita membuat fungsi untuk menerjemahkan array sampel kami ke dalam array vektor: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Vector2[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreatePath</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] src</span></span></span><span class="hljs-function">)</span></span> { Vector2[] result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2[src.Length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; size; i++) { result[i] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(i * <span class="hljs-number"><span class="hljs-number">0.01f</span></span>, Mathf.Abs(src[i] * lineScale)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><p>  Setelah itu, cukup serahkan array vektor yang dihasilkan ke collider: </p><br><pre> <code class="cs hljs">path = CreatePath(waveFormArray); poly.points = path;</code> </pre> <br><p>  Kami melihat hasilnya.  Ini adalah awal dari lagu kami ... hmm ... itu tidak terlihat lumayan (jangan berpikir tentang visualisasi, komentar akan datang nanti). </p><br><p><img src="https://habrastorage.org/webt/e-/3e/ry/e-3eryzi385zy3f4r-hvnsi0iwc.png"></p><br><p>  Kami memiliki bentuk audio yang terlalu tajam, sehingga trek keluar aneh.  Perlu menghaluskannya.  Di sini kita menggunakan algoritma rata-rata bergerak.  Anda dapat membaca lebih lanjut tentang itu di Habr, di artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Algoritma Rata-Rata Bergerak (Simple Moving Average)</a> . </p><br><p>  Di Unity, algoritma ini diterapkan sebagai berikut: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function">[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MovingAverage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> frameSize, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] avgPoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[data.Length - frameSize + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> counter = <span class="hljs-number"><span class="hljs-number">0</span></span>; counter &lt;= data.Length - frameSize; counter++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> innerLoopCounter = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = counter; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (innerLoopCounter &lt; frameSize) { sum = sum + data[index]; innerLoopCounter += <span class="hljs-number"><span class="hljs-number">1</span></span>; index += <span class="hljs-number"><span class="hljs-number">1</span></span>; } avgPoints[counter] = sum / frameSize; sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> avgPoints; }</code> </pre> <br><p>  Kami memodifikasi pembuatan jalur kami: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] avgArray = MovingAverage(frameSize, waveFormArray); path = CreatePath(avgArray); poly.points = path;</code> </pre> <br><p>  Memeriksa ... </p><br><p><img src="https://habrastorage.org/webt/m5/rk/sb/m5rksbekvjfd45482gbgprvnmn0.png"></p><br><p>  Sekarang lagu kami terlihat cukup normal.  Saya menggunakan lebar jendela 10. Anda dapat memodifikasi parameter ini untuk memilih smoothing yang Anda butuhkan. </p><br><p>  Berikut ini skrip lengkap untuk bagian ini: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WaveFormTest</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> frameSize = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size = <span class="hljs-number"><span class="hljs-number">2048</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> PolygonCollider2D poly; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lineScale = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Vector2[] path; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource myAudio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> freq = myAudio.clip.frequency; sampleCount = freq / quality; samples = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[myAudio.clip.samples * myAudio.clip.channels]; myAudio.clip.GetData(samples, <span class="hljs-number"><span class="hljs-number">0</span></span>); waveFormArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[(samples.Length / sampleCount)]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; waveFormArray.Length; i++) { waveFormArray[i] = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; sampleCount; j++) { waveFormArray[i] += Mathf.Abs(samples[(i * sampleCount) + j]); } waveFormArray[i] /= sampleCount * <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//  ,    frameSize float[] avgArray = MovingAverage(frameSize, waveFormArray); path = CreatePath(avgArray); poly.points = path; } private Vector2[] CreatePath(float[] src) { Vector2[] result = new Vector2[src.Length]; for (int i = 0; i &lt; size; i++) { result[i] = new Vector2(i * 0.01f, Mathf.Abs(src[i] * lineScale)); } return result; } private float[] MovingAverage(int frameSize, float[] data) { float sum = 0; float[] avgPoints = new float[data.Length - frameSize + 1]; for (int counter = 0; counter &lt;= data.Length - frameSize; counter++) { int innerLoopCounter = 0; int index = counter; while (innerLoopCounter &lt; frameSize) { sum = sum + data[index]; innerLoopCounter += 1; index += 1; } avgPoints[counter] = sum / frameSize; sum = 0; } return avgPoints; } }</span></span></code> </pre> <br><p>  Seperti yang saya katakan di awal bagian, dengan smoothing ini, kami berhenti merasakan trek, di samping itu, kecepatan mesin tidak terikat dengan kecepatan musik (BPM).  Kami akan menganalisis masalah ini di bagian selanjutnya dari rangkaian artikel ini.  Selain itu, di sana kami akan menyentuh pada topik spesial.  efek di bawah irama.  Omong-omong, saya mengambil mesin tik dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">aset gratis</a> ini. </p><br><p>  Mungkin banyak dari Anda, melihat screenshot, bertanya-tanya bagaimana saya menggambar trek itu sendiri?  Bagaimanapun, colliders tidak terlihat. </p><br><p>  Saya menggunakan kebijaksanaan Internet dan menemukan cara di mana Anda dapat mengubah collider poligon menjadi mesh yang dapat Anda gunakan untuk bahan apa pun, dan pembuat baris akan membuat garis besar yang bergaya.  Metode ini dijelaskan secara rinci di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> .  Triangulator Anda dapat mengambil <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Unity Community</a> . </p><br><h2 id="zavershenie">  Penyelesaian </h2><br><p>  Apa yang kami pelajari dalam artikel ini adalah sketsa dasar untuk permainan musik.  Ya, dalam bentuk ini, sejauh ini, sedikit jelek, tetapi Anda dapat dengan aman mengatakan "Guys, saya membuat mesin berjalan di sepanjang trek audio!".  Untuk menjadikan ini permainan nyata, Anda harus berusaha keras.  Berikut adalah daftar yang dapat kita lakukan di sini: </p><br><ol><li>  Ikat kecepatan mesin ke trek BPM.  Pemain hanya bisa mengendalikan kemiringan mobil, tetapi tidak kecepatan.  Maka musik akan terasa jauh lebih kuat selama kursus. </li><li>  Buat sedikit detektor dan tambahkan spesial.  efek yang akan bekerja di bawah irama.  Selain itu, Anda dapat menambahkan animasi ke tubuh mobil, yang akan memantul pada ketukan.  Itu semua tergantung pada imajinasi Anda. </li><li>  Alih-alih bergerak rata-rata, Anda perlu lebih kompeten memproses trek dan mendapatkan berbagai data sehingga puncak tidak hilang, tetapi mudah untuk membangun jejak. </li><li>  Yah, dan, tentu saja, Anda perlu membuat permainannya menarik.  Anda dapat menempatkan sedikit koin di setiap pukulan, menambahkan zona bahaya, dll. </li></ol><br><p>  Kami akan mempelajari semua ini dan banyak lagi di bagian-bagian yang tersisa dari seri artikel ini.  Terima kasih sudah membaca! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id432134/">https://habr.com/ru/post/id432134/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id432120/index.html">Lenovo akan membayar ganti rugi pemilik laptop $ 8,3 juta untuk menginstal malware Superfish</a></li>
<li><a href="../id432122/index.html">Xcode dan Advanced Debugging di LLDB: Bagian 2</a></li>
<li><a href="../id432128/index.html">Crutches, Narnia, Procrustes Ninja: Three Timlid Pain in a Startup</a></li>
<li><a href="../id432130/index.html">Mitaps musim gugur pada pengembangan ponsel di kantor Tutu.ru</a></li>
<li><a href="../id432132/index.html">William Shakespeare: kesulitan menerjemahkan soneta ke dalam bahasa Rusia</a></li>
<li><a href="../id432136/index.html">Dinginkan CPU di pusat data - pencetakan laser 3D akan membantu</a></li>
<li><a href="../id432138/index.html">Mari kita bicara tentang metrik sebagai cara untuk mengevaluasi pekerjaan seorang programmer</a></li>
<li><a href="../id432142/index.html">Beehive Monitoring dan Open Project</a></li>
<li><a href="../id432144/index.html">Bagaimana kami terintegrasi untuk toko SAP di Eropa dengan meja kas di Rusia melalui 1C</a></li>
<li><a href="../id432146/index.html">Zimbra Collaboration Suite sebagai pengganti Microsoft Exchange yang layak</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>