<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏆 🍙 🆕 Optimisations utilisées en Python: liste et tuple 👨‍⚖️ 👇🏿 🚧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En Python, il existe deux types similaires - liste (liste) et tuple (tuple). La différence la plus célèbre entre les deux est que les tuples sont immu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Optimisations utilisées en Python: liste et tuple</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417783/">  En Python, il existe deux types similaires - liste (liste) et tuple (tuple).  La différence la plus célèbre entre les deux est que les tuples sont immuables. <br><br>  Vous ne pouvez pas modifier les objets dans le tuple: <br><br><pre><code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>a = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>) &gt;&gt;&gt; a[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">10</span></span> Traceback (most recent call last): File <span class="hljs-string"><span class="hljs-string">"&lt;stdin&gt;"</span></span>, line <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;module&gt; TypeError: <span class="hljs-string"><span class="hljs-string">'tuple'</span></span> object does <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> support item assignment</code> </pre> <br>  Mais vous pouvez modifier des objets mutables à l'intérieur d'un tuple: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>b = (<span class="hljs-number"><span class="hljs-number">1</span></span>,[<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>],<span class="hljs-number"><span class="hljs-number">3</span></span>) &gt;&gt;&gt; b[<span class="hljs-number"><span class="hljs-number">1</span></span>] [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>] &gt;&gt;&gt; b[<span class="hljs-number"><span class="hljs-number">1</span></span>].append(<span class="hljs-number"><span class="hljs-number">4</span></span>) &gt;&gt;&gt; b (<span class="hljs-number"><span class="hljs-number">1</span></span>, [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>], <span class="hljs-number"><span class="hljs-number">3</span></span>)</code> </pre><a name="habracut"></a><br>  Dans CPython (l'interpréteur standard), la liste et le tuple sont implémentés comme une feuille de pointeurs (liens) vers des objets Python, c'est-à-dire  physiquement, ils ne stockent pas d'objets côte à côte.  Lorsque vous supprimez un objet de la liste, la référence à cet objet est supprimée.  Si quelqu'un d'autre fait référence à l'objet, il continuera à être en mémoire. <br><br><h4>  Tuples </h4><br>  Malgré le fait que les tuples sont beaucoup moins courants dans le code et moins populaires, il s'agit d'un type très fondamental que Python utilise constamment à des fins internes. <br><br>  Vous ne le remarquerez peut-être pas, mais vous utilisez des tuples lorsque: <br><br><ul><li>  travailler avec des arguments ou des paramètres (ils sont stockés sous forme de tuples) </li><li>  retourner deux ou plusieurs variables d'une fonction </li><li>  itérer les clés de valeur dans un dictionnaire </li><li>  utiliser la mise en forme des chaînes </li></ul><br>  En règle générale, le script le plus simple utilise des milliers de tuples: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> gc &gt;&gt;&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">type_stats</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type_obj)</span></span></span><span class="hljs-function">:</span></span> ... count = <span class="hljs-number"><span class="hljs-number">0</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> obj <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> gc.get_objects(): ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> type(obj) == type_obj: ... count += <span class="hljs-number"><span class="hljs-number">1</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count ... &gt;&gt;&gt; type_stats(tuple) <span class="hljs-number"><span class="hljs-number">3136</span></span> &gt;&gt;&gt; type_stats(list) <span class="hljs-number"><span class="hljs-number">659</span></span> &gt;&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas &gt;&gt;&gt; type_stats(tuple) <span class="hljs-number"><span class="hljs-number">6953</span></span> &gt;&gt;&gt; type_stats(list) <span class="hljs-number"><span class="hljs-number">2455</span></span></code> </pre><br><h4>  Listes vides vs tuples vides </h4><br>  Un tuple vide fonctionne comme un singleton, c'est-à-dire  il n'y a toujours qu'un seul tuple vide dans la mémoire d'un script Python en cours d'exécution.  Tous les tuples vides se réfèrent simplement au même objet, cela est possible car les tuples sont immuables.  Cette approche économise beaucoup de mémoire et accélère le processus de travail avec des tuples vides. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>a = () &gt;&gt;&gt; b = () &gt;&gt;&gt; a <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> b <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> &gt;&gt;&gt; id(a) <span class="hljs-number"><span class="hljs-number">4409020488</span></span> &gt;&gt;&gt; id(b) <span class="hljs-number"><span class="hljs-number">4409020488</span></span> &gt;&gt;&gt; <span class="hljs-comment"><span class="hljs-comment">#  CPython,  id    .</span></span></code> </pre><br>  Mais cela ne fonctionne pas avec les listes, car elles peuvent être modifiées: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>a = [] &gt;&gt;&gt; b = [] &gt;&gt;&gt; a <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> b <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> &gt;&gt;&gt; id(a) <span class="hljs-number"><span class="hljs-number">4465566920</span></span> &gt;&gt;&gt; id(b) <span class="hljs-number"><span class="hljs-number">4465370632</span></span></code> </pre><br><h4>  Optimisation de l'allocation de mémoire pour les tuples </h4><br>  Afin de réduire la fragmentation de la mémoire et d'accélérer la création de tuples, Python réutilise les anciens tuples qui ont été supprimés.  Si un tuple se compose de moins de 20 éléments et n'est plus utilisé, alors au lieu de le supprimer, Python le place dans une liste spéciale qui stocke des tuples libres de réutilisation. <br><br>  Cette liste est divisée en 20 groupes, où chaque groupe est une liste de tuples de taille n, où n est compris entre 0 et 20. Chaque groupe peut stocker jusqu'à 2 000 tuples gratuits.  Le premier groupe stocke un seul élément et est une liste d'un tuple vide. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>a = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>) &gt;&gt;&gt; id(a) <span class="hljs-number"><span class="hljs-number">4427578104</span></span> &gt;&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">del</span></span> a &gt;&gt;&gt; b = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>) &gt;&gt;&gt; id(b) <span class="hljs-number"><span class="hljs-number">4427578104</span></span></code> </pre><br>  Dans l'exemple ci-dessus, nous pouvons voir que a et b ont la même adresse en mémoire.  Cela est dû au fait que nous avons instantanément pris un tuple gratuit de la même taille. <br><br><h4>  Optimisation de l'allocation de mémoire pour les listes </h4><br>  Les listes étant susceptibles de changer, la même optimisation que dans le cas des tuples ne peut plus être augmentée.  Malgré cela, les listes utilisent des optimisations similaires visant des listes vides.  Si la liste vide est supprimée, elle peut également être réutilisée à l'avenir. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>a = [] &gt;&gt;&gt; id(a) <span class="hljs-number"><span class="hljs-number">4465566792</span></span> &gt;&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">del</span></span> a &gt;&gt;&gt; b = [] &gt;&gt;&gt; id(b) <span class="hljs-number"><span class="hljs-number">4465566792</span></span></code> </pre><br><h4>  Redimensionner la liste </h4><br>  Pour éviter les frais généraux liés au redimensionnement constant des listes, Python ne le redimensionne pas chaque fois qu'il est requis.  Au lieu de cela, chaque liste possède un ensemble de cellules supplémentaires qui sont masquées pour l'utilisateur, mais peuvent ensuite être utilisées pour de nouveaux éléments.  Dès la fin des cellules cachées, Python ajoute de l'espace supplémentaire pour de nouveaux éléments.  Et il le fait avec une bonne marge, le nombre de cellules cachées est sélectionné en fonction de la taille actuelle de la liste - plus elle est grande, plus il y a d'emplacements cachés supplémentaires pour les nouveaux éléments. <br><br>  Cette optimisation est particulièrement utile lorsque vous essayez d'ajouter de nombreux éléments dans une boucle. <br><br>  Le modèle de croissance de la taille de la liste ressemble à ceci: 0, 4, 8, 16, 25, 35, 46, 58, 72, 88, ... <br><br>  Par exemple, si vous souhaitez ajouter un nouvel élément à une liste de 8 éléments, il n'y aura pas de cellules libres et Python étendra immédiatement sa taille à 16 cellules, dont 9 d'entre elles seront occupées et visibles par l'utilisateur. <br><br>  Formule de dimensionnement Python: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_new_size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n_items)</span></span></span><span class="hljs-function">:</span></span> ... new_size = n_items + (n_items // <span class="hljs-number"><span class="hljs-number">2</span></span> ** <span class="hljs-number"><span class="hljs-number">3</span></span>) ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n_items &lt; <span class="hljs-number"><span class="hljs-number">9</span></span>: ... new_size += <span class="hljs-number"><span class="hljs-number">3</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: ... new_size += <span class="hljs-number"><span class="hljs-number">6</span></span> ... ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> new_size ... &gt;&gt;&gt; get_new_size(<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-number"><span class="hljs-number">16</span></span></code> </pre><br><h4>  La vitesse </h4><br>  Si nous comparons ces deux types de vitesse, puis en moyenne dans un hôpital, les tuples sont légèrement plus rapides que les listes.  Raymond Hettinger a une excellente explication de la différence de vitesse sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">stackoverflow</a> . <br><br>  PS: je suis l'auteur de cet article, vous pouvez poser toutes vos questions. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr417783/">https://habr.com/ru/post/fr417783/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr417773/index.html">Installateur de composants OpenPnP fait maison</a></li>
<li><a href="../fr417775/index.html">Mécanisme de commission Bitcoin et pourquoi être ami avec les mineurs</a></li>
<li><a href="../fr417777/index.html">Week-end de lecture: 25 documents pour les amateurs de vinyle débutants</a></li>
<li><a href="../fr417779/index.html">Utilisation d'Unity3D dans une application iOS / Android native pour modéliser l'éclairage des espaces ouverts</a></li>
<li><a href="../fr417781/index.html">La sonde de la NASA «touche» le Soleil - et ne fond pas</a></li>
<li><a href="../fr417785/index.html">Quel administrateur système ne rêve pas de son entreprise d'externalisation?</a></li>
<li><a href="../fr417787/index.html">Mon expérience professionnelle sur le rôle du coach agile en Europe, première partie</a></li>
<li><a href="../fr417789/index.html">Discussions sur les perspectives des télécoms</a></li>
<li><a href="../fr417791/index.html">Comment nous sommes allés à la New York Developer Week</a></li>
<li><a href="../fr417793/index.html">Oubliez les mégastructures des extraterrestres: de nouvelles observations expliquent le comportement de l'étoile Tabby seule poussière</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>