<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üå± üòπ üèí Interruptions externes dans le syst√®me x86. Partie 1. √âvolution du contr√¥leur d'interruption üôèüèª üë©üèΩ‚Äçüé® ‚ö±Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article concerne le processus de livraison d'interruption √† partir de p√©riph√©riques externes dans le syst√®me x86. Il essaie de r√©pondre √† des ques...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Interruptions externes dans le syst√®me x86. Partie 1. √âvolution du contr√¥leur d'interruption</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446312/">  Cet article concerne le processus de livraison d'interruption √† partir de p√©riph√©riques externes dans le syst√®me x86.  Il essaie de r√©pondre √† des questions telles que: <br><br><ul><li>  Qu'est-ce que la photo et √† quoi sert-elle? </li><li>  Qu'est-ce que l'APIC et √† quoi sert-il?  Quel est l'objectif du LAPIC et des E / S APIC? </li><li>  Quelles sont les diff√©rences entre APIC, xAPIC et x2APIC? </li><li>  Qu'est-ce que MSI?  Quelles sont les diff√©rences entre MSI et MSI-X? </li><li>  Quel est le r√¥le des tables $ PIR, MPtable et ACPI? </li></ul><br>  Si vous souhaitez conna√Ætre la r√©ponse √† l'une de ces questions, ou si vous souhaitez simplement conna√Ætre l'√©volution du contr√¥leur d'interruption, n'h√©sitez pas. <br><a name="habracut"></a><br><h3>  Pr√©sentation </h3><br>  Pour ceux qui ne savent pas ce qu'est une interruption, voici une citation de Wikipedia: <br><blockquote> Dans la programmation syst√®me, une interruption est un signal envoy√© au processeur par un mat√©riel ou un logiciel indiquant un √©v√©nement qui n√©cessite une attention imm√©diate.  Une interruption avertit le processeur d'une condition de priorit√© √©lev√©e n√©cessitant l'interruption du code actuel que le processeur ex√©cute.  Le processeur r√©pond en suspendant ses activit√©s en cours, en enregistrant son √©tat et en ex√©cutant une fonction appel√©e gestionnaire d'interruption (ou routine de service d'interruption, ISR) pour g√©rer l'√©v√©nement.  Cette interruption est temporaire et, une fois le gestionnaire d'interruptions termin√©, le processeur reprend ses activit√©s normales. <br><br>  Il existe deux types d'interruptions: les interruptions mat√©rielles et les interruptions logicielles (softirqs): <br><br><ul><li>  Les interruptions mat√©rielles sont utilis√©es par les p√©riph√©riques pour communiquer qu'elles n√©cessitent l'attention du syst√®me d'exploitation.  En interne, les interruptions mat√©rielles sont mises en ≈ìuvre √† l'aide de signaux d'alerte √©lectroniques qui sont envoy√©s au processeur √† partir d'un p√©riph√©rique externe, qui fait partie de l'ordinateur lui-m√™me, tel qu'un contr√¥leur de disque, ou d'un p√©riph√©rique externe.  Par exemple, appuyer sur une touche du clavier ou d√©placer la souris d√©clenche des interruptions mat√©rielles qui obligent le processeur √† lire la position de la frappe ou de la souris.  L'acte d'initier une interruption mat√©rielle est appel√© une demande d'interruption (IRQ). </li><li>  Une interruption logicielle est provoqu√©e soit par une condition exceptionnelle dans le processeur lui-m√™me, soit par une instruction sp√©ciale dans le jeu d'instructions qui provoque une interruption lors de son ex√©cution.  Le premier est souvent appel√© un pi√®ge ou une exception et est utilis√© pour les erreurs ou √©v√©nements survenant pendant l'ex√©cution du programme qui sont suffisamment exceptionnels pour ne pas √™tre trait√©s dans le programme lui-m√™me.  Par exemple, une exception de division par z√©ro sera lev√©e si l'unit√© logique arithm√©tique du processeur re√ßoit l'ordre de diviser un nombre par z√©ro car cette instruction est une erreur et impossible. </li></ul></blockquote><br>  Cet article concerne les interruptions mat√©rielles / externes IRQ. <br><br>  Quel est le but des interruptions?  Par exemple, nous voulons effectuer une action avec un paquet entrant de la carte r√©seau d√®s que le paquet arrive.  Si vous ne souhaitez pas demander en continu √† la carte r√©seau "Mon paquet est-il arriv√©?"  et perdre votre temps processeur, vous pouvez utiliser IRQ d'interruption de mat√©riel externe.  La ligne d'interruption d'un p√©riph√©rique doit √™tre connect√©e √† la ligne INTR du CPU, et apr√®s la r√©ception de chaque paquet, la carte r√©seau √©mettra un signal sur cette ligne.  Le CPU d√©tectera ce signal et saura que la carte r√©seau a des informations pour cela.  Ce n'est qu'apr√®s que le CPU lira le paquet entrant. <br><br>  Mais que devons-nous faire s'il y a beaucoup de p√©riph√©riques externes?  Il serait tr√®s improductif de cr√©er une tonne de broches INTR sur le processeur pour chacun d'eux. <br><br><img src="https://habrastorage.org/webt/vg/3q/3v/vg3q3v7kx8vjttp43xo99o8pccs.png"><br><br>  Pour r√©soudre ce probl√®me, une puce sp√©ciale a √©t√© invent√©e - un contr√¥leur d'interruption. <br><br><h3>  Pic </h3><br>  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">wiki</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">osdev</a> ) <br><br>  La premi√®re puce de contr√¥leur d'interruption √©tait l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Intel 8259 PIC</a> .  Il avait 8 lignes d'entr√©e (IRQ0-7) et 1 ligne de sortie (qui connecte le contr√¥leur d'interruption √† la ligne INTR de la CPU).  En cas d'interruption d'un des appareils sur ses lignes d'entr√©e, le 8259 √©met un signal sur la ligne INTR.  Apr√®s cela, le CPU saura que certains p√©riph√©riques n√©cessitent son attention imm√©diate, et le processeur demandera au PIC laquelle des 8 lignes d'entr√©e (IRQx) √©tait la source de cette interruption.  Il y a des frais g√©n√©raux √† ce sondage, mais maintenant nous avons 8 lignes d'interruption au lieu de 1. <br><br><img src="https://habrastorage.org/webt/le/yf/6e/leyf6enogyzp6flpijo2d0x1w9g.png"><br><br>  Bient√¥t, 8 lignes ne suffisent plus.  Pour augmenter le nombre total de lignes d'interruption, deux contr√¥leurs 8259 (ma√Ætre et esclave) ont √©t√© connect√©s en cascade (Dual PIC). <br><br>  Les IRQ de 0 √† 7 sont trait√©s avec le premier Intel 8259 PIC (ma√Ætre) et les IRQ de 8 √† 15 sont trait√©s avec le second Intel 8259 PIC (ma√Ætre).  Seul le ma√Ætre est connect√© √† la CPU et peut signaler les interruptions entrantes.  S'il y a une interruption sur les lignes 8-15, le deuxi√®me PIC (esclave) le signalera au ma√Ætre sur la ligne IRQ2, puis le ma√Ætre signalera le CPU.  Cette interruption en cascade supprime 1 des 16 lignes, mais effectue un total de 15 interruptions pour tous les p√©riph√©riques externes. <br><br><img src="https://habrastorage.org/webt/xj/yn/dh/xjyndhabujjwz0alrbx831zfzt8.png"><br><br>  Ce sch√©ma a √©t√© adopt√© par la communaut√©, et maintenant quand quelqu'un parle de PIC (Programm Interrupt Controller), il s'agit de ce syst√®me Dual PIC.  Apr√®s un certain temps, les contr√¥leurs 8259 ont √©t√© am√©lior√©s et ont obtenu un nouveau nom: 8259A.  Avec ces contr√¥leurs, le syst√®me DUAL PIC √©tait inclus dans le chipset.  √Ä une √©poque o√π le bus principal pour la connexion des p√©riph√©riques externes √©tait l'ISA, ce syst√®me √©tait suffisant.  Il √©tait seulement n√©cessaire que diff√©rents appareils ne se connectent pas √† la m√™me ligne IRQ, car les interruptions ISA ne sont pas partageables. <br><br>  Le mappage des interruptions de l'appareil √©tait √† peu pr√®s standard: <br><br>  Exemple (d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> ): <br>  IRQ 0 - minuterie syst√®me <br>  IRQ 1 - contr√¥leur de clavier <br>  IRQ 2 - cascade (interruption du contr√¥leur esclave) <br>  IRQ 3 - port s√©rie COM2 <br>  IRQ 4 - port s√©rie COM1 <br>  IRQ 5 - port parall√®le 2 et 3 ou carte son <br>  IRQ 6 - contr√¥leur de disquette <br>  IRQ 7 - port parall√®le 1 <br>  IRQ 8 - Minuterie RTC <br>  IRQ 9 - ACPI <br>  IRQ 10 - ouvert / SCSI / NIC <br>  IRQ 11 - ouvert / SCSI / NIC <br>  IRQ 12 - contr√¥leur de souris <br>  IRQ 13 - coprocesseur math√©matique <br>  IRQ 14 - Canal ATA 1 <br>  IRQ 15 - Canal ATA 2 <br><br>  La configuration et le travail avec les puces 8259 sont effectu√©s avec des ports d'E / S: <br><div class="scrollable-table"><table><tbody><tr><th>  Puce </th><th>  S'inscrire </th><th>  Port d'E / S </th></tr><tr><td>  Photo ma√Ætre </td><td>  Commande </td><td>  0x0020 </td></tr><tr><td>  Photo ma√Ætre </td><td>  Les donn√©es </td><td>  0x0021 </td></tr><tr><td>  Pic esclave </td><td>  Commande </td><td>  0x00A0 </td></tr><tr><td>  Pic esclave </td><td>  Les donn√©es </td><td>  0x00A1 </td></tr></tbody></table></div><br>  La documentation compl√®te du 8259A est disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Le bus PCI a ensuite remplac√© le bus ISA.  Malheureusement, le nombre de p√©riph√©riques a commenc√© √† d√©passer le nombre 15. De plus, au lieu du bus ISA statique, des p√©riph√©riques dans le bus PCI peuvent √™tre ajout√©s dynamiquement au syst√®me, ce qui pourrait potentiellement entra√Æner encore plus de probl√®mes.  Mais heureusement, les interruptions du bus PCI peuvent √™tre partag√©es, il est donc possible de connecter de nombreux p√©riph√©riques √† une ligne d'interruption IRQ.  Au final, pour r√©soudre le probl√®me du manque de lignes d'interruption, il a √©t√© d√©cid√© de regrouper les interruptions de tous les p√©riph√©riques PCI en lignes PIRQ (Programmable Interrupt Request). <br><br>  Par exemple, supposons que nous ayons 4 lignes d'interruption libres sur le contr√¥leur PIC et 20 p√©riph√©riques PCI.  Nous pouvons combiner les interruptions de 5 appareils en une seule ligne PIRQx et connecter ces lignes PIRQx au contr√¥leur PIC.  Dans ce cas, s'il y a une interruption sur l'une des lignes PIRQx, le processeur devra demander √† tous les p√©riph√©riques connect√©s √† cette ligne √† propos de l'interruption de savoir qui en est responsable, mais au final cela r√©sout le probl√®me.  Le p√©riph√©rique qui connecte les lignes d'interruption PCI aux lignes PIRQ est souvent appel√© routeur PIR. <br><br>  Avec cette m√©thode, il est n√©cessaire de s'assurer que les lignes PIRQx ne se connectent pas aux lignes avec des interruptions ISA (car cela produira des conflits) et que les lignes PIRQx sont √©quilibr√©es (plus il y a de p√©riph√©riques connect√©s √† une ligne, plus le CPU aura besoin de p√©riph√©riques pour interroger lorsqu'il doit v√©rifier quel appareil est responsable de l'interruption). <br><br><img src="https://habrastorage.org/webt/u_/jr/u9/u_jru9pemdeda2xvvbqihvgtp3y.png"><br><br>  <b>Remarque</b> : sur l'image, le mappage du p√©riph√©rique PCI -&gt; PIR est repr√©sent√© de mani√®re abstraite, car dans le cas r√©el, c'est un peu plus compliqu√©.  Dans le monde r√©el, chaque p√©riph√©rique PCI poss√®de 4 lignes d'interruption (INTA, INTB, INTC, INTD) et jusqu'√† 8 fonctions, o√π chaque fonction ne peut avoir qu'une seule de ces interruptions INTx.  La ligne INTx qui sera utilis√©e par chaque fonction est d√©termin√©e par la configuration du chipset. <br><br>  De par leur nature, les fonctions sont des blocs logiques s√©par√©s.  Par exemple, un p√©riph√©rique PCI peut avoir une fonction de contr√¥leur Smbus, une fonction de contr√¥leur SATA et une fonction de pont LPC.  Du point de vue d'un syst√®me d'exploitation (OS), chaque fonction est comme un appareil s√©par√© avec son propre espace de configuration (configuration PCI). <br><br>  Les informations sur un routage d'interruption du contr√¥leur PIC sont envoy√©es au syst√®me d'exploitation par le BIOS, √† l'aide de la table $ PIR et via les registres 3Ch (INT_LN Interrupt Line (R / W)) et 3Dh (INT_PN Interrupt Pin (RO)) de l'espace de configuration PCI pour chaque fonction. <br><br>  Une sp√©cification pour la table $ PIR √©tait r√©cemment <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur le site Web de Microsoft</a> , mais n'est actuellement pas disponible.  Il est possible de comprendre le contenu de la table √† partir de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sp√©cification BIOS PCI</a> [4.2.2.  Obtenir les options de routage d'interruption PCI] ou √† partir d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> (le dernier lien est en russe, mais vous pouvez essayer de google ¬´Sp√©cification de la table de routage PCI IRQ¬ª) <br><br><h3>  Apic </h3><br>  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">wiki</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">osdev</a> ) <br><br>  La derni√®re m√©thode a fonctionn√© jusqu'√† l'arriv√©e des syst√®mes multiprocesseurs.  Par nature, le PIC ne peut envoyer des interruptions qu'√† un seul processeur, et dans un syst√®me multiprocesseur, il est souhaitable de charger les CPU de mani√®re √©quilibr√©e.  La solution √† ce probl√®me a √©t√© la nouvelle interface APIC (PIC avanc√©). <br><br>  Un contr√¥leur sp√©cial appel√© LAPIC (Local APIC) a √©t√© ajout√© pour chaque processeur, ainsi que le contr√¥leur d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">E / S APIC</a> pour le routage des interruptions √† partir de p√©riph√©riques externes.  Tous ces contr√¥leurs sont combin√©s dans un bus commun avec le nom APIC (notez que les syst√®mes modernes utilisent un bus syst√®me standard au lieu d'un bus APIC s√©par√© pour cette t√¢che). <br><br>  Lorsqu'une interruption externe arrive sur l'entr√©e I / O APIC, le contr√¥leur envoie un message d'interruption au LAPIC de l'un des CPU du syst√®me.  De cette fa√ßon, le contr√¥leur d'E / S APIC permet d'√©quilibrer la charge d'interruption entre les processeurs. <br><br>  La premi√®re puce APIC √©tait la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">82489DX</a> , qui √©tait une puce distincte qui avait en elle-m√™me un LAPIC connect√© et un APIC d'E / S.  Pour un syst√®me √† deux processeurs, trois de ces puces √©taient n√©cessaires: deux pour LAPIC et une pour I / O APIC.  Plus tard, la fonctionnalit√© LAPIC a √©t√© directement incluse dans les processeurs et la partie E / S APIC a √©t√© s√©par√©e de la puce 82093AA. <br><br>  L'E / S APIC <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">82093AA</a> avait 24 entr√©es et l'architecture APIC pouvait prendre en charge jusqu'√† 16 CPU.  Les interruptions 0-15 ont √©t√© laiss√©es pour les anciennes interruptions ISA pour la compatibilit√© avec les anciens syst√®mes, et les interruptions 16-23 √©taient destin√©es √† tous les p√©riph√©riques PCI.  Avec cette d√©limitation, tous les conflits entre les interruptions ISA et PCI pourraient √™tre facilement √©vit√©s.  Avec l'augmentation du nombre de lignes d'interruption libres, il est √©galement devenu possible d'augmenter le nombre de lignes PIRQx. <br><br><img src="https://habrastorage.org/webt/mc/ra/hj/mcrahjn-owk9qrcmyiixcmhomcq.png"><br><br>  La programmation des E / S APIC et LAPIC s'effectue √† l'aide de MMIO.  Les registres LAPIC sont g√©n√©ralement plac√©s √† l'adresse 0xFEE00000 et les E / S APIC s'inscrivent √† l'adresse 0xFE0000, bien qu'il soit possible de les reconfigurer. <br><br>  Comme dans le cas PIC, des puces s√©par√©es au d√©but sont devenues une partie du chipset plus tard. <br><br>  L'architecture APIC a ensuite √©t√© modernis√©e et sa nouvelle variante a √©t√© nomm√©e xAPIC (x - √©tendu).  Avec une compatibilit√© descendante compl√®te, le nombre total de CPU possibles dans le syst√®me a √©t√© augment√© √† 256. <br><br>  La prochaine √©tape du d√©veloppement de l'architecture a √©t√© nomm√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">x2APIC</a> .  Le nombre de CPU possibles dans le syst√®me a √©t√© augment√© √† 2 ^ 32.  Ces contr√¥leurs peuvent fonctionner dans un mode de compatibilit√© descendante avec xAPIC, ou ils peuvent fonctionner dans le nouveau mode x2APIC.  Dans ce nouveau mode, la programmation du contr√¥leur ne se fait pas via MMIO, mais via les registres MSR (qui sont beaucoup plus rapides).  Selon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ce lien</a> , le support IOMMU est n√©cessaire pour ce mode. <br><br>  Il convient de noter qu'il est possible d'avoir plusieurs contr√¥leurs APIC d'E / S dans le syst√®me.  Par exemple, un pour 24 interruptions dans un southbridge et l'autre pour 32 interruptions dans un northbridge.  Dans le contexte d'E / S APIC, les interruptions sont g√©n√©ralement appel√©es GSI (Global System Interrupt).  Ainsi, le syst√®me susmentionn√© a des GSI 0-55. <br><br>  Comment d√©terminer si un CPU a un LAPIC interne et quelle architecture APIC il prend en charge?  Il est possible de r√©pondre √† ces questions en inspectant les indicateurs de bits de CPUID. <br>  Pour aider le syst√®me d'exploitation √† d√©couvrir LAPIC et les E / S APIC, le BIOS doit pr√©senter des informations √† leur sujet via une table MPtable (ancienne m√©thode) ou via une table ACPI (une table MADT dans ce cas).  Outre les informations courantes, la table MPtable et l'ACPI (dans ce cas, une table DSDT) doivent contenir des informations sur le routage d'interruption.  Cela signifie des informations sur quel p√©riph√©rique utilise quelle ligne d'interruption (similaire √† la table $ PIR). <br><br>  Vous pouvez lire sur la MPtable dans les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://web.archive.org/web/20121002210153/">sp√©cifications</a> officielles.  Auparavant, la sp√©cification √©tait sur le site Web d'Intel, mais actuellement, il n'est possible de la trouver que dans une version archive.  La sp√©cification ACPI se trouve sur le site Web de l'UEFI (la version actuelle est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">6.2</a> ).  Il convient de noter qu'avec ACPI, il est possible de d√©clarer le routage d'interruption pour les syst√®mes sans APIC (au lieu de fournir une table $ PIR distincte). <br><br><h3>  Msi </h3><br>  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">wiki</a> ) <br><br>  La derni√®re variante d'APIC √©tait bonne, mais pas sans inconv√©nients.  Toutes les lignes d'interruption des appareils ont rendu le syst√®me tr√®s compliqu√© et ont donc augment√© la probabilit√© d'erreur.  Le bus PCI express est venu remplacer le bus PCI, ce qui a compl√®tement simplifi√© tous les syst√®mes d'interruption.  Il n'a pas du tout de lignes d'interruption.  Pour des raisons de r√©trocompatibilit√©, les signaux d'interruption (INTx #) sont √©mul√©s avec un type de message distinct.  Avec les lignes d'interruption PCI, leur connexion a √©t√© √©tablie avec des fils physiques.  Avec les lignes d'interruption PCI express, une connexion est logique et est √©tablie par des ponts PCI express.  Mais cette prise en charge des interruptions INTx h√©rit√©es n'existe que pour une compatibilit√© descendante avec le bus PCI.  PCI express introduit une toute nouvelle m√©thode de livraison d'interruption - MSI (Message Signaled Interrupts).  Dans cette m√©thode, un appareil signale l'interruption simplement en √©crivant √† un endroit sp√©cial dans la r√©gion MMIO des CPU LAPIC. <br><br><img src="https://habrastorage.org/webt/8z/qw/7h/8zqw7him-vupzm_wi5glkqtr1ja.png"><br><br>  Auparavant, un seul p√©riph√©rique PCI (c'est-√†-dire toutes ses fonctions) ne pouvait avoir que 4 interruptions, mais maintenant il est devenu possible d'adresser jusqu'√† 32 interruptions. <br><br>  Dans le cas de MSI, il n'y a pas de partage de lignes d'interruption: chaque interruption correspond naturellement √† son appareil. <br><br>  Les interruptions MSI r√©solvent √©galement un autre probl√®me.  Par exemple, imaginons une situation o√π un p√©riph√©rique effectue une transaction d'√©criture en m√©moire et souhaite signaler son ach√®vement via l'interruption.  Mais une transaction d'√©criture peut √™tre retard√©e sur le bus au cours de sa transmission (et l'appareil ne pouvait pas le savoir).  Dans ce cas, le signal de l'interruption arrivera en premier au CPU, donc le processeur lira les donn√©es non encore valides.  Si MSI est utilis√©, les informations sur le MSI sont transmises de la m√™me mani√®re que les messages de donn√©es et ne peuvent donc pas venir plus t√¥t. <br><br>  Il est int√©ressant de noter que les interruptions MSI ne peuvent pas fonctionner sans LAPIC, mais les MSI peuvent remplacer les E / S APIC (une simplification de conception de plus). <br><br>  Apr√®s un certain temps, la m√©thode MSI a √©t√© √©tendue √† MSI-X.  D√©sormais, chaque appareil peut avoir jusqu'√† 2048 interruptions.  Il est √©galement d√©sormais possible de sp√©cifier quelle CPU doit traiter quelle interruption.  Il peut √™tre tr√®s utile pour les appareils √† haute charge, comme les cartes r√©seau par exemple. <br><br>  Il n'est pas n√©cessaire de disposer d'une table BIOS distincte pour la prise en charge MSI.  Mais l'appareil doit indiquer sa prise en charge MSI via l'une des capacit√©s de son espace de configuration PCI.  En outre, un pilote de p√©riph√©rique doit inclure toute la prise en charge n√©cessaire pour travailler avec le MSI. <br><br><h3>  Conclusion </h3><br>  Dans cet article, nous avons √©tudi√© les informations sur l'√©volution du contr√¥leur d'interruption et avons acquis des connaissances th√©oriques communes sur la distribution d'interruptions √† partir de p√©riph√©riques externes dans le syst√®me x86. <br><br>  Dans la partie suivante, nous allons nous entra√Æner et voir comment engager chacun des contr√¥leurs d'interruption susmentionn√©s sous Linux. <br><br>  Dans la troisi√®me partie, nous examinerons le code du coreboot et verrons quels param√®tres sont n√©cessaires dans le chipset pour un routage d'interruption correct. <br><br><h4>  Liens: </h4><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Contr√¥leurs d'interruption (Stuff in the Middle)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Que font les diff√©rentes interruptions dans PCIe?</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">R√©duction de la latence d'interruption gr√¢ce √† l'utilisation d'interruptions signal√©es par message</a> </li></ul><br><h4>  Segments reconnus </h4><br>  Un merci sp√©cial √† Jacob Garber de la communaut√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">coreboot</a> de m'avoir aid√© avec la traduction de cet article. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr446312/">https://habr.com/ru/post/fr446312/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr446300/index.html">Comment coordonner le vol de la sonde dans la stratosph√®re (ce que nous rencontrerons en pratique au lancement)</a></li>
<li><a href="../fr446302/index.html">9 citations de Habraseminar 2019 pour les blogueurs, les entrepreneurs et les RH</a></li>
<li><a href="../fr446304/index.html">Fonctions physiques non clonables: protection de l'√©lectronique contre la copie ill√©gale</a></li>
<li><a href="../fr446306/index.html">Des guerres nucl√©aires d'un pass√© lointain?</a></li>
<li><a href="../fr446308/index.html">Le recrutement de r√©f√©rence est-il vivant dans l'informatique?</a></li>
<li><a href="../fr446316/index.html">Juste de l'espace! Un √©norme morceau de titane en 6,5 jours</a></li>
<li><a href="../fr446320/index.html">Comment le scanner 3D a permis d'abandonner l'ensemble de contr√¥le √† grande √©chelle du pont</a></li>
<li><a href="../fr446322/index.html">Cryptographie en Java. Utilitaire Keytool</a></li>
<li><a href="../fr446324/index.html">Navigation dans DataGrip avec Yandex.Navigator</a></li>
<li><a href="../fr446326/index.html">R√©solution des probl√®mes de trafic</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>