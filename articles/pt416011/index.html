<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äçüè´ „ÄΩÔ∏è üì™ Padr√£o BIF: c√≥digo front-end limpo e trabalho conveniente com dados do servidor üë©üèª‚Äçü§ù‚Äçüë®üèæ üë©üèº‚Äçüé® üëêüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O material, cuja tradu√ß√£o publicamos hoje, se concentrar√° no que fazer em uma situa√ß√£o em que os dados recebidos do servidor n√£o pare√ßam com as necess...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Padr√£o BIF: c√≥digo front-end limpo e trabalho conveniente com dados do servidor</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/416011/">  O material, cuja tradu√ß√£o publicamos hoje, se concentrar√° no que fazer em uma situa√ß√£o em que os dados recebidos do servidor n√£o pare√ßam com as necessidades do cliente.  Nomeadamente, inicialmente consideraremos um problema t√≠pico desse tipo e, depois, analisaremos v√°rias maneiras de resolv√™-lo. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/7dc/108/edd/7dc108edd1850ed1da6eb12f865f93a5.jpg" alt="imagem"></a> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">O problema da API do servidor com falha</font> </h2><br>  Vamos considerar um exemplo condicional com base em v√°rios projetos reais.  Suponha que estamos desenvolvendo um novo site para uma organiza√ß√£o que j√° existe h√° algum tempo.  Ela j√° possui pontos de extremidade REST, mas eles n√£o foram totalmente projetados para o que vamos criar.  Aqui, precisamos acessar o servidor apenas para autenticar o usu√°rio, obter informa√ß√µes sobre ele e baixar uma lista de notifica√ß√µes n√£o visualizadas desse usu√°rio.  Como resultado, estamos interessados ‚Äã‚Äãnos seguintes pontos de extremidade da API do servidor: <br><br><ul><li> <code>/auth</code> : autoriza o usu√°rio e retorna um token de acesso. </li><li>  <code>/profile</code> : retorna informa√ß√µes b√°sicas do usu√°rio. </li><li>  <code>/notifications</code> : permite receber notifica√ß√µes de usu√°rios n√£o lidas. </li></ul><br>  Imagine que nosso aplicativo sempre precise receber todos esses dados em uma √∫nica unidade, ou seja, idealmente seria bom se, em vez de tr√™s pontos de extremidade, tiv√©ssemos apenas um. <br>  No entanto, somos confrontados com muito mais problemas do que muitos pontos de extremidade.  Em particular, estamos falando sobre o fato de que os dados que recebemos n√£o parecem da melhor maneira. <br><br>  Por exemplo, o n√≥ de extremidade <code>/profile</code> foi criado nos tempos antigos, n√£o foi escrito em JavaScript; como resultado, os nomes das propriedades nos dados retornados parecem incomuns para um aplicativo JS: <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"Profiles"</span></span>: [   {     <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">1234</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"Christian_Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"David"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"Surname"</span></span>: <span class="hljs-string"><span class="hljs-string">"Gilbertson"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"Photographs"</span></span>: [       {         <span class="hljs-attr"><span class="hljs-attr">"Size"</span></span>: <span class="hljs-string"><span class="hljs-string">"Medium"</span></span>,         <span class="hljs-attr"><span class="hljs-attr">"URLS"</span></span>: [           <span class="hljs-string"><span class="hljs-string">"/images/david.png"</span></span>         ]       }     ],     <span class="hljs-attr"><span class="hljs-attr">"Last_Login"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-01-01"</span></span>   } ] }</code> </pre> <br>  Em geral - nada de bom. <br><br>  √â verdade que, se voc√™ observar o que o ponto de extremidade <code>/notifications</code> produz, os dados acima de <code>/profile</code> parecer√£o bastante agrad√°veis: <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"msg-1234"</span></span>: {     <span class="hljs-attr"><span class="hljs-attr">"timestamp"</span></span>: <span class="hljs-string"><span class="hljs-string">"1529739612"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"user"</span></span>: {       <span class="hljs-attr"><span class="hljs-attr">"Christian_Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Alice"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"Surname"</span></span>: <span class="hljs-string"><span class="hljs-string">"Guthbertson"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"Enhanced"</span></span>: <span class="hljs-string"><span class="hljs-string">"True"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"Photographs"</span></span>: [         {           <span class="hljs-attr"><span class="hljs-attr">"Size"</span></span>: <span class="hljs-string"><span class="hljs-string">"Medium"</span></span>,           <span class="hljs-attr"><span class="hljs-attr">"URLS"</span></span>: [             <span class="hljs-string"><span class="hljs-string">"/images/alice.png"</span></span>           ]         }       ]     },     <span class="hljs-attr"><span class="hljs-attr">"message_summary"</span></span>: <span class="hljs-string"><span class="hljs-string">"Hey I like your hair, it re"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: <span class="hljs-string"><span class="hljs-string">"Hey I like your hair, it really goes nice with your eyes"</span></span>   },   <span class="hljs-attr"><span class="hljs-attr">"msg-5678"</span></span>: {     <span class="hljs-attr"><span class="hljs-attr">"timestamp"</span></span>: <span class="hljs-string"><span class="hljs-string">"1529731234"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"user"</span></span>: {       <span class="hljs-attr"><span class="hljs-attr">"Christian_Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Bob"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"Surname"</span></span>: <span class="hljs-string"><span class="hljs-string">"Smelthsen"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"Photographs"</span></span>: [         {           <span class="hljs-attr"><span class="hljs-attr">"Size"</span></span>: <span class="hljs-string"><span class="hljs-string">"Medium"</span></span>,           <span class="hljs-attr"><span class="hljs-attr">"URLS"</span></span>: [             <span class="hljs-string"><span class="hljs-string">"/images/smelth.png"</span></span>           ]         }       ]     },     <span class="hljs-attr"><span class="hljs-attr">"message_summary"</span></span>: <span class="hljs-string"><span class="hljs-string">"I'm launching my own cryptocu"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: <span class="hljs-string"><span class="hljs-string">"I'm launching my own cryptocurrency soon and many thanks for you to look at and talk about"</span></span>   } } }</code> </pre> <br>  Aqui a lista de mensagens √© um objeto, n√£o uma matriz.  Al√©m disso, existem dados do usu√°rio aqui, que s√£o t√£o desconfortavelmente organizados quanto no caso do terminal <code>/profile</code> .  E - eis uma surpresa - a propriedade <code>timestamp</code> cont√©m o n√∫mero de segundos desde o in√≠cio de 1970. <br><br>  Se eu tivesse que desenhar um diagrama da arquitetura daquele sistema infernalmente inconveniente sobre o qual acabamos de falar, seria semelhante ao mostrado na figura abaixo.  A cor vermelha √© usada para as partes deste circuito que correspondem a dados mal preparados para trabalhos futuros. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8e1/6c4/42f/8e16c442f3af8ad8ca702875e25207e0.png"><br>  <i><font color="#999999">Diagrama do sistema</font></i> <br><br>  Nessas circunst√¢ncias, n√£o podemos nos esfor√ßar para corrigir a arquitetura deste sistema.  Voc√™ pode simplesmente carregar dados dessas tr√™s APIs e usar esses dados no aplicativo.  Por exemplo, se voc√™ precisar exibir o nome de usu√°rio completo na p√°gina, precisaremos combinar as propriedades <code>Christian_Name</code> e <code>Surname</code> . <br><br>  Aqui eu gostaria de fazer uma observa√ß√£o sobre nomes.  A ideia de dividir o nome completo de uma pessoa em um nome e sobrenome pessoais √© caracter√≠stica dos pa√≠ses ocidentais.  Se voc√™ estiver desenvolvendo algo projetado para uso internacional, tente considerar o nome completo da pessoa como uma sequ√™ncia indivis√≠vel e n√£o fa√ßa suposi√ß√µes sobre como dividir essa sequ√™ncia em partes menores para usar o que aconteceu em locais onde precisa de brevidade ou deseja apelar para o usu√°rio em um estilo informal. <br><br>  De volta √†s nossas estruturas de dados imperfeitas.  O primeiro problema √≥bvio que pode ser visto aqui √© expresso na necessidade de combinar dados diferentes no c√≥digo da interface do usu√°rio.  Consiste no fato de que talvez seja necess√°rio repetir essa a√ß√£o em v√°rios lugares.  Se voc√™ precisar fazer isso apenas ocasionalmente, o problema n√£o ser√° t√£o s√©rio, mas se voc√™ precisar disso com frequ√™ncia, ser√° muito pior.  Como resultado, existem fen√¥menos indesej√°veis ‚Äã‚Äãcausados ‚Äã‚Äãpela incompatibilidade de como os dados recebidos do servidor s√£o organizados e como eles s√£o usados ‚Äã‚Äãno aplicativo. <br><br>  O segundo problema √© a complexidade do c√≥digo usado para formar a interface do usu√°rio.  Eu acredito que esse c√≥digo deve ser, em primeiro lugar, o mais simples poss√≠vel e, em segundo lugar - o mais claro poss√≠vel.  Quanto mais transforma√ß√µes internas de dados voc√™ precisar fazer no cliente, maior ser√° sua complexidade e o c√≥digo complexo ser√° o local onde os erros geralmente se ocultam. <br><br>  A terceira quest√£o diz respeito aos tipos de dados.  Nos trechos de c√≥digo acima, voc√™ pode ver que, por exemplo, identificadores de mensagens s√£o cadeias de caracteres e identificadores de usu√°rios s√£o n√∫meros.  Do ponto de vista t√©cnico, est√° tudo bem, mas essas coisas podem confundir o programador.  Al√©m disso, veja a apresenta√ß√£o das datas!  Mas e a bagun√ßa na parte dos dados relacionada √† imagem do perfil?  Afinal, tudo o que precisamos √© de uma URL que leve ao arquivo correspondente, e n√£o algo a partir do qual teremos que criar essa URL, percorrendo a selva de estruturas de dados aninhadas. <br><br>  Se processarmos esses dados, passando-os para o c√≥digo da interface do usu√°rio e analisando os m√≥dulos, n√£o poderemos entender imediatamente exatamente com o que estamos trabalhando l√°.  A convers√£o da estrutura de dados interna e seu tipo ao trabalhar com eles cria uma carga adicional para o programador.  Mas sem todas essas dificuldades, √© bem poss√≠vel fazer isso. <br><br>  De fato, como op√ß√£o, seria poss√≠vel implementar um sistema de tipo est√°tico para resolver esse problema, mas a digita√ß√£o estrita n√£o √© capaz, apenas pelo fato de sua presen√ßa, de tornar bons c√≥digos ruins. <br><br>  Agora que voc√™ pode ver a seriedade do problema que estamos enfrentando, vamos falar sobre maneiras de resolv√™-lo. <br><br><h2>  <font color="#3AC1EF">Solu√ß√£o 1: alterando a API do servidor</font> </h2><br>  Se o dispositivo inconveniente da API existente n√£o for ditado por alguns motivos importantes, nada o impedir√° de criar uma nova vers√£o que melhor atenda √†s necessidades do projeto e de localizar essa nova vers√£o, digamos, em <code>/v2</code> .  Talvez essa abordagem possa ser chamada de solu√ß√£o mais bem-sucedida para os problemas acima.  O esquema desse sistema √© apresentado na figura abaixo; a estrutura de dados que corresponde perfeitamente √†s necessidades do cliente √© destacada em verde. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c59/59d/c18/c5959dc18590ec9bce0368e4b9ba1967.png"><br>  <i><font color="#999999">A nova API do servidor que produz exatamente o que o lado do cliente do sistema precisa</font></i> <br><br>  Come√ßando a desenvolver um novo projeto, cuja API deixa muito a desejar, estou sempre interessado na possibilidade de implementar a abordagem descrita.  No entanto, algumas vezes o dispositivo da API, embora inconveniente, tem alguns objetivos importantes, ou alterar a API do servidor simplesmente n√£o √© poss√≠vel.  Nesse caso, recorro √† seguinte abordagem. <br><br><h2>  <font color="#3AC1EF">Solu√ß√£o # 2: Padr√£o BFF</font> </h2><br>  Esse √© um bom e velho padr√£o de BFF ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">back-end para o front-end</a> ).  Usando esse padr√£o, voc√™ pode abstrair dos intricados pontos de extremidade REST universais e fornecer ao front end exatamente o que ele precisa.  Aqui est√° uma representa√ß√£o esquem√°tica de uma solu√ß√£o desse tipo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ea5/484/437/ea5484437a08ed68db006b5194dd9a9b.png"><br>  <i><font color="#999999">Aplicando o padr√£o BFF</font></i> <br><br>  O significado da exist√™ncia da camada BFF √© satisfazer as necessidades do frontend.  Talvez ele use pontos de extremidade REST adicionais, servi√ßos GraphQL, soquetes da Web ou qualquer outra coisa.  Seu principal objetivo √© fazer todo o poss√≠vel para a conveni√™ncia do lado do cliente do aplicativo. <br><br>  Minha arquitetura favorita √© o NodeJS BFF, usando quais desenvolvedores front-end podem fazer o que precisam, criando √≥timas APIs para os aplicativos clientes que desenvolvem.  Idealmente, o c√≥digo correspondente est√° no mesmo reposit√≥rio que o c√≥digo do front-end, o que simplifica o compartilhamento de c√≥digo, por exemplo, para verificar os dados enviados, tanto no cliente quanto no servidor. <br><br>  Al√©m disso, isso significa que as tarefas que requerem altera√ß√µes na parte do cliente do aplicativo e na API do servidor s√£o executadas em um reposit√≥rio.  Um pouco, como eles dizem, mas legal. <br><br>  No entanto, o BFF nem sempre pode ser usado.  E esse fato nos leva a outra solu√ß√£o para o problema do uso conveniente de APIs ruins de servidor. <br><br><h2>  <font color="#3AC1EF">Solu√ß√£o 3: Padr√£o BIF</font> </h2><br>  O padr√£o BIF (back-end no front-end) usa a mesma l√≥gica que pode ser aplicada usando o BFF (combinando v√°rias APIs e limpeza de dados), mas essa l√≥gica se move para o lado do cliente.  Na verdade, essa ideia n√£o √© nova, poderia ter sido vista vinte anos atr√°s, mas essa abordagem pode ajudar no trabalho com APIs de servidor mal organizadas, √© por isso que estamos falando sobre isso.  Aqui est√° como fica. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/185/102/d39/185102d39436b6119ead19f230eb8196.png"><br>  <i><font color="#999999">Aplicando o padr√£o BIF</font></i> <br><br><h3>  <font color="#3AC1EF">‚ñç O que √© um BIF?</font> </h3><br>  Como pode ser visto na se√ß√£o anterior, o BIF √© um padr√£o, isto √©, uma abordagem para entender o c√≥digo e sua organiza√ß√£o.  Seu uso n√£o leva √† necessidade de remover nenhuma l√≥gica do projeto.  Apenas separa a l√≥gica de um tipo (modifica√ß√£o de estruturas de dados) da l√≥gica de outro tipo (a forma√ß√£o da interface do usu√°rio).  Isso √© semelhante √† id√©ia de uma "separa√ß√£o de responsabilidades", que todo mundo est√° ouvindo. <br><br>  Aqui eu gostaria de observar que, embora isso n√£o possa ser chamado de desastre, muitas vezes eu tinha que ver implementa√ß√µes analfabetas de BIF.  Portanto, parece-me que muitos estar√£o interessados ‚Äã‚Äãem ouvir uma hist√≥ria sobre como implementar corretamente esse padr√£o. <br><br>  O c√≥digo BIF deve ser considerado como um c√≥digo que pode ser usado e transferido para o servidor Node.js. Depois disso, tudo funcionar√° da mesma maneira que antes.  Ou at√© mesmo transfira-o para um pacote NPM privado, que ser√° usado em v√°rios projetos front-end dentro da estrutura de uma empresa, o que √© simplesmente incr√≠vel. <br><br>  Lembre-se de que discutimos acima os principais problemas que surgem ao trabalhar com uma API do servidor com falha.  Entre eles, h√° uma chamada muito frequente para a API e o fato de os dados retornados por eles n√£o atenderem √†s necessidades do front-end. <br><br>  Dividiremos a solu√ß√£o de cada um desses problemas em blocos de c√≥digo separados, cada um dos quais ser√° colocado em seu pr√≥prio arquivo.  Como resultado, a camada BIF da parte do cliente do aplicativo consistir√° em dois arquivos.  Al√©m disso, um arquivo de teste ser√° anexado a eles. <br><br><h3>  <font color="#3AC1EF">‚ñç Combinando chamadas de API</font> </h3><br>  Fazer muitas chamadas para as APIs do servidor em nosso c√≥digo de cliente n√£o √© um problema t√£o s√©rio.  No entanto, gostaria de abstra√≠-lo, para possibilitar o atendimento de uma √∫nica ‚Äúsolicita√ß√£o‚Äù (do c√≥digo do aplicativo √† camada BIF) e obter exatamente o que √© necess√°rio em resposta. <br><br>  Obviamente, no nosso caso, n√£o h√° como fazer tr√™s solicita√ß√µes HTTP para o servidor, mas o aplicativo n√£o precisa saber sobre isso. <br><br>  A API da minha camada BIF √© representada como fun√ß√µes.  Portanto, quando o aplicativo precisar de alguns dados sobre o usu√°rio, ele chamar√° a fun√ß√£o <code>getUser()</code> , que retornar√° esses dados para ele.  Aqui est√° a apar√™ncia dessa fun√ß√£o: <br><br><pre> <code class="hljs powershell">import parseUserData from <span class="hljs-string"><span class="hljs-string">'./parseUserData'</span></span>; import fetchJson from <span class="hljs-string"><span class="hljs-string">'./fetchJson'</span></span>; export const getUser = async () =&gt; { const auth = await fetchJson(<span class="hljs-string"><span class="hljs-string">'/auth'</span></span>); const [ <span class="hljs-type"><span class="hljs-type">profile</span></span>, <span class="hljs-type"><span class="hljs-type">notifications</span></span> ] = await Promise.all([   <span class="hljs-type"><span class="hljs-type">fetchJson</span></span>(`/<span class="hljs-type"><span class="hljs-type">profile</span></span>/<span class="hljs-variable"><span class="hljs-variable">$</span></span>{<span class="hljs-type"><span class="hljs-type">auth.userId</span></span>}`, <span class="hljs-type"><span class="hljs-type">auth.jwt</span></span>),   <span class="hljs-type"><span class="hljs-type">fetchJson</span></span>(`/<span class="hljs-type"><span class="hljs-type">notifications</span></span>/<span class="hljs-variable"><span class="hljs-variable">$</span></span>{<span class="hljs-type"><span class="hljs-type">auth.userId</span></span>}`, <span class="hljs-type"><span class="hljs-type">auth.jwt</span></span>), ]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parseUserData(auth, profile, notifications); };</code> </pre> <br>  Aqui, primeiro, √© feita uma solicita√ß√£o ao servi√ßo de autentica√ß√£o para obter um token, que pode ser usado para autorizar o usu√°rio (n√£o falaremos sobre mecanismos de autentica√ß√£o aqui, mas nosso principal objetivo √© o BIF). <br><br>  Ap√≥s receber o token, voc√™ pode executar simultaneamente duas solicita√ß√µes que recebem dados e informa√ß√µes do perfil do usu√°rio sobre notifica√ß√µes n√£o lidas. <br><br>  A prop√≥sito, observe como a constru√ß√£o <code>async/await</code> √© bonita ao trabalhar com ela usando <code>Promise.all</code> e usando atribui√ß√£o destrutiva. <br><br>  Portanto, este foi o primeiro passo, aqui abstra√≠mos o fato de que o acesso ao servidor inclui tr√™s solicita√ß√µes.  No entanto, o caso ainda n√£o foi conclu√≠do.  Ou seja, preste aten√ß√£o na chamada para a fun√ß√£o <code>parseUserData()</code> , que, como voc√™ pode julgar pelo nome, organiza os dados recebidos do servidor.  Vamos conversar sobre ela. <br><br><h3>  <font color="#3AC1EF">‚ñç Limpeza de dados</font> </h3><br>  Quero dar imediatamente uma recomenda√ß√£o que, acredito, pode afetar seriamente um projeto que anteriormente n√£o possu√≠a uma camada BIF, em particular um novo projeto.  Tente n√£o pensar no que voc√™ recebe do servidor por um tempo.  Em vez disso, concentre-se em quais dados seu aplicativo precisa. <br><br>  Al√©m disso, √© melhor n√£o tentar, ao projetar o aplicativo, levar em considera√ß√£o suas poss√≠veis necessidades futuras, digamos, relacionadas a 2021.  Apenas tente fazer o aplicativo funcionar exatamente como deveria hoje.  O fato √© que o entusiasmo excessivo pelo planejamento e as tentativas de prever o futuro √© o principal motivo da complica√ß√£o injustificada dos projetos de software. <br><br>  Ent√£o, voltando ao nosso neg√≥cio.  Agora sabemos como s√£o os dados recebidos das tr√™s APIs do servidor e sabemos em que eles devem se transformar ap√≥s a an√°lise. <br><br>  Parece que este √© um daqueles casos raros em que o uso do TDD realmente faz sentido.  Portanto, escreveremos um grande teste longo para a fun√ß√£o <code>parseUserData()</code> : <br><br><pre> <code class="hljs powershell">import parseUserData from <span class="hljs-string"><span class="hljs-string">'./parseUserData'</span></span>; it(<span class="hljs-string"><span class="hljs-string">'should parse the data'</span></span>, () =&gt; { const authApiData = {   userId: <span class="hljs-number"><span class="hljs-number">1234</span></span>,   jwt: <span class="hljs-string"><span class="hljs-string">'the jwt'</span></span>, }; const profileApiData = {   Profiles: [     {       <span class="hljs-type"><span class="hljs-type">id</span></span>: <span class="hljs-number"><span class="hljs-number">1234</span></span>,       <span class="hljs-type"><span class="hljs-type">Christian_Name</span></span>: <span class="hljs-string"><span class="hljs-string">'David'</span></span>,       <span class="hljs-type"><span class="hljs-type">Surname</span></span>: <span class="hljs-string"><span class="hljs-string">'Gilbertson'</span></span>,       <span class="hljs-type"><span class="hljs-type">Photographs</span></span>: [         {           <span class="hljs-type"><span class="hljs-type">Size</span></span>: <span class="hljs-string"><span class="hljs-string">'Medium'</span></span>,           <span class="hljs-type"><span class="hljs-type">URLS</span></span>: [             <span class="hljs-string"><span class="hljs-string">'/images/david.png'</span></span>,           ],         },       ],       <span class="hljs-type"><span class="hljs-type">Last_Login</span></span>: <span class="hljs-string"><span class="hljs-string">'2018-01-01'</span></span>     },   ], }; const notificationsApiData = {   <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>: {     <span class="hljs-string"><span class="hljs-string">'msg-1234'</span></span>: {       timestamp: <span class="hljs-string"><span class="hljs-string">'1529739612'</span></span>,       user: {         Christian_Name: <span class="hljs-string"><span class="hljs-string">'Alice'</span></span>,         Surname: <span class="hljs-string"><span class="hljs-string">'Guthbertson'</span></span>,         Enhanced: <span class="hljs-string"><span class="hljs-string">'True'</span></span>,         Photographs: [           {             <span class="hljs-type"><span class="hljs-type">Size</span></span>: <span class="hljs-string"><span class="hljs-string">'Medium'</span></span>,             <span class="hljs-type"><span class="hljs-type">URLS</span></span>: [               <span class="hljs-string"><span class="hljs-string">'/images/alice.png'</span></span>             ]           }         ]       },       message_summary: <span class="hljs-string"><span class="hljs-string">'Hey I like your hair, it re'</span></span>,       message: <span class="hljs-string"><span class="hljs-string">'Hey I like your hair, it really goes nice with your eyes'</span></span>     },     <span class="hljs-string"><span class="hljs-string">'msg-5678'</span></span>: {       timestamp: <span class="hljs-string"><span class="hljs-string">'1529731234'</span></span>,       user: {         Christian_Name: <span class="hljs-string"><span class="hljs-string">'Bob'</span></span>,         Surname: <span class="hljs-string"><span class="hljs-string">'Smelthsen'</span></span>,       },       message_summary: <span class="hljs-string"><span class="hljs-string">'I\'</span></span>m launching my own cryptocu<span class="hljs-string"><span class="hljs-string">',       message: '</span></span>I\<span class="hljs-string"><span class="hljs-string">'m launching my own cryptocurrency soon and many thanks for you to look at and talk about'</span></span>     },   }, }; const parsedData = parseUserData(authApiData, profileApiData, notificationsApiData); expect(parsedData).toEqual({   jwt: <span class="hljs-string"><span class="hljs-string">'the jwt'</span></span>,   id: <span class="hljs-string"><span class="hljs-string">'1234'</span></span>,   name: <span class="hljs-string"><span class="hljs-string">'David Gilbertson'</span></span>,   photoUrl: <span class="hljs-string"><span class="hljs-string">'/images/david.png'</span></span>,   notifications: [     {       <span class="hljs-type"><span class="hljs-type">id</span></span>: <span class="hljs-string"><span class="hljs-string">'msg-1234'</span></span>,       <span class="hljs-built_in"><span class="hljs-built_in">dateTime</span></span>: <span class="hljs-type"><span class="hljs-type">expect.any</span></span>(<span class="hljs-type"><span class="hljs-type">Date</span></span>),       <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Alice Guthbertson'</span></span>,       <span class="hljs-type"><span class="hljs-type">premiumMember</span></span>: <span class="hljs-type"><span class="hljs-type">true</span></span>,       <span class="hljs-type"><span class="hljs-type">photoUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'/images/alice.png'</span></span>,       <span class="hljs-type"><span class="hljs-type">message</span></span>: <span class="hljs-string"><span class="hljs-string">'Hey I like your hair, it really goes nice with your eyes'</span></span>     },     {       <span class="hljs-type"><span class="hljs-type">id</span></span>: <span class="hljs-string"><span class="hljs-string">'msg-5678'</span></span>,       <span class="hljs-built_in"><span class="hljs-built_in">dateTime</span></span>: <span class="hljs-type"><span class="hljs-type">expect.any</span></span>(<span class="hljs-type"><span class="hljs-type">Date</span></span>),       <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Bob Smelthsen'</span></span>,       <span class="hljs-type"><span class="hljs-type">premiumMember</span></span>: <span class="hljs-type"><span class="hljs-type">false</span></span>,       <span class="hljs-type"><span class="hljs-type">photoUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'/images/placeholder.jpg'</span></span>,       <span class="hljs-type"><span class="hljs-type">message</span></span>: <span class="hljs-string"><span class="hljs-string">'I\'</span></span><span class="hljs-type"><span class="hljs-type">m</span></span> <span class="hljs-type"><span class="hljs-type">launching</span></span> <span class="hljs-type"><span class="hljs-type">my</span></span> <span class="hljs-type"><span class="hljs-type">own</span></span> <span class="hljs-type"><span class="hljs-type">cryptocurrency</span></span> <span class="hljs-type"><span class="hljs-type">soon</span></span> <span class="hljs-type"><span class="hljs-type">and</span></span> <span class="hljs-type"><span class="hljs-type">many</span></span> <span class="hljs-type"><span class="hljs-type">thanks</span></span> <span class="hljs-type"><span class="hljs-type">for</span></span> <span class="hljs-type"><span class="hljs-type">you</span></span> <span class="hljs-type"><span class="hljs-type">to</span></span> <span class="hljs-type"><span class="hljs-type">look</span></span> <span class="hljs-type"><span class="hljs-type">at</span></span> <span class="hljs-type"><span class="hljs-type">and</span></span> <span class="hljs-type"><span class="hljs-type">talk</span></span> <span class="hljs-type"><span class="hljs-type">about</span></span><span class="hljs-string"><span class="hljs-string">'     },   ], }); });</span></span></code> </pre> <br>  E aqui est√° o c√≥digo da pr√≥pria fun√ß√£o: <br><br><pre> <code class="hljs powershell">const getPhotoFromProfile = profile =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> profile.Photographs[<span class="hljs-number"><span class="hljs-number">0</span></span>].URLS[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'/images/placeholder.jpg'</span></span>; //   } }; const getFullNameFromProfile = profile =&gt; `${profile.Christian_Name} <span class="hljs-variable"><span class="hljs-variable">$</span></span>{profile.Surname}`; export default <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseUserData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(authApiData, profileApiData, notificationsApiData)</span></span></span></span> { const profile = profileApiData.Profiles[<span class="hljs-number"><span class="hljs-number">0</span></span>]; const result = {   jwt: authApiData.jwt,   id: authApiData.userId.toString(), // ID        name: getFullNameFromProfile(profile),   photoUrl: getPhotoFromProfile(profile),   notifications: [], //      ,     }; Object.entries(notificationsApiData.data).forEach(([<span class="hljs-type"><span class="hljs-type">id</span></span>, <span class="hljs-type"><span class="hljs-type">notification</span></span>]) =&gt; {   result.notifications.push({     id,     dateTime: new Date(Number(notification.timestamp) * <span class="hljs-number"><span class="hljs-number">1000</span></span>), // ,   ,   ,     Unix,         name: getFullNameFromProfile(notification.user),     photoUrl: getPhotoFromProfile(notification.user),     message: notification.message,     premiumMember: notification.user.Enhanced === <span class="hljs-string"><span class="hljs-string">'True'</span></span>,   }) }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br>  Gostaria de observar que, quando √© poss√≠vel coletar em um local duzentas linhas de c√≥digo respons√°veis ‚Äã‚Äãpela modifica√ß√£o dos dados espalhados antes disso por todo o aplicativo, isso causa uma sensa√ß√£o maravilhosa.  Agora, tudo isso est√° em um arquivo, testes de unidade s√£o escritos para esse c√≥digo e todos os momentos amb√≠guos s√£o fornecidos com coment√°rios. <br><br>  Eu disse anteriormente que o BFF √© minha abordagem favorita para combinar e limpar dados, mas existe uma √°rea em que o BIF √© superior ao BFF.  Ou seja, os dados recebidos do servidor podem incluir objetos JavaScript que n√£o suportam JSON, como objetos <code>Date</code> ou <code>Map</code> (talvez esse seja um dos recursos JavaScript mais subutilizados).  Por exemplo, no nosso caso, temos que converter a data que veio do servidor (expressa em segundos, n√£o em milissegundos) em um objeto JS do tipo <code>Date</code> . <br><br><h2>  <font color="#3AC1EF">Sum√°rio</font> </h2><br>  Se voc√™ acha que seu projeto tem algo em comum com aquele em que examinamos os problemas de APIs malsucedidas, analise seu c√≥digo fazendo as seguintes perguntas sobre o uso de dados do servidor no cliente: <br><br><ul><li>  Voc√™ precisa combinar propriedades que nunca s√£o usadas separadamente (por exemplo, nome e sobrenome do usu√°rio)? </li><li>  O c√≥digo JS precisa trabalhar com nomes de propriedades formados de uma maneira que n√£o seja aceita em JS (algo como PascalCase)? </li><li>  Quais s√£o os tipos de dados dos v√°rios identificadores?  Talvez √†s vezes sejam cordas, √†s vezes n√∫meros? </li><li>  Como as datas s√£o apresentadas no seu projeto?  Talvez, √†s vezes, esses sejam objetos <code>Date</code> JS prontos para uso na interface e, √†s vezes, n√∫meros ou at√© strings? </li><li>  Voc√™ geralmente precisa verificar as propriedades quanto √† exist√™ncia delas ou se uma entidade √© uma matriz antes de come√ßar a enumerar os elementos dessa entidade para formar algum fragmento da interface do usu√°rio com base?  Ser√° que essa entidade n√£o ser√° uma matriz, mesmo que vazia? </li><li>  Voc√™ precisa classificar ou filtrar matrizes ao formar a interface, que, idealmente, j√° deve ser classificada e filtrada corretamente? </li><li>  Se acontecer que, ao verificar as propriedades quanto √† sua exist√™ncia, n√£o h√° propriedades procuradas, √© necess√°rio mudar para usar alguns valores padr√£o (por exemplo, use a imagem padr√£o quando n√£o houver foto do usu√°rio nos dados recebidos do servidor)? </li><li>  As propriedades s√£o nomeadas de maneira uniforme?  Ocorre que a mesma entidade pode ter nomes diferentes, o que √© possivelmente causado pelo uso conjunto de APIs de servidor ‚Äúantigas‚Äù e ‚Äúnovas‚Äù, relativamente falando? </li><li>  Voc√™ precisa, juntamente com dados √∫teis, transferir para algum lugar os dados que nunca s√£o usados, fazendo isso apenas porque s√£o provenientes da API do servidor?  Esses dados n√£o utilizados interferem na depura√ß√£o? </li></ul><br>  Se voc√™ puder responder positivamente a uma ou duas perguntas dessa lista, talvez n√£o deva reparar algo que j√° funcione corretamente. <br><br>  No entanto, se voc√™, lendo essas perguntas, descobrir em cada uma delas os problemas do seu projeto, se o dispositivo do seu c√≥digo √© desnecessariamente complicado por causa de tudo isso, se for dif√≠cil de perceber e testar, se houver erros dif√≠ceis de detectar, d√™ uma olhada no padr√£o BIF. <br><br>  No final, quero dizer que, ao introduzir a camada BIF em aplicativos existentes, as coisas ficam mais f√°ceis devido ao fato de que isso pode ser feito em etapas, em pequenas etapas.  Digamos que a primeira vers√£o da fun√ß√£o para a prepara√ß√£o de dados, vamos cham√°-la de <code>parseData()</code> , pode simplesmente, sem altera√ß√µes, retornar o que vem √† sua entrada.  Em seguida, voc√™ pode mover gradualmente a l√≥gica do c√≥digo respons√°vel pela cria√ß√£o da interface do usu√°rio para esta fun√ß√£o. <br><br>  <b>Caros leitores!</b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Voc√™ encontrou problemas para os quais o autor deste material sugere o uso do padr√£o BIF? </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt416011/">https://habr.com/ru/post/pt416011/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt416001/index.html">Mensagens de um site em VK - simples e eficaz - PHP + CUrl</a></li>
<li><a href="../pt416003/index.html">Renderiza√ß√£o de arquivo HTML: um cap√≠tulo do livro ReactPHP for Beginners de Skyeng</a></li>
<li><a href="../pt416005/index.html">16 Reagir ferramentas para desenvolvedores de interface</a></li>
<li><a href="../pt416007/index.html">Quase complicado. O in√≠cio da cria√ß√£o de uma "casa inteligente" sem fio. Baseado na tecnologia Linux, nos softwares Z-Wave e MajorDoMo</a></li>
<li><a href="../pt416009/index.html">Tente excrementos de coelho, √© vigoroso, ele pega - extratos em farmacologia</a></li>
<li><a href="../pt416013/index.html">Como come√ßar a investir e economizar dinheiro: os especialistas da Dow Jones apontaram os cinco principais erros de traders iniciantes</a></li>
<li><a href="../pt416015/index.html">Brincando com threads no Node.JS 10.5.0</a></li>
<li><a href="../pt416017/index.html">Coletamos an√°lise de coorte / an√°lise de fluxos no exemplo do Excel</a></li>
<li><a href="../pt416019/index.html">Qu√£o bom √© o ecossistema de c√≥digo aberto da R para resolver problemas de neg√≥cios?</a></li>
<li><a href="../pt416021/index.html">Desenvolvendo sua pr√≥pria estrutura e crescimento profissional de um programador de JS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>