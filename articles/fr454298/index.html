<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§µüèº üíú üå† The Standoff: comment c'√©tait üë®üèº‚Äçüíº üçó ‚úã</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salutations! Ayant vu suffisamment d'int√©r√™t pour ce qui se passe √† The Standoff dans les rangs des d√©fenseurs des PHDays 9, nous avons d√©cid√© de parl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>The Standoff: comment c'√©tait</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jetinfosystems/blog/454298/"><img src="https://habrastorage.org/webt/ef/tx/b3/eftxb30vyae7fr5w6xkios-nl9q.jpeg"><br><br>  Salutations!  Ayant vu suffisamment d'int√©r√™t pour ce qui se passe √† The Standoff dans les rangs des d√©fenseurs des PHDays 9, nous avons d√©cid√© de parler de la fa√ßon dont la pr√©paration et la "confrontation" se sont d√©roul√©es √† travers les yeux du Jet CSIRT au sein de l'√©quipe Jet Security. <br><a name="habracut"></a><br><h3>  Guo Standoff, j'ai cr√©√© </h3><br>  Quelque chose comme √ßa, les coll√®gues ont rapport√© que nous participons √† nouveau √† The Standoff, et nous avons naturellement accept√©. <br><br>  Il faut dire tout de suite que pour les d√©fenseurs de cette ann√©e, le format de la comp√©tition a quelque peu chang√©.  Toutes les √©quipes ont re√ßu des infrastructures de bureaux tr√®s similaires, ce qui a permis aux organisateurs d'entrer un classement de d√©fenseurs dans certains perroquets.  Et pour l'√©quipe Jet Security, c'√©tait la premi√®re "Confrontation", o√π le bureau √©tait d√©fendu, et non l'infrastructure industrielle. <br><br>  Nous avons eu acc√®s √† l'infrastructure pour pr√©parer la cyber-bataille fin avril.  Apr√®s l'audit de l'infrastructure, tout un wagon de d√©ficiences a √©t√© assembl√©, en voici quelques-unes.  Absolument dans toute l'infrastructure, il n'y avait pas de correctifs r√©els.  Les mots de passe de tous les utilisateurs peuvent √™tre obtenus via Ntds.dit en texte clair.  De plus, certains utilisateurs avaient des mots de passe de la liste TOP-500 ou des mots de passe avec un hachage facilement r√©versible.  Le durcissement du syst√®me √©tait pratiquement nul ou nul.  Certains h√¥tes de la DMZ avaient une interface dans le sous-r√©seau du serveur. <br><br>  Sur la base des r√©sultats de l'audit, nous avons d√©velopp√© certaines mesures de s√©curit√©, √† leur tour, les organisateurs, apr√®s approbation pr√©alable, nous ont permis d'appliquer les politiques dont nous avions besoin et d'apporter tous les outils de s√©curit√© et les outils qui peuvent √™tre d√©ploy√©s dans un environnement virtuel.  En raison des d√©lais serr√©s, certaines id√©es sur les mesures de protection sont tomb√©es au d√©part.  Les principaux r√©glages et le profilage du SPI ont √©t√© effectu√©s pendant les vacances de mai (bonjour √† tous ceux qui ont jet√© des photos des pique-niques, nous vous aimons aussi), et certains des √©quipements de protection ont d√ª √™tre ajust√©s juste avant le d√©part, directement sur le site.  De plus, un certain nombre de services √©taient interdits de correction et de reconfiguration stricte.  Par exemple, Oracle Weblogic avec CVE-2019-2725, dont PoC a √©t√© publi√© au tout d√©but de mai 2019, √©tait l'un d'entre eux. <br><br>  Eh bien, et une liste de ce que nous avons apport√© avec nous: <br><br><ul><li>  Pare-feu (fourni par les organisateurs a √©t√© remplac√©); </li><li>  Solution antivirus; </li><li>  WAF; </li><li>  EDR </li><li>  Quelques solutions de d√©ception; </li><li>  Une paire de scanners de vuln√©rabilit√©; </li><li>  Pile ELK pour une analyse Netflow suppl√©mentaire; </li><li>  SIEM. </li></ul><br>  Nous devrions √©galement parler de ce qui allait au SIEM.  Comme sources d'√©v√©nements, nous avions √† notre disposition les journaux Windows, Sysmon, les journaux Auditd et, comme vous pouvez le deviner, les √©v√©nements du SZI lui-m√™me.  S'il n'y avait pas de probl√®mes particuliers avec les deux premiers, et nous nous sommes rapidement mis d'accord sur des changements dans la politique et la configuration de Sysmon, alors nous avons d√ª lutter avec les organisateurs pour la configuration Auditd. <br><br>  Parall√®lement √† cela, nous avons identifi√© les principaux vecteurs d'attaque, et sur cette base, nous avons s√©lectionn√© et adapt√© des sc√©narios et des r√®gles de corr√©lation pertinents - un total d'environ 160 r√®gles de corr√©lation.  De plus, un ensemble de tableaux de bord h√©t√©roclites a √©t√© assembl√© pour les n≈ìuds critiques, SZI et ce qui n√©cessitait une attention particuli√®re dans l'infrastructure de jeu. <br><br><h3>  Le bras de fer </h3><br>  Pour The Standoff, nous avons d√©cid√© d'adh√©rer au concept de s√©paration des incidents en externe et interne, car il √©tait parfaitement entendu que nous essaierions activement d'explorer et d'exploiter le Web de l'ext√©rieur.  Les incidents li√©s √† la num√©risation et aux tentatives de contournement du WAF ont √©t√© surveill√©s s√©par√©ment, √† une priorit√© inf√©rieure, ce qui nous a permis de nous concentrer sur les incidents internes.  Des tableaux de bord pour SPI ont √©t√© distribu√©s entre les d√©fenseurs dans les zones de responsabilit√©, et au moins 2 personnes ont √©t√© affect√©es √† chaque outil - pour la possibilit√© de rotation et de repos. <br><br>  Tout s'est pass√©, comme nous nous y attendions.  La confrontation a commenc√© vers 10 heures du matin, et d√®s le d√©but du processus, le syst√®me SIEM a commenc√© √† diffuser un tas d'incidents li√©s √† une analyse externe et √† des tentatives d'agresseurs d'exploiter le Web.  Dans certains cas, m√™me le groupe n'a pas enregistr√©.  Parall√®lement √† cela, les v√©rificateurs des organisateurs ont commenc√© √† travailler, v√©rifiant l'√©tat des diff√©rents services dans le bureau, ce qui nous a oblig√©s √† reconduire le profilage dans une certaine mesure pour √©liminer les faux positifs qui leur sont associ√©s. <br><br>  Dans les toutes premi√®res heures du jeu, l'√©quipe Hack.ERS a r√©ussi √† trouver les informations d'identification standard de l'administrateur (admin / admin) sur le CMS de l'une des ressources et √† d√©tecter une vuln√©rabilit√© potentielle LFI.  Ces tentatives ne sont pas pass√©es inaper√ßues, nos d√©fenseurs ont men√© une intervention op√©rationnelle et les attaquants n'ont finalement pas pu avancer davantage. <br><br>  Jusqu'√† la fin de la premi√®re journ√©e de jeu, les m√©thodes n'ont pas chang√©, WAF a quand m√™me repouss√© toutes les tentatives de t√©l√©chargement de quelque chose d'int√©ressant sur les sites Web de la soci√©t√©, et les m√™mes ¬´adresses externes¬ª, sans cesse, ont essay√© de scanner nos ressources. <br><br><img src="https://habrastorage.org/webt/k4/h2/je/k4h2jeeackujcdpdfydy2ci7i7s.png"><br><br>  Au total, pour l'ensemble de l'√©v√©nement, 3000 incidents li√©s aux tentatives de scan ont √©t√© enregistr√©s, sans tenir compte du regroupement des √©v√©nements en incidents. <br><br><img src="https://habrastorage.org/webt/eo/c0/j-/eoc0j-v5ohyz-kbja5goxy9vzsi.png"><br><br>  Et environ 2500 incidents avec tentatives de contournement du WAF, √©galement sans tenir compte du regroupement des √©v√©nements en incidents. <br><br>  Vers la nuit, l'intensit√© de toutes les activit√©s a diminu√© - pour plusieurs raisons.  Une partie des d√©fenseurs et des attaquants n'a pas pu r√©sister √† la v√©rification du son et √† la r√©p√©tition du concert, qui devait se tenir le lendemain.  Certaines √©quipes attaquantes ont d√©cid√© de faire une pause et de poursuivre les attaques plus pr√®s du matin dans l'espoir que les d√©fenseurs et la surveillance auraient moins de ressources de surveillance et une certaine fatigue. <br><br>  Le matin du deuxi√®me jour, les assaillants ont chang√© de tactique.  Des informations sur une partie de ses employ√©s ont √©t√© publi√©es sur l'un des sites Web de l'entreprise.  Les pirates ont profit√© de ces informations et ont commenc√© √† collecter activement des comptes d'utilisateurs via Exchange (statistiques des tentatives dans la capture d'√©cran). <br><br><img src="https://habrastorage.org/webt/ud/pp/z0/udppz0drbdk_woprerkpwz3xgos.png"><br><br>  Un peu plus tard, des tentatives non s√©curis√©es ont √©t√© faites pour s√©lectionner un mot de passe sur la passerelle VPN, des comptes qui n'√©taient pas dans notre infrastructure ont particip√© √† la brute.  Avec une forte probabilit√©, les attaquants ont tent√© d'utiliser des comptes de l'infrastructure d√©j√† pirat√©e dans l'espoir que les organisateurs les laissaient les m√™mes partout.  En cons√©quence, toute la situation avec la force brute nous a amen√©s √† cr√©er un groupe de tableaux de bord sur les tendances en termes d'authentification des utilisateurs.  De plus, nous avons resserr√© la surveillance des incidents li√©s au succ√®s de la force brute, mais, heureusement, aucun de ces cas n'a √©t√© d√©tect√©. <br><br>  Environ une heure avant la fin du jeu, les tendances ont vu une seule tentative r√©ussie d'authentifier plusieurs utilisateurs, y compris ceux sur Exchange, l'analyse op√©rationnelle a montr√© que les sources √©taient des machines utilisateur directement, la plupart des √©v√©nements ont indiqu√© que les organisateurs se sont connect√©s √† partir de la console VMware Vcenter. <br><br>  Dans le m√™me temps, nous avons enregistr√© une analyse interne √† partir d'un n≈ìud qui s'est connect√© avec succ√®s via VPN.  Apr√®s une analyse op√©rationnelle des √©v√©nements li√©s √† l'incident, il est devenu clair que les attaquants ont pu compromettre les informations d'identification de plusieurs utilisateurs, et √† en juger par l'absence de tentatives d'authentification infructueuses, il est probable que les donn√©es utilisateur aient √©t√© ¬´divulgu√©es¬ª. <br><br>  Des informations ont √©t√© transmises aux d√©fenseurs.  Pendant tout le temps de r√©ponse sur les ordinateurs personnels des utilisateurs compromis, la solution de point de terminaison a √©t√© mise en mode de protection pr√©ventive pour ralentir la capacit√© de prendre pied dans le syst√®me.  Les sessions d'attaque sur la passerelle VPN ont √©t√© abandonn√©es de force et les attaquants ont √©t√© expuls√©s du p√©rim√®tre prot√©g√©.  Dans l'UZ compromise, les mots de passe ont √©t√© rapidement modifi√©s. <br><br>  √Ä ce moment pr√©cis, les gars de l'√©quipe True0xA3 sont mont√©s sur sc√®ne et ont utilis√© avec succ√®s OSINT et ont signal√© le compromis du bureau Behealthy, qui est sous la protection d'une autre √©quipe.  Les attaquants ont r√©ussi √† compromettre l'administrateur du domaine.  Les organisateurs ont √©t√© inform√©s de notre incident et des preuves ont √©t√© fournies. <br><br>  La derni√®re heure a √©t√© particuli√®rement chaude en raison de la soudaine OSINT, tout le monde attendait quelques pr√©paratifs suppl√©mentaires de la part des organisateurs.  L'√©quipe de surveillance, √† son tour, a surveill√© toutes les anomalies et incidents suspects, mais apr√®s une tentative infructueuse de p√©n√©trer de nouvelles tentatives de piratage, elle n'a pas suivi.  Les derni√®res minutes de jeu se sont donc √©coul√©es et le piratage r√©ussi du bureau prot√©g√© par la Jet Security Team n'a pas eu lieu. <br><br>  Et un peu de statistiques finales pour deux jours de jeu: <br><br><ul><li>  1 200 EPS en moyenne et un peu moins de 3 000 EPS au sommet; </li><li>  Environ 7 000 incidents; </li><li>  Plus de 120 millions d'√©v√©nements. </li></ul><br><br><h3>  Facteurs qui nous ont aid√©s √† gagner </h3><br><ul><li>  R√©partition comp√©tente des r√¥les.  Chacun s'est install√© et s'est engag√© dans la plupart de ses activit√©s quotidiennes.  Personne n'a eu √† √©tudier des mat√©riaux de la cat√©gorie des "pare-feu pour les nuls". </li><li>  Profilage op√©rationnel des r√®gles de corr√©lation.  Tous les faux positifs ont √©t√© trait√©s et corrig√©s en fonction des caract√©ristiques de l'infrastructure de jeu. </li><li>  R√©ponse rapide.  √âtant donn√© que plusieurs personnes ont √©t√© affect√©es √† chaque type de SZI et de syst√®mes, nous n'avons eu aucun probl√®me avec le fait que la personne responsable se soit repos√©e ou soit partie pendant quelques minutes.  Toutes les informations issues de la surveillance ont √©t√© trait√©es le plus rapidement possible. </li><li>  Exp√©rience du durcissement et de la surveillance de diverses infrastructures. </li></ul><br>  PS Un merci sp√©cial √† tous ceux qui sont venus et ont pos√© des questions, et nous nous excusons aupr√®s de ceux qui n'ont pas pu dire quelque chose au cours du processus - l'√©quipe attendait des ¬´Cosaques maltrait√©s¬ª des attaquants et n'a pas pu divulguer tous les d√©tails. <br><br>  <i>Dmitry Lifanov, expert au Centre de surveillance et de r√©ponse aux incidents de s√©curit√© de l'information Jet CSIRT</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr454298/">https://habr.com/ru/post/fr454298/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr454284/index.html">D√©sol√©, je ne viendrai pas travailler parce que c'est l'hiver</a></li>
<li><a href="../fr454290/index.html">Principe de responsabilit√© unique. Pas aussi simple qu'il y para√Æt</a></li>
<li><a href="../fr454292/index.html">JS. Proxy. √âcueil √† conna√Ætre</a></li>
<li><a href="../fr454294/index.html">¬´Sans exp√©riences inutiles¬ª, ou comment nous avons lanc√© un acc√©l√©rateur de banque</a></li>
<li><a href="../fr454296/index.html">Comment une √©cole de Porto Rico donne vie √† la chimie avec Minecraft: √âducation</a></li>
<li><a href="../fr454300/index.html">Comment les CTT diff√®rent des caloducs conventionnels et comment les appliquer</a></li>
<li><a href="../fr454302/index.html">Fichiers QVD - contenu</a></li>
<li><a href="../fr454304/index.html">Imprimante Delta 3D √† faire soi-m√™me pour la c√©ramique</a></li>
<li><a href="../fr454306/index.html">Cinq erreurs que j'ai commises en tant que d√©veloppeur principal</a></li>
<li><a href="../fr454308/index.html">AMA avec Habr. V.9.0. Podcast, conf√©rence et concepts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>