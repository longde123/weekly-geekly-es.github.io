<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº üêï üïë Android-Umgebungen üè¥Û†ÅßÛ†Å¢Û†Å∑Û†Å¨Û†Å≥Û†Åø üëá üòû</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vorwort 


 Ab dem fernen Jahr 2012 erinnere ich mich in den offenen R√§umen von Habr an den Kommentar: 
 ... wenn es von Anfang an keinen Fall gibt, b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Android-Umgebungen</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462751/"><h3 id="predislovie">  Vorwort </h3><br><p>  Ab dem fernen Jahr 2012 erinnere ich mich in den offenen R√§umen von Habr an den Kommentar: </p><br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">... wenn es von Anfang an keinen Fall gibt, bleibt das Ger√§t</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">unvollendet, wird Staub auf ein Regal fallen ...</a> </blockquote><p>  Das Thema ist weit entfernt von einer Hardwarekomponente.  Als ich mein Problem analysierte, wurde ich von der Richtigkeit dieses Urteils √ºberzeugt und versuchte, die Dinge in meinem staubigen Regal in Ordnung zu bringen. </p><br><p>  K√ºrzlich wurde ich von einem Kunden angesprochen, der mich bat, seinem Projekt Unterst√ºtzung f√ºr mehrere Dienste hinzuzuf√ºgen.  Die Aufgabe bestand darin, den Dienst "A" zu verbinden und diesen Dienst in einer Testumgebung auszuf√ºhren, bevor die Anwendung in Betrieb genommen wurde.  Ich beschloss, meine fr√ºheren Entscheidungen zu analysieren und ... war entsetzt. </p><br><p>  F√ºr verschiedene Arten von Assemblys habe ich verschiedene Konfigurationsdateien mit der Beschreibung von Umgebungsvariablen verwendet.  Das Problem war jedoch, dass nur um den Wert in den realen Code weiterzuleiten, f√ºr jeden Typ derselbe Code geschrieben werden musste. </p><a name="habracut"></a><br><h3 id="problema">  Das Problem </h3><br><p> Google gibt uns die M√∂glichkeit, benutzerdefinierte Werte f√ºr jeden weiterzuleiten <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Montage</a> . </p><br><pre><code class="plaintext hljs">android { //... buildTypes { release { buildConfigField("String", "HOST_URL", "\"prod.com\"") } debug { buildConfigField("String", "HOST_URL", "\"debug.com\"") } } }</code> </pre> <br><p>  Nach der Analyse des Skripts <strong>build.gradle</strong> √ºbernehmen die Android-Tools alle Werte von <strong>buildConfigFileds</strong> aus <strong>buildTypes</strong> und <strong>productFlavors</strong> und generieren <strong>BuildConfig-</strong> Dateien f√ºr jeden Assembly-Typ: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BuildConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//... // Fields from build type: release public static final String HOST_URL = "prod.com"; }</span></span></code> </pre> <br><p>  Kein Problem auf den ersten Blick.  Besonders wenn Ihre Anwendung nicht so viele Geschmacksrichtungen und benutzerdefinierte Werte enth√§lt.  In meinem Projekt gab es&gt; 20 und 3 Umgebungen (intern / Alpha / Produktion).  Offensichtlich gab es f√ºr mich nur ein Problem - die Kesselplatte loszuwerden. </p><br><p>  Ein ebenso wichtiges Problem ist, dass die Werte von Umgebungsvariablen nicht in Ihrem Projekt ber√ºcksichtigt werden sollten.  Auch in der Konfigurationsdatei.  Sie m√ºssen Ihre <strong>build.gradle-</strong> Konfiguration √ºber VCS √ºberpr√ºfen.  Sie sollten Ihre Schl√ºssel jedoch nicht direkt registrieren. Dazu ben√∂tigen Sie einen Mechanismus eines Drittanbieters (z. B. eine Datei, die Dienste Ihres CI).  In meiner Praxis gab es mehrere Projekte, bei denen ich f√ºr die Release-Produktionsassemblierung keinen Zugriff auf die Werte einiger Bibliotheken hatte.  Dies ist bereits ein Gesch√§ftsproblem und im Interesse, keine unn√∂tigen Kosten zu verursachen.  Sie sollten beim Debuggen oder beim internen Testen keine f√ºr die Produktion bestimmten Schl√ºssel verwenden. </p><br><h3 id="sposob-resheniyaproblemy">  Weg, um das Problem zu l√∂sen </h3><br><p>  In einem der alten Projekte haben wir zum Speichern der Werte von Umgebungsvariablen einfache <strong>.properties-</strong> Dateien verwendet, die den Zugriff auf die Felder √ºber die klassische key: value-Zuordnung erm√∂glichten.  Dieser Ansatz l√∂st das Bindungsproblem nicht.  Aber es l√∂st das Problem der Datenlieferung, das angewendet werden sollte.  Dar√ºber hinaus k√∂nnen wir <strong>.properties-</strong> Dateien als Grundlage f√ºr eine bestimmte Art von Datenbereitstellungsvertrag verwenden. </p><br><p>  Wenn wir ein wenig zur√ºckgehen, haben wir einen Zwischenschritt: von <strong>buildConfigField</strong> zum Feld der <strong>BuildConfig-</strong> Klasse.  Aber wer macht das?  Alles ist ziemlich kitschig, das Gradle-Plugin, das Sie in allen Android-Projekten absolut verbinden, ist daf√ºr verantwortlich. </p><br><pre> <code class="plaintext hljs">apply plugin: "com.android.application"</code> </pre> <br><p>  Er ist daf√ºr verantwortlich, dass nach der Analyse Ihrer <strong>build.gradle-</strong> Datei die <strong>BuildConfig-</strong> Klasse f√ºr jede <strong>Variante</strong> mit eigenen Feldern generiert wird.  Auf diese Weise kann ich meine eigene Medizin schreiben, die die Funktionen von <strong>com.android.application erweitert</strong> und speichert <br>  mich von diesen Kopfschmerzen. </p><br><p>  Die L√∂sung des Problems lautet wie folgt: Bereitstellung eines Vertrags, <br>  Hier werden alle Schl√ºssel und Werte f√ºr alle Assemblys beschrieben. <br>  Erweitern Sie Konfigurationsdateien in Untertypen.  Gib alles zum Plugin. </p><br><img src="https://drive.google.com/uc?id=10GEI-k-zG2JLOWQ1pNkRqLur7g3yKAE3" alt="Zeichnen" width="800"><br><h3 id="reshenie">  L√∂sung </h3><br><p>  Oben haben wir die Struktur der L√∂sung herausgefunden. Das einzige, was wir noch tun m√ºssen, ist, alles zum Leben zu erwecken.  Es scheint, dass eine triviale L√∂sung und ein Problem durch eine einfache Dateierweiterung gel√∂st werden k√∂nnen.  Anfangs habe ich das getan. </p><br><div class="spoiler">  <b class="spoiler_title">L√∂sung enth√ºllen</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">```groovy class Constants { // Environments properties path pattern, store your config files in each folders of pattern static final CONFIG_PROPERTY_PATTERN = "config/%s/config.properties" } android.buildTypes.all { buildType -&gt; buildConfigFields(buildType, buildType.name) } android.applicationVariants.all { appVariant -&gt; buildConfigFields(appVariant, appVariant.flavorName) } private def buildConfigFields(Object variant, String variantName) { def properties = getProperties(variantName) properties.each { key, value -&gt; variant.buildConfigField( parseValueType(value), toConfigKey(key), value ) } } // Convert config property key to java constant style private def toConfigKey(String key) { return key.replaceAll("(\\.)|(-)", "_") .toUpperCase() } // Parse configuration value type private def parseValueType(String value) { if (value == null) { throw new NullPointerException("Missing configuration value") } if (value =~ "[0-9]*L" ) { return "Long" } if (value.isInteger()) { return "Integer" } if (value.isFloat()) { return "Float" } if ("true" == value.toLowerCase() || "false" == value.toLowerCase()) { return "Boolean" } return "String" } private def getProperties(String variantName) { def propertiesPath = String.format( Constants.CONFIG_PROPERTY_PATTERN, variantName ) def propertiesFile = rootProject.file(propertiesPath) def properties = new Properties() // Do nothing, when configuration file doesn't exists if (propertiesFile.exists()) { properties.load(new FileInputStream(propertiesFile)) } return properties } ```</code> </pre> </div></div><br><p>  Und hier traten sofort diese Schwierigkeiten auf, an die ich nicht gedacht hatte - ein staubiges Regiment. Ich beschloss, meine Entscheidung an meine Kollegen zu "verkaufen".  Ich habe ein Dock vorbereitet, die Angelegenheit zur Diskussion gestellt und ... Ich habe festgestellt, dass wir alle Menschen sind und Programmierer faule Menschen.  Niemand m√∂chte einen ihm unbekannten Code in das Projekt einbetten. Muss er studiert und endg√ºltig gelesen werden?  Was ist, wenn er nicht arbeitet?  Was ist, wenn er etwas anderes falsch macht?  Das ist gro√üartig, aber ich kenne ihn nicht und es ist nicht klar, wie ich mit ihm arbeiten soll.  Und ein Skript ist schon lange nach Kotlin gezogen, und ich kann nicht aus Grooves portieren und so weiter. </p><br><p>  Das Interessanteste ist, dass all diese Urteile bereits von mir stammen, weil  Mir wurde klar, dass eine solche Integration der L√∂sung nicht zu mir passt.  Au√üerdem habe ich einige Punkte bemerkt, die ich wirklich verbessern m√∂chte.  Nachdem ich die L√∂sung in Projekt A implementiert habe, m√∂chte ich sie in Projekt B unterst√ºtzen. Es gibt nur einen Ausweg - Sie m√ºssen ein Plug-In schreiben. </p><br><p>  Und welche Probleme werden das Plug-In und seine Remote-Lieferung an den Benutzer l√∂sen? </p><br><ul><li>  das Problem eines faulen Programmierers.  Wir sind zu faul, um die Wurzel des Problems und m√∂gliche L√∂sungswege zu untersuchen.  Es ist f√ºr uns viel einfacher, etwas, das bereits vor Ihnen erledigt wurde, zu verwenden. </li><li>  Unterst√ºtzung.  Es umfasst Code-Unterst√ºtzung, die Entwicklung und Erweiterung von M√∂glichkeiten.  Bei der L√∂sung meines Problems habe ich nur probrosvarivnyh-Umgebungen nur im Code gel√∂st und dabei die M√∂glichkeit der Weiterleitung an Ressourcen v√∂llig vergessen. </li><li>  Codequalit√§t.  Es gibt eine Meinung, dass einige Entwickler nicht einmal Open Source Code betrachten, der nicht durch Tests abgedeckt wird.  Es ist 2019 und wir k√∂nnen problemlos Dienste verbinden, um die Qualit√§t des Codes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://sonarcloud.io</a> oder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://codecov.io/</a> zu verfolgen. </li><li>  Konfiguration.  Die Build-Dateierweiterung zwingt mich, diesen Code zu untersuchen und √Ñnderungen manuell vorzunehmen.  In meinem Fall muss ich die Konfiguration nicht immer f√ºr <strong>buildTypes</strong> oder <strong>productFlavors verwenden</strong> , ich m√∂chte eine Sache oder alle gleichzeitig. </li><li>  staubige Regalreinigung.  Ich habe endlich einen von ihnen aufger√§umt und konnte diese Entscheidung meines kleinen Zimmers f√∂rdern. </li></ul><br><p>  Ich werde beim Schreiben des Plugins nicht auf Details und Probleme eingehen, sondern ein neues Thema ansprechen.  Sie k√∂nnen mit seiner Integration eine Entscheidung treffen, Ihre Idee vorschlagen oder Ihren Beitrag leisten <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de462751/">https://habr.com/ru/post/de462751/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de462737/index.html">Opencart-Integration in Buchhaltungssysteme</a></li>
<li><a href="../de462739/index.html">Spieleindustrie-Konferenz GAMEDEV.HOUSE</a></li>
<li><a href="../de462743/index.html">Moscow SPA Meetup # 5 - Ank√ºndigung des Treffens</a></li>
<li><a href="../de462747/index.html">Ich habe diesen Artikel geschrieben, ohne jemals auf die Tastatur zu schauen</a></li>
<li><a href="../de462749/index.html">Gl√ºcksmanagement: Pflege und Entwicklung eines Home-Office-Teams aus √ºber 30 St√§dten</a></li>
<li><a href="../de462753/index.html">Die Kraft der Generika in Swift. Teil 1</a></li>
<li><a href="../de462755/index.html">Asynchroner Stream in C # 8</a></li>
<li><a href="../de462763/index.html">GAZ-66 Spielzeug auf dem Bedienfeld. Teil 3</a></li>
<li><a href="../de462765/index.html">ONYX BOOX Note Pro-Test: PDF-Reader der Spitzenklasse</a></li>
<li><a href="../de462769/index.html">Anwendung von maschinellem Lernen und Datenwissenschaft in der Industrie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>