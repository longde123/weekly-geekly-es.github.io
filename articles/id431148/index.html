<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶É ‚öíÔ∏è üí∑ Perusahaan Seluler iOS Baru. Bagian # 1: Pembuatan Kode untuk Sumber Daya üçû ‚úèÔ∏è üîó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya! 


 Nama saya Dmitry. Kebetulan saya adalah pemimpin tim di tim 13 pengembang iOS selama dua tahun terakhir. Dan bersama-sama kami beke...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Perusahaan Seluler iOS Baru. Bagian # 1: Pembuatan Kode untuk Sumber Daya</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/431148/"><h4 id="vsem-privet">  Halo semuanya! </h4><br><p>  Nama saya Dmitry.  Kebetulan saya adalah pemimpin tim di tim 13 pengembang iOS selama dua tahun terakhir.  Dan bersama-sama kami bekerja pada aplikasi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tinkoff Business</a> . </p><br><p>  Saya ingin berbagi dengan Anda pengalaman kami tentang cara merilis aplikasi pada saat yang tidak terduga dengan set fitur maksimum atau perbaikan bug dan masih belum menjadi abu-abu. </p><br><p>  Saya akan memberi tahu Anda tentang praktik dan pendekatan yang membantu tim secara signifikan mempercepat pengembangan dan pengujian dan secara signifikan mengurangi jumlah stres, bug, masalah dengan rilis yang tidak dijadwalkan atau mendesak.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">#MakeReleaseWithoutStress</a> . </p><br><h4 id="poehali">  Ayo pergi! </h4><a name="habracut"></a><br><h2 id="opisanie-problemy">  Deskripsi masalah </h2><br><p>  Bayangkan situasi berikut. </p><br><p>  Ada rilis lain.  Itu didahului oleh pengujian regresi, penguji kembali menemukan tempat di mana alih-alih teks dalam aplikasi, ID baris ditampilkan. </p><br><img src="https://habrastorage.org/webt/s6/-u/qv/s6-uqv5rwcnqkxwlyzdhrphfamu.png" alt="Bug pelokalan" width="100%"><br><p>  Ini adalah salah satu masalah kami yang paling sering kami temui. </p><br><p>  Anda mungkin tidak mengalami masalah ini jika Anda tidak memiliki aplikasi yang dilokalkan dalam bahasa lain, atau semua pelokalan ditulis langsung dalam kode tanpa menggunakan file Localizable.strings. </p><br><p>  Tetapi Anda mungkin menghadapi masalah lain yang kami akan bantu Anda selesaikan: </p><br><ul><li>  Aplikasi macet karena Anda salah menentukan nama gambar dan membuat paksa membuka <br><pre><code class="plaintext hljs">UIImage(named: "NotExist")!</code> </pre> </li><li>  Aplikasi macet jika storyboard tidak ditambahkan ke target </li><li>  Aplikasi macet jika Anda membuat pengontrol dari storyboard dengan ID yang tidak ada </li><li>  Aplikasi macet jika Anda membuat pengontrol dari storyboard dengan ID yang ada, tetapi dilemparkan ke kelas yang salah </li><li>  Perilaku yang tidak dapat diprediksi jika Anda menggunakan font dalam kode yang tidak ditambahkan ke info.plist, atau jika file font tidak ditandai dengan target: crash dimungkinkan, atau dimungkinkan untuk mendapatkan font standar alih-alih yang Anda butuhkan.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pengembang Apple: Font Kustom</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Stackoverflow: crash</a> </li><li>  Aplikasi macet jika storyboard menunjukkan ke controller kelas yang tidak ada </li><li>  Sekelompok kode monoton yang membuat ikon, font, pengontrol, tampilan </li><li>  Tidak ada gambar, ikon dalam runtime, meskipun nama gambar ada di storyboard, tetapi tidak dalam aset </li><li>  Papan cerita menggunakan font yang tidak ada di info.plist </li><li>  ID baris muncul di aplikasi, alih-alih dilokalkan di tempat yang tak terduga, karena menghapus garis di Localizable.strings (menganggapnya tidak digunakan) </li><li>  Hal lain yang saya lupa sebutkan, atau belum kita jumpai. </li></ul><br><h2 id="prichina--sledstvie">  Alasan ‚Üí Efek </h2><br><p>  Mengapa ini semua terjadi? </p><br><p>  Ada kode program yang mengkompilasi.  Jika Anda menulis sesuatu yang salah (secara sintaksis, atau nama fungsi yang salah saat memanggil), maka proyek Anda tidak akan dirakit.  Ini bisa dimengerti, jelas dan logis. </p><br><p>  Tetapi bagaimana dengan hal-hal seperti sumber daya? </p><br><p>  Mereka tidak dikompilasi, mereka hanya ditambahkan ke bundel setelah kode dikompilasi.  Dalam hal ini, sejumlah besar masalah dapat terjadi dalam runtime, misalnya, kasus yang dijelaskan di atas - dengan string dalam pelokalan. </p><br><h2 id="poisk-resheniya">  Cari solusinya </h2><br><p>  Kami berpikir tentang bagaimana masalah tersebut diselesaikan secara umum, dan bagaimana kami dapat memperbaikinya.  Saya ingat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">salah satu konferensi Cocoaheads di mail.ru.</a>  Ada pembicaraan tentang membandingkan alat pembuat kode. </p><br><p>  Setelah melihat sekali lagi apa alat-alat ini (perpustakaan / kerangka kerja) tentang semua, kami akhirnya menemukan apa yang dibutuhkan. </p><br><p>  Pada saat yang sama, pendekatan serupa telah digunakan oleh pengembang untuk Android selama bertahun-tahun.  Google memikirkan mereka dan menjadikannya alat yang luar biasa.  Tetapi Apple, bahkan Xcode stabil, tidak dapat melakukan ... </p><br><p>  Yang tersisa hanyalah mencari tahu instrumen mana yang harus dipilih: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Natalie</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SwiftGen</a> atau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">R.swift</a> ? </p><br><p>  Natalie tidak memiliki dukungan pelokalan, diputuskan untuk segera meninggalkannya.  SwiftGen dan R.swift memiliki kemampuan yang sangat mirip.  Kami memilih R.swift, hanya berdasarkan jumlah bintang, mengetahui bahwa setiap saat kami dapat berubah ke SwiftGen. </p><br><h2 id="kak-rabotaet-rswift">  Bagaimana R.swift bekerja </h2><br><p>  Skrip tahap pembuatan pra-kompilasi diluncurkan, dijalankan melalui struktur proyek dan menghasilkan file bernama <code>R.generated.swift</code> , yang perlu ditambahkan ke proyek (kami akan memberi tahu Anda lebih lanjut tentang cara melakukan ini di akhir). </p><br><p>  File memiliki struktur berikut: </p><br><pre> <code class="plaintext hljs">import Foundation import Rswift import UIKit /// This `R` struct is generated and contains references to static resources. struct R: Rswift.Validatable { fileprivate static let applicationLocale = hostingBundle.preferredLocalizations.first.flatMap(Locale.init) ?? Locale.current fileprivate static let hostingBundle = Bundle(for: R.Class.self) static func validate() throws { try intern.validate() } // ... /// This `R.string` struct is generated, and contains static references to 2 localization tables. struct string { /// This `R.string.localizable` struct is generated, and contains static references to 1196 localization keys. struct localizable { /// en translation:  Apple Pay /// /// Locales: en, ru static let card_actions_activate_apple_pay = Rswift.StringResource(key: "card_actions_activate_apple_pay", tableName: "Localizable", bundle: R.hostingBundle, locales: ["en", "ru"], comment: nil) // ... /// en translation:  Apple Pay /// /// Locales: en, ru static func card_actions_activate_apple_pay(_: Void = ()) -&gt; String { return NSLocalizedString("card_actions_activate_apple_pay", bundle: R.hostingBundle, comment: "") } } } }</code> </pre> <br><p>  Penggunaan: </p><br><pre> <code class="plaintext hljs">let str = R.string.localizable.card_actions_activate_apple_pay() print(str) &gt;  Apple Pay</code> </pre> <br><p>  "Mengapa <code>Rswift.StringResource</code> membutuhkan <code>Rswift.StringResource</code> ?", Anda bertanya.  Saya sendiri tidak mengerti mengapa membuatnya, tetapi, seperti yang penulis jelaskan, diperlukan untuk yang berikut: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tautan</a> . </p><br><h2 id="primenenie-v-realnyh-usloviyah">  Aplikasi dunia nyata </h2><br><p>  Penjelasan kecil dari konten di bawah ini: </p><br><p>  * Itu - mereka menggunakan pendekatan untuk sementara waktu, pada akhirnya, mereka meninggalkannya <br>  * Ini telah menjadi - pendekatan yang kita gunakan saat menulis kode baru <br>  * Itu tidak, tetapi Anda dapat memilikinya - suatu pendekatan yang tidak pernah ada dalam aplikasi kami, tetapi saya bertemu di berbagai proyek, pada saat-saat yang jauh, ketika saya belum bekerja di Tinkoff.ru. </p><br><h4 id="localization">  Lokalisasi </h4><br><p>  Kami mulai menggunakan <code>R.swift</code> untuk pelokalan, ini menyelamatkan kami dari masalah yang kami tulis di awal.  Sekarang, jika id di lokalisasi telah berubah, maka proyek tidak akan dirakit. </p><br><p>  * Ini hanya berfungsi jika Anda mengubah id di semua pelokalan ke yang lain.  Jika string tetap berada di salah satu pelokalan, maka pada saat kompilasi akan ada peringatan bahwa id ini tidak dilokalkan dalam semua bahasa. </p><br><img src="https://habrastorage.org/webt/b4/ab/mh/b4abmhdhewhco-azpem4ab-ochy.png" alt="Peringatan" width="40%"><br><br><div class="spoiler">  <b class="spoiler_title">Tidak di sana, tetapi Anda mungkin memiliki:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">final class NewsViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() titleLabel.text = NSLocalizedString("news_title", comment: "News title") } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Itu:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">extension String { public func localized(in bundle: Bundle = .main, value: String = "", comment: String = "") -&gt; String { return NSLocalizedString(self, tableName: nil, bundle: bundle, value: value, comment: comment) } } final class NewsViewController: UIViewController { private enum Localized { static let newsTitle = "news_title".localized() } override func viewDidLoad() { super.viewDidLoad() titleLabel.text = Localized.newsTitle } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Itu menjadi:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">titleLabel.text = R.string.localizable.newsTitle()</code> </pre> </div></div><br><h4 id="images">  Gambar </h4><br><p>  Sekarang, jika kita mengganti nama sesuatu di * .xcassets, dan tidak mengubah kode, maka proyek tidak akan dirakit. </p><br><div class="spoiler">  <b class="spoiler_title">Itu:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">imageView.image = UIImage(named: "NotExist") //     imageView.image = UIImage(named: "NotExist")! // crash imageView.image = #imageLiteral(resourceName: "NotExist") // crash</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Itu menjadi:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">imageView.image = R.image.tinkoffLogo() //    </code> </pre> </div></div><br><h4 id="storyboards">  Papan cerita </h4><br><div class="spoiler">  <b class="spoiler_title">Itu:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">let someStoryboardName = "SomeStoryboard" // Change to something else (eg: "somestoryboard") - get nil or crash in else let someVCIdentifier = "SomeViewController" // Change to something else (eg: "someviewcontroller") - get nil or crash in else let storyboard = UIStoryboard(name: someStoryboardName, bundle: .main) let _vc = storyboard.instantiateViewController(withIdentifier: someVCIdentifier) guard let vc = _vc as? SomeViewController else { //    -  ,  Fabric  Firebase //    fatalError() ¬Ø\_(„ÉÑ)_/¬Ø}</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Itu menjadi:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">guard let vc = R.storyboard.someStoryboard.someViewController() else { //    -  ,  Fabric  Firebase //    fatalError() ¬Ø\_(„ÉÑ)_/¬Ø }</code> </pre> </div></div><br><p>  Dan sebagainya. </p><br><h4 id="validaciya-storyboard">  Storyboard Validasi </h4><br><p>  <a href="">R.validate ()</a> adalah alat yang luar biasa yang mengalahkan tangan (atau lebih tepatnya, hanya melempar kesalahan ke dalam catch block) jika Anda melakukan sesuatu yang salah di storyboard atau file xib. <br>  Sebagai contoh: </p><br><ul><li>  Menunjukkan nama gambar, yang tidak ada dalam proyek </li><li>  Mereka menunjukkan font, dan kemudian berhenti menggunakannya dan menghapusnya dari proyek (dari info.plist) </li></ul><br><p>  Penggunaan: </p><br><pre> <code class="plaintext hljs">final class AppDelegate: UIResponder { func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]? = nil) -&gt; Bool { #if DEBUG do { try R.validate() } catch { //   fatalError      //        debug        //  -   ,                 production fatalError(error.localizedDescription) } #endif return true } }</code> </pre> <br><h4 id="i-vot-vy-uzhe-gotovy-kupit-dva">  Dan sekarang Anda siap membeli dua! </h4><br><img src="https://habrastorage.org/webt/7x/m3/4q/7xm34quvznbr0zo761iqdhs7jgu.jpeg" alt="Diam dan ambil uangku!" width="40%"><br><br><h2 id="kak-vnedryat">  Bagaimana cara mengimplementasikannya? </h2><br><p>  * Sistem berbasis komponen - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">wiki</a> , konsep pengembangan kode di mana komponen (satu set layar / modul dihubungkan bersama) dikembangkan di lingkungan tertutup (dalam kasus kami, di pod lokal) untuk mengurangi koherensi basis kode.  Banyak orang tahu pendekatan di backend, yang didasarkan pada konsep ini - layanan microser. </p><br><p>  * Monolith - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">wiki</a> , konsep pengembangan kode, di mana seluruh basis kode terletak pada satu repositori, dan kode tersebut terkait erat.  Konsep ini cocok untuk proyek-proyek kecil dengan serangkaian fungsi yang terbatas. </p><br><p>  Jika Anda sedang mengembangkan aplikasi monolitik atau hanya menggunakan dependensi pihak ketiga, maka Anda beruntung (tetapi ini tidak akurat).  Ikuti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tutorial</a> dan lakukan semuanya dengan ketat. </p><br><p>  Ini bukan kasus kami.  Kami terlibat.  Karena kami menggunakan sistem berbasis komponen, <code></code> menanamkan R.swift di aplikasi utama, kami memutuskan untuk menanamkannya di pod lokal (yang merupakan komponen). </p><br><p>  Karena pembaruan pelokalan, gambar, dan semua elemen yang memengaruhi file R.generated.swift, ada banyak konflik dalam file yang dihasilkan saat digabungkan ke cabang umum.  Dan untuk menghindari ini, Anda harus menghapus R.generated.swift dari repositori git.  Penulis juga <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">merekomendasikan untuk melakukan ini</a> . </p><br><p>  Tambahkan baris berikut ke <code>.gitignore</code> . </p><br><pre> <code class="plaintext hljs"># R.Swift generated files *.generated.swift</code> </pre> <br><p>  Selain itu, jika Anda tidak ingin membuat kode untuk beberapa sumber daya, Anda selalu dapat menggunakan mengabaikan file individual atau seluruh folder: </p><br><pre> <code class="plaintext hljs">"${PODS_ROOT}/R.swift/rswift" generate "${SRCROOT}/Example" "--rswiftignore" "Example/.rswiftignore"</code> </pre> <br><p>  <a href="">deskripsi .rswiftignore</a> </p><br><p>  Seperti dalam proyek utama, penting bagi kita untuk tidak menambahkan file R.generated.swift dari pod lokal ke repositori git.  Kami mulai mempertimbangkan opsi bagaimana hal ini dapat dilakukan: </p><br><ul><li>  alias pada R.generated.swift sehingga file (alias, misalnya: R.swift) ditambahkan ke proyek, dan kemudian, ketika mengkompilasi dengan referensi, file nyata tersedia.  Tapi cocoapod itu pintar, dan tidak diizinkan melakukannya </li><li>  di podspec pada fase pra-kompilasi, tambahkan file R.generated.swift ke proyek itu sendiri menggunakan skrip, tetapi kemudian akan ditambahkan hanya sebagai file dalam sistem file, dan file tersebut tidak akan muncul dalam proyek </li><li>  Pilihan lainnya kurang lebih rapi </li><li><p>  sihir di podfile </p><br><div class="spoiler">  <b class="spoiler_title">Ajaib</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/jk/fg/lt/jkfgltwqbhucchythactmnyrnrk.jpeg" alt="Ajaib" width="40%"><br><br><pre> <code class="ruby hljs">pre_install <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|installer|</span></span> installer.pod_targets.flat_map <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|pod_target|</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pod_target.pod_target_srcroot.<span class="hljs-keyword"><span class="hljs-keyword">include</span></span>? <span class="hljs-string"><span class="hljs-string">'LocalPods'</span></span> <span class="hljs-comment"><span class="hljs-comment">#           LocalPods,     ,   pod_target_srcroot = pod_target.pod_target_srcroot #   pod_target_path = pod_target_srcroot.sub('${PODS_ROOT}/..', '.') #       pod_target_sources_path = pod_target_path + '/' + pod_target.name + '/Sources' #     Sources generated_file_path = pod_target_sources_path + '/R.generated.swift' #     R.generated.swift File.new(generated_file_path, 'w') #    R.generated.swift      end end end</span></span></code> </pre> <br></div></div><br></li></ul><br><ul><li>  dan opsi lain ... masih menambahkan R.generated.swift ke git </li></ul><br><p>  Kami sementara memilih opsi: "magic in the Podfile", meskipun faktanya ada beberapa kekurangan: </p><br><ul><li>  Itu hanya dapat diluncurkan dari root proyek (meskipun cocoapods dapat diluncurkan dari hampir semua folder dalam proyek) </li><li>  Semua pod harus memiliki folder bernama Sumber (walaupun ini tidak penting jika podnya sudah beres) </li><li>  Dia aneh dan tidak bisa dipahami, tetapi cepat atau lambat dia harus mendukung (ini masih penopang) </li><li>  Jika beberapa pustaka pihak ketiga ada di folder dengan ‚ÄúLocalPods‚Äù di jalurnya, maka itu akan mencoba untuk menambahkan file R.generated.swift di sana atau akan crash dengan kesalahan </li></ul><br><h4 id="prepare_command">  prep_command </h4><br><p>  Hidup beberapa lama dengan naskah dan penderitaan, saya memutuskan untuk mempelajari topik ini lebih luas dan menemukan pilihan lain. <br>  Di Podspec ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">prep_command</a> , yang dimaksudkan hanya untuk membuat dan memodifikasi sumber, yang kemudian akan ditambahkan ke proyek. </p><br><p>  * Berita - nama pod, yang harus diganti dengan nama pod lokal Anda <br>  * sentuh - perintah untuk membuat file.  Argumen adalah jalur relatif ke file (termasuk nama file dengan ekstensi) </p><br><p>  Selanjutnya kita akan melakukan penipuan dengan News.podspec </p><br><p>  Script ini disebut pertama kali <code>pod install</code> dijalankan dan menambahkan file yang kita butuhkan ke folder sumber di perapian. </p><br><pre> <code class="ruby hljs">Pod::Spec.new <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|s|</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... generated_file_path = "News/Sources/R.generated.swift" s.prepare_command = &lt;&lt;-CMD touch "#{generated_file_path}" CMD # ... end</span></span></code> </pre> <br><p>  Berikutnya adalah "tipuan dengan telinga" - kita perlu membuat panggilan ke skrip R.swift untuk perapian lokal. </p><br><pre> <code class="ruby hljs">Pod::Spec.new <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|s|</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... s.dependency 'R.swift' r_swift_script = '"${PODS_ROOT}/R.swift/rswift" generate "${PODS_TARGET_SRCROOT}/News/Sources"' s.script_phases = [ { :name =&gt; 'R.swift', :script =&gt; r_swift_script, :execution_position =&gt; :before_compile } ] end</span></span></code> </pre> <br><p>  Benar, ada satu "tetapi."  <code>prepare_command</code> tidak berfungsi dengan pod lokal, atau lebih tepatnya berfungsi, tetapi dalam beberapa kasus khusus.  Ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">diskusi tentang topik ini di Github</a> . </p><br><h4 id="fatality">  Kematian </h4><br><p>  * Fatality - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">wiki</a> , hit terakhir di Mortal Kombat. </p><br><p>  Setelah sedikit riset, saya menemukan solusi lain - gabungan dari pendekatan c <code>prepare_command</code> dan <code>pre_install</code> . </p><br><p>  Modifikasi kecil sihir dari Podfile: </p><br><pre> <code class="ruby hljs">pre_install <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|installer|</span></span> <span class="hljs-comment"><span class="hljs-comment"># map development pods installer.development_pod_targets.each do |target| # get only main spec and exclude subspecs spec = target.non_test_specs.first # get full podspec file path podspec_file_path = spec.defined_in_file # get podspec dir path pod_directory = podspec_file_path.parent # check if path contains local pods directory # exclude development but non local pods local_pods_directory_name = "LocalPods" if pod_directory.to_s.include? local_pods_directory_name # go to pod root directorty and run prepare command in sub-shell system("cd \"#{pod_directory}\"; #{spec.prepare_command}") end end end</span></span></code> </pre> <br><p>  Dan skrip yang sama yang tidak berjalan untuk perapian lokal </p><br><pre> <code class="ruby hljs">Pod::Spec.new <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|s|</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... s.dependency 'R.swift' generated_file_path = "News/Sources/R.generated.swift" s.prepare_command = &lt;&lt;-CMD touch "#{generated_file_path}" CMD r_swift_script = '"${PODS_ROOT}/R.swift/rswift" generate "${PODS_TARGET_SRCROOT}/News/Sources"' s.script_phases = [ { :name =&gt; 'R.swift', :script =&gt; r_swift_script, :execution_position =&gt; :before_compile } ] end</span></span></code> </pre> <br><p>  Pada akhirnya, itu berfungsi seperti yang kita harapkan. </p><br><p>  Akhirnya! </p><br><p>  PS: </p><br><p>  Saya mencoba membuat perintah kustom lain alih-alih <code>prepare_command</code> , tetapi <code>pod lib lint</code> (perintah untuk memvalidasi konten podspec dan perapian sendiri) bersumpah pada variabel tambahan dan tidak lulus. </p><br><h4 id="nelokalnye-pody">  Perapian non-lokal </h4><br><p>  Di pod jarak jauh (yang masing-masing di repositori mereka sendiri), Anda tidak memerlukan semua keajaiban skrip ini, yang dijelaskan di atas, karena di sana basis kode terikat erat dengan versi ketergantungan. </p><br><p>  Cukup dengan menanamkan Contoh (proyek yang dihasilkan setelah pod lib membuat perintah &lt;Name&gt;) skrip R.swift itu sendiri dan menambahkan R.generated.swift ke paket pustaka (bawah).  Jika proyek tidak memiliki Contoh, maka Anda harus menulis skrip yang akan mirip dengan yang saya kutip. </p><br><p>  PS: </p><br><p>  Ada klarifikasi kecil: <br>  R.swift + Xcode 10 + sistem build baru + build inkremental! = &lt;3 <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Informasi lebih lanjut tentang masalah di halaman utama perpustakaan</a> atau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di sini</a> <br>  R.swift v4.0.0 tidak bekerja dengan cocoapods 1.6.0 :( <br>  Saya pikir segera semua masalah akan diperbaiki. </p><br><h2 id="vyvod">  Kesimpulan </h2><br><p>  Anda selalu perlu menjaga kualitas bar setinggi mungkin.  Ini sangat penting untuk aplikasi yang bekerja dengan keuangan. </p><br><p>  Dalam hal ini, Anda tidak perlu membebani pengujian dan menemukan bug sedini mungkin.  Dalam kasus kami, ini adalah saat pengembang menyusun kode, atau saat uji coba untuk Tarik Permintaan.  Dengan demikian, kami menemukan kurangnya lokalisasi bukan oleh tatapan penuh perhatian dari penguji atau oleh tes otomatis, tetapi oleh proses yang biasa membangun aplikasi. </p><br><p>  Anda juga perlu mempertimbangkan fakta bahwa ini adalah alat pihak ketiga yang terkait dengan struktur proyek dan mem-parsing isinya.  Jika struktur file proyek berubah, maka alat harus diubah. <br>  Kami mengambil risiko ini dan, dalam hal ini, selalu siap untuk mengubah alat ini ke yang lain atau menulis milik Anda sendiri. </p><br><p>  Dan keuntungan dari R.swift adalah sejumlah besar jam kerja yang dapat dihabiskan tim untuk hal-hal yang jauh lebih penting: fitur baru, solusi teknis baru, peningkatan kualitas, dan sebagainya.  R.swift sepenuhnya mengembalikan jumlah waktu yang dihabiskan untuk integrasinya, bahkan dengan mempertimbangkan kemungkinan penggantiannya di masa depan dengan solusi serupa lainnya. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">R. cepat</a> </p><br><h2 id="bonus">  Bonus </h2><br><p>  Anda dapat bermain-main dengan contoh untuk segera melihat dengan mata kepala sendiri keuntungan dari pembuatan kode untuk sumber daya.  Kode sumber proyek "untuk bermain-main": <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GitHub</a> . </p><br><h4 id="spasibo-ogromnoe-chto-prochitali-statyu-ili-zhe-prosto-dolistali-do-etogo-mesta-mne-v-lyubom-sluchae-priyatno">  Terima kasih banyak untuk membaca artikel atau hanya pergi ke tempat ini, saya senang dalam hal apapun) </h4><br><h4 id="thats-all">  Itu saja. </h4></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id431148/">https://habr.com/ru/post/id431148/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id431138/index.html">Biometrik dengan Kunci Rostelecom: bagaimana FSB pertama kali meluncurkan kriptografi Rusia di toko aplikasi</a></li>
<li><a href="../id431140/index.html">Laporan dari metapa Go in Production: video, foto, presentasi</a></li>
<li><a href="../id431142/index.html">Bagaimana menjalankan Trace Profiler SQL di malam hari, pada waktu tertentu?</a></li>
<li><a href="../id431144/index.html">Far Fields mic (Mic array) - pahlawan yang tidak mencolok di kolom pintar</a></li>
<li><a href="../id431146/index.html">1. Periksa Log Analisis Titik: Aplikasi Titik Periksa resmi untuk Splunk</a></li>
<li><a href="../id431152/index.html">Metro 4 adalah perjalanan 6 tahun. Sejarah Singkat Metro UI CSS</a></li>
<li><a href="../id431154/index.html">Kekurangan dalam misi Fallout 76 memungkinkan pemain untuk membuat neraka nuklir</a></li>
<li><a href="../id431156/index.html">SHOCK! Perangkat lunak phishing baru memenangkan faktor kedua</a></li>
<li><a href="../id431158/index.html">Lebih banyak kopi, lebih sedikit kafein: Intel 9th ‚Äã‚ÄãGen (bagian 2)</a></li>
<li><a href="../id431160/index.html">Bukan peluang tunggal untuk lawan - kami mengadopsi keyboard HyperX Alloy FPS RGB yang sangat cepat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>