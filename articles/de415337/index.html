<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🈵 🚒 🚾 Wie Pusher-Kanäle bereits 10.000.000.000.000 Nachrichten übermittelten 🤛🏻 🚛 ☕️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo! Ich bin kürzlich auf eine ziemlich interessante Beschreibung der Architektur von Pusher Channels gestoßen und habe beschlossen, sie für Sie zu ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie Pusher-Kanäle bereits 10.000.000.000.000 Nachrichten übermittelten</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415337/"><p> <em>Hallo!</em>  <em>Ich bin kürzlich auf eine ziemlich interessante Beschreibung der Architektur von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Pusher Channels gestoßen</a> und habe beschlossen, sie für Sie zu übersetzen.</em>  <em>Meiner Meinung nach hat der Autor Ansätze zum Aufbau einer hoch geladenen und skalierbaren Architektur sehr leicht beschrieben.</em>  <em>Der Artikel wird höchstwahrscheinlich sowohl für Anfänger als auch für Spezialisten aus verwandten Bereichen nützlich sein.</em> </p><br><p>  Im Pusher-Büro haben wir einen kleinen Schalter mit einer ständig wachsenden Anzahl.  Es zeigt die Anzahl der zugestellten Nachrichten für die gesamte Existenz von Pusher-Kanälen.  Am Freitag um 22:20 UTC stieg die Zahl um eine Kategorie und erreichte 10.000.000.000.000.  Es hat 13 Nullen - 10 Billionen. </p><br><p><img src="https://habrastorage.org/webt/za/kb/dw/zakbdwmmhgz5p8hg5oxvhbi-jdc.jpeg"></p><br><p>  Sie könnten denken, dass die Gesamtzahl der Nachrichten eine nutzlose, aufgedunsene Metrik ist.  Diese Zahl ist jedoch ein Schlüsselindikator für den Erfolg von Pusher Channels, unserem Echtzeit-Kommunikationsprodukt.  Erstens spiegelt dieser Zähler das Vertrauen wider, das uns die Benutzer entgegenbringen.  Zweitens misst es die Skalierbarkeit unseres Systems.  Um die Anzahl zu erhöhen, müssen wir bei Pusher sicherstellen, dass Benutzer dem Senden von Nachrichten an unseren Dienst vertrauen, und wir müssen sicherstellen, dass unser System diese Nachrichten verarbeiten kann.  Aber was sollen wir 10 Billionen Nachrichten übermitteln?  Mal sehen. </p><a name="habracut"></a><br><p>  Über Pusher-Kanäle werden pro Sekunde etwa 200.000 Nachrichten gesendet, zu Spitzenzeiten Millionen.  Zum Beispiel, als die New York Times den Dienst nutzte, um ihre Leser über den Fortschritt der US-Präsidentschaftswahlen auf dem Laufenden zu halten. </p><br><p>  Betrachten wir Pusher Channels zunächst als eine große Black Box, durch die all diese Nachrichten gehen: </p><br><p><img src="https://habrastorage.org/webt/q8/ly/tt/q8lyttjmuao2gkkgkfbjavnx120.png"></p><br><p>  Pusher Channels ist ein Publish-Subscribe-System.  Clients abonnieren Kanäle (z. B. "btc-usd" oder "private-user-jim"), während andere Clients Nachrichten an sie senden.  Wenn eine Million Menschen den Kanal „btc-usd“ abonniert haben und jemand die tatsächlichen Kosten für Bitcoin dorthin sendet, müssen Pusher Channels eine Million Nachrichten übermitteln.  Wir machen das in wenigen Millisekunden. </p><br><p>  Ein Server kann nicht so viele Nachrichten in so kurzer Zeit übermitteln.  Daher verwenden wir drei bewährte Techniken: Fan-Out, Sharding und Load Balancing.  Mal sehen, was in der Black Box ist. </p><br><p><img src="https://habrastorage.org/webt/fe/vx/rx/fevxrxzehjg1squjlnjqoa473sq.png"></p><br><p>  Millionen von Abonnenten sind auf ungefähr 170 leistungsstarke Edgeserver verteilt, von denen jeder ungefähr 20.000 Verbindungen enthält.  Jeder dieser Server merkt sich die Liste der Kanäle, die für seine Kunden interessant sind, und abonniert sie im zentralen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Redis-Dienst</a> .  Selbst wenn 2000 Clients an „btc-usd“ auf dem Edgeserver interessiert sind, muss er es nur einmal abonnieren.  Wenn also eine neue Nachricht im Kanal eintrifft, sendet Redis 170 Nachrichten an Edgeserver, die bereits 20.000 Nachrichten an ihre Abonnenten senden.  Dieser Ansatz wird als Fan-Out bezeichnet. </p><br><p>  Aber nur Fan-Out reicht uns nicht, denn es gibt immer noch eine zentrale Redis-Komponente, über die alle, die Nachrichten senden, gehen.  Diese Zentralisierung begrenzt die Anzahl der pro Sekunde gesendeten Nachrichten.  Um diese Einschränkung zu umgehen, besteht der zentrale Redis-Dienst aus vielen Redis-Shards.  Jeder Kanal wird wiederum durch Hashing seines Namens an den Redis-Shard angehängt.  Wenn der Kunde eine Nachricht senden möchte, geht er zum Restdienst.  Letzterer hasht den Kanalnamen und bestimmt anhand des Ergebnisses den erforderlichen Redis-Shard, an den die Nachricht gesendet werden soll.  Dieser Ansatz wird als Sharding bezeichnet. </p><br><p>  Es hört sich so an, als würden wir die Zentralisierung nur von einem Redis-Dienst auf einen Ruhedienst verlagern.  Dies ist jedoch nicht der Fall, da der Rest-Service selbst aus etwa 90 Servern besteht, die dieselbe Arbeit ausführen: Sie empfangen Veröffentlichungsanforderungen, berechnen Redis-Shards und senden Nachrichten an sie.  Wenn ein Publisher eine Nachricht senden möchte, geht er zu einem der vielen Rest-Server.  Dieser Ansatz wird als Lastausgleich bezeichnet. </p><br><p>  Zusammen bilden Fan-Out, Sharding und Load Balancing eine zentrale Komponente des Systems.  Diese Eigenschaft ist der Schlüssel zum Erreichen einer horizontalen Skalierbarkeit, mit der Millionen von Nachrichten pro Sekunde gesendet werden können. </p><br><p>  Wir haben die zentralen Komponenten des Pusher Channels-Dienstes untersucht, aber es gibt auch andere Teile, wie z. B. Metriken (wie erhalten wir diese Zahl von 10 Billionen), Webhooks (wie informieren wir Kunden über interessante Ereignisse), Autorisierung (Einschränkung des Zugriffs auf Kanäle), Daten zu Aktiv Benutzer, Ratenbegrenzung (wie stellen wir sicher, dass unsere Kunden genau so viele Ressourcen verwenden, wie sie bezahlt haben, und dass sie andere Kunden nicht stören).  All diese zusätzlichen Funktionen sollten implementiert werden, ohne die Bandbreite, die Nachrichtenübermittlungszeit und die Verfügbarkeit unseres gesamten Dienstes zu beeinträchtigen. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de415337/">https://habr.com/ru/post/de415337/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de415327/index.html">Der Satz von Pythagoras wurde von den Bauherren von Stonehenge 2000 Jahre vor der Geburt von Pythagoras selbst verwendet</a></li>
<li><a href="../de415329/index.html">Die ganze Wahrheit über RTOS von Colin Walls. Artikel 3. Aufgaben und Planung</a></li>
<li><a href="../de415331/index.html">In Jaroslawl werden Konstruktionsdrucker für Druckereien mit 5-6 Stockwerken hergestellt</a></li>
<li><a href="../de415333/index.html">Arduino - mikropowerful AM Broadcast Sender</a></li>
<li><a href="../de415335/index.html">Android Hintergrund Tutorial. Teil 5: Coroutinen in Kotlin</a></li>
<li><a href="../de415341/index.html">PostgreSQL-Verwaltungskurse</a></li>
<li><a href="../de415343/index.html"># 2HACKATON für junge Berufstätige in Perm</a></li>
<li><a href="../de415345/index.html">Tipps für die Entscheidung, iOS-Entwickler zu werden</a></li>
<li><a href="../de415347/index.html">2. Basierend auf Meyers „Effective and Modern C ++“ - Details zur Inferenz des Vorlagentyps für Arrays</a></li>
<li><a href="../de415349/index.html">Kubernetes 1.11: Ein Überblick über die wichtigsten Innovationen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>