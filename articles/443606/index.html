<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêÇ üíÜüèΩ ü§≤üèº Jenkins para Android con Docker üîº üë©üèΩ‚ÄçüöÄ ‚õπüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos! 

 Trabajo como desarrollador de Android, y no hace mucho tiempo nos topamos con algunas tareas de rutina en nuestro proyecto que nos gu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Jenkins para Android con Docker</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443606/">  Hola a todos! <br><br>  Trabajo como desarrollador de Android, y no hace mucho tiempo nos topamos con algunas tareas de rutina en nuestro proyecto que nos gustar√≠a automatizar.  Por ejemplo, tenemos 5 sabores diferentes, para cada uno de los cuales necesitamos cargar nuestra construcci√≥n en la tela, a veces para diferentes carros varias veces al d√≠a.  S√≠, esta tarea tambi√©n se puede hacer usando la tarea de gradle, pero me gustar√≠a no comenzar este proceso en la m√°quina del desarrollador, sino hacerlo de manera centralizada.  O, por ejemplo, cargue autom√°ticamente la compilaci√≥n en Google Play a beta.  Bueno, solo quer√≠a elegir el sistema CI.  Lo que surgi√≥ de esto y c√≥mo lo configuramos, por qu√© est√° Docker, m√°s adelante en el art√≠culo. <br><br><img src="https://habrastorage.org/webt/at/pi/_v/atpi_veqcyb-lryxth_ia4m0uag.png"><br><a name="habracut"></a><br>  En mi opini√≥n, toda la tarea se dividi√≥ en aproximadamente dos etapas: <br><br><ol><li>  Instale y configure Jenkins con el SDK de Android </li><li>  Configurar tareas que ya est√°n dentro de Jenkins </li></ol><br>  En este art√≠culo, quiero tocar el primer punto, y si esto es de inter√©s para alguien, en el pr√≥ximo art√≠culo describir√© el proceso de configuraci√≥n de tareas de ensamblaje en Jenkins. <br><br><h2>  Entonces, el primer punto es la instalaci√≥n y configuraci√≥n del sistema Jenkins </h2><br>  <i>Habr√© ya tiene un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> maravilloso sobre este tema, pero ya lleva un par de a√±os y algunas cosas est√°n un poco desactualizadas (por ejemplo, sdkmanager), aunque me ayud√≥ mucho a descubrir qu√© y c√≥mo hacer en las etapas iniciales.</i> <br><br>  Si observa la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n</a> oficial para instalar Jenkins, veremos tres formas diferentes de hacerlo: inicie una imagen acoplada lista para usar, descargue y ejecute un archivo war, y tambi√©n simplemente instale jenkins en el sistema a la antigua usanza (por ejemplo, <code>apt-get install jenkins</code> usando ubuntu como ejemplo).  La primera opci√≥n es la m√°s correcta, ya que no lleva configuraciones innecesarias y dependencias a nuestro sistema host, y en cualquier momento, incluso si algo sale mal, es f√°cil y simple eliminar todo y comenzar de nuevo.  Pero la imagen est√°ndar de Docker para Jenkins contiene algunos de los datos que no necesitamos (por ejemplo, el complemento blueocean) y no contiene lo que definitivamente necesitaremos (por ejemplo, Android SDK).  Se decidi√≥ crear nuestra propia imagen de acoplador que en su interior descargar√° y ejecutar√° el archivo war, descargar√° e instalar√° el sdk de Android, y configurar√° todas las dem√°s configuraciones que necesitemos.  Para iniciarlo m√°s tarde, necesitamos un sistema host con docker instalado.  Sugiero aqu√≠ no reinventar la rueda y usar DigitalOcean. <br><br><h4>  Crear y configurar una m√°quina virtual </h4><br>  Para empezar, si alguien m√°s no est√° registrado all√≠, sugiero que se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">registre</a> (aqu√≠, al momento de escribir el art√≠culo, hab√≠a un enlace de referencia, pero despu√©s de leer las reglas, lo descart√©).  Despu√©s del registro, puede buscar en Google uno u otro c√≥digo promocional en Internet y obtener unos 10 d√≥lares para comenzar. <br><br>  Despu√©s tenemos que conseguir una nueva gota.  Seleccione el elemento Gotitas y luego <b>Crear gotita</b> . <br><br><img src="https://habrastorage.org/webt/gx/5m/th/gx5mthmcjzw-okm6ktxpfekimn8.png" alt="imagen"><br><br>  El sistema host es Ubuntu 18.04.  Puede elegir una imagen con Docker ya instalado y configurado, pero haremos todo por nuestra cuenta.  Dado que el ensamblaje de las compilaciones de Android a√∫n requiere muchos recursos, debemos elegir una configuraci√≥n de al menos 20 d√≥lares para que las compilaciones se recopilen normalmente y con relativa rapidez. <br><br><img src="https://habrastorage.org/webt/1e/y_/z1/1ey_z1uyjffbqocqz6i4ef8ium8.png" alt="imagen"><br><br>  Elegiremos una ubicaci√≥n m√°s cercana (por ejemplo, en Alemania).  Luego hay dos opciones sobre c√≥mo nos conectaremos a nuestro servidor virtual.  Podemos agregar una clave ssh o prescindir de ella.  Si en este lugar no indicamos qu√© clave usar, la contrase√±a del usuario ra√≠z se enviar√° a nuestro correo. <br><br><img src="https://habrastorage.org/webt/eg/qd/hu/egqdhuamgiddwijvsfidcxu7ieq.png" alt="imagen"><br><br>  Aqu√≠ podemos cambiar el nombre del servidor y completar la creaci√≥n haciendo clic en el bot√≥n <b>Crear</b> . <br><br><img src="https://habrastorage.org/webt/ad/mw/6w/admw6wwv2zyontaxpzx-fgp-rfg.png" alt="imagen"><br><br>  Ahora vamos al droplet creado y copiamos la direcci√≥n IP para nosotros, para una mayor conexi√≥n y configuraci√≥n. <br><br><img src="https://habrastorage.org/webt/q7/th/yv/q7thyvgm-hppvgrured6dogeqva.png" alt="imagen"><br><br>  Necesitamos un cliente ssh.  Si trabaja desde debajo de una amapola, entonces puede usar el terminal est√°ndar, si desde debajo de Windows podemos usar masilla para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">trabajar</a> o usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el subsistema Linux</a> (solo para Windows 10).  Yo personalmente uso la √∫ltima opci√≥n, y me queda completamente bien. <br><br>  Con√©ctese a nuestro servidor usando el siguiente comando <br><br><pre> <code class="bash hljs">ssh root@YOUR_IP_ADDRESS</code> </pre> <br>  La consola le ofrecer√° guardar la clave, estamos de acuerdo con esto.  Despu√©s de conectarnos, crearemos un nuevo usuario para nosotros, lo agregaremos a los superusuarios (y le daremos la oportunidad de usar sudo sin contrase√±a), le copiaremos la clave de acceso a trav√©s de ssh y le diremos que es el propietario de estos archivos (de lo contrario, no funcionar√°).  El <b>nombre de usuario se</b> cambia a cualquier conveniente para usted. <br><br><pre> <code class="bash hljs">useradd -m -s /bin/bash username \ &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'username ALL=(ALL) NOPASSWD:ALL'</span></span> &gt;&gt; /etc/sudoers \ &amp;&amp; mkdir /home/username/.ssh \ &amp;&amp; cp /root/.ssh/authorized_keys /home/username/.ssh/authorized_keys \ &amp;&amp; chown username:username -R /home/username/.ssh</code> </pre><br>  Desconectarse de la ra√≠z con el comando <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre> <br>  Y ya nos volveremos a conectar con la ayuda del nuevo usuario creado. <br><br><pre> <code class="bash hljs">ssh username@YOUR_IP_ADDRESS</code> </pre> <br>  Despu√©s de actualizar el sistema y reiniciar nuestro servidor (si durante el proceso de actualizaci√≥n el sistema le preguntar√° algo, es suficiente elegir siempre los valores predeterminados en este caso). <br><br><pre> <code class="bash hljs">sudo apt update &amp;&amp; sudo apt full-upgrade -y &amp;&amp; sudo apt autoremove -y &amp;&amp; sudo reboot</code> </pre> <br>  La configuraci√≥n b√°sica est√° completa.  Desde el punto de vista del sistema de combate, no es muy seguro, pero dentro del marco de este art√≠culo es completamente adecuado. <br><br><h4>  Instalar Docker. </h4><br>  Para instalar Docker en nuestro sistema, utilizaremos la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n oficial</a> .  Dado que tenemos un sistema reci√©n instalado, omitiremos este punto, y si tiene un sistema en el que algo se ha estado ejecutando durante mucho tiempo, por recomendaci√≥n de los chicos de Docker, elimine las posibles versiones anteriores <br><br><pre> <code class="bash hljs">sudo apt-get remove docker docker-engine docker.io containerd runc</code> </pre> <br>  No olvide conectarse primero a trav√©s de ssh a nuestro servidor.  La instalaci√≥n de Docker en s√≠ se describe con gran detalle en la documentaci√≥n, dar√© comandos generales para que sea m√°s f√°cil para usted.  Lo que hacen se puede leer all√≠.  Primero agregue el repositorio. <br><br><pre> <code class="bash hljs">sudo apt update \ &amp;&amp; sudo apt install -y apt-transport-https ca-certificates \ curl gnupg-agent software-properties-common \ &amp;&amp; curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - \ &amp;&amp; sudo apt-key fingerprint 0EBFCD88 \ &amp;&amp; sudo add-apt-repository <span class="hljs-string"><span class="hljs-string">"deb [arch=amd64] https://download.docker.com/linux/ubuntu </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(lsb_release -cs)</span></span></span><span class="hljs-string"> stable"</span></span></code> </pre> <br>  Y luego instale Docker: <br><br><pre> <code class="bash hljs">sudo apt update &amp;&amp; sudo apt install -y docker-ce docker-ce-cli containerd.io</code> </pre> <br>  Para que en el futuro podamos llamar a los comandos de Docker sin el prefijo sudo, ejecute el siguiente comando (que tambi√©n se describe cuidadosamente en las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">instrucciones</a> ). <br><br><pre> <code class="bash hljs">sudo usermod -aG docker username</code> </pre> <br>  Despu√©s de eso, debe volver a iniciar sesi√≥n (usando el comando de salida y reconectando al servidor) para que esto funcione. <br><br>  Docker est√° instalado, lo que podemos verificar con el comando <br><br><pre> <code class="bash hljs">docker run hello-world</code> </pre> <br>  Ella descarga la imagen de prueba, la ejecuta en el contenedor.  El contenedor, despu√©s de comenzar, imprime un mensaje informativo y sale. <br><br>  ¬°Felicitaciones, hemos terminado la etapa de preparaci√≥n del servidor para el trabajo! <br><br><h4>  Crear tu imagen de Docker </h4><br>  Crearemos la imagen de Docker escribiendo nuestro propio Dockerfile.  Ejemplos de c√≥mo hacer esto correctamente en Internet, un vag√≥n y un carrito peque√±o, mostrar√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mi</a> versi√≥n terminada e intentar√© comentarla lo m√°s posible.  Tambi√©n hay un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">manual</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">instrucciones</a> de Docker con ejemplos sobre la ortograf√≠a correcta y can√≥nica de dockerfile. <br><br>  Crea y abre tu Dockerfile para editar <br><br><pre> <code class="bash hljs">touch Dockerfile &amp;&amp; nano Dockerfile</code> </pre> <br>  En √©l, por ejemplo, colocaremos el contenido de mi Dockerfile <br><br><div class="spoiler">  <b class="spoiler_title">Todo mi dockerfile con comentarios</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    . FROM ubuntu:18.04 #      LABEL author="osipovaleks" LABEL maintainer="osipov.aleks.kr@gmail.com" LABEL version="1.0" LABEL description="Docker image for Jenkins with Android SDK" #  ,  Jenkins    ENV TZ=Europe/Kiev RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime &amp;&amp; echo $TZ &gt; /etc/timezone # i386    ia32-libs RUN dpkg --add-architecture i386 #      RUN apt-get update &amp;&amp; apt-get install -y git \ wget \ unzip \ sudo \ tzdata \ locales\ openjdk-8-jdk \ libncurses5:i386 \ libstdc++6:i386 \ zlib1g:i386 #  ,       RUN apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists /var/cache/apt #  RUN locale-gen en_US.UTF-8 ENV LANG en_US.UTF-8 ENV LANGUAGE en_US:en ENV LC_ALL en_US.UTF-8 #   Android Sdk     ARG android_home_dir=/var/lib/android-sdk/ ARG sdk_tools_zip_file=sdk-tools-linux-4333796.zip RUN mkdir $android_home_dir RUN wget https://dl.google.com/android/repository/$sdk_tools_zip_file -P $android_home_dir -nv RUN unzip $android_home_dir$sdk_tools_zip_file -d $android_home_dir RUN rm $android_home_dir$sdk_tools_zip_file &amp;&amp; chmod 777 -R $android_home_dir # environment    ENV ANDROID_HOME=$android_home_dir ENV PATH="${PATH}:$android_home_dir/tools/bin:$android_home_dir/platform-tools" ENV JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64/ #   Android SDK RUN yes | sdkmanager --licenses #    Jenkins ENV JENKINS_HOME=/var/lib/jenkins RUN mkdir $JENKINS_HOME &amp;&amp; chmod 777 $JENKINS_HOME #     jenkins,   ,         RUN useradd -m jenkins &amp;&amp; echo 'jenkins ALL=(ALL) NOPASSWD:ALL' &gt;&gt; /etc/sudoers USER jenkins WORKDIR /home/jenkins #   war     Jenkins RUN wget http://mirrors.jenkins.io/war-stable/latest/jenkins.war -nv CMD java -jar jenkins.war #      EXPOSE 8080/tcp</span></span></code> </pre><br></div></div><br>  Algunas aclaraciones: <br><br><ul><li>  Al principio, hab√≠a un deseo de usar un alpine m√°s ligero en lugar de ubuntu, pero no tiene <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">soporte para ia32-libs</a> , que es necesario para construir proyectos usando el SDK de Android. </li><li>  Instalamos openjdk-8-jdk, no el openjdk-8-jdk-headless m√°s liviano, porque algunas funciones de Jenkins necesitan un sistema completo (por ejemplo, mostrar resultados de pruebas unitarias). </li><li>  Es necesario instalar configuraciones regionales, debido al hecho de que en algunos proyectos, sin ellos, el ensamblaje de gradle se bloquea sin errores y registros claros, y pas√© varios d√≠as para llegar al fondo de esta raz√≥n (en ubuntu regular que no est√° en la ventana acoplable, todas las configuraciones regionales se llenan por defecto) . </li><li>  Necesitamos aceptar de inmediato todas las licencias para el SDK de Android, de modo que durante el proceso de compilaci√≥n Jenkins pueda instalar de forma independiente los componentes que necesita (por ejemplo, los SDK que necesita para diferentes versiones de la API).  Si es necesario, m√°s adelante dentro del contenedor docker ser√° posible administrar el SDK usando sdkmanager, por ejemplo <code>sdkmanager --list</code> permite ver todos los componentes disponibles y todos instalados, y <code>sdkmanager --install "platforms;android-26"</code> instalar√° el SDK para la versi√≥n 26 de la API. </li><li>  En general, era posible no iniciar el usuario jenkins y permanecer con el usuario ra√≠z, pero de alguna manera no es del todo correcto, tampoco podr√≠a otorgarle derechos de superusuario, pero esto se hizo en t√©rminos de conveniencia, si es necesario instalar algo en la etapa de configuraci√≥n y depuraci√≥n. </li><li>  El tama√±o b√°sico de la imagen result√≥ ser bastante grande (casi 800 mb), pero en general llegu√© a la conclusi√≥n de que para m√≠ esto no es muy cr√≠tico, y es m√°s f√°cil para m√≠ descargarlo de esta forma que pasar tiempo buscando y eliminando paquetes que no necesito. </li></ul><br>  Despu√©s de escribir Dockerfile, debemos convertirlo en una imagen preparada para Docker, en funci√≥n de qu√© contenedores se crear√°n.  Esto lo hace simplemente un equipo <br><br><pre> <code class="bash hljs">docker build -t jenkins-image</code> </pre> <br>  donde el par√°metro <code>-t jenkins-image</code> es responsable del nombre de su imagen, y el punto al final del comando indica que debe buscar el Dockerfile para ensamblar dentro de este directorio.  El proceso de compilaci√≥n en s√≠ toma algo de tiempo, y despu√©s de la compilaci√≥n, la consola deber√≠a tener un mensaje similar. <br><blockquote>  Construido con √©xito 9fd8f5545c27 <br>  Etiquetado correctamente jenkins-image: √∫ltimo </blockquote>  Lo que nos dice que nuestra imagen se ha ensamblado con √©xito, y podemos proceder al siguiente paso, a saber, el lanzamiento de nuestro contenedor <br><br><h4>  Docker Hub e im√°genes listas para usar </h4><br>  S√≠, por supuesto, podemos usar nuestra imagen preparada para iniciar el contenedor, pero si necesitamos hacerlo en m√°s de varios dispositivos, crear un Dockerfile cada vez y construir una imagen preparada a partir de √©l no ser√° muy conveniente.  Y si tambi√©n actualizamos el contenido de nuestro Dockerfile, no ser√° conveniente implementar los cambios en todos los nodos.  Para estos fines, existe un repositorio p√∫blico de im√°genes de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Docker Hub</a> .  Le permite no recopilar una imagen cada vez, en cada nodo, sino simplemente descargarla desde el repositorio p√∫blico y usarla por igual en todas las m√°quinas.  Por ejemplo, la imagen que sirvi√≥ como ejemplo para este art√≠culo est√° disponible en el repositorio llamado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">osipovaleks / docker-jenkins-android</a> , y m√°s adelante en el art√≠culo trabajaremos con ella. <br><br>  Este art√≠culo no implica un estudio detallado del Docker Hub, no entenderemos c√≥mo cargar nuestras im√°genes all√≠ (aunque esto no es muy dif√≠cil) y qu√© se puede hacer con ellas all√≠, no entenderemos que todav√≠a puede haber sus propios repositorios p√∫blicos o privados, En esto, todo se puede resolver de forma independiente si es necesario. <br><br><h4>  Lanzamiento de contenedores </h4><br>  Hay dos formas de iniciar un contenedor. <br><br><ol><li>  La primera forma, simplemente usando el <code>docker run</code> , le permite hacer esto f√°cil y r√°pidamente de la siguiente manera <br><br><pre> <code class="bash hljs">docker run --name jenkins -d -it -v jenkins-data:/var/lib/jenkins -v jenkins-home:/home/jenkins -p 8080:8080 --restart unless-stopped osipovaleks/docker-jenkins-android</code> </pre> <br>  donde el comando de <code>run</code> tiene los siguientes par√°metros <br><br><ul><li>  <code>--name jenkins</code> - nombre del futuro contenedor </li><li>  <code>-d</code> - iniciar contenedor en segundo plano </li><li>  <code>-it</code> - banderas para trabajar con STDIN y tty </li><li>  <code>-v jenkins-data:/var/lib/jenkins</code> y <code>-v jenkins-home:/home/jenkins</code> - crea (si no se cre√≥) y asigna archivos de volumen especiales a las secciones internas del contenedor que nos permitir√°n guardar nuestro Jenkins configurado incluso despu√©s de la reconstrucci√≥n contenedor </li><li>  <code>-p 8080:8080</code> el puerto del host al puerto del contenedor para que tengamos acceso a la interfaz web (s√≠, este es el puerto que especificamos en el Dockerfile) </li><li>  <code>--restart unless-stopped</code> : la opci√≥n determina la pol√≠tica de ejecuci√≥n autom√°tica del contenedor despu√©s de reiniciar el host (en este caso, inicio autom√°tico si el contenedor no se apag√≥ manualmente) </li><li>  <code>osipovaleks/docker-jenkins-android</code> : imagen para la implementaci√≥n. </li></ul><br>  A la salida de la consola de Docker, deber√≠amos obtener la identificaci√≥n del contenedor creado y tambi√©n mostrar informaci√≥n sobre c√≥mo se carga la imagen en el sistema (por supuesto, si a√∫n no est√° cargada), algo como esto <br><blockquote>  No se puede encontrar la imagen 'osipovaleks / docker-jenkins-android: latest' localmente <br>  √∫ltimo: extracci√≥n de osipovaleks / docker-jenkins-android <br>  6cf436f81810: extracci√≥n completa <br>  987088a85b96: extracci√≥n completa <br>  b4624b3efe06: extracci√≥n completa <br>  d42beb8ded59: Pull complete <br>  b3896048bb8c: extracci√≥n completa <br>  8eeace4c3d64: extracci√≥n completa <br>  d9b74624442c: extracci√≥n completa <br>  36bb3b7da419: Pull complete <br>  31361bd508cb: extracci√≥n completa <br>  cee49ae4c825: extracci√≥n completa <br>  868ddf54d4c1: extracci√≥n completa <br>  361bd7573dd0: Pull complete <br>  bb7b15e36ae8: Pull complete <br>  97f19daace79: Pull complete <br>  1f5eb3850f3e: extracci√≥n completa <br>  651e7bbedad2: extracci√≥n completa <br>  a52705a2ded7: extracci√≥n completa <br>  Resumen: sha256: 321453e2f2142e433817cc9559443387e9f680bb091d6369bbcbc1e0201be1c5 <br>  Estado: Imagen m√°s reciente descargada para osipovaleks / docker-jenkins-android: latest <br>  ef9e5512581da66d66103d9f6ea6ccd74e5bdb3776747441ce6a88a98a12b5a4 </blockquote></li><li>  La segunda forma de comenzar implica escribir un archivo de composici√≥n especial, donde el comando de ejecuci√≥n simplemente se describe usando el lenguaje <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">YAML</a> y se inicia usando Docker Compose. <br><br>  Para hacer esto, necesitamos instalarlo: <br><br><pre> <code class="bash hljs">sudo apt update &amp;&amp; sudo apt install -y docker-compose</code> </pre> <br>  A continuaci√≥n, cree un directorio para el proyecto (esto es importante si le importa c√≥mo se llamar√°n los vol√∫menes creados autom√°ticamente para el contenedor) y vaya a √©l <br><br><pre> <code class="bash hljs">mkdir jenkinsProject &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> jenkinsProject</code> </pre> <br>  y dentro creamos el archivo de composici√≥n en s√≠ y pasamos al modo de edici√≥n <br><br><pre> <code class="bash hljs">touch docker-compose.yml &amp;&amp; nano docker-compose.yml</code> </pre> <br>  y poner los siguientes contenidos en √©l <br><br><pre> <code class="markdown hljs">version: '3' services: jenkins: container_name: jenkins image: osipovaleks/docker-jenkins-android ports: - "8080:8080" restart: unless-stopped volumes: - "jenkins-data:/var/lib/jenkins" - "jenkins-home:/home/jenkins" volumes: jenkins-data: jenkins-home:</code> </pre> <br>  En √©l, tal vez, solo la primera l√≠nea plantea preguntas ( <code>version: '3'</code> ) que indica la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">versi√≥n de las</a> capacidades del archivo de composici√≥n, as√≠ como una secci√≥n con el bloque de <code>volumes</code> que enumera las utilizadas en este contenedor <br><br>  Ejecute su contenedor con el comando: <br><br><pre> <code class="bash hljs">docker-compose up -d</code> </pre> <br>  donde el indicador <code>-d</code> tambi√©n indica que el contenedor se crear√° y se iniciar√° en segundo plano.  Como resultado, Docker deber√≠a mostrar algo como lo siguiente: <br><blockquote>  Creaci√≥n del volumen "jenkinsproject_jenkins-data" con el controlador predeterminado <br>  Creaci√≥n del volumen "jenkinsproject_jenkins-home" con el controlador predeterminado <br>  Tirando de jenkins (osipovaleks / docker-jenkins-android: latest) ... <br>  √∫ltimo: extracci√≥n de osipovaleks / docker-jenkins-android <br>  6cf436f81810: extracci√≥n completa <br>  987088a85b96: extracci√≥n completa <br>  b4624b3efe06: extracci√≥n completa <br>  d42beb8ded59: Pull complete <br>  b3896048bb8c: extracci√≥n completa <br>  8eeace4c3d64: extracci√≥n completa <br>  d9b74624442c: extracci√≥n completa <br>  36bb3b7da419: Pull complete <br>  31361bd508cb: extracci√≥n completa <br>  cee49ae4c825: extracci√≥n completa <br>  868ddf54d4c1: extracci√≥n completa <br>  361bd7573dd0: Pull complete <br>  bb7b15e36ae8: Pull complete <br>  97f19daace79: Pull complete <br>  1f5eb3850f3e: extracci√≥n completa <br>  651e7bbedad2: extracci√≥n completa <br>  a52705a2ded7: extracci√≥n completa <br>  Resumen: sha256: 321453e2f2142e433817cc9559443387e9f680bb091d6369bbcbc1e0201be1c5 <br>  Estado: Imagen m√°s reciente descargada para osipovaleks / docker-jenkins-android: latest <br>  Creando Jenkins ... <br>  Creando jenkins ... hecho </blockquote>  ¬øRecuerdas que dije que el nombre de los vol√∫menes creados depender√° del nombre del proyecto?  Ejecute el comando: <br><br><pre> <code class="bash hljs">docker volume ls</code> </pre> <br>  y obtenemos tal salida <br><blockquote>  NOMBRE DE VOLUMEN DEL CONDUCTOR <br>  jenkinsproject_jenkins-data local <br>  jenkinsproject_jenkins-home local </blockquote>  donde veremos que a pesar del hecho de que el nombre del volumen fue elegido por <code>jenkins-home</code> , en realidad, un prefijo del nombre del proyecto se <code><b>jenkinsproject _jenkins-home</b></code> a √©l y el nombre del volumen result√≥ ser <code><b>jenkinsproject</b> _jenkins-home</code> </li></ol><br><br>  ¬øQu√© opci√≥n de inicio usar?  Aqu√≠ puede elegir por s√≠ mismo, se cree que Docker Compose es m√°s una herramienta para lanzar varios contenedores a la vez, que est√°n vinculados entre s√≠, y si necesita iniciar solo un contenedor, puede usar el <code>docker run</code> . <br><br>  Ahora, despu√©s de estos pasos secundarios para iniciar y configurar el servidor, as√≠ como tambi√©n para iniciar el contenedor con Jenkins, podemos proceder a su configuraci√≥n inicial <br><br><h4>  Configuraci√≥n inicial de Jenkins </h4><br>  Tome la direcci√≥n IP de nuestro servidor, agregue el puerto 8080 indicado por nosotros y siga este enlace en el navegador. <br><br> <code>http://YOUR_IP_ADDRESS:8080/</code> <br> <br>  Si antes de eso todo se configur√≥ y comenz√≥ correctamente, entonces aqu√≠ veremos la siguiente imagen <br><br><img src="https://habrastorage.org/webt/za/a5/bi/zaa5bi-5vkvscc-ww7gd2ouxjte.png"><br><br>  Para la primera configuraci√≥n, necesitamos ingresar la contrase√±a que el sistema gener√≥ durante la instalaci√≥n.  Para hacer esto, solo necesitamos mirar el contenido del archivo <code>/var/lib/jenkins/secrets/initialAdminPassword</code> .  Pero este archivo est√° dentro de nuestro contenedor en ejecuci√≥n, y para leerlo, necesitamos conectarnos al contenedor usando el siguiente comando: <br><br><pre> <code class="bash hljs">docker <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> -it jenkins /bin/bash</code> </pre> <br>  donde la opci√≥n <code>-it</code> es similar a ejecutar <code>docker run</code> , <code>jenkins</code> es el nombre de nuestro contenedor y <code>/bin/bash</code> ejecutar√° <code>/bin/bash</code> para nosotros en el contenedor y le dar√° acceso.  Despu√©s de eso, podemos ver la contrase√±a inicial para Jenkins: <br><br><pre> <code class="bash hljs">cat /var/lib/jenkins/secrets/initialAdminPassword</code> </pre> <br>  lo siguiente aparece en la consola <br><blockquote>  91092b18d6ca4492a2759b1903241d2a </blockquote>  Esta es la contrase√±a. <br><br>  <i>El usuario <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">ALexhha</a> sugiri√≥ una opci√≥n m√°s simple para leer esta contrase√±a, sin conectarse al contenedor en s√≠.</i>  <i>El hecho es que al momento de lanzar Jenkins, esta contrase√±a se muestra en los registros.</i>  <i>Resulta que todo lo que necesitamos es leer los registros del contenedor.</i>  <i>En nuestro caso, esto se hace con el siguiente comando:</i> <br><br><pre> <code class="bash hljs">docker logs jenkins</code> </pre> <br><br>  <i>donde</i> <code>jenkins</code> <i>nombre de nuestro contenedor, y en los registros puede ver lo siguiente:</i> <br><br><blockquote>  ***************************************************** *********** <br>  ***************************************************** *********** <br>  ******************************************** .... *********** <br><br>  Se requiere la configuraci√≥n inicial de Jenkins.  Se ha creado un usuario administrador y se ha generado una contrase√±a. <br>  Utilice la siguiente contrase√±a para proceder a la instalaci√≥n: <br><br>  91092b18d6ca4492a2759b1903241d2a <br><br>  Esto tambi√©n se puede encontrar en: / var / lib / jenkins / secrets / initialAdminPassword <br><br>  ******************************************** .... *********** <br>  ******************************************** .... *********** </blockquote><br>  ******************************************** .... *********** <br><br>  <i>Esta opci√≥n es un poco m√°s simple y r√°pida.</i> <br><br>  C√≥pielo, p√©guelo en el campo <b>Contrase√±a de administrador</b> en la interfaz web y haga clic en <b>Continuar</b> .  En la siguiente pantalla, seleccione <b>Instalar complementos sugeridos</b> e instale un conjunto de complementos predeterminados. <br><br><img src="https://habrastorage.org/webt/bs/9d/xs/bs9dxsxd6-cddmut2bww9utxjw4.png"><br><br><img src="https://habrastorage.org/webt/r5/-m/u-/r5-mu-bgyaqswxcqnyrpds0qhic.png"><br><br>  Despu√©s de instalar los complementos, cree un usuario para nosotros y haga clic en <b>Guardar y finalizar</b> <br><br><img src="https://habrastorage.org/webt/iy/ap/jd/iyapjd__vdbys6jsjiinvzcp58q.png"><br><br>  Estamos de acuerdo con la secci√≥n Configuraci√≥n de instancia, donde se nos pide que completemos la URL en la que trabajar√° Jenkins (en nuestro caso, deje todo como est√°) <br><br><img src="https://habrastorage.org/webt/4v/w1/ie/4vw1ieq0o_tm5bkrgn4sb-m__kk.png"><br><br>  Y en la siguiente pantalla, haga clic en el preciado <b>Comenzar a usar Jenkins</b> <br><br><img src="https://habrastorage.org/webt/4a/iw/yq/4aiwyqwkzbxjdkjwyzowxyvsktc.png"><br><br>  ¬°As√≠ que instalamos y lanzamos Jenkins! <br><br><img src="https://habrastorage.org/webt/9a/4z/tu/9a4ztunwk1gxuc8rsho2ql9-tou.png"><br><br>  Ya es bastante posible trabajar con √©l, pero para recopilar nuestras compilaciones de Android, deber√° configurar algunos puntos m√°s.  La localizaci√≥n de Jenkins est√° relacionada con el idioma seleccionado de su navegador y, por supuesto, la traducci√≥n al ruso no est√° completamente terminada, y obtenemos una mezcla infernal de ruso e ingl√©s.  Si tuvo √©xito exactamente de la misma manera, y eso lo enfurece, entonces puede usar el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">complemento</a> especial y configurar el idioma predeterminado de la interfaz.  Bueno, o cambie su navegador a la interfaz en ingl√©s. <br><br>  Vaya a la configuraci√≥n de Jenkins y seleccione <b>Configuraci√≥n del sistema.</b> <br><br><img src="https://habrastorage.org/webt/pk/xo/1d/pkxo1diloanswc7tciicxhaiidq.png"><br><br>  Verifique las <b>variables de entorno</b> e ingrese el nombre <b>ANDROID_HOME</b> en el campo y especifique <b>/ var / lib / android-sdk /</b> en el campo (especificamos estos datos en el Dockerfile como el directorio de inicio para el SDK de Android). <br><br><img src="https://habrastorage.org/webt/on/af/4j/onaf4jfhel5_ys078k5ohrxwxuu.png"><br><br>  Haga clic en el bot√≥n <b>Guardar</b> , salga de esta secci√≥n de configuraci√≥n y vaya a la secci√≥n llamada <b>Configuraci√≥n de herramientas globales</b> . <br><br><img src="https://habrastorage.org/webt/b9/3i/zx/b93izxlndc-utyrnewgv5kluug0.png"><br><br>  Configure la partici√≥n <b>JDK</b> (donde la variable JAVA_HOME tambi√©n fue poblada por nosotros en el Dockerfile, y podemos usar su valor <b>/ usr / lib / jvm / java-8-openjdk-amd64 / here</b> ). <br><br><img src="https://habrastorage.org/webt/0l/wn/2p/0lwn2prv62virmofscvskc5e6_8.png"><br><br>  Tambi√©n aqu√≠ todav√≠a tenemos que completar la secci√≥n de <b>Gradle</b> .  Seleccionamos e instalamos la versi√≥n de Gradle que se utiliza en los proyectos que crear√° con este sistema CI.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Puedes tener varias versiones. Tampoco puede iniciar la variable Gradle si tiene gradlew en el repositorio, por ejemplo, y puede construirlo con √©l. </font></font><br><br><img src="https://habrastorage.org/webt/0q/fe/wj/0qfewj73fbwr3vzudpk8woyrsmy.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Con esto podemos terminar nuestra primera etapa. El sistema Jenkins est√° en pleno funcionamiento y podemos pasar a personalizar las tareas de compilaci√≥n ellos mismos. Tenga en cuenta que el sistema se ajust√≥ a nuestras necesidades y aqu√≠ puede no proporcionarle lo que necesita; por ejemplo, no hay emuladores de Android para pruebas y NDK.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si este art√≠culo le interesa a alguien, entonces continuar√© en la segunda parte con un ejemplo de uno o dos problemas, describir√© la integraci√≥n de Jenkins y Bitbucket (es √©l, no Github, porque es m√°s f√°cil con repositorios privados gratuitos y art√≠culos en Internet sobre es m√°s peque√±o, pero quiz√°s m√°s divertido), te dir√© c√≥mo hacer amigos con la clave ssh de nuestro contenedor con el repositorio, sobre notificaciones por correo electr√≥nico, as√≠ como varios otros chips. </font><font style="vertical-align: inherit;">En general, sobre todo lo que hemos configurado. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Te pido que no patees mucho, este es mi primer art√≠culo sobre Habr. </font><font style="vertical-align: inherit;">Bueno para todos!</font></font></i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/443606/">https://habr.com/ru/post/443606/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../443592/index.html">RFID front end ISO 11785 est√°ndar de un antiguo receptor de FM y desechos de elevador</a></li>
<li><a href="../443594/index.html">La encrucijada de las pruebas y la arquitectura: una entrevista con Neil Ford</a></li>
<li><a href="../443600/index.html">Las mejores y peores tendencias del MWC 2019</a></li>
<li><a href="../443602/index.html">¬øQu√© es el alias estricto y por qu√© deber√≠a importarnos? Parte 2</a></li>
<li><a href="../443604/index.html">M√ìVIL PRIMERO: Hackathon en OZON</a></li>
<li><a href="../443608/index.html">Smart Home / Actualizaciones en Lazurite</a></li>
<li><a href="../443612/index.html">Usamos viejos discos duros malos</a></li>
<li><a href="../443614/index.html">YouTrack 2019.1: seleccione paneles √°giles, campos de tarjetas personalizables en paneles √°giles y m√°s</a></li>
<li><a href="../443616/index.html">35% de rendimiento de stock en datos alternativos</a></li>
<li><a href="../443618/index.html">Emulador de computadora de los 80 en el navegador</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>