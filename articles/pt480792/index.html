<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶Ñ üî° üîª Engenharia de Presentes üë©üèΩ‚Äçüíª üñêüèæ ‚ôåÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Do lado de fora da janela chove, o calend√°rio √© dezembro. A hora das f√©rias est√° se aproximando e, portanto, a hora dos presentes. O colega Pavel quer...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Engenharia de Presentes</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480792/"><img src="https://habrastorage.org/webt/md/lw/ph/mdlwpht7vhixr2jkxrftetb8hv4.jpeg"><br><br>  Do lado de fora da janela chove, o calend√°rio √© dezembro.  A hora das f√©rias est√° se aproximando e, portanto, a hora dos presentes.  O colega Pavel quer um novo laptop para si e a namorada Masha quer uma casa √† beira-mar.  E, apesar do sal√°rio digno da profiss√£o de tyzhprogrammer, n√£o vivemos em um mundo de infinitas possibilidades, o que significa que n√£o posso dar a essas pessoas exatamente o que elas mais querem (mesmo que Pasha possa ser meu melhor Pavel, a quem Eu sei, mas Masha est√° bem). <br><br>  √â aqui que o problema de "presentes baratos" aparece.  N√£o d√° para dar um presente caro a todos, mas n√£o quero dar outra caixa de chocolates, uma vela ou uma figura indistinta.  Ent√£o, voc√™ precisa combinar neg√≥cios com prazer - gosto de fazer as coisas com minhas pr√≥prias m√£os, e o resultado √© √≥timo como presente.  Esta √© uma hist√≥ria sobre como mais uma vez fingi ser engenheiro e fiz v√°rios presentes √† m√£o. <br><a name="habracut"></a><br><h2>  Uma pequena digress√£o do t√≥pico principal </h2><br>  N√£o posso ir imediatamente ao t√≥pico principal, ent√£o vou come√ßar de longe.  Alguns anos atr√°s, o jogo "The Witcher 3" foi lan√ßado.  Meu amigo me aconselhou a jogar e, em geral, eu realmente admirava o jogo.  Decidi o que fazer e lhe dei algo tem√°tico relacionado ao jogo ... N√£o vou me aprofundar na descri√ß√£o do jogo (o Google ajudar√° a todos) ou dizer que n√£o me ocorreu muita coisa pelas palavras-chave "The Witcher, Engineer, Gift". <br><br>  O personagem principal do jogo tem um cavalo chamado "Roach" (na dublagem russa), o her√≥i de tempos em tempos a leva com a frase "Move, Roach".  Eu decidi fazer um brinquedo mec√¢nico sobre o tema "mexendo baratas". <br><br>  Naturalmente, o presente foi concebido como algo completamente in√∫til, est√∫pido, mas engra√ßado, ent√£o o plano era o seguinte: <br><br><ol><li>  H√° uma caixa que oculta o mecanismo em si. </li><li>  O mecanismo √© um eixo, girando o qual o cavalo est√° se movendo. </li><li>  A m√°xima "tenacidade" do movimento do cavalo √© bem-vinda.  Inicialmente, pensou-se que o cavalo deveria se mover como um peixe, e n√£o como um cavalo (afinal, barata), mas o resultado foi "algo intermedi√°rio". </li><li>  Tudo isso ser√° feito a partir de compensado, que de acordo com os desenhos pode ser cortado com precis√£o a pedido com um laser. </li></ol><br>  A principal desvantagem da escolha do material e o fato de que o corte ser√° feito por encomenda foi o fato de eu ter perdido a oportunidade de criar um prot√≥tipo, o que significa que todos os problemas de m√£os tortas e o n√£o cumprimento da regra da ‚Äúmedida dos sete tempos‚Äù se fizeram sentir rapidamente: <br><br><img src="https://habrastorage.org/webt/bq/9h/e2/bq9he2doyiixrvhr47zha5frml0.jpeg"><br><br>  Embora, no final, o fato de muitos detalhes do mecanismo de folga devido a folgas muito grandes ajudaram a compensar o fato de eu ter conectado as pe√ßas e o eixo de maneira bastante torta.  Aqui, como se costuma dizer, ‚Äúmenos menos d√° mais‚Äù e o mecanismo como um todo funcionou, como pretendido: <br><br><img src="https://habrastorage.org/webt/cn/x2/gf/cnx2gfjjm2rasl3jtcd3oah-ors.gif"><br><br>  Depois, havia apenas uma pequena pintura e o resultado foi uma caixa: <br><br><img src="https://habrastorage.org/webt/fe/x9/uf/fex9ufxoprduhzobingucsoinm4.jpeg"><br><br>  Ent√£o algu√©m dir√° que foi necess√°rio tornar a caixa transparente para que fosse poss√≠vel observar o trabalho do interior, mas, na verdade, eu imaginei que n√£o poderia montar todo o mecanismo e a caixa t√£o limpos e ordenadamente por dentro que n√£o machucariam. olhe atrav√©s das paredes transparentes da caixa.  Portanto, uma caixa opaca √© uma medida necess√°ria. <br><br>  Resta apenas empacot√°-lo, amarrar um la√ßo em uma caixa e o presente est√° pronto: <br><br><img src="https://habrastorage.org/webt/k9/47/k_/k947k_nkfln04gnb6adkqda9vs4.jpeg"><br><br>  Mas para n√£o incomodar a crian√ßa interior, que queria se sentir como um engenheiro em uma situa√ß√£o em que colei duas pe√ßas de madeira compensada, decidi fazer um ‚Äúdesenho‚Äù.  Perdoe-me todos aqueles que entendem alguma coisa nos desenhos t√©cnicos, porque  Entendo que isso √© mais uma par√≥dia do desenho do que um desenho real, mas, como me pareceu, ele agregou valor a um simples brinquedo: <br><br><img src="https://habrastorage.org/webt/pk/t2/ms/pkt2msf9f2s496bchyrmdi6fs0w.png"><br><br><h2>  Hoje eu ... </h2><br>  √Äs vezes, o destino brinca conosco e de alguma forma sugere que algo deve acontecer em breve.  A hist√≥ria de um dos meus dispositivos come√ßa exatamente da mesma maneira.  Encomendei alguns eletr√¥nicos pequenos no valor de US $ 5, que, como de costume, passaram um m√™s na estrada, ap√≥s o qual recebi um SMS informando que o pacote estava me esperando na esta√ß√£o de correios local.  A caixa acabou sendo muito maior do que eu esperava e imediatamente levantou d√∫vidas sobre seu conte√∫do.  D√∫vidas foram confirmadas - por dentro, al√©m das pequenas coisas que pedi, havia tamb√©m uma tela de tinta colorida em tr√™s cores com uma diagonal de 4,2 polegadas.  Entrei em contato com o vendedor, ele confirmou que tinha estragado alguma coisa ao fazer as malas, mas disse que posso considerar isso um presente e us√°-lo como achar melhor. <br><br>  O destino sugeriu para mim que chegou a hora de iniciar um novo projeto e esse projeto ser√° algo com uma exibi√ß√£o de tinta eletr√¥nica.  Depois de me familiarizar brevemente com as especifica√ß√µes do dispositivo e conectar o monitor ao controlador, certifiquei-me de que as especifica√ß√µes n√£o me mentissem sobre o tempo de atualiza√ß√£o.  A tela foi atualizada por mais de 10 segundos, piscando e tentando me causar um ataque epil√©tico: <br><br><img src="https://habrastorage.org/webt/ni/w1/h5/niw1h5wpnfczyud_2593yvxq-mg.gif"><br>  (Eu n√£o tenho fotos antigas de conex√£o da tela, ent√£o aqui o dispositivo j√° tem uma apar√™ncia mais significativa) <br><br>  Ficou claro que voc√™ precisa de um dispositivo simples que n√£o exija anima√ß√µes complexas (e anima√ß√µes em geral).  E ent√£o me deparei com um calend√°rio de humor: <br><img src="https://habrastorage.org/webt/zm/a0/dg/zma0dglgpkea9lkxbnqlndawc-o.jpeg"><br><br>  O calend√°rio de humor √© um conjunto de fotos simples e assinaturas ir√¥nicas para eles.  Decidi criar um calend√°rio (que na verdade n√£o √© um calend√°rio) com o nome "Hoje eu" ... Ser√° um dispositivo simples que todos os dias exibe uma imagem que caracteriza o "estado de esp√≠rito" hoje e uma descri√ß√£o dele.  Al√©m disso, o calend√°rio tamb√©m pode ter outras fun√ß√µes, mas o calend√°rio principal seria precisamente o "calend√°rio" - sua pr√≥pria imagem para cada dia. <br><br>  O m√≥dulo de papel eletr√¥nico permitiu exibir tr√™s cores (preto, vermelho e branco), que devem ser transmitidas ao m√≥dulo, como duas figuras - preto e branco e vermelho e branco.  De fato, seria mais correto dizer que a tela simplesmente espera um bitmap monocrom√°tico, em que cada bit determina a cor de um pixel (n√£o tenho certeza de que esse termo seja aplic√°vel ao papel eletr√¥nico, mas espero que a ideia seja clara).  Um bitmap separado pode ser definido para o canal preto ou vermelho.  Portanto, h√° um conjunto de bytes em que cada bit definido como 1 corresponder√° a um pixel colorido e todos os bits que permanecerem 0 ser√£o pixels brancos na tela.  A resolu√ß√£o da tela √© de 400 x 300 pixels, ou seja,  para uma imagem em preto e branco, ser√£o necess√°rios 15.000 bytes (8 pixels s√£o codificados em um byte).  Para as tr√™s cores, ser√£o necess√°rios 30.000 bytes, se voc√™ n√£o tentar compactar a imagem de maneira mais compacta.  Do ponto de vista da implementa√ß√£o, os criadores da tela poderiam simplesmente selecionar dois bits por pixel e armazenar o estado real das coisas (onde √© vermelho, onde √© preto e onde √© branco), mas isso exigiria os mesmos 30.000 bytes, mas mesmo para imagens monocrom√°ticas exigiria a transfer√™ncia de 30.000 bytes. <br><br>  Como em qualquer um dos meus outros trabalhos manuais, comecei a inventar tarefas para mim, para que tudo n√£o se transformasse em "conectar a fia√ß√£o e fazer o download da biblioteca".  Mesmo se levarmos em conta a capacidade de implementar algum tipo de algoritmo de compacta√ß√£o de imagem no lado do controlador, ficou claro que, sem um armazenamento externo para arquivos de imagem, o controlador ficaria muito deprimido.  Foi decidido pegar um cart√£o SD e escrever um inv√≥lucro de c√≥digo simples para trabalhar com o FAT32.  Obviamente, seria poss√≠vel ficar sem um sistema de arquivos e gravar dados diretamente em um cart√£o de mem√≥ria, mas me pareceu menos conveniente para adicionar novos arquivos, e foi interessante para mim implementar as opera√ß√µes b√°sicas para trabalhar com o FAT32 com minhas pr√≥prias m√£os. <br><br>  √â importante esclarecer que eu tenho o h√°bito de escrever coisas sozinho (voc√™ n√£o deve me dizer que h√° um mar de bibliotecas, eu sei sobre isso e com o Google) quando fa√ßo essas coisas, mas desde  Antes disso, eu n√£o tinha o prazer de trabalhar com o FAT32 em um n√≠vel baixo, era um processo bastante divertido. <br><br>  N√£o entrarei em detalhes sobre como trabalhar com o FAT32 e o cart√£o SD como um todo, pois  a Internet est√° cheia de artigos sobre esse t√≥pico (e n√£o quero transformar minha hist√≥ria em uma recontagem de especifica√ß√µes), mas falarei sobre algumas coisas que precisavam ser implementadas.  √â necess√°rio implementar n√£o apenas as fun√ß√µes de leitura e grava√ß√£o de um arquivo (decidi armazenar algumas configura√ß√µes e estados no mesmo cart√£o SD, e n√£o na EEPROM), mas tamb√©m as fun√ß√µes de procurar um arquivo no sistema de arquivos, se voc√™ precisar trabalhar com da maneira usual. <br><br>  Todos os dados no cart√£o de mem√≥ria s√£o divididos em clusters (a principal unidade endere√ß√°vel no sistema de arquivos FAT32) e os clusters j√° est√£o divididos em setores.  Para ler o arquivo "habr.txt" do cart√£o SD no FAT32, voc√™ precisa: <br><br><ol><li>  Inicialize o cart√£o de mem√≥ria. </li><li>  Leia o setor no endere√ßo zero e verifique se o sistema de arquivos FAT32 possui um determinado cabe√ßalho (voc√™ pode pular esta etapa se acreditarmos na sorte). </li><li>  Leia o setor no endere√ßo zero e obtenha "Logical Block Addressing" (LBA). </li><li>  Leia o setor no endere√ßo recebido (LBA) e obtenha os dados necess√°rios (qual cluster √© a raiz - o diret√≥rio raiz, quantos setores est√£o no cluster etc.). </li><li>  Leia o cluster "Diret√≥rio Raiz" (na verdade, a leitura √© feita por setores, voc√™ s√≥ precisa ler quantos setores houver setores no cluster) pelo n√∫mero.  Possui sua pr√≥pria f√≥rmula para converter n√∫meros de s√©rie do cluster em endere√ßos f√≠sicos.  As informa√ß√µes do arquivo s√£o armazenadas aqui, ent√£o lemos os dados em busca do arquivo desejado.  H√° mais um pouco sobre nomes de arquivos: o nome pode ser curto ou longo, dependendo disso, os dados s√£o armazenados em um √∫nico local (na mesma estrutura) ou em um registro adicional, que tamb√©m deve ser lido separadamente.  Quando um arquivo com o nome desejado √© encontrado, obtemos o cluster no qual est√° localizado o in√≠cio (ou talvez o arquivo inteiro, se ele se encaixar no tamanho do cluster), bem como o tamanho do arquivo.  Se o arquivo n√£o for encontrado neste cluster, procuraremos o pr√≥ximo cluster e repetiremos o processo de pesquisa de arquivos. </li><li>  Leia o cluster no endere√ßo encontrado.  E continue a ler mais os clusters e procure o pr√≥ximo cluster at√© que todos os dados tenham sido lidos. </li></ol><br>  Parece-me que √© mais f√°cil dizer o princ√≠pio do sistema de arquivos √†queles que implementaram listas vinculadas pelo menos uma vez, porque  de fato, o sistema de arquivos FAT32 √© um conjunto de blocos de dados e um tipo de tabela que indica onde procurar o pr√≥ximo bloco de dados.  Ler todos os dados do FAT32 √© um processo em que lemos os dados, procuramos o endere√ßo do pr√≥ximo bloco, lemos os dados, procuramos o endere√ßo do pr√≥ximo bloco, etc. <br><br>  N√£o implementei todos os cen√°rios poss√≠veis e simplifiquei algumas coisas: <br><br><ul><li>  Todos os arquivos est√£o na raiz do cart√£o de mem√≥ria e a navega√ß√£o no diret√≥rio n√£o √© usada. </li><li>  Todos os arquivos t√™m nomes abreviados. </li><li>  O controlador na inicializa√ß√£o l√™ uma lista de arquivos e os armazena na mem√≥ria para n√£o procurar cada arquivo novamente. </li><li>  O n√∫mero m√°ximo de arquivos √© limitado por uma constante (e, de fato, desenhei apenas algumas dezenas de imagens). </li></ul><br>  Resumindo, tudo isso √© um motivo convincente para obter uma biblioteca pronta e n√£o gastar muito tempo lendo a documenta√ß√£o, desenvolvendo e depurando.  Eu me aconselharia a implementar essas coisas apenas para fins educacionais ou "por divers√£o". <br><br>  A tela tamb√©m imp√¥s algumas limita√ß√µes, como  qualquer imagem nela √© exibida desta maneira: <br><br><ol><li>  Acordamos e inicializamos a tela (para prolongar sua vida √∫til e economizar energia, a tela basicamente dorme). </li><li>  N√≥s expomos o canal necess√°rio (por exemplo, preto). </li><li>  Encaminhamos 15000 bytes da imagem. </li><li>  N√≥s expomos o canal necess√°rio (por exemplo, vermelho). </li><li>  Encaminhamos 15000 bytes da imagem. </li><li>  Dizemos ao visor para extrair dados do buffer. </li><li>  Esperamos at√© que a tela termine de desenhar. </li><li>  Dizemos √† tela para dormir. </li></ol><br>  Para imagens monocrom√°ticas, voc√™ pode pular as etapas 4 e 5. Para uma imagem em tr√™s cores, a ordem de transmiss√£o das imagens em preto e branco e vermelho e branco n√£o √© importante, porque  o vermelho √© sempre pintado sobre preto, o preto somente sobre branco e apenas os pixels permanecem brancos, que s√£o brancos e pretos e brancos e vermelhos e brancos. <br><br>  Por uma quest√£o de simplicidade (para n√£o aumentar o n√∫mero total de arquivos), decidi armazenar as imagens em preto e branco e vermelho e branco como um √∫nico arquivo, onde a imagem em preto e branco √© imediatamente seguida por vermelho e branco: <br><br><img src="https://habrastorage.org/webt/qo/p-/4j/qop-4jlidhtf82tthoxxspebl2o.png"><br><br>  O resultado da compara√ß√£o dessas imagens foi algo assim (parece-me que cada um de n√≥s pelo menos uma vez na vida se sentiu como um cervo com chifres - uma perna): <br><br><img src="https://habrastorage.org/webt/7o/tb/cs/7otbcsv6yqjrqivfjutep87b1am.png"><br><br>  De fato, as duas imagens foram seguidas por outra imagem que continha uma descri√ß√£o do estado (clicando no bot√£o, voc√™ pode obter uma descri√ß√£o que corresponda √† imagem exibida hoje). <br><br>  Devido √† mem√≥ria limitada do controlador, os dados do cart√£o de mem√≥ria nunca s√£o lidos inteiramente na mem√≥ria do controlador.  A imagem do cart√£o de mem√≥ria √© lida em fragmentos determinados pelo tamanho do setor (por simplicidade, assumimos que esse tamanho √© sempre est√°tico e n√£o pode ser alterado de cart√£o para cart√£o) e cai no processo de processamento de dados do cart√£o.  Na minha implementa√ß√£o, a fun√ß√£o de ler um arquivo toma como entrada o n√∫mero do cluster, o tamanho do arquivo e o retorno de chamada a serem "extra√≠dos" para cada setor lido.  Essa abordagem nos permitiu usar v√°rias fun√ß√µes diferentes de processamento de arquivos para ler e exibir a pr√≥pria imagem ou sua descri√ß√£o. <br><br>  Portanto, a seguinte l√≥gica recaiu na fun√ß√£o de retorno de chamada da leitura de imagens de um cart√£o de mem√≥ria: <br><br><ol><li>  Defina o canal necess√°rio (o canal √© determinado aleatoriamente) antes de enviar dados para o visor. </li><li>  Acompanhe os dados transmitidos para mudar de canal quando o envio de dados para o canal anterior for conclu√≠do. </li><li>  Envie dados recebidos do cart√£o. </li><li>  Determine que os dados necess√°rios foram transmitidos e que o restante dos dados (imagem com descri√ß√£o) pode ser ignorado. </li></ol><br>  Foi complicado pelo fato de eu ter decidido inserir imagens que continham mais dados do que deveriam ser exibidos na tela.  I.e.  h√° alguma imagem, que √© o plano de fundo e √© sempre est√°tica e corresponde ao tamanho da tela, e h√° uma imagem muito maior na qual √© necess√°rio tirar uma √°rea aleat√≥ria (o tamanho da tela) e exibir. <br><br>  Essa imagem impunha requisitos adicionais ao manipulador - era necess√°rio calcular quantos bytes da linha atual da tela foram transferidos, quanto mais precisava ser adicionado na pr√≥xima chamada (se a linha cair na borda do tamanho do setor) e quantos deveriam ser ignorados. <br><br>  Visualmente, essa situa√ß√£o pode ser mostrada assim: <br><br><img src="https://habrastorage.org/webt/22/iy/sr/22iysrbf7x-8n4ptpq4mtbq6kjc.png"><br><br>  H√° um certo buffer no qual existe uma ‚Äújanela‚Äù do tamanho necess√°rio (se√ß√£o verde) e voc√™ s√≥ precisa ler os dados dessa janela, lendo os dados do buffer em fragmentos de N bytes.  Seria poss√≠vel visualizar um processo de leitura como este: <br><br><img src="https://habrastorage.org/webt/cp/me/qo/cpmeqoznzfnhkflphfxdhscxhq0.gif"><br><br>  Em geral, adicionar a l√≥gica de trabalhar com a tela a uma fun√ß√£o que sempre recebe um buffer de 512 bytes e qual deve determinar qual desses 512 bytes √© necess√°rio (se √© necess√°rio algo) n√£o se revelou uma tarefa t√£o f√°cil de resolver. "Na testa".  Mais precisamente, a tarefa n√£o era t√£o complicada quanto n√£o-padr√£o em compara√ß√£o com as solu√ß√µes cotidianas; portanto, surpreendentemente, foi muito interessante resolv√™-la.  Para mim, era como uma ‚Äútarefa das olimp√≠adas‚Äù, onde era necess√°rio calcular a quantidade de eletricidade necess√°ria para contrair os m√∫sculos, a fim de transferir a √°gua de um balde para outro com duas colheres (uma colher em cada m√£o). <br><br>  Para entender melhor qual √© a dificuldade, adicionarei outra anima√ß√£o aqui, apenas "em termos de" o conte√∫do do cluster e n√£o o arquivo inteiro (todas as outras informa√ß√µes precisam ser armazenadas separadamente): <br><br><img src="https://habrastorage.org/webt/ba/vk/zg/bavkzgmfovjycovxj1uasy7kwae.gif"><br><br>  Conforme planejado, o calend√°rio deve mostrar uma nova imagem todos os dias, ou seja,  ele deve poder monitorar a hora (mesmo quando desligada), o que significa que tamb√©m √© necess√°rio um m√≥dulo de rel√≥gio em tempo real (RTC).  E, apesar do fato de o meu controlador possuir um rel√≥gio em tempo real, √© quase imposs√≠vel comprar uma bateria para ele, porque  os contatos n√£o est√£o conectados ao quadro.  Decidi n√£o estuprar as pernas do controlador na tentativa de sold√°-las e peguei o RTC chin√™s externo.  Trabalhar com o RTC era para ser completamente simples: <br><br><ul><li>  Quando ligado, obtenha tempo no RTC chin√™s. </li><li>  Defina a hora no RTC interno. </li><li>  Use o RTC interno para contar o tempo e esquecer os chineses at√© o pr√≥ximo desligamento. </li></ul><br>  Mas aqui, tudo acabou n√£o sendo t√£o simples, porque o RTC interno do controlador funciona com o tempo no formato usual (carimbo de data e hora do UNIX), e seu amigo chin√™s usa Decimal Codificado em Bin√°rio (BCD).  Antes disso, n√£o encontrei esse formato e fiquei muito surpreso que mesmo os m√≥dulos modernos do Arduino o usassem.  A ess√™ncia do formato √© bastante simples - h√° um byte que, por exemplo, armazena o n√∫mero de segundos.  Os quatro bits de alta ordem armazenam dezenas e as quatro bits de baixa ordem armazenam unidades.  Acontece que a representa√ß√£o hexadecimal desse byte em si cont√©m um tempo leg√≠vel - o byte 0x49 corresponde a um valor de 49 segundos (embora no sistema decimal, esse byte corresponda a 72). <br><br>  Pelo que entendi, isso aconteceu t√£o historicamente que era mais f√°cil usar o RTC diretamente com codificadores de tela para criar um rel√≥gio, mas tive que converter o carimbo de data / hora do BDC em UNIX com canetas. <br><br>  Al√©m da tela, do m√≥dulo de rel√≥gio em tempo real, do cart√£o de mem√≥ria e do sistema de arquivos, era necess√°rio envolver todas essas gl√¢ndulas em um estojo, que tamb√©m precisava ser fabricado, ou seja,  "Draw".  Voc√™ pode ler com mais detalhes toda a dor que encontrei na minha √∫ltima publica√ß√£o; tudo era exatamente o mesmo aqui: <br><br><img src="https://habrastorage.org/webt/f_/6i/jh/f_6ijh7_nag2fpzyjwzkdkapips.jpeg"><br>  (Eu n√£o planejei a produ√ß√£o em massa, todos os detalhes s√£o resultado de medi√ß√µes incorretas ou de solu√ß√µes mal pensadas) <br><br>  Como resultado, o caso e os detalhes necess√°rios foram desenhados (n√£o h√° capa na imagem): <br><br><img src="https://habrastorage.org/webt/pg/k9/w-/pgk9w-ajyangtju3ianmi1dm9jo.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os bot√µes foram colocados em uma pe√ßa separada para facilitar a montagem (parece que eu ainda aprendi alguma coisa desde a √©poca do √∫ltimo projeto): </font></font><br><br><img src="https://habrastorage.org/webt/lp/c_/i8/lpc_i8kkwazohmmz2ujiynl2lea.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A montagem (com exce√ß√£o das capas frontal e traseira) o dispositivo fica assim: O </font></font><br><br><img src="https://habrastorage.org/webt/ah/yq/un/ahyqun2x2cwbvpn2hk5o59dupbw.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">monitor √© anexado ao estojo com gravatas. </font><font style="vertical-align: inherit;">Isso acabou sendo um m√©todo muito mais conveniente do que aparafus√°-lo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bem, um pequeno inferno para os perfeccionistas (uma barba de fios e componentes): </font></font><br><br><img src="https://habrastorage.org/webt/tv/kh/pz/tvkhpznwutzclmhqaf_0q1abk_a.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A montagem acabou sendo um dispositivo para o qual eu fiz um pequeno livro - instru√ß√µes: </font></font><br><br><img src="https://habrastorage.org/webt/cw/s0/y9/cws0y9bk4nre9kwyjwjar2cvsui.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A tampa traseira √© parafusada, o que permite desmontar o dispositivo se for necess√°ria uma viol√™ncia adicional por dentro:</font></font><br><br><img src="https://habrastorage.org/webt/ec/dj/d6/ecdjd6m9-d85udrkqee-vphi1qe.jpeg"><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sim, √© mais f√°cil comprar uma casa √† beira-mar! </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E ent√£o algu√©m que leu at√© este ponto dir√°: ‚ÄúE isso √© uma alternativa aos presentes simples ?! Sim, voc√™ imediatamente precisa investir 100500 horas do seu tempo, o que √© muito mais caro que o dinheiro! ‚Äù N√£o discutirei sobre esse t√≥pico, apenas direi que para mim √© um processo meditativo e mato dois coelhos com uma cajadada - por um lado, fa√ßo coisas que basicamente ningu√©m precisa (poucos me pagariam para desenvolver algo tal), mas que s√£o interessantes para eu fazer, e uma pessoa recebe um objeto √∫nico como presente, que, embora n√£o carregue uma carga √∫til √≥bvia, d√° um sorriso. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, para que n√£o haja sabor residual de solu√ß√µes que exijam muito tempo, compartilharei mais algumas hist√≥rias curtas.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora, em geral, ficou muito na moda imprimir coisas em uma impressora 3D. </font><font style="vertical-align: inherit;">Os dispositivos de impress√£o tornaram-se muito mais acess√≠veis, e o software para criar modelos √© simples o suficiente para as crian√ßas entenderem.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Clame por ajuda </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No trabalho, tivemos uma piada sobre o fato de que, se voc√™ precisar de ajuda, basta gritar a gaivota e algu√©m definitivamente o ajudar√°. Na verdade, eu n√£o sei com o que isso est√° relacionado e de onde veio essa piada, mas em correspond√™ncias internas imagens de gaivotas frequentemente come√ßaram a aparecer, sugerindo que algu√©m precisa de ajuda. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, o escrit√≥rio de tipo aberto e a mod√©stia interna de alguns colegas n√£o lhes permitiram aproveitar ao m√°ximo a oportunidade de pedir ajuda como essa. Ent√£o, um "homem n√£o-engenheiro" decidiu vir em socorro, levando um "MP3 Player Module para MP3 para o Arduino", um clone chin√™s do Arduino Nano, alguns fios e alguns mp3s com a grava√ß√£o dos sons das gaivotas.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em geral, deve-se observar aqui que eu tenho o h√°bito de pedir v√°rios m√≥dulos com desconto, o que, parece-me, pode um dia ser √∫til, ou recebo eletr√¥nicos como um presente de amigos / conhecidos que n√£o acharam esses eletr√¥nicos √∫teis. </font><font style="vertical-align: inherit;">Portanto, a palavra "por a√≠" n√£o √© acidental, mas descreve com muita precis√£o o estado das coisas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como sou uma pessoa longe da modelagem 3D, peguei um modelo pronto da cabe√ßa da gaivota e fiz as altera√ß√µes necess√°rias. </font><font style="vertical-align: inherit;">Ou seja, a partir das mudan√ßas era necess√°rio:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Separe o bico da cabe√ßa para imprimi-lo em uma cor diferente. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fa√ßa uma ‚Äúcavidade‚Äù na qual todos os eletr√¥nicos estar√£o (alto-falante, tocador, arduino e fios). </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O resultado √© algo assim (o bico √© dividido em duas partes para melhor qualidade de impress√£o): </font></font><br><br><img src="https://habrastorage.org/webt/r7/nz/9_/r7nz9_z7qibv9mqtowdvp038dki.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o acho que fa√ßa sentido falar sobre o c√≥digo, porque </font><font style="vertical-align: inherit;">al√©m de inicializar o player, havia apenas um manipulador de cliques de bot√£o e tocando uma das grava√ß√µes de voz de gaivota (em geral: playSound (rand () &amp; 3);). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depois disso, deixe a gaivota para imprimir e coletar tudo juntos. </font><font style="vertical-align: inherit;">Como resultado, temos um "simulador de ch√°" completo (a cor da gaivota √© determinada pelo pl√°stico dispon√≠vel), que se conecta ao USB e quando voc√™ clica no bot√£o na cabe√ßa da gaivota, ele reproduz o "pedido de ajuda":</font></font><br><br><img src="https://habrastorage.org/webt/ec/xg/ts/ecxgtsytg7czrd89196s2bwm8de.jpeg"><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ainda mais f√°cil? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma colega reclamou que ela estava constantemente distra√≠da enquanto escrevia testes. </font><font style="vertical-align: inherit;">Encontramos na Internet um modelo 3D de √≥culos e fazemos pequenas altera√ß√µes: </font></font><br><br><img src="https://habrastorage.org/webt/kg/zz/jv/kgzzjvkhncuwiektwjpkjqciv54.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como resultado, temos √≥culos - cortinas. </font><font style="vertical-align: inherit;">N√£o nos distra√≠mos e outros entendem que voc√™ n√£o deve se distrair:</font></font><br><br><img src="https://habrastorage.org/webt/ce/vm/k5/cevmk5j74alm2qbuzodzsk5uplc.jpeg"><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Muito simples! </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ent√£o, para criar voc√™ precisa: </font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A capacidade de encontrar ou desenhar uma muleta no editor de vetores. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A capacidade de desenhar 2 cilindros no editor 3D, um a mais que o outro em ~ 0,4 mm. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A capacidade de fazer um simples peda√ßo de papel - uma etiqueta. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Impressora 3D (servi√ßo de impress√£o pr√≥prio ou personalizado). </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A impressora √© comum. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E agora, em ordem ... Desenhamos uma muleta: </font></font><br><br><img src="https://habrastorage.org/webt/l6/z_/uv/l6z_uvppvank9lg9tnt00clmeeq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desenhamos dois cilindros: </font></font><br><br><img src="https://habrastorage.org/webt/aa/xi/yd/aaxiydolfoszxdnh8duxmhk3io0.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imprimimos as pe√ßas e a etiqueta e recebemos um presente excelente e simples de "tyzhprogramistov":</font></font><br><br><img src="https://habrastorage.org/webt/ux/up/w9/uxupw9tma7hqfuhatlg6n2loies.jpeg"><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para que foi tudo isso? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äú√Äs vezes o destino brinca conosco e de alguma forma sugere que algo deve acontecer em breve.‚Äù V√°rias vezes na minha vida eu tinha id√©ias que queria realizar, mas esperei por algo. </font><font style="vertical-align: inherit;">Eu n√£o faria um "calend√°rio" eletr√¥nico se uma tela gratuita n√£o viesse da China, isso significa que eu nem lidaria com o FAT32, n√£o aprenderia sobre o formato BCD usado no RTC. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Talvez algu√©m leia essa hist√≥ria (ou pelo menos veja as figuras) e pense: ‚ÄúDroga, se ele pudesse, ent√£o eu posso faz√™-lo ainda melhor!‚Äù E, como resultado, trar√° alegria a algu√©m pr√≥ximo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Do lado de fora da janela est√° chovendo, dezembro est√° no calend√°rio. </font><font style="vertical-align: inherit;">A hora das f√©rias est√° se aproximando e, portanto, a hora dos presentes. </font><font style="vertical-align: inherit;">Fa√ßa e receba presentes interessantes, n√£o apenas mais uma caixa de chocolates, uma vela ou uma estatueta.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt480792/">https://habr.com/ru/post/pt480792/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt480780/index.html">Como montar uma ilustra√ß√£o a partir de cubos e pictogramas</a></li>
<li><a href="../pt480782/index.html">5 coisas que eu gostaria de saber quando comecei a usar o Angular</a></li>
<li><a href="../pt480786/index.html">Clonagem profunda independente de objetos em JavaScript</a></li>
<li><a href="../pt480788/index.html">√Årvore de Natal na linha de comando</a></li>
<li><a href="../pt480790/index.html">"Efici√™ncia de f√°brica". Localizando um gargalo e implementando um sistema pull para aumentar a produtividade</a></li>
<li><a href="../pt480794/index.html">Um pouco sobre o caso especial da implementa√ß√£o de algoritmos de pesquisa de portas abertas</a></li>
<li><a href="../pt480796/index.html">Programadores da Schrodinger, devops e gatos</a></li>
<li><a href="../pt480798/index.html">Revis√£o de relat√≥rios C ++ Russia Piter 2019</a></li>
<li><a href="../pt480800/index.html">Procurando um testador de emprego? Prepare-se para demonstrar as habilidades do desenvolvedor</a></li>
<li><a href="../pt480802/index.html">Engenharia do Caos, Parte 3: M√©todos e Ferramentas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>