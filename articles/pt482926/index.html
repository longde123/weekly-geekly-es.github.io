<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôè üíÉüèΩ ‚úãüèº O Arc √© um sistema de controle de vers√£o para um monoreposit√≥rio. Relat√≥rio Yandex üë®üèæ‚Äçüé§ ‚õé üà∫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Os sistemas de controle de vers√£o s√£o uma ferramenta di√°ria para desenvolvedores. Em grandes monoreposit√≥rios, os requisitos para eles s√£o muito espec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>O Arc √© um sistema de controle de vers√£o para um monoreposit√≥rio. Relat√≥rio Yandex</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/482926/">  Os sistemas de controle de vers√£o s√£o uma ferramenta di√°ria para desenvolvedores.  Em grandes monoreposit√≥rios, os requisitos para eles s√£o muito espec√≠ficos.  Por isso, as empresas adaptam as solu√ß√µes existentes, como o Facebook faz com o Mercurial e a Microsoft com o Git, ou desenvolvem seus pr√≥prios sistemas: Piper e CitC no Google e Arc VCS no Yandex. <br><br>  No relat√≥rio, o desenvolvedor Vladimir Kikhtenko <a href="https://habr.com/ru/users/kikht/" class="user_link">kikht</a> conta por que a Yandex precisava de seu pr√≥prio sistema de controle de vers√£o e como ele funciona.  Considere isso do lado de um desenvolvedor comum: como acessar o c√≥digo-fonte, reservar um ramo para desenvolvimento e integrar as altera√ß√µes em uma base de c√≥digo comum.  N√≥s olhamos por baixo - aprendemos sobre a representa√ß√£o interna dos dados e sua exibi√ß√£o em um sistema de arquivos virtual com uma c√≥pia de trabalho.  Discutiremos as dificuldades na implementa√ß√£o das fun√ß√µes do VCS em um sistema de arquivos virtual e ao carregar dados vagarosamente.  Vamos falar sobre como garantir a confiabilidade da infraestrutura do servidor do reposit√≥rio.  <a href="https://habr.com/ru/company/yandex/blog/482926">No final,</a> voc√™ pode ver um registro n√£o oficial do relat√≥rio. <br><br>  - Boa tarde a todos, meu nome √© Vladimir.  Todos voc√™s ouviram discursos sobre n√£o escrever bicicletas.  Meu relat√≥rio estar√° do outro lado da barricada. <br><a name="habracut"></a><br>  De fato, o Yandex tem um monoreposit√≥rio no qual h√° muito c√≥digo.  E chegamos √† conclus√£o de que estamos desenvolvendo nosso pr√≥prio sistema de controle de vers√£o. <br><br><img src="https://habrastorage.org/webt/l3/y8/lq/l3y8lqxua4etd-ukds2vvc5kxkg.jpeg"><br><br>  Como chegamos a essa vida?  Historicamente, esse monoreposit√≥rio morava conosco no SVN.  Ela pratica o desenvolvimento baseado em tronco.  N√£o h√° ramifica√ß√µes com muito poucas exce√ß√µes.  Todo o c√≥digo deve primeiro entrar no tronco e depois ficar cheio. <br><br>  Com o crescimento do reposit√≥rio, a √∫nica maneira poss√≠vel de trabalhar com ele foi o checkout seletivo, pois ele √© suportado no SVN.  Carregar o reposit√≥rio inteiro para si mesmo n√£o √© totalmente imposs√≠vel, mas √© muito dif√≠cil trabalhar com ele. <br><br><img src="https://habrastorage.org/webt/rw/i0/wa/rwi0wambw-yjb_ahmiwoytmvytk.jpeg"><br><br>  Qual √© a escala do nosso problema?  Aqui est√£o alguns n√∫meros: 6 milh√µes de confirma√ß√µes, quase 2 milh√µes de arquivos individuais.  O tamanho total com todo o hist√≥rico do reposit√≥rio √© de 2 TB.  Para deixar claro o que esses n√∫meros significam em compara√ß√£o com outros reposit√≥rios t√≠picos, aqui est√° um gr√°fico.  A mediana do GitHub √© o tamanho m√©dio do reposit√≥rio no GitHub, 1 MB.  O percentil 90 no GitHub √© o que meus colegas chamavam de "reposit√≥rio do filho da namorada da minha m√£e".  E tudo o resto s√£o os famosos grandes reposit√≥rios. <br><br><img src="https://habrastorage.org/webt/sb/dd/ek/sbddeks2vvyhyzwwmwsotp-etne.jpeg"><br><br>  At√© onde eu sei, o maior reposit√≥rio do mundo √© o Google.  Uma estimativa de seu tamanho √© dada a partir de um artigo em 2015 - provavelmente desde ent√£o eles cresceram.  Como voc√™ pode ver, a escala √© logar√≠tmica.  Pode-se ver que tamb√©m somos muito grandes. <br><br>  Como os diferentes sistemas de controle de vers√£o funcionam ao tentar baixar todo o reposit√≥rio?  Naturalmente, n√£o come√ßamos imediatamente a desenvolver nosso sistema de controle de vers√£o.  Tentamos converter nosso reposit√≥rio em diferentes sistemas.  A tentativa mais s√©ria foi feita com Mercurial.  E os resultados do tempo das opera√ß√µes t√≠picas ainda n√£o nos agradam. <br><br><img src="https://habrastorage.org/webt/xu/ww/bz/xuwwbztsv7_qyoptjukm2pu3nay.jpeg"><br><br>  Durante a prepara√ß√£o do relat√≥rio, o git-svn, infelizmente, n√£o p√¥de converter nosso reposit√≥rio inteiro.  Converti uma fatia de um pequeno n√∫mero de confirma√ß√µes, ent√£o n√£o posso estimar quantas opera√ß√µes relacionadas ao hist√≥rico funcionam.  Em um segmento, eles s√£o r√°pidos, e como ser√° para 6 milh√µes de confirma√ß√µes n√£o √© muito claro. <br><br>  No final, est√£o os n√∫meros do nosso sistema de controle de vers√£o.  Voc√™ pode obter instantaneamente uma c√≥pia de trabalho.  Na primeira partida, as opera√ß√µes de log ficam um pouco mais lentas; na segunda partida, tudo funciona rapidamente. <br><br>  E o √∫ltimo d√≠gito.  Como nosso sistema de controle de vers√£o carrega todos os dados pregui√ßosamente, apenas os c√≥digos-fonte que realmente elaboramos e que realmente usamos est√£o no disco.  Isso √© significativamente menor do que baixar o todo. <br><br><img src="https://habrastorage.org/webt/ig/8e/oh/ig8eohthc8a_mfyfyiaxjslhrka.jpeg"><br><br>  Como conseguimos isso?  A principal caracter√≠stica: a c√≥pia de trabalho que criamos n√£o √© um arquivo real no disco.  Este √© um sistema de arquivos virtual.  No Linux e Mac, isso √© feito com o fus√≠vel, no Windows com o ProjFS.  Carregamos todos os dados pregui√ßosamente; portanto, quanto espa√ßo em disco √© usado, como realmente precisamos, n√£o estamos tentando carregar tudo com anteced√™ncia.  E realizamos todo o tipo de opera√ß√µes pesadas no servidor.  Em particular - a opera√ß√£o do log e um pouco mais. <br><br><img src="https://habrastorage.org/webt/ig/jg/jw/igjgjww9nzy70irbsg-svup6_vi.jpeg"><br><br>  A interface do nosso sistema de controle de vers√£o, em geral, repete o Git, ent√£o n√£o mostrarei como √© o fluxo de trabalho t√≠pico.  Imagine o Git.  Tudo √© o mesmo: checkout para obter a revis√£o desejada, ramifica√ß√£o para criar ramifica√ß√µes, confirma√ß√£o para confirma√ß√µes, stash tamb√©m √© suportado da mesma maneira.  O que essa abordagem oferece?  Reduzimos significativamente o limite de entrada.  A maioria dos desenvolvedores dentro e fora do Yandex pode trabalhar com o Git.  Eles n√£o precisam aprender nada de novo. <br><br>  Por outro lado, n√£o temos o objetivo de derrubar o Git.  Falarei sobre isso mais tarde em mais detalhes.  Apoiar toda a variedade de equipes git parece loucura, quase n√£o precisamos de todas. <br><br><img src="https://habrastorage.org/webt/u2/fh/ke/u2fhkejztyav2rfuwrcsvmwmzv4.jpeg"><br><br>  Vou falar um pouco sobre o interior, sobre como tudo funciona.  Vamos come√ßar com o modelo de dados.  Nosso modelo de dados √© muito semelhante ao modelo geogr√°fico, com algumas diferen√ßas.  Da mesma forma, todos os objetos que criamos dentro s√£o imut√°veis, eles s√£o tratados por um hash de seu conte√∫do e, dentro, s√£o armazenados em flatbuffers. <br><br><img src="https://habrastorage.org/webt/0y/xn/5f/0yxn5fgiyjkgkuatsacat0igx44.jpeg"><br><br>  Como √© a estrutura?  Existem objetos de confirma√ß√£o, cada confirma√ß√£o tem um ancestral separado ou v√°rios.  E dessa maneira eles constroem algumas hist√≥rias do DAG (gr√°fico ac√≠clico direcionado). <br><br><img src="https://habrastorage.org/webt/vj/gq/ai/vjgqaiudbezdynjexr6ys2qnh30.jpeg"><br><br>  O que temos e o que n√£o apareceu imediatamente no Git s√£o os n√∫meros de gera√ß√£o.  Usando um algoritmo simples, consideramos uma certa dist√¢ncia da raiz da √°rvore.  Por que precisamos disso?  Tudo isso √© costurado na estrutura dos objetos, uma vez corrigido, e nunca muda novamente. <br><br>  Uma opera√ß√£o bastante importante para um sistema de controle de vers√£o √© encontrar o menor ancestral comum para os dois commits.  Na vers√£o b√°sica, ele pode ser implementado simplesmente percorrendo a largura, come√ßando em dois pontos, marcando todos os commits alcan√ßados l√° com um ou outro sinal, assim que eles encontrarem um commit com esses dois sinais, haver√° o ancestral menos comum. <br><br>  Como isso funcionar√° em uma implementa√ß√£o ing√™nua?  Algo assim: v√° ao redor e encontre nosso commit desejado. <br><br><img src="https://habrastorage.org/webt/_k/ua/ra/_kuarauekfozlpunbtufesyaxem.gif"><br><br>  O problema √© com B, que √© sup√©rfluo.  Parece que n√£o conseguimos entrar, mas analisamos.  E quanto mais tivermos a diferen√ßa entre um ramo e um tronco usando um exemplo, mais confirma√ß√µes extras encontraremos.  No caso de um monoreposit√≥rio, quando a taxa de consolida√ß√£o em um tronco √© alta o suficiente, essa dist√¢ncia pode ser muito grande.  E haver√° dezenas de milhares de confirma√ß√µes extras. <br><br><img src="https://habrastorage.org/webt/ls/qe/ko/lsqekoyn9trz8dxsqejf8tfkvdy.jpeg"><br><br><img src="https://habrastorage.org/webt/b2/_i/ld/b2_ild3rkleepwd-w2gwvnoegak.gif"><br><br>  No caso de existirem n√∫meros de gera√ß√£o, podemos usar a fila de prioridade ao rastrear, e o rastreamento ser√° mais ou menos assim: uma vez - e encontre imediatamente o que voc√™ precisa. <br><br><img src="https://habrastorage.org/webt/xq/dy/hx/xqdyhxj1w29lm5r0j_xdftsmg8y.jpeg"><br><br>  Este √© um exemplo da diferen√ßa entre o nosso modelo.  No Git, isso era suportado anteriormente, eles usavam carimbos de data e hora dos n√∫meros de gera√ß√£o, mas isso s√≥ funcionar√° se os hor√°rios para a cria√ß√£o de confirma√ß√µes forem consistentes com o gr√°fico de confirma√ß√£o. <br><br><img src="https://habrastorage.org/webt/l2/nz/ob/l2nzobltj8dcwjfefjrp_dpea68.jpeg"><br><br>  Infelizmente, esse n√£o √© o caso do nosso hist√≥rico de reposit√≥rios.  Existem confirma√ß√µes resultantes da migra√ß√£o de outro reposit√≥rio e o tempo come√ßa a retroceder nelas.  No Git, isso era suportado em algum momento, mas nem sempre √© aplic√°vel l√°, porque no Git voc√™ pode substituir o objeto de confirma√ß√£o por outro localmente.  A imunidade do modelo sofre com isso; portanto, os n√∫meros de gera√ß√£o que n√£o registram, √†s vezes n√£o s√£o aplic√°veis ‚Äã‚Äãao que est√° escrito neles, isso n√£o √© verdade.  N√£o temos esse problema. <br><br>  Outra vantagem dessa otimiza√ß√£o √© que ela √© completamente local.  Para usar esses n√∫meros, n√£o precisamos ter o gr√°fico de confirma√ß√£o inteiro.  E geralmente n√£o temos nada, conosco √© carregado pregui√ßosamente.  Quanto menos carregarmos pregui√ßosamente, melhor viveremos. <br><br>  Al√©m de confirma√ß√µes, o modelo √© muito semelhante ao Git.  Cada confirma√ß√£o aponta para um determinado objeto da √°rvore, a √°rvore consiste em registros, cada registro √© outra √°rvore e, portanto, a hierarquia de diret√≥rios √© exibida aqui, ou √© um blob, algum arquivo.  Al√©m disso, temos o BlobRef, quando o arquivo √© muito grande, dividimos em peda√ßos e o apresentamos em um objeto especial.  Isso √© tudo, como no Git. <br><br><img src="https://habrastorage.org/webt/zx/ma/yb/zxmaybpia7hh2rnjgzledt6ikg8.jpeg"><br><br>  Do que n√£o gostamos no Git?  Chamamos isso de informa√ß√£o de c√≥pia.  Se o arquivo foi copiado em algum tipo de confirma√ß√£o, o Git n√£o salva essas informa√ß√µes de forma alguma e tenta restaur√°-las com heur√≠sticas quando mostra diferen√ßas e status.  Guardamos essas informa√ß√µes no gr√°fico.  Os registros podem ter algum link de informa√ß√µes de c√≥pia para outro commit, para o caminho dentro do reposit√≥rio nesse commit, pelo qual sabemos que esse arquivo foi copiado nesse commit. <br><br>  Tamb√©m h√° desduplica√ß√£o, pois, ao lado, esse blob √© armazenado uma vez.  Mas a desduplica√ß√£o seria a mesma, porque o conte√∫do do arquivo n√£o foi alterado, pois seria desduplicado por hash. <br><br>  Como os back-ends s√£o organizados?  Se o Git tiver um sistema de controle de vers√£o distribu√≠do, n√£o precisar√° de back-end.  Sentimos isso especialmente quando o GitHub est√° inoperante.  Entendemos claramente que o Git n√£o precisa de back-end.  Nosso sistema √© cliente-servidor, ele armazena todos os dados no servidor e a disponibilidade do servidor √© necess√°ria para fazer o download dos objetos que ainda n√£o est√£o no cliente. <br><br><img src="https://habrastorage.org/webt/tn/ra/uz/tnrauzebvya5hi9zuvdjsorttxe.jpeg"><br><br>  Todos os dados que armazenamos no banco de dados Yandex.  Este √© um banco de dados muito legal que fornece a transa√ß√£o, o n√≠vel necess√°rio de confiabilidade.  Tem tudo o que precisamos, e isso nos salvou de muitos problemas. <br><br>  Gra√ßas a isso, os back-ends em si s√£o completamente sem estado, o estado inteiro est√° no banco de dados e os back-end que podemos escalar facilmente com a facilidade necess√°ria. <br><br>  E para a intera√ß√£o que com os clientes, a do interserver, usamos o gRPC, havia um relat√≥rio detalhado sobre isso hoje. <br><br><img src="https://habrastorage.org/webt/ce/xh/at/cexhatxlfxthnfdofvi1wedwexq.jpeg"><br><br>  Como nosso sistema √© integrado ao SVN?  O reposit√≥rio SVN continua ativo.  Al√©m disso, nosso sistema de controle de vers√£o ainda n√£o √© auto-suficiente.  Como ela trabalha nessa parte?  Inicialmente, h√° algum componente Converter que monitora o status do reposit√≥rio SVN e transforma as confirma√ß√µes do SVN em confirma√ß√µes do Arc - nosso sistema de controle de vers√£o. <br><br>  Em seguida, h√° um cliente que monta uma c√≥pia de trabalho e vai ao servidor para obter dados.  Quando um desenvolvedor confirma algo, ele √© enviado primeiro ao servidor Arc, mas, para que essas altera√ß√µes cheguem ao tronco, nossa filial principal, eles devem passar pelo sistema de solicita√ß√£o de pool e pelo sistema de revis√£o de c√≥digo.  A√≠ vem outro servi√ßo que monitora as ramifica√ß√µes do Arc e, se forem atualizadas, envia uma solicita√ß√£o de pool √† nossa revis√£o de c√≥digo do sistema.  A seguir, o sistema de revis√£o de c√≥digo, quando for decidido que esse patch precisa ser mesclado, o confirma ao SVN.  N√£o √© t√£o simples: ele adiciona uma certa quantidade de metadados para que esse commit seja realmente uma mescla desse e daquele ramo do Arc.  E ent√£o essa confirma√ß√£o j√° v√™ o conversor, encontra esses metadados e cria uma confirma√ß√£o no servidor Arc.  Este √© o ciclo de confirma√ß√µes.  Portanto, enquanto n√£o podemos viver sem SVN, porque temos tronco no SVN. <br><br>  O ramo principal √© constantemente sincronizado com o nosso servidor, mas n√£o permitimos confirmar diretamente com ele. <br><br><img src="https://habrastorage.org/webt/gi/a0/-1/gia0-1aqpsq2bt3xsikjhilcr2g.jpeg"><br><br>  Sobre a confiabilidade dos back-ends.  Obviamente, planejamos que todos os desenvolvedores do Yandex usem essa coisa, por isso √© importante para n√≥s que n√£o quebre.  Esse √© um padr√£o intra-√≠ndice: nossos servi√ßos devem sobreviver √† falha de qualquer data center.  O sistema de controle de vers√£o n√£o √© exce√ß√£o.  Aqui, somos grandemente salvos pelo fato de o YDB suportar isso.  E nossos back-end s√£o sem estado, existem diferentes partes implementadas de maneiras ligeiramente diferentes.  Servidores que operam em objetos Arc operam em ramifica√ß√µes, s√£o sem estado, replicados.  Conversores que convertem constantemente do SVN s√£o replicados de acordo com o esquema ativo-ativo.  Existem v√°rios conversores trabalhando simultaneamente, eles convertem ao mesmo tempo e, no momento em que tentam atualizar a ramifica√ß√£o do Arc, resolvem conflitos.  Um conseguiu, o outro falhou.  Ele est√° tentando converter algo mais. <br><br>  O servi√ßo de solicita√ß√£o de pool √© replicado pelo master-slave.  H√° uma delas funcionando.  Se falhar, um novo √© selecionado atrav√©s do YDB.  H√° coisas maravilhosas como os sem√°foros, que t√™m s√©rias garantias de acessibilidade e confiabilidade.  Os acessos aos sem√°foros s√£o completamente serializados.  Usamos sem√°foros para o servi√ßo de descoberta de solicita√ß√µes de pool e para selecionar l√≠deres. <br><br>  Um pouco sobre como o cliente funciona.  Essa √© a parte mais dif√≠cil do nosso sistema de controle de vers√£o, porque existe um sistema de arquivos virtual.  De fato, somos for√ßados a implementar todas as opera√ß√µes em arquivos por conta pr√≥pria.  Analisarei algumas opera√ß√µes b√°sicas, descreverei aproximadamente nos dedos o que acontece l√° dentro quando as fazemos. <br><br><img src="https://habrastorage.org/webt/is/sg/5l/issg5lt5g8ozy9hfmjalxuhhbig.jpeg"><br><br>  Por exemplo, abrimos um arquivo para grava√ß√£o.  Quando abrimos o arquivo para grava√ß√£o, encontramos o blob correspondente do nosso modelo de objeto.  Se necess√°rio, fa√ßa o upload de algo do servidor.  Se criarmos fisicamente um arquivo em uma loja especial, todas as solicita√ß√µes adicionais que forem para esse arquivo ser√£o enviadas para proxy.  Assim, at√© que as altera√ß√µes localizadas sejam confirmadas (no Git √© chamado de n√£o-est√°gio), elas entram no armazenamento tempor√°rio.  Chamamos esses arquivos de materializados. <br><br><img src="https://habrastorage.org/webt/wi/ig/ar/wiigarboe1byzw6g2dm1tpj3mda.jpeg"><br><br>  Se abrirmos o arquivo para leitura, n√£o poderemos materializar nada, mas simplesmente fornecer dados diretamente do nosso blob. <br><br><img src="https://habrastorage.org/webt/kt/4w/qg/kt4wqgxgb6p155jfrcsmej5kxek.jpeg"><br><br>  Aqui √© o momento em que adicionamos o arquivo ao √≠ndice.  Neste ponto, voc√™ precisa ver se temos algo materializado.  Existe um arquivo que foi alterado.  Se estiver, crie um blob para ele e salve-o no √≠ndice. <br><br><img src="https://habrastorage.org/webt/-d/qj/lx/-dqjlxli2tamjacrjl2aus-iinu.jpeg"><br><br>  A pr√≥xima opera√ß√£o √© o status do arco.  √â interessante porque √© o que em sistemas de controle de vers√£o convencionais em tamanhos t√£o lentos, porque precisa percorrer toda a √°rvore de arquivos.  N√£o precisamos percorrer toda a √°rvore de arquivos, porque todos os pedidos de altera√ß√£o de arquivos passam por nosso driver de fus√≠vel e sabemos imediatamente quais arquivos valem a pena verificar se h√° altera√ß√µes.  Verificamos o que conseguimos escrever no √≠ndice e imprimimos a resposta. <br><br><img src="https://habrastorage.org/webt/wa/7f/0e/wa7f0emrhfllexxyj8asf0kplso.jpeg"><br><br>  Confirme o tempo.  Tudo parece estar claro.  Existe um √≠ndice, j√° criamos blobs para esses objetos, criamos objetos em √°rvore que correspondem a esse estado, criamos um novo objeto de confirma√ß√£o e escrevemos no armazenamento de objetos. <br><br><img src="https://habrastorage.org/webt/eb/p4/uj/ebp4ujcdu2jg9vk18vnsgg9by9o.jpeg"><br><br>  Em seguida, alternamos a c√≥pia de trabalho para o novo commit.  Esta √© uma opera√ß√£o complicada, que pode ser claramente feita com o comando checkout.  E aqui voc√™ pode pensar que todas as nossas altera√ß√µes locais parecem j√° ter se materializado, podemos assumir que devemos devolver arquivos que n√£o s√£o materializados a partir de novas confirma√ß√µes.  E √© isso.  Todas as opera√ß√µes subseq√ºentes s√£o simplesmente enviadas para outra √°rvore e blobs. <br><br><img src="https://habrastorage.org/webt/ne/qa/cu/neqacudmw91qauhiaoonre_49zm.jpeg"><br><br>  Por que isso pode n√£o funcionar?  A primeira vers√£o foi sobre isso.  O problema est√° em todos os tipos de opera√ß√µes complicadas, como redefini√ß√£o de arco - suave.  Eles nos trocam de √°rvore, mas n√£o materializam arquivos.  Eles continuam a existir em algum lugar sagrado.  Tamb√©m temos arquivos n√£o rastreados e ignorados, que tamb√©m precisam ser processados ‚Äã‚Äãde uma maneira especial.  Nesse local, coletamos muitos ancinhos e, finalmente, chegamos √† conclus√£o de que ainda precisamos pegar uma √°rvore (agora uma c√≥pia de trabalho) durante o checkout, pegar a √°rvore do commit para o qual estamos mudando, pegar o √≠ndice e aceit√°-lo perfeitamente espere. <br><br>  Mas em termos da complexidade dos algoritmos, n√£o perdemos nada aqui: todas essas √°rvores de mudan√ßas locais s√£o proporcionais √†s mudan√ßas que fizemos.  Portanto, n√£o devemos percorrer todo o reposit√≥rio com essas opera√ß√µes, elas ainda funcionam muito rapidamente. <br><br>  Ao mesmo tempo, estamos fazendo alguma m√°gica para que os carimbos de data e hora que damos aos arquivos sejam mais ou menos corretos.  Se apenas armazenarmos arquivos no sistema de arquivos, ele ser√° monitorado, e o tempo sempre passa.  Aqui n√≥s mesmos devemos lembrar de alguma forma que arquivo o usu√°rio viu em que momento.  E se ele mudou para um commit anterior, n√£o comece a dar um tempo antes.  Como os sistemas de montagem, todos os IDEs n√£o est√£o prontos para isso, eles tiram muitas coisas. <br><br><img src="https://habrastorage.org/webt/r7/h7/fd/r7h7fdedl8-aip9z49ovoeb3zci.jpeg"><br><br>  Em nosso sistema de controle de vers√£o, o suporte ao desenvolvimento baseado em tronco √© acertado.  Primeiro, o que eu j√° disse: todas as altera√ß√µes passam pelas solicita√ß√µes e tronco da piscina.  H√° mais alguns pontos.  N√£o temos suporte de ramifica√ß√£o de grupo.  As ramifica√ß√µes criadas no Arc s√£o vinculadas a um usu√°rio espec√≠fico, e somente ele pode confirmar l√°.  Isso nos permite evitar ramos de vida longa.  No SVN, isso n√£o foi particularmente porque √© inconveniente fazer ramifica√ß√µes l√°.  E √© conveniente faz√™-las no Arc, e se isso n√£o for controlado, temos medo de que algumas partes do nosso mono-reposit√≥rio deixem suas ramifica√ß√µes e conduzam seu desenvolvimento l√°.  Isso √© contr√°rio ao modelo que queremos fazer. <br><br><img src="https://habrastorage.org/webt/uq/9a/bv/uq9abvkh2dunwxijq1vpuqefh7a.jpeg"><br><br>  Em segundo lugar, n√£o temos um comando de mesclagem.  Todas as fus√µes de filiais ocorrem sob nosso r√≠gido controle.  Agora estamos desenvolvendo ramifica√ß√µes para lan√ßamentos, nas quais tamb√©m ser√° poss√≠vel mesclar.  Isso tamb√©m ser√° realizado n√£o por alguma equipe de usu√°rios, mas por m√°quinas de servidor, provavelmente. <br><br><img src="https://habrastorage.org/webt/qa/dk/yl/qadkylvgcbgyx8lwuvc3n93ix7e.jpeg"><br><br>  Quais s√£o os nossos planos?  20% dos desenvolvedores de monoreposit√≥rios j√° usam nosso sistema de controle de vers√£o.      -  ,    ,      .   ‚Äî       .   -   80% ,    ,     . ,           ,    Git. <br><br> ,  -     ,         ,       Arc,     SVN    . <br><br>      ‚Äî       ,   CI   .   ,    ,       .      .     . <br><br>    ‚Äî    ,   CI        Arc, - .         ,       .     .      ,      ++-  ,  ,      .     . <br><br>   .      ¬´  Git¬ª.       :   Git.      ,   ,     . <br><br>   .  Git  .      ,       .     -  .       ,        checkout  reset,       .   ,     ,       .   :    Git. ¬´    ,   ¬ª.  Git   . <br><br>        .       Git,  git begin-wave-stash? <br><br>  : <br> ‚Äî  . <br><br> ‚Äî   ,  Git    ?     ‚Äî         ,   ,      ,   .  ,     .  Git   .         ,      . . <br><br><a name="video"></a><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/PQWdvuo6Gzc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt482926/">https://habr.com/ru/post/pt482926/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt482908/index.html">A segunda parte da tradu√ß√£o do livro de David Kouchner, Masters of Doom. Cap√≠tulos 6-12</a></li>
<li><a href="../pt482912/index.html">A ideia de uma rede social descentralizada de pr√≥xima gera√ß√£o</a></li>
<li><a href="../pt482918/index.html">Salvando Dados em uma EEPROM em um Arduino Transacionalmente</a></li>
<li><a href="../pt482920/index.html">Como o piloto autom√°tico entrou em nossas vidas, mas n√£o percebemos</a></li>
<li><a href="../pt482922/index.html">Drupal Digest - 2019 / Dezembro</a></li>
<li><a href="../pt482928/index.html">Vis√£o Predadora: Efeito de Vis√£o T√©rmica</a></li>
<li><a href="../pt482930/index.html">Pesquisa geneal√≥gica - livros m√©tricos, censos, arquivos, bancos de dados abertos</a></li>
<li><a href="../pt482932/index.html">IIoT - ou como ajudar os funcion√°rios a usar o c√©rebro como pretendido</a></li>
<li><a href="../pt482934/index.html">Falha no projeto do ERP (Liqui Moly, Otto e outros como ele)</a></li>
<li><a href="../pt482936/index.html">Introdu√ß√£o ao ASGI: Criando um ecossistema da Web Python ass√≠ncrono</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>