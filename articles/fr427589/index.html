<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíáüèΩ ‚è© üë©‚Äçüè´ Nous √©crivons un chat en ligne sur Websockets en utilisant Swoole üë®‚Äçüë¶ üóΩ ‚ÅâÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le th√®me des Websockets a d√©j√† √©t√© abord√© √† plusieurs reprises sur Habr√©, en particulier des options d'impl√©mentation en PHP ont √©t√© envisag√©es. Cepen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nous √©crivons un chat en ligne sur Websockets en utilisant Swoole</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427589/"><img src="https://habrastorage.org/webt/8p/gc/di/8pgcdiztceoyeqy2os69qvw8rmq.png"><br><br>  Le th√®me des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Websockets a</a> d√©j√† √©t√© abord√© √† plusieurs reprises sur Habr√©, en particulier des options d'impl√©mentation en PHP ont √©t√© envisag√©es.  Cependant, plus d'un an s'est √©coul√© depuis le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dernier article</a> avec un aper√ßu des diff√©rentes technologies, et le monde PHP <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">a de quoi se</a> vanter au fil du temps. <br><br>  Dans cet article, je veux pr√©senter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Swoole</a> √† la communaut√© russophone - Framework Open Source asynchrone pour PHP, √©crit en C, et livr√© en tant qu'extension pecl. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sources sur github</a> . <br><a name="habracut"></a><br><h2>  Pourquoi swoole? </h2><br>  Il y aura s√ªrement des gens qui seront en principe contre l'utilisation de PHP √† de telles fins, cependant, ils peuvent souvent jouer en faveur de PHP: <br><br><ul><li>  R√©ticence √† √©lever un zoo de diff√©rentes langues sur le projet </li><li>  Possibilit√© d'utiliser une base de code d√©j√† d√©velopp√©e (si le projet est en PHP). </li></ul><br>  N√©anmoins, m√™me en comparant avec node.js / go / erlang et d'autres langages qui proposent nativement un mod√®le asynchrone, Swoole - un framework √©crit en C et combinant un seuil d'entr√©e bas et des fonctionnalit√©s puissantes peut √™tre un bon candidat. <br><br>  <b>Caract√©ristiques du cadre:</b> <br><br><ul><li>  √âv√©nement, mod√®le de programmation asynchrone </li><li>  API client / serveur TCP / UDP / HTTP / Websocket / HTTP2 asynchrones </li><li>  Prise en charge IPv4 / IPv6 / Unixsocket / TCP / UDP et SSL / TLS </li><li>  S√©rialisation / d√©s√©rialisation rapide des donn√©es </li><li>  Haute performance, extensibilit√©, prise en charge de jusqu'√† 1 million de connexions simultan√©es </li><li>  Planificateur de t√¢ches en millisecondes </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Open source</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Assistance: Coroutines</a> </li></ul><br>  <b>Cas d'utilisation possibles:</b> <br><br><ul><li>  Microservices </li><li>  Serveurs de jeux </li><li>  Internet des objets </li><li>  Syst√®mes de communication en direct </li><li>  API WEB </li><li>  Tout autre service n√©cessitant une r√©ponse instantan√©e / haute vitesse / ex√©cution asynchrone </li></ul><br>  Des exemples de code peuvent √™tre vus sur la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">page principale du site</a> .  Dans la section documentation, des informations plus d√©taill√©es sur toutes les fonctionnalit√©s du framework. <br><br><h2>  Commen√ßons </h2><br>  Ci-dessous, je d√©crirai le processus d'√©criture d'un simple serveur Websocket pour le chat en ligne et les difficult√©s possibles avec cela. <br><br>  Avant de commencer: Plus d'informations sur les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">classes</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">swoole_websocket_server</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">swoole_server</a> (la deuxi√®me classe h√©rite de la premi√®re). <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sources du chat lui-m√™me.</a> <br><br><div class="spoiler">  <b class="spoiler_title">Installer le framework</b> <div class="spoiler_text"><code>Linux users <br> <br> #!/bin/bash <br> pecl install swoole <br> <br> Mac users <br> <br> # get a list of avaiable packages <br> brew install swoole <br> #!/bin/bash <br> brew install homebrew/php/php71-swoole <br></code> <br></div></div><br>  Pour utiliser la saisie semi-automatique dans l'IDE, il est propos√© d'utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ide-helper</a> <br><br>  <b>Mod√®le de serveur Websocket minimum:</b> <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $server = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> swoole_websocket_server(<span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>, <span class="hljs-number"><span class="hljs-number">9502</span></span>); $server-&gt;on(<span class="hljs-string"><span class="hljs-string">'open'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($server, $req)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"connection open: {$req-&gt;fd}\n"</span></span>; }); $server-&gt;on(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($server, $frame)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"received message: {$frame-&gt;data}\n"</span></span>; $server-&gt;push($frame-&gt;fd, json_encode([<span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span>])); }); $server-&gt;on(<span class="hljs-string"><span class="hljs-string">'close'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($server, $fd)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"connection close: {$fd}\n"</span></span>; }); $server-&gt;start();</code> </pre><br>  $ fd est l'identifiant de connexion. <br>  Obtenez les connexions actuelles: <br><br><pre> <code class="php hljs">$server-&gt;connections;</code> </pre> <br>  $ Frame contient toutes les donn√©es envoy√©es.  Voici un exemple d'un objet entr√© dans la fonction onMessage: <br><br><pre> <code class="plaintext hljs">Swoole\WebSocket\Frame Object ( [fd] =&gt; 20 [data] =&gt; {"type":"login","username":"new user"} [opcode] =&gt; 1 [finish] =&gt; 1 )</code> </pre><br>  Les donn√©es sont envoy√©es au client √† l'aide de la fonction <br><br><pre> <code class="php hljs">Server::push($fd, $data, $opcode=<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, $finish=<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)</code> </pre> <br>  En savoir plus sur les cadres et les opcodes en russe sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">learn.javascript</a> .  Section "format des donn√©es" <br><br>  Autant que possible sur le protocole Websocket - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RFC</a> <br><br>  <b>Et comment enregistrer les donn√©es qui sont arriv√©es sur le serveur?</b> <br>  Swoole introduit des fonctionnalit√©s pour travailler de mani√®re asynchrone avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MySQL</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Redis</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">les E / S de fichiers</a> <br><br>  Ainsi que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">swoole_buffer</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">swoole_channel</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">swoole_table</a> <br>  Je pense que les diff√©rences ne sont pas difficiles √† comprendre √† partir de la documentation.  Pour stocker les noms d'utilisateurs, j'ai s√©lectionn√© swoole_table.  Les messages eux-m√™mes sont stock√©s dans MySQL. <br><br>  Donc, initialisation de la table des noms d'utilisateurs: <br><br><pre> <code class="php hljs">$users_table = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> swoole_table(<span class="hljs-number"><span class="hljs-number">131072</span></span>); $users_table-&gt;column(<span class="hljs-string"><span class="hljs-string">'id'</span></span>, swoole_table::TYPE_INT, <span class="hljs-number"><span class="hljs-number">5</span></span>); $users_table-&gt;column(<span class="hljs-string"><span class="hljs-string">'username'</span></span>, swoole_table::TYPE_STRING, <span class="hljs-number"><span class="hljs-number">64</span></span>); $users_table-&gt;create();</code> </pre><br>  Le remplissage des donn√©es est le suivant: <br><br><pre> <code class="php hljs">$count = count($messages_table); $dateTime = time(); $row = [<span class="hljs-string"><span class="hljs-string">'username'</span></span> =&gt; $username, <span class="hljs-string"><span class="hljs-string">'message'</span></span> =&gt; $data-&gt;message, <span class="hljs-string"><span class="hljs-string">'date_time'</span></span> =&gt; $dateTime]; $messages_table-&gt;set($count, $row);</code> </pre><br>  Pour travailler avec MySQL, j'ai d√©cid√© de ne pas encore utiliser le mod√®le asynchrone, mais d'y acc√©der de mani√®re standard, depuis le serveur de socket web, via PDO <br><br><div class="spoiler">  <b class="spoiler_title">Appel √† la base</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> Message[] */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $stmt = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;pdo-&gt;query(<span class="hljs-string"><span class="hljs-string">'SELECT * from messages'</span></span>); $messages = []; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($stmt-&gt;fetchAll() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $row) { $messages[] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Message( $row[<span class="hljs-string"><span class="hljs-string">'username'</span></span>], $row[<span class="hljs-string"><span class="hljs-string">'message'</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \DateTime($row[<span class="hljs-string"><span class="hljs-string">'date_time'</span></span>]) ); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $messages; }</code> </pre> <br></div></div><br>  Serveur Websocket, il a √©t√© d√©cid√© d'√©mettre sous forme de classe, et de le d√©marrer dans le constructeur: <br><br><div class="spoiler">  <b class="spoiler_title">Constructeur</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;ws = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> swoole_websocket_server(<span class="hljs-string"><span class="hljs-string">'0.0.0.0'</span></span>, <span class="hljs-number"><span class="hljs-number">9502</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;ws-&gt;on(<span class="hljs-string"><span class="hljs-string">'open'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($ws, $request)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;onConnection($request); }); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;ws-&gt;on(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($ws, $frame)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;onMessage($frame); }); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;ws-&gt;on(<span class="hljs-string"><span class="hljs-string">'close'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($ws, $id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;onClose($id); }); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;ws-&gt;on(<span class="hljs-string"><span class="hljs-string">'workerStart'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(swoole_websocket_server $ws)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;onWorkerStart($ws); }); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;ws-&gt;start(); }</code> </pre> <br></div></div><br>  <b>Probl√®mes rencontr√©s:</b> <br><br><ol><li>  Un utilisateur connect√© au chat se d√©connecte apr√®s 60 secondes s'il n'y a pas d'√©change de paquets (c'est-√†-dire que l'utilisateur n'a rien envoy√© ni re√ßu) </li><li>  Le serveur Web perd la connexion avec MySQL si aucune interaction ne se produit pendant longtemps </li></ol><br>  Solution: <br><br>  Dans les deux cas, nous avons besoin d'une impl√©mentation de la fonction ping, qui testera en permanence le client toutes les n secondes dans le premier cas, et la base de donn√©es MySQL dans le second. <br><br>  √âtant donn√© que les deux fonctions doivent fonctionner de mani√®re asynchrone, elles doivent √™tre appel√©es dans les processus enfants du serveur. <br><br>  Pour ce faire, ils peuvent √™tre initialis√©s avec l'√©v√©nement "workerStart".  Nous l'avons d√©j√† d√©fini dans le constructeur, et avec cet √©v√©nement, la m√©thode $ this-&gt; onWorkerStart est d√©j√† appel√©e: <br>  Le protocole Websocket prend en charge le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ping-pong</a> hors de la bo√Æte.  Ci-dessous, vous pouvez voir l'impl√©mentation sur Swoole. <br><br><div class="spoiler">  <b class="spoiler_title">onWorkerStart</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onWorkerStart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(swoole_websocket_server $ws)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;messagesRepository = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MessagesRepository(); $ws-&gt;tick(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::PING_DELAY_MS, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($ws)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($ws-&gt;connections <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $id) { $ws-&gt;push($id, <span class="hljs-string"><span class="hljs-string">'ping'</span></span>, WEBSOCKET_OPCODE_PING); } }); }</code> </pre> <br></div></div><br>  Ensuite, j'ai impl√©ment√© une fonction simple pour envoyer un ping √† un serveur MySQL toutes les N secondes en utilisant swoole \ Timer: <br><br><div class="spoiler">  <b class="spoiler_title">DatabaseHelper</b> <div class="spoiler_text">  Le temporisateur lui-m√™me d√©marre dans initPdo s'il n'est pas d√©j√† activ√©: <br><br><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Init new Connection, and ping DB timer function */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initPdo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$timerId === <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || (!Timer::exists(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$timerId))) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$timerId = Timer::tick(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::MySQL_PING_INTERVAL, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::ping(); }); } <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$pdo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PDO(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::DSN, DBConfig::USER, DBConfig::PASSWORD, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::OPT); } <span class="hljs-comment"><span class="hljs-comment">/** * Ping database to maintain the connection */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ping</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$pdo-&gt;query(<span class="hljs-string"><span class="hljs-string">'SELECT 1'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (PDOException $e) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::initPdo(); } }</code> </pre><br></div></div><br>  La partie principale du travail consistait √† √©crire une logique pour ajouter, enregistrer, envoyer des messages (pas plus compliqu√© que le CRUD habituel), puis une √©norme marge d'am√©lioration. <br><br>  Jusqu'√† pr√©sent, j'ai apport√© mon code sous une forme plus ou moins lisible et un style orient√© objet, j'ai impl√©ment√© un peu de fonctionnalit√©: <br><br>  - Connectez-vous par nom; <br><br><div class="spoiler">  <b class="spoiler_title">- V√©rifiez que le nom n'est pas occup√©</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $username * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> bool */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isUsernameCurrentlyTaken</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $username)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;usersRepository-&gt;getByIds(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;ws-&gt;connection_list()) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $user) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($user-&gt;getUsername() == $username) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">- Limiteur de spam</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Helpers</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoole</span></span>\<span class="hljs-title"><span class="hljs-title">Channel</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RequestLimiter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Channel */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $userIds; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MAX_RECORDS_COUNT = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MAX_REQUESTS_BY_USER = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;userIds = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Channel(<span class="hljs-number"><span class="hljs-number">1024</span></span> * <span class="hljs-number"><span class="hljs-number">64</span></span>); } <span class="hljs-comment"><span class="hljs-comment">/** * Check if there are too many requests from user * and make a record of request from that user * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $userId * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> bool */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkIsRequestAllowed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $userId)</span></span></span><span class="hljs-function"> </span></span>{ $requestsCount = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRequestsCountByUser($userId); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addRecord($userId); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($requestsCount &gt;= <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::MAX_REQUESTS_BY_USER) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $userId * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> int */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRequestsCountByUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $userId)</span></span></span><span class="hljs-function"> </span></span>{ $channelRecordsCount = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;userIds-&gt;stats()[<span class="hljs-string"><span class="hljs-string">'queue_num'</span></span>]; $requestsCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; $channelRecordsCount; $i++) { $userIdFromChannel = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;userIds-&gt;pop(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;userIds-&gt;push($userIdFromChannel); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($userIdFromChannel === $userId) { $requestsCount++; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $requestsCount; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $userId */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addRecord</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $userId)</span></span></span><span class="hljs-function"> </span></span>{ $recordsCount = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;userIds-&gt;stats()[<span class="hljs-string"><span class="hljs-string">'queue_num'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($recordsCount &gt;= <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::MAX_RECORDS_COUNT) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;userIds-&gt;pop(); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;userIds-&gt;push($userId); } }</code> </pre> <br>  PS: Oui, la v√©rification est sur l'identifiant de connexion.  Il est peut-√™tre judicieux de le remplacer dans ce cas, par exemple, par l'adresse IP de l'utilisateur. <br><br>  Je ne suis pas s√ªr non plus que dans cette situation, ce soit swoole_channel qui soit le mieux adapt√©.  Je pense plus tard √† revoir ce moment. <br></div></div><br>  - Protection XSS <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">simple en</a> utilisant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ezyang / htmlpurifier</a> <br><br><div class="spoiler">  <b class="spoiler_title">- Filtre anti-spam simple</b> <div class="spoiler_text">  Avec la possibilit√© d'ajouter des contr√¥les suppl√©mentaires √† l'avenir. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Helpers</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SpamFilter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string[] errors */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $errors = []; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $text * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> bool */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkIsMessageTextCorrect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $text)</span></span></span><span class="hljs-function"> </span></span>{ $isCorrect = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(trim($text))) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;errors[] = <span class="hljs-string"><span class="hljs-string">'Empty message text'</span></span>; $isCorrect = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $isCorrect; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string[] errors */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getErrors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;errors; } }</code> </pre> <br></div></div><br>  Le chat frontal est encore tr√®s brut, car  Je suis plus attir√© par le backend, mais quand il y aura plus de temps, j'essaierai de le rendre plus agr√©able. <br><br><h2>  O√π obtenir des informations, obtenir des nouvelles sur le cadre? </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Site officiel anglais</a> - liens utiles, documentation √† jour, quelques commentaires des utilisateurs </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Twitter</a> - actualit√©s, liens utiles, articles int√©ressants </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Issue tracker (Github)</a> - bugs, questions, communication avec les cr√©ateurs du framework.  Ils r√©pondent tr√®s intelligemment (ils ont r√©pondu √† ma question avec une question dans quelques heures, aid√© √† la mise en ≈ìuvre de pingloop). </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Probl√®mes r√©solus</a> - je conseille √©galement.  Une grande base de donn√©es de questions d'utilisateurs et de r√©ponses des cr√©ateurs du framework. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tests √©crits par les d√©veloppeurs</a> - presque tous les modules de la documentation ont des tests √©crits en PHP, montrant des cas d'utilisation. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Framework wiki chinois</a> - toutes les informations comme en anglais, mais beaucoup plus de commentaires des utilisateurs (traducteur google pour vous aider). </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Documentation API</a> - une description de certaines classes et fonctions du framework sous une forme assez pratique. <br><br><h3>  R√©sum√© </h3><br>  Il me semble que Swoole s'est d√©velopp√© tr√®s activement l'ann√©e derni√®re, il est sorti de l'√©tape o√π il pouvait √™tre appel√© "brut", et maintenant il est en pleine concurrence avec l'utilisation de node.js / go en termes de programmation asynchrone et de mise en ≈ìuvre de protocoles r√©seau. <br><br>  Je serai heureux d'entendre diff√©rentes opinions sur le sujet et les commentaires de ceux qui ont d√©j√† de l'exp√©rience avec Swoole <br><br>  Vous pouvez discuter dans la salle de chat d√©crite par le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lien</a> <br>  Les sources sont disponibles sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Github</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr427589/">https://habr.com/ru/post/fr427589/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr427579/index.html">Distribution d'applications pour iOS au sein de l'entreprise (Enterprise Distribute iOS App en interne)</a></li>
<li><a href="../fr427581/index.html">Test des points d'acc√®s Zyxel vs Ubiquiti</a></li>
<li><a href="../fr427583/index.html">Nous communiquons avec des journalistes de relations publiques influents: ce sont 10 secrets qui augmenteront les chances de publier votre article</a></li>
<li><a href="../fr427585/index.html">La recette d'un jeu MMO populaire et r√©ussi.</a></li>
<li><a href="../fr427587/index.html">Java concentr√© pour un millier et demi de personnes. Comment √©tait Joker 2018</a></li>
<li><a href="../fr427591/index.html">L'architecture comme fardeau</a></li>
<li><a href="../fr427593/index.html">Quick Command Magic dans Vivaldi 2.1</a></li>
<li><a href="../fr427595/index.html">Essayez Micronaut ou Darling, j'ai r√©duit le cadre</a></li>
<li><a href="../fr427601/index.html">Cas 5 + 1 o√π la sp√©cification de l'API REST joue un r√¥le √©norme</a></li>
<li><a href="../fr427603/index.html">Comment enfin commencer √† √©crire des tests et ne pas le regretter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>