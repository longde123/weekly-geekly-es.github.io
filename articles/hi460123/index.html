<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>тЬТя╕П ЁЯдЬЁЯП╜ ЁЯСЖЁЯП╝ рдЕрднрд┐рдиреЗрддрд╛рдУрдВ рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рдПрдХ рдШреЛрд╖рдгрд╛рддреНрдордХ рдбрд╛рдЯрд╛-рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдкрд╛рдЗрдкрд▓рд╛рдЗрди? рдХреНрдпреЛрдВ рдирд╣реАрдВ? ЁЯЪа ЁЯРШ ЁЯЧия╕П</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдХреБрдЫ рд╕рдордп рдкрд╣рд▓реЗ, SObjectizer рдХреЗ рдПрдХ рд░рд┐рд▓реАрдЬрд╝ рдкрд░ рдЪрд░реНрдЪрд╛ рдореЗрдВ, рд╣рдорд╕реЗ рдкреВрдЫрд╛ рдЧрдпрд╛ рдерд╛: "рдХреНрдпрд╛ рдбреЗрдЯрд╛-рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбреАрдПрд╕рдПрд▓ рдмрдирд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИ?" рджреВрд╕рд░...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдЕрднрд┐рдиреЗрддрд╛рдУрдВ рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рдПрдХ рдШреЛрд╖рдгрд╛рддреНрдордХ рдбрд╛рдЯрд╛-рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдкрд╛рдЗрдкрд▓рд╛рдЗрди? рдХреНрдпреЛрдВ рдирд╣реАрдВ?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460123/"><p>  рдХреБрдЫ рд╕рдордп рдкрд╣рд▓реЗ, SObjectizer рдХреЗ рдПрдХ рд░рд┐рд▓реАрдЬрд╝ рдкрд░ рдЪрд░реНрдЪрд╛ рдореЗрдВ, рд╣рдорд╕реЗ рдкреВрдЫрд╛ рдЧрдпрд╛ рдерд╛: "рдХреНрдпрд╛ рдбреЗрдЯрд╛-рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбреАрдПрд╕рдПрд▓ рдмрдирд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИ?"  рджреВрд╕рд░реЗ рд╢рдмреНрджреЛрдВ рдореЗрдВ, рдХреНрдпрд╛ рдРрд╕рд╛ рдХреБрдЫ рд▓рд┐рдЦрдирд╛ рд╕рдВрднрд╡ рд╣реИ: </p><br><p><code>A | B | C | D</code> </p> <br><p>  рдФрд░ рдПрдХ рдХрд╛рд░реНрдпрд╢реАрд▓ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ рдЬрд╣рд╛рдВ рд╕рдВрджреЗрд╢ рдП рд╕реЗ рдмреА рдФрд░ рдлрд┐рд░ рд╕реА рд╕реЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ рдбреА рдХреЗ рд╕рд╛рде рдирд┐рдпрдВрддреНрд░рдг рд╣реИ рдХрд┐ рдмреА рдХреЛ рдареАрдХ рдЙрд╕реА рдкреНрд░рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдП рд░рд┐рдЯрд░реНрди рджреЗрддрд╛ рд╣реИред  рдФрд░ C рдареАрдХ рдЙрд╕реА рдкреНрд░рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕ рдкреНрд░рдХрд╛рд░ B рд╡рд╛рдкрд╕ рдЖрддрд╛ рд╣реИред  рдФрд░ рдЗрд╕реА рддрд░рд╣ред </p><br><p>  рдпрд╣ рдЖрд╢реНрдЪрд░реНрдпрдЬрдирдХ рд░реВрдк рд╕реЗ рд╕рд░рд▓ рд╕рдорд╛рдзрд╛рди рдХреЗ рд╕рд╛рде рдПрдХ рджрд┐рд▓рдЪрд╕реНрдк рдХрд╛рдо рдерд╛ред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрд╣ рд╣реИ рдХрд┐ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХреИрд╕рд╛ рджрд┐рдЦ рд╕рдХрддрд╛ рд╣реИ: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> pipeline = make_pipeline(env, stage(A) | stage(B) | stage(C) | stage(D));</code> </pre> <br><p>  рдпрд╛, рдПрдХ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рдорд╛рдорд▓реЗ рдореЗрдВ (рдЬреЛ рдиреАрдЪреЗ рдЪрд░реНрдЪрд╛ рдХреА рдЬрд╛рдПрдЧреА): </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> pipeline = make_pipeline( sobj.environment(), stage(validation) | stage(conversion) | broadcast( stage(archiving), stage(distribution), stage(range_checking) | stage(alarm_detector{}) | broadcast( stage(alarm_initiator), stage( []( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> alarm_detected &amp; v ) { alarm_distribution( <span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span>, v ); } ) ) ) );</code> </pre> <br><p>  рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ, рд╣рдо рдРрд╕реЗ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдбреАрдПрд╕рдПрд▓ рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░реЗрдВрдЧреЗред  рд╣рдо <code>stage()</code> рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдЕрдзрд┐рдХрд╛рдВрд╢ рднрд╛рдЧреЛрдВ <code>stage()</code> , <code>broadcast()</code> рдФрд░ <code>operator|()</code> C ++ рдЯреЗрдореНрдкрд▓реЗрдЯреНрд╕ рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рдХрдИ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рд░реНрдп рдХрд░реЗрдВрдЧреЗред  рдЗрд╕рд▓рд┐рдП рдореБрдЭреЗ рдЖрд╢рд╛ рд╣реИ рдХрд┐ рдпрд╣ рдЙрди рдкрд╛рдардХреЛрдВ рдХреЗ рд▓рд┐рдП рднреА рджрд┐рд▓рдЪрд╕реНрдк рд╣реЛрдЧрд╛, рдЬрд┐рдиреНрд╣реЗрдВ SObjectizer рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдирд╣реАрдВ рд╣реИ (рдпрджрд┐ рдЖрдкрдиреЗ рдХрднреА рднреА SObjectizer рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдирд╣реАрдВ рд╕реБрдирд╛ рд╣реИ рддреЛ рдЗрд╕ рдЯреВрд▓ рдХрд╛ рдЕрд╡рд▓реЛрдХрди рдХрд░реЗрдВ)ред </p><a name="habracut"></a><br><h1 id="a-couple-of-words-about-the-used-demo">  рдкреНрд░рдпреБрдХреНрдд рдбреЗрдореЛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╢рдмреНрджреЛрдВ рдХреА рдПрдХ рдЬреЛрдбрд╝реА </h1><br><p>  рд▓реЗрдЦ рдореЗрдВ рдкреНрд░рдпреБрдХреНрдд рдЙрджрд╛рд╣рд░рдг SCADA рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдореЗрд░реЗ рдкреБрд░рд╛рдиреЗ (рдФрд░ рдмрд▓реНрдХрд┐ рднреВрд▓ рдЧрдП) рдЕрдиреБрднрд╡ рд╕реЗ рдкреНрд░рднрд╛рд╡рд┐рдд рд╣реБрдЖ рд╣реИред </p><br><p>  рдбреЗрдореЛ рдХрд╛ рд╡рд┐рдЪрд╛рд░ рдХреБрдЫ рд╕реЗрдВрд╕рд░ рд╕реЗ рдкрдврд╝реЗ рдЧрдП рдбреЗрдЯрд╛ рдХреА рд╣реИрдВрдбрд▓рд┐рдВрдЧ рд╣реИред  рдбреЗрдЯрд╛ рдХреЛ рдХреБрдЫ рдЕрд╡рдзрд┐ рдХреЗ рд╕рд╛рде рдПрдХ рд╕реЗрдВрд╕рд░ рд╕реЗ рдЕрдзрд┐рдЧреНрд░рд╣рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдлрд┐рд░ рдЙрд╕ рдбреЗрдЯрд╛ рдХреЛ рдорд╛рдиреНрдп рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП (рдЧрд▓рдд рдбреЗрдЯрд╛ рдХреЛ рдирдЬрд░рдЕрдВрджрд╛рдЬ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП) рдФрд░ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдореВрд▓реНрдпреЛрдВ рдореЗрдВ рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рд╕реЗрдВрд╕рд░ рд╕реЗ рдкрдврд╝рд╛ рдЧрдпрд╛ рдХрдЪреНрдЪрд╛ рдбреЗрдЯрд╛ рджреЛ 8-рдмрд┐рдЯ рдкреВрд░реНрдгрд╛рдВрдХ рдорд╛рди рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЙрди рдорд╛рдиреЛрдВ рдХреЛ рдПрдХ рдлрд╝реНрд▓реЛрдЯрд┐рдВрдЧ-рдкреЙрдЗрдВрдЯ рдирдВрдмрд░ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </p><br><p>  рдлрд┐рд░ рд╡реИрдз рдФрд░ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдореВрд▓реНрдпреЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдХрд╣реАрдВ рд╡рд┐рддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдЕрд▓рдЧ-рдЕрд▓рдЧ рдиреЛрдбреНрд╕ рдкрд░, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП), "рдЕрд▓рд╛рд░реНрдо" рдХреЗ рд▓рд┐рдП рдЬрд╛рдБрдЪ рдХреА рдЬрд╛рддреА рд╣реИ (рдпрджрд┐ рдорд╛рди рд╕реБрд░рдХреНрд╖рд┐рдд рд╕реАрдорд╛рдУрдВ рд╕реЗ рдмрд╛рд╣рд░ рд╣реИрдВ рддреЛ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП)ред  рдпреЗ рдСрдкрд░реЗрд╢рди рд╕реНрд╡рддрдВрддреНрд░ рд╣реИрдВ рдФрд░ рд╕рдорд╛рдирд╛рдВрддрд░ рдореЗрдВ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдкрддрд╛ рдЪрд▓рд╛ рдЕрд▓рд╛рд░реНрдо рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╕рдВрдЪрд╛рд▓рди рд╕рдорд╛рдирд╛рдВрддрд░ рдореЗрдВ рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: рдПрдХ "рдЕрд▓рд╛рд░реНрдо" рд╢реБрд░реВ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП (рдЗрд╕рд▓рд┐рдП рд╡рд░реНрддрдорд╛рди рдиреЛрдб рдкрд░ SCADA рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдЗрд╕ рдкрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ) рдФрд░ "рдЕрд▓рд╛рд░реНрдо" рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдЕрдиреНрдпрддреНрд░ рд╡рд┐рддрд░рд┐рдд рдХреА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдП (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП) : рдПрдХ рдРрддрд┐рд╣рд╛рд╕рд┐рдХ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдФрд░ / рдпрд╛ SCADA рдСрдкрд░реЗрдЯрд░ рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдкрд░ рдХрд▓реНрдкрдирд╛)ред </p><br><p>  рдЗрд╕ рддрд░реНрдХ рдХреЛ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдкрд╛рда рд░реВрдк рдореЗрдВ рд╡реНрдпрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: </p><br><pre> <code class="plaintext hljs">optional(valid_raw_data) = validate(raw_data); if valid_raw_data is not empty then { converted_value = convert(valid_raw_data); do_async archive(converted_value); do_async distribute(converted_value); do_async { optional(suspicious_value) = check_range(converted_value); if suspicious_value is not empty then { optional(alarm) = detect_alarm(suspicious_value); if alarm is not empty then { do_async initiate_alarm(alarm); do_async distribute_alarm(alam); } } } }</code> </pre> <br><p>  рдпрд╛, рдЪрд┐рддреНрд░рдордп рд░реВрдк рдореЗрдВ: </p><br><p><img src="https://habrastorage.org/webt/5z/nm/vv/5znmvvaqnou_qwh808t8vkbrdc8.jpeg"></p><br><p>  рдпрд╣ рдПрдХ рдХреГрддреНрд░рд┐рдо рдЙрджрд╛рд╣рд░рдг рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕рдореЗрдВ рдХреБрдЫ рджрд┐рд▓рдЪрд╕реНрдк рдЪреАрдЬреЗрдВ рд╣реИрдВ рдЬреЛ рдореИрдВ рджрд┐рдЦрд╛рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдВред  рдкрд╣рд▓рд╛ рдПрдХ рдкрд╛рдЗрдк рд▓рд╛рдЗрди рдореЗрдВ рд╕рдорд╛рдирд╛рдВрддрд░ рдЪрд░рдгреЛрдВ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рд╣реИ (рдСрдкрд░реЗрд╢рди <code>broadcast()</code> рдмрд╕ рдЙрд╕реА рдХреЗ рдХрд╛рд░рдг рдореМрдЬреВрдж рд╣реИ)ред  рджреВрд╕рд░рд╛ рдХреБрдЫ рдЕрд╡рд╕реНрдерд╛рдУрдВ рдореЗрдВ рд░рд╛рдЬреНрдп рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЕрд▓рд╛рд░реНрдо_рдбреЗрдЯреЗрдЯрд░ рд╕реНрдЯреЗрдЯрдлреБрд▓ рд╕реНрдЯреЗрдЬ рд╣реИред </p><br><h1 id="pipeline-capabilities">  рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреА рдХреНрд╖рдорддрд╛ </h1><br><p>  рдПрдХ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЪрд░рдгреЛрдВ рд╕реЗ рдмрдирд╛рдИ рдЧрдИ рд╣реИред  рдкреНрд░рддреНрдпреЗрдХ рдЪрд░рдг рдПрдХ рдХрд╛рд░реНрдп рдпрд╛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреНрд░рд╛рд░реВрдк рдХрд╛ рдПрдХ рдлрд╝рдирдХрд╛рд░ рд╣реИ: </p><br><pre> <code class="cpp hljs">opt&lt;Out&gt; func(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> In &amp;);</code> </pre> <br><p>  рдпрд╛ </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> In &amp;)</span></span></span></span>;</code> </pre> <br><p>  рдЪрд░рдг рдЬреЛ <code>void</code> рд╡рд╛рдкрд╕ рдХрд░рддреЗ рд╣реИрдВ, рдЙрдиреНрд╣реЗрдВ рдХреЗрд╡рд▓ рдПрдХ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЗ рдЕрдВрддрд┐рдо рдЪрд░рдг рдХреЗ рд░реВрдк рдореЗрдВ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p><br><p>  рдЪрд░рдг рдПрдХ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдореЗрдВ рдмрдВрдзреЗ рд╣реЛрддреЗ рд╣реИрдВред  рдкреНрд░рддреНрдпреЗрдХ рдЕрдЧрд▓реЗ рдЪрд░рдг рдореЗрдВ рдкрд┐рдЫрд▓реЗ рдЪрд░рдг рджреНрд╡рд╛рд░рд╛ рд▓реМрдЯрд╛рдпрд╛ рдЧрдпрд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИред  рдпрджрд┐ рдкрд┐рдЫрд▓рд╛ рдЪрд░рдг рдЦрд╛рд▓реА рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ <code>opt&lt;Out&gt;</code> рдорд╛рди рдлрд┐рд░ рдЕрдЧрд▓рд╛ рдЪрд░рдг рдирд╣реАрдВ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  рдПрдХ рд╡рд┐рд╢реЗрд╖ <code>broadcast</code> рдЪрд░рдг рд╣реИред  рдЗрд╕рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрдИ рдкрд╛рдЗрдкрд▓рд╛рдЗрдиреЛрдВ рд╕реЗ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдПрдХ <code>broadcast</code> рдЪрд░рдг рдкрд┐рдЫрд▓реЗ рдЪрд░рдг рд╕реЗ рдПрдХ рд╡рд╕реНрддреБ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рд╕рд╣рд╛рдпрдХ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЛ рдкреНрд░рд╕рд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИред </p><br><p>  рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, <code>broadcast</code> рдЪрд░рдг рдирд┐рдореНрди рдкреНрд░рд╛рд░реВрдк рдХреЗ рдПрдХ рд╕рдорд╛рд░реЛрд╣ рдХреА рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> In &amp;)</span></span></span></span>;</code> </pre> <br><p>  рдХреНрдпреЛрдВрдХрд┐ <code>broadcast</code> рдЪрд░рдг рд╕реЗ рдХреЛрдИ рд╡рд╛рдкрд╕реА рдореВрд▓реНрдп рдирд╣реАрдВ рд╣реИ рдПрдХ <code>broadcast</code> рдЪрд░рдг рдХреЗрд╡рд▓ рдПрдХ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдореЗрдВ рдЕрдВрддрд┐рдо рдЪрд░рдг рд╣реЛ рд╕рдХрддрд╛ рд╣реИред </p><br><h2 id="why-does-the-pipeline-stage-return-an-optional-value">  рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдЪрд░рдг рдПрдХ рд╡реИрдХрд▓реНрдкрд┐рдХ рдорд╛рди рдХреНрдпреЛрдВ рд▓реМрдЯрд╛рддрд╛ рд╣реИ? </h2><br><p>  рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдХреБрдЫ рдЖрд╡рдХ рдореВрд▓реНрдпреЛрдВ рдХреЛ рдЫреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, <code>validate</code> рдЪрд░рдг рдПрдХ рдХрдЪреНрдЪрд╛ рдорд╛рди рдЧрд▓рдд рд╣реЛрдиреЗ рдкрд░ рдХреБрдЫ рднреА рдирд╣реАрдВ рд▓реМрдЯрд╛рддрд╛ рд╣реИ, рдФрд░ рдЗрд╕реЗ рд╕рдВрднрд╛рд▓рдиреЗ рдХрд╛ рдХреЛрдИ рдЕрд░реНрде рдирд╣реАрдВ рд╣реИред </p><br><p>  рдПрдХ рдЕрдиреНрдп рдЙрджрд╛рд╣рд░рдг: <code>alarm_detector</code> рдЪрд░рдг рдХреБрдЫ рднреА рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИ рдпрджрд┐ рд╡рд░реНрддрдорд╛рди рд╕рдВрджрд┐рдЧреНрдз рдорд╛рди рдПрдХ рдирдпрд╛ рдЕрд▓рд╛рд░реНрдо рдХреЗрд╕ рдЙрддреНрдкрдиреНрди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред </p><br><h1 id="implementation-details">  рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХрд╛ рд╡рд┐рд╡рд░рдг </h1><br><h2 id="types-and-functions-related-to-the-application-logic">  рдЖрд╡реЗрджрди рддрд░реНрдХ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдкреНрд░рдХрд╛рд░ рдФрд░ рдХрд╛рд░реНрдп </h2><br><p>  рдЖрдЗрдП рдЖрд╡реЗрджрди рддрд░реНрдХ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдбреЗрдЯрд╛ рдкреНрд░рдХрд╛рд░реЛрдВ рдФрд░ рдХрд╛рд░реНрдпреЛрдВ рд╕реЗ рд╢реБрд░реВ рдХрд░реЗрдВред  рдЪрд░реНрдЪрд╛ рдХрд┐рдП рдЧрдП рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рдирд┐рдореНрди рдбреЗрдЯрд╛ рдкреНрд░рдХрд╛рд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реВрдЪрдирд╛рдУрдВ рдХреЛ рдПрдХ рдЪрд░рдг рд╕реЗ рджреВрд╕рд░реЗ рдЪрд░рдг рдореЗрдВ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Raw data from a sensor. struct raw_measure { int m_meter_id; uint8_t m_high_bits; uint8_t m_low_bits; }; // Type of input for validation stage with raw data from a sensor. struct raw_value { raw_measure m_data; }; // Type of input for conversion stage with valid raw data from a sensor. struct valid_raw_value { raw_measure m_data; }; // Data from a sensor after conversion to Celsius degrees. struct calculated_measure { int m_meter_id; float m_measure; }; // The type for result of conversion stage with converted data from a sensor. struct sensor_value { calculated_measure m_data; }; // Type with value which could mean a dangerous level of temperature. struct suspicious_value { calculated_measure m_data; }; // Type with information about detected dangerous situation. struct alarm_detected { int m_meter_id; };</span></span></code> </pre> <br><p>  рд╣рдорд╛рд░реЗ рдкрд╛рдЗрдк рд▓рд╛рдЗрди рдХреЗ рдкрд╣рд▓реЗ рдЪрд░рдг рдореЗрдВ <code>raw_value</code> рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдмрди рд░рд╣рд╛ рд╣реИред  рдЗрд╕ <code>raw_value</code> рдореЗрдВ <code>raw_measure</code> рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рд╕реЗрдВрд╕рд░ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдЬрд╛рдирдХрд╛рд░реА рд╢рд╛рдорд┐рд▓ рд╣реИред  рдлрд┐рд░ <code>raw_value</code> рдореЗрдВ рдмрджрд▓ <code>valid_raw_value</code> ред  рддрдм <code>valid_raw_value</code> , <code>calulated_measure</code> рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕реЗрдВрд╕рд░ рдХреЗ рдореВрд▓реНрдп рдХреЗ рд╕рд╛рде <code>valid_raw_value</code> рдмрджрд▓ рдЧрдпрд╛ред  рдпрджрд┐ <code>sensor_value</code> рдХреЗ <code>sensor_value</code> рдореЗрдВ рдПрдХ рд╕рдВрджрд┐рдЧреНрдз рдорд╛рди рд╣реИ, рддреЛ <code>suspicious_value</code> рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИред  рдФрд░ рдЙрд╕ <code>suspicious_value</code> <code>alarm_detected</code> рдмрд╛рдж рдореЗрдВ <code>alarm_detected</code> рдЙрджрд╛рд╣рд░рдг рдореЗрдВ <code>alarm_detected</code> рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p><br><p>  рдпрд╛, рдЪрд┐рддреНрд░рдордп рд░реВрдк рдореЗрдВ: </p><br><p><img src="https://habrastorage.org/webt/dp/dx/rz/dpdxrzpp-rvo05zk-8rwdwucszo.jpeg"></p><br><p>  рдЕрдм рд╣рдо рдЕрдкрдиреЗ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдЪрд░рдгреЛрдВ рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// // The first stage of a pipeline. Validation of raw data from a sensor. // // Returns valid_raw_value or nothing if value is invalid. // stage_result_t&lt; valid_raw_value &gt; validation( const raw_value &amp; v ) { if( 0x7 &gt;= v.m_data.m_high_bits ) return make_result&lt; valid_raw_value &gt;( v.m_data ); else return make_empty&lt; valid_raw_value &gt;(); } // // The second stage of a pipeline. Conversion from raw data to a value // in Celsius degrees. // stage_result_t&lt; sensor_value &gt; conversion( const valid_raw_value &amp; v ) { return make_result&lt; sensor_value &gt;( calculated_measure{ v.m_data.m_meter_id, 0.5f * ((static_cast&lt; uint16_t &gt;( v.m_data.m_high_bits ) &lt;&lt; 8) + v.m_data.m_low_bits) } ); } // // Simulation of the data archiving. // void archiving( const sensor_value &amp; v ) { clog &lt;&lt; "archiving (" &lt;&lt; v.m_data.m_meter_id &lt;&lt; "," &lt;&lt; v.m_data.m_measure &lt;&lt; ")" &lt;&lt; endl; } // // Simulation of the data distribution. // void distribution( const sensor_value &amp; v ) { clog &lt;&lt; "distributing (" &lt;&lt; v.m_data.m_meter_id &lt;&lt; "," &lt;&lt; v.m_data.m_measure &lt;&lt; ")" &lt;&lt; endl; } // // The first stage of a child pipeline at third level of the main pipeline. // // Checking for to high value of the temperature. // // Returns suspicious_value message or nothing. // stage_result_t&lt; suspicious_value &gt; range_checking( const sensor_value &amp; v ) { if( v.m_data.m_measure &gt;= 45.0f ) return make_result&lt; suspicious_value &gt;( v.m_data ); else return make_empty&lt; suspicious_value &gt;(); } // // The next stage of a child pipeline. // // Checks for two suspicious_value-es in 25ms time window. // class alarm_detector { using clock = chrono::steady_clock; public : stage_result_t&lt; alarm_detected &gt; operator()( const suspicious_value &amp; v ) { if( m_previous ) if( *m_previous + chrono::milliseconds(25) &gt; clock::now() ) { m_previous = nullopt; return make_result&lt; alarm_detected &gt;( v.m_data.m_meter_id ); } m_previous = clock::now(); return make_empty&lt; alarm_detected &gt;(); } private : optional&lt; clock::time_point &gt; m_previous; }; // // One of last stages of a child pipeline. // Imitates beginning of the alarm processing. // void alarm_initiator( const alarm_detected &amp; v ) { clog &lt;&lt; "=== alarm (" &lt;&lt; v.m_meter_id &lt;&lt; ") ===" &lt;&lt; endl; } // // Another of last stages of a child pipeline. // Imitates distribution of the alarm. // void alarm_distribution( ostream &amp; to, const alarm_detected &amp; v ) { to &lt;&lt; "alarm_distribution (" &lt;&lt; v.m_meter_id &lt;&lt; ")" &lt;&lt; endl; }</span></span></code> </pre> <br><p>  рдмрд╕ <code>stage_result_t</code> , <code>make_result</code> рдФрд░ <code>make_empty</code> рдЬреИрд╕реЗ рд╕рд╛рдорд╛рди рдЫреЛрдбрд╝реЗрдВ, рд╣рдо рдЕрдЧрд▓реЗ рднрд╛рдЧ рдореЗрдВ рдЗрд╕рдХреА рдЪрд░реНрдЪрд╛ рдХрд░реЗрдВрдЧреЗред </p><br><p>  рдореБрдЭреЗ рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ рдЙрди рдЪрд░рдгреЛрдВ рдХреЗ рдХреЛрдб рдмрд▓реНрдХрд┐ рддреБрдЪреНрдЫред  рдПрдХрдорд╛рддреНрд░ рднрд╛рдЧ рдЬрд┐рд╕реЗ рдХреБрдЫ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рд╡рд╣ рд╣реИ <code>alarm_detector</code> рдЪрд░рдг рдХрд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрдиред </p><br><p>  рдЙрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рдПрдХ рдЕрд▓рд╛рд░реНрдо рдХреЗрд╡рд▓ рддрднреА рд╢реБрд░реВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрдм 25ms рдЯрд╛рдЗрдо рд╡рд┐рдВрдбреЛ рдореЗрдВ рдХрдо рд╕реЗ рдХрдо рджреЛ рд╕рдВрджрд┐рдЧреНрдз_рд╡рд╛рдпреБ рд╣реЛрдВред  рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ <code>alarm_detector</code> рд╕реНрдЯреЗрдЬ рдкрд░ рдкрд┐рдЫрд▓реЗ <code>alarm_detector</code> рдЙрджрд╛рд╣рд░рдг рдХрд╛ рд╕рдордп рдпрд╛рдж рд░рдЦрдирд╛ рд╣реЛрдЧрд╛ред  рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ <code>alarm_detector</code> рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЙрд▓ рдСрдкрд░реЗрдЯрд░ рдХреЗ рд╕рд╛рде рдПрдХ рд╕реНрдЯреЗрдЯрдлреБрд▓ <code>alarm_detector</code> рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><h2 id="stages-return-sobjectizers-type-instead-of-stdoptional">  рдЪрд░рдг :: std рдХреЗ рдмрдЬрд╛рдп SObjectizer рдХрд╛ рдкреНрд░рдХрд╛рд░ рд▓реМрдЯрд╛рддреЗ рд╣реИрдВ :: рд╡реИрдХрд▓реНрдкрд┐рдХ </h2><br><p>  рдореИрдВрдиреЗ рдкрд╣рд▓реЗ рдХрд╣рд╛ рдерд╛ рдХрд┐ рдордВрдЪ рд╡реИрдХрд▓реНрдкрд┐рдХ рдореВрд▓реНрдп рд▓реМрдЯрд╛ рд╕рдХрддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди <code>std::optional</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреЛрдб рдореЗрдВ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреЗ <code>stage_result_t</code> рдХреЛ рдЪрд░рдгреЛрдВ рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдореЗрдВ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p><br><p>  рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдПрд╕рдУрдмреАрдЬреЗрд▓рд╛рдЗрдЬрд╝рд░ рдХреЗ рдХреБрдЫ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдпрд╣рд╛рдВ рдЕрдкрдиреА рднреВрдорд┐рдХрд╛ рдирд┐рднрд╛рддреЗ рд╣реИрдВред  рд▓реМрдЯрд╛рдП рдЧрдП рдорд╛рдиреЛрдВ рдХреЛ SObjectizer рдХреЗ рдПрдЬреЗрдВрдЯреЛрдВ (рдЙрд░реНрдл рдЕрднрд┐рдиреЗрддрд╛рдУрдВ) рдХреЗ рдмреАрдЪ рд╕рдВрджреЗрд╢реЛрдВ рдХреЗ рд░реВрдк рдореЗрдВ рд╡рд┐рддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  SObjectizer рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рд╕рдВрджреЗрд╢ рдХреЛ рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рдЖрд╡рдВрдЯрд┐рдд рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП рд╣рдорд╛рд░реЗ рдпрд╣рд╛рдВ рдХреБрдЫ "рдЕрдиреБрдХреВрд▓рди" рд╣реИрдВ: <code>std::optional</code> рдХреА рд╡рд╛рдкрд╕реА рдХреЗ рдмрдЬрд╛рдп <code>std::optional</code> рдФрд░ рдлрд┐рд░ рдПрдХ рдирдпрд╛ рд╕рдВрджреЗрд╢ рдСрдмреНрдЬреЗрдХреНрдЯ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдирд╛, рд╣рдо рдмрд╕ рдПрдХ рд╕рдВрджреЗрд╢ рдСрдмреНрдЬреЗрдХреНрдЯ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдПрдХ рд╕реНрдорд╛рд░реНрдЯ рдкреЙрдЗрдВрдЯрд░ рд▓реМрдЯрд╛рддреЗ рд╣реИрдВред </p><br><p>  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, <code>stage_result_t</code> , рдПрд╕рдУрдмреАрдЬреЗрд▓рд╛рдЗрдЬрд╝рд░ рдХреЗ рд╕рд╛рдЭрд╛ рдХрд┐рдП рдЧрдП рдПрдирд╛рд▓реЙрдЧ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рдПрдХ <code>stage_result_t</code> рд╣реИ: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> M &gt; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">stage_result_t</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">message_holder_t</span></span>&lt; M &gt;;</code> </pre> <br><p>  рдФрд░ <code>make_result</code> рдФрд░ <code>make_empty</code> <code>stage_result_t</code> рд╕рд╛рде рдпрд╛ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдореВрд▓реНрдп рдХреЗ рдмрд┐рдирд╛ рдирд┐рд░реНрдорд╛рдг рдХреЗ рд▓рд┐рдП рд╕рд┐рд░реНрдл рд╕рд╣рд╛рдпрдХ рдХрд╛рд░реНрдп рд╣реИрдВ: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> M, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span>... Args &gt; <span class="hljs-keyword"><span class="hljs-keyword">stage_result_t</span></span>&lt; M &gt; make_result( Args &amp;&amp;... args ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">stage_result_t</span></span>&lt; M &gt;::make(forward&lt; Args &gt;(args)...); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> M &gt; <span class="hljs-keyword"><span class="hljs-keyword">stage_result_t</span></span>&lt; M &gt; make_empty() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">stage_result_t</span></span>&lt; M &gt;(); }</code> </pre> <br><p>  рд╕рд╛рджрдЧреА рдХреЗ рд▓рд┐рдП рдпрд╣ рдХрд╣рдирд╛ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИ рдХрд┐ <code>validation</code> рдЪрд░рдг рдЗрд╕ рддрд░рд╣ рд╡реНрдпрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: </p><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt; valid_raw_value &gt; validation( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> raw_value &amp; v ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-number"><span class="hljs-number">0x7</span></span> &gt;= v.m_data.m_high_bits ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::make_shared&lt; valid_raw_value &gt;( v.m_data ); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt; valid_raw_value &gt;{}; }</code> </pre> <br><p>  рд▓реЗрдХрд┐рди, SObjectizer рдХреЗ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╣реЛрдиреЗ рдХреЗ рдХрд╛рд░рдг, рд╣рдо <code>std::shared_ptr</code> share_ptr рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ <code>so_5::message_holder_t</code> рдкреНрд░рдХрд╛рд░ рд╕реЗ <code>so_5::message_holder_t</code> ред  рдФрд░ рд╣рдо рдЙрд╕ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХреЛ <code>stage_result_t</code> рдкреАрдЫреЗ <code>stage_result_t</code> , <code>make_result</code> рдФрд░ <code>make_empty</code> ред </p><br><h2 id="stage_handler_t-and-stage_builder_t-separation">  stage_handler_t рдФрд░ stage_builder_t рдЬреБрджрд╛рдИ </h2><br><p>  рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХрд╛ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд┐рдВрджреБ <em>рд╕реНрдЯреЗрдЬ рд╣реИрдВрдбрд▓рд░</em> рдФрд░ <em>рд╕реНрдЯреЗрдЬ рдмрд┐рд▓реНрдбрд░</em> рдЕрд╡рдзрд╛рд░рдгрд╛рдУрдВ рдХрд╛ рдкреГрдердХреНрдХрд░рдг рд╣реИред  рдпрд╣ рд╕рд░рд▓рддрд╛ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрди рдЕрд╡рдзрд╛рд░рдгрд╛рдУрдВ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдиреЗ рдореБрдЭреЗ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреА рдкрд░рд┐рднрд╛рд╖рд╛ рдореЗрдВ рджреЛ рдХрджрдо рд░рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреАред </p><br><p>  рдкрд╣рд▓реЗ рдЪрд░рдг рдореЗрдВ, рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдЪрд░рдгреЛрдВ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рддрд╛ рд╣реИред  рдирддреАрдЬрддрди, рдореБрдЭреЗ <code>stage_t</code> рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдорд┐рд▓рддрд╛ рд╣реИ рдЬреЛ рд╕рднреА рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдЪрд░рдгреЛрдВ рдХреЛ рдЕрдВрджрд░ рд░рдЦрддрд╛ рд╣реИред </p><br><p>  рджреВрд╕рд░реЗ рдЪрд░рдг рдореЗрдВ, рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд SObjectizer рдХреЗ рдПрдЬреЗрдВрдЯреЛрдВ рдХрд╛ рдПрдХ рд╕реЗрдЯ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред  рд╡реЗ рдПрдЬреЗрдВрдЯ рдкрд┐рдЫрд▓реЗ рдЪрд░рдгреЛрдВ рдХреЗ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЗ рд╕рд╛рде рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рд╡рд╛рд╕реНрддрд╡рд┐рдХ <em>рдЪрд░рдг рд╕рдВрдЪрд╛рд▓рдХреЛрдВ рдХреЛ</em> рдХреЙрд▓ рдХрд░рддреЗ рд╣реИрдВ, рдлрд┐рд░ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЛ рдЕрдЧрд▓реЗ рдЪрд░рдгреЛрдВ рдореЗрдВ рднреЗрдЬрддреЗ рд╣реИрдВред </p><br><p>  рд▓реЗрдХрд┐рди рдПрдЬреЗрдВрдЯреЛрдВ рдХреЗ рдЗрд╕ рд╕реЗрдЯ рдХреЛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рд░ рдЪрд░рдг рдореЗрдВ рдПрдХ <em>рд╕реНрдЯреЗрдЬ рдмрд┐рд▓реНрдбрд░ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП</em> ред  <em>рд╕реНрдЯреЗрдЬ рдмрд┐рд▓реНрдбрд░</em> рдХреЛ рдПрдХ рдХрд╛рд░рдЦрд╛рдиреЗ рдХреЗ рд░реВрдк рдореЗрдВ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдПрдХ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд SObjectizer рдПрдЬреЗрдВрдЯ рдмрдирд╛рддрд╛ рд╣реИред </p><br><p>  рдЗрд╕рд▓рд┐рдП рд╣рдорд╛рд░рд╛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рдВрдмрдВрдз рд╣реИ: рдкреНрд░рддреНрдпреЗрдХ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдЪрд░рдг рджреЛ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рддрд╛ рд╣реИ: <em>рд╕реНрдЯреЗрдЬ рд╣реИрдВрдбрд▓рд░</em> рдЬреЛ рд╕реНрдЯреЗрдЬ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рддрд░реНрдХ рд░рдЦрддрд╛ рд╣реИ, рдФрд░ <em>рд╕реНрдЯреЗрдЬ рдмрд┐рд▓реНрдбрд░</em> рдЬреЛ рдЙрдЪрд┐рдд рд╕рдордп рдкрд░ <em>рд╕реНрдЯреЗрдЬ рд╣реИрдВрдбрд▓рд░</em> рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд SObjectizer рдХрд╛ рдПрдЬреЗрдВрдЯ рдмрдирд╛рддрд╛ рд╣реИ: </p><br><p><img src="https://habrastorage.org/webt/gl/tp/nn/gltpnnqhjqslsscxvellndh6n0u.jpeg"></p><br><p>  <em>рд╕реНрдЯреЗрдЬ рд╣реИрдВрдбрд▓рд░</em> рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрд░реАрдХреЗ рд╕реЗ рджрд░реНрд╢рд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> In, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Out &gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">stage_handler_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> traits = <span class="hljs-keyword"><span class="hljs-keyword">handler_traits_t</span></span>&lt; In, Out &gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> func_type = function&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> traits::output(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> traits::input &amp;) &gt;; <span class="hljs-keyword"><span class="hljs-keyword">stage_handler_t</span></span>( func_type handler ) : m_handler( move(handler) ) {} <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Callable &gt; <span class="hljs-keyword"><span class="hljs-keyword">stage_handler_t</span></span>( Callable handler ) : m_handler( handler ) {} <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> traits::<span class="hljs-function"><span class="hljs-function">output </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">typename</span></span></span></span><span class="hljs-function"><span class="hljs-params"> traits::input &amp; a )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_handler( a ); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> : func_type m_handler; };</code> </pre> <br><p>  рдЬрд╣рд╛рдБ <code>handler_traits_t</code> рдХреЛ рдирд┐рдореНрди рддрд░реАрдХреЗ рд╕реЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ: </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// // We have to deal with two types of stage handlers: // - intermediate handlers which will return some result (eg some new // message); // - terminal handlers which can return nothing (eg void instead of // stage_result_t&lt;M&gt;); // // This template with specialization defines `input` and `output` // aliases for both cases. // template&lt; typename In, typename Out &gt; struct handler_traits_t { using input = In; using output = stage_result_t&lt; Out &gt;; }; template&lt; typename In &gt; struct handler_traits_t&lt; In, void &gt; { using input = In; using output = void; };</span></span></code> </pre> <br><p>  <em>рд╕реНрдЯреЗрдЬ рдмрд┐рд▓реНрдбрд░</em> рдХреЛ рд╕рд┐рд░реНрдл <code>std::function</code> рджреНрд╡рд╛рд░рд╛ рджрд░реНрд╢рд╛рдпрд╛ рдЬрд╛рддрд╛ <code>std::function</code> : </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">stage_builder_t</span></span> = function&lt; <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">coop_t</span></span> &amp;, <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span>) &gt;;</code> </pre> <br><h2 id="helper-types-lambda_traits_t-and-callable_traits_t">  рд╕рд╣рд╛рдпрдХ рдкреНрд░рдХрд╛рд░ lambda_traits_t рдФрд░ callable_traits_t </h2><br><p>  рдХреНрдпреЛрдВрдХрд┐ рдЪрд░рдгреЛрдВ рдХреЛ рдирд┐: рд╢реБрд▓реНрдХ рдлрд╝рдВрдХреНрд╢рди рдпрд╛ <code>alarm_detector</code> рджреНрд╡рд╛рд░рд╛ рджрд░реНрд╢рд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рдЬреИрд╕реЗ рдХрд┐ <code>alarm_detector</code> рдХреНрд▓рд╛рд╕ рдХреЗ рдЙрджрд╛рд╣рд░рдг рдпрд╛ рдЕрдирд╛рдо рдХрдВрдкрд╛рдЗрд▓рд░-рдЬрдирд░реЗрдЯ рдХрд┐рдП рдЧрдП рд╡рд░реНрдЧ рдЬреЛ рд▓реИрдореНрдмреНрдбрд╛ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддреЗ рд╣реИрдВ), рд╣рдореЗрдВ рдЪрд░рдг рдХреЗ рддрд░реНрдХ рдФрд░ рд░рд┐рдЯрд░реНрди рд╡реИрд▓реНрдпреВ рдХреЗ рдкреНрд░рдХрд╛рд░реЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рд╕рд╣рд╛рдпрдХреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдореИрдВрдиреЗ рдЙрд╕ рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛: </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// // Helper type for `arg_type` and `result_type` alises definition. // template&lt; typename R, typename A &gt; struct callable_traits_typedefs_t { using arg_type = A; using result_type = R; }; // // Helper type for dealing with stateful objects with operator() // (they could be user-defined objects or generated by compiler // like lambdas). // template&lt; typename T &gt; struct lambda_traits_t; template&lt; typename M, typename A, typename T &gt; struct lambda_traits_t&lt; stage_result_t&lt; M &gt;(T::*)(const A &amp;) const &gt; : public callable_traits_typedefs_t&lt; M, A &gt; {}; template&lt; typename A, typename T &gt; struct lambda_traits_t&lt; void (T::*)(const A &amp;) const &gt; : public callable_traits_typedefs_t&lt; void, A &gt; {}; template&lt; typename M, typename A, typename T &gt; struct lambda_traits_t&lt; stage_result_t&lt; M &gt;(T::*)(const A &amp;) &gt; : public callable_traits_typedefs_t&lt; M, A &gt; {}; template&lt; typename A, typename T &gt; struct lambda_traits_t&lt; void (T::*)(const A &amp;) &gt; : public callable_traits_typedefs_t&lt; void, A &gt; {}; // // Main type for definition of `arg_type` and `result_type` aliases. // With specialization for various cases. // template&lt; typename T &gt; struct callable_traits_t : public lambda_traits_t&lt; decltype(&amp;T::operator()) &gt; {}; template&lt; typename M, typename A &gt; struct callable_traits_t&lt; stage_result_t&lt; M &gt;(*)(const A &amp;) &gt; : public callable_traits_typedefs_t&lt; M, A &gt; {}; template&lt; typename A &gt; struct callable_traits_t&lt; void(*)(const A &amp;) &gt; : public callable_traits_typedefs_t&lt; void, A &gt; {};</span></span></code> </pre> <br><p>  рдореБрдЭреЗ рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ рдпрд╣ рдХреЛрдб C ++ рдХреЗ рдЕрдЪреНрдЫреЗ рдЬреНрдЮрд╛рди рд╡рд╛рд▓реЗ рдкрд╛рдардХреЛрдВ рдХреЗ рд▓рд┐рдП рдХрд╛рдлреА рд╕рдордЭ рдореЗрдВ рдЖрдПрдЧрд╛ред  рдпрджрд┐ рдирд╣реАрдВ, рддреЛ рдмреЗрдЭрд┐рдЭрдХ рдореБрдЭреЗ рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдореЗрдВ рдкреВрдЫреЗрдВ, рдореБрдЭреЗ рд╡рд┐рд╡рд░рдг рдореЗрдВ <code>lambda_traits_t</code> рдФрд░ <code>callable_traits_t</code> рдкреАрдЫреЗ рдХреЗ рддрд░реНрдХ рдХреА рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд░рдиреЗ рдореЗрдВ рдЦреБрд╢реА рд╣реЛрдЧреАред </p><br><h2 id="stage-broadcast-and-operator-functions">  рдЪрд░рдг (), рдкреНрд░рд╕рд╛рд░рдг () рдФрд░ рдСрдкрд░реЗрдЯрд░ | () рдлрд╝рдВрдХреНрд╢рди </h2><br><p>  рдЕрдм рд╣рдо рдореБрдЦреНрдп рдкрд╛рдЗрдкрд▓рд╛рдЗрди-рдирд┐рд░реНрдорд╛рдг рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рдЕрдВрджрд░ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ, рдПрдХ рдЦрд╛рдХрд╛ рд╡рд░реНрдЧ рдХреЗ рд╕реНрддрд░ рдХреА рдкрд░рд┐рднрд╛рд╖рд╛ рдкрд░ рдПрдХ рдирдЬрд╝рд░ <code>stage_t</code> : </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> In, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Out &gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">stage_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">stage_builder_t</span></span> m_builder; };</code> </pre> <br><p>  рдпрд╣ рдПрдХ рдмрд╣реБрдд рд╣реА рд╕рд░рд▓ рд╕рдВрд░рдЪрдирд╛ рд╣реИ, рдЬреЛ рдХрд┐ рдХреЗрд╡рд▓ <code>stage_bulder_t</code> рдЙрджрд╛рд╣рд░рдг рдкреНрд░рд╕реНрддреБрдд рдХрд░рддреА рд╣реИред  рдЯреЗрдореНрдкрд▓реЗрдЯ рдкреИрд░рд╛рдореАрдЯрд░ <code>stage_t</code> рдЕрдВрджрд░ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдП <code>stage_t</code> , рдЗрд╕рд▓рд┐рдП рд╡реЗ рдпрд╣рд╛рдВ рдХреНрдпреЛрдВ рдореМрдЬреВрдж рд╣реИрдВ? </p><br><p>  рд╡реЗ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдЪрд░рдгреЛрдВ рдХреЗ рдмреАрдЪ рд╕рдВрдЧрддрддрд╛ рдХреЗ рд╕рдВрдХрд▓рди-рд╕рдордп рдХреА рдЬрд╛рдБрдЪ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИрдВред  рд╣рдо рдЬрд▓реНрдж рд╣реА рджреЗрдЦреЗрдВрдЧреЗред </p><br><p>  рдЖрдЗрдП рд╕рд░рд▓рддрдо рдкрд╛рдЗрдкрд▓рд╛рдЗрди-рдирд┐рд░реНрдорд╛рдг рдХрд╛рд░реНрдп рдХреЛ рджреЗрдЦреЗрдВ, <code>stage()</code> : </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Callable, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> In = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> <span class="hljs-keyword"><span class="hljs-keyword">callable_traits_t</span></span>&lt; Callable &gt;::arg_type, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Out = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> <span class="hljs-keyword"><span class="hljs-keyword">callable_traits_t</span></span>&lt; Callable &gt;::result_type &gt; <span class="hljs-keyword"><span class="hljs-keyword">stage_t</span></span>&lt; In, Out &gt; stage( Callable handler ) { <span class="hljs-keyword"><span class="hljs-keyword">stage_builder_t</span></span> builder{ [h = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(handler)]( <span class="hljs-keyword"><span class="hljs-keyword">coop_t</span></span> &amp; coop, <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> next_stage) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> coop.make_agent&lt; <span class="hljs-keyword"><span class="hljs-keyword">a_stage_point_t</span></span>&lt;In, Out&gt; &gt;( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(h), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(next_stage) ) -&gt;so_direct_mbox(); } }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(builder) }; }</code> </pre> <br><p>  рдпрд╣ рдПрдХ рдПрдХрд▓ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рд╡рд╛рд╕реНрддрд╡рд┐рдХ <em>рдЪрд░рдг рд╣реИрдВрдбрд▓рд░</em> рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИред  рдпрд╣ рдПрдХ рдлрдВрдХреНрд╢рди рдпрд╛ рд▓реИрдореНрдмреНрдбрд╛-рдлрдВрдХреНрд╢рди рдпрд╛ рдлрдиреНрдХреНрдЯрд░ рдХрд╛ рдкреЙрдЗрдВрдЯрд░ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  <code>callable_traits_t</code> рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреЗ рдкреАрдЫреЗ "рдЯреЗрдореНрдкрд▓реЗрдЯ рдореИрдЬрд┐рдХ" рдХреЗ рдХрд╛рд░рдг рдЪрд░рдг рдХреЗ рдЗрдирдкреБрдЯ рдФрд░ рдЖрдЙрдЯрдкреБрдЯ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдХрдЯ рдЬрд╛рддреЗ рд╣реИрдВред </p><br><p>  <em>рд╕реНрдЯреЗрдЬ рдмрд┐рд▓реНрдбрд░</em> рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдЕрдВрджрд░ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдЙрд╕ <code>stage()</code> рдХреЗ рдкрд░рд┐рдгрд╛рдо рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рдирдпрд╛ <code>stage_t</code> рдСрдмреНрдЬреЗрдХреНрдЯ рдореЗрдВ рд╡рд╛рдкрд╕ рдЖ рдЧрдпрд╛ рд╣реИред  рдПрдХ рд╡рд╛рд╕реНрддрд╡рд┐рдХ <em>рд╕реНрдЯреЗрдЬ рд╣реИрдВрдбрд▓рд░</em> рдХреЛ <em>рд╕реНрдЯреЗрдЬ рдмрд┐рд▓реНрдбрд░</em> рд▓реИрдореНрдмреНрдбрд╛ рджреНрд╡рд╛рд░рд╛ рдХреИрдкреНрдЪрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рддрдм рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд SObjectizer рдХреЗ рдПрдЬреЗрдВрдЯ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ (рд╣рдо рдЕрдЧрд▓реЗ рднрд╛рдЧ рдореЗрдВ рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмреЛрд▓реЗрдВрдЧреЗ)ред </p><br><p>  рд╕рдореАрдХреНрд╖рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдЧрд▓рд╛ рдХрд╛рд░реНрдп <code>operator|()</code> рдЬреЛ рджреЛ рдЪрд░рдгреЛрдВ рдХреЛ рдПрдХ рд╕рд╛рде рдЬреЛрдбрд╝рддрд╛ рд╣реИ рдФрд░ рдПрдХ рдирдпрд╛ рдЪрд░рдг рд▓реМрдЯрд╛рддрд╛ рд╣реИ: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> In, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Out1, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Out2 &gt; <span class="hljs-keyword"><span class="hljs-keyword">stage_t</span></span>&lt; In, Out2 &gt; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>|( <span class="hljs-keyword"><span class="hljs-keyword">stage_t</span></span>&lt; In, Out1 &gt; &amp;&amp; prev, <span class="hljs-keyword"><span class="hljs-keyword">stage_t</span></span>&lt; Out1, Out2 &gt; &amp;&amp; next ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">stage_builder_t</span></span>{ [prev, next]( <span class="hljs-keyword"><span class="hljs-keyword">coop_t</span></span> &amp; coop, <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> next_stage ) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> m = next.m_builder( coop, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(next_stage) ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prev.m_builder( coop, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(m) ); } } }; }</code> </pre> <br><p>  <code>operator|()</code> рдХрд╛ рддрд░реНрдХ рд╕рдордЭрд╛рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рд╕рд░рд▓ рддрд░реАрдХрд╛ <code>operator|()</code> рдПрдХ рдЪрд┐рддреНрд░ рдмрдирд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рдирд╛ рд╣реИред  рдорд╛рди рд▓реЗрддреЗ рд╣реИрдВ рдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рд╣реИ: </p><br><pre> <code class="cpp hljs">stage(A) | stage(B) | stage(C) | stage(B)</code> </pre> <br><p>  рдпрд╣ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдмрджрд▓ рдЬрд╛рдПрдЧреА: </p><br><p><img src="https://habrastorage.org/webt/jo/rr/aq/jorraqaawl6y7ju3om7zfq3java.jpeg"></p><br><p>  рд╡рд╣рд╛рдВ рд╣рдо рдпрд╣ рднреА рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХрдВрдкрд╛рдЗрд▓-рдЯрд╛рдЗрдо рдЯрд╛рдЗрдк-рдЪреЗрдХрд┐рдВрдЧ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░ рд░рд╣реА рд╣реИ: <code>operator|()</code> рдХреА рдкрд░рд┐рднрд╛рд╖рд╛ <code>operator|()</code> рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдкрд╣рд▓реЗ рдЪрд░рдг рдХрд╛ рдЖрдЙрдЯрдкреБрдЯ рдкреНрд░рдХрд╛рд░ рджреВрд╕рд░реЗ рдЪрд░рдг рдХрд╛ рдЗрдирдкреБрдЯ рд╣реИред  рдпрджрд┐ рдРрд╕рд╛ рдирд╣реАрдВ рд╣реИ рддреЛ рдХреЛрдб рд╕рдВрдХрд▓рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </p><br><p>  рдФрд░ рдЕрдм рд╣рдо рд╕рдмрд╕реЗ рдЬрдЯрд┐рд▓ рдкрд╛рдЗрдкрд▓рд╛рдЗрди-рдмрд┐рд▓реНрдбрд┐рдВрдЧ рдлрд╝рдВрдХреНрд╢рди, <code>broadcast()</code> рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВред  рд╕рдорд╛рд░реЛрд╣ рд╣реА рд╕рд░рд▓ рд╣реИ: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> In, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Out, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span>... Rest &gt; <span class="hljs-keyword"><span class="hljs-keyword">stage_t</span></span>&lt; In, <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> &gt; broadcast( <span class="hljs-keyword"><span class="hljs-keyword">stage_t</span></span>&lt; In, Out &gt; &amp;&amp; first, Rest &amp;&amp;... stages ) { <span class="hljs-keyword"><span class="hljs-keyword">stage_builder_t</span></span> builder{ [broadcasts = collect_sink_builders( move(first), forward&lt; Rest &gt;(stages)...)] ( <span class="hljs-keyword"><span class="hljs-keyword">coop_t</span></span> &amp; coop, <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> ) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> &gt; mboxes; mboxes.reserve( broadcasts.size() ); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> &amp; b : broadcasts ) mboxes.emplace_back( b( coop, <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span>{} ) ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">broadcast_mbox_t</span></span>::make( coop.environment(), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(mboxes) ); } }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(builder) }; }</code> </pre> <br><p>  рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдЪрд░рдг рдФрд░ рдкреНрд░рд╕рд╛рд░рдг-рдордВрдЪ рдХреЗ рдмреАрдЪ рдореБрдЦреНрдп рдЕрдВрддрд░ рдпрд╣ рд╣реИ рдХрд┐ рдкреНрд░рд╕рд╛рд░рдг-рдЪрд░рдг рдореЗрдВ рд╕рд╣рд╛рдпрдХ <em>рдЪрд░рдг рдмрд┐рд▓реНрдбрд░реЛрдВ</em> рдХрд╛ рд╡реЗрдХреНрдЯрд░ рдкрдХрдбрд╝рдирд╛ рд╣реЛрддрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдЙрд╕ рд╡реЗрдХреНрдЯрд░ рдХреЛ рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдЗрд╕реЗ рдмреНрд░реЙрдбрдХрд╛рд╕реНрдЯ-рд╕реНрдЯреЗрдЬ рдХреЗ рдореБрдЦреНрдп <em>рд╕реНрдЯреЗрдЬ рдмрд┐рд▓реНрдбрд░</em> рдореЗрдВ рдбрд╛рд▓рдирд╛ рд╣реЛрдЧрд╛ред  рдЙрд╕рдХреА рд╡рдЬрд╣ рд╕реЗ, рд╣рдо <code>broadcast()</code> рдЕрдВрджрд░ рдПрдХ <code>collect_sink_builders</code> рдХреА рдХреИрдкреНрдЪрд░ рд╕реВрдЪреА рдореЗрдВ <code>collect_sink_builders</code> рдХреЙрд▓ рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">stage_builder_t</span></span> builder{ [broadcasts = collect_sink_builders( move(first), forward&lt; Rest &gt;(stages)...)]</code> </pre> <br><p>  рдпрджрд┐ рд╣рдо <code>collect_sink_builder</code> рдореЗрдВ рджреЗрдЦрддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рджреЗрдЦреЗрдВрдЧреЗ: </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// // Serie of helper functions for building description for // `broadcast` stage. // // Those functions are used for collecting // `builders` functions for every child pipeline. // // Please note that this functions checks that each child pipeline has the // same In type. // template&lt; typename In, typename Out, typename... Rest &gt; void move_sink_builder_to( vector&lt; stage_builder_t &gt; &amp; receiver, stage_t&lt; In, Out &gt; &amp;&amp; first, Rest &amp;&amp;... rest ) { receiver.emplace_back( move( first.m_builder ) ); if constexpr( 0u != sizeof...(rest) ) move_sink_builder_to&lt;In&gt;( receiver, forward&lt; Rest &gt;(rest)... ); } template&lt; typename In, typename Out, typename... Rest &gt; vector&lt; stage_builder_t &gt; collect_sink_builders( stage_t&lt; In, Out &gt; &amp;&amp; first, Rest &amp;&amp;... stages ) { vector&lt; stage_builder_t &gt; receiver; receiver.reserve( 1 + sizeof...(stages) ); move_sink_builder_to&lt;In&gt;( receiver, move(first), std::forward&lt;Rest&gt;(stages)... ); return receiver; }</span></span></code> </pre> <br><p>  рдХрдВрдкрд╛рдЗрд▓-рдЯрд╛рдЗрдо рдЯрд╛рдЗрдк-рдЪреЗрдХрд┐рдВрдЧ рдпрд╣рд╛рдБ рднреА рдХрд╛рдо рдХрд░рддреА рд╣реИ: рдпрд╣ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ 'in' рдЯрд╛рдЗрдк рдХрд░рдХреЗ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдкреИрд░рд╛рдореАрдЯрд░ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ <code>move_sink_builder_to</code> рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдлреЙрд░реНрдо рдореЗрдВ рдПрдХ рдХреЙрд▓ <code>collect_sink_builders(stage_t&lt;In1, Out1&gt;, stage_t&lt;In2, Out2&gt;, ...)</code> рд╕рдВрдХрд▓рди рддреНрд░реБрдЯрд┐ рдХрд╛ рдХрд╛рд░рдг <code>move_sink_builder_to&lt;In1&gt;(receiver, stage_t&lt;In2, Out2&gt;, ...)</code> рдХреНрдпреЛрдВрдХрд┐ рдХрдВрдкрд╛рдЗрд▓рд░ <code>move_sink_builder_to&lt;In1&gt;(receiver, stage_t&lt;In2, Out2&gt;, ...)</code> ред </p><br><p>  рдореИрдВ рдпрд╣ рднреА рдиреЛрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВ рдХрд┐ рдХреНрдпреЛрдВрдХрд┐ <code>broadcast()</code> рд▓рд┐рдП рд╕рд╣рд╛рдпрдХ рдкрд╛рдЗрдкрд▓рд╛рдЗрдиреЛрдВ рдХреА рдЧрд┐рдирддреА <code>broadcast()</code> рд╕рдВрдХрд▓рди-рд╕рдордп рдкрд░ рдЬреНрдЮрд╛рдд рд╣реИ, рд╣рдо <code>std::vector</code> рдмрдЬрд╛рдп <code>std::array</code> рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдХреБрдЫ рдореЗрдореЛрд░реА рдЖрд╡рдВрдЯрди рд╕реЗ рдмрдЪ рд╕рдХрддреЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди <code>std::vector</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдпрд╣рд╛рдБ рдХреЗрд╡рд▓ рд╕рд╛рджрдЧреА рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><h2 id="relation-between-stages-and-sobjectizers-agentsmboxes">  рдЪрд░рдгреЛрдВ рдФрд░ SObjectizer рдХреЗ рдПрдЬреЗрдВрдЯреЛрдВ / mboxes рдХреЗ рдмреАрдЪ рд╕рдВрдмрдВрдз </h2><br><p>  рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рдкреАрдЫреЗ рдХрд╛ рд╡рд┐рдЪрд╛рд░ рд╣рд░ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдЪрд░рдг рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рдПрдЬреЗрдВрдЯ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рд╣реИред  рдПрдХ рдПрдЬреЗрдВрдЯ рдПрдХ рдЗрдирдХрдорд┐рдВрдЧ рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ, рдЙрд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд <em>рдЪрд░рдг рд╣реИрдВрдбрд▓рд░ рдХреЛ</em> рднреЗрдЬрддрд╛ рд╣реИ, рдкрд░рд┐рдгрд╛рдо рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддрд╛ рд╣реИ рдФрд░, рдпрджрд┐ рдкрд░рд┐рдгрд╛рдо рдЦрд╛рд▓реА рдирд╣реАрдВ рд╣реИ, рддреЛ рдкрд░рд┐рдгрд╛рдо рдХреЛ рдЕрдЧрд▓реЗ рдЪрд░рдг рдореЗрдВ рдЖрдиреЗ рд╡рд╛рд▓реЗ рд╕рдВрджреЗрд╢ рдХреЗ рд░реВрдк рдореЗрдВ рднреЗрдЬрддрд╛ рд╣реИред  рдпрд╣ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрдиреБрдХреНрд░рдо рдЖрд░реЗрдЦ рджреНрд╡рд╛рд░рд╛ рдЪрд┐рддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: </p><br><p><img src="https://habrastorage.org/webt/om/pn/wy/ompnwye792gjgad7zzgphpv4ctu.png"></p><br><p>  рдХреБрдЫ SObjectizer рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдЪреАрдЬреЛрдВ рдкрд░ рдЪрд░реНрдЪрд╛ рдХреА рдЬрд╛рдиреА рд╣реИ, рдХрдо рд╕реЗ рдХрдо рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВред  рдпрджрд┐ рдЖрдкрдХреЛ рдРрд╕реЗ рд╡рд┐рд╡рд░рдгреЛрдВ рдореЗрдВ рдХреЛрдИ рджрд┐рд▓рдЪрд╕реНрдкреА рдирд╣реАрдВ рд╣реИ, рддреЛ рдЖрдк рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдЕрдиреБрднрд╛рдЧреЛрдВ рдХреЛ рдЫреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕реАрдзреЗ рдирд┐рд╖реНрдХрд░реНрд╖ рдкрд░ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред </p><br><h3 id="coop-is-a-group-of-agents-to-work-together">  рдХреВрдкрд░ рдПрдХ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдЬреЗрдВрдЯреЛрдВ рдХрд╛ рдПрдХ рд╕рдореВрд╣ рд╣реИ </h3><br><p>  рдПрдЬреЗрдВрдЯреЛрдВ рдХреЛ рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ рдирд╣реАрдВ рдмрд▓реНрдХрд┐ рдХреЙрдкреНрд╕ рдирд╛рдо рдХреЗ рд╕рдореВрд╣реЛрдВ рдореЗрдВ рдПрд╕реЛрдмрд┐рдЬрд╛рдЗрдЬрд╝рд░ рдореЗрдВ рдкреЗрд╢ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдХреЙрдк рдПрдЬреЗрдВрдЯреЛрдВ рдХрд╛ рдПрдХ рд╕рдореВрд╣ рд╣реИ рдЬрд┐рд╕реЗ рдПрдХ рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рд╕рдореВрд╣ рдХреЗ рдХрд┐рд╕реА рдПрдХ рдПрдЬреЗрдВрдЯ рдХреЗ рдЧрд╛рдпрдм рд╣реЛрдиреЗ рдкрд░ рдХрд╛рдо рдЬрд╛рд░реА рд░рдЦрдиреЗ рдХрд╛ рдХреЛрдИ рдорддрд▓рдм рдирд╣реАрдВ рд╣реИред </p><br><p>  рдЕрддрдГ SObjectizer рдореЗрдВ рдПрдЬреЗрдВрдЯреЛрдВ рдХрд╛ рдкрд░рд┐рдЪрдп, рдХреЙрдк рдЙрджрд╛рд╣рд░рдг рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреА рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ, рдЙрд╕ рдЙрджрд╛рд╣рд░рдг рдХреЛ рдЙрдкрдпреБрдХреНрдд рдПрдЬреЗрдВрдЯреЛрдВ рдХреЗ рд╕рд╛рде рднрд░рдирд╛ рдФрд░ рдлрд┐рд░ рдХреЙрдк рдХреЛ SObjectizer рдореЗрдВ рдкрдВрдЬреАрдХреГрдд рдХрд░рдирд╛ред </p><br><p>  рдЙрд╕рдХреЗ рдХрд╛рд░рдг рдПрдХ <em>рд╕реНрдЯреЗрдЬ рдмрд┐рд▓реНрдбрд░ рдХреЗ</em> рд▓рд┐рдП рдкрд╣рд▓рд╛ рддрд░реНрдХ рдПрдХ рдирдП рдХреЙрдк рдХрд╛ рд╕рдВрджрд░реНрдн рд╣реИред  рдпрд╣ рдХреЙрдк <code>make_pipeline()</code> рдлрд╝рдВрдХреНрд╢рди (рдиреАрдЪреЗ рдЪрд░реНрдЪрд╛ рдХреА рдЧрдИ) рдореЗрдВ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдлрд┐рд░ рдпрд╣ <em>рд╕реНрдЯреЗрдЬ рдмрд┐рд▓реНрдбрд░реЛрдВ</em> рджреНрд╡рд╛рд░рд╛ рдкреЙрдкреБрд▓реЗрдЯреЗрдб рд╣реИ рдФрд░ рдлрд┐рд░ рдкрдВрдЬреАрдХреГрдд (рдлрд┐рд░ рд╕реЗ <code>make_pipeline()</code> рдлрд╝рдВрдХреНрд╢рди) рдореЗрдВ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред </p><br><h3 id="message-boxes">  рд╕рдВрджреЗрд╢ рдмреЙрдХреНрд╕ </h3><br><p>  SObjectizer рдХрдИ рд╕рдВрдЧрд╛рдорд┐рддрд┐-рд╕рдВрдмрдВрдзрд┐рдд рдореЙрдбрд▓ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИред  рдЕрднрд┐рдиреЗрддрд╛ рдореЙрдбрд▓ рдЙрдирдореЗрдВ рд╕реЗ рд╕рд┐рд░реНрдл рдПрдХ рд╣реИред  рдЙрд╕ рд╡рдЬрд╣ рд╕реЗ, рдПрд╕реЛрдмрд┐рдЬрд╛рдЗрдЬрд╝рд░ рдЕрдиреНрдп рдЕрднрд┐рдиреЗрддрд╛ рдлреНрд░реЗрдорд╡рд░реНрдХ рд╕реЗ рдХрд╛рдлреА рднрд┐рдиреНрди рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  рдПрдХ рдЕрдВрддрд░ рд╕рдВрджреЗрд╢реЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдВрдмреЛрдзрди рдпреЛрдЬрдирд╛ рд╣реИред </p><br><p>  SObjectizer рдореЗрдВ рд╕рдВрджреЗрд╢ рдЕрднрд┐рдиреЗрддрд╛рдУрдВ рдХреЛ рдирд╣реАрдВ рдмрд▓реНрдХрд┐ <em>рд╕рдВрджреЗрд╢ рдмреЙрдХреНрд╕</em> (mboxes) рдХреЛ рд╕рдВрдмреЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЕрднрд┐рдиреЗрддрд╛рдУрдВ рдХреЛ рдПрдХ mbox рд╕реЗ рд╕рдВрджреЗрд╢реЛрдВ рдХреА рд╕рджрд╕реНрдпрддрд╛ рд▓реЗрдиреА рд╣реЛрддреА рд╣реИред  рдпрджрд┐ рдХреЛрдИ рдЕрднрд┐рдиреЗрддрд╛ рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖ рд╕рдВрджреЗрд╢ рдкреНрд░рдХрд╛рд░ рд╕реЗ mbox рд╕реЗ рд╕рджрд╕реНрдпрддрд╛ рд▓реЗрддрд╛ рд╣реИ, рддреЛ рдЙрд╕реЗ рдЙрд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рд╣реЛрдВрдЧреЗ: </p><br><p><img src="https://habrastorage.org/webt/o4/bf/ee/o4bfee0lp8hdvks68cas4yjlkgu.png"></p><br><p>  рдпрд╣ рддрдереНрдп рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдПрдХ рдЪрд░рдг рд╕реЗ рджреВрд╕рд░реЗ рдЪрд░рдг рдореЗрдВ рд╕рдВрджреЗрд╢ рднреЗрдЬрдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╣рд░ рдЪрд░рдг рдореЗрдВ рдЙрд╕рдХрд╛ рдмреЙрдХреНрд╕ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдЙрд╕ рдмреЙрдХреНрд╕ рдХреЛ рдкрд┐рдЫрд▓реЗ рдЪрд░рдг рдХреЗ рд▓рд┐рдП рдЬрд╛рдирд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </p><br><p>  SObjectizer рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдЕрднрд┐рдиреЗрддрд╛ (рдЙрд░реНрдл рдПрдЬреЗрдВрдЯ) <em>рдХрд╛ рдкреНрд░рддреНрдпрдХреНрд╖</em> рдмреЙрдХреНрд╕ рд╣реИред  рдпрд╣ рдПрдордмреЙрдХреНрд╕ рдХреЗрд╡рд▓ рдорд╛рд▓рд┐рдХ рдПрдЬреЗрдВрдЯ рдХреЗ рд╕рд╛рде рдЬреБрдбрд╝рд╛ рд╣реБрдЖ рд╣реИ рдФрд░ рдХрд┐рд╕реА рдЕрдиреНрдп рдПрдЬреЗрдВрдЯ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдЪрд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдП рдЧрдП рдПрдЬреЗрдВрдЯреЛрдВ рдХреЗ рдкреНрд░рддреНрдпрдХреНрд╖ рдмреЙрдХреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЪрд░рдгреЛрдВ рдХреА рдмрд╛рддрдЪреАрдд рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </p><br><p>  рдпрд╣ SObjectizer рдХреА рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреБрдЫ рдкрд╛рдЗрдкрд▓рд╛рдЗрди-рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд╡рд┐рд╡рд░рдгреЛрдВ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреА рд╣реИред </p><br><p>  рдкрд╣рд▓рд╛ рддрдереНрдп рдпрд╣ рд╣реИ рдХрд┐ <em>рд╕реНрдЯреЗрдЬ рдмрд┐рд▓реНрдбрд░</em> рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреНрд░реЛрдЯреЛрдЯрд╛рдЗрдк рд╣реИ: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> builder(<span class="hljs-keyword"><span class="hljs-keyword">coop_t</span></span> &amp;, <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span>);</code> </pre> <br><p>  рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ <em>рд╕реНрдЯреЗрдЬ рдмрд┐рд▓реНрдбрд░</em> рдХреЛ рдЕрдЧрд▓реЗ рдЪрд░рдг рдХрд╛ рдПрдХ рдмреЙрдХреНрд╕ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдЙрд╕реЗ рдПрдХ рдирдпрд╛ рдПрдЬреЗрдВрдЯ рдмрдирд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬреЛ рдЙрд╕ рдмреЙрдХреНрд╕ рдореЗрдВ рд╕реНрдЯреЗрдЬ рдХреЗ рдкрд░рд┐рдгрд╛рдо рднреЗрдЬреЗрдЧрд╛ред  рдирдП рдПрдЬреЗрдВрдЯ рдХрд╛ рдПрдХ рдмреЙрдХреНрд╕ <em>рд╕реНрдЯреЗрдЬ рдмрд┐рд▓реНрдбрд░</em> рджреНрд╡рд╛рд░рд╛ рд▓реМрдЯрд╛рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  рдЙрд╕ mbox рдХрд╛ рдЙрдкрдпреЛрдЧ рдкрд┐рдЫрд▓реЗ рдЪрд░рдг рдХреЗ рд▓рд┐рдП рдПрдХ рдПрдЬреЗрдВрдЯ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </p><br><p>  рджреВрд╕рд░рд╛ рддрдереНрдп рдпрд╣ рд╣реИ рдХрд┐ рдЪрд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдЬреЗрдВрдЯ рдЖрд░рдХреНрд╖рд┐рдд рдХреНрд░рдо рдореЗрдВ рдмрдирд╛рдП рдЬрд╛рддреЗ рд╣реИрдВред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЕрдЧрд░ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рд╣реИ: </p><br><pre> <code class="cpp hljs">stage(A) | stage(B) | stage(C)</code> </pre> <br><p>  рд╕реНрдЯреЗрдЬ рд╕реА рдХреЗ рд▓рд┐рдП рдПрдХ рдПрдЬреЗрдВрдЯ рдкрд╣рд▓реЗ рдмрдирд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдлрд┐рд░ рдЗрд╕рдХреЗ рдПрдордмреЙрдХреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реНрдЯреЗрдЬ рдмреА рдХреЗ рд▓рд┐рдП рдПрдЬреЗрдВрдЯ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдФрд░ рдлрд┐рд░ рд╕реНрдЯреЗрдЬ рдП рдХреЗ рд▓рд┐рдП рдПрдЬреЗрдВрдЯ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреЗ рд▓рд┐рдП рдмреА-рд╕реНрдЯреЗрдЬ рдПрдЬреЗрдВрдЯ рдХреЗ рдПрдордмреЙрдХреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </p><br><p>  рдпрд╣ рднреА рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ <code>operator|()</code> рдПрдЬреЗрдВрдЯ рдирд╣реАрдВ рдмрдирд╛рддрд╛ рд╣реИ: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">stage_builder_t</span></span>{ [prev, next]( <span class="hljs-keyword"><span class="hljs-keyword">coop_t</span></span> &amp; coop, <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> next_stage ) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> m = next.m_builder( coop, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(next_stage) ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prev.m_builder( coop, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(m) ); } }</code> </pre> <br><p>  <code>operator|()</code> рдПрдХ рдмрд┐рд▓реНрдбрд░ рдмрдирд╛рддрд╛ рд╣реИ рдЬреЛ рдХреЗрд╡рд▓ рдЕрдиреНрдп рдмрд┐рд▓реНрдбрд░реЛрдВ рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ рд▓реЗрдХрд┐рди рдЕрддрд┐рд░рд┐рдХреНрдд рдПрдЬреЗрдВрдЯреЛрдВ рдХрд╛ рдкрд░рд┐рдЪрдп рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИред  рддреЛ рдорд╛рдорд▓реЗ рдХреЗ рд▓рд┐рдП: </p><br><pre> <code class="cpp hljs">stage(A) | stage(B)</code> </pre> <br><p>  рдХреЗрд╡рд▓ рджреЛ рдПрдЬреЗрдВрдЯ рдмрдирд╛рдП рдЬрд╛рдПрдВрдЧреЗ (рдП-рд╕реНрдЯреЗрдЬ рдФрд░ рдмреА-рд╕реНрдЯреЗрдЬ рдХреЗ рд▓рд┐рдП) рдФрд░ рдлрд┐рд░ рдЙрдиреНрд╣реЗрдВ <code>operator|()</code> рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдП рдЧрдП <em>рд╕реНрдЯреЗрдЬ рдмрд┐рд▓реНрдб</em> рдореЗрдВ рдПрдХ рд╕рд╛рде рдЬреЛрдбрд╝рд╛ рдЬрд╛рдПрдЧрд╛ред <code>operator|()</code> </p><br><h3 id="there-is-no-agent-for-broadcast-implementation">  <code>broadcast()</code> рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рд▓рд┐рдП рдХреЛрдИ рдПрдЬреЗрдВрдЯ рдирд╣реАрдВ рд╣реИ </h3><br><p>  рдкреНрд░рд╕рд╛рд░рдг рдЪрд░рдг рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рд╕реНрдкрд╖реНрдЯ рддрд░реАрдХрд╛ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдПрдЬреЗрдВрдЯ рдмрдирд╛рдирд╛ рд╣реИ рдЬреЛ рдЖрдиреЗ рд╡рд╛рд▓реЗ рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдЧрд╛ рдФрд░ рдлрд┐рд░ рдЙрд╕ рд╕рдВрджреЗрд╢ рдХреЛ рдЧрдВрддрд╡реНрдп mboxes рдХреА рд╕реВрдЪреА рдореЗрдВ рдлрд┐рд░ рд╕реЗ рднреЗрдЬ рджреЗрдЧрд╛ред  рдЗрд╕ рддрд░рд╣ <a href="">рдХрд╛ рдЙрдкрдпреЛрдЧ</a> рд╡рд░реНрдгрд┐рдд рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдбреАрдПрд╕рдПрд▓ <a href="">рдХреЗ рдкрд╣рд▓реЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдореЗрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛</a> ред </p><br><p>  рд▓реЗрдХрд┐рди рд╣рдорд╛рд░рд╛ рд╕рд╛рдереА рдкреНрд░реЛрдЬреЗрдХреНрдЯ, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">so5extra</a> , рдЕрдм mbox рдХрд╛ рдПрдХ рд╡рд┐рд╢реЗрд╖ рд╕рдВрд╕реНрдХрд░рдг рд╣реИ: рдПрдХ рдкреНрд░рд╕рд╛рд░рдгред  рд╡рд╣ рдПрдордмреЙрдХреНрд╕ рдареАрдХ рд╡рд╣реА рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдпрд╣рд╛рдВ рдЖрд╡рд╢реНрдпрдХ рд╣реИ: рдпрд╣ рдПрдХ рдирдпрд╛ рд╕рдВрджреЗрд╢ рд▓реЗрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдбреЗрд╕реНрдЯрд┐рдиреЗрд╢рди рдмреЙрдХреНрд╕ рдХреЗ рд╕реЗрдЯ рддрдХ рдкрд╣реБрдВрдЪрд╛рддрд╛ рд╣реИред </p><br><p>  рдЗрд╕рдХреА рд╡рдЬрд╣ рд╕реЗ рдЕрд▓рдЧ рдкреНрд░рд╕рд╛рд░рдг рдПрдЬреЗрдВрдЯ рдмрдирд╛рдиреЗ рдХреА рдХреЛрдИ рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рд╣рдо рд╕рд┐рд░реНрдл so5extra рд╕реЗ рдкреНрд░рд╕рд╛рд░рдг mbox рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// // A special mbox for broadcasting of a message to a set of destination // mboxes. // using broadcast_mbox_t = so_5::extra::mboxes::broadcast::fixed_mbox_template_t&lt;&gt;; ... // // Inside the broadcast() function: // stage_builder_t builder{ [broadcasts = collect_sink_builders( move(first), forward&lt; Rest &gt;(stages)...)] ( coop_t &amp; coop, mbox_t ) -&gt; mbox_t { vector&lt; mbox_t &gt; mboxes; mboxes.reserve( broadcasts.size() ); for( const auto &amp; b : broadcasts ) mboxes.emplace_back( b( coop, mbox_t{} ) ); // That is the creation of broadcasting mbox instance. return broadcast_mbox_t::make( coop.environment(), std::move(mboxes) ); } };</span></span></code> </pre> <br><h3 id="implementation-of-stage-agent">  рд╕реНрдЯреЗрдЬ-рдПрдЬреЗрдВрдЯ рдХрд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди </h3><br><p>  рдЕрдм рд╣рдо рд╕реНрдЯреЗрдЬ рдПрдЬреЗрдВрдЯ рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// // An agent which will be used as intermediate or terminal pipeline stage. // It will receive input message, call the stage handler and pass // handler result to the next stage (if any). // template&lt; typename In, typename Out &gt; class a_stage_point_t final : public agent_t { public : a_stage_point_t( context_t ctx, stage_handler_t&lt; In, Out &gt; handler, mbox_t next_stage ) : agent_t{ ctx } , m_handler{ move( handler ) } , m_next{ move(next_stage) } {} void so_define_agent() override { if( m_next ) // Because there is the next stage the appropriate // message handler will be used. so_subscribe_self().event( [=]( const In &amp; evt ) { auto r = m_handler( evt ); if( r ) so_5::send( m_next, r ); } ); else // There is no next stage. A very simple message handler // will be used for that case. so_subscribe_self().event( [=]( const In &amp; evt ) { m_handler( evt ); } ); } private : const stage_handler_t&lt; In, Out &gt; m_handler; const mbox_t m_next; }; // // A specialization of a_stage_point_t for the case of terminal stage of // a pipeline. This type will be used for stage handlers with void // return type. // template&lt; typename In &gt; class a_stage_point_t&lt; In, void &gt; final : public agent_t { public : a_stage_point_t( context_t ctx, stage_handler_t&lt; In, void &gt; handler, mbox_t next_stage ) : agent_t{ ctx } , m_handler{ move( handler ) } { if( next_stage ) throw std::runtime_error( "sink point cannot have next stage" ); } void so_define_agent() override { so_subscribe_self().event( [=]( const In &amp; evt ) { m_handler( evt ); } ); } private : const stage_handler_t&lt; In, void &gt; m_handler; };</span></span></code> </pre> <br><p>  рдпрджрд┐ рдЖрдк SObjectizer рдХреА рдореВрд▓ рдмрд╛рддреЗрдВ рд╕рдордЭрддреЗ рд╣реИрдВ рддреЛ рдпрд╣ рдмрд╣реБрдд рддреБрдЪреНрдЫ рд╣реИред  рдпрджрд┐ рдирд╣реАрдВ рддреЛ рдХреБрдЫ рд╢рдмреНрджреЛрдВ рдореЗрдВ рд╕рдордЭрд╛рдирд╛ рдХрд╛рдлреА рдХрдард┐рди рд╣реЛрдЧрд╛ (рдЗрд╕рд▓рд┐рдП рдмреЗрдЭрд┐рдЭрдХ рдЯрд┐рдкреНрдкрдгреА рдореЗрдВ рд╕рд╡рд╛рд▓ рдкреВрдЫ рд╕рдХрддреЗ рд╣реИрдВ)ред </p><br><p>  <code>a_stage_point_t</code> рдПрдЬреЗрдВрдЯ рдХрд╛ рдореБрдЦреНрдп рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдкреНрд░рдХрд╛рд░ рдХреЗ рд╕рдВрджреЗрд╢ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рджрд╕реНрдпрддрд╛ рдмрдирд╛рддрд╛ рд╣реИред  рдЬрдм рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХрд╛ рд╕рдВрджреЗрд╢ рдЖрддрд╛ рд╣реИ рддреЛ <em>рд╕реНрдЯреЗрдЬ рд╣реИрдВрдбрд▓рд░</em> рдХрд╣рд▓рд╛рддрд╛ рд╣реИред  рдпрджрд┐ <em>рд╕реНрдЯреЗрдЬ рд╣реИрдВрдбрд▓рд░</em> рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдкрд░рд┐рдгрд╛рдо рджреЗрддрд╛ рд╣реИ, рддреЛ рдкрд░рд┐рдгрд╛рдо рдЕрдЧрд▓реЗ рдЪрд░рдг рдореЗрдВ рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдпрджрд┐ рд╡рд╣ рдЪрд░рдг рдореМрдЬреВрдж рд╣реИ)ред </p><br><p>  рдорд╛рдорд▓реЗ рдХреЗ рд▓рд┐рдП <code>a_stage_point_t</code> рдХрд╛ рдПрдХ рд╕рдВрд╕реНрдХрд░рдг рднреА рд╣реИ рдЬрдм рд╕рдВрдмрдВрдзрд┐рдд рдЪрд░рдг рдЯрд░реНрдорд┐рдирд▓ рдЪрд░рдг рд╣реИ рдФрд░ рдЕрдЧрд▓рд╛ рдЪрд░рдг рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред </p><br><p>  <code>a_stage_point_t</code> рдХрд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдереЛрдбрд╝рд╛ рдЬрдЯрд┐рд▓ рд▓рдЧ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдореЗрд░рд╛ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░реЛ, рдпрд╣ рдореЗрд░реЗ рджреНрд╡рд╛рд░рд╛ рд▓рд┐рдЦреЗ рдЧрдП рд╕рдмрд╕реЗ рд╕рд░рд▓ рдПрдЬреЗрдВрдЯреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИред </p><br><h2 id="make_pipeline-function">  make_pipeline () рдлрд╝рдВрдХреНрд╢рди </h2><br><p>  рдпрд╣ рдЕрдВрддрд┐рдо рдкрд╛рдЗрдкрд▓рд╛рдЗрди-рдирд┐рд░реНрдорд╛рдг рдХрд╛рд░реНрдп, <code>make_pipeline()</code> рдкрд░ рдЪрд░реНрдЪрд╛ рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рд╣реИ: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> In, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Out, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span>... Args &gt; <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> make_pipeline( <span class="hljs-comment"><span class="hljs-comment">// SObjectizer Environment to work in. so_5::environment_t &amp; env, // Definition of a pipeline. stage_t&lt; In, Out &gt; &amp;&amp; sink, // Optional args to be passed to make_coop() function. Args &amp;&amp;... args ) { auto coop = env.make_coop( forward&lt; Args &gt;(args)... ); auto mbox = sink.m_builder( *coop, mbox_t{} ); env.register_coop( move(coop) ); return mbox; }</span></span></code> </pre> <br><p>  рдпрд╣рд╛рдВ рди рдХреЛрдИ рдЬрд╛рджреВ рд╣реИ рдФрд░ рди рд╣реА рдХреЛрдИ рдЖрд╢реНрдЪрд░реНрдпред  рд╣рдореЗрдВ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЗ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдПрдЬреЗрдВрдЯреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдирдпрд╛ рдХреЙрдк рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЙрд╕ рдХреЙрдк рдХреЛ рдПрдЬреЗрдВрдЯреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рд╢реАрд░реНрд╖-рд╕реНрддрд░реАрдп <em>рд╕реНрдЯреЗрдЬ рдмрд┐рд▓реНрдбрд░</em> рдХреЛ рдХреЙрд▓ рдХрд░рдХреЗ рднрд░реЗрдВ, рдФрд░ рдлрд┐рд░ рдЙрд╕ рдХреЙрдк рдХреЛ рд╕реЛрдмрд┐рдЬрд╛рдЗрдЬрд╝рд░ рдореЗрдВ рдкрдВрдЬреАрдХреГрдд рдХрд░реЗрдВред  рд╡рд╣ рд╕рдмред </p><br><p>  <code>make_pipeline()</code> рдХрд╛ рдкрд░рд┐рдгрд╛рдо рдкрд╛рдЗрдк рд▓рд╛рдЗрди рдХреЗ рдмрд╛рдПрдВ-рд╕рдмрд╕реЗ (рдкрд╣рд▓реЗ) рдЪрд░рдг рдХрд╛ <code>make_pipeline()</code> ред  рдЙрд╕ mbox рдХрд╛ рдЙрдкрдпреЛрдЧ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЛ рд╕рдВрджреЗрд╢ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </p><br><h1 id="the-simulation-and-experiments-with-it">  рд╕рд┐рдореБрд▓реЗрд╢рди рдФрд░ рдЗрд╕рдХреЗ рд╕рд╛рде рдкреНрд░рдпреЛрдЧ </h1><br><p>  рддреЛ рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╣рдорд╛рд░реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд▓реЙрдЬрд┐рдХ рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рдкреНрд░рдХрд╛рд░ рдФрд░ рдлрд╝рдВрдХреНрд╢рдВрд╕ рд╣реИрдВ рдФрд░ рдЙрди рдлрд╝рдВрдХреНрд╢рдВрд╕ рдХреЛ рдбреЗрдЯрд╛-рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдореЗрдВ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг рд╣реИрдВред  рдЪрд▓реЛ рдЗрд╕реЗ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдПрдХ рдкрд░рд┐рдгрд╛рдо рджреЗрдЦрддреЗ рд╣реИрдВ: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Launch SObjectizer in a separate thread. wrapped_env_t sobj; // Make a pipeline. auto pipeline = make_pipeline( sobj.environment(), stage(validation) | stage(conversion) | broadcast( stage(archiving), stage(distribution), stage(range_checking) | stage(alarm_detector{}) | broadcast( stage(alarm_initiator), stage( []( const alarm_detected &amp; v ) { alarm_distribution( cerr, v ); } ) ) ) ); // Send messages to a pipeline in a loop with 10ms delays. for( uint8_t i = 0; i &lt; static_cast&lt; uint8_t &gt;(250); i += 10 ) { send&lt; raw_value &gt;( pipeline, raw_measure{ 0, 0, i } ); std::this_thread::sleep_for( chrono::milliseconds{10} ); } }</span></span></code> </pre> <br><p>  рдпрджрд┐ рд╣рдо рдЙрд╕ рдЙрджрд╛рд╣рд░рдг рдХреЛ рдЪрд▓рд╛рддреЗ рд╣реИрдВ рддреЛ рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЖрдЙрдЯрдкреБрдЯ рджреЗрдЦреЗрдВрдЧреЗ: </p><br><pre> <code class="plaintext hljs">archiving (0,0) distributing (0,0) archiving (0,5) distributing (0,5) archiving (0,10) distributing (0,10) archiving (0,15) distributing (0,15) archiving (0,20) distributing (0,20) archiving (0,25) distributing (0,25) archiving (0,30) distributing (0,30) ... archiving (0,105) distributing (0,105) archiving (0,110) distributing (0,110) === alarm (0) === alarm_distribution (0) archiving (0,115) distributing (0,115) archiving (0,120) distributing (0,120) === alarm (0) === alarm_distribution (0)</code> </pre> <br><p>  рдпрд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред </p><br><p>  рд▓реЗрдХрд┐рди рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рд╣рдорд╛рд░реА рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЗ рдЪрд░рдг рдХреНрд░рдорд┐рдХ рд░реВрдк рд╕реЗ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рдПрдХ рдХреЗ рдмрд╛рдж рдПрдХ, рд╣реИ рди? </p><br><p>  рд╣рд╛рдБ, рдпрд╣ рд╣реИред  рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╕рднреА рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдПрдЬреЗрдВрдЯ рдбрд┐рдлрд╝реЙрд▓реНрдЯ SObjectizer рдХреЗ рдбрд┐рд╕реНрдкреИрдЪрд░ рд╕реЗ рдмрдВрдзреЗ рд╣реИрдВред  рдФрд░ рд╡рд╣ рдбрд┐рд╕реНрдкреИрдЪрд░ рд╕рднреА рдПрдЬреЗрдВрдЯреЛрдВ рдХреЗ рд╕рдВрджреЗрд╢ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреА рд╕реЗрд╡рд╛ рдХреЗ рд▓рд┐рдП рд╕рд┐рд░реНрдл рдПрдХ рд╢реНрд░рдорд┐рдХ рдзрд╛рдЧреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред </p><br><p>  рд▓реЗрдХрд┐рди рдЗрд╕реЗ рдЖрд╕рд╛рдиреА рд╕реЗ рдмрджрд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдмрд╕ <code>make_pipeline()</code> рдХреЙрд▓ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рддрд░реНрдХ рдкрд╛рд╕ рдХрд░реЗрдВ: </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Make a pipeline. auto pipeline = make_pipeline( sobj.environment(), stage(validation) | stage(conversion) | broadcast( stage(archiving), stage(distribution), stage(range_checking) | stage(alarm_detector{}) | broadcast( stage(alarm_initiator), stage( []( const alarm_detected &amp; v ) { alarm_distribution( cerr, v ); } ) ) ), disp::thread_pool::make_dispatcher( sobj.environment() ).binder( disp::thread_pool::bind_params_t{}.fifo( disp::thread_pool::fifo_t::individual ) ) );</span></span></code> </pre> <br><p>  рдпрд╣ рдПрдХ рдирдпрд╛ рдереНрд░реЗрдб рдкреВрд▓ рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ рдЙрд╕ рдкреВрд▓ рдореЗрдВ рд╕рднреА рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдПрдЬреЗрдВрдЯреЛрдВ рдХреЛ рдмрд╛рдВрдзрддрд╛ рд╣реИред  рдкреНрд░рддреНрдпреЗрдХ рдПрдЬреЗрдВрдЯ рдХреЛ рдЕрдиреНрдп рдПрдЬреЗрдВрдЯреЛрдВ рд╕реЗ рд╕реНрд╡рддрдВрддреНрд░ рд░реВрдк рд╕реЗ рдкреВрд▓ рджреНрд╡рд╛рд░рд╛ рд╕реЗрд╡рд╛ рджреА рдЬрд╛рдПрдЧреАред </p><br><p>  рдпрджрд┐ рд╣рдо рд╕рдВрд╢реЛрдзрд┐рдд рдЙрджрд╛рд╣рд░рдг рдЪрд▓рд╛рддреЗ рд╣реИрдВ рддреЛ рд╣рдо рдХреБрдЫ рдРрд╕рд╛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="plaintext hljs">archiving (0,0) distributing (0,0) distributing (0,5) archiving (0,5) archiving (0,10) distributing (0,10) distributing (archiving (0,15) 0,15) archiving (0,20) distributing (0,20) archiving (0,25) distributing (0,25) archiving (0,distributing (030) ,30) ... archiving (0,distributing (0,105) 105) archiving (0,alarm_distribution (0) distributing (0,=== alarm (0) === 110) 110) archiving (distributing (0,0,115) 115) archiving (distributing (=== alarm (0) === 0alarm_distribution (0) 0,120) ,120)</code> </pre> <br><p>  рдЗрд╕рд▓рд┐рдП рд╣рдо рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЗ рд╡рд┐рднрд┐рдиреНрди рдЪрд░рдг рд╕рдорд╛рдирд╛рдВрддрд░ рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВред </p><br><p>  рд▓реЗрдХрд┐рди рдХреНрдпрд╛ рдЖрдЧреЗ рдЬрд╛рдХрд░ рд╡рд┐рднрд┐рдиреНрди рдбрд┐рд╕реНрдкреИрдЪрд░реЛрдВ рдореЗрдВ рдЪрд░рдгреЛрдВ рдХреЛ рдмрд╛рдВрдзрдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реИ? </p><br><p>  рд╣рд╛рдВ, рдпрд╣ рд╕рдВрднрд╡ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдореЗрдВ <code>stage()</code> рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдПрдХ рдФрд░ рдЕрдзрд┐рднрд╛рд░ рд▓рд╛рдЧреВ рдХрд░рдирд╛ рд╣реЛрдЧрд╛: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Callable, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> In = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> <span class="hljs-keyword"><span class="hljs-keyword">callable_traits_t</span></span>&lt; Callable &gt;::arg_type, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Out = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> <span class="hljs-keyword"><span class="hljs-keyword">callable_traits_t</span></span>&lt; Callable &gt;::result_type &gt; <span class="hljs-keyword"><span class="hljs-keyword">stage_t</span></span>&lt; In, Out &gt; stage( <span class="hljs-keyword"><span class="hljs-keyword">disp_binder_shptr_t</span></span> disp_binder, Callable handler ) { <span class="hljs-keyword"><span class="hljs-keyword">stage_builder_t</span></span> builder{ [binder = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(disp_binder), h = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(handler)]( <span class="hljs-keyword"><span class="hljs-keyword">coop_t</span></span> &amp; coop, <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> next_stage) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> coop.make_agent_with_binder&lt; <span class="hljs-keyword"><span class="hljs-keyword">a_stage_point_t</span></span>&lt;In, Out&gt; &gt;( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(binder), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(h), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(next_stage) ) -&gt;so_direct_mbox(); } }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(builder) }; }</code> </pre> <br><p> This version of <code>stage()</code> accepts not only a <em>stage handler</em> but also a dispatcher binder. Dispatcher binder is a way to bind an agent to the particular dispatcher. So to assign a stage to a specific working context we can create an appropriate dispatcher and then pass the binder to that dispatcher to <code>stage()</code> function. Let's do that: </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// An active_obj dispatcher to be used for some stages. auto ao_disp = disp::active_obj::make_dispatcher( sobj.environment() ); // Make a pipeline. auto pipeline = make_pipeline( sobj.environment(), stage(validation) | stage(conversion) | broadcast( stage(ao_disp.binder(), archiving), stage(ao_disp.binder(), distribution), stage(range_checking) | stage(alarm_detector{}) | broadcast( stage(ao_disp.binder(), alarm_initiator), stage(ao_disp.binder(), []( const alarm_detected &amp; v ) { alarm_distribution( cerr, v ); } ) ) ), disp::one_thread::make_dispatcher( sobj.environment() ).binder() );</span></span></code> </pre> <br><p> In that case stages <code>archiving</code> , <code>distribution</code> , <code>alarm_initiator</code> and <code>alarm_distribution</code> will work on own worker threads. All other stages will work on the same single worker thread. </p><br><h1 id="the-conclusion"> The conclusion </h1><br><p> This was an interesting experiment and I was surprised how easy SObjectizer could be used in something like reactive programming or data-flow programming. </p><br><p> However, I don't think that pipeline DSL can be practically meaningful. It's too simple and, maybe not flexible enough. But, I hope, it can be a base for more interesting experiments for those why need to deal with different workflows and data-processing pipelines. At least as a base for some ideas in that area. C++ language a rather good here and some (not so complicated) template magic can help to catch various errors at compile-time. </p><br><p> In conclusion, I want to say that we see SObjectizer not as a specialized tool for solving a particular problem, but as a basic set of tools to be used in solutions for different problems. And, more importantly, that basic set can be extended for your needs. Just take a look at <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">SObjectizer</a> , try it, and share your feedback. Maybe you missed something in SObjectizer? Perhaps you don't like something? <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Tell us</a> , and we can try to help you. </p><br><p> If you want to help further development of SObjectizer, please share a reference to it or to this article somewhere you want (Reddit, HackerNews, LinkedIn, Facebook, Twitter, ...). The more attention and the more feedback, the more new features will be incorporated into SObjectizer. </p><br><p> And many thanks for reading this ;) </p><br><p>  рдкреБрдирд╢реНрдЪред The source code for that example can be found in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">that repository</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi460123/">https://habr.com/ru/post/hi460123/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi460113/index.html">рдЬреЗрдПрд╕рдУрд╕реА рд╕реАрдИрдЖрд░рдЯреА, рдпрд╛ рдЕрдирдмрдирдмрд▓ рдлреЛрд░реЗрдВрд╕рд┐рдХ рдХреЗ рдЬреАрд╡рди рдХреА рдХреБрдЫ рдХрд╣рд╛рдирд┐рдпрд╛рдБ</a></li>
<li><a href="../hi460115/index.html">Erlang рдореЗрдВ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдХреЗ рджрд╕ рд╕рд╛рд▓</a></li>
<li><a href="../hi460117/index.html">рдХреНрдпрд╛ рд░реВрд╕ рдореЗрдВ рд╕рдмрд╕реЗ рдмрдбрд╝реЗ рдЧреНрд░рд╛рд╣рдХ рдПрдХ рдмрдбрд╝рд╛ рдЦрдЬрд╛рдирд╛ рдпрд╛ рд╕рд┐рд░рджрд░реНрдж рд╣реИрдВ? AGIMA рдЕрдиреБрднрд╡</a></li>
<li><a href="../hi460119/index.html">рд╕реНрдерд┐рд░ рдХреЛрдб рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдореЗрдВ рддреНрд░реБрдЯрд┐рдпрд╛рдВ рдирд╣реАрдВ рдорд┐рд▓реА рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ</a></li>
<li><a href="../hi460121/index.html">рд╕реНрдерд┐рд░ рдХреЛрдб рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдореЗрдВ рддреНрд░реБрдЯрд┐рдпрд╛рдВ рдирд╣реАрдВ рдкрд╛рдИ рдЬрд╛рддреА рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ</a></li>
<li><a href="../hi460125/index.html">Node.js рдпрд╛ Java: рдкреНрд░рджрд░реНрд╢рди, рд╕рдВрд╕рд╛рдзрди, рдкреНрд░рд╡рд╛рд╣ рдирд┐рдпрдВрддреНрд░рдг, рд▓реЛрдХрдкреНрд░рд┐рдпрддрд╛ рдФрд░ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдЕрдиреБрднрд╡</a></li>
<li><a href="../hi460129/index.html">рд░реЛрдмреЛрдЯ рдФрд░ рд╕реНрдЯреНрд░реЙрдмреЗрд░реА: рдПрдЖрдИ рдлреАрд▓реНрдб рдкреИрджрд╛рд╡рд╛рд░ рдХреИрд╕реЗ рдмрдврд╝рд╛рддрд╛ рд╣реИ</a></li>
<li><a href="../hi460131/index.html">рд╕реЛрдлреЛрд╕ рдПрдХреНрд╕рдЬреА рдлрд╛рдпрд░рд╡рд╛рд▓: рд╕реВрдЪрдирд╛ рд╕реБрд░рдХреНрд╖рд╛ рдШрдЯрдирд╛рдУрдВ рдХреЗ рд▓рд┐рдП рд╕реНрд╡рдд: рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕рд╛рде рдХреНрд▓рд╛рд╕рд┐рдХ рдПрдордИ рд╕реЗ рдПрдирдЬреАрдПрдлрдбрдмреНрд▓реНрдпреВ рддрдХ</a></li>
<li><a href="../hi460133/index.html">рдХреЛрдЯрд▓рд┐рди / рдПрд╡рд░реАрд╡реЗрдпрд░ - рд╢реЛрдХреЗрд╕ рдЕрднреНрдпрд╛рд╕: 31 рдЬреБрд▓рд╛рдИ</a></li>
<li><a href="../hi460135/index.html">рд╕реБрд░рдХреНрд╖рд╛ рд╕рдкреНрддрд╛рд╣ 29: рдЬрд╝реВрдо, рд╕реБрд░рдХреНрд╖рд╛, рдФрд░ рдирд╛рдЯрдХреАрдпрддрд╛</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>