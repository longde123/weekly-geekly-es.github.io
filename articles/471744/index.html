<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úçüèø üíó ‚ô¶Ô∏è Tarantool Data Grid: arquitectura y caracter√≠sticas üéì üõ∑ üå†</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En 2017, ganamos la competencia para el desarrollo del n√∫cleo de transacciones para el negocio de inversi√≥n de Alfa-Bank y comenzamos a trabajar de in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tarantool Data Grid: arquitectura y caracter√≠sticas</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/471744/"><img src="https://habrastorage.org/webt/v7/6-/di/v76-dikmo5ifekbsg35xutol68s.jpeg"><br><br>  En 2017, ganamos la competencia para el desarrollo del n√∫cleo de transacciones para el negocio de inversi√≥n de Alfa-Bank y comenzamos a trabajar de inmediato.  (Vladimir Drynkin, l√≠der del equipo de desarrollo de Investment Business Transaction Core de Alfa-Bank, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">habl√≥</a> sobre el n√∫cleo de negocios de inversi√≥n en HighLoad ++ 2018). Se supon√≠a que este sistema deb√≠a agregar datos de transacciones en diferentes formatos de varias fuentes, unificar los datos, guardarlos y Proporcionar acceso a ella. <br><br>  En el proceso de desarrollo, el sistema evolucion√≥ y ampli√≥ sus funciones.  En alg√∫n momento, nos dimos cuenta de que creamos algo mucho m√°s que un simple software de aplicaci√≥n dise√±ado para un alcance bien definido de tareas: creamos un sistema para construir aplicaciones distribuidas con almacenamiento persistente.  Nuestra experiencia sirvi√≥ de base para el nuevo producto, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tarantool Data Grid</a> (TDG). <br><br>  Quiero hablar sobre la arquitectura TDG y las soluciones que desarrollamos durante el desarrollo.  Presentar√© las funciones b√°sicas y mostrar√© c√≥mo nuestro producto podr√≠a convertirse en la base para construir soluciones llave en mano. <br><a name="habracut"></a><br>  En t√©rminos de arquitectura, dividimos el sistema en <i>roles</i> separados.  Cada uno de ellos es responsable de una gama espec√≠fica de tareas.  Una instancia en ejecuci√≥n de una aplicaci√≥n implementa uno o m√°s tipos de roles.  Puede haber varios roles del mismo tipo en un cl√∫ster: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/305/53b/214/30553b214c136611f00c94a8c33621e0.png"></div><br><h2>  Conector </h2><br>  El conector es responsable de la comunicaci√≥n con el mundo exterior;  est√° dise√±ado para aceptar la solicitud, analizarla y, si tiene √©xito, env√≠a los datos para su procesamiento al procesador de entrada.  Se admiten los siguientes formatos: HTTP, SOAP, Kafka, FIX.  La arquitectura nos permite agregar soporte para nuevos formatos (el soporte de IBM MQ estar√° disponible pr√≥ximamente).  Si el an√°lisis de solicitud falla, el conector devuelve un error.  De lo contrario, responde que la solicitud se ha procesado correctamente, incluso si se produjo un error durante el procesamiento posterior.  Esto se hace a prop√≥sito para trabajar con los sistemas que no saben c√≥mo repetir solicitudes, o viceversa, hacerlo de manera demasiado agresiva.  Para asegurarse de que no se pierdan datos, se utiliza la cola de reparaci√≥n: el objeto se une a la cola y se elimina de ella solo despu√©s de un procesamiento exitoso.  El administrador recibe notificaciones sobre los objetos que quedan en la cola de reparaci√≥n y puede volver a intentar el procesamiento despu√©s de manejar un error de software o falla de hardware. <br><br><h3>  Procesador de entrada </h3><br>  El procesador de entrada clasifica los datos recibidos por caracter√≠sticas y llama a los controladores correspondientes.  Los controladores son c√≥digo Lua que se ejecuta en un entorno limitado, por lo que no pueden afectar el funcionamiento del sistema.  En esta etapa, los datos se pueden transformar seg√∫n sea necesario y, si es necesario, se puede ejecutar cualquier cantidad de tareas para implementar la l√≥gica necesaria.  Por ejemplo, al agregar un nuevo usuario en MDM (Master Data Management creado en base a Tarantool Data Grid), se crear√≠a un registro dorado como una tarea separada para que el procesamiento de la solicitud no se ralentice.  El entorno limitado admite solicitudes para leer, cambiar y agregar datos.  Tambi√©n le permite llamar a alguna funci√≥n para todos los roles del tipo de almacenamiento y agregar el resultado (mapear / reducir). <br><br>  Los controladores se pueden describir en archivos: <br><br><pre><code class="lua hljs">sum.lua <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> x, y = <span class="hljs-built_in"><span class="hljs-built_in">unpack</span></span>(...) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x + y</code> </pre> <br>  Luego declarado en la configuraci√≥n: <br><br><pre> <code class="lua hljs">functions: sum: { __file: sum.lua }</code> </pre> <br>  ¬øPor qu√© lua?  Lua es un lenguaje sencillo.  Seg√∫n nuestra experiencia, las personas comienzan a escribir c√≥digo que resolver√≠a su problema solo un par de horas despu√©s de ver el idioma por primera vez.  Y estos no son solo desarrolladores profesionales, sino, por ejemplo, analistas.  Adem√°s, gracias al compilador JIT, Lua es veloz. <br><br><h3>  Almacenamiento </h3><br>  El almacenamiento almacena datos persistentes.  Antes de guardar, los datos se validan para cumplir con el esquema de datos.  Para describir el esquema, utilizamos el formato extendido <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Apache Avro</a> .  Ejemplo: <br><br><pre> <code class="plaintext hljs">{ "name": "User", "type": "record", "logicalType": "Aggregate", "fields": [ { "name": "id", "type": "string" }, { "name": "first_name", "type": "string" }, { "name": "last_name", "type": "string" } ], "indexes": ["id"] }</code> </pre> <br>  En base a esta descripci√≥n, el DDL (Lenguaje de definici√≥n de datos) para el esquema DBMS de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tarantool</a> y el esquema <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GraphQL</a> para el acceso a los datos se generan autom√°ticamente. <br><br>  Se admite la replicaci√≥n asincr√≥nica de datos (tambi√©n planeamos agregar replicaci√≥n s√≠ncrona). <br><br><h3>  Procesador de salida </h3><br>  A veces es necesario notificar a los consumidores externos sobre los nuevos datos.  Es por eso que tenemos el rol de Procesador de salida.  Despu√©s de guardar los datos, podr√≠an transferirse al controlador apropiado (por ejemplo, para transformarlos seg√∫n lo requiera el consumidor) y luego transferirse al conector para su env√≠o.  La cola de reparaci√≥n tambi√©n se usa aqu√≠: si nadie acepta el objeto, el administrador puede intentarlo m√°s tarde. <br><br><h3>  Escalamiento </h3><br>  Las funciones de Conector, Procesador de entrada y Procesador de salida no tienen estado, lo que nos permite escalar el sistema horizontalmente simplemente agregando nuevas instancias de aplicaci√≥n con la funci√≥n habilitada necesaria.  Para el escalado de almacenamiento horizontal, se organiza un cl√∫ster utilizando el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enfoque de</a> cubos virtuales.  Despu√©s de agregar un nuevo servidor, algunos dep√≥sitos de los servidores antiguos se mueven a un nuevo servidor en segundo plano.  Este proceso es transparente para los usuarios y no afecta el funcionamiento de todo el sistema. <br><br><h3>  Propiedades de datos </h3><br>  Los objetos pueden ser enormes y contener otros objetos.  Nos aseguramos de agregar y actualizar datos at√≥micamente y de guardar el objeto con todas las dependencias en un √∫nico dep√≥sito virtual.  Esto se hace para evitar la llamada "mancha" del objeto en varios servidores f√≠sicos. <br><br>  Tambi√©n se admite el control de versiones: cada actualizaci√≥n del objeto crea una nueva versi√≥n, y siempre podemos hacer un intervalo de tiempo para ver c√≥mo se ve√≠a todo en ese momento.  Para los datos que no necesitan un historial largo, podemos limitar el n√∫mero de versiones o incluso almacenar solo la √∫ltima, es decir, podemos desactivar el control de versiones para un tipo de datos espec√≠fico.  Tambi√©n podemos establecer los l√≠mites hist√≥ricos: por ejemplo, eliminar todos los objetos de un tipo espec√≠fico anterior a un a√±o.  El archivado tambi√©n es compatible: podemos cargar objetos por encima de cierta edad para liberar el espacio del cl√∫ster. <br><br><h3>  Tareas </h3><br>  Las caracter√≠sticas interesantes que se deben tener en cuenta incluyen la capacidad de ejecutar tareas a tiempo, a solicitud del usuario o autom√°ticamente desde el sandbox: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6d2/99c/7ea/6d299c7ea95444bb922af6b9606a81c9.png"></div><br>  Aqu√≠ podemos ver otro rol llamado Runner.  Este papel no tiene estado;  si es necesario, se podr√≠an agregar m√°s instancias de aplicaci√≥n con este rol al cl√∫ster.  El corredor es responsable de completar las tareas.  Como ya he mencionado, se pueden crear nuevas tareas desde el sandbox;  se unen a la cola en el almacenamiento y luego se ejecutan en el corredor.  Este tipo de tareas se llama trabajo.  Tambi√©n tenemos un tipo de tarea llamada Tarea, es decir, una tarea definida por el usuario que se ejecutar√° a tiempo (utilizando la sintaxis cron) o bajo demanda.  Para ejecutar y rastrear tales tareas, tenemos un conveniente administrador de tareas.  El rol del planificador debe estar habilitado para usar esta funci√≥n.  Este rol tiene un estado, por lo que no escala lo que no es necesario de todos modos.  Sin embargo, como cualquier otro rol, puede tener una r√©plica que comienza a funcionar si el maestro falla repentinamente. <br><br><h3>  Registrador </h3><br>  Otro rol se llama Logger.  Recopila registros de todos los miembros del cl√∫ster y proporciona una interfaz para cargarlos y verlos a trav√©s de la interfaz web. <br><br><h3>  Servicios </h3><br>  Vale la pena mencionar que el sistema facilita la creaci√≥n de servicios.  En el archivo de configuraci√≥n, puede especificar qu√© solicitudes deben enviarse al controlador escrito por el usuario que se ejecuta en el entorno limitado.  Tal controlador puede, por ejemplo, realizar alg√∫n tipo de solicitud anal√≠tica y devolver el resultado. <br>  El servicio se describe en el archivo de configuraci√≥n: <br><br><pre> <code class="lua hljs">services: sum: doc: <span class="hljs-string"><span class="hljs-string">"adds two numbers"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return_type</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">args</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span></span></code> </pre> <br>  La API GraphQL se genera autom√°ticamente y el servicio est√° disponible para llamadas: <br><br><pre> <code class="lua hljs">query { sum(x: <span class="hljs-number"><span class="hljs-number">1</span></span>, y: <span class="hljs-number"><span class="hljs-number">2</span></span>) }</code> </pre> <br>  Esto llama al controlador de <code>sum</code> que devuelve el resultado: <br><br><pre> <code class="plaintext hljs">3</code> </pre> <br><h3>  Solicitud de perfiles y m√©tricas </h3><br>  Implementamos soporte para el protocolo OpenTracing para lograr una mejor comprensi√≥n de los mecanismos del sistema y solicitar perfiles.  Bajo demanda, el sistema puede enviar informaci√≥n sobre c√≥mo se ejecut√≥ la solicitud a las herramientas que admiten este protocolo (por ejemplo, Zipkin): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b47/84b/ff8/b4784bff86dfccbf05879af28a5c04bd.png"></div><br>  No hace falta decir que el sistema proporciona m√©tricas internas que se pueden recopilar con Prometheus y visualizar con Grafana. <br><br><h3>  Despliegue </h3><br>  Tarantool Data Grid se puede implementar desde paquetes o archivos RPM utilizando la utilidad incorporada o Ansible.  Kubernetes tambi√©n es compatible ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tarantool Kubernetes Operator</a> ). <br><br>  Una aplicaci√≥n que implementa l√≥gica de negocios (configuraci√≥n, controladores) se carga en el cl√∫ster de Tarantool Data Grid implementado en el archivo a trav√©s de la interfaz de usuario o como un script que utiliza la API proporcionada. <br><br><h3>  Aplicaciones de muestra </h3><br>  ¬øQu√© aplicaciones puedes crear con Tarantool Data Grid?  De hecho, la mayor√≠a de las tareas comerciales est√°n relacionadas de alguna manera con el procesamiento, el almacenamiento y el acceso a la secuencia de datos.  Por lo tanto, si tiene grandes flujos de datos que requieren almacenamiento seguro y accesibilidad, entonces nuestro producto podr√≠a ahorrarle mucho tiempo en el desarrollo y ayudarlo a concentrarse en su l√≥gica comercial. <br><br>  Por ejemplo, le gustar√≠a recopilar informaci√≥n sobre el mercado inmobiliario para mantenerse actualizado sobre las mejores ofertas en el futuro.  En este caso, destacamos las siguientes tareas: <br><br><ol><li>  Los robots que recopilan informaci√≥n de fuentes abiertas ser√≠an sus fuentes de datos.  Puede resolver este problema utilizando soluciones preparadas o escribiendo c√≥digo en cualquier idioma. </li><li>  A continuaci√≥n, Tarantool Data Grid acepta y guarda los datos.  Si el formato de datos de varias fuentes es diferente, entonces podr√≠a escribir c√≥digo en Lua que convertir√≠a todo a un solo formato.  En la etapa de preprocesamiento, tambi√©n podr√≠a, por ejemplo, filtrar ofertas recurrentes o actualizar m√°s informaci√≥n de la base de datos sobre agentes que operan en el mercado. </li><li>  Ahora ya tiene una soluci√≥n escalable en el cl√∫ster que podr√≠a rellenarse con datos y usarse para crear muestras de datos.  Luego puede implementar nuevas funciones, por ejemplo, escribir un servicio que crear√≠a una solicitud de datos y devolver√≠a la oferta m√°s ventajosa por d√≠a.  Solo requerir√≠a varias l√≠neas en el archivo de configuraci√≥n y algo de c√≥digo Lua. </li></ol><br><h3>  ¬øQu√© sigue? </h3><br>  Para nosotros, una prioridad es aumentar la conveniencia de desarrollo con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tarantool Data Grid</a> .  (Por ejemplo, este es un IDE con soporte para perfiles y depuradores que funcionan en el sandbox). <br><br>  Tambi√©n prestamos mucha atenci√≥n a los problemas de seguridad.  En este momento, nuestro producto est√° siendo certificado por el FSTEC de Rusia (Servicio Federal de Tecnolog√≠a y Control de Exportaciones) para reconocer el alto nivel de seguridad y cumplir con los requisitos de certificaci√≥n para productos de software utilizados en sistemas de informaci√≥n de datos personales y sistemas de informaci√≥n federal. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/471744/">https://habr.com/ru/post/471744/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../471728/index.html">Avalonia mis pros y contras</a></li>
<li><a href="../471736/index.html">Sensor Ethernet sin contacto</a></li>
<li><a href="../471738/index.html">Una breve historia sobre c√≥mo la conveniencia a veces se dispara en la rodilla</a></li>
<li><a href="../471740/index.html">Servicio de cach√© inteligente basado en ZeroMQ y Tarantool</a></li>
<li><a href="../471742/index.html">Sberbank AI Journey. C√≥mo ense√±amos a una red neuronal a tomar un examen</a></li>
<li><a href="../471746/index.html">Gu√≠a completa para configurar encabezados HTTP para seguridad</a></li>
<li><a href="../471748/index.html">Optimizaci√≥n de farmacia: lo que hicimos con las matem√°ticas</a></li>
<li><a href="../471750/index.html">Gesti√≥n de acceso privilegiado como tarea prioritaria en seguridad de la informaci√≥n (por ejemplo, Fudo PAM)</a></li>
<li><a href="../471756/index.html">C√≥mo se inicia el servidor</a></li>
<li><a href="../471758/index.html">¬øC√≥mo traducir texto a un idioma diferente?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>