<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíë üë®üèª‚Äçüî¨ üò¥ HighLoad ++, Eugene Kuzovlev (EcommPay IT): qu√© hacer cuando un minuto de tiempo de inactividad cuesta $ 100,000 üë®üèæ‚Äçü§ù‚Äçüë®üèΩ üìù üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Todos hablan sobre los procesos de desarrollo y pruebas, capacitaci√≥n del personal, aumento de la motivaci√≥n, pero estos procesos son pocos cuando un ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>HighLoad ++, Eugene Kuzovlev (EcommPay IT): qu√© hacer cuando un minuto de tiempo de inactividad cuesta $ 100,000</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/484908/"> Todos hablan sobre los procesos de desarrollo y pruebas, capacitaci√≥n del personal, aumento de la motivaci√≥n, pero estos procesos son pocos cuando un minuto de inactividad del servicio cuesta dinero en espacio.  ¬øQu√© hacer cuando realiza transacciones financieras bajo un estricto SLA?  ¬øC√≥mo aumentar la confiabilidad y la tolerancia a fallas de sus sistemas, describiendo el desarrollo y las pruebas? <br><br><img src="https://habrastorage.org/webt/dz/-p/tn/dz-ptnygkaqhxsm07hgsfil2fxq.jpeg"><br><br>  La pr√≥xima conferencia HighLoad ++ se llevar√° a cabo los d√≠as 6 y 7 de abril de 2020 en San Petersburgo.  Detalles y entradas <a href="http://bit.ly/2sSxgBx">aqu√≠</a> .  9 de noviembre, 18:00.  HighLoad ++ Mosc√∫ 2018, Delhi + Calcutta Hall.  Res√∫menes y <a href="http://www.highload.ru/moscow/2018/abstracts/4226">presentaci√≥n</a> . <a name="habracut"></a><br><br>  <b>Evgeny Kuzovlev (en lo sucesivo, la CE):</b> - ¬°Amigos, hola!  Mi nombre es Kuzovlev Evgeny.  Soy de EcommPay, una divisi√≥n espec√≠fica es EcommPay IT, una divisi√≥n de TI de un grupo de empresas.  Y hoy hablaremos sobre los tiempos de inactividad: c√≥mo evitarlos, c√≥mo minimizar sus consecuencias, si no puede evitarlos.  El tema es: "¬øQu√© hacer cuando un minuto de tiempo de inactividad cuesta $ 100,000?"  Para nosotros, mirando hacia el futuro, los n√∫meros son comparables. <br><br><h3>  ¬øQu√© hace EcommPay IT? </h3><br>  Quienes somos  ¬øPor qu√© estoy parado frente a ti?  ¬øPor qu√© tengo derecho a decirte algo aqu√≠?  ¬øY de qu√© hablaremos con m√°s detalle aqu√≠? <br><br><img src="https://habrastorage.org/webt/id/bv/so/idbvsod8gah5mhw25b4pnidb8d4.jpeg"><br><br>  EcommPay Group of Companies es una adquirente internacional.  Procesamos pagos en todo el mundo: en Rusia, Europa, en el sudeste asi√°tico (en todo el mundo).  Tenemos 9 oficinas, 500 empleados en total y aproximadamente un poco menos de la mitad de ellos son especialistas en TI.  Todo lo que hacemos, todo lo que ganamos dinero, lo hicimos nosotros mismos. <br><br>  Tenemos todos nuestros productos (y tenemos muchos de ellos; en la l√≠nea de grandes productos de TI tenemos alrededor de 16 componentes diferentes) los escribimos nosotros mismos;  Nos escribimos, nos desarrollamos.  Y en este momento estamos realizando alrededor de un mill√≥n de transacciones por d√≠a (millones, probablemente sea correcto decir eso).  Somos una empresa lo suficientemente joven, solo tenemos unos seis a√±os. <br><br>  Hace 6 a√±os fue una startup cuando los muchachos se unieron al negocio.  Estaban unidos por una idea (no hab√≠a nada m√°s que una idea), y corrimos.  Como cualquier startup, corrimos m√°s r√°pido ... Para nosotros, la velocidad era m√°s importante que la calidad. <br><br>  En alg√∫n momento, nos detuvimos: nos dimos cuenta de que ya no pod√≠amos vivir a esa velocidad y con esa calidad, y ten√≠amos que hacerlo en primer lugar.  En este punto, decidimos escribir una nueva plataforma que sea correcta, escalable y confiable.  Comenzaron a escribir esta plataforma (comenzaron a invertir, desarrollar el desarrollo, probar), pero en alg√∫n momento se dieron cuenta de que el desarrollo y las pruebas no permit√≠an alcanzar un nuevo nivel de calidad de servicio. <br><br>  Hace un nuevo producto, lo pone en producci√≥n, pero a√∫n as√≠, en alg√∫n lugar, algo sale mal.  Y hoy hablaremos sobre c√≥mo alcanzar un nuevo nivel cualitativo (c√≥mo lo obtuvimos, sobre nuestra experiencia), eliminando el desarrollo y las pruebas;  hablaremos sobre lo que est√° disponible para la explotaci√≥n: qu√© puede hacer la explotaci√≥n por s√≠ solo, qu√© puede ofrecer pruebas para afectar la calidad. <br><br><h3>  Tiempos de inactividad.  Los mandamientos de la explotaci√≥n. </h3><br>  Siempre la piedra angular principal, de la que realmente hablaremos hoy es el tiempo de inactividad.  Palabra de miedo  Si tuvimos un tiempo de inactividad, todo es malo para nosotros.  Estamos corriendo para subir, los administradores est√°n reteniendo el servidor - Dios no lo quiera, no se cae, como en esa canci√≥n.  De esto es de lo que hablaremos hoy. <br><br><img src="https://habrastorage.org/webt/7w/nd/t8/7wndt8zz0lal9gvkglnu8zcc-fw.jpeg"><br><br>  Cuando comenzamos a cambiar nuestros enfoques, formamos 4 mandamientos.  Se presentan en mis diapositivas: <br><br>  Estos mandamientos son lo suficientemente simples: <br><br><img src="https://habrastorage.org/webt/kr/vd/zr/krvdzr268yzpyvwaf3_4fgatwrg.jpeg"><br><br><ul><li>  Identifica r√°pidamente el problema. </li><li>  Deshazte de √©l a√∫n m√°s r√°pido. </li><li>  Ayuda a entender la raz√≥n (m√°s tarde, para los desarrolladores). </li><li>  Y estandarizar enfoques. </li></ul><br>  Le llamo la atenci√≥n sobre el punto n√∫mero 2. Eliminamos el problema, pero no lo resolvemos.  Decidir es la segunda vez.  Lo principal para nosotros es que el usuario est√° protegido de este problema.  Existir√° en un determinado entorno aislado, pero este entorno no entrar√° en contacto con √©l.  En realidad, revisaremos estos cuatro grupos de problemas (para algunos con m√°s detalle, para otros con menos detalle), les dir√© lo que usamos, qu√© tipo de experiencia tenemos para resolver. <br><br><h3>  Soluci√≥n de problemas: ¬øcu√°ndo ocurren y qu√© hacer con ellos? </h3><br>  Pero comenzaremos fuera de orden, comenzamos con el punto n√∫mero 2: ¬øc√≥mo deshacerse r√°pidamente del problema?  Hay un problema: tenemos que solucionarlo.  "¬øQu√© haremos con esto?" Es la pregunta principal.  Y cuando comenzamos a pensar en c√≥mo solucionar el problema, desarrollamos algunos requisitos que la resoluci√≥n de problemas deber√≠a seguir. <br><br><img src="https://habrastorage.org/webt/oq/ch/1z/oqch1zstieolkejut_t01rbzokw.jpeg"><br><br>  Para formular estos requisitos, decidimos hacernos la pregunta: "¬øY cu√°ndo tenemos problemas"?  Y los problemas, como se vio despu√©s, se encuentran en cuatro casos: <br><br><img src="https://habrastorage.org/webt/ks/kw/zm/kskwzmylqshsejm96u-bxngu1uq.jpeg"><br><br><ul><li>  Mal funcionamiento del hardware. </li><li>  Fallo de servicios externos. </li><li>  Cambio de versi√≥n de software (la misma implementaci√≥n). </li><li>  Crecimiento explosivo de la carga. </li></ul><br>  No hablaremos de los dos primeros.  Un mal funcionamiento del hardware se resuelve de manera bastante simple: debe tener todo duplicado.  Si se trata de discos, los discos deben ensamblarse en RAID, si es un servidor, el servidor debe estar duplicado, si tiene una infraestructura de red, debe colocar una segunda copia de la infraestructura de red, es decir, tomar y duplicar.  Y si algo te falla, cambias a las capacidades de reserva.  Es dif√≠cil decir m√°s aqu√≠. <br><br>  El segundo es el fracaso de los servicios externos.  Para la mayor√≠a, el sistema no es un problema en absoluto, pero no para nosotros.  Como procesamos los pagos, somos un agregador que se interpone entre el usuario (quien ingresa los datos de su tarjeta) y los bancos, los sistemas de pago ("Visa", "MasterCard", "Mundo" de la misma).  Nuestros servicios externos (sistemas de pago, bancos) tienden a fallar.  Ni nosotros ni usted (si tiene tales servicios) podemos influir en esto. <br><br>  ¬øQu√© hacer entonces?  Hay dos opciones  Primero, si puede, debe duplicar este servicio de alguna manera.  Por ejemplo, si podemos, transferimos el tr√°fico de un servicio a otro: procesamos, por ejemplo, tarjetas a trav√©s de Sberbank, Sberbank tiene problemas; transferimos el tr√°fico [condicionalmente] a Raiffeisen.  La segunda cosa que podemos hacer es notar r√°pidamente la falla de los servicios externos y, por lo tanto, hablaremos sobre la velocidad de reacci√≥n en la siguiente parte del informe. <br><br>  De hecho, de estos cuatro, podemos afectar espec√≠ficamente el cambio de versiones de software, para tomar medidas que conduzcan a una mejora en el contexto de las implementaciones y en el contexto del crecimiento explosivo de la carga.  En realidad lo hicimos.  Aqu√≠, de nuevo, un peque√±o comentario ... <br><br>  De estos cuatro problemas, varios se resuelven de inmediato si tiene una nube.  Si est√° en las nubes Microsoft Azhur, Ozone, use nuestras nubes, desde Yandex o Mail, entonces al menos un mal funcionamiento del hardware se convierte en su problema y todo se vuelve inmediatamente bueno en el contexto de un mal funcionamiento del hardware. <br><br>  Somos una peque√±a empresa no est√°ndar.  Aqu√≠ todos hablan de Kubernets, de nubes: no tenemos Kubernets ni nubes.  Pero tenemos bastidores con hierro en muchos centros de datos, y nos vemos obligados a vivir con este hierro, nos vemos obligados a responder por todo.  Por lo tanto, en este contexto hablaremos.  Entonces, sobre los problemas.  Los dos primeros est√°n fuera de par√©ntesis. <br><br><h3>  Cambiar la versi√≥n del software.  Bases </h3><br>  Nuestros desarrolladores no tienen acceso a la producci√≥n.  Por qu√©  Pero simplemente estamos certificados por PCI DSS, y nuestros desarrolladores simplemente no tienen derecho a subir al "producto".  Eso es, punto.  Absolutamente  Por lo tanto, la responsabilidad de desarrollo finaliza exactamente en el momento en que el desarrollo pas√≥ la compilaci√≥n a la versi√≥n. <br><br><img src="https://habrastorage.org/webt/ze/bp/su/zebpsueilk7pvkhrsqwn-0nrfko.jpeg"><br><br>  Nuestra segunda base, que tenemos, que tambi√©n nos ayuda mucho, es la falta de conocimiento √∫nico e indocumentado.  Espero que hagas lo mismo.  Porque si esto no es as√≠, entonces tendr√°s problemas.  Surgir√°n problemas cuando este conocimiento √∫nico e indocumentado no est√© presente en el momento correcto en el lugar correcto.  Suponga que tiene una persona que sabe c√≥mo implementar un componente espec√≠fico: no hay persona, est√° de vacaciones o se enferm√≥, eso es todo, tiene problemas. <br><br>  Y la tercera base a la que hemos llegado.  Llegamos a √©l a trav√©s del dolor, la sangre, las l√°grimas: llegamos a la conclusi√≥n de que cualquiera de nuestros componentes contiene errores, incluso si no tiene errores.  Decidimos esto por nosotros mismos: cuando implementamos algo, cuando colocamos algo en el producto, tenemos una compilaci√≥n con errores.  Hemos formado los requisitos que nuestro sistema debe satisfacer. <br><br><h3>  Requisitos de cambio de versi√≥n de software </h3><br>  Hay tres de estos requisitos: <br><br><img src="https://habrastorage.org/webt/ou/qm/ma/ouqmmajckkplivqpqoiuwsvs3hs.jpeg"><br><br><ul><li>  Debemos revertir r√°pidamente la implementaci√≥n. </li><li>  Debemos minimizar el impacto de una implementaci√≥n fallida. </li><li>  Y debemos ser capaces de quedarnos atascados r√°pidamente en paralelo. <br>  En ese orden!  Por qu√©  Porque, antes que nada, al implementar la nueva versi√≥n, la velocidad no es importante, pero es importante para usted, si algo sali√≥ mal, retroceda r√°pidamente y tenga un impacto m√≠nimo.  Pero si tiene un conjunto de versiones en la producci√≥n, para lo cual result√≥ que hay un error (como nieve en su cabeza, no hubo despliegue, pero el error est√° contenido): la velocidad del despliegue posterior es importante para usted.  ¬øQu√© hemos hecho para cumplir con estos requisitos?  Recurrimos a dicha metodolog√≠a: <br><br><img src="https://habrastorage.org/webt/bx/xn/9h/bxxn9hd10bckeqbycqanabweery.jpeg"><br><br>  Es bien sabido, no hemos inventado ni una sola vez: esta es una implementaci√≥n Azul / Verde.  Que es esto  Debe tener una copia para cada grupo de servidores en el que est√°n instaladas sus aplicaciones.  La copia es "c√°lida": no hay tr√°fico, pero en cualquier momento este tr√°fico puede enviarse a esta copia.  Esta copia contiene la versi√≥n anterior.  Y en el momento de la implementaci√≥n, implementa el c√≥digo en una copia inactiva.  Luego cambie parte del tr√°fico (o todo) a la nueva versi√≥n.  Por lo tanto, para cambiar el flujo de tr√°fico de la versi√≥n anterior a la nueva, solo necesita realizar una acci√≥n: debe cambiar el equilibrador en el flujo ascendente, cambiar la direcci√≥n, de un flujo ascendente a otro.  Esto es muy conveniente y resuelve el problema de cambio r√°pido, retroceso r√°pido. <br><br>  Aqu√≠, la soluci√≥n a la segunda pregunta es la minimizaci√≥n: puede colocar una nueva l√≠nea, en una l√≠nea con un nuevo c√≥digo, solo una parte de su tr√°fico (por ejemplo, 2%).  Y estos 2%, ¬°no son 100%!  Si ha perdido el 100% del tr√°fico durante una implementaci√≥n fallida, esto da miedo, si ha perdido el 2% del tr√°fico, esto es desagradable, pero no da miedo.  Adem√°s, es muy probable que los usuarios ni siquiera lo noten, porque en algunos casos (no todos) el mismo usuario, al presionar F5, lo llevar√°n a otra versi√≥n que funcione. <br><br><h3>  Despliegue azul / verde.  Enrutamiento </h3><br>  Adem√°s, no todo es tan simple "Blue / Green Deploy" ... Todos nuestros componentes se pueden dividir en tres grupos: <br><br><ul><li>  Esta es la interfaz (p√°ginas de pago que ven nuestros clientes); </li><li>  n√∫cleo de procesamiento; </li><li>  un adaptador para trabajar con sistemas de pago (bancos, MasterCard, Visa ...). </li></ul><br>  Y hay un matiz: el matiz es la ruta entre las l√≠neas.  Si simplemente cambia el 100% del tr√°fico, no tiene estos problemas.  Pero si desea cambiar el 2%, las preguntas comienzan: "¬øC√≥mo hacer esto?" Lo m√°s simple en la frente: puede seleccionar al azar Round Robin en nginx, y le queda un 2%, 98% - a la derecha.  Pero esto no siempre es adecuado. <br><br>  Aqu√≠, por ejemplo, el usuario interact√∫a con el sistema en m√°s de una solicitud.  Esto es normal: 2, 3, 4, 5 consultas: sus sistemas pueden ser los mismos.  Y si es importante para usted que todas las solicitudes de los usuarios lleguen a la misma l√≠nea a la que lleg√≥ la primera solicitud, o (segundo momento) todas las solicitudes de los usuarios llegan a una nueva l√≠nea despu√©s del cambio (podr√≠a comenzar a trabajar antes con el sistema, antes de cambiar), entonces esta distribuci√≥n aleatoria no te conviene.  Luego est√°n las siguientes opciones: <br><br><img src="https://habrastorage.org/webt/hs/3f/fq/hs3ffqgbcy8wu3lzopom58r6tlm.jpeg"><br><br>  La primera opci√≥n, la m√°s f√°cil, basada en los par√°metros b√°sicos del cliente (IP Hash).  Tiene una IP y la comparte de derecha a izquierda por IP.  Luego, el segundo caso descrito por m√≠ funcionar√° para usted cuando haya una implementaci√≥n, el usuario ya podr√≠a comenzar a trabajar con su sistema y, desde el momento de la implementaci√≥n, todas las solicitudes ir√°n a una nueva l√≠nea (a la misma, por ejemplo). <br><br>  Si por alguna raz√≥n esto no le conviene y necesita enviar solicitudes a la l√≠nea donde lleg√≥ la solicitud principal e √≠ntima del usuario, entonces tiene dos opciones ... <br>  La primera opci√≥n: puede tomar nginx + pagado.  Existe un mecanismo de sesiones permanentes, que, a solicitud inicial del usuario, expone una sesi√≥n al usuario y la vincula a un flujo ascendente particular.  Todas las solicitudes de usuario posteriores dentro de la vida √∫til de la sesi√≥n ir√°n a la misma cadena ascendente donde se configur√≥ la sesi√≥n. <br><br>  Esto no nos conven√≠a, porque ya ten√≠amos nginx normal.  Cambiar nginx + no es que sea costoso, solo fue un poco doloroso para nosotros y no muy correcto.  Por ejemplo, "Sticks Sessions" no funcion√≥ para nosotros por la simple raz√≥n de que "Sticks Sessions" no brinda la oportunidad de realizar rutas en base a "Eli-or".  All√≠ puede especificar lo que hacemos "Sesiones fijas", por ejemplo, por IP o por IP y por cookie o por par√°metro de publicaci√≥n, pero "Eli-or" ya es m√°s complicado all√≠. <br><br>  Por lo tanto, llegamos a la cuarta opci√≥n.  Tomamos nginx en "esteroides" (esto es openresty), este es el mismo nginx que adem√°s admite la inclusi√≥n de los √∫ltimos scripts.  Puede escribir un √∫ltimo script, deslizar este "abrir", y este √∫ltimo script se ejecutar√° cuando llegue una solicitud del usuario. <br><br>  Y de hecho, escribimos un gui√≥n de este tipo, nos pusimos "abiertos" y en este gui√≥n clasificamos 6 par√°metros diferentes para la concatenaci√≥n de "O".  Dependiendo de la disponibilidad de este o aquel par√°metro, sabemos que el usuario lleg√≥ a una p√°gina u otra, a una l√≠nea u otra. <br><br><h3>  Despliegue azul / verde.  Ventajas y desventajas. </h3><br>  Por supuesto, probablemente podr√≠amos hacerlo un poco m√°s f√°cil (use las mismas "Sesiones fijas"), pero a√∫n tenemos un matiz tal que no solo el usuario interact√∫a con nosotros en el marco de un procesamiento de una transacci√≥n ... Pero los sistemas de pago tambi√©n interact√∫an con nosotros: nosotros, despu√©s de procesar la transacci√≥n (enviando una solicitud al sistema de pago), recibimos una devoluci√≥n de llamada. <br>  Y supongamos que si dentro de nuestro circuito podemos omitir la direcci√≥n IP del usuario en todas las solicitudes y separar a los usuarios en funci√≥n de la direcci√≥n IP, entonces no diremos la misma "Visa": "Dudes, somos una empresa tan retro, somos un poco internacionales (en el sitio y en De Rusia) ... Y por favor, denos un vistazo a la direcci√≥n IP del usuario en un campo adicional, ¬°su protocolo est√° estandarizado!  Negocio claro, no estar√°n de acuerdo. <br><br><img src="https://habrastorage.org/webt/he/5o/-w/he5o-wivis5fucv4e7_1wn1qz3y.jpeg"><br><br>  Por lo tanto, para nosotros no encajaba, hicimos openresty.  En consecuencia, con el enrutamiento tenemos as√≠: <br><br>  El Blue / Green Deploy tiene, respectivamente, las ventajas de las que habl√© y las desventajas. <br><br>  Desventaja dos: <br><br><ul><li>  necesita molestarse con el enrutamiento; </li><li>  La segunda desventaja principal es el costo. </li></ul><br>  Necesita el doble de servidores, necesita el doble de recursos operativos, debe invertir el doble de esfuerzo para mantener todo este zool√≥gico. <br><br>  Por cierto, entre las ventajas hay otra cosa que no he mencionado antes: tiene una reserva en caso de un aumento en la carga.  Si tiene un aumento explosivo en la carga, una gran cantidad de usuarios se han derramado sobre usted, entonces simplemente incluye la segunda l√≠nea en la distribuci√≥n de 50 a 50, e inmediatamente tiene 2 servidores en su cl√∫ster hasta que resuelva el problema de tener servidores todav√≠a. <br><br><h3>  ¬øC√≥mo hacer un despliegue r√°pido? </h3><br>  Hablamos sobre c√≥mo resolver el problema de la minimizaci√≥n y la reversi√≥n r√°pida, pero la pregunta sigue siendo: "¬øC√≥mo implementar r√°pidamente?" <br><br><img src="https://habrastorage.org/webt/vy/8l/xo/vy8lxokper6luvftog4okdvgbh4.jpeg"><br><br>  Aqu√≠ es breve y simple. <br><br><ul><li>  Debe tener un sistema de CD (Entrega continua), sin √©l, en ninguna parte.  Si tiene un servidor, puede quedarse atascado con plumas.  Tenemos alrededor de mil quinientos servidores y 1.500 manijas, por supuesto, podemos plantar un departamento del tama√±o de esta sala, solo para implementar. </li><li>  La implementaci√≥n debe ser paralela.  Si tiene una implementaci√≥n consistente, entonces todo est√° mal.  Un servidor es normal, implementar√° mil quinientos servidores todo el d√≠a. </li><li>  Nuevamente, para acelerar, esto ya no es necesario, probablemente.  Cuando desploey suelen construir el proyecto.  ¬øTiene un proyecto web, hay una parte de front-end (crea un paquete web all√≠, npm recopila algo as√≠), y este proceso es b√°sicamente de corta duraci√≥n: 5 minutos, pero estos 5 minutos pueden ser cr√≠ticos.  Por lo tanto, por ejemplo, no hacemos esto: eliminamos estos 5 minutos, desplegamos artefactos. <br><br>  ¬øQu√© es un artefacto?  Un artefacto es una construcci√≥n ensamblada en la que toda la parte del ensamblaje ya se ha completado.  Almacenamos este artefacto en el almacenamiento de artefactos.  Usamos dos de estos almacenamientos al mismo tiempo: era Nexus y ahora jFrog Artifactory). Inicialmente utilizamos el Nexus porque comenzamos a practicar este enfoque en aplicaciones Java (se adaptaba bien).  Luego ponen all√≠ la parte de las aplicaciones escritas por PHP;  y el Nexus ya no era adecuado, y por lo tanto elegimos jFrog Artefactory, que puede producir casi todo.  Incluso llegamos al hecho de que en este almacenamiento de artefactos almacenamos nuestros propios paquetes binarios, que recopilamos para los servidores. </li></ul><br><h3>  Crecimiento explosivo de la carga </h3><br>  Hablamos sobre cambiar la versi√≥n del software.  Lo siguiente que tenemos es un crecimiento explosivo de la carga.  Aqu√≠ probablemente entiendo que el crecimiento explosivo de la carga no es lo correcto ... <br><br>  Escribimos un nuevo sistema: est√° orientado al servicio, a la moda hermosa, a todos los trabajadores, a todas las colas, a toda la asincron√≠a.  Y en tales sistemas, los datos pueden ir en flujo diferente.  Para la primera transacci√≥n, el 1 ¬∞, 3 ¬∞, 10 ¬∞ trabajador puede participar, para la segunda transacci√≥n: 2 ¬∞, 4 ¬∞, 5 ¬∞.  Y hoy, digamos, en la ma√±ana tiene un flujo de datos que usa los primeros tres trabajadores, y en la noche cambia dram√°ticamente, y todo usa a los otros tres trabajadores. <br><br>  Y aqu√≠ resulta que necesita escalar de alguna manera a los trabajadores, necesita escalar de alguna manera sus servicios, pero al mismo tiempo evitar la inflaci√≥n de los recursos. <br><br><img src="https://habrastorage.org/webt/wg/1t/kr/wg1tkrnswlv954eaws3dj1ije_a.jpeg"><br><br>  Hemos determinado los requisitos para nosotros mismos.    :    Service discovery,  ‚Äì       ,    ‚Äì   .  ,      ,    .   ¬´¬ª,   ¬´¬ª,    . <br><br>     ?    .       70  .      ¬´¬ª,  ¬´¬ª ,  ,        .    100   ¬´¬ª,        100     .         .  ,    ‚Äì  24/7   ,      ,    ,  70   ,  . <br><br>     ¬´¬ª,     IP     Scale-Nomad ‚Äì ScaleNo,    :                 .  ,  : ¬´  ?¬ª     ‚Äì  ,   . <br><br>        ,       ,  ,     ,    ,       ‚Äì  , .     3-5  ‚Äì   . <br><br><img src="https://habrastorage.org/webt/8z/ja/m0/8zjam0uickgtjt67yl6grtzfmao.jpeg"><br><br>  Como funciona  !  :       :   ,  ‚Äì   ,   ‚Äì  ,  ‚Äì  . <br><br>  ,     .         45  ‚Äì     .       2         ,     (    ‚Äì ,   ).     ‚Äì    ,  5-10 ,    . <br><br>     ¬´¬ª,      ,  ¬´¬ª      .  ,    ,    ‚Äì       .     .    ‚Ññ 2 ‚Äì ¬´    ¬ª. <br><br><h3> .    ? </h3><br>    ‚Äì ¬´   ?¬ª !      .      ? <br><br><img src="https://habrastorage.org/webt/md/xm/op/mdxmopdox-kznqvid9b4uesleeg.jpeg"><br><br>  ! <br><br><ul><li>           . </li><li>       ,   ,     . </li><li>   ‚Äì   .      ,     ,   -  . </li></ul><br>  , ,     .   .  ,    .    ¬´ ¬ª.       : <br><br><img src="https://habrastorage.org/webt/8w/1z/w4/8w1zw4dq1rwsz7e7dg7tp53wbke.jpeg"><br><br>   ¬´¬ª    ¬´¬ª,     . ¬´¬ª     . ¬´¬ª  ¬´¬ª      ,      ,   ‚Äì  ¬´¬ª  ¬´¬ª,  ‚Äì ¬´¬ª  ¬´¬ª  Telegraf. <br><br>      New Relic.  ,   .     ,    .       1,5  ,    , : ¬´     ¬ª.    ,  ,     .    ¬´-¬ª ,    15     ¬´-¬ª.    . <br><br>    ,     ‚Äì  Debugger.     ¬´¬ª,       ,  ,    ¬´¬ª.  Que es esto  ,     15-30    ,  ¬´ ¬ª ,      . <br><br> ,    ( ) ‚Äì      ,    .   ,    ¬´¬ª ‚Äì ,   ¬´¬ª .       ‚Äì     ,  ,  ,     . <br><br><h3>     ? </h3><br>     ?     ? <br><br><img src="https://habrastorage.org/webt/8c/qe/tn/8cqetn3kfyedayuv9fwc8qpx4vq.jpeg"><br><br><ul><li> Response time / RPS   ‚Äì   .   ,    -  . </li><li>      . </li><li>  . </li><li>   . </li></ul><br>   ‚Äì ¬´¬ª, ¬´¬ª .       ,    - ,      .     ‚Äì   (        ).    -    5-10-15  ‚Äì ,     (  ). <br><br>      ‚Äì     : <br><br><img src="https://habrastorage.org/webt/73/xa/jg/73xajgyfx9xahrr_9hl3ysaapgw.jpeg"><br><br>    ‚Äì 6 ,     ‚Äì       .    ‚Äì RPS, RTS.  ‚Äì    ¬´¬ª.   ¬´¬ª     ,  -       ‚Ä¶      ,    . <br><br> ,      ‚Äì       .    OpenTracing ‚Äì , , ,     ;    .  OpenTracing-   ,       .     ,       , .  ,      ,   . <br><br><img src="https://habrastorage.org/webt/42/nw/5h/42nw5hrsai8-i8t3bnsclajtklw.jpeg"><br><br>   ,         3  ‚Äì    .     ,   ,    20-30 . <br><br>     ,   ‚Äì   . <br><br>  ,  ,     ,        ,   .   ,    . <br><br><img src="https://habrastorage.org/webt/d8/pz/1v/d8pz1vfzv9otccv6dsa-crqiuuu.jpeg"><br><br>      ? ,  :     (,  ¬´¬ª);   , .         ,   ,  ‚Ä¶      ‚Äì        -.   ,   : ¬´        ¬ª? <br><br>   ‚Ä¶       -,   ( )    ,      .    :       ‚Äì ,      ,     ( ).    ,    -        .     !      .         . <br><br>      ,    . <br><br><h3>     </h3><br>   ,    ‚Äì   ,    ,  ,     ,      ,    -   . ,   ,   . <br><br><img src="https://habrastorage.org/webt/e2/kb/jz/e2kbjzy9w7wvv6kicbniocak4ac.jpeg"><br><br>      (  ‚Äì ),       ELK Stack ‚Äì    .  -, ,   ELK,      ,       ELK.    . <br><br><img src="https://habrastorage.org/webt/_f/8a/3i/_f8a3ibc2i7os5pp3xot6m9_gxo.jpeg"><br><br>   .  ,    ,  ,     ,   ¬´¬ª,   id-       ( ).        .  Por qu√©    ,      ,      .      ,     ‚Äì   OpenTracing,    . <br><br>     ,      ,      ‚Äì  ¬´¬ª (Zipkin)  ¬´¬ª (Jaeger). ¬´¬ª ‚Äì      ,   ¬´¬ª.  ¬´¬ª  ,  ,     ,      ,   .  ¬´¬ª  . <br><br>   ¬´¬ª:   ,    Api ( Api  PHP   , ,    ‚Äì   ,    ),     . ¬´¬ª, ‚Äì  ,    .    ?     : <br><br><img src="https://habrastorage.org/webt/uq/x2/mu/uqx2muumblbudpbjnuittfrsdkk.jpeg"><br><br>  ¬´¬ª     span'.  ,    ,           (1-2-3 ‚Äì      ,   ).      ,        . ,          Error.     Error    ,      .    ,    span: <br><br><img src="https://habrastorage.org/webt/3e/is/fk/3eisfkpsc9mkuipyg-5iaob2d-y.jpeg"><br><br>     .       ,       ,   .        :    ‚Äì  ,   ,            . <br><br> ,    .    ,    .      ,      ¬´¬ª   PHP ‚Äì   , welcome to use,  : <br><br><img src="https://habrastorage.org/webt/q7/vi/pc/q7vipcgfujbggn_zt64r3h7foay.jpeg"><br><br>     ‚Äì     OpenTracing Api,   php-extention,          .      .     ,   .   :     ,    extention up to you. <br><br><h3>   </h3><br>    .   ‚Äì   .   ?    : <br><br><img src="https://habrastorage.org/webt/3h/ka/zo/3hkazonrypgjcuakfff1yrutxlc.jpeg"><br><br>    ¬´¬ª?        , !  ¬´¬ª       ,    ,        ,      .     ? <br><br><img src="https://habrastorage.org/webt/b7/h6/qa/b7h6qavqwtn9fm9bam0jbg07nym.jpeg"><br><br><ul><li>     .      ,  .    60   ,        .     , ,         ‚Äì ,   . </li><li>    .          ,     ,        RnD-.       ,      (,    ) ,    ,   . </li><li>     ,   ‚Äì ,     .       . </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tenemos tolerancias </font><font style="vertical-align: inherit;">Por ejemplo, no consideramos el tiempo de inactividad si perdimos el 2% del tr√°fico en dos minutos. </font><font style="vertical-align: inherit;">Esto, en principio, no entra en nuestras estad√≠sticas. </font><font style="vertical-align: inherit;">Si m√°s en porcentaje o tiempo, ya contamos.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y siempre escribimos post-mortem. </font><font style="vertical-align: inherit;">Pase lo que pase con nosotros, cualquier situaci√≥n en la que se haya comportado de manera inapropiada en el sitio de producci√≥n se reflejar√° en el potsortem. </font><font style="vertical-align: inherit;">Un post-mortem es un documento en el que escribe lo que le sucedi√≥, el tiempo detallado de lo que hizo para solucionarlo y (¬°esto es un bloqueo obligatorio!) Lo que har√° para evitar que esto suceda en el futuro. </font><font style="vertical-align: inherit;">Esto es necesario, necesario para su posterior an√°lisis.</font></font></li></ul><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬øQu√© considerar el tiempo de inactividad? </font></font></h3><br><img src="https://habrastorage.org/webt/ad/8v/ye/ad8vyesevuqquvkj4rtf15hggd8.jpeg"><br><br>  ¬øA qu√© condujo todo esto? <br><br>  Esto llev√≥ al hecho de que (tuvimos ciertos problemas de estabilidad, esto no nos conven√≠a ni a los clientes ni a nosotros) en los √∫ltimos 6 meses, nuestro indicador de estabilidad ascendi√≥ a 99,97.  Podemos decir que esto no es mucho.  S√≠, tenemos algo por lo que luchar.  Aproximadamente la mitad de este indicador es la estabilidad, por as√≠ decirlo, no la nuestra, sino nuestro firewall de aplicaciones web, que est√° delante de nosotros y se utiliza como un servicio, pero no es importante para los clientes. <br><br>  Aprendimos a dormir por la noche.  Por fin!  Hace seis meses, no sab√≠amos c√≥mo.  Y en esta nota con los resultados, quiero hacer un comentario.  Anoche hubo un maravilloso informe sobre el sistema de control de un reactor nuclear.  Si las personas que escribieron este sistema me escuchan, olv√≠date de lo que dije sobre "2% no es tiempo de inactividad".  Para usted, el 2% es tiempo de inactividad, ¬°aunque sea por dos minutos! <br><br>  Eso es todo!  Sus preguntas <br><br><img src="https://habrastorage.org/webt/us/ih/xg/usihxgshbsygnv59b5detm4js5m.jpeg"><br><br><h3>  Sobre balanceadores y migraci√≥n de bases de datos </h3><br>  Pregunta de la audiencia (en adelante - B): - Buenas tardes.  ¬°Muchas gracias por tal informe de administrador!  La pregunta es breve sobre el tema de sus equilibradores.  Mencion√≥ que tiene WAF, es decir, seg√∫n tengo entendido, usa alg√∫n tipo de equilibrador externo ... <br><br>  <b>:</b> - No, utilizamos nuestros servicios como equilibradores.  En este caso, WAF es para nosotros √∫nicamente una herramienta de protecci√≥n DDoS. <br><br>  <b>P:</b> - ¬øPodr√≠a decir algunas palabras sobre balanceadores? <br><br>  <b>EK:</b> - Como dije, este es un grupo de servidores en openresty.  Ahora tenemos 5 grupos de redundantes que responden exclusivamente ... es decir, un servidor en el que se encuentra exclusivamente openresty, solo representa el tr√°fico.  En consecuencia, para comprender cu√°nto tenemos: ahora tenemos un flujo de tr√°fico regular, esto es varios cientos de megabits.  Se las arreglan, se sienten bien, ni siquiera se esfuerzan. <br><br>  <b>P:</b> - Tambi√©n una pregunta simple.  Hay una implementaci√≥n azul / verde.  ¬øY qu√© haces, por ejemplo, con las migraciones desde la base de datos? <br><br>  <b>EK:</b> - ¬°Buena pregunta!  Mire, nosotros en el despliegue Azul / Verde tenemos l√≠neas separadas para cada l√≠nea.  Es decir, si estamos hablando de las l√≠neas de eventos que se transmiten del trabajador al trabajador, hay l√≠neas separadas para la l√≠nea azul y la l√≠nea verde.  Si hablamos de la base de datos en s√≠, entonces la redujimos deliberadamente, como pudimos, poniendo todo casi en l√≠nea, solo tenemos una pila de transacciones en la base de datos.  Y tenemos una sola pila de transacciones para todas las l√≠neas.  Con una base de datos en este contexto: no la compartimos con azul y verde, porque ambas versiones del c√≥digo deben saber qu√© est√° pasando con la transacci√≥n. <br><br>  Amigos, todav√≠a tengo un premio tan peque√±o para incentivarlos: un libro.  Y necesito darle la mejor pregunta. <br><br>  <b>P:</b> Hola.  Gracias por el informe  La pregunta es esta.  Supervisas los pagos, supervisas los servicios con los que te comunicas ... Pero, ¬øc√≥mo supervisas para que una persona de alguna manera acuda a tu p√°gina de pagos, realice un pago y el proyecto le acredite dinero?  Es decir, ¬øc√≥mo monitorea que marchant est√° disponible y acepta su devoluci√≥n de llamada? <br><br>  <b>:</b> - "Comerciante" para nosotros en este caso es exactamente el mismo servicio externo que el sistema de pago.  Monitoreamos la velocidad de respuesta del "comerciante". <br><br><h3>  Sobre el cifrado de la base de datos </h3><br>  <b>P:</b> Hola.  Tengo una peque√±a pregunta.  Tiene datos confidenciales de PCI DSS.  ¬øQuer√≠a saber c√≥mo se almacenan los PAN en las colas en las que deben ingresar?  ¬øUsas alg√∫n cifrado?  Y a partir de aqu√≠ surge la segunda segunda pregunta: en PCI DSS, es necesario volver a cifrar la base de datos peri√≥dicamente en caso de cambios (despido de administradores, etc.): ¬øc√≥mo sucede esto con la accesibilidad? <br><br><img src="https://habrastorage.org/webt/0z/oh/29/0zoh293lif-ioxouzt79ui9j98a.jpeg"><br><br>  <b>EK: ¬°</b> Maravillosa pregunta!  En primer lugar, no almacenamos PAN en las colas.  No tenemos derecho a almacenar PAN en ning√∫n lugar claro, en principio, por lo tanto, utilizamos un servicio especial (lo llamamos "Kademon"): este es un servicio que solo hace una cosa: recibe un mensaje y env√≠a un mensaje cifrado.  Y almacenamos todo con este mensaje cifrado.  En consecuencia, la longitud de la clave para nosotros es inferior a kilobytes, por lo que es directa, seria y confiable. <br><br>  <b>P:</b> - ¬øNecesita 2 kilobytes ahora? <br><br>  <b>EK:</b> - Parece que ayer fueron 256 ... Bueno, ¬ød√≥nde m√°s? <br><br>  En consecuencia, este es el primero.  Y en segundo lugar, la soluci√≥n que existe, es compatible con el proceso de reencriptaci√≥n: hay dos pares de "tortas" (claves) que dan "cubiertas" que encriptan (las claves son claves, dek son derivados de claves que encriptan).  Y en el caso del inicio del procedimiento (se lleva a cabo regularmente, de 3 meses a ¬± algunos), cargamos un nuevo par de "pasteles" y tenemos los datos reencriptados.  Tenemos servicios separados que eliminan todos los datos, los cifran de una manera nueva;  los datos se almacenan al lado del identificador de clave con el que se cifran.  En consecuencia, tan pronto como los datos se cifren con nuevas claves, eliminamos la clave anterior. <br><br><h3>  A veces necesitas hacer pagos manualmente ... </h3><br>  <b>P:</b> - Es decir, si se produce un retorno para alguna operaci√≥n, ¬ødescifrarlo con la clave anterior? <br><br>  <b>CE:</b> S√≠. <br><br>  <b>P:</b> - Entonces una peque√±a pregunta m√°s.  Cuando hay alg√∫n tipo de falla, ca√≠da, incidente, es necesario empujar la transacci√≥n en modo manual.  Existe tal situaci√≥n. <br><br>  <b>EK:</b> S√≠, lo hace. <br><br>  <b>P:</b> - ¬øDe d√≥nde sacas estos datos?  ¬øO t√∫ mismo vas con bol√≠grafos a esta tienda? <br><br>  <b>EK:</b> - No, bueno, por supuesto, tenemos alg√∫n tipo de sistema de back-office que contiene una interfaz para nuestro soporte.  Si no sabemos en qu√© estado se encuentra la transacci√≥n (por ejemplo, mientras el sistema de pago no respondi√≥ con un tiempo de espera), no sabemos a priori, es decir, asignamos el estado final solo con plena confianza.  En este caso, volcamos la transacci√≥n en un estado especial para el procesamiento manual.  Por la ma√±ana, al d√≠a siguiente, tan pronto como el soporte recibe informaci√≥n de que tales transacciones permanecen en el sistema de pago, las procesan manualmente en esta interfaz. <br><br><img src="https://habrastorage.org/webt/um/1e/qe/um1eqefsegdtcvv8gczvx2qe54o.jpeg"><br><br>  <b>P:</b> - Tengo un par de preguntas.  Una de ellas es la continuaci√≥n de la zona PCI DSS: ¬øc√≥mo se obtienen sus registros de bucle?  Tal pregunta porque el desarrollador podr√≠a poner cualquier cosa en los registros.  Segunda pregunta: ¬øc√≥mo se implementan las revisiones?  Los bol√≠grafos en la base de datos son una opci√≥n, pero puede haber correcciones r√°pidas gratuitas: ¬øcu√°l es el procedimiento all√≠?  Y la tercera pregunta probablemente est√© relacionada con RTO, RPO.  Su disponibilidad era de 99.97, casi cuatro nueves, pero seg√∫n tengo entendido, tiene un segundo centro de datos, un tercer centro de datos y un quinto centro de datos ... ¬øC√≥mo maneja su sincronizaci√≥n, replicaci√≥n, todo lo dem√°s? <br><br>  <b>EK:</b> - Comencemos por el primero.  La primera pregunta sobre los registros fue?  Cuando escribimos registros, tenemos una capa que enmascara todos los datos confidenciales.  Ella mira la m√°scara y los campos adicionales.  En consecuencia, nuestros registros salen con datos ya enmascarados y un bucle PCI DSS.  Esta es una de las tareas regulares asignadas al departamento de pruebas.  Est√°n obligados a verificar todas las tareas, incluidos los registros que escriben, y esta es una de las tareas habituales en la revisi√≥n del c√≥digo, para controlar que el desarrollador no haya escrito algo.  El departamento de seguridad de la informaci√≥n lleva a cabo una verificaci√≥n posterior de esto una vez por semana: los registros se toman de forma selectiva para el √∫ltimo d√≠a y se ejecutan a trav√©s de un esc√°ner-analizador especial desde los servidores de prueba para verificar todo esto. <br>  Sobre arreglos calientes.  Esto est√° incluido en nuestro cronograma de implementaci√≥n.  Tenemos un art√≠culo separado sobre las revisiones.  Creemos que implementamos revisiones todo el d√≠a cuando lo necesitamos.  Tan pronto como se haya ensamblado la versi√≥n, tan pronto como se ejecute, tan pronto como tengamos el artefacto, contactaremos al administrador del sistema para que lo llame y lo implementar√° en el momento que sea necesario. <br><br>  Sobre los "cuatro nueves".  El n√∫mero que tenemos ahora, realmente se logr√≥, y lo buscamos en otro centro de datos.  Ahora tenemos un segundo centro de datos, y estamos comenzando a enrutarlos, y la cuesti√≥n del centro de replicaci√≥n de datos cruzados es realmente una pregunta no trivial.  Intentamos resolverlo a su debido tiempo por diferentes medios: tratamos de usar la misma "Tar√°ntula", no funcion√≥ para nosotros, lo digo de inmediato.  Por lo tanto, llegamos al hecho de que hacemos el orden de "sensaci√≥n" manualmente.  De hecho, tenemos todas las aplicaciones en el modo asincr√≥nico de las unidades necesarias de sincronizaci√≥n "cambio hecho" entre centros de datos. <br><br>  <b>P:</b> - Si tienes una segunda, ¬øpor qu√© no una tercera?  Porque nadie tiene cerebro dividido todav√≠a ... <br><br>  <b>:</b> - Y no tenemos un cerebro dividido.  Debido al hecho de que cada aplicaci√≥n maneja un multimaestro, no nos importa a qu√© centro lleg√≥ la solicitud.  Estamos listos para el hecho de que, en el caso de que un centro de datos se bloquee (estamos recostados) y en medio de la solicitud de un usuario cambiado a un segundo centro de datos, realmente estamos listos para perder a este usuario;  pero ser√°n unidades, unidades absolutas. <br><br>  <b>P:</b> - Buenas tardes.  Gracias por el informe  Usted habl√≥ sobre su depurador, que impulsa algunas transacciones de prueba en producci√≥n.  ¬°Pero cu√©ntanos sobre las transacciones de prueba!  ¬øQu√© tan profundo va? <br><br>  <b>EC:</b> - Pasa por el ciclo completo de todo el componente.  No hay diferencias entre la transacci√≥n de prueba y la de combate para el componente.  Y desde el punto de vista de la l√≥gica, este es solo un proyecto separado en el sistema, en el que solo se persiguen las transacciones de prueba. <br><br>  <b>P:</b> - ¬øY d√≥nde lo cortas?  Entonces Core envi√≥ ... <br><br>  <b>:</b> - Estamos detr√°s de "Kor" en este caso para transacciones de prueba ... Tenemos algo as√≠ como enrutamiento: "Kor" sabe a qu√© sistema de pago enviar - enviamos a un sistema de pago falso, que simplemente da una respuesta http y eso es todo . <br><br>  <b>P:</b> - Por favor, d√≠game, ¬øten√≠a la aplicaci√≥n escrita en un gran monolito o la recort√≥ en algunos servicios o incluso en microservicios? <br><br>  <b>:</b> - No tenemos un monolito, por supuesto, tenemos una aplicaci√≥n orientada a servicios.  Tenemos una broma de que tenemos un servicio de monolitos: son realmente bastante grandes.  Al llamar a microservicios, este lenguaje no se aparta de la palabra, pero estos son los servicios dentro de los cuales trabajan los trabajadores de m√°quinas distribuidas. <br><br><h3>  Si el servicio en el servidor se ve comprometido ... </h3><br>  <b>P:</b> - Entonces tengo la siguiente pregunta.  Incluso si fuera un monolito, a√∫n dijiste que tienes muchos de estos servidores instant√°neos, todos procesan los datos en principio, y la pregunta es: ‚ÄúSi uno de los servidores instant√°neos o la aplicaci√≥n, cualquier enlace en particular est√° comprometido ¬øTienen alg√∫n tipo de control de acceso?  ¬øCu√°l de ellos puede hacer qu√©?  ¬øA qui√©n contactar, para qu√© datos? <br><br><img src="https://habrastorage.org/webt/3j/qn/pt/3jqnpt1dfzhas9kn5de1qb6x1lq.jpeg"><br><br>  <b>EK:</b> S√≠, por supuesto.  Los requisitos de seguridad son bastante serios.  En primer lugar, tenemos tr√°fico de datos abierto, y los puertos son solo aquellos en los que anticipamos el tr√°fico por adelantado.  Si el componente se comunica con la base de datos (por ejemplo, "Muskul") en 5-4-3-2, solo se abrir√°n 5-4-3-2 y otros puertos, otras direcciones de tr√°fico no estar√°n disponibles.  Adem√°s, debemos entender que en producci√≥n tenemos unos 10 bucles de seguridad diferentes.  E incluso si la aplicaci√≥n se vio comprometida de alguna manera, Dios no lo quiera, un atacante no podr√° acceder a la consola de administraci√≥n del servidor, porque esta es otra zona de seguridad de la red. <br><br>  <b>P:</b> - Y en este contexto, estoy m√°s interesado en el momento en que tiene algunos contratos con los servicios: qu√© pueden hacer, a trav√©s de qu√© "acciones" pueden contactarse entre s√≠ ... Y en el flujo normal, algunos servicios espec√≠ficos preguntan qu√© una serie, una lista de "acci√≥n" en otra.  No parecen recurrir a otros en una situaci√≥n normal, y tienen otras √°reas de responsabilidad.  Si uno de ellos se ve comprometido, ¬øpodr√° tirar de la "acci√≥n" de ese servicio? .. <br><br>  <b>EK:</b> - Entiendo.  Si en una situaci√≥n normal con otro servidor generalmente se permit√≠a la comunicaci√≥n, entonces s√≠.  Seg√∫n el contrato de SLA, no controlamos que solo se le permitan las primeras 3 "acciones", y no se le permiten 4 "acciones".  Probablemente esto sea redundante para nosotros, porque tenemos un sistema de protecci√≥n de 4 niveles, en principio, para circuitos.  Preferimos defender con contornos en lugar de a nivel de los interiores. <br><br><h3>  C√≥mo funcionan Visa, MasterCard y Sberbank </h3><br>  <b>P:</b> - Quiero aclarar un momento acerca de cambiar a un usuario de un centro de datos a otro.  Hasta donde yo s√©, "Visa" y "MasterCard" funcionan en el protocolo s√≠ncrono binario 8583, hay mezclas.  Y quer√≠a saber, ahora me refiero a cambiar: ¬øes directamente "Visa" y "MasterCard" o a los sistemas de pago, a los procesamientos? <br><br>  <b>EK:</b> - Depende de las mezclas.  Mezclas que tenemos en un centro de datos. <br><br>  <b>P:</b> - En t√©rminos generales, ¬øtiene un punto de conexi√≥n? <br><br>  <b>:</b> - "Vise" y "MasterCard" - s√≠.  Solo porque "Visa" y "MasterCard" requieren inversiones bastante serias en infraestructura para celebrar contratos separados para recibir un segundo par de mezclas, por ejemplo.  Est√°n reservados dentro del marco de un centro de datos, pero si Dios no lo permite, el centro de datos donde las mezclas para conectarse a "Visa" y "MasterCard" est√°n muertas, entonces tendremos una conexi√≥n con "Visa" y "MasterCard" perdido ... <br><br>  <b>P:</b> - ¬øC√≥mo se pueden reservar?  ¬°S√© que "Visa" solo permite mantener una conexi√≥n en principio! <br><br>  <b>EK:</b> - Ellos mismos suministran equipos.  En cualquier caso, recibimos equipos que son internamente redundantes. <br><br>  <b>P:</b> - Es decir, ¬øel rack de su Connects Orange? .. <br><br>  <b>CE:</b> S√≠. <br><br>  <b>P:</b> - Pero como en este caso: si su centro de datos desaparece, ¬ødeber√≠a usarlo m√°s?  ¬øO solo se trata de detener el tr√°fico? <br><br>  <b>CE:</b> - No.  En este caso, simplemente cambiamos el tr√°fico a otro canal, que, por supuesto, ser√° m√°s costoso para nosotros, m√°s costoso para los clientes.  Pero el tr√°fico no pasar√° a trav√©s de nuestra conexi√≥n directa con la "Visa", "MasterCard", sino a trav√©s del "Sberbank" convencional (muy exagerado). <br><br>  Lamento much√≠simo si lastimo a los empleados de Sberbank.  Pero seg√∫n nuestras estad√≠sticas, Sberbank est√° cayendo con mayor frecuencia de los bancos rusos.  En menos de un mes, algo no se ha ca√≠do en Sberbank. <br><br><img src="https://habrastorage.org/webt/u2/pm/rp/u2pmrpkbplsfx65dstp-lsstwcw.jpeg"><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/6YB1kMnzyRs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3>  Un poco de publicidad :) </h3><br>  Gracias por quedarte con nosotros.  ¬øTe gustan nuestros art√≠culos?  ¬øQuieres ver m√°s materiales interesantes?  Ap√≥yenos haciendo un pedido o recomendando a sus amigos <a href="https://ua-hosting.company/cloudvps/nl">VPS basado en la nube para desarrolladores desde $ 4.99</a> , un <b>an√°logo √∫nico de servidores de nivel b√°sico que inventamos para usted:</b> <a href="https://habr.com/company/ua-hosting/blog/347386/">toda la verdad sobre VPS (KVM) E5-2697 v3 (6 n√∫cleos) 10GB DDR4 480GB SSD 1Gbps desde $ 19 o c√≥mo dividir el servidor?</a>  (las opciones est√°n disponibles con RAID1 y RAID10, hasta 24 n√∫cleos y hasta 40GB DDR4). <br><br>  <b>Dell R730xd 2 veces m√°s barato en el centro de datos Equinix Tier IV en Amsterdam?</b>  ¬°Solo tenemos <b><a href="https://ua-hosting.company/serversnl">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV desde $ 199</a> en los Pa√≠ses Bajos!</b>  <b><b>Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - ¬°desde $ 99!</b></b>  Lea sobre <a href="https://habr.com/company/ua-hosting/blog/329618/">C√≥mo construir un edificio de infraestructura.</a>  <a href="https://habr.com/company/ua-hosting/blog/329618/">clase utilizando servidores Dell R730xd E5-2650 v4 que cuestan 9,000 euros por un centavo?</a> </li></ul></div></div><p>Source: <a href="https://habr.com/ru/post/484908/">https://habr.com/ru/post/484908/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../484898/index.html">Buen motivo para probar sus dependencias: edici√≥n AGPL</a></li>
<li><a href="../484900/index.html">Representaci√≥n del sitio web 101</a></li>
<li><a href="../484902/index.html">En ecuaciones de grados superiores</a></li>
<li><a href="../484904/index.html">Un a√±o sin Splunk: c√≥mo una empresa estadounidense cambi√≥ el mercado de an√°lisis de datos de m√°quinas en Rusia y a qui√©n dej√≥ atr√°s</a></li>
<li><a href="../484906/index.html">Equipo distribuido y l√≠der de equipo en remoto</a></li>
<li><a href="../484910/index.html">Paul Graham: enemigos</a></li>
<li><a href="../484918/index.html">Anotaci√≥n incremental en proceso para acelerar las construcciones de gradle</a></li>
<li><a href="../484920/index.html">¬øC√≥mo entender que usted es un operador de fresadoras?</a></li>
<li><a href="../484930/index.html">Codifiquemos r√°pidamente como profesionales</a></li>
<li><a href="../484932/index.html">La naturaleza dual de los requisitos de software.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>