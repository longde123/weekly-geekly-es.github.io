<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’‘ ğŸ‘¨ğŸ»â€ğŸ”¬ ğŸ˜´ HighLoad ++, Eugene Kuzovlev (EcommPay IT): quÃ© hacer cuando un minuto de tiempo de inactividad cuesta $ 100,000 ğŸ‘¨ğŸ¾â€ğŸ¤â€ğŸ‘¨ğŸ½ ğŸ“ ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Todos hablan sobre los procesos de desarrollo y pruebas, capacitaciÃ³n del personal, aumento de la motivaciÃ³n, pero estos procesos son pocos cuando un ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>HighLoad ++, Eugene Kuzovlev (EcommPay IT): quÃ© hacer cuando un minuto de tiempo de inactividad cuesta $ 100,000</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/484908/"> Todos hablan sobre los procesos de desarrollo y pruebas, capacitaciÃ³n del personal, aumento de la motivaciÃ³n, pero estos procesos son pocos cuando un minuto de inactividad del servicio cuesta dinero en espacio.  Â¿QuÃ© hacer cuando realiza transacciones financieras bajo un estricto SLA?  Â¿CÃ³mo aumentar la confiabilidad y la tolerancia a fallas de sus sistemas, describiendo el desarrollo y las pruebas? <br><br><img src="https://habrastorage.org/webt/dz/-p/tn/dz-ptnygkaqhxsm07hgsfil2fxq.jpeg"><br><br>  La prÃ³xima conferencia HighLoad ++ se llevarÃ¡ a cabo los dÃ­as 6 y 7 de abril de 2020 en San Petersburgo.  Detalles y entradas <a href="http://bit.ly/2sSxgBx">aquÃ­</a> .  9 de noviembre, 18:00.  HighLoad ++ MoscÃº 2018, Delhi + Calcutta Hall.  ResÃºmenes y <a href="http://www.highload.ru/moscow/2018/abstracts/4226">presentaciÃ³n</a> . <a name="habracut"></a><br><br>  <b>Evgeny Kuzovlev (en lo sucesivo, la CE):</b> - Â¡Amigos, hola!  Mi nombre es Kuzovlev Evgeny.  Soy de EcommPay, una divisiÃ³n especÃ­fica es EcommPay IT, una divisiÃ³n de TI de un grupo de empresas.  Y hoy hablaremos sobre los tiempos de inactividad: cÃ³mo evitarlos, cÃ³mo minimizar sus consecuencias, si no puede evitarlos.  El tema es: "Â¿QuÃ© hacer cuando un minuto de tiempo de inactividad cuesta $ 100,000?"  Para nosotros, mirando hacia el futuro, los nÃºmeros son comparables. <br><br><h3>  Â¿QuÃ© hace EcommPay IT? </h3><br>  Quienes somos  Â¿Por quÃ© estoy parado frente a ti?  Â¿Por quÃ© tengo derecho a decirte algo aquÃ­?  Â¿Y de quÃ© hablaremos con mÃ¡s detalle aquÃ­? <br><br><img src="https://habrastorage.org/webt/id/bv/so/idbvsod8gah5mhw25b4pnidb8d4.jpeg"><br><br>  EcommPay Group of Companies es una adquirente internacional.  Procesamos pagos en todo el mundo: en Rusia, Europa, en el sudeste asiÃ¡tico (en todo el mundo).  Tenemos 9 oficinas, 500 empleados en total y aproximadamente un poco menos de la mitad de ellos son especialistas en TI.  Todo lo que hacemos, todo lo que ganamos dinero, lo hicimos nosotros mismos. <br><br>  Tenemos todos nuestros productos (y tenemos muchos de ellos; en la lÃ­nea de grandes productos de TI tenemos alrededor de 16 componentes diferentes) los escribimos nosotros mismos;  Nos escribimos, nos desarrollamos.  Y en este momento estamos realizando alrededor de un millÃ³n de transacciones por dÃ­a (millones, probablemente sea correcto decir eso).  Somos una empresa lo suficientemente joven, solo tenemos unos seis aÃ±os. <br><br>  Hace 6 aÃ±os fue una startup cuando los muchachos se unieron al negocio.  Estaban unidos por una idea (no habÃ­a nada mÃ¡s que una idea), y corrimos.  Como cualquier startup, corrimos mÃ¡s rÃ¡pido ... Para nosotros, la velocidad era mÃ¡s importante que la calidad. <br><br>  En algÃºn momento, nos detuvimos: nos dimos cuenta de que ya no podÃ­amos vivir a esa velocidad y con esa calidad, y tenÃ­amos que hacerlo en primer lugar.  En este punto, decidimos escribir una nueva plataforma que sea correcta, escalable y confiable.  Comenzaron a escribir esta plataforma (comenzaron a invertir, desarrollar el desarrollo, probar), pero en algÃºn momento se dieron cuenta de que el desarrollo y las pruebas no permitÃ­an alcanzar un nuevo nivel de calidad de servicio. <br><br>  Hace un nuevo producto, lo pone en producciÃ³n, pero aÃºn asÃ­, en algÃºn lugar, algo sale mal.  Y hoy hablaremos sobre cÃ³mo alcanzar un nuevo nivel cualitativo (cÃ³mo lo obtuvimos, sobre nuestra experiencia), eliminando el desarrollo y las pruebas;  hablaremos sobre lo que estÃ¡ disponible para la explotaciÃ³n: quÃ© puede hacer la explotaciÃ³n por sÃ­ solo, quÃ© puede ofrecer pruebas para afectar la calidad. <br><br><h3>  Tiempos de inactividad.  Los mandamientos de la explotaciÃ³n. </h3><br>  Siempre la piedra angular principal, de la que realmente hablaremos hoy es el tiempo de inactividad.  Palabra de miedo  Si tuvimos un tiempo de inactividad, todo es malo para nosotros.  Estamos corriendo para subir, los administradores estÃ¡n reteniendo el servidor - Dios no lo quiera, no se cae, como en esa canciÃ³n.  De esto es de lo que hablaremos hoy. <br><br><img src="https://habrastorage.org/webt/7w/nd/t8/7wndt8zz0lal9gvkglnu8zcc-fw.jpeg"><br><br>  Cuando comenzamos a cambiar nuestros enfoques, formamos 4 mandamientos.  Se presentan en mis diapositivas: <br><br>  Estos mandamientos son lo suficientemente simples: <br><br><img src="https://habrastorage.org/webt/kr/vd/zr/krvdzr268yzpyvwaf3_4fgatwrg.jpeg"><br><br><ul><li>  Identifica rÃ¡pidamente el problema. </li><li>  Deshazte de Ã©l aÃºn mÃ¡s rÃ¡pido. </li><li>  Ayuda a entender la razÃ³n (mÃ¡s tarde, para los desarrolladores). </li><li>  Y estandarizar enfoques. </li></ul><br>  Le llamo la atenciÃ³n sobre el punto nÃºmero 2. Eliminamos el problema, pero no lo resolvemos.  Decidir es la segunda vez.  Lo principal para nosotros es que el usuario estÃ¡ protegido de este problema.  ExistirÃ¡ en un determinado entorno aislado, pero este entorno no entrarÃ¡ en contacto con Ã©l.  En realidad, revisaremos estos cuatro grupos de problemas (para algunos con mÃ¡s detalle, para otros con menos detalle), les dirÃ© lo que usamos, quÃ© tipo de experiencia tenemos para resolver. <br><br><h3>  SoluciÃ³n de problemas: Â¿cuÃ¡ndo ocurren y quÃ© hacer con ellos? </h3><br>  Pero comenzaremos fuera de orden, comenzamos con el punto nÃºmero 2: Â¿cÃ³mo deshacerse rÃ¡pidamente del problema?  Hay un problema: tenemos que solucionarlo.  "Â¿QuÃ© haremos con esto?" Es la pregunta principal.  Y cuando comenzamos a pensar en cÃ³mo solucionar el problema, desarrollamos algunos requisitos que la resoluciÃ³n de problemas deberÃ­a seguir. <br><br><img src="https://habrastorage.org/webt/oq/ch/1z/oqch1zstieolkejut_t01rbzokw.jpeg"><br><br>  Para formular estos requisitos, decidimos hacernos la pregunta: "Â¿Y cuÃ¡ndo tenemos problemas"?  Y los problemas, como se vio despuÃ©s, se encuentran en cuatro casos: <br><br><img src="https://habrastorage.org/webt/ks/kw/zm/kskwzmylqshsejm96u-bxngu1uq.jpeg"><br><br><ul><li>  Mal funcionamiento del hardware. </li><li>  Fallo de servicios externos. </li><li>  Cambio de versiÃ³n de software (la misma implementaciÃ³n). </li><li>  Crecimiento explosivo de la carga. </li></ul><br>  No hablaremos de los dos primeros.  Un mal funcionamiento del hardware se resuelve de manera bastante simple: debe tener todo duplicado.  Si se trata de discos, los discos deben ensamblarse en RAID, si es un servidor, el servidor debe estar duplicado, si tiene una infraestructura de red, debe colocar una segunda copia de la infraestructura de red, es decir, tomar y duplicar.  Y si algo te falla, cambias a las capacidades de reserva.  Es difÃ­cil decir mÃ¡s aquÃ­. <br><br>  El segundo es el fracaso de los servicios externos.  Para la mayorÃ­a, el sistema no es un problema en absoluto, pero no para nosotros.  Como procesamos los pagos, somos un agregador que se interpone entre el usuario (quien ingresa los datos de su tarjeta) y los bancos, los sistemas de pago ("Visa", "MasterCard", "Mundo" de la misma).  Nuestros servicios externos (sistemas de pago, bancos) tienden a fallar.  Ni nosotros ni usted (si tiene tales servicios) podemos influir en esto. <br><br>  Â¿QuÃ© hacer entonces?  Hay dos opciones  Primero, si puede, debe duplicar este servicio de alguna manera.  Por ejemplo, si podemos, transferimos el trÃ¡fico de un servicio a otro: procesamos, por ejemplo, tarjetas a travÃ©s de Sberbank, Sberbank tiene problemas; transferimos el trÃ¡fico [condicionalmente] a Raiffeisen.  La segunda cosa que podemos hacer es notar rÃ¡pidamente la falla de los servicios externos y, por lo tanto, hablaremos sobre la velocidad de reacciÃ³n en la siguiente parte del informe. <br><br>  De hecho, de estos cuatro, podemos afectar especÃ­ficamente el cambio de versiones de software, para tomar medidas que conduzcan a una mejora en el contexto de las implementaciones y en el contexto del crecimiento explosivo de la carga.  En realidad lo hicimos.  AquÃ­, de nuevo, un pequeÃ±o comentario ... <br><br>  De estos cuatro problemas, varios se resuelven de inmediato si tiene una nube.  Si estÃ¡ en las nubes Microsoft Azhur, Ozone, use nuestras nubes, desde Yandex o Mail, entonces al menos un mal funcionamiento del hardware se convierte en su problema y todo se vuelve inmediatamente bueno en el contexto de un mal funcionamiento del hardware. <br><br>  Somos una pequeÃ±a empresa no estÃ¡ndar.  AquÃ­ todos hablan de Kubernets, de nubes: no tenemos Kubernets ni nubes.  Pero tenemos bastidores con hierro en muchos centros de datos, y nos vemos obligados a vivir con este hierro, nos vemos obligados a responder por todo.  Por lo tanto, en este contexto hablaremos.  Entonces, sobre los problemas.  Los dos primeros estÃ¡n fuera de parÃ©ntesis. <br><br><h3>  Cambiar la versiÃ³n del software.  Bases </h3><br>  Nuestros desarrolladores no tienen acceso a la producciÃ³n.  Por quÃ©  Pero simplemente estamos certificados por PCI DSS, y nuestros desarrolladores simplemente no tienen derecho a subir al "producto".  Eso es, punto.  Absolutamente  Por lo tanto, la responsabilidad de desarrollo finaliza exactamente en el momento en que el desarrollo pasÃ³ la compilaciÃ³n a la versiÃ³n. <br><br><img src="https://habrastorage.org/webt/ze/bp/su/zebpsueilk7pvkhrsqwn-0nrfko.jpeg"><br><br>  Nuestra segunda base, que tenemos, que tambiÃ©n nos ayuda mucho, es la falta de conocimiento Ãºnico e indocumentado.  Espero que hagas lo mismo.  Porque si esto no es asÃ­, entonces tendrÃ¡s problemas.  SurgirÃ¡n problemas cuando este conocimiento Ãºnico e indocumentado no estÃ© presente en el momento correcto en el lugar correcto.  Suponga que tiene una persona que sabe cÃ³mo implementar un componente especÃ­fico: no hay persona, estÃ¡ de vacaciones o se enfermÃ³, eso es todo, tiene problemas. <br><br>  Y la tercera base a la que hemos llegado.  Llegamos a Ã©l a travÃ©s del dolor, la sangre, las lÃ¡grimas: llegamos a la conclusiÃ³n de que cualquiera de nuestros componentes contiene errores, incluso si no tiene errores.  Decidimos esto por nosotros mismos: cuando implementamos algo, cuando colocamos algo en el producto, tenemos una compilaciÃ³n con errores.  Hemos formado los requisitos que nuestro sistema debe satisfacer. <br><br><h3>  Requisitos de cambio de versiÃ³n de software </h3><br>  Hay tres de estos requisitos: <br><br><img src="https://habrastorage.org/webt/ou/qm/ma/ouqmmajckkplivqpqoiuwsvs3hs.jpeg"><br><br><ul><li>  Debemos revertir rÃ¡pidamente la implementaciÃ³n. </li><li>  Debemos minimizar el impacto de una implementaciÃ³n fallida. </li><li>  Y debemos ser capaces de quedarnos atascados rÃ¡pidamente en paralelo. <br>  En ese orden!  Por quÃ©  Porque, antes que nada, al implementar la nueva versiÃ³n, la velocidad no es importante, pero es importante para usted, si algo saliÃ³ mal, retroceda rÃ¡pidamente y tenga un impacto mÃ­nimo.  Pero si tiene un conjunto de versiones en la producciÃ³n, para lo cual resultÃ³ que hay un error (como nieve en su cabeza, no hubo despliegue, pero el error estÃ¡ contenido): la velocidad del despliegue posterior es importante para usted.  Â¿QuÃ© hemos hecho para cumplir con estos requisitos?  Recurrimos a dicha metodologÃ­a: <br><br><img src="https://habrastorage.org/webt/bx/xn/9h/bxxn9hd10bckeqbycqanabweery.jpeg"><br><br>  Es bien sabido, no hemos inventado ni una sola vez: esta es una implementaciÃ³n Azul / Verde.  Que es esto  Debe tener una copia para cada grupo de servidores en el que estÃ¡n instaladas sus aplicaciones.  La copia es "cÃ¡lida": no hay trÃ¡fico, pero en cualquier momento este trÃ¡fico puede enviarse a esta copia.  Esta copia contiene la versiÃ³n anterior.  Y en el momento de la implementaciÃ³n, implementa el cÃ³digo en una copia inactiva.  Luego cambie parte del trÃ¡fico (o todo) a la nueva versiÃ³n.  Por lo tanto, para cambiar el flujo de trÃ¡fico de la versiÃ³n anterior a la nueva, solo necesita realizar una acciÃ³n: debe cambiar el equilibrador en el flujo ascendente, cambiar la direcciÃ³n, de un flujo ascendente a otro.  Esto es muy conveniente y resuelve el problema de cambio rÃ¡pido, retroceso rÃ¡pido. <br><br>  AquÃ­, la soluciÃ³n a la segunda pregunta es la minimizaciÃ³n: puede colocar una nueva lÃ­nea, en una lÃ­nea con un nuevo cÃ³digo, solo una parte de su trÃ¡fico (por ejemplo, 2%).  Y estos 2%, Â¡no son 100%!  Si ha perdido el 100% del trÃ¡fico durante una implementaciÃ³n fallida, esto da miedo, si ha perdido el 2% del trÃ¡fico, esto es desagradable, pero no da miedo.  AdemÃ¡s, es muy probable que los usuarios ni siquiera lo noten, porque en algunos casos (no todos) el mismo usuario, al presionar F5, lo llevarÃ¡n a otra versiÃ³n que funcione. <br><br><h3>  Despliegue azul / verde.  Enrutamiento </h3><br>  AdemÃ¡s, no todo es tan simple "Blue / Green Deploy" ... Todos nuestros componentes se pueden dividir en tres grupos: <br><br><ul><li>  Esta es la interfaz (pÃ¡ginas de pago que ven nuestros clientes); </li><li>  nÃºcleo de procesamiento; </li><li>  un adaptador para trabajar con sistemas de pago (bancos, MasterCard, Visa ...). </li></ul><br>  Y hay un matiz: el matiz es la ruta entre las lÃ­neas.  Si simplemente cambia el 100% del trÃ¡fico, no tiene estos problemas.  Pero si desea cambiar el 2%, las preguntas comienzan: "Â¿CÃ³mo hacer esto?" Lo mÃ¡s simple en la frente: puede seleccionar al azar Round Robin en nginx, y le queda un 2%, 98% - a la derecha.  Pero esto no siempre es adecuado. <br><br>  AquÃ­, por ejemplo, el usuario interactÃºa con el sistema en mÃ¡s de una solicitud.  Esto es normal: 2, 3, 4, 5 consultas: sus sistemas pueden ser los mismos.  Y si es importante para usted que todas las solicitudes de los usuarios lleguen a la misma lÃ­nea a la que llegÃ³ la primera solicitud, o (segundo momento) todas las solicitudes de los usuarios llegan a una nueva lÃ­nea despuÃ©s del cambio (podrÃ­a comenzar a trabajar antes con el sistema, antes de cambiar), entonces esta distribuciÃ³n aleatoria no te conviene.  Luego estÃ¡n las siguientes opciones: <br><br><img src="https://habrastorage.org/webt/hs/3f/fq/hs3ffqgbcy8wu3lzopom58r6tlm.jpeg"><br><br>  La primera opciÃ³n, la mÃ¡s fÃ¡cil, basada en los parÃ¡metros bÃ¡sicos del cliente (IP Hash).  Tiene una IP y la comparte de derecha a izquierda por IP.  Luego, el segundo caso descrito por mÃ­ funcionarÃ¡ para usted cuando haya una implementaciÃ³n, el usuario ya podrÃ­a comenzar a trabajar con su sistema y, desde el momento de la implementaciÃ³n, todas las solicitudes irÃ¡n a una nueva lÃ­nea (a la misma, por ejemplo). <br><br>  Si por alguna razÃ³n esto no le conviene y necesita enviar solicitudes a la lÃ­nea donde llegÃ³ la solicitud principal e Ã­ntima del usuario, entonces tiene dos opciones ... <br>  La primera opciÃ³n: puede tomar nginx + pagado.  Existe un mecanismo de sesiones permanentes, que, a solicitud inicial del usuario, expone una sesiÃ³n al usuario y la vincula a un flujo ascendente particular.  Todas las solicitudes de usuario posteriores dentro de la vida Ãºtil de la sesiÃ³n irÃ¡n a la misma cadena ascendente donde se configurÃ³ la sesiÃ³n. <br><br>  Esto no nos convenÃ­a, porque ya tenÃ­amos nginx normal.  Cambiar nginx + no es que sea costoso, solo fue un poco doloroso para nosotros y no muy correcto.  Por ejemplo, "Sticks Sessions" no funcionÃ³ para nosotros por la simple razÃ³n de que "Sticks Sessions" no brinda la oportunidad de realizar rutas en base a "Eli-or".  AllÃ­ puede especificar lo que hacemos "Sesiones fijas", por ejemplo, por IP o por IP y por cookie o por parÃ¡metro de publicaciÃ³n, pero "Eli-or" ya es mÃ¡s complicado allÃ­. <br><br>  Por lo tanto, llegamos a la cuarta opciÃ³n.  Tomamos nginx en "esteroides" (esto es openresty), este es el mismo nginx que ademÃ¡s admite la inclusiÃ³n de los Ãºltimos scripts.  Puede escribir un Ãºltimo script, deslizar este "abrir", y este Ãºltimo script se ejecutarÃ¡ cuando llegue una solicitud del usuario. <br><br>  Y de hecho, escribimos un guiÃ³n de este tipo, nos pusimos "abiertos" y en este guiÃ³n clasificamos 6 parÃ¡metros diferentes para la concatenaciÃ³n de "O".  Dependiendo de la disponibilidad de este o aquel parÃ¡metro, sabemos que el usuario llegÃ³ a una pÃ¡gina u otra, a una lÃ­nea u otra. <br><br><h3>  Despliegue azul / verde.  Ventajas y desventajas. </h3><br>  Por supuesto, probablemente podrÃ­amos hacerlo un poco mÃ¡s fÃ¡cil (use las mismas "Sesiones fijas"), pero aÃºn tenemos un matiz tal que no solo el usuario interactÃºa con nosotros en el marco de un procesamiento de una transacciÃ³n ... Pero los sistemas de pago tambiÃ©n interactÃºan con nosotros: nosotros, despuÃ©s de procesar la transacciÃ³n (enviando una solicitud al sistema de pago), recibimos una devoluciÃ³n de llamada. <br>  Y supongamos que si dentro de nuestro circuito podemos omitir la direcciÃ³n IP del usuario en todas las solicitudes y separar a los usuarios en funciÃ³n de la direcciÃ³n IP, entonces no diremos la misma "Visa": "Dudes, somos una empresa tan retro, somos un poco internacionales (en el sitio y en De Rusia) ... Y por favor, denos un vistazo a la direcciÃ³n IP del usuario en un campo adicional, Â¡su protocolo estÃ¡ estandarizado!  Negocio claro, no estarÃ¡n de acuerdo. <br><br><img src="https://habrastorage.org/webt/he/5o/-w/he5o-wivis5fucv4e7_1wn1qz3y.jpeg"><br><br>  Por lo tanto, para nosotros no encajaba, hicimos openresty.  En consecuencia, con el enrutamiento tenemos asÃ­: <br><br>  El Blue / Green Deploy tiene, respectivamente, las ventajas de las que hablÃ© y las desventajas. <br><br>  Desventaja dos: <br><br><ul><li>  necesita molestarse con el enrutamiento; </li><li>  La segunda desventaja principal es el costo. </li></ul><br>  Necesita el doble de servidores, necesita el doble de recursos operativos, debe invertir el doble de esfuerzo para mantener todo este zoolÃ³gico. <br><br>  Por cierto, entre las ventajas hay otra cosa que no he mencionado antes: tiene una reserva en caso de un aumento en la carga.  Si tiene un aumento explosivo en la carga, una gran cantidad de usuarios se han derramado sobre usted, entonces simplemente incluye la segunda lÃ­nea en la distribuciÃ³n de 50 a 50, e inmediatamente tiene 2 servidores en su clÃºster hasta que resuelva el problema de tener servidores todavÃ­a. <br><br><h3>  Â¿CÃ³mo hacer un despliegue rÃ¡pido? </h3><br>  Hablamos sobre cÃ³mo resolver el problema de la minimizaciÃ³n y la reversiÃ³n rÃ¡pida, pero la pregunta sigue siendo: "Â¿CÃ³mo implementar rÃ¡pidamente?" <br><br><img src="https://habrastorage.org/webt/vy/8l/xo/vy8lxokper6luvftog4okdvgbh4.jpeg"><br><br>  AquÃ­ es breve y simple. <br><br><ul><li>  Debe tener un sistema de CD (Entrega continua), sin Ã©l, en ninguna parte.  Si tiene un servidor, puede quedarse atascado con plumas.  Tenemos alrededor de mil quinientos servidores y 1.500 manijas, por supuesto, podemos plantar un departamento del tamaÃ±o de esta sala, solo para implementar. </li><li>  La implementaciÃ³n debe ser paralela.  Si tiene una implementaciÃ³n consistente, entonces todo estÃ¡ mal.  Un servidor es normal, implementarÃ¡ mil quinientos servidores todo el dÃ­a. </li><li>  Nuevamente, para acelerar, esto ya no es necesario, probablemente.  Cuando desploey suelen construir el proyecto.  Â¿Tiene un proyecto web, hay una parte de front-end (crea un paquete web allÃ­, npm recopila algo asÃ­), y este proceso es bÃ¡sicamente de corta duraciÃ³n: 5 minutos, pero estos 5 minutos pueden ser crÃ­ticos.  Por lo tanto, por ejemplo, no hacemos esto: eliminamos estos 5 minutos, desplegamos artefactos. <br><br>  Â¿QuÃ© es un artefacto?  Un artefacto es una construcciÃ³n ensamblada en la que toda la parte del ensamblaje ya se ha completado.  Almacenamos este artefacto en el almacenamiento de artefactos.  Usamos dos de estos almacenamientos al mismo tiempo: era Nexus y ahora jFrog Artifactory). Inicialmente utilizamos el Nexus porque comenzamos a practicar este enfoque en aplicaciones Java (se adaptaba bien).  Luego ponen allÃ­ la parte de las aplicaciones escritas por PHP;  y el Nexus ya no era adecuado, y por lo tanto elegimos jFrog Artefactory, que puede producir casi todo.  Incluso llegamos al hecho de que en este almacenamiento de artefactos almacenamos nuestros propios paquetes binarios, que recopilamos para los servidores. </li></ul><br><h3>  Crecimiento explosivo de la carga </h3><br>  Hablamos sobre cambiar la versiÃ³n del software.  Lo siguiente que tenemos es un crecimiento explosivo de la carga.  AquÃ­ probablemente entiendo que el crecimiento explosivo de la carga no es lo correcto ... <br><br>  Escribimos un nuevo sistema: estÃ¡ orientado al servicio, a la moda hermosa, a todos los trabajadores, a todas las colas, a toda la asincronÃ­a.  Y en tales sistemas, los datos pueden ir en flujo diferente.  Para la primera transacciÃ³n, el 1 Â°, 3 Â°, 10 Â° trabajador puede participar, para la segunda transacciÃ³n: 2 Â°, 4 Â°, 5 Â°.  Y hoy, digamos, en la maÃ±ana tiene un flujo de datos que usa los primeros tres trabajadores, y en la noche cambia dramÃ¡ticamente, y todo usa a los otros tres trabajadores. <br><br>  Y aquÃ­ resulta que necesita escalar de alguna manera a los trabajadores, necesita escalar de alguna manera sus servicios, pero al mismo tiempo evitar la inflaciÃ³n de los recursos. <br><br><img src="https://habrastorage.org/webt/wg/1t/kr/wg1tkrnswlv954eaws3dj1ije_a.jpeg"><br><br>  Hemos determinado los requisitos para nosotros mismos.    :    Service discovery,  â€“       ,    â€“   .  ,      ,    .   Â«Â»,   Â«Â»,    . <br><br>     ?    .       70  .      Â«Â»,  Â«Â» ,  ,        .    100   Â«Â»,        100     .         .  ,    â€“  24/7   ,      ,    ,  70   ,  . <br><br>     Â«Â»,     IP     Scale-Nomad â€“ ScaleNo,    :                 .  ,  : Â«  ?Â»     â€“  ,   . <br><br>        ,       ,  ,     ,    ,       â€“  , .     3-5  â€“   . <br><br><img src="https://habrastorage.org/webt/8z/ja/m0/8zjam0uickgtjt67yl6grtzfmao.jpeg"><br><br>  Como funciona  !  :       :   ,  â€“   ,   â€“  ,  â€“  . <br><br>  ,     .         45  â€“     .       2         ,     (    â€“ ,   ).     â€“    ,  5-10 ,    . <br><br>     Â«Â»,      ,  Â«Â»      .  ,    ,    â€“       .     .    â„– 2 â€“ Â«    Â». <br><br><h3> .    ? </h3><br>    â€“ Â«   ?Â» !      .      ? <br><br><img src="https://habrastorage.org/webt/md/xm/op/mdxmopdox-kznqvid9b4uesleeg.jpeg"><br><br>  ! <br><br><ul><li>           . </li><li>       ,   ,     . </li><li>   â€“   .      ,     ,   -  . </li></ul><br>  , ,     .   .  ,    .    Â« Â».       : <br><br><img src="https://habrastorage.org/webt/8w/1z/w4/8w1zw4dq1rwsz7e7dg7tp53wbke.jpeg"><br><br>   Â«Â»    Â«Â»,     . Â«Â»     . Â«Â»  Â«Â»      ,      ,   â€“  Â«Â»  Â«Â»,  â€“ Â«Â»  Â«Â»  Telegraf. <br><br>      New Relic.  ,   .     ,    .       1,5  ,    , : Â«     Â».    ,  ,     .    Â«-Â» ,    15     Â«-Â».    . <br><br>    ,     â€“  Debugger.     Â«Â»,       ,  ,    Â«Â».  Que es esto  ,     15-30    ,  Â« Â» ,      . <br><br> ,    ( ) â€“      ,    .   ,    Â«Â» â€“ ,   Â«Â» .       â€“     ,  ,  ,     . <br><br><h3>     ? </h3><br>     ?     ? <br><br><img src="https://habrastorage.org/webt/8c/qe/tn/8cqetn3kfyedayuv9fwc8qpx4vq.jpeg"><br><br><ul><li> Response time / RPS   â€“   .   ,    -  . </li><li>      . </li><li>  . </li><li>   . </li></ul><br>   â€“ Â«Â», Â«Â» .       ,    - ,      .     â€“   (        ).    -    5-10-15  â€“ ,     (  ). <br><br>      â€“     : <br><br><img src="https://habrastorage.org/webt/73/xa/jg/73xajgyfx9xahrr_9hl3ysaapgw.jpeg"><br><br>    â€“ 6 ,     â€“       .    â€“ RPS, RTS.  â€“    Â«Â».   Â«Â»     ,  -       â€¦      ,    . <br><br> ,      â€“       .    OpenTracing â€“ , , ,     ;    .  OpenTracing-   ,       .     ,       , .  ,      ,   . <br><br><img src="https://habrastorage.org/webt/42/nw/5h/42nw5hrsai8-i8t3bnsclajtklw.jpeg"><br><br>   ,         3  â€“    .     ,   ,    20-30 . <br><br>     ,   â€“   . <br><br>  ,  ,     ,        ,   .   ,    . <br><br><img src="https://habrastorage.org/webt/d8/pz/1v/d8pz1vfzv9otccv6dsa-crqiuuu.jpeg"><br><br>      ? ,  :     (,  Â«Â»);   , .         ,   ,  â€¦      â€“        -.   ,   : Â«        Â»? <br><br>   â€¦       -,   ( )    ,      .    :       â€“ ,      ,     ( ).    ,    -        .     !      .         . <br><br>      ,    . <br><br><h3>     </h3><br>   ,    â€“   ,    ,  ,     ,      ,    -   . ,   ,   . <br><br><img src="https://habrastorage.org/webt/e2/kb/jz/e2kbjzy9w7wvv6kicbniocak4ac.jpeg"><br><br>      (  â€“ ),       ELK Stack â€“    .  -, ,   ELK,      ,       ELK.    . <br><br><img src="https://habrastorage.org/webt/_f/8a/3i/_f8a3ibc2i7os5pp3xot6m9_gxo.jpeg"><br><br>   .  ,    ,  ,     ,   Â«Â»,   id-       ( ).        .  Por quÃ©    ,      ,      .      ,     â€“   OpenTracing,    . <br><br>     ,      ,      â€“  Â«Â» (Zipkin)  Â«Â» (Jaeger). Â«Â» â€“      ,   Â«Â».  Â«Â»  ,  ,     ,      ,   .  Â«Â»  . <br><br>   Â«Â»:   ,    Api ( Api  PHP   , ,    â€“   ,    ),     . Â«Â», â€“  ,    .    ?     : <br><br><img src="https://habrastorage.org/webt/uq/x2/mu/uqx2muumblbudpbjnuittfrsdkk.jpeg"><br><br>  Â«Â»     span'.  ,    ,           (1-2-3 â€“      ,   ).      ,        . ,          Error.     Error    ,      .    ,    span: <br><br><img src="https://habrastorage.org/webt/3e/is/fk/3eisfkpsc9mkuipyg-5iaob2d-y.jpeg"><br><br>     .       ,       ,   .        :    â€“  ,   ,            . <br><br> ,    .    ,    .      ,      Â«Â»   PHP â€“   , welcome to use,  : <br><br><img src="https://habrastorage.org/webt/q7/vi/pc/q7vipcgfujbggn_zt64r3h7foay.jpeg"><br><br>     â€“     OpenTracing Api,   php-extention,          .      .     ,   .   :     ,    extention up to you. <br><br><h3>   </h3><br>    .   â€“   .   ?    : <br><br><img src="https://habrastorage.org/webt/3h/ka/zo/3hkazonrypgjcuakfff1yrutxlc.jpeg"><br><br>    Â«Â»?        , !  Â«Â»       ,    ,        ,      .     ? <br><br><img src="https://habrastorage.org/webt/b7/h6/qa/b7h6qavqwtn9fm9bam0jbg07nym.jpeg"><br><br><ul><li>     .      ,  .    60   ,        .     , ,         â€“ ,   . </li><li>    .          ,     ,        RnD-.       ,      (,    ) ,    ,   . </li><li>     ,   â€“ ,     .       . </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tenemos tolerancias </font><font style="vertical-align: inherit;">Por ejemplo, no consideramos el tiempo de inactividad si perdimos el 2% del trÃ¡fico en dos minutos. </font><font style="vertical-align: inherit;">Esto, en principio, no entra en nuestras estadÃ­sticas. </font><font style="vertical-align: inherit;">Si mÃ¡s en porcentaje o tiempo, ya contamos.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y siempre escribimos post-mortem. </font><font style="vertical-align: inherit;">Pase lo que pase con nosotros, cualquier situaciÃ³n en la que se haya comportado de manera inapropiada en el sitio de producciÃ³n se reflejarÃ¡ en el potsortem. </font><font style="vertical-align: inherit;">Un post-mortem es un documento en el que escribe lo que le sucediÃ³, el tiempo detallado de lo que hizo para solucionarlo y (Â¡esto es un bloqueo obligatorio!) Lo que harÃ¡ para evitar que esto suceda en el futuro. </font><font style="vertical-align: inherit;">Esto es necesario, necesario para su posterior anÃ¡lisis.</font></font></li></ul><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Â¿QuÃ© considerar el tiempo de inactividad? </font></font></h3><br><img src="https://habrastorage.org/webt/ad/8v/ye/ad8vyesevuqquvkj4rtf15hggd8.jpeg"><br><br>  Â¿A quÃ© condujo todo esto? <br><br>  Esto llevÃ³ al hecho de que (tuvimos ciertos problemas de estabilidad, esto no nos convenÃ­a ni a los clientes ni a nosotros) en los Ãºltimos 6 meses, nuestro indicador de estabilidad ascendiÃ³ a 99,97.  Podemos decir que esto no es mucho.  SÃ­, tenemos algo por lo que luchar.  Aproximadamente la mitad de este indicador es la estabilidad, por asÃ­ decirlo, no la nuestra, sino nuestro firewall de aplicaciones web, que estÃ¡ delante de nosotros y se utiliza como un servicio, pero no es importante para los clientes. <br><br>  Aprendimos a dormir por la noche.  Por fin!  Hace seis meses, no sabÃ­amos cÃ³mo.  Y en esta nota con los resultados, quiero hacer un comentario.  Anoche hubo un maravilloso informe sobre el sistema de control de un reactor nuclear.  Si las personas que escribieron este sistema me escuchan, olvÃ­date de lo que dije sobre "2% no es tiempo de inactividad".  Para usted, el 2% es tiempo de inactividad, Â¡aunque sea por dos minutos! <br><br>  Eso es todo!  Sus preguntas <br><br><img src="https://habrastorage.org/webt/us/ih/xg/usihxgshbsygnv59b5detm4js5m.jpeg"><br><br><h3>  Sobre balanceadores y migraciÃ³n de bases de datos </h3><br>  Pregunta de la audiencia (en adelante - B): - Buenas tardes.  Â¡Muchas gracias por tal informe de administrador!  La pregunta es breve sobre el tema de sus equilibradores.  MencionÃ³ que tiene WAF, es decir, segÃºn tengo entendido, usa algÃºn tipo de equilibrador externo ... <br><br>  <b>:</b> - No, utilizamos nuestros servicios como equilibradores.  En este caso, WAF es para nosotros Ãºnicamente una herramienta de protecciÃ³n DDoS. <br><br>  <b>P:</b> - Â¿PodrÃ­a decir algunas palabras sobre balanceadores? <br><br>  <b>EK:</b> - Como dije, este es un grupo de servidores en openresty.  Ahora tenemos 5 grupos de redundantes que responden exclusivamente ... es decir, un servidor en el que se encuentra exclusivamente openresty, solo representa el trÃ¡fico.  En consecuencia, para comprender cuÃ¡nto tenemos: ahora tenemos un flujo de trÃ¡fico regular, esto es varios cientos de megabits.  Se las arreglan, se sienten bien, ni siquiera se esfuerzan. <br><br>  <b>P:</b> - TambiÃ©n una pregunta simple.  Hay una implementaciÃ³n azul / verde.  Â¿Y quÃ© haces, por ejemplo, con las migraciones desde la base de datos? <br><br>  <b>EK:</b> - Â¡Buena pregunta!  Mire, nosotros en el despliegue Azul / Verde tenemos lÃ­neas separadas para cada lÃ­nea.  Es decir, si estamos hablando de las lÃ­neas de eventos que se transmiten del trabajador al trabajador, hay lÃ­neas separadas para la lÃ­nea azul y la lÃ­nea verde.  Si hablamos de la base de datos en sÃ­, entonces la redujimos deliberadamente, como pudimos, poniendo todo casi en lÃ­nea, solo tenemos una pila de transacciones en la base de datos.  Y tenemos una sola pila de transacciones para todas las lÃ­neas.  Con una base de datos en este contexto: no la compartimos con azul y verde, porque ambas versiones del cÃ³digo deben saber quÃ© estÃ¡ pasando con la transacciÃ³n. <br><br>  Amigos, todavÃ­a tengo un premio tan pequeÃ±o para incentivarlos: un libro.  Y necesito darle la mejor pregunta. <br><br>  <b>P:</b> Hola.  Gracias por el informe  La pregunta es esta.  Supervisas los pagos, supervisas los servicios con los que te comunicas ... Pero, Â¿cÃ³mo supervisas para que una persona de alguna manera acuda a tu pÃ¡gina de pagos, realice un pago y el proyecto le acredite dinero?  Es decir, Â¿cÃ³mo monitorea que marchant estÃ¡ disponible y acepta su devoluciÃ³n de llamada? <br><br>  <b>:</b> - "Comerciante" para nosotros en este caso es exactamente el mismo servicio externo que el sistema de pago.  Monitoreamos la velocidad de respuesta del "comerciante". <br><br><h3>  Sobre el cifrado de la base de datos </h3><br>  <b>P:</b> Hola.  Tengo una pequeÃ±a pregunta.  Tiene datos confidenciales de PCI DSS.  Â¿QuerÃ­a saber cÃ³mo se almacenan los PAN en las colas en las que deben ingresar?  Â¿Usas algÃºn cifrado?  Y a partir de aquÃ­ surge la segunda segunda pregunta: en PCI DSS, es necesario volver a cifrar la base de datos periÃ³dicamente en caso de cambios (despido de administradores, etc.): Â¿cÃ³mo sucede esto con la accesibilidad? <br><br><img src="https://habrastorage.org/webt/0z/oh/29/0zoh293lif-ioxouzt79ui9j98a.jpeg"><br><br>  <b>EK: Â¡</b> Maravillosa pregunta!  En primer lugar, no almacenamos PAN en las colas.  No tenemos derecho a almacenar PAN en ningÃºn lugar claro, en principio, por lo tanto, utilizamos un servicio especial (lo llamamos "Kademon"): este es un servicio que solo hace una cosa: recibe un mensaje y envÃ­a un mensaje cifrado.  Y almacenamos todo con este mensaje cifrado.  En consecuencia, la longitud de la clave para nosotros es inferior a kilobytes, por lo que es directa, seria y confiable. <br><br>  <b>P:</b> - Â¿Necesita 2 kilobytes ahora? <br><br>  <b>EK:</b> - Parece que ayer fueron 256 ... Bueno, Â¿dÃ³nde mÃ¡s? <br><br>  En consecuencia, este es el primero.  Y en segundo lugar, la soluciÃ³n que existe, es compatible con el proceso de reencriptaciÃ³n: hay dos pares de "tortas" (claves) que dan "cubiertas" que encriptan (las claves son claves, dek son derivados de claves que encriptan).  Y en el caso del inicio del procedimiento (se lleva a cabo regularmente, de 3 meses a Â± algunos), cargamos un nuevo par de "pasteles" y tenemos los datos reencriptados.  Tenemos servicios separados que eliminan todos los datos, los cifran de una manera nueva;  los datos se almacenan al lado del identificador de clave con el que se cifran.  En consecuencia, tan pronto como los datos se cifren con nuevas claves, eliminamos la clave anterior. <br><br><h3>  A veces necesitas hacer pagos manualmente ... </h3><br>  <b>P:</b> - Es decir, si se produce un retorno para alguna operaciÃ³n, Â¿descifrarlo con la clave anterior? <br><br>  <b>CE:</b> SÃ­. <br><br>  <b>P:</b> - Entonces una pequeÃ±a pregunta mÃ¡s.  Cuando hay algÃºn tipo de falla, caÃ­da, incidente, es necesario empujar la transacciÃ³n en modo manual.  Existe tal situaciÃ³n. <br><br>  <b>EK:</b> SÃ­, lo hace. <br><br>  <b>P:</b> - Â¿De dÃ³nde sacas estos datos?  Â¿O tÃº mismo vas con bolÃ­grafos a esta tienda? <br><br>  <b>EK:</b> - No, bueno, por supuesto, tenemos algÃºn tipo de sistema de back-office que contiene una interfaz para nuestro soporte.  Si no sabemos en quÃ© estado se encuentra la transacciÃ³n (por ejemplo, mientras el sistema de pago no respondiÃ³ con un tiempo de espera), no sabemos a priori, es decir, asignamos el estado final solo con plena confianza.  En este caso, volcamos la transacciÃ³n en un estado especial para el procesamiento manual.  Por la maÃ±ana, al dÃ­a siguiente, tan pronto como el soporte recibe informaciÃ³n de que tales transacciones permanecen en el sistema de pago, las procesan manualmente en esta interfaz. <br><br><img src="https://habrastorage.org/webt/um/1e/qe/um1eqefsegdtcvv8gczvx2qe54o.jpeg"><br><br>  <b>P:</b> - Tengo un par de preguntas.  Una de ellas es la continuaciÃ³n de la zona PCI DSS: Â¿cÃ³mo se obtienen sus registros de bucle?  Tal pregunta porque el desarrollador podrÃ­a poner cualquier cosa en los registros.  Segunda pregunta: Â¿cÃ³mo se implementan las revisiones?  Los bolÃ­grafos en la base de datos son una opciÃ³n, pero puede haber correcciones rÃ¡pidas gratuitas: Â¿cuÃ¡l es el procedimiento allÃ­?  Y la tercera pregunta probablemente estÃ© relacionada con RTO, RPO.  Su disponibilidad era de 99.97, casi cuatro nueves, pero segÃºn tengo entendido, tiene un segundo centro de datos, un tercer centro de datos y un quinto centro de datos ... Â¿CÃ³mo maneja su sincronizaciÃ³n, replicaciÃ³n, todo lo demÃ¡s? <br><br>  <b>EK:</b> - Comencemos por el primero.  La primera pregunta sobre los registros fue?  Cuando escribimos registros, tenemos una capa que enmascara todos los datos confidenciales.  Ella mira la mÃ¡scara y los campos adicionales.  En consecuencia, nuestros registros salen con datos ya enmascarados y un bucle PCI DSS.  Esta es una de las tareas regulares asignadas al departamento de pruebas.  EstÃ¡n obligados a verificar todas las tareas, incluidos los registros que escriben, y esta es una de las tareas habituales en la revisiÃ³n del cÃ³digo, para controlar que el desarrollador no haya escrito algo.  El departamento de seguridad de la informaciÃ³n lleva a cabo una verificaciÃ³n posterior de esto una vez por semana: los registros se toman de forma selectiva para el Ãºltimo dÃ­a y se ejecutan a travÃ©s de un escÃ¡ner-analizador especial desde los servidores de prueba para verificar todo esto. <br>  Sobre arreglos calientes.  Esto estÃ¡ incluido en nuestro cronograma de implementaciÃ³n.  Tenemos un artÃ­culo separado sobre las revisiones.  Creemos que implementamos revisiones todo el dÃ­a cuando lo necesitamos.  Tan pronto como se haya ensamblado la versiÃ³n, tan pronto como se ejecute, tan pronto como tengamos el artefacto, contactaremos al administrador del sistema para que lo llame y lo implementarÃ¡ en el momento que sea necesario. <br><br>  Sobre los "cuatro nueves".  El nÃºmero que tenemos ahora, realmente se logrÃ³, y lo buscamos en otro centro de datos.  Ahora tenemos un segundo centro de datos, y estamos comenzando a enrutarlos, y la cuestiÃ³n del centro de replicaciÃ³n de datos cruzados es realmente una pregunta no trivial.  Intentamos resolverlo a su debido tiempo por diferentes medios: tratamos de usar la misma "TarÃ¡ntula", no funcionÃ³ para nosotros, lo digo de inmediato.  Por lo tanto, llegamos al hecho de que hacemos el orden de "sensaciÃ³n" manualmente.  De hecho, tenemos todas las aplicaciones en el modo asincrÃ³nico de las unidades necesarias de sincronizaciÃ³n "cambio hecho" entre centros de datos. <br><br>  <b>P:</b> - Si tienes una segunda, Â¿por quÃ© no una tercera?  Porque nadie tiene cerebro dividido todavÃ­a ... <br><br>  <b>:</b> - Y no tenemos un cerebro dividido.  Debido al hecho de que cada aplicaciÃ³n maneja un multimaestro, no nos importa a quÃ© centro llegÃ³ la solicitud.  Estamos listos para el hecho de que, en el caso de que un centro de datos se bloquee (estamos recostados) y en medio de la solicitud de un usuario cambiado a un segundo centro de datos, realmente estamos listos para perder a este usuario;  pero serÃ¡n unidades, unidades absolutas. <br><br>  <b>P:</b> - Buenas tardes.  Gracias por el informe  Usted hablÃ³ sobre su depurador, que impulsa algunas transacciones de prueba en producciÃ³n.  Â¡Pero cuÃ©ntanos sobre las transacciones de prueba!  Â¿QuÃ© tan profundo va? <br><br>  <b>EC:</b> - Pasa por el ciclo completo de todo el componente.  No hay diferencias entre la transacciÃ³n de prueba y la de combate para el componente.  Y desde el punto de vista de la lÃ³gica, este es solo un proyecto separado en el sistema, en el que solo se persiguen las transacciones de prueba. <br><br>  <b>P:</b> - Â¿Y dÃ³nde lo cortas?  Entonces Core enviÃ³ ... <br><br>  <b>:</b> - Estamos detrÃ¡s de "Kor" en este caso para transacciones de prueba ... Tenemos algo asÃ­ como enrutamiento: "Kor" sabe a quÃ© sistema de pago enviar - enviamos a un sistema de pago falso, que simplemente da una respuesta http y eso es todo . <br><br>  <b>P:</b> - Por favor, dÃ­game, Â¿tenÃ­a la aplicaciÃ³n escrita en un gran monolito o la recortÃ³ en algunos servicios o incluso en microservicios? <br><br>  <b>:</b> - No tenemos un monolito, por supuesto, tenemos una aplicaciÃ³n orientada a servicios.  Tenemos una broma de que tenemos un servicio de monolitos: son realmente bastante grandes.  Al llamar a microservicios, este lenguaje no se aparta de la palabra, pero estos son los servicios dentro de los cuales trabajan los trabajadores de mÃ¡quinas distribuidas. <br><br><h3>  Si el servicio en el servidor se ve comprometido ... </h3><br>  <b>P:</b> - Entonces tengo la siguiente pregunta.  Incluso si fuera un monolito, aÃºn dijiste que tienes muchos de estos servidores instantÃ¡neos, todos procesan los datos en principio, y la pregunta es: â€œSi uno de los servidores instantÃ¡neos o la aplicaciÃ³n, cualquier enlace en particular estÃ¡ comprometido Â¿Tienen algÃºn tipo de control de acceso?  Â¿CuÃ¡l de ellos puede hacer quÃ©?  Â¿A quiÃ©n contactar, para quÃ© datos? <br><br><img src="https://habrastorage.org/webt/3j/qn/pt/3jqnpt1dfzhas9kn5de1qb6x1lq.jpeg"><br><br>  <b>EK:</b> SÃ­, por supuesto.  Los requisitos de seguridad son bastante serios.  En primer lugar, tenemos trÃ¡fico de datos abierto, y los puertos son solo aquellos en los que anticipamos el trÃ¡fico por adelantado.  Si el componente se comunica con la base de datos (por ejemplo, "Muskul") en 5-4-3-2, solo se abrirÃ¡n 5-4-3-2 y otros puertos, otras direcciones de trÃ¡fico no estarÃ¡n disponibles.  AdemÃ¡s, debemos entender que en producciÃ³n tenemos unos 10 bucles de seguridad diferentes.  E incluso si la aplicaciÃ³n se vio comprometida de alguna manera, Dios no lo quiera, un atacante no podrÃ¡ acceder a la consola de administraciÃ³n del servidor, porque esta es otra zona de seguridad de la red. <br><br>  <b>P:</b> - Y en este contexto, estoy mÃ¡s interesado en el momento en que tiene algunos contratos con los servicios: quÃ© pueden hacer, a travÃ©s de quÃ© "acciones" pueden contactarse entre sÃ­ ... Y en el flujo normal, algunos servicios especÃ­ficos preguntan quÃ© una serie, una lista de "acciÃ³n" en otra.  No parecen recurrir a otros en una situaciÃ³n normal, y tienen otras Ã¡reas de responsabilidad.  Si uno de ellos se ve comprometido, Â¿podrÃ¡ tirar de la "acciÃ³n" de ese servicio? .. <br><br>  <b>EK:</b> - Entiendo.  Si en una situaciÃ³n normal con otro servidor generalmente se permitÃ­a la comunicaciÃ³n, entonces sÃ­.  SegÃºn el contrato de SLA, no controlamos que solo se le permitan las primeras 3 "acciones", y no se le permiten 4 "acciones".  Probablemente esto sea redundante para nosotros, porque tenemos un sistema de protecciÃ³n de 4 niveles, en principio, para circuitos.  Preferimos defender con contornos en lugar de a nivel de los interiores. <br><br><h3>  CÃ³mo funcionan Visa, MasterCard y Sberbank </h3><br>  <b>P:</b> - Quiero aclarar un momento acerca de cambiar a un usuario de un centro de datos a otro.  Hasta donde yo sÃ©, "Visa" y "MasterCard" funcionan en el protocolo sÃ­ncrono binario 8583, hay mezclas.  Y querÃ­a saber, ahora me refiero a cambiar: Â¿es directamente "Visa" y "MasterCard" o a los sistemas de pago, a los procesamientos? <br><br>  <b>EK:</b> - Depende de las mezclas.  Mezclas que tenemos en un centro de datos. <br><br>  <b>P:</b> - En tÃ©rminos generales, Â¿tiene un punto de conexiÃ³n? <br><br>  <b>:</b> - "Vise" y "MasterCard" - sÃ­.  Solo porque "Visa" y "MasterCard" requieren inversiones bastante serias en infraestructura para celebrar contratos separados para recibir un segundo par de mezclas, por ejemplo.  EstÃ¡n reservados dentro del marco de un centro de datos, pero si Dios no lo permite, el centro de datos donde las mezclas para conectarse a "Visa" y "MasterCard" estÃ¡n muertas, entonces tendremos una conexiÃ³n con "Visa" y "MasterCard" perdido ... <br><br>  <b>P:</b> - Â¿CÃ³mo se pueden reservar?  Â¡SÃ© que "Visa" solo permite mantener una conexiÃ³n en principio! <br><br>  <b>EK:</b> - Ellos mismos suministran equipos.  En cualquier caso, recibimos equipos que son internamente redundantes. <br><br>  <b>P:</b> - Es decir, Â¿el rack de su Connects Orange? .. <br><br>  <b>CE:</b> SÃ­. <br><br>  <b>P:</b> - Pero como en este caso: si su centro de datos desaparece, Â¿deberÃ­a usarlo mÃ¡s?  Â¿O solo se trata de detener el trÃ¡fico? <br><br>  <b>CE:</b> - No.  En este caso, simplemente cambiamos el trÃ¡fico a otro canal, que, por supuesto, serÃ¡ mÃ¡s costoso para nosotros, mÃ¡s costoso para los clientes.  Pero el trÃ¡fico no pasarÃ¡ a travÃ©s de nuestra conexiÃ³n directa con la "Visa", "MasterCard", sino a travÃ©s del "Sberbank" convencional (muy exagerado). <br><br>  Lamento muchÃ­simo si lastimo a los empleados de Sberbank.  Pero segÃºn nuestras estadÃ­sticas, Sberbank estÃ¡ cayendo con mayor frecuencia de los bancos rusos.  En menos de un mes, algo no se ha caÃ­do en Sberbank. <br><br><img src="https://habrastorage.org/webt/u2/pm/rp/u2pmrpkbplsfx65dstp-lsstwcw.jpeg"><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/6YB1kMnzyRs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3>  Un poco de publicidad :) </h3><br>  Gracias por quedarte con nosotros.  Â¿Te gustan nuestros artÃ­culos?  Â¿Quieres ver mÃ¡s materiales interesantes?  ApÃ³yenos haciendo un pedido o recomendando a sus amigos <a href="https://ua-hosting.company/cloudvps/nl">VPS basado en la nube para desarrolladores desde $ 4.99</a> , un <b>anÃ¡logo Ãºnico de servidores de nivel bÃ¡sico que inventamos para usted:</b> <a href="https://habr.com/company/ua-hosting/blog/347386/">toda la verdad sobre VPS (KVM) E5-2697 v3 (6 nÃºcleos) 10GB DDR4 480GB SSD 1Gbps desde $ 19 o cÃ³mo dividir el servidor?</a>  (las opciones estÃ¡n disponibles con RAID1 y RAID10, hasta 24 nÃºcleos y hasta 40GB DDR4). <br><br>  <b>Dell R730xd 2 veces mÃ¡s barato en el centro de datos Equinix Tier IV en Amsterdam?</b>  Â¡Solo tenemos <b><a href="https://ua-hosting.company/serversnl">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV desde $ 199</a> en los PaÃ­ses Bajos!</b>  <b><b>Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - Â¡desde $ 99!</b></b>  Lea sobre <a href="https://habr.com/company/ua-hosting/blog/329618/">CÃ³mo construir un edificio de infraestructura.</a>  <a href="https://habr.com/company/ua-hosting/blog/329618/">clase utilizando servidores Dell R730xd E5-2650 v4 que cuestan 9,000 euros por un centavo?</a> </li></ul></div></div><p>Source: <a href="https://habr.com/ru/post/484908/">https://habr.com/ru/post/484908/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../484898/index.html">Buen motivo para probar sus dependencias: ediciÃ³n AGPL</a></li>
<li><a href="../484900/index.html">RepresentaciÃ³n del sitio web 101</a></li>
<li><a href="../484902/index.html">En ecuaciones de grados superiores</a></li>
<li><a href="../484904/index.html">Un aÃ±o sin Splunk: cÃ³mo una empresa estadounidense cambiÃ³ el mercado de anÃ¡lisis de datos de mÃ¡quinas en Rusia y a quiÃ©n dejÃ³ atrÃ¡s</a></li>
<li><a href="../484906/index.html">Equipo distribuido y lÃ­der de equipo en remoto</a></li>
<li><a href="../484910/index.html">Paul Graham: enemigos</a></li>
<li><a href="../484918/index.html">AnotaciÃ³n incremental en proceso para acelerar las construcciones de gradle</a></li>
<li><a href="../484920/index.html">Â¿CÃ³mo entender que usted es un operador de fresadoras?</a></li>
<li><a href="../484930/index.html">Codifiquemos rÃ¡pidamente como profesionales</a></li>
<li><a href="../484932/index.html">La naturaleza dual de los requisitos de software.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>