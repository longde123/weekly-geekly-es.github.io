<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧒🏻 👨🏽‍🤝‍👨🏻 👨🏼 50个树桩阴影* Microchip微控制器以硬件方式接收PWM编码信号 🔭 🚮 Ⓜ️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="* NIP-Microchip微控制器中的内核独立外围设备，也称为CIP-内核独立外围设备。 

 第4部分 
 先前的文章[ 1 ]，[ 2 ]和[ 3 ]专门介绍了内核独立（NEV）Microchip微控制器的外设：可配置逻辑单元，具有限流功能的输入/输出端口以及具有计算机的ADC；显示了此类外...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>50个树桩阴影* Microchip微控制器以硬件方式接收PWM编码信号</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/401541/"><div style="text-align:center;"><img src="https://habrastorage.org/files/344/eea/f79/344eeaf79b9a424fb5c5272f4506a24f.JPG" width="300"></div><br>  * NIP-Microchip微控制器中的内核独立外围设备，也称为CIP-内核独立外围设备。 <br><br><h1> 第4部分 </h1><br> 先前的文章[ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1</a> ]，[ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">2</a> ]和[ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3</a> ]专门介绍了内核独立（NEV）Microchip微控制器的外设：可配置逻辑单元，具有限流功能的输入/输出端口以及具有计算机的ADC；显示了此类外设的一些功能。 让我提醒您，隐含的独立性不是取决于微控制器的PIC内核类型（BaseLine，中档，增强型中档，PIC18、16位，32位），而是取决于内核的操作即即。 独立执行分配给CPU外围状态的任务。 这样的外围设备，尤其是配置它以进行硬件功能的协作和综合的可能性，旨在减轻软件部分的负担并降低功耗。 <br><br> 在这篇简短的文章中，我想展示使用独立于内核的外设实现“定制”非标准通信接口的接收示例。 <br><a name="habracut"></a><br> 当离散信号log.1和log.0由脉冲宽度编码时，信息的PWM编码非常普遍。 考虑使用与外围内核无关的PIC控制器接收和解码此类信号的选项。 <br><br><h2>  AM2302传感器信号的PWM解码 </h2><br> 在DIY项目中，经常使用DHT22温湿度传感器（AM2302）。 该传感器具有3个输出，信息通过单线传输。 响应该请求（大约1ms的低电平），传感器响应一个起始位，然后响应一个40位的序列，其中信息以脉冲持续时间log编码。  “ 0”-脉冲数30mk秒，记录。  “ 1”-70mk秒（典型值）。 传感器的响应包含5个字节：2个字节的湿度数据，2个温度的字节和1个控制字节。 <br><br><img src="https://habrastorage.org/files/d89/ab5/d3a/d89ab5d3a7204c46aeb299ace4023003.png"><br>  <i>图1。</i>  <i>DHT22传感器信号生成原理的说明。</i> <br><br> 网络上有许多在Arduino上使用此类传感器的示例。 一些库实现使用以下构造： <br><br><pre><code class="hljs ruby">loopCnt = TIMEOUT; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(PIN) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(--loopCount == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ErrorTimeout; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loopCnt &lt; cntOne) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> bit =<span class="hljs-number"><span class="hljs-number">1</span></span> … } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> bit =<span class="hljs-number"><span class="hljs-number">0</span></span> … }</code> </pre> <br> 在这样的实现中，我看到以下问题： <br><br>  -整个测量时间（&gt; 5ms）的程序在测量代码中“挂起”； <br>  -发生足够长的中断会中断从传感器读取数据； <br>  -在微控制器的低时钟频率下工作的潜在问题； <br><br> 这种解决方案的程序算法大致具有以下形式（见图2） <br><br><img src="https://habrastorage.org/files/c97/8c0/d3f/c978c0d3f5444843aa4caa67c2d62f14.png"><br>  <i>图</i>  <i>2.一种用于以编程方式接收和解码传感器信号的算法。</i> <br><br> 以下被认为是具有最小软件开销的协议的硬件接收/解码的变体。 <br><br> 其思想是从位流中隔离时钟脉冲，然后将原始信号和时钟脉冲的方向隔离到SPI硬件模块。 在这种情况下，微控制器的程序只能从SPI顺序获取5个字节的数据。 <br><br>  CIP的一部分是计时器，它可以触发事件（输入状态或其他外设的更改）。 即 改变输入状态可以触发一个定时器，见图3中的TMR6信号。 当定时器达到设定值时，其计数停止，定时器处于TMR6 = PR6（PR-周期寄存器）状态。 计时器状态可以是可配置逻辑单元（CLC，请参见第1部分）的输入。 <br><br> 因此，使用定时器和逻辑单元，我们可以生成适合于SPI模块SCK时钟输入的信号。 为了提取信息，这种块的持续时间应该具有在零和一之间的平均值。 然后，SPI可以根据块的衰减来固定该位（见图3 SCK信号）。 <br><br> 来自传感器的信号将具有从请求脉冲和启动脉冲生成的错误脉冲。 为了避免这些脉冲干扰操作，您只需要在信息脉冲持续时间内使能SPI，或者切断不必要的脉冲即可。 我们也可以使用CIP解决此问题。 <br><br> 另一个计时器用作切换衰退的脉冲计数器：将2写入周期寄存器，计时器对前2个脉冲进行计数（请参见图3中的信号TMR4）并停止计数（请参见图3中的EN信号），通过逻辑单元块允许将剩余脉冲发送到输入SPI。 <br><br><img src="https://habrastorage.org/files/063/871/47f/06387147f53f4a24b875feee752b271b.png"><br>  <i>图3。</i>  <i>解释DHT22传感器信号接收的图。</i> <br><br>  SCK信号生成的逻辑功能是在一个逻辑单元（CLC）上实现的，AND-OR配置的完整电路如图4所示。 <br><br> 逻辑单元的输出连接到SCK输入，DHT22传感器信号连接到SPI模块的MOSI。 所有连接都在微控制器内部进行（图5）。 为了进行监视和调试，可以将信号输出到微控制器的端口。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f99/2ab/63f/f992ab63fbc048a1ae5b6dad31748263.png"></div><br>  <i>图4。</i>  <i>PIC微控制器中的CLC逻辑单元配置。</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b27/d35/f60/b27d35f60fc04de9890ed357bb84309d.png"></div><br>  <i>图</i>  <i>5.外围结构的完整结构。</i> <br><br> 如果似乎有2个用于解码传感器协议的计时器浪费了资源，那么可以在空闲的CLC逻辑单元上“收集”最多2个计数器。 <br><br> 总的来说，解码任务归结为一个非常简单的算法：微控制器及其外围设备被初始化，必要时打开SPI模块并生成测量请求（记录“ 0”约1毫秒）。 <br><br> 当发生SPI中断时，它仍然从缓冲区读取数据。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/434/536/fef/434536fef59a4b569a45aa334d9df535.png"></div><br>  <i>图6。</i>  <i>使用树桩时用于DHT22传感器的算法。</i> <br><br><img src="https://habrastorage.org/files/966/2d4/798/9662d4798e9f4d289957d2c6ff619898.png"><br>  <i>图7。</i>  <i>来自微控制器端口的信号。</i>  <i>信号SSP1IF-SPI模块接收到字节后中断。</i> <br><br> 图7显示了信号图，其中： <br><blockquote>  DHT（dat）-传感器信号线上的信号-馈入MOSI模块SPI的输入； <br>  TMR6！= RP6-专用时钟-发送至SPI模块的SCK； <br>  SSP1IF-中断信号（SPI缓冲区中的数据就绪）-实际上，此信号显示了微控制器内核的负载-读取结果数据。 </blockquote><br><h2> 解码其他PWM协议 </h2><br> 家用电器的红外遥控器中使用了类似的“单线” PWM协议。 通常在IR传输期间，当持续时间恒定且暂停时间可变时，将使用按脉冲位置进行编码。 此选项也称为“可变暂停编码”。 实际上，这是相同的PWM编码，但信号反相。 在存在逻辑单元的情况下，反转不是问题，此外，IR接收器会将接收到的信号反转。 在图。 图8显示了接收器从两个不同的控制台接收到的信号。 <br><br><img src="https://habrastorage.org/files/6a8/6ca/62e/6a86ca62ec704b029650cfc4cb1d70a8.png"><br><img src="https://habrastorage.org/files/739/1a1/4bb/7391a14bb1764eef9a3d36d4f19c40c9.png"><br>  <i>图8。</i>  <i>红外遥控器的编码选项。</i> <br><br> 两个遥控器都有不同的协议，但是这些协议很容易以上述方式进行解码，唯一的问题是必须确定发送的开始以同步SPI的包含，因为IR接收器可能会遇到干扰。 <br><br><img src="https://habrastorage.org/files/205/4b6/99a/2054b699a4244346990f8748f65733df.png"><br><img src="https://habrastorage.org/files/c3b/4f0/49c/c3b4f049ce3b408b9ff8715cdf017579.png"><br>  <i>图</i>  <i>9.使用SPI解码的信号。</i> <br><br> 并非所有的红外遥控器都具有PWM编码。 一些协议，例如RC5，具有相位编码（曼彻斯特码，“ 0”发送为10，“ 1”发送为01）[4]。 在第一部分[1]中我们已经考虑过使用独立于内核的外围对曼彻斯特代码进行解码。 <br><br><h2> 总结 </h2><br> 我们将信息包的接收转移到硬件上，而不是微控制器的CPU负载的几乎100％用于在Arduino版本中解码PWM协议（是的，我知道，使用捕获模块或其他外设可以更有效地解决问题）。 输入信号的前面将启动计时器，计时器的状态确定逻辑单元块的输出，逻辑单元的输出将馈送到SPI。 <br><br> 使用独立于内核的外设可以优化资源的使用，将某些任务转移到硬件，简化代码并减少消耗。 <br><br><h2> 文学作品 </h2><br>  1. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PIC控制器中的可配置逻辑单元。</a> <br>  2. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">50个树桩阴影。</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">输入/输出端口</a> <br>  3. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">50个树桩阴影。</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ADC和具有Microchip微控制器计算机的ADC</a> <br>  4. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">sbprojects.com/knowledge/ir/rc5.php</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN401541/">https://habr.com/ru/post/zh-CN401541/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN401529/index.html">问伊桑：可以认为宇宙还活着吗？</a></li>
<li><a href="../zh-CN401531/index.html">在“科学不是面粉”项目的框架内，将就以下主题进行讨论：“性，毒品，摇滚：成瘾还是生命？”</a></li>
<li><a href="../zh-CN401533/index.html">在RX 460实例上选择预算视频卡的困难</a></li>
<li><a href="../zh-CN401535/index.html">殖民地 第4章：旧军事基地</a></li>
<li><a href="../zh-CN401539/index.html">实时流转码的NVidia GPU压力测试</a></li>
<li><a href="../zh-CN401543/index.html">使用来自俄罗斯开放数据门户网站data.gov.ru的数据集</a></li>
<li><a href="../zh-CN401545/index.html">厨师我见 英特尔Unite-专业交流工具</a></li>
<li><a href="../zh-CN401549/index.html">物质的异乎寻常状态，LCD和水的未来</a></li>
<li><a href="../zh-CN401555/index.html">最有用的家用机器人</a></li>
<li><a href="../zh-CN401561/index.html">去中国的机顶盒有多远？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>