<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ“™ ğŸ•º ğŸ––ğŸ» æˆ‘å¯ä»¥æ™•å—ï¼Ÿ å—åˆ°é€šç”¨ç±»å‹ç¼–ç¨‹çš„æ‰“å‡» ğŸ¤« ğŸ™…ğŸ¾ ğŸ£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å“ˆHa 


 ä¸Šä¸€æ¬¡ï¼Œæˆ‘ä»¬æè¿°äº†â€œ Hasæ¨¡å¼â€ï¼Œæ¦‚è¿°äº†å…¶è§£å†³çš„é—®é¢˜ï¼Œå¹¶ç¼–å†™äº†ä¸€äº›ç‰¹å®šçš„å®ä¾‹ï¼š 


 instance HasDbConfig AppConfig where getDbConfig = dbConfig instance HasWebServerConfig AppConfig...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>æˆ‘å¯ä»¥æ™•å—ï¼Ÿ å—åˆ°é€šç”¨ç±»å‹ç¼–ç¨‹çš„æ‰“å‡»</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471052/"><p> å“ˆHa </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸Šä¸€æ¬¡ï¼Œ</a>æˆ‘ä»¬æè¿°äº†â€œ <code>Has</code>æ¨¡å¼â€ï¼Œæ¦‚è¿°äº†å…¶è§£å†³çš„é—®é¢˜ï¼Œå¹¶ç¼–å†™äº†ä¸€äº›ç‰¹å®šçš„å®ä¾‹ï¼š </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">instance</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HasDbConfig</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppConfig</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">where</span></span></span></span> getDbConfig = dbConfig <span class="hljs-keyword"><span class="hljs-keyword">instance</span></span> <span class="hljs-type"><span class="hljs-type">HasWebServerConfig</span></span> <span class="hljs-type"><span class="hljs-type">AppConfig</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> getWebServerConfig = webServerConfig <span class="hljs-keyword"><span class="hljs-keyword">instance</span></span> <span class="hljs-type"><span class="hljs-type">HasCronConfig</span></span> <span class="hljs-type"><span class="hljs-type">AppConfig</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> getCronConfig = cronConfig</code> </pre> <br><p> çœ‹èµ·æ¥ä¸é”™ è¿™é‡Œä¼šå‡ºç°ä»€ä¹ˆå›°éš¾ï¼Ÿ </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/821/f4f/397/821f4f397a69ccd020b677098f5ecaf7.jpg" alt="å›¾ç‰‡"></p><br><p> å¥½å§ï¼Œè®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹æˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦å“ªäº›å…¶ä»–å®ä¾‹ã€‚ é¦–å…ˆï¼Œæœ¬èº«å…·æœ‰é…ç½®çš„å…·ä½“ç±»å‹æ˜¯è¿™äº›ç±»å‹ç±»çš„ï¼ˆç®€å•ï¼‰å®ç°çš„è‰¯å¥½å€™é€‰è€…ï¼Œè¿™ä¸ºæˆ‘ä»¬æä¾›äº†å¦å¤–ä¸‰ä¸ªå®ä¾‹ï¼Œå…¶ä¸­æ¯ç§æ–¹æ³•éƒ½æ˜¯é€šè¿‡<code>id</code>å®ç°çš„ï¼Œä¾‹å¦‚ </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">instance</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HasDbConfig</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DbConfig</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">where</span></span></span></span> getDbConfig = id</code> </pre> <br><p> å®ƒä»¬ä½¿æˆ‘ä»¬èƒ½å¤Ÿè½»æ¾ç¼–å†™ç‹¬ç«‹äºæ•´ä¸ª<code>AppConfig</code>å•ä¸ªæµ‹è¯•æˆ–å¸®åŠ©ç¨‹åºå®ç”¨ç¨‹åºã€‚ </p><br><p> è¿™å·²ç»å¾ˆæ— èŠï¼Œä½†ä»ä¼šç»§ç»­ã€‚ å¯ä»¥æƒ³è±¡ï¼Œä¸€äº›é›†æˆæµ‹è¯•ä¼šæ£€æŸ¥ä¸€å¯¹æ¨¡å—çš„äº¤äº’ï¼Œè€Œæˆ‘ä»¬ä»ç„¶ä¸å¸Œæœ›ä¾èµ–äºæ•´ä¸ªåº”ç”¨ç¨‹åºçš„é…ç½®ï¼Œå› æ­¤ç°åœ¨æˆ‘ä»¬éœ€è¦ç¼–å†™å…­ä¸ªå®ä¾‹ï¼ˆæ¯ä¸ªç±»å‹ä¸¤ä¸ªï¼‰ï¼Œæ¯ä¸ªå®ä¾‹éƒ½å°†ç®€åŒ–ä¸º<code>fst</code>æˆ–<code>snd</code> ã€‚ ä¾‹å¦‚ï¼Œå¯¹äº<code>DbConfig</code> ï¼š </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">instance</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HasDbConfig</span></span></span><span class="hljs-class"> (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DbConfig</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">b</span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">where</span></span></span></span> getDbConfig = fst <span class="hljs-keyword"><span class="hljs-keyword">instance</span></span> <span class="hljs-type"><span class="hljs-type">HasDbConfig</span></span> (a, <span class="hljs-type"><span class="hljs-type">DbConfig</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> getDbConfig = snd</code> </pre> <br><p> ææ€–ç‰‡ å¸Œæœ›æˆ‘ä»¬æ°¸è¿œä¸éœ€è¦åŒæ—¶æµ‹è¯•ä¸‰ä¸ªæ¨¡å—çš„æ“ä½œ-å¦åˆ™ï¼Œæ‚¨å°†ä¸å¾—ä¸ç¼–å†™9ä¸ªæ— èŠçš„å®ä¾‹ã€‚ æ— è®ºå¦‚ä½•ï¼Œæˆ‘ä¸ªäººå·²ç»å¾ˆä¸èˆ’æœï¼Œæˆ‘å®æ„¿èŠ±å‡ ä¸ªå°æ—¶æ¥è‡ªåŠ¨æ‰§è¡Œæ­¤é—®é¢˜ï¼Œä¹Ÿä¸å¸Œæœ›èŠ±å‡ åˆ†é’Ÿæ¥ç¼–å†™é¢å¤–çš„ä»£ç è¡Œã€‚ </p><br><p> æ­¤å¤–ï¼Œå¦‚æœæ‚¨å¯¹å¦‚ä½•ä»¥ä¸€èˆ¬æ–¹å¼è§£å†³æ­¤é—®é¢˜æ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆå®ƒæ˜¯ä»å±ç±»å‹ï¼Œä»¥åŠæœ€ç»ˆçœ‹èµ·æ¥åƒHaskell-WelkomçŒ«ã€‚ </p><a name="habracut"></a><br><h1 id="obobschaem-has-klass"> æ€»ç»“<code>Has</code>ç±» </h1><br><p> é¦–å…ˆï¼Œè¯·æ³¨æ„ï¼Œå¯¹äºä¸åŒçš„ç¯å¢ƒï¼Œæˆ‘ä»¬æœ‰ä¸åŒçš„ç±»ã€‚ è¿™å¯èƒ½ä¼šå¦¨ç¢åˆ¶å®šé€šç”¨è§£å†³æ–¹æ¡ˆï¼Œå› æ­¤æˆ‘ä»¬åœ¨å•ç‹¬çš„å‚æ•°ä¸­å–å‡ºç¯å¢ƒï¼š </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Has</span></span></span><span class="hljs-class"> part record </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">where</span></span></span></span> extract :: record -&gt; part</code> </pre> <br><p> å¯ä»¥è¯´ï¼Œ <code>Has part record</code>æ„å‘³ç€å¯ä»¥ä»ç±»å‹<code>record</code>çš„å€¼ä¸­æå–<code>part</code>ç±»å‹çš„å€¼ã€‚ ç”¨è¿™äº›æœ¯è¯­ï¼Œæˆ‘ä»¬å¥½çš„æ—§å¼<code>HasDbConfig</code>å˜ä¸º<code>Has DbConfig</code> ï¼Œå¯¹äºæˆ‘ä»¬å…ˆå‰ç¼–å†™çš„å…¶ä»–ç±»å‹ç±»ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ äº‹å®è¯æ˜ï¼Œè¿™å‡ ä¹æ˜¯çº¯ç²¹çš„è¯­æ³•å˜åŒ–ï¼Œä¾‹å¦‚ï¼Œä¸Šä¸€ç¯‡æ–‡ç« ä¸­çš„ä¸€ç§å‡½æ•°çš„ç±»å‹ç”± </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">doSmthWithDbAndCron</span></span> :: (<span class="hljs-type"><span class="hljs-type">MonadReader</span></span> rm, <span class="hljs-type"><span class="hljs-type">HasDbConfig</span></span> r, <span class="hljs-type"><span class="hljs-type">HasCronConfig</span></span> r) =&gt; ...</code> </pre> <br><p> åœ¨ </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">doSmthWithDbAndCron</span></span> :: (<span class="hljs-type"><span class="hljs-type">MonadReader</span></span> rm, <span class="hljs-type"><span class="hljs-type">Has</span></span> <span class="hljs-type"><span class="hljs-type">DbConfig</span></span> r, <span class="hljs-type"><span class="hljs-type">Has</span></span> <span class="hljs-type"><span class="hljs-type">CronConfig</span></span> r) =&gt; ...</code> </pre> <br><p> å”¯ä¸€çš„å˜åŒ–æ˜¯åœ¨æ­£ç¡®çš„ä½ç½®æœ‰å‡ ä¸ªç©ºæ ¼ã€‚ </p><br><p> å¦å¤–ï¼Œæˆ‘ä»¬åœ¨ç±»å‹æ¨æ–­æ–¹é¢å¹¶æ²¡æœ‰æŸå¤±å¤ªå¤šï¼šåœ¨å®è·µä¸­é‡åˆ°çš„å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè®¡æ—¶å™¨ä»å¯ä»¥åœ¨å‘¨å›´çš„ä¸Šä¸‹æ–‡ä¸­è¾“å‡ºå¿…è¦çš„<code>extract</code>è¿”å›å€¼ã€‚ </p><br><p> ç°åœ¨ï¼Œæˆ‘ä»¬ä¸åœ¨ä¹ç‰¹å®šçš„ç¯å¢ƒç±»å‹ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å“ªäº›è®°å½•å¯ä»¥ä¸ºå›ºå®š<code>part</code>å®ç°â€œ <code>Has part record</code>ç±»ã€‚ æ­¤ä»»åŠ¡å…·æœ‰è‰¯å¥½çš„å½’çº³ç»“æ„ï¼š </p><br><ol><li> æ¯ç§ç±»å‹éƒ½æœ‰å®ƒè‡ªå·±ï¼š <code>Has record record</code>æ–¹æ³•å¾ˆç®€å•ï¼ˆ <code>extract = id</code> ï¼‰ã€‚ </li><li> å¦‚æœ<code>record</code>æ˜¯<code>rec1</code>å’Œ<code>rec2</code>ç±»å‹çš„<code>rec1</code> ï¼Œåˆ™ä»…å½“<code>Has part rec1</code>æˆ–<code>Has part rec2</code>æ—¶ï¼Œæ‰å®ç°<code>Has part record</code> ã€‚ </li><li> å¦‚æœ<code>record</code>æ˜¯<code>rec1</code>å’Œ<code>rec2</code>ç±»å‹çš„æ€»å’Œï¼Œåˆ™åªæœ‰å½“<code>Has part rec1</code>å’Œ<code>Has part rec2</code> ï¼Œæ‰<code>Has part record</code> ã€‚ å°½ç®¡åœ¨è¿™ç§æƒ…å†µä¸‹è¿™ç§æƒ…å†µçš„å®é™…æ‚£ç—…ç‡å¹¶ä¸æ˜æ˜¾ï¼Œä½†å‡ºäºå®Œæ•´æ€§è€ƒè™‘ï¼Œä»ç„¶å€¼å¾—ä¸€æã€‚ </li></ol><br><p> å› æ­¤ï¼Œçœ‹èµ·æ¥æˆ‘ä»¬å·²ç»åˆ¶å®šäº†ç®—æ³•çš„è‰å›¾ï¼Œå¯ä»¥è‡ªåŠ¨ç¡®å®šæ˜¯å¦<code>Has part record</code>ä¸º<code>part</code>å®æ–½äº†<code>part</code> <code>record</code>å¹¶<code>record</code>æ•°æ®ï¼ </p><br><p> å¹¸è¿çš„æ˜¯ï¼Œè¿™ç§åŸºäºç±»å‹çš„å½’çº³æ¨ç†éå¸¸é€‚åˆHaskell <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ³›å‹</a>æœºåˆ¶ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œæ³›å‹æ˜¯Haskellä¸­å¹¿ä¹‰å…ƒç¼–ç¨‹çš„æ–¹æ³•ä¹‹ä¸€ï¼Œè¿™æ˜¯ç”±äºè§‚å¯Ÿåˆ°æ¯ç§ç±»å‹éƒ½æ˜¯æ±‚å’Œç±»å‹ï¼Œä¹˜ç§¯ç±»å‹æˆ–å…·æœ‰ä¸€ä¸ªå­—æ®µçš„å•æ„é€ åŸºæœ¬ç±»å‹ã€‚ </p><br><p> æˆ‘ä¸ä¼šå†ç¼–å†™æœ‰å…³æ³›å‹çš„æ•™ç¨‹ï¼Œæ‰€ä»¥ç»§ç»­å­¦ä¹ ä»£ç ã€‚ </p><br><h1 id="pervaya-popytka"> ç¬¬ä¸€æ¬¡å°è¯• </h1><br><p> æˆ‘ä»¬å°†é€šè¿‡è¾…åŠ©ç±»<code>GHas</code> <code>Has</code>çš„<code>Generic</code>å®ç°çš„ç»å…¸æ–¹æ³•ï¼š </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GHas</span></span></span><span class="hljs-class"> part grecord </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">where</span></span></span></span> gextract :: grecord p -&gt; part</code> </pre> <br><p>  <code>grecord</code>æ˜¯æˆ‘ä»¬<code>record</code>ç±»å‹çš„<code>Generic</code>è¡¨ç¤ºå½¢å¼ã€‚ </p><br><p>  <code>GHas</code>å®ç°éµå¾ªæˆ‘ä»¬ä¸Šé¢æåˆ°çš„å½’çº³ç»“æ„ï¼š </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">instance</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GHas</span></span></span><span class="hljs-class"> record (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">K1</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">i</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">record</span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">where</span></span></span></span> gextract (<span class="hljs-type"><span class="hljs-type">K1</span></span> x) = x <span class="hljs-keyword"><span class="hljs-keyword">instance</span></span> <span class="hljs-type"><span class="hljs-type">GHas</span></span> part record =&gt; <span class="hljs-type"><span class="hljs-type">GHas</span></span> part (<span class="hljs-type"><span class="hljs-type">M1</span></span> it record) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> gextract (<span class="hljs-type"><span class="hljs-type">M1</span></span> x) = gextract x <span class="hljs-keyword"><span class="hljs-keyword">instance</span></span> <span class="hljs-type"><span class="hljs-type">GHas</span></span> part l =&gt; <span class="hljs-type"><span class="hljs-type">GHas</span></span> part (l :*: r) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> gextract (l :*: _) = gextract l <span class="hljs-keyword"><span class="hljs-keyword">instance</span></span> <span class="hljs-type"><span class="hljs-type">GHas</span></span> part r =&gt; <span class="hljs-type"><span class="hljs-type">GHas</span></span> part (l :*: r) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> gextract (_ :*: r) = gextract r</code> </pre> <br><ol><li>  <code>K1</code>å¯¹åº”äºåŸºæœ¬æƒ…å†µã€‚ </li><li>  <code>M1</code>æˆ‘ä»¬åœ¨ä»»åŠ¡ä¸­ä¸éœ€è¦çš„æ³›å‹ç‰¹å®šå…ƒæ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€å¿½ç•¥å®ƒä»¬å¹¶éå†å®ƒä»¬ã€‚ </li><li> äº§å“ç±»å‹<code>l :*: r</code>çš„ç¬¬ä¸€ä¸ªå®ä¾‹å¯¹åº”äºäº§å“çš„â€œå·¦â€éƒ¨åˆ†å…·æœ‰æˆ‘ä»¬éœ€è¦çš„ç±»å‹<code>part</code>çš„å€¼çš„æƒ…å†µï¼ˆå¯èƒ½æ˜¯é€’å½’çš„ï¼‰ã€‚ </li><li> ç±»ä¼¼åœ°ï¼Œäº§å“ç±»å‹<code>l :*: r</code>çš„ç¬¬äºŒç§æƒ…å†µå¯¹åº”äºäº§å“çš„â€œå³ä¾§â€éƒ¨åˆ†å…·æœ‰ç±»å‹<code>part</code>çš„æœŸæœ›å€¼ï¼ˆè‡ªç„¶ï¼Œä¹Ÿå¯èƒ½é€’å½’ï¼‰çš„æƒ…å†µã€‚ </li></ol><br><p> æˆ‘ä»¬ä»…åœ¨è¿™é‡Œæ”¯æŒäº§å“ç±»å‹ã€‚ æˆ‘çš„ä¸»è§‚å°è±¡æ˜¯<code>MonadReader</code>å’Œç±»ä¼¼ç±»çš„ä¸Šä¸‹æ–‡ä¸­ä¸ç»å¸¸ä½¿ç”¨é‡‘é¢ï¼Œå› æ­¤å¯ä»¥å¿½ç•¥å®ƒä»¬ä»¥ç®€åŒ–è€ƒè™‘ã€‚ </p><br><p> æ­¤å¤–ï¼Œè¯·æ³¨æ„æ¯ä¸ª <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.395ex" height="1.455ex" viewBox="0 -520.7 600.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/471052/&amp;usg=ALkJrhhFeDWUiCNSDS1LUz5mLoek5Yo3ag#MJMATHI-6E" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-1"> n </script> ä¸€å…ƒç±»å‹ä¹˜ç§¯<code>(a1, ..., an)</code>å¯ä»¥è¡¨ç¤ºä¸ºç»„æˆ <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi><mo>&amp;#x2212;</mo><mn>1</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.398ex" height="2.057ex" viewBox="0 -728.2 2323.9 885.9" role="img" focusable="false" style="vertical-align: -0.366ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/471052/&amp;usg=ALkJrhhFeDWUiCNSDS1LUz5mLoek5Yo3ag#MJMATHI-6E" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/471052/&amp;usg=ALkJrhhFeDWUiCNSDS1LUz5mLoek5Yo3ag#MJMAIN-2212" x="822" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/471052/&amp;usg=ALkJrhhFeDWUiCNSDS1LUz5mLoek5Yo3ag#MJMAIN-31" x="1823" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mo>âˆ’</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-2"> n-1 </script> å¯¹<code>(a1, (a2, (a3, (..., an))))</code> ï¼Œæ‰€ä»¥æˆ‘å…è®¸è‡ªå·±å°†äº§å“ç±»å‹ä¸å¯¹å…³è”ã€‚ </p><br><p> ä½¿ç”¨æˆ‘ä»¬çš„<code>GHas</code> ï¼Œæ‚¨å¯ä»¥ä¸º<code>Has</code>ç¼–å†™ä¸€ä¸ªä½¿ç”¨æ³›å‹çš„é»˜è®¤å®ç°ï¼š </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Has</span></span></span><span class="hljs-class"> part record </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">where</span></span></span></span> extract :: record -&gt; part <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> extract :: <span class="hljs-type"><span class="hljs-type">Generic</span></span> record =&gt; record -&gt; part extract = gextract . from</code> </pre> <br><p> åšå®Œäº† </p><br><p> è¿˜æ˜¯ä¸è¡Œ </p><br><h1 id="problema"> é—®é¢˜ </h1><br><p> å¦‚æœæˆ‘ä»¬å°è¯•ç¼–è¯‘æ­¤ä»£ç ï¼Œåˆ™å³ä½¿æ²¡æœ‰å°è¯•ä½¿ç”¨æ­¤å®ç°ï¼ˆé»˜è®¤æƒ…å†µä¸‹ä¹Ÿæ˜¯å¦‚æ­¤ï¼‰å¹¶æŠ¥å‘Šé‚£é‡Œçš„ä¸€äº›é‡å å®ä¾‹ï¼Œæˆ‘ä»¬ä»ä¼šçœ‹åˆ°å®ƒå¹¶æ²¡æœ‰è§£å†³é—®é¢˜ã€‚ æ›´ç³Ÿç³•çš„æ˜¯ï¼Œè¿™äº›å®ä¾‹åœ¨æŸäº›æ–¹é¢æ˜¯ç›¸åŒçš„ã€‚ ä¼¼ä¹æ˜¯æ—¶å€™å¼„æ¸…æ¥šHaskellä¸­è§£æå®ä¾‹çš„æœºåˆ¶å¦‚ä½•å·¥ä½œäº†ã€‚ </p><br><p> å¯ä»¥æœ‰ </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">instance</span></span></span><span class="hljs-class"> context =&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Foo</span></span></span><span class="hljs-class"> barPattern bazPattern </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">where</span></span></span></span> ...</code> </pre> <br><p>  ï¼ˆé¡ºä¾¿è¯´ä¸€å¥ï¼Œ <code>=&gt;</code>ä¹‹åçš„ä¸œè¥¿ç§°ä¸ºå®ä¾‹å¤´ã€‚ï¼‰ </p><br><p> è¯»ä¸º </p><br><blockquote> è®©æˆ‘ä»¬éœ€è¦ä¸º<code>Foo bar baz</code>é€‰æ‹©ä¸€ä¸ªå®ä¾‹ã€‚  <em>å¦‚æœ</em>æ»¡è¶³<code>context</code> ï¼Œ <em>åˆ™</em>å¯ä»¥é€‰æ‹©æ­¤å®ä¾‹ï¼Œå‰ææ˜¯<code>bar</code>å’Œ<code>baz</code>å¯¹åº”äº<code>barPattern</code>å’Œ<code>bazPattern</code> ã€‚ </blockquote><p> ä½†æ˜¯ï¼Œè¿™æ˜¯ä¸€ç§è¯¯è§£ï¼Œè€Œæ°æ°ç›¸åï¼š </p><br><blockquote> è®©æˆ‘ä»¬éœ€è¦ä¸º<code>Foo bar baz</code>é€‰æ‹©ä¸€ä¸ªå®ä¾‹ã€‚  <em>å¦‚æœ</em> <code>bar</code>å’Œ<code>baz</code>å¯¹åº”äº<code>barPattern</code>å’Œ<code>bazPattern</code> ï¼Œé‚£ä¹ˆæˆ‘ä»¬é€‰æ‹©æ­¤å®ä¾‹å¹¶å°†<code>context</code>æ·»åŠ åˆ°å¿…é¡»è§£æçš„å¸¸é‡åˆ—è¡¨ä¸­ã€‚ </blockquote><p> ç°åœ¨å¾ˆæ˜æ˜¾é—®é¢˜å‡ºåœ¨å“ªé‡Œã€‚ è®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹ä»¥ä¸‹ä¸¤ä¸ªå®ä¾‹ï¼š </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">instance</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GHas</span></span></span><span class="hljs-class"> part l =&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GHas</span></span></span><span class="hljs-class"> part (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">l</span></span></span><span class="hljs-class"> :*: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">r</span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">where</span></span></span></span> gextract (l :*: _) = gextract l <span class="hljs-keyword"><span class="hljs-keyword">instance</span></span> <span class="hljs-type"><span class="hljs-type">GHas</span></span> part r =&gt; <span class="hljs-type"><span class="hljs-type">GHas</span></span> part (l :*: r) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> gextract (_ :*: r) = gextract r</code> </pre> <br><p> å®ƒä»¬å…·æœ‰ç›¸åŒçš„å®ä¾‹å¤´ï¼Œæ‰€ä»¥éš¾æ€ªå®ƒä»¬ç›¸äº¤ï¼ æ­¤å¤–ï¼Œå®ƒä»¬éƒ½ä¸æ¯”å…¶ä»–æ›´å…·ä½“ã€‚ </p><br><p> æ­¤å¤–ï¼Œæ— æ³•ä»¥æŸç§æ–¹å¼ä¼˜åŒ–è¿™äº›å®ä¾‹ï¼Œä»¥ä½¿å…¶ä¸å†é‡å ã€‚ å¥½å§ï¼Œé™¤äº†æ·»åŠ æ›´å¤šçš„<code>GHas</code>å‚æ•°ã€‚ </p><br><h1 id="vyrazitelnye-tipy-speshat-na-pomosch"> è¡¨ç°åŠ›ç±»å‹æ€¥æ•‘ï¼ </h1><br><p> è§£å†³è¯¥é—®é¢˜çš„æ–¹æ³•æ˜¯é¢„å…ˆè®¡ç®—å‡ºæˆ‘ä»¬æ„Ÿå…´è¶£çš„å€¼çš„â€œè·¯å¾„â€ï¼Œå¹¶ä½¿ç”¨è¯¥è·¯å¾„æ¥æŒ‡å¯¼å®ä¾‹çš„é€‰æ‹©ã€‚ </p><br><p> ç”±äºæˆ‘ä»¬åŒæ„ä¸æ”¯æŒæ±‚å’Œç±»å‹ï¼Œå› æ­¤ä»å­—é¢ä¸Šçœ‹ï¼Œè·¯å¾„æ˜¯äº§å“ç±»å‹çš„å·¦è½¬æˆ–å³è½¬åºåˆ—ï¼ˆå³ï¼Œé€‰æ‹©ä¸€å¯¹ä¸­çš„ç¬¬ä¸€ä¸ªæˆ–ç¬¬äºŒä¸ªæˆåˆ†ï¼‰ï¼Œå¹¶åœ¨æ‰¾åˆ°æ‰€éœ€ç±»å‹åä»¥å¤§çš„â€œ HEREâ€æŒ‡é’ˆç»“å°¾ã€‚ æˆ‘ä»¬è¿™æ ·å†™ï¼š </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Path</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">L</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Path</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">R</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Path</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Here</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">deriving</span></span></span><span class="hljs-class"> (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Show</span></span></span><span class="hljs-class">)</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">ä¸¾ä¸ªä¾‹å­</b> <div class="spoiler_text"><p> è¯·è€ƒè™‘ä»¥ä¸‹ç±»å‹ï¼š </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DbConfig</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DbConfig</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dbAddress</span></span></span><span class="hljs-class"> :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DbAddress</span></span></span><span class="hljs-class"> , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dbUsername</span></span></span><span class="hljs-class"> :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Username</span></span></span><span class="hljs-class"> , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dbPassword</span></span></span><span class="hljs-class"> :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Password</span></span></span><span class="hljs-class"> } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppConfig</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppConfig</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dbConfig</span></span></span><span class="hljs-class"> :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DbConfig</span></span></span><span class="hljs-class"> , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">webServerConfig</span></span></span><span class="hljs-class"> :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WebServerConfig</span></span></span><span class="hljs-class"> , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cronConfig</span></span></span><span class="hljs-class"> :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CronConfig</span></span></span><span class="hljs-class"> }</span></span></code> </pre> <br><p> æ¥è‡ª<code>AppConfig</code>çš„è·¯å¾„çš„ä¸€äº›ç¤ºä¾‹æ˜¯ä»€ä¹ˆï¼Ÿ </p><br><ol><li> åˆ°<code>DbConfig</code> <code>L Here</code> ã€‚ </li><li> è‡³<code>WebServerConfig</code> <code>R (L Here)</code>ä¸º<code>R (L Here)</code> ã€‚ </li><li> è‡³<code>CronConfig</code> <code>R (R Here)</code>ä¸º<code>R (R Here)</code> ã€‚ </li><li> åˆ°<code>DbAddress</code> <code>L (L Here)</code> ã€‚ </li></ol></div></div><br><p> æœç´¢æ‰€éœ€ç±»å‹çš„å€¼å¯èƒ½æ˜¯ä»€ä¹ˆç»“æœï¼Ÿ æ˜¾è€Œæ˜“è§æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼šæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å®ƒï¼Œä¹Ÿå¯ä»¥æ‰¾ä¸åˆ°å®ƒã€‚ ä½†å®é™…ä¸Šï¼Œæ‰€æœ‰äº‹æƒ…éƒ½æœ‰äº›å¤æ‚ï¼šæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°è¿™ç§ç±»å‹çš„å¤šä¸ªå€¼ã€‚ æ˜¾ç„¶ï¼Œåœ¨è¿™ä¸ªæœ‰äº‰è®®çš„æ¡ˆä¾‹ä¸­ï¼Œæœ€æ˜æ™ºçš„è¡Œä¸ºä¹Ÿå°†æ˜¯é”™è¯¯æ¶ˆæ¯ã€‚ ç‰¹å®šå€¼çš„ä»»ä½•é€‰æ‹©éƒ½å°†å…·æœ‰ä¸€å®šç¨‹åº¦çš„éšæœºæ€§ã€‚ </p><br><p> ç¡®å®ï¼Œè¯·è€ƒè™‘æˆ‘ä»¬çš„æ ‡å‡†WebæœåŠ¡ç¤ºä¾‹ã€‚ å¦‚æœæœ‰äººæƒ³è¦è·å–ç±»å‹<code>(Host, Port)</code> ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥æ˜¯æ•°æ®åº“æœåŠ¡å™¨çš„åœ°å€è¿˜æ˜¯WebæœåŠ¡å™¨çš„åœ°å€ï¼Ÿ æœ€å¥½ä¸è¦å†’é™©ã€‚ </p><br><p> æ— è®ºå¦‚ä½•ï¼Œè®©æˆ‘ä»¬ç”¨ä»£ç è¡¨è¾¾è¿™ä¸€ç‚¹ï¼š </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MaybePath</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NotFound</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Conflict</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Found</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Path</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">deriving</span></span></span><span class="hljs-class"> (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Show</span></span></span><span class="hljs-class">)</span></span></code> </pre> <br><p> æˆ‘ä»¬å°†<code>NotFound</code>å’Œ<code>Conflict</code>åˆ†å¼€ï¼Œå› ä¸ºè¿™äº›æƒ…å†µçš„å¤„ç†æ–¹å¼æ ¹æœ¬ä¸åŒï¼šå¦‚æœåœ¨æˆ‘ä»¬äº§å“ç±»å‹çš„ä¸€ä¸ªåˆ†æ”¯ä¸­è·å¾—<code>NotFound</code> ï¼Œåˆ™åœ¨å…¶ä»–æŸä¸ªåˆ†æ”¯ä¸­æ‰¾åˆ°æ‰€éœ€çš„å€¼ä¸ä¼šæœ‰ä»»ä½•æŸå®³ï¼Œè€Œä»»ä½•åˆ†æ”¯ä¸­çš„<code>Conflict</code>ç«‹å³æ„å‘³ç€å·²æ»¡å¤±è´¥ã€‚ </p><br><p> ç°åœ¨ï¼Œæˆ‘ä»¬è€ƒè™‘äº§å“ç±»å‹çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼ˆæŒ‰ç…§æˆ‘ä»¬çš„åŒæ„ï¼Œæˆ‘ä»¬å°†å…¶è§†ä¸ºå¯¹ï¼‰ã€‚ å¦‚ä½•åœ¨å…¶ä¸­æ‰¾åˆ°æ‰€éœ€ç±»å‹çš„å€¼ï¼Ÿ æ‚¨å¯ä»¥åœ¨ä¸€å¯¹ä¸­çš„æ¯ä¸ªç»„ä»¶ä¸­é€’å½’è¿è¡Œæœç´¢<code>p2</code>åˆ†åˆ«è·å¾—ç»“æœ<code>p1</code>å’Œ<code>p2</code>ç„¶åä»¥æŸç§æ–¹å¼å°†å®ƒä»¬ç»„åˆã€‚ </p><br><p> ç”±äºæˆ‘ä»¬æ­£åœ¨è®¨è®ºçš„æ˜¯åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å‘ç”Ÿçš„æ—¶é—´ç±»å®ä¾‹çš„é€‰æ‹©ï¼Œå› æ­¤æˆ‘ä»¬å®é™…ä¸Šéœ€è¦è¿›è¡Œç¼–è¯‘æ—¶è®¡ç®—ï¼Œè¿™äº›è®¡ç®—åœ¨Haskellä¸­é€šè¿‡å¯¹ç±»å‹çš„è®¡ç®—æ¥è¡¨ç¤ºï¼ˆå³ä½¿ç±»å‹æ˜¯é€šè¿‡ä½¿ç”¨<code>DataKinds</code>åœ¨Universeä¸­æå‡ºçš„æœ¯è¯­æ¥<code>DataKinds</code> ï¼‰ã€‚ å› æ­¤ï¼Œæ­¤ç±»å…³äºç±»å‹çš„å‡½æ•°è¡¨ç¤ºä¸ºç±»å‹æ—ï¼š </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">family</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Combine</span></span></span><span class="hljs-class"> p1 p2 where </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Combine</span></span></span><span class="hljs-class"> ('</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Found</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">path</span></span></span><span class="hljs-class">) '</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NotFound</span></span></span><span class="hljs-class"> = '</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Found</span></span></span><span class="hljs-class"> ('</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">L</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">path</span></span></span><span class="hljs-class">) </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Combine</span></span></span><span class="hljs-class"> '</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NotFound</span></span></span><span class="hljs-class"> ('</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Found</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">path</span></span></span><span class="hljs-class">) = '</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Found</span></span></span><span class="hljs-class"> ('</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">R</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">path</span></span></span><span class="hljs-class">) </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Combine</span></span></span><span class="hljs-class"> '</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NotFound</span></span></span><span class="hljs-class"> '</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NotFound</span></span></span><span class="hljs-class"> = '</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NotFound</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Combine</span></span></span><span class="hljs-class"> _ _ = '</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Conflict</span></span></span></span></code> </pre> <br><p> æ­¤å‡½æ•°ä»£è¡¨å‡ ç§æƒ…å†µï¼š </p><br><ol><li> å¦‚æœå…¶ä¸­ä¸€ä¸ªé€’å½’æœç´¢æˆåŠŸï¼Œè€Œå¦ä¸€ä¸ª<code>NotFound</code> ï¼Œåˆ™æˆ‘ä»¬é‡‡ç”¨æˆåŠŸæœç´¢çš„è·¯å¾„ï¼Œå¹¶åœ¨æ­£ç¡®çš„æ–¹å‘é™„åŠ è½¬å¼¯ã€‚ </li><li> å¦‚æœä¸¤ä¸ªé€’å½’æœç´¢éƒ½ä»¥<code>NotFound</code>ç»ˆæ­¢ï¼Œé‚£ä¹ˆæ˜¾ç„¶æ•´ä¸ªæœç´¢éƒ½ä»¥<code>NotFound</code>ç»ˆæ­¢ã€‚ </li><li> åœ¨ä»»ä½•å…¶ä»–æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½ä¼šå¾—åˆ°<code>Conflict</code> ã€‚ </li></ol><br><p> ç°åœ¨ï¼Œæˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªTipeçº§å‡½æ•°æ¥è·å–è¦æŸ¥æ‰¾çš„<code>part</code> ï¼Œå¹¶ä»¥<code>Generic</code>è¡¨ç¤ºå½¢å¼æŸ¥æ‰¾<code>part</code> ï¼Œå¹¶è¿›è¡Œæœç´¢ï¼š </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">family</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Search</span></span></span><span class="hljs-class"> part (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">grecord</span></span></span><span class="hljs-class"> :: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">k</span></span></span><span class="hljs-class"> -&gt; *) :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MaybePath</span></span></span><span class="hljs-class"> where </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Search</span></span></span><span class="hljs-class"> part (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">K1</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">_</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">part</span></span></span><span class="hljs-class">) = '</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Found</span></span></span><span class="hljs-class"> '</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Here</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Search</span></span></span><span class="hljs-class"> part (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">K1</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">_</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">other</span></span></span><span class="hljs-class">) = '</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NotFound</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Search</span></span></span><span class="hljs-class"> part (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">M1</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">_</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">_</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">) = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Search</span></span></span><span class="hljs-class"> part x </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Search</span></span></span><span class="hljs-class"> part (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">l</span></span></span><span class="hljs-class"> :*: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">r</span></span></span><span class="hljs-class">) = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Combine</span></span></span><span class="hljs-class"> (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Search</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">part</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">l</span></span></span><span class="hljs-class">) (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Search</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">part</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">r</span></span></span><span class="hljs-class">) </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Search</span></span></span><span class="hljs-class"> _ _ = '</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NotFound</span></span></span></span></code> </pre> <br><p> è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å¾—åˆ°çš„å«ä¹‰ä¸æˆ‘ä»¬å…ˆå‰å¯¹<code>GHas</code>å°è¯•éå¸¸ç›¸ä¼¼ã€‚ è¿™æ˜¯æ„æ–™ä¹‹ä¸­çš„ï¼Œå› ä¸ºæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨é‡ç°æˆ‘ä»¬è¯•å›¾é€šè¿‡æ—¶é—´ç±»è¡¨è¾¾çš„ç®—æ³•ã€‚ </p><br><p>  <code>GHas</code> ï¼Œå‰©ä¸‹çš„å°±æ˜¯ä¸ºè¯¥ç±»æ·»åŠ ä¸€ä¸ªé™„åŠ å‚æ•°ï¼Œè¯¥å‚æ•°è´Ÿè´£å‰é¢æ‰¾åˆ°çš„è·¯å¾„ï¼Œå¹¶å°†ç”¨äºé€‰æ‹©ç‰¹å®šå®ä¾‹ï¼š </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GHas</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">path</span></span></span><span class="hljs-class"> :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Path</span></span></span><span class="hljs-class">) part grecord </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">where</span></span></span></span> gextract :: <span class="hljs-type"><span class="hljs-type">Proxy</span></span> path -&gt; grecord p -&gt; part</code> </pre> <br><p> æˆ‘ä»¬è¿˜ä¸º<code>gextract</code>æ·»åŠ äº†ä¸€ä¸ªé™„åŠ å‚æ•°ï¼Œä»¥ä¾¿ç¼–è¯‘å™¨å¯ä»¥ä¸ºç»™å®šè·¯å¾„é€‰æ‹©æ­£ç¡®çš„å®ä¾‹ï¼ˆä¸ºæ­¤å¿…é¡»åœ¨å‡½æ•°ç­¾åä¸­æåŠï¼‰ã€‚ </p><br><p> ç°åœ¨ç¼–å†™å®ä¾‹éå¸¸ç®€å•ï¼š </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">instance</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GHas</span></span></span><span class="hljs-class"> '</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Here</span></span></span><span class="hljs-class"> record (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">K1</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">i</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">record</span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">where</span></span></span></span> gextract _ (<span class="hljs-type"><span class="hljs-type">K1</span></span> x) = x <span class="hljs-keyword"><span class="hljs-keyword">instance</span></span> <span class="hljs-type"><span class="hljs-type">GHas</span></span> path part record =&gt; <span class="hljs-type"><span class="hljs-type">GHas</span></span> path part (<span class="hljs-type"><span class="hljs-type">M1</span></span> it record) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> gextract proxy (<span class="hljs-type"><span class="hljs-type">M1</span></span> x) = gextract proxy x <span class="hljs-keyword"><span class="hljs-keyword">instance</span></span> <span class="hljs-type"><span class="hljs-type">GHas</span></span> path part l =&gt; <span class="hljs-type"><span class="hljs-type">GHas</span></span> ('<span class="hljs-type"><span class="hljs-type">L</span></span> path) part (l :*: r) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> gextract _ (l :*: _) = gextract (<span class="hljs-type"><span class="hljs-type">Proxy</span></span> :: <span class="hljs-type"><span class="hljs-type">Proxy</span></span> path) l <span class="hljs-keyword"><span class="hljs-keyword">instance</span></span> <span class="hljs-type"><span class="hljs-type">GHas</span></span> path part r =&gt; <span class="hljs-type"><span class="hljs-type">GHas</span></span> ('<span class="hljs-type"><span class="hljs-type">R</span></span> path) part (l :*: r) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> gextract _ (_ :*: r) = gextract (<span class="hljs-type"><span class="hljs-type">Proxy</span></span> :: <span class="hljs-type"><span class="hljs-type">Proxy</span></span> path) r</code> </pre> <br><p> å®é™…ä¸Šï¼Œæˆ‘ä»¬åªæ˜¯æ ¹æ®æˆ‘ä»¬å…ˆå‰è®¡ç®—çš„è·¯å¾„ä¸­çš„<code>path</code>é€‰æ‹©æ‰€éœ€å®ä¾‹ã€‚ </p><br><p> ç°åœ¨å¦‚ä½•åœ¨<code>Has</code>ç±»ä¸­ç¼–å†™æˆ‘ä»¬çš„<code>extract :: record -&gt; part</code>å‡½æ•°çš„<code>default</code>å®ç°ï¼Ÿ æˆ‘ä»¬æœ‰å‡ ä¸ªæ¡ä»¶ï¼š </p><br><ol><li>  <code>record</code>å¿…é¡»å®ç°<code>Generic</code>ä»¥ä¾¿å¯ä»¥åº”ç”¨æ³›å‹æœºåˆ¶ï¼Œå› æ­¤æˆ‘ä»¬è·å¾—äº†<code>Generic record</code> ã€‚ </li><li>  <code>Search</code>å‡½æ•°åº”è¯¥åœ¨<code>record</code>æ‰¾åˆ°<code>part</code> ï¼ˆæˆ–è€…åœ¨<code>record</code>çš„<code>Generic</code>è¡¨ç¤ºå½¢å¼ä¸­ï¼Œè¡¨ç¤ºä¸º<code>Rep record</code> ï¼‰ã€‚ åœ¨ä»£ç ä¸­ï¼Œè¿™çœ‹èµ·æ¥æœ‰ç‚¹ä¸å¯»å¸¸ï¼š <code>Search part (Rep record) ~ 'Found path</code> ã€‚ æ­¤è®°å½•è¡¨ç¤ºé™åˆ¶ï¼Œå³<code>Search part (Rep record)</code>çš„ç»“æœ<code>Search part (Rep record)</code>åº”ç­‰äº<code>'Found path</code>æŸäº›<code>path</code>çš„<code>'Found path</code> â€ï¼ˆå®é™…ä¸Šï¼Œè¿™å¯¹æˆ‘ä»¬å¾ˆæœ‰è¶£ï¼‰ã€‚ </li><li> æˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿå°†<code>GHas</code>ä¸<code>part</code>ä¸€èµ·ä½¿ç”¨ï¼Œä»æœ€åä¸€æ­¥å¼€å§‹ï¼Œå®ƒæ˜¯<code>record</code>å’Œ<code>path</code>çš„é€šç”¨è¡¨ç¤ºå½¢å¼ï¼Œå®ƒå°†å˜æˆ<code>GHas path part (Rep record)</code> ã€‚ </li></ol><br><p> æˆ‘ä»¬å°†å¤šæ¬¡é‡åˆ°æœ€åä¸¤ä¸ªå¸¸é‡ï¼Œå› æ­¤å°†å®ƒä»¬æ”¾åœ¨å•ç‹¬çš„conståŒä¹‰è¯ä¸­å¾ˆæœ‰ç”¨ï¼š </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SuccessfulSearch</span></span></span><span class="hljs-class"> part record path = (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Search</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">part</span></span></span><span class="hljs-class"> (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Rep</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">record</span></span></span><span class="hljs-class">) ~ '</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Found</span></span></span><span class="hljs-class"> path, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GHas</span></span></span><span class="hljs-class"> path part (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Rep</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">record</span></span></span><span class="hljs-class">))</span></span></code> </pre> <br><p> æœ‰äº†è¿™ä¸ªåŒä¹‰è¯ï¼Œæˆ‘ä»¬å¾—åˆ° </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Has</span></span></span><span class="hljs-class"> part record </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">where</span></span></span></span> extract :: record -&gt; part <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> extract :: forall path. (<span class="hljs-type"><span class="hljs-type">Generic</span></span> <span class="hljs-title"><span class="hljs-title">record</span></span>, <span class="hljs-type"><span class="hljs-type">SuccessfulSearch</span></span> <span class="hljs-title"><span class="hljs-title">part</span></span> <span class="hljs-title"><span class="hljs-title">record</span></span> <span class="hljs-title"><span class="hljs-title">path</span></span>) =&gt; record -&gt; part extract = gextract (<span class="hljs-type"><span class="hljs-type">Proxy</span></span> :: <span class="hljs-type"><span class="hljs-type">Proxy</span></span> <span class="hljs-title"><span class="hljs-title">path</span></span>) . from</code> </pre> <br><p> ç°åœ¨ä¸€åˆ‡ï¼ </p><br><h1 id="ispolzovanie-obobschyonnogo-has"> ä½¿ç”¨é€šç”¨<code>Has</code> </h1><br><p> ä¸ºäº†äº†è§£æ‰€æœ‰è¿™äº›æƒ…å†µï¼Œæˆ‘ä»¬å°†ä¸ºå‡äººç¼–å†™ä¸€äº›é€šç”¨å®ä¾‹ï¼š </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">instance</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SuccessfulSearch</span></span></span><span class="hljs-class"> a (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a0</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a1</span></span></span><span class="hljs-class">) path =&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Has</span></span></span><span class="hljs-class"> a (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a0</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a1</span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">instance</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SuccessfulSearch</span></span></span><span class="hljs-class"> a (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a0</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a1</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a2</span></span></span><span class="hljs-class">) path =&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Has</span></span></span><span class="hljs-class"> a (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a0</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a1</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a2</span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">instance</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SuccessfulSearch</span></span></span><span class="hljs-class"> a (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a0</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a1</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a2</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a3</span></span></span><span class="hljs-class">) path =&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Has</span></span></span><span class="hljs-class"> a (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a0</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a1</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a2</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a3</span></span></span><span class="hljs-class">)</span></span></code> </pre> <br><p> åœ¨æ­¤ï¼Œ <code>SuccessfulSearch a (a0, ..., an) path</code>æ˜¯<code>a0, ..., an</code>æ°å¥½åœ¨<code>a0, ..., an</code>ä¹‹é—´å‘ç”Ÿçš„äº‹å®ã€‚ </p><br><p> æ„¿æˆ‘ä»¬ç°åœ¨æ‹¥æœ‰ç¾å¥½çš„æ—§æ—¶å…‰ </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppConfig</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppConfig</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dbConfig</span></span></span><span class="hljs-class"> :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DbConfig</span></span></span><span class="hljs-class"> , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">webServerConfig</span></span></span><span class="hljs-class"> :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WebServerConfig</span></span></span><span class="hljs-class"> , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cronConfig</span></span></span><span class="hljs-class"> :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CronConfig</span></span></span><span class="hljs-class"> }</span></span></code> </pre> <br><p> å¹¶ä¸”æˆ‘ä»¬è¦è¾“å‡º<code>Has DbConfig</code> ï¼Œ <code>Has WebServerConfig</code>å’Œ<code>Has CronConfig</code> ã€‚ åŒ…å«<code>DeriveGeneric</code>å’Œ<code>DeriveAnyClass</code>å¹¶æ·»åŠ æ­£ç¡®çš„<code>deriving</code>å£°æ˜å°±è¶³å¤Ÿäº†ï¼š </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppConfig</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppConfig</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dbConfig</span></span></span><span class="hljs-class"> :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DbConfig</span></span></span><span class="hljs-class"> , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">webServerConfig</span></span></span><span class="hljs-class"> :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WebServerConfig</span></span></span><span class="hljs-class"> , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cronConfig</span></span></span><span class="hljs-class"> :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CronConfig</span></span></span><span class="hljs-class"> } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">deriving</span></span></span><span class="hljs-class"> (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Generic</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Has</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DbConfig</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Has</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WebServerConfig</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Has</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CronConfig</span></span></span><span class="hljs-class">)</span></span></code> </pre> <br><p> æˆ‘ä»¬å¾ˆå¹¸è¿ï¼ˆæˆ–è€…æˆ‘ä»¬æœ‰è¶³å¤Ÿçš„è§è¯†ï¼‰å¯ä»¥å®‰æ’<code>Has</code>çš„å‚æ•°ï¼Œä»¥ä¾¿åµŒå¥—ç±»å‹çš„åç§°é¦–å…ˆå‡ºç°ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ä¾èµ–<code>DeriveAnyClass</code>æœºåˆ¶æ¥å‡å°‘<code>DeriveAnyClass</code> ã€‚ </p><br><h2 id="bezopasnost-prevyshe-vsego"> å®‰å…¨ç¬¬ä¸€ </h2><br><p> å¦‚æœæˆ‘ä»¬æ²¡æœ‰ä»»ä½•ç±»å‹æ€ä¹ˆåŠï¼Ÿ </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppConfig</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppConfig</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dbConfig</span></span></span><span class="hljs-class"> :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DbConfig</span></span></span><span class="hljs-class"> , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">webServerConfig</span></span></span><span class="hljs-class"> :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WebServerConfig</span></span></span><span class="hljs-class"> } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">deriving</span></span></span><span class="hljs-class"> (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Generic</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Has</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CronConfig</span></span></span><span class="hljs-class">)</span></span></code> </pre> <br><p> ä¸ï¼Œæˆ‘ä»¬åœ¨ç±»å‹å®šä¹‰æ—¶é‡åˆ°äº†ä¸€ä¸ªé”™è¯¯ï¼š </p><br><pre> <code class="plaintext hljs">Spec.hs:35:24: error: â€¢ Couldn't match type ''NotFound' with ''Found path0' arising from the 'deriving' clause of a data type declaration â€¢ When deriving the instance for (Has CronConfig AppConfig) | 35 | } deriving (Generic, Has CronConfig) | ^^^^^^^^^^^^^^</code> </pre> <br><p> ä¸æ˜¯æœ€å‹å¥½çš„é”™è¯¯æ¶ˆæ¯ï¼Œä½†æ˜¯å³ä½¿ä»é”™è¯¯æ¶ˆæ¯ä¸­æ‚¨ä»ç„¶å¯ä»¥äº†è§£é—®é¢˜æ‰€åœ¨ï¼šå¥‡æ•°é¢‘ç‡<code>NotFound</code>å¥‡æ•°é¢‘ç‡<code>CronConfig</code> ã€‚ </p><br><p> å¦‚æœæˆ‘ä»¬æœ‰å‡ ä¸ªç›¸åŒç±»å‹çš„å­—æ®µæ€ä¹ˆåŠï¼Ÿ </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppConfig</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppConfig</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">prodDbConfig</span></span></span><span class="hljs-class"> :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DbConfig</span></span></span><span class="hljs-class"> , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">qaDbConfig</span></span></span><span class="hljs-class"> :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DbConfig</span></span></span><span class="hljs-class"> , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">webServerConfig</span></span></span><span class="hljs-class"> :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WebServerConfig</span></span></span><span class="hljs-class"> , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cronConfig</span></span></span><span class="hljs-class"> :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CronConfig</span></span></span><span class="hljs-class"> } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">deriving</span></span></span><span class="hljs-class"> (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Generic</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Has</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DbConfig</span></span></span><span class="hljs-class">)</span></span></code> </pre> <br><p> ä¸ï¼Œä¸é¢„æœŸçš„ä¸€æ ·ï¼š </p><br><pre> <code class="plaintext hljs">Spec.hs:37:24: error: â€¢ Couldn't match type ''Conflict' with ''Found path0' arising from the 'deriving' clause of a data type declaration â€¢ When deriving the instance for (Has DbConfig AppConfig) | 37 | } deriving (Generic, Has DbConfig) | ^^^^^^^^^^^^</code> </pre> <br><p> ä¸€åˆ‡ä¼¼ä¹éƒ½å¾ˆå¥½ã€‚ </p><br><h1 id="podytozhivaya"> æ€»ç»“ä¸€ä¸‹ </h1><br><p> å› æ­¤ï¼Œæˆ‘ä»¬å°†å°è¯•ç®€è¦åœ°æå‡ºæ‰€æå‡ºçš„æ–¹æ³•ã€‚ </p><br><p> å‡è®¾æˆ‘ä»¬æœ‰æŸç§ç±»å‹çš„æ‰“å­—æœºï¼Œå¹¶ä¸”æˆ‘ä»¬æƒ³æ ¹æ®ä¸€äº›é€’å½’è§„åˆ™è‡ªåŠ¨æ˜¾ç¤ºå…¶å®ä¾‹ã€‚ ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥é¿å…æ­§ä¹‰ï¼ˆå¦‚ä¸‹æ‰€ç¤ºï¼šå¦‚æœè§„åˆ™ä¸é‡è¦ä¸”ä¸é€‚åˆè§£å†³å®ä¾‹çš„æ ‡å‡†æœºåˆ¶ï¼Œåˆ™é€šå¸¸è¡¨è¾¾è¿™äº›è§„åˆ™ï¼‰ï¼š </p><br><ol><li> æˆ‘ä»¬ä»¥å½’çº³æ•°æ®ç±»å‹<code>T</code>çš„å½¢å¼ç¼–ç é€’å½’è§„åˆ™<code>T</code> </li><li> æˆ‘ä»¬å°†åœ¨ç±»å‹ï¼ˆä»¥ç±»å‹æ—çš„å½¢å¼ï¼‰ä¸Šç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œä»¥åˆæ­¥è®¡ç®—è¯¥ç±»å‹<code>T</code>çš„å€¼<code>v</code> ï¼ˆæˆ–è€…å°±Haskellè€Œè¨€ï¼Œç±»å‹<code>T</code>ç±»å‹<code>v</code>å…¶ä¸­æ˜¯æˆ‘çš„ä»å±ç±»å‹ï¼‰ï¼Œå®ƒæè¿°äº†éœ€è¦é‡‡å–çš„å…·ä½“æ­¥éª¤é¡ºåºã€‚ </li><li> ä½¿ç”¨æ­¤<code>v</code>ä½œä¸º<code>Generic</code>å¸®åŠ©ç¨‹åºçš„é™„åŠ å‚æ•°ï¼Œå¯ä»¥ç¡®å®šç°åœ¨ä¸<code>v</code>å€¼åŒ¹é…çš„å®ä¾‹çš„ç‰¹å®šé¡ºåºã€‚ </li></ol><br><p> å¥½å§ï¼Œå°±æ˜¯è¿™æ ·ï¼ </p><br><p> åœ¨ä»¥ä¸‹æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶æ­¤æ–¹æ³•çš„ä¸€äº›ä¼˜é›…æ‰©å±•ï¼ˆä»¥åŠä¼˜é›…é™åˆ¶ï¼‰ã€‚ </p><br><p> å“¦æ˜¯çš„ è·Ÿè¸ªæˆ‘ä»¬çš„æ¦‚æ‹¬é¡ºåºå¾ˆæœ‰è¶£ã€‚ </p><br><ol><li> ä»<code>Env -&gt; Foo</code> ã€‚ </li><li> ä¸å¤Ÿç¬¼ç»Ÿï¼Œè¯·åœ¨<code>Reader Env</code> monadä¸­è¿›è¡Œæ€»ç»“ã€‚ </li><li> ä¸å¤Ÿé€šç”¨ï¼Œè¯·ä½¿ç”¨<code>MonadReader Env m</code>é‡å†™ã€‚ </li><li> ä¸å¤Ÿé€šç”¨ï¼Œé‡å†™<code>MonadReader rm, HasEnv r</code> ã€‚ </li><li> ä¸å¤Ÿé€šç”¨ï¼Œ <code>MonadReader rm, Has Env r</code>ç¼–å†™<code>MonadReader rm, Has Env r</code>å¹¶æ·»åŠ æ³›å‹ï¼Œä»¥ä¾¿ç¼–è¯‘å™¨åœ¨é‚£é‡Œæ‰§è¡Œæ‰€æœ‰æ“ä½œã€‚ </li><li> ç°åœ¨æ˜¯è§„èŒƒã€‚ </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN471052/">https://habr.com/ru/post/zh-CN471052/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN471042/index.html">ä½¿ç”¨pwnable.kr 25è§£å†³é—®é¢˜-OTP Linuxæ–‡ä»¶å¤§å°é™åˆ¶</a></li>
<li><a href="../zh-CN471044/index.html">Sass MediaScreen-å®šä¹‰CSSè®¾å¤‡</a></li>
<li><a href="../zh-CN471046/index.html">æ—¶å°šçš„é˜¿ç“¦éš†</a></li>
<li><a href="../zh-CN471048/index.html">React + Mobxï¼šæœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ</a></li>
<li><a href="../zh-CN471050/index.html">Dè¯­è¨€å‘å±•åŸºé‡‘èèµ„ï¼šæ–°å¹³å°å’Œæ–°èµ æ¬¾...</a></li>
<li><a href="../zh-CN471054/index.html">Longridå…³äºåŠ å¯†è´§å¸çš„é‡å­å¨èƒçš„ç°å®ä¸»ä¹‰å’Œâ€œ 2027å¹´é¢„è¨€â€é—®é¢˜</a></li>
<li><a href="../zh-CN471062/index.html">å¦‚ä½•æ•™çˆ±ä¸½ä¸ç®¡ç†æ‚¨çš„æ™ºèƒ½å®¶å±…ã€‚ YandexæŠ¥å‘Š</a></li>
<li><a href="../zh-CN471066/index.html">zipå­˜æ¡£æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥æ€ä¹ˆåš</a></li>
<li><a href="../zh-CN471070/index.html">ä¸ºç§»åŠ¨å¼€å‘äººå‘˜é€‰æ‹©å“ªç§æœåŠ¡å™¨è¯­è¨€...</a></li>
<li><a href="../zh-CN471072/index.html">ç”µæŠ¥ä¸­æœ‰å¤šå°‘å…‹ï¼Ÿ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>