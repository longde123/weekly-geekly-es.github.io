<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐ฉ๐ฝโ๐จ ๐ค ุงุฎุชุฑุงุน ููุชุจุฉ vusb ๐๏ธ ๐ง ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ููุฏูุฉ 


 ุจุนุฏ ูุฑุงุกุฉ ุงูุนููุงู ุ ูุฏ ููุดุฃ ุณุคุงู ููุทูู: ููุงุฐุง ุชุฏุฑุณ ูู ุงูููุช ุงูุญุงุถุฑ ุชูููุฐ ุจุฑูุงูุฌ USB ููุฎูุถ ุงูุณุฑุนุฉ ุนูุฏูุง ูููู ููุงู ูุฌููุนุฉ ูู ูุญุฏุงุช ุงูุชุญูู ุงูุฑุฎ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุงุฎุชุฑุงุน ููุชุจุฉ vusb</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460815/" style=";text-align:right;direction:rtl"><h2 id="vvedenie" style=";text-align:right;direction:rtl">  ููุฏูุฉ </h2><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ูุฑุงุกุฉ ุงูุนููุงู ุ ูุฏ ููุดุฃ ุณุคุงู ููุทูู: ููุงุฐุง ุชุฏุฑุณ ูู ุงูููุช ุงูุญุงุถุฑ ุชูููุฐ ุจุฑูุงูุฌ USB ููุฎูุถ ุงูุณุฑุนุฉ ุนูุฏูุง ูููู ููุงู ูุฌููุนุฉ ูู ูุญุฏุงุช ุงูุชุญูู ุงูุฑุฎูุตุฉ ุจุงุณุชุฎุฏุงู ูุญุฏุฉ ุงูุฃุฌูุฒุฉุ  ุงูุญูููุฉ ูู ุฃู ูุญุฏุฉ ุงูุฃุฌูุฒุฉ ุ ุงูุชู ุชุฎูู ูุณุชูู ุชุจุงุฏู ุงููุณุชููุงุช ุงูููุทููุฉ ุ ุชุญูู ุจุฑูุชูููู USB ุฅูู ููุน ูู ุงูุณุญุฑ.  ููู ุชุดุนุฑ ููู ูุนูู ูุฐุง "ุงูุณุญุฑ" ุ ูุง ููุฌุฏ ุดูุก ุฃูุถู ูู ุฅุนุงุฏุฉ ุฅูุชุงุฌู ูู ููุทุฉ ุงูุตูุฑ ุ ุจุฏุกูุง ูู ุงููุณุชูู ุงูุฃุฏูู. </p><br><p style=";text-align:right;direction:rtl">  ุชุญููููุง ููุฐู ุงูุบุงูุฉ ุ ุณูุญุงูู ุฌุนู ุฌูุงุฒูุง ูุชุธุงูุฑ ุจุฃูู USB-HID ุงุณุชูุงุฏูุง ุฅูู ุฌูุงุฒ ุงูุชุญูู ATmega8.  ุนูู ุนูุณ ุงูุฃุฏุจ ุงููุงุณุน ุงูุงูุชุดุงุฑ ุ ูู ููุชูู ูู ุงููุธุฑูุฉ ุฅูู ุงูููุงุฑุณุฉ ุ ูู ุงููุณุชูู ุงูุฃุฏูู ุฅูู ุงูุฃุนูู ุ ูู ุงููููุชูุฉ ุงูููุทููุฉ ุฅูู ุงูุงุณุชูุชุงุฌุงุช ุ ูููุชูู ุจู "ุงูุงุฎุชุฑุงุน" ูููุณ ุงููุตุทูุญ ุ ุจุนุฏ ูู ุฎุทูุฉ ูุชุญูู ููุง ุฅุฐุง ูุงูุช ุงูุดูุฑุฉ ุชุนูู ููุง ูู ูุชููุน.  ุจุดูู ูููุตู ุ ูุงุญุธุช ุฃููู ูุง ุฃุฎุชุฑุน ุจุฏููุงู ููุฐู ุงูููุชุจุฉ ุ ููููู ุฏุงุฆููุง ูุง ุฃุนูุฏ ุฅูุชุงุฌ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงููุตุฏุฑ ุงูุฎุงุตุฉ ุจูุง ุ ูุน ุงูุญูุงุธ ุนูู ุงููููู ุงูุฃุตูู ูุงูุฃุณูุงุก ูุฏุฑ ุงูุฅููุงู ุ ูุน ุชูุถูุญ ุณุจุจ ุนูู ูุฐุง ุงููุณู ุฃู ูุฐุง ุงููุณู.  ููุน ุฐูู ุ ูุฅู ุฃุณููุจ ูุชุงุจุฉ ุงูููุฏ ุงููุฃููู ุจุงููุณุจุฉ ูู ูุฎุชูู ุนู ุฃุณููุจ ูุคููู vusb.  ุนูู ุงูููุฑ ุ ุฃุนุชุฑู ุจุตุฏู ุฃูู ุจุงูุฅุถุงูุฉ ุฅูู ุงูุงูุชูุงู ุจุงูุฅูุซุงุฑ (ูุฅุฎุจุงุฑ ุงูุขุฎุฑูู ุนู ููุถูุน ุตุนุจ) ุ ูุฏู ุฃูุถูุง ูุตูุญุฉ ุฃูุงููุฉ - ุฏุฑุงุณุฉ ุงูููุถูุน ุจููุฑุฏู ูุงูุชูุงุท ุฃูุจุฑ ูุฏุฑ ูู ุงูููุงุท ุงูุฏูููุฉ ุจููุณู.  ููุชุฑุชุจ ุนูู ุฐูู ุฃูุถูุง ููุฏุงู ุจุนุถ ุงูููุงุท ุงููููุฉ ุ ุฃู ุนุฏู ุงููุดู ุนู ุจุนุถ ุงูููุถูุนุงุช ุจุดูู ูุงูู. </p><br><p style=";text-align:right;direction:rtl">  ูููู ุฃูุถู ููุฑูุฒ ุ ุญุงููุช ุชุณููุท ุงูุถูุก ุนูู ุงูุฃูุณุงู ุงูุชู ุชู ุชุบููุฑูุง ูุน ุงูุชุนูููุงุช ูุฅุฒุงูุชูุง ูู ุงูุฃูุณุงู ุงูุชู ูููุดุช ูู ููุช ุณุงุจู.  ูู ุงููุงูุน ุ ุณูููู ุงูููุฏ ุงููุตุฏุฑู ูู ุงููุตุฏุฑ ุงูุฑุฆูุณู ูููุนูููุงุช ุ ูุณูููู ุงููุต ุจุดุฑุญ ูุง ุชู ุงูููุงู ุจู ูููุงุฐุง ุ ููุฐูู ุงููุชูุฌุฉ ุงููุชููุนุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุฃูุงุญุธ ุฃูุถูุง ุฃู USB ููุฎูุถ ุงูุณุฑุนุฉ ููุท ูุนุชุจุฑ ุ ุญุชู ูู ุฏูู ุฐูุฑ ุ ูุง ูููุฒ ุฃูุซุฑ ุงูุฃุตูุงู ุนุงููุฉ ุงูุณุฑุนุฉ. </p><a name="habracut"></a><br><h2 id="shag-0-zhelezo-i-prochaya-podgotovka" style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 0. ุงูุญุฏูุฏ ูุบูุฑูุง ูู ุงูุชุญุถูุฑ </h2><br><p style=";text-align:right;direction:rtl">  ูุงุฎุชุจุงุฑ ุ ุฏุนูุง ูุฃุฎุฐ ููุญุฉ ุชุตุญูุญ ูุญููุฉ ุงูุตูุน ุชุนุชูุฏ ุนูู ATmega8 ูุน 12 ููุบุงููุฑุชุฒ ููุงุฑุชุฒ.  ูู ุฃุนุทู ูุฐุง ุงููุฎุทุท ุ ููู ููุงุณู ุชูุงููุง (ุฑุงุฌุน ูููุน vusb ุงูุฑุณูู) ุ ุงูุดูุก ุงููุญูุฏ ุงูุฐู ูุณุชุญู ุงูุฐูุฑ ูู ุงูุงุณุชูุชุงุฌุงุช ุงููุณุชุฎุฏูุฉ.  ูู ุญุงูุชู ุ ูุชูุงูู ุงูุฅุฎุฑุงุฌ D + ูุน PD2 ุ ูุงูุฅุฎุฑุงุฌ D- PD3 ุ ููุนูู ุงููุนูู ุนูู PD4.  ูู ุญูุซ ุงููุจุฏุฃ ุ ูููู ุชูุตูู ุงูููุงูู ููุณุญุจ ุฅูู ุงูุณูุทุฉ ุ ูููู ุงูุชุญูู ุงููุฏูู ูุจุฏู ุฃูุซุฑ ุงุชุณุงูุง ููููุง ูุน ุงููุนูุงุฑ. </p><br><p style=";text-align:right;direction:rtl">  ูุชู ุชูููุฑ ุทุงูุฉ 5 ูููุช ูู ููุตู USB ุ ูููู ูุง ููุชููุน ุฃูุซุฑ ูู 3.6 ูููุช ุนูู ุฎุทูุท ุงูุฅุดุงุฑุฉ (ููุงุฐุง ูุงู ูุฐุง ูุบุฒุง ุจุงููุณุจุฉ ูู).  ูุฐูู ุชุญุชุงุฌ ุฅูุง ุฅูู ุฎูุถ ููุฉ ูุญุฏุฉ ุงูุชุญูู ุ ุฃู ูุถุน ุซูุงุฆูุงุช ุฒููุฑ ุนูู ุฎุทูุท ุงูุฅุดุงุฑุฉ.  ุงุฎุชุฑุช ุงูุฎูุงุฑ ุงูุซุงูู ุ ูููู ุฅูู ุญุฏ ูุจูุฑ ูุง ููู. </p><br><p style=";text-align:right;direction:rtl">  ูุธุฑูุง ูุฃููุง "ูุฎุชุฑุน" ุงูุชูููุฐ ุ ุณูููู ูู ุงูุฌูุฏ ุฃู ูุฑู ูุง ูุญุฏุซ ูู ุฃุฏูุบุฉ ูุญุฏุฉ ุงูุชุญูู ุ ุฃู ุฃูู ุนูู ุงูุฃูู ููุงู ุญุงุฌุฉ ุฅูู ููุน ูู ูุนูููุงุช ุชุตุญูุญ ุงูุฃุฎุทุงุก.  ูู ุญุงูุชู ุ ูููุงู ูุคุดุฑุงู LED ุนูู PD6 ุ PD7 ุ ูุงูุฃูู ูู ุฐูู ุ UART on PD0 ุ PD1 ุ ุชู ุชููููููุง ุนูู 115200 ุ ุจุญูุซ ููููู ุงูุงุณุชูุงุน ุฅูู ุซุฑุซุฑุฉ ูุญุฏุฉ ุงูุชุญูู ูู ุฎูุงู ุดุงุดุฉ ุนุงุฏูุฉ ุฃู ุจุฑูุงูุฌ ุขุฎุฑ ููุนูู ูุน ูููุฐ COM: </p><br><pre style=";text-align:right;direction:rtl"><code class="bash hljs">$ screen /dev/ttyUSB0 115200</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฃูุถูุง ุ ุณูู ูุชุญูู ุงุณุชุฎุฏุงู ุฃุฏุงุฉ wharhar ูุน ุงููุญุฏุฉ ุงูููุทูุฉ ุงูููุงุณุจุฉ ุฅูู ุฃุฏุงุฉ ูููุฏุฉ ูุชุตุญูุญ ุฃุฎุทุงุก USB (ูุง ุชุจุฏุฃ ุฏุงุฆููุง ูู ุงููุฑุจุน ุ ูููู ุญู ูุซู ูุฐู ุงููุดููุงุช ููุน ุจูุฌุงุญ ูุจูุฑ ุนูู ุงูุฅูุชุฑูุช ูููุณ ูููุฉ ูุฐู ุงูููุงูุฉ). </p><br><p style=";text-align:right;direction:rtl">  ููุง ุณูููู ูู ุงููููู ุฅููุงู ููููุจุงูุช ุขุฎุฑ ูู ุงููุต ุนูู ูุตู ุงููุจุฑูุฌ ุ ูุงูุชุฑููุจุงุช ุ ูุฃุดูุงุก ุฃุฎุฑู ุ ูููู ูุฐุง ุจุงููุงุฏ ููุทูู.  ูุจุงููุซู ุ ูู ุฃุฑูุฒ ุนูู ุงูุฅุนุฏุงุฏุงุช ุงูุทุฑููุฉ ุบูุฑ ุงููุฑุชุจุทุฉ ุจู USB.  ุฅุฐุง ูู ูุณุชุทุน ุฃุญุฏ ูุนุฑูุฉ ุฐูู ุ ููู ูู ุงูุณุงุจู ูุฃูุงูู ุงูุฏุฎูู ูู ุฃุญุงุณูุณ ุจุฑูุงูุฌ USBุ </p><br><p style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุดูุฑุฉ ุงููุตุฏุฑ ูุฌููุน ุงูุฎุทูุงุช ูุชุงุญุฉ ุนูู ุฌูุซุจ.</a> </p><br><h2 id="shag-1-prinimaem-hot-chto-to" style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 1. ูุจูู ูุง ูุง ููู ุนู ุดูุก </h2><br><p style=";text-align:right;direction:rtl">  ููููุง ูููุซุงุฆู ุ ูุฏุนู USB ุนุฏุฉ ุณุฑุนุงุช ุซุงุจุชุฉ ุ ูููุง AVR ุณุชุณุญุจ ููุท ุฃุฏูู: 1.5 ููุบุงุจุช ูู ุงูุซุงููุฉ.  ูุชู ุชุญุฏูุฏู ุจูุงุณุทุฉ ุงูููุงูู ุณุญุจ ูุงูุงุชุตุงูุงุช ุงููุงุญูุฉ.  ุจุงููุณุจุฉ ููุชุฑุฏุฏ ุงูุฐู ูุฎุชุงุฑู ุ ูุฌุจ ุนูู ุงูููุงูู ุชูุตูู D- ูุน ูุตุฏุฑ ุทุงูุฉ 3.3 ูููุช ูุฃู ูููู ูู ูููุฉ ุงุณููุฉ ุชุจูุบ 1.5 ูููู ุฃูู ุ ููู ูู ุงูููุงุฑุณุฉ ุงูุนูููุฉ ูููู ุชูุตููู ุจู +5 ูููุช ููููู ุฃู ุชุชุบูุฑ ุงููููุฉ ุงูุงุณููุฉ ููููุงู.  ูุน ุชุฑุฏุฏ ุชุญูู ูู 12 ููุบุงููุฑุชุฒ ุ ููุท 8 ุฏูุฑุงุช ุนูู ูุฏุงุฑ ุงูุณุงุนุฉ ููู ุจุช.  ูู ุงููุงุถุญ ุฃู ูุฐู ุงูุฏูุฉ ูุงูุณุฑุนุฉ ูุง ูููู ุชุญูููููุง ุฅูุง ูู ุฃุฏุงุฉ ุงูุชุฌููุน ุ ูุฐูู ุณููุชุญ ููู drvasm.S.  ูุฐุง ูุนูู ุฃูุถูุง ุงูุญุงุฌุฉ ุฅูู ุงุณุชุฎุฏุงู ููุงุทุนุฉ ูููุจุถ ุนูู ุจุฏุงูุฉ ุจุงูุช.  ุฃูุง ุณุนูุฏ ูุฃู ุงูุจุงูุช ุงูุฃูู ุงูุฐู ูุชู ุฅุฑุณุงูู ุนุจุฑ USB ูู ููุณู ุฏุงุฆููุง ุ SYNC ุ ูุฐูู ุฅุฐุง ูุตูุช ุฅูู ุงูุจุฏุงูุฉ ุ ููุง ุจุฃุณ ุจุฐูู.  ูุชูุฌุฉ ูุฐูู ุ ูู ุจุฏุงูุฉ ุงูุจุงูุช ุฅูู ููุงูุชู ุ ูุชู ุฅุฌุฑุงุก 64 ุฏูุฑุฉ ููุท ูู ูุญุฏุฉ ุงูุชุญูู (ูู ุงููุงูุน ุ ูููู ุงููุงูุด ุฃุตุบุฑ) ุ ูุฐูู ูุฌุจ ุนุฏู ุงุณุชุฎุฏุงู ุงูููุงุทุนุงุช ุงูุฃุฎุฑู ุบูุฑ ุงูุชุงุจุนุฉ ูู USB. </p><br><p style=";text-align:right;direction:rtl">  ูุจุงุดุฑุฉ ูุถุน ุงูุชูููู ูู ููู ูููุตู usbconfig.h.  ููุงู ุณูุชู ุชุนููู ุงููุณุงููุฑ ุงููุณุคููุฉ ุนู USB ุ ููุฐูู ุงูุจุชุงุช ูุงูุซูุงุจุช ูุงูุณุฌูุงุช ุงููุณุชุฎุฏูุฉ. </p><br><blockquote style=";text-align:right;direction:rtl">  <strong>ุฅุฏุฑุงุฌ ุงููุธุฑู</strong> <br>  ูุชู ุงูููู ุนุจุฑ USB ูู ุญุฒู ูู ุนุฏุฉ ุจุงูุช ูู ูู ูููุง.  ุงูุจุงูุช ุงูุฃูู ูู ุฏุงุฆููุง ุจุงูุช ุชุฒุงูู SYNC ุ ูุณุงูู 0b10000000 ุ ูุงูุซุงูู ูู ูุนุฑู ุงูุจุงูุช ูุญุฒูุฉ PID.  ููุชูู ููู ูู ุจุงูุช ูู ุงูุจุชุฉ ุงูุฃูู ุฏูุงูุฉ ุฅูู ุงูุจุชุฉ ุงูุฃูุซุฑ ุฃูููุฉ (ูุฐุง ููุณ ุตุญูุญูุง ุชูุงููุง ุ ูููู ูู vusb ูุชู ุชุฌุงูู ูุฐู ุงูุฏูุฉ ูู ููุงู ุขุฎุฑ) ุจุงุณุชุฎุฏุงู ุชุดููุฑ NRZI.  ุชุชููู ูุฐู ุงูุทุฑููุฉ ูู ุญูููุฉ ุฃู ุงูุตูุฑ ุงูููุทูู ูุชู ุฅุฑุณุงูู ุนู ุทุฑูู ุชุบููุฑ ุงููุณุชูู ุงูููุทูู ุฅูู ุงูุงุชุฌุงู ุงููุนุงูุณ ุ ููุชู ุฅุฑุณุงู ุงููุญุฏุฉ ุงูููุทููุฉ ุนู ุทุฑูู ุนุฏู ุงูุชุบููุฑ.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุชู ุชูููุฑ ุงูุญูุงูุฉ ูู desync (ุงูุชู ูู ูุณุชุฎุฏููุง ุ ูููู ูุฌุจ ุฃุฎุฐูุง ูู ุงูุงุนุชุจุงุฑ) ููุตุฏุฑ ุงูุฅุดุงุฑุฉ ูุงููุณุชูุจู: ุฅุฐุง ูุงูุช ููุงู ุณุช ูุญุฏุงุช ูุชุชุงููุฉ ูู ุงูุชุณูุณู ุงููุฑุณูู ุ ุฃู ุฃู ุญุงูุฉ ุงููุทุงุฑูู ูุง ุชุชุบูุฑ ููุฏุฉ ุณุช ูุชุฑุงุช ูุชุชุงููุฉ ุ ุชุชู ุฅุถุงูุฉ ุงูููุงุจ ูุณุฑู ุฅูู ุงูุฅุฑุณุงู ุ ููุง ูู ููุชูู ุงูุตูุฑ.  ูุจุงูุชุงูู ุ ูููู ุฃู ูููู ุญุฌู ุงูุจุงูุช 8 ุฃู 9 ุจุช. <br>  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฃูุถูุง ุฅูู ุฃู ุฎุทูุท ุงูุจูุงูุงุช ูู USB ุชูุงุถููุฉ ุ ุฃู ุนูุฏูุง ุชููู + D ูุฑุชูุนุฉ ุ ุชููู D- ููุฎูุถุฉ (ุชุณูู ูุฐู ุงูุญุงูุฉ K) ูุงูุนูุณ (J-state).  ูุชู ุฐูู ูุชุญุณูู ููุงุนุฉ ุงูุถูุถุงุก ุนูุฏ ุงูุชุฑุฏุฏ ุงูุนุงูู.  ุตุญูุญ ุ ููุงู ุงุณุชุซูุงุก: ูุชู ุฅุฑุณุงู ุงูุฅุดุงุฑุฉ ูู ููุงูุฉ ุงูุญุฒูุฉ (ูุทูู ุนูููุง SE0) ุนู ุทุฑูู ุณุญุจ ููุง ุฎุทูุท ุงูุฅุดุงุฑุฉ ุฅูู ุงูุฃุฑุถ (D + = D- = 0).  ููุงู ููุนุงู ูู ุงูุฅุดุงุฑุงุช ุงููุฑุณูุฉ ุนู ุทุฑูู ุงูุถุบุท ุงูููุฎูุถ ุนูู ุงูุฎุท D + ูุงูุฌูุฏ ุงูุนุงูู ุนูู ุงูุฎุท D + ูุฃููุงุช ูุฎุชููุฉ.  ุฅุฐุง ูุงู ุงูููุช ุตุบูุฑุงู (ุทูู ุจุงูุช ูุงุญุฏ ุฃู ุฃุทูู ููููุงู) ููุฐุง ูู ุงูุฎููู ุ ูููุฉ ูุคูุชุฉ ุจูู ุงูุญุฒู ุ ูุฅุฐุง ูุงูุช ูุจูุฑุฉ ุ ูุฅุนุงุฏุฉ ุชุนููู ุฅุดุงุฑุฉ. </blockquote><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ูููู ูุงูู ุงูุญุฑูุฉ ุนูู ุฒูุฌ ุชูุงุถูู ุ ุฏูู ุญุณุงุจ ุงูุญุงูุฉ ุงูุบุฑูุจุฉ ูู SE0 ุ ููููุง ูู ูููุฑ ูููุง ุจุนุฏ.  ูุฐูู ูุชุญุฏูุฏ ุญุงูุฉ ูุงูู USB ุ ูุญุชุงุฌ ุฅูู ุณุทุฑ ูุงุญุฏ ููุท ุ D + ุฃู D-.  ุฅูู ุญุฏ ูุจูุฑ ุ ูุง ููุฌุฏ ูุฑู ุจูู ูุง ูุฌุจ ุงุฎุชูุงุฑู ุ ูููู ูู ุฃุฌู ุงูุชุญุฏูุฏ ุ ุฏุน D- ูููู. </p><br><p style=";text-align:right;direction:rtl">  ูููู ุชุญุฏูุฏ ุจุฏุงูุฉ ุงูุญุฒูุฉ ูู ุฎูุงู ุชููู ุจุงูุช SYNC ุจุนุฏ ุฎููู ุทููู.  ุชุชูุงูู ุญุงูุฉ ุงูุฎููู ูุน ุงูุณุฌู 1 ุนูู ุงูุฎุท D (ููู ุฃูุถูุง ุงูุญุงูุฉ J) ุ ูุจุงูุชุฉ SYNC ูู 0b100000 ุ ููููุง ุชูุชูู ูู ุงูุจุชุฉ ุงูุฃูู ุฃูููุฉ ุฅูู ุงูุฃูุซุฑ ุฃูููุฉ ุ ุนูุงูุฉ ุนูู ุฐูู ุ ูุชู ุชุฑููุฒูุง ูู NRZI ุ ุฃู ูุนูู ูู ุตูุฑ ุงูููุงุจ ุงูุฅุดุงุฑุฉ ุ ููุณููุฉ ูุงุญุฏุฉ ุงูุญูุงุธ ุนูู ููุณ ุงููุณุชูู.  ูุจุงูุชุงูู ูุฅู ุชุณูุณู ุงูุญุงูุงุช D- ุณูููู ุนูู ุงููุญู ุงูุชุงูู: </p><br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><thead><tr><th>  ุจุงูุช </th><th>  ุฎุงูู </th><th>  SYNC </th><th>  PID </th></tr></thead><tbody><tr><td>  USB </td><td>  1..1 </td><td>  00000001 </td><td>  ุุุุุุุุ </td></tr><tr><td>  D- </td><td>  1..1 </td><td>  01010100 </td><td>  ุุุุุุุุ </td></tr></tbody></table></div><br><p style=";text-align:right;direction:rtl">  ูู ุงูุณูู ุงูุชุดุงู ุจุฏุงูุฉ ุงูุญุฒูุฉ ุนูู ุญุงูุฉ ุงูุณููุท ุ ูุณูููู ุจุชูููู ููุงุทุนุฉ ุนูููุง.  ูููู ูุงุฐุง ูู ูุงูุช ูุญุฏุฉ ุงูุชุญูู ูุดุบููุฉ ุฃุซูุงุก ุจุฏุก ุงูุงุณุชูุจุงู ููู ุชุชููู ูู ุงูุฏุฎูู ุฅูู ุงูููุงุทุนุฉ ุนูู ุงูููุฑุ  ูุชุฌูุจ ููุฏุงู ุนุฏุฏ ูุฑุงุช ุงูุชุชุจุน ูู ูุซู ูุฐุง ุงููููู ุ ูุณุชุฎุฏู ุจุงูุช SYNC ููุบุฑุถ ุงูููุตูุฏ ููู.  ููู ุชุชุฃูู ุจุงููุงูู ูู ุฌุจูุงุช ุนูู ุญุฏูุฏ ุงูุจุชุงุช ุ ุจุญูุซ ูููููุง ุฃู ููุชุธุฑ ุฃุญุฏูุง ุ ุซู ูุตููุง ุขุฎุฑ ุ ูููุชูู ูุจุงุดุฑุฉ ุฅูู ููุชุตู ุงูุชุงูู.  ููุน ุฐูู ุ ูุฅู ุงูุชุธุงุฑ "ุจุนุถ" ุงูุฌุจูุฉ ููุณ ููุฑุฉ ุฌูุฏุฉ ุ ูุฃููุง ูุง ูุญุชุงุฌ ููุท ุฅูู ุงูุฏุฎูู ูู ููุชุตู ุงูุตูุฑุฉ ุ ูููู ุฃูุถูุง ููุนุฑูุฉ ุงูุดูุก ุงูุฐู ุญุตููุง ุนููู ูู ุงููุชูุฌุฉ.  ูููุญุตูู ุนูู SYNC ูุฐุง ููุงุณุจ ุฃูุถูุง: ูุญุชูู ุนูู ูุทุนุชูู ุตูุฑูุชูู ุนูู ุงูุชูุงูู ูู ุงูููุงูุฉ (ููุง K-state).  ููุง ุณููุจุถ ุนูููู.  ูุฐูู ุ ูู ููู drvasm.S ุ ุชุธูุฑ ูุทุนุฉ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูู ุฅุฏุฎุงู ุงูููุงุทุนุฉ ุฅูู foundK.  ุนูุงูุฉ ุนูู ุฐูู ุ ูุธุฑูุง ูููุช ุงูุชุญูู ูู ุญุงูุฉ ุงููููุฐ ุ ูุงูุงูุชูุงู ุบูุฑ ุงููุดุฑูุท ููุง ุฅูู ุฐูู ุ ูุฅููุง ูู ูุตู ุฅูู ุงูุนูุงูุฉ ูู ุจุฏุงูุฉ ุงูุจุช ุ ูููู ููุท ูู ุงูููุชุตู.  ูููู ูู ุบูุฑ ุงููุฌุฏู ุงูุชุญูู ูู ุงูุดูุก ููุณู ุ ูุฃููุง ูุนุฑู ุจุงููุนู ูุนูุงูุง.  ูุฐูู ุ ููุชุธุฑ 8 ุฏูุฑุงุช ุนูู ูุฏุงุฑ ุงูุณุงุนุฉ (ุญุชู ุงูุขู nop'ami ูุงุฑุบุฉ ุญุชู ุงูุขู) ูููุญุต ุงูุจุช ุงูุชุงูู.  ุฅุฐุง ูุงู ุงูุฑูู ุตูุฑูุง ุฃูุถูุง ุ ููุฏ ูุฌุฏูุง ููุงูุฉ SYNC ููููููุง ุงูุงูุชูุงู ุฅูู ุงุณุชูุจุงู ุฃุฌุฒุงุก ูุจูุฑุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงููุงูุน ุ ุชู ุชุตููู ุฌููุน ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุฅุถุงููุฉ ููุฑุงุกุฉ ูุญุฏุชู ุจุงูุช ุฃุฎุฑููู ูุน ุงูุฅุฎุฑุงุฌ ุงูุชุงูู ุฅูู UART.  ุญุณููุง ุ ูู ุงูุชุธุงุฑ ุญุงูุฉ SE0 ุญุชู ูุง ุชุฏุฎู ุจุทุฑูู ุงูุฎุทุฃ ูู ุงูุญุฒูุฉ ุงูุชุงููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ููููู ุงูุขู ุชุฑุฌูุฉ ุงูุดูุฑุฉ ุงููุงุชุฌุฉ ููุนุฑูุฉ ูุง ููุจูู ุฌูุงุฒูุง.  ุดุฎุตูุง ุ ูุฏู ุงูุชุณูุณู ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">4E 55 00 00 4E 55 00 00 4E 55 00 00 4E 55 00 00 4E 55 00 00</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุฐูุฑ ุฃููุง ูุฎุฑุฌ ุจูุงูุงุช ุฃูููุฉ ุ ุจุงุณุชุซูุงุก ุงูุฃุตูุงุฑ ุงูุฅุถุงููุฉ ููู ุชุดููุฑ NRZI.  ุฏุนูุง ูุญุงูู ูู ุดูุฑุฉ ูุฏูููุง ุ ุจุฏุกูุง ุจุงูุจุช ุงููููู: </p><br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td></td><td>  4E </td><td></td></tr><tr><td>  NRZI </td><td>  01001110 </td><td>  0 (ุจุช ุงูุณุงุจูุฉ) </td></tr><tr><td>  ุจุงูุช </td><td>  00101101 </td><td></td></tr><tr><td></td><td>  2D </td><td></td></tr></tbody></table></div><br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td></td><td>  55 </td><td></td></tr><tr><td>  NRZI </td><td>  01010101 </td><td>  0 (ุจุช ุงูุณุงุจูุฉ) </td></tr><tr><td>  ุจุงูุช </td><td>  00000000 </td><td></td></tr><tr><td></td><td>  00 </td><td></td></tr></tbody></table></div><br><p style=";text-align:right;direction:rtl">  ูุง ูุนูู ููู ุชุดููุฑ ุงูุฃุตูุงุฑ ุ ุญูุซ ูุง ูููู ุชุถููู 16 ูููุฉ ูุชุทุงุจูุฉ ูู ุตู ูุงุญุฏ ูู ุงูุฑุฒูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุจุงูุชุงูู ุ ุชูููุง ูู ูุชุงุจุฉ ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ ุงูุชู ุชูุจู ุฃูู ูุญุฏุชู ุจุงูุช ูู ุงูุญุฒูุฉ ุ ุนูู ุงูุฑุบู ูู ุฐูู ุญุชู ุงูุขู ุฏูู ูู ุงูุชุดููุฑ. </p><br><h2 id="shag-2-demo-versiya-nrzi" style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 2. ุงูุฅุตุฏุงุฑ ุงูุชุฌุฑูุจู ูู NRZI </h2><br><p style=";text-align:right;direction:rtl">  ุญุชู ูุง ุชุชู ุฅุนุงุฏุฉ ุงูุชุฑููุฒ ูุฏูููุง ุ ููููู ุชูููู ูุฐุง ุจูุญุฏุฉ ุงูุชุญูู ููุณูุง: ุชุนูู ุนูููุฉ XOR ุนูู ูุง ุชุญุชุงุฌู ุจุงูุถุจุท ุ ุนูู ุงูุฑุบู ูู ุฃู ุงููุชูุฌุฉ ูุนููุณุฉ ุ ูุฐูู ุฃุถู ุงูููุงุจูุง ุขุฎุฑ ุจุนุฏ ุฐูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">mov temp, shift lsl shift eor temp, shift com temp rcall uart_hex</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงููุชูุฌุฉ ูุชููุนุฉ ุชูุงููุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">2D 00 FF FF 2D 00 FF FF 2D 00 FF FF 2D 00 FF FF 2D 00 FF FF</code> </pre> <br><h2 id="shag-3-izbavlyaemsya-ot-cikla-priema-bayta" style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 3. ุชุฎูุต ูู ุจุงูุช ุชููู ุฏูุฑุฉ </h2><br><p style=";text-align:right;direction:rtl">  ููุฃุฎุฐ ุฎุทูุฉ ุตุบูุฑุฉ ุฃุฎุฑู ูููุณุน ุฏุงุฆุฑุฉ ุงุณุชูุงู ุงูุจุงูุชุฉ ุงูุฃููู ูู ุฑูุฒ ุฎุทู.  ูุจุงูุชุงูู ุงุชุถุญ ุงููุซูุฑ ูู ุงูุบุซูุงู ุ ูููุงู ุญุงุฌุฉ ููุท ูุงูุชุธุงุฑ ุจุฏุงูุฉ ุงูุจุช ุงูููุจู.  ุจุฏูุงู ูู ุจุนุถูุง ุ ููููู ุงุณุชุฎุฏุงู ูุญุฏุฉ ูู ุชุฑููุฒ NRZI ุ ูุณูู ูููู ุงูุขุฎุฑูู ูู ูุชูุงูู ุงููุฏ ูุงุญููุง. </p><br><p style=";text-align:right;direction:rtl">  ุงููุชูุฌุฉ ูู ุงูุฎูุงุฑ ุงูุณุงุจู ูุง ุชุฎุชูู. </p><br><h2 id="shag-4-chitaem-v-bufer" style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 4. ูุฑุงุกุฉ ุฅูู ุงููุฎุฒู ุงููุคูุช </h2><br><p style=";text-align:right;direction:rtl">  ุชุนุชุจุฑ ุงููุฑุงุกุฉ ูู ุณุฌูุงุช ูููุตูุฉ ุ ุจุทุจูุนุฉ ุงูุญุงู ุ ุณุฑูุนุฉ ูุฌูููุฉ ุ ูููู ุนูุฏูุง ูููู ููุงู ุงููุซูุฑ ูู ุงูุจูุงูุงุช ุ ููู ุงูุฃูุถู ุงุณุชุฎุฏุงู ุฅุฏุฎุงู ูุฎุฒู ูุคูุช ููุฌูุฏ ูู ููุงู ูุง ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู.  ููููุงู ุจุฐูู ุ ุณูุนูู ูุฌููุนุฉ ูู ุงูุญุฌู ุงููุงูู ูู ุงูุฑุฆูุณู ุ ููู ุงูููุงุทุนุฉ ุณููุชุจ ููุงู. <br>  ุฅุฏุฑุงุฌ ุงููุธุฑู </p><br><p style=";text-align:right;direction:rtl">  ูููู ุงูุญุฒูุฉ ูู USB ููุญุฏ ููุชููู ูู ุงูุฃุฌุฒุงุก ุงูุชุงููุฉ: ุจุงูุช SYNC ุ ุจุงูุช PID + CHECK (ุญููุงู ูู 4 ุจุช ููู ููููุง) ุ ุญูู ุจูุงูุงุช (ุฃุญูุงููุง 11 ุจุช ุ ููู ูู ูุซูุฑ ูู ุงูุฃุญูุงู ุฑูู ุชุนุณูู ููุจุงูุช 8 ุจุช) ููุฌููุน ุชุญูู CRC ุฅูุง 5 ( ูุญูู ุงูุจูุงูุงุช 11 ุจุช) ุ ุฃู 16 (ููุจุงูู) ุจุช.  ุฃุฎูุฑูุง ุ ููุงูุฉ ูุคุดุฑ ุงูุฑุฒู (EOP) ุนุจุงุฑุฉ ุนู ุจุชุชูู ูุคูุชุชูู ุ ููู ูุฐุง ูู ูุนุฏ ุจูุงูุงุช. </p><br><p style=";text-align:right;direction:rtl">  ูุจู ุงูุนูู ูุน ุงููุตูููุฉ ุ ูุง ุชุฒุงู ุจุญุงุฌุฉ ุฅูู ุชูููู ุงูุณุฌูุงุช ุ ู nop ุงููุฌุงูู ูุจู ุงูุจุชุฉ ุงูุฃููู ูุง ูููู ูุฐูู.  ูุฐูู ุ ุณูุชุนูู ุนููู ูุถุน ูุฑุงุกุฉ ุงูุจุชุงุช ุงูุฃูููู ูู ุงููุณู ุงูุฎุทู ูู ุงูุดูุฑุฉ ุ ุจูู ุงูุฃูุฑูู ุงููุฐูู ุณูููู ุจุฅุฏุฎุงู ุฑูุฒ ุงูุชููุฆุฉ ูููุง ุ ุซู ุงูุงูุชูุงู ุฅูู ููุชุตู ุฏูุฑุฉ ุงููุฑุงุกุฉ ุ ุฅูู ุชุณููุฉ rxbit2.  ุงูุญุฏูุซ ุนู ุญุฌู ุงูุนุงุฒูุฉ.  ููููุง ูููุซุงุฆู ุ ููู ุงููุณุชุญูู ูู ุญุฒูุฉ ูุงุญุฏุฉ ููู ุฃูุซุฑ ูู 8 ุจุงูุชุงุช ูู ุงูุจูุงูุงุช.  ูุถูู ุฎุฏูุฉ ุจุงูุช PID ู CRC16 ุ ูุญุตู ุนูู ุญุฌู ุงููุฎุฒู ุงููุคูุช 11 ุจุงูุช.  ูู ุชุชู ูุชุงุจุฉ ุจุงูุช SYNC ูุญุงูุฉ EOP.  ูู ูุชููู ูู ุงูุชุญูู ูู ุงููุงุตู ุงูุฒููู ููุทูุจุงุช ุงูููุฏูุฉ ูู ุงููุถูู ุ ููููุง ูุง ูุฑูุฏ ุฃู ูููุฏูุง ุฃูุถูุง ุ ูุฐูู ุณูุฃุฎุฐ ูุงูุดูุง ูุฒุฏูุฌูุง ูููุฑุงุกุฉ.  ูู ุงูููุช ุงูุญุงูู ุ ูู ูุณุชุฎุฏู ุงููุฎุฒู ุงููุคูุช ุจุงููุงูู ุ ูููู ุญุชู ูุง ูุนูุฏ ูู ุงููุณุชูุจู ุ ูู ุงูุฃูุถู ุชุฎุตูุต ุงูุญุฌู ุงููุทููุจ ุนูู ุงูููุฑ. </p><br><h2 id="shag-5-rabotaem-s-buferom-po-chelovecheski" style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 5. ุงูุนูู ูุน ุงููุฎุฒู ุงููุคูุช ุฅูุณุงููุง </h2><br><p style=";text-align:right;direction:rtl">  ุจุฏูุงู ูู ูุฑุงุกุฉ ุงูุจุงูุชุงุช ุงูุฃููู ููุตููู ูุจุงุดุฑุฉู ุ ููุชุจ ุฌุฒุกูุง ูู ุงูููุฏ ุงูุฐู ููุฑุฃ ุนุฏุฏ ุงูุจุงูุชุงุช ุจุงูุถุจุท ููุง ูู ููุชูุจ ุจุงููุนู ูู ุงููุตูููุฉ.  ููู ุงูููุช ููุณู ุฅุถุงูุฉ ูุงุตู ุจูู ุงูุญุฒู. <br>  ุงูุขู ูุจุฏู ุงูุฅุฎุฑุงุฌ ูุซู ูุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">&gt;03 2D 00 10 &gt;01 FF &gt;03 2D 00 10 &gt;01 FF &gt;03 2D 00 10 &gt;01 FF &gt;03 2D 00 10 &gt;01 FF &gt;03 2D 00 10 &gt;01 FF</code> </pre> <br><h2 id="shag-6-dobavlyaem-dobavku-dobavochnyh-nuley" style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 6. ุฅุถุงูุฉ ูุถุงูุฉ ุตูุฑ ุงููุถุงูุฉ </h2><br><p style=";text-align:right;direction:rtl">  ุฃุฎูุฑูุง ุ ุญุงู ุงูููุช ูุฅููุงุก ูุฑุงุกุฉ bitstream ุฅูู ุงููุณุชูู ุงูููุงุณู.  ูุงู ุงูุนูุตุฑ ุงูุฃุฎูุฑ ุงูุฐู ูุฌุญูุง ูู ุฅุฏุงุฑุชู ุจุฏูู ุงูุตูุฑ ูู ุงูุตูุฑ ุงููุถุงู ุ ุจุนุฏ ูู ุณุช ูุญุฏุงุช ูุชุชุงููุฉ.  ูุธุฑูุง ูุฃู ูุฏููุง ุงุณุชูุจุงู ุงูุจุงูุช ูุดุฑ ุนูู ุงูุฌุณู ุงูุฎุทู ููุญููุฉ ุ ูุฌุจ ุนููู ุงูุชุญูู ุจุนุฏ ูู ุจุช ุ ูู ุฌููุน ุงูุฃูุงูู ุงูุซูุงููุฉ.  ุงููุธุฑ ูู ุฃูู ุงุซููู ูู ุงูุจุชุงุช ููุซุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">unstuff0: ;1 (  breq) andi x3, ~(1&lt;&lt;0) ;1 [15]  0-  .     mov x1, x2 ;1 [16]      () in x2, USBIN ;1 [17] &lt;-- 1-   .     ori shift, (1&lt;&lt;0) ;1 [18]  0-   .1      rjmp didUnstuff0 ;2 [20] ;&lt;---//---&gt; rxLoop: eor shift, x3 ;1 [0] in x1, USBIN ;1 [1] st y+, shift ;2 [3] ldi x3, 0xFF ;1 [4] nop ;1 [5] eor x2, x1 ;1 [6] bst x2, USBMINUS ;1 [7]     0-   shift bld shift, 0 ;1 [8] in x2, USBIN ;1 [9] &lt;--  1- (, ) andi x2, USBMASK ;1 [10] breq se0 ;1 [11] andi shift, 0xF9 ;1 [12] didUnstuff0: breq unstuff0 ;1 [13] eor x1, x2 ;1 [14]; bst x1, USBMINUS ;1 [15]     1-   shift bld shift, 1 ;1 [16] rxbit2: in x1, USBIN ;1 [17] &lt;--  2-  (, ) andi shift, 0xF3 ;1 [18] breq unstuff1 ;1 [19] didUnstuff1:</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชูููุฑ ุงูุฑุงุญุฉ ูู ุงูุชููู ุ ุณูุชู ุญุณุงุจ ุนูุงููู ุงูุฃูุงูุฑ ุงูููุถุญุฉ ุจูุงุณุทุฉ ุงูุชุตูููุงุช ุงูููุฌูุฏุฉ ุนูู ุงููููู.  ูุฑุฌู ููุงุญุธุฉ ุฃูู ุชู ุชูุฏูููุง ูุญุณุงุจ ุฏูุฑุงุช ุงูุณุงุนุฉ ูู ูุญุฏุฉ ุชุญูู ุ ูุฐูู ููุณุช ูู ุงููุธุงู.  ุชุชู ูุฑุงุกุฉ ุงูุจุงูุช ุงูุชุงูู ุนูู ููุตู rxLoop ุ ูุชู ุนูุณ ุงูุจุงูุชุฉ ุงูุณุงุจูุฉ ููุชุงุจุชูุง ุฅูู ุงููุฎุฒู ุงููุคูุช [0 ุ 3].  ุจุนุฏ ุฐูู ุ ุนูู ุงูููุตู [1] ุ ุชุชู ูุฑุงุกุฉ ุญุงูุฉ ุงูุฎุท D- ููููุง ูู XOR ุจุงูุญุงูุฉ ุงูููุจููุฉ ุงูุณุงุจูุฉ ุ ูููู ุจูู ุชุดููุฑ NRZI (ุฃุฐูุฑ ุฃู XOR ุงูุนุงุฏู ูุถูู ุงูุนูุงุณู ุ ูุฅุตูุงุญ ุงูุฐู ูุฏุฎูู ูู ุณุฌู ุงูููุงุน x3 ุ ุงูุฐู ุชูุช ุชููุฆุชู ุจูุญุฏุงุช 0xFF) ูุงููุชุงุจุฉ ุฅูู 0- ุฅูุซ ููููุง ูู ุณุฌู ุงูุชุญูู [7ุ8].  ุซู ุชุจุฏุฃ ุงููุชุนุฉ - ูุชุญูู ููุง ุฅุฐุง ูุงูุช ุงูุจุชุฉ ุงููุณุชููุฉ ูู ุงูุณุงุฏุณุฉ ุฏูู ุชุบููุฑ.  ุงูุจุชุฉ ุงููุณุชูุฑุฉ ุงููุณุชููุฉ ูุน D- ุชูุงุจู ุงููุชุงุจุฉ ุตูุฑ (ูุง ูุงุญุฏ! ุณูุชุบูุฑ ุฅูู ูุงุญุฏุฉ ูู ุงูููุงูุฉ ุ XOR) ูู ุงูุณุฌู.  ูุฐูู ุ ุชุญุชุงุฌ ุฅูู ุงูุชุญูู ููุง ุฅุฐุง ูุงูุช ุงูุจุชุงุช 0 ู 7 ู 6 ู 5 ู 4 ู 3 ุนุจุงุฑุฉ ุนู ุฃุตูุงุฑ.  ูุง ููู ุงูุจุชุงุช ุงุซููู ุงููุชุจููุฉ ุ ูุฅููุง ุจููุช ูู ุงูุจุงูุช ุงูุณุงุจู ูุชู ูุญุตูุง ูู ููุช ุณุงุจู.  ููุชุฎูุต ูููู ุ ูููุง ุจูุทุน ุงูุชุณุฌูู ุนู ุทุฑูู ุงูููุงุน [12] ุ ุญูุซ ุชู ุชุนููู ูู ุงูุจุชุงุช ุงูุชู ุชูููุง ุนูู 1: 0b11111001 = 0xF9.  ุฅุฐุง ุชุญููุช ุจุนุฏ ุชุทุจูู ุงูููุงุน ุฅูู ูู ุงูุฃุตูุงุฑ ุ ูุฅู ูููู ุฅุถุงูุฉ ุจุนุถ ุงูุดูุก ูููู ุซุงุจุชูุง ูููุงู ุงูุชูุงู ุฅูู ุงูุชุณููุฉ unstuff0.  ุชุชู ูุฑุงุกุฉ ุฌุฒุก ูุงุญุฏ ุขุฎุฑ [17] ุจุฏูุงู ูู ูุง ุชูุช ูุฑุงุกุชู ูุณุจููุง ุ ูู ุงููุชุฑุฉ ุงููุงุตูุฉ ุจูู ุงูุนูููุงุช ุงูุฃุฎุฑู ุ ูู ูุงุฆุถ [9].  ูููู ุฃูุถูุง ุจุชุจุงุฏู ุณุฌูุงุช ุงูููู ุงูุญุงููุฉ ูุงูุณุงุจูุฉ x1 ุ x2.  ูุงูุญูููุฉ ูู ุฃูู ูู ูู ุจุช ุ ูุชู ูุฑุงุกุฉ ุงููููุฉ ูู ุณุฌู ูุงุญุฏ ุ ุซู XOR ูุน ุณุฌู ุขุฎุฑ ุ ูุจุนุฏ ุฐูู ูุชู ุชุจุงุฏู ุงูุณุฌูุงุช.  ููููุง ูุฐูู ุ ุนูุฏ ูุฑุงุกุฉ ุงูุณุฌู ุงูุชุฏุฑูุฌู ุ ูุฌุจ ุฃูุถูุง ุฅุฌุฑุงุก ูุฐู ุงูุนูููุฉ.  ููู ุงูุดูุก ุงูุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู ูู ุฃููุง ูู ุณุฌู ุจูุงูุงุช ุงูุชุญูู ููุชุจ ููุณ ุงูุตูุฑ ุ ุงูุฐู ุชููููุงู ุจุฃูุงูุฉ ุ ูููู ุงููุญุฏุฉ ุงูุชู ุญุงูู ุงููุถูู ููููุง [18].  ููุฑุฌุน ุฐูู ุฅูู ุญูููุฉ ุฃูู ุนูุฏ ุงุณุชูุงู ุงูุจุชุงุช ุงูุชุงููุฉ ุ ูุฌุจ ุฃูุถูุง ุฃุฎุฐ ูููุฉ ุงูุตูุฑ ูู ุงูุงุนุชุจุงุฑ ุ ูุฅุฐุง ุณุฌููุง ุงูุตูุฑ ุ ููู ูุชููู ูุญุต ุงูููุงุน ูู ุงูุชุดุงู ุฃู ุงูุจุชุฉ ุงูุฒุงุฆุฏุฉ ูุฏ ุชู ุฃุฎุฐูุง ุจุงููุนู ูู ุงูุงุนุชุจุงุฑ.  ูุจุงูุชุงูู ุ ูู ุณุฌู ุงูุฅุฒุงุญุฉ ุ ูุชู ุนูุณ ูู ุงูุจุชุงุช (ูุณุจุฉ ุฅูู ุงููุฑุณูุฉ ูู ูุจู ุงููุถูู) ุ ูุงูุตูุฑ ููุณ ูุฐูู.  ูููุน ุญุฏูุซ ูุซู ูุฐู ุงูููุถู ูู ุงููุฎุฒู ุงููุคูุช ุ ุณูููู ุจุฅุฌุฑุงุก ุงูุนูุงุณ ุนูุณู ููููุง ูู XOR ููุณ ูุน 0xFF [0] ุ ูููู ูุน 0xFE ุ ุฃู ุงูุณุฌู ุงูุฐู ุณุชุชู ุฅุนุงุฏุฉ ุชุนููู ุงูุจุช ุงููุทุงุจู ููู ุฅูู 0 ูุจุงูุชุงูู ุ ูู ูุคุฏู ุฐูู ุฅูู ุงูุนูุงุณ.  ููููุงู ุจุฐูู ุ ูู ุงูุนููุฉ [15] ูุฅุนุงุฏุฉ ุชุนููู ุจุช ุตูุฑ. </p><br><p style=";text-align:right;direction:rtl">  ูุญุฏุซ ูููู ููุงุซู ูุน ุงูุจุชุงุช 1-5.  ูููุชุฑุถ ุฃู ุงูุจุชุฉ ุงูุฃููู ุชูุงุจู ุงููุฏูู 1 ู 0 ู 7 ู 6 ู 5 ู 4 ุ ุจูููุง ูุชู ุชุฌุงูู ุงูุจุชุงุช 2 ู 3.  ูุฐุง ูุชูุงูู ูุน ุงูููุงุน 0xF3. <br>  ููู ูุนุงูุฌุฉ 6 ู 7 ุจุช ูุฎุชููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">didUnstuff5: andi shift, 0x3F ;1 [45]   5-0 breq unstuff5 ;1 [46] ;&lt;---//---&gt; bld shift, 6 ;1 [52] didUnstuff6: cpi shift, 0x02 ;1 [53]   6-1 brlo unstuff6 ;1 [54] ;&lt;---//---&gt; bld shift, 7 ;1 [60] didUnstuff7: cpi shift, 0x04 ;1 [61]   7-2 brsh rxLoop ;3 [63] unstuff7:</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุงุน ุงูุฌุฒุก ุงูุณุงุฏุณ ูู ุงูุฑูู 0b01111110 (0x7E) ุ ููู ูุง ููููู ุชุซุจูุชู ุนูู ุณุฌู ุงูุฅุฒุงุญุฉ ุ ุญูุซ ุฅูู ุณูุนูุฏ ุชุนููู ุงูุจุช 0 ุ ุงูุฐู ูุฌุจ ูุชุงุจุชู ุนูู ุงููุตูููุฉ.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูู ุงูุนุฏ ุงูุชูุงุฒูู [45] ุ ุชู ุจุงููุนู ุชุซุจูุช ุงูููุงุน ุ ูุฅุนุงุฏุฉ ุถุจุท 7 ุจุช.  ูุฐูู ุ ูู ุงูุถุฑูุฑู ูุนุงูุฌุฉ ุงูุจุชุฉ ุงูุฅุถุงููุฉ ุฅุฐุง ูุงูุช ุงูุจุชุงุช 1-6 ูุณุงููุฉ ููุตูุฑ ุ ููุง ููู ุงูุจุชุฉ 0.  ุฃู ุฃู ูููุฉ ุงูุณุฌู ูุฌุจ ุฃู ุชููู 0 ุฃู 1 ุ ูุงูุชู ูุชู ุงูุชุญูู ูููุง ุชูุงููุง ุนู ุทุฑูู ููุงุฑูุฉ "ุฃูู ูู 2" [53 ุ 54]. </p><br><p style=";text-align:right;direction:rtl">  ุชู ุงุณุชุฎุฏุงู ููุณ ุงููุจุฏุฃ ููุจุช ุงูุณุงุจุน: ุจุฏูุงู ูู ุชุทุจูู ููุงุน 0xFC ุ ูุชู ุฅุฌุฑุงุก ูุญุต ูู "ุฃูู ูู 4" [61 ุ 63]. </p><br><h2 id="shag-7-sortiruem-pakety" style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 7. ูุฑุฒ ุงูุญุฒู </h2><br><p style=";text-align:right;direction:rtl">  ูุธุฑูุง ูุฃูู ูููููุง ุชููู ุญุฒูุฉ ุฐุงุช ุงูุจุงูุช ุงูุฃูู (PID) ุชุณุงูู 0x2D (SETUP) ุ ุณูุญุงูู ูุฑุฒ ุงูุญุฒูุฉ ุงููุณุชููุฉ.  ุจุงูููุงุณุจุฉ ุ ููุงุฐุง ุงุชุตูุช ุงูุญุฒูุฉ 0x2D SETUP ุนูุฏูุง ูุจุฏู ุฃูู ACKุ  ูุงูุญูููุฉ ูู ุฃู ููู USB ูู ุจุช ุงูุฃูู ุฃูููุฉ ุฅูู ุงูุฃูุซุฑ ุฃูููุฉ ูุชู ุฏุงุฎู ูู ุญูู ุ ูููุณ ุงูุจุงูุช ุ ุจูููุง ูุญู ููุจู ุงูุจุงูุช.  ูุดุชูู ุงูุญูู ุงูุฃูู ุงููุงู ุ PID ุ ุนูู 4 ุจุชุงุช ููุท ุ ูุชุจูุนูุง ุจู 4 ุจุชุงุช CHECK ุฃุฎุฑู ุ ููุง ููุซู ุงูุนูุงุณูุง ุญููููุง ูุญูู PID.  ูุจุงูุชุงูู ุ ูู ุชููู ุงูุจุงูุชุฉ ุงูุฃููู ุงููุณุชููุฉ ูู PID + CHECK ุ ูููู CHECK + PID.  ููุน ุฐูู ุ ูุง ููุฌุฏ ูุฑู ูุจูุฑ ุ ุญูุซ ุฃู ุฌููุน ุงูููู ูุนุฑููุฉ ูุณุจููุง ุ ููู ุงูุณูู ุฅุนุงุฏุฉ ุชุฑุชูุจ ุงููุถู ูู ุงูุฃูุงูู.  ุนูู ุงูููุฑ ุ ุณููุชุจ ุงูุฑููุฒ ุงูุฑุฆูุณูุฉ ุงูุชู ูุฏ ุชููู ูููุฏุฉ ููุง ูู ููู usbconfig.h. </p><br><p style=";text-align:right;direction:rtl">  ุญุชู ูุจุฏุฃ ูู ุฅุถุงูุฉ ุฑูุฒ ูุนุงูุฌุฉ PID ุ ูุฌุจ ุฃู ููุงุญุธ ุฃูู ูุฌุจ ุฃู ูููู ุณุฑูุนูุง (ุฃู ุ ูู ุงููุฌูุน) ุ ููู ุงููุญุงุฐุงุฉ ุญุณุจ ุงูุณุงุนุงุช ุบูุฑ ูุทููุจุฉ ุ ูุฃููุง ูุจููุง ุจุงููุนู ุงูุญุฒูุฉ.  ูุจุงูุชุงูู ุ ุณูุชู ููู ูุฐุง ุงููุณู ูุงุญููุง ุฅูู ููู asmcommon.inc ุ ูุงูุฐู ุณูุญุชูู ุนูู ุฑูุฒ ุงููุฌูุน ุบูุฑ ุงููุฑุชุจุท ุจุงูุชุฑุฏุฏ.  ูู ุบุถูู ุฐูู ุ ุณูุท ุงูุถูุก ุนูู ุงูุชุนููู. <br>  ุงูุขู ุฏุนูุง ููุชูู ุฅูู ูุฑุฒ ุงูุญุฒู ุงููุณุชููุฉ. </p><br><blockquote style=";text-align:right;direction:rtl">  <strong>ุฅุฏุฑุงุฌ ุงููุธุฑู</strong> <br>  ูุชู ุฏูุฌ ุญุฒู ุงูุจูุงูุงุช ุนูู ุงููุงูู USB ูู ุงููุนุงููุงุช.  ุชุจุฏุฃ ูู ูุนุงููุฉ ุจุงูุฅุฑุณุงู ุจูุงุณุทุฉ ุงููุถูู ูุญุฒูุฉ ุนูุงูุฉ ุฎุงุตุฉ ุชุญูู ูุนูููุงุช ุญูู ูุง ูุฑูุฏ ุงููุถูู ุงูููุงู ุจู ูุน ุงูุฌูุงุฒ: ุชูููู (SETUP) ุฃู ููู ุงูุจูุงูุงุช (OUT) ุฃู ุงุณุชูุงููุง (IN).  ุจุนุฏ ุฅุฑุณุงู ุฑุฒูุฉ ุงูุนูุงูุฉ ุ ูุชุจุน ุชููู ูุคูุช ูู ุฌุฒุฆูู.  ูุชุจุน ุฐูู ุญุฒูุฉ ุจูุงูุงุช (DATA0 ุฃู DATA1) ุ ูููู ุฅุฑุณุงููุง ุจูุงุณุทุฉ ุงููุถูู ูุงูุฌูุงุฒ ุ ููููุง ูุญุฒูุฉ ุงูุนูุงูุฉ.  ุจุนุฏ ุฐูู ุ ููุงู ูููุฉ ุฃุฎุฑู ูู ุทูู ุงูุจุชุงุช ุงุซููู ูุงูุฅุฌุงุจุฉ ูู HANDSHAKE ุ ุญุฒูุฉ ุชุฃููุฏ (ACK ุ NAK ุ STALL ุ ุณููุธุฑ ูููุง ูุฑุฉ ุฃุฎุฑู). <br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><thead><tr><th>  SETUP </th><th></th><th>  DATA0 </th><th></th><th>  ูุตุงูุญุฉ </th></tr></thead><tbody><tr><td>  ุงููุถูู&gt; ุงูุฌูุงุฒ </td><td>  ูููุฉ </td><td>  ุงููุถูู&gt; ุงูุฌูุงุฒ </td><td>  ูููุฉ </td><td>  ุงูุฌูุงุฒ&gt; ุงููุถูู </td></tr></tbody></table></div><br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><thead><tr><th>  OUT </th><th></th><th>  DATA0 / DATA1 </th><th></th><th>  ูุตุงูุญุฉ </th></tr></thead><tbody><tr><td>  ุงููุถูู&gt; ุงูุฌูุงุฒ </td><td>  ูููุฉ </td><td>  ุงููุถูู&gt; ุงูุฌูุงุฒ </td><td>  ูููุฉ </td><td>  ุงูุฌูุงุฒ&gt; ุงููุถูู </td></tr></tbody></table></div><br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><thead><tr><th>  IN </th><th></th><th>  DATA0 / DATA1 </th><th></th><th>  ูุตุงูุญุฉ </th></tr></thead><tbody><tr><td>  ุงููุถูู&gt; ุงูุฌูุงุฒ </td><td>  ูููุฉ </td><td>  ุงูุฌูุงุฒ&gt; ุงููุถูู </td><td>  ูููุฉ </td><td>  ุงููุถูู&gt; ุงูุฌูุงุฒ </td></tr></tbody></table></div><br><br>  ูุธุฑูุง ูุฃู ุงูุชุจุงุฏู ูุณูุฑ ุนูู ููุณ ุงูุฎุทูุท ุ ูุชุนูู ุนูู ุงููุถูู ูุงูุฌูุงุฒ ุงูุชุจุฏูู ุจุงุณุชูุฑุงุฑ ุจูู ุงูุฅุฑุณุงู ูุงูุงุณุชูุจุงู.  ูู ุงููุงุถุญ ุฃู ุงูุชุฃุฎูุฑ ุซูุงุฆู ุงูุจุช ูุฎุตุต ููุฐุง ุงูุบุฑุถ ุนูู ูุฌู ุงูุชุญุฏูุฏ ุ ููู ูุตููุน ุจุญูุซ ูุง ูุจุฏุฃูุง ูู ุชุดุบูู ููุฒุฉ "ุงูุฏูุน ุงูููุฑู" ุ ุจูููุง ูุญุงูููู ูู ููุช ูุงุญุฏ ููู ุจุนุถ ุงูุจูุงูุงุช ุฅูู ุงูุญุงููุฉ. </blockquote><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ูุญู ูุนุฑู ุฌููุน ุฃููุงุน ุงูุญุฒู ุงููุงุฒูุฉ ููุชุจุงุฏู.  ูุถูู ุงูุชุญูู ูู ุจุงูุช PID ุงููุณุชูู ููุงูุชุซุงู ููู ูููุง.  ูู ุงูููุช ุงูุญุงูู ุ ูู ููู ุงูุฌูุงุฒ ูุงุฏุฑูุง ุญุชู ุงูุขู ุนูู ูุชุงุจุฉ ุญุชู ุงูุญุฒู ุงูุจุฏุงุฆูุฉ ูุซู ACK ุฅูู ุงูุญุงููุฉ ุ ููุง ูุนูู ุฃูู ุบูุฑ ูุงุฏุฑ ุนูู ุฅุฎุจุงุฑ ุงููุถูู ุจูุง ูู ุนููู.  ูุฐูู ุ ูุง ูููู ุชููุน ุฃูุงูุฑ ูุซู IN.  ูุฐูู ุ ุณูู ูุชุญูู ููุท ูู ุงุณุชูุจุงู ุฃูุงูุฑ SETUP ู OUT ุ ูุงูุชู ุณูุดูุฑ ุฅูู ุฅุฏุฑุงุฌ ูุตุงุจูุญ LED ุงูููุงุจูุฉ ููุง ูู ุงููุฑูุน ุงูููุงุจูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุฅู ุงูุฃูุฑ ูุณุชุญู ุฃุฎุฐ ุฅุฑุณุงู ุณุฌูุงุช ุชุชุฌุงูุฒ ุงูููุงุทุนุฉ ุ ูู ููุงู ูุง ุจุดูู ุฑุฆูุณู. </p><br><p style=";text-align:right;direction:rtl">  ูููุถ ุงูุฌูุงุฒ ุจูุง ุญุฏุซ ุจุนุฏ ุฅุฌุฑุงุก ูุฐู ุงูุชุบููุฑุงุช ูููุงุญุธ ุงูุชุณูุณู ุงูุชุงูู ููุจุงูุชุงุช ุงููุณุชููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">2D|80|06|00|01|00|00|40|00 C3|80|06|00|01|00|00|40|00 2D|80|06|00|01|00|00|40|00 C3|80|06|00|01|00|00|40|00</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฅูู ุฌุงูุจ ุฐูู - ููุง ุญุฑู ุงููุตุงุจูุญ.  ูุฐูู ุ ููุนูุง SETUP ู OUT. </p><br><h2 id="shag-8-chitaem-adres-na-konverte" style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 8. ูุฑุงุกุฉ ุงูุนููุงู ุนูู ุงููุบูู </h2><br><blockquote style=";text-align:right;direction:rtl">  <strong>ุฅุฏุฑุงุฌ ุงููุธุฑู</strong> <br>  ูุง ุชุฎุฏู ุญุฒู ุงูุนูุงูุงุช (SETUP ุ IN ุ OUT) ููุท ูู ุฅุธูุงุฑ ุงูุฌูุงุฒ ูุง ูุฑูุฏูู ููู ุ ูููู ุฃูุถูุง ููุนุงูุฌุฉ ุฌูุงุฒ ูุนูู ุนูู ุงููุงูู ูุฅูู ููุทุฉ ููุงูุฉ ูุญุฏุฏุฉ ุจุฏุงุฎูู.  ููุงู ุญุงุฌุฉ ุฅูู ููุงุท ุงูููุงูุฉ ูุชุณููุท ุงูุถูุก ูุธููููุง ุนูู ูุธููุฉ ูุฑุนูุฉ ูุนููุฉ ููุฌูุงุฒ.  ูููู ุฃู ุชุฎุชูู ูู ูุชูุฑุฉ ุงูุงูุชุฑุงุน ุ ูุณุนุฑ ุงูุตุฑู ุ ูุบูุฑูุง ูู ุงููุนุงูู.  ูููู ุฃูู ุฅุฐุง ุจุฏุง ุฃู ุงูุฌูุงุฒ ุนุจุงุฑุฉ ุนู ูุญูู USB-COM ุ ูุฅู ูููุชู ุงูุฑุฆูุณูุฉ ูู ุชููู ุงูุจูุงูุงุช ูู ุงูุญุงููุฉ ูููููุง ุฅูู ุงููููุฐ (ููุทุฉ ุงูููุงูุฉ ุงูุฃููู) ูุชููู ุงูุจูุงูุงุช ูู ุงููููุฐ ูุฅุฑุณุงููุง ุฅูู ุงููุงูู (ุงูุซุงููุฉ).  ูู ุญูุซ ุงููุนูู ุ ูุฐู ุงูููุงุท ูุฎุตุตุฉ ูุชุฏูู ูุจูุฑ ูู ุงูุจูุงูุงุช ุบูุฑ ุงููููููุฉ.  ูููู ุฅูู ุฌุงูุจ ุฐูู ุ ูู ููุช ูุขุฎุฑ ุ ูุฌุจ ุฃู ูุชุจุงุฏู ุงูุฌูุงุฒ ูุน ุงููุถูู ุญุงูุฉ ุฎุทูุท ุงูุชุญูู (ุฌููุน ุฃููุงุน RTS ู DTR ูุบูุฑูุง) ูุฅุนุฏุงุฏุงุช ุงูุชุจุงุฏู (ุงูุณุฑุนุฉ ุ ุงูุชูุงุซู).  ูููุง ุ ูุง ูุชููุน ูุฌูุฏ ูููุงุช ูุจูุฑุฉ ูู ุงูุจูุงูุงุช.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุชููู ูุฑูุญุฉ ุนูุฏูุง ูุง ูุชู ุฎูุท ูุนูููุงุช ุงูุฎุฏูุฉ ูุน ุงูุจูุงูุงุช.  ูุฐูู ุงุชุถุญ ุฃูู ููุงุณุจ ูุงุณุชุฎุฏุงู 3 ููุงุท ููุงูุฉ ุนูู ุงูุฃูู ููุญูู USB-COM.  ูู ุงูููุงุฑุณุฉ ุงูุนูููุฉ ุ ุจุงูุทุจุน ุ ูุญุฏุซ ุจุทุฑู ูุฎุชููุฉ ... <br>  ุณุคุงู ูุซูุฑ ููุงูุชูุงู ุจููุณ ุงููุฏุฑ ูู ุณุจุจ ุฅุฑุณุงู ุงูุฌูุงุฒ ูุนููุงูู ุ ูุฃูู ุจุตุฑู ุงููุธุฑ ุนู ุฐูู ุ ูุง ูุฒุงู ูุชุนุฐุฑ ุนููู ุฅุฏุฎุงู ุฃู ุดูุก ูู ูุฐุง ุงููููุฐ ุงููุญุฏุฏ.  ูุชู ุฐูู ูุชุจุณูุท ุชุทููุฑ ููุญุงุช ูุตู USB.  ูููู ุฃู ุชููู "ุบุจูุฉ" ูุจุจุณุงุทุฉ ุฅุดุงุฑุงุช ูู ุงููุถูู ุฅูู ุฌููุน ุงูุฃุฌูุฒุฉ ุฏูู ุงูุญุงุฌุฉ ุฅูู ุงูููู ุจุดุฃู ุงููุฑุฒ.  ูุณูููู ุงูุฌูุงุฒ ููุณู ุจุงูุชุดุงููุง ุฃู ูุนุงูุฌุฉ ุงูุญุฒูุฉ ุฃู ุชุฌุงูููุง. <br>  ูุฐูู ุ ูุชู ุชุถููู ูู ูู ุนููุงู ุงูุฌูุงุฒ ูุนููุงู ููุทุฉ ุงูููุงูุฉ ูู ุญุฒู ุงูุนูุงูุฉ.  ููุฑุฏ ูููู ูุฐู ุงูุญุฒู ุฃุฏูุงู: <br>  ุงููุฌุงู <br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><thead><tr><th>  ุงููุฌุงู </th><th>  SYNC </th><th>  ADDR </th><th>  ููุทุฉ ุงูููุงูุฉ </th><th>  CRC </th><th>  EOP </th></tr></thead><tbody><tr><td>  ุจุช USB </td><td>  0-7 </td><td>  0123456 </td><td>  0123 </td><td>  01234 </td><td>  01 </td></tr><tr><td>  ุจุช ุชููู </td><td></td><td>  0123456 </td><td>  7012 </td><td>  34567 </td><td></td></tr></tbody></table></div><br><br>      ,    -   ( -  PID = SETUP  OUT)   (IN)  ,     . </blockquote><p style=";text-align:right;direction:rtl">     ,       (-)     (Handshake) : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  :     ,     ,  NAK   </li><li style=";text-align:right;direction:rtl">  -:   SETUP  OUT,  ,  IN โ ,  </li><li style=";text-align:right;direction:rtl">   .   ,              ,        ,        </li></ul><br><p style=";text-align:right;direction:rtl">       ยซ โ  ยป    .         PID',      ,     .     ยซPIDยป  .       usbCurrentTok.   PID'   (DATA0, DATA1)   ,      .      ,   ?  :    ,    ( 0   usbCurrentTok     ),    ,     .       ( SE0)      ,  -  ,     D+, D- .        ,       SYNC,   . ,             ,          .    ยซยป    ,        .          . </p><br><p style=";text-align:right;direction:rtl">        ,         .       x3,          (,     ,     ,         ). </p><br><p style=";text-align:right;direction:rtl">    ,   USB    ,      ,              .     ,  ,     ,          CRC (      ).      ,      [21].       0-    .      ,    [26]. ,        CRC,        . </p><br><h2 id="shag-9-bezotkaznyy-priem" style=";text-align:right;direction:rtl">  9.   </h2><br><p style=";text-align:right;direction:rtl">       ,       ,    ยซ ยป,   ACK.         NAK',     (    cnt โ         ).   USB     ,   ,            SYNC  PID.       Y,           cnt (         ).     ,        โ ACK.       x3      โ    1 ,           .     x3 (  r20)    20. </p><br><p style=";text-align:right;direction:rtl">        (     SETUP,     ),   ACK'  ,    ,        ,      . ,              . </p><br><p style=";text-align:right;direction:rtl">   ,       D+, D- (      ),    โ .      XOR  ,      , ,  ,    -  . </p><br><p style=";text-align:right;direction:rtl">  ,     ,     ,      ,   . ,    ,        ,           .        .   vusb   :  txBitloop   2    ([00], [08]).    3 ,  6 .       ,             .      1    3    :      171.       (    171,        11 ,    ),    โ ,    .    cnt=4: </p><br><p style=";text-align:right;direction:rtl"> 4 โ 171 = -167 = (   ) 89 (+ ) <br> 89 โ 171 = -82 = (   ) 174 (+ ) <br> 174 โ 171 = 3.     ,     <br>       ,      . </p><br><p style=";text-align:right;direction:rtl">  ,   3 ,      1.      6       ,    ,      x4.        D+, D-   ,     . . <br>          : </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">2D|80|06|00|01|00|00|40|00 69|00|10|00|01|00|00|40|00</code> </pre> <br><p style=";text-align:right;direction:rtl">    C3 .  ,       ,      UART   . ,  ,       IN ,       . ,    . </p><br><h2 id="shag-10-posylaem-hosta-nak" style=";text-align:right;direction:rtl">  10.   NAK </h2><br><p style=";text-align:right;direction:rtl">    NAK    ,       .      ,      .       ,  -       . </p><br><p style=";text-align:right;direction:rtl">      ,      .    ,  ,   -    ,     .        usbRxBuf,    .        ,   โ  ,     USB_BUFSIZE.        usbInputBufOffset,            .        . </p><br><p style=";text-align:right;direction:rtl">   NAK    handleData      ,        [22].            (usbRxLen),     - .       (   โ    ),       usbRxLen,  ,      โ  usbRxToken,   SETUP  OUT - .   :        ,     ,   ACK . </p><br><p style=";text-align:right;direction:rtl">                  .   ,     ,     -    ,  -,    .         ?    ,   ,    ,   ,    -    . </p><br><p style=";text-align:right;direction:rtl">  ,     </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">2D|80|06|00|01|00|00|40|00</code> </pre> <br><p style=";text-align:right;direction:rtl">     ,    NAK`,    ,     . </p><br><h2 id="shag-11-obrabatyvaem-zaprosy" style=";text-align:right;direction:rtl">  11.   </h2><br><p style=";text-align:right;direction:rtl">     , ,        .       โ         .     ,      ,     , ,  ,     .            .        .         ,    USB,           usbPoll.  โ      ,     .    โ     .      SETUP ,     PID  CRC,    SETUP  5-  ,     16-.      3 ยซยป . ยซยป   PID      usbRxToken,  CRC   ,         ,  .        usbProcessRx,      ,       . </p><br><p style=";text-align:right;direction:rtl">  ,   ,        โ  ,     SE0.   ,     USB      . </p><br><p style=";text-align:right;direction:rtl">     .        SETUP,           .        .  SETUP    usbRequest_t    8 .      :  (    USB-)  ,     - .         ,     .           . <br>      , ,  ,  . </p><br><h2 id="shag-12-podrobnosti-setupa" style=";text-align:right;direction:rtl">  12.  SETUP' </h2><br><p style=";text-align:right;direction:rtl"> ,  ,      .     .     usbDriverSetup,         . ,      . ,      (    ,     ,            )   . ,           : ACK  NAK,        . </p><br><h2 id="shag-13-otpravlyaem-otvet" style=";text-align:right;direction:rtl">  13.   </h2><br><p style=";text-align:right;direction:rtl">    ,      SETUP + DATAx,    DATAx   8 .        IN      DATAx,     .         ,     .        ,      ACK  NAK.           ,       .   โ    usbTxBuf,   ,   usbTxLen   .  low-speed USB          8  ( PID,    CRC),    usbTxLen      11.      PID,   ,      . ,     16,   , 0x0F,   .    PID      ,       .        IN,   ,       (handshake    ,    ). </p><br><p style=";text-align:right;direction:rtl">      : <br>   SETUP + DATAx,    ACK  NAK      . , ,  usbPoll,   ,        (       PID=DATA1 (  DATA0  DATA1   ,     ,     DATA1).   CRC  .       ,    ,   -   .           โ 4 .  ,    3 ,   4.   ,   SYNC       .          ยซ   IN   NAK?ยป     NAK.      ,     , DATA1   . </p><br><p style=";text-align:right;direction:rtl">      ,     โ USBRQ_SET_ADDRESS (   ,    ).          .          (drvsdm.S,  make SE0).     ,              ,   ,      DATA1    ,  ,          . ,   ,           ,    ,           ,        .       ,         ,      . </p><br><h2 id="shag-14-sortiruem-standartnye-zaprosy" style=";text-align:right;direction:rtl">  14.    </h2><br><p style=";text-align:right;direction:rtl">    ,        .   ,    USBRQ_GET_DESCRIPTOR  USBRQ_SET_ADDRESS, ,    .    usbDriverDescriptor,    .        ,   USBRQ_GET_DESCRIPTOR.  ,    , : </p><br><p style=";text-align:right;direction:rtl"> USBDESCR_DEVICE โ   :   USB (1.1   ),  , ,    . . <br> USBDESCR_CONFIG โ ,     ,    . . <br> USBDESCR_STRING โ   ,   . <br> ,   ,       USBDESCR_DEVICE,  ,        . </p><br><h2 id="shag-15-zapolnyaem-anketnye-dannye" style=";text-align:right;direction:rtl">  15.    </h2><br><p style=";text-align:right;direction:rtl">       . -,     .      ,   - - , , HID,      ,        .     Vendor ID  Product ID,      USB,     .  ,  vusb            . </p><br><p style=";text-align:right;direction:rtl">     , , - .    ,       ,    ,        (, )      usbMsgPtr,   โ   len,     usbMsgLen.      (     )  18 ,       8. ,    ,  3 .       - ,  STALL. </p><br><p style=";text-align:right;direction:rtl">           usbDeviceRead.   ,       memcpy_P,             ,  , . </p><br><p style=";text-align:right;direction:rtl">   ,      ,  ,      .    ,      ,        . </p><br><p style=";text-align:right;direction:rtl">       ,     ,  . </p><br><blockquote style=";text-align:right;direction:rtl"> <strong> </strong> <br>  PID'  DATA0  DATA1       .  PID'     ,          ,  -       . </blockquote><p style=";text-align:right;direction:rtl">       ,  DATA0 / DATA1    (        ),     , ,   3 ,    .     XOR    PID',   .      ,        ,   XOR'    .     PID  DATA1,   XOR    PID   ,   XOR  DATA0    . </p><br><p style=";text-align:right;direction:rtl">      ,    ,     USBDESCR_CONFIG. </p><br><h2 id="shag-16-nakonec-to-ustroystvo" style=";text-align:right;direction:rtl">  16. - ! </h2><br><p style=";text-align:right;direction:rtl">   USBDESCR_CONFIG      USBDESCR_DEVICE.     (   ,        )  .   , -     USB-,     ,   D+, D-. </p><br><p style=";text-align:right;direction:rtl">        ,      : , ,   .    ,        (    ,    ).  ,      UTF-16,       .     USB     UTF-8  . </p><br><p style=";text-align:right;direction:rtl">   vusb       ,     lsusb    .    VID, PID      ,        .         ,        VID, PID,     โ      . </p><br><p style=";text-align:right;direction:rtl"> ,         ,      (    ).       SETUP:   ,        ,     .   0,       ,    โ      . ,     ,       ,  . <br>        . </p><br><h2 id="shag-17-ustroystvo-stanovitsya-chelovechnee-hid" style=";text-align:right;direction:rtl">  17.    (HID) </h2><br><blockquote style=";text-align:right;direction:rtl"> <strong> </strong> <br> HID โ human interface device,   ,       ,     .    HID   ,       .  ,      ,   , , ,       .    ยซยป     .      HID     ( low-speed      800   ),        . </blockquote><p style=";text-align:right;direction:rtl">     HID     ,     USBDESCR_HID_REPORT.          vusb,      . ,   usbDriverSetup ( )   usbFunctionSetup ( ).  ,      SETUP,         OUT.      ,         , ,   usbFunctionWrite. </p><br><p style=";text-align:right;direction:rtl">     ,  usbDeviceRead  usbFunctionRead,           .   ,    ,   usbFunctionSetup  (  ,   )   USB_FLG_USE_USER_RW,   usbDriverSetup   . </p><br><p style=";text-align:right;direction:rtl">    โ      โ    usbFunctionWrite  usbFunctionRead.          .   โ      ,       . </p><br><p style=";text-align:right;direction:rtl">       usbDriverSetup. </p><br><h2 id="shag-18-obschaemsya-s-zhelezkoy" style=";text-align:right;direction:rtl">  18.    </h2><br><p style=";text-align:right;direction:rtl">  ,      ,        .     HID,    ,   ,      (        udev  - ).  ,        ,   .        ,   ,   ,     . <br> UPD:   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">ramzes2</a> ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">HIDAPI</a> </p><br><p style=";text-align:right;direction:rtl">           . </p><br><h2 id="shag-19-sravnivaem-s-vusb" style=";text-align:right;direction:rtl">  19.   vusb </h2><br><p style=";text-align:right;direction:rtl">     vusb              ,   . </p><br><p style=";text-align:right;direction:rtl"> drvasm.S   - usbdrvasm.S  asmcommon.inc,   -,   , usbdrvasm12.inc โ usbdrvasm20.inc. </p><br><p style=";text-align:right;direction:rtl"> main.c    main.c ( )  usbdrv.c (  vusb) <br> usbconfig.h      (     ),   ,  ,   usbconfig.h. </p><br><h2 id="zaklyuchenie" style=";text-align:right;direction:rtl">  ุงุณุชูุชุงุฌ </h2><br><p style=";text-align:right;direction:rtl">      vusb,            ,   ,    .  ,    ,      . . ,     ,     ,    USB-HID.   ,   ,  ,            vusb,     ,  , ,      . </p><br><h2 id="ispolzovannaya-literatura-i-poleznye-ssylki" style=";text-align:right;direction:rtl">      </h2><br><p style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://www.obdev.at/products/vusb/index.html</a> (  vusb) <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">http://microsin.net/programming/arm-working-with-usb/usb-in-a-nutshell-part1.html</a> <br>  ..  USB:     <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://radiohlam.ru/tag/usb/</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">http://we.easyelectronics.ru/electro-and-pc/usb-dlya-avr-chast-1-vvodnaya.html</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">http://usb.fober.net/cat/teoriya/</a> </p><br><p style=";text-align:right;direction:rtl"> PS -     (,      )     ,   </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar460815/">https://habr.com/ru/post/ar460815/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar460803/index.html">ูุฑุงุกุฉ ููุตู ุงูุตูู: ูุชุจ ุงูุชููููู</a></li>
<li><a href="../ar460805/index.html">ููููุฉ ููู ุงูุจูุงูุงุช ุจูู ูููุฑูููุชุฑููุฑ ุจุณุฑุนุฉ 100 ููุบุงุจุช ูู ุงูุซุงููุฉ</a></li>
<li><a href="../ar460807/index.html">ููุงุณ ุณุจุน ูุฑุงุช ุ ูุฑุฉ ูุงุญุฏุฉ ุชูููุฐ ุฃุฏุงุฉ BI</a></li>
<li><a href="../ar460811/index.html">ุงูููููุงุช ุงููุดุชุฑูุฉ ูู ูุจู ูุฑู ูุฎุชููุฉ. ุชูุฑูุฑ ูุงูุฏูุณ</a></li>
<li><a href="../ar460813/index.html">ููููุฉ ุงุณุชุฎุฏุงู ูุฎุทุทุงุช ููุฑูููู ููุชุญูู ูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู</a></li>
<li><a href="../ar460819/index.html">ุงูููุงุฑุงุช ุงูุนุงูููุฉ: ูุฑุงุฌุนุฉ ูู ูุดุงุฑู ุงูุฃูููุจูุงุฏ</a></li>
<li><a href="../ar460821/index.html">ููุฎุต ุงูููุงุฏ ุงููุซูุฑุฉ ููุงูุชูุงู ููุทูุฑ ุงูุฌูุงู ุฑูู 307 (15-21 ููููู)</a></li>
<li><a href="../ar460823/index.html">ุงูุฃุญุฏุงุซ ุงูุฑูููุฉ ูู ููุณูู ูู 22 ููููู ุฅูู 28 ููููู</a></li>
<li><a href="../ar460825/index.html">ููุฏูุฉ ุฅูู Screen Capture API - ูุณุญ ุฑููุฒ QR ูู ุงููุณุชุนุฑุถ</a></li>
<li><a href="../ar460827/index.html">ูุดููุฉ PGP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>