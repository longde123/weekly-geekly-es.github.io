<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üì• ü§∞ üêú Composici√≥n de UIViewControllers y navegaci√≥n entre ellos (y no solo) üë∂üèº üë®üèª‚Äçüé® üöå</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En este art√≠culo quiero compartir la experiencia que hemos estado utilizando con √©xito durante varios a√±os en nuestras aplicaciones iOS, 3 de las cual...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Composici√≥n de UIViewControllers y navegaci√≥n entre ellos (y no solo)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421097/"><p><img src="https://habrastorage.org/webt/x7/yt/ll/x7ytllwqwgvgxy2rvtmdwj3qkia.png"></p><br><p>  En este art√≠culo quiero compartir la experiencia que hemos estado utilizando con √©xito durante varios a√±os en nuestras aplicaciones iOS, 3 de las cuales se encuentran actualmente en la tienda de aplicaciones.  Este enfoque ha funcionado bien y recientemente lo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">separamos</a> del resto del c√≥digo y lo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dise√±amos</a> en una biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RouteComposer</a> separada, que se discutir√° de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hecho</a> . </p><a name="habracut"></a><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/ekazaev/route-composer</a> </p><br><p>  Pero, para empezar, intentemos averiguar qu√© significa la composici√≥n de los controladores de vista en iOS. </p><br><p> Antes de continuar con la explicaci√≥n en s√≠, le recuerdo que en iOS se entiende con mayor frecuencia como un controlador de vista o <code>UIViewController</code> .  Esta es una clase heredada del <code>UIViewController</code> est√°ndar, que es el controlador de patr√≥n MVC base que Apple recomienda usar para desarrollar aplicaciones iOS. </p><br><p>  Puede usar patrones arquitect√≥nicos alternativos como MVVM, VIP, VIPER, pero en ellos el <code>UIViewController</code> estar√° involucrado de una forma u otra, lo que significa que esta biblioteca se puede usar con ellos.  La esencia del <code>UIViewController</code> usa para controlar el <code>UIView</code> , que con mayor frecuencia representa una pantalla o una parte importante de la pantalla, procesa eventos desde ella y muestra algunos datos en ella. </p><br><p><img src="https://habrastorage.org/webt/5v/ia/-3/5via-37-mfc9leww-hwfvcu20eg.png"></p><br><p>  Todos los <code>UIViewController</code> se pueden dividir condicionalmente en <strong>controladores de vista normal</strong> , que son responsables de un √°rea visible en la pantalla, y <strong>controladores de vista de contenedor</strong> , que, adem√°s de mostrarse a s√≠ mismos y algunos de sus controles, tambi√©n pueden mostrar controladores de vista secundarios integrados en ellos de una forma u otra . </p><br><p>  Los controladores de vista de contenedor est√°ndar suministrados con Cocoa Touch incluyen: <code>UINavigationConroller</code> , <code>UITabBarController</code> , <code>UISplitController</code> , <code>UIPageController</code> y algunos otros.  Adem√°s, el usuario puede crear sus propios controladores de vista de contenedor personalizados siguiendo las reglas de Cocoa Touch que se describen en la documentaci√≥n de Apple. </p><br><p>  El proceso de introducci√≥n de controladores de vista est√°ndar en los controladores de vista de contenedor, as√≠ como la integraci√≥n de los controladores de vista en la pila de controladores, llamaremos a la <strong>composici√≥n</strong> en este art√≠culo. </p><br><p>  Por qu√©, entonces, la soluci√≥n est√°ndar para la composici√≥n de los controladores de vista result√≥ no ser √≥ptima para nosotros, y desarrollamos una biblioteca que facilita nuestro trabajo. </p><br><p>  Echemos un vistazo a la composici√≥n de algunos controladores de vista de contenedor est√°ndar como ejemplo: </p><br><h3 id="primery-kompozicii-v-standartnyh-konteynerah">  Ejemplos de composici√≥n en contenedores est√°ndar. </h3><br><h4 id="uinavigationcontroller"> <code>UINavigationController</code> </h4> <br><p><img src="https://habrastorage.org/webt/zx/fc/su/zxfcsucgp6qusx4kkkfccphmzz0.png"></p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> tableViewController = <span class="hljs-type"><span class="hljs-type">UITableViewController</span></span>(style: .plain) <span class="hljs-comment"><span class="hljs-comment">//        let navigationController = UINavigationController(rootViewController: tableViewController) // ... //        let detailViewController = UIViewController(nibName: "DetailViewController", bundle: nil) navigationController.pushViewController(detailViewController, animated: true) // ... //     navigationController.popToRootViewController(animated: true)</span></span></code> </pre> <br><h4 id="uitabbarcontroller"> <code>UITabBarController</code> </h4> <br><p><img src="https://habrastorage.org/webt/vi/2t/bx/vi2tbxjzyl9xs_rhrcpbx9p9lp8.png"></p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> firstViewController = <span class="hljs-type"><span class="hljs-type">UITableViewController</span></span>(style: .plain) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> secondViewController = <span class="hljs-type"><span class="hljs-type">UIViewController</span></span>() <span class="hljs-comment"><span class="hljs-comment">//   let tabBarController = UITabBarController() //         tabBarController.viewControllers = [firstViewController, secondViewController] //        tabBarController.selectedViewController = secondViewController</span></span></code> </pre> <br><h4 id="uisplitviewcontroller"> <code>UISplitViewController</code> </h4> <br><p><img src="https://habrastorage.org/webt/gs/jx/ll/gsjxllx4rm_tjpukwtawibmffsg.png"></p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> firstViewController = <span class="hljs-type"><span class="hljs-type">UITableViewController</span></span>(style: .plain) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> secondViewController = <span class="hljs-type"><span class="hljs-type">UIViewController</span></span>() <span class="hljs-comment"><span class="hljs-comment">//   let splitViewController = UISplitViewController() //        splitViewController.viewControllers = [firstViewController] //        splitViewController.showDetailViewController(secondViewController, sender: nil)</span></span></code> </pre> <br><h3 id="primery-integracii-kompozicii-vyu-kotrollerov-v-stek">  Ejemplos de integraci√≥n (composici√≥n) de controladores de vista en la pila </h3><br><h4 id="ustanovka-vyu-kontrolera-rutom">  Instalaci√≥n de la ra√≠z del controlador de vista </h4><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> window: <span class="hljs-type"><span class="hljs-type">UIWindow</span></span> = <span class="hljs-comment"><span class="hljs-comment">//... window.rootViewController = viewController window.makeKeyAndVisible()</span></span></code> </pre> <br><h4 id="modalnaya-prezentaciya-vyu-kontrolera">  Presentaci√≥n modal del controlador de vista </h4><br><pre> <code class="swift hljs">window.rootViewController.present(splitViewController, animated: animated, completion: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)</code> </pre> <br><h3 id="pochemu-my-reshili-sozdat-biblioteku-dlya-kompozicii">  ¬øPor qu√© decidimos crear una biblioteca para la composici√≥n? </h3><br><p>  Como puede ver en los ejemplos anteriores, no existe una forma √∫nica de integrar los controladores de vista convencionales en contenedores, al igual que no hay una forma √∫nica de construir una pila de controladores de vista.  Y, si desea cambiar ligeramente el dise√±o de su aplicaci√≥n o la forma en que navega en ella, necesitar√° cambios significativos en el c√≥digo de la aplicaci√≥n, tambi√©n necesitar√° enlaces a objetos de contenedor para poder insertar sus controladores de vista, etc.  Es decir, el m√©todo est√°ndar en s√≠ implica una gran cantidad de trabajo, as√≠ como la presencia de enlaces para ver los controladores para generar acciones y presentaciones de otros controladores. </p><br><p>  Todo esto agrega un dolor de cabeza a varios m√©todos de vinculaci√≥n por inmersi√≥n a la aplicaci√≥n (por ejemplo, usando enlaces universales), ya que debe responder la pregunta: <em>¬øqu√© pasa si el controlador debe mostrarse al usuario ya que hizo clic en el enlace en el safari ya se muestra, o estoy viendo el controlador? lo que deber√≠a mostrar que a√∫n no se ha creado</em> , lo que le obliga a caminar a trav√©s de los controladores del √°rbol de visi√≥n y escribir c√≥digo del que a veces sus ojos comienzan a sangrar y que cualquier desarrollador de iOS intenta ocultar.  Adem√°s, a diferencia de la arquitectura de Android donde cada pantalla se construye por separado, en iOS, para mostrar una parte de la aplicaci√≥n inmediatamente despu√©s del lanzamiento, puede ser necesario construir una pila bastante grande de controladores que estar√°n ocultos debajo de la que se muestra a pedido. </p><br><p>  Ser√≠a genial llamar a m√©todos como <code>goToAccount()</code> , <code>goToMenu()</code> o <code>goToProduct(withId: "012345")</code> cuando un usuario hace clic en un bot√≥n o cuando una aplicaci√≥n <code>goToProduct(withId: "012345")</code> enlace universal de otra aplicaci√≥n y no piensa en integrar este controlador de vista en la pila, sabiendo que el creador de este controlador de vista ya ha proporcionado esta implementaci√≥n. </p><br><p>  Adem√°s, a menudo, nuestras aplicaciones consisten en una gran cantidad de pantallas desarrolladas por diferentes equipos, y para acceder a una de las pantallas durante el proceso de desarrollo, debe pasar por otra pantalla que a√∫n no se ha creado.  En nuestra empresa, utilizamos el enfoque que llamamos la <em>placa de Petri</em> .  Es decir, en el modo de desarrollo, el desarrollador y el probador tienen acceso a una lista de todas las pantallas de aplicaciones y puede acceder a cualquiera de ellas (por supuesto, algunas de ellas pueden requerir algunos par√°metros de entrada). </p><br><p><img src="https://habrastorage.org/webt/5l/wx/cv/5lwxcvup0mtdaedrgjsxokbsdti.png"></p><br><p>  Puede interactuar con ellos y probarlos individualmente, y luego ensamblarlos en la aplicaci√≥n final para la producci√≥n.  Este enfoque facilita en gran medida el desarrollo, pero, como viste en los ejemplos anteriores, la composici√≥n comienza cuando necesitas mantener en el c√≥digo varias formas de integrar el controlador de vista en la pila. </p><br><p>  Queda por agregar que todo esto se multiplicar√° por N tan pronto como su equipo de marketing exprese su deseo de realizar pruebas A / B en usuarios en vivo y verificar qu√© m√©todo de navegaci√≥n funciona mejor, por ejemplo, una barra de pesta√±as o un men√∫ de hamburguesas. </p><br><ul><li><del>  Vamos a cortar las piernas de Susanin </del>  Vamos a mostrar el 50% de los usuarios de la barra de pesta√±as y al otro men√∫ de hamburguesas, y en un mes le diremos qu√© usuarios ven m√°s de nuestras ofertas especiales. </li></ul><br><p>  Tratar√© de decirle c√≥mo abordamos la soluci√≥n a este problema y finalmente lo asignamos a la biblioteca RouteComposer. </p><br><h3 id="susanin-route-composer"><del>  Susanin </del>  Compositor de ruta </h3><br><p>  Despu√©s de analizar todos los escenarios de composici√≥n y navegaci√≥n, tratamos de abstraer el c√≥digo dado en los ejemplos anteriores e identificamos 3 entidades principales de las cuales <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">opera la</a> biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RouteComposer</a> : <code>Factory</code> , <code>Finder</code> , <code>Action</code> .  Adem√°s, la biblioteca contiene 3 entidades auxiliares que son responsables de un peque√±o ajuste que puede ser necesario durante el proceso de navegaci√≥n: <code>RoutingInterceptor</code> , <code>ContextTask</code> , <code>PostRoutingTask</code> .  Todas estas entidades deben configurarse en una cadena de dependencias y transferirse al <code>Router</code> y, el objeto que construir√° su pila de controladores. </p><br><p>  Pero, sobre cada uno de ellos en orden: </p><br><h4 id="factory">  La f√°brica </h4><br><p>  Como su nombre lo indica, <code>Factory</code> es responsable de crear el controlador de vista. </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Factory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">ViewController</span></span>: <span class="hljs-type"><span class="hljs-type">UIViewController</span></span> <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">Context</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with context: Context)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ViewController</span></span> }</code> </pre> <br><p>  Aqu√≠ es importante hacer una reserva sobre el concepto de <strong>contexto</strong> .  Al contexto dentro de la biblioteca, llamamos todo lo que el espectador pueda necesitar para ser creado.  Por ejemplo, para mostrar un controlador de vista que muestre los detalles del producto, debe pasarle un determinado ID de producto, por ejemplo, en forma de una <code>String</code> .  La esencia del contexto puede ser cualquier cosa: un objeto, estructura, bloque o tupla.  Si su controlador no necesita nada para ser creado, ¬øse puede especificar el contexto como <code>Any?</code>  e instalar en <code>nil</code> . </p><br><p>  Por ejemplo: </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductViewControllerFactory</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Factory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with productID: UUID)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ProductViewController</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> productViewController = <span class="hljs-type"><span class="hljs-type">ProductViewController</span></span>(nibName: <span class="hljs-string"><span class="hljs-string">"ProductViewController"</span></span>, bundle: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) productViewController.productID = productID <span class="hljs-comment"><span class="hljs-comment">//  ,      `ContextAction`,     return productViewController } }</span></span></code> </pre> <br><p>  A partir de la implementaci√≥n anterior, queda claro que esta f√°brica cargar√° la imagen del controlador del archivo XIB e instalar√° el productID transferido en √©l.  Adem√°s del protocolo est√°ndar de <code>Factory</code> , la biblioteca proporciona varias implementaciones est√°ndar de este protocolo para evitar que escriba c√≥digo banal (en particular, el ejemplo anterior). </p><br><p>  Adem√°s, me abstendr√© de proporcionar descripciones de protocolos y ejemplos de sus implementaciones, ya que puede familiarizarse con ellos en detalle descargando el ejemplo que viene con la biblioteca.  Existen diversas implementaciones de f√°bricas para controladores y contenedores de vista convencionales, as√≠ como formas de configurarlas. </p><br><h4 id="action">  Acci√≥n </h4><br><p>  La entidad <code>Action</code> es una descripci√≥n de c√≥mo integrar un controlador de vista, que ser√° construido por la f√°brica, en la pila.  El controlador de vista despu√©s de la creaci√≥n no puede simplemente colgarse en el aire y, por lo tanto, cada f√°brica debe contener <code>Action</code> como se puede ver en el ejemplo anterior. </p><br><p>  La implementaci√≥n m√°s com√∫n de <code>Action</code> es la presentaci√≥n modal del controlador: </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PresentModally</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Action</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">perform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(viewController: UIViewController, on existingController: UIViewController, animated: Bool, completion: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">: ActionResult)</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> existingController.presentedViewController == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { completion(.failure(<span class="hljs-string"><span class="hljs-string">"\(existingController) is already presenting a view controller."</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } existingController.present(viewController, animated: animated, completion: { completion(.continueRouting) }) } }</code> </pre> <br><p>  La biblioteca contiene la implementaci√≥n de la mayor√≠a de las formas est√°ndar para integrar controladores de vista en la pila, y probablemente no tendr√° que crear los suyos propios hasta que utilice alg√∫n tipo de controlador de vista de contenedor personalizado o m√©todo de presentaci√≥n.  Pero crear acciones personalizadas no deber√≠a causar problemas si lee los ejemplos. </p><br><h4 id="finder">  Buscador </h4><br><p>  La esencia de <code>Finder</code> responde al enrutador a la pregunta <em>: ¬øya se ha creado un controlador de este tipo y ya est√° en la pila?</em>  <em>¬øQuiz√°s no se necesita crear nada y es suficiente para mostrar lo que ya est√° all√≠?</em>  . </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Finder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">ViewController</span></span>: <span class="hljs-type"><span class="hljs-type">UIViewController</span></span> <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">Context</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findViewController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with context: Context)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ViewController?</span></span> }</code> </pre> <br><p>  Si almacena enlaces a todos los controladores de vista que cre√≥, en la implementaci√≥n del <code>Finder</code> simplemente puede devolver un enlace al controlador de vista deseado.  Pero a menudo esto no es as√≠, porque la pila de aplicaciones, especialmente si es grande, cambia de forma bastante din√°mica.  Adem√°s, puede tener varios controladores de vista id√©nticos en la pila que muestran diferentes entidades (por ejemplo, varios ProductViewControllers que muestran diferentes productos con diferentes ID de producto), por lo que la implementaci√≥n del <code>Finder</code> puede requerir una implementaci√≥n personalizada y buscar el controlador de vista correspondiente en la pila.  La biblioteca facilita esta tarea al proporcionar <code>StackIteratingFinder</code> como una extensi√≥n del <code>Finder</code> , un protocolo con la configuraci√≥n adecuada para simplificar esta tarea.  En la implementaci√≥n de <code>StackIteratingFinder</code> solo necesita responder la pregunta: ¬øes este controlador de vista el que el enrutador est√° buscando a pedido? </p><br><p>  Un ejemplo de tal implementaci√≥n: </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductViewControllerFinder</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StackIteratingFinder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> options: <span class="hljs-type"><span class="hljs-type">SearchOptions</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(options: <span class="hljs-type"><span class="hljs-type">SearchOptions</span></span> = .currentAndUp) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.options = options } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isTarget</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> productViewController: ProductViewController, with productID: UUID)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> productViewController.productID == productID } }</code> </pre> <br><h3 id="vspomogatelnye-suschnosti">  Entidades auxiliares </h3><br><h4 id="routinginterceptor"> <code>RoutingInterceptor</code> </h4> <br><p>  <code>RoutingInterceptor</code> permite realizar algunas acciones antes de comenzar la composici√≥n de los controladores de vista y decirle al enrutador si es posible integrar los controladores de vista en la pila.  El ejemplo m√°s com√∫n de una tarea de este tipo es la autenticaci√≥n (pero nada com√∫n en la implementaci√≥n).  Por ejemplo, desea mostrar un controlador de vista con los detalles de una cuenta de usuario, pero, para esto, el usuario debe iniciar sesi√≥n en el sistema.  Puede implementar un <code>RoutingInterceptor</code> y agregarlo a la configuraci√≥n de la vista del controlador de detalles del usuario y verificar desde adentro: si el usuario ha iniciado sesi√≥n, permita que el enrutador contin√∫e la navegaci√≥n, si no, muestre el controlador de vista que le indica que inicie sesi√≥n y si esta acci√≥n es exitosa, permita que el enrutador contin√∫e la navegaci√≥n o cancele ella si el usuario se niega a iniciar sesi√≥n. </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginInterceptor</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RoutingInterceptor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">for</span></span></span></span><span class="hljs-function"><span class="hljs-params"> destination: AppDestination, completion: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">: InterceptorResult)</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> !<span class="hljs-type"><span class="hljs-type">LoginManager</span></span>.sharedInstance.isUserLoggedIn <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">// ... //  LoginViewController       completion(.success)  completion(.failure("User has not been logged in.")) // ... return } completion(.success) } }</span></span></code> </pre><br><p>  Una implementaci√≥n de tal <code>RoutingInterceptor</code> con comentarios est√° contenida en el ejemplo suministrado con la biblioteca. </p><br><h4 id="contexttask"> <code>ContextTask</code> </h4> <br><p>  La entidad <code>ContextTask</code> , si la proporciona, se puede aplicar por separado a cada controlador de vista en la configuraci√≥n, independientemente de si fue creada por un enrutador o se encontr√≥ en la pila, y solo desea actualizar los datos y establecer algunos valores predeterminados par√°metros (por ejemplo, mostrar bot√≥n de cierre o no mostrar). </p><br><h4 id="postroutingtask"> <code>PostRoutingTask</code> </h4> <br><p>  El <code>PostRoutingTask</code> llamar√° a la implementaci√≥n de <code>PostRoutingTask</code> despu√©s de completar con √©xito la integraci√≥n del controlador de vista solicitado en la pila.  En su implementaci√≥n, es conveniente agregar varios an√°lisis o extraer varios servicios. </p><br><p>  <strong>M√°s detalladamente con la implementaci√≥n de todas las entidades descritas se puede encontrar en la documentaci√≥n de la biblioteca, as√≠ como en el ejemplo adjunto.</strong> </p><br><p>  PD: el n√∫mero de entidades auxiliares que se pueden agregar a la configuraci√≥n no est√° limitado. </p><br><h3 id="konfiguraciya">  Configuracion </h3><br><p>  Todas las entidades descritas son buenas porque dividen el proceso de composici√≥n en bloques peque√±os, intercambiables y confiables. </p><br><p>  Ahora pasemos a lo m√°s importante: a la configuraci√≥n, es decir, la conexi√≥n de estos bloques entre s√≠.  Para recopilar estos bloques entre ellos y combinarlos en una cadena de pasos, la biblioteca proporciona una clase de generador <code>StepAssembly</code> (para contenedores - <code>ContainerStepAssembly</code> ).  Su implementaci√≥n le permite encadenar los bloques de composici√≥n en un √∫nico objeto de configuraci√≥n, como cuentas en una cadena, y tambi√©n indicar las dependencias en las configuraciones de otros controladores de vista.  Qu√© hacer con la configuraci√≥n en el futuro depende de usted.  Puede alimentarlo al enrutador con los par√°metros necesarios y crear√° una pila de controladores para usted, puede guardarlo en el diccionario y usarlo m√°s tarde por clave; depende de su tarea espec√≠fica. </p><br><p>  Considere un ejemplo trivial: supongamos que, al hacer clic en una celda de la lista o cuando la aplicaci√≥n recibe un enlace universal de un cliente de safari o correo electr√≥nico, necesitamos mostrar modalmente el controlador del producto con un determinado ID de producto.  En este caso, el controlador del producto debe estar integrado dentro del <code>UINavigationController</code> para que pueda mostrar su nombre y el bot√≥n de cierre en su panel de control.  Adem√°s, este producto solo se puede mostrar a los usuarios que han iniciado sesi√≥n; de lo contrario, inv√≠telos a iniciar sesi√≥n. </p><br><p>  Si analiza este ejemplo sin usar una biblioteca, se ver√° as√≠: </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductArrayViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> products: [<span class="hljs-type"><span class="hljs-type">UUID</span></span>]? <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> analyticsManager = <span class="hljs-type"><span class="hljs-type">AnalyticsManager</span></span>.sharedInstance <span class="hljs-comment"><span class="hljs-comment">//  UITableViewControllerDelegate override func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) { guard let productID = products[indexPath.row] else { return } //   LoginInterceptor guard !LoginManager.sharedInstance.isUserLoggedIn else { //    LoginViewController         `showProduct(with: productID)` return } showProduct(with: productID) } func showProduct(with productID: String) { //   ProductViewControllerFactory let productViewController = ProductViewController(nibName: "ProductViewController", bundle: nil) //   ProductViewControllerContextTask productViewController.productID = productID //   NavigationControllerStep  PushToNavigationAction let navigationController = UINavigationController(rootViewController: productViewController) //   GenericActions.PresentModally present(alertController, animated: navigationController) { [weak self]   . ProductViewControllerPostTask self?.analyticsManager.trackProductView(productID: productID) } } }</span></span></code> </pre> <br><p>  Este ejemplo no incluye la implementaci√≥n de enlaces universales, que requerir√°n aislar el c√≥digo de autorizaci√≥n y mantener el contexto al que debe dirigirse el usuario, adem√°s de buscar, de repente el usuario hace clic en un enlace, y este producto ya se le muestra, lo que finalmente har√° que el c√≥digo sea muy Dif√≠cil de leer. </p><br><p>  <strong>Considere la configuraci√≥n de este ejemplo usando la biblioteca:</strong> </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> productScreen = <span class="hljs-type"><span class="hljs-type">StepAssembly</span></span>(finder: <span class="hljs-type"><span class="hljs-type">ProductViewControllerFinder</span></span>(), factory: <span class="hljs-type"><span class="hljs-type">ProductViewControllerFactory</span></span>()) <span class="hljs-comment"><span class="hljs-comment">//  : .adding(LoginInterceptor()) .adding(ProductViewControllerContextTask()) .adding(ProductViewControllerPostTask(analyticsManager: AnalyticsManager.sharedInstance)) //  : .using(PushToNavigationAction()) .from(NavigationControllerStep()) // NavigationControllerStep -&gt; StepAssembly(finder: NilFinder(), factory: NavigationControllerFactory()) .using(GeneralAction.presentModally()) .from(GeneralStep.current()) .assemble()</span></span></code> </pre> <br><p>  Si traduces esto al lenguaje humano: </p><br><ul><li>  Compruebe que el usuario haya iniciado sesi√≥n y, si no, ofr√©zcale una entrada. </li><li>  Si el usuario ha iniciado sesi√≥n correctamente, contin√∫e </li><li>  Buscar controlador de vista de producto proporcionado por <code>Finder</code> </li><li>  Si se encontr√≥, haga visible y termine </li><li>  Si no se encontr√≥, cree un <code>UINavigationController</code> , integre en √©l el controlador de vista creado por <code>ProductViewControllerFactory</code> utilizando <code>PushToNavigationAction</code> </li><li>  <code>UINavigationController</code> <code>GenericActions.PresentModally</code> <code>UINavigationController</code> <code>GenericActions.PresentModally</code> usando <code>GenericActions.PresentModally</code> desde el controlador de vista actual </li></ul><br><p>  La configuraci√≥n requiere alg√∫n estudio, como muchas soluciones complejas, por ejemplo, el concepto de <code>AutoLayout</code> y, a primera vista, puede parecer complicado y redundante.  Sin embargo, la cantidad de tareas que se resolver√°n con el fragmento de c√≥digo dado cubre todos los aspectos, desde la autorizaci√≥n hasta la vinculaci√≥n profunda, y dividir en una secuencia de acciones hace posible cambiar f√°cilmente la configuraci√≥n sin la necesidad de realizar cambios en el c√≥digo.  Adem√°s, la implementaci√≥n de <code>StepAssembly</code> lo ayudar√° a evitar problemas con una cadena de pasos incompleta y al control de tipos, problemas con la incompatibilidad de los par√°metros de entrada para diferentes controladores de vista. </p><br><p>  Considere el pseudoc√≥digo de una aplicaci√≥n completa en la que un <code>ProductArrayViewController</code> muestra una lista de productos y, si el usuario selecciona este producto, lo muestra dependiendo de si el usuario inici√≥ sesi√≥n o no, u ofrece iniciar sesi√≥n y se muestra despu√©s de un inicio de sesi√≥n exitoso: </p><br><p>  <strong>Objetos de configuraci√≥n</strong> </p><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">// `RoutingDestination`    .          . struct AppDestination: RoutingDestination { let finalStep: RoutingStep let context: Any? } struct Configuration { //     ,             static func productDestination(with productID: UUID) -&gt; AppDestination { let productScreen = StepAssembly(finder: ProductViewControllerFinder(), factory: ProductViewControllerFactory()) .add(LoginInterceptor()) .add(ProductViewControllerContextTask()) .add(ProductViewControllerPostTask(analyticsManager: AnalyticsManager.sharedInstance)) .using(PushToNavigationAction()) .from(NavigationControllerStep()) .using(GenericActions.PresentModally()) .from(CurrentControllerStep()) .assemble() return AppDestination(finalStep: productScreen, context: productID) } }</span></span></code> </pre> <br><p> <strong>  </strong> </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductArrayViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> products: [<span class="hljs-type"><span class="hljs-type">UUID</span></span>]? <span class="hljs-comment"><span class="hljs-comment">//... // DefaultRouter -  Router   ,   UIViewController   let router = DefaultRouter() override func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) { guard let productID = products[indexPath.row] else { return } router.navigate(to: Configuration.productDestination(with: productID)) } }</span></span></code> </pre> <br><p> <strong>  </strong> </p><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@UIApplicationMain</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppDelegate</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIResponder</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIApplicationDelegate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//... func application(_ application: UIApplication, open url: URL, sourceApplication: String?, annotation: Any) -&gt; Bool { guard let productID = UniversalLinksManager.parse(url: url) else { return false } return DefaultRouter().navigate(to: Configuration.productDestination(with: productID)) == .handled } }</span></span></code> </pre><br><p>              . </p><br><p>             . ,          , ,           ‚Äî       ProductArrayViewController,      UINavigationController   HomeViewController ‚Äî         <code>StepAssembly</code>  <code>from()</code> .     <code>RouteComposer</code> ,      (     ).  ,      <code>Configuration</code>               .     ,      A/B ,         . </p><br><h3 id="vmesto-zaklyucheniya">  En lugar de una conclusi√≥n </h3><br><p>   ,      3       .     ,  ,       .   <code>Fabric</code> , <code>Finder</code>  <code>Action</code>            .   ,     ‚Äî              ,    ,       .          ,      . </p><br><p> ,      ,      objective c       Cocoa Touch,             .     iOS  9  12. </p><br><p>            <code>UIViewController</code>  (MVC, MVVM, VIP, RIB, VIPER  ..) </p><br><p>      ,   ,     ,   .         .            . </p><br><p>      . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es421097/">https://habr.com/ru/post/es421097/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es421087/index.html">C√≥mo configurar la implementaci√≥n de aplicaciones web en Go for Gitlab en VDS</a></li>
<li><a href="../es421089/index.html">Los proveedores rusos han descubierto c√≥mo transferir a Google parte de los costos del "Paquete de primavera"</a></li>
<li><a href="../es421091/index.html">C√≥mo redujimos el tiempo para desarrollar modelos de puntuaci√≥n cinco veces al cambiar a Python</a></li>
<li><a href="../es421093/index.html">C√≥mo aprendo Spring framework - parte 2 (ayuda para principiantes - el trabajo de los principiantes mismos)</a></li>
<li><a href="../es421095/index.html">Seg√∫n el nuevo proyecto de ley sobre el bloqueo previo al juicio, pueden caer 19 millones de sitios</a></li>
<li><a href="../es421099/index.html">¬øEs dif√≠cil concentrarse? Quiz√°s no es tu culpa</a></li>
<li><a href="../es421101/index.html">"Calendario de prueba" para agosto. Leer un libro</a></li>
<li><a href="../es421103/index.html">Primer vistazo al Mavic 2: vuela m√°s largo, m√°s tranquilo, m√°s r√°pido</a></li>
<li><a href="../es421105/index.html">Situaci√≥n: Spotify hace tratos directos con m√∫sicos; las etiquetas no est√°n contentas</a></li>
<li><a href="../es421107/index.html">Desmontamos y vemos certificados calificados usando Python / Tkinter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>