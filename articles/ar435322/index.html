<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👚 🐽 👅 دليل آخر لتخفيض عدد الألواح المسترجعة (NGRX) 🚦 🛳️ ✳️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ماذا سيكون حول؟ 


 سنتحدث عن عدة طرق (خمسة ، لتكون محددة) ، والحيل ، والتضحيات الدموية لإله المؤسسة ، والتي يبدو أنها تساعدنا في كتابة كود أكثر إيجاز...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>دليل آخر لتخفيض عدد الألواح المسترجعة (NGRX)</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435322/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/n7/ws/br/n7wsbrphgkyoghehxfoydlcf5zq.jpeg"></p><br><h2 id="o-chem-poydet-rech" style=";text-align:right;direction:rtl">  ماذا سيكون حول؟ </h2><br><p style=";text-align:right;direction:rtl">  سنتحدث عن عدة طرق (خمسة ، لتكون محددة) ، والحيل ، والتضحيات الدموية لإله المؤسسة ، والتي يبدو أنها تساعدنا في كتابة كود أكثر إيجازًا وتعبيرًا في تطبيقات Redux (و NGRX!) الخاصة بنا.  طرق تعاني من العرق والقهوة.  من فضلك ركل وانتقد بشدة.  سوف نتعلم أن نرمز معا بشكل أفضل. </p><a name="habracut"></a><br><p style=";text-align:right;direction:rtl">  بصراحة ، في البداية أردت فقط أن أخبر العالم عن مكتبتي الصغيرة الجديدة (35 سطرًا من الكود!) فئة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">تدفقات الحركة</a> ، لكنني أتطلع إلى العدد المتزايد باستمرار من التعجبات التي سيصبح Habr قريباً Twitter ، والجزء الأكبر منها أتفق معهم ، قررت أن أحاول قراءة قراءة رحبة بعض الشيء.  لذلك ، نلتقي 5 طرق لترقية تطبيق Redux الخاص بك! </p><br><h2 id="boylerpleyt-vyhodi" style=";text-align:right;direction:rtl">  Boilerplate يخرج </h2><br><p style=";text-align:right;direction:rtl">  فكر في مثال نموذجي لكيفية إرسال طلب AJAX إلى Redux.  دعنا نتخيل أننا نحتاج حقًا إلى قائمة الأختام من الخادم. </p><br><pre style=";text-align:right;direction:rtl"><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { createSelector } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'reselect'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionTypeCatsGetInit = <span class="hljs-string"><span class="hljs-string">'CATS_GET_INIT'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionTypeCatsGetSuccess = <span class="hljs-string"><span class="hljs-string">'CATS_GET_SUCCESS'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionTypeCatsGetError = <span class="hljs-string"><span class="hljs-string">'CATS_GET_ERROR'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionCatsGetInit = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: actionTypeCatsGetInit }) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionCatsGetSuccess = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">payload</span></span></span><span class="hljs-function">) =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: actionTypeCatsGetSuccess, payload, }) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionCatsGetError = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: actionTypeCatsGetError, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: error, }) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerCatsInitialState = { <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerCats = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = reducerCatsInitialState, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> actionTypeCatsGetInit: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> actionCatsGetSuccess: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: action.payload, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> actionCatsGetError: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...data, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: action.payload, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state } } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> makeSelectorCatsData = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> createSelector( <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) =&gt;</span></span> state.cats.data, (cats) =&gt; cats, ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> makeSelectorCatsLoading = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> createSelector( <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) =&gt;</span></span> state.cats.loading, (loading) =&gt; loading, ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> makeSelectorCatsError = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> createSelector( <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) =&gt;</span></span> state.cats.error, (error) =&gt; error, )</code> </pre> <br><p style=";text-align:right;direction:rtl">  <em>إذا كنت لا تفهم تمامًا سبب الحاجة إلى مصانع محددات هنا ، فيمكنك القراءة عنها <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">هنا.</a></em> </p><br><p style=";text-align:right;direction:rtl">  <em>أنا لا أعتبر الآثار الجانبية عن علم.</em>  <em>هذا موضوع لمقال منفصل مليء بالغضب في سن المراهقة وانتقاد النظام البيئي الحالي: D</em> </p><br><p style=";text-align:right;direction:rtl">  هناك عدة نقاط ضعف في هذا الرمز: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  تعتبر مصانع الإجراءات فريدة في حد ذاتها ، لكننا لا نزال نستخدم أنواع الإجراءات. </li><li style=";text-align:right;direction:rtl">  عند إضافة كيانات جديدة ، نستمر في تكرار نفس المنطق لضبط علامة <code>loading</code> .  البيانات التي نخزنها في <code>data</code> ، ونموذجها يمكن أن تختلف اختلافًا كبيرًا من طلب إلى آخر ، لكن مؤشر التنزيل (علامة <code>loading</code> ) سيظل كما هو. </li><li style=";text-align:right;direction:rtl">  وقت تشغيل التبديل هو (ن) (حسنا ، <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">تقريبا</a> ).  هذه في حد ذاتها ليست حجة قوية للغاية ، لأن Redux ، من حيث المبدأ ، لا يتعلق بالأداء.  يزعجني أكثر أنه في كل <code>case</code> تحتاج إلى كتابة سطرين إضافيين من شفرة التقديم ، ولا يمكن تقسيم هذا <code>switch</code> بسهولة وبجمال إلى عدة. </li><li style=";text-align:right;direction:rtl">  هل نحتاج حقًا إلى تخزين حالة الخطأ لكل كيان على حدة؟ </li><li style=";text-align:right;direction:rtl">  محددات بارد.  محددات memoized بارد مضاعفة.  يقدمون لنا تجريدًا من جانبنا ، بحيث لا يتعين علينا فيما بعد إعادة نصف الطلب عند تغيير النموذج الخاص به.  نحن فقط تغيير المحدد نفسه.  ما لا يرضي العين هو مجموعة من المصانع البدائية اللازمة فقط بسبب خصوصيات المذكرات في <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">إعادة البحث</a> . </li></ul><br><h2 id="sposob-1-izbavlyaemsya-ot-ekshn-tipov" style=";text-align:right;direction:rtl">  الطريقة 1: التخلص من أنواع الإجراءات </h2><br><p style=";text-align:right;direction:rtl">  حسنا ، ليس حقا.  نحن فقط نجعل JS تصنعها لنا. </p><br><p style=";text-align:right;direction:rtl">  دعونا نفكر لثانية واحدة حول سبب حاجتنا عمومًا إلى أنواع الإجراءات.  حسنًا ، من الواضح ، أن نبدأ فرع المنطق المطلوب في المخفض الخاص بنا وتغيير حالة التطبيق وفقًا لذلك.  السؤال الحقيقي هو ، هل يجب أن يكون النوع عبارة عن سلسلة؟  ولكن ماذا لو استخدمنا الفصول وقمنا <code>switch</code> حسب النوع؟ </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsGetInit</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsGetSuccess</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(responseData) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.payload = responseData } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsGetError</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(error) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.payload = error <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.error = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerCatsInitialState = { <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerCats = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = reducerCatsInitialState, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.constructor) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CatsGetInit: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CatsGetSuccess: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: action.payload, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CatsGetError: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...data, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: action.payload, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  يبدو أن كل شيء رائع ، ولكن هناك مشكلة واحدة: فقدنا تسلسل أعمالنا.  لم تعد هذه كائنات بسيطة يمكننا تحويلها إلى سلسلة والعكس صحيح.  الآن نعتمد على حقيقة أن كل إجراء له نموذجه الفريد الخاص به ، والذي ، في الواقع ، يسمح بتصميم مثل <code>switch</code> على <code>action.constructor</code> للعمل.  كما تعلم ، أحب حقًا فكرة إجراء تسلسل لأفعالي في سلسلة وإرسالها مع تقرير خطأ ، وأنا لست مستعدًا لرفضه. </p><br><p style=";text-align:right;direction:rtl">  لذلك ، يجب أن يحتوي كل إجراء على حقل <code>type</code> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">هنا</a> يمكنك معرفة الإجراءات الأخرى التي يجب أن يكون لكل إجراء يحترم الإجراء).  لحسن الحظ ، كل فئة لها اسم يشبه السلسلة.  دعنا نضيف <code>type</code> getter <code>type</code> كل فصل سيعود اسم هذه الفئة. </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsGetInit</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.constructor.name } } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerCats = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CatsGetInit.name: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, } <span class="hljs-comment"><span class="hljs-comment">//... } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  إنه يعمل بشكل جيد ، لكنني أرغب في التمسك بادئة لكل نوع ، كما يقترح السيد إريك في <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">البط المعياري - استرجاع</a> (أوصي بالنظر إلى مفترق <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">إعادة البط</a> ، وهو أكثر برودة بالنسبة لي).  لإضافة بادئة ، سيتعين علينا التوقف عن استخدام اسم الفصل مباشرةً ، وإضافة برنامج آخر.  الآن ثابت. </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsGetInit</span></span></span><span class="hljs-class"> </span></span>{ get <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> type () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">`prefix/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.name}</span></span></span><span class="hljs-string">`</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span> () { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.constructor.type } } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerCats = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CatsGetInit.type: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, } <span class="hljs-comment"><span class="hljs-comment">//... } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  دعونا تمشيط هذا الشيء كله قليلا.  قم بتقليل لصق النسخ إلى الحد الأدنى وإضافة شرط آخر: إذا كان الإجراء يمثل خطأ ، فيجب أن تكون <code>payload</code> من النوع <code>Error</code> . </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionStandard</span></span></span><span class="hljs-class"> </span></span>{ get <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> type () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">`prefix/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.name}</span></span></span><span class="hljs-string">`</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(payload) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.constructor.type <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.payload = payload <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.error = payload <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span> } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsGetInit</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionStandard</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsGetSuccess</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionStandard</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsGetError</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionStandard</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerCatsInitialState = { <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerCats = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = reducerCatsInitialState, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CatsGetInit.type: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CatsGetSuccess.type: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: action.payload, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CatsGetError.type: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...data, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: action.payload, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  في هذه المرحلة ، يعمل هذا الرمز بشكل جيد مع NGRX ، لكن Redux غير قادر على مضغه.  يقسم أن العمل يجب أن يكون أشياء بسيطة.  لحسن الحظ ، تسمح لنا JS بإرجاع أي شيء تقريبًا من المصمم ، لكننا لسنا بحاجة حقًا إلى سلسلة نماذج أولية بعد إنشاء الإجراء. </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionStandard</span></span></span><span class="hljs-class"> </span></span>{ get <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> type () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">`prefix/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.name}</span></span></span><span class="hljs-string">`</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(payload) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.constructor.type, payload, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: payload <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span> } } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsGetInit</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionStandard</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsGetSuccess</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionStandard</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsGetError</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionStandard</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerCatsInitialState = { <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerCats = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = reducerCatsInitialState, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CatsGetInit.type: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CatsGetSuccess.type: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: action.payload, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CatsGetError.type: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...data, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: action.payload, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  بناءً على الاعتبارات المذكورة أعلاه ، تمت كتابة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">مكتبة micro-class-class</a> .  هناك اختبارات وتغطية اختبار 100٪ ونفس فئة أكشن ستاندارد <code>ActionStandard</code> الأدوية الجنيسة لتلبية احتياجات TypeScript.  يعمل مع كل من TypeScript و JavaScript. </p><br><h2 id="sposob-2-ne-boimsya-ispolzovat-combinereducers" style=";text-align:right;direction:rtl">  الطريقة 2: نحن لسنا خائفين من استخدام CombineReducers </h2><br><p style=";text-align:right;direction:rtl">  الفكرة سهلة الخزي: استخدام <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">أدوات الجمع</a> لا تقتصر فقط على مخفضات المستوى الأعلى ، ولكن أيضًا لمزيد من <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">تفصيل</a> المنطق وإنشاء مخفض منفصل <code>loading</code> . </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerLoading = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">actionInit, actionSuccess, actionError</span></span></span><span class="hljs-function">) =&gt;</span></span> ( state = <span class="hljs-literal"><span class="hljs-literal">false</span></span>, action, ) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> actionInit.type: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> actionSuccess.type: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> actionError.type: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsGetInit</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionStandard</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsGetSuccess</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionStandard</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsGetError</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionStandard</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerCatsData = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">undefined</span></span></span></span><span class="hljs-function"><span class="hljs-params">, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CatsGetSuccess.type: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> action.payload <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state } } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerCatsError = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">undefined</span></span></span></span><span class="hljs-function"><span class="hljs-params">, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CatsGetError.type: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> action.payload <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state } } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerCats = combineReducers({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: reducerCatsData, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: reducerLoading(CatsGetInit, CatsGetSuccess, CatsGetError), <span class="hljs-attr"><span class="hljs-attr">error</span></span>: reducerCatsError, })</code> </pre> <br><h2 id="sposob-3-izbavimsya-ot-switch" style=";text-align:right;direction:rtl">  الطريقة الثالثة: تخلص من المفتاح </h2><br><p style=";text-align:right;direction:rtl">  ومرة أخرى فكرة بسيطة للغاية: بدلاً من <code>switch-case</code> استخدم كائنًا لتحديد الحقل المطلوب حسب المفتاح.  الوصول إلى حقل الكائن بواسطة المفتاح هو O (1) ، ويبدو أنظف قليلاً في رأيي المتواضع. </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> createReducer = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">initialState, reducerMap</span></span></span><span class="hljs-function">) =&gt;</span></span> ( state = initialState, action, ) =&gt; { <span class="hljs-comment"><span class="hljs-comment">//       const reducer = state[action.type] if (!reducer) { return state } //  ,    return reducer(state, action) } const reducerLoading = (actionInit, actionSuccess, actionError) =&gt; createReducer(false, { [actionInit.type]: () =&gt; true, [actionSuccess.type]: () =&gt; false, [actionError.type]: () =&gt; false, }) class CatsGetInit extends ActionStandard {} class CatsGetSuccess extends ActionStandard {} class CatsGetError extends ActionStandard {} const reducerCatsData = createReducer(undefined, { [CatsGetSuccess.type]: () =&gt; action.payload, }) const reducerCatsError = createReducer(undefined, { [CatsGetError.type]: () =&gt; action.payload, }) const reducerCats = combineReducers({ data: reducerCatsData, loading: reducerLoading(CatsGetInit, CatsGetSuccess, CatsGetError), error: reducerCatsError, })</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  دعونا refactor <code>reducerLoading</code> .  الآن ، ومعرفة الخرائط (الكائنات) الخاصة <code>reducerLoading</code> ، يمكننا إرجاع هذه الخريطة من <code>reducerLoading</code> ، بدلاً من إرجاع المخفض بالكامل.  يحتمل أن يفتح هذا نطاقًا غير محدود لتوسيع الوظيفة. </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> createReducer = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">initialState, reducerMap</span></span></span><span class="hljs-function">) =&gt;</span></span> ( state = initialState, action, ) =&gt; { <span class="hljs-comment"><span class="hljs-comment">//       const reducer = state[action.type] if (!reducer) { return state } //  ,    return reducer(state, action) } const reducerLoadingMap = (actionInit, actionSuccess, actionError) =&gt; ({ [actionInit.type]: () =&gt; true, [actionSuccess.type]: () =&gt; false, [actionError.type]: () =&gt; false, }) class CatsGetInit extends ActionStandard {} class CatsGetSuccess extends ActionStandard {} class CatsGetError extends ActionStandard {} const reducerCatsLoading = createReducer( false, reducerLoadingMap(CatsGetInit, CatsGetSuccess, CatsGetError), ) /*       reducerCatsLoading: const reducerCatsLoading = createReducer( false, { ...reducerLoadingMap(CatsGetInit, CatsGetSuccess, CatsGetError), ... some custom stuff } ) */ const reducerCatsData = createReducer(undefined, { [CatsGetSuccess.type]: () =&gt; action.payload, }) const reducerCatsError = createReducer(undefined, { [CatsGetError.type]: () =&gt; action.payload, }) const reducerCats = combineReducers({ data: reducerCatsData, loading: reducerCatsLoading), error: reducerCatsError, })</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">تتحدث الوثائق الرسمية عن Redux أيضًا عن هذا النهج</a> ، ومع ذلك ، ولسبب غير معروف ، ما زلت أرى الكثير من المشاريع التي تستخدم <code>switch-case</code> .  بناءً على الكود من الوثائق الرسمية ، قام السيد موشيه بتجميع مكتبة لنا من أجل <code>createReducer</code> . </p><br><h2 id="sposob-4-ispolzuem-globalnyy-obrabotchik-oshibok" style=";text-align:right;direction:rtl">  الطريقة الرابعة: استخدام معالج الأخطاء العمومي </h2><br><p style=";text-align:right;direction:rtl">  لا يتعين علينا مطلقًا الاحتفاظ بالخطأ لكل كيان على حدة.  في معظم الحالات ، نريد فقط إظهار الحوار.  نفس الحوار مع النص الديناميكي لجميع الكيانات. </p><br><p style=";text-align:right;direction:rtl">  إنشاء معالج خطأ عمومي.  في أبسط الحالات ، قد يبدو مثل هذا: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GlobalErrorInit</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionStandard</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GlobalErrorClear</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionStandard</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerError = createReducer(<span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, { [GlobalErrorInit.type]: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) =&gt;</span></span> action.payload, [GlobalErrorClear.type]: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, })</code> </pre> <br><p style=";text-align:right;direction:rtl">  ثم في تأثيرنا الجانبي سوف نرسل الإجراء <code>ErrorInit</code> في <code>catch</code> .  قد يبدو مثل هذا عند استخدام <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">redux-thunk</a> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> catsGetAsync = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (dispatch) =&gt; { dispatch(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CatsGetInit()) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> res = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> fetch(<span class="hljs-string"><span class="hljs-string">'https://cats.com/api/v1/cats'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> body = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> res.json() dispatch(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CatsGetSuccess(body)) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (error) { dispatch(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CatsGetError(error)) dispatch(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GlobalErrorInit(error)) } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  الآن يمكننا التخلص من حقل <code>error</code> في متجرنا للقطط واستخدام <code>CatsGetError</code> فقط لتبديل علامة <code>loading</code> . </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsGetInit</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionStandard</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsGetSuccess</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionStandard</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsGetError</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionStandard</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerCatsLoading = createReducer( <span class="hljs-literal"><span class="hljs-literal">false</span></span>, reducerLoadingMap(CatsGetInit, CatsGetSuccess, CatsGetError), ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerCatsData = createReducer(<span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, { [CatsGetSuccess.type]: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> action.payload, }) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerCats = combineReducers({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: reducerCatsData, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: reducerCatsLoading) })</code> </pre> <br><h2 id="sposob-5-dumaem-pered-memoizaciey" style=";text-align:right;direction:rtl">  الطريقة 5: فكر قبل Memoizing </h2><br><p style=";text-align:right;direction:rtl">  دعونا نلقي نظرة على كومة من المصانع للاختيار مرة أخرى. </p><br><p style=";text-align:right;direction:rtl">  <em>رميت <code>makeSelectorCatsError</code> لأنه لم يعد هناك حاجة ، كما وجدنا في الفصل السابق.</em> </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> makeSelectorCatsData = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> createSelector( <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) =&gt;</span></span> state.cats.data, (cats) =&gt; cats, ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> makeSelectorCatsLoading = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> createSelector( <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) =&gt;</span></span> state.cats.loading, (loading) =&gt; loading, )</code> </pre> <br><p style=";text-align:right;direction:rtl">  لماذا نحتاج محددات memoized هنا؟  ما الذي نحاول تحديده بالضبط؟  الوصول إلى حقل الكائن حسب المفتاح ، وهو ما يحدث هنا ، هو O (1).  يمكننا استخدام وظائف عادية غير مذكّرة.  استخدم المذكرة فقط عندما تريد تغيير البيانات من المتجر قبل إعطائها للمكون. </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> selectorCatsData = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) =&gt;</span></span> state.cats.data <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> selectorCatsLoading = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) =&gt;</span></span> state.cats.loading</code> </pre> <br><p style=";text-align:right;direction:rtl">  الحفظ المنطقي في حالة حساب النتيجة على الطاير.  على سبيل المثال أدناه ، دعونا نتخيل أن كل قطة هي كائن يحتوي على حقل <code>name</code> ، ونريد الحصول على سلسلة تحتوي على أسماء جميع القطط. </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> makeSelectorCatNames = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> createSelector( <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) =&gt;</span></span> state.cats.data, (cats) =&gt; cats.data.reduce(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">accum, { name }</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${accum}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${name}</span></span></span><span class="hljs-string">`</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>), )</code> </pre> <br><h2 id="vyvod" style=";text-align:right;direction:rtl">  الخاتمة </h2><br><p style=";text-align:right;direction:rtl">  دعونا نرى مرة أخرى من حيث بدأنا: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { createSelector } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'reselect'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionTypeCatsGetInit = <span class="hljs-string"><span class="hljs-string">'CATS_GET_INIT'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionTypeCatsGetSuccess = <span class="hljs-string"><span class="hljs-string">'CATS_GET_SUCCESS'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionTypeCatsGetError = <span class="hljs-string"><span class="hljs-string">'CATS_GET_ERROR'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionCatsGetInit = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: actionTypeCatsGetInit }) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionCatsGetSuccess = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: actionTypeCatsGetSuccess }) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionCatsGetError = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: actionTypeCatsGetError }) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerCatsInitialState = { <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerCats = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = reducerCatsInitialState, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> actionTypeCatsGetInit: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> actionCatsGetSuccess: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: action.payload, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> actionCatsGetError: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...data, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: action.payload, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state } } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> makeSelectorCatsData = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> createSelector( <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) =&gt;</span></span> state.cats.data, (cats) =&gt; cats, ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> makeSelectorCatsLoading = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> createSelector( <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) =&gt;</span></span> state.cats.loading, (loading) =&gt; loading, ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> makeSelectorCatsError = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> createSelector( <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) =&gt;</span></span> state.cats.error, (error) =&gt; error, )</code> </pre> <br><p style=";text-align:right;direction:rtl">  وماذا جاء إلى: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsGetInit</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionStandard</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsGetSuccess</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionStandard</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsGetError</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionStandard</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerCatsLoading = createReducer( <span class="hljs-literal"><span class="hljs-literal">false</span></span>, reducerLoadingMap(CatsGetInit, CatsGetSuccess, CatsGetError), ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerCatsData = createReducer(<span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, { [CatsGetSuccess.type]: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> action.payload, }) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerCats = combineReducers({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: reducerCatsData, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: reducerCatsLoading) }) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> selectorCatsData = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) =&gt;</span></span> state.cats.data <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> selectorCatsLoading = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) =&gt;</span></span> state.cats.loading</code> </pre> <br><p style=";text-align:right;direction:rtl">  أرجو ألا تضيع الوقت دون جدوى ، وكانت المقالة مفيدة لك على الأقل.  كما قلت في البداية ، يرجى الركل وانتقد بشدة.  سوف نتعلم أن نرمز معا بشكل أفضل. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar435322/">https://habr.com/ru/post/ar435322/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar435308/index.html">الكتب الإلكترونية وأشكالها: إخبار PDF - تاريخه وإيجابياته وسلبياته</a></li>
<li><a href="../ar435312/index.html">Electric Polestar 2 - أول سيارة كهربائية مزودة بنظام التشغيل Android Auto OS الأصلي</a></li>
<li><a href="../ar435314/index.html">"اعرف الأفضل - افعل الأفضل": بث جديد عن مزيج العمل وهواية المحرر / المسوق</a></li>
<li><a href="../ar435316/index.html">ابتكر العلماء الكوريون نظامًا لتتبع حركة المرور من جهازي كمبيوتر محمول</a></li>
<li><a href="../ar435320/index.html">أسرع وأكثر دقة: نظام هجين من البتات غير المتجانسة</a></li>
<li><a href="../ar435324/index.html">تبدأ تسلا في بناء مصنع في شنغهاي ، لكن الوضع في الشركة صعب</a></li>
<li><a href="../ar435326/index.html">الفيديو كونفرنس نظرة عامة على السوق</a></li>
<li><a href="../ar435328/index.html">كيفية العمل مع شادر الرسم البياني في Unity3D</a></li>
<li><a href="../ar435330/index.html">Cisco DevNet كمنصة تعليمية ، ميزات للمطورين والمهندسين</a></li>
<li><a href="../ar435332/index.html">لوحة المفاتيح تبول لي قبالة</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>