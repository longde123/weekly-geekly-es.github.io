<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë§ ‚òëÔ∏è üéπ Configura√ß√£o compil√°vel de um sistema distribu√≠do üñïüèº ‚èπÔ∏è üíÆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Neste post, gostar√≠amos de compartilhar uma maneira interessante de lidar com a configura√ß√£o de um sistema distribu√≠do. 
 A configura√ß√£o √© representad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Configura√ß√£o compil√°vel de um sistema distribu√≠do</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/primetalk/blog/447690/"><p>  Neste post, gostar√≠amos de compartilhar uma maneira interessante de lidar com a configura√ß√£o de um sistema distribu√≠do. <br>  A configura√ß√£o √© representada diretamente no idioma Scala de maneira segura.  Um exemplo de implementa√ß√£o √© descrito em detalhes.  V√°rios aspectos da proposta s√£o discutidos, incluindo influ√™ncia no processo geral de desenvolvimento. </p><br><p><img src="https://habrastorage.org/webt/71/bl/ax/71blaxtldz-ia4yftyebaxbam7c.png" alt="Processo geral de gerenciamento de configura√ß√£o"></p><br><p>  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">em russo</a> ) </p><a name="habracut"></a><br><h3 id="introduction">  1. Introdu√ß√£o </h3><br><p>  A constru√ß√£o de sistemas distribu√≠dos robustos requer o uso de configura√ß√£o correta e coerente em todos os n√≥s.  Uma solu√ß√£o t√≠pica √© usar uma descri√ß√£o de implanta√ß√£o textual (terraform, ansible ou algo semelhante) e arquivos de configura√ß√£o gerados automaticamente (geralmente - dedicados a cada n√≥ / fun√ß√£o).  Tamb√©m gostar√≠amos de usar os mesmos protocolos das mesmas vers√µes em cada n√≥ de comunica√ß√£o (caso contr√°rio, ter√≠amos problemas de incompatibilidade).  No mundo da JVM, isso significa que pelo menos a biblioteca de mensagens deve ter a mesma vers√£o em todos os n√≥s de comunica√ß√£o. </p><br><p>  Que tal testar o sistema?  Obviamente, devemos ter testes de unidade para todos os componentes antes de chegar aos testes de integra√ß√£o.  Para poder extrapolar os resultados do teste em tempo de execu√ß√£o, devemos garantir que as vers√µes de todas as bibliotecas sejam mantidas id√™nticas nos ambientes de tempo de execu√ß√£o e de teste. </p><br><p>  Ao executar testes de integra√ß√£o, geralmente √© muito mais f√°cil ter o mesmo caminho de classe em todos os n√≥s.  S√≥ precisamos garantir que o mesmo caminho de classe seja usado na implanta√ß√£o.  (√â poss√≠vel usar caminhos de classe diferentes em n√≥s diferentes, mas √© mais dif√≠cil representar essa configura√ß√£o e implant√°-la corretamente.) Portanto, para manter as coisas simples, consideraremos apenas caminhos de classe id√™nticos em todos os n√≥s. </p><br><p>  A configura√ß√£o tende a evoluir junto com o software.  Geralmente usamos vers√µes para identificar v√°rios <br>  est√°gios da evolu√ß√£o do software.  Parece razo√°vel cobrir a configura√ß√£o no gerenciamento de vers√µes e identificar configura√ß√µes diferentes com alguns r√≥tulos.  Se houver apenas uma configura√ß√£o em produ√ß√£o, podemos usar a vers√£o √∫nica como um identificador.  √Äs vezes, podemos ter v√°rios ambientes de produ√ß√£o.  E para cada ambiente, podemos precisar de um ramo de configura√ß√£o separado.  Portanto, as configura√ß√µes podem ser rotuladas com ramifica√ß√£o e vers√£o para identificar exclusivamente configura√ß√µes diferentes.  Cada r√≥tulo e vers√£o da ramifica√ß√£o corresponde a uma √∫nica combina√ß√£o de n√≥s distribu√≠dos, portas, recursos externos e vers√µes da biblioteca de caminhos de classe em cada n√≥.  Aqui, cobriremos apenas a ramifica√ß√£o √∫nica e identificaremos as configura√ß√µes por uma vers√£o decimal de tr√™s componentes (1.2.3), da mesma maneira que outros artefatos. </p><br><p>  Nos ambientes modernos, os arquivos de configura√ß√£o n√£o s√£o mais modificados manualmente.  Normalmente geramos <br>  arquivos de configura√ß√£o no momento da implanta√ß√£o e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nunca mais os toque</a> .  Ent√£o, pode-se perguntar por que ainda usamos o formato de texto para arquivos de configura√ß√£o?  Uma op√ß√£o vi√°vel √© colocar a configura√ß√£o dentro de uma unidade de compila√ß√£o e se beneficiar da valida√ß√£o da configura√ß√£o em tempo de compila√ß√£o. </p><br><p>  Nesta postagem, examinaremos a id√©ia de manter a configura√ß√£o no artefato compilado. </p><br><h3 id="compilable-configuration">  Configura√ß√£o compil√°vel </h3><br><p>  Nesta se√ß√£o, discutiremos um exemplo de configura√ß√£o est√°tica.  Dois servi√ßos simples - o servi√ßo de eco e o cliente do servi√ßo de eco est√£o sendo configurados e implementados.  Em seguida, dois sistemas distribu√≠dos diferentes com os dois servi√ßos s√£o instanciados.  Um √© para uma configura√ß√£o de n√≥ √∫nico e outro para configura√ß√£o de dois n√≥s. </p><br><p>  Um sistema distribu√≠do t√≠pico consiste em alguns n√≥s.  Os n√≥s podem ser identificados usando algum tipo: </p><br><pre><code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Backend</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Frontend</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span></span></code> </pre> <br><p>  ou apenas </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">hostName: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">)</span></span></code> </pre> <br><p>  ou mesmo </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Singleton</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Singleton</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span></code> </pre> <br><p>  Esses n√≥s executam v√°rias fun√ß√µes, executam alguns servi√ßos e devem poder se comunicar com os outros n√≥s por meio de conex√µes TCP / HTTP. </p><br><p>  Para conex√£o TCP, √© necess√°rio pelo menos um n√∫mero de porta.  Tamb√©m queremos garantir que cliente e servidor estejam falando o mesmo protocolo.  Para modelar uma conex√£o entre n√≥s, declaremos a seguinte classe: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TcpEndPoint</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Protocol</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">node: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">NodeId</span></span></span></span><span class="hljs-class"><span class="hljs-params">, port: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Port</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Protocol</span></span></span></span><span class="hljs-class"><span class="hljs-params">]</span></span></span><span class="hljs-class">)</span></span></code> </pre> <br><p>  onde <code>Port</code> √© apenas um <code>Int</code> dentro do intervalo permitido: </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PortNumber</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Refined</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>, <span class="hljs-type"><span class="hljs-type">Closed</span></span>[_0, <span class="hljs-type"><span class="hljs-type">W</span></span>.`<span class="hljs-number"><span class="hljs-number">65535</span></span>`.<span class="hljs-type"><span class="hljs-type">T</span></span>]]</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Tipos refinados</b> <div class="spoiler_text"><p>  Veja a biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">refinada</a> .  Em suma, permite adicionar restri√ß√µes de tempo de compila√ß√£o a outros tipos.  Nesse caso, <code>Int</code> s√≥ pode ter valores de 16 bits que podem representar o n√∫mero da porta.  N√£o h√° requisitos para usar esta biblioteca para esta abordagem de configura√ß√£o.  Apenas parece se encaixar muito bem. </p></div></div><br><p>  Para HTTP (REST), tamb√©m podemos precisar de um caminho do servi√ßo: </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UrlPathPrefix</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Refined</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>, <span class="hljs-type"><span class="hljs-type">MatchesRegex</span></span>[<span class="hljs-type"><span class="hljs-type">W</span></span>.`<span class="hljs-string"><span class="hljs-string">"[a-zA-Z_0-9/]*"</span></span>`.<span class="hljs-type"><span class="hljs-type">T</span></span>]] <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PortWithPrefix</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Protocol</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">portNumber: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">PortNumber</span></span></span></span><span class="hljs-class"><span class="hljs-params">, pathPrefix: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">UrlPathPrefix</span></span></span></span></span><span class="hljs-class">)</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Tipo fantasma</b> <div class="spoiler_text"><p>  Para identificar o protocolo durante a compila√ß√£o, estamos usando o recurso Scala de declarar o argumento do tipo <code>Protocol</code> que n√£o √© usado na classe.  √â o chamado <em>tipo fantasma</em> .  Em tempo de execu√ß√£o, raramente precisamos de uma inst√¢ncia de identificador de protocolo, por isso n√£o a armazenamos.  Durante a compila√ß√£o, esse tipo de fantasma oferece seguran√ßa adicional ao tipo.  N√£o podemos passar a porta com protocolo incorreto. </p></div></div><br><p>  Um dos protocolos mais usados ‚Äã‚Äã√© a API REST com serializa√ß√£o Json: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JsonHttpRestProtocol</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RequestMessage</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ResponseMessage</span></span></span><span class="hljs-class">]</span></span></code> </pre> <br><p>  em que <code>RequestMessage</code> √© o tipo b√°sico de mensagens que o cliente pode enviar ao servidor e <code>ResponseMessage</code> √© a mensagem de resposta do servidor.  Obviamente, podemos criar outras descri√ß√µes de protocolo que especifiquem o protocolo de comunica√ß√£o com a precis√£o desejada. </p><br><p>  Para os fins deste post, usaremos uma vers√£o mais simples do protocolo: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleHttpGetRest</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RequestMessage</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ResponseMessage</span></span></span><span class="hljs-class">]</span></span></code> </pre> <br><p>  Neste protocolo, a mensagem de solicita√ß√£o √© anexada ao URL e a mensagem de resposta √© retornada como uma sequ√™ncia simples. </p><br><p>  Uma configura√ß√£o de servi√ßo pode ser descrita pelo nome do servi√ßo, uma cole√ß√£o de portas e algumas depend√™ncias.  Existem algumas maneiras poss√≠veis de como representar todos esses elementos no Scala (por exemplo, <code>HList</code> , tipos de dados alg√©bricos).  Para os fins deste post, usaremos o Cake Pattern e representaremos pe√ßas combin√°veis ‚Äã‚Äã(m√≥dulos) como caracter√≠sticas.  (O padr√£o de bolo n√£o √© um requisito para essa abordagem de configura√ß√£o compil√°vel. √â apenas uma poss√≠vel implementa√ß√£o da ideia.) </p><br><p>  Depend√™ncias podem ser representadas usando o padr√£o de bolo como pontos finais de outros n√≥s: </p><br><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoProtocol</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">A</span></span></span><span class="hljs-class">] </span></span>= <span class="hljs-type"><span class="hljs-type">SimpleHttpGetRest</span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>, <span class="hljs-type"><span class="hljs-type">A</span></span>] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoConfig</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">A</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">portNumber</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">PortNumber</span></span> = <span class="hljs-number"><span class="hljs-number">8081</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">echoPort</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">PortWithPrefix</span></span>[<span class="hljs-type"><span class="hljs-type">EchoProtocol</span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>]] = <span class="hljs-type"><span class="hljs-type">PortWithPrefix</span></span>[<span class="hljs-type"><span class="hljs-type">EchoProtocol</span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>]](portNumber, <span class="hljs-string"><span class="hljs-string">"echo"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">echoService</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">HttpSimpleGetEndPoint</span></span>[<span class="hljs-type"><span class="hljs-type">NodeId</span></span>, <span class="hljs-type"><span class="hljs-type">EchoProtocol</span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>]] = providedSimpleService(echoPort) }</code> </pre> <br><p>  O servi√ßo de eco precisa apenas de uma porta configurada.  E declaramos que esta porta suporta o protocolo de eco.  Observe que n√£o precisamos especificar uma porta espec√≠fica no momento, porque as caracter√≠sticas permitem declara√ß√µes de m√©todos abstratos.  Se usarmos m√©todos abstratos, o compilador exigir√° uma implementa√ß√£o em uma inst√¢ncia de configura√ß√£o.  Aqui fornecemos a implementa√ß√£o ( <code>8081</code> ) e ela ser√° usada como valor padr√£o se a ignorarmos em uma configura√ß√£o concreta. </p><br><p>  Podemos declarar uma depend√™ncia na configura√ß√£o do cliente de servi√ßo de eco: </p><br><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoClientConfig</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">A</span></span></span><span class="hljs-class">] </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testMessage</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">String</span></span> = <span class="hljs-string"><span class="hljs-string">"test"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pollInterval</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">FiniteDuration</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">echoServiceDependency</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">HttpSimpleGetEndPoint</span></span>[_, <span class="hljs-type"><span class="hljs-type">EchoProtocol</span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>]] }</code> </pre> <br><p>  A depend√™ncia tem o mesmo tipo que o <code>echoService</code> .  Em particular, exige o mesmo protocolo.  Portanto, podemos ter certeza de que, se conectarmos essas duas depend√™ncias, elas funcionar√£o corretamente. </p><br><div class="spoiler">  <b class="spoiler_title">Implementa√ß√£o de servi√ßos</b> <div class="spoiler_text"><p>  Um servi√ßo precisa de uma fun√ß√£o para iniciar e encerrar normalmente.  (A capacidade de encerrar um servi√ßo √© essencial para o teste.) Novamente, existem algumas op√ß√µes para especificar essa fun√ß√£o para uma determinada configura√ß√£o (por exemplo, poder√≠amos usar classes de tipo).  Para este post, usaremos novamente o Cake Pattern.  Podemos representar um servi√ßo usando <code>cats.Resource</code> que j√° fornece bracketing e libera√ß√£o de recursos.  Para adquirir um recurso, devemos fornecer uma configura√ß√£o e algum contexto de tempo de execu√ß√£o.  Portanto, a fun√ß√£o de inicializa√ß√£o do servi√ßo pode se parecer com: </p><br><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResourceReader</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">F</span></span></span><span class="hljs-class">[_], </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class">] </span></span>= <span class="hljs-type"><span class="hljs-type">Reader</span></span>[<span class="hljs-type"><span class="hljs-type">Config</span></span>, <span class="hljs-type"><span class="hljs-type">Resource</span></span>[<span class="hljs-type"><span class="hljs-type">F</span></span>, <span class="hljs-type"><span class="hljs-type">A</span></span>]] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">F</span></span></span><span class="hljs-class">[_]] </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">resource</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> implicit resolver: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">AddressResolver</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">F</span></span></span></span><span class="hljs-class"><span class="hljs-params">], timer: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Timer</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">F</span></span></span></span><span class="hljs-class"><span class="hljs-params">], contextShift: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">ContextShift</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">F</span></span></span></span><span class="hljs-class"><span class="hljs-params">], ec: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">ExecutionContext</span></span></span></span><span class="hljs-class"><span class="hljs-params">, applicative: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Applicative</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">F</span></span></span></span><span class="hljs-class"><span class="hljs-params">] </span></span></span><span class="hljs-class">)</span></span>: <span class="hljs-type"><span class="hljs-type">ResourceReader</span></span>[<span class="hljs-type"><span class="hljs-type">F</span></span>, <span class="hljs-type"><span class="hljs-type">Config</span></span>, <span class="hljs-type"><span class="hljs-type">Unit</span></span>] }</code> </pre> <br><p>  onde </p><br><ul><li>  <code>Config</code> - tipo de configura√ß√£o exigida por este iniciador de servi√ßo </li><li>  <code>AddressResolver</code> - um objeto de tempo de execu√ß√£o que tem a capacidade de obter endere√ßos reais de outros n√≥s (continue lendo para obter detalhes). </li></ul><br><p>  os outros tipos s√£o de <code>cats</code> : </p><br><ul><li>  <code>F[_]</code> - tipo de efeito (no caso mais simples, <code>F[A]</code> poderia ser apenas <code>() =&gt; A</code> Neste post, usaremos <code>cats.IO</code> ) </li><li>  <code>Reader[A,B]</code> - √© mais ou menos sin√¥nimo de uma fun√ß√£o <code>A =&gt; B</code> </li><li>  <code>cats.Resource</code> - tem maneiras de adquirir e liberar </li><li>  <code>Timer</code> - permite dormir / medir o tempo </li><li>  <code>ContextShift</code> - an√°logo de <code>ExecutionContext</code> </li><li>  <code>Applicative</code> - inv√≥lucro de fun√ß√µes em vigor (quase uma m√¥nada) (podemos eventualmente substitu√≠-lo por outra coisa) </li></ul><br><p>  Usando essa interface, podemos implementar alguns servi√ßos.  Por exemplo, um servi√ßo que n√£o faz nada: </p><br><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZeroServiceImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">F</span></span></span><span class="hljs-class">[_]] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">F</span></span></span><span class="hljs-class">] </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">&lt;</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Any</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resource</span></span></span></span>(...): <span class="hljs-type"><span class="hljs-type">ResourceReader</span></span>[<span class="hljs-type"><span class="hljs-type">F</span></span>, <span class="hljs-type"><span class="hljs-type">Config</span></span>, <span class="hljs-type"><span class="hljs-type">Unit</span></span>] = <span class="hljs-type"><span class="hljs-type">Reader</span></span>(_ =&gt; <span class="hljs-type"><span class="hljs-type">Resource</span></span>.pure[<span class="hljs-type"><span class="hljs-type">F</span></span>, <span class="hljs-type"><span class="hljs-type">Unit</span></span>](())) }</code> </pre> </div></div><br><p>  (Consulte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">C√≥digo fonte</a> para outras implementa√ß√µes de servi√ßos - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">servi√ßo de eco</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">clientes de eco</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">controladores vital√≠cios</a> .) </p><br><p>  Um n√≥ √© um √∫nico objeto que executa alguns servi√ßos (o in√≠cio de uma cadeia de recursos √© ativado pelo Cake Pattern): </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SingleNodeImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZeroServiceImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IO</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoServiceService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoClientService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FiniteDurationLifecycleServiceImpl</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">EchoConfig</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-type"><span class="hljs-type">EchoClientConfig</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-type"><span class="hljs-type">FiniteDurationLifecycleConfig</span></span> }</code> </pre> <br><p>  Observe que no n√≥ especificamos o tipo exato de configura√ß√£o que √© necess√°rio para esse n√≥.  O compilador n√£o permitir√° que construamos o objeto (Cake) com tipo insuficiente, porque cada caracter√≠stica de servi√ßo declara uma restri√ß√£o no tipo de <code>Config</code> .  Tamb√©m n√£o poderemos iniciar o n√≥ sem fornecer uma configura√ß√£o completa. </p><br><div class="spoiler">  <b class="spoiler_title">Resolu√ß√£o do endere√ßo do n√≥</b> <div class="spoiler_text"><p>  Para estabelecer uma conex√£o, precisamos de um endere√ßo de host real para cada n√≥.  Pode ser conhecido depois de outras partes da configura√ß√£o.  Portanto, precisamos de uma maneira de fornecer um mapeamento entre a identifica√ß√£o do n√≥ e seu endere√ßo real.  Esse mapeamento √© uma fun√ß√£o: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeAddress</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NodeId</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">host: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Uri</span></span></span></span><span class="hljs-class"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Host</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AddressResolver</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">F</span></span></span><span class="hljs-class">[_]] </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolve</span></span></span></span>[<span class="hljs-type"><span class="hljs-type">NodeId</span></span>](nodeId: <span class="hljs-type"><span class="hljs-type">NodeId</span></span>): <span class="hljs-type"><span class="hljs-type">F</span></span>[<span class="hljs-type"><span class="hljs-type">NodeAddress</span></span>[<span class="hljs-type"><span class="hljs-type">NodeId</span></span>]] }</code> </pre> <br><p>  Existem algumas maneiras poss√≠veis de implementar essa fun√ß√£o. </p><br><ol><li>  Se conhecermos os endere√ßos reais antes da implanta√ß√£o, durante a instancia√ß√£o dos hosts do n√≥, podemos gerar o c√≥digo Scala com os endere√ßos reais e executar a compila√ß√£o posteriormente (que executa verifica√ß√µes no tempo de compila√ß√£o e executa o conjunto de testes de integra√ß√£o).  Nesse caso, nossa fun√ß√£o de mapeamento √© conhecida estaticamente e pode ser simplificada para algo como um <code>Map[NodeId, NodeAddress]</code> . </li><li>  √Äs vezes, obtemos endere√ßos reais apenas posteriormente quando o n√≥ √© realmente iniciado ou n√£o temos endere√ßos de n√≥s que ainda n√£o foram iniciados.  Nesse caso, podemos ter um servi√ßo de descoberta iniciado antes de todos os outros n√≥s, e cada n√≥ pode anunciar seu endere√ßo nesse servi√ßo e assinar as depend√™ncias. </li><li>  Se podemos modificar o <code>/etc/hosts</code> , podemos usar nomes de host predefinidos (como <code>my-project-main-node</code> e <code>echo-backend</code> ) e apenas associar esse nome ao endere√ßo IP no momento da implanta√ß√£o. </li></ol><br><p>  Neste post, n√£o abordamos esses casos em mais detalhes.  De fato, no nosso exemplo de brinquedo, todos os n√≥s ter√£o o mesmo endere√ßo IP - <code>127.0.0.1</code> . </p></div></div><br><p>  Nesta postagem, consideraremos dois layouts de sistema distribu√≠do: </p><br><ol><li>  Layout de n√≥ √∫nico, onde todos os servi√ßos s√£o colocados no n√≥ √∫nico. </li><li>  Layout de dois n√≥s, em que servi√ßo e cliente est√£o em n√≥s diferentes. </li></ol><br><p>  A configura√ß√£o para um layout de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">n√≥ √∫nico</a> √© a seguinte: </p><br><div class="spoiler">  <b class="spoiler_title">Configura√ß√£o de n√≥ √∫nico</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SingleNodeConfig</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoConfig</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoClientConfig</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FiniteDurationLifecycleConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Singleton</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">//</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">identifier</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">of</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">the</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">single</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">node</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">//</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">configuration</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">of</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">server</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Singleton</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nodeId</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-type"><span class="hljs-type">Singleton</span></span> <span class="hljs-comment"><span class="hljs-comment">/** Type safe service port specification. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">portNumber</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">PortNumber</span></span> = <span class="hljs-number"><span class="hljs-number">8088</span></span> <span class="hljs-comment"><span class="hljs-comment">// configuration of client /** We'll use the service provided by the same host. */ def echoServiceDependency = echoService override def testMessage: UrlPathElement = "hello" def pollInterval: FiniteDuration = 1.second // lifecycle controller configuration def lifetime: FiniteDuration = 10500.milliseconds // additional 0.5 seconds so that there are 10 requests, not 9. }</span></span></code> </pre> </div></div><br><p>  Aqui, criamos uma √∫nica configura√ß√£o que estende a configura√ß√£o do servidor e do cliente.  Tamb√©m configuramos um controlador de ciclo de vida que normalmente encerra o cliente e o servidor ap√≥s o intervalo da <code>lifetime</code> passar. </p><br><p>  O mesmo conjunto de implementa√ß√µes e configura√ß√µes de servi√ßo pode ser usado para criar o layout de um sistema com dois n√≥s separados.  S√≥ precisamos criar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">duas configura√ß√µes de n√≥ separadas</a> com os servi√ßos apropriados: </p><br><div class="spoiler">  <b class="spoiler_title">Configura√ß√£o de dois n√≥s</b> <div class="spoiler_text"><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeServerConfig</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoConfig</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SigTermLifecycleConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">NodeIdImpl</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nodeId</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-type"><span class="hljs-type">NodeServer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">portNumber</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">PortNumber</span></span> = <span class="hljs-number"><span class="hljs-number">8080</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeClientConfig</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoClientConfig</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FiniteDurationLifecycleConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// NB! dependency specification def echoServiceDependency = NodeServerConfig.echoService def pollInterval: FiniteDuration = 1.second def lifetime: FiniteDuration = 10500.milliseconds // additional 0.5 seconds so that there are 10 request, not 9. def testMessage: String = "dolly" }</span></span></code> </pre> </div></div><br><p>  Veja como especificamos a depend√™ncia.  Mencionamos o servi√ßo fornecido pelo outro n√≥ como uma depend√™ncia do n√≥ atual.  O tipo de depend√™ncia √© verificado porque cont√©m o tipo fantasma que descreve o protocolo.  E em tempo de execu√ß√£o, teremos o ID do n√≥ correto.  Este √© um dos aspectos importantes da abordagem de configura√ß√£o proposta.  Ele nos permite definir a porta apenas uma vez e garantir que estamos fazendo refer√™ncia √† porta correta. </p><br><div class="spoiler">  <b class="spoiler_title">Implementa√ß√£o de dois n√≥s</b> <div class="spoiler_text"><p>  Para esta configura√ß√£o, usamos exatamente as mesmas implementa√ß√µes de servi√ßos.  Nenhuma altera√ß√£o.  No entanto, criamos duas implementa√ß√µes de n√≥ diferentes que cont√™m diferentes conjuntos de servi√ßos: </p><br><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TwoJvmNodeServerImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZeroServiceImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IO</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoServiceService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SigIntLifecycleServiceImpl</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">EchoConfig</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-type"><span class="hljs-type">SigTermLifecycleConfig</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TwoJvmNodeClientImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZeroServiceImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IO</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoClientService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FiniteDurationLifecycleServiceImpl</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">EchoClientConfig</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-type"><span class="hljs-type">FiniteDurationLifecycleConfig</span></span> }</code> </pre> <br><p>  O primeiro n√≥ implementa o servidor e precisa apenas da configura√ß√£o do lado do servidor.  O segundo n√≥ implementa o cliente e precisa de outra parte da configura√ß√£o.  Ambos os n√≥s requerem alguma especifica√ß√£o vital√≠cia.  Para os prop√≥sitos deste n√≥ de p√≥s-servi√ßo, ter√° uma vida √∫til infinita que pode ser finalizada usando o <code>SIGTERM</code> , enquanto o cliente de eco ser√° finalizado ap√≥s a dura√ß√£o finita configurada.  Consulte o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aplicativo inicial</a> para obter detalhes. </p></div></div><br><h4 id="overall-development-process">  Processo geral de desenvolvimento </h4><br><p>  Vamos ver como essa abordagem muda a maneira como trabalhamos com a configura√ß√£o. </p><br><p>  A configura√ß√£o como c√≥digo ser√° compilada e produzir√° um artefato.  Parece razo√°vel separar o artefato de configura√ß√£o de outros artefatos de c√≥digo.  Freq√ºentemente, podemos ter v√°rias configura√ß√µes na mesma base de c√≥digo.  E, √© claro, podemos ter v√°rias vers√µes de v√°rios ramos de configura√ß√£o.  Em uma configura√ß√£o, podemos selecionar vers√µes espec√≠ficas de bibliotecas e isso permanecer√° constante sempre que implantarmos essa configura√ß√£o. </p><br><p>  Uma altera√ß√£o na configura√ß√£o se torna uma altera√ß√£o no c√≥digo.  Portanto, deve ser coberto pelo mesmo processo de garantia de qualidade: </p><br><p>  Ticket -&gt; PR -&gt; revis√£o -&gt; mesclagem -&gt; integra√ß√£o cont√≠nua -&gt; implanta√ß√£o cont√≠nua </p><br><p>  Existem as seguintes consequ√™ncias da abordagem: </p><br><ol><li><p>  A configura√ß√£o √© coerente para a inst√¢ncia de um sistema espec√≠fico.  Parece que n√£o h√° como haver conex√£o incorreta entre os n√≥s. </p><br></li><li><p>  N√£o √© f√°cil alterar a configura√ß√£o apenas em um n√≥.  N√£o parece razo√°vel fazer login e alterar alguns arquivos de texto.  Portanto, o desvio da configura√ß√£o se torna menos poss√≠vel. </p><br></li><li><p>  Pequenas altera√ß√µes na configura√ß√£o n√£o s√£o f√°ceis de fazer. </p><br></li><li><p>  A maioria das altera√ß√µes na configura√ß√£o seguir√° o mesmo processo de desenvolvimento e passar√° por uma revis√£o. </p><br></li></ol><br><p>  Precisamos de um reposit√≥rio separado para configura√ß√£o da produ√ß√£o?  A configura√ß√£o de produ√ß√£o pode conter informa√ß√µes confidenciais que gostar√≠amos de manter fora do alcance de muitas pessoas.  Portanto, pode valer a pena manter um reposit√≥rio separado com acesso restrito que conter√° a configura√ß√£o de produ√ß√£o.  Podemos dividir a configura√ß√£o em duas partes - uma que cont√©m os par√¢metros mais abertos de produ√ß√£o e outra que cont√©m a parte secreta da configura√ß√£o.  Isso permitiria o acesso √† maioria dos desenvolvedores √† grande maioria dos par√¢metros, restringindo o acesso a coisas realmente sens√≠veis.  √â f√°cil fazer isso usando tra√ßos intermedi√°rios com valores de par√¢metro padr√£o. </p><br><h3 id="variations">  Varia√ß√µes </h3><br><p>  Vamos ver os pr√≥s e os contras da abordagem proposta em compara√ß√£o com outras t√©cnicas de gerenciamento de configura√ß√£o. </p><br><p>  Primeiro, listaremos algumas alternativas para os diferentes aspectos da maneira proposta de lidar com a configura√ß√£o: </p><br><ol><li>  Arquivo de texto na m√°quina de destino. </li><li>  Armazenamento centralizado de valores-chave (como <code>etcd</code> / <code>zookeeper</code> ). </li><li>  Componentes de subprocesso que podem ser reconfigurados / reiniciados sem reiniciar o processo. </li><li>  Configura√ß√£o fora do artefato e controle de vers√£o. </li></ol><br><p>  O arquivo de texto oferece alguma flexibilidade em termos de corre√ß√µes ad-hoc.  O administrador de um sistema pode efetuar login no n√≥ de destino, fazer uma altera√ß√£o e simplesmente reiniciar o servi√ßo.  Isso pode n√£o ser t√£o bom para sistemas maiores.  Nenhum vest√≠gio √© deixado para tr√°s da altera√ß√£o.  A altera√ß√£o n√£o √© revisada por outro par de olhos.  Pode ser dif√≠cil descobrir o que causou a mudan√ßa.  N√£o foi testado.  Da perspectiva do sistema distribu√≠do, um administrador pode simplesmente esquecer de atualizar a configura√ß√£o em um dos outros n√≥s. </p><br><p>  (Por√©m, se eventualmente houver a necessidade de come√ßar a usar arquivos de configura√ß√£o de texto, teremos de adicionar apenas analisador + validador que possa produzir o mesmo tipo de <code>Config</code> e que seria suficiente para come√ßar a usar configura√ß√µes de texto. Isso tamb√©m mostra que o a complexidade da configura√ß√£o em tempo de compila√ß√£o √© um pouco menor que a complexidade das configura√ß√µes baseadas em texto, porque na vers√£o baseada em texto precisamos de algum c√≥digo adicional.) </p><br><p>  O armazenamento centralizado de valores-chave √© um bom mecanismo para distribuir meta-par√¢metros de aplicativos.  Aqui precisamos pensar sobre o que consideramos ser valores de configura√ß√£o e o que s√£o apenas dados.  Dada uma fun√ß√£o <code>C =&gt; A =&gt; B</code> , geralmente chamamos raramente de valores vari√°veis <code>C</code> "configura√ß√£o", enquanto os dados frequentemente alterados <code>A</code> - apenas inserem dados.  A configura√ß√£o deve ser fornecida √† fun√ß√£o antes dos dados <code>A</code>  Dada essa id√©ia, podemos dizer que √© a frequ√™ncia esperada de altera√ß√µes o que poderia ser usado para distinguir dados de configura√ß√£o de apenas dados.  Al√©m disso, os dados geralmente v√™m de uma fonte (usu√°rio) e a configura√ß√£o vem de uma fonte diferente (administrador).  Lidar com par√¢metros que podem ser alterados ap√≥s a inicializa√ß√£o do processo leva a um aumento da complexidade do aplicativo.  Para esses par√¢metros, teremos que lidar com o mecanismo de entrega, an√°lise e valida√ß√£o, lidando com valores incorretos.  Portanto, para reduzir a complexidade do programa, √© melhor reduzir o n√∫mero de par√¢metros que podem mudar no tempo de execu√ß√£o (ou mesmo elimin√°-los completamente). </p><br><p>  Da perspectiva deste post, devemos fazer uma distin√ß√£o entre par√¢metros est√°ticos e din√¢micos.  Se a l√≥gica de servi√ßo exigir uma altera√ß√£o rara de alguns par√¢metros em tempo de execu√ß√£o, podemos cham√°-los de par√¢metros din√¢micos.  Caso contr√°rio, eles s√£o est√°ticos e podem ser configurados usando a abordagem proposta.  Para reconfigura√ß√£o din√¢mica, outras abordagens podem ser necess√°rias.  Por exemplo, partes do sistema podem ser reiniciadas com os novos par√¢metros de configura√ß√£o de maneira semelhante √† reinicializa√ß√£o de processos separados de um sistema distribu√≠do. <br>  (Minha humilde opini√£o √© evitar a reconfigura√ß√£o do tempo de execu√ß√£o, porque aumenta a complexidade do sistema. <br>  Pode ser mais simples confiar apenas no suporte do SO para reiniciar processos.  Embora nem sempre seja poss√≠vel.) </p><br><p>  Um aspecto importante do uso da configura√ß√£o est√°tica que √†s vezes leva as pessoas a considerar a configura√ß√£o din√¢mica (sem outros motivos) √© o tempo de inatividade do servi√ßo durante a atualiza√ß√£o da configura√ß√£o.  De fato, se precisarmos fazer altera√ß√µes na configura√ß√£o est√°tica, precisaremos reiniciar o sistema para que novos valores se tornem efetivos.  Os requisitos para o tempo de inatividade variam para diferentes sistemas, portanto, pode n√£o ser t√£o cr√≠tico.  Se for cr√≠tico, temos que planejar com anteced√™ncia o rein√≠cio de qualquer sistema.  Por exemplo, podemos implementar a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">drenagem de conex√£o do AWS ELB</a> .  Nesse cen√°rio, sempre que precisamos reiniciar o sistema, iniciamos uma nova inst√¢ncia do sistema em paralelo e depois mudamos o ELB para ele, deixando o sistema antigo concluir a manuten√ß√£o das conex√µes existentes. </p><br><p>  Que tal manter a configura√ß√£o dentro do artefato com vers√£o ou fora?  Manter a configura√ß√£o dentro de um artefato significa que, na maioria dos casos, essa configura√ß√£o passou no mesmo processo de garantia de qualidade que outros artefatos.  Portanto, pode-se ter certeza de que a configura√ß√£o √© de boa qualidade e confi√°vel.  Pelo contr√°rio, a configura√ß√£o em um arquivo separado significa que n√£o h√° vest√≠gios de quem e por que fez altera√ß√µes nesse arquivo.  Isso √© importante?  Acreditamos que, para a maioria dos sistemas de produ√ß√£o, √© melhor ter uma configura√ß√£o est√°vel e de alta qualidade. </p><br><p>  A vers√£o do artefato permite descobrir quando foi criado, quais valores ele cont√©m, quais recursos s√£o ativados / desativados, quem foi respons√°vel por fazer cada altera√ß√£o na configura√ß√£o.  Pode ser necess√°rio algum esfor√ßo para manter a configura√ß√£o dentro de um artefato e √© uma escolha de design a ser feita. </p><br><h3 id="pros--cons">  Pr√≥s e contras </h3><br><p>  Aqui gostar√≠amos de destacar algumas vantagens e discutir algumas desvantagens da abordagem proposta. </p><br><h4 id="advantages">  Vantagens </h4><br><p>  Recursos da configura√ß√£o compil√°vel de um sistema distribu√≠do completo: </p><br><ol><li>  Verifica√ß√£o est√°tica da configura√ß√£o.  Isso fornece um alto n√≠vel de confian√ßa, de que a configura√ß√£o est√° correta, dadas as restri√ß√µes de tipo. </li><li>  Linguagem avan√ßada de configura√ß√£o.  Normalmente, outras abordagens de configura√ß√£o s√£o limitadas a, no m√°ximo, substitui√ß√£o de vari√°veis. <br>  Usando o Scala, √© poss√≠vel usar uma ampla variedade de recursos de idiomas para melhorar a configura√ß√£o.  Por exemplo, podemos usar caracter√≠sticas para fornecer valores padr√£o, objetos para definir escopo diferente, podemos nos referir a valores definidos apenas uma vez no escopo externo (DRY).  √â poss√≠vel usar sequ√™ncias literais ou inst√¢ncias de determinadas classes ( <code>Seq</code> , <code>Map</code> etc.). </li><li>  DSL  Scala tem suporte decente para gravadores DSL.  √â poss√≠vel usar esses recursos para estabelecer uma linguagem de configura√ß√£o mais conveniente e amig√°vel ao usu√°rio final, para que a configura√ß√£o final seja pelo menos leg√≠vel pelos usu√°rios do dom√≠nio. </li><li>  Integridade e coer√™ncia entre n√≥s.  Um dos benef√≠cios de ter a configura√ß√£o para todo o sistema distribu√≠do em um s√≥ lugar √© que todos os valores s√£o definidos estritamente uma vez e depois reutilizados em todos os locais onde precisamos deles.  Al√©m disso, digite declara√ß√µes de porta segura para garantir que, em todas as configura√ß√µes corretas poss√≠veis, os n√≥s do sistema falem o mesmo idioma.  Existem depend√™ncias expl√≠citas entre os n√≥s, o que dificulta o esquecimento de fornecer alguns servi√ßos. </li><li>  Alta qualidade de mudan√ßas.  A abordagem geral de passar as altera√ß√µes de configura√ß√£o atrav√©s do processo normal de RP estabelece altos padr√µes de qualidade tamb√©m na configura√ß√£o. </li><li>  Altera√ß√µes simult√¢neas na configura√ß√£o.  Sempre que fazemos altera√ß√µes na implanta√ß√£o autom√°tica da configura√ß√£o, assegura que todos os n√≥s estejam sendo atualizados. </li><li>  Simplifica√ß√£o de aplicativos.  O aplicativo n√£o precisa analisar e validar a configura√ß√£o e manipular valores de configura√ß√£o incorretos.  Isso simplifica a aplica√ß√£o geral.  (Algum aumento de complexidade est√° na pr√≥pria configura√ß√£o, mas √© uma troca consciente em rela√ß√£o √† seguran√ßa.) √â bem simples retornar √† configura√ß√£o comum - basta adicionar as pe√ßas que faltam.  √â mais f√°cil come√ßar com a configura√ß√£o compilada e adiar a implementa√ß√£o de pe√ßas adicionais para alguns momentos posteriores. </li><li>  Configura√ß√£o com vers√£o.  Devido ao fato de que as mudan√ßas na configura√ß√£o seguem o mesmo processo de desenvolvimento, como resultado, obtemos um artefato com uma vers√£o exclusiva.  Isso nos permite alterar a configura√ß√£o novamente, se necess√°rio.  Podemos at√© implantar uma configura√ß√£o que foi usada h√° um ano e funcionar√° exatamente da mesma maneira.  A configura√ß√£o est√°vel melhora a previsibilidade e a confiabilidade do sistema distribu√≠do.  A configura√ß√£o √© fixada em tempo de compila√ß√£o e n√£o pode ser facilmente violada em um sistema de produ√ß√£o. </li><li>  Modularidade  A estrutura proposta √© modular e os m√≥dulos podem ser combinados de v√°rias maneiras para <br>  suporta configura√ß√µes diferentes (configura√ß√µes / layouts).  Em particular, √© poss√≠vel ter um layout de n√≥ √∫nico em pequena escala e uma configura√ß√£o em v√°rios n√≥s em grande escala.  √â razo√°vel ter v√°rios layouts de produ√ß√£o. </li><li>  Teste  Para fins de teste, √© poss√≠vel implementar um servi√ßo simulado e us√°-lo como uma depend√™ncia de uma maneira segura.  Alguns layouts de teste diferentes com v√°rias pe√ßas substitu√≠das por zombarias podem ser mantidos simultaneamente. </li><li>  Teste de integra√ß√£o.  √Äs vezes, em sistemas distribu√≠dos, √© dif√≠cil executar testes de integra√ß√£o.  Usando a abordagem descrita para digitar a configura√ß√£o segura do sistema distribu√≠do completo, podemos executar todas as partes distribu√≠das em um √∫nico servidor de forma control√°vel.  √â f√°cil imitar a situa√ß√£o <br>  quando um dos servi√ßos ficar indispon√≠vel. </li></ol><br><h4 id="disadvantages">  Desvantagens </h4><br><p>  A abordagem de configura√ß√£o compilada √© diferente da configura√ß√£o "normal" e pode n√£o atender a todas as necessidades.  Aqui est√£o algumas das desvantagens da configura√ß√£o compilada: </p><br><ol><li>  Configura√ß√£o est√°tica.  Pode n√£o ser adequado para todos os aplicativos.  Em alguns casos, √© necess√°rio corrigir rapidamente a configura√ß√£o na produ√ß√£o, ignorando todas as medidas de seguran√ßa.  Essa abordagem torna mais dif√≠cil.  A compila√ß√£o e reimplanta√ß√£o s√£o necess√°rias ap√≥s fazer qualquer altera√ß√£o na configura√ß√£o.  Esse √© o recurso e o fardo. </li><li>  Gera√ß√£o de configura√ß√£o.  Quando a configura√ß√£o √© gerada por alguma ferramenta de automa√ß√£o, essa abordagem requer compila√ß√£o subsequente (que por sua vez pode falhar).  Pode ser necess√°rio um esfor√ßo adicional para integrar esta etapa adicional ao sistema de constru√ß√£o. </li><li>  Instrumentos.  Atualmente, existem muitas ferramentas em uso que dependem de configura√ß√µes baseadas em texto.  Alguns deles <br>  n√£o ser√° aplic√°vel quando a configura√ß√£o for compilada. </li><li>  √â necess√°ria uma mudan√ßa de mentalidade.  Os desenvolvedores e o DevOps est√£o familiarizados com os arquivos de configura√ß√£o de texto.  A id√©ia de compilar a configura√ß√£o pode parecer estranha para eles. </li><li>  Antes de introduzir a configura√ß√£o compil√°vel, √© necess√°rio um processo de desenvolvimento de software de alta qualidade. </li></ol><br><p>  Existem algumas limita√ß√µes do exemplo implementado: </p><br><ol><li>  Se fornecermos uma configura√ß√£o extra que n√£o √© exigida pela implementa√ß√£o do n√≥, o compilador n√£o nos ajudar√° a detectar a implementa√ß√£o ausente.  Isso pode ser resolvido usando <code>HList</code> ou ADTs (classes de caso) para a configura√ß√£o do n√≥, em vez de caracter√≠sticas e padr√£o de bolo. </li><li>  Temos que fornecer algumas informa√ß√µes gerais no arquivo de configura√ß√£o: ( <code>package</code> , <code>import</code> , declara√ß√µes de <code>object</code> ; <br>  <code>override def</code> 's para par√¢metros que possuem valores padr√£o).  Isso pode ser parcialmente resolvido usando uma DSL. </li><li>  Neste post, n√£o abordamos a reconfigura√ß√£o din√¢mica de clusters de n√≥s semelhantes. </li></ol><br><h3 id="conclusion">  Conclus√£o </h3><br><p>  Neste post, discutimos a id√©ia de representar a configura√ß√£o diretamente no c√≥digo-fonte de uma maneira segura.  A abordagem pode ser utilizada em muitos aplicativos como um substituto para xml e outras configura√ß√µes baseadas em texto.  Apesar de nosso exemplo ter sido implementado no Scala, ele tamb√©m pode ser traduzido para outros idiomas compil√°veis ‚Äã‚Äã(como Kotlin, C #, Swift etc.).  Pode-se tentar essa abordagem em um novo projeto e, caso n√£o se encaixe bem, mudar para o modo antiquado. </p><br><p>  Obviamente, a configura√ß√£o compil√°vel requer um processo de desenvolvimento de alta qualidade.  Em troca, promete fornecer uma configura√ß√£o robusta de alta qualidade. </p><br><p>  Essa abordagem pode ser estendida de v√°rias maneiras: </p><br><ol><li>  Pode-se usar macros para executar a valida√ß√£o da configura√ß√£o e falhar no momento da compila√ß√£o, no caso de falhas de restri√ß√µes da l√≥gica de neg√≥cios. </li><li>  Uma DSL pode ser implementada para representar a configura√ß√£o de uma maneira f√°cil de usar no dom√≠nio. </li><li>  Gerenciamento din√¢mico de recursos com ajustes de configura√ß√£o autom√°ticos.  Por exemplo, quando ajustamos o n√∫mero de n√≥s do cluster, podemos desejar (1) que os n√≥s obtenham uma configura√ß√£o levemente modificada;  (2) gerenciador de cluster para receber novas informa√ß√µes de n√≥s. </li></ol><br><h3 id="thanks">  Obrigado </h3><br><p>  Gostaria de agradecer a Andrey Saksonov, Pavel Popov e Anton Nehaev, por darem um feedback inspirador sobre o rascunho deste post que me ajudou a esclarecer. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt447690/">https://habr.com/ru/post/pt447690/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt447680/index.html">Exerc√≠cios de emula√ß√£o: manual do Xbox 360 FMA</a></li>
<li><a href="../pt447682/index.html">Data Center Espacial: 24 horas antes do lan√ßamento</a></li>
<li><a href="../pt447684/index.html">Como mostrar os valores da empresa em um escrit√≥rio (sem p√¥steres e slogans)</a></li>
<li><a href="../pt447686/index.html">Um par√¢metro muito importante das l√¢mpadas LED, que poucas pessoas conhecem</a></li>
<li><a href="../pt447688/index.html">Para a pergunta sobre bitset</a></li>
<li><a href="../pt447694/index.html">Configura√ß√£o do sistema distribu√≠do compilado</a></li>
<li><a href="../pt447696/index.html">Por que as cidades se op√µem ao Amazon Go, as primeiras lojas que n√£o s√£o de caixa</a></li>
<li><a href="../pt447698/index.html">Red Hogwarts: acad√™mico sem diploma</a></li>
<li><a href="../pt447700/index.html">A flexibilidade emocional √© a chave para o crescimento pessoal.</a></li>
<li><a href="../pt447702/index.html">O c√≠rculo matem√°tico ideal n√£o existe</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>