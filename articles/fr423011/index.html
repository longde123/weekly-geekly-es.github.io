<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>„äôÔ∏è ‚õ∑Ô∏è üë´ Gestion des microservices avec Kubernetes et Istio ü•ñ ‚úãüèº üë©üèø‚Äçüéì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Une courte histoire sur les avantages et les inconv√©nients des microservices, le concept Service Mesh et les outils Google qui vous permettent d'ex√©cu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gestion des microservices avec Kubernetes et Istio</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/423011/">  Une courte histoire sur les avantages et les inconv√©nients des microservices, le concept Service Mesh et les outils Google qui vous permettent d'ex√©cuter des applications de microservices sans vous boucher la t√™te avec des param√®tres infinis de politiques, d'acc√®s et de certificats et de trouver rapidement des erreurs qui ne se cachent pas dans le code, mais dans la logique du microservice. <br><br><img src="https://habrastorage.org/webt/os/ta/tg/ostatgvg9ytjgcicnno567t2x_q.jpeg"><br><br>  L'article est bas√© sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rapport de Craig Box</a> lors de notre conf√©rence DevOops 2017. La vid√©o et la traduction du rapport sont en cours. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/RnBXQpo6Mjs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Craig Box (Craig Box, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Twitter</a> ) - DevRel de Google en charge des microservices et des outils Kubernetes et Istio.  Son histoire actuelle concerne la gestion des microservices sur ces plateformes. <br><br>  Commen√ßons par un concept relativement nouveau appel√© Service Mesh.  Ce terme est utilis√© pour d√©crire le r√©seau de microservices en interaction qui composent l'application. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/91b/eb1/7c6/91beb17c6f784bdf2b8d433b44512285.jpg"><br><br>  √Ä un niveau √©lev√©, nous voyons le r√©seau comme un canal qui d√©place simplement les bits.  Nous ne voulons pas nous en pr√©occuper ni, par exemple, des adresses MAC dans les applications, mais nous nous effor√ßons de penser aux services et aux connexions dont ils ont besoin.  Si vous regardez du point de vue de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">OSI</a> , alors nous avons un r√©seau de troisi√®me niveau (avec les fonctions de d√©termination de la route et de l'adressage logique), mais nous voulons penser en termes de septi√®me (avec la fonction d'acc√®s aux services de r√©seau). <br><br>  √Ä quoi devrait ressembler un v√©ritable r√©seau de septi√®me niveau?  Peut-√™tre que nous voulons voir quelque chose comme une trace de trafic autour des services probl√©matiques.  Pour que vous puissiez vous connecter au service, et en m√™me temps, le niveau du mod√®le a √©t√© √©lev√© √† partir du troisi√®me niveau.  Nous voulons avoir une id√©e de ce qui se passe dans le cluster, trouver des d√©pendances involontaires, d√©couvrir les causes profondes des √©checs.  Nous devons √©galement √©viter les frais g√©n√©raux inutiles, par exemple, la connexion avec une latence √©lev√©e ou la connexion √† des serveurs avec un cache froid ou pas compl√®tement r√©chauff√©. <br><br>  Nous devons √™tre s√ªrs que le trafic entre les services est prot√©g√© contre les attaques triviales.  L'authentification TLS mutuelle est requise, mais sans int√©grer les modules appropri√©s dans chaque application que nous √©crivons.  Il est important de pouvoir contr√¥ler ce qui entoure nos applications non seulement au niveau de la connexion, mais √©galement √† un niveau sup√©rieur. <br><br>  Service Mesh est une couche qui nous permet de r√©soudre les probl√®mes ci-dessus dans un environnement de micro-service. <br><br><h2>  Monolith et microservices: avantages et inconv√©nients </h2><br>  Mais d'abord, nous nous demandons, pourquoi devrions-nous r√©soudre ces probl√®mes?  Comment avons-nous fait le d√©veloppement de logiciels auparavant?  Nous avions une application qui ressemblait √† quelque chose comme √ßa - comme un monolithe. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8c6/385/111/8c63851119c38df240c57cf399a8c344.jpg"><br><br>  C'est super: tout le code est bien visible.  Pourquoi ne pas continuer √† utiliser cette approche? <br>  Oui, car le monolithe a ses propres probl√®mes.  La principale difficult√© est que si nous voulons reconstruire cette application, nous devons red√©ployer chaque module, m√™me si rien n'a chang√©.  Nous sommes oblig√©s de cr√©er une application dans la m√™me langue ou dans des langues compatibles, m√™me si diff√©rentes √©quipes y travaillent.  En fait, les pi√®ces individuelles ne peuvent pas √™tre test√©es ind√©pendamment les unes des autres.  Il est temps de le changer, il est temps pour les microservices. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d19/ccb/fd5/d19ccbfd59552751e2171ba6b89ac9bc.jpg"><br><br>  Nous avons donc divis√© le monolithe en plusieurs parties.  Vous remarquerez peut-√™tre que dans cet exemple, nous avons supprim√© certaines des d√©pendances inutiles et cess√© d'utiliser les m√©thodes internes appel√©es √† partir d'autres modules.  Nous avons cr√©√© des services √† partir des mod√®les utilis√©s pr√©c√©demment, cr√©ant des abstractions dans les cas o√π nous devons maintenir l'√©tat.  Par exemple, chaque service doit avoir un √©tat ind√©pendant afin que lorsque vous y acc√©dez, vous n'ayez pas √† vous soucier de ce qui se passe dans le reste de notre environnement. <br><br>  Quel est le r√©sultat? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cd2/4da/729/cd24da7292ffd1e23eb4e56ca2842c5f.jpg"><br><br>  Nous avons quitt√© le monde des applications gigantesques pour obtenir ce qui est vraiment g√©nial.  Nous avons acc√©l√©r√© le d√©veloppement, cess√© d'utiliser des m√©thodes internes, cr√©√© des services et maintenant nous pouvons les faire √©voluer ind√©pendamment, agrandir le service sans avoir √† consolider tout le reste.  Mais quel est le prix du changement que nous avons perdu? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2b4/234/b49/2b4234b49b4dcb5f79840391ee0f5a36.jpg"><br><br>  Nous avons eu des appels fiables dans les applications parce que vous avez simplement appel√© une fonction ou un module.  Nous avons remplac√© l'appel de confiance √† l'int√©rieur du module par un appel de proc√©dure distante non fiable.  Mais le service de l'autre c√¥t√© n'est pas toujours disponible. <br><br>  Nous √©tions en s√©curit√©, en utilisant le m√™me processus √† l'int√©rieur de la m√™me machine.  Nous nous connectons maintenant √† des services qui peuvent se trouver sur diff√©rentes machines et sur un r√©seau non approuv√©. <br><br>  Dans la nouvelle approche sur le r√©seau, la pr√©sence d'autres utilisateurs qui tentent de se connecter aux services est possible.  Les retards ont augment√© et, en m√™me temps, leurs capacit√©s de mesure ont diminu√©.  Maintenant, nous avons des connexions √©tape par √©tape dans tous les services qui cr√©ent un appel de module, et nous ne pouvons plus simplement regarder l'application dans le d√©bogueur et d√©couvrir exactement ce qui a caus√© l'√©chec.  Et ce probl√®me doit √™tre en quelque sorte r√©solu.  De toute √©vidence, nous avons besoin d'un nouvel ensemble d'outils. <br><br><h2>  Que peut-on faire? </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/fd0/857/5a9/fd08575a99e8a4f4baf64d916eef077b.jpg"><br><br>  Il existe plusieurs options.  Nous pouvons prendre notre application et dire que si <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RPC</a> ne fonctionne pas la premi√®re fois, vous devriez r√©essayer, puis encore et encore.  Attendez un peu et r√©essayez ou ajoutez Jitter.  Nous pouvons √©galement ajouter des traces d'entr√©e-sortie pour dire que l'appel a commenc√© et s'est termin√©, ce qui pour moi √©quivaut √† un d√©bogage.  Vous pouvez ajouter une infrastructure pour fournir une authentification des connexions et enseigner √† toutes nos applications comment travailler avec le chiffrement TLS.  Nous devrons prendre en charge le contenu des √©quipes individuelles et garder constamment √† l'esprit les diff√©rents probl√®mes pouvant survenir dans les biblioth√®ques SSL. <br><br>  Maintenir la coh√©rence sur plusieurs plates-formes est une t√¢che ingrate.  Je voudrais que l'espace entre les applications devienne raisonnable, afin qu'il y ait une possibilit√© de suivi.  Nous devons √©galement pouvoir modifier les configurations au moment de l'ex√©cution afin de ne pas recompiler ou red√©marrer les applications pour la migration.  Ces liste de souhaits et impl√©mentent le service Mesh. <br><br><h2>  Isstio </h2><br>  Parlez d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Istio</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fc8/cdf/0fe/fc8cdf0fe52823fcd092a2dd8de2aeb6.jpg"><br><br>  Istio est un cadre complet pour connecter, g√©rer et surveiller l'architecture de microservices.  Istio est con√ßu pour fonctionner au-dessus de Kubernetes.  Lui-m√™me ne d√©ploie pas le logiciel et ne tient pas √† le rendre disponible sur les machines que nous utilisons √† cet effet avec des conteneurs dans Kubernetes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ddb/e05/1e8/ddbe051e8e8f90273b1bd686d1f5c90e.jpg"><br><br>  Sur la figure, nous voyons trois sections diff√©rentes des machines et des blocs qui composent nos microservices.  Nous avons un moyen de les regrouper en utilisant les m√©canismes fournis par Kubernetes.  Nous pouvons cibler et dire qu'un groupe sp√©cifique, qui peut avoir une mise √† l'√©chelle automatique, est attach√© √† un service Web ou peut avoir d'autres m√©thodes de d√©ploiement, contiendra notre service Web.  Dans ce cas, nous n'avons pas besoin de penser aux machines, nous fonctionnons en termes de niveau d'acc√®s aux services r√©seau. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/966/45b/f3c/96645bf3c0ff9d2104622a84edcafeeb.png"><br><br>  Cette situation peut √™tre repr√©sent√©e sous forme de diagramme.  Prenons un exemple lorsque nous avons un m√©canisme qui effectue un traitement d'image.  L'utilisateur de gauche est le trafic qui nous parvient dans le microservice. <br><br>  Pour accepter le paiement de l'utilisateur, nous avons un microservice de paiement distinct qui appelle une API externe situ√©e en dehors du cluster. <br><br>  Pour traiter la connexion des utilisateurs, nous fournissons un microservice d'authentification, et il a √† nouveau des √©tats stock√©s en dehors de notre cluster dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">base de donn√©es Cloud SQL</a> . <br><br>  Que fait Istio?  Istio am√©liore Kubernetes.  Vous l'installez √† l'aide d'une fonction alpha dans Kubernetes appel√©e Initializer.  Lorsque vous d√©ployez le logiciel, kubernetes le remarquera et nous demandera si nous voulons changer et ajouter un autre conteneur √† l'int√©rieur de chaque kubernetes.  Ce conteneur g√©rera les chemins et le routage, soyez au courant de tous les changements d'application. <br><br>  Voil√† √† quoi ressemble le circuit avec Istio. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/398/f41/c6d/398f41c6dcbe3e0dea4741e71204d7bd.jpg"><br><br>  Nous avons des machines externes qui fournissent des procurations entrantes et sortantes pour le trafic dans un service particulier.  Nous pouvons d√©charger les fonctions dont nous avons d√©j√† parl√©.  Nous n'avons pas besoin d'enseigner √† l'application comment effectuer la t√©l√©m√©trie ou le tra√ßage √† l'aide de TLS.  Mais nous pouvons ajouter d'autres choses √† l'int√©rieur: interruption automatique, limitation de vitesse, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lib√©ration des canaris</a> . <br><br>  Tout le trafic passera d√©sormais par des serveurs proxy sur des machines externes, et non directement vers les services.  Kubernetes fait tout sur la m√™me adresse IP.  Nous pourrons intercepter le trafic qui irait aux services frontaux ou terminaux. <br><br>  Le proxy externe utilis√© par Istio s'appelle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Envoy</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a00/3ed/04f/a003ed04fc566d4f27b1e5df70e3ae21.jpg"><br><br>  Envoy est en fait plus √¢g√© qu'Istio, il a √©t√© d√©velopp√© chez Lyft.  Travaille en production depuis plus d'un an, lan√ßant l'ensemble de l'infrastructure des microservices.  Nous avons choisi Envoy pour le projet Istio en collaboration avec la communaut√©.  Ainsi, Google, IBM et LYFT sont les trois soci√©t√©s qui y travaillent encore. <br><br>  Envoy est √©crit en C ++ 11. Il est en production depuis plus de 18 mois avant de devenir un projet open source.  Cela ne prendra pas beaucoup de ressources lorsque vous le connecterez √† vos services. <br><br>  Voici quelques choses que l'Envoy peut faire.  Il s'agit de la cr√©ation d'un serveur proxy pour HTTP, y compris HTTP / 2 et des protocoles bas√©s sur lui, tels que gRPC.  Il peut √©galement transmettre √† d'autres protocoles au niveau binaire.  Envoy contr√¥le votre zone d'infrastructure afin que vous puissiez rendre votre pi√®ce autonome.  Il peut g√©rer un grand nombre de connexions r√©seau avec de nouvelles tentatives et attendre.  Vous pouvez d√©finir un certain nombre de tentatives de connexion au serveur avant d'arr√™ter l'appel et transmettre des informations √† vos serveurs auxquelles le service ne r√©pond pas. <br><br>  Pas besoin de vous soucier de recharger l'application pour y ajouter une configuration.  Vous vous y connectez simplement √† l'aide d'une API tr√®s similaire √† kubernetes et modifiez la configuration lors de l'ex√©cution. <br><br>  L'√©quipe Istio a apport√© une grande contribution √† la plate-forme UpStream Envoy.  Par exemple, une alerte d'erreur d'injection.  Nous avons permis de voir comment se comporte l'application en cas de d√©passement du nombre de requ√™tes pour l'objet qui a √©chou√©.  Et √©galement impl√©ment√© les fonctions d'affichage graphique et de s√©paration du trafic afin de g√©rer les cas o√π un d√©ploiement canari est utilis√©. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/068/0e1/351/0680e13511f2d5dc5eeac4bada02c05c.jpg"><br><br>  La figure montre √† quoi ressemble l'architecture du syst√®me Istio.  Nous ne prendrons que deux microservices mentionn√©s pr√©c√©demment.  En fin de compte, dans le diagramme, tout est tr√®s similaire √† un r√©seau d√©fini par logiciel.  √Ä partir du serveur proxy Envoy, que nous avons d√©ploy√© avec les applications, le trafic est transf√©r√© √† l'aide de tables IP dans l'espace de noms.  Le panneau de contr√¥le est responsable de la gestion de la console, mais il ne traite pas le trafic lui-m√™me. <br>  Nous avons trois composantes.  Pilot, qui cr√©e la configuration, examine les r√®gles qui peuvent √™tre modifi√©es √† l'aide de l'API pour le panneau de configuration Istio, puis met √† jour Envoy pour qu'il se comporte comme un service de d√©couverte de cluster.  Istio-Auth sert d'autorit√© de certification et transmet les certificats TLS aux mandataires.  L'application ne n√©cessite pas de SSL, ils peuvent se connecter via HTTP et les mandataires g√©reront tout cela pour vous. <br><br>  Mixer traite les demandes pour vous assurer que vous respectez la politique de s√©curit√©, puis transmet les informations de t√©l√©m√©trie.  Sans apporter de modifications √† l'application, nous pouvons voir tout ce qui se passe √† l'int√©rieur de notre cluster. <br><br><h2>  Avantages sociaux chez Istio </h2><br>  Parlons donc plus en d√©tail des cinq choses que nous obtiendrons d'Istio.  Tout d'abord, pensez √† <b>la gestion du trafic</b> .  Nous pouvons s√©parer le contr√¥le du trafic de la mise √† l'√©chelle de l'infrastructure, donc plus t√¥t nous pourrions faire quelque chose comme 20 instances de l'application et 19 d'entre elles seront sur l'ancienne version, et une sur la nouvelle, c'est-√†-dire que 5% du trafic sera sur la nouvelle version.  Avec Istio, nous pouvons d√©ployer n'importe quel nombre d'instances dont nous avons besoin, tout en indiquant le pourcentage de trafic √† envoyer aux nouvelles versions.  Une simple r√®gle de s√©paration. <br><br>  Tout peut √™tre programm√© √† la vol√©e en utilisant des r√®gles.  Envoy sera mis √† jour p√©riodiquement √† mesure que la configuration change, ce qui n'entra√Ænera pas de pannes de service.  √âtant donn√© que nous travaillons au niveau de l'acc√®s aux services r√©seau, nous pouvons afficher les packages, et dans ce cas, il est possible d'acc√©der √† l'agent utilisateur, qui est situ√© au troisi√®me niveau du r√©seau. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/810/1a1/7d5/8101a17d596613c7cc6871ce0f7d238a.png"><br><br>  Par exemple, nous pouvons dire que tout trafic provenant de l'iPhone suit une r√®gle diff√©rente, et nous allons diriger une certaine fraction du trafic vers la nouvelle version, que nous voulons tester pour un appareil sp√©cifique.  Le microservice d'appel interne peut d√©terminer √† quelle version sp√©cifique il doit se connecter et vous pouvez le transf√©rer vers une autre version, par exemple 2.0. <br><br>  Le deuxi√®me avantage est la <b>transparence</b> .  Lorsque vous avez une vue √† l'int√©rieur du cluster, vous pouvez comprendre comment elle est cr√©√©e.  Nous n'avons pas besoin de cr√©er des outils de m√©triques dans le processus de d√©veloppement.  Les m√©triques sont d√©j√† pr√©sentes dans chaque composant. <br><br>  Certains estiment qu'il suffit de conserver un journal pour la surveillance.  Mais en fait, tout ce dont nous avons besoin, c'est d'avoir un ensemble universel d'indicateurs pouvant √™tre transmis √† tout service de surveillance. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/099/627/ab5/099627ab5e7b0615bb2e3725ce118160.jpg"><br><br>  Voici √† quoi ressemble la barre d'outils Istio cr√©√©e √† l'aide du service Prometheus.  N'oubliez pas de le d√©ployer √† l'int√©rieur du cluster. <br><br>  Dans l'exemple, la capture d'√©cran montre un certain nombre de param√®tres surveill√©s sp√©cifiques √† l'ensemble du cluster.  Des choses plus int√©ressantes peuvent √™tre d√©duites, par exemple, quel pourcentage d'applications donne plus de 500 erreurs, ce qui implique un √©chec.  Le temps de r√©ponse est agr√©g√© dans toutes les instances de service appelant et r√©pondant au sein du cluster; cette fonctionnalit√© ne n√©cessite pas de param√®tres.  Istio sait ce que Prometheus prend en charge et il sait quels services sont disponibles dans votre cluster, donc Istio-Mixer peut envoyer des m√©triques √† Prometheus sans aucun param√®tre suppl√©mentaire. <br>  Voyons comment cela fonctionne.  Si vous appelez un service sp√©cifique, le service proxy envoie des informations sur cet appel √† Mixer, qui capture des param√®tres tels que le temps d'attente pour la r√©ponse, l'√©tat du code et IP.  Il les normalise et les envoie √† tous les serveurs que vous avez configur√©s.  Surtout pour afficher les principaux indicateurs, il y a le service Prometheus et les adaptateurs FLUX DB, mais vous pouvez √©galement √©crire votre propre adaptateur et afficher les donn√©es dans n'importe quel format pour toute autre application.  Et vous n'avez rien √† changer dans l'infrastructure si vous souhaitez ajouter une nouvelle mesure. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/477/8cf/7ea/4778cf7ea5f78c0d8dca61aaaf7756c5.jpg"><br><br>  Si vous souhaitez effectuer des recherches plus approfondies, utilisez le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">syst√®me de</a> suivi distribu√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Zipkin</a> .  Les informations sur tous les appels achemin√©s via Istio-Mixer peuvent √™tre envoy√©es √† Zipkin.  Vous y verrez toute la cha√Æne des appels de microservices lorsque vous r√©pondez √† l'utilisateur et trouverez facilement un service qui retarde le temps de traitement. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1c0/820/3e5/1c08203e54bc8fc2cb3a0f6da427e497.jpg"><br><br>  Au niveau de l'application, il n'est pas n√©cessaire de s'inqui√©ter de cr√©er une trace.  Envoy lui-m√™me transmet toutes les informations n√©cessaires au Mixer, qui les envoie √† la trace, par exemple, √† Zipkin, √† la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">trace stackdriver</a> de Google ou √† toute autre application utilisateur. <br><br>  Parlons de <b>tol√©rance aux pannes et d'efficacit√©</b> . <br><img src="https://habrastorage.org/getpro/habr/post_images/da4/c03/b1b/da4c03b1b08ebbc652e332c680b79599.jpg"><br><br>  Des d√©lais d'attente entre les appels de service sont n√©cessaires pour tester la sant√©, tout d'abord, des √©quilibreurs de charge.  Nous introduisons des erreurs dans cette connexion et voyons ce qui se passe.  Prenons un exemple.  Supposons qu'il existe une connexion entre le service A et le service B. Nous attendons une r√©ponse du service vid√©o pendant 100 millisecondes et ne donnons que 3 tentatives si le r√©sultat n'est pas re√ßu.  En substance, nous allons le prendre pendant 300 millisecondes avant qu'il ne signale une tentative de connexion infructueuse. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2c8/858/101/2c885810146ca5a44c88b42b2b1552c5.jpg"><br><br>  De plus, par exemple, notre service de film devrait examiner la cote du film via un autre microservice.  La note a un d√©lai d'expiration de 200 millisecondes et deux tentatives d'appel sont donn√©es.  L'appel d'un service vid√©o peut vous faire attendre 400 millisecondes si le nombre d'√©toiles est hors de port√©e.  Mais, nous nous souvenons, apr√®s 300 ms, le service de cin√©ma signalera qu'il est inactif et nous ne conna√Ætrons jamais la v√©ritable cause de l'√©chec.  L'utilisation de d√©lais d'attente et le test de ce qui se passe dans ces cas est un excellent moyen de trouver toutes sortes de bogues intelligents dans votre architecture de microservice. <br><br>  Voyons maintenant ce qui est efficace.  L'√©quilibreur kubernetes lui-m√™me n'agit qu'au niveau de la quatri√®me couche.  Nous avons invent√© un constructeur d'entr√©e pour l'√©quilibrage de charge de la deuxi√®me couche √† la septi√®me.  Istio est impl√©ment√© comme un √©quilibreur pour la couche r√©seau avec acc√®s aux services r√©seau. <br><br>  Nous effectuons le d√©chargement TLS, nous utilisons donc un protocole SSL moderne et bien dop√© dans Envoy, vous n'avez donc pas √† vous soucier des vuln√©rabilit√©s. <br><br>  Un autre avantage d'Istio est la <b>s√©curit√©</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/902/a1d/fcc/902a1dfcc83b7bbb4bc3d49463c5682b.jpg"><br><br>  Quelles sont les fonctionnalit√©s de s√©curit√© de base d'Istio?  Le service Istio-Auth fonctionne dans plusieurs directions.  Il utilise un cadre public et un ensemble de normes d'authentification pour les services <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SPIFFE</a> .  Si nous parlons de flux de trafic, nous avons une autorit√© de certification Istio qui √©met des certificats pour les comptes de service que nous ex√©cutons √† l'int√©rieur du cluster.  Ces certificats sont conformes √† la norme SPIFFE et sont distribu√©s par Envoy √† l'aide du m√©canisme de s√©curit√© kubernetes.  Envoy utilise des cl√©s pour l'authentification TLS bidirectionnelle.  Ainsi, les applications backend re√ßoivent des identifiants sur la base desquels il est d√©j√† possible d'organiser une politique. <br><br>  Istio g√®re lui-m√™me les certificats racine afin que vous ne vous inqui√©tiez pas des dates de r√©vocation et d'expiration.  Le syst√®me r√©pondra √† la mise √† l'√©chelle automatique, donc en introduisant une nouvelle entit√©, vous obtenez un nouveau certificat.  Aucun r√©glage manuel.  Vous n'avez pas besoin de configurer un pare-feu.  Les utilisateurs utiliseront la strat√©gie r√©seau et kubernetes pour impl√©menter des pare-feu entre les conteneurs. <br><br>  Enfin, l' <b>application des politiques</b> .  Mixer est un point d'int√©gration avec des backends d'infrastructure que vous pouvez √©tendre avec Service Mesh.  Les services peuvent facilement se d√©placer au sein d'un cluster, √™tre d√©ploy√©s dans plusieurs environnements, dans le cloud ou localement.  Tout est con√ßu pour le contr√¥le op√©rationnel des appels qui transitent par Envoy.       ,      ,     . ,    -   20    .    20 ,   . <br><br>        , , ,    , ICL      .       ,  ,  ,   ,    . , Mixer      ,   .            . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/202/d7a/975/202d7a975db3a50477ac367ea4d6f1e4.jpg"><br><br>     ,      Istio?       .        .         ,         .     ,    . <br><br><h2>     Istio </h2><br> Istio    kubernetes,    ,    ,    1.7  .  -  kubernetes.    Google Container Engine Alpha clusters.    ,                 . <br><br>   Istio ‚Äî        github.      0.2.   0.1          kubernetes.   0.2          kubernetes.        ,     .    Envoy      ,    .   Istio    ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cloud Foundry</a> . <br><br>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> .        Google Container Engine  1.8   -,   Istio ‚Äî     . <br><br><blockquote>     ,  14    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DevOops 2018</a> ():       ,         . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr423011/">https://habr.com/ru/post/fr423011/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr422997/index.html">Le livre "PHP moderne"</a></li>
<li><a href="../fr422999/index.html">Cr√©ez votre propre jeu de donn√©es extraterrestre</a></li>
<li><a href="../fr423005/index.html">Comment Yandex.Zen, le plugin de mise en cache WordPress et l'h√©bergement ont stimul√© ma pression</a></li>
<li><a href="../fr423007/index.html">"Malyavki, mais bon": comment nous avons amen√© les √©tudiants √† la pratique</a></li>
<li><a href="../fr423009/index.html">Diagnostics SENS. Biomarqueurs de glycation des prot√©ines</a></li>
<li><a href="../fr423013/index.html">Comment organiser vos d√©pendances dans une application Vue</a></li>
<li><a href="../fr423015/index.html">Git: erreurs courantes et comment les corriger</a></li>
<li><a href="../fr423017/index.html">Bobbiniki: dix magn√©tophones √† bobine culte - Tell and Show</a></li>
<li><a href="../fr423021/index.html">Hackathon en ligne par Naviaddress</a></li>
<li><a href="../fr423023/index.html">Pourquoi les d√©veloppeurs ont-ils besoin d'enseigner</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>