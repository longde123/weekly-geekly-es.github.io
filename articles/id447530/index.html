<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôèüèª üòá üî¨ OceanLotus: Pembaruan Malvari untuk macOS üë®üèæ‚Äçüíª üë¥üèº üò†</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pada bulan Maret 2019, VirusTotal, sebuah layanan pemindaian online yang populer, mengunggah sampel malware baru untuk macOS dari cybergroup OceanLotu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>OceanLotus: Pembaruan Malvari untuk macOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/447530/"> Pada bulan Maret 2019, VirusTotal, sebuah layanan pemindaian online yang populer, mengunggah sampel malware baru untuk macOS dari cybergroup OceanLotus.  File executable backdoor memiliki kemampuan yang sama dengan versi malvari sebelumnya yang kami pelajari untuk macOS, tetapi strukturnya telah berubah dan menjadi semakin sulit dideteksi.  Sayangnya, kami tidak dapat menemukan pipet yang terkait dengan sampel ini, jadi kami belum tahu vektor infeksi. <br><br>  Baru-baru ini, kami menerbitkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">posting tentang OceanLotus</a> dan bagaimana operator berusaha untuk memastikan kegigihan, mempercepat eksekusi kode, dan meminimalkan jejak kehadiran pada sistem Windows.  Diketahui juga bahwa cybergroup ini memiliki komponen untuk macOS.  Posting ini menjelaskan secara rinci perubahan dalam versi terbaru dari Malware untuk macOS dibandingkan dengan versi sebelumnya ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dijelaskan oleh Trend Micro</a> ), serta bagaimana analisis dapat mengotomatiskan dekripsi string menggunakan IDA Hex-Rays API. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b9/2i/bc/b92ibc95cbufdprulqgxtcrrh2q.jpeg"></div><a name="habracut"></a><br><h2>  Analisis </h2><br>  Tiga bagian berikut menjelaskan analisis sampel dengan <code>E615632C9998E4D3E5ACD8851864ED09B02C77D2</code> SHA-1.  File ini disebut <b>flashlightd</b> , produk antivirus ESET mendeteksinya sebagai OSX / OceanLotus.D. <br><br><h4>  Perlindungan anti-debugging dan kotak pasir </h4><br>  Seperti semua binari OceanLotus macOS, sampel dikemas dengan UPX, tetapi sebagian besar alat identifikasi pengepak tidak mengenalinya.  Mungkin karena mereka terutama mengandung tanda tangan, tergantung pada keberadaan string "UPX", di samping itu, tanda tangan Mach-O kurang umum dan tidak sering diperbarui.  Fitur ini membuat deteksi statis sulit.  Menariknya, setelah membongkar, titik masuk adalah di awal bagian <code>__cfstring</code> di segmen <code>.TEXT</code> .  Ada atribut flag di bagian ini, seperti yang ditunjukkan pada gambar di bawah ini. <br><br><img src="https://habrastorage.org/webt/9f/-e/nv/9f-envxqfnhv8qxtp-gjeitht1q.png"><br>  <i>Gambar 1. Atribut bagian MACH-O __cfstring</i> <br><br>  Seperti yang ditunjukkan pada Gambar 2, lokasi kode di bagian <code>__cfstring</code> memungkinkan <code>__cfstring</code> untuk mengelabui beberapa alat pembongkaran dengan menampilkan kode sebagai string. <br><br><img src="https://habrastorage.org/webt/qw/q0/s3/qwq0s3-lc2tj86cb3wtcx91y8d0.png"><br>  <i>Gambar 2. Kode backdoor didefinisikan oleh IDA sebagai data</i> <br><br>  Setelah memulai file biner menciptakan aliran sebagai sarana perlindungan terhadap debugging, satu-satunya tujuan adalah untuk terus-menerus memeriksa keberadaan debugger.  Untuk utas ini: <br><br><ul><li>  Mencoba melepaskan kaitan debugger apa pun dengan memanggil <code>ptrace</code> dengan <code>PT_DENY_ATTACH</code> sebagai parameter permintaan </li><li>  Cek apakah beberapa port pengecualian terbuka dengan memanggil <code>task_get_exception_ports</code> </li><li>  Memeriksa apakah debugger terhubung, seperti yang ditunjukkan pada gambar di bawah ini, dengan memeriksa keberadaan bendera <code>P_TRACED</code> dalam proses saat ini </li></ul><br><img src="https://habrastorage.org/webt/hi/cz/hd/hiczhdrsr9kgk9kkhfr72fv_xsg.png"><br>  <i>Gambar 3. Memeriksa koneksi debugger menggunakan fungsi sysctl</i> <br><br>  Jika watchdog mendeteksi keberadaan debugger, fungsi <code>exit</code> disebut.  Selain itu, sampel kemudian memeriksa lingkungan dengan menjalankan dua perintah: <br><br> <code>ioreg -l | grep -e "Manufacturer"  sysctl hw.model</code> <br> <br>  Setelah itu, sampel memeriksa nilai kembali terhadap daftar string dari sistem virtualisasi yang dikenal: <b>acle</b> , <b>vmware</b> , <b>virtualbox</b> atau <b>paralel</b> .  Akhirnya, perintah berikut memeriksa apakah mesin adalah salah satu dari "MBP", "MBA", "MB", "MM", "IM", "MP" dan "XS" berikut.  Ini adalah kode model sistem, misalnya, "MBP" berarti MacBook Pro, "MBA" berarti MacBook Air, dll. <br><br> <code>system_profiler SPHardwareDataType 2&gt;/dev/null | awk '/Boot ROM Version/ {split($0, line, ":");printf("%s", line[2]);}</code> <br> <br><h4>  Penambahan kunci </h4><br>  Terlepas dari kenyataan bahwa tim backdoor tidak berubah sejak studi Trend Micro, kami melihat beberapa modifikasi lainnya.  Server C &amp; C yang digunakan dalam sampel ini cukup baru, tanggal pembuatannya adalah 10/22/2018. <br><br><ul><li>  <b>daff.faybilodeau [.] com</b> </li><li>  <b>sarc.onteagleroad [.] com</b> </li><li>  <b>au.charlineopkesston [.] com</b> </li></ul><br>  URL sumber daya diubah menjadi <code>/dp/B074WC4NHW/ref=gbps_img_m-9_62c3_750e6b35</code> . <br>  Paket pertama yang dikirim ke server C&amp;C berisi lebih banyak informasi tentang mesin host, termasuk semua data yang dikumpulkan oleh perintah dari tabel di bawah ini. <br><br><img src="https://habrastorage.org/webt/xb/9k/xo/xb9kxohiu-1pdfbxnxbcrmnewqq.png"><br><br>  Selain perubahan konfigurasi ini, sampel tidak menggunakan perpustakaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">libcurl</a> untuk penyaringan jaringan, tetapi perpustakaan eksternal.  Untuk menemukannya, pintu belakang mencoba mendekripsi setiap file dalam direktori saat ini menggunakan AES-256-CBC dengan <code>gFjMXBgyXWULmVVVzyxy</code> kunci <code>gFjMXBgyXWULmVVVzyxy</code> dengan nol.  Setiap file didekripsi dan disimpan sebagai <code>/tmp/store</code> , dan upaya untuk memuatnya sebagai pustaka dibuat menggunakan fungsi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dlopen</a> .  Ketika upaya dekripsi mengarah ke panggilan <code>dlopen</code> berhasil, pintu belakang mengambil fungsi <code>Boriry</code> dan <code>Boriry</code> diekspor, yang tampaknya bertanggung jawab untuk komunikasi jaringan dengan server.  Kami tidak memiliki dropper atau file lain dari lokasi sumber sampel, jadi kami tidak dapat menganalisis perpustakaan ini.  Selain itu, karena komponen dienkripsi, aturan YARA berdasarkan baris ini tidak akan cocok dengan file yang ditemukan pada disk. <br><br>  Seperti yang dijelaskan dalam artikel di atas, <i>cliendID</i> dibuat.  Identifier ini adalah hash MD5 dari nilai pengembalian salah satu dari perintah berikut: <br><br>  - <code>ioreg -rd1 -c IOPlatformExpertDevice | awk '/IOPlatformSerialNumber/ { split($0, line, "\""); printf("%s", line[4]); }'</code> <code>ioreg -rd1 -c IOPlatformExpertDevice | awk '/IOPlatformSerialNumber/ { split($0, line, "\""); printf("%s", line[4]); }'</code> <br>  - <code>ioreg -rd1 -c IOPlatformExpertDevice | awk '/IOPlatformUUID/ { split($0, line, "\""); printf("%s", line[4]); }'</code> <code>ioreg -rd1 -c IOPlatformExpertDevice | awk '/IOPlatformUUID/ { split($0, line, "\""); printf("%s", line[4]); }'</code> <br>  - <code>ifconfig en0 | awk \'/ether /{print $2}\'</code>  <code>ifconfig en0 | awk \'/ether /{print $2}\'</code> (dapatkan alamat MAC) <br>  - perintah tidak dikenal (" <code>\x1e\x72\x0a</code> "), yang digunakan dalam sampel sebelumnya <br><br>  Sebelum hashing, karakter "0" atau "1" ditambahkan ke nilai yang dikembalikan, yang menunjukkan keberadaan hak akses root.  <i>ClientID</i> ini disimpan di <code>/Library/Storage/File System/HFS/25cf5d02-e50b-4288-870a-528d56c3cf6e/pivtoken.appex</code> jika kode tersebut berjalan sebagai root atau di ~ / Library / SmartCardsServices / Technology / PlugIns / drivers / snippets.ecgML dalam semua kasus lainnya.  File biasanya disembunyikan menggunakan fungsi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">_chflags</a> , stempel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">waktunya</a> diubah menggunakan perintah <code>touch ‚Äìt</code> dengan nilai acak. <br><br><h4>  String decoding </h4><br>  Seperti pada versi sebelumnya, string dienkripsi menggunakan AES-256-CBC (kunci heksadesimal: <code>9D7274AD7BCEF0DED29BDBB428C251DF8B350B92</code> dengan nol, dan IV diisi dengan nol) menggunakan fungsi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CCCrypt</a> .  Kunci telah diubah dari versi sebelumnya, tetapi karena grup masih menggunakan algoritma enkripsi string yang sama, dekripsi dapat otomatis.  Selain posting ini, kami merilis skrip IDA yang menggunakan API Hex-Rays untuk mendekripsi string yang ada dalam file biner.  Skrip ini dapat membantu dalam analisis OceanLotus di masa mendatang dan analisis sampel yang ada yang belum dapat kami peroleh.  Script didasarkan pada metode universal untuk menerima argumen yang diteruskan ke suatu fungsi.  Dia juga mencari pengaturan tujuan.  Metode ini dapat digunakan kembali untuk mendapatkan daftar argumen fungsi dan kemudian meneruskannya ke panggilan balik. <br><br>  Mengetahui prototipe fungsi <i>dekripsi</i> , skrip menemukan semua referensi silang ke fungsi ini, semua argumen, lalu mendekripsi data dan menempatkan teks biasa di dalam komentar di alamat referensi silang.  Agar skrip bekerja dengan benar, ia harus memiliki alfabet yang ditentukan pengguna yang digunakan oleh fungsi decoding base64 dan variabel global yang berisi panjang kunci harus ditentukan (dalam hal ini, DWORD, lihat Gambar 4). <br><br><img src="https://habrastorage.org/webt/eh/24/ci/eh24cifpohyeyx3jvtsyodn6v8s.png"><br>  <i>Gambar 4. Definisi variabel global key_len</i> <br><br>  Di jendela Fungsi, Anda dapat mengklik kanan fungsi dekripsi dan mengeklik "Ekstrak dan dekripsi argumen".  Script harus meletakkan baris yang didekripsi dalam komentar, seperti yang ditunjukkan pada Gambar 5. <br><br><img src="https://habrastorage.org/webt/sy/or/e5/syore5rq9pnlbtdp_f4l4bq0aoe.png"><br>  <i>Gambar 5. Teks yang didekripsi ditempatkan dalam komentar</i> <br><br>  Dengan demikian, baris yang didekripsi ditempatkan bersama-sama di jendela <i>xrefs</i> IDA untuk fungsi ini, seperti yang ditunjukkan pada Gambar 6. <br><br><img src="https://habrastorage.org/webt/sl/v8/ok/slv8okoh1m44vxl1wpcv8hxqleo.png"><br>  <i>Gambar 6. Xrefs ke fungsi f_decrypt</i> <br><br>  Script terakhir dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">repositori Github</a> . <br><br><h2>  Kesimpulan </h2><br>  Seperti yang telah disebutkan, OceanLotus terus meningkatkan dan memperbarui set alatnya.  Kali ini, cybergroup meningkatkan malware untuk bekerja dengan pengguna Mac.  Kode ini tidak banyak berubah, tetapi karena banyak pengguna Mac mengabaikan produk keamanan, melindungi Malware dari deteksi adalah hal yang sangat penting. <br><br>  Produk ESET telah mendeteksi file ini pada saat penelitian.  Karena pustaka jaringan yang digunakan untuk komunikasi C&amp;C sekarang dienkripsi pada disk, protokol jaringan yang tepat yang digunakan oleh penyerang belum diketahui. <br><br><h2>  Indikator kompromi </h2><br>  Indikator kompromi serta atribut MITER ATT &amp; CK juga tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GitHub</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id447530/">https://habr.com/ru/post/id447530/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id447516/index.html">Bagaimana kami melakukan overclock CAD COMPASS-3D ‚Üí Bagian 2</a></li>
<li><a href="../id447520/index.html">Fitur Auto Tiering dalam penyimpanan Qsan XCubeSAN</a></li>
<li><a href="../id447522/index.html">Hal-hal berguna apa yang bisa ditarik dari log workstation berbasis Windows</a></li>
<li><a href="../id447526/index.html">Sepeda sendiri untuk menyinkronkan MariaDB dan Sphinx</a></li>
<li><a href="../id447528/index.html">Siapa yang bertanggung jawab atas kualitas?</a></li>
<li><a href="../id447532/index.html">Splunk Universal Forwarder di Docker sebagai pengumpul log sistem</a></li>
<li><a href="../id447534/index.html">Cosmonaut Aleksandr Laveykin tentang film ruang angkasa terbaik, G-force 20g, dan soft landing</a></li>
<li><a href="../id447536/index.html">Terapkan IdM. Persiapan untuk implementasi oleh pelanggan</a></li>
<li><a href="../id447538/index.html">CUBA 7: Apa yang baru?</a></li>
<li><a href="../id447540/index.html">RHEL 8 Beta Workshop: Membangun Aplikasi Web Langsung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>