<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥇 ⛹🏿 ⛰️ 支持工业编程语言或BluePill x405的家庭自动化 ⛹🏾 👨‍⚖️ 🦑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="开始审查 
 因此，亲爱的同事们，我们从我们真正要强调的内容开始进行审查。 在本文中，我想考虑构建工业控制器程序所需的典型元素，并展示如何将其应用于家庭自动化系统。 最重要的是找到问题的答案-为此需要什么。 

 家庭自动化-应用 
 甜蜜的家...您真的需要控制器吗？ 答案很简单-一切都取决于这种...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>支持工业编程语言或BluePill x405的家庭自动化</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/477478/"><h3> 开始审查 </h3><br> 因此，亲爱的同事们，我们从我们真正要强调的内容开始进行审查。 在本文中，我想考虑构建工业控制器程序所需的典型元素，并展示如何将其应用于家庭自动化系统。 最重要的是找到问题的答案-为此需要什么。 <br><br><h3> 家庭自动化-应用 </h3><br> 甜蜜的家...您真的需要控制器吗？ 答案很简单-一切都取决于这种房屋中的可用物品。 当然，如果您只有一间公寓，而自动化在于在夏季管理家庭媒体中心和空调，则下面编写的所有内容可能都完全没有意思。 但是，如果您的爱好不仅是推沙发（隐藏的东西，我本人有时会注意到这一点），那么这篇文章可能会非常有用。 <br><a name="habracut"></a><br> 因此，让我们尝试了解即兴手段如何简化我们的艰难生活。 例如，我们使用真实情况-一台泵在70米深的井中，两个邻居将其折叠。 他们在春天安装了它，当时井中有很多水，总的来说，它温暖而良好。 但是随着时间的流逝，问题开始了-要从这样的深度提水，就需要用电，这是您必须付费的。 地下室和技术层被淹没了好几次-他们只是忘了关掉水泵了...是的，手动控制它不是很方便-您需要关闭一个水龙头，再打开另一个水龙头，然后打开水泵并观察水箱中的水位。 <br><br> 花时间在上面已经值得吗？ 好奇的人开始寻找解决方案，当然找到了！ 实施任务清单由此诞生。 <br><br><ol><li> 不必为用电量支付费用-也就是说，我们将安装两个起动器，每个起动器都连接到其自己的电表。 </li><li> 泵不应因缺水而发生故障-这意味着我们将为泵的“干”冲程安装传感器。 如果没有水，请不要启动泵，如果泵可以工作，我们将紧急停止。 </li><li> 泵不能运行太长时间-例如，超过25分钟。 超过此时间表示系统将退出其正常操作模式。 </li><li> 容器的填充应在没有人为干预的情况下进行，即自动进行，这意味着从较低级别开始，在较高级别停止。 </li><li> 仅应填充一个水箱，也就是说，我们安装两个阀门-为每个水箱中的一组供水。 </li><li> 泵启动之间的间隔必须至少30分钟。 </li><li> 电源中断（如果处于活动状态）不应影响操作算法。 尽管如此，该算法必须完成。 </li></ol><br> 这些任务很简单，可以用一百种甚至一千种方法来解决。 但是文章的标题不言而喻，我们将走上一条棘手的道路。 让我们使用一个虚拟的（当然，现在）控制器，它将完成所有这些工作。 <br><br><h3> 工业控制器如何工作？ </h3><br> 当然，我们会立即进行澄清-我们正在谈论所谓的可编程逻辑控制器，简称PLC。 这个缩写隐藏了什么？ 这就是隐藏的东西-令人难以置信的各种硬件解决方案，大量的软件产品和实用程序。 一个合理的问题随即出现-那么如何利用所有这些好处呢？ 真的有必要从头开始研究材料部分并为每个新设备花费时间和金钱，以便参加培训课程并获得使用每个设备所需的技能吗？ <br><br> 答案是否定的，没有必要。 一切都摆在我们面前。 它仍然只是学习和学习使用方法。 这是我建议做的进一步工作-稍微浸入IEC 61131标准，让我们来揭示一下该标准包含的部分。 <br><br><ul><li>  IEC 61131-1：一般信息。 </li><li>  IEC 61131-2：设备要求和测试。 </li><li>  IEC 61131-3：编程语言。 </li><li>  IEC 61131-4：用户指南。 </li><li>  IEC 61131-5：通信。 </li><li>  IEC 61131-6：功能安全。 </li><li>  IEC 61131-7：模糊控制程序。 </li><li>  IEC 61131-8：编程语言的使用和实施准则。 </li><li>  IEC 61131-9：用于小型传感器和执行器的单点数字通信接口。 </li><li>  IEC 61131-10：PLC开放的基于XML的交换格式。 </li></ul><br> 但是，我们不会深入研究标准主题，简单地说，控制器通常是循环工作的-轮询输入的状态，解释器执行控制程序，设置输出的状态，执行内部维护任务，然后再次返回轮询输入的状态。 这很无聊，但是有效又高效。 控制程序是使用编程环境创建的伪代码，通常，该伪代码是二进制编码的序列，与通常的编程语言无关。 尽管对于用户来说，它是以一种可以理解的形式呈现的-对于控制器，它使用了完全不同的视图。 一个很好的例子是一个小程序，以IL，LD和控制器的二进制编码形式表示（嗯，甚至没有专门的术语）。 在扰流板下方，显示了一个小示例。 <br><br><div class="spoiler">  <b class="spoiler_title">程序显示选项</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/1v/zd/el/1vzdelgzkvbgvb9jdf8kzb66un8.png"><br></div></div><br> 那么，什么使该程序有用呢？ 是的，她什么也没做-如果M8010合并器的值是1，则1.将被写入地址Y377的输出中。因此，对于0同样如此。 <br> 这种实现方式的最大优势之一是能够从控制器的内存中卸载程序，以人类可以理解的方式打开程序以在编辑器中进行编辑，编译（此术语在此是有条件的）并将其加载回控制器的内存中。 而且，某些控制器甚至保存注释和变量名。 <br><br><h3> 控制器如何编程？ </h3><br> 当然，需要专门的软件。 经过长时间的搜索和实验，选择了Inovance Control的Autoshop v3.02。 值得注意的是它是免费的，可以免费下载，并且支持与三菱控制器兼容的控制器。 它不仅支持通过串行端口的工作，还支持通过以太网的工作。 链接到我们在扰流板下使用的版本。 <br><br><div class="spoiler">  <b class="spoiler_title">链接以从Yandex磁盘下载</b> <div class="spoiler_text">  <a href="https://yadi.sk/d/nXaAKljCPvqR5Q">汽车商店v3.02</a> <br></div></div><br> 好了，我们安装了程序，现在又遇到了另一个问题-如何将程序写入控制器？ 由于我们将使用特定的设备，因此将为虚拟COM端口安装特定的驱动程序。 为了保存结论并简化操作，我决定使用开发板的USB端口进行连接。 扰流板下的驾驶员。 <br><br><div class="spoiler">  <b class="spoiler_title">Yandex磁盘上的驱动程序</b> <div class="spoiler_text">  <a href="https://yadi.sk/d/n6kmoszV3TexWj">车手</a> <br></div></div><br> 安装驱动程序并通过mini-USB连接开发板后，您可以检查一切是否成功。 为此，请右键单击“我的电脑-管理-设备管理器-端口”（COM和LPT）。 您应该看到扰流板下方的窗口。 您系统上的COM端口号可能会有所不同。 <br><br><div class="spoiler">  <b class="spoiler_title">设备管理员</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/co/vs/o_/covso_rwe7duas9oaeg8hmqbqpi.png"><br></div></div><br> 现在，您可以在AutoShop菜单中选择“工具-通讯设置”，在出现的窗口中选择“串行”，指定端口号，然后单击“测试”按钮。 您应该在扰流板下有一个这样的窗口。 <br><br><div class="spoiler">  <b class="spoiler_title">成功连接到板</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/xf/l9/xf/xfl9xfc7ey_ktixw-tj3mh8f6cy.png"><br></div></div><br> 但是，如果对您没有帮助，请写在PM或评论中。 我们一定会提供帮助。 <br><br><h3> 程序的要素，没有它，这将是可悲的 </h3><br> 在下文中，我们将考虑梯形图的语言或所谓的LD。 让我们只考虑以后将要使用的那些元素。 <br><br><ul><li> 输入和输出是离散的。 它们分别命名为X和Y。设计用于接收和发出离散信号。 </li><li>  M个合并器M的内存区域。它可以处于两种状态-开启和关闭。 </li><li> 计时器指定为T。设计用于计时从0.1到3276.7秒的时间。 </li><li> 寄存器D的区域。它的单元尺寸为16位，但也可以寻址为32位单元。 </li></ul><br><h3> 球形寄存器或间接寻址寄存器 </h3><br> 间接寻址寄存器的名称为V和Z，可以从V0到V7以及从Z0到Z7寻址。 为什么要使用它们？ 让我们看看它们通常如何工作。 看起来很疯狂的D1000V0记录意味着将使用计算为D1000地址的单元地址加上写入间接寻址寄存器的值。 如果有15，那么我们将使用单元格D1015的地址。 在使用数据数组或表控件时，这非常方便-足以更改索引寄存器的值，并且可以从已寻址的那些存储单元中获取值。 但是，尽管我们将不应用它们，但我们将在下一个出版物中进行介绍。 <br><br><h3> 关于程序可视化或在线调试的一些知识 </h3><br> 如果您是程序员并且刚刚完成编写程序，则下一步是调试。 问题就在这里-如何做到。 同样，有很多选择，但是我将讨论我们将进一步使用的选择。 通过编程环境编辑器，您可以通过按一个按钮直观地显示控制器存储器中当前位和变量的值。 一个非常有启发性的例子是-在扰流板下面，在编辑器中离线和在线显示程序。 <br><br><div class="spoiler">  <b class="spoiler_title">按钮切换到变量查看模式</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/5-/nr/8z/5-nr8zfe8q1j1zcmwlmoxg5kfw0.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">查看变量值模式下的程序类型</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/-_/ox/gx/-_oxgxsuqn4x90y1d8yqgndcbjq.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">编辑模式下的程序类型</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/pl/f9/tj/plf9tjq0u2vx6tnufkrlao_klhu.png"><br></div></div><br> 有关单击“联机”按钮时发生的过程的更多信息。 该程序快速编译可见变量列表，并在完成后将其写入特定的控制器缓冲区。 之后，控制器从该列表准备数据，并将其放置在另一个缓冲区中。 程序从该缓冲区读取值，并将其显示为模拟图上的值。 如果在显示窗口中滚动一个小程序并更改可见变量，则此循环将再次重复... <br><br><h3> 谁叫哈姆雷特，或在舞台上BluePill x405 </h3><br> 您是否注意到市场上没有像蓝色平板电脑这样的简单主板，而是配备了F405和更高版本的处理器？ 我本人只遇到过F401石头，但这水平稍有不同...我很容易爬上去，为了进行实验，我没有三思而后行，我用一台优质的P-CAD 2006付款，并在其中一个快速订购站点上从中文订购。 当然，在颜色上它是绿色的平板电脑，但就含义而言，我决定保留名称BluePill，但表示它已经是x405。 扰流板下的结果是BluePill x405板的照片。 <br><br><div class="spoiler">  <b class="spoiler_title">顶视图</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/kv/ha/hs/kvhahsy1nncrjqogvfafgr1jn10.jpeg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">底视图</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/5z/ar/ts/5zartsne1u9zbrijwlz6txgknp8.jpeg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">GitHub上的Concept和Gerber</b> <div class="spoiler_text">  <a href="https://github.com/Greeds74/BluePill-x405/tree/master/Habr">Github</a> <br></div></div><br> 关于这个董事会为何如此出色的一些信息？ 毕竟，只有数以千计的尝试创建蓝药克隆！ 但是不同之处在于：我将固件附加到该板上，这会将它变成一个内核，该内核运行与命令系统中的Mitsubishi工业控制器兼容的程序。 这个奇迹是根据16个输入，16个输出，2个模拟输入，3个具有DE支持RS485的UART，1个单线主总线计算得出的。  UART可用作主总线Modbus RTU，也可用作从属总线。 他们可以完全独立地工作。 <br> 但这还不是全部-如果将3V电池连接到VBAT引脚，则不仅时钟，而且计时器，计数器，合并器和前1000个通用寄存器D都将保持其值，并且有8000个寄存器。 <br><br> 在回答问题之前，我会立即说-是的，该软件基于实时操作系统。 是的，尽可能使用DMA。 这些功能使工作在高通信负载下的周期时间无明显变化。 此版本是第二修订版，进行了修订和补充。 <br><br>  GX FXDeveloper和IEC Developer和GX Works都可以对该板进行完全编程。 <br><br><h3> 泵和两个坦克的命运 </h3><br> 现在让我们解决这个问题-尤其是因为有所有可用的工具。 为了避免过多拖延，我编写了一个程序，将其分为几个部分（所谓的网络或工作链），在这里我将展示每个程序并提供注释。 <br><br><div class="spoiler">  <b class="spoiler_title">Net 1-程序的首次运行</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/mt/se/6l/mtse6lkxocvzicroixvaxkp986y.png"><br></div></div><br>  D1000寄存器存储抑制触点反弹所需的时间。 实际上，这已经在程序中-但我想更清楚地显示它。 寄存器D1001负责泵的保护时间。 在其中写入15,000或1,500秒。 接下来，我们有一个备用复位链-如果出现问题，可以将信号1发送到输入X14并重新启动电路板。 在这种情况下，将0写入寄存器D0和D1，并且复位M98和M99推杆。 <br><br><div class="spoiler">  <b class="spoiler_title">Net 2-输入信号处理</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/q2/c2/0r/q2c20rgbj45frsx31p4sisxv_tg.png"><br></div></div><br> 在这里，借助计时器，我们摆脱了联系的反弹。 为此，请使用200毫秒的延迟。 为了确保在以后的程序中更改联系人的输入地址时不必重写许多链，我使用中间合并器（例如M102）。 还值得注意的是，此处使用了M8003系统商家-在程序执行的第一个周期结束后它将打开。 但是M8002 Merker仅在程序的第一个周期中处于活动状态，并且可以并且应该将其用于设置初始值。 <br><br><div class="spoiler">  <b class="spoiler_title">净3-储罐填充1。</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/vr/cp/h4/vrcph4mhgoiir-hgrghd92tpiew.png"><br></div></div><br> 除地址外，储罐1的填充与储罐2的填充完全相同。 该图有点不合适-但是您最好只打开项目即可查看它。 这个控制单元有什么特别之处？ 保护和死锁的存在使启动和停止机制无冲击。 例如，在打开阀1之后，仅在700 ms之后才会发出启动启动器的命令，该启动器打开泵。 <br><br> 此处的管理不提供手动模式。 此外，还实现了防止空转和防止泵运行时间过长的保护措施。 <br><br><div class="spoiler">  <b class="spoiler_title">网络5-6-输出管理</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/sw/oi/ta/swoitandloflperaamkjr9yysak.png"><br></div></div><br> 在这里，我们根据锁控制输出。 <br><br> 在这些任务中，只有重新启动前30分钟保护间隔的连接未实现。 我必须马上说-在此版本中，仅实现了输入X0-X3和输出Y0-Y3，这足以测试本文中的材料。 绑定是PA4-X0，PA5-X1，PA6-X2，PA7-X3和PB4-Y0，PB5-Y1，PB6-Y2，PB7-Y3。 <br><br><h3> 程序循环速度-祖父测量方法 </h3><br> 当我们问自己这个问题时，立即想到这样做-用一定数量的相同元素向控制器编写一个非常大的程序，获取执行时间并获得一个命令的执行时间。 据说-完成了，在扰流板程序下，以扰流板执行时间的名义。 <br><br><div class="spoiler">  <b class="spoiler_title">7995步-2.6毫秒</b> <div class="spoiler_text">  <a href="">8000步</a> <br></div></div><br> 在这里，每一步都是一个命令，我们得到2.6 / 7995 = 0.325微秒。 不是很快，但还不错。 <br><br><h3>  FPU-是还是不是？ </h3><br> 现在，让我们确定固件中浮点指令的运行速度。 有两种固件，一种使用内置FPU，另一种使用软件仿真。 下面的程序： <br><br><div class="spoiler">  <b class="spoiler_title">用于计算指令执行时间的程序</b> <div class="spoiler_text">  <a href="">8000浮点步数程序</a> <br></div></div><br> 以下固件位于扰流板下方，没有任何限制 <br><br><div class="spoiler">  <b class="spoiler_title">两种固件</b> <div class="spoiler_text">  <a href="https://github.com/Greeds74/BluePill-x405/tree/master/Habr_software">韧体</a> <br></div></div><br> 使用硬件FPU时，程序执行时间为1.8毫秒或1.8 / 600 = 0.003毫秒或3微秒。 <br><br> 现在更换固件-使用软件仿真。 结果已经不同-2.5毫秒或2.5 / 600 = 0.0041毫秒或4.1微秒。 还不错，但是区别非常明显。 <br><br><h3> 结论 </h3><br> 尽管文章量很大，但仍然有很多材料可以覆盖。 因此，如果您对本文感兴趣，那么本文后面还会再有一篇。 但是我想找到志同道合的人，他们只希望有一个目的而加入工业和家庭的交叉口，这样一个简单的外行就可以使用这些工具。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN477478/">https://habr.com/ru/post/zh-CN477478/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN477464/index.html">我如何在Docker内部启动Docker及其结果</a></li>
<li><a href="../zh-CN477468/index.html">Seek Thermal SHOT热成像仪概述：住宅场所的热检查</a></li>
<li><a href="../zh-CN477470/index.html">关于测试任务在开发人员生命中的作用</a></li>
<li><a href="../zh-CN477474/index.html">梦想家的生活和习俗</a></li>
<li><a href="../zh-CN477476/index.html">异构编程和OneAPI工具包。 向英特尔专家提问</a></li>
<li><a href="../zh-CN477484/index.html">他们如何看待程序员</a></li>
<li><a href="../zh-CN477488/index.html">Neungers：香料必须流动</a></li>
<li><a href="../zh-CN477490/index.html">Kitchen Robotics Part 2或另一个Blynk头像</a></li>
<li><a href="../zh-CN477492/index.html">服务器机房中将剩下什么？</a></li>
<li><a href="../zh-CN477494/index.html">1.使用Check Point取证分析恶意软件。 喷沙网</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>