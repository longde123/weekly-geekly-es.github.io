<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äçüé§ üçó üèéÔ∏è So verbinden Sie die PhotoSwipe-Galerie in der Android-Webansicht üåô üë©üèº ‚õ¥Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich bin kein professioneller Entwickler, obwohl ich als Programmierer studiert habe. Jetzt arbeite ich als Systemadministrator und plane, zu den Entwi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>So verbinden Sie die PhotoSwipe-Galerie in der Android-Webansicht</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454578/"> Ich bin kein professioneller Entwickler, obwohl ich als Programmierer studiert habe.  Jetzt arbeite ich als Systemadministrator und plane, zu den Entwicklern zu wechseln.  Ich schreibe f√ºr mich selbst eine Anwendung, die eine der beliebtesten IT-bezogenen Websites analysiert und Artikel in der nativen Android-Anwendung anzeigt.  Ich wollte, dass alle Bilder im Artikel in der Galerie ge√∂ffnet werden, wie in der mobilen Anwendung von habr. <br><a name="habracut"></a><br>  H√∂chstwahrscheinlich wird sich das Handbuch als einfach herausstellen, aber ich m√∂chte Feedback erhalten, und h√∂chstwahrscheinlich wird dieses Handbuch f√ºr jemanden n√ºtzlich sein. <br><br>  Ich habe mehrere Plugins ausprobiert.  Einige wurden nicht gestartet, andere erfordern jQuery, was das Laden der Seite in der Anwendung verlangsamt.  Am Ende habe ich das PhotoSwipe-Plugin gew√§hlt.  Das Plugin ben√∂tigt kein jQuery, es funktioniert schnell und wiegt fast nichts. <br><br>  Zuerst m√ºssen Sie sich √ºberlegen, wo es besser ist, die Plugin-Quelldateien in der Anwendung zu platzieren.  Aus Unerfahrenheit habe ich die Dateien zun√§chst im Rohordner abgelegt, aber es ist besser, sie im Assets-Ordner abzulegen.  Klicken Sie mit der rechten Maustaste auf App ‚Üí Neu ‚Üí Ordner ‚Üí Assets-Ordner <br><br>  Das Markup ist eine einfache WebView: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.support.constraint.ConstraintLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:app</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:tools</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/tools"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tools:context</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".MainActivity"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WebView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/webView"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WebView</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.support.constraint.ConstraintLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><br>  Als N√§chstes m√ºssen Sie das Repository von PhotoSwipe herunterladen oder klonen (Link auf der Plugin-Website) und den gesamten Inhalt des dist-Ordners in Assets kopieren (dist kann in PhotoSwipe umbenannt werden. Sie k√∂nnen auch eine style.css-Datei im css-Ordner erstellen, sodass die Bilder die gesamte Breite einnehmen. <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">img</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: auto; }</code> </pre> <br>  F√ºr die Galerie m√ºssen Sie Stile, Javascipt-Dateien und eine Stildatei f√ºr den Skin verbinden.  Sie k√∂nnen HTML generieren: <br><br><div class="spoiler">  <b class="spoiler_title">Hier geht HTML f√ºr Webview hin</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHTML</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ String header = <span class="hljs-string"><span class="hljs-string">"&lt;!DOCTYPE HTML&gt;&lt;HTML&gt;&lt;head&gt;&lt;title&gt;test&lt;/title&gt;"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  ,      //     . String headerEnd = "&lt;/head&gt;&lt;body onload=\"init();\"&gt;"; String footer = "&lt;/body&gt;&lt;/HTML&gt;"; String charset = "&lt;meta charset=\"utf-8\"&gt;"; String style = "&lt;link href=\"css/style.css\" type=\"text/css\" rel=\"stylesheet\" /&gt;"; String pscss = "&lt;link rel=\"stylesheet\" href=\"PhotoSwipe/photoswipe.css\"&gt;"; String psdscss = "&lt;link rel=\"stylesheet\" href=\"PhotoSwipe/default-skin/default-skin.css\"&gt;"; // ,        String script = "&lt;script type=\"text/javascript\" src=\"js/script.js\"&gt;&lt;/script&gt;"; String psjs = "&lt;script src=\"PhotoSwipe/photoswipe.js\"&gt;&lt;/script&gt; "; String psuijs = "&lt;script src=\"PhotoSwipe/photoswipe-ui-default.min.js\"&gt;&lt;/script&gt;"; StringBuilder stringBuilder = new StringBuilder(); //  head stringBuilder.append(header); stringBuilder.append(charset); stringBuilder.append(style); stringBuilder.append(pscss); stringBuilder.append(psdscss); stringBuilder.append(script); stringBuilder.append(psjs); stringBuilder.append(psuijs); stringBuilder.append(headerEnd); stringBuilder.append("&lt;img src=\"https://ps.denko.me/images/linux1.jpg\" /&gt;"); stringBuilder.append("&lt;img src=\"https://ps.denko.me/images/linux2.jpg\" /&gt;"); stringBuilder.append("&lt;img src=\"https://ps.denko.me/images/linux3.jpeg\" /&gt;"); stringBuilder.append(getPhotoSwipeHTML()); stringBuilder.append(footer); return stringBuilder.toString();</span></span></code> </pre>  . <br></div></div><br>  Damit das Plugin funktioniert, m√ºssen Sie auch den Container f√ºr die Galerie in die Quelle der Seite einf√ºgen.  Die Dokumentation besagt, dass dies kein einfaches Plugin ist und Sie einen Teil der Arbeit selbst erledigen m√ºssen. <br><br>  Es ist ratsam, den Code vor dem schlie√üenden Tag einzuf√ºgen <br><br><div class="spoiler">  <b class="spoiler_title">Galerie-Container</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPhotoSwipeHTML</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;!-- Root element of PhotoSwipe. Must have class pswp. --&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"&lt;div class=\"pswp\" tabindex=\"-1\" role=\"dialog\" aria-hidden=\"true\"&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;!-- Background of PhotoSwipe. \n"</span></span> + <span class="hljs-string"><span class="hljs-string">" It's a separate element as animating opacity is faster than rgba(). --&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;div class=\"pswp__bg\"&gt;&lt;/div&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;!-- Slides wrapper with overflow:hidden. --&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;div class=\"pswp__scroll-wrap\"&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;!-- Container that holds slides. \n"</span></span> + <span class="hljs-string"><span class="hljs-string">" PhotoSwipe keeps only 3 of them in the DOM to save memory.\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" Don't modify these 3 pswp__item elements, data is added later on. --&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;div class=\"pswp__container\"&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;div class=\"pswp__item\"&gt;&lt;/div&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;div class=\"pswp__item\"&gt;&lt;/div&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;div class=\"pswp__item\"&gt;&lt;/div&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;/div&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. --&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;div class=\"pswp__ui pswp__ui--hidden\"&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;div class=\"pswp__top-bar\"&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;!-- Controls are self-explanatory. Order can be changed. --&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;div class=\"pswp__counter\"&gt;&lt;/div&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;button class=\"pswp__button pswp__button--close\" title=\"Close (Esc)\"&gt;&lt;/button&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;button class=\"pswp__button pswp__button--share\" title=\"Share\"&gt;&lt;/button&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;button class=\"pswp__button pswp__button--fs\" title=\"Toggle fullscreen\"&gt;&lt;/button&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;button class=\"pswp__button pswp__button--zoom\" title=\"Zoom in/out\"&gt;&lt;/button&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR --&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;!-- element will get class pswp__preloader--active when preloader is running --&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;div class=\"pswp__preloader\"&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;div class=\"pswp__preloader__icn\"&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;div class=\"pswp__preloader__cut\"&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;div class=\"pswp__preloader__donut\"&gt;&lt;/div&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;/div&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;/div&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;/div&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;/div&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;div class=\"pswp__share-modal pswp__share-modal--hidden pswp__single-tap\"&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;div class=\"pswp__share-tooltip\"&gt;&lt;/div&gt; \n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;/div&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;button class=\"pswp__button pswp__button--arrow--left\" title=\"Previous (arrow left)\"&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;/button&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;button class=\"pswp__button pswp__button--arrow--right\" title=\"Next (arrow right)\"&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;/button&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;div class=\"pswp__caption\"&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;div class=\"pswp__caption__center\"&gt;&lt;/div&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;/div&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;/div&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;/div&gt;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"&lt;/div&gt;"</span></span>; }</code> </pre> <br></div></div><br>  Die Dokumentation enth√§lt ein Beispiel f√ºr die Aktivierung des Plugins durch Klicken auf das Bild. Es wird jedoch darauf hingewiesen, dass es PhotoSwipe egal ist, wie genau es gestartet wird.  Als Ergebnis habe ich mein Skript geschrieben.  Ich zeige einen Artikel von einer anderen Website in der Anwendung an, damit ich vorgefertigtes HTML erhalte.  Um nicht dynamisch mit dem Layout zu arbeiten, √§ndere ich in meinem Skript die Klasse f√ºr alle Bilder (da der Artikel definitiv keine Exzesse enth√§lt), weise einen Ereignishandler zu (beim Klicken wird die URL √ºbergeben - sie dient als Kennung f√ºr die Galerie und das Plug-In startet). <br><br>  Das Plugin muss die Gr√∂√üe des Bildes kennen.  Da die Galerie beim Laden der gesamten Seite verbunden ist, k√∂nnen Sie die endg√ºltigen Bildgr√∂√üen anhand der Eigenschaften naturalWidth und naturalHeight des Bildes leicht ermitteln. <br><br>  Skriptcode.  Wenn die Seite geladen wird, wird zun√§chst die Funktion init () gestartet.  Wenn Sie dann auf das Bild klicken, √∂ffnen Sie die Galerie (). <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//         function init() { var images = document.images; for (var i = 0; i &lt; images.length; i++) { images[i].className = "photoSwipe"; images[i].onclick = function () { openGalery(this.attributes["src"].value); } } } //    function openGalery(url) { var images = document.getElementsByClassName("photoSwipe"); var items = new Array(); for (var i = 0; i &lt; images.length; i++) { items.push(getAttributes(images[i])); } startPhotoSwipe(items, getIndex(images, url)); } //    function getAttributes(image) { return { src: image.attributes["src"].value, w: image.naturalWidth, h: image.naturalHeight } } //   ,    function getIndex(images, url) { for(var i = 0; i &lt; images.length; i++) { if (url == images[i].attributes["src"].value) return i; } return false; } //   function startPhotoSwipe(items, index) { var pswpElement = document.querySelectorAll('.pswp')[0]; // define options (if needed) var options = { // optionName: 'option value' // for example: index: index, // start at index slide bgOpacity: 0.9, pinchToClose: false, fullscreenEl: false, closeEl:false, zoomEl: false, shareEl: false, indexIndicatorSep: '  ', tapToClose: true }; callAndroid.setGallery(true); //     Java  ,    // Initializes and opens PhotoSwipe var gallery = new PhotoSwipe( pswpElement, PhotoSwipeUI_Default, items, options); gallery.init(); }</span></span></code> </pre> <br></div></div><br>  Als N√§chstes m√ºssen Sie WebView konfigurieren und die Seite laden. <br><br><pre> <code class="java hljs">webView = findViewById(R.id.webView); webView.setWebViewClient(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebViewClient()); webView.setWebChromeClient(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebChromeClient()); webView.getSettings().setJavaScriptEnabled(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); webView.getSettings().setDomStorageEnabled(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);</code> </pre> <br>  In diesem Stadium wird die Seite geladen, das Plugin startet, wenn Sie auf das Bild klicken. Wenn Sie jedoch bei ge√∂ffneter Galerie auf die Schaltfl√§che "Zur√ºck" klicken, wird die gesamte Anwendung geschlossen, nicht das Plugin. <br><br>  Um dies zu beheben, habe ich eine Javascipt-Br√ºcke gebaut. <br><br>  Zuerst m√ºssen Sie Singleton mit dem Status der Galerie erstellen. <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> me.denko.photoswipe; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GalleryState</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> GalleryState ourInstance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GalleryState(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> GalleryState </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInstance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ourInstance; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GalleryState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> isGallery = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isGallery</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isGallery; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setGallery</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> gallery)</span></span></span><span class="hljs-function"> </span></span>{ isGallery = gallery; } }</code> </pre> <br></div></div><br>  Weitere Schnittstelle zum Aufrufen von WebView <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> me.denko.photoswipe; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.webkit.JavascriptInterface; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JavascriptFromWebView</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@JavascriptInterface</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setGallery</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bool)</span></span></span><span class="hljs-function"> </span></span>{ GalleryState.getInstance().setGallery(bool); } }</code> </pre> <br></div></div><br>  Sie m√ºssen diese Schnittstelle mit WebView verbinden <br><br><pre> <code class="java hljs">webView.addJavascriptInterface(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JavascriptFromWebView(), <span class="hljs-string"><span class="hljs-string">"callAndroid"</span></span>);</code> </pre> <br>  Im Skript zum √ñffnen der Galerie m√ºssen Sie hinzuf√ºgen <br><pre> <code class="javascript hljs">callAndroid.setGallery(<span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> </pre> <br><br>  Das Skript zum Schlie√üen der Galerie in der Datei photoswipe.js <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="javascript hljs">close: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!_isOpen) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } callAndroid.setGallery(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    _isOpen = false; _isDestroying = true; _shout('close'); _unbindEvents(); _showOrHide(self.currItem, null, true, self.destroy); },</span></span></code> </pre> <br></div></div><br>  Wenn Sie jetzt die Galerie √∂ffnen, wird der Status auf true gesetzt, wenn er geschlossen ist, auf false.  Sie m√ºssen lediglich den Back-Button-Handler WebView hinzuf√ºgen. <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="java hljs">webView.setOnKeyListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnKeyListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onKey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> keyCode, KeyEvent event)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.getAction() != KeyEvent.ACTION_DOWN &amp;&amp; keyCode == KeyEvent.KEYCODE_BACK) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GalleryState.getInstance().isGallery()) { webView.reload(); GalleryState.getInstance().setGallery(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> onBackPressed(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } });</code> </pre> <br></div></div><br>  Jetzt kann die Galerie mit der Zur√ºck-Taste ge√∂ffnet und dann geschlossen werden. <br><br>  Vollst√§ndiger <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github-</a> App-Code. <br><br>  Kritik am Kodex ist willkommen.  Wenn ich etwas falsch gemacht habe, schreibe bitte in den Kommentaren dar√ºber. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de454578/">https://habr.com/ru/post/de454578/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de454562/index.html">Warum das Konzept des Bytecodes nicht mehr so ‚Äã‚Äãrelevant ist wie zuvor</a></li>
<li><a href="../de454568/index.html">Mozilla bezeichnete Googles digital signierte Webpaket-Distribution als "schlecht".</a></li>
<li><a href="../de454570/index.html">Neuerstellung eines alten DOS-Spiels in C ++ 17</a></li>
<li><a href="../de454574/index.html">Maschinelles Lernen in der Mikrofinanzierung: Aufbau eines Bewertungsmodells f√ºr Kunden mit einer leeren Bonit√§tshistorie</a></li>
<li><a href="../de454576/index.html">GandCrab-Autoren h√∂ren auf zu arbeiten: Sie behaupten, genug gestohlen zu haben</a></li>
<li><a href="../de454582/index.html">Sollte die Arrayl√§nge in einer lokalen Variablen in C # gespeichert werden?</a></li>
<li><a href="../de454584/index.html">Schule f√ºr Schnittstellenentwicklung: Analyse der Aufgaben f√ºr Minsk und ein neues Set in Moskau</a></li>
<li><a href="../de454586/index.html">L√∂sen japanischer Kreuzwortr√§tsel mit PÃ∂yÃ∂tÃ∂hÃ∂oÃ∂Ã∂nÃ∂ Rust und WebAssembly</a></li>
<li><a href="../de454588/index.html">Gazprom Neft l√§dt Sie ein: GPN Data Science Meetup</a></li>
<li><a href="../de454590/index.html">Zimbra Collaboration Suite und Mobile Control mit ABQ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>