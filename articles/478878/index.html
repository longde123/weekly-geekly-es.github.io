<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üå¨Ô∏è üôéüèª üôÖ ¬°El c√≥digo m√°s popular en la historia de StackOverflow tiene un error! üíè üö† üë©‚Äçüî¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Un estudio reciente, "Uso y atribuci√≥n de fragmentos de c√≥digo de desbordamiento de pila en proyectos GitHub", de repente descubri√≥ que la mayor√≠a de ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>¬°El c√≥digo m√°s popular en la historia de StackOverflow tiene un error!</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/478878/">  Un estudio reciente, <a href="https://doi.org/10.1007/s10664-018-9650-5" rel="nofollow">"Uso y atribuci√≥n de fragmentos de c√≥digo de desbordamiento de pila en proyectos GitHub", de</a> repente descubri√≥ que la mayor√≠a de las veces en proyectos de c√≥digo abierto, mi <a href="https://stackoverflow.com/a/3758880/276052" rel="nofollow">respuesta</a> fue escrita hace casi diez a√±os.  Ir√≥nicamente, hay un error. <br><br><h2>  √ârase una vez ... </h2><br>  En 2010, estaba sentado en mi oficina y haciendo tonter√≠as: me divert√≠ con el <a href="https://en.wikipedia.org/wiki/Code_golf" rel="nofollow">c√≥digo de golf</a> y <a href="https://en.wikipedia.org/wiki/Code_golf" rel="nofollow">agregu√© una</a> calificaci√≥n a Stack Overflow. <br><br>  La siguiente pregunta me llam√≥ la atenci√≥n: ¬øc√≥mo mostrar el n√∫mero de bytes en un formato legible?  Es decir, c√≥mo convertir algo como 123456789 bytes a "123.5 MB". <br><br> <a href="https://stackoverflow.com/q/3758606/276052" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/7ca/00b/1f7/7ca00b1f7d4f57f0f8afa4ed9554797a.png"></a> <br>  <i><font color="gray">Buena interfaz de 2010, gracias The Wayback Machine</font></i> <br><a name="habracut"></a><br>  Impl√≠citamente, el resultado ser√≠a un n√∫mero entre 1 y 999.9 con la unidad apropiada. <br><br>  Ya hab√≠a una respuesta con un bucle.  La idea es simple: verifique todos los grados desde la unidad m√°s grande (EB = 10 <sup>18</sup> bytes) hasta la m√°s peque√±a (B = 1 byte) y aplique el primero, que es menor que el n√∫mero de bytes.  En pseudoc√≥digo, se ve m√°s o menos as√≠: <br><br><pre><code class="plaintext hljs">suffixes = [ "EB", "PB", "TB", "GB", "MB", "kB", "B" ] magnitudes = [ 10^18, 10^15, 10^12, 10^9, 10^6, 10^3, 10^0 ] i = 0 while (i &lt; magnitudes.length &amp;&amp; magnitudes[i] &gt; byteCount) i++ printf("%.1f %s", byteCount / magnitudes[i], suffixes[i])</code> </pre> <br>  Por lo general, con la respuesta correcta con una calificaci√≥n positiva, es dif√≠cil ponerse al d√≠a.  En la jerga de Stack Overflow, esto se llama el <a href="https://meta.stackexchange.com/questions/9731/fastest-gun-in-the-west-problem" rel="nofollow">problema del tirador m√°s r√°pido en Occidente</a> .  Pero aqu√≠ la respuesta ten√≠a varios defectos, as√≠ que todav√≠a esperaba superarla.  Al menos el c√≥digo con un bucle puede reducirse considerablemente. <br><br><h2>  Bueno, esto es √°lgebra, ¬°todo es simple! </h2><br>  Entonces me di cuenta.  Los prefijos son kilo-, mega-, giga-, ... - nada m√°s que el grado de 1000 (o 1024 en el est√°ndar IEC), por lo que el prefijo correcto se puede determinar utilizando el logaritmo, y no el ciclo. <br><br>  Basado en esta idea, publiqu√© lo siguiente: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">humanReadableByteCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bytes, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> si)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> unit = si ? <span class="hljs-number"><span class="hljs-number">1000</span></span> : <span class="hljs-number"><span class="hljs-number">1024</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bytes &lt; unit) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bytes + <span class="hljs-string"><span class="hljs-string">" B"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> exp = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) (Math.log(bytes) / Math.log(unit)); String pre = (si ? <span class="hljs-string"><span class="hljs-string">"kMGTPE"</span></span> : <span class="hljs-string"><span class="hljs-string">"KMGTPE"</span></span>).charAt(exp-<span class="hljs-number"><span class="hljs-number">1</span></span>) + (si ? <span class="hljs-string"><span class="hljs-string">""</span></span> : <span class="hljs-string"><span class="hljs-string">"i"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> String.format(<span class="hljs-string"><span class="hljs-string">"%.1f %sB"</span></span>, bytes / Math.pow(unit, exp), pre); }</code> </pre> <br>  Por supuesto, esto no es muy legible, y log / pow es inferior en eficiencia a otras opciones.  Pero no hay bucle y casi no hay ramificaci√≥n, por lo que el resultado es bastante hermoso, en mi opini√≥n. <br><br><blockquote>  <b>La matem√°tica es simple</b> .  El n√∫mero de bytes se expresa como byteCount = 1000 <sup>s</sup> , donde <i>s</i> representa el grado (en notaci√≥n binaria, la base es 1024). La soluci√≥n <i>s</i> da <i>s</i> = log <sub>1000</sub> (byteCount). <br><br>  No hay una expresi√≥n simple log <sub>1000</sub> en la API, pero podemos expresarla en t√©rminos del logaritmo natural de la siguiente manera s = log (byteCount) / log (1000).  Luego, convertimos <i>s</i> en int, por lo que si, por ejemplo, tenemos m√°s de un megabyte (pero no un gigabyte completo), se utilizar√° MB como unidad de medida. <br><br>  Resulta que si <i>s</i> = 1, entonces la dimensi√≥n es kilobytes, si <i>s</i> = 2 - megabytes y as√≠ sucesivamente.  Divida byteCount por 1000 <sup>sy</sup> coloque la letra correspondiente en el prefijo. </blockquote><br>  Todo lo que quedaba era esperar y ver c√≥mo la comunidad percib√≠a la respuesta.  No podr√≠a pensar que este c√≥digo se convertir√≠a en el m√°s difundido en la historia de Stack Overflow. <br><br><h2>  Estudio de atribuci√≥n </h2><br>  Avance r√°pido hasta 2018.  El estudiante graduado Sebastian Baltes publica un art√≠culo en la revista cient√≠fica <i>Empirical Software Engineering</i> titulado <a href="https://doi.org/10.1007/s10664-018-9650-5" rel="nofollow">‚ÄúUso y atribuci√≥n de fragmentos de c√≥digo de desbordamiento de pila en proyectos GitHub‚Äù</a> .  El tema de su investigaci√≥n es cu√°nto se respeta la licencia Stack Overflow CC BY-SA 3.0, es decir, ¬øse√±alan los autores que los enlaces de Stack Overflow son una fuente de c√≥digo? <br><br>  Para el an√°lisis, se extrajeron fragmentos de c√≥digo del <a href="https://archive.org/details/stackexchange" rel="nofollow">volcado de desbordamiento de pila</a> y se asignaron al c√≥digo en los repositorios p√∫blicos de GitHub.  Cita del resumen: <br><br><blockquote>  <i>Presentamos los resultados de un estudio emp√≠rico a gran escala que analiza el uso y la atribuci√≥n de fragmentos no triviales de c√≥digo Java de respuestas SO en proyectos p√∫blicos de GitHub (GH).</i> </blockquote><br>  (Spoiler: no, la mayor√≠a de los programadores no cumplen con los requisitos de la licencia). <br><br>  El art√≠culo tiene una tabla de este tipo: <br><br><img src="https://habrastorage.org/webt/d_/jb/az/d_jbazgu5cmhwyw__yxdxkzdhwy.png"><br><br>  Esta respuesta anterior con el identificador <a href="https://stackoverflow.com/a/3758880/276052" rel="nofollow">3758880</a> result√≥ ser la respuesta que <a href="https://stackoverflow.com/a/3758880/276052" rel="nofollow">publiqu√©</a> hace ocho a√±os.  Por el momento, tiene m√°s de cien mil visitas y m√°s de mil ventajas. <br><br>  Una b√∫squeda r√°pida en GitHub realmente produce miles de repositorios con el c√≥digo <code>humanReadableByteCount</code> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c4c/3de/bc6/c4c3debc6c290c209b90c2dca5be46ab.png"><br><br>  Busque este fragmento en su repositorio: <br><br><pre> <code class="bash hljs">$ git grep humanReadableByteCount</code> </pre> <br><blockquote>  <b>Una historia divertida</b> , como descubr√≠ sobre este estudio. <br><br>  Sebastian encontr√≥ una coincidencia en el repositorio de OpenJDK sin ninguna atribuci√≥n, y la licencia de OpenJDK no es compatible con CC BY-SA 3.0.  En <a href="http://mail.openjdk.java.net/pipermail/jdk9-dev/2016-December/005327.html" rel="nofollow">la lista de correo jdk9-dev,</a> pregunt√≥: ¬øse copia el c√≥digo de desbordamiento de pila de OpenJDK o viceversa? <br><br>  Lo curioso es que acabo de trabajar en Oracle, en el proyecto OpenJDK, por lo que mi antiguo colega y amigo escribi√≥ lo siguiente: <br><br>  <i>Hola</i> <i><br><br></i>  <i>¬øPor qu√© no preguntar al autor de esta publicaci√≥n directamente en SO (aioobe)?</i>  <i>Es miembro de OpenJDK y trabaj√≥ en Oracle cuando este c√≥digo apareci√≥ en los repositorios de c√≥digo fuente de OpenJDK.</i> <br><br>  Oracle se toma muy en serio estos problemas.  S√© que algunos gerentes se sintieron aliviados cuando leyeron esta respuesta y encontraron al "culpable". <br><br>  Entonces Sebastian me escribi√≥ para aclarar la situaci√≥n, lo cual hice: este c√≥digo se agreg√≥ <i>antes de</i> unirme a Oracle y no tengo nada que ver con el commit.  Es mejor no bromear con Oracle.  Unos d√≠as despu√©s de que <a href="https://bugs.openjdk.java.net/browse/JDK-8170860" rel="nofollow">se abri√≥ el ticket,</a> este c√≥digo <a href="http://hg.openjdk.java.net/jdk9/jdk9/hotspot/rev/b552b596203f" rel="nofollow">se elimin√≥</a> . </blockquote><br><h2>  Bug </h2><br>  Apuesto a que ya pensaste en eso.  ¬øQu√© tipo de error en el c√≥digo? <br><br>  Una vez m√°s: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">humanReadableByteCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bytes, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> si)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> unit = si ? <span class="hljs-number"><span class="hljs-number">1000</span></span> : <span class="hljs-number"><span class="hljs-number">1024</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bytes &lt; unit) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bytes + <span class="hljs-string"><span class="hljs-string">" B"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> exp = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) (Math.log(bytes) / Math.log(unit)); String pre = (si ? <span class="hljs-string"><span class="hljs-string">"kMGTPE"</span></span> : <span class="hljs-string"><span class="hljs-string">"KMGTPE"</span></span>).charAt(exp-<span class="hljs-number"><span class="hljs-number">1</span></span>) + (si ? <span class="hljs-string"><span class="hljs-string">""</span></span> : <span class="hljs-string"><span class="hljs-string">"i"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> String.format(<span class="hljs-string"><span class="hljs-string">"%.1f %sB"</span></span>, bytes / Math.pow(unit, exp), pre); }</code> </pre> <br>  Cuales son las opciones? <br><br>  Despu√©s de exabytes (10 <sup>18</sup> ) son zettabytes (10 <sup>21</sup> ).  ¬øQuiz√°s un n√∫mero realmente grande ir√° m√°s all√° de kMGTPE?  No  El valor m√°ximo es 2 <sup>63</sup> -1 ‚âà 9.2 √ó 10 <sup>18</sup> , por lo que ning√∫n valor ir√° m√°s all√° de los exabytes. <br><br>  ¬øQuiz√°s la confusi√≥n entre las unidades SI y el sistema binario?  No  Hubo confusi√≥n en la primera versi√≥n de la respuesta, pero se solucion√≥ con bastante rapidez. <br><br>  ¬øQuiz√°s exp termina en cero, causando que charAt (exp-1) se bloquee?  No tampoco.  La primera declaraci√≥n if cubre este caso.  El valor exp siempre ser√° al menos 1. <br><br>  ¬øQuiz√°s alg√∫n extra√±o error de redondeo en la extradici√≥n?  Bueno, finalmente ... <br><br><h2>  Muchos nueves </h2><br>  La soluci√≥n funciona hasta que se acerca a 1 MB.  Cuando se especifican <code>"1000,0 kB"</code> bytes como entrada, el resultado (en modo SI) es <code>"1000,0 kB"</code> .  Aunque 999,999 est√° m√°s cerca de 1000 √ó 1000 <sup>1</sup> que de 999,9 √ó 1000 <sup>1</sup> , el significante 1000 est√° prohibido por la especificaci√≥n.  El resultado correcto es <code>"1.0 MB"</code> . <br><br>  En mi defensa, puedo decir que en el momento de escribir esto, tal error estaba en las 22 respuestas publicadas, incluidas las bibliotecas Apache Commons y Android. <br><br>  ¬øC√≥mo arreglarlo?  En primer lugar, observamos que el exponente (exp) deber√≠a cambiar de 'k' a 'M' tan pronto como el n√∫mero de bytes est√© m√°s cerca de 1 √ó 1,000 <sup>2</sup> (1 MB) que de 999.9 √ó 1000 <sup>1</sup> (999.9 k )  Esto sucede en 999,950. Del mismo modo, debemos cambiar de 'M' a 'G' cuando pasamos por 999,950,000 y as√≠ sucesivamente. <br><br>  Calculamos este umbral y aumentamos la <code>exp</code> si los <code>bytes</code> mayores: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bytes &gt;= Math.pow(unit, exp) * (unit - <span class="hljs-number"><span class="hljs-number">0.05</span></span>)) exp++;</code> </pre> <br>  Con este cambio, el c√≥digo funciona bien hasta que el n√∫mero de bytes se aproxima a 1 EB. <br><br><h2>  M√°s nueves </h2><br>  Al calcular 999 949 999 999 999 999 999, el c√≥digo da <code>1000.0 PB</code> , y el resultado correcto es <code>999.9 PB</code> .  Matem√°ticamente, el c√≥digo es preciso, entonces, ¬øqu√© pasa aqu√≠? <br><br>  Ahora nos enfrentamos a restricciones <code>double</code> . <br><br><blockquote><h4>  Introducci√≥n a la aritm√©tica de coma flotante. </h4><br>  De acuerdo con la especificaci√≥n IEEE 754, los valores de coma flotante cercanos a cero tienen una representaci√≥n muy densa, mientras que los valores grandes tienen una representaci√≥n muy escasa.  De hecho, la mitad de todos los valores est√°n entre -1 y 1, y cuando se trata de n√∫meros grandes, un valor de tama√±o <code>Long.MAX_VALUE</code> no significa nada.  En el sentido literal. <br><br><pre> <code class="plaintext hljs">double l1 = Double.MAX_VALUE; double l2 = l1 - Long.MAX_VALUE; System.err.println(l1 == l2); // prints true</code> </pre> <br>  Consulte <a href="https://programming.guide/bits-of-a-floating-point-value.html" rel="nofollow">"Bits de coma flotante" para m√°s</a> detalles. </blockquote><br>  El problema est√° representado por dos c√°lculos: <br><br><ul><li>  Divisi√≥n en <code>String.format</code> y <br></li><li>  Umbral de expansi√≥n <code>exp</code> </li></ul><br>  Podemos cambiar a <code>BigDecimal</code> , pero es aburrido.  Adem√°s, aqu√≠ tambi√©n surgen problemas, porque la API est√°ndar no tiene un logaritmo para <code>BigDecimal</code> . <br><br><h4>  Reducci√≥n de valores intermedios </h4><br>  Para resolver el primer problema, podemos reducir el valor de <code>bytes</code> al rango deseado, donde la precisi√≥n es mejor, y ajustar la <code>exp</code> consecuencia.  En cualquier caso, el resultado final es redondeado, por lo que no importa que descartemos los d√≠gitos menos significativos. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exp &gt; <span class="hljs-number"><span class="hljs-number">4</span></span>) { bytes /= unit; exp--; }</code> </pre> <br><h4>  Configuraci√≥n de bits menos significativos </h4><br>  Para resolver el segundo problema <i>, los</i> bits menos significativos <i>son importantes para</i> nosotros (99994999 ... 9 y 99995000 ... 0 deben tener diferentes grados), por lo que debemos encontrar una soluci√≥n diferente. <br><br>  Primero, tenga en cuenta que hay 12 valores de umbral diferentes (6 para cada modo), y solo uno de ellos conduce a un error.  Un resultado incorrecto puede identificarse de forma exclusiva porque termina en D00 <sub>16</sub> .  Para que pueda arreglarlo directamente. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">long</span></span> th = (<span class="hljs-keyword"><span class="hljs-keyword">long</span></span>) (Math.pow(unit, exp) * (unit - <span class="hljs-number"><span class="hljs-number">0.05</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exp &lt; <span class="hljs-number"><span class="hljs-number">6</span></span> &amp;&amp; bytes &gt;= th - ((th &amp; <span class="hljs-number"><span class="hljs-number">0xFFF</span></span>) == <span class="hljs-number"><span class="hljs-number">0xD00</span></span> ? <span class="hljs-number"><span class="hljs-number">52</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>)) exp++;</code> </pre> <br>  Dado que confiamos en ciertos patrones de bits en los resultados de coma flotante, utilizamos el modificador estricto fp para garantizar que el c√≥digo funcione independientemente del hardware. <br><br><h2>  Valores de entrada negativos </h2><br>  No est√° claro en qu√© circunstancias puede tener sentido un n√∫mero negativo de bytes, pero dado que Java no tiene un <code>long</code> sin signo, es mejor manejar esta opci√≥n.  En este momento, una entrada como <code>-10000 B</code> produce <code>-10000 B</code> <br><br>  Escribamos <code>absBytes</code> : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">long</span></span> absBytes = bytes == Long.MIN_VALUE ? Long.MAX_VALUE : Math.abs(bytes);</code> </pre> <br>  La expresi√≥n es tan detallada porque <code>-Long.MIN_VALUE == Long.MIN_VALUE</code> .  Ahora hacemos todos los c√°lculos de <code>exp</code> utilizando <code>absBytes</code> lugar de <code>bytes</code> . <br><br><h2>  Versi√≥n final </h2><br>  Aqu√≠ est√° la versi√≥n final del c√≥digo, acortada y condensada en el esp√≠ritu de la versi√≥n original: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// From: https://programming.guide/the-worlds-most-copied-so-snippet.html public static strictfp String humanReadableByteCount(long bytes, boolean si) { int unit = si ? 1000 : 1024; long absBytes = bytes == Long.MIN_VALUE ? Long.MAX_VALUE : Math.abs(bytes); if (absBytes &lt; unit) return bytes + " B"; int exp = (int) (Math.log(absBytes) / Math.log(unit)); long th = (long) (Math.pow(unit, exp) * (unit - 0.05)); if (exp &lt; 6 &amp;&amp; absBytes &gt;= th - ((th &amp; 0xfff) == 0xd00 ? 52 : 0)) exp++; String pre = (si ? "kMGTPE" : "KMGTPE").charAt(exp - 1) + (si ? "" : "i"); if (exp &gt; 4) { bytes /= unit; exp -= 1; } return String.format("%.1f %sB", bytes / Math.pow(unit, exp), pre); }</span></span></code> </pre> <br>  Tenga en cuenta que esto comenz√≥ como un intento de evitar bucles y ramificaciones excesivas.  Pero despu√©s de suavizar todas las situaciones de borde, el c√≥digo se volvi√≥ a√∫n menos legible que la versi√≥n original.  Personalmente, no copiar√≠a este fragmento en producci√≥n. <br><br>  Para una versi√≥n actualizada de la calidad de producci√≥n, vea un art√≠culo separado: <a href="https://programming.guide/java/formatting-byte-size-to-human-readable-format.html" rel="nofollow">"Formateando el tama√±o del byte en un formato legible"</a> . <br><br><h2>  Resultados clave </h2><br><ul><li>  Puede haber errores en las respuestas a Stack Overflow, incluso si tienen miles de ventajas. <br></li><li>  Verifique todos los casos l√≠mite, <i>especialmente</i> en c√≥digo con Stack Overflow. <br></li><li>  La aritm√©tica de coma flotante es complicada. <br></li><li>  Aseg√∫rese de incluir la atribuci√≥n correcta al copiar el c√≥digo.  Alguien puede llevarte a limpiar el agua. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/478878/">https://habr.com/ru/post/478878/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../478858/index.html">Comparaci√≥n de sesiones de creaci√≥n de perfiles en XHProf Admin</a></li>
<li><a href="../478862/index.html">¬øC√≥mo se organizan las pruebas frontend en Yandex.Market y por qu√© rechazamos los lanzamientos semanales?</a></li>
<li><a href="../478866/index.html">Meet Space - Nuevo producto de JetBrains</a></li>
<li><a href="../478872/index.html">Bricolaje: c√≥mo automatizamos la supervisi√≥n del almac√©n</a></li>
<li><a href="../478874/index.html">Toshiba ha anunciado dos nuevas l√≠neas de discos duros con una capacidad de hasta 6 TB y anunci√≥ su orientaci√≥n al segmento corporativo desde 2020</a></li>
<li><a href="../478880/index.html">¬øQu√© salarios ofrecieron los empleadores a los especialistas de TI en la segunda mitad de 2019?</a></li>
<li><a href="../478884/index.html">C√≥mo preparar RTSP en el sitio en 2020, o por qu√© los jabal√≠es no tienen tiempo para escapar</a></li>
<li><a href="../478886/index.html">Componentes angulares con contenido en l√≠nea</a></li>
<li><a href="../478888/index.html">Algunas reflexiones sobre css modular y problemas de soporte de c√≥digo</a></li>
<li><a href="../478892/index.html">El voluntariado como forma de vida.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>