<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔙 📎 📮 Siapkan peluncuran otomatis uji UI aplikasi Android melalui TeamCity 🛤️ 🍌 🐼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cepat atau lambat, setiap penguji yang mengembangkan praktik swa-uji menghadapi masalah pelaksanaan otonom dari pengujian mereka. Selain itu, jika spe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Siapkan peluncuran otomatis uji UI aplikasi Android melalui TeamCity</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415769/">  Cepat atau lambat, setiap penguji yang mengembangkan praktik swa-uji menghadapi masalah pelaksanaan otonom dari pengujian mereka.  Selain itu, jika spesialis berpengalaman, maka ia mencoba untuk menangani ini sedini mungkin.  Jadi saya, setelah autotest pertama yang berhasil dijalankan secara lokal, memutuskan untuk segera mengkonfigurasi peluncuran di TeamCity. <br><br>  Saya perhatikan bahwa di perusahaan kami praktis tidak ada keahlian dalam peluncuran jarak jauh tes instrumental Android, jadi saya harus google keras, tapi saya juga tidak menemukan panduan terperinci di sana.  Karena itu, saya memutuskan untuk membaca instruksi ini. <br><a name="habracut"></a><br>  Di pintu masuk kami memiliki: <br><br><ul><li>  tes berhasil dijalankan secara lokal </li><li>  menjalankan server TeamCity </li><li>  server pada debian dengan KVM dan X </li></ul><br>  <i>Penafian segera tentang server tempat peluncuran akan dilakukan: menyiapkan OS, virtualisasi perangkat keras, dan shell grafis bukan subjek dari artikel ini dan akan dihapus.</i> <br><br><h3>  Instal dan konfigurasikan agen TeamCity </h3><br>  Mari kita mulai dengan Java.  Hal utama di sini adalah memilih versi yang tepat.  Saya memiliki 3 dependensi: tes sendiri, alat android, dan agen tim.  Saya berhenti di versi 8 untuk menggunakan satu JVM untuk semua orang.  Jika Anda kurang beruntung dan akan ada konflik, Anda harus mengkonfigurasi penggunaan beberapa versi Java pada mesin yang sama.  Satu lagi catatan: jika Anda memiliki debian, maka pertama-tama Anda perlu menambahkan repositori webupd8team (google sangat cepat). <br><br><pre><code class="bash hljs">sudo apt-get install oracle-java8-installer sudo apt-get install oracle-java8-set-default</code> </pre> <br>  Selanjutnya, buat pengguna di mana agen akan diluncurkan dan, sesuai, segalanya.  Jangan lupa untuk mengatur kata sandi. <br><br><pre> <code class="bash hljs">sudo useradd -d /home/tc_agent -s /bin/bash -m tc_agent sudo passwd tc_agent</code> </pre> <br>  Distribusi agen dapat diambil di antarmuka web dari tim Anda.  Untuk melakukan ini, buka bagian <i>Agen</i> dan klik tautan <i>Instal Agen Build</i> di kanan atas.  Unduh dan unzip ke folder yang diinginkan di server (saya sarankan folder home pengguna kami - <code>/home/tc_agent</code> ).  Selanjutnya, tambahkan hak untuk menjalankan semua skrip: <br><br><pre> <code class="bash hljs">sudo chmod +x /home/tc_agent/BuildAgent/bin/*</code> </pre> <br>  Jika versi teamcity Anda mendukung Agent Push, maka itu masih lebih mudah.  Cukup buka tab yang sesuai di antarmuka web, klik tombol <i>Instal Agen ...</i> dan ikuti instruksi. <br><br>  Kami mengonfigurasi konfigurasi.  Jika Anda menggunakan instalasi jarak jauh, maka itu telah dibuat dan Anda hanya perlu menentukan nama agen di dalamnya.  Jika tidak, buat: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /home/tc_agent/BuildAgent/conf cp buildAgent.dist.properties buildAgent.properties nano buildAgent.properties</code> </pre> <br>  <code>serverUrl=</code> alamat antarmuka web server, dan <code>name=</code> nama unik agen.  Jika Anda memiliki beberapa agen atau port default (9090) sedang sibuk, maka atur sendiri menggunakan parameter <code>ownPort=</code> . <br><br>  Kita <code>/home/tc_agent/BuildAgent/bin/agent.sh start</code> perintah <code>/home/tc_agent/BuildAgent/bin/agent.sh start</code> .  Jika semuanya dikonfigurasi dengan benar, maka kita akan melihat agen kami di tab <i>Tidak Sah</i> .  Kami mengizinkan dan Anda dapat menggunakan. <br><br>  Untuk memulai agen secara otomatis, buat skrip <code>/etc/init.d/teamcity_agent</code> dengan konten berikut: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash BINARY="/home/tc_agent/BuildAgent/bin/agent.sh" RUNAS="tc_agent" LOGFILE="/home/tc_agent/BuildAgent/logs/start.log" CMD="$BINARY $1 $2" runuser - "$RUNAS" -c "$CMD &gt; $LOGFILE" cat $LOGFILE</span></span></code> </pre><br>  Tambahkan hak untuk menjalankan <code>sudo chmod +x /etc/init.d/teamcity_agent</code> dan tambahkan baris <code>/etc/init.d/teamcity_agent start</code> dari file <code>/etc/rc.local</code> . <br><br>  Kontrol reboot, agen telah meningkat, kami melanjutkan. <br><br><h3>  Instal Android SDK dan emulator </h3><br>  Unduh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">alat SDK Android</a> (hanya alat baris perintah) dan buka paket itu ke direktori yang diinginkan.  Buat direktori untuk menyimpan gambar AVD di masa depan (harus ada ruang yang cukup).  Bagi saya, admin telah menghubungkan repositori utama ke direktori <code>/var,</code> dan saya akan meletakkan semuanya di sana.  Selanjutnya, kami mengubah pemilik file menjadi pengguna kami dan langkah selanjutnya paling baik dilakukan di bawahnya. <br><br><pre> <code class="bash hljs">sudo chown tc_agent -R /var/opt/android-sdk sudo mkdir /var/opt/.android sudo chown tc_agent /var/opt/.android</code> </pre> <br>  Tambahkan variabel lingkungan.  Buka file <code>/home/tc_agent/.bash_profile</code> untuk mengedit dan menulis: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ANDROID_HOME=/var/opt/android-sdk <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ANDROID_AVD_HOME=/var/opt/.android/avd <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> PATH=<span class="hljs-variable"><span class="hljs-variable">$ANDROID_HOME</span></span>/platform-tools:<span class="hljs-variable"><span class="hljs-variable">$PATH</span></span> <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> PATH=<span class="hljs-variable"><span class="hljs-variable">$ANDROID_HOME</span></span>/tools:<span class="hljs-variable"><span class="hljs-variable">$PATH</span></span></code> </pre> <br>  Kami memulai ulang dan memverifikasi bahwa variabel ditampilkan dengan benar di antarmuka web teamcity pada tab <i>Parameter Agen</i> . <br><br>  Kami mencoba menjalankan sdkmanager: perintah <code>$ANDROID_HOME/tools/bin/sdkmanager --list</code> daftar harus mencantumkan paket yang diinstal dan tersedia.  Jika Anda mendapatkan kesalahan seperti <code>Exception in thread "main" java.lang.NoClassDefFoundError</code> , kemudian coba <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">solusi ini</a> . <br><br>  Instal alat yang diperlukan dan gambar mesin virtual. <br><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$ANDROID_HOME</span></span>/tools/bin/sdkmanager emulator platform-tools tools <span class="hljs-variable"><span class="hljs-variable">$ANDROID_HOME</span></span>/tools/bin/sdkmanager <span class="hljs-string"><span class="hljs-string">'system-images;android-25;google_apis;x86'</span></span></code> </pre> <br><h3>  Buat dan jalankan AVD </h3><br>  Jadi, kami mengunduh gambar <code>'system-images;android-25;google_apis;x86'</code> (Android 7.1.1), buat perangkat virtual berdasarkan itu.  Saya tidak akan masuk ke rincian semua parameter yang mungkin dari utilitas avdmanager, saya akan menunjukkannya pada jumlah minimum yang mungkin: <br><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$ANDROID_HOME</span></span>/tools/bin/avdmanager create avd -n avd_name -k <span class="hljs-string"><span class="hljs-string">"system-images;android-25;google_apis;x86"</span></span></code> </pre> <br>  Kami mentransfer nama dan gambar asli (harus diunduh terlebih dahulu melalui sdkmanager).  Jika kesalahan dikembalikan, tambahkan tanda <code>-v</code> untuk melihat teks. <br><br>  Kami lolos ke emulator.  Pertama, periksa emulator, platform, platform-tools, folder gambar sistem di direktori SDK.  Saya membuat platform dengan tangan saya, sisanya dibuat ketika menginstal paket melalui sdkmanager.  Selanjutnya, periksa akselerasi perangkat keras.  Seharusnya ada jawaban seperti itu. <br><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$ANDROID_HOME</span></span>/emulator/emulator -accel-check accel: 0 KVM (version 12) is installed and usable. accel</code> </pre><br>  Jika ada kesalahan saat mengakses <code>/dev/kvm</code> , maka tambahkan haknya: <br><br><pre> <code class="bash hljs">addgroup kvm usermod -a -G kvm tc_agent chown root:kvm /dev/kvm</code> </pre><br>  Plus, saya masih perlu menginstal QEMU: <code>sudo apt-get install qemu-kvm</code> <br>  Buat relogon dan periksa lagi emulator. <br><br>  Jika semuanya baik-baik saja, maka coba jalankan.  Untuk melihat melalui mata, sambungkan ke server melalui vnc.  Dan jalankan emulator: <br><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$ANDROID_HOME</span></span>/emulator/emulator @avd_name</code> </pre> <br>  Jendela berikut akan muncul: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xh/j8/ba/xhj8ba7qlv8xivwalti-cg9mf-m.png"></div><br>  Selama uji coba, kami akan berjalan tanpa gambar, jadi kami akan menambahkan parameter <code>-no-window</code> . <br><br><h3>  Konfigurasikan build di TeamCity </h3><br>  Kami lolos ke tahap akhir - menyiapkan peluncuran tes kami secara otonom.  Saya membangun 4 langkah. <br><br>  1. Mulai emulator <br><br><pre> <code class="bash hljs">nohup /var/opt/android-sdk/emulator/emulator @avd_name -no-snapshot-save -no-boot-anim -no-window -snapshot clean_snap_1 &gt; start_emulator.log 2&gt;&amp;1&amp;</code> </pre> <br>  Karena emulator "mengunci" terminal, Anda perlu membuka ikatan proses menggunakan utilitas nohup (Anda dapat melakukannya dengan cara lain - Anda memutuskan).  Untuk berjaga-jaga, simpan log emulator ke file <code>start_emulator.log</code> .  Untuk menjalankan tes, saya membuat snapshot bersih (lihat di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini tentang</a> cara melakukan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ini</a> ) dan menambahkan tombol <code>-no-snapshot-save</code> sehingga tidak akan ditimpa. <br><br>  2. Menunggu perangkat untuk boot. <br><br><pre> <code class="bash hljs">adb <span class="hljs-built_in"><span class="hljs-built_in">wait</span></span>-for-device shell <span class="hljs-string"><span class="hljs-string">'while [[ -z $(getprop sys.boot_completed) ]]; do sleep 1; done;'</span></span></code> </pre> <br>  Pertama, kita menunggu status <code>wait-for-device</code> , kemudian dalam loop kita menunggu ketika variabel <code>sys.boot_completed</code> mengembalikan 1. <br><br>  3. Menjalankan tes.  Semuanya individual di sini, inilah contoh saya: <br><br><pre> <code class="bash hljs">./gradlew clean connectedAndroidTest</code> </pre> <br>  4. Tutup emulator.  Di sini sejauh ini saya telah membuat penghentian proses yang sederhana. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> -s 2 `pgrep qemu-system`</code> </pre> <br>  Tetapi lebih baik, tentu saja, untuk mengingat ID proses saat membuat emulator.  Ini akan diperlukan ketika kita mulai menjalankan tes di beberapa utas, yang secara tidak sengaja “membunuh” proses yang salah. <br><br>  Itu saja, terima kasih sudah membaca.  Jika ada komentar dari kolega yang lebih berpengalaman, maka saya dengan senang hati akan melakukan perubahan pada manual. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id415769/">https://habr.com/ru/post/id415769/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id415759/index.html">NSA telah mulai menghapus metadata yang direkam karena "kesalahan"</a></li>
<li><a href="../id415761/index.html">Apa, Bagaimana dan Mengapa di Iklan yang Dapat Diputar</a></li>
<li><a href="../id415763/index.html">Pemerintah AS sedang mendiskusikan kemungkinan mendapatkan kembali kendali atas IANA [tetapi ini tidak mungkin]</a></li>
<li><a href="../id415765/index.html">Mengapa VMware memutuskan untuk membuat platform untuk mengembangkan blockchains perusahaan</a></li>
<li><a href="../id415767/index.html">Tesla Inc telah membuka kemungkinan memesan Tesla Model 3 untuk penduduk Kanada dan Amerika Serikat</a></li>
<li><a href="../id415771/index.html">Go Compiler: Aturan Optimasi SSA Deskripsi Bahasa</a></li>
<li><a href="../id415773/index.html">Persyaratan non-fungsional: Skalabilitas</a></li>
<li><a href="../id415775/index.html">Sederhana, tetapi tidak jelas, kiat untuk menyiapkan laporan untuk konferensi keren</a></li>
<li><a href="../id415777/index.html">Kejuaraan pembelajaran mesin pertama dalam pengembangan</a></li>
<li><a href="../id415779/index.html">Implementasi platform perangkat lunak NAS yang aman</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>