<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏂🏻 🥘 💙 «Consultant +»: évolution du flux de matière. Polices, styles, alignement du texte avec python 🍷 📏 ⛹🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=""Consultant +" - un système de référence pour les avocats, les comptables, etc. Cela fonctionne de manière stable comme une montre. Dans cet article, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>«Consultant +»: évolution du flux de matière. Polices, styles, alignement du texte avec python</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465229/">  "Consultant +" - un système de référence pour les avocats, les comptables, etc.  Cela fonctionne de manière stable comme une montre.  Dans cet article, il est suggéré de régler cette horloge un peu en fonction de vos besoins en termes de sortie de texte, à savoir: regardez comment vous pouvez traiter les informations de texte que le système donne avec python.  En cours de route, travaillez avec les éléments de texte déclarés dans le titre. <br><a name="habracut"></a><br><h3>  Ombre sur la clôture </h3><br>  En tant qu'avocat qui travaille depuis longtemps avec le programme d'aide «Consultant +», je manquais toujours de la fonction habituelle dans ce système.  Cette fonction était la suivante.  Lorsqu'un changement apparaît dans l'acte réglementaire, les employés de K + affichent un aperçu des changements sous la forme de deux colonnes de texte: <br><br><img src="https://habrastorage.org/webt/k5/ya/w9/k5yaw9jbfy9aefzvtfzb-dg90he.png"><br><br>  La colonne de gauche est ce qu'elle était avant, la colonne de droite est la norme qui est maintenant en vigueur.  Maintenant (il y a quelques années), la fonctionnalité a été mise à jour et les modifications sont mises <b>en</b> évidence <b>en gras</b> et immédiatement visibles.  Tout cela est très pratique.  Mais il y a des choses inconfortables. <br><br>  Premièrement, certaines normes ne sont pas données, car  leur volume est trop important pour les employés de K + et vous devez accéder aux liens système, et deuxièmement, vous ne pouvez pas simplement prendre et copier ces deux colonnes en les collant dans un tableau Excel ou Word standard. <br><br>  Peut-être que cela a été fait intentionnellement pour que les utilisateurs travaillent plus activement avec le système, y compris pour ne rien transférer de là. <br><br>  Il faut bien le réparer. <br><br>  <b>La tâche</b> : répartir le texte en deux colonnes, là où c'est possible et où non - supprimez simplement la norme et mettez tout cela dans une feuille de calcul Excel.  Dans le même temps, voyons comment vous pouvez changer la police, l'alignement et d'autres bagatelles dans le texte en utilisant python. <br><br>  Pour un exemple qui nourrit notre futur programme, nous reprenons de K + les modifications de la loi "Sur JSC".  Cette loi est souvent modifiée, il y aura donc du travail à faire. <br><br>  Enregistrez les modifications dans un fichier txt normal (par exemple, l'édition de .txt).  Vous obtenez quelque chose comme ceci: <br><br><img src="https://habrastorage.org/webt/0o/xw/-t/0oxw-tin_znk0m2atwnmuazx9na.jpeg"><br><br>  Ainsi, il est clair que chaque modification est séparée de l'autre par une ligne continue, qui après enregistrement a pris la forme de nombreux «???».  Il y a aussi une rubrique de changement à prendre en compte.  Tout a l'air simple sauf pour certains points. <br><br>  Alors, rencontrez des changements qui ont la forme suivante: <br><br><img src="https://habrastorage.org/webt/ph/qe/iy/phqeiyzh_jqmllcnr-a54xe8sq8.jpeg"><br><br>  De plus, la question est aggravée par le fait que les changements individuels diffèrent considérablement en longueur. <br><br><h3>  Nous passons à K +. </h3><br>  Créez un nouveau fichier consult.py et ajoutez-y les premières lignes: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> __future__ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> unicode_literals <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> codecs <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> openpyxl</code> </pre> <br>  Le module openpyxl est déjà familier, il vous permet de travailler avec Excel, mais les deux autres sont nouveaux.  Leur fonction est de traiter correctement les caractères russes, qui sont souvent mal lus par les programmes. <br><br>  À l'avance, créez un nouveau fichier Excel vide en dehors du programme, en le nommant par exemple revision2.xlsx.  Nous allons ouvrir ce fichier avec notre programme et y écrire les données.  Ce sera notre dossier final. <br>  Ainsi, le programme ouvre le fichier Excel, le saisit: <br><br><pre> <code class="python hljs">wb = openpyxl.load_workbook(<span class="hljs-string"><span class="hljs-string">'2.xlsx'</span></span>) sheet=wb.get_active_sheet() x=<span class="hljs-number"><span class="hljs-number">1</span></span> y=<span class="hljs-number"><span class="hljs-number">0</span></span> test=[] test2=[] test3=[]</code> </pre> <br>  Aussi ci-dessus, nous créons 3 listes vides où nous collecterons des données: test, test2, test3. <br><br>  Ensuite, dans la variable «a», nous mettrons tout ce qui peut se présenter sous la forme du nom du changement.  En y - il y aura une ligne de division.  C'est la même longueur: <br><br><pre> <code class="python hljs">a=(<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>) y=<span class="hljs-string"><span class="hljs-string">'?????????????????????????????????????????????????????????????????????????'</span></span></code> </pre> <br>  Maintenant, la partie amusante. <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open (<span class="hljs-string"><span class="hljs-string">'.txt'</span></span>,encoding=<span class="hljs-string"><span class="hljs-string">'cp1251'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: lines = (line.strip() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> f) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> lines: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> line.startswith(<span class="hljs-string"><span class="hljs-string">''</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> col1=line[:<span class="hljs-number"><span class="hljs-number">35</span></span>] col2=line[<span class="hljs-number"><span class="hljs-number">39</span></span>:] col3=line[<span class="hljs-number"><span class="hljs-number">35</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> line.startswith(a): sheet.cell(row=x, column=<span class="hljs-number"><span class="hljs-number">1</span></span>).value=line <span class="hljs-comment"><span class="hljs-comment">#   ,  .. sheet.cell(row=x, column=1).font=ft2 #sheet.cell(row=x, column=1).style='20 % - Accent3' x+=1 #  x+=2 elif line==None: continuewith open ('.txt',encoding='cp1251') as f: lines = (line.strip() for line in f) for line in lines: if line.startswith(''): continue col1=line[:35] col2=line[39:] col3=line[35:39] if line.startswith(a): sheet.cell(row=x, column=1).value=line #   ,  .. x+=1 #  x+=2 elif line==None: continue</span></span></code> </pre> <br>  Nous avons ouvert le fichier .txt encodé cp1251.  Chaque ligne a été débarrassée des espaces de la fin et du début par la méthode de la bande. <br><br>  Si la ligne commence par le mot «ancien», nous la sautons.  Pourquoi devons-nous conserver «l'ancien» et le «nouveau», cela est déjà clair.  Ensuite, nous divisons la ligne: du début à 35 caractères et de 39 caractères à la fin.  Autrement dit, nous éliminons l'écart au milieu: <br><br><img src="https://habrastorage.org/webt/lr/7c/rv/lr7crvthi0odk7_1sgw9n2ukvne.jpeg"><br><br>  Nous mettons le contenu de l'espace au milieu de la ligne en col3, car  il peut ne pas s'agir d'un espace si la modification est écrite sur une ligne d'affilée: <br><br><img src="https://habrastorage.org/webt/do/zc/bm/dozcbmndg7-epalwt553lwaorpi.jpeg"><br><br>  De plus, si la ligne commence par l'en-tête de modification (nous avons écrit ces en-têtes dans la variable a), nous écrivons immédiatement cette ligne pour exceller sans fractionnement et ajoutons la ligne - x + = 1 (ou x = x + 1). Lignes vides, que nous rencontrons, nous manquons. <br><br>  Considérez l'extrait de code suivant: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(col2)==<span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-comment"><span class="hljs-comment">#   1-     2- if line.startswith(a): continue test2.append(col1) #test3.append(col1) if col3==' ' and col2!=None: test.append(line[:35]) test2.append(line[39:]) if col3!=' ' and line!=y and len(line)&gt;60: #print(test3) test3.append(line) if line==y: #   ,   if test!=None: sheet.cell(row=x, column=1).value=(' '.join(test).strip('\?')) sheet.cell(row=x, column=1).font=ft sheet.cell(row=x, column=1).alignment=al sheet.cell(row=x, column=2).value=(' '.join(test2).strip('\?')) sheet.cell(row=x, column=2).font=ft sheet.cell(row=x, column=2).alignment=al test=[] test2=[] x+=1 if len(test3)&gt;0: #print(len(test3)) sheet.cell(row=x, column=2).value=(' '.join(test3).strip('\?')) sheet.cell(row=x, column=2).font=ft sheet.cell(row=x, column=2).alignment=al test3=[] x+=1 else: continue</span></span></code> </pre> <br>  Si la longueur de 2 parties de la chaîne est 0, c'est-à-dire qu'elle n'existe pas, alors test2 obtient la première partie de la chaîne.  S'il y a un espace dans la ligne, mais que la deuxième partie de la ligne est absente, alors la première et la deuxième partie de la ligne, respectivement, tombent dans test et test2. <br><br>  S'il y a un espace dans la ligne et que la ligne n'est pas vide et que sa longueur est supérieure à 60 caractères, elle est ajoutée à test3. <br><br>  Si la ligne est vide, c'est-à-dire que nous avons effectué tout le changement, nous écrivons tout ce que nous avons collecté dans les cellules Excel, vérifiant simultanément le vide dans le test (afin qu'il ne soit pas vide) et la durée du test3. <br><br>  Enfin, enregistrez le fichier Excel: <br><br><pre> <code class="python hljs">wb.save(<span class="hljs-string"><span class="hljs-string">'2.xlsx'</span></span>)</code> </pre> <br><h3>  Styles, police et alignement du texte en python </h3><br>  Ajoutez de la beauté à notre table. <br><br>  En particulier, nous allons faire en sorte que lors de la sortie des données, les en-têtes de changement soient mis en évidence en gras, et le texte lui-même soit plus petit et formaté pour une lecture facile. <br>  Python vous permet de le faire.  Pour ce faire, nous devons ajouter et modifier le code aux endroits où nous enregistrons les résultats dans un fichier Excel: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> openpyxl.styles <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Font, Color,NamedStyle, Alignment</code> </pre> <br><pre> <code class="python hljs">al= Alignment(horizontal=<span class="hljs-string"><span class="hljs-string">"justify"</span></span>, vertical=<span class="hljs-string"><span class="hljs-string">"top"</span></span>) ft = Font(name=<span class="hljs-string"><span class="hljs-string">'Calibri'</span></span>, size=<span class="hljs-number"><span class="hljs-number">9</span></span>) ft2 = Font(name=<span class="hljs-string"><span class="hljs-string">'Calibri'</span></span>, size=<span class="hljs-number"><span class="hljs-number">9</span></span>,bold=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> line.startswith(a): sheet.cell(row=x, column=<span class="hljs-number"><span class="hljs-number">1</span></span>).value=line <span class="hljs-comment"><span class="hljs-comment">#   ,  .. sheet.cell(row=x, column=1).font=ft2</span></span></code> </pre> <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> line==y: <span class="hljs-comment"><span class="hljs-comment">#   ,   if test!=None: sheet.cell(row=x, column=1).value=(' '.join(test).strip('\?')) sheet.cell(row=x, column=1).font=ft sheet.cell(row=x, column=1).alignment=al sheet.cell(row=x, column=2).value=(' '.join(test2).strip('\?')) sheet.cell(row=x, column=2).font=ft sheet.cell(row=x, column=2).alignment=al</span></span></code> </pre> <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(test3)&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-comment"><span class="hljs-comment">#print(len(test3)) sheet.cell(row=x, column=2).value=(' '.join(test3).strip('\?')) sheet.cell(row=x, column=2).font=ft sheet.cell(row=x, column=2).alignment=al</span></span></code> </pre> <br>  En fait, nous n'avons ajouté que les méthodes applicables .font et .alignment. <br><br>  L'ensemble du programme a pris la forme: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> __future__ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> unicode_literals <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> codecs <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> openpyxl <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> openpyxl.styles <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Font, Color,NamedStyle, Alignment <span class="hljs-string"><span class="hljs-string">""" 1.  Consultant+   ,    .txt  ?????????????????????????????????????????????????????????????????????????   15  1  48     15)    15)     excel    .  word      - txt  : .txt  : 2.xlsx """</span></span> <span class="hljs-comment"><span class="hljs-comment">#file = open ( '2.txt', 'w',encoding='cp1251', newline = '\n') wb = openpyxl.load_workbook('2.xlsx') sheet=wb.get_active_sheet() x=1 y=0 test=[] test2=[] test3=[] a=('','','','','','','') y='?????????????????????????????????????????????????????????????????????????' #  #al= Alignment(horizontal="distributed", vertical="top") al= Alignment(horizontal="justify", vertical="top") ft = Font(name='Calibri', size=9) ft2 = Font(name='Calibri', size=9,bold=True) with open ('.txt',encoding='cp1251') as f: lines = (line.strip() for line in f) for line in lines: if line.startswith(''): continue col1=line[:35] col2=line[39:] col3=line[35:39] if line.startswith(a): sheet.cell(row=x, column=1).value=line #   ,  .. sheet.cell(row=x, column=1).font=ft2 #sheet.cell(row=x, column=1).style='20 % - Accent3' x+=1 #  x+=2 elif line==None: continue #print (line) #print (len(col2)) if len(col2)==0: #   1-     2- if line.startswith(a): continue test2.append(col1) #test3.append(col1) if col3==' ' and col2!=None: test.append(line[:35]) test2.append(line[39:]) if col3!=' ' and line!=y and len(line)&gt;60: #print(test3) test3.append(line) if line==y: #   ,   if test!=None: sheet.cell(row=x, column=1).value=(' '.join(test).strip('\?')) sheet.cell(row=x, column=1).font=ft sheet.cell(row=x, column=1).alignment=al sheet.cell(row=x, column=2).value=(' '.join(test2).strip('\?')) sheet.cell(row=x, column=2).font=ft sheet.cell(row=x, column=2).alignment=al test=[] test2=[] x+=1 if len(test3)&gt;0: #print(len(test3)) sheet.cell(row=x, column=2).value=(' '.join(test3).strip('\?')) sheet.cell(row=x, column=2).font=ft sheet.cell(row=x, column=2).alignment=al test3=[] x+=1 else: continue wb.save('2.xlsx')</span></span></code> </pre> <br></div></div><br>  Donc, à la fin, après avoir traité le fichier par le programme, nous avons un tableau assez décent avec des changements dans la loi: <br><br><img src="https://habrastorage.org/webt/oz/rf/hs/ozrfhsdae84_btpv9ma1ukceirk.jpeg"><br><br>  Le programme peut être téléchargé à partir du lien - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br>  Un exemple de fichier pour le traitement par le programme est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr465229/">https://habr.com/ru/post/fr465229/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr465215/index.html">Que lire chef d'équipe et station-service: une sélection de 50 livres avec notes et plus</a></li>
<li><a href="../fr465217/index.html">Acronis True Image 2020: nouveaux schémas de réplication et protection améliorée</a></li>
<li><a href="../fr465221/index.html">À quoi pourraient ressembler les registres dans 1C en présence de POO</a></li>
<li><a href="../fr465223/index.html">Comment faire un usage pratique de la sécurité du papier, ou pourquoi avons-nous besoin de la conformité avec 152-ФЗ et PCI DSS dans un nuage</a></li>
<li><a href="../fr465227/index.html">Réalité augmentée dans le commerce en ligne</a></li>
<li><a href="../fr465237/index.html">Conversion de maillage polygonal en solide B-Rep: détails de l'algorithme et exemples de code C ++</a></li>
<li><a href="../fr465239/index.html">Venez chercher des livres en anglais</a></li>
<li><a href="../fr465241/index.html">Mon septième jour avec Haiku: référencement, numérisation, réseau</a></li>
<li><a href="../fr465245/index.html">Voir l'interface «à travers les yeux du designer»: sur l'interaction du front-end avec le designer</a></li>
<li><a href="../fr465247/index.html">Angulaire Comprendre @Input, @Output et EventEmitter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>