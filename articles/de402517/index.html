<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üç≤ üßòüèΩ üëÇüèº Der Winstar-Grafik- und Textmodus wird angezeigt üêµ üëö ‚¨ÜÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Grafikdisplays, einschlie√ülich solcher vom Typ OLED, die auf unserem Markt am h√§ufigsten von Winstar vertreten werden, haben eine viel geringere Nachf...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Der Winstar-Grafik- und Textmodus wird angezeigt</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/402517/"> Grafikdisplays, einschlie√ülich solcher vom Typ OLED, die auf unserem Markt am h√§ufigsten von Winstar vertreten werden, haben eine viel geringere Nachfrage im Vergleich zu Kleinbuchstaben, und Ver√∂ffentlichungen √ºber ihre Verwendung sind ebenfalls viel geringer.  Mittlerweile sind es grafische OLED-Displays, die aufgrund der fehlenden Bindung an Schriftarten eines vordefinierten Musters den besten Weg bieten, ergonomische Anzeigeger√§te f√ºr eine Vielzahl von Anforderungen zu erhalten.  Dar√ºber hinaus stellte sich heraus, dass der Grafikmodus im WS0010-Controller einfacher zu initiieren ist und stabiler arbeitet als der Textmodus. <br><br>  Bevor wir mit der Betrachtung der tats√§chlichen grafischen Anzeigen fortfahren, werden wir das immergr√ºne Problem mit den Problemen der Aktivierung des Textmodus des WS0010-Controllers betrachten, der eine unerwartete und offensichtliche L√∂sung erhalten hat (oh, wo waren meine Augen!). <br><a name="habracut"></a><br><h3>  Beheben von Problemen mit dem WS0010-Textmodus </h3><br>  Es ist bekannt, dass Winstar-Linienanzeigen w√§hrend der Initialisierung Stabilit√§tsprobleme aufweisen.  √úbrigens stellte sich heraus, dass dies nicht nur f√ºr die ‚Äûverdammten Chinesen‚Äú gilt: Die Muster von Newhaven Display 16x2, die ich mit gro√üer Schwierigkeit auf der anderen Seite der Welt erhalten habe, sind √§u√üerlich eine vollst√§ndige Kopie von Winstar, mit Ausnahme der Position einiger Inschriften und des Firmennamens auf dem Fleck ( die gleiche Form und Schriftart): <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/5c4/0e4/db8/5c40e4db8577cfcdacad5ecdf2652606.jpg" width="600" alt="Bild"><br><br>  Diese Anzeigen enthalten, wie in Datenbl√§ttern beschrieben, einen bestimmten "LCD-vergleichbaren" Controller. Sie verhalten sich v√∂llig identisch mit den chinesischen und haben die gleichen Nachteile.  Nat√ºrlich sollten Sie keine Zeit damit verbringen, andere Unternehmen wie Midas zu √ºberpr√ºfen: Nach dieser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ver√∂ffentlichung</a> k√∂nnte es nicht ohne internationale Zusammenarbeit auskommen.  Die globalisierte Wirtschaft herrscht! <br><br>  Die Schwierigkeiten des Textmodus √§u√üern sich darin, dass beim Starten (z. B. beim Neustart oder manuellen Zur√ºcksetzen des Programms der Steuerungssteuerung) M√ºll auf den Anzeigen erscheinen kann und die Zeilen 0 und 1 zuf√§llig die Stellen wechseln.  Die Experimente zeigten, dass es nicht von der Einschlussmethode abh√§ngt (8-Bit oder 4-Bit).  Dieses Problem ist besonders akut, wenn regelm√§√üige Neustarts der Software erforderlich sind, z. B. durch den Watchdog-Timer. <br><br>  Das Problem wird teilweise durch eine sorgf√§ltige Einstellung zur Stromversorgung (von einer separaten Quelle und keinesfalls von einem USB-Arduino) und einen separaten Neustart durch Aus- und Einschalten des Displays nach dem Starten des Steuerungsprogramms gel√∂st (siehe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vorherige Ver√∂ffentlichung</a> des Autors).  Wie sich herausstellte, war der Autor dieser Zeilen nicht der einzige, der eine √§hnliche L√∂sung f√ºr das Problem vorschlug: Der Autor des LuquidCrystal-Add- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ons</a> namens <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">WinstarOLED</a> enthielt auch einen speziellen pw_pin, mit dem die Anzeigeleistung zum Zeitpunkt des Programmstarts verzerrt ist. <br><br>  Aber das ist nat√ºrlich alles Initiative und halbe Sachen.  Jemand SeregaB ist auf einen radikalen Weg gesto√üen (siehe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">seine Ver√∂ffentlichung</a> auf easyelectronics.ru - danke an <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tomasina</a> f√ºr den Tipp).  Tats√§chlich stellte er eine ganz andere Aufgabe: zu lernen, wie man nur mit Grafik statt mit Text arbeitet.  Beim Versuch, zwischen den Modi zu wechseln, stellte er schnell fest, dass "das <i>Umschalten in den Grafikmodus normal und von Grafik zu" Text "- sehr ungeschickt</i> " war.  Dann erinnerte er sich daran, dass ‚Äû <i>ich vor langer Zeit, als DShs noch auf Papier gedruckt waren, in einigen DShs des HD44780 gelesen habe, dass das Umschalten der Modi nur bei ausgeschaltetem Bildschirm erfolgen sollte</i> .‚Äú  Und es hat funktioniert. <br><br>  Aus der zitierten Ver√∂ffentlichung werde ich hier einfach zwei Schaltvorg√§nge reproduzieren und sie f√ºr die Verwendung mit LuquidCrystal leicht anpassen (die Klasseninstanz hei√üt hier OLED1). <br><br>  In den Grafikmodus wechseln: <br><pre><code class="hljs cmake">OLED1.<span class="hljs-keyword"><span class="hljs-keyword">command</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>x08);//  OLED1.<span class="hljs-keyword"><span class="hljs-keyword">command</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>x1F);//   OLED1.<span class="hljs-keyword"><span class="hljs-keyword">command</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>x01);//    (..  clear()) OLED1.<span class="hljs-keyword"><span class="hljs-keyword">command</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>x08|<span class="hljs-number"><span class="hljs-number">0</span></span>x04);// </code> </pre> <br>  In den Textmodus wechseln: <br><pre> <code class="hljs cmake"> OLED1.<span class="hljs-keyword"><span class="hljs-keyword">command</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>x08);//  OLED1.<span class="hljs-keyword"><span class="hljs-keyword">command</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>x17);//    OLED1.<span class="hljs-keyword"><span class="hljs-keyword">command</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>x01);//    (..  clear()) OLED1.<span class="hljs-keyword"><span class="hljs-keyword">command</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>x04 | <span class="hljs-number"><span class="hljs-number">0</span></span>x08);// </code> </pre> <br>  Wie wir sp√§ter sehen werden, ist das erste Verfahren nicht wirklich erforderlich: Der WS0010 wechselt nach einem halben Tritt in den Grafikmodus. Senden Sie einfach den Befehl 0x1F an ihn.  Aber die zweite Folge von Befehlen war sehr wohl der Fall.  F√ºr das Beispiel wurde es mit LuquidCrystal in folgender Form direkt in die Skizze aufgenommen: <br><pre> <code class="hljs ruby">void reset_textmode() /<span class="hljs-regexp"><span class="hljs-regexp">/     { OLED1.command(0x08);/</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  OLED1.command(0x17);/</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    OLED1.command(0x01);/</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    OLED1.command(0x04 | 0x08);/</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  }</span></span></code> </pre> <br>  Diese Funktion wurde dann direkt nach dem Start der Bibliothek im Setup aufgerufen: <br><br><pre> <code class="hljs ruby"> . . . . . OLED1.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(<span class="hljs-number"><span class="hljs-number">16</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span><span class="hljs-number"><span class="hljs-number">16</span></span>  <span class="hljs-number"><span class="hljs-number">2</span></span>  reset_textmode(); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  clear() . . . . .</code> </pre> <br>  Wenn Sie zuvor eine Verz√∂gerung (500) einf√ºgen, wird die Demonstration sehr deutlich: Nach dem Dr√ºcken der Reset-Taste der Arduino-Karte wird normalerweise M√ºll auf dem Bildschirm angezeigt, jedoch nur f√ºr einen Moment: Nachdem die Funktion ausgel√∂st wurde, wird der Bildschirm gel√∂scht und alle Zeilen sind wieder vorhanden . <br><br>  Die Funktion funktioniert so, aber der Einfachheit halber habe ich den Inhalt der Funktion LiquidCrystalRus :: clear () in der Datei der aktualisierten Bibliothek LiquidCrystalRus_OLED.cpp ersetzt, die zuvor mit dieser Befehlsfolge erl√§utert wurde (ich erinnere Sie daran, dass <a href="">Sie sie</a> von der Website des Autors <a href="">herunterladen k√∂nnen</a> ).  Es wird nicht darauf gewartet, dass der Befehl in der Bibliothek ausgef√ºhrt wird. Aus Gr√ºnden der Zuverl√§ssigkeit werden daher nach jedem Befehl Verz√∂gerungen von 100 Œºs in den allgemeinen Stil der Bibliothek eingef√ºgt.  In Skizzen, die diese Variante von LiquidCrystalRus_OLED verwenden, muss zu Beginn des Setups die Funktion clear () aufgerufen werden, und gleichzeitig wird der Bildschirm gel√∂scht. <br><div class="spoiler">  <b class="spoiler_title">Hinweis</b> <div class="spoiler_text">  Es gibt ein Missverst√§ndnis im Zusammenhang mit der Bildschirmreinigung: Im Datenblatt der Befehlstabelle wird darauf hingewiesen, dass der Befehl 0x01 bis zu 6,2 ms dauern kann, ‚Äûwenn fsp oder fosc = 250 kHz‚Äú.  Welche Art von "fsp oder fosc" tats√§chlich in bestimmten Controllern vorhanden ist, sie waren zu faul zum Schreiben, aber auf jeden Fall sollte die Verz√∂gerung f√ºr diesen Befehl erheblich sein, selbst wenn es sich um Megahertz handelt (und der Autor von LiquidCrystal erw√§hnt dies).  In der Praxis stellt sich jedoch heraus, dass das Reinigungsteam f√ºr sich selbst arbeitet, wenn es √ºberhaupt keine Verz√∂gerung gibt.  Also habe ich nicht verstanden, sondern nach der bekannten Programmierregel gehandelt: "Es funktioniert - nicht anfassen!". <br></div></div><br>  Lassen Sie uns nun endlich den Grafikmodus behandeln. <br><br><h3>  Der Grafikmodus im Text zeigt WEH001602 an </h3><br>  Zun√§chst habe ich versucht, die Textanzeige von WEH001602BG in den Grafikmodus zu schalten.  Beachten Sie, dass die grafischen Anzeigen 100x16 und Text (20x2-Konfiguration, 16x2 haben nur weniger horizontale Punkte) identische Matrizen aufweisen. Nur Textanzeigen sind vertraute Intervalle.  Dies schr√§nkt die Verwendung des Grafikmodus in Textanzeigen und noch mehr des Textmodus in Grafiken stark ein.  Aber um zu testen, wie es funktioniert, k√∂nnen Sie jeden von ihnen verwenden. <br><br>  Das Display wurde zusammen mit dem DS1307 nach folgendem Schema mit dem Arduino Nano verbunden: <br><img src="https://habrastorage.org/getpro/geektimes/post_images/606/8e2/216/6068e2216b082857a72cd76f322628e3.png" width="600" alt="Bild"><br><br>  Nach dem gleichen Schema werden wir in Zukunft grafische Anzeigen anschlie√üen.  Die graue Farbe im Diagramm zeigt ggf. den Anschluss des zweiten Displays. <br><br>  Um in den grafischen Modus zu wechseln, k√∂nnen Sie das verbesserte Verfahren aus dem vorherigen Abschnitt verwenden. Eine einfache Funktion mit einem einzigen Befehl funktioniert jedoch: <br><pre> <code class="hljs cs">. . . . . <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LCD_SETGRAPHICMODE 0x1f LiquidCrystal lcd(9, 4, 8, 7, 6, 5); void setGraphicMode(){ lcd.command(LCD_SETGRAPHICMODE); } . . . . .</span></span></code> </pre> <br>  Wir brauchen hier keine russische Tabelle, daher wird der Standard-LiquidCrystal (nicht begradigt) verwendet, der im grafischen Modus einwandfrei funktioniert.  Um nicht mit dem Debuggen aller Bibliotheksoptionen herumzuspielen, verwende ich f√ºr den Fall, dass Text und grafische Anzeigen parallel enthalten sind, f√ºr jede meine eigene Bibliothek (f√ºr Text, der Rus_OLED aktualisiert hat, f√ºr grafische Normalen).  In diesem Fall kann mit Ausnahme der E-Ausgangspins gem√§√ü dem obigen Diagramm immer noch eine Verbindung zu denselben Controller-Beinen hergestellt werden. <br><br>  Au√üerdem habe ich teilweise die Leistungen des Autors der erw√§hnten WinstarOLED-Bibliothek genutzt (an sich ist dieses Add-On f√ºr LuquidCrystal meiner Meinung nach unvollst√§ndig und es ist nicht praktisch, es als zu verwenden).  Er f√ºhrte eine praktische Funktion zum Setzen des grafischen Cursors ein (der urspr√ºngliche Fehler bez√ºglich des maximalen <i>x-</i> Werts wurde hier behoben): <br><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setGraphicCursor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y )</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-number"><span class="hljs-number">0</span></span> &lt;= x &amp;&amp; x &lt;= <span class="hljs-number"><span class="hljs-number">99</span></span> ){ lcd.command(LCD_SETDDRAMADDR | x); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-number"><span class="hljs-number">0</span></span> &lt;= y &amp;&amp; y &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span> ){ lcd.command(LCD_SETCGRAMADDR | y); } }</code> </pre> <br>  Die Konstante LCD_SETDDRAMADDR ist in der LiquidCrystal-Bibliothek definiert.  Eine 100x16-Anzeige ist wie eine Textanzeige in zwei Zeilen unterteilt, 0 und 1, da <i>y hier</i> nur zwei Werte annehmen kann.  Die horizontale Koordinate <i>x</i> variiert zwischen 0 und 99. Mit dem Befehl lcd.write () wird ein Byte gesendet, dessen einzelne Bits die Lichtpositionen der vertikalen Linie mit einer L√§nge von 8 Punkten bestimmen.  Die Position ganz links in der oberen Zeile hat die Koordinaten 0,0, die Position ganz rechts in der unteren Zeile - 99,1.  Dar√ºber hinaus entspricht der niedrigste Punkt dem niedrigstwertigen Bit und der niedrigste Punkt dem h√∂chsten. <br><br>  Um das Codieren von Bildern zu vereinfachen, habe ich eine Platte gezeichnet, auf der Sie den gew√ºnschten Code schnell manuell erstellen k√∂nnen.  F√ºr vollst√§ndige Schriftarten-Tabellen ist es nat√ºrlich ratsam, spezielle Editoren zu verwenden (von denen es mindestens eine Million verschiedene Grade an Amateuraktivit√§t gibt), aber 10 Ziffern mit der gew√ºnschten Bitreihenfolge lassen sich schneller manuell verarbeiten, zumal automatisch erstellte Schriftarten h√§ufig noch von Hand fertiggestellt werden m√ºssen.  In √úbereinstimmung mit dem Obigen wird eine Glyphe, beispielsweise die Schriftart Nummer 2, Schrift 10x16, wie folgt codiert: <br><br><img src="http://revich.lib.ru/AVR/TableCod2.png" width="400" alt="Bild"><br><br>  All dies wird in ein zweidimensionales Array der Form geschrieben: <br><pre> <code class="hljs markdown">const byte Data2[<span class="hljs-string"><span class="hljs-string">2</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">10</span></span>]={{0x06,0x07,0x03,0x03,0x03,0x83,0xc3,0x63,0x3f,0x1e}, {0xf0,0xf8,0xcc,0xc6,0xc3,0xc1,0xc0,0xc0,0xc0,0xc0}};</code> </pre> <br>  F√ºr jede Ziffer 0-9 wird ein separates solches Array erstellt: Daten0, Daten1, Daten2 usw.  F√ºr Uhren ben√∂tigen Sie neben Zahlen auch einen doppelten Punkt.  Es kann k√ºrzer gemacht werden: <br><pre> <code class="hljs markdown">const byte DataDP[<span class="hljs-string"><span class="hljs-string">2</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">2</span></span>]={{0x70,0x70}, {0x1c,0x1c}};// </code> </pre> <br>  Da der Controller im Grafikmodus nicht wei√ü, wie er ‚Äûblinken‚Äú soll, muss der Doppelpunkt programmgesteuert blinken.  Sie k√∂nnen einen Doppelpunkt einfach l√∂schen, indem Sie Nullen an den entsprechenden Positionen anzeigen. Aus Gr√ºnden der Einheitlichkeit habe ich jedoch ein separates Array erstellt <br><pre> <code class="hljs markdown">const byte DataDPclr[<span class="hljs-string"><span class="hljs-string">2</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">2</span></span>]={{0x00,0x00}, {0x00,0x00}};// . </code> </pre> <br>  Um jede Ziffer und separat f√ºr einen Doppelpunkt anzuzeigen, wird eine separate Funktion geschrieben: <br><pre> <code class="hljs powershell">void draw2 (byte x/* */) // ‚Äú<span class="hljs-number"><span class="hljs-number">2</span></span>‚Äù { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (byte i = x; i&lt;x+<span class="hljs-number"><span class="hljs-number">10</span></span>; i++){ setGraphicCursor(i, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(<span class="hljs-keyword"><span class="hljs-keyword">Data</span></span>2[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-type"><span class="hljs-type">ix</span></span>]); setGraphicCursor(i, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(<span class="hljs-keyword"><span class="hljs-keyword">Data</span></span>2[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-type"><span class="hljs-type">ix</span></span>]);} }</code> </pre> <br>  Alle Funktionen sind gleich, verwenden jedoch unterschiedliche Arrays. F√ºr einen Doppelpunkt werden auch andere Grenzen der Schleife verwendet.  Es stellte sich heraus, dass die Codemenge nicht zu sparsam ist (dazu sp√§ter mehr), aber es ist klar und einfach, Fehler zu korrigieren.  Die L√ºcken zwischen den Zeichen werden in der Ausgangsstufe ber√ºcksichtigt und geben die entsprechende Position an (die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RTClib-Bibliothek</a> wird zum Lesen der Uhr verwendet): <br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { DateTime clock = RTC.now(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (clock.second()!=old_second) { uint8_t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>=clock.hour()/<span class="hljs-number"><span class="hljs-number">10</span></span>; //  drawValPos(<span class="hljs-keyword"><span class="hljs-keyword">values</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>=clock.hour()%<span class="hljs-number"><span class="hljs-number">10</span></span>; //  drawValPos(<span class="hljs-keyword"><span class="hljs-keyword">values</span></span>,<span class="hljs-number"><span class="hljs-number">12</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>=clock.minute()/<span class="hljs-number"><span class="hljs-number">10</span></span>; //  drawValPos(<span class="hljs-keyword"><span class="hljs-keyword">values</span></span>,<span class="hljs-number"><span class="hljs-number">28</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>=clock.minute()%<span class="hljs-number"><span class="hljs-number">10</span></span>; //<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>   drawValPos(<span class="hljs-keyword"><span class="hljs-keyword">values</span></span>,<span class="hljs-number"><span class="hljs-number">40</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (clock.second()%<span class="hljs-number"><span class="hljs-number">2</span></span>) drawDP(<span class="hljs-number"><span class="hljs-number">24</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> drawDPclr(<span class="hljs-number"><span class="hljs-number">24</span></span>); old_second=clock.second(); }//<span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> clocksecond }</code> </pre> <br>  Zehn Ziffern mit jeweils 20 Bytes belegen 200 Bytes im Speicher - etwa 10% des Volumens (und die breite Schrift ist 16 x 16, wie im folgenden Beispiel, und alle 16%).  Eine vollst√§ndige einsprachige Schrift dieser Gr√∂√üe zusammen mit Zahlen, ohne Ber√ºcksichtigung aller Arten von Satzzeichen und Sonderzeichen.  Zeichen, enth√§lt 62 (Englisch) bis 74 (Russisch ohne E) Zeichen, der Wert nimmt fast die H√§lfte des ATmega328 RAM ein.  Daher m√ºssen Tricks mit Arrays und Ausgabefunktionen f√ºr jedes Zeichen separat abgebrochen werden und wie erwartet ausgef√ºhrt werden.  Das hei√üt, die Schriftarten sollten im Programmspeicher belassen und √ºber PROGMEM heruntergeladen werden, und alle Glyphenmuster sollten als ein einziges Schriftartenarray angeordnet und zur Ausgabe nach Symbolnummer in eine einzige Tabelle geladen werden.  Andernfalls ist nicht gen√ºgend Speicher vorhanden und der Programmcode wird auf ein unkontrollierbares Volume aufgeblasen.  Hier werden wir nicht weiter darauf eingehen, da in unseren einfachen Beispielen all dies nicht erforderlich ist - jedes Mal werden wir auf eine kleine, unbedingt notwendige Anzahl von Zeichen beschr√§nkt sein. <br><br>  Aufgrund der Gr√∂√üe des Volltexts der GraphicOLED_DC1307-Skizze bringe ich sie nicht mit. Sie k√∂nnen sie <a href="">hier</a> herunterladen.  Die Funktion resetOLED wird im Text gespeichert, wodurch die Anzeigeleistung beim Neustart des Controllers (√ºber pwrPin D2) verzerrt wird. Sie wurde jedoch nie ben√∂tigt, sodass sie sicher entfernt werden kann.  Das Ergebnis des Programms ist auf dem Foto dargestellt: <br><br><img src="http://revich.lib.ru/AVR/WEH1602_clock.jpg" width="600" alt="Bild"><br><br>  Leider ist ein gleichzeitiger Aufenthalt im Text- und Grafikmodus ausgeschlossen. Wenn Sie also den verbleibenden Speicherplatz verwenden m√∂chten, m√ºssen Sie Ihre eigenen Schriftarten zeichnen (in jeder Zeile bleibt Platz f√ºr ca. 7 Zeichen mit 5 x 7 Schriftarten). <br><br><h3>  Grafikdisplay WEG010016A </h3><br>  Als schlie√ülich die bestellten Grafikdisplays WEG010016AL eintrafen, versuchte ich zun√§chst, sie in den Textmodus zu versetzen, um zu sehen, was daraus wurde. <br><br>  Um den Textmodus zu √ºberpr√ºfen, wurde ein Programm zur Simulation einer Kalenderuhranzeige mit einem externen Temperatursensor heruntergeladen, das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in einer fr√ºheren Ver√∂ffentlichung beschrieben</a> wurde.  Das Ergebnis hat mich daran erinnert, dass verschiedene Winstar-Anzeigen in Bezug auf den Anschluss unterschiedlich ausgerichtet sein k√∂nnen (in diesem Fall hat der WEG010016A oben einen Anschluss f√ºr den Text WEH001602B, den wir oben verwendet haben, unten und f√ºr Typ C an der Seite): <br><br><img src="http://revich.lib.ru/AVR/WEG10016_test.jpg" width="600" alt="Bild"><br><br>  Wir werden uns weiter mit der Ausrichtung des Displays befassen, aber jetzt werden wir sehen, was passiert ist.  Aber es hat sich als nicht gut herausgestellt: Der Textmodus (nat√ºrlich mit einer Kr√ºcke ausgestattet, der am Anfang des Artikels besprochen wurde) funktioniert einwandfrei, macht aber in der Praxis keinen Sinn, da zwischen den Zeichen keine Leerzeichen vorhanden sind.  Daher werden wir nicht weiter darauf eingehen, sondern mit der Betrachtung des Grafikmodus fortfahren. <br><br>  Die Installationsverfahren f√ºr den Grafikmodus selbst sind dieselben wie die oben f√ºr die Textversion beschriebenen.  Es bleibt zu behandeln, wenn das Display umgedreht ist, wenn es oben auf dem Bildschirm einen Anschluss hat.  Nat√ºrlich k√∂nnen Sie das Display einfach umdrehen, aber die Position mit dem Stecker nach unten erscheint mir nat√ºrlicher und bequemer.  Wenn Sie einen Typ mit einem seitlichen Anschluss verwenden, m√ºssen Sie den Anschluss m√∂glicherweise nach rechts und nicht nach links ausrichten.  F√ºr die verkehrte Ausrichtung ist es erforderlich, das Bild zu transformieren, dh die erste und letzte horizontale Position und Linie zu vertauschen und auch die Reihenfolge der Bits in Bytes umzukehren, aus denen das Array besteht (in diesem Fall entspricht das niedrigstwertige Bit dem unteren Punkt). <br><br>  Da ich f√ºr den vorherigen Fall bereits zehn Ziffern gemalt hatte, blieb es f√ºr die letzte Aufgabe, das Programmumkehrverfahren einzuf√ºhren: <br><pre> <code class="hljs matlab">byte reverse(byte x) { byte result=<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>;<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>&lt;<span class="hljs-number"><span class="hljs-number">8</span></span>;<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &amp; (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>)) { result |= <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; (<span class="hljs-number"><span class="hljs-number">7</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br>  Sie k√∂nnen die Reihenfolge der horizontalen Koordinaten und vertikalen Linien √§ndern, indem Sie √Ñnderungen an der Funktion setGraphicCursor vornehmen: <br><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setGraphicCursor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y )</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-number"><span class="hljs-number">0</span></span> &lt;= x &amp;&amp; x &lt;= <span class="hljs-number"><span class="hljs-number">99</span></span> ){ lcd.command(LCD_SETDDRAMADDR | (<span class="hljs-number"><span class="hljs-number">99</span></span>-x)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-number"><span class="hljs-number">0</span></span> &lt;= y &amp;&amp; y &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span> ){ lcd.command(LCD_SETCGRAMADDR | (<span class="hljs-number"><span class="hljs-number">1</span></span>-y)); } }</code> </pre> <br>  Die Ausgabefunktionen des Arrays jeder Ziffer bleiben gleich, es wird nur die Bitumkehr hinzugef√ºgt: <br><pre> <code class="hljs powershell">void draw2 (byte x/* */) // <span class="hljs-number"><span class="hljs-number">2</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (byte i = x; i&lt;x+<span class="hljs-number"><span class="hljs-number">10</span></span>; i++){ setGraphicCursor(i, <span class="hljs-number"><span class="hljs-number">0</span></span>); byte b=reverse(<span class="hljs-keyword"><span class="hljs-keyword">Data</span></span>2[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-type"><span class="hljs-type">ix</span></span>]); lcd.write(b); setGraphicCursor(i, <span class="hljs-number"><span class="hljs-number">1</span></span>); b=reverse(<span class="hljs-keyword"><span class="hljs-keyword">Data</span></span>2[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-type"><span class="hljs-type">ix</span></span>]); lcd.write(b);} }</code> </pre> <br>  Die vollst√§ndige Skizze der Ausgabe der Uhr GraphicOLED_DC1307_100x16 kann hier heruntergeladen <a href="">werden</a> . Das Ergebnis f√ºr die Anzeige WEG010016AL ist auf dem Foto dargestellt: <br><br><img src="http://revich.lib.ru/AVR/WEG10016_clock.jpg" width="600" alt="Bild"><br><br>  Aber auf diesem Foto eine andere Schriftart (16 x 16) auf dem WEG010016CG-Display (das Display steht ebenfalls auf dem Kopf): <br><br><img src="http://revich.lib.ru/AVR/WEG10016CG_clock.jpg" width="600" alt="Bild"><br><br>  Wenn Sie die Schriftart neu erstellen, indem Sie die Reihenfolge der Bits manuell √§ndern, m√ºssen Sie nicht umgekehrt vorgehen, und das Programm wird schneller ausgef√ºhrt (obwohl es keine merklichen Verz√∂gerungen im Auge gibt).  Das angegebene Bit-Flip-Verfahren ist jedoch in jedem Fall n√ºtzlich, um verschiedene Bilder anzuzeigen.  Beispielsweise k√∂nnen Sie von einem Pfeil nach oben und rechts programmgesteuert vier Richtungen gleichzeitig abrufen. <br><div class="spoiler">  <b class="spoiler_title">Pfeilzeichnung</b> <div class="spoiler_text">  Bild- und Pfeilcode (die Koordinaten und Bits in der Tabelle werden entsprechend der unteren Position des Anschlusses f√ºr die Anzeige WEG010016AL invertiert, siehe oben): <br><br><img src="http://revich.lib.ru/AVR/TableCodArray.png" alt="Bild"><br><pre> <code class="hljs markdown">const byte DataATR[<span class="hljs-string"><span class="hljs-string">2</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">8</span></span>]={{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, {0x01,0x02,0x04,0x28,0x30,0x78,0x60,0x80}};</code> </pre> <br>  Funktionen zur Ausgabe von multidirektionalen Pfeilen: <br><pre> <code class="hljs powershell">. . . . . void drawSW (byte x) //   (  ) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (byte i = x; i&lt;x+<span class="hljs-number"><span class="hljs-number">8</span></span>; i++){ setGraphicCursor(i, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(DataATR[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-type"><span class="hljs-type">ix</span></span>]); setGraphicCursor(i, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(DataATR[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-type"><span class="hljs-type">ix</span></span>]);} } void drawNW (byte x) //   (  ) {//   : <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (byte i = x; i&lt;x+<span class="hljs-number"><span class="hljs-number">8</span></span>; i++){ setGraphicCursor(i, <span class="hljs-number"><span class="hljs-number">0</span></span>); byte b=reverse(DataATR[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-type"><span class="hljs-type">ix</span></span>]); lcd.write(b); setGraphicCursor(i, <span class="hljs-number"><span class="hljs-number">1</span></span>); b=reverse(DataATR[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-type"><span class="hljs-type">ix</span></span>]); lcd.write(b);} } void drawNE (byte x) //   (  ) {//  ,    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (byte i = x; i&lt;x+<span class="hljs-number"><span class="hljs-number">8</span></span>; i++){ setGraphicCursor(i, <span class="hljs-number"><span class="hljs-number">0</span></span>); byte b=reverse(DataATR[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">7</span></span>-(<span class="hljs-type"><span class="hljs-type">ix</span></span>)]); lcd.write(b); setGraphicCursor(i, <span class="hljs-number"><span class="hljs-number">1</span></span>); b=reverse(DataATR[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">7</span></span>-(<span class="hljs-type"><span class="hljs-type">ix</span></span>)]); lcd.write(b);} } void drawSE (byte x) //   (  ) {//   <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (byte i = x; i&lt;x+<span class="hljs-number"><span class="hljs-number">8</span></span>; i++){ setGraphicCursor(i, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.write(DataATR[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">7</span></span>-(<span class="hljs-type"><span class="hljs-type">ix</span></span>)]); setGraphicCursor(i, <span class="hljs-number"><span class="hljs-number">1</span></span>); lcd.write(DataATR[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">7</span></span>-(<span class="hljs-type"><span class="hljs-type">ix</span></span>)]);} } . . . . .</code> </pre> </div></div><br>  Das Foto unten zeigt das Ergebnis eines leeren Programms zur Anzeige des Geschwindigkeits- und Windrichtungssensors.  Wie Sie sehen, hat es sich als sehr einfach herausgestellt, Schriftarten unterschiedlicher Gr√∂√üe zusammen mit Bildern in einer Zeile zu implementieren: <br><br><img src="http://revich.lib.ru/AVR/WEG10016_wind.jpg" width="600" alt="Bild"><br><br>  Abschlie√üend m√∂chte ich hinzuf√ºgen, dass <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> eine sehr interessante Bibliothek f√ºr die Arbeit mit WS0010 im grafischen und textuellen Modus mit SPI ist.  Im Text werden haupts√§chlich Fl√ºssigkristalle kopiert (und woran k√∂nnen Sie noch denken?). In der Grafik werden grafische Grundelemente, integrierte Schriftarten (dick wie meine und die √ºblichen 5 x 7) und vieles mehr gezeichnet. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de402517/">https://habr.com/ru/post/de402517/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de402505/index.html">Augmented Reality wurde in der amerikanischen Industrie massiv angewendet.</a></li>
<li><a href="../de402507/index.html">Pers√∂nliche Verm√∂gensverwaltung als grundlegendes Menschenrecht</a></li>
<li><a href="../de402509/index.html">Satellitennavigation deaktiviert das Routing</a></li>
<li><a href="../de402511/index.html">Wie das Leben geboren wurde</a></li>
<li><a href="../de402515/index.html">Braun Oral-B Genius 9000: Wenn der Pinsel √ºber ein Smartphone Tipps gibt</a></li>
<li><a href="../de402521/index.html">Infrarot-WLAN ist 17-mal schneller als normal, jedoch in eine Richtung</a></li>
<li><a href="../de402523/index.html">"D√ºnne Welt." Kapitel 9</a></li>
<li><a href="../de402525/index.html">Warum OneDrive unter Linux langsamer wurde</a></li>
<li><a href="../de402527/index.html">Vier bis zweiunddrei√üig</a></li>
<li><a href="../de402529/index.html">Warum ist es mit einem Cardio-T-Shirt besser als ohne: ein paar Worte zu schicker Kleidung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>