<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüë¶ üéõÔ∏è üëû Comment rouler ML en prod: six r√¢teaux sur lesquels nous avons march√© üôåüèº üíù ü¶ã</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Plus r√©cemment, nous avons recherch√© un scientifique des donn√©es dans l'√©quipe (et trouv√© - bonjour, nik_son et Arseny!). En discutant avec les candid...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment rouler ML en prod: six r√¢teaux sur lesquels nous avons march√©</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/hh/blog/415437/">  Plus r√©cemment, nous avons recherch√© un scientifique des donn√©es dans l'√©quipe (et trouv√© - bonjour, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">nik_son</a> et Arseny!).  En discutant avec les candidats, nous avons r√©alis√© que beaucoup de gens veulent changer d'emploi parce qu'ils font quelque chose ¬´autour de la table¬ª. <br><br>  Par exemple, ils assument les pr√©visions complexes propos√©es par le chef, mais le projet s'arr√™te parce que l'entreprise ne comprend pas quoi et comment inclure dans la production, comment r√©aliser un profit, comment ¬´r√©cup√©rer¬ª les ressources d√©pens√©es sur le nouveau mod√®le. <br><br><img src="https://habrastorage.org/webt/ok/et/et/oketet2tebg0tlbjkbrqimzn92g.jpeg"><br><br>  HeadHunter n'a pas une grande puissance de calcul, comme Yandex ou Google.  Nous comprenons combien il est difficile de mettre en production un ML complexe.  Par cons√©quent, de nombreuses entreprises s'attardent sur le fait que les mod√®les lin√©aires les plus simples sont mis en production. <br><br>  Au cours de la prochaine mise en ≈ìuvre du BC dans le syst√®me de recommandation et dans la recherche de postes vacants, nous avons rencontr√© un certain nombre de "r√¢teaux" classiques.  Faites attention √† eux si vous avez l'intention de mettre en ≈ìuvre le ML √† la maison: peut-√™tre que cette liste vous aidera √† ne pas y aller <s>et √† trouver votre propre r√¢teau personnel</s> . <br><a name="habracut"></a><br><h2>  Rake n ¬∞ 1: Data Scientist - Artiste libre </h2><br>  Dans chaque entreprise qui commence √† introduire l'apprentissage automatique, y compris les r√©seaux de neurones dans son travail, il y a un √©cart entre ce que le data scientist veut faire et ce qui profite √† la production.  Y compris parce que l'entreprise ne peut pas toujours expliquer ce qu'est un avantage et comment il peut aider. <br><br>  Nous traitons cela de la mani√®re suivante: nous discutons de toutes les id√©es √©mergentes, mais ne mettons en ≈ìuvre que ce qui b√©n√©ficiera √† l'entreprise - maintenant ou √† l'avenir.  Nous ne faisons pas de recherche en vase clos. <br><br>  Apr√®s chaque mise en ≈ìuvre ou exp√©rience, nous consid√©rons la qualit√©, les ressources et les effets √©conomiques et mettons √† jour nos plans. <br><br><h2>  Rake num√©ro 2: mise √† jour des biblioth√®ques </h2><br>  Ce probl√®me se produit dans plusieurs.  De nombreuses biblioth√®ques nouvelles et pratiques apparaissent dont personne n'avait entendu parler il y a quelques ann√©es, ou pas du tout.  Je voudrais utiliser les derni√®res biblioth√®ques, car elles sont plus pratiques. <br><br>  Mais il y a plusieurs obstacles: <br><br>  1. Si le prod utilise, par exemple, le 14e Ubuntu, alors il n'y a probablement pas de nouvelles biblioth√®ques.  La solution consiste √† transf√©rer le service vers docker et √† installer les biblioth√®ques Python √† l'aide de pip (au lieu des packages deb). <br><br>  2. Si un format d√©pendant du code est utilis√© pour le stockage de donn√©es (tel que le pickle), cela fige les biblioth√®ques utilis√©es.  Autrement dit, lorsque le mod√®le d'apprentissage automatique a √©t√© obtenu √† l'aide de la biblioth√®que scikit-learn version 15 et enregistr√© au format pickle, alors pour la r√©cup√©ration correcte du mod√®le, la biblioth√®que scikit-learn √† quinze versions sera n√©cessaire.  Vous ne pouvez pas passer √† la derni√®re version, et c'est un pi√®ge beaucoup plus insidieux que celui d√©crit au paragraphe 1. <br><br>  Il y a deux fa√ßons de s'en sortir: <br><br><ul><li>  Utiliser un format ind√©pendant du code pour stocker des mod√®les </li><li>  √™tre toujours en mesure de recycler n'importe quel mod√®le.  Ensuite, lors de la mise √† jour de la biblioth√®que, il sera n√©cessaire de former tous les mod√®les et de les enregistrer avec la nouvelle version de la biblioth√®que. </li></ul><br>  Nous avons choisi la deuxi√®me voie. <br><br><h2>  R√¢teau num√©ro 3: travailler avec d'anciens mod√®les </h2><br>  Faire quelque chose de nouveau dans un ancien mod√®le appris est moins utile que faire quelque chose de simple dans un nouveau.  Souvent, au final, il s'av√®re que l'introduction de mod√®les plus simples mais plus r√©cents est plus utile et la quantit√© d'effort est moindre.  Il est important de s'en souvenir et de toujours tenir compte de la quantit√© d'efforts communs dans la recherche de mod√®les. <br><br><h2>  R√¢teau num√©ro 4: uniquement des exp√©riences locales </h2><br>  De nombreux experts en science des donn√©es aiment exp√©rimenter localement sur leurs serveurs de machine learning.  Seuls les producteurs n'ont pas une telle flexibilit√©: en cons√©quence, un tas de raisons sont r√©v√©l√©es pour lesquelles il est impossible de faire glisser ces exp√©riences en production. <br><br>  Il est important de configurer la communication entre le sp√©cialiste DS et les ing√©nieurs commerciaux pour une compr√©hension commune - comment tel ou tel mod√®le fonctionnera en production, s'il y a la puissance et la capacit√© physique n√©cessaires pour le d√©ployer.  De plus, plus les mod√®les et les facteurs sont complexes, plus il est difficile de les rendre fiables et de pouvoir les r√©entra√Æner √† tout moment.  Contrairement aux comp√©titions Kaggle, en production, il est souvent pr√©f√©rable de sacrifier les dix milli√®mes sur les m√©triques locales et m√™me un petit KPI en ligne, mais mettre en ≈ìuvre la version des mod√®les est beaucoup plus simple, stable dans les r√©sultats et facile dans les ressources informatiques. <br><br>  Copropri√©t√© du code (les d√©veloppeurs et les scientifiques des donn√©es savent comment fonctionne le code √©crit par d'autres d√©veloppeurs), r√©utilisation des signes et des m√©ta-attributs dans divers mod√®les √† la fois dans le processus d'apprentissage et dans le travail en prod (nous sommes aid√©s par us framework), unit- et autotests, que nous pilotons tr√®s souvent, int√©gration de code avec retest.  Nous mettons les mod√®les finaux dans les r√©f√©rentiels git et les utilisons √©galement en production. <br><br><h2>  R√¢teau num√©ro 5: test uniquement prod </h2><br>  Chacun de nos d√©veloppeurs et scientifiques des donn√©es a son propre banc de test, parfois pas un.  Les principaux composants de la production HH y sont d√©ploy√©s.  C'est cher, mais √ßa paie pour la qualit√© et la rapidit√© de d√©veloppement.  C'est n√©cessaire, mais pas suffisant.  Nous chargeons non seulement les mod√®les qui sont d√©j√† en production, mais aussi ceux qui seront bient√¥t l√†.  Cela permet de comprendre avec le temps que les mod√®les qui fonctionnent parfaitement sur les machines locales, les bancs d'essai ou en production pour 5% des utilisateurs, et lorsqu'ils sont allum√©s √† 100%, sont trop lourds. <br><br>  Nous utilisons plusieurs √©tapes de test.  Nous v√©rifions le code tr√®s rapidement (c'est le point cl√©) - lors de l'ajout ou de la modification de composants dans le r√©f√©rentiel, le code est collect√©, les tests unitaires et automatiques sont ex√©cut√©s sur les composants correspondants, si n√©cessaire, nous les testons √©galement manuellement - et si quelque chose ne va pas, donnez une r√©ponse "Le tien est cass√©, d√©cide." <br><br><h2>  R√¢teau num√©ro 6: longs calculs et perte de concentration </h2><br>  Si un mod√®le n√©cessite, disons, une semaine de formation, il est facile de perdre sa concentration sur la t√¢che en raison du passage √† un autre projet.  Nous essayons de ne pas donner aux d√©veloppeurs et aux scientifiques des donn√©es plus de deux t√¢ches dans une main.  Et pas plus d'un urgent afin que vous puissiez y basculer d√®s que les calculs ou les exp√©riences A / B sont termin√©s pour lui.  Cette r√®gle est n√©cessaire pour ne pas perdre le focus, et par crainte que certaines de ces t√¢ches ne courent g√©n√©ralement le risque d'√™tre perdues, et une autre partie qui se d√©roule bien plus tard que n√©cessaire. <br><br><h2>  Nous avons march√© sur un r√¢teau mais n'avons pas abandonn√© </h2><br>  Nous avons r√©cemment termin√© une exp√©rience sur l'introduction de r√©seaux de neurones dans un syst√®me de recommandation.  Tout a commenc√© avec le fait qu'en deux jours, le hackathon interne a r√©dig√© un mod√®le de pr√©vision des r√©ponses par CV, ce qui a grandement facilit√© la recherche de postes vacants appropri√©s. <br><br>  Mais plus tard, nous avons appris: pour le mettre en production, vous devez mettre √† jour √† peu pr√®s tout - par exemple, transf√©rer le syst√®me √† double usage, qui consid√®re les signes et enseigne les mod√®les, √† Docker, ainsi que la mise √† jour des biblioth√®ques d'apprentissage automatique. <br><br><h3>  Comment c'√©tait </h3><br>  Nous avons utilis√© le mod√®le DSSM avec un r√©seau neuronal monocouche.  Dans l'article original de Microsoft, un r√©seau neuronal √† trois couches a √©t√© utilis√©, mais nous n'avons pas observ√© d'am√©lioration de la qualit√© avec une augmentation du nombre de couches, nous nous sommes donc install√©s sur une seule couche. <br><br><img src="https://habrastorage.org/webt/ti/au/qj/tiauqjuapnwvgews3dvymzhqir8.jpeg"><br><br>  En bref: <br><br><ol><li>  Le texte de la requ√™te et l'en-t√™te de la vacance sont convertis en deux vecteurs trigrammes de symboles.  Nous utilisons 20 000 trigrammes de caract√®res. </li><li>  Le vecteur trigramme est aliment√© √† l'entr√©e d'un r√©seau neuronal monocouche.  √Ä l'entr√©e de la couche de r√©seau neuronal, il y a 20 000 nombres, √† la sortie, 64. Essentiellement, le r√©seau neuronal est une matrice de 20 000 x 64 par laquelle le vecteur trigramme d'entr√©e de dimension 1 x 20 000 est multipli√©. Un vecteur constant de dimension 1 x 64 est ajout√© au r√©sultat de la multiplication. la sortie d'un tel r√©seau de neurones correspond √† la demande (ou au titre de la vacance). </li><li>  Le produit scalaire du vecteur dssm de requ√™te et du vecteur dssm d'en-t√™te de vacance est calcul√©.  La fonction sigmo√Øde est appliqu√©e au travail.  Le r√©sultat final est le m√©ta-signe dssm. </li></ol><br>  Lorsque nous avons essay√© d'inclure ce mod√®le pour la premi√®re fois, les mesures locales sont devenues meilleures, mais lorsque nous avons essay√© de l'int√©grer dans le test A / B, nous avons constat√© qu'il n'y avait aucune am√©lioration. <br><br>  Apr√®s cela, nous avons essay√© d'augmenter la deuxi√®me couche de neurones √† 256 - d√©ploy√©e par 5% des utilisateurs: il s'est av√©r√© que le syst√®me de recommandation et la recherche √©taient devenus meilleurs, mais lorsque vous avez allum√© le mod√®le √† 100%, il s'est av√©r√© soudain qu'il √©tait trop lourd. <br><br>  Nous avons analys√© pourquoi le mod√®le est si lourd, enlev√© la tige et exp√©riment√© √† nouveau ce r√©seau de neurones.  Et ce n'est qu'apr√®s cela, apr√®s avoir parcouru tout le chemin, qu'ils ont d√©couvert que le mod√®le est utile: le nombre de r√©ponses dans le syst√®me de recommandation a augment√© de 700 par jour, et dans la recherche, apr√®s tous les recomptages, de 4200. <br><br>  L'introduction d'un r√©seau neuronal aussi peu complexe permet √† nos clients d'embaucher plusieurs dizaines d'employ√©s suppl√©mentaires chaque jour via hh.ru, et pendant la mise en ≈ìuvre, nous avons vaincu une partie importante des gros probl√®mes.  Par cons√©quent, nous pr√©voyons de d√©velopper davantage nos r√©seaux de neurones.  Les plans sont d'essayer la racine g√©n√©rale, la lemmatisation suppl√©mentaire, de traiter les textes complets de la vacance et de reprendre, de faire des exp√©riences avec la topologie (couches cach√©es et, √©ventuellement, RNN / LSTM). <br><br>  La chose la plus importante que nous ayons faite avec ce mod√®le: <br><br><ul><li>  Ne laissez pas tomber l'exp√©rience au milieu. </li><li>  Nous avons calcul√© les indicateurs d'augmentation de la r√©ponse et avons constat√© que le travail sur ce mod√®le en valait la peine.  Il est tr√®s important de comprendre les avantages de chacune de ces impl√©mentations. </li></ul><br>  Fait int√©ressant, le mod√®le que nous avons fait et finalement ajout√© √† la prod est tr√®s similaire √† la m√©thode des composants principaux (PCA) appliqu√©e √† la matrice [texte de la requ√™te, titre du document, s'il y a eu un clic].  C'est-√†-dire, √† une matrice dans laquelle une ligne correspond √† une requ√™te unique, une colonne √† un en-t√™te vacant unique;  la valeur dans la cellule est 1 si apr√®s cette demande, l'utilisateur a cliqu√© sur un poste vacant avec cette rubrique, et 0 s'il n'y a pas eu de clic. <br><br>  Les r√©sultats de l'application de ce mod√®le aux demandes scala, java, C #, ¬´avocat¬ª, ¬´avocat¬ª sont pr√©sent√©s dans le tableau ci-dessous.  Semblable dans le sens, les paires de requ√™tes sont mises en √©vidence dans l'obscurit√©, contrairement √† la lumi√®re.  On peut voir que le mod√®le comprend la connexion entre diff√©rents langages de programmation, il y a une forte connexion entre la requ√™te ¬´avocat¬ª et ¬´avocat¬ª.  Mais entre "l'avocat" et tout langage de programmation, la connexion est tr√®s faible. <br><img src="https://habrastorage.org/webt/wi/xl/bq/wixlbqi7eg_kdq5zirst9grmi7u.png"><br>  √Ä un moment donn√©, je veux vraiment abandonner - les exp√©riences se poursuivent, mais elles ne ¬´s'enflamment¬ª pas.  √Ä ce stade, un data scientist peut trouver utile de soutenir l'√©quipe et de calculer √† nouveau les avantages: il peut √™tre utile ¬´d'enterrer l'h√¥tesse de l'air¬ª et de ne pas essayer de ¬´monter √† cheval¬ª, ce n'est pas un √©chec, mais une exp√©rience r√©ussie avec un r√©sultat n√©gatif.  Ou, apr√®s avoir pes√© le pour et le contre, vous effectuerez une autre exp√©rience qui ¬´tirera¬ª.  Cela nous est donc arriv√©. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr415437/">https://habr.com/ru/post/fr415437/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr415427/index.html">Toute la v√©rit√© sur RTOS de Colin Walls. Article # 4. T√¢ches, changement de contexte et interruptions</a></li>
<li><a href="../fr415429/index.html">Toute la v√©rit√© sur RTOS de Colin Walls. Article # 5. Interaction et synchronisation des t√¢ches</a></li>
<li><a href="../fr415431/index.html">Annonce du hackathon SmartMail Hack 2: Appel de donn√©es</a></li>
<li><a href="../fr415433/index.html">G√©rer les communiqu√©s sur le logement SIG et les services communaux - nous partageons notre exp√©rience et combattons avec intuition</a></li>
<li><a href="../fr415435/index.html">D√©veloppement de cartes d'interface sur Soil Xilinx Zynq 7000 pour l'enregistrement vocal au format analogique et num√©rique</a></li>
<li><a href="../fr415439/index.html">La communication d'entreprise vous oblige-t-elle √† quitter ou vous entra√Æne-t-elle dans un projet comme un jeu?</a></li>
<li><a href="../fr415441/index.html">Aux √âtats-Unis, les attaques de ransomwares contre les agences gouvernementales se multiplient</a></li>
<li><a href="../fr415443/index.html">MDG et ITMO University invitent √† l'√©cole d'√©t√© d'apprentissage automatique</a></li>
<li><a href="../fr415445/index.html">Le condens√© des √©v√©nements pour les professionnels des RH dans le domaine des TI pour juillet 2018</a></li>
<li><a href="../fr415447/index.html">La sortie du jeton utilitaire est une impasse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>