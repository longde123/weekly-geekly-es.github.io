<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👋🏿 ♻️ ⛹🏿 Führen Sie OpenVPN in Docker in 2 Sekunden aus 💜 📐 📨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habrowsk-Bürger! Haben Sie jemals eine Situation erlebt, in der Sie wirklich virtuell in eine andere Stadt, ein anderes Land oder einen anderen ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Führen Sie OpenVPN in Docker in 2 Sekunden aus</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458606/">  Hallo Habrowsk-Bürger!  Haben Sie jemals eine Situation erlebt, in der Sie wirklich virtuell in eine andere Stadt, ein anderes Land oder einen anderen Kontinent reisen möchten?  Ich habe ein solches Bedürfnis ziemlich oft, daher war die Möglichkeit, einen eigenen VPN-Server zu haben, der in wenigen Sekunden überall gestartet werden kann, ziemlich groß. In diesem Artikel möchte ich über mein Projekt sprechen, das ich geplant hatte, als ich nach einer vorgefertigten Lösung suchte, in diesem Fall Docker Ein Image, mit dem Sie den OpenVPN-Server mit einem Minimum an Einstellungen und einem akzeptablen Sicherheitsniveau schnell anheben können. <p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/118/940/919/11894091908f95b1d8f42980f553fa10.png"></div><p></p><br><a name="habracut"></a><h3>  Hintergrund </h3> Die Möglichkeit, den Dienst auf einem beliebigen Computer auszuführen: sei es ein physischer Server oder ein virtueller privater Server oder überhaupt der Containerraum in einem anderen Containerverwaltungssystem - war von entscheidender Bedeutung.  Mein Blick fiel sofort auf den Docker.  Erstens wird dieser Dienst immer beliebter, und daher bieten immer mehr Anbieter mit seiner Vorinstallation schlüsselfertige Lösungen an.  Zweitens gibt es ein zentrales Repository mit Bildern, von dem Sie den Dienst mit einem einzigen Befehl im Terminal herunterladen und starten können.  Die Idee, dass ein solches Projekt bereits existieren sollte, besuchte mich und ich suchte beharrlich.  Aber die meisten Projekte, die ich fand, waren entweder zu umständlich (es war notwendig, einen Container für die permanente Datenspeicherung zu erstellen und den Container mehrmals mit einer Anwendung mit unterschiedlichen Parametern auszuführen), entweder ohne vernünftige Dokumentation oder vollständig aufgegeben. Ich fand nichts Akzeptables und begann Arbeiten Sie an Ihrem Projekt.  Vor uns lagen schlaflose Nächte, in denen Dokumentation studiert, Code geschrieben und Fehler behoben wurden, aber am Ende sah mein Dienst das Licht und spielte in allen Farben des monochromen LED-Panels des Routers.  Also, bitte lieben und bevorzugen - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Docker-OpenVPN</a> .  Ich habe mir sogar ein Logo ausgedacht (oben vor dem Schnitt), aber beurteile es nicht streng, da ich (bereits) kein Designer bin. Bei der Implementierung dieses Projekts habe ich mich auf die Bereitstellungsgeschwindigkeit, ein Minimum an Einstellungen und ein akzeptables Sicherheitsniveau konzentriert.  Durch Versuch und Irrtum fand ich das optimale Gleichgewicht dieser Kriterien. An einigen Stellen musste ich jedoch die Bereitstellungsgeschwindigkeit für die Sicherheit opfern und die Portabilität für ein Minimum an Einstellungen bezahlen: In der aktuellen Konfiguration kann der auf einem Server erstellte Container nicht übertragen und auf einem anderen ausgeführt werden.  Beispielsweise werden alle Client- und Serverzertifikate beim Start des Dienstes generiert. Dies dauert ca. 2 Sekunden.  Die Generierung der Defi Hellman-Datei musste jedoch in der Erstellungszeit entfernt werden: Sie wird während der Erstellung des Docker-Images erstellt und kann bis zu 10 Minuten dauern.  Ich würde sehr gerne ein Sicherheitsaudit einer solchen Lösung von einer angesehenen Community erhalten. <h3>  Starten </h3>  Um den Dienst zu starten, benötigen wir einige Dinge: <ol><li>  Server: physisch oder virtuell.  Theoretisch können Sie im Docker-in-Docker-Modus ausgeführt werden, aber ich habe diese Option nicht ausführlich getestet. </li><li>  Eigentlich Docker.  Viele Hosting-Anbieter bieten vorgefertigte Lösungen mit Docker "on board" an. </li><li>  Die öffentliche IP-Adresse. </li></ol>  Wenn alle Details vorhanden sind, müssen wir den folgenden Befehl in der Konsole Ihres Servers ausführen: <pre><code class="bash hljs">docker run --<span class="hljs-built_in"><span class="hljs-built_in">cap</span></span>-add=NET_ADMIN \ -it -p 1194:1194/udp -p 80:8080/tcp \ -e HOST_ADDR=$(curl -s https://api.ipify.org) \ alekslitvinenk/openvpn</code> </pre>  Ein aufmerksamer Leser könnte darauf achten, dass die IP-Adresse des Servers automatisch über <i>ipify.org</i> ermittelt <i>wird</i> .  Wenn dies aus irgendeinem Grund nicht funktioniert, können Sie die Adresse manuell angeben. Wenn alle vorherigen Schritte korrekt ausgeführt wurden, sollte in der Konsole etwas Ähnliches angezeigt werden: <pre> <code class="bash hljs">Sun Jun 9 08:56:11 2019 Initialization Sequence Completed Sun Jun 9 08:56:12 2019 Client.ovpn file has been generated Sun Jun 9 08:56:12 2019 Config server started, download your client.ovpn config at http://example.com/ Sun Jun 9 08:56:12 2019 NOTE: After you download you client config, http server will be shut down!</code> </pre>  Wir sind dem Ziel nahe: Jetzt müssen wir <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">example.com</a></i> kopieren (in Ihrem Fall gibt es die Adresse Ihres Servers) und in die Adressleiste des Browsers einfügen.  Nachdem Sie die Eingabetaste gedrückt haben, wird die Datei client.ovpn heruntergeladen und der http-Server selbst gerät in Vergessenheit.  Wenn diese Lösung zweifelhaft ist, können Sie den folgenden Trick verwenden: Führen Sie den vorherigen Befehl aus und fügen Sie die <i>zp-</i> Flags und das Kennwort hinzu.  Wenn Sie nun den generierten Link in das Browserfenster einfügen, erhalten Sie ein Zip-Archiv mit einem Kennwort. Wenn Sie eine Datei mit Client-Konfiguration haben, können Sie jeden geeigneten Client verwenden.  Ich benutze Tunnelblick für Mac. <h3>  Video-Tutorial </h3>  Dieses Video-Tutorial enthält detaillierte Anweisungen zum Bereitstellen des Dienstes für DigitalOcean. <iframe width="560" height="315" src="https://www.youtube.com/embed/y5Dwakc6hMs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>  <b>PS</b> Wenn Sie dieses Projekt nützlich finden, geben Sie ihm bitte ein Sternchen auf dem GitHub, gabeln Sie es und teilen Sie es Ihren Freunden mit.  Mitwirkende und Sicherheitsüberprüfungen sind ebenfalls herzlich willkommen.  <b>PPS</b> Wenn dieser Artikel über Habr geschrieben wird, habe ich vor, Folgendes darüber zu schreiben, wie ich Docker-in-Docker und Docker-in-Docker-in-Docker gestartet habe, für das, was ich getan habe und was daraus entstanden ist. <br>  <b>EDIT1:</b> <ol><li>  Korrigierte Fehler in der Veröffentlichung, </li><li>  Als Antwort auf Kommentare habe ich beschlossen, diese Informationen hier zu platzieren: --privilegiertes Flag wird für die Arbeit mit iptables benötigt </li></ol><br>  <b>EDIT2:</b> <ol><li>  Verbesserter Befehl zum Starten von Bildern: Jetzt ist das Flag --privileged nicht mehr erforderlich </li><li>  Es wurde ein Link zum russischsprachigen Video-Guide <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hinzugefügt</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">youtu.be/A8zvrHsT9A0</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de458606/">https://habr.com/ru/post/de458606/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de458594/index.html">Vergessen Sie nicht, die Wahrscheinlichkeit einer Antwort an den Client durch eine wiederholte Anforderung beim L7-Ausgleich zu erhöhen</a></li>
<li><a href="../de458596/index.html">Kleine Freude # 6: OpenAI Gym - Spiele spielen und Roboter steuern</a></li>
<li><a href="../de458600/index.html">Was sind Elektrofahrräder (Gruppenbewertung in zwei Teilen von fünf Modellen zweier Hersteller), Teil 1</a></li>
<li><a href="../de458602/index.html">Wie wir die Great Chinese Firewall durchbohrt haben (Teil 1)</a></li>
<li><a href="../de458604/index.html">Warum sich die beiden größten Elektronikhersteller zu einem neuen GPU-Projekt zusammengeschlossen haben</a></li>
<li><a href="../de458608/index.html">Node.js Entwicklertools Jobwarteschlange</a></li>
<li><a href="../de458612/index.html">Kosmos. 7 Jahre</a></li>
<li><a href="../de458614/index.html">Erstellen eines Reactive UsePosition () - Hooks zum Abrufen und Verfolgen von Browserkoordinaten</a></li>
<li><a href="../de458622/index.html">Automatisierung für die Kleinsten. Teil eins (der nach Null liegt). Netzwerkvirtualisierung</a></li>
<li><a href="../de458624/index.html">Wie wir gelernt haben, Texte auf Leinwand zu zeichnen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>