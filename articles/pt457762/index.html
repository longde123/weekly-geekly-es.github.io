<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüé§ üç≥ üëù R√©gua do CCD: o que √© comido üë∑üèª üíí üë®üèæ‚Äçüé§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Neste artigo, quero apresentar minha experi√™ncia no uso de um fotodetector CCD linear. Essa linha de CCD pode ser usada no design de um espectr√¥metro ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>R√©gua do CCD: o que √© comido</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457762/"><img src="https://habrastorage.org/webt/6f/ss/-0/6fss-0mg8davzerthbljhhg9ora.jpeg"><br>  Neste artigo, quero apresentar minha experi√™ncia no uso de um fotodetector CCD linear.  Essa linha de CCD pode ser usada no design de um espectr√¥metro improvisado, leitor de c√≥digo de barras, sensor de posi√ß√£o ou desvio do feixe de laser, scanner de foto ou filme e muito mais.  No meu caso, era um scanner a laser, que n√£o consigo descrever na rede. <br><a name="habracut"></a><br>  <b>O que √© um dispositivo com carga acoplada?</b> <br><br>  Na maioria das vezes, quando se fala em CCD, eles significam v√°rios fotodetectores.  Menos comumente, s√£o dispositivos de mem√≥ria: registradores de deslocamento, linhas de atraso.  Na sua ess√™ncia, esse dispositivo lembra um pouco a mem√≥ria em dom√≠nios magn√©ticos cil√≠ndricos, apenas em sil√≠cio - com a ajuda de uma onda itinerante de um campo el√©trico criado por um sistema de eletrodos, aglomerados de portadores de carga que de alguma forma se formaram nele de alguma forma se movem anteriormente pelo semicondutor.  Assim, obtemos um registro de turno que possui uma estrutura extremamente simples e √© capaz de memorizar n√£o apenas uma sequ√™ncia de unidades digitais e zeros, mas tamb√©m um sinal anal√≥gico. <br><div style="text-align:center;"><img width="50%" src="https://habrastorage.org/webt/at/dl/gv/atdlgvfbnsok-t_geekshblchyo.gif"></div><br>  Nos receptores de imagem CCD, √© precisamente essa capacidade dessa estrutura que √© usada para emitir sequencialmente as cargas acumuladas sob cada um dos pixels da estrutura.  Al√©m disso, o mesmo sistema de porta usado para mover as cargas durante a exposi√ß√£o cria po√ßos potenciais nos quais essas cargas se acumulam (ou esses orif√≠cios s√£o criados durante a forma√ß√£o da estrutura - semelhante aos canais internos e induzidos do transistor MOS).  Estruturas mais complexas incluem um port√£o resistivo ao longo do qual uma inclina√ß√£o de potencial suave √© formada (√© assim que as linhas do CCD Hamamatsu S11155 s√£o organizadas), bem como a separa√ß√£o das zonas de acumula√ß√£o de carga e transfer√™ncia de carga - as cargas acumuladas de toda a linha s√£o primeiro transferidas para a linha de buffer e depois posteriormente avan√ßadas saia ao longo da √∫ltima. <br>  A simplicidade da estrutura interna se traduz na complexidade de gerenci√°-la.  Mesmo a vers√£o mais simples da linha CCD requer a gera√ß√£o de um sinal bif√°sico ou trif√°sico de forma complexa com diferentes n√≠veis de tens√£o com arestas √≠ngremes (com uma alta capacit√¢ncia de entrada de 1000 pF ou mais), deslocadas uma em rela√ß√£o √† outra.  As r√©guas do tipo Hamamatsu S11155 requerem at√© oito sinais diferentes com diferentes n√≠veis de alta e baixa tens√£o nos dois lados do zero. <br>  Felizmente, algumas empresas (por exemplo, a Sony) lan√ßaram uma linha na qual toda essa complexidade √© formada diretamente no chip.  E para o trabalho deles, voc√™ precisa gerar apenas dois sinais: o obturador eletr√¥nico de abertura pela dura√ß√£o da exposi√ß√£o e o rel√≥gio.  Em nosso design, essa √© exatamente a linha ILX554: (como regra, usada, mas bastante funcional) √© f√°cil de comprar dos chineses no Aliexpress. <br><br>  <b>Vamos olhar para a folha de dados</b> <br><br>  E vemos que apenas 6 dos 22 pinos est√£o envolvidos: fonte de alimenta√ß√£o de + 5V, sinais de entrada ROG e CLK, sinal de sa√≠da Vout, entrada e aterramento de sele√ß√£o de modo SHSW.  E isso √© tudo. <br>  ROG √© o controle eletr√¥nico do obturador (e o in√≠cio da transfer√™ncia de carga da linha fotossens√≠vel para o registro de deslocamento direto).  Ele tem um n√≠vel ativo - zero.  Para expor a matriz, ela deve ser pressionada para zero e mantida pelo tempo necess√°rio - de 5 Œºs a v√°rios segundos.  E ent√£o, liberando, aguarde pelo menos 3 Œºs (durante esse per√≠odo, o circuito de transfer√™ncia de carga funcionar√°).  Todo esse tempo na entrada do CLK mantemos um alto n√≠vel.  E ent√£o voc√™ pode ler a linha, aplicando √† entrada CLK um meandro com uma frequ√™ncia de v√°rias dezenas de quilohertz a 2 MHz.  Nesse caso, a cada diferen√ßa de unidade para zero, o pr√≥ximo pixel ser√° empurrado para a sa√≠da.  Existem 2088 desses pixels na programa√ß√£o, dos quais 2048 est√£o funcionando, fotossens√≠veis (na realidade, existem v√°rios outros, mas os pixels mais externos s√£o parcialmente obscurecidos).  A Datashit recomenda aplicar pelo menos 2090 pulsos CLK √† matriz para a opera√ß√£o correta. <br>  E como ele ser√° enviado depende do que est√° na entrada do SHSW.  Se for uma unidade l√≥gica, a sa√≠da produzir√° um sinal bastante complicado: <br><div style="text-align:center;"><img width="50%" src="https://habrastorage.org/webt/dz/xq/qb/dzxqqbdg8vq_r_jgxg4gwek-6lg.gif"></div><br>  Al√©m disso, quando o CLK passa de zero para um, ocorre uma redefini√ß√£o e de unidade para zero - a emiss√£o de um sinal √∫til. <br>  E a zero na entrada SHSW, o circuito interno de amostragem e armazenamento √© ativado, o que simplifica esse sinal para um sinal de v√≠deo passo a passo simples, onde, a cada nova transi√ß√£o de CLK para zero, o n√≠vel de sinal do pr√≥ximo pixel simplesmente aparece e √© mantido durante todo o per√≠odo do sinal CLK. <br>  A faixa √∫til do sinal de sa√≠da vem de um certo n√≠vel escuro, que de acordo com a folha de dados √© de 2,85 V, mas na realidade pode ser diferente (na minha linha - cerca de 3 V) e, quando saturado, o n√≠vel do sinal de sa√≠da cai para 1,5-2 B. <br>  Em geral, √© tudo o que precisamos saber sobre essa linha. <br><br>  <b>Circuito de inclus√£o</b> <br><br><div style="text-align:center;"><img width="60%" src="https://habrastorage.org/webt/th/vo/xs/thvoxsmrevwageaehbzgex4j054.png"></div><br>  √â simples e √≥bvio.  Geramos sinais CLK e ROG programaticamente usando MK, e os gatilhos Schmitt na entrada s√£o a maneira mais simples de alternar de 3,3 V para 5 V. O fato √© que n√£o h√° buffers nessas linhas na linha e que os circuitos da matriz funcionem corretamente voc√™ precisa submeter a eles um meandro com escala completa de zero a cinco volts e uma boa inclina√ß√£o das frentes.  Os NC7SZ14M5X indicados no diagrama s√£o gatilhos de invers√£o Schmitt √∫nicos muito convenientes, com frentes √≠ngremes e capacidade de carga aumentada, e geralmente os uso em meus projetos. <br>  Usando DA1, o n√≠vel do sinal de v√≠deo da programa√ß√£o ‚Äúacelera‚Äù at√© o intervalo em que o ADC opera, enquanto o ‚Äúsuporte‚Äù de aproximadamente 1,5 V correspondente ao n√≠vel de satura√ß√£o √© removido.  Como a diferen√ßa entre a amplitude do sinal e o valor ‚Äústand‚Äù varia muito entre os diferentes arranjos do CCD, as resist√™ncias R1 e R3 devem ser selecionadas ‚Äúcolocando‚Äù o sinal de sa√≠da na faixa desejada.  Deve-se ter em mente que n√£o apenas o deslocamento, mas tamb√©m o ganho depende da resist√™ncia R1; portanto, voc√™ deve primeiro selecion√°-lo. <br>  L1 e L2 s√£o esferas de ferrite ou bobinas pequenas para 1-2 ŒºG do tamanho de quadro 0805 ou 0603. Resistores e capacitores s√£o usados ‚Äã‚Äãdo mesmo tamanho.  O circuito √© montado em uma placa de dupla face por montagem em superf√≠cie.  N√£o trago o layout do quadro, pois ainda tenho muitas coisas nele. <br><br>  <b>Implementa√ß√£o de software no MK</b> <br><br>  A tarefa MK √© gerar um sinal ROG de alto n√≠vel (n√£o se esque√ßa dos inversores!) Da dura√ß√£o necess√°ria, uma breve pausa (3-10 Œºs) e, depois, uma sequ√™ncia de 2090 pulsos de alto n√≠vel separados por pausas iguais na dura√ß√£o.  Durante esses pulsos (ou pausas), algum tempo ap√≥s a frente, o valor da ilumina√ß√£o de pixel √© obtido usando um ADC externo ou de bordo.  Depois de ler o quadro, voc√™ tamb√©m deve fazer uma pausa at√© um novo pulso ROG - os mesmos 3-10 Œºs.  Depois de ligar a energia e, como se viu, ap√≥s um longo per√≠odo de uso (mais de 100 ms) da r√©gua, voc√™ precisa "limp√°-la" aplicando um trem de pulso padr√£o gratuito ao CLK algumas vezes. <br>  No STM32, √© aconselh√°vel fazer tudo isso em uma interrup√ß√£o do timer.  Ao configurar o timer para gerar interrup√ß√µes com uma frequ√™ncia correspondente a uma freq√º√™ncia de pixel dobrada, colocamos cada opera√ß√£o do timer em uma interrup√ß√£o, onde alternadamente produzimos zero ou um para a porta e, quando produzimos zero, lemos as leituras do ADC.  E depois de contar 2090 ciclos, paramos o cron√¥metro.  Para ler o pr√≥ximo quadro, √© necess√°rio redefinir o contador de ciclos para zero, iniciar o temporizador e aguardar at√© que tudo seja contado. <br>  Algo assim, como mostrado nesses trechos de c√≥digo. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> clkState = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> frameOk = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> pixCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> ccdFrame[<span class="hljs-number"><span class="hljs-number">2090</span></span>]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> uint16_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readADC1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//            { . . . } void Delay(unsigned int Val) //     { for( ; Val != 0; Val--) __NOP(); } void readCCD(void) //   - { pixCount = 0; //    frameOk = false; //   TIM_Cmd(TIM6, ENABLE); //   while(frameOk == false); // ,     } // ...    ... // void TIM6_IRQHandler(void) /*      -     CLK       */ { if (TIM_GetITStatus(TIM4, TIM_IT_Update) != RESET) { if(clkState == true) //   (.0)      { clkState = false; GPIOB-&gt;ODR &amp;= ~GPIO_ODR_ODR_1; //      Delay(3); //  ,        ccdFrame[pixCount] = readADC1(); } else //   (.1) { pixCount++; clkState = true; GPIOB-&gt;ODR |= GPIO_ODR_ODR_1; //      } if(pixCount &gt;= 2090) //    ,      { pixCount = 0; frameOk = true; TIM_Cmd(TIM6, DISABLE); } TIM_ClearITPendingBit(TIM4, TIM_IT_Update); } }</span></span></span></span></code> </pre> <br><br>  <b>E aqui est√° o resultado</b> <br>  O resultado n√£o √© ruim.  Apesar do ADC embutido n√£o brilhar com suas caracter√≠sticas, suas caracter√≠sticas de ru√≠do correspondem completamente ao ru√≠do da linha CCD.  A faixa de ru√≠do do sinal escuro com um tempo de acumula√ß√£o de cerca de 1 ms resulta em n√≠veis de quantiza√ß√£o de ~ 3-4 e, ao usar um ADC externo de 14 bits com excelentes caracter√≠sticas, os resultados s√£o apenas ligeiramente melhores.  Com o aumento da ilumina√ß√£o, o ru√≠do aumenta por uma raz√£o simples: o n√∫mero de fotoel√©trons em cada um dos pixels n√£o √© t√£o grande (de acordo com meus c√°lculos, cerca de 30 mil na satura√ß√£o).  Para os melhores dispositivos, esse valor chega a 200 mil. <br>  No gr√°fico abaixo, h√° um exemplo de uma ‚Äúfigura‚Äù registrada pela r√©gua, na qual, contra o fundo da parede iluminada, existe um suporte escuro no qual uma bola oca de vidro com um di√¢metro de 1 cm fixado no interior √© preenchida com solu√ß√£o preta.  Um pico √© um reflexo da superf√≠cie externa desta bola.  O ru√≠do nas √°reas claras √© a estrutura da parede propriamente dita, refor√ßada por manchas do laser, de quadro a quadro, permanece estacion√°ria.  O ru√≠do real da linha √© muito menor. <br><div style="text-align:center;"><img width="65%" src="https://habrastorage.org/webt/ce/bt/jw/cebtjw-j6wmi1icilzg_oprfxnc.png" alt="imagem"></div><br><br>  <b>Outras linhas semelhantes</b> <br>  Algumas outras linhas SONY CCD em preto e branco de 2048 pixels da ILX511, ILX551 (a √∫ltima possui uma pinagem diferente e requer duas tens√µes de alimenta√ß√£o - 5 e 9 V), diferindo no tamanho do pixel transversal (de 14 a 200 m√≠crons), funciona exatamente da mesma maneira. e sensibilidade espectral (o ILX554A √© sens√≠vel ao vermelho e ao IR, semelhante ao √≠ndice B tem uma sensibilidade reduzida na regi√£o do IR e √© muito pr√≥ximo do olho, e o ILX511B √© mais sens√≠vel ao azul).  Suas caracter√≠sticas din√¢micas s√£o diferentes: a faixa din√¢mica do ILX551B, devido ao pequeno tamanho de pixel, chega a 6000 (nossa linha atinge esse DD com velocidades curtas do obturador de cerca de 10 Œºs). <br><br>  * * * <br>  Este artigo discute a conex√£o talvez da linha CCD mais f√°cil de usar.  Essa simplicidade se deve ao fato de toda a complexidade estar escondida nela sob o cap√¥.  Se n√£o fossem os drivers internos, eu teria que gerar muitos sinais multin√≠veis. <br>  Infelizmente, pelos padr√µes modernos, uma linha CCD com drivers internos n√£o possui as melhores caracter√≠sticas.  Portanto, nesta linha, a faixa din√¢mica, definida como a propor√ß√£o do sinal de satura√ß√£o para o sinal escuro, √© 333: 1 e definida como a propor√ß√£o do sinal de satura√ß√£o para o sinal m√≠nimo detectado no contexto do ru√≠do - cerca de 1000: 1.  Mas esses dispositivos n√£o s√£o apenas dif√≠ceis de usar, mas geralmente dif√≠ceis de acessar (o mesmo Hamamatsu exige formalidades burocr√°ticas complexas na compra de suas matrizes CCD e outros fotodetectores devido √† dupla finalidade desses produtos).  No entanto, esse alto desempenho nem sempre √© necess√°rio e, para muitos prop√≥sitos, os par√¢metros desses dispositivos s√£o bastante aceit√°veis. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt457762/">https://habr.com/ru/post/pt457762/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt457752/index.html">Nem vagabundos da lua nem piadistas. O que sabemos sobre rob√¥s em Fukushima</a></li>
<li><a href="../pt457754/index.html">Estado e T-killers</a></li>
<li><a href="../pt457756/index.html">O livro Kafka Streams em a√ß√£o. Aplicativos e microsservi√ßos em tempo real ¬ª</a></li>
<li><a href="../pt457758/index.html">Engenheiros salvam pessoas perdidas na floresta, mas a floresta ainda n√£o se rendeu</a></li>
<li><a href="../pt457760/index.html">Como tornar os cont√™ineres ainda mais isolados: uma revis√£o das tecnologias de sandbox de cont√™ineres</a></li>
<li><a href="../pt457764/index.html">10 erros do jovem PO (parte II)</a></li>
<li><a href="../pt457766/index.html">Geramos n√≠veis de ladrilhos e ocultamos quadrados do jogador</a></li>
<li><a href="../pt457768/index.html">Como fiquei vulner√°vel: digitalizando a infraestrutura de TI com a Qualys</a></li>
<li><a href="../pt457770/index.html">Escrevemos o transformador personalizado AST no TypeScript</a></li>
<li><a href="../pt457774/index.html">Estudar como piloto particular na Terra-m√©dia: mudar e morar em uma vila da Nova Zel√¢ndia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>