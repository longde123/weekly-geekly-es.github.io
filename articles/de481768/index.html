<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍❤️‍💋‍👨 🤞 🖕 Wir beschäftigen uns mit WebKit in 1C, zum Beispiel der Integration von TinyMCE in eine verwaltete Form in UT 11.4 🗜️ 🦕 🚩</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Viele wissen bereits, dass in der Veröffentlichung der Plattform 8.3.14.1565 der Internet Explorer durch das Web-Kit ersetzt wurde. Dies ist eigentlic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wir beschäftigen uns mit WebKit in 1C, zum Beispiel der Integration von TinyMCE in eine verwaltete Form in UT 11.4</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481768/">  Viele wissen bereits, dass in der Veröffentlichung der Plattform 8.3.14.1565 der Internet Explorer durch das Web-Kit ersetzt wurde. Dies ist eigentlich ein großer Schritt nach vorne, aber ich bin mir sicher, dass noch nicht klar ist, was was ist.  Es gab die Erfahrung, Web-Kit in 1C zu verwenden, JS von 1C aufzurufen und 1C von JS aufzurufen.  Versuchen wir gemeinsam zu verstehen, wie sich das eine vom anderen unterscheidet, und gleichzeitig etwas Nützliches zu tun.  Ja, und sicherlich müssen viele ihre ähnlichen Fertigkeiten nach dem Update auf eine neue Plattform umschreiben, also hoffe ich, dass meine Erfahrung nützlich sein wird. <br><a name="habracut"></a><br>  Alles begann damit, dass die Aufgabe lautete: „Wir möchten in UT eine formatierte Beschreibung für das Produkt eingeben, damit es später in den Onlineshop gelangt.“ Die Standardbeschreibung für das Produkt kommt in einer durchgezogenen Linie ohne Silbentrennung an und sieht nicht sehr gut aus.  Sofort gab es den Wunsch, ein formatiertes Dokument zu verwenden, es gibt einen einfachen Editor, und Sie können es in HTML hochladen.  Aber sobald ich den Webentwicklern den HTML-Code zeigte, der durch das formatierte Dokument generiert wurde, winkten sie sofort mit den Händen und sagten, dass dies nicht funktionieren würde.  Die Site verfügt bereits über eigene Stile zum Anzeigen der erforderlichen Blockelemente, und das Verhalten dieser Art von Text kann unvorhersehbar werden. <br><br>  Die Get HTML-Funktion eines formatierten Dokuments gibt eine vollständig formatierte HTML-Seite mit der gesamten Struktur der Tags und den unangenehmsten Inline-Stilen zurück.  Es sieht so aus. <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content-Type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html; charset=utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"X-UA-Compatible"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"IE=Edge"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"format-detection"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"telephone=no"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css"> </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">body</span></span></span><span class="css">{</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">margin</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">;</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">padding</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">8px</span></span></span><span class="css">;} </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">p</span></span></span><span class="css">{</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">line-height</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">1.15</span></span></span><span class="css">;</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">margin</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">;</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">white-space</span></span></span><span class="css">:pre-wrap;} </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">ol</span></span></span><span class="css">,</span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">ul</span></span></span><span class="css">{</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">margin-top</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">;</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">margin-bottom</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">;} </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">img</span></span></span><span class="css">{</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">border</span></span></span><span class="css">:none;} </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">li</span></span></span><span class="css">&gt;</span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">p</span></span></span><span class="css">{</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">display</span></span></span><span class="css">:inline;} </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text-decoration: underline;"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"font-weight: bold;"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"color: #ff0000;font-weight: normal;"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Und wenn das Abrufen des Inhalts des Body-Tags eine einfache Aufgabe ist, wollte ich die Stilattribute nicht aus den Tags analysieren und ausschneiden. <br><br>  TinyMCE bringt ein schönes Layout zurück.  Erlauben Sie sich Inline-Stile nur bei Farbe, was schon viel besser ist. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"color: #ff0000;"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Es wurde beschlossen, TinyMCE, einen Texteditor von Drittanbietern, zu integrieren.  Darüber hinaus ist die Erfahrung bei der Integration in die 1C-Community bereits recht groß. <br><br>  Vielleicht war es damals ein Fehler, und Sie mussten nur den von einem formatierten Dokument erzeugten Text analysieren, aber wir haben das, was wir haben. <br><br><h4>  1. Merkmale der Lösung </h4><br>  Da 1C das Hochladen lokaler Dateien aus dem Dateisystem auf die Seite im HTML-Feld nicht zulässt, benötigen Sie auf jeden Fall einen Webserver oder zumindest die Adresse dieser Datei im temporären Speicher. Stellen Sie die Tiny js-Bibliothek neben 1C und laden Sie sie in die Header des HTML-Dokuments Sie können nicht - Sie müssen auch eine Datei mit einem HTML-Layout erstellen, das intern ein vorgefertigtes Editorfenster bildet und bereits mit dem HTML-Dokument verbunden ist. <br><br>  Im Allgemeinen können Sie eine Bibliothek laden, wenn Sie im Repository eine Adresse dafür erhalten, wenn sie in einer Datei kompiliert wurde. Tiny enthält neben der Hauptbibliothek auch Plug-in-JS-Dateien, einen Stil-Manager und Stile, die selbst Dateien knacken , Symbole usw., und wie Sie es verstehen, erschwert dies die Aufgabe erheblich.  Zu einer Zeit gab es sogar die Idee, all dieses Zeug in eine Datei zu kompilieren und die Probleme nicht zu kennen, aber es dauerte lange, bis man die Werkzeuge verstanden hatte.  Dann wurde TinyMCE Builder auf der offiziellen Website gefunden, die alle js in einer Datei zusammenfasst. Es wäre ein kleiner Sieg, wenn es dasselbe mit css machen würde, aber nein, css lag immer noch neben mehreren Ordnern. <br><br>  TinyMCE erstellt einen Iframe für das Bearbeitungsfenster, das selbst ein in die Seite eingebettetes HTML-Dokument ist. Ereignisse, die in diesem Iframe 1C auftreten, können daher nicht nachverfolgt werden. <br><br>  Die Konfiguration von UT 11.4 zum Zeitpunkt der Entwicklung hatte einen Kompatibilitätsmodus von 8.3.12, so dass nun der IE als integrierter Browser verwendet wurde. Ein weiteres Update erforderte jedoch einen Übergang zu neuen Versionen, die das Web-Kit bereits verwenden. <br><br><h4>  2. Erste Schritte </h4><br>  Die Hauptunterschiede beim Arbeiten mit dem Web-Kit: <br><br>  Das Hauptobjekt der HTML-Felder hat jetzt eine andere Struktur. Um mit dem Inhalt der Seite arbeiten zu können, müssen Sie die Eigenschaft <b>defaultView verwenden</b> <br><br><pre> <code class="1c hljs">.HTML.Document.DefaultView</code> </pre> <br>  Zuvor wurde hierfür die Eigenschaft <b>parentWindow verwendet</b> <br><br><pre> <code class="1c hljs">.HTML.Document.parentWindow</code> </pre> <br>  Das Verbot der Verwendung von eval, das früher allgemein zum Aufrufen von JS-Code verwendet wurde.  So etwas in der Art <br><br>  Elements.FieldHTML.Document.parentWindow.eval ("alert ('Aufrufcode von 1C')") <br>  Sie können jedoch direkt von 1C aus auf die Methoden zugreifen. <br><br>  Elements.Description HTML.Document.DefaultView.NameMethodJS (); <br>  Und ich habe schnell Wrapping-Funktionen für alle Tiny-Methoden erstellt, die ich benötige. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetText</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tinyMCE.activeEditor.getContent({<span class="hljs-attr"><span class="hljs-attr">format</span></span>: <span class="hljs-string"><span class="hljs-string">"text"</span></span>}); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetText</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tinyMCE.activeEditor.setContent(text); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetHTML</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tinyMCE.activeEditor.getContent(); }</code> </pre> <br>  Welche weiter aus 1C so angesprochen <br><br><pre> <code class="1c hljs">HTML = .HTML.Document.DefaultView; HTML = HTML.GetHTML();  = HTML.GetText();</code> </pre> <br>  Obwohl man mit direkten Aufrufen des Editor-Objekts auskommen könnte, zum Beispiel <br><br><pre> <code class="1c hljs">.HTML..defaultView.tinyMCE.activeEditor.getContent()</code> </pre> <br>  Die Verarbeitung aus der Publikation wurde sofort heruntergeladen (ein separater Hinweis an den Autor), der mir viele interessante Dinge zeigte.  Es funktionierte mehr oder weniger im IE, aber das Kopieren und Einfügen funktionierte nicht im Webkit. Zuerst verursachte es einen Fehler. Später wurde jedoch klar, dass aufgrund des Iframes das HTML-Feld beim Klicken nicht aktiviert wurde, da der Klick tatsächlich im angehängten Dokument auftrat HTML, dessen Ereignisse irgendwo auf dem Weg zu 1C hängen blieben.  Wenn Sie also an einer Stelle des Formulars Strg + C drücken und versuchen, es in das Feld des Editors einzufügen, wird der Text in das Feld eingefügt, aus dem er kopiert wurde, da das HTML-Feld des Dokuments nicht aktiviert ist.  Das gleiche passiert im umgekehrten Fall, die Tastaturkürzel zum Kopieren und Einfügen funktionieren nicht. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/759/7b5/9e3/7597b59e3048362a6cc6d715e64c43f3.gif" alt="Bild"><br><br>  Zuerst kam die Idee auf, dass es sich um einen winzigen Pfosten handelt, der direkte Paste aus dem Puffer blockiert, wie CKEditor, der ein separates Fenster zum Einfügen aus dem Puffer bietet.  Aber um zu überprüfen, ob es ganz einfach war, habe ich ein leeres Dokument mit einem Eingabefeld erstellt und versucht, es zu kopieren und einzufügen <br><br><img src="https://habrastorage.org/getpro/habr/post_images/496/d00/ca5/496d00ca55f4a4ed0b593f56575b8336.gif" alt="Bild"><br><br>  Wie Sie sehen, funktioniert alles.  Das Problem liegt also irgendwo in Tiny oder in der Interaktion mit 1C. <br><br><h4>  3. Entscheidung </h4><br>  Um das Problem mit der Interaktion von Browser und 1C zu lösen, wurde der übliche Trick angewendet. Ich erstellte eine unsichtbare Schaltfläche auf der HTML-Seite und plante, in JS darauf zu klicken, wenn die erforderlichen Ereignisse auf der Seite eintraten, die 1C im HTML-Press-Ereignis abfangen würde.  Aber bei welcher Veranstaltung soll eine Programmpresse durchgeführt werden? <br><br>  Das Layout sieht ungefähr so ​​aus: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"editor"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button1c"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display: none"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Und eine Funktion zum Auslösen eines Schaltflächen-Klick-Ereignisses <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clickButton</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ button1c.click(); }</code> </pre> <br>  Bisher war es möglich, ein Objekt der Form 1C als Objekt in das HTML-Feld zu übertragen, und aufgrund der Tatsache, dass der IE über COM mit 1C verbunden war, wurde das Formular selbst in ein Objekt umgewandelt, das der IE verstand, und es war möglich, Exportfunktionen der Form 1C direkt aus JS-Code aufzurufen .  Jetzt ist es unmöglich. <br><br>  Wir haben die Tiny API-Dokumentation untersucht und ein Konstrukt zum Abfangen von Ereignishandlern und eine geeignete Kombination von Ereignissen gefunden, die das HTML-Feld des Dokuments aktivieren sollen <br><br><pre> <code class="javascript hljs">tinymce.activeEditor.on(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">)</span></span>{clickButton(e)}); tinymce.activeEditor.on(<span class="hljs-string"><span class="hljs-string">'KeyDown'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">)</span></span>{clickButton(e)});</code> </pre> <br>  Sie müssen diesen Code an der Stelle ablegen, an der Tiny bereits initialisiert wurde.  Ich habe dies im <b>Onload-</b> Handler des <b>Fensterobjekts gemacht</b> .  Aber Sie können es schöner machen und den Code beim Initialisieren von Tiny in den Parameter einfügen: <br><br><pre> <code class="javascript hljs">init_instance_callback</code> </pre> <br>  Jetzt sollte alles in Ordnung sein.  Und das Formular sollte funktionieren, wie es sollte ... <br><br>  Es wurde viel besser, das HTML-Feld begann wirklich aktiviert zu werden, aber nicht immer, aus irgendeinem Grund verursachten einige Klicks nicht, dass der Fokus auf das Feld verschoben wurde: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e91/403/d67/e91403d6763d389bcbb7b95a884e07e9.gif" alt="Bild"><br><br>  Dieser Datensatz zeigt, dass, wenn Sie auf die Zeile klicken, in der der Cursor blinkt, der Fokus des Felds wie gewünscht funktioniert. Wenn Sie jedoch unten klicken, wird das Feld nicht aktiviert. <br><br>  Es war ein ärgerliches Artefakt, und Versuche zu verstehen, was geschah, gaben keine Lösung.  Ich habe Warnungen an den Handler ausgegeben, und es wurden Warnungen angezeigt, aber 1C hat nicht auf das Ereignis reagiert <br><br><img src="https://habrastorage.org/getpro/habr/post_images/531/81f/f82/53181ff82d52da46e812d260056e6d79.gif" alt="Bild"><br><br>  Plötzlich kam mir die Idee: Was passiert, wenn 1C es nicht schafft, das Ereignis im Feld zu verarbeiten? Was passiert, wenn Sie die Ausführung des JS-Skripts etwas verlangsamen und sehen, was passiert?  Die Pausenfunktion in JS wurde schnell implementiert, indem Versprechen und asynchrone Wartezeiten verwendet wurden.  Wie Sie in JS sehen können, existiert es auch standardmäßig nicht und es gibt nichts, Leute leben). <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sleep</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ms</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve</span></span></span><span class="hljs-function"> =&gt;</span></span> setTimeout(resolve, ms)); } <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clickButton</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>); button1c.click(); }</code> </pre> <br>  Hier stelle ich die Verzögerung auf eine Millisekunde ein, bevor ich auf den Button klicke.  Und voila, es hat funktioniert.  1C fing an, das Klicken eines Knopfes rechtzeitig zu verarbeiten. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4fd/c95/937/4fdc959377f0ec372414c1db88959d9e.gif" alt="Bild"><br><br><h4>  4. Wir beenden den Austausch </h4><br>  Da zum Speichern der neuen Beschreibung im HTML-Format dem Verzeichnis ein neues Attribut hinzugefügt wurde, müssen wir beim Entladen den Wert des typischen Felds ersetzen.  Fügen Sie dazu im Modul ExchangeSiteRemoveable der Erweiterung die Funktion GetTexts of RequestsCatalog hinzu und schreiben Sie dort: <br><br><pre> <code class="1c hljs">. = <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(., <span class="hljs-string"><span class="hljs-string">"."</span></span>, <span class="hljs-string"><span class="hljs-string">".HTML_HTML"</span></span>);</code> </pre> <br>  Das ist alles.  Wir starten den Austausch und alles funktioniert, es bleiben nur noch Änderungen an der Site, falls erforderlich, damit die Produktbeschreibung als Layout und nicht als String wahrgenommen wird. <br><br><h4>  Zusammenfassung </h4><br>  In diesem Beispiel habe ich die Interaktion von JS WebKit und 1C ausprobiert, den Rechen gesammelt und eine Lösung gefunden. <br><br>  Um dieses Problem zu lösen, war es vielleicht einfacher, den HTML-Text aus einem formatierten Dokument zu analysieren und zu löschen, aber es wäre nicht so interessant und könnte Probleme mit einigen komplexen Formatierungsoptionen verursachen. <br><br>  Danke fürs Lesen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de481768/">https://habr.com/ru/post/de481768/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de481754/index.html">Ich Bot und meine Ahle</a></li>
<li><a href="../de481756/index.html">Wie organisiere ich DDoS für gute Zwecke?</a></li>
<li><a href="../de481758/index.html">Bau-, Versorgungs- und Besuchsstatistiken der ISS</a></li>
<li><a href="../de481762/index.html">Gleichungen für die Küche unter dem Weihnachtsbaum</a></li>
<li><a href="../de481764/index.html">Warum hat grüne Energie eine schwierige Zukunft?</a></li>
<li><a href="../de481770/index.html">Der Computerprogramm-Pionier Tony Brucker stirbt im Alter von 94 Jahren</a></li>
<li><a href="../de481774/index.html">Sicherheits-Cheat-Sheets: Virtual Patching</a></li>
<li><a href="../de481776/index.html">5G- und Cloud-Gaming-Dienste - Testen Sie, wie es in Moskau funktioniert</a></li>
<li><a href="../de481778/index.html">Skeleton Key-Malware-Analyse</a></li>
<li><a href="../de481780/index.html">MyOffice hat über 200 neue Funktionen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>