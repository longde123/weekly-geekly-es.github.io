<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéª üïò üèòÔ∏è Aben√ßoe Nouveau, ou sobre o meu tormento com a Nvidia Optimus. Parte 1. A beleza da documenta√ß√£o do Arch üßõüèº üñäÔ∏è üçß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Antes de come√ßar 
 Antes de come√ßar a hist√≥ria principal, gostaria de esclarecer alguns pontos. O artigo √© voltado principalmente para os propriet√°rio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aben√ßoe Nouveau, ou sobre o meu tormento com a Nvidia Optimus. Parte 1. A beleza da documenta√ß√£o do Arch</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414061/"><h2>  Antes de come√ßar </h2><br>  Antes de come√ßar a hist√≥ria principal, gostaria de esclarecer alguns pontos.  O artigo √© voltado principalmente para os propriet√°rios de laptops com a tecnologia Nvidia Optimus que desejam instalar o GNU / Linux (doravante o Linux).  O material visa garantir que a √Åsia Central acima mencionada se familiarize com poss√≠veis solu√ß√µes para o problema e facilitar e agilizar sua resolu√ß√£o.  Al√©m disso, o artigo n√£o √© menos <b>motivador</b> e tem como objetivo entender uma verdade simples das pessoas: no Linux, como na vida, sempre h√° uma solu√ß√£o alternativa e, se voc√™ desistir, n√£o ficar√° melhor <i>(na maioria dos casos)</i> . <br><blockquote>  <b><i>Qui quaerit, reperit</i></b> </blockquote>  <i>- ditado latino</i> <br><br><h3>  Pref√°cio </h3><br>  Por enquanto, eu era um Linuxoid comum.  Testei diferentes distribui√ß√µes, aprendi lentamente coisas novas.  S√≥ porque eu estava interessado.  Como regra, o "conhecimento" era limitado ao Ubuntu e seus garfos, bem como ao Fedora e algumas distribui√ß√µes "f√°ceis de usar".  Mas, como outro prov√©rbio latino diz, omnia fluunt, omnia mutantur, isto √©, tudo flui, tudo muda, e √© claro que isso n√£o poderia continuar para sempre. <br><br><h3>  Tudo come√ßou bem </h3><br>  Deve-se notar que eu n√£o tinha muito espa√ßo para experimentos: um PC <i>relativamente</i> fraco, que mal puxava o GNOME 3, e uma Internet lenta, o que complicou bastante a situa√ß√£o geral.  Mas, em seguida, mais para o menino de 12 anos e n√£o era necess√°rio.  No final, estou cansado de experimentar, instalei o Windows 10 e esqueci o Linux por alguns anos. <br><br>  O tempo passou e, ap√≥s cerca de dois anos, percebi que era hora de atualizar meu <s>peda√ßo de ferro</s> PC e come√ßamos a economizar dinheiro.  Algo foi ganho com a venda de seus pertences, algo foi dado, mais da metade do valor foi jogado por seus pais, ele at√© teve <s>que sacrificar</s> para vender seu Xbox (!) <a name="habracut"></a>  divertir suas perguntas frequentes para aumentar suas habilidades em Linux.  Desta vez, decidi tentar instalar o Arch.  Ouvi dizer que ele tem uma documenta√ß√£o muito boa.  E ele come√ßou. <br><br><h3>  A beleza da documenta√ß√£o do Arch </h3><br>  A instala√ß√£o foi r√°pida e <i>relativamente</i> indolor.  Mais uma vez, gra√ßas √† documenta√ß√£o.  Ap√≥s instalar o sistema e a DE representada pelo KDE Plasma, tentei conectar o laptop ao meu monitor externo, porque o monitor possui uma diagonal de 24 'e o laptop apenas 15,6'.  Nada aconteceu, n√£o havia sinal no monitor.  Como sempre, comecei a pesquisar no Google.  E, ap√≥s 30 minutos de pesquisa, descobri que o problema estava com a tecnologia Nvidia Optimus. <br><br><h4>  Um pouco sobre a Nvidia Optimus </h4><br>  A Nvidia √© uma boa companhia.  Ao longo de seus 25 anos de hist√≥ria, eles implementaram muitas solu√ß√µes <i>relativamente</i> boas.  A Nvidia Optimus √© uma delas.  O assunto √© uma tecnologia h√≠brida para garantir a opera√ß√£o correta de duas placas gr√°ficas (geralmente gr√°ficos poderosos da Nvidia e Intel integrado) em laptops.  Se <s>funcionar no Windows</s> configurado corretamente, ajudar√° a economizar recursos de energia e laptop.  Tudo isso √© excelente, mas o que me levou a escrever essa obra foi que essa bela tecnologia no Linux, segundo os desenvolvedores, funciona apenas <i>parcialmente</i> e, na minha opini√£o, s√£o necess√°rios muitos, muitos nervos, tempo e esfor√ßo para configur√°-la. <br><br><h3>  A beleza da documenta√ß√£o do Arch (continua√ß√£o) </h3><br>  Depois que descobri a verdadeira raiz do problema, fiquei feliz por ter determinado ‚Äúonde o cachorro est√° enterrado‚Äù (apenas a placa Nvidia tinha uma sa√≠da HDMI), e meu primeiro passo foi ler a documenta√ß√£o oficial do Arch.  Sua ess√™ncia era usar o Xorg.conf e o .xinitrc para for√ßar o X a usar apenas a placa Nvidia.  Ap√≥s concluir estas etapas e reiniciar ... uma tela preta apareceu.  A documenta√ß√£o dizia que, neste caso, √© necess√°rio verificar se h√° e comercial no .xinitrc e, se n√£o houver, use a "Configura√ß√£o alternativa", que for√ßou o X a usar apenas uma placa Intel.  Isso n√£o combina comigo, j√° que a placa Intel j√° foi usada por padr√£o e essa op√ß√£o n√£o combina comigo.  Havia tamb√©m op√ß√µes para v√°rios DMs.  Eles tamb√©m n√£o se encaixavam, pois nenhum deles podia iniciar o servidor X por v√°rios motivos. <br>  Descrever cada um deles separadamente seria um exerc√≠cio muito longo e sem sentido. <br><br><h3>  Qui quaerit, reperit </h3><br>  Esta express√£o na tradu√ß√£o do latim significa "quem procura, encontra".  N√£o foi em v√£o que o coloquei no in√≠cio, porque, quanto a mim, essa express√£o se tornar√° a moral ideal para este artigo. <br><br>  Eu estava desesperado.  Por dois dias, tentei em v√£o encontrar uma solu√ß√£o, vasculhei os f√≥runs estrangeiros (apenas neles, uma vez que, na LOR ortodoxa, a resposta era essa: voc√™ n√£o pode iniciar o X atrav√©s da Nvidia de forma alguma. √â imposs√≠vel, reconciliar).  Ainda assim, em uma manh√£ nublada do terceiro dia de pesquisas, deparei-me com um t√≥pico (link no por√£o) no f√≥rum de desenvolvimento da Nvidia, no qual foi descrito como a Nvidia Optimus √© implementada no Arch nos laptops da Dell.  Percebi imediatamente - estou salvo!  Seguindo as etapas, reiniciei e ... uma tela preta.  Obviamente, fiquei chateado, mas lembrei-me: n√£o me registrei na linha .xinitrc para executar o DE.  Tendo escrito exec startkde, reiniciei novamente e funcionou.  X iniciado via Nvidia.  Levei quatro longos dias para instalar e configurar o Arch, e ainda assim eu fiz! <br><br><h3>  Debriefing </h3><br>  Agora vamos analisar as instru√ß√µes do t√≥pico acima.  Vamos come√ßar: <br><br>  Primeiro, voc√™ precisa habilitar o suporte KMS (Configura√ß√£o do modo do kernel, o m√©todo de configura√ß√£o da resolu√ß√£o diretamente no kernel) adicionando aos par√¢metros do kernel (arquivo / etc / default / grub) na linha GRUB_CMDLINE_LINUX_DEFAULT = par√¢metro <br><br><pre><code class="bash hljs">nvidia-drm.modeset=1</code> </pre> <br>  Em seguida, criamos um script para o DM (gerenciador de login).  Considere a op√ß√£o com o LightDM.  Criamos o script /etc/lightdm/display_setup.sh com o seguinte conte√∫do: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh xrandr --setprovideroutputsource modesetting NVIDIA-0 xrandr --auto</span></span></code> </pre> <br>  Com este script, especificamos o provedor e definimos a resolu√ß√£o de tela m√°xima poss√≠vel. <br><br>  Vamos tornar o script criado execut√°vel: <br><br><pre> <code class="bash hljs">chmod +x /etc/lightdm/display_setup.sh</code> </pre> <br>  Deixe o LightDM executar o script acima na inicializa√ß√£o.  Primeiro, edite o /etc/lightdm/lightdm.conf: <br><br><pre> <code class="bash hljs">nano /etc/lightdm/lightdm.conf</code> </pre> <br>  Digite o par√¢metro <br><br><pre> <code class="bash hljs">display-setup-script=/etc/lightdm/display_setup.sh</code> </pre> <br>  Voc√™ pode ver as instru√ß√µes para SDDM no t√≥pico que eu j√° mencionei, links no por√£o. <br><br>  Agora precisamos atualizar o microc√≥digo da CPU (mais sobre o microc√≥digo a partir dos links no por√£o): <br><br><pre> <code class="bash hljs">sudo pacman -S intel-ucode</code> </pre> <br>  Ap√≥s atualizar o microc√≥digo, instale v√°rios pacotes da Nvidia: <br><br><pre> <code class="bash hljs">sudo pacman -S lib32-mesa-demos mesa-demos libva-vdpau-driver nvidia nvidia-libgl lib32-nvidia-utils nvidia-settings lib32-opencl-nvidia</code> </pre> <br><blockquote>  <b>Nota:</b> Alguns dos pacotes podem n√£o estar dispon√≠veis.  Nesse caso, instale tudo separadamente.  Ignore pacotes que n√£o estar√£o dispon√≠veis. </blockquote>  Ative o daemon nvidia.persistenced, respons√°vel pela persist√™ncia (leia mais sobre ele no link do por√£o) do driver da Nvidia: <br><br><pre> <code class="bash hljs">systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> nvidia-persistenced.service</code> </pre> <br>  Configure automaticamente o GRUB: <br><br><pre> <code class="bash hljs">sudo grub-mkconfig -o /boot/grub/grub.cfg</code> </pre> <br>  Crie um disco RAM inicializ√°vel: <br><br><pre> <code class="bash hljs">mkinitcpio -p linux</code> </pre> <br>  Verifique .xinitrc: <br><br><pre> <code class="bash hljs">nano ~/.xinitrc</code> </pre> <br>  Se n√£o inserido, insira <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> gnome-session</code> </pre> <br>  para GNOME e <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> startkde</code> </pre> <br>  para o KDE Plasma. <br><br>  Reinicializa√ß√£o: <br><br><pre> <code class="bash hljs">reboot</code> </pre> <br>  Ap√≥s reiniciar o laptop, efetue login usando sua conta e aproveite o mundo do Arch. <br><br><h3>  Sobre o Bumblebee e o PRIME </h3><br>  Voc√™ deve ter notado que eu n√£o disse nada sobre as ‚Äúmuletas‚Äù que visam garantir a opera√ß√£o <u>correta</u> do Nvidia Optimus no Linux: Bumblebee e PRIME. <br>  Al√©m disso, s√≥ recebi uma placa Nvidia com um driver propriet√°rio, o Nouveau n√£o funcionou (√© por isso que o artigo se chama ‚ÄúBless Nouveau‚Äù). <br>  Quanto √† minha experi√™ncia pessoal com eles, ele √© pequeno e deplor√°vel: as duas muletas √† queima-roupa n√£o viram minha placa de v√≠deo Nvidia.  Se voc√™ estiver interessado neles, no por√£o voc√™ encontrar√° links para os materiais neles. <br><br><h2>  Posf√°cio </h2><br>  Se voc√™ ler o artigo inteiro, ser√° um her√≥i <i>(bom ou moderador)</i> . <br><br>  Ao escrever um artigo, tentei dilu√≠-lo para voc√™ <i>com</i> piadas <i>relativamente</i> engra√ßadas, a fim de justificar a aus√™ncia de imagens nele.  Espero que voc√™ tenha chegado ao zen depois de ler. <br><br><h3>  Lista de fontes </h3><br>  Sobre o microc√≥digo: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">en.wikipedia.org/wiki/</a> Microcode <br>  Sobre o Bumblebee: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">wiki.archlinux.org/index.php/Bumblebee_</a> (russo) <br>  Sobre o PRIME: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">wiki.archlinux.org/index.php/PRIME</a> <br>  T√≥pico: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">devtalk.nvidia.com/default/topic/1027679/linux/optimus-support-for-arch-linux-for-dell-i7559-dual-graphics-intel-nvidia-gtx-960m-laptop-/2</a> <br>  Sobre a persist√™ncia: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">en.wikipedia.org/wiki/Persistency</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt414061/">https://habr.com/ru/post/pt414061/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt414049/index.html">Os principais jogos da E3 2018: Fallout 76, Metro Exodus, Doom Eternal e outros</a></li>
<li><a href="../pt414053/index.html">5 equ√≠vocos sobre o GDPR</a></li>
<li><a href="../pt414055/index.html">Trans-PRK: um dos padr√µes de corre√ß√£o da vis√£o</a></li>
<li><a href="../pt414057/index.html">Refrigera√ß√£o do data center: uma can√ß√£o de gelo e fogo</a></li>
<li><a href="../pt414059/index.html">A porcentagem de casamento entre l√¢mpadas LED. Uma sele√ß√£o de 27.000 l√¢mpadas vendidas</a></li>
<li><a href="../pt414063/index.html">Comandante da manh√£</a></li>
<li><a href="../pt414065/index.html">O melhor smartphone chin√™s "at√© 10 mil rublos" com AliExpress vs Xiaomi Redmi 5</a></li>
<li><a href="../pt414067/index.html">Inicie o redirecionamento m√≥vel com o Adjust: configura√ß√µes, relat√≥rios e links</a></li>
<li><a href="../pt414069/index.html">Restri√ß√µes de drones durante a Copa do Mundo da FIFA 2018 (FIFA 2018)</a></li>
<li><a href="../pt414071/index.html">Do monitoramento ao gerenciamento de incidentes. Relat√≥rio do DevOps Moscow Meetup</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>