<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôåüèº ‚úçüèΩ üçÅ Inmersi√≥n en desarrollo en Ethereum. Parte 5: Oraclize ü§≤üèª üîî üç≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El acceso a archivos grandes y diversos datos din√°micos externos son a menudo una parte muy importante de una aplicaci√≥n descentralizada. Al mismo tie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Inmersi√≥n en desarrollo en Ethereum. Parte 5: Oraclize</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417681/">  El acceso a archivos grandes y diversos datos din√°micos externos son a menudo una parte muy importante de una aplicaci√≥n descentralizada.  Al mismo tiempo, Ethereum en s√≠ no proporciona un mecanismo para dar la vuelta: los contratos inteligentes solo se pueden leer y escribir dentro de la propia cadena de bloques.  En este art√≠culo, consideraremos Oraclize, que solo permite interactuar con el mundo exterior al consultar casi cualquier recurso de Internet.  Un tema relacionado es IPFS, y lo mencionamos brevemente. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sp/_k/1m/sp_k1m_ob9-qh3_yiiyhmtecypu.jpeg"></div><br><a name="habracut"></a><br><h2>  IPFS </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">IPFS</a> es un sistema de archivos distribuido con direccionamiento de contenido.  Esto significa que para el contenido de cualquier archivo agregado all√≠, se considera un hash √∫nico.  Luego se usa el mismo hash para buscar y recuperar este contenido de la red. <br>  La informaci√≥n b√°sica ya se ha descrito en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este art√≠culo</a> y en varios otros, por lo que no vemos motivos para repetir. <br><br><h3>  ¬øPor qu√© usar IPFS junto con Ethereum? </h3><br>  Guardar cualquier volumen de contenido en la cadena de bloques es demasiado costoso y perjudicial para la red.  Por lo tanto, la mejor opci√≥n es guardar alg√∫n tipo de enlace al archivo que se encuentra en el almacenamiento fuera de la cadena, no necesariamente IPFS.  Pero IPFS tiene una serie de ventajas: <br><br><ul><li>  Un enlace de archivo es un hash que es exclusivo de los contenidos espec√≠ficos del archivo, por lo que si colocamos este hash en la cadena de bloques, podemos estar seguros de que el archivo recibido de √©l es el que se agreg√≥ originalmente, el archivo no se puede reemplazar </li><li>  El sistema distribuido asegura contra la falta de disponibilidad de un servidor espec√≠fico (debido al bloqueo u otras razones) </li><li>  El enlace al archivo y la confirmaci√≥n de hash se combinan en una l√≠nea, lo que significa que puede escribir menos en la cadena de bloques y ahorrar gas </li></ul><br>  Entre las deficiencias, se puede mencionar que, dado que no hay un servidor central, para la accesibilidad de los archivos es necesario que al menos un archivo est√© "distribuido".  Pero si tiene un archivo espec√≠fico, conectarse a los distribuidores es f√°cil: inicie su demonio ipfs y agregue el archivo a trav√©s de <code>ipfs add</code> . <br><br>  La tecnolog√≠a es muy adecuada para la ideolog√≠a de la descentralizaci√≥n, por lo tanto, considerando Oraclize ahora, a menudo encontraremos el uso de IPFS en diferentes mecanismos de or√°culo. <br><br><h2>  Oraclize </h2><br>  Para realizar casi cualquier trabajo √∫til, un contrato inteligente necesita recibir nuevos datos.  Sin embargo, no hay una capacidad incorporada para satisfacer una solicitud de blockchain al mundo exterior.  Por supuesto, puede agregar todo lo que requieren las transacciones manualmente, pero es imposible verificar de d√≥nde provienen estos datos y su confiabilidad.  Adem√°s, es posible que deba organizar una infraestructura adicional para actualizar r√°pidamente los datos din√°micos, como los tipos de cambio.  Y las actualizaciones con un intervalo fijo provocar√°n desbordamientos de gas. <br><br>  Por lo tanto, el servicio provisto por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Oraclize</a> es √∫til: en un contrato inteligente, puede enviar una solicitud a casi cualquier API o recurso en Internet, aseg√∫rese de que los datos recibidos del recurso especificado no cambien y use el resultado en el mismo contrato inteligente. <br><br>  Oraclize no es solo un servicio de Ethereum, se proporciona una funcionalidad similar a otras cadenas de bloques, sino que solo describiremos el paquete con Ethereum. <br><br><h3>  Empezando </h3><br>  Todo lo que se necesita para comenzar es agregar uno de los archivos oraclizeAPI del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">repositorio</a> al proyecto.  Solo necesita elegir el adecuado para su versi√≥n del compilador (solc): oraclizeAPI_0.5.sol para versiones que comienzan en 0.4.18, oraclizeAPI_0.4.sol para versiones de 0.4.1, oraclizeAPI_pre0.4.sol para todo lo anterior, soporte Esta versi√≥n ya ha sido descontinuada.  Si usa trufa, no olvide cambiar el nombre del archivo a usando Oracle: requiere que el nombre del archivo y el contrato coincidan. <br><br>  Al incluir el archivo apropiado en su proyecto, hereda el contrato de <code>usingOraclize</code> .  Y puede comenzar a usar Oracle, que se reduce a dos cosas principales: enviar una solicitud utilizando el asistente <code>oraclize_query</code> , y luego procesar el resultado en la funci√≥n <code>__callback</code> .  El contrato inteligente m√°s simple (para obtener el precio actual del tiempo aire en d√≥lares) podr√≠a verse as√≠: <br><br><pre> <code class="javascript hljs">pragma solidity <span class="hljs-number"><span class="hljs-number">0.4</span></span><span class="hljs-number"><span class="hljs-number">.23</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"./usingOraclize.sol"</span></span>; contract ExampleContract is usingOraclize { string public ETHUSD; event updatedPrice(string price); event newOraclizeQuery(string description); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExampleContract</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">payable</span></span></span><span class="hljs-function"> </span></span>{ updatePrice(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__callback</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bytes32 myid, string result</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> (msg.sender == oraclize_cbAddress()); ETHUSD = result; updatedPrice(result); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updatePrice</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">payable</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (oraclize_getPrice(<span class="hljs-string"><span class="hljs-string">"URL"</span></span>) &gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.balance) { newOraclizeQuery(<span class="hljs-string"><span class="hljs-string">"Oraclize query was NOT sent, please add some ETH to cover for the query fee"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { newOraclizeQuery(<span class="hljs-string"><span class="hljs-string">"Oraclize query was sent, standing by for the answer.."</span></span>); oraclize_query(<span class="hljs-string"><span class="hljs-string">"URL"</span></span>, <span class="hljs-string"><span class="hljs-string">"json(https://api.coinmarketcap.com/v1/ticker/ethereum/?convert=USD).0.price_usd"</span></span>); } } }</code> </pre> <br>  La funci√≥n que env√≠a la solicitud es <code>updatePrice</code> .  Puede ver que primero hay una comprobaci√≥n de que <code>oraclize_getPrice(‚ÄúURL‚Äù)</code> mayor que el saldo actual del contrato.  Esto se debe a que la llamada <code>oraclize_query</code> debe pagarse, el precio se calcula como la suma de la comisi√≥n fija y el pago de gas por llamar a la devoluci√≥n de llamada.  <code>‚ÄúURL‚Äù</code> es una designaci√≥n de uno de los tipos de fuentes de datos, en este caso es una simple solicitud a trav√©s de https, luego consideraremos otras opciones.  Las respuestas a pedido se pueden analizar de antemano como json (como en el ejemplo) y de varias otras maneras (lo consideraremos m√°s adelante).  Se devuelve una l√≠nea de <code>__callback</code> en <code>__callback</code> .  Al principio, se verifica que la llamada pas√≥ de la direcci√≥n confiable de oraclize <br><br>  Todas las opciones para usar oraclize se crean de acuerdo con un esquema, solo las fuentes de datos y la capacidad de agregar autenticaci√≥n a <code>__callback</code> .  Por lo tanto, en futuros ejemplos citaremos solo diferencias significativas. <br><br><h3>  Precio de uso </h3><br>  Como ya se mencion√≥, el √©ter adicional se paga por las solicitudes de oraclize, y se elimina del saldo del contrato, y no de la direcci√≥n de la llamada.  Una excepci√≥n es solo la primera solicitud de cada nuevo contrato, se proporciona de forma gratuita.  Tambi√©n es interesante que se conserven los mismos mecanismos en las redes de prueba, pero el pago se realiza transmitiendo la red correspondiente, es decir, en testnet las solicitudes son pr√°cticamente gratuitas. <br><br>  Ya se ha mencionado que el precio de la solicitud consta de dos valores: una comisi√≥n fija y el pago de una devoluci√≥n de llamada de gas.  Una comisi√≥n fija se define en d√≥lares, y la cantidad de √©ter se calcula a partir de la tasa actual.  La comisi√≥n depende de la fuente de los datos y los mecanismos de apoyo adicionales, en los que nos detendremos.  La tabla de precios actual se ve as√≠: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/d9/w2/xv/d9w2xvqkoi2laplioqc377xydxm.png"></div><br>  Como puede ver, el precio por solicitud de URL es de varios centavos.  ¬øEs mucho o poco?  Para hacer esto, consideremos cu√°nto cuesta la segunda parte: el cargo de devoluci√≥n de llamada de gas. <br>  Esto funciona de acuerdo con el siguiente esquema: la cantidad de √©ter necesaria para pagar una cantidad fija de gas a un precio fijo se transfiere por adelantado con la solicitud del contrato.  Esta cantidad deber√≠a ser suficiente para hacer una devoluci√≥n de llamada, y el precio deber√≠a ser adecuado para el mercado, de lo contrario la transacci√≥n no se realizar√° o se suspender√° durante mucho tiempo.  Al mismo tiempo, est√° claro que no siempre es posible saber la cantidad de gas por adelantado, por lo tanto, el tablero tambi√©n debe estar en reserva (la reserva no se devuelve).  Los valores predeterminados son un l√≠mite de 200 mil de gas a un precio de 20 gwei.  Esto es suficiente para una devoluci√≥n de llamada promedio con varias entradas y alg√∫n tipo de l√≥gica.  Y el precio de 20 gwei, aunque puede parecer demasiado grande en este momento (al momento de escribir, el promedio es de 4 gwei), pero en el momento de la afluencia de transacciones, el precio de mercado puede saltar repentinamente y ser a√∫n m√°s alto, por lo que, en general, estos valores est√°n cerca de los valores reales utilizados.  Entonces, con tales valores y el precio del aire en la regi√≥n de $ 500, los pagos de gas se acercar√°n a $ 2, por lo que podemos decir que una comisi√≥n fija ocupa una peque√±a parte. <br><br>  Si sabe lo que est√° haciendo, existe una opci√≥n para cambiar el l√≠mite y el precio del gas, lo que ahorra significativamente en las solicitudes. <br><br>  El precio del gas se puede establecer mediante una funci√≥n separada: <code>oraclize_setCustomGasPrice(&lt;  wei&gt;)</code> .  Despu√©s de la llamada, el precio se guarda y se usa en todas las solicitudes posteriores. <br>  El l√≠mite se puede establecer en la consulta <code>oraclize_query</code> , especific√°ndolo con el √∫ltimo argumento, por ejemplo, as√≠: <br><br><pre> <code class="javascript hljs">oraclize_query(<span class="hljs-string"><span class="hljs-string">"URL"</span></span>, <span class="hljs-string"><span class="hljs-string">"&lt;&gt;"</span></span>, <span class="hljs-number"><span class="hljs-number">50000</span></span>);</code> </pre> <br>  Si tiene una l√≥gica compleja en <code>__callback</code> y el gas se consume m√°s de 200k, entonces definitivamente deber√° establecer un l√≠mite que cubra el peor de los casos de consumo de gas.  De lo contrario, si se excede el l√≠mite, <code>__callback</code> simplemente retroceder√°. <br><br>  Por cierto, recientemente, Oraclize recibi√≥ informaci√≥n que puede pagar por solicitudes fuera de blockchain, lo que le permitir√° no gastar todo el l√≠mite o devolver el saldo (y el pago no es del contrato).  No hemos tenido que usar esto todav√≠a, pero oraclize ofrece contactarlos en info@oraclize.it, si esta opci√≥n es interesante.  Por lo tanto, ten en cuenta. <br><br><h3>  Como funciona </h3><br>  ¬øPor qu√©, habiendo heredado de un contrato inteligente regular, obtenemos una funcionalidad que inicialmente no era compatible con los mecanismos de blockchain?  De hecho, el servicio Oracle no solo consiste en contratos con funciones auxiliares.  El trabajo principal para obtener datos lo realiza un servicio externo.  Los contratos inteligentes forman aplicaciones para acceder a datos externos y ponerlos en la cadena de bloques.  Servicio externo: monitorea nuevos bloques de blockchain y, si detecta una aplicaci√≥n, la ejecuta.  Esquem√°ticamente, esto se puede representar de la siguiente manera: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/th/b0/ka/thb0kan1hwm75ijixmdrqtiwvum.png"></div><br><h3>  Fuentes de datos </h3><br>  Adem√°s de la <code>URL</code> considerada, oraclize ofrece 4 opciones m√°s (que vio en la secci√≥n sobre precios): <code>WolframAlpha</code> , <code>IPFS</code> , <code>random</code> y <code>computation</code> .  Consideremos cada uno de ellos. <br><br><h4>  1. URL </h4><br>  El ejemplo ya discutido utiliza esta fuente de datos.  Esta es la fuente de las solicitudes HTTP a varias API.  El ejemplo fue el siguiente: <br><br><pre> <code class="javascript hljs">oraclize_query(<span class="hljs-string"><span class="hljs-string">"URL"</span></span>, <span class="hljs-string"><span class="hljs-string">"json(https://api.coinmarketcap.com/v1/ticker/ethereum/?convert=USD).0.price_usd"</span></span>);</code> </pre> <br>  Esto est√° obteniendo el precio del √©ter, y dado que api proporciona una cadena json con un conjunto de datos, la solicitud se envuelve en un analizador json y devuelve solo el campo que necesitamos.  En este caso, es GET, pero la URL de origen tambi√©n admite solicitudes POST.  El tipo de solicitud se determina autom√°ticamente mediante un argumento adicional.  Si hay un json v√°lido como en este ejemplo: <br><br><pre> <code class="javascript hljs">oraclize_query(<span class="hljs-string"><span class="hljs-string">"URL"</span></span>, <span class="hljs-string"><span class="hljs-string">"json(https://shapeshift.io/sendamount).success.deposit"</span></span>, <span class="hljs-string"><span class="hljs-string">'{"pair":"eth_btc","amount":"1","withdrawal":"1AAcCo21EUc1jbocjssSQDzLna9Vem2UN5"}'</span></span>)</code> </pre> <br>  entonces la solicitud se procesa como POST (la API utilizada se describe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> , si est√° interesado) <br><br><h4>  2. WolframAlpha </h4><br>  Esta fuente de datos le permite acceder al servicio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">WolframAlpha</a> , que puede proporcionar respuestas a varias solicitudes de hechos o c√°lculos, por ejemplo <br><br><pre> <code class="javascript hljs">oraclize_query(‚ÄúWolframAlpha‚Äù, ‚Äúpresident <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> Russia‚Äù)</code> </pre> <br>  devolver√° <code>Vladimir Putin</code> , y solicitar√° <br><br><pre> <code class="javascript hljs">oraclize_query(‚ÄúWolframAlpha‚Äù, ‚Äúsolve x^<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-number"><span class="hljs-number">-4</span></span>‚Äù)</code> </pre> <br>  devolver√° <code>x = 2</code> . <br>  Como puede ver, el resultado fue incompleto porque se perdi√≥ el s√≠mbolo ¬±.  Por lo tanto, antes de usar esta fuente, debe verificar que el valor de una solicitud espec√≠fica se pueda usar en un contrato inteligente.  Adem√°s, la autenticaci√≥n no es compatible con las respuestas, por lo que oraclize recomienda que esta fuente se use solo para pruebas. <br><br><h4>  3. IPFS </h4><br>  Como puede suponer, le permite recuperar el contenido de un archivo en IPFS utilizando un hash m√∫ltiple.  El tiempo de espera para recibir contenido es de 20 segundos. <br><br><pre> <code class="javascript hljs">oraclize_query(‚ÄúIPFS‚Äù, ‚ÄúQmTL5xNq9PPmwvM1RhxuhiYqoTJcmnaztMz6PQpGxmALkP‚Äù)</code> </pre> <br>  <code>Hello, Habr!</code>  (si el archivo con este contenido a√∫n est√° disponible) <br><br><h4>  4. aleatorio </h4><br>  La generaci√≥n de n√∫meros aleatorios funciona de la misma manera que otras fuentes, pero si usa <code>oraclize_query</code> , se requiere una <code>oraclize_query</code> preparaci√≥n de los argumentos.  Para evitar esto, puede usar la <code>oraclize_newRandomDSQuery(delay, nbytes, customGasLimit)</code> auxiliar <code>oraclize_newRandomDSQuery(delay, nbytes, customGasLimit)</code> , configurando solo el retraso de ejecuci√≥n (en segundos), el n√∫mero de bytes generados y el l√≠mite de gas para llamar a <code>__callback</code> . <br>  Usar <code>random</code> tiene un par de cosas a tener en cuenta: <br><br><ul><li>  Para confirmar que el n√∫mero es realmente aleatorio, se utiliza un tipo especial de verificaci√≥n: Ledger, que se puede realizar en la cadena de bloques (a diferencia de todos los dem√°s, pero m√°s sobre eso m√°s adelante).  Esto significa que en el constructor del contrato inteligente, debe establecer este m√©todo de verificaci√≥n mediante la funci√≥n: <br><br><pre> <code class="javascript hljs">oraclize_setProof(proofType_Ledger);</code> </pre> <br>  Y al comienzo de la devoluci√≥n de llamada deber√≠a haber un cheque en s√≠ mismo: <br><br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__callback</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bytes32 _queryId, string _result, bytes _proof</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> (oraclize_randomDS_proofVerify__returnCode(_queryId, _result, _proof) == <span class="hljs-number"><span class="hljs-number">0</span></span>) ); <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">...</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br>  Esta verificaci√≥n requiere una red real y no funcionar√° en ganache, por lo que para las pruebas locales puede eliminar temporalmente esta l√≠nea.  Por cierto, el tercer argumento para <code>__callback</code> aqu√≠ es el par√°metro opcional <code>_proof</code> .  Siempre se requiere cuando se usa uno de los tipos de confirmaci√≥n. </li><li>  Si usa un n√∫mero aleatorio para momentos cr√≠ticos, por ejemplo, para determinar el ganador de la loter√≠a, capture la entrada del usuario antes de enviar newRandomDSQuery.  De lo contrario, puede ocurrir esta situaci√≥n: oraclize llama a _callback y la transacci√≥n es visible para todos en la lista pendiente.  Junto con esto, el n√∫mero aleatorio en s√≠ es visible.  Si los usuarios pueden continuar, en t√©rminos generales, haciendo apuestas, entonces podr√°n especificar un precio de gasolina m√°s alto y subir su tasa antes de ejecutar _callback, sabiendo de antemano que ganar√°. </li></ul><br><br><h4>  5. c√°lculo </h4><br>  Esta es la m√°s flexible de las fuentes.  Le permite escribir sus propios scripts y usarlos como fuente de datos.  La computaci√≥n se lleva a cabo en AWS.  Para la ejecuci√≥n, debe describir el Dockerfile y juntarlo con archivos adicionales arbitrarios en un archivo zip, y descargar el archivo en IPFS.  La implementaci√≥n debe cumplir las siguientes condiciones: <br><br><ul><li>  Escriba la respuesta que desea devolver con la √∫ltima l√≠nea en stdout </li><li>  La respuesta no debe tener m√°s de 2500 caracteres. </li><li>  La inicializaci√≥n y la ejecuci√≥n no deben tomar m√°s de 5 minutos en total. </li></ul><br>  Para un ejemplo de c√≥mo se hace esto, consideraremos c√≥mo realizar la uni√≥n m√°s simple de las filas transmitidas y devolver el resultado. <br><br>  Dockerfile: <br><br><pre> <code class="bash hljs">FROM ubuntu:16.04 MAINTAINER <span class="hljs-string"><span class="hljs-string">"info@rubyruby.ru"</span></span> CMD <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ARG0</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ARG1</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ARG2</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ARG3</span></span></span><span class="hljs-string">"</span></span></code> </pre><br>  Variables de entorno <code>ARG0</code> , <code>ARG1</code> , etc.  - Estos son los par√°metros pasados ‚Äã‚Äãjunto con la solicitud. <br>  Agregue el dockerfile al archivo, inicie el servidor ipfs y agregue este archivo all√≠ <br><br><pre> <code class="bash hljs">$ zip concatenation.zip Dockerfile $ ipfs daemon &amp; $ ipfs add concatenation.zip QmWbnw4BBFDsh7yTXhZaTGQnPVCNY9ZDuPBoSwB9A4JNJD</code> </pre> <br>  Utilizamos el hash resultante para enviar la solicitud a trav√©s de <code>oraclize_query</code> en el contrato inteligente: <br><br><pre> <code class="javascript hljs">oraclize_query(<span class="hljs-string"><span class="hljs-string">"computation"</span></span>, [<span class="hljs-string"><span class="hljs-string">"QmVAS9TNKGqV49WTEWv55aMCTNyfd4qcGFFfgyz7BYHLdD"</span></span>, <span class="hljs-string"><span class="hljs-string">"s1"</span></span>, <span class="hljs-string"><span class="hljs-string">"s2"</span></span>, <span class="hljs-string"><span class="hljs-string">"s3"</span></span>, <span class="hljs-string"><span class="hljs-string">"s4"</span></span>]);</code> </pre> <br>  Se usa una matriz como argumento, en el que el primer elemento es el multihash de archivo, y todo lo dem√°s son los par√°metros que se encuentran en las variables de entorno. <br><br>  Si espera a que se complete la solicitud, <code>__callback</code> resultado <code>s1 s2 s3 s4</code> . <br><br><h3>  Ayudantes de an√°lisis y subconsultas </h3><br>  A partir de la respuesta devuelta por cualquier fuente, puede preseleccionar solo la informaci√≥n requerida utilizando una serie de ayudantes, como: <br><br><h4>  1. Analizador JSON </h4><br>  Viste este m√©todo en el primer ejemplo, donde solo se devolvi√≥ el precio del resultado devuelto por coinmarketcap: <br><br><pre> <code class="bash hljs">json(https://api.coinmarketcap.com/v1/ticker/ethereum/?convert=USD).0.price_usd</code> </pre> <br>  El caso de uso es bastante obvio, volviendo por ejemplo: <br><br><pre> <code class="hljs json">[ { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"ethereum"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Ethereum"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"symbol"</span></span>: <span class="hljs-string"><span class="hljs-string">"ETH"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"rank"</span></span>: <span class="hljs-string"><span class="hljs-string">"2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"price_usd"</span></span>: <span class="hljs-string"><span class="hljs-string">"462.857"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"price_btc"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.0621573"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"24h_volume_usd"</span></span>: <span class="hljs-string"><span class="hljs-string">"1993200000.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"market_cap_usd"</span></span>: <span class="hljs-string"><span class="hljs-string">"46656433775.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"available_supply"</span></span>: <span class="hljs-string"><span class="hljs-string">"100800968.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"total_supply"</span></span>: <span class="hljs-string"><span class="hljs-string">"100800968.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"max_supply"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">"percent_change_1h"</span></span>: <span class="hljs-string"><span class="hljs-string">"-0.5"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"percent_change_24h"</span></span>: <span class="hljs-string"><span class="hljs-string">"-3.02"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"percent_change_7d"</span></span>: <span class="hljs-string"><span class="hljs-string">"5.93"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"last_updated"</span></span>: <span class="hljs-string"><span class="hljs-string">"1532064934"</span></span> } ]</code> </pre> <br>  Como se trata de una matriz, tomamos el elemento <code>0</code> y, a partir de √©l, el campo <code>price_usd</code> <br><br><h4>  2. XML </h4><br>  El uso es similar a JSON, por ejemplo: <br><br><pre> <code class="bash hljs">xml(https://informer.kovalut.ru/webmaster/getxml.php?kod=7701).Exchange_Rates.Central_Bank_RF.USD.New.Exch_Rate</code> </pre> <br><h4>  3. HTML </h4><br>  Puede analizar XHTML con XPath.  Por ejemplo, obtenga una capitalizaci√≥n de mercado con etherscan: <br><br><pre> <code class="bash hljs">html(https://etherscan.io/).xpath(string(//*[contains(@href, <span class="hljs-string"><span class="hljs-string">'/stat/supply'</span></span>)]/font))</code> </pre> <br>  <code>MARKET CAP OF $46.148 BillionB</code> <br><br><h4>  4. Ayudante binario </h4><br>  Le permite cortar piezas de datos sin procesar utilizando la funci√≥n de corte (desplazamiento, longitud).  Es decir, por ejemplo, tenemos un archivo con el contenido de "abc": <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"abc"</span></span> &gt; example.bin</code> </pre> <br>  Ponlo en IPFS: <br><br><pre> <code class="bash hljs">$ ipfs add example.bin added Qme4u9HfFqYUhH4i34ZFBKi1ZsW7z4MYHtLxScQGndhgKE</code> </pre> <br>  Ahora corta 1 personaje del medio: <br><br><pre> <code class="javascript hljs">binary(Qme4u9HfFqYUhH4i34ZFBKi1ZsW7z4MYHtLxScQGndhgKE).slice(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br>  En la respuesta obtenemos <code>b</code> <br><br>  Como habr√°s notado, en el caso del asistente binario, no se utiliz√≥ la fuente IP, sino IPFS.  De hecho, los analizadores se pueden aplicar a cualquier fuente, digamos que no es necesario aplicar JSON a lo que devuelve la URL, puede agregar dicho contenido al archivo: <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"one"</span></span>:<span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"two"</span></span>:<span class="hljs-string"><span class="hljs-string">"2"</span></span> }</code> </pre> <br>  Agr√©guelo a IPFS: <br><br><pre> <code class="bash hljs">$ ipfs add test.json added QmZinLwAq5fy4imz8ZNgupWeNFTneUqHjPiTPX9tuR7Vxp</code> </pre> <br>  Y luego desmontar as√≠: <br><br><pre> <code class="bash hljs">json(QmZinLwAq5fy4imz8ZNgupWeNFTneUqHjPiTPX9tuR7Vxp).one</code> </pre> <br>  Obtenemos <code>1</code> <br><br>  Y un caso de uso particularmente interesante es combinar cualquier fuente de datos y cualquier analizador en una sola solicitud.  Esto es posible utilizando una fuente de datos <code>nested</code> separada.  Usamos el archivo que acabamos de crear en una solicitud m√°s compleja (agregando valores en dos campos): <br><br><pre> <code class="hljs powershell"><span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">WolframAlpha</span></span></span><span class="hljs-function">] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span></span> <span class="hljs-variable"><span class="hljs-variable">$</span></span>{<span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">IPFS</span></span></span><span class="hljs-function">] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">json</span></span></span></span>(QmZinLwAq5fy4imz8ZNgupWeNFTneUqHjPiTPX9tuR7Vxp).one} to <span class="hljs-variable"><span class="hljs-variable">$</span></span>{<span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">IPFS</span></span></span><span class="hljs-function">] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">json</span></span></span></span>(QmZinLwAq5fy4imz8ZNgupWeNFTneUqHjPiTPX9tuR7Vxp).two}</code> </pre> <br>  Obtenemos <code>3</code> <br>  La solicitud se forma de la siguiente manera: especifique la fuente de datos <code>nested</code> , luego, para cada solicitud, agregue el nombre de la fuente entre corchetes y, adem√°s, enmarque todas las subconsultas en <code>${..}</code> . <br><br><h3>  Prueba </h3><br>  Oraclize proporciona un servicio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">√∫til de</a> validaci√≥n de consultas sin la necesidad de contratos inteligentes.  Simplemente ingrese, elija una fuente de datos, un m√©todo de verificaci√≥n y podr√° ver que volver√° a __callback si env√≠a las solicitudes correspondientes <br><br>  Para la verificaci√≥n local junto con un contrato inteligente, puede usar una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">versi√≥n especial de Remix IDE</a> que admita solicitudes de Oracle. <br><br>  Y para verificar localmente con ganache, necesitar√° el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">puente ethereum</a> , que implementar√° contratos inteligentes oraclize en su red de prueba.  Para probar, primero agregue la siguiente l√≠nea al constructor de su contrato: <br><br><pre> <code class="javascript hljs">OAR = OraclizeAddrResolverI(<span class="hljs-number"><span class="hljs-number">0x6f485C8BF6fc43eA212E93BBF8ce046C7f1cb475</span></span>);</code> </pre> <br>  correr <br><br><pre> <code class="bash hljs">ganache-cli</code> </pre> <br>  Entonces <br><br><pre> <code class="bash hljs">node bridge --dev</code> </pre> <br>  Espere hasta que los contratos est√©n muertos y pueda probar.  En la salida del <code>node bridge</code> puede ver las solicitudes enviadas y las respuestas recibidas. <br><br>  Otra ayuda no solo durante las pruebas, sino tambi√©n en el uso real es la capacidad de monitorear las solicitudes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  Si est√° solicitando en una red p√∫blica, puede usar el hash de la transacci√≥n en la que se ejecuta la solicitud.  Si usa autenticaci√≥n, tenga en cuenta que se garantiza que se enviar√°n solo a mainnet, para otras redes puede devolver 0. Si la solicitud estaba en la red local, puede usar el id de solicitud, que devuelve <code>oraclize_query</code> .  Por cierto, se recomienda mantener siempre esta identificaci√≥n, por ejemplo, en una asignaci√≥n similar: <br><br><pre> <code class="javascript hljs">mapping(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bytes32</span></span></span><span class="hljs-function">=&gt;</span></span>bool) validIds;</code> </pre> <br>  En el momento de la solicitud, marque la identificaci√≥n enviada como <code>true</code> : <br><br><pre> <code class="javascript hljs">bytes32 queryId = oraclize_query(<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">...</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">); validIds[queryId] = true;</span></span></code> </pre><br>  Y luego, en <code>__callback</code> verifique que la solicitud con este ID a√∫n no se haya procesado: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__callback</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bytes32 myid, string result</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(validIds[myid] != bytes32(<span class="hljs-number"><span class="hljs-number">0</span></span>)); <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(msg.sender == oraclize_cbAddress()); validIds[myid] = bytes32(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">...</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  Esto es necesario porque <code>__callback</code> en una solicitud se puede llamar m√°s de una vez debido a las peculiaridades de los mecanismos de Oraclize. <br><br><h3>  Autenticaci√≥n </h3><br>  En la tabla con las fuentes, puede ver que diferentes fuentes pueden admitir diferentes tipos de confirmaciones, y se pueden cobrar diferentes tarifas.  Esta es una parte muy importante de oraclize, pero una descripci√≥n detallada de estos mecanismos es un tema aparte. <br><br>  El mecanismo m√°s utilizado, al menos por nosotros, es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">TLSNotary</a> con almacenamiento en IPFS.  El almacenamiento en IPFS es m√°s eficiente porque <code>__callback</code> no devuelve la evidencia en s√≠ (tal vez en la regi√≥n de 4-5 kilobytes), sino que es un hash m√∫ltiple mucho m√°s peque√±o.  Para especificar este tipo, agregue una l√≠nea en el constructor: <br><br><pre> <code class="javascript hljs">oraclize_setProof(proofType_TLSNotary | proofStorage_IPFS);</code> </pre> <br>  Solo podemos decir que este tipo, en t√©rminos generales, nos protege de la inexactitud de los datos recibidos de Oraclize.  Pero Oraclize utiliza servidores de Amazon, que act√∫an como el auditor, por lo que solo tienen que confiar. <br><br>  Lee m√°s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br><h2>  Conclusi√≥n </h2><br>  Oraclize proporciona herramientas que aumentan significativamente el n√∫mero de casos de uso para contratos inteligentes, as√≠ como IPFS, que se puede ver en varias versiones de consultas de Oracle.  El problema principal es que nuevamente usamos datos externos que est√°n sujetos a las amenazas de las que la cadena de bloques deber√≠a haber protegido: centralizaci√≥n, capacidades de bloqueo, cambios de c√≥digo, suplantaci√≥n de identidad.  Pero si bien todo esto es inevitable, y la opci√≥n de obtener datos es muy √∫til y viable, solo debe saber por qu√© se introdujo el uso de blockchain en el proyecto y si el uso de fuentes externas no confiables reduce el beneficio a cero. <br><br>  Si est√° interesado en algunos temas de desarrollo en Ethereum que a√∫n no se han divulgado en estos art√≠culos, escriba en los comentarios, tal vez los cubriremos a continuaci√≥n. <br><br>  Inmersi√≥n en desarrollo en Ethereum: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 1: Introducci√≥n</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 2: Web3.js y gas</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 3: aplicaci√≥n de usuario</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 4: despliegue y depuraci√≥n en trufa, ganache, infura</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es417681/">https://habr.com/ru/post/es417681/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es417671/index.html">Nuevas caracter√≠sticas del lenguaje de programaci√≥n ABAP en seminarios web de SAP</a></li>
<li><a href="../es417673/index.html">La investigaci√≥n lleva Solar Dozor: 5 casos no est√°ndar que DLP revel√≥</a></li>
<li><a href="../es417675/index.html">Localizaci√≥n de juegos y aplicaciones en Unity. R√°pido y f√°cil</a></li>
<li><a href="../es417677/index.html">Migrar un proyecto de yii1 a yii2 a trav√©s de un trabajo √∫nico</a></li>
<li><a href="../es417679/index.html">El grave legado del pasado. Problemas de la l√≠nea de comandos de Windows</a></li>
<li><a href="../es417683/index.html">C√≥digo obsoleto - C√≥digo de terceros</a></li>
<li><a href="../es417685/index.html">Seminarios web de Skillbox Friday: aprendizaje continuo gratis</a></li>
<li><a href="../es417687/index.html">Asimetr√≠a de la vida</a></li>
<li><a href="../es417689/index.html">Mobio habla con el CEO de Appnext sobre el mercado CPI y las tendencias de aplicaciones m√≥viles</a></li>
<li><a href="../es417691/index.html">Nuestra estanter√≠a es un programador de C #. Que hay de ti</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>