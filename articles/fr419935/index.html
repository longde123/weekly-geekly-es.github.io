<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌻 🐔 🛬 Exactement une fois n'est PAS exactement la même: analyse d'article 👎🏽 🧔🏽 👩🏽‍🎓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Présentation 


 J'ai décidé d'analyser un article décrivant certains détails intéressants du traitement en streaming une seule fois: une seule fois ....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Exactement une fois n'est PAS exactement la même: analyse d'article</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419935/"><h2 id="vvedenie">  Présentation </h2><br><p>  J'ai décidé d'analyser un article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">décrivant certains détails intéressants du traitement en streaming une seule fois: une seule fois</a> .  Le fait est que certains auteurs comprennent très étrangement les termes.  L'analyse de l'article nous permettra de clarifier plus en profondeur de nombreux détails, car  l'identification des incohérences et des bizarreries vous permet de découvrir plus pleinement les concepts et la signification. </p><br><p>  Commençons. </p><br><h2 id="analiz">  Analyse </h2><br><p>  Tout commence très bien: </p><a name="habracut"></a><br><blockquote> Le traitement distribué des flux d'événements est devenu un sujet de plus en plus d'actualité dans le domaine du Big Data.  Les moteurs de traitement de flux (SPE) notables incluent Apache Storm, Apache Flink, Heron, Apache Kafka (Kafka Streams) et Apache Spark (Spark Streaming).  L'une des caractéristiques les plus notables et les plus discutées des SPE est leur sémantique de traitement, «exactement une fois» étant l'une des plus recherchées et de nombreuses SPE prétendant fournir une sémantique de traitement «exactement une fois». </blockquote><p>  Autrement dit, le traitement des données est extrêmement important, etc., et le sujet en discussion est une seule fois.  Discutons-en. </p><br><blockquote>  Il existe cependant beaucoup de malentendus et d'ambiguïtés entourant ce qu'est exactement «exactement une fois», ce que cela implique et ce que cela signifie vraiment lorsque des SPE individuelles prétendent le fournir. </blockquote><p>  En effet, il est très important de comprendre ce que c'est.  Pour ce faire, il serait bon de donner la bonne définition avant un long raisonnement.  Et qui suis-je pour donner de si bons conseils? </p><br><blockquote>  Je vais discuter de la façon dont la sémantique de traitement «une seule fois» diffère entre de nombreuses SPE populaires et pourquoi «une seule fois» peut être mieux décrit comme efficace une fois </blockquote><p>  Inventer de nouveaux termes est, bien sûr, une tâche importante.  J'adore cette chose moi-même.  Juste pour cela, une justification est nécessaire.  Essayons de le trouver. </p><br><p>  Je ne décrirai pas les choses évidentes comme des graphiques de traitement dirigé et ainsi de suite.  Les lecteurs peuvent lire eux-mêmes l'article original.  De plus, l'analyse de ces détails n'est pas pertinente.  Je ne donnerai qu'une photo: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/14b/024/a60/14b024a60f1b9403430bd43ff77cb50b.png"></p><br><p>  Ensuite, il y a une description de la sémantique: </p><br><ul><li>  Au plus une fois, c'est-à-dire  pas plus d'une fois.  Avec une évidence apparente, un tel comportement est extrêmement difficile à garantir dans des scénarios au niveau des limites tels que des plantages, des perturbations de la connectivité réseau, etc.  Mais pour l'auteur, tout est simple: </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b12/02f/cb0/b1202fcb0c735e893daf0373ba23255e.png"></p><br><ul><li>  Au moins une fois, c'est-à-dire  au moins une fois.  Le schéma est plus complexe.  Et le râteau peut être collecté plus: </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/879/4cd/bd3/8794cdbd351ae965b267e7a3d51ae761.png"></p><br><ul><li>  Exactement une fois.  Qu'est-ce qu'une seule fois? </li></ul><br><blockquote>  Les événements sont garantis pour être traités «une seule fois» par tous les opérateurs dans l'application de flux, même en cas de diverses pannes. </blockquote><p>  C'est-à-dire  la garantie d'un traitement en une seule fois est lorsque le traitement "une seule fois" a eu lieu. </p><br><p>  Ressentez-vous le pouvoir de la détermination?  Pour reformuler: le traitement une fois, c'est quand le traitement a lieu «une fois».  Eh bien, oui, il dit également que cette garantie doit être préservée en cas de défaillance.  Mais pour les systèmes distribués, c'est une chose évidente.  Et les guillemets suggèrent que quelque chose ne va pas ici.  Définir avec des guillemets sans expliquer ce que cela signifie est le signe d'une approche profonde et réfléchie. </p><br><p>  Ce qui suit est une description de la façon d'implémenter une telle sémantique.  Et ici, je voudrais m'attarder plus en détail. </p><br><blockquote>  Deux mécanismes populaires sont généralement utilisés pour réaliser une sémantique de traitement «en une seule fois». <br><ol><li>  Instantané distribué / point de contrôle d'état </li><li>  Livraison d'événements au moins une fois plus déduplication des messages </li></ol><br></blockquote><p>  Si le premier mécanisme concernant les instantanés et les points de contrôle ne soulève pas de questions, à l'exception de certains détails tels que l'efficacité, il y a alors de petits problèmes avec le second que l'auteur a ignorés. </p><br><p>  Pour une raison quelconque, il est entendu qu'un gestionnaire ne peut être que déterministe.  Dans le cas d'un gestionnaire non déterministe, chaque redémarrage ultérieur donnera, de manière générale, d'autres valeurs et états de sortie, ce qui signifie que la déduplication ne fonctionnera pas, car  les valeurs de sortie seront différentes.  Ainsi, le mécanisme général sera beaucoup plus compliqué que celui décrit dans l'article.  Ou, franchement, un tel mécanisme est incorrect. </p><br><p>  Cependant, nous nous tournons vers les plus délicieux: </p><br><blockquote><h2 id="is-exactly-once-really-exactly-once">  Exactement une fois est-il vraiment exactement une fois? </h2><br><br>  Maintenant, réexaminons ce que la sémantique de traitement «en une seule fois» garantit réellement à l'utilisateur final.  L'étiquette «exactement une fois» est trompeuse en décrivant ce qui est fait exactement une fois. </blockquote><p>  On dit qu'il est temps de reconsidérer ce concept, car  il y a quelques incohérences. </p><br><blockquote>  Certains pourraient penser que «exactement une fois» décrit la garantie du traitement des événements dans lequel chaque événement du flux n'est traité qu'une seule fois.  En réalité, aucune SPE ne peut garantir un traitement unique.  Il est impossible de garantir que la logique définie par l'utilisateur dans chaque opérateur ne s'exécute qu'une fois par événement face à des échecs arbitraires, car l'exécution partielle du code utilisateur est une possibilité omniprésente. </blockquote><p>  Cher auteur, il convient de rappeler le fonctionnement des processeurs modernes.  Chaque processeur en cours de traitement effectue un grand nombre d'étages parallèles.  De plus, il existe des branches dans lesquelles le processeur commence à effectuer les mauvaises actions si le prédicteur de branche est incorrect.  Dans ce cas, les actions sont annulées.  Ainsi, le processeur peut exécuter deux fois le même morceau de code, même si aucun échec n'est survenu! </p><br><p>  Le lecteur attentif s'exclamera immédiatement: car l'échappement est important, et non la manière dont il est effectué.  Exactement!  Ce qui compte, c'est ce qui s'est passé et non comment cela s'est réellement passé.  Si le résultat est comme s'il s'est produit exactement une fois, cela signifie qu'il s'est produit exactement une fois.  Vous ne trouvez pas?  Et tout le reste est décortiqué, sans importance.  Les systèmes sont complexes et les abstractions qui en résultent ne créent que l'illusion de l'exécution d'une certaine manière.  Il nous semble que le code est exécuté séquentiellement, instruction par instruction, qui lit d'abord, puis écrit, puis une nouvelle instruction.  Mais ce n'est pas le cas, tout est beaucoup plus compliqué.  Et l'essence des abstractions correctes est de maintenir l'illusion de garanties simples et compréhensibles, sans approfondir à chaque fois, lorsque vous devez attribuer des valeurs à une variable. </p><br><p>  Et tout le problème de cet article réside dans le fait qu'exactement une fois est une abstraction qui vous permet de créer des applications sans penser aux doublons et aux valeurs perdues.  Que tout ira bien, même en cas de chute.  Et il n'est pas nécessaire d'inventer de nouveaux termes pour cela. </p><br><p>  L'exemple de code de l'article montre clairement un manque de compréhension de la façon d'écrire des gestionnaires: </p><br><pre><code class="hljs cs">Map (Event <span class="hljs-keyword"><span class="hljs-keyword">event</span></span>) { Print <span class="hljs-string"><span class="hljs-string">"Event ID: "</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">event</span></span>.getId() Return <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> }</code> </pre> <br><p>  Le lecteur est invité à réécrire indépendamment le code afin de ne pas répéter les erreurs de l'auteur de l'article. </p><br><blockquote>  Alors, qu'est-ce que les SPE garantissent lorsqu'ils revendiquent une sémantique de traitement «une seule fois»?  S'il n'est pas garanti que la logique utilisateur soit exécutée une seule fois, qu'est-ce qui est exécuté une seule fois?  Lorsque les SPE revendiquent une sémantique de traitement «une seule fois», ce qu'ils disent en réalité, c'est qu'ils peuvent garantir que les mises à jour de l'état géré par la SPE ne sont validées qu'une seule fois dans un magasin d'arrière-plan durable. </blockquote><p>  L'utilisateur n'a pas besoin d'une garantie de l'exécution physique du code.  En sachant comment fonctionne le processeur, il est facile de conclure que ce n'est pas possible.  L'essentiel est l'exécution logique une seule fois, comme s'il n'y avait aucun échec.  Attirer les concepts de «s’engager dans l’entrepôt de données» ne fait qu’aggraver le manque de compréhension de l’auteur des choses de base, car  il existe des implémentations de telles sémantiques sans avoir besoin d'un commit. </p><br><p>  Pour plus d'informations, vous pouvez lire brièvement mon article: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Traitement concurrentiel hétérogène des données en temps réel strictement une fois</a> . </p><br><blockquote>  En d'autres termes, le traitement d'un événement peut se produire plusieurs fois, mais l'effet de ce traitement n'est reflété qu'une seule fois dans la mémoire d'état du backend durable. </blockquote><p>  Qu'il existe un "magasin d'état backend durable" pour l'utilisateur est absolument violet.  Seul l'effet du traitement est important, c'est-à-dire  cohérence et valeurs de sortie sur toute la durée du traitement des données en streaming.  Il convient de noter que pour certaines tâches, il n'est pas nécessaire d'avoir un magasin d'état backend durable, et il serait bon de garantir exactement une fois. </p><br><blockquote>  Chez Streamlio, nous avons décidé qu'effectivement une fois est le meilleur terme pour décrire ces sémantiques de traitement. </blockquote><p>  Un exemple typique de saisie stupide de concepts: nous écrirons quelques exemples et de longs arguments pour un paragraphe entier, et à la fin nous ajouterons que «nous définissons ce concept de cette manière».  La précision et la clarté des définitions provoquent une réponse émotionnelle vraiment vive. </p><br><h2 id="vyvody">  Conclusions </h2><br><p>  La méconnaissance de l'essence des abstractions conduit à une distorsion de la signification originale des concepts existants et à la création ultérieure de nouveaux termes à partir de zéro. </p><br><p>  [1] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Exactement une fois n'est PAS exactement la même chose</a> . <br>  [2] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Traitement hétérogène des données concurrentielles en temps réel strictement une fois</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr419935/">https://habr.com/ru/post/fr419935/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr419925/index.html">Contrôle de version de fichiers individuels à l'aide de GitHub Gist</a></li>
<li><a href="../fr419927/index.html">[DotNetBook] Exceptions: Type Architecture du système</a></li>
<li><a href="../fr419929/index.html">[DotNetBook] Événements d'exception et comment obtenir StackOverflow et ExecutionEngineException à partir de zéro</a></li>
<li><a href="../fr419931/index.html">[DotNetBook] L'heure des histoires divertissantes: des situations exceptionnellement exceptionnelles</a></li>
<li><a href="../fr419933/index.html">Comment faire des recherches d'utilisateurs sur Github en utilisant Angular</a></li>
<li><a href="../fr419939/index.html">Comment j'ai rendu la navigation dans React Native pas si terrible</a></li>
<li><a href="../fr419941/index.html">Visite photo du bureau Audiomania: première partie</a></li>
<li><a href="../fr419943/index.html">Ce que nous lisons en juillet: comment trouver du temps pour lire, cinq livres pour le chef d'équipe et quelques articles frais</a></li>
<li><a href="../fr419945/index.html">Comment se préparer à un entretien sur Google et ne pas le passer. Deux fois</a></li>
<li><a href="../fr419947/index.html">Connectez-vous à PiZeroW avec Raspbian Stretch Lite, sans adaptateurs supplémentaires ni moniteur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>