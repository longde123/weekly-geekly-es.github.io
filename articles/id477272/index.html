<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏽‍✈️ 👀 ◽️ Pengantar pertama untuk AssemblyScript 🈺 ✌🏽 🍷</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dukungan untuk teknologi WebAssembly (Wasm) telah muncul di browser relatif baru-baru ini. Tetapi teknologi ini juga dapat memperluas kemampuan web, m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pengantar pertama untuk AssemblyScript</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/477272/">  Dukungan untuk <a href="https://webassembly.org/">teknologi WebAssembly</a> (Wasm) telah muncul di browser relatif baru-baru ini.  Tetapi teknologi ini juga dapat memperluas kemampuan web, menjadikannya sebuah platform yang mampu mendukung aplikasi seperti itu yang biasanya dianggap sebagai desktop. <br><br>  Menguasai WebAssembly bisa menjadi tugas yang menakutkan bagi pengembang web.  Namun, kompiler <a href="https://assemblyscript.org/">AssemblyScript</a> dapat memperbaiki situasi. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pw/p4/91/pwp491ryabgnwblabon5slwooey.jpeg"></div><br>  Penulis artikel, yang kami terbitkan hari ini, menawarkan pertama untuk berbicara tentang mengapa WebAssembly adalah teknologi yang sangat menjanjikan, dan kemudian untuk melihat bagaimana AssemblyScript dapat membantu membuka potensi Wasm. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Perakitan web</font> </h2><br>  WebAssembly dapat disebut bahasa tingkat rendah untuk browser.  Ini memberi pengembang kemampuan untuk membuat kode yang mengkompilasi menjadi sesuatu selain JavaScript.  Ini memungkinkan program yang dimasukkan dalam halaman web berfungsi hampir secepat aplikasi asli untuk berbagai platform.  Program semacam itu dijalankan dalam lingkungan yang terbatas dan aman. <br><br>  Perwakilan tim yang bertanggung jawab untuk pengembangan semua browser terkemuka (Chrome, Firefox, Safari dan Edge) terlibat dalam pembuatan standar WebAssembly.  Mereka menyetujui <a href="https://lists.w3.org/Archives/Public/public-webassembly/2017Feb/0002.html">arsitektur</a> sistem pada awal 2017.  Sekarang semua browser di atas mendukung WebAssembly.  Bahkan, teknologi ini dapat digunakan di <a href="https://caniuse.com/">sekitar 87%</a> browser. <br><br>  Kode WebAssembly ada dalam format biner.  Ini berarti bahwa kode tersebut lebih kecil dari kode JavaScript yang sama dan memuat lebih cepat.  Kode Wasm, selain itu, dapat disajikan dalam <a href="https://developer.mozilla.org/en-US/docs/WebAssembly/Understanding_the_text_format">format teks</a> , sehingga orang dapat membaca dan mengeditnya. <br><br>  Ketika standar WebAssembly pertama kali muncul, beberapa pengembang berpikir bahwa itu bisa menggantikan JavaScript dan menjadi bahasa utama web.  Tapi WebAssembly paling baik dilihat sebagai alat baru yang terintegrasi dengan baik dengan platform web yang ada.  Ini adalah salah satu <a href="https://webassembly.org/docs/high-level-goals/">tujuan prioritasnya</a> . <br><br>  Alih-alih mengganti JavaScript di mana bahasa ini telah digunakan untuk waktu yang lama dan berhasil, WebAssembly memberikan peluang menarik baru bagi pengembang web.  Benar, kode Wasm tidak memiliki akses langsung ke DOM, sehingga sebagian besar proyek web yang ada akan terus menggunakan JavaScript.  Bahasa ini, selama bertahun-tahun pengembangan dan optimalisasi, sudah cukup cepat.  Dan WebAssembly memiliki <a href="https://webassembly.org/docs/use-cases/">aplikasi</a> sendiri: <br><br><ul><li>  Game </li><li>  Perhitungan ilmiah, visualisasi, simulasi. </li><li>  Aplikasi CAD. </li><li>  Mengedit gambar dan video. </li></ul><br>  Semua penggunaan ini untuk Wasm dipersatukan oleh apa yang masing-masing aplikasi mereka biasanya dianggap sebagai desktop.  Tetapi karena kenyataan bahwa WebAssembly memungkinkan Anda untuk mencapai tingkat kinerja yang mendekati asli, banyak aplikasi serupa sekarang dapat diimplementasikan menggunakan platform web. <br><br>  WebAssembly dapat memanfaatkan proyek web yang ada.  Contohnya adalah proyek <a href="https://www.figma.com/">Figma</a> .  Berkat penggunaan Wasm, waktu pemuatan proyek ini meningkat secara signifikan.  Jika situs web menggunakan kode yang melakukan perhitungan berat, maka, untuk meningkatkan kinerja situs web ini, masuk akal untuk mengganti hanya kode tersebut dengan analog WebAssembly. <br><br>  Anda mungkin ingin mencoba menggunakan WebAssembly di proyek Anda sendiri.  Bahasa ini dapat dipelajari dan ditulis <a href="https://blog.scottlogic.com/2018/04/26/webassembly-by-hand.html">langsung di situ</a> .  Namun, bagaimanapun, WebAssembly awalnya dikembangkan sebagai <a href="https://github.com/appcypher/awesome-wasm-langs">target kompilasi</a> untuk bahasa lain.  Itu <a href="https://webassembly.org/docs/c-and-c%2B%2B/">dirancang</a> dengan dukungan yang baik untuk C dan C ++.  Dukungan <a href="">eksperimental</a> Wasm muncul di Go 1.11.  Banyak upaya yang dilakukan untuk menulis aplikasi Wasm di <a href="https://www.rust-lang.org/what/wasm">Rust</a> . <br><br>  Tetapi sangat mungkin bahwa pengembang web tidak ingin mempelajari C, C ++, Go, atau Rust hanya untuk menggunakan WebAssembly.  Apa yang mereka lakukan  Jawaban untuk pertanyaan ini dapat memberikan AssemblyScript. <br><br><h2>  <font color="#3AC1EF">AssemblyScript</font> </h2><br>  AssemblyScript adalah kompiler yang mengubah kode TypeScript ke kode WebAssembly.  TypeScript adalah bahasa yang dikembangkan oleh Microsoft.  Ini adalah superset dari JavaScript, menampilkan dukungan tipe yang ditingkatkan dan beberapa fitur lainnya.  TypeScript telah menjadi bahasa yang cukup <a href="https://insights.stackoverflow.com/survey/2019">populer</a> .  Perlu dicatat bahwa AssemblyScript mampu mengkonversi ke Wasm hanya set konstruksi TypeScript yang terbatas.  Ini berarti bahwa bahkan seseorang yang tidak terbiasa dengan TypeScript dapat dengan cepat mempelajari bahasa ini pada tingkat yang cukup untuk menulis kode yang dipahami oleh AssemblyScript. <br><br>  Selain itu, mengingat fakta bahwa TypeScript sangat mirip dengan JavaScript, kita dapat mengatakan bahwa teknologi AssemblyScript memungkinkan pengembang web untuk dengan mudah mengintegrasikan modul Wasm ke dalam proyek mereka tanpa perlu mempelajari bahasa yang sama sekali baru. <br><br><h2>  <font color="#3AC1EF">Contoh</font> </h2><br>  Mari kita menulis modul AssemblyScript pertama kami.  Semua kode yang akan kita diskusikan sekarang dapat ditemukan di <a href="https://github.com/dguo/assemblyscript-demo">GitHub</a> .  Untuk <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly">mendukung</a> WebAssembly, kita memerlukan setidaknya <a href="https://nodejs.org/">Node.js</a> 8. <br><br>  Buat direktori baru, inisialisasi proyek npm dan instal AssemblyScript: <br><br><pre><code class="javascript hljs">mkdir assemblyscript-demo cd assemblyscript-demo npm init npm install --save-dev github:AssemblyScript/assemblyscript</code> </pre> <br>  Perhatikan bahwa AssemblyScript harus diinstal langsung dari <a href="https://github.com/AssemblyScript/assemblyscript">repositori GitHub</a> proyek.  AssemblyScript belum diterbitkan dalam npm, karena pengembang <a href="https://github.com/AssemblyScript/assemblyscript/issues/442">belum menganggapnya</a> siap untuk digunakan secara luas. <br><br>  Kami akan membuat file tambahan menggunakan perintah <code>asinit</code> termasuk dalam AssemblyScript: <br><br><pre> <code class="javascript hljs">npx asinit .</code> </pre> <br>  Sekarang bagian <code>scripts</code> <code>package.json</code> kami harus mengambil bentuk berikut: <br><br><pre> <code class="javascript hljs">{  <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: {    <span class="hljs-string"><span class="hljs-string">"asbuild:untouched"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/untouched.wasm -t build/untouched.wat --sourceMap --validate --debug"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild:optimized"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/optimized.wasm -t build/optimized.wat --sourceMap --validate --optimize"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run asbuild:untouched &amp;&amp; npm run asbuild:optimized"</span></span>  } }</code> </pre> <br>  File <code>index.js</code> terletak di folder root proyek akan terlihat seperti ini: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"fs"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> compiled = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebAssembly.Module(fs.readFileSync(__dirname + <span class="hljs-string"><span class="hljs-string">"/build/optimized.wasm"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> imports = {  <span class="hljs-attr"><span class="hljs-attr">env</span></span>: {    abort(_msg, _file, line, column) {       <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(<span class="hljs-string"><span class="hljs-string">"abort called at index.ts:"</span></span> + line + <span class="hljs-string"><span class="hljs-string">":"</span></span> + column);    }  } }; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(<span class="hljs-built_in"><span class="hljs-built_in">module</span></span>, <span class="hljs-string"><span class="hljs-string">"exports"</span></span>, {  <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebAssembly.Instance(compiled, imports).exports });</code> </pre> <br>  Ini memungkinkan Anda untuk memasukkan modul WebAssembly dalam kode Anda menggunakan perintah need.  Yaitu - dengan cara yang sama seperti modul JavaScript biasa terhubung. <br><br>  Folder <code>assembly</code> berisi file <code>index.ts</code> .  Ini memiliki kode sumber yang ditulis sesuai dengan aturan AssemblyScript.  Kode boilerplate yang dihasilkan secara otomatis adalah fungsi sederhana untuk menambahkan dua angka: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a: i32, b: i32</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i32</span></span></span><span class="hljs-function"> </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b; }</code> </pre> <br>  Mungkin Anda mengharapkan tanda tangan dari fungsi yang mirip terlihat seperti <code>add(a: number, b: number): number</code> .  Jadi akan terlihat jika ditulis dalam TypeScript biasa.  Namun di sini, alih-alih tipe <code>number</code> , tipe <code>i32</code> .  Ini terjadi karena kode AssemblyScript menggunakan <a href="https://docs.assemblyscript.org/basics/types">tipe WebAssembly</a> spesifik untuk bilangan bulat dan angka floating point, daripada tipe <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html">angka</a> generik dari TypeScript. <br><br>  Mari kita kumpulkan proyek: <br><br><pre> <code class="javascript hljs">npm run asbuild</code> </pre> <br>  File-file berikut ini akan muncul di folder <code>build</code> : <br><br><pre> <code class="javascript hljs">optimized.wasm optimized.wasm.map optimized.wat untouched.wasm untouched.wasm.map untouched.wat</code> </pre> <br>  Ada versi perakitan yang dioptimalkan dan teratur.  Setiap versi majelis memberi kita file biner .wasm, <a href="https://developer.mozilla.org/en-US/docs/Tools/Debugger/How_to/Use_a_source_map">peta peta</a> .wasm.map, dan representasi tekstual dari kode biner dalam file .wat.  Presentasi pengujian kode Wasm dimaksudkan untuk programmer, tetapi kami bahkan tidak akan melihat file ini.  Sebenarnya, salah satu alasan untuk menggunakan AssemblyScript adalah karena menghilangkan kebutuhan untuk bekerja dengan kode Wasm. <br><br>  Sekarang mari kita jalankan Node.js dalam mode REPL dan pastikan bahwa modul Wasm yang dikompilasi dapat digunakan dengan cara yang sama seperti modul JS biasa: <br><br><pre> <code class="javascript hljs">$ node Welcome to Node.js v12<span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>. Type <span class="hljs-string"><span class="hljs-string">".help"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> more information. &gt; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> add = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./index'</span></span>).add; <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> &gt; add(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-number"><span class="hljs-number">8</span></span></code> </pre> <br>  Secara umum, ini semua yang diperlukan untuk menggunakan teknologi WebAssembly di Node.js. <br><br><h2>  <font color="#3AC1EF">Melengkapi proyek dengan naskah pengamat</font> </h2><br>  Untuk membangun kembali modul secara otomatis selama pengembangan ketika membuat perubahan, saya sarankan menggunakan paket <a href="https://github.com/Qard/onchange">onchange</a> .  Faktanya adalah bahwa AssemblyScript <a href="https://github.com/AssemblyScript/assemblyscript/issues/624">belum</a> memiliki sistem sendiri untuk memonitor perubahan file.  Instal paket onchange: <br><br><pre> <code class="javascript hljs">npm install --save-dev onchange</code> </pre> <br>  Tambahkan <code>asbuild:watch</code> script ke <code>package.json</code> .  <a href="https://github.com/Qard/onchange">Bendera</a> <code>-i</code> disertakan dalam perintah sehingga proses pembangunan dimulai satu kali ketika skrip dipanggil, sebelum semua peristiwa terjadi. <br><br><pre> <code class="javascript hljs">{  <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: {    <span class="hljs-string"><span class="hljs-string">"asbuild:untouched"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/untouched.wasm -t build/untouched.wat --sourceMap --validate --debug"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild:optimized"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/optimized.wasm -t build/optimized.wat --sourceMap --validate --optimize"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run asbuild:untouched &amp;&amp; npm run asbuild:optimized"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild:watch"</span></span>: <span class="hljs-string"><span class="hljs-string">"onchange -i 'assembly/**/*' -- npm run asbuild"</span></span>  } }</code> </pre> <br>  Sekarang, alih-alih terus menjalankan perintah <code>asbuild</code> , jalankan saja <code>asbuild:watch</code> sekali. <br><br><h2>  <font color="#3AC1EF">Performa</font> </h2><br>  Kami akan menulis tes sederhana yang akan mengevaluasi tingkat kinerja kode Wasm.  Ruang lingkup utama WebAssembly adalah untuk menyelesaikan tugas-tugas yang menggunakan prosesor secara intensif.  Sebagai contoh, ini adalah semacam perhitungan "berat".  Mari kita membuat fungsi yang mencari tahu apakah angka tertentu adalah prima. <br><br>  Implementasi JS dasar dari fungsi serupa ditunjukkan di bawah ini.  Ini diatur dengan sangat sederhana, memeriksa angka dengan kekerasan, tetapi untuk tujuan kami ini cocok, karena melakukan perhitungan dalam jumlah besar. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPrime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function">) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;    }    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; x; i++) {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x % i === <span class="hljs-number"><span class="hljs-number">0</span></span>) {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;        }    }    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br>  Fungsi serupa, ditulis untuk kompiler AssemblyScript, terlihat hampir sama.  Perbedaan utama adalah adanya anotasi jenis dalam kode: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPrime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x: u32</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-function"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;    }    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i: u32 = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; x; i++) {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x % i === <span class="hljs-number"><span class="hljs-number">0</span></span>) {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;        }    }    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br>  Untuk menganalisis kinerja kode, kami akan menggunakan paket <a href="https://benchmarkjs.com/">Benchmark.js</a> .  Pasang itu: <br><br><pre> <code class="javascript hljs">npm install --save-dev benchmark</code> </pre> <br>  Buat file <code>benchmark.js</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Benchmark = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'benchmark'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> assemblyScriptIsPrime = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./index'</span></span>).isPrime; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPrime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function">) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; x; i++) {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x % i === <span class="hljs-number"><span class="hljs-number">0</span></span>) {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;        }    }    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> suite = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Benchmark.Suite; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> startNumber = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> stopNumber = <span class="hljs-number"><span class="hljs-number">10000</span></span>; suite.add(<span class="hljs-string"><span class="hljs-string">'AssemblyScript isPrime'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = startNumber; i &lt; stopNumber; i++) {        assemblyScriptIsPrime(i);    } }).add(<span class="hljs-string"><span class="hljs-string">'JavaScript isPrime'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = startNumber; i &lt; stopNumber; i++) {        isPrime(i);    } }).on(<span class="hljs-string"><span class="hljs-string">'cycle'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{    <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>(event.target)); }).on(<span class="hljs-string"><span class="hljs-string">'complete'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fastest = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.filter(<span class="hljs-string"><span class="hljs-string">'fastest'</span></span>);    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> slowest = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.filter(<span class="hljs-string"><span class="hljs-string">'slowest'</span></span>);    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> difference = (fastest.map(<span class="hljs-string"><span class="hljs-string">'hz'</span></span>) - slowest.map(<span class="hljs-string"><span class="hljs-string">'hz'</span></span>)) / slowest.map(<span class="hljs-string"><span class="hljs-string">'hz'</span></span>) * <span class="hljs-number"><span class="hljs-number">100</span></span>;    <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${fastest.map(</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'name'</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string"> is ~</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${difference.toFixed(</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">1</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">% faster.`</span></span>); }).run();</code> </pre> <br>  Inilah yang saya berhasil dapatkan setelah menjalankan perintah <code>node benchmark</code> di komputer saya: <br><br><pre> <code class="javascript hljs">AssemblyScript isPrime x <span class="hljs-number"><span class="hljs-number">74.00</span></span> ops/sec ±<span class="hljs-number"><span class="hljs-number">0.43</span></span>% (<span class="hljs-number"><span class="hljs-number">76</span></span> runs sampled) JavaScript isPrime x <span class="hljs-number"><span class="hljs-number">61.56</span></span> ops/sec ±<span class="hljs-number"><span class="hljs-number">0.30</span></span>% (<span class="hljs-number"><span class="hljs-number">64</span></span> runs sampled) AssemblyScript isPrime is ~<span class="hljs-number"><span class="hljs-number">20.2</span></span>% faster.</code> </pre> <br>  Seperti yang Anda lihat, implementasi AssemblyScript dari algoritma itu 20% lebih cepat daripada implementasi JS.  Namun, perhatikan bahwa tes ini adalah <a href="https://stackoverflow.com/a/2842707/1481479">microbenchmark</a> .  Jangan terlalu mengandalkan hasilnya. <br><br>  Untuk menemukan hasil yang lebih dapat diandalkan dari penelitian kinerja proyek-proyek AssemblyScript - Saya sarankan melihat <a href="https://wasmboy.app/benchmark/">ini</a> dan tolok ukur <a href="https://jtiscione.github.io/webassembly-wave/index.html">ini</a> . <br><br><h2>  <font color="#3AC1EF">Menggunakan Modul Wasm di Halaman Web</font> </h2><br>  Mari kita gunakan modul Wasm kami di halaman web.  Kami mulai dengan membuat file <code>index.html</code> dengan konten berikut: <br><br><pre> <code class="javascript hljs">&lt;!DOCTYPE html&gt; &lt;html&gt;    &lt;head&gt;        &lt;meta charset="utf-8" /&gt;        &lt;title&gt;AssemblyScript isPrime demo&lt;/title&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;form id="prime-checker"&gt;            &lt;label for="number"&gt;Enter a number to check if it is prime:&lt;/label&gt;            &lt;input name="number" type="number" /&gt;            &lt;button type="submit"&gt;Submit&lt;/button&gt;        &lt;/form&gt;        &lt;p id="result"&gt;&lt;/p&gt;        &lt;script src="demo.js"&gt;&lt;/script&gt;    &lt;/body&gt; &lt;/html&gt;</code> </pre> <br>  Sekarang buat file <code>demo.js</code> yang kodenya ditunjukkan di bawah ini.  Ada <a href="https://developers.google.com/web/updates/2018/04/loading-wasm">banyak cara untuk</a> memuat modul WebAssembly.  Yang paling efisien adalah mengkompilasi dan menginisialisasi mereka dalam mode streaming menggunakan fungsi <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly/instantiateStreaming">WebAssembly.instantiateStreaming</a> .  Harap perhatikan bahwa kami perlu mendefinisikan kembali fungsi <a href="https://docs.assemblyscript.org/details/debugging">batal</a> , yang dipanggil jika beberapa <a href="https://docs.assemblyscript.org/basics/environment">pernyataan</a> tidak dieksekusi. <br><br><pre> <code class="javascript hljs">(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; {    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> importObject = {        <span class="hljs-attr"><span class="hljs-attr">env</span></span>: {            abort(_msg, _file, line, column) {                <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(<span class="hljs-string"><span class="hljs-string">"abort called at index.ts:"</span></span> + line + <span class="hljs-string"><span class="hljs-string">":"</span></span> + column);            }        }    };    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> WebAssembly.instantiateStreaming(        fetch(<span class="hljs-string"><span class="hljs-string">"build/optimized.wasm"</span></span>),        importObject    );    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isPrime = <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.instance.exports.isPrime;    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">"#result"</span></span>);    <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">"#prime-checker"</span></span>).addEventListener(<span class="hljs-string"><span class="hljs-string">"submit"</span></span>, event =&gt; {        event.preventDefault();        result.innerText = <span class="hljs-string"><span class="hljs-string">""</span></span>;        <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> number = event.target.elements.number.value;        result.innerText = <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${number}</span></span></span><span class="hljs-string"> is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${isPrime(number) ? </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">''</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> : </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'not '</span></span></span></span><span class="hljs-string"><span class="hljs-subst">}</span></span></span><span class="hljs-string">prime.`</span></span>;    }); })();</code> </pre> <br>  Selanjutnya, instal paket <a href="https://github.com/nbluis/static-server">server statis</a> .  Kita memerlukan server karena fakta bahwa untuk menggunakan fungsi <code>WebAssembly.instantiateStreaming</code> , modul harus diservis menggunakan <code>application/wasm</code> MIME <code>application/wasm</code> . <br><br><pre> <code class="javascript hljs">npm install --save-dev <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>-server</code> </pre> <br>  Tambahkan skrip yang sesuai ke <code>package.json</code> : <br><br><pre> <code class="javascript hljs">{  <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: {    <span class="hljs-string"><span class="hljs-string">"serve-demo"</span></span>: <span class="hljs-string"><span class="hljs-string">"static-server"</span></span>  } }</code> </pre> <br>  Sekarang <code>npm run serve-demo</code> dan buka URL host lokal di browser.  Jika Anda memasukkan nomor tertentu dalam formulir, Anda dapat mengetahui apakah itu sederhana atau tidak.  Sekarang, dalam mengembangkan AssemblyScript, kita telah jauh dari menulis kode untuk menggunakannya di Node.js dan di halaman web. <br><br><h2>  <font color="#3AC1EF">Ringkasan</font> </h2><br>  WebAssembly, dan karenanya AssemblyScript, tidak dapat entah bagaimana mempercepat situs apa pun secara ajaib.  Tapi Wasm tidak pernah ditugaskan untuk mempercepat segalanya.  Teknologi ini luar biasa karena membuka jalan ke web untuk aplikasi jenis baru. <br><br>  Hal serupa dapat dikatakan tentang AssemblyScript.  Teknologi ini menyederhanakan akses ke WebAssembly untuk sejumlah besar pengembang.  Hal ini memungkinkan, ketika membuat kode dalam bahasa yang dekat dengan JavaScript, untuk menggunakan kemampuan WebAssembly untuk memecahkan masalah komputasi yang kompleks. <br><br>  <b>Pembaca yang budiman!</b>  Bagaimana Anda menilai prospek untuk menggunakan AssemblyScript di proyek Anda? <br><br><div style="text-align:center;"> <a href="https://ruvds.com/vps_start/"><img src="https://habrastorage.org/webt/-o/2e/tu/-o2etuqogwhmdnmysb9_vivc9v4.png"></a> </div><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id477272/">https://habr.com/ru/post/id477272/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id477256/index.html">Peluncuran OneWeb penuh pertama pada kendaraan peluncuran Soyuz ditunda tahun depan, serta peluncuran kendaraan peluncuran Angara</a></li>
<li><a href="../id477262/index.html">Android dari perusahaan Promobot. Tampak samping</a></li>
<li><a href="../id477264/index.html">Ekskavator berubah menjadi robot otonom yang mampu menggali parit secara mandiri</a></li>
<li><a href="../id477266/index.html">Intisari bahan-bahan segar dari dunia front-end untuk minggu terakhir No. 390 (18-24 November, 2019)</a></li>
<li><a href="../id477268/index.html">Cari optimasi solusi di github</a></li>
<li><a href="../id477274/index.html">Bagaimana Anda menyingkirkan kode CSS yang tidak digunakan? Bagian 1</a></li>
<li><a href="../id477276/index.html">Bagaimana Anda menyingkirkan kode CSS yang tidak digunakan? Bagian 2</a></li>
<li><a href="../id477278/index.html">Pengujian frontend</a></li>
<li><a href="../id477282/index.html">Membuat profil Pergi kode proyek dan menyelesaikan masalah alokasi memori</a></li>
<li><a href="../id477284/index.html">Mengapa JavaScript diperlukan mode ketat?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>