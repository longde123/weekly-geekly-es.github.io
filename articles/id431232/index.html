<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§í üòº üõåüèæ Kami menghasilkan placeholder SVG yang indah di Node.js üç© üç† üìÆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Menggunakan gambar SVG sebagai pengganti adalah ide yang sangat bagus, terutama di dunia kita, ketika hampir semua situs terdiri dari banyak gambar ya...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kami menghasilkan placeholder SVG yang indah di Node.js</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431232/"><p><img src="https://habrastorage.org/webt/ko/6n/vo/ko6nvoj9m3q1bdzvbeogrcbt09i.jpeg"></p><br><p> Menggunakan gambar SVG sebagai pengganti adalah ide yang sangat bagus, terutama di dunia kita, ketika hampir semua situs terdiri dari banyak gambar yang kami coba muat secara tidak sinkron.  Semakin banyak gambar dan semakin banyak gambarnya, semakin tinggi kemungkinan mendapatkan berbagai masalah, mulai dari kenyataan bahwa pengguna tidak cukup memahami apa yang dimuat di sana, dan diakhiri dengan lompatan terkenal dari seluruh antarmuka setelah memuat gambar.  Terutama pada Internet yang buruk dari ponsel Anda - ia dapat terbang di beberapa layar.  Pada saat itulah bertopik datang untuk menyelamatkan.  Opsi lain untuk penggunaannya adalah sensor.  Ada saat-saat ketika Anda perlu menyembunyikan gambar dari pengguna, tetapi saya ingin menjaga gaya keseluruhan halaman, warna dan tempat gambar itu ditempati. </p><br><p>  Tetapi di sebagian besar artikel, semua orang berbicara tentang teori, bahwa akan lebih baik untuk memasukkan semua gambar rintisan ini ke halaman-halaman di-line, dan hari ini kita akan melihat dalam praktiknya bagaimana Anda dapat menghasilkan mereka sesuai dengan selera dan warna Anda menggunakan Node.js.  Kami akan membuat template setang dari gambar SVG dan mengisinya dengan cara yang berbeda, dari pengisian sederhana dengan warna atau gradien hingga triangulasi, mosaik Voronoi, dan menggunakan filter.  Semua tindakan akan disortir dalam langkah-langkah.  Saya percaya artikel ini akan menarik bagi pemula yang tertarik pada bagaimana hal ini dilakukan dan memerlukan analisis tindakan yang terperinci, tetapi pengembang yang berpengalaman mungkin juga menyukai beberapa ide. </p><a name="habracut"></a><br><h2 id="podgotovka">  Persiapan </h2><br><p> Untuk memulainya, kita akan pergi ke repositori tanpa dasar dari semua jenis barang yang disebut NPM.  Karena tugas menghasilkan gambar rintisan kami melibatkan pembuatan satu kali gambar di sisi server (atau bahkan di mesin pengembang, jika kita berbicara tentang situs yang kurang lebih statis), kami tidak akan berurusan dengan optimasi prematur.  Kami akan menghubungkan semua yang kami suka.  Jadi, kita mulai dengan mantra <code>npm init</code> dan melanjutkan dengan pemilihan dependensi. </p><br><p>  Sebagai permulaan, ini adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ColorThief</a> .  Anda mungkin sudah pernah mendengar tentang dia.  Perpustakaan indah yang dapat mengisolasi palet warna dari warna yang paling sering digunakan dalam gambar.  Kami hanya butuh sesuatu seperti itu sebagai permulaan. </p><br><pre> <code class="plaintext hljs">npm i --save color-thief</code> </pre> <br><p>  Saat memasang paket ini di Linux, ada masalah - beberapa paket cairo hilang, yang tidak ada di direktori NPM.  Kesalahan aneh ini diselesaikan dengan menginstal versi pengembangan beberapa perpustakaan: </p><br><pre> <code class="plaintext hljs">sudo apt install libcairo2-dev libjpeg-dev libgif-dev</code> </pre> <br><p>  Cara kerja alat ini akan ditonton dalam proses.  Tetapi tidak akan berlebihan untuk segera menghubungkan paket rgb-hex untuk mengubah format warna dari RGB ke Hex, yang jelas dari namanya.  Kami tidak akan terlibat dalam bersepeda dengan fungsi sederhana seperti itu. </p><br><pre> <code class="plaintext hljs">npm i --save rgb-hex</code> </pre> <br><blockquote>  Dari sudut pandang pelatihan, adalah berguna untuk menulis hal-hal seperti itu sendiri, tetapi ketika ada tugas untuk dengan cepat mengumpulkan prototipe yang berfungsi minimal, maka menghubungkan segala sesuatu yang berasal dari katalog NPM adalah ide yang bagus.  Menghemat banyak waktu. </blockquote><p>  Salah satu parameter terpenting untuk busi adalah proporsi.  Mereka harus cocok dengan proporsi gambar asli.  Oleh karena itu, kita perlu mengetahui ukurannya.  Kami akan menggunakan paket ukuran gambar untuk menyelesaikan masalah ini. </p><br><pre> <code class="plaintext hljs">npm i --save image-size</code> </pre> <br><p>  Karena kami akan mencoba membuat versi gambar yang berbeda dan semuanya akan dalam format SVG, dengan satu atau lain cara akan muncul pertanyaan tentang templat untuk mereka.  Anda tentu saja bisa mengelak dengan string pola di JS, tetapi mengapa semua ini?  Lebih baik menggunakan mesin templat "normal".  Misalnya, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">setang</a> .  Sederhana dan enak, karena tugas kita akan tepat. </p><br><pre> <code class="plaintext hljs">npm i --save handlebars</code> </pre> <br><p>  Kami tidak akan segera mengatur semacam arsitektur kompleks untuk percobaan ini.  Kami membuat file main.js dan mengimpor semua dependensi kami di sana, serta modul untuk bekerja dengan sistem file. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ColorThief = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'color-thief'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Handlebars = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'handlebars'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rgbHex = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'rgb-hex'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> sizeOf = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'image-size'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>);</code> </pre> <br><p>  ColorThief membutuhkan inisialisasi tambahan </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> thief = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ColorThief();</code> </pre> <br><p>  Menggunakan dependensi yang kami sambungkan, menyelesaikan masalah "mengunggah gambar ke skrip" dan "mendapatkan ukurannya" tidak sulit.  Katakanlah kita memiliki gambar 1.jpg: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> image = fs.readFileSync(<span class="hljs-string"><span class="hljs-string">'1.jpg'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> size = sizeOf(<span class="hljs-string"><span class="hljs-string">'1.jpg'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> height = size.height; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> width = size.width;</code> </pre> <br><p>  Bagi orang yang tidak terbiasa dengan Node.js, ada baiknya mengatakan bahwa hampir semua yang terkait dengan sistem file dapat terjadi secara sinkron atau asinkron.  Untuk metode sinkron, "Sinkronkan" ditambahkan di akhir nama.  Kami akan menggunakannya agar tidak mengalami komplikasi yang tidak perlu dan tidak memutar otak kami secara tiba-tiba. </p><br><p>  Mari kita beralih ke contoh pertama. </p><br><h2 id="zalivka-cvetom">  Isi warna </h2><br><p><img src="https://habrastorage.org/webt/xa/1p/7g/xa1p7gmnqwkm9rcdntn9qbtnrjm.jpeg"></p><br><p>  Untuk memulainya, kita akan memecahkan masalah pengisian persegi panjang sederhana.  Gambar kami akan memiliki tiga parameter - lebar, tinggi dan warna isi.  Kami membuat gambar SVG dengan persegi panjang, tetapi alih-alih nilai-nilai ini kami mengganti pasangan tanda kurung dan nama bidang yang akan berisi data yang dikirimkan dari skrip.  Anda mungkin sudah melihat sintaks ini dengan HTML tradisional (misalnya, Vue menggunakan sesuatu yang serupa), tetapi tidak ada yang mengganggu untuk menggunakannya dengan gambar SVG - mesin template tidak peduli apa yang akan terjadi dalam jangka panjang.  Teksnya adalah dia dan teks di Afrika. </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'1.1'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'http://www.w3.org/2000/svg'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">viewBox</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0 0 100 100'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">preserveAspectRatio</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'none'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ height }}'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ width }}'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rect</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'100'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'100'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fill</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ color }}'</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Lebih lanjut ColorThief memberi kita salah satu warna yang paling umum, dalam contoh itu adalah abu-abu.  Untuk menggunakan templat, kita membaca file dengan itu, katakan setang sehingga perpustakaan ini mengkompilasinya dan kemudian kita menghasilkan garis dengan rintisan SVG yang sudah jadi.  Mesin template itu sendiri menggantikan data kami (warna dan ukuran) di tempat yang tepat. </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateOneColor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rgb = thief.getColor(image); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> color = <span class="hljs-string"><span class="hljs-string">'#'</span></span> + rgbHex(...rgb); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> template = Handlebars.compile(fs.readFileSync(<span class="hljs-string"><span class="hljs-string">'template-one-color.svg'</span></span>, <span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> svg = template({ height, width, color }); fs.writeFileSync(<span class="hljs-string"><span class="hljs-string">'1-one-color.svg'</span></span>, svg, <span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>); }</code> </pre> <br><p>  Tetap hanya menulis hasilnya ke file.  Seperti yang Anda lihat, bekerja dengan SVG cukup bagus - semua file adalah teks, Anda dapat dengan mudah membaca dan menulisnya.  Hasilnya adalah gambar persegi panjang.  Tidak ada yang menarik, tetapi setidaknya kami memastikan bahwa pendekatan itu berhasil (tautan ke sumber lengkap akan ada di akhir artikel). </p><br><h2 id="zalivka-gradientom">  Isi gradien </h2><br><p>  Menggunakan gradien adalah pendekatan yang lebih menarik.  Di sini kita dapat menggunakan beberapa warna umum dari gambar dan membuat transisi yang mulus dari satu ke yang lain.  Ini kadang-kadang dapat ditemukan di situs yang memuat gambar pita panjang. </p><br><p><img src="https://habrastorage.org/webt/_e/hk/dp/_ehkdpgdhchgknqkcvbadu8dwpq.jpeg"></p><br><p>  Template SVG kami sekarang telah diperluas dengan gradien ini.  Sebagai contoh, kita akan menggunakan gradien linier biasa.  Kami hanya tertarik pada dua parameter - warna di awal dan warna di akhir: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">defs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">linearGradient</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'my-gradient'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x1</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0%'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">y1</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0%'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x2</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'100%'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">y2</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0%'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">gradientTransform</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'rotate(45)'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stop</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">offset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0%'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'stop-color:{{ startColor }};stop-opacity:1'</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stop</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">offset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'100%'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'stop-color:{{ endColor }};stop-opacity:1'</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">linearGradient</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">defs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rect</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'100'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'100'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fill</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'url(#my-gradient)'</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br><p>  Warna itu sendiri diperoleh dengan menggunakan ColorThief yang sama.  Ini memiliki dua mode operasi - baik itu memberi kita satu warna primer, atau palet dengan jumlah warna yang kita tentukan.  Cukup nyaman.  Untuk gradien, kita perlu dua warna. </p><br><p>  Kalau tidak, contoh ini mirip dengan yang sebelumnya: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateGradient</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> palette = thief.getPalette(image, <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> startColor = <span class="hljs-string"><span class="hljs-string">'#'</span></span> + rgbHex(...palette[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> endColor = <span class="hljs-string"><span class="hljs-string">'#'</span></span> + rgbHex(...palette[<span class="hljs-number"><span class="hljs-number">1</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> template = Handlebars.compile(fs.readFileSync(<span class="hljs-string"><span class="hljs-string">'template-gradient.svg'</span></span>, <span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> svg = template({ height, width, startColor, endColor }); <span class="hljs-comment"><span class="hljs-comment">// . . .</span></span></code> </pre> <br><p>  Dengan cara ini, Anda dapat membuat semua jenis gradien - tidak harus linier.  Tapi tetap saja ini hasil yang agak membosankan.  Akan lebih bagus untuk membuat semacam mosaik yang akan menyerupai gambar aslinya. </p><br><h2 id="mozaika-iz-pryamougolnikov">  Mosaik persegi panjang </h2><br><p>  Untuk memulai, mari kita membuat banyak persegi panjang dan mengisinya dengan warna dari palet yang akan diberikan perpustakaan yang sama kepada kita. </p><br><p><img src="https://habrastorage.org/webt/l6/w2/hd/l6w2hd1l4bgc-pand_tz2gixe3s.jpeg"></p><br><p>  Setang dapat melakukan banyak hal berbeda, khususnya memiliki siklus.  Kami akan memberinya array koordinat dan warna, dan kemudian dia akan mengetahuinya.  Kami hanya membungkus persegi panjang kami di templat di masing-masing: </p><br><pre> <code class="xml hljs">{{# each rects }} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rect</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ x }}'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ y }}'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'11'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'11'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fill</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ color }}'</span></span></span><span class="hljs-tag"> /&gt;</span></span> {{/each }}</code> </pre> <br><p>  Dengan demikian, dalam skrip itu sendiri, kita sekarang memiliki palet warna penuh, loop melalui koordinat X / Y dan membuat persegi panjang dengan warna acak dari palet.  Semuanya cukup sederhana: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateMosaic</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> palette = thief.getPalette(image, <span class="hljs-number"><span class="hljs-number">16</span></span>); palette.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">color, index</span></span></span><span class="hljs-function">) </span></span>{ palette[index] = <span class="hljs-string"><span class="hljs-string">'#'</span></span> + rgbHex(...color); }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rects = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; x += <span class="hljs-number"><span class="hljs-number">10</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>; y &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; y += <span class="hljs-number"><span class="hljs-number">10</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> color = palette[<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random() * <span class="hljs-number"><span class="hljs-number">15</span></span>)]; rects.push({ x, y, color }); } } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> template = Handlebars.compile(fs.readFileSync(<span class="hljs-string"><span class="hljs-string">'template-mosaic.svg'</span></span>, <span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> svg = template({ height, width, rects }); <span class="hljs-comment"><span class="hljs-comment">// . . .</span></span></code> </pre><br><p>  Tentunya, mozaik, meski warnanya mirip dengan gambar, tetapi dengan penataan warna, semuanya tidak sama sekali seperti yang kita inginkan.  Kemampuan ColorThief di bidang ini terbatas.  Saya ingin mendapatkan mosaik di mana gambar aslinya akan ditebak, dan bukan hanya satu set batu bata dengan warna yang kurang lebih sama. </p><br><h2 id="uluchshaem-mozaiku">  Memperbaiki mosaik </h2><br><p>  Di sini kita harus sedikit lebih dalam dan mendapatkan warna dari piksel dalam gambar ... </p><br><p><img src="https://habrastorage.org/webt/qf/mt/60/qfmt60p4wqhi0yil0r28wtdjskq.jpeg"></p><br><p>  Karena kami jelas tidak memiliki kanvas di konsol tempat kami biasanya mendapatkan data ini, kami akan menggunakan bantuan dalam bentuk paket get-pixel.  Dia dapat menarik informasi yang diperlukan dari buffer dengan gambar yang sudah kita miliki. </p><br><pre> <code class="plaintext hljs">npm i --save get-pixels</code> </pre> <br><p>  Akan terlihat seperti ini: </p><br><pre> <code class="javascript hljs">getPixels(image, <span class="hljs-string"><span class="hljs-string">'image/jpg'</span></span>, (err, pixels) =&gt; { <span class="hljs-comment"><span class="hljs-comment">// . . . });</span></span></code> </pre> <br><p>  Kami mendapatkan objek yang berisi bidang data - array piksel, sama seperti yang kami dapatkan dari kanvas.  Biarkan saya mengingatkan Anda bahwa untuk mendapatkan warna piksel dengan koordinat (X, Y), Anda perlu membuat perhitungan sederhana: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pixelPosition = <span class="hljs-number"><span class="hljs-number">4</span></span> * (y * width + x); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rgb = [ pixels.data[pixelPosition], pixels.data[pixelPosition + <span class="hljs-number"><span class="hljs-number">1</span></span>], pixels.data[pixelPosition + <span class="hljs-number"><span class="hljs-number">2</span></span>] ];</code> </pre> <br><p>  Jadi, untuk setiap persegi panjang kita dapat mengambil warna bukan dari palet, tetapi langsung dari gambar, dan menggunakannya.  Anda akan mendapatkan sesuatu seperti ini (hal utama di sini adalah jangan lupa bahwa koordinat dalam gambar berbeda dari "dinormalisasi" kami dari 0 hingga 100): </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateImprovedMosaic</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ getPixels(image, <span class="hljs-string"><span class="hljs-string">'image/jpg'</span></span>, (err, pixels) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(err); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rects = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; x += <span class="hljs-number"><span class="hljs-number">5</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> realX = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(x * width / <span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>; y &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; y += <span class="hljs-number"><span class="hljs-number">5</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> realY = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(y * height / <span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pixelPosition = <span class="hljs-number"><span class="hljs-number">4</span></span> * (realY * width + realX); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rgb = [ pixels.data[pixelPosition], pixels.data[pixelPosition + <span class="hljs-number"><span class="hljs-number">1</span></span>], pixels.data[pixelPosition + <span class="hljs-number"><span class="hljs-number">2</span></span>] ]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> color = <span class="hljs-string"><span class="hljs-string">'#'</span></span> + rgbHex(...rgb); rects.push({ x, y, color }); } } <span class="hljs-comment"><span class="hljs-comment">// . . .</span></span></code> </pre> <br><p>  Untuk kecantikan yang lebih besar, kita dapat sedikit meningkatkan jumlah "batu bata", mengurangi ukurannya.  Karena kami tidak meneruskan ukuran ini ke templat (tentu saja, ada baiknya menjadikannya parameter yang sama dengan lebar atau tinggi gambar), kami akan mengubah nilai ukuran dalam templat itu sendiri: </p><br><pre> <code class="xml hljs">{{# each rects }} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rect</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ x }}'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ y }}'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'6'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'6'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fill</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ color }}'</span></span></span><span class="hljs-tag"> /&gt;</span></span> {{/each }}</code> </pre> <br><p>  Sekarang kami memiliki mosaik yang benar-benar terlihat seperti gambar asli, tetapi pada saat yang sama memakan banyak ruang lebih sedikit. </p><br><blockquote>  Jangan lupa bahwa GZIP memampatkan urutan berulang dalam file teks dengan baik, sehingga saat mentransfer ke browser, ukuran pratinjau seperti itu akan menjadi lebih kecil. </blockquote><p>  Tapi mari kita lanjutkan. </p><br><h2 id="triangulyaciya">  Triangulasi </h2><br><p><img src="https://habrastorage.org/webt/by/h7/dq/byh7dqqiigv_3v5ayf-1lw8deyw.jpeg"></p><br><p>  Persegi panjang itu baik, tetapi segitiga biasanya memberikan hasil yang jauh lebih menarik.  Jadi mari kita coba membuat mosaik dari tumpukan segitiga.  Ada beberapa pendekatan untuk masalah ini, kami akan menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">triangulasi Delaunay</a> : </p><br><pre> <code class="plaintext hljs">npm i --save delaunay-triangulate</code> </pre> <br><p>  Keuntungan utama dari algoritma yang akan kita gunakan adalah bahwa ia menghindari segitiga dengan sudut yang sangat tajam dan tumpul bila memungkinkan.  Untuk gambar yang indah, kita tidak perlu segitiga yang sempit dan panjang. </p><br><blockquote>  Ini adalah salah satu momen ketika berguna untuk mengetahui algoritma matematika apa yang ada di bidang kita dan apa perbedaannya.  Tidak perlu mengingat semua implementasi mereka, tetapi setidaknya berguna untuk mengetahui apa yang harus google. </blockquote><p>  Bagilah tugas kami menjadi yang lebih kecil.  Pertama, Anda perlu menghasilkan poin untuk simpul segitiga.  Dan akan menyenangkan untuk menambahkan beberapa keacakan pada koordinat mereka: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateTriangulation</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// . . . const basePoints = []; for (let x = 0; x &lt;= 100; x += 5) { for (let y = 0; y &lt;= 100; y += 5) { const point = [x, y]; if ((x &gt;= 5) &amp;&amp; (x &lt;= 95)) { point[0] += Math.floor(10 * Math.random() - 5); } if ((y &gt;= 5) &amp;&amp; (y &lt;= 95)) { point[1] += Math.floor(10 * Math.random() - 5); } basePoints.push(point); } } const triangles = triangulate(basePoints); // . . .</span></span></code> </pre> <br><p>  Setelah meninjau struktur array dengan segitiga (console.log untuk membantu kami), kami menemukan diri kami sendiri titik di mana kami akan mengambil warna piksel.  Anda bisa menghitung rata-rata aritmatika untuk koordinat simpul segitiga.  Kemudian kita memindahkan titik ekstra dari batas ekstrim sehingga mereka tidak keluar di mana pun dan, setelah menerima koordinat nyata, tidak dinormalisasi, kita mendapatkan warna piksel, yang akan menjadi warna segitiga. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> polygons = []; triangles.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">triangle</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> x = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor((basePoints[triangle[<span class="hljs-number"><span class="hljs-number">0</span></span>]][<span class="hljs-number"><span class="hljs-number">0</span></span>] + basePoints[triangle[<span class="hljs-number"><span class="hljs-number">1</span></span>]][<span class="hljs-number"><span class="hljs-number">0</span></span>] + basePoints[triangle[<span class="hljs-number"><span class="hljs-number">2</span></span>]][<span class="hljs-number"><span class="hljs-number">0</span></span>]) / <span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> y = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor((basePoints[triangle[<span class="hljs-number"><span class="hljs-number">0</span></span>]][<span class="hljs-number"><span class="hljs-number">1</span></span>] + basePoints[triangle[<span class="hljs-number"><span class="hljs-number">1</span></span>]][<span class="hljs-number"><span class="hljs-number">1</span></span>] + basePoints[triangle[<span class="hljs-number"><span class="hljs-number">2</span></span>]][<span class="hljs-number"><span class="hljs-number">1</span></span>]) / <span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x === <span class="hljs-number"><span class="hljs-number">100</span></span>) { x = <span class="hljs-number"><span class="hljs-number">99</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (y === <span class="hljs-number"><span class="hljs-number">100</span></span>) { y = <span class="hljs-number"><span class="hljs-number">99</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> realX = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(x * width / <span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> realY = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(y * height / <span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pixelPosition = <span class="hljs-number"><span class="hljs-number">4</span></span> * (realY * width + realX); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rgb = [ pixels.data[pixelPosition], pixels.data[pixelPosition + <span class="hljs-number"><span class="hljs-number">1</span></span>], pixels.data[pixelPosition + <span class="hljs-number"><span class="hljs-number">2</span></span>] ]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> color = <span class="hljs-string"><span class="hljs-string">'#'</span></span> + rgbHex(...rgb); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> points = <span class="hljs-string"><span class="hljs-string">' '</span></span> + basePoints[triangle[<span class="hljs-number"><span class="hljs-number">0</span></span>]][<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-string"><span class="hljs-string">','</span></span> + basePoints[triangle[<span class="hljs-number"><span class="hljs-number">0</span></span>]][<span class="hljs-number"><span class="hljs-number">1</span></span>] + <span class="hljs-string"><span class="hljs-string">' '</span></span> + basePoints[triangle[<span class="hljs-number"><span class="hljs-number">1</span></span>]][<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-string"><span class="hljs-string">','</span></span> + basePoints[triangle[<span class="hljs-number"><span class="hljs-number">1</span></span>]][<span class="hljs-number"><span class="hljs-number">1</span></span>] + <span class="hljs-string"><span class="hljs-string">' '</span></span> + basePoints[triangle[<span class="hljs-number"><span class="hljs-number">2</span></span>]][<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-string"><span class="hljs-string">','</span></span> + basePoints[triangle[<span class="hljs-number"><span class="hljs-number">2</span></span>]][<span class="hljs-number"><span class="hljs-number">1</span></span>]; polygons.push({ points, color }); });</code> </pre> <br><p>  Tetap hanya mengumpulkan koordinat titik yang diinginkan dalam string dan mengirimkannya bersama warna ke Setang untuk diproses, seperti yang kami lakukan sebelumnya. </p><br><p>  Dalam templat itu sendiri, sekarang kita tidak akan memiliki persegi panjang, tetapi poligon: </p><br><pre> <code class="xml hljs">{{# each polygons }} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">polygon</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">points</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ points }}'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'stroke-width:0.1;stroke:{{ color }};fill:{{ color }}'</span></span></span><span class="hljs-tag"> /&gt;</span></span> {{/each }}</code> </pre> <br><p>  Triangulasi adalah hal yang sangat menarik.  Dengan menambah jumlah segitiga, Anda hanya bisa mendapatkan gambar yang indah, karena tidak ada yang mengatakan bahwa kita harus menggunakannya hanya sebagai potongan. </p><br><h2 id="mozaika-voronogo">  Mosaik Voronoi </h2><br><p>  Ada masalah, cermin yang sebelumnya - partisi atau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mosaik Voronoi</a> .  Kami sudah menggunakannya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">saat bekerja dengan shader</a> , tetapi di sini juga bisa bermanfaat. </p><br><p><img src="https://habrastorage.org/webt/ij/-y/4m/ij-y4mnhq9tlbbkewlmfeyn-q0k.jpeg"></p><br><p>  Seperti halnya algoritma lain yang dikenal, kami memiliki implementasi yang siap pakai: </p><br><pre> <code class="plaintext hljs">npm i --save voronoi</code> </pre> <br><p>  Tindakan selanjutnya akan sangat mirip dengan apa yang kami lakukan dalam contoh sebelumnya.  Satu-satunya perbedaan adalah bahwa sekarang kita memiliki struktur yang berbeda - daripada array segitiga kita memiliki objek yang kompleks.  Dan pilihannya sedikit berbeda.  Kalau tidak, semuanya hampir sama.  Array poin dasar dihasilkan dengan cara yang sama, lewati saja agar tidak membuat daftar terlalu lama: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateVoronoi</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// . . . const box = { xl: 0, xr: 100, yt: 0, yb: 100 }; const diagram = voronoi.compute(basePoints, box); const polygons = []; diagram.cells.forEach((cell) =&gt; { let x = cell.site.x; let y = cell.site.y; if (x === 100) { x = 99; } if (y === 100) { y = 99; } const realX = Math.floor(x * width / 100); const realY = Math.floor(y * height / 100); const pixelPosition = 4 * (realY * width + realX); const rgb = [ pixels.data[pixelPosition], pixels.data[pixelPosition + 1], pixels.data[pixelPosition + 2] ]; const color = '#' + rgbHex(...rgb); let points = ''; cell.halfedges.forEach((halfedge) =&gt; { const endPoint = halfedge.getEndpoint(); points += endPoint.x.toFixed(2) + ',' + endPoint.y.toFixed(2) + ' '; }); polygons.push({ points, color }); }); // . . .</span></span></code> </pre> <br><p>  Hasilnya, kami mendapatkan mosaik poligon cembung.  Juga hasil yang sangat menarik. </p><br><blockquote>  Berguna untuk membulatkan semua angka ke bilangan bulat atau setidaknya beberapa tempat desimal.  Keakuratan yang berlebihan dalam SVG sama sekali tidak perlu di sini, itu hanya akan meningkatkan ukuran gambar. </blockquote><br><h2 id="razmytaya-mozaika">  Mosaik buram </h2><br><p>  Contoh terakhir yang akan kita lihat adalah mosaik buram.  Kami memiliki semua kekuatan SVG di tangan kami, jadi mengapa tidak menggunakan filter? </p><br><p><img src="https://habrastorage.org/webt/xt/us/k1/xtusk1lqy7g9zsolqqanjrmqcva.jpeg"></p><br><p>  Ambil mosaik pertama persegi panjang dan tambahkan filter "blur" standar ke dalamnya: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">defs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'my-filter'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">feGaussianBlur</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">in</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'SourceGraphic'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stdDeviation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'2'</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">defs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">g</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">filter</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'url(#my-filter)'</span></span></span><span class="hljs-tag">&gt;</span></span> {{# each rects }} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rect</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ x }}'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ y }}'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'6'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'6'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fill</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ color }}'</span></span></span><span class="hljs-tag"> /&gt;</span></span> {{/each }} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">g</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Hasilnya adalah pratinjau buram, "disensor" dari gambar kami, ini memakan ruang hampir 10 kali lebih sedikit (tanpa kompresi), vektor, dan membentang ke ukuran layar apa pun.  Dengan cara yang sama, Anda dapat mengaburkan sisa mosaik kami. </p><br><blockquote>  Ketika menerapkan filter seperti itu ke mosaik persegi panjang biasa, "efek jip" bisa berubah, jadi jika Anda menggunakan sesuatu seperti ini dalam produksi, terutama untuk gambar berukuran besar, mungkin lebih indah untuk menerapkan pengaburan bukan untuk itu, tetapi untuk pemecahan Voronoi. </blockquote><br><h2 id="vmesto-zaklyucheniya">  Alih-alih sebuah kesimpulan </h2><br><p>  Dalam artikel ini, kami melihat bagaimana Anda dapat menghasilkan semua jenis gambar rintisan SVG di Node.js dan memastikan bahwa ini bukan tugas yang sulit jika Anda tidak menulis semuanya dengan tangan dan, jika mungkin, merakit modul yang sudah jadi.  Sumber lengkap <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tersedia di github</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id431232/">https://habr.com/ru/post/id431232/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id431220/index.html">Pandangan seorang ahli biologi tentang akar penuaan kita</a></li>
<li><a href="../id431222/index.html">Pengarsipan Situs Web</a></li>
<li><a href="../id431226/index.html">Gim Ular untuk FPGA Cyclone IV (dengan VGA & SPI joystick)</a></li>
<li><a href="../id431228/index.html">Rintangan Jalankan untuk Cahaya: Kristal Cair untuk Membantu</a></li>
<li><a href="../id431230/index.html">Penyimpanan untuk Infrastruktur HPC, atau Cara Kami Mengumpulkan Penyimpanan 65 PB di Pusat Penelitian RIKEN Jepang</a></li>
<li><a href="../id431234/index.html">11 Desember, Moskow - Alfa JS MeetUp</a></li>
<li><a href="../id431236/index.html">Cara menulis di Objective-C pada tahun 2018. Bagian 1</a></li>
<li><a href="../id431238/index.html">Intisari acara untuk profesional SDM di bidang TI untuk Desember 2018</a></li>
<li><a href="../id431242/index.html">Sertifikat TLS dan Web</a></li>
<li><a href="../id431244/index.html">"Dua tanpa filter" atau cara mudah untuk menembak kaki</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>