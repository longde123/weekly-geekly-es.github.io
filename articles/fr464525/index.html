<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíµ üëãüèª üéä Votre propre convertisseur JSON ou un peu plus sur ExpressionTrees üôÇ üö¥üèø üßîüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La s√©rialisation et la d√©s√©rialisation sont des op√©rations typiques que le d√©veloppeur moderne consid√®re comme triviales. Nous communiquons avec des b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Votre propre convertisseur JSON ou un peu plus sur ExpressionTrees</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464525/"><img src="https://habrastorage.org/webt/ud/qn/kd/udqnkdpyauh-0k7h5d-g_hgzrys.png"><br><br>  La s√©rialisation et la d√©s√©rialisation sont des op√©rations typiques que le d√©veloppeur moderne consid√®re comme triviales.  Nous communiquons avec des bases de donn√©es, g√©n√©rons des requ√™tes HTTP, recevons des donn√©es via l'API REST et souvent, nous ne pensons m√™me pas √† son fonctionnement.  Aujourd'hui, je sugg√®re d'√©crire mon s√©rialiseur et d√©s√©rialiseur pour JSON pour savoir ce qui est sous le capot. <br><a name="habracut"></a><br><h2>  Clause de non-responsabilit√© </h2><br>  Comme la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">derni√®re fois</a> , je le remarquerai: nous √©crirons un s√©rialiseur primitif, pourrait-on dire, un v√©lo.  Si vous avez besoin d'une solution cl√© en main, utilisez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Json.NET</a> .  Ces gars ont sorti un produit merveilleux qui est hautement personnalisable, peut faire beaucoup et <i>r√©sout d√©j√† les probl√®mes</i> qui surviennent lorsque vous travaillez avec JSON.  Utiliser votre propre solution est vraiment cool, mais seulement si vous avez besoin de performances maximales, d'une personnalisation sp√©ciale ou si vous aimez les v√©los comme je les aime. <br><br><h2>  Domaine </h2><br>  Le service de conversion de JSON en une repr√©sentation d'objet comprend au moins deux sous-syst√®mes.  Le d√©s√©rialiseur est un sous-syst√®me qui transforme un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JSON</a> (texte) valide en une repr√©sentation d'objet √† l'int√©rieur de notre programme.  La d√©s√©rialisation implique la tokenisation, c'est-√†-dire l'analyse du JSON en √©l√©ments logiques.  Serializer est un sous-syst√®me qui effectue la t√¢che inverse: transforme la repr√©sentation objet des donn√©es en JSON. <br><br>  Le consommateur voit le plus souvent l'interface suivante.  Je l'ai d√©lib√©r√©ment simplifi√© pour mettre en √©vidence les principales m√©thodes les plus utilis√©es. <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IJsonConverter</span></span> { T Deserialize&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> json); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Serialize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> source</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre> <br>  ¬´Sous le capot¬ª, la d√©s√©rialisation comprend la tokenisation (analyse d'un texte JSON) et la construction de primitives qui facilitent la cr√©ation d'une repr√©sentation d'objet plus tard.  √Ä des fins de formation, nous ignorerons la construction de primitives interm√©diaires (par exemple, JObject, JProperty de Json.NET) et nous √©crirons imm√©diatement des donn√©es sur l'objet.  C'est un inconv√©nient, car cela r√©duit les options de personnalisation, mais il est impossible de cr√©er une biblioth√®que enti√®re dans le cadre d'un article. <br><br><h2>  Tokenisation </h2><br>  Permettez-moi de vous rappeler que le processus de tokenisation ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d'analyse lexicale</a> est une analyse du texte dans le but d'obtenir une repr√©sentation diff√©rente et plus rigoureuse des donn√©es qu'il contient.  En r√®gle g√©n√©rale, cette repr√©sentation est appel√©e <b>jetons</b> ou jetons.  Pour analyser JSON, nous devons mettre en √©vidence les propri√©t√©s, leurs valeurs, les symboles du d√©but et de la fin des structures, c'est-√†-dire les jetons qui peuvent √™tre repr√©sent√©s comme JsonToken dans le code. <br><br>  <a href="">JsonToken</a> est une structure qui contient une valeur (texte), ainsi qu'un type de jeton.  JSON est une notation stricte, donc tous les types de jetons peuvent √™tre r√©duits √† l' <a href="">√©num√©ration suivante</a> .  Bien s√ªr, il serait bien d'ajouter au jeton ses coordonn√©es dans les donn√©es entrantes (ligne et colonne), mais le d√©bogage d√©passe le cadre de l'impl√©mentation, ce qui signifie que JsonToken ne contient pas ces donn√©es. <br><br>  Ainsi, la fa√ßon la plus simple d'analyser du texte en jetons est de lire chaque caract√®re s√©quentiellement et de le comparer avec des mod√®les.  Nous devons comprendre ce que signifie tel ou tel symbole.  Il est possible que le mot-cl√© (vrai, faux, nul) commence par ce caract√®re, il est possible que ce soit le d√©but de la ligne (guillemet), ou peut-√™tre que ce caract√®re lui-m√™me est un jeton ([,], {,}).  L'id√©e g√©n√©rale ressemble √† ceci: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tokens = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;JsonToken&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; json.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> ch = json[i]; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (ch) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'['</span></span>: tokens.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JsonToken(JsonTokenType.ArrayStart)); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">']'</span></span>: tokens.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JsonToken(JsonTokenType.ArrayEnd)); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'"'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> stringValue = ReadString(); tokens.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JsonToken(JsonTokenType.String, stringValue); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; ... } }</code> </pre><br>  En regardant le code, il semble que vous puissiez lire et faire imm√©diatement quelque chose avec les donn√©es lues.  Ils n'ont pas besoin d'√™tre stock√©s, ils doivent √™tre imm√©diatement envoy√©s au consommateur.  Ainsi, un certain IEnumerator supplie, qui analysera le texte en morceaux.  Tout d'abord, cela r√©duira l'allocation, car nous n'avons pas besoin de stocker les r√©sultats interm√©diaires (un tableau de jetons).  Deuxi√®mement, nous augmenterons la vitesse de travail - oui, dans notre exemple, l'entr√©e est une cha√Æne, mais dans une situation r√©elle, elle sera <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">remplac√©e par Stream</a> (√† partir d'un fichier ou d'un r√©seau), que nous lisons s√©quentiellement. <br><br>  J'ai pr√©par√© le code <b>JsonTokenizer</b> , qui peut √™tre <a href="">trouv√© ici</a> .  L'id√©e est la m√™me: le tokenizer va s√©quentiellement le long de la ligne, essayant de d√©terminer √† quoi le symbole ou sa s√©quence fait r√©f√©rence.  S'il s'av√©rait √™tre compris, nous cr√©ons un jeton et transf√©rons le contr√¥le au consommateur.  Si ce n'est pas encore clair, lisez la suite. <br><br><h2>  Pr√©paration √† la d√©s√©rialisation des objets </h2><br>  Le plus souvent, une demande de conversion de donn√©es √† partir de JSON est un appel √† la m√©thode g√©n√©rique <b>Deserialize</b> , o√π <b>TOut</b> est le type de donn√©es avec lequel les jetons JSON doivent √™tre mapp√©s.  O√π <a href="">Type est</a> : il est temps d'appliquer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Reflection</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ExpressionTrees</a> .  Les bases de l'utilisation d'ExpressionTrees, ainsi que les raisons pour lesquelles les expressions compil√©es sont meilleures que la r√©flexion ¬´nue¬ª, j'ai d√©crit dans un article pr√©c√©dent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">comment cr√©er votre AutoMapper</a> .  Si vous ne savez rien sur Expression.Labmda.Compile () - je vous recommande de le lire.  Il me semble que l'exemple du mappeur s'est av√©r√© assez compr√©hensible. <br><br>  Ainsi, le plan de cr√©ation d'un d√©s√©rialiseur d'objet est bas√© sur la connaissance que nous pouvons obtenir des types de propri√©t√© du type TOut √† tout moment, c'est-√†-dire la collection <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PropertyInfo</a> .  Dans le m√™me temps, les types de propri√©t√©s sont limit√©s par la notation JSON: nombres, cha√Ænes, tableaux et objets.  M√™me si nous n'oublions pas null, ce n'est pas tant que cela puisse para√Ætre √† premi√®re vue.  Et si pour chaque type primitif nous sommes oblig√©s de cr√©er un d√©s√©rialiseur s√©par√©, alors pour les tableaux et les objets, nous pouvons cr√©er des classes g√©n√©riques.  Si vous r√©fl√©chissez un peu, tous les s√©rialiseurs-d√©s√©rialiseurs (ou <b>convertisseurs</b> ) peuvent √™tre r√©duits √† l'interface suivante: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IJsonConverter</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Deserialize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">JsonTokenizer tokenizer</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Serialize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params">, StringBuilder builder</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre><br>  Le code d'un convertisseur fortement typ√© de types primitifs est aussi simple que possible: nous extrayons le JsonToken actuel du tokenizer et le transformons en valeur en analysant.  Par exemple, float.Parse (currentToken.Value).  Jetez un ≈ìil √† <a href="">BoolConverter</a> ou <a href="">FloatConverter</a> - rien de compliqu√©.  Ensuite, si vous avez besoin d'un d√©s√©rialiseur pour bool?  ou flottant?, il peut √©galement √™tre ajout√©. <br><br><h2>  D√©s√©rialisation des baies </h2><br>  <a href="">Le code de classe g√©n√©rique</a> pour convertir un tableau √† partir de JSON est √©galement relativement simple.  Il est param√©tr√© par le type d'√©l√©ment que l'on peut extraire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Type.GetElementType ()</a> .  D√©terminer qu'un type est un tableau est √©galement simple: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Type.IsArray</a> .  La d√©s√©rialisation des tableaux revient √† dire tokenizer.MoveNext () jusqu'√† ce qu'un jeton de type ArrayEnd soit atteint.  La d√©s√©rialisation des √©l√©ments du tableau est la d√©s√©rialisation du type d'√©l√©ment du tableau. Par cons√©quent, lors de la cr√©ation d'un ArrayConverter, le d√©s√©rialiseur d'√©l√©ment lui est transmis. <br><br>  Parfois, il y a des difficult√©s avec l'instanciation d'impl√©mentations g√©n√©riques, je vais donc vous dire imm√©diatement comment le faire.  La r√©flexion vous permet de cr√©er des types g√©n√©riques en temps r√©el, ce qui signifie que nous pouvons utiliser le type cr√©√© comme argument pour Activator.CreateInstance.  Profitez-en: <br><br><pre> <code class="cs hljs">Type elementType = arrayType.GetElementType(); Type converterType = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ArrayConverter&lt;&gt;).MakeGenericType(elementType); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> converterInstance = Activator.CreateInstance(converterType, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] args);</code> </pre><br>  Finissant les pr√©paratifs pour la cr√©ation d'un d√©s√©rialiseur d'objets, vous pouvez mettre tout le code d'infrastructure associ√© √† la cr√©ation et au stockage des d√©s√©rialiseurs dans la fa√ßade de <a href="">JConverter</a> .  Il sera responsable de toutes les op√©rations de s√©rialisation et de d√©s√©rialisation JSON et est disponible pour les consommateurs en tant que service. <br><br><h2>  D√©s√©rialisation d'objets </h2><br>  Permettez-moi de vous rappeler que vous pouvez obtenir toutes les propri√©t√©s de type T comme ceci: typeof (T) .GetProperties ().  Pour chaque propri√©t√©, vous pouvez extraire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PropertyInfo.PropertyType</a> , ce qui nous donnera la possibilit√© de cr√©er un IJsonConverter typ√© pour la s√©rialisation et la d√©s√©rialisation des donn√©es d'un type particulier.  Si le type de la propri√©t√© est un tableau, nous instancions ArrayConverter ou en trouvons un appropri√© parmi ceux existants.  Si le type de propri√©t√© est un type primitif, des d√©s√©rialiseurs (convertisseurs) sont d√©j√† cr√©√©s pour eux dans le constructeur JConverter. <br><br>  Le code r√©sultant peut √™tre affich√© dans la classe g√©n√©rique <a href="">ObjectConverter</a> .  Un activateur est cr√©√© dans son constructeur, les propri√©t√©s sont extraites d'un dictionnaire sp√©cialement pr√©par√©, et pour chacun d'eux une m√©thode de d√©s√©rialisation est cr√©√©e - Action &lt;TObject, JsonTokenizer&gt;.  Il est n√©cessaire, d'une part, afin d'associer imm√©diatement le IJsonConverter √† la propri√©t√© souhait√©e, et d'autre part, afin d'√©viter la boxe lors de l'extraction et de l'√©criture de types primitifs.  Chaque m√©thode de d√©s√©rialisation sait quelle propri√©t√© de l'objet sortant sera enregistr√©e, le d√©s√©rialiseur de la valeur est strictement typ√© et renvoie la valeur exactement sous la forme dans laquelle elle est n√©cessaire. <br><br>  La liaison d'un IJsonConverter √† une propri√©t√© est la suivante: <br><br><pre> <code class="cs hljs">Type converterType = propertyValueConverter.GetType(); ConstantExpression Expression.Constant(propertyValueConverter, converterType); MethodInfo deserializeMethod = converterType.GetMethod(<span class="hljs-string"><span class="hljs-string">"Deserialize"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = Expression.Call(converter, deserializeMethod, tokenizer);</code> </pre><br>  La constante <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Expression.Constant</a> est cr√©√©e directement dans l'expression, qui stocke une r√©f√©rence √† l'instance de d√©s√©rialiseur pour la valeur de la propri√©t√©.  Ce n'est pas exactement la constante que nous √©crivons en ¬´C # normal¬ª, car elle peut stocker un type de r√©f√©rence.  Ensuite, la m√©thode Deserialize est r√©cup√©r√©e √† partir du type de d√©s√©rialiseur, qui renvoie la valeur du type souhait√©, puis elle est appel√©e - <a href="">Expression.Call</a> .  Ainsi, nous obtenons une m√©thode qui sait exactement o√π et quoi √©crire.  Il reste √† le mettre dans le dictionnaire et √† l'appeler lorsqu'un token du type Property avec le nom souhait√© ¬´vient¬ª du tokenizer.  Un autre avantage est que tout fonctionne tr√®s rapidement. <br><br><h2>  √Ä quelle vitesse </h2><br>  Les v√©los, comme cela a √©t√© not√© au tout d√©but, il est logique d'√©crire dans plusieurs cas: s'il s'agit d'une tentative de comprendre le fonctionnement de la technologie, ou si vous devez obtenir des r√©sultats sp√©ciaux.  Par exemple, la vitesse.  Vous pouvez vous assurer que le d√©s√©rialiseur d√©s√©rialise vraiment <a href="">avec les tests pr√©par√©s</a> (j'utilise <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AutoFixture</a> pour obtenir les donn√©es de test).  Au fait, vous avez probablement remarqu√© que j'ai √©galement √©crit la s√©rialisation d'objets.  Mais comme l'article s'est av√©r√© assez volumineux, je ne le d√©crirai pas, mais je donnerai simplement des rep√®res.  Oui, tout comme avec l'article pr√©c√©dent, j'ai √©crit des benchmarks en utilisant la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BenchmarkDotNet</a> . <br><br>  Bien s√ªr, j'ai <a href="">compar√© la</a> vitesse de d√©s√©rialisation avec Newtonsoft (Json.NET), comme la solution la plus courante et recommand√©e pour travailler avec JSON.  De plus, sur leur site Web, il est √©crit: 50% plus rapide que DataContractJsonSerializer et 250% plus rapide que JavaScriptSerializer.  Bref, je voulais savoir combien mon code allait perdre.  Les r√©sultats m'ont surpris: notez que l'allocation des donn√©es est presque trois fois inf√©rieure et que le taux de d√©s√©rialisation est environ deux fois plus rapide. <br><div class="scrollable-table"><table><thead><tr><th>  La m√©thode </th><th>  Moyenne </th><th>  Erreur </th><th>  Stddev </th><th>  Ratio </th><th>  Allou√© </th></tr></thead><tbody><tr><td>  Newtonsoft </td><td>  75,39 ms </td><td>  0,3027 ms </td><td>  0,2364 ms </td><td>  1,00 </td><td>  35,47 Mo </td></tr><tr><td>  Velo </td><td>  31,78 ms </td><td>  0,1135 ms </td><td>  0,1062 ms </td><td>  0,42 </td><td>  12,36 Mo </td></tr></tbody></table></div><br>  La comparaison de la vitesse et de l'allocation <a href="">pendant la s√©rialisation des donn√©es a</a> donn√© des r√©sultats encore plus int√©ressants.  Il s'av√®re que le s√©rialiseur de v√©lo a allou√© pr√®s de cinq fois moins et a fonctionn√© presque trois fois plus rapidement.  Si la vitesse me d√©rangeait vraiment (vraiment), ce serait un succ√®s √©vident. <br><div class="scrollable-table"><table><thead><tr><th>  La m√©thode </th><th>  Moyenne </th><th>  Erreur </th><th>  Stddev </th><th>  Ratio </th><th>  Allou√© </th></tr></thead><tbody><tr><td>  Newtonsoft </td><td>  54,83 ms </td><td>  0,5582 ms </td><td>  0,5222 ms </td><td>  1,00 </td><td>  25,44 Mo </td></tr><tr><td>  Velo </td><td>  20,66 ms </td><td>  0,0484 ms </td><td>  0,0429 ms </td><td>  0,38 </td><td>  5,93 Mo </td></tr></tbody></table></div><br>  Oui, lors de la mesure de la vitesse, je n'ai pas utilis√© les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">conseils pour augmenter la productivit√©</a> qui sont publi√©s sur le site Web Json.NET.  J'ai pris des mesures hors de la bo√Æte, c'est-√†-dire selon le sc√©nario le plus couramment utilis√©: JsonConvert.DeserializeObject.  Il existe peut-√™tre d‚Äôautres moyens d‚Äôam√©liorer les performances, mais je ne les connais pas. <br><br><h2>  Conclusions </h2><br>  Malgr√© la vitesse relativement √©lev√©e de s√©rialisation et de d√©s√©rialisation, je ne recommanderais pas d'abandonner Json.NET au profit de ma propre solution.  Le gain de vitesse est calcul√© en millisecondes et se ¬´noie¬ª facilement dans les retards du r√©seau, du disque ou du code, qui est hi√©rarchiquement situ√© au-dessus de l'endroit o√π la s√©rialisation est appliqu√©e.  Prendre en charge de telles solutions propri√©taires est un enfer, o√π seuls les d√©veloppeurs qui connaissent bien le sujet peuvent √™tre autoris√©s. <br><br>  La port√©e de ces v√©los est des applications enti√®rement con√ßues en vue de hautes performances ou des projets pour animaux de compagnie o√π vous comprenez comment telle ou telle technologie fonctionne.  J'esp√®re que je vous ai aid√© un peu dans tout cela. <br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr464525/">https://habr.com/ru/post/fr464525/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr464511/index.html">Comment collecter des cohortes d'utilisateurs sous forme de graphiques dans Grafana [+ image docker avec un exemple]</a></li>
<li><a href="../fr464513/index.html">Duffle: Transformer de XD Design</a></li>
<li><a href="../fr464515/index.html">Comment faire des e-mails et ne pas g√¢cher: conseils pratiques</a></li>
<li><a href="../fr464517/index.html">Nouvelles cartes CUBA</a></li>
<li><a href="../fr464523/index.html">Syst√®mes de paiement (PSP) pour l'informatique: nous jouons gros</a></li>
<li><a href="../fr464529/index.html">Pour la publicit√© contextuelle par les noms des concurrents peut d√©sormais √™tre condamn√© √† une amende de 500 000 roubles</a></li>
<li><a href="../fr464535/index.html">D√©tails sur l'appareil et les fonctions du scooter √©lectrique KickScooter T60</a></li>
<li><a href="../fr464537/index.html">Arduino DIY Demonic Carrousel</a></li>
<li><a href="../fr464539/index.html">√âtudes cliniques. Comment entrer dans le groupe exp√©rimental, obtenir un traitement contre le cancer gratuit et aider la science</a></li>
<li><a href="../fr464543/index.html">Ce qui est et ce qui n'est pas dans Go. 2e partie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>