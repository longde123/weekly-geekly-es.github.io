<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐚 👨‍🎨 ⛺️ Kami memeriksa kerentanan tertutup dan mendapatkan empat CVE baru 🕋 🧙🏽 ⏱️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saya diminta untuk melanjutkan serangkaian artikel tentang penutupan kerentanan dan tentang bagaimana mereka ditutup (artikel pertama kami dapat dibac...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kami memeriksa kerentanan tertutup dan mendapatkan empat CVE baru</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/acribia/blog/430408/">  Saya diminta untuk melanjutkan serangkaian artikel tentang penutupan kerentanan dan tentang bagaimana mereka ditutup (artikel pertama kami dapat dibaca di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> ).  Terakhir kali kami mengetahui bahwa meskipun pabrikan melaporkan penutupan kerentanan, maka pada kenyataannya semuanya mungkin tidak demikian. <br><br><img src="https://habrastorage.org/webt/me/ds/nj/medsnjr0lbtdxy9vots_csy_bbg.jpeg"><br><a name="habracut"></a><br><h3>  Kriteria pemilihan: </h3><br>  Kriteria pemilihan untuk kerentanan yang dipertimbangkan kali ini adalah sama (dengan pengecualian bahwa kali ini saya ingin melihat jenis kerentanan lainnya): <br><br><ul><li>  harus ada eksploitasi - kami ingin melihat bahwa sebelum pembaruan semuanya <s>dieksploitasi dengan</s> baik, dan setelah itu menjadi baik; </li><li>  kerentanan harus kritis (idealnya RCE) dan dengan skor tinggi; </li><li>  produk harus open source; </li><li>  produk tidak boleh ditinggalkan dan digunakan secara aktif; </li><li>  kerentanan harus relatif baru; </li><li>  seperti biasa, hal utama adalah bahwa kita sendiri akan tertarik. </li></ul><br><h3>  Apa dan bagaimana saya memilih: </h3><br>  Saya pergi ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">vulners.com</a> dan meminta untuk menunjukkan semua exploit dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">exploit-db.com</a> dalam beberapa minggu terakhir.  Kali ini dalam kategori web, hampir semua eksploitasi ditulis oleh Ihsan Sencan, tetapi karena fakta bahwa mereka paling sering berhubungan dengan injeksi sql dalam aplikasi dan plugin lama yang tidak didukung, saya menghapusnya.  Dari produk yang tersisa, hanya ProjeQtOr Project Management Tool 7.2.5 dengan kerentanan CVE-2018-18924 masuk dalam kategori “tidak ditinggalkan dan secara aktif berkembang”. <br>  Kerentanan ini memenuhi semua kriteria pemilihan: <br><br><ul><li>  ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">eksploitasi</a> ; </li><li>  Kerentanan RCE (meskipun mengharuskan pengguna untuk diotorisasi); </li><li>  produknya cukup open source; </li><li> produk tidak ditinggalkan, pada tahun 2018 ada 28 rilis dan hanya sourceforge.net ada 702 unduhan (dan sebagian besar unduhan pembaruan menyelesaikan masalah CVE, yang kemungkinan besar menunjukkan bahwa orang melihat CVE dan mulai memperbarui); </li><li>  CVE 4 November, eksploitasi 25 Oktober, ini memenuhi persyaratan kebaruan; </li><li>  Saya melihat masalah dan solusinya, saya menjadi tertarik (lebih lanjut tentang itu nanti). </li></ul><br><h4>  Memahami Alat Manajemen Proyek ProjeQtOr </h4><br>  Kami membaca deskripsi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">exploit</a> dan deskripsi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CVE di nist.gov</a> , kami memahami bahwa versi 7.2.5 hanya rentan untuk pengguna yang diotorisasi.  Dan juga Anda dapat mengunggah file .shtml sebagai gambar, meskipun meskipun pesan kesalahan <i>"File ini bukan gambar yang valid"</i> ditampilkan, file tersebut akan tetap disimpan ke gambar di server dan dapat diakses melalui tautan langsung di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">host / file / images / image_name</a> . <br><br><img src="https://habrastorage.org/webt/8d/wu/0x/8dwu0x1uezs-x_ws7egw9szchue.png"><br><br>  Akses melalui tautan langsung baik, tetapi di sini Anda masih harus menebak nama file yang akan diunduh.  Kami beruntung, dan ini tidak acak, tetapi dihasilkan dari waktu saat ini dalam format: tahun, bulan, hari, jam, menit, detik.  Hasilnya adalah angka seperti 20181114140320. Selanjutnya, ID pengguna dan kemudian nama file asli melalui garis bawah.  Ada beberapa yang tidak diketahui: <br><br><ul><li>  Zona waktu di server </li><li>  jika jam di server turun; </li><li>  ID pengguna </li></ul><br>  Dan sekali lagi kami beruntung: jika Anda mengunggah gambar yang valid, maka semua parameter ini akan dilaporkan kepada kami.  Tidak sulit untuk membahas beberapa opsi tautan (beberapa, karena ada beberapa detik, tetapi sulit untuk langsung masuk ke dalamnya). <br><br><img src="https://habrastorage.org/webt/zq/ce/lh/zqcelhvlhrk7496dafoiqart2nk.png"><br><br>  Secara umum, mendapatkan nama file tidak menjadi masalah.  Kami melanjutkan.  Dan kami pikir, mengapa tidak hanya mengunggah skrip php?  Kami mencoba mengunduhnya, jendela yang sama muncul, tetapi file tersebut tidak muncul di direktori.  Saatnya melihat kode! <br><br>  Script uploadImage.php bertanggung jawab untuk mengunggah gambar ke server dalam versi 7.2.5. Kami tertarik pada baris 100 hingga 117. <br><br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (substr($ext,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>)==<span class="hljs-string"><span class="hljs-string">'php'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> substr($ext,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>)==<span class="hljs-string"><span class="hljs-string">'phtm'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(@!getimagesize($uploadedFile[<span class="hljs-string"><span class="hljs-string">'tmp_name'</span></span>])) { $error=i18n(<span class="hljs-string"><span class="hljs-string">'errorNotAnImage'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { traceHack(<span class="hljs-string"><span class="hljs-string">"Try to upload php file as image in CKEditor"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( ! move_uploaded_file($uploadedFile[<span class="hljs-string"><span class="hljs-string">'tmp_name'</span></span>], $uploadfile)) { $error = htmlGetErrorMessage(i18n(<span class="hljs-string"><span class="hljs-string">'errorUploadFile'</span></span>,<span class="hljs-string"><span class="hljs-string">'hacking ?'</span></span>)); errorLog(i18n(<span class="hljs-string"><span class="hljs-string">'errorUploadFile'</span></span>,<span class="hljs-string"><span class="hljs-string">'hacking ?'</span></span>)); } } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$error) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(@!getimagesize($uploadfile)) { $error=i18n(<span class="hljs-string"><span class="hljs-string">'errorNotAnImage'</span></span>); } }</code> </pre> <br>  Baris 100 bertanggung jawab untuk memeriksa ekstensi file: jika itu adalah php atau phtm, maka file tersebut dibuang dan tidak disimpan.  Oleh karena itu file php tidak muncul di direktori "file / gambar /".  Baris 115 menciptakan kesalahan yang kita lihat, tetapi tidak melakukan apa pun dengan file tersebut. <br><br>  Yah, jangan tinggalkan eksploitasi dan unggah file dengan ekstensi .shtml.  Di sini perlu dilakukan penyimpangan kecil dan memberi tahu apa .shtml itu dan apa yang dimakannya. <br><br><h4>  SHTML dan SSI </h4><br>  Definisi Wikipedia: <br><br>  SSI (Sisi Server Termasuk - inklusi di sisi server) - bahasa sederhana untuk "perakitan" dinamis halaman web di server dari komponen individual dan pengiriman dokumen HTML yang diterima ke klien.  Diimplementasikan di server web Apache menggunakan modul mod_include.  Fitur yang termasuk dalam pengaturan default server web memungkinkan Anda untuk memasukkan file HTML, oleh karena itu, untuk menggunakan instruksi, file tersebut harus diakhiri dengan ekstensi .shtml, .stm atau .shtm. <br><br>  Dengan kata-kata Anda sendiri: <br><br>  SHTML adalah HTML yang dapat mengeksekusi set instruksi sisi server.  Dari yang berguna ada fungsi exec yang mengeksekusi perintah sewenang-wenang di server (ya, kita dapat mengunduh file menggunakan kode HTML dan menjalankannya). <br><br>  Berikut ini contoh kode untuk menjalankan kode arbitrer: <br><br><pre> <code class="php hljs">&lt;!--<span class="hljs-comment"><span class="hljs-comment">#exec cmd=”ls” --&gt;</span></span></code> </pre> <br>  Kabar baiknya adalah bahwa fungsi ini tidak diaktifkan secara default di server Apache2, dan untuk mengaktifkannya Anda harus menari dengan rebana.  Dalam beberapa jam memilih konfigurasi, saya bisa membuat kembalinya variabel lingkungan berfungsi, tetapi bukan perintahnya.  Ini kode SSI saya: <br><br><pre> <code class="php hljs">&lt;html&gt; &lt;head&gt; &lt;title&gt;thegeekstuff.com&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;p&gt; Today is &lt;!--<span class="hljs-comment"><span class="hljs-comment">#echo var="DATE_LOCAL" --&gt; &lt;!--#exec cmd="ls" --&gt; &lt;/p&gt; &lt;/body&gt; &lt;/html&gt;  : Today is Wednesday, 14-Nov-2018 17:29:14 MSK [an error occurred while processing this directive]</span></span></code> </pre><br>  Jika seseorang memberi tahu Anda apa yang harus ditulis dalam konfigurasi agar berfungsi dengan benar, saya ingin membacanya. <br><br><h4>  Mengeksploitasi kerentanan </h4><br>  Jika bintang-bintang bertemu, Anda dapat mengunduh file shtml dan menjalankan perintah sewenang-wenang (atau, seperti saya, lihat waktu di server). <br><br><h4>  Menonton tambalan </h4><br>  Versi berikutnya adalah 7.2.6, tetapi tidak ada perubahan terkait kerentanan yang kami minati (nist.gov lagi-lagi tertipu). <br><br>  Kami melihat versi 7.2.7 dan tampaknya semuanya sudah diperbaiki (pengembang sendiri mengatakan bahwa semuanya sudah diperbaiki hanya dalam versi ini).  Ada dua perubahan utama: <br><br>  1. Di antara ekstensi terlarang, "shtm" telah ditambahkan (jika 4 karakter pertama seperti itu, shtml juga termasuk di sini): <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (substr($ext,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>)==<span class="hljs-string"><span class="hljs-string">'php'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> substr($ext,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>)==<span class="hljs-string"><span class="hljs-string">'phtm'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> substr($ext,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>)==<span class="hljs-string"><span class="hljs-string">'shtm'</span></span>) {</code> </pre> <br><br>  2. File yang bukan gambar sekarang dihapus: <br><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(@!getimagesize($uploadfile)) { $error=i18n(<span class="hljs-string"><span class="hljs-string">'errorNotAnImage'</span></span>); kill($uploadfile); }</code> </pre> <br>  Tampaknya Anda dapat menyimpang, karena non-gambar dihapus, dan shtml bahkan tidak berusaha untuk bertahan.  Tapi saya selalu tidak suka jika mereka mencoba menyelesaikan masalah dengan daftar hitam.  Misalnya, di beberapa negara, perusahaan melarang jejaring sosial.  Ini mengarah pada fakta bahwa pengguna mulai menggunakan "mirror" dari jejaring sosial, di mana nama pengguna dan kata sandi mereka dicuri.  Kata sandi mereka bertepatan dengan kata sandi perusahaan, tetapi kemudian mungkin ada masalah yang jauh lebih besar daripada karyawan yang membalik-balik instagram sambil minum kopi. <br><br>  Dalam pemrograman web dan keamanannya, daftar hitam juga jahat. <br><br><h4>  Bypass daftar hitam dari ProjeQtOr </h4><br>  Yah, semuanya sederhana.  Pertama, mari kita lihat file apa yang dapat ditafsirkan oleh Apache2 + PHP pada pengaturan default (semuanya diinstal pada ubuntu 16.04 dengan repositori yang diperbarui).  Arahan “FilesMatch” bertanggung jawab atas kemampuan untuk menafsirkan file.  Kami melakukan pencarian dengan perintah "grep -r" &lt;FilesMatch "/ etc / apache2" dan berikut ini hasilnya: <br><br><pre> <code class="php hljs">/etc/apache2/mods-available/php7<span class="hljs-number"><span class="hljs-number">.0</span></span>.conf:&lt;FilesMatch <span class="hljs-string"><span class="hljs-string">".+\.ph(p[3457]?|t|tml)$"</span></span>&gt; /etc/apache2/mods-available/php7<span class="hljs-number"><span class="hljs-number">.0</span></span>.conf:&lt;FilesMatch <span class="hljs-string"><span class="hljs-string">".+\.phps$"</span></span>&gt; /etc/apache2/mods-available/php7<span class="hljs-number"><span class="hljs-number">.0</span></span>.conf:&lt;FilesMatch <span class="hljs-string"><span class="hljs-string">"^\.ph(p[3457]?|t|tml|ps)$"</span></span>&gt; /etc/apache2/sites-available/<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-ssl.conf: &lt;FilesMatch <span class="hljs-string"><span class="hljs-string">"\.(cgi|shtml|phtml|php)$"</span></span>&gt; /etc/apache2/apache2.conf:&lt;FilesMatch <span class="hljs-string"><span class="hljs-string">"^\.ht"</span></span>&gt;</code> </pre> <br>  Dalam konfigurasi default-ssl.conf, semua ekstensi hanya terdaftar secara keseluruhan, ini adalah: cgi, shtml, phtml, php.  Sayangnya, semuanya kecuali cgi disaring di ProjeQtOr. <br><br>  Konfigurasi php7.0.conf jauh lebih menarik, di dalamnya ekstensi diatur oleh ekspresi reguler.  Kami mendapatkan: <br><table><tbody><tr><th>  Ekstensi </th><th>  Apa yang difilter </th></tr><tr><td>  php </td><td>  substr ($ ext, 0.3) == 'php' </td></tr><tr><td>  php3 </td><td>  substr ($ ext, 0.3) == 'php' </td></tr><tr><td>  php4 </td><td>  substr ($ ext, 0.3) == 'php' </td></tr><tr><td>  php5 </td><td>  substr ($ ext, 0.3) == 'php' </td></tr><tr><td>  php7 </td><td>  substr ($ ext, 0.3) == 'php' </td></tr><tr><td>  pht </td><td>  TIDAK ADA </td></tr><tr><td>  phtml3 </td><td>  substr ($ ext, 0.4) == 'phtm' </td></tr></tbody></table><br>  Hebat, ekstensi file yang tidak difilter ditemukan.  Kami memverifikasi bahwa itu benar-benar ditafsirkan. <br><br>  Buat file test.pht dengan konten berikut: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> phpinfo();</code> </pre> <br>  Kami membuka file ini di browser dan melihat informasi tentang php yang diinstal.  Hebatnya, daftar hitam dilewati, sementara untuk pengaturan non-default, untuk beberapa alasan, ekstensi lain untuk interpretasi dapat diizinkan. <br><br>  Kami memuat file pengujian kami di Alat Manajemen Proyek ProjeQtOr.  Tentu saja, kami mendapatkan kesalahan, karena ini bukan gambar (dalam versi sebelum 7.2.7, kami sudah memiliki eksekusi kode di server, karena mengubah phpinfo ke menjalankan perintah tidak sulit).  Dalam versi 7.2.7, file dihapus, dan kode tidak dieksekusi. <br><br>  Tapi kami tidak kesal dan memintas pemeriksaan pada gambar. <br><br><h4>  Gambar PHP </h4><br>  Memeriksa apakah file yang diunduh adalah gambar di ProjeQtOr Project Management Tool dilakukan oleh fungsi getimagesize, yang hanya melihat pada header file yang ditransfer. <br><br>  Mengambil keuntungan dari kenyataan bahwa mungkin ada sampah di file php, dan interpretasi kode php dimulai hanya dengan karakter "&lt;? Php", kita menulis kode kecil yang pertama menulis gambar, dan kemudian kode php yang kita butuhkan.  Sebagai gambar, kami akan mengirim tangkapan layar dari jendela kesalahan.  3 baris kode python dan Anda selesai: <br><br><pre> <code class="python hljs">data = open (<span class="hljs-string"><span class="hljs-string">'test.png'</span></span>,<span class="hljs-string"><span class="hljs-string">'rb'</span></span>).read() data += open (<span class="hljs-string"><span class="hljs-string">'test.pht'</span></span>,<span class="hljs-string"><span class="hljs-string">'rb'</span></span>).read() open (<span class="hljs-string"><span class="hljs-string">'new_pht_png.pht'</span></span>,<span class="hljs-string"><span class="hljs-string">'wb'</span></span>).write(data)</code> </pre> <br>  Mungkin, Anda bisa saja menulis header gambar yang valid di awal file, tetapi lebih mudah, dan terlebih lagi, gambar ditampilkan di setiap pemirsa. <br><br>  Kami mengunggah kreasi ini ke server dan, lihat, itu dimuat (dan ditampilkan di pemirsa sebagai gambar), dan kami juga senang ditunjukkan nama lengkap tempat file ini diunggah. <br><br><img src="https://habrastorage.org/webt/xi/px/mh/xipxmhyuzvcaqbxl28pcrrezd1q.png"><br><br>  Kami pergi ke file yang diunduh <a href="">localhost / files / images / 2018111417173030__new_pht_png.pht</a> dan melihat gambar yang diunduh sebagai teks, dan output phpinfo di bawahnya.  Jelas bahwa mengganti phpinfo dengan shell web sederhana tidak sulit.  Misalnya, ini: &lt;? Sistem php ($ _ GET ['cmd']); <br><br><img src="https://habrastorage.org/webt/m-/kv/ad/m-kvadznv4ev99yge_zwwsgzf6m.png"><br><br>  Setelah Anda mulai memilih unduhan file, Anda harus menyelesaikan pekerjaan dan melihat di mana lagi ada unduhan file dengan atau tanpa daftar hitam. <br><br><h4>  Unggah file lain </h4><br>  Kami akan menonton dalam versi terbaru yang tersedia.  Dengan asumsi bahwa Anda menggunakan fungsi yang sama untuk mengunggah file seperti sebelumnya, mis.  move_uploaded_file, kami mencarinya di direktori proyek "grep -r" move_uploaded_file "./".  Kami mendapatkan 5 file berikut: <br><br>  ./tool/uploadImage.php <br>  ./tool/saveDocumentVersion.php <br>  ./tool/uploadPlugin.php <br>  ./tool/import.php <br>  ./tool/saveAttachment.php <br><br>  File uploadImage.php - sudah tampak. <br>  File saveDocumentVersion.php - unduh versi dokumen (sesuai namanya).  Kami mencoba mengunduh dokumen dan melihatnya (sebagai permulaan kami akan selalu memuat gambar).  Setelah mengunduh, kita melihat bahwa ekstensi .1 ditambahkan ke file.  Kami melihat dalam kode bagaimana nama itu diperoleh (ini dilakukan pada baris 229): <br><br><pre> <code class="php hljs">$uploadfile = $dv-&gt;getUploadFileName();</code> </pre> <br>  Fungsi getUploadFileName dideklarasikan dalam file DocumentVersionMain.php.  Di sana, pada baris 227, kita melihat bahwa "." Ditambahkan ke nama yang dikembalikan.  dan dokumen ID.  Kami tidak dapat menyiasati titik tambahan: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $uploaddir . $paramPathSeparator . $fileName . <span class="hljs-string"><span class="hljs-string">'.'</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;id;</code> </pre> <br>  File uploadPlugin.php hanya dapat diakses oleh administrator dan fakta bahwa plugin mungkin memiliki kode yang buruk sangat logis dan sulit untuk dihilangkan tanpa harus memasukkan validasi plugin (seperti yang dilakukan CMS populer).  Tentu saja, ketika Anda mencoba mengunduh sesuatu di sana, itu berhasil dimuat, dan kemudian dieksekusi. <br><br>  File import.php juga hanya tersedia untuk administrator.  Saat mengunduh file, kita diberitahu bahwa itu harus berupa file csv atau file xlsx.  Tentu saja, kami mencoba memuat file php dan melihat kesalahan: <br><br><h4>  GALAT - Jenis file yang diberikan dan format file yang dipilih tidak cocok </h4><br>  Impor dibatalkan <br><br>  Masalahnya adalah, seperti pada bug asli dari CVE, file tersebut tidak dihapus, tetapi tetap tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">localhost / file / attach / import / test.php</a> . <br><br>  File saveAttachment digunakan saat memuat lampiran apa pun (misalnya, saat memuat gambar Anda sendiri).  Script PHP tidak merangkak di sana, karena ada perlindungan formulir: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (substr($ext,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>)==<span class="hljs-string"><span class="hljs-string">'php'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> substr($ext,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>)==<span class="hljs-string"><span class="hljs-string">'phtm'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> substr($ext,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>)==<span class="hljs-string"><span class="hljs-string">'shtm'</span></span>) { $attachment→fileName.=<span class="hljs-string"><span class="hljs-string">".projeqtor"</span></span>;</code> </pre> <br>  ternyata file ekstensi php *, phtm *, shtm * ekstensi ".projeqtor" ditambahkan, yaitu, jelas file pht kami akan merayapi di sana (bahkan tanpa merangkak gambar).  Kami mencoba, dan kami mendapatkan semuanya di alamat <a href="">localhost / files / attach / attachment_1 / test.pht</a> . <br><br>  Total garis bawah dari lima lokasi pengunduhan file yang ditemukan dengan cepat: <br><br><ul><li>  berhasil memuat skrip php atau pht 4 kali; </li><li>  validasi daftar hitam ada dua; </li><li>  validasi daftar putih tidak ada di mana pun; </li><li>  sekali gagal mengunduh file (gagal mengunduh, tetapi gagal dieksekusi), karena  ekspansi berubah </li></ul><br><h3>  Kesimpulan tentang Alat Manajemen Proyek ProjeQtOr dan CVE-2018-18924 </h3><br><br><ul><li>  kerentanan yang dilaporkan telah dihilangkan; </li><li>  ada kerentanan lain dalam kode (dilaporkan ke pengembang, dan mereka bahkan menjanjikan daftar putih ekstensi); </li><li>  konfigurasi yang tepat dari server Apache2 dapat menyelamatkan kita dari segalanya (membatasi format yang dapat dieksekusi hanya diperlukan, melarang eksekusi skrip di folder pengguna); </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">nist.gov</a> tidak <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mengandung</a> versi rentan terbaru. </li></ul><br><h3>  Catatan nyonya </h3><br><ul><li>  menolak daftar hitam sedapat mungkin (saya tidak tahu di mana ini tidak mungkin); </li><li>  hati-hati dan penuh perhatian saat memproses file yang diunduh (lebih baik berada di satu tempat, dan tidak menyebar 5); </li><li>  server web yang dikonfigurasi dengan benar menyelamatkan dari banyak masalah dalam kode proyek (penting untuk menulis kode dan mengkonfigurasi server dengan baik). </li></ul><br><h3>  Jawaban terperinci dari pengembang </h3><br>  Jawaban pertama dari pengembang adalah sesuatu seperti "kami memperbaiki semuanya, jadi lihat kode yang diperbaiki".  Saya harus melukis dengan sangat rinci di mana beberapa masalah berada dan bagaimana mereka dapat dieksploitasi. <br><br>  Kemudian dia menerima jawaban terperinci: “ya ada masalah, dan mereka akan diperbaiki dalam versi 7.3.0.  Daftar putih juga akan ditambahkan untuk gambar untuk xlslx dan csv. "  Mereka juga menulis bahwa mereka memiliki rekomendasi untuk menambahkan direktori "lampiran" dan "dokumen" di luar akses web dalam instruksi instalasi. <br><br>  Pengembang mengizinkan saya untuk mendaftar CVE dan menulis artikel setelah pembaruan (yang keluar dan tersedia untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">diunduh</a> ). <br><br><h3>  Kesimpulan </h3><br>  Seperti yang saya tulis di awal, beberapa orang telah mengunduh pembaruan yang memutuskan CVE (lebih dari 500 unduhan), dan itu keren bahwa orang memperbarui perangkat lunak mereka yang rentan, tetapi menyedihkan bahwa perangkat lunak itu tetap rentan. <br><br>  Akibatnya, empat CVE ditugaskan kepada saya dan perusahaan kami: CVE-2018-19307, CVE-2018-19308, CVE-2018-19309, CVE-2018-19310. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id430408/">https://habr.com/ru/post/id430408/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id430398/index.html">Bagaimana memahami bahwa Anda tidak diperbolehkan atau membahas metode memeras pekerja keluar dari perusahaan</a></li>
<li><a href="../id430400/index.html">Pengalaman menggunakan hybrid keyboard dan mouse dalam pemrograman</a></li>
<li><a href="../id430402/index.html">Apa yang diam dari developer.android.com tentang RecyclerView?</a></li>
<li><a href="../id430404/index.html">Kami mengumpulkan data tentang perilaku pelanggan di situs</a></li>
<li><a href="../id430406/index.html">C ++ 20 dan Modul, Jaringan, Coroutine, Ranges, Grafik. Hasil pertemuan di San Diego</a></li>
<li><a href="../id430410/index.html">“Selalu harus berevolusi”: sebuah wawancara dengan Evgeny Kuvshinov (ManyChat) tentang pengembangan dalam sebuah startup</a></li>
<li><a href="../id430412/index.html">Logika fuzzy terhadap PID. Kami menyeberang landak dan ular. Mesin pesawat terbang dan algoritma kontrol PLTN</a></li>
<li><a href="../id430414/index.html">Azure DevOps untuk Commodore 64?</a></li>
<li><a href="../id430418/index.html">Pengalaman pribadi menggunakan sensor jarak dalam pengembangan</a></li>
<li><a href="../id430422/index.html">Kode Anda sangat menentukan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>