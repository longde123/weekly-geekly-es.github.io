<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üññüèº üë®üèæ‚ÄçüöÄ üßôüèø Sintetizador DDS en Verilog üë®üèª‚Äçüç≥ ü§üüèø üé´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En esta publicaci√≥n compartir√© c√≥mo entend√≠ escribir un sintetizador DDS en Verilog. Se utilizar√° para generar una oscilaci√≥n sinusoidal, cuya frecuen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sintetizador DDS en Verilog</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457634/"><p><img src="https://habrastorage.org/webt/9a/zg/qs/9azgqsahwpzig90y6b8xbulgz9s.png"></p><br><p>  En esta publicaci√≥n compartir√© c√≥mo entend√≠ escribir un sintetizador DDS en Verilog.  Se utilizar√° para generar una oscilaci√≥n sinusoidal, cuya frecuencia y fase inicial se pueden ajustar y calcular para usar con un DAC unipolar de 8 bits.  El funcionamiento del sintetizador est√° bien escrito en un art√≠culo en la revista <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Componentes y Tecnolog√≠as</a> .  Para reducir la cantidad de memoria utilizada de la tabla sinusoidal, se utiliza la simetr√≠a. </p><a name="habracut"></a><br><p> Para la compilaci√≥n en Linux utilic√© Iverilog y para mostrar GTKWave.  Por conveniencia, se escribi√≥ un Makefile simple, tal vez sea √∫til para alguien.  Inicialmente, usando el compilador iverilog, obtenemos el archivo tb.out y luego lo enviamos al simulador vvp, que se instala con iverilog.  Como resultado, vvp generar√° out.vcd, que contiene todas las variables (se√±ales) utilizadas en el proyecto.  El objetivo de la pantalla, adem√°s de lo anterior, lanzar√° GTKWave con un archivo variable y podr√° ver las formas de onda de las se√±ales. </p><br><pre><code class="plaintext hljs">SRC = nco.v TB = nco_tb.v all: iverilog -o tb.out $(TB) vvp -lxt tb.out check: iverilog -v $(TB) display: iverilog -o tb.out $(TB) vvp -lxt tb.out gtkwave out.vcd &amp; clean: rm -rf *.out *.vcd *.vvp</code> </pre> <br><p>  En primer lugar, debe colocar una tabla del seno futuro en la memoria, ya que escrib√≠ un script simple de Python que divide una cuarta parte del per√≠odo sinusoidal en 64 puntos y lo genera en un formato que luego se puede copiar en el c√≥digo fuente.  Como conceb√≠ la implementaci√≥n de DDS para un DAC unipolar externo con una capacidad de bits de no m√°s de 8 bits, la amplitud sinusoidal deber√≠a estar en el rango de 0 a 256, donde el medio per√≠odo negativo se encuentra en el rango 0 ... 127, y la mitad positiva en 128 ... 255 .  En este sentido, los valores de seno obtenidos (de 0 a pi / 4) se multiplican por 127 y luego se les agrega 127. Como resultado, se obtienen los valores del primer trimestre del per√≠odo, cuya amplitud es 128 ... 256. </p><br><p>  Llamo la atenci√≥n sobre el hecho de que con esta formaci√≥n, el seno en la salida del DAC tendr√° un componente constante.  Para eliminarlo, es necesario pasarlo a trav√©s de un condensador. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np x=np.linspace(<span class="hljs-number"><span class="hljs-number">0</span></span>,np.pi/<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>) print(np.sin(x)) y=<span class="hljs-number"><span class="hljs-number">127</span></span>*np.sin(x) print(len(y)) print(y) z=[] i = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> elem <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> y: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> int(elem)&lt;=<span class="hljs-number"><span class="hljs-number">16</span></span>: print(<span class="hljs-string"><span class="hljs-string">"lut[%d] = 7'h0%X;"</span></span> % (i, int(elem))) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: print(<span class="hljs-string"><span class="hljs-string">"lut[%d] = 7'h%X;"</span></span> % (i, int(elem))) z.append(hex(int(elem))) i = i + <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><p>  Como la funci√≥n seno es sim√©trica (impar), puede encontrar la primera simetr√≠a sin (x) = - sin (pi + x).  La segunda simetr√≠a se caracteriza por el hecho de que al tener una tabla durante un cuarto del per√≠odo, se puede obtener el segundo trimestre yendo a trav√©s de la tabla en el orden inverso (dado que el seno en el medio per√≠odo primero aumenta, luego disminuye). </p><br><h4 id="formiruem-sinus">  Formamos un seno </h4><br><p>  La mayor parte del sintetizador DDS es una bater√≠a de fase.  En esencia, es el √≠ndice de un elemento de la tabla de b√∫squeda (LUT).  Para cada per√≠odo de la se√±al de reloj, el valor en ella aumenta en un cierto valor, como resultado, se obtiene un seno en la salida.  La frecuencia de la se√±al en la salida depender√° del valor del incremento del acumulador de fase: cuanto mayor sea, mayor ser√° la frecuencia.  Sin embargo, seg√∫n el criterio de Kotelnikov, la frecuencia de muestreo debe ser al menos 2 veces la frecuencia de la se√±al (para evitar el efecto de superponer el espectro), por lo tanto, la limitaci√≥n en el incremento m√°ximo es la mitad del acumulador de fase.  En general, el criterio de ingenier√≠a es la frecuencia de muestreo = 2.2 de la frecuencia de la se√±al, por lo tanto, despu√©s de haber decidido no llevarla al extremo, elimin√© un bit m√°s, dejando 6 bits incrementados con una bater√≠a de fase de 8 bits (aunque la jackalita sinusoidal ya). </p><br><p>  Debido a la simetr√≠a utilizada, solo los 6 bits inferiores de 2 ^ 6 = 64 se utilizar√°n directamente para el muestreo de √≠ndice.  Los 2 bits altos se utilizan para identificar un cuarto de per√≠odo de generaci√≥n de seno y, en consecuencia, cambiar la direcci√≥n del recorrido de la tabla.  Deber√≠as obtener algo similar a: </p><br><pre> <code class="plaintext hljs">module nco(clk, rst, out ); input clk, rst; output reg [7:0] out; reg [5:0] phase_inc = 6'h1; reg [7:0] phase_acc = 0; parameter LUT_SIZE = 64; reg [6:0] lut [0:LUT_SIZE-1]; always @(posedge clk) begin if (rst) begin phase_inc = 6'h1; phase_acc = 0; out = 0; lut[0] = 7'h00; //     lut[63] = 7'h7F; end else begin //      1    if (phase_acc[7:6] == 2'b00) begin //        LUT out &lt;= {1'b1,lut[phase_acc[5:0]]}; end if (phase_acc[7:6] == 2'b01) begin out &lt;= {1'b1,lut[~phase_acc[5:0]]}; end if (phase_acc[7:6] == 2'b10) begin out &lt;= {1'b0,~lut[phase_acc[5:0]]}; end if (phase_acc[7:6] == 2'b11) begin out &lt;= {1'b0,~lut[~phase_acc[5:0]]}; end phase_acc &lt;= phase_acc + {2'b0,phase_inc}; end end endmodule</code> </pre> <br><p>  Al reiniciar, inicializamos todo con ceros, excepto el valor de incremento de fase, lo establecemos en uno.  Para preservar la capacidad de sintetizaci√≥n del c√≥digo, la tabla tambi√©n se rellenar√° con valores durante el reinicio.  En un proyecto real, es aconsejable usar la memoria de bloque integrada en el FPGA para tales fines y crear un archivo de configuraci√≥n separado para √©l, y usar el n√∫cleo IP en el proyecto mismo. </p><br><p>  Una peque√±a explicaci√≥n sobre c√≥mo funciona la simetr√≠a.  En cada ciclo, se verifica (en los 2 bits m√°s significativos) en qu√© cuarto se encuentra actualmente el acumulador de fase.  Si el m√°s alto = 00, entonces la salida en el d√≠gito m√°s alto es 1 (responsable de la media onda positiva), en los m√°s bajos, el valor de la LUT de acuerdo con el √≠ndice.  Despu√©s de que el valor del acumulador de fase exceda 63 (el primer trimestre pasar√°), aparecer√° 01 en los bits m√°s altos y los m√°s bajos se volver√°n a llenar con ceros. </p><br><p>  Para pasar la LUT en el orden inverso, es suficiente invertir los bits menos significativos del acumulador de fase (continuar√° aumentando para cada ciclo, y su valor invertido disminuir√°). </p><br><p>  Para formar una media onda negativa, escribimos 0. En el bit superior de la salida, ahora necesitamos invertir el valor mismo de la tabla senoidal.  El punto aqu√≠ es que necesita obtener una copia espejo del cuarto del seno, y si esto no se hace, obtendr√° la misma imagen que en el primer trimestre, pero se redujo en 127 hacia abajo.  Puede verificar esto eliminando el inverso en el c√≥digo. </p><br><h4 id="menyaem-chastotu-i-nachalnuyu-fazu">  Cambiamos la frecuencia y la fase inicial. </h4><br><p>  Como ya se describi√≥ anteriormente, para cambiar la frecuencia, es necesario cambiar el valor del incremento de fase.  Aparecer√°n nuevas entradas: </p><br><pre> <code class="plaintext hljs">input [5:0] freq_res; input [7:0] phase;</code> </pre> <br><p>  Para cambiar el valor del incremento de fase, simplemente lo ajustamos en cada ciclo: </p><br><pre> <code class="plaintext hljs">always @(posedge clk) begin if (rst) begin //... end else begin //... phase_inc &lt;= freq_res; end end</code> </pre> <br><p>  Con la fase inicial, no todo es tan simple.  Primero debe escribirlo en el registro intermedio y llenar el acumulador de fase con este valor solo si el valor de la fase inicial en la entrada no coincide con el almacenado previamente.  Esto plantea otro punto importante relacionado con el estado de las razas.  Ya tenemos un lugar donde escribimos <code>phase_acc</code> en el registro.  No puede grabar al mismo tiempo en varios lugares, ya que se registrar√°n los datos que vinieron primero.  Por lo tanto, el dise√±o se ver√° as√≠: </p><br><pre> <code class="plaintext hljs">reg change_phase = 0; //     //     (  ) //     : prev_phase &lt;= phase; if (phase != prev_phase) begin //       change_phase &lt;= 1'b1; end if (change_phase) begin //        phase_acc &lt;= prev_phase; change_phase &lt;= 1'b0; end else begin //           phase_acc &lt;= phase_acc + {2'b0,phase_inc}; end</code> </pre> <br><h4 id="testbench">  Banco de pruebas </h4><br><p>  El c√≥digo de banco de pruebas para Iverilog y GTKWave tiene algunos dise√±os (con un signo de d√≥lar) que no se usan en el ISE Design Suite o Quartus habitual.  Su significado se reduce a seleccionar se√±ales monitoreadas y cargarlas en un archivo, para que luego puedan transferirse al simulador.  El trabajo del banco de pruebas en s√≠ es trivial: hacemos un reinicio, establecemos la frecuencia / fase inicial y esperamos un momento. </p><br><pre> <code class="plaintext hljs">`include "nco.v" `timescale 1ns / 1ps module nco_tb; reg clk = 0, rst = 0; reg [7:0] phase = 0; reg [5:0] freq_res; wire [7:0] out; nco nco_inst ( .clk(clk), .rst(rst), .phase(phase), .freq_res(freq_res), .out(out) ); always #2 clk &lt;= ~clk; initial begin $dumpfile("out.vcd"); $dumpvars(0, nco_tb); //$monitor("time =%4d out=%h",$time,out); rst = 1'b1; freq_res = 1; #8 rst = 1'b0; #300 phase = 8'b00100011; #300 phase = 8'b00001111; #1200 freq_res = 6'b111101; #1200 freq_res = 6'b001111; #1200 freq_res = 6'b011111; #400 phase = 8'b00010011; #1200 $finish; end endmodule</code> </pre> <br><h4 id="vremennye-diagrammy">  Tablas de tiempo </h4><br><p>  En la salida, obtenemos algo similar a un seno con una frecuencia cambiante y una fase inicial en los puntos de tiempo establecidos en el banco de pruebas.  Vale la pena se√±alar que al aumentar la frecuencia, la resoluci√≥n (el n√∫mero de muestras por per√≠odo) disminuye, respectivamente, la frecuencia del reloj del sintetizador y su tama√±o LUT juegan un papel decisivo en la reproducci√≥n del seno puro (cuanto m√°s se acerca su forma al ideal, menos componentes laterales en el espectro del resultado resultante se√±al y el pico ya estar√° en la frecuencia generada). </p><br><p><img src="https://habrastorage.org/webt/zk/ws/zg/zkwszgjj7dw89xqygjhcc8uhzoc.png"></p><br><p>  Se puede ver que una se√±al con una segunda frecuencia ya no tiene un seno tan suave como las otras.  Echemos un vistazo m√°s de cerca. </p><br><p><img src="https://habrastorage.org/webt/ni/ja/cd/nijacdynrfxbcbq-xjxbmbjtqbe.png"></p><br><p>  Se puede ver que esto sigue siendo un poco similar al seno, el resultado ser√° a√∫n mejor despu√©s de que dicha se√±al se pase a trav√©s de un filtro antisolapamiento (filtro de paso bajo). </p><br><p>  Las fuentes del proyecto est√°n disponibles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . </p><br><h4 id="istochniki">  Fuentes </h4><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C√≥mo funciona el sintetizador DDS</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sitio web de Icarus Verilog</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/457634/">https://habr.com/ru/post/457634/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../457624/index.html">C√≥mo rompimos la vieja choza y construimos un rascacielos en su lugar</a></li>
<li><a href="../457626/index.html">Revisi√≥n de los niveles de acceso del usuario utilizando Power BI utilizando el ejemplo de Bitrix CMS (BUS)</a></li>
<li><a href="../457628/index.html">Programa P2M efectivo y gesti√≥n de proyectos</a></li>
<li><a href="../457630/index.html">Experiencia desarrollando requisitos para el cient√≠fico de datos de cualidades profesionales</a></li>
<li><a href="../457632/index.html">¬øCu√°nto cuestan las pruebas unitarias?</a></li>
<li><a href="../457638/index.html">Atr√°pame si puedes. Versi√≥n profeta</a></li>
<li><a href="../457640/index.html">¬øEn qu√© conf√≠an los expertos en protecci√≥n de datos? Informe del Congreso Internacional de Ciberseguridad</a></li>
<li><a href="../457646/index.html">Sobre el ant√≠lope en una m√°scara de gas y lagos de sal rosa</a></li>
<li><a href="../457652/index.html">C√≥mo organizar 120,000 fotos y para que no haya pruebas, con diferentes niveles de acceso, para el equipo</a></li>
<li><a href="../457658/index.html">Union MS-11: ¬øUn accidente que no exist√≠a?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>