<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí≠ üòø üì± Yandex: ein Smart Home f√ºr Erwachsene üëäüèª ‚úãüèø üë®üèª‚Äçüåæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor kurzem hat Yandex sein Smart-Home-System auf den Markt gebracht. Es wird angeboten, kosteng√ºnstige Wi-Fi-Ger√§te zu kaufen: einen Adapter in einer ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Yandex: ein Smart Home f√ºr Erwachsene</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465537/"><img src="https://habrastorage.org/webt/rs/l_/lm/rsl_lmpzna0pj3o9ahxzsawpsn0.png"><br><br>  Vor kurzem hat Yandex sein Smart-Home-System auf den Markt gebracht.  Es wird angeboten, kosteng√ºnstige Wi-Fi-Ger√§te zu kaufen: einen Adapter in einer Steckdose, eine Gl√ºhbirne und eine IR-Fernbedienung.  Es ist interessant, dass die Entwickler von ‚Äûintelligenten‚Äú Ger√§ten die M√∂glichkeit haben, ihre ‚Äûintelligenten‚Äú F√§higkeiten zu entwickeln. Auf diese Weise k√∂nnen Sie Ger√§te mit dem Yandex-System verbinden und ihre Stimme √ºber Alice verwalten.  Immer mehr neue Marken erscheinen auf Skill-Listen.  Alice versteht die russische Sprache perfekt, was sie zur unbestrittenen F√ºhrungspers√∂nlichkeit unter den Sprachassistenten auf dem russischen Markt macht. <br>  Allerdings ist nicht alles so glatt ... <br><a name="habracut"></a><br>  Erstes Minus: Grunds√§tzlich sind alle vorgeschlagenen Systeme ‚Äûbew√∂lkt‚Äú.  Ihre Zuverl√§ssigkeit ist manchmal zweifelhaft, da ihre Leistung direkt von der Qualit√§t der Verbindung mit den Servern des Herstellers abh√§ngt.  Und wenn Sie das Internet ausschalten, verwandeln sich die Ger√§te vollst√§ndig in einen ‚ÄûK√ºrbis‚Äú. <br><br>  Zweites Minus: Skriptsystem.  Ein wichtiger Bestandteil eines Smart Homes sind die Skripte.  Und hier sind sie sehr primitiv: Wenn "der Ausdruck so und so ist", dann aktivieren Sie "das Ger√§t ist so und so".  F√ºr mein Smart Home war das zu wenig. <br><br>  Die Nachteile enden nicht dort, aber der Rest h√§ngt eher mit der Unreife des Systems zusammen.  Das Yandex-Entwicklungsteam f√ºgt weiterhin aktiv verschiedene Funktionen und zu bearbeitende Fehler hinzu, wof√ºr wir uns sehr bedanken! <br><br>  Nachdem ich die Dokumentation studiert hatte, entschied ich mich, die Yandex UD-F√§higkeit zu erstellen und den Smart Home-Controller daran anzuschlie√üen.  Auf diese Weise k√∂nnen Sie sich nicht auf Cloud-Server verlassen, Skripts lokal auf dem Controller implementieren und gleichzeitig das System per Spracheingabe √ºber Alice steuern.  Daf√ºr habe ich das Plugin "yandex2mqtt" auf Node.js geschrieben. <br><br><h4>  Ein bisschen Theorie </h4><br>  - Alice, mach das Licht an. <br>  Nach diesem Satz geschieht Magie und das Licht geht an.  Aber was ist hinter den Kulissen?  Lassen Sie uns herausfinden, wie das alles funktioniert. <br><br>  Nachdem die Yandex-Station einen vertrauten Befehl geh√∂rt hat, sendet sie Daten an den Yandex-Server, an den wir im Voraus die Adresse unseres Controllers angegeben haben.  Der Server verarbeitet die Informationen und leitet sie in Form einer Post-Anfrage an den Controller weiter.  Auf dem Controller verarbeitet die Zwischen-API (in unserem Fall das yandex2mqtt-Plugin) die Anforderung und leitet sie an das MQTT-Thema weiter.  Als n√§chstes wird das Skript im Node-Red-Programm verarbeitet. <br><br>  Node-Red entscheidet, was als n√§chstes zu tun ist.  Wenn das Skript dies vorsieht, sendet er einen Befehl zum Einschalten des Lichts im entsprechenden MQTT-Thema.  Der wb-mqtt-serial-Treiber sendet daraufhin einen Modbus-Befehl an das Relaismodul, das das Relais schaltet.  Und schlie√ülich geht das Licht an!  Ja, der Pfad ist nicht eng, aber ein Bruchteil eines zweiten Durchgangs f√ºr den Benutzer. <br><br>  Schauen wir uns das yandex2mqtt-Plugin genauer an.  Das erste, was Yandex ben√∂tigt, damit die F√§higkeit funktioniert, ist der oAuth-Dienst zum B√ºndeln von Konten in der Yandex-Anwendung.  Nachdem Yandex das Autorisierungstoken vom oAuth-Dienst erhalten hat, fordert es eine Liste der Ger√§te an.  Das yandex2mqtt-Plugin antwortet mit einer Liste von Ger√§ten mit allen Eigenschaften im JSON-Format.  Dann erscheinen sie in der Liste der zur Steuerung verf√ºgbaren Ger√§te (im sogenannten Quasar).  Wenn Sie Alice nun anweisen, ein Ger√§t aus der Liste einzuschalten, sendet Yandex eine Post-Anfrage mit den Daten des Ger√§ts, das er einschalten m√∂chte, an den Controller.  Als Antwort best√§tigt das Plugin die Aufnahme und schreibt den neuen Status in das in den Einstellungen desselben Plugins angegebene mqtt-Thema.  Wenn das Ger√§t seinen Status ohne die Teilnahme von Yandex ge√§ndert hat, sendet das Plug-In, das die neuen Daten im Thema mqtt sieht, diese an Yandex, wenn es den Status anfordert. Dies geschieht jetzt nur, wenn Sie das Ger√§t selbst in Quasar aufrufen.  In anderen F√§llen fragt Yandex den Status nicht ab. <br>  Jetzt werde ich √ºber einige Eigenschaften von Yandex UD-Ger√§ten sprechen. <br><br><h4>  Ger√§tetyp </h4><br>  F√ºr eine korrekte Anzeige im ‚ÄûQuasar‚Äú und eine genauere Definition der Befehle durch Alice schl√§gt Yandex vor, Ger√§ten verschiedene Ger√§tetypen zuzuweisen.  Gesamttypen 10: <br><br><ul><li>  <b>Ger√§te.Typen.Licht</b> - Jede Lampe, Kronleuchter, Gl√ºhbirne usw. </li><li>  <b>Ger√§te.Typen.Socket</b> - Outlet </li><li>  <b>Ger√§te.Typen.Schalter</b> - Schalter </li><li>  <b>Ger√§te.Typen.Thermostat</b> - Thermostat </li><li>  <b>Ger√§te.Typen.Thermostat.ac</b> - Klimaanlage </li><li>  <b>device.types.media_device</b> - Medienger√§t </li><li>  <b>device.types.media_device.tv</b> - TV </li><li>  <b>Ger√§te.Typen.Kochen</b> - K√ºchenger√§te </li><li>  <b>Ger√§te.Typen.Kochen.Kessel</b> - Hersteller </li><li>  <b>device.types.other</b> - Alles andere, was nicht zu den vorherigen Abs√§tzen passte. </li></ul><br><h5>  F√§higkeit </h5><br>  Au√üerdem muss jedes Ger√§t mindestens eine <b>Funktion haben</b> . <br><br>  Insgesamt verf√ºgt Yandex UD √ºber 5 Arten von F√§higkeiten.  Jede F√§higkeit hat eine andere Funktion <b>(Instanz)</b> , und einige F√§higkeiten haben mehrere solche Funktionen, was die Flexibilit√§t bei der Konfiguration von Ger√§ten erh√∂ht. <br><br>  <b>F√§higkeiten:</b> <br><br>  1. <b>device.capabilities.on_off</b> - <b>Ein-</b> und ausschalten. <br><br>  Instanz: <br><br><ul><li>  auf </li></ul><br>  2. <b>Ger√§te.F√§higkeiten.Farbeinstellung</b> - Farbmanagement. <br><br>  Instanz: <br><br><ul><li>  rgb </li><li>  hsv </li><li>  Temperatur_k </li></ul><br>  3. <b>Ger√§te.F√§higkeiten.Modus - Modus wechseln.</b> <br><br>  Instanz: <br><br><ul><li>  Thermostat </li><li>  fan_speed </li></ul><br>  4. <b>Ger√§te.F√§higkeiten.Bereich - Bereichssteuerung.</b> <br><br>  Instanz: <br><br><ul><li>  Helligkeit </li><li>  Temperatur </li><li>  Lautst√§rke </li><li>  Kanal </li></ul><br>  5. <b>device.capabilities.toggle - Stumm.</b> <br><br>  Instanz: <br><br><ul><li>  stumm schalten </li></ul><br><br>  Mit der richtigen Kombination aller Eigenschaften des Ger√§ts versteht Alice problemlos alle Befehle, die ihr zur Verwaltung des Smart Home gegeben wurden.  Hier gibt es nat√ºrlich einige Schwierigkeiten beim Kombinieren von F√§higkeiten.  Die Dokumentation gibt eindeutig nicht an, welche F√§higkeiten kombiniert werden k√∂nnen und welche nicht.  Aber die "wissenschaftliche Poke-Methode" wird uns dabei helfen. <br><br>  So fand ich zum Beispiel heraus, dass die Klimaanlage vier F√§higkeiten enth√§lt: <br><br>  Ger√§tetyp: <br><br>  <b>Ger√§te.Typen.Thermostat.ac</b> <br><br>  F√§higkeitstyp: <br><br>  <b>Ger√§te.F√§higkeiten.on_off</b> <br><br>  Instanz: <br><br><ul><li>  auf </li></ul><br>  <b>Ger√§te.F√§higkeiten.Bereich</b> <br>  Instanz: <br><br><ul><li>  Temperatur </li></ul><br>  <b>Ger√§te.Kapazit√§ten.Modus</b> <br>  Instanz: <br><br><ul><li>  Thermostat </li></ul><br>  <b>Ger√§te.Kapazit√§ten.Modus</b> <br>  Instanz: <br><br><ul><li>  fan_speed </li></ul><br>  Ich werde die restlichen Eigenschaften nicht beschreiben, dort ist alles ganz einfach. <br><br>  Damit es funktioniert, ben√∂tigen Sie: <br><br><ul><li>  <b>Controller</b> </li><li>  <b>Beliebige Domain</b> </li><li>  <b>SSL-Zertifikat</b> </li><li>  <b>Node.js</b> </li><li>  <b>Yandex2mqtt Plugin</b> </li><li>  <b>MQTT-Broker</b> </li><li>  <b>Knotenrot</b> </li></ul><br><h3>  Controller </h3><br>  Meine ‚Äûintelligente‚Äú Wohnung wird vom Wiren Board 6 gesteuert. Sie k√∂nnen jedoch jeden anderen Linux-Controller verwenden, der Node.js und Node-Red abruft.  Zum Beispiel Raspberry Pi oder PC. <br><br><h4>  Domain </h4><br>  Nat√ºrlich ist es w√ºnschenswert, eine wei√üe IP-Adresse zu haben und eine Domain zu kaufen, aber dies ist nicht notwendig.  Sie k√∂nnen DDNS verwenden, z. B. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">www.noip.com</a> . <br><br>  Hier ist alles einfach: Registrieren, kostenlosen Hostnamen erstellen, IP-Adresse eingeben.  Einige Router verf√ºgen √ºber eine spezielle DDNS-Einstellung, in die Sie noip.com-Daten eingeben k√∂nnen.  Der Router sendet automatisch eine IP-Adresse, wenn diese ge√§ndert wird.  Wenn im Router keine solche Einstellung vorhanden ist, k√∂nnen Sie das Noip-Programm auf dem Controller installieren und zur automatischen Ausf√ºhrung hinzuf√ºgen.  Das Programm macht genau das Gleiche wie ein Router mit speziellen DDNS-Einstellungen - aktualisieren Sie Ihre IP-Adresse in der Datenbank noip.com <br><br>  Daher haben wir eine statische Adresse, die alle Anforderungen an unseren Controller umleitet. <br><br><h4>  Ports 443 und 80 </h4><br>  Jetzt hat fast jeder zu Hause einen Router.  Zus√§tzlich zu seinen offensichtlichen Funktionen ist es auch ein Hindernis f√ºr das lokale Netzwerk durch unerw√ºnschte G√§ste von au√üen.  In bestimmten F√§llen ben√∂tigen wir jedoch von au√üen Zugriff auf das interne Netzwerk.  Routerhersteller stellten sich dies vor und f√ºgten die NAT-Funktion (Network Address Translation) hinzu. <br><br>  Ich werde den Zeitpunkt der Einrichtung des Routers nicht beschreiben, da er f√ºr jeden Hersteller unterschiedlich ist.  Lesen Sie dazu die Anweisungen f√ºr Ihren Router.  Google-Schl√ºsselw√∂rter: Portweiterleitung, Portzuordnung, NAT. <br><br>  Es ist erforderlich, den Port f√ºr den Zugriff auf yandex2mqtt (es kann jeder sein, ich habe 443 gew√§hlt) und Port 80 weiterzuleiten (nur erforderlich, um ein SSL-Zertifikat zu erhalten. Nach Erhalt des Zertifikats kann Port 80 geschlossen werden). <br><br><h4>  SSL-Zertifikat </h4><br>  Setzen Sie sofort alle Punkte auf das "und": Selbstsignierte Zertifikate funktionieren nicht. <br>  Die meisten Domain-Registrare (z. B. reg.ru) geben ihren Kunden kostenlose SSL-Zertifikate f√ºr die Hauptdomain (www.IhreDomain.ru).  Wenn Sie eine Domain speziell f√ºr Alice gekauft haben, k√∂nnen Sie das bereitgestellte SSL-Zertifikat verwenden. <br><br>  Wenn Sie keine eigene Domain haben oder Alice eine andere Subdomain zugewiesen ist (z. B. alice.yourdomain.ru), ben√∂tigen Sie ein Zertifikat f√ºr diese Subdomain oder f√ºr die vom DDNS-Dienst angegebene Adresse. <br><br>  Zu diesem Zweck schlage ich vor, den kostenlosen Dienst zu verwenden, um ein SSL-Zertifikat von letsencrypt.org zu erhalten. <br><br>  Um ein Zertifikat zu erhalten, m√ºssen Sie das certbot-Programm installieren, alle angeforderten Daten ausf√ºhren und angeben.  Gleichzeitig sollte Port 80 frei und von au√üen zug√§nglich sein. Ich rate Ihnen, die Anweisungen von letsencrypt sorgf√§ltig zu lesen. <br><br><div class="spoiler">  <b class="spoiler_title">Installieren und konfigurieren Sie certbot</b> <div class="spoiler_text"><pre><code class="bash hljs">apt-get update apt-get install certbot</code> </pre> <br><br>  Stoppen Sie die Watchdog- und Nginx-Dienste. <br><br><pre> <code class="bash hljs">service watchdog stop service nginx stop</code> </pre> <br>  Wir leiten den 80. Port im Router weiter. <br><br>  F√ºhren Sie das certbot-Programm aus: <br><br><pre> <code class="bash hljs">certbot certonly --standalone</code> </pre> <br>  Nach dem Start stellt das Programm einige einfache Fragen. <br><br>  1. Ihre E-Mail.  Geben Sie einfach die Adresse ein und dr√ºcken Sie die Eingabetaste <br><br><img src="https://habrastorage.org/webt/mn/gf/si/mngfsiaatuo6txsrtc6wyyz4v_o.png"><br><br>  2. Sie werden aufgefordert, die Benutzervereinbarungen zu lesen.  Wenn Sie mit allem einverstanden sind, geben Sie einfach "A" ein, was "zustimmen" bedeutet, dh ich stimme zu. <br><br><img src="https://habrastorage.org/webt/y8/zz/to/y8zztosybjouwmncxuawmbq-55c.png"><br><br>  3. Das Programm bittet um die Erlaubnis, Ihre E-Mail-Adresse an die Entwickler zu senden.  Geben Sie N ein. <br><br><img src="https://habrastorage.org/webt/pn/y_/yw/pny_ywp5pjfj7gupd09m3hnbmg4.png"><br><br>  4. Geben Sie Ihre Domain ein, f√ºr die Sie ein Zertifikat erhalten m√∂chten (Sie k√∂nnen die Domain eingeben, die wir zuvor in noip erhalten haben).  Hier gebe ich ein Beispiel f√ºr fehlerhafte Eingaben.  Das Pr√§fix http: // ist nicht erforderlich. <br><br><img src="https://habrastorage.org/webt/mt/bj/py/mtbjpyenb63jqv3gvtd_oyh9qze.png"><br><br>  Wenn Sie alles richtig gemacht haben, sehen Sie Folgendes: <br><br><img src="https://habrastorage.org/webt/ug/7c/kf/ug7ckfuvos8bkgfgzvaepqvu48s.png"><br><br>  Dies bedeutet, dass das Zertifikat erfolgreich empfangen wurde.  Denken Sie an den Pfad zum Zertifikat und Schl√ºssel, der bei der Konfiguration des yandex2mqtt-Plugins erforderlich ist.  Schlie√üen Sie aus Sicherheitsgr√ºnden Port 80 in den Router-Einstellungen. Dies ist nicht mehr sinnvoll. <br><br>  Wir schalten die Watchdog- und Nginx-Dienste ein. <br><br><pre> <code class="bash hljs">service nginx start service watchdog start</code> </pre> <br>  Das Zertifikat von letsencrypt wird f√ºr <b>3</b> Monate ausgestellt.  <b>Vergessen Sie nicht zu aktualisieren.</b> <br><br></div></div><br><h4>  Node.js und das yandex2mqtt-Plugin </h4><br><div class="spoiler">  <b class="spoiler_title">Installation</b> <div class="spoiler_text">  Konfigurieren des Repositorys node.js. <br><br><pre> <code class="bash hljs">curl -sL https://deb.nodesource.com/setup_10.x | bash -</code> </pre> <br>  Installieren oder aktualisieren Sie anschlie√üend alle erforderlichen Komponenten <br><br><pre> <code class="bash hljs">apt-get install -y nodejs git make g++ gcc build-essential</code> </pre> <br>  Kopieren Sie nach erfolgreicher Installation das yandex2mqtt-Repository auf den Controller. <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/munrexio/yandex2mqtt.git /mnt/data/root/yandex2mqtt</code> </pre> <br>  Wir setzen die Rechte. <br><br><pre> <code class="bash hljs">chown -R root:root /mnt/data/root/yandex2mqtt</code> </pre> <br>  Wir gehen zum Ordner. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /mnt/data/root/yandex2mqtt</code> </pre> <br>  Wir starten die Installation. <br><br><pre> <code class="bash hljs">npm install</code> </pre> <br>  Installation abgeschlossen. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Autostart</b> <div class="spoiler_text">  <b>Erstellen Sie eine systemd-Einheit:</b> <br><br>  <b>Wechseln</b> Sie in den Ordner <b>/ etc / systemd / system /</b> auf dem Controller und erstellen Sie eine Datei mit dem Namen <b>yandex2mqtt.service</b> .  Kopieren Sie Folgendes hinein: <br><br><pre> <code class="bash hljs">[Unit] Description=yandex2mqtt After=network.target [Service] ExecStart=/usr/bin/npm start WorkingDirectory=/mnt/data/root/yandex2mqtt StandardOutput=inherit StandardError=inherit Restart=always User=root [Install] WantedBy=multi-user.target</code> </pre> <br>  Speichern Sie danach die √Ñnderungen und schlie√üen Sie die Datei. <br><br>  Geben Sie den Befehl in die Konsole ein, um das Ger√§t zu aktivieren: <br><br><pre> <code class="bash hljs">systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> yandex2mqtt.service</code> </pre> <br><br>  Jetzt k√∂nnen Sie das Plugin mit Befehlen starten und stoppen <br><br><pre> <code class="bash hljs">service yandex2mqtt start service yandex2mqtt stop service yandex2mqtt restart</code> </pre> <br></div></div><br>  <b>Einrichtung:</b> <br><br>  Alle erforderlichen Plug-In-Einstellungen befinden sich in der Datei <b>/mnt/data/root/yandex2mqtt/config.js</b> <br>  Bearbeiten Sie diese Datei gem√§√ü Ihren Parametern. <br>  Das SSL-Zertifikat muss vollst√§ndig <b>verkettet sein</b> . <br><br>  F√ºhren Sie nach der Konfiguration yandex2mqtt mit dem folgenden Befehl aus: <br><br><pre> <code class="bash hljs">service yandex2mqtt start</code> </pre> <br>  Nach dem Einrichten und Starten der Bridge empfehle ich Ihnen, das Zertifikat auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dieser Site</a> zu √ºberpr√ºfen. <br><br>  Geben Sie einfach Ihre Domain ein, mit der Sie auf Alice zugreifen m√∂chten.  F√ºr einen ordnungsgem√§√üen Betrieb muss das Zertifikat alle Pr√ºfungen bestehen.  Sonst funktioniert nichts. <br><br><h4>  F√§higkeit Yandex UD </h4><br><div class="spoiler">  <b class="spoiler_title">F√§higkeitserstellung</b> <div class="spoiler_text">  1. Gehen Sie zur Seite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dialogs.yandex.ru/developer</a> <br>  2. Melden Sie sich mit Ihrem Konto an. <br>  3. Klicken Sie auf "Dialog erstellen". <br>  4. W√§hlen Sie "Smart Home" <br>  5. Geben Sie die erforderlichen Parameter ein: <br><br><ul><li>  <b>Name</b> - Beliebiger Name. </li><li>  <b>Endpunkt-URL</b> - eine Adresse vom Typ <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ihrer Dom√§ne / Ihres Anbieters</a></b> , wobei anstelle von <b>"</b> Ihre Dom√§ne" die Adresse von noip oder Ihrer Dom√§ne ist, f√ºr die ein SSL-Zertifikat empfangen wird. </li></ul><br><img src="https://habrastorage.org/webt/6w/sn/oc/6wsnoczljzsap2fdrldsgi47qr8.png" width="400"><br><br><ul><li>  <b>Datenschutz</b> - W√§hlen Sie <b>"Nicht im Katalog anzeigen" (Erforderlich! Andernfalls besteht die Fertigkeit keine sofortige Moderation.)</b> </li><li>  <b>Name und E-Mail-Adresse des Entwicklers</b> - Geben Sie Ihre Daten an. </li><li>  <b>Beschreibung</b> - beliebiger Text </li><li>  Symbol - ein beliebiges Symbol. </li></ul><br><img src="https://habrastorage.org/webt/70/7q/pv/707qpvhwz4bp8-g7anzd6yocavw.png" width="400"><br><br>  6. Kontopaket: <br><br><img src="https://habrastorage.org/webt/z4/vg/ep/z4vgep4de2sngw6byx34eo5s5te.png" width="400"><br><br>  Klicken Sie auf "Neu hinzuf√ºgen". <br><ul><li>  Die ersten beiden Punkte - <b>Geben Sie die Daten aus config.js / clients an</b> : </li></ul><br>  1. <b>Die Anwendungskennung</b> lautet clientId <br><br>  2. <b>Anwendungsgeheimnis</b> - clientSecret <br><br><ul><li>  <b>Autorisierungs-URL</b> - Ihre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Domain / Dialog / Autorisierung</a> </li><li>  <b>Token-URL</b> - Ihre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Domain / oauth / token</a> </li><li>  <b>Token-Update-URL</b> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ihre Dom√§ne / oauth / token</a> </li></ul><br><img src="https://habrastorage.org/webt/im/pg/zi/impgzifephas4rycqhvyll0_7uq.png" width="400"><br><br>  7. Speichern Sie die Fertigkeit <br><br><img src="https://habrastorage.org/webt/fj/ud/xy/fjudxydpqb3mwv5ksihpr277j2u.png" width="400"><br><br>  8. Klicken Sie auf "Moderation". <br><br><img src="https://habrastorage.org/webt/a2/ah/ji/a2ahjiezupvml9wo3a1pboif3pc.png"><br><br>  9. Klicken Sie auf "Ver√∂ffentlichen". <br><br><img src="https://habrastorage.org/webt/7a/jv/83/7ajv8394tns4icumhxj1qqp-eea.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Hinzuf√ºgen von Ger√§ten zu Yandex UD.</b> <div class="spoiler_text">  1. Rufen Sie die Yandex-Anwendung auf dem Telefon auf <br><br><img src="https://habrastorage.org/webt/ki/fk/t6/kifkt6ims4epu1zm2hsa2z3bef0.jpeg" width="230"><br><br>  2. W√§hlen Sie im Men√º Ger√§te / Smart Home <br><br><img src="https://habrastorage.org/webt/up/ec/ee/upeceeae_jjtrocticjinlinxmq.jpeg" width="230"><br><br>  3. Klicken Sie auf "Ger√§t hinzuf√ºgen". <br><br><img src="https://habrastorage.org/webt/-c/yn/k3/-cynk3sjwga2frnsung0wp8mtre.jpeg" width="230"><br><br>  4. W√§hlen Sie Ihre F√§higkeiten <br><br><img src="https://habrastorage.org/webt/ew/4h/jd/ew4hjdahl4eunc4kvygka1eftrs.jpeg" width="230"><br><br>  5. Klicken Sie auf "Konten zusammenf√ºhren". <br><br><img src="https://habrastorage.org/webt/ov/k7/hk/ovk7hkqe6oe0j7jvkw6eghcnycy.jpeg" width="230"><br><br>  6. Die Autorisierungsseite wird ge√∂ffnet <br><br>  <i>Login und Passwort eingeben (in der Datei config.js im Benutzerblock festgelegt)</i> <br><br><img src="https://habrastorage.org/webt/ly/lr/gw/lylrgwlzw5wcuy1c4wov6ez-2fm.jpeg" width="230"><br><br>  7. Klicken Sie auf "Zulassen". <br><br><img src="https://habrastorage.org/webt/y2/pu/tn/y2putnokvnlac9h4tuypa1sny9y.jpeg" width="230"><br><br>  8. Klicken Sie auf "Ger√§teliste aktualisieren". <br><br><img src="https://habrastorage.org/webt/cq/qd/gw/cqqdgwhp-zhmq5_ax3zbgohgrt4.jpeg" width="230"><br></div></div><br>  Jetzt kann Alice Befehle zum Verwalten der hinzugef√ºgten Ger√§te erhalten.  Entsprechende Teams kommen zu den von mqtt angegebenen Themen. <br><br>  Es bleibt noch einige Aktionen an diese Themen zu binden. <br><br><h4>  Knotenrot </h4><br>  F√ºr das Automatisierungssystem wurde Node-Red ausgew√§hlt.  Dies ist ein gro√üartiges visuelles Programmierwerkzeug.  Das Installations- und Konfigurationsverfahren finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br>  Beim Einrichten und Automatisieren eines Smart Homes wird ein oder sogar zwei Artikel in Anspruch genommen.  Und es gibt bereits viele solcher Artikel.  Stattdessen - ein kleines Beispiel f√ºr die Verwendung des Plugins, wie die Gl√ºhbirnenstimme eingeschaltet wird. <br><br>  Der Einfachheit halber erstellen wir ein virtuelles Ger√§t auf dem Wiren Board 6-Controller in der Weboberfl√§che. <br>  In der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wb-rules-</a> Regel-Engine m√ºssen Sie eingeben <br><br><pre> <b><code class="javascript hljs">defineVirtualDevice(<span class="hljs-string"><span class="hljs-string">"yandex"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">"yandex controls"</span></span>, <span class="hljs-attr"><span class="hljs-attr">cells</span></span>: { <span class="hljs-attr"><span class="hljs-attr">light1</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"switch"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, } });</code></b> </pre> <b><br></b> <br><img src="https://habrastorage.org/webt/3t/mn/qh/3tmnqhsdi1vnkdd_wr4ucnsvusc.jpeg"><br><br>  <b>Wir werden die</b> MQTT-Themen dieses virtuellen Ger√§ts in <b>config.js</b> f√ºr den Skill-Typ "on" des "Light" <b>-Ger√§ts schreiben</b> : <br><br><pre> <code class="json hljs"> devices: [ //_______________   ______________// { name: '', room: '', type: 'devices.types.light', mqtt: [ { type: 'on', set: '/devices/yandex/controls/light1/on', //   stat: '/devices/yandex/controls/light1' //   }, ], capabilities: [ { type: 'devices.capabilities.on_off', retrievable: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, state: { instance: 'on', value: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }, ] }, //_______________   _______________// ]</code> </pre><br>  Mit dem Satz ‚ÄûAlice, schalte das Licht ein / aus‚Äú schaltet das virtuelle Ger√§t. <br><br>  Gehen wir zu Node-Red, das gem√§√ü den Anweisungen installiert wurde. <br><br>  F√ºr eine bequeme Arbeit mit Wiren Board 6 k√∂nnen Sie auch das zus√§tzliche ‚ÄûNode‚Äú <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Node-Red-Contrib-Wirenboard verwenden</a> . <br><br>  Das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">WBE2R-R-ZIGBEE-</a> Erweiterungsmodul ist in der Steuerung installiert, wodurch eine Verbindung mit der IKeevskaya-Smart-Lampe der TRODFRY-Serie √ºber das ZigBee-Protokoll m√∂glich wurde. <br><br>  Jetzt liegt es an den Kleinen.  Werfen Sie einige Bl√∂cke in den Node-Red-Arbeitsbereich, verbinden Sie sie mit ‚ÄûZeichenfolgen‚Äú und klicken Sie auf Bereitstellen. <br><br><img src="https://habrastorage.org/webt/ev/p8/zn/evp8zn84umdssgxcecq9rmosgm8.jpeg"><br><br>  Die ikeevsky-Gl√ºhbirne ist √ºber das Plugin zigbee2mqtt verbunden, daher muss in mqtt das Thema der Gl√ºhbirne zur Steuerung an json gesendet werden.  Dazu f√ºgen wir eine einfache Funktion zwischen dem virtuellen WB-Ger√§t und dem Thema mqtt bulb ein. <br><br><img src="https://habrastorage.org/webt/y1/e6/9h/y1e69hfghaemcayotpvugppiqz8.jpeg"><br><br>  Klicken Sie auf Bereitstellen.  Wir pr√ºfen. <br><br>  Alice, mach das Licht an! <br><br>  Heute haben wir gelernt, wie man Alice mit einem Automatisierungssystem verbindet.  Vielleicht ist es in einigen F√§llen zu kompliziert, es ist einfacher, eine normale Wi-Fi-Gl√ºhbirne zu kaufen, und das ist genug.  Aber wenn Sie vorhaben, sich ein wirklich intelligentes Zuhause zu bauen, k√∂nnen einfache Wege hier nicht funktionieren.  Aber lohnt es sich oder nicht, jeder wird f√ºr sich selbst entscheiden.  Vielen Dank f√ºr Ihre Aufmerksamkeit! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de465537/">https://habr.com/ru/post/de465537/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de465525/index.html">Mobile Berichte zu Oracle BI EE 12c - eins, zwei, drei. Methodik aus dem Oracle BI EE 12c CAD-Kurs</a></li>
<li><a href="../de465527/index.html">Die lange Reise von RFC 4357 zu RFC 8645 oder die Verwaltung von Verschl√ºsselungsschl√ºsseln</a></li>
<li><a href="../de465529/index.html">Federung √ºber Blockierung</a></li>
<li><a href="../de465531/index.html">Entpacken verschachtelter Listen mit unbestimmter Tiefe</a></li>
<li><a href="../de465535/index.html">Wer implementiert IPv6 und was behindert seine Entwicklung?</a></li>
<li><a href="../de465539/index.html">766 km - ein neuer Reichweitenrekord f√ºr LoRaWAN</a></li>
<li><a href="../de465541/index.html">Vom Unternehmen zum KMU: Wir teilen unsere Erfahrung bei der Anpassung von Unternehmensl√∂sungen f√ºr kleine und mittlere Unternehmen mit Monetarisierung mithilfe des SaaS-Modells</a></li>
<li><a href="../de465545/index.html">Auf verschiedenen Seiten des Staates: Wie Facebook im US-Kongress gebraten wurde, w√§hrend Telegram mit dem FSB k√§mpfte</a></li>
<li><a href="../de465547/index.html">SQL-Handbuch: Besseres Schreiben von Abfragen (Teil 1)</a></li>
<li><a href="../de465551/index.html">September IT Events Digest (Teil 1)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>