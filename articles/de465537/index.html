<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💭 😿 📱 Yandex: ein Smart Home für Erwachsene 👊🏻 ✋🏿 👨🏻‍🌾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor kurzem hat Yandex sein Smart-Home-System auf den Markt gebracht. Es wird angeboten, kostengünstige Wi-Fi-Geräte zu kaufen: einen Adapter in einer ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Yandex: ein Smart Home für Erwachsene</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465537/"><img src="https://habrastorage.org/webt/rs/l_/lm/rsl_lmpzna0pj3o9ahxzsawpsn0.png"><br><br>  Vor kurzem hat Yandex sein Smart-Home-System auf den Markt gebracht.  Es wird angeboten, kostengünstige Wi-Fi-Geräte zu kaufen: einen Adapter in einer Steckdose, eine Glühbirne und eine IR-Fernbedienung.  Es ist interessant, dass die Entwickler von „intelligenten“ Geräten die Möglichkeit haben, ihre „intelligenten“ Fähigkeiten zu entwickeln. Auf diese Weise können Sie Geräte mit dem Yandex-System verbinden und ihre Stimme über Alice verwalten.  Immer mehr neue Marken erscheinen auf Skill-Listen.  Alice versteht die russische Sprache perfekt, was sie zur unbestrittenen Führungspersönlichkeit unter den Sprachassistenten auf dem russischen Markt macht. <br>  Allerdings ist nicht alles so glatt ... <br><a name="habracut"></a><br>  Erstes Minus: Grundsätzlich sind alle vorgeschlagenen Systeme „bewölkt“.  Ihre Zuverlässigkeit ist manchmal zweifelhaft, da ihre Leistung direkt von der Qualität der Verbindung mit den Servern des Herstellers abhängt.  Und wenn Sie das Internet ausschalten, verwandeln sich die Geräte vollständig in einen „Kürbis“. <br><br>  Zweites Minus: Skriptsystem.  Ein wichtiger Bestandteil eines Smart Homes sind die Skripte.  Und hier sind sie sehr primitiv: Wenn "der Ausdruck so und so ist", dann aktivieren Sie "das Gerät ist so und so".  Für mein Smart Home war das zu wenig. <br><br>  Die Nachteile enden nicht dort, aber der Rest hängt eher mit der Unreife des Systems zusammen.  Das Yandex-Entwicklungsteam fügt weiterhin aktiv verschiedene Funktionen und zu bearbeitende Fehler hinzu, wofür wir uns sehr bedanken! <br><br>  Nachdem ich die Dokumentation studiert hatte, entschied ich mich, die Yandex UD-Fähigkeit zu erstellen und den Smart Home-Controller daran anzuschließen.  Auf diese Weise können Sie sich nicht auf Cloud-Server verlassen, Skripts lokal auf dem Controller implementieren und gleichzeitig das System per Spracheingabe über Alice steuern.  Dafür habe ich das Plugin "yandex2mqtt" auf Node.js geschrieben. <br><br><h4>  Ein bisschen Theorie </h4><br>  - Alice, mach das Licht an. <br>  Nach diesem Satz geschieht Magie und das Licht geht an.  Aber was ist hinter den Kulissen?  Lassen Sie uns herausfinden, wie das alles funktioniert. <br><br>  Nachdem die Yandex-Station einen vertrauten Befehl gehört hat, sendet sie Daten an den Yandex-Server, an den wir im Voraus die Adresse unseres Controllers angegeben haben.  Der Server verarbeitet die Informationen und leitet sie in Form einer Post-Anfrage an den Controller weiter.  Auf dem Controller verarbeitet die Zwischen-API (in unserem Fall das yandex2mqtt-Plugin) die Anforderung und leitet sie an das MQTT-Thema weiter.  Als nächstes wird das Skript im Node-Red-Programm verarbeitet. <br><br>  Node-Red entscheidet, was als nächstes zu tun ist.  Wenn das Skript dies vorsieht, sendet er einen Befehl zum Einschalten des Lichts im entsprechenden MQTT-Thema.  Der wb-mqtt-serial-Treiber sendet daraufhin einen Modbus-Befehl an das Relaismodul, das das Relais schaltet.  Und schließlich geht das Licht an!  Ja, der Pfad ist nicht eng, aber ein Bruchteil eines zweiten Durchgangs für den Benutzer. <br><br>  Schauen wir uns das yandex2mqtt-Plugin genauer an.  Das erste, was Yandex benötigt, damit die Fähigkeit funktioniert, ist der oAuth-Dienst zum Bündeln von Konten in der Yandex-Anwendung.  Nachdem Yandex das Autorisierungstoken vom oAuth-Dienst erhalten hat, fordert es eine Liste der Geräte an.  Das yandex2mqtt-Plugin antwortet mit einer Liste von Geräten mit allen Eigenschaften im JSON-Format.  Dann erscheinen sie in der Liste der zur Steuerung verfügbaren Geräte (im sogenannten Quasar).  Wenn Sie Alice nun anweisen, ein Gerät aus der Liste einzuschalten, sendet Yandex eine Post-Anfrage mit den Daten des Geräts, das er einschalten möchte, an den Controller.  Als Antwort bestätigt das Plugin die Aufnahme und schreibt den neuen Status in das in den Einstellungen desselben Plugins angegebene mqtt-Thema.  Wenn das Gerät seinen Status ohne die Teilnahme von Yandex geändert hat, sendet das Plug-In, das die neuen Daten im Thema mqtt sieht, diese an Yandex, wenn es den Status anfordert. Dies geschieht jetzt nur, wenn Sie das Gerät selbst in Quasar aufrufen.  In anderen Fällen fragt Yandex den Status nicht ab. <br>  Jetzt werde ich über einige Eigenschaften von Yandex UD-Geräten sprechen. <br><br><h4>  Gerätetyp </h4><br>  Für eine korrekte Anzeige im „Quasar“ und eine genauere Definition der Befehle durch Alice schlägt Yandex vor, Geräten verschiedene Gerätetypen zuzuweisen.  Gesamttypen 10: <br><br><ul><li>  <b>Geräte.Typen.Licht</b> - Jede Lampe, Kronleuchter, Glühbirne usw. </li><li>  <b>Geräte.Typen.Socket</b> - Outlet </li><li>  <b>Geräte.Typen.Schalter</b> - Schalter </li><li>  <b>Geräte.Typen.Thermostat</b> - Thermostat </li><li>  <b>Geräte.Typen.Thermostat.ac</b> - Klimaanlage </li><li>  <b>device.types.media_device</b> - Mediengerät </li><li>  <b>device.types.media_device.tv</b> - TV </li><li>  <b>Geräte.Typen.Kochen</b> - Küchengeräte </li><li>  <b>Geräte.Typen.Kochen.Kessel</b> - Hersteller </li><li>  <b>device.types.other</b> - Alles andere, was nicht zu den vorherigen Absätzen passte. </li></ul><br><h5>  Fähigkeit </h5><br>  Außerdem muss jedes Gerät mindestens eine <b>Funktion haben</b> . <br><br>  Insgesamt verfügt Yandex UD über 5 Arten von Fähigkeiten.  Jede Fähigkeit hat eine andere Funktion <b>(Instanz)</b> , und einige Fähigkeiten haben mehrere solche Funktionen, was die Flexibilität bei der Konfiguration von Geräten erhöht. <br><br>  <b>Fähigkeiten:</b> <br><br>  1. <b>device.capabilities.on_off</b> - <b>Ein-</b> und ausschalten. <br><br>  Instanz: <br><br><ul><li>  auf </li></ul><br>  2. <b>Geräte.Fähigkeiten.Farbeinstellung</b> - Farbmanagement. <br><br>  Instanz: <br><br><ul><li>  rgb </li><li>  hsv </li><li>  Temperatur_k </li></ul><br>  3. <b>Geräte.Fähigkeiten.Modus - Modus wechseln.</b> <br><br>  Instanz: <br><br><ul><li>  Thermostat </li><li>  fan_speed </li></ul><br>  4. <b>Geräte.Fähigkeiten.Bereich - Bereichssteuerung.</b> <br><br>  Instanz: <br><br><ul><li>  Helligkeit </li><li>  Temperatur </li><li>  Lautstärke </li><li>  Kanal </li></ul><br>  5. <b>device.capabilities.toggle - Stumm.</b> <br><br>  Instanz: <br><br><ul><li>  stumm schalten </li></ul><br><br>  Mit der richtigen Kombination aller Eigenschaften des Geräts versteht Alice problemlos alle Befehle, die ihr zur Verwaltung des Smart Home gegeben wurden.  Hier gibt es natürlich einige Schwierigkeiten beim Kombinieren von Fähigkeiten.  Die Dokumentation gibt eindeutig nicht an, welche Fähigkeiten kombiniert werden können und welche nicht.  Aber die "wissenschaftliche Poke-Methode" wird uns dabei helfen. <br><br>  So fand ich zum Beispiel heraus, dass die Klimaanlage vier Fähigkeiten enthält: <br><br>  Gerätetyp: <br><br>  <b>Geräte.Typen.Thermostat.ac</b> <br><br>  Fähigkeitstyp: <br><br>  <b>Geräte.Fähigkeiten.on_off</b> <br><br>  Instanz: <br><br><ul><li>  auf </li></ul><br>  <b>Geräte.Fähigkeiten.Bereich</b> <br>  Instanz: <br><br><ul><li>  Temperatur </li></ul><br>  <b>Geräte.Kapazitäten.Modus</b> <br>  Instanz: <br><br><ul><li>  Thermostat </li></ul><br>  <b>Geräte.Kapazitäten.Modus</b> <br>  Instanz: <br><br><ul><li>  fan_speed </li></ul><br>  Ich werde die restlichen Eigenschaften nicht beschreiben, dort ist alles ganz einfach. <br><br>  Damit es funktioniert, benötigen Sie: <br><br><ul><li>  <b>Controller</b> </li><li>  <b>Beliebige Domain</b> </li><li>  <b>SSL-Zertifikat</b> </li><li>  <b>Node.js</b> </li><li>  <b>Yandex2mqtt Plugin</b> </li><li>  <b>MQTT-Broker</b> </li><li>  <b>Knotenrot</b> </li></ul><br><h3>  Controller </h3><br>  Meine „intelligente“ Wohnung wird vom Wiren Board 6 gesteuert. Sie können jedoch jeden anderen Linux-Controller verwenden, der Node.js und Node-Red abruft.  Zum Beispiel Raspberry Pi oder PC. <br><br><h4>  Domain </h4><br>  Natürlich ist es wünschenswert, eine weiße IP-Adresse zu haben und eine Domain zu kaufen, aber dies ist nicht notwendig.  Sie können DDNS verwenden, z. B. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">www.noip.com</a> . <br><br>  Hier ist alles einfach: Registrieren, kostenlosen Hostnamen erstellen, IP-Adresse eingeben.  Einige Router verfügen über eine spezielle DDNS-Einstellung, in die Sie noip.com-Daten eingeben können.  Der Router sendet automatisch eine IP-Adresse, wenn diese geändert wird.  Wenn im Router keine solche Einstellung vorhanden ist, können Sie das Noip-Programm auf dem Controller installieren und zur automatischen Ausführung hinzufügen.  Das Programm macht genau das Gleiche wie ein Router mit speziellen DDNS-Einstellungen - aktualisieren Sie Ihre IP-Adresse in der Datenbank noip.com <br><br>  Daher haben wir eine statische Adresse, die alle Anforderungen an unseren Controller umleitet. <br><br><h4>  Ports 443 und 80 </h4><br>  Jetzt hat fast jeder zu Hause einen Router.  Zusätzlich zu seinen offensichtlichen Funktionen ist es auch ein Hindernis für das lokale Netzwerk durch unerwünschte Gäste von außen.  In bestimmten Fällen benötigen wir jedoch von außen Zugriff auf das interne Netzwerk.  Routerhersteller stellten sich dies vor und fügten die NAT-Funktion (Network Address Translation) hinzu. <br><br>  Ich werde den Zeitpunkt der Einrichtung des Routers nicht beschreiben, da er für jeden Hersteller unterschiedlich ist.  Lesen Sie dazu die Anweisungen für Ihren Router.  Google-Schlüsselwörter: Portweiterleitung, Portzuordnung, NAT. <br><br>  Es ist erforderlich, den Port für den Zugriff auf yandex2mqtt (es kann jeder sein, ich habe 443 gewählt) und Port 80 weiterzuleiten (nur erforderlich, um ein SSL-Zertifikat zu erhalten. Nach Erhalt des Zertifikats kann Port 80 geschlossen werden). <br><br><h4>  SSL-Zertifikat </h4><br>  Setzen Sie sofort alle Punkte auf das "und": Selbstsignierte Zertifikate funktionieren nicht. <br>  Die meisten Domain-Registrare (z. B. reg.ru) geben ihren Kunden kostenlose SSL-Zertifikate für die Hauptdomain (www.IhreDomain.ru).  Wenn Sie eine Domain speziell für Alice gekauft haben, können Sie das bereitgestellte SSL-Zertifikat verwenden. <br><br>  Wenn Sie keine eigene Domain haben oder Alice eine andere Subdomain zugewiesen ist (z. B. alice.yourdomain.ru), benötigen Sie ein Zertifikat für diese Subdomain oder für die vom DDNS-Dienst angegebene Adresse. <br><br>  Zu diesem Zweck schlage ich vor, den kostenlosen Dienst zu verwenden, um ein SSL-Zertifikat von letsencrypt.org zu erhalten. <br><br>  Um ein Zertifikat zu erhalten, müssen Sie das certbot-Programm installieren, alle angeforderten Daten ausführen und angeben.  Gleichzeitig sollte Port 80 frei und von außen zugänglich sein. Ich rate Ihnen, die Anweisungen von letsencrypt sorgfältig zu lesen. <br><br><div class="spoiler">  <b class="spoiler_title">Installieren und konfigurieren Sie certbot</b> <div class="spoiler_text"><pre><code class="bash hljs">apt-get update apt-get install certbot</code> </pre> <br><br>  Stoppen Sie die Watchdog- und Nginx-Dienste. <br><br><pre> <code class="bash hljs">service watchdog stop service nginx stop</code> </pre> <br>  Wir leiten den 80. Port im Router weiter. <br><br>  Führen Sie das certbot-Programm aus: <br><br><pre> <code class="bash hljs">certbot certonly --standalone</code> </pre> <br>  Nach dem Start stellt das Programm einige einfache Fragen. <br><br>  1. Ihre E-Mail.  Geben Sie einfach die Adresse ein und drücken Sie die Eingabetaste <br><br><img src="https://habrastorage.org/webt/mn/gf/si/mngfsiaatuo6txsrtc6wyyz4v_o.png"><br><br>  2. Sie werden aufgefordert, die Benutzervereinbarungen zu lesen.  Wenn Sie mit allem einverstanden sind, geben Sie einfach "A" ein, was "zustimmen" bedeutet, dh ich stimme zu. <br><br><img src="https://habrastorage.org/webt/y8/zz/to/y8zztosybjouwmncxuawmbq-55c.png"><br><br>  3. Das Programm bittet um die Erlaubnis, Ihre E-Mail-Adresse an die Entwickler zu senden.  Geben Sie N ein. <br><br><img src="https://habrastorage.org/webt/pn/y_/yw/pny_ywp5pjfj7gupd09m3hnbmg4.png"><br><br>  4. Geben Sie Ihre Domain ein, für die Sie ein Zertifikat erhalten möchten (Sie können die Domain eingeben, die wir zuvor in noip erhalten haben).  Hier gebe ich ein Beispiel für fehlerhafte Eingaben.  Das Präfix http: // ist nicht erforderlich. <br><br><img src="https://habrastorage.org/webt/mt/bj/py/mtbjpyenb63jqv3gvtd_oyh9qze.png"><br><br>  Wenn Sie alles richtig gemacht haben, sehen Sie Folgendes: <br><br><img src="https://habrastorage.org/webt/ug/7c/kf/ug7ckfuvos8bkgfgzvaepqvu48s.png"><br><br>  Dies bedeutet, dass das Zertifikat erfolgreich empfangen wurde.  Denken Sie an den Pfad zum Zertifikat und Schlüssel, der bei der Konfiguration des yandex2mqtt-Plugins erforderlich ist.  Schließen Sie aus Sicherheitsgründen Port 80 in den Router-Einstellungen. Dies ist nicht mehr sinnvoll. <br><br>  Wir schalten die Watchdog- und Nginx-Dienste ein. <br><br><pre> <code class="bash hljs">service nginx start service watchdog start</code> </pre> <br>  Das Zertifikat von letsencrypt wird für <b>3</b> Monate ausgestellt.  <b>Vergessen Sie nicht zu aktualisieren.</b> <br><br></div></div><br><h4>  Node.js und das yandex2mqtt-Plugin </h4><br><div class="spoiler">  <b class="spoiler_title">Installation</b> <div class="spoiler_text">  Konfigurieren des Repositorys node.js. <br><br><pre> <code class="bash hljs">curl -sL https://deb.nodesource.com/setup_10.x | bash -</code> </pre> <br>  Installieren oder aktualisieren Sie anschließend alle erforderlichen Komponenten <br><br><pre> <code class="bash hljs">apt-get install -y nodejs git make g++ gcc build-essential</code> </pre> <br>  Kopieren Sie nach erfolgreicher Installation das yandex2mqtt-Repository auf den Controller. <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/munrexio/yandex2mqtt.git /mnt/data/root/yandex2mqtt</code> </pre> <br>  Wir setzen die Rechte. <br><br><pre> <code class="bash hljs">chown -R root:root /mnt/data/root/yandex2mqtt</code> </pre> <br>  Wir gehen zum Ordner. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /mnt/data/root/yandex2mqtt</code> </pre> <br>  Wir starten die Installation. <br><br><pre> <code class="bash hljs">npm install</code> </pre> <br>  Installation abgeschlossen. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Autostart</b> <div class="spoiler_text">  <b>Erstellen Sie eine systemd-Einheit:</b> <br><br>  <b>Wechseln</b> Sie in den Ordner <b>/ etc / systemd / system /</b> auf dem Controller und erstellen Sie eine Datei mit dem Namen <b>yandex2mqtt.service</b> .  Kopieren Sie Folgendes hinein: <br><br><pre> <code class="bash hljs">[Unit] Description=yandex2mqtt After=network.target [Service] ExecStart=/usr/bin/npm start WorkingDirectory=/mnt/data/root/yandex2mqtt StandardOutput=inherit StandardError=inherit Restart=always User=root [Install] WantedBy=multi-user.target</code> </pre> <br>  Speichern Sie danach die Änderungen und schließen Sie die Datei. <br><br>  Geben Sie den Befehl in die Konsole ein, um das Gerät zu aktivieren: <br><br><pre> <code class="bash hljs">systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> yandex2mqtt.service</code> </pre> <br><br>  Jetzt können Sie das Plugin mit Befehlen starten und stoppen <br><br><pre> <code class="bash hljs">service yandex2mqtt start service yandex2mqtt stop service yandex2mqtt restart</code> </pre> <br></div></div><br>  <b>Einrichtung:</b> <br><br>  Alle erforderlichen Plug-In-Einstellungen befinden sich in der Datei <b>/mnt/data/root/yandex2mqtt/config.js</b> <br>  Bearbeiten Sie diese Datei gemäß Ihren Parametern. <br>  Das SSL-Zertifikat muss vollständig <b>verkettet sein</b> . <br><br>  Führen Sie nach der Konfiguration yandex2mqtt mit dem folgenden Befehl aus: <br><br><pre> <code class="bash hljs">service yandex2mqtt start</code> </pre> <br>  Nach dem Einrichten und Starten der Bridge empfehle ich Ihnen, das Zertifikat auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dieser Site</a> zu überprüfen. <br><br>  Geben Sie einfach Ihre Domain ein, mit der Sie auf Alice zugreifen möchten.  Für einen ordnungsgemäßen Betrieb muss das Zertifikat alle Prüfungen bestehen.  Sonst funktioniert nichts. <br><br><h4>  Fähigkeit Yandex UD </h4><br><div class="spoiler">  <b class="spoiler_title">Fähigkeitserstellung</b> <div class="spoiler_text">  1. Gehen Sie zur Seite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dialogs.yandex.ru/developer</a> <br>  2. Melden Sie sich mit Ihrem Konto an. <br>  3. Klicken Sie auf "Dialog erstellen". <br>  4. Wählen Sie "Smart Home" <br>  5. Geben Sie die erforderlichen Parameter ein: <br><br><ul><li>  <b>Name</b> - Beliebiger Name. </li><li>  <b>Endpunkt-URL</b> - eine Adresse vom Typ <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ihrer Domäne / Ihres Anbieters</a></b> , wobei anstelle von <b>"</b> Ihre Domäne" die Adresse von noip oder Ihrer Domäne ist, für die ein SSL-Zertifikat empfangen wird. </li></ul><br><img src="https://habrastorage.org/webt/6w/sn/oc/6wsnoczljzsap2fdrldsgi47qr8.png" width="400"><br><br><ul><li>  <b>Datenschutz</b> - Wählen Sie <b>"Nicht im Katalog anzeigen" (Erforderlich! Andernfalls besteht die Fertigkeit keine sofortige Moderation.)</b> </li><li>  <b>Name und E-Mail-Adresse des Entwicklers</b> - Geben Sie Ihre Daten an. </li><li>  <b>Beschreibung</b> - beliebiger Text </li><li>  Symbol - ein beliebiges Symbol. </li></ul><br><img src="https://habrastorage.org/webt/70/7q/pv/707qpvhwz4bp8-g7anzd6yocavw.png" width="400"><br><br>  6. Kontopaket: <br><br><img src="https://habrastorage.org/webt/z4/vg/ep/z4vgep4de2sngw6byx34eo5s5te.png" width="400"><br><br>  Klicken Sie auf "Neu hinzufügen". <br><ul><li>  Die ersten beiden Punkte - <b>Geben Sie die Daten aus config.js / clients an</b> : </li></ul><br>  1. <b>Die Anwendungskennung</b> lautet clientId <br><br>  2. <b>Anwendungsgeheimnis</b> - clientSecret <br><br><ul><li>  <b>Autorisierungs-URL</b> - Ihre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Domain / Dialog / Autorisierung</a> </li><li>  <b>Token-URL</b> - Ihre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Domain / oauth / token</a> </li><li>  <b>Token-Update-URL</b> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ihre Domäne / oauth / token</a> </li></ul><br><img src="https://habrastorage.org/webt/im/pg/zi/impgzifephas4rycqhvyll0_7uq.png" width="400"><br><br>  7. Speichern Sie die Fertigkeit <br><br><img src="https://habrastorage.org/webt/fj/ud/xy/fjudxydpqb3mwv5ksihpr277j2u.png" width="400"><br><br>  8. Klicken Sie auf "Moderation". <br><br><img src="https://habrastorage.org/webt/a2/ah/ji/a2ahjiezupvml9wo3a1pboif3pc.png"><br><br>  9. Klicken Sie auf "Veröffentlichen". <br><br><img src="https://habrastorage.org/webt/7a/jv/83/7ajv8394tns4icumhxj1qqp-eea.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Hinzufügen von Geräten zu Yandex UD.</b> <div class="spoiler_text">  1. Rufen Sie die Yandex-Anwendung auf dem Telefon auf <br><br><img src="https://habrastorage.org/webt/ki/fk/t6/kifkt6ims4epu1zm2hsa2z3bef0.jpeg" width="230"><br><br>  2. Wählen Sie im Menü Geräte / Smart Home <br><br><img src="https://habrastorage.org/webt/up/ec/ee/upeceeae_jjtrocticjinlinxmq.jpeg" width="230"><br><br>  3. Klicken Sie auf "Gerät hinzufügen". <br><br><img src="https://habrastorage.org/webt/-c/yn/k3/-cynk3sjwga2frnsung0wp8mtre.jpeg" width="230"><br><br>  4. Wählen Sie Ihre Fähigkeiten <br><br><img src="https://habrastorage.org/webt/ew/4h/jd/ew4hjdahl4eunc4kvygka1eftrs.jpeg" width="230"><br><br>  5. Klicken Sie auf "Konten zusammenführen". <br><br><img src="https://habrastorage.org/webt/ov/k7/hk/ovk7hkqe6oe0j7jvkw6eghcnycy.jpeg" width="230"><br><br>  6. Die Autorisierungsseite wird geöffnet <br><br>  <i>Login und Passwort eingeben (in der Datei config.js im Benutzerblock festgelegt)</i> <br><br><img src="https://habrastorage.org/webt/ly/lr/gw/lylrgwlzw5wcuy1c4wov6ez-2fm.jpeg" width="230"><br><br>  7. Klicken Sie auf "Zulassen". <br><br><img src="https://habrastorage.org/webt/y2/pu/tn/y2putnokvnlac9h4tuypa1sny9y.jpeg" width="230"><br><br>  8. Klicken Sie auf "Geräteliste aktualisieren". <br><br><img src="https://habrastorage.org/webt/cq/qd/gw/cqqdgwhp-zhmq5_ax3zbgohgrt4.jpeg" width="230"><br></div></div><br>  Jetzt kann Alice Befehle zum Verwalten der hinzugefügten Geräte erhalten.  Entsprechende Teams kommen zu den von mqtt angegebenen Themen. <br><br>  Es bleibt noch einige Aktionen an diese Themen zu binden. <br><br><h4>  Knotenrot </h4><br>  Für das Automatisierungssystem wurde Node-Red ausgewählt.  Dies ist ein großartiges visuelles Programmierwerkzeug.  Das Installations- und Konfigurationsverfahren finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br>  Beim Einrichten und Automatisieren eines Smart Homes wird ein oder sogar zwei Artikel in Anspruch genommen.  Und es gibt bereits viele solcher Artikel.  Stattdessen - ein kleines Beispiel für die Verwendung des Plugins, wie die Glühbirnenstimme eingeschaltet wird. <br><br>  Der Einfachheit halber erstellen wir ein virtuelles Gerät auf dem Wiren Board 6-Controller in der Weboberfläche. <br>  In der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wb-rules-</a> Regel-Engine müssen Sie eingeben <br><br><pre> <b><code class="javascript hljs">defineVirtualDevice(<span class="hljs-string"><span class="hljs-string">"yandex"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">"yandex controls"</span></span>, <span class="hljs-attr"><span class="hljs-attr">cells</span></span>: { <span class="hljs-attr"><span class="hljs-attr">light1</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"switch"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, } });</code></b> </pre> <b><br></b> <br><img src="https://habrastorage.org/webt/3t/mn/qh/3tmnqhsdi1vnkdd_wr4ucnsvusc.jpeg"><br><br>  <b>Wir werden die</b> MQTT-Themen dieses virtuellen Geräts in <b>config.js</b> für den Skill-Typ "on" des "Light" <b>-Geräts schreiben</b> : <br><br><pre> <code class="json hljs"> devices: [ //_______________   ______________// { name: '', room: '', type: 'devices.types.light', mqtt: [ { type: 'on', set: '/devices/yandex/controls/light1/on', //   stat: '/devices/yandex/controls/light1' //   }, ], capabilities: [ { type: 'devices.capabilities.on_off', retrievable: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, state: { instance: 'on', value: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }, ] }, //_______________   _______________// ]</code> </pre><br>  Mit dem Satz „Alice, schalte das Licht ein / aus“ schaltet das virtuelle Gerät. <br><br>  Gehen wir zu Node-Red, das gemäß den Anweisungen installiert wurde. <br><br>  Für eine bequeme Arbeit mit Wiren Board 6 können Sie auch das zusätzliche „Node“ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Node-Red-Contrib-Wirenboard verwenden</a> . <br><br>  Das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">WBE2R-R-ZIGBEE-</a> Erweiterungsmodul ist in der Steuerung installiert, wodurch eine Verbindung mit der IKeevskaya-Smart-Lampe der TRODFRY-Serie über das ZigBee-Protokoll möglich wurde. <br><br>  Jetzt liegt es an den Kleinen.  Werfen Sie einige Blöcke in den Node-Red-Arbeitsbereich, verbinden Sie sie mit „Zeichenfolgen“ und klicken Sie auf Bereitstellen. <br><br><img src="https://habrastorage.org/webt/ev/p8/zn/evp8zn84umdssgxcecq9rmosgm8.jpeg"><br><br>  Die ikeevsky-Glühbirne ist über das Plugin zigbee2mqtt verbunden, daher muss in mqtt das Thema der Glühbirne zur Steuerung an json gesendet werden.  Dazu fügen wir eine einfache Funktion zwischen dem virtuellen WB-Gerät und dem Thema mqtt bulb ein. <br><br><img src="https://habrastorage.org/webt/y1/e6/9h/y1e69hfghaemcayotpvugppiqz8.jpeg"><br><br>  Klicken Sie auf Bereitstellen.  Wir prüfen. <br><br>  Alice, mach das Licht an! <br><br>  Heute haben wir gelernt, wie man Alice mit einem Automatisierungssystem verbindet.  Vielleicht ist es in einigen Fällen zu kompliziert, es ist einfacher, eine normale Wi-Fi-Glühbirne zu kaufen, und das ist genug.  Aber wenn Sie vorhaben, sich ein wirklich intelligentes Zuhause zu bauen, können einfache Wege hier nicht funktionieren.  Aber lohnt es sich oder nicht, jeder wird für sich selbst entscheiden.  Vielen Dank für Ihre Aufmerksamkeit! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de465537/">https://habr.com/ru/post/de465537/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de465525/index.html">Mobile Berichte zu Oracle BI EE 12c - eins, zwei, drei. Methodik aus dem Oracle BI EE 12c CAD-Kurs</a></li>
<li><a href="../de465527/index.html">Die lange Reise von RFC 4357 zu RFC 8645 oder die Verwaltung von Verschlüsselungsschlüsseln</a></li>
<li><a href="../de465529/index.html">Federung über Blockierung</a></li>
<li><a href="../de465531/index.html">Entpacken verschachtelter Listen mit unbestimmter Tiefe</a></li>
<li><a href="../de465535/index.html">Wer implementiert IPv6 und was behindert seine Entwicklung?</a></li>
<li><a href="../de465539/index.html">766 km - ein neuer Reichweitenrekord für LoRaWAN</a></li>
<li><a href="../de465541/index.html">Vom Unternehmen zum KMU: Wir teilen unsere Erfahrung bei der Anpassung von Unternehmenslösungen für kleine und mittlere Unternehmen mit Monetarisierung mithilfe des SaaS-Modells</a></li>
<li><a href="../de465545/index.html">Auf verschiedenen Seiten des Staates: Wie Facebook im US-Kongress gebraten wurde, während Telegram mit dem FSB kämpfte</a></li>
<li><a href="../de465547/index.html">SQL-Handbuch: Besseres Schreiben von Abfragen (Teil 1)</a></li>
<li><a href="../de465551/index.html">September IT Events Digest (Teil 1)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>