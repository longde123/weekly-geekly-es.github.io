<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏾‍💼 👩‍🏭 👸🏿 Pencarian Alamat MAC pada Switch Juniper 💟 🙏🏽 📓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Di jaringan lokal, Anda sering perlu mencari tahu di port mana switch alamat MAC spesifik perangkat berada. Masalahnya mudah diselesaikan jika ada beb...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pencarian Alamat MAC pada Switch Juniper</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/plarium/blog/420013/">  Di jaringan lokal, Anda sering perlu mencari tahu di port mana switch alamat MAC spesifik perangkat berada.  Masalahnya mudah diselesaikan jika ada beberapa switch di jaringan, tetapi ketika ada lebih dari 30 dari mereka, semuanya menjadi jauh lebih rumit.  Saya ingin berbagi skrip Python kecil yang mencari alamat MAC yang diinginkan di jaringan dan mengembalikan nama dan port switch di mana MAC ini terdaftar. <br><br><img src="https://habrastorage.org/webt/ui/sl/tm/uisltmawb4week0qnbf04l0p7um.png"><br><br>  Kritik konstruktif dipersilahkan.  Detail di bawah potongan. <br><a name="habracut"></a><br>  Jika desain jaringan dilakukan dengan benar, yaitu, sakelar <b>CORE</b> root, ke mana sakelar distribusi <b>DS</b> (Distribution Switch) terhubung, dan pada gilirannya, level akses <b>AS</b> (Access Switch) beralih.  Aturan ini tidak selalu benar, sakelar akses dapat dihubungkan secara seri.  Dalam kasus apa pun, port sakelar hulu berisi semua alamat MAC perangkat yang terhubung ke sakelar hilir. <br><br>  Misalnya, jika perangkat yang menarik bagi kami terhubung ke switch <b>AS3</b> , maka, memulai pencarian dengan <b>CORE</b> , kami akan menemukan alamat ini pada port yang mengarah ke <b>DS1</b> .  Pergi ke <b>DS1</b> , kita akan menemukan MAC ini di port yang mengarah ke <b>AS2</b> , pergi ke <b>AS2</b> , kita akan melihat bahwa itu membawa kita ke <b>AS3</b> , dan hanya pada <b>AS3</b> kita akan menemukan port spesifik di mana perangkat yang terkait terhubung. <br><br>  Saya tidak ingin melakukan semuanya dengan tangan, memilah-milah semua sakelar dalam satu lingkaran dan menentukan di mana uplink berada dan di mana tidak terlalu, sehingga solusi berikutnya lahir, yang ingin saya bagikan. <br><br><h4>  Sedikit teori. </h4><br>  Untuk menemukan MAC <b>08: 62: 66: c7: b3: 45</b> pada sakelar Juniper, jalankan perintah berikut: <br><br><pre><code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ethernet-switching <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> | <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">62</span></span>:<span class="hljs-number"><span class="hljs-number">66</span></span>:c7:b3:<span class="hljs-number"><span class="hljs-number">45</span></span></code> </pre> <br>  Jika ada MAC seperti itu, jawabannya adalah sebagai berikut: <br><br><pre> <code class="hljs ruby">vlan151 08<span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">62</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">66</span></span><span class="hljs-symbol"><span class="hljs-symbol">:c7</span></span><span class="hljs-symbol"><span class="hljs-symbol">:b3</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">45</span></span> D - xe-<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">23.0</span></span></code> </pre> <br>  Kolom terakhir adalah nama antarmuka sakelar tempat MAC terdaftar.  Tetapi bagaimana memahami di mana antarmuka ini mengarah?  Dan di sini <b>Deskripsi Antarmuka</b> datang untuk menyelamatkan.  Ini adalah baris dalam file konfigurasi sakelar yang memungkinkan Anda menetapkan label teks untuk antarmuka. <br><br>  Tim <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">show</span></span> interfaces xe<span class="hljs-number"><span class="hljs-number">-0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">23</span></span> descriptions</code> </pre> <br>  akan menunjukkan yang berikut: <br><br><pre> <code class="hljs pgsql">Interface <span class="hljs-keyword"><span class="hljs-keyword">Admin</span></span> Link Description xe<span class="hljs-number"><span class="hljs-number">-0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">23</span></span> up up SW&gt;DS1</code> </pre> <br>  Dalam konfigurasi, kami menunjukkan bahwa antarmuka ini mengarah ke sakelar hilir: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">set</span></span> interfaces xe-<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">23</span></span> description <span class="hljs-type"><span class="hljs-type">SW</span></span>&gt;<span class="hljs-type"><span class="hljs-type">DS1</span></span></code> </pre> <br><h4>  Implementasi </h4><br>  Skrip yang diusulkan akan melakukan hal berikut: <br><br><ol><li>  Terhubung melalui SSH ke sakelar root </li><li>  periksa antarmuka yang alamat MAC yang dilewati dalam parameter berada; </li><li>  Periksa Deskripsi antarmuka ini; </li><li>  jika antarmuka mengarah ke sakelar, akses sakelar berikutnya dalam rantai secara rekursif. </li></ol><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#       searchpass = [] #main      MAC-    checkswitch,           MAC-.       searchpass   json. def main(argv): mac_addr = argv[0] checkswitch('CORE',mac_addr) for switch in searchpass: print (json.dumps(switch, ensure_ascii=False)) if __name__ == "__main__": main(sys.argv[1:]) #   MAC- def checkswitch(hostname,mac_addr): try: #    ,  host    returnvalue = {} returnvalue['host']=hostname #sendCommand      SSH     MAC-    answer = sendCommand(hostname,'show ethernet-switching table | match '+mac_addr) #   ,      #vlan151 08:62:66:c7:b3:45 D - xe-0/0/23.0 if(answer!=0): iface = answer.split()[4] returnvalue['iface']=iface # description ,    2  .0       #xe-0/0/23 up up SW&gt;DS01 answer = sendCommand(hostname,'show interfaces '+iface[:-2]+' descriptions | last 1 | no-more') iface = answer.split() # description   ,      ,     SW&gt;.  ,   3 ,         . if(len(iface)&gt;2): iface=iface[3] returnvalue['description']=iface else: returnvalue['description']='none' searchpass.append(returnvalue) if (iface[:3]=='SW&gt;'): checkswitch(iface[3:],mac_addr) else: returnvalue['iface']='none' searchpass.append(returnvalue) except Exception as e: print(e)</span></span></code> </pre> <br>  Dengan demikian, skrip akan melalui semua switch jaringan, mulai dari kernel, dan mencoba untuk menemukan MAC yang diinginkan.  Untuk operasi yang sukses, itu cukup untuk menjaga deskripsi pada antarmuka tetap up to date, dan topologi dapat dari hampir semua kompleksitas. <br><br>  Contoh skrip: <br><br><pre> <code class="hljs ruby">python findmac.py <span class="hljs-number"><span class="hljs-number">00</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">17</span></span><span class="hljs-symbol"><span class="hljs-symbol">:fc</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">21</span></span><span class="hljs-symbol"><span class="hljs-symbol">:e8</span></span><span class="hljs-symbol"><span class="hljs-symbol">:f9</span></span> {<span class="hljs-string"><span class="hljs-string">"host"</span></span>: <span class="hljs-string"><span class="hljs-string">"CORE"</span></span>, <span class="hljs-string"><span class="hljs-string">"iface"</span></span>: <span class="hljs-string"><span class="hljs-string">"xe-0/0/23.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"SW&gt;DS1"</span></span>} {<span class="hljs-string"><span class="hljs-string">"host"</span></span>: <span class="hljs-string"><span class="hljs-string">"DS1"</span></span>, <span class="hljs-string"><span class="hljs-string">"iface"</span></span>: <span class="hljs-string"><span class="hljs-string">"xe-0/0/11.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"SW&gt;AS2"</span></span>} {<span class="hljs-string"><span class="hljs-string">"host"</span></span>: <span class="hljs-string"><span class="hljs-string">"AS2"</span></span>, <span class="hljs-string"><span class="hljs-string">"iface"</span></span>: <span class="hljs-string"><span class="hljs-string">"xe-1/0/1.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"SW&gt;AS3"</span></span>} {<span class="hljs-string"><span class="hljs-string">"host"</span></span>: <span class="hljs-string"><span class="hljs-string">"AS3"</span></span>, <span class="hljs-string"><span class="hljs-string">"iface"</span></span>: <span class="hljs-string"><span class="hljs-string">"ge-0/0/26.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"none"</span></span>}</code> </pre> <br>  Jika tidak ada MAC, kita dapatkan <br><br><pre> <code class="hljs json">{<span class="hljs-attr"><span class="hljs-attr">"host"</span></span>: <span class="hljs-string"><span class="hljs-string">"CORE"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"iface"</span></span>: <span class="hljs-string"><span class="hljs-string">"none"</span></span>}</code> </pre> <br>  Baris terakhir adalah saklar dan port yang menarik minat kami, tetapi pada saat yang sama kami dapat melacak seluruh jalur pencarian. <br><br>  Kode lengkapnya ada di bawah spoiler, terima kasih atas perhatian Anda. <br><br><div class="spoiler">  <b class="spoiler_title">findmac.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> paramiko <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> threading <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> logging login = <span class="hljs-string"><span class="hljs-string">'user1'</span></span> password = <span class="hljs-string"><span class="hljs-string">'pass1234'</span></span> searchpass = [] port = <span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LogPipe</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(threading.Thread)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, level)</span></span></span><span class="hljs-function">:</span></span> threading.Thread.__init__(self) self.daemon = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.level = level self.fdRead, self.fdWrite = os.pipe() self.pipeReader = os.fdopen(self.fdRead) self.start() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fileno</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.fdWrite <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> iter(self.pipeReader.readline, <span class="hljs-string"><span class="hljs-string">''</span></span>): logging.log(self.level, line.strip(<span class="hljs-string"><span class="hljs-string">'\n'</span></span>)) self.pipeReader.close() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">close</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> os.close(self.fdWrite) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute_ssh_command</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(host, port, username, password, command)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-comment"><span class="hljs-comment"># Create the SSH client. ssh = paramiko.SSHClient() ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy()) # Connect to the host. ssh.connect(host, port, username, password, look_for_keys=False) # Send the command (non-blocking) stdin, stdout, stderr = ssh.exec_command(command) # Wait for the command to terminate while not stdout.channel.exit_status_ready() and not stdout.channel.recv_ready(): time.sleep(1) stdoutstring = stdout.readlines() stderrstring = stderr.readlines() return stdoutstring, stderrstring finally: if ssh is not None: # Close client connection. ssh.close() def sendCommand (hostname,command): returnvalue = 0 logging.info('Host '+hostname+', command: '+command) Try: #add .mydomain for FQDN (stdoutstring, stderrstring) = execute_ssh_command(hostname+'.mydomain', port, login, password, command+'\n') if (len(stdoutstring)&gt;0): logging.info(stdoutstring[0]) if (len(stderrstring)&gt;0): logging.info(stderrstring[0]) except Exception as e: return returnvalue else: returnvalue = stdoutstring[0] finally: return returnvalue def checkswitch(hostname,mac_addr): try: returnvalue = {} returnvalue['host']=hostname answer = sendCommand(hostname,'show ethernet-switching table | match '+mac_addr) if(answer!=0): iface = answer.split()[4] returnvalue['iface']=iface #cut .0 prefix in the interface name answer = sendCommand(hostname,'show interfaces '+iface[:-2]+' descriptions | last 1 | no-more') iface = answer.split() if(len(iface)&gt;2): iface=iface[3] returnvalue['description']=iface else: returnvalue['description']='none' searchpass.append(returnvalue) if (iface[:3]=='SW&gt;'): checkswitch(iface[3:],mac_addr) else: returnvalue['iface']='none' searchpass.append(returnvalue) except Exception as e: logging.info(e) def main(argv): mac_addr = argv[0] #configure log logging.basicConfig(filename='/var/log/findmac.log', level=logging.INFO, format='%(asctime)s %(message)s') logging.info('Find MAC: '+mac_addr) checkswitch('CORE',mac_addr) for switch in searchpass: print (json.dumps(switch, ensure_ascii=False)) if __name__ == "__main__": main(sys.argv[1:])</span></span></code> </pre> <br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id420013/">https://habr.com/ru/post/id420013/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id420003/index.html">Jendela dengan tombol di JavaFX:</a></li>
<li><a href="../id420005/index.html">Pengawasan video tidak profesional di apartemen itu menyenangkan dan tidak mahal</a></li>
<li><a href="../id420007/index.html">Gelisah, lampu aneh dan kubus pembagi: mengenal Allocacoc</a></li>
<li><a href="../id420009/index.html">Seluk-beluk desain produk</a></li>
<li><a href="../id420011/index.html">Cara Memilih Printer 3D: Panduan Pemula</a></li>
<li><a href="../id420015/index.html">Cara mengukur kecepatan saluran Internet dengan benar dan berhenti terlihat seperti orang bodoh di mata penyedia Anda</a></li>
<li><a href="../id420017/index.html">Seni mengambil kata sandi</a></li>
<li><a href="../id420019/index.html">Interaksi klien-server dalam perangkat PvP shooter dan server game baru: masalah dan solusi</a></li>
<li><a href="../id420021/index.html">Mengapa Anda perlu Splunk? Internet Benda dan Data Industri</a></li>
<li><a href="../id420023/index.html">Menyimpan status di aplikasi android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>