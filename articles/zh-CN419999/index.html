<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§‘ğŸ¿â€ğŸ¤â€ğŸ§‘ğŸ» ğŸ³ï¸ ğŸ“š Yii1 / yii2èº«ä»½éªŒè¯å…±äº« ğŸ™ğŸ¼ ğŸ“¦ ğŸš£ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¦‚æœæ²¡æœ‰ç¬¬ä¸€éƒ¨åˆ† ï¼Œæœ¬æ–‡å°±æ²¡æœ‰æ„ä¹‰ï¼Œåœ¨ç¬¬ä¸€éƒ¨åˆ†ä¸­æœ‰ä¸€ä¸ªç­”æ¡ˆâ€œä¸ºä»€ä¹ˆè¦è¿™æ ·åšâ€ã€‚ 

 å®ƒæ˜¯å…³äºå°†é¡¹ç›®ä»yii1é¡ºåˆ©è¿ç§»åˆ°yii2çš„æŠ€æœ¯ã€‚ å…¶å®è´¨æ˜¯yii1ä¸Šçš„é¡¹ç›®åˆ†æ”¯å’Œyii2ä¸Šçš„æ–°ç‰ˆæœ¬åœ¨ä¸€ä¸ªè™šæ‹Ÿä¸»æœºä¸­çš„åŒä¸€åŸŸä¸Šä¸€èµ·å·¥ä½œï¼Œå¹¶ä¸”è¿ç§»æ˜¯é€æ­¥è¿›è¡Œçš„ï¼Œè€Œä¸”æ­¥è°ƒå¾ˆå°ï¼ˆé€šè¿‡é¡µé¢ï¼Œæ§åˆ¶å™¨ï¼Œæ¨¡å—ç­‰ï¼‰ã€‚ 

 ç¬¬ä¸€éƒ¨...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Yii1 / yii2èº«ä»½éªŒè¯å…±äº«</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419999/"><img src="https://habrastorage.org/webt/ax/qo/vv/axqovvxw6vehedogcejd1obzehs.jpeg" alt="å›¾ç‰‡"><br><br> å¦‚æœæ²¡æœ‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬ä¸€éƒ¨åˆ†</a> ï¼Œæœ¬æ–‡å°±æ²¡æœ‰æ„ä¹‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ï¼Œåœ¨ç¬¬ä¸€éƒ¨åˆ†</a>ä¸­æœ‰ä¸€ä¸ªç­”æ¡ˆâ€œä¸ºä»€ä¹ˆè¦è¿™æ ·åšâ€ã€‚ <br><br> å®ƒæ˜¯å…³äºå°†é¡¹ç›®ä»yii1é¡ºåˆ©è¿ç§»åˆ°yii2çš„æŠ€æœ¯ã€‚ å…¶å®è´¨æ˜¯yii1ä¸Šçš„é¡¹ç›®åˆ†æ”¯å’Œyii2ä¸Šçš„æ–°ç‰ˆæœ¬åœ¨ä¸€ä¸ªè™šæ‹Ÿä¸»æœºä¸­çš„åŒä¸€åŸŸä¸Šä¸€èµ·å·¥ä½œï¼Œå¹¶ä¸”è¿ç§»æ˜¯é€æ­¥è¿›è¡Œçš„ï¼Œè€Œä¸”æ­¥è°ƒå¾ˆå°ï¼ˆé€šè¿‡é¡µé¢ï¼Œæ§åˆ¶å™¨ï¼Œæ¨¡å—ç­‰ï¼‰ã€‚ <br><br> ç¬¬ä¸€éƒ¨åˆ†æ˜¯å…³äºå¦‚ä½•åœ¨ç°æœ‰è™šæ‹Ÿä¸»æœºä¸Šçš„yii2ä¸Šè¿è¡Œä¸€ä¸ªè£¸é¡¹ç›®ã€‚ ä½¿ä¸¤ä¸ªåˆ†æ”¯æœºæ„ä¸€èµ·å·¥ä½œè€Œä¸ç›¸äº’å¹²æ‰°ã€‚ <br><br> ä¹‹åï¼Œæœ€å›°éš¾çš„é˜¶æ®µå¼€å§‹äº†ï¼šæ‚¨éœ€è¦ä¸ºå¼€å§‹åˆ›å»ºä¸€ä¸ªæœ€å°çš„åŸºç¡€æ¶æ„ã€‚ æˆ‘å°†æŒ‘å‡º2ä¸ªä»»åŠ¡ï¼šé‡å¤è®¾è®¡å’Œç«¯åˆ°ç«¯ç”¨æˆ·èº«ä»½éªŒè¯ã€‚ <br><br> è®¾è®¡çš„é‡å¤æ˜¯æ— èŠçš„ç¬¬ä¸€ä½ã€‚ å¦‚æœæ‚¨ä¸èµ°è¿ï¼Œåªéœ€å¤åˆ¶/è¿˜åŸæ—§çš„â€œ 1åˆ1â€å³å¯ã€‚ å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘æ€»æ˜¯ä¸é‡æ–°è®¾è®¡ç»“åˆåœ¨ä¸€èµ·ã€‚ å³ ç•Œé¢å’Œè®¾è®¡å·²å¾—åˆ°é‡å¤§æ›´æ–°ï¼Œåœ¨è¿™æ–¹é¢ï¼Œå·¥ä½œå¹¶ä¸æ„šè ¢ã€‚ ä½†è¿™é‡Œæœ‰ä»–è‡ªå·±çš„ä¸€é¢-æˆ‘éå¸¸æ³¨æ„ç•Œé¢å’Œè®¾è®¡ï¼Œæ°æ°ç›¸åï¼Œæœ‰äººæ›´å–œæ¬¢åç«¯å’Œæ§åˆ¶å°ã€‚ ä½†æ˜¯ï¼Œæ— è®ºå–œå¥½å¦‚ä½•ï¼Œéƒ½æ— æ³•å…‹æœæ­¤ä»»åŠ¡-æ‚¨å°†å¿…é¡»åˆ›å»ºä¸€ä¸ªç•Œé¢ï¼Œå¹¶ä¸”å·¥ä½œé‡å°†å¾ˆå¤§ã€‚ <br><br> ç«¯åˆ°ç«¯èº«ä»½éªŒè¯æ›´åŠ æœ‰è¶£ï¼Œå¹¶ä¸”å·¥ä½œé‡å°†å‡å°‘ã€‚ ä¸ç¬¬ä¸€ç¯‡æ–‡ç« ä¸€æ ·ï¼Œä¸ä¼šæœ‰ä»»ä½•å¯ç¤ºã€‚ æœ¬æ–‡çš„ç‰¹å¾ï¼šé¦–æ¬¡è§£å†³æ­¤é—®é¢˜çš„äººå‘˜çš„æ•™ç¨‹ã€‚ <br><br> å¦‚æœè¿™æ˜¯æ‚¨çš„æƒ…å†µï¼Œé‚£ä¹ˆè¯·å‚è€ƒæ›´å¤šè¯¦ç»†ä¿¡æ¯ <br><a name="habracut"></a><br> é¦–å…ˆï¼Œæ‚¨éœ€è¦åœ¨åˆ†æ”¯ä¹‹é—´æ‹†åˆ†åŠŸèƒ½ã€‚ å› ä¸º å¯ä»¥ç†è§£ï¼Œè¿ç§»é˜¶æ®µåªæ˜¯åœ¨å¼€å§‹é˜¶æ®µï¼Œç„¶åå¾ˆå¯èƒ½æ‰€æœ‰ä¸ç”¨æˆ·è¿›è¡Œçš„å·¥ä½œï¼ˆæ³¨å†Œï¼Œèº«ä»½éªŒè¯ï¼Œå¯†ç æ¢å¤ç­‰ï¼‰éƒ½ä¿ç•™åœ¨æ—§ç«™ç‚¹ä¸Šã€‚  yii2ä¸Šçš„æ–°åˆ†æ”¯åº”è¯¥åªçœ‹åˆ°å·²ç»é€šè¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ã€‚ <br><br>  yii1 / yii2çš„èº«ä»½éªŒè¯æœºåˆ¶ç•¥æœ‰ä¸åŒï¼Œæ‚¨éœ€è¦è°ƒæ•´yii2ä»£ç ï¼Œä»¥ä¾¿å®ƒå¯ä»¥çœ‹åˆ°ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ã€‚ å› ä¸º èº«ä»½éªŒè¯æ•°æ®å­˜å‚¨åœ¨ä¼šè¯ä¸­ï¼Œæ‚¨åªéœ€è¦åœ¨ç”¨äºè¯»å–ä¼šè¯æ•°æ®çš„å‚æ•°ä¸Šè¾¾æˆä¸€è‡´å³å¯ã€‚ <br><br> åœ¨æ¥è‡ªyii1çš„ä¼šè¯ä¸­ï¼Œè¿™æ˜¯ä»¥æŸç§æ–¹å¼å­˜å‚¨çš„ï¼š <br><br><pre><code class="php hljs">print_r($_SESSION); <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [<span class="hljs-number"><span class="hljs-number">34e60</span></span>d27092d90364d1807021107e5a3__id] =&gt; <span class="hljs-number"><span class="hljs-number">123456</span></span> [<span class="hljs-number"><span class="hljs-number">34e60</span></span>d27092d90364d1807021107e5a3__name] =&gt; tester [<span class="hljs-number"><span class="hljs-number">34e60</span></span>d27092d90364d1807021107e5a3__states] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( ) )</code> </pre> <br> å®ƒå¦‚ä½•ä¸æ‚¨ä¸€èµ·å­˜å‚¨-ä¾‹å¦‚ï¼Œæ£€æŸ¥yii1çš„ä¸åŒç‰ˆæœ¬ä¸­prefixKeyçš„ç”Ÿæˆæ–¹å¼æ˜¯å¦ä¸åŒã€‚ <br><br> è¿™æ˜¯æ‚¨éœ€è¦çš„yii1æ•°æ® <br><br><pre> <code class="php hljs">Yii::app()-&gt;user-&gt;getStateKeyPrefix() Yii::app()-&gt;name Yii::app()-&gt;getBasePath() Yii::app()-&gt;getId() get_class(Yii::app()-&gt;user)</code> </pre><br> æœ€ç®€å•çš„æ–¹æ³•æ˜¯åˆ¶ä½œæµ‹è¯•é¡µå¹¶åœ¨å…¶ä¸Šæ˜¾ç¤ºæ‰€æœ‰å¿…è¦çš„æ•°æ®-å°†æ¥å°†éœ€è¦å®ƒä»¬ã€‚ <br><br><h2>  yii2ä¸­çš„èº«ä»½éªŒè¯ </h2><br> åœ¨Yii2ä¸­ï¼Œæˆ‘ä»¬éœ€è¦çš„æ‰€æœ‰åŠŸèƒ½éƒ½ä½äºç”¨æˆ·ç»„ä»¶ï¼ˆ <u>\ yii \ web \ User</u> ï¼‰ä¸­ï¼Œè¯¥ç»„ä»¶æ§åˆ¶èº«ä»½éªŒè¯çŠ¶æ€ã€‚ <br><br><ul><li> åœ¨å…¶<u>getIdentityï¼ˆï¼‰</u>æ–¹æ³•ä¸­ï¼Œ <u>è°ƒç”¨äº†renewAuthStatusï¼ˆï¼‰</u> ï¼Œå…¶ä¸­ï¼Œé€šè¿‡<u>$ idParam</u>å˜é‡ä¸­çš„å¯†é’¥æŸ¥æ‰¾èº«ä»½éªŒè¯ä¼šè¯ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œå…¶ä¸­å­˜å‚¨äº†â€œ __idâ€ï¼‰ï¼› </li><li> åœ¨ä¼šè¯å˜é‡ä¸­ï¼Œç”¨æˆ·IDæ˜¯ä½¿ç”¨é”®<u>$ idParam</u>å­˜å‚¨çš„ï¼ˆä¾‹å¦‚ï¼Œæ¥è‡ª<u>app / model / User</u> ï¼‰ã€‚ </li></ul><br>  <i>è®¤è¯ç®—æ³•<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨å®˜æ–¹æŒ‡å—ä¸­æœ‰</a>è¯¦ç»†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æè¿°</a> ã€‚</i> <br><br> å½“ç„¶ï¼Œåœ¨yii1ä¸­ï¼Œä¼šè¯ä½¿ç”¨å…¶ä»–å¯†é’¥å­˜å‚¨ã€‚ å› æ­¤ï¼Œæ‚¨éœ€è¦ä½¿yii2ä½¿ç”¨ä¸yii1ä¸­å­˜å‚¨çš„ç›¸åŒçš„é”®æ¥æŸ¥æ‰¾ç”¨æˆ·IDã€‚ <br><br>  <b>ä¸ºæ­¤ï¼š</b> <br><br>  1.å°†è´Ÿè´£ç®¡ç†èº«ä»½éªŒè¯çŠ¶æ€çš„ç”¨æˆ·ç»„ä»¶çš„ç±»æ›´æ”¹ä¸ºæˆ‘ä»¬è‡ªå·±çš„ç±»ï¼Œè¯¥ç±»ç»§æ‰¿è‡ª<u>config / web.phpä¸­çš„yii</u> <u>/ web / User</u> <br><br><pre> <code class="php hljs"><span class="hljs-string"><span class="hljs-string">'components'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'app\models\WebUser'</span></span>, <span class="hljs-string"><span class="hljs-string">'identityClass'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'app\models\User'</span></span>, ], ]</code> </pre><br>  2.åœ¨<u>app \ models \ WebUserä¸­</u>è°ƒæ•´<u>$ idParam</u>çš„å€¼ã€‚ <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  idParam (    //    ) $this-&gt;idParam = $this-&gt;getIdParamYii1(); }</span></span></code> </pre> <br> åœ¨æ‰°æµå™¨ä¸‹ï¼Œå°†æœ‰ä¸€äº›æ–¹æ³•ä»¥æŸç§æ–¹å¼æ¨¡ä»¿yii1çš„ç±»ä¼¼è¡Œä¸ºã€‚ <br><br> é€šå¸¸ï¼Œæ‚¨å¯ä»¥ä»…ä»<u>yii1</u>å¤åˆ¶åŸå§‹çš„<u>_keyPrefix</u> ï¼ˆç”šè‡³<u>ç«‹å³</u>å¤åˆ¶<u>idParam</u> ï¼‰ï¼Œè€Œä¸æ¨¡æ‹Ÿå…¶ç”Ÿæˆï¼Œä½†æ˜¯å°±åƒâ€œå¤åˆ¶éš¾ä»¥ç†è§£çš„åƒåœ¾â€æŒ‡ä»¤ä¸€æ ·ã€‚ <br><br> ç¡®å®ï¼Œæ‚¨å¯ä»¥å¤åˆ¶ï¼Œå› ä¸ºyii1ä¸­çš„_keyPrefixå‡ ä¹æ˜¯é™æ€çš„ã€‚ å®ƒå–å†³äºç”¨æˆ·ç»„ä»¶çš„ç±»åç§°å’Œåº”ç”¨ç¨‹åºIDï¼Œè€Œåº”ç”¨ç¨‹åºIDåˆä»åº”ç”¨ç¨‹åºçš„ä½ç½®åŠå…¶åç§°è·å¾—ã€‚ <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//   yii1  _keyPrefix $this-&gt;_keyPrefix = md5('Yii.'.get_class($this).'.'.Yii::app()-&gt;getId()); //   - ID  $this-&gt;_id=sprintf('%x',crc32($this-&gt;getBasePath().$this-&gt;name));</span></span></code> </pre><br> å¦‚æœæˆ‘ä»¬ä»…å°†è‡ªå·±é™åˆ¶åœ¨èº«ä»½éªŒè¯ä»»åŠ¡ä¸­ï¼Œåˆ™å¤åˆ¶_keyPrefixå€¼å°†å¤§å¤§å‡å°‘å·¥ä½œé‡ã€‚ ä½†æˆ‘å°†ä¸¾ä¾‹è¯´æ˜æ›´å¹¿æ³›çš„ç”¨é€”ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">ç”¨æˆ·ç»„ä»¶ï¼ˆapp \ models \ WebUserï¼‰</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">models</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">web</span></span>\<span class="hljs-title"><span class="hljs-title">User</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebUser</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *    cookies  yii2, *     yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $autoRenewCookie = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * _keyPrefix    CWebUser  Yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_keyPrefix; <span class="hljs-comment"><span class="hljs-comment">/** *    Yii1,    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $paramsYii1 = [ <span class="hljs-comment"><span class="hljs-comment">//    user   Yii1 'classUserComponent' =&gt; 'CWebUser', // ID  Yii1 //  ,  Yii::app()-&gt;getId() 'appId' =&gt; '', //     Yii1 'appName' =&gt; 'My Web Application', //     yii1  \Yii::getAlias('@app') 'relPath' =&gt; '../htdocs/protected', ]; public function init() { //  idParam (    //    ) $this-&gt;idParam = $this-&gt;getIdParamYii1(); } }</span></span></code> </pre><br> ä»¥åŠå…¶ä»–æ–¹æ³•ï¼ˆWebUserï¼‰ã€‚  <i>åˆ†å¼€ä»¥ä¾¿äºè§‚çœ‹ã€‚</i> <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** *     Yii1,    ID  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIdParamYii1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getStateKeyPrefix() . <span class="hljs-string"><span class="hljs-string">'__id'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** *    Yii 1 * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStateKeyPrefix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_keyPrefix !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_keyPrefix; $class = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'classUserComponent'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_keyPrefix = md5(<span class="hljs-string"><span class="hljs-string">'Yii.'</span></span> . $class . <span class="hljs-string"><span class="hljs-string">'.'</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getAppIdYii1()); } <span class="hljs-comment"><span class="hljs-comment">/** *   getId()  CApplication * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string ID  Yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAppIdYii1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'appId'</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'appId'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'appId'</span></span>] = sprintf(<span class="hljs-string"><span class="hljs-string">'%x'</span></span>, crc32(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getBasePathYii1() . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'appName'</span></span>])); } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string    Yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBasePathYii1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $basePath = realpath(\Yii::getAlias(<span class="hljs-string"><span class="hljs-string">'@app'</span></span>) . DIRECTORY_SEPARATOR . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'relPath'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$basePath) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidConfigException(<span class="hljs-string"><span class="hljs-string">'basePath  yii1  .'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $basePath; }</code> </pre><br>  <i>ä»…å¯¹äºâ€œ <u>åŒæ„ä¼šè¯å¯†é’¥çš„æ ¼å¼</u> â€çš„ä»»åŠ¡ï¼Œæ–¹æ³•çš„åˆ†è§£æœ‰ç‚¹å¤æ‚ï¼Œä½†æ˜¯å®ƒä»¬å¯¹äºä»¥ä¸‹ç¤ºä¾‹å¾ˆæœ‰ç”¨ã€‚</i> <br></div></div><br> ä¹‹åï¼Œåœ¨yii2ä¸Šçš„æ–°åˆ†æ”¯ä¸­ï¼Œå¯¹å…ˆå‰åœ¨yii1ä¸­æˆæƒçš„ç”¨æˆ·çš„è¯†åˆ«å¼€å§‹èµ·ä½œç”¨ã€‚ ç†æƒ³æƒ…å†µä¸‹ï¼Œå¿…é¡»åœæ­¢åœ¨æ­¤ä½ç½®ï¼Œå› ä¸ºæ»‘è¡Œè·¯å¾„ä¼šè¿›ä¸€æ­¥å¼€å§‹ã€‚ <br><br><h2>  yii2ä¸­çš„ç”¨æˆ·ç™»å½• </h2><br> åŒæ„ä¼šè¯ä¸­ç”¨æˆ·IDçš„å­˜å‚¨æ ¼å¼åï¼Œå³ä½¿â€œè‡ªåŠ¨â€ç”¨æˆ·ç™»å½•ä¹Ÿå¯èƒ½ä¼šé€šè¿‡yii2èµ·ä½œç”¨ã€‚ <br><br>  <i>æˆ‘è®¤ä¸ºåœ¨æˆ˜æ–—æ¨¡å¼ä¸‹ä½¿ç”¨yii2ä¸Šçš„ç™»å½•è¡¨å•è€Œä¸ç¦ç”¨yii1ä¸Šçš„ç›¸åº”è¡¨å•æ˜¯ä¸æ­£ç¡®çš„ï¼Œä½†æ˜¯ï¼ŒåŸºæœ¬çš„åŠŸèƒ½åœ¨ç¨åŠ åè°ƒä¹‹åå°±å¯ä»¥ä½¿ç”¨ã€‚</i> <br><br> å› ä¸º æˆ‘ä»¬è®¤ä¸ºï¼Œåœ¨è¿›è¡Œç”¨æˆ·æ³¨å†Œä»¥åŠç›¸åº”çš„å¯†ç å“ˆå¸Œå¤„ç†åï¼Œæˆ‘ä»¬ç•™åœ¨yii1ä¸­ï¼Œç„¶åå¯¹äºé€šè¿‡yii2è¿›è¡Œçš„æœ‰æ•ˆç™»å½•ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿yii2ä¸­ä¿å­˜çš„å¯†ç çš„éªŒè¯æ–¹æ³•å¯ä»¥ç†è§£åœ¨Yii1ä¸­è¿›è¡Œäº†å“ˆå¸Œå¤„ç†å’Œå­˜å‚¨çš„å†…å®¹ã€‚ <br><br> æ£€æŸ¥è¿™äº›æ–¹æ³•çš„ä½œç”¨ã€‚ <br><br> ä¾‹å¦‚ï¼Œå¦‚æœåœ¨Yii2ä¸­ï¼Œæ¡ä»¶æ ‡å‡†ç”¨æˆ·æ¨¡å‹Userå°†æŒ‰ä»¥ä¸‹æ–¹å¼éªŒè¯å¯†ç ï¼š <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validatePassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($password)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> \Yii::$app-&gt;getSecurity()-&gt;validatePassword($password, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;password); }</code> </pre><br> ç„¶åï¼Œä»<u>yii \ base \ Security</u> ï¼ˆYii2ï¼‰ä¸­æŸ¥çœ‹<u>validatePasswordï¼ˆ$ passwordï¼Œ$ hashï¼‰</u> <u>æ–¹æ³•</u> ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">validatePasswordï¼ˆï¼‰</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validatePassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($password, $hash)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_string($password) || $password === <span class="hljs-string"><span class="hljs-string">''</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidArgumentException(<span class="hljs-string"><span class="hljs-string">'Password must be a string and cannot be empty.'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!preg_match(<span class="hljs-string"><span class="hljs-string">'/^\$2[axy]\$(\d\d)\$[\.\/0-9A-Za-z]{22}/'</span></span>, $hash, $matches) || $matches[<span class="hljs-number"><span class="hljs-number">1</span></span>] &lt; <span class="hljs-number"><span class="hljs-number">4</span></span> || $matches[<span class="hljs-number"><span class="hljs-number">1</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">30</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidArgumentException(<span class="hljs-string"><span class="hljs-string">'Hash is invalid.'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (function_exists(<span class="hljs-string"><span class="hljs-string">'password_verify'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> password_verify($password, $hash); } $test = crypt($password, $hash); $n = strlen($test); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($n !== <span class="hljs-number"><span class="hljs-number">60</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;compareString($test, $hash); }</code> </pre></div></div><br> å¦‚æœåœ¨Yii1ä¸Šï¼Œç”¨æˆ·æ¨¡å‹ä¸­çš„å¯†ç å“ˆå¸Œæ˜¯è¿™æ ·å®Œæˆçš„ï¼š <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hashPassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($password)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CPasswordHelper::hashPassword($password); }</code> </pre><br> ç„¶åä¸<u>yii</u> <u>\ framework \ utils \ CPasswordHelperä¸­çš„</u> <u>verifyPasswordï¼ˆ$ passwordï¼Œ$ hashï¼‰</u>è¿›è¡Œæ¯”è¾ƒ <br><br><div class="spoiler">  <b class="spoiler_title">hashPasswordï¼ˆï¼‰</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hashPassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($password,$cost=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">13</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::checkBlowfish(); $salt=<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::generateSalt($cost); $hash=crypt($password,$salt); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!is_string($hash) || (function_exists(<span class="hljs-string"><span class="hljs-string">'mb_strlen'</span></span>) ? mb_strlen($hash, <span class="hljs-string"><span class="hljs-string">'8bit'</span></span>) : strlen($hash))&lt;<span class="hljs-number"><span class="hljs-number">32</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CException(Yii::t(<span class="hljs-string"><span class="hljs-string">'yii'</span></span>,<span class="hljs-string"><span class="hljs-string">'Internal error while generating hash.'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $hash; }</code> </pre><br></div></div><br> å¦‚æœå“ˆå¸Œå’ŒéªŒè¯æ–¹æ³•ä¸åŒï¼Œåˆ™éœ€è¦åœ¨<u>app \ model \ User</u>ä¸­çš„<u>validatePasswordï¼ˆï¼‰ä¸­</u>æ›´æ”¹éªŒè¯ã€‚ <br><br> ä»æ¡†æ¶çš„æœ€æ–°ç‰ˆæœ¬çš„æ¡†ä¸­ï¼Œå¯ä»¥å…¼å®¹Yii1 / Yii2å¯†ç å“ˆå¸Œã€‚ ä½†è¿™å¹¶ä¸æ„å‘³ç€å®ƒä»¬å°†ä¸æ‚¨å…¼å®¹ï¼Œæˆ–è€…å°†æ¥ä¼šé‡åˆã€‚  Yii1ä¸­é¡¹ç›®çš„å“ˆå¸Œæ–¹æ³•å’ŒYii2æ–°é¡¹ç›®ä¸­çš„éªŒè¯æ–¹æ³•çš„æ¦‚ç‡å¾ˆé«˜ã€‚ <br><br><h2> åœ¨Yii2ä¸­è‡ªåŠ¨ç™»å½•yii1çš„cookie </h2><br><blockquote> ç”±äºYii2ä¸Šçš„åˆ†æ”¯æœºæ„å·²ç»çŸ¥é“å¦‚ä½•é€æ˜åœ°ä½¿ç”¨Yii1çš„ç”¨æˆ·èº«ä»½éªŒè¯æ•°æ®ï¼Œä¸ºä»€ä¹ˆä¸é€šè¿‡cookieè®¾ç½®è‡ªåŠ¨ç™»å½•ï¼Ÿ <br></blockquote> å¦‚æœæ‚¨æœ‰è¿™ç§æƒ³æ³•ï¼Œå»ºè®®æ‚¨ä¸è¦è¿™æ ·åšã€‚ æˆ‘è®¤ä¸ºæ²¡æœ‰å……åˆ†çš„ç†ç”±åœ¨ä¸å°†ç”¨æˆ·å·¥ä½œï¼ˆé¦–å…ˆæ˜¯èº«ä»½éªŒè¯ï¼‰è½¬ç§»åˆ°æ­¤çº¿ç¨‹çš„æƒ…å†µä¸‹åœ¨Yii2ä¸Šå¯ç”¨è‡ªåŠ¨ç™»å½•ã€‚ å³ æˆ‘çš„æ„æ€æ˜¯ä»¥ä¸‹æƒ…å†µï¼š <br><br>  <i>ç”¨æˆ·èº«ä»½éªŒè¯æ˜¯åœ¨Yii1ä¸Šæ‰§è¡Œçš„ï¼Œä½†æ˜¯Yii2åˆ†æ”¯åº”è¯¥èƒ½å¤Ÿå¯¹Yii1ä¸­å­˜å‚¨çš„cookieè¿›è¡Œè‡ªåŠ¨ç™»å½•ã€‚</i> <i><br></i> <br> è€å®è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå¦ç‡çš„å˜æ€ã€‚ è¿™æ ·åšå¹¶éæ˜“äº‹è€Œä¼˜é›…ï¼Œåªæ˜¯åœ¨è¿™ä¹‹é—´çš„ç•Œé™ä»‹äºæœ‰æ„è¯†å’Œåˆç†çš„ç§»å¾™ä»»åŠ¡ä¸ä¸å¿…è¦çš„è‡ªè¡Œè½¦çš„å‘æ˜ä¹‹é—´ã€‚ <br><br> å›°éš¾åœ¨äºï¼ŒYiiçš„ä¸¤ä¸ªåˆ†æ”¯æœºæ„éƒ½å—åˆ°ä¿æŠ¤ï¼Œå…å—å‡Cookieçš„å½±å“ï¼Œå› æ­¤å¾ˆéš¾å°±æ–¹æ³•è¾¾æˆä¸€è‡´ã€‚ <br><br><ul><li>  Yii2æ¶‰åŠçš„ç»„ä»¶æ˜¯ï¼šç”¨æˆ·ï¼ˆ <u>\ yii \ web \ User</u> ï¼‰ï¼Œ <u>è¯·æ±‚</u> ï¼Œ <u>å®‰å…¨æ€§</u> + <u>CookieCollection</u> </li><li> åœ¨Yii1ä¸­ï¼š <u>CWebUser</u> ï¼Œ <u>CHttpRequest</u> ï¼Œ <u>CSecurityManager</u> ï¼Œ <u>CStatePersister</u> ï¼Œ <u>CCookieCollection</u> </li></ul><br> ä½†æ˜¯ï¼Œæƒ…å†µä¸åŒã€‚ ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨è‡ªè¡Œè½¦è¿›è¡Œè‡ªåŠ¨ç™»å½•çš„ç¤ºä¾‹ã€‚ <br><br> åœ¨yii2ä¸­ï¼Œæˆ‘ä»¬å¯¹<u>\ yii \ web \ User</u>ä¸­çš„<u>getIdentityAndDurationFromCookieï¼ˆï¼‰</u>æ–¹æ³•æ„Ÿå…´è¶£ã€‚ åœ¨æ­¤æ–¹æ³•çš„ç¬¬ä¸€è¡Œä¸­ï¼Œåº”è·å–æ‰€éœ€çš„cookieï¼š <br><br><pre> <code class="php hljs">$value = Yii::$app-&gt;getRequest()-&gt;getCookies()-&gt;getValue(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;identityCookie[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]);</code> </pre> <br> ä½†æ˜¯å¥¹ä¸ä¼šï¼Œå› ä¸º  <u>Yii :: $ app-&gt; getRequestï¼ˆï¼‰-&gt; getCookiesï¼ˆï¼‰</u>é›†åˆå°†ä¸ºç©ºï¼Œå› ä¸ºåœ¨<u>Request</u> cookieä¸­ï¼ŒéªŒè¯æ˜¯é€šè¿‡<u>loadCookiesï¼ˆï¼‰</u>åŠ è½½çš„ï¼Œå¹¶ä¸”å½“ç„¶ä¸ä¼šé€šè¿‡ã€‚ <br><br> åˆ†å‰æœ€ç®€å•çš„æ–¹æ³•æ˜¯é€šè¿‡è¦†ç›–<u>getIdentityAndDurationFromCookieï¼ˆï¼‰</u>æ¥å®ç°æ ‡å‡†è¡Œä¸ºã€‚ ä¾‹å¦‚ï¼Œåƒè¿™æ ·ï¼š <br><br><ol><li> ç›´æ¥ä»è¶…å…¨å±€$ _COOKIEä¸‹è½½æ‰€éœ€çš„cookieï¼Œä»¥å…<s>ç ´å</s>æ ‡å‡†çš„cookieåŠ è½½æœºåˆ¶ã€‚ <br><br> æ ‡è¯†cookieçš„åç§°ä»…ä¸º_keyPrefixï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“å¦‚ä½•æ¥æ”¶ï¼ˆæˆ–å¤åˆ¶ï¼‰äº†ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬åœ¨<u>initï¼ˆï¼‰ä¸­</u>æ›´æ”¹äº†æ ‡å‡†<u>$ identityCookie</u> ã€‚ <br></li><li>  â€œå¤§çº¦ä¸yii1ä¸­ä¸€æ ·â€è§£å¯†æ‰€å¾—çš„cookieã€‚ å¦‚ä½ æ‰€æ„¿ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»<u>CSecurityManager</u>å¤åˆ¶äº†å¿…éœ€çš„æ–¹æ³•ã€‚ </li></ol><br> å®é™…ä¸Šï¼Œä¸‹é¢æ˜¯ä»£ç ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">æˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åº/æ¨¡å‹/ WebUserä¸­å·¥ä½œ</b> <div class="spoiler_text">  1.æŒ‰ç…§ii1è®¾ç½®çš„åç§°identityCookie cookie <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;idParam = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getIdParamYii1(); <span class="hljs-comment"><span class="hljs-comment">//     $this-&gt;identityCookie = ['name' =&gt; $this-&gt;getStateKeyPrefix()]; }</span></span></code> </pre><br><br>  2.å†æ·»åŠ ä¸¤ç§æ–¹æ³• <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** *    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIdentityAndDurationFromCookie</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $id = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getIdIdentityFromCookiesYii1(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$id) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } $class = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;identityClass; $identity = $class::findOne($id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($identity !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'identity'</span></span> =&gt; $identity, <span class="hljs-string"><span class="hljs-string">'duration'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** *  ID identity  cookies,   yii1 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> null|integer  ID     null */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIdIdentityFromCookiesYii1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_COOKIE[<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;identityCookie[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]])) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; $cookieValue = $_COOKIE[<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;identityCookie[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]]; <span class="hljs-comment"><span class="hljs-comment">// Cookies  yii1 ,  $utilSecurity = new UtilYii1Security($this-&gt;getBasePathYii1()); $data = $utilSecurity-&gt;validateData($cookieValue); if ($data === false) { return null; } $data = @unserialize($data); if (is_array($data) &amp;&amp; isset($data[0], $data[1], $data[2], $data[3])) { list($id, $name, $duration, $states) = $data; return $id; } return null; }</span></span></code> </pre><br></div></div><br> è¯¥ä»£ç ä½¿ç”¨æŸä¸ª<u>UtilYii1Security</u>ç±»-è¿™æ˜¯å¯¹<u>CSecurityManager</u>çš„å¿…è¦æ–¹æ³•çš„ä¿®æ”¹åçš„å¤åˆ¶ç²˜è´´ï¼Œå› æ­¤ï¼Œä¸€æ–¹é¢çœ‹èµ·æ¥åƒåŸå§‹çš„ï¼Œä½†æœ‰ä¸€äº›ç®€åŒ–ã€‚ ä¾‹å¦‚ï¼Œåœ¨<u>CSecurityManagerä¸­ï¼Œæœ‰</u>å¤šä¸ªç”¨äºç”ŸæˆHMACï¼ˆåŸºäºå“ˆå¸Œçš„æ¶ˆæ¯èº«ä»½éªŒè¯ä»£ç ï¼‰çš„é€‰é¡¹ï¼Œè¿™å–å†³äºphpç‰ˆæœ¬å’Œmbstringçš„å­˜åœ¨ã€‚ ä½†æ˜¯å› ä¸º å·²çŸ¥yii1ä¸yii2åœ¨ç›¸åŒçš„ç¯å¢ƒä¸­å·¥ä½œï¼Œç„¶åç®€åŒ–äº†ä»»åŠ¡ï¼Œå¹¶å› æ­¤ç®€åŒ–äº†ä»£ç ã€‚ <br><br> å› ä¸º å¾ˆæ˜¾ç„¶ï¼Œè¿™é‡Œå†™äº†ä¸€ä¸ªæ˜æ˜¾çš„æ‹æ–ï¼Œæ‰€ä»¥æ²¡æœ‰å¿…è¦å°è¯•ä½¿å…¶é€šç”¨å¹¶èµ‹äºˆå®ƒä¼˜ç¾çš„å½¢çŠ¶ï¼Œè¶³ä»¥åœ¨æ‚¨çš„æ¡ä»¶ä¸‹å¯¹å…¶è¿›è¡Œâ€œç ”ç£¨â€ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">UtilYii1Security.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">components</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* *   CSecurityManager  Yii1, *     * */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">base</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">base</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">base</span></span>\<span class="hljs-title"><span class="hljs-title">InvalidConfigException</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UtilYii1Security</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * ,   yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> STATE_VALIDATION_KEY = <span class="hljs-string"><span class="hljs-string">'Yii.CSecurityManager.validationkey'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *  ,    yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $hashAlgorithm = <span class="hljs-string"><span class="hljs-string">'sha1'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *   cookies */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_validationKey; <span class="hljs-comment"><span class="hljs-comment">/** *    Yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $basePath; <span class="hljs-comment"><span class="hljs-comment">/** *      yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $stateFile; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $basePath -    Yii1 *        stateFile */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($basePath)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;basePath = $basePath; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;stateFile = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;basePath . DIRECTORY_SEPARATOR . <span class="hljs-string"><span class="hljs-string">'runtime'</span></span> . DIRECTORY_SEPARATOR . <span class="hljs-string"><span class="hljs-string">'state.bin'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!realpath(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;stateFile)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidConfigException(<span class="hljs-string"><span class="hljs-string">'    '</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validateData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($data, $key = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_string($data)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; $len = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;strlen(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;computeHMAC(<span class="hljs-string"><span class="hljs-string">'test'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;strlen($data) &gt;= $len) { $hmac = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;substr($data, <span class="hljs-number"><span class="hljs-number">0</span></span>, $len); $data2 = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;substr($data, $len, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;strlen($data)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;compareString($hmac, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;computeHMAC($data2, $key)) ? $data2 : <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">computeHMAC</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($data, $key = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($key === <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) $key = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getValidationKey(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hash_hmac(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;hashAlgorithm, $data, $key); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValidationKey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_validationKey !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_validationKey; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (($key = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loadStateValidationKey(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::STATE_VALIDATION_KEY)) !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_validationKey = $key; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_validationKey; } <span class="hljs-comment"><span class="hljs-comment">//  validationKey    Yii1 private function loadStateValidationKey($key) { $content = $this-&gt;loadState(); if ($content) { $content = unserialize($content); if (isset($content[$key])) return $content[$key]; } return false; } //      Yii1 protected function loadState() { $filename = $this-&gt;stateFile; $file = fopen($filename, "r"); if ($file &amp;&amp; flock($file, LOCK_SH)) { $contents = @file_get_contents($filename); flock($file, LOCK_UN); fclose($file); return $contents; } return false; } public function compareString($expected, $actual) { $expected .= "\0"; $actual .= "\0"; $expectedLength = $this-&gt;strlen($expected); $actualLength = $this-&gt;strlen($actual); $diff = $expectedLength - $actualLength; for ($i = 0; $i &lt; $actualLength; $i++) $diff |= (ord($actual[$i]) ^ ord($expected[$i % $expectedLength])); return $diff === 0; } private function strlen($string) { return mb_strlen($string, '8bit'); } private function substr($string, $start, $length) { return mb_substr($string, $start, $length, '8bit'); } }</span></span></code> </pre><br></div></div><br><h2> è¡ŒåŠ¨é¡ºåº </h2><br> ä»èº«ä»½éªŒè¯çš„æ–¹å¼ä»yii1è¿ç§»åˆ°yii2æ—¶ï¼Œæˆ‘éµå¾ªä»¥ä¸‹é¡ºåºï¼š <br><br><ol><li> åœ¨åˆ†æ”¯ä¹‹é—´è¿›è¡Œé€æ˜çš„ç”¨æˆ·èº«ä»½éªŒè¯ã€‚ <br> å³ ä»¥ä¾¿yii2åˆ†æ”¯æ¥å—é€šè¿‡yii1è®¤è¯çš„ç”¨æˆ·ã€‚ å®ƒå¾ˆå¿«ï¼Œå¹¶ä¸å›°éš¾ã€‚ <br></li><li> å°†èº«ä»½éªŒè¯ï¼ˆç”¨æˆ·ç™»å½•ï¼‰ä»yii1è½¬ç§»åˆ°yii2ã€‚ <br> åœ¨æ—§åˆ†æ”¯ä¸­åŒæ—¶ç¦ç”¨å®ƒã€‚ è¯·æ³¨æ„ï¼Œæ­¤åï¼Œcookieçš„è‡ªåŠ¨ç™»å½•å°†åœæ­¢å·¥ä½œï¼Œå› ä¸º  yii1ä¸­çš„cookieä¸å†é€‚åˆï¼Œå¹¶ä¸”yii2ä¸Šä»ç„¶å¾ˆå°‘æœ‰æ–°é¡µé¢ã€‚ </li><li> è‡³å°‘å°†ç½‘ç«™çš„ä¸»é¡µç§»æ¤åˆ°yii2 <br> è¿™æ ·æ‚¨å°±å¯ä»¥å¯¹å­˜å‚¨åœ¨yii2ä¸­çš„æ–°cookieä½¿ç”¨è‡ªåŠ¨ç™»å½•ã€‚ <br> è‡ªåŠ¨ç™»å½•çš„å­˜åœ¨ï¼ˆè‡³å°‘åœ¨ä¸»ç™»å½•ä¸­ï¼‰å°†æœ‰åŠ©äºæ©ç›–å‰ä¸€ä¸ªåˆ†æ”¯ä¸Šä¸¢å¤±çš„è‡ªåŠ¨ç™»å½•ã€‚ <br></li><li> æ£€æŸ¥yii1æ˜¯å¦äº†è§£yii2ä¸­å·²è®¤è¯çš„èº«ä»½ã€‚ <br> é€šè¿‡åå•†ä¼šè¯å¯†é’¥ã€‚ <br></li><li> å°†ç”¨æˆ·æ³¨å†Œè½¬ç§»åˆ°yii2ã€‚ <br> ä¼ è¾“å¿…é¡»åœ¨å…ˆå‰å­˜å‚¨çš„å¯†ç å“ˆå¸Œçš„åè°ƒä¸‹å®Œæˆã€‚ ä¹Ÿè®¸ä¿ç•™æ—§çš„å“ˆå¸Œæ ¼å¼æˆ–å¼•å…¥æ–°çš„å“ˆå¸Œæ ¼å¼ï¼Œä½†è¿™æ ·ç™»å½•åå°±å¯ä»¥ç†è§£è¿™ä¸¤ç§ç±»å‹ã€‚ </li><li> è€ƒè™‘ä¸ºç”¨æˆ·æ·»åŠ ç«™ç‚¹æœåŠ¡ï¼Œä»¥ä½¿yii2â€œå¼€ç®±å³ç”¨â€ã€‚ <br> æˆ‘çš„æ„æ€æ˜¯å®ç°ç”¨æˆ·çš„<u>IdentityInterface</u>æ¥å£ï¼Œè¯¥æ¥å£å…è®¸é€šè¿‡ä»¤ç‰Œè¿›è¡Œèº«ä»½éªŒè¯ï¼Œæ¢å¤å¯†ç ç­‰ã€‚ ä¹Ÿè®¸æ‚¨å·²ç»æ‹¥æœ‰åˆé€‚çš„å®‰å…¨å¸¦ï¼Œä½†æ˜¯çªç„¶ä¹‹é—´æ²¡æœ‰ï¼Ÿ ç„¶åï¼Œè¿™æ˜¯ä¸€ä¸ªä»¥æœ€å°çš„åŠªåŠ›æ”¹è¿›æœåŠ¡çš„å¥½é€‰æ‹©ã€‚ <br><br> å¦‚æœæ˜¯ï¼Œé‚£ä¹ˆè¿™å°†å¯¼è‡´åœ¨yii2ä¸­ï¼ˆè‡³å°‘éƒ¨åˆ†åœ°ï¼‰å®ç°ï¼ˆè¿ç§»ï¼‰ä¸ªäººå¸æˆ·ã€‚ <br> å¦‚æœä¸ºâ€œå¦â€ï¼Œé‚£ä¹ˆæ‚¨ä»ç„¶åº”è¯¥è€ƒè™‘ä¸ªäººå¸æˆ·çš„è¿ç§»ï¼ˆå³ä½¿æ²¡æœ‰æ–°äº§å“ï¼‰ã€‚ <br></li></ol><br><h4>  PSï¼š </h4><br> å®ƒå¹¶ä¸æ€»æ˜¯æè¿°ç‰¹å®šä»»åŠ¡ä¸­çš„æ˜ç¡®è§£å†³æ–¹æ¡ˆï¼Œå¹¶ä¸”å¹¶éæ‰€æœ‰è§£å†³æ–¹æ¡ˆéƒ½éœ€è¦åº”ç”¨ã€‚ <br><br> æè¿°å®ƒä»¬å¹¶ä¸æ˜¯ä¸ºäº†è¯´â€œåƒæˆ‘ä¸€æ ·åšâ€ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿yii1çš„cookieè‡ªåŠ¨è¿›å…¥yii2è‡ªåŠ¨ç™»å½•ï¼Œä½†æ˜¯ï¼Œè¯´å¾—é€šä¸€ç‚¹ä¹Ÿä¸å¥½ï¼ˆå¹¶ä¸”åº”è¯¥ä»¥æŸç§æ–¹å¼è¯æ˜è¿™ç§æ‹æ–æ˜¯åˆç†çš„ï¼‰ã€‚ <br><br> ä½†æ˜¯æˆ‘å·²ç»èŠ±äº†ä¸€äº›æ—¶é—´æ¥é€æ­¥è¿›è¡Œé¡¹ç›®è¿ç§»ï¼Œå¦‚æœæœ‰äººæ ¹æ®æˆ‘çš„ç»éªŒå°†ä»–æ•‘å‡ºæ¥ï¼Œæˆ‘ä¼šæ„Ÿåˆ°å¾ˆé«˜å…´ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN419999/">https://habr.com/ru/post/zh-CN419999/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN419989/index.html">æ–°è¥¿å…°ç¦æ­¢ä½¿ç”¨å¡‘æ–™è¢‹</a></li>
<li><a href="../zh-CN419991/index.html">è‡ªä¸»æ— äººæœºå°†ä»æœºåœºé©±èµ¶æˆç¾¤çš„é¸Ÿç±»</a></li>
<li><a href="../zh-CN419993/index.html">TypeScripté¢è¯•ï¼š20ä¸ªé—®é¢˜å’Œç­”æ¡ˆ</a></li>
<li><a href="../zh-CN419995/index.html">å¯¹æ–°çš„Angularç¼–è¯‘å™¨Ivyçš„ç ”ç©¶</a></li>
<li><a href="../zh-CN419997/index.html">è§£æJavaScriptä¸­çš„â€œæ¨¡å—â€æ¨¡å¼</a></li>
<li><a href="../zh-CN420001/index.html">æ¨å‡º3CX v15.5 Update 6 BETAå’ŒWebRTCæµè§ˆå™¨è½¯ä»¶ç”µè¯</a></li>
<li><a href="../zh-CN420003/index.html">JavaFXä¸Šå¸¦æœ‰æŒ‰é’®çš„çª—å£ï¼š</a></li>
<li><a href="../zh-CN420005/index.html">ä¸ä¸“ä¸šçš„å…¬å¯“è§†é¢‘ç›‘æ§æ—¢æœ‰è¶£åˆä¾¿å®œ</a></li>
<li><a href="../zh-CN420007/index.html">FidgetPenï¼Œæ€ªå¼‚çš„ç¯å’Œåˆ†ç¦»å™¨ç«‹æ–¹ä½“ï¼šè®¤è¯†Allocacoc</a></li>
<li><a href="../zh-CN420009/index.html">äº§å“è®¾è®¡çš„ç²¾å¦™ä¹‹å¤„</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>