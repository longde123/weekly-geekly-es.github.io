<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë£ üéÉ üë©üèº‚Äçüöí Interaction avec le serveur via l'API dans iOS sur Swift 3. Partie 2 üìÖ ü§µüèæ üé∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article fait suite √† l'article Interagir avec le serveur via une API dans iOS sur Swift 3. Partie 1 et mettre √† jour un ancien article √©crit en Ob...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Interaction avec le serveur via l'API dans iOS sur Swift 3. Partie 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415615/">  Cet article fait suite √† l'article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Interagir avec le serveur via une API dans iOS sur Swift 3. Partie 1</a> et mettre √† jour un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ancien article</a> √©crit en Objective-C sur swift 3. <br><br><h2>  Br√®ve th√©orie </h2><br><h3>  GET request </h3><br>  GET est la m√©thode de requ√™te HTTP la plus simple, et c'est ce que le navigateur utilise pour charger les pages Web.  Il est utilis√© pour demander du contenu situ√© √† une URL sp√©cifique.  Le contenu peut √™tre, par exemple, une page Web, une image ou un fichier audio.  Par convention, les requ√™tes GET sont en lecture seule et, conform√©ment √† la norme W3C, ne doivent pas √™tre utilis√©es dans des op√©rations qui changent le c√¥t√© serveur.  Par exemple, nous n'utiliserons pas de requ√™te GET pour envoyer un formulaire ou envoyer une photo, car ces op√©rations n√©cessitent quelques modifications c√¥t√© serveur (nous utiliserons POST dans ces cas). <br><br><h3>  Demande POST </h3><br>  POST envoie des donn√©es pour un traitement ult√©rieur √† l'URL.  Les param√®tres sont inclus dans le corps de la demande en utilisant le m√™me format que GET.  Par exemple, si nous voulons publier un formulaire contenant deux champs, un nom et un √¢ge, nous enverrons quelque chose de similaire √† name = Martin &amp; age = 29 dans le corps de la demande. <br><br>  Cette m√©thode d'envoi de param√®tres est largement utilis√©e dans les pages Web.  Les cas les plus courants sont les formulaires.  Lorsque nous remplissons le formulaire sur le site et cliquons sur Soumettre, la demande sera probablement POST. <br><a name="habracut"></a><br>  Dans notre application, nous utilisons POST pour classer les blagues.  Nous enverrons des votes (ou +1 ou -1) au serveur distant. <br><br>  Les donn√©es de demande POST peuvent √™tre structur√©es en utilisant diff√©rents formats.  Les param√®tres sont g√©n√©ralement format√©s conform√©ment aux normes de codage form-url (conform√©ment √† la norme HTML W3C).  Il s'agit du format par d√©faut et il est largement utilis√© dans de nombreux navigateurs.  Notre m√©thode accepte le dictionnaire Dictionary comme argument, mais nous ne pouvons pas envoyer le dictionnaire Dictionary via la connexion HTTP car il s'agit d'un type Swift interne.  Pour transmettre via une connexion HTTP, nous devons cr√©er une repr√©sentation reconnaissable du dictionnaire.  C'est comme communiquer avec un √©tranger.  Nous traduisons notre message dans une langue universelle, et il traduit d'une langue universelle dans sa langue maternelle.  Le langage universel en HTTP est le standard W3C, notre langue est Swift, la langue du destinataire nous est inconnue. <br><br>  La norme W3C d√©finit des r√®gles qui d√©finissent ce que signifie une repr√©sentation reconnaissable pour chaque cas.  Dans notre cas, nous devons pr√©senter les param√®tres suivant la partie cod√©e par l'url du formulaire de la norme (par exemple, param1 = var1 &amp; param2 = var2). <br><br><h3>  Webview </h3><br>  √Ä l'aide d'outils de langage de programmation, nous pouvons envoyer des demandes √† un serveur distant.  C'est ce que font les navigateurs avant d'afficher une page Web.  La diff√©rence r√©side uniquement dans le contenu de la r√©ponse.  Les pages Web sont format√©es √† l'aide de la norme HTML, qui d√©finit un ensemble de r√®gles pour d√©finir graphiquement diff√©rentes balises de balisage.  Ces r√®gles semblent simples, mais afficher une page enti√®re suivant la norme W3C est une t√¢che difficile.  Heureusement, iOS a un composant UIWebView int√©gr√© qui utilise le moteur WebKit bien connu et interpr√®te HTML / CSS / JavaScript et affiche des pages Web enti√®res dans une UIView. <br><br>  Il y a plusieurs cas o√π nous voulons contr√¥ler le flux de navigation.  Par exemple, nous voulons savoir quand un certain contenu ou une URL sp√©cifique est charg√©. <br><br>  Ou peut-√™tre que nous mettons en ≈ìuvre un navigateur s√©curis√© pour les enfants, nous voulons emp√™cher l'utilisateur de charger des pages qui r√©pondent √† certains crit√®res, comme le sexe ou la drogue.  Pour tous ces types de personnalisation, nous cr√©ons une instance d'une classe qui impl√©mente le protocole UIWebViewDelegate en tant que d√©l√©gu√© UIWebView.  Nous pouvons impl√©menter les m√©thodes suivantes: <br><br><pre><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">webView</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:shouldStartLoadWithRequest</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:navigationType</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">webViewDidStartLoad</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">webViewDidFinishLoad</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">webView</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:didFailLoadWithError</span></span>:</code> </pre> <br>  En utilisant la premi√®re m√©thode, nous pouvons contr√¥ler le flux de navigation en autorisant ou en bloquant des requ√™tes sp√©cifiques.  Les trois autres m√©thodes sont des √©v√©nements d'information (les noms de m√©thode donnent une bonne id√©e de l'√©v√©nement). <br><br><h2>  Mise en place du vote via demande POST </h2><br>  Nous ajouterons les <b>fichiers MainViewController.swift</b> et <b>HTTPCommunication.swift</b> et cr√©erons un nouveau fichier <b>WebViewController.swift</b> dans lequel nous d√©finirons notre webView. <br><br>  Cr√©ez d'abord un nouveau fichier WebViewController.swift et d√©finissez-y la classe WebViewController: <br><br>  <b>WebViewController.swift</b> <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> UIKit <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UIViewController { } extension WebViewController { }</span></span></span></span></code> </pre> <br>  Maintenant, nous impl√©mentons la fonctionnalit√© permettant de faire des requ√™tes POST dans la classe responsable de toutes nos op√©rations HTTP: classe HTTPCommunication.  Pour ce faire, ajoutez une nouvelle m√©thode postURL (_: params: compl√©tementHandler :) dans HTTPCommunication.swift, qui est similaire √† la m√©thode pr√©c√©dente retrieveURL (_: compl√©tionHandler :). <br><br>  <b>HTTPCommunication.swift</b> <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTTPCommunication</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSObject</span></span></span><span class="hljs-class"> </span></span>{ ‚Ä¶ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">retrieveURL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url: URL, completionHandler: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params">(Data)</span></span></span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>)) { ‚Ä¶ } <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">    } // end of class HTTPCommunication</span></span></code> </pre><br>  Code de m√©thode <br><br><pre> <code class="hljs powershell">func postURL(_ url: URL, params: <span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">String</span></span></span><span class="hljs-function">: </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">Int</span></span></span><span class="hljs-function">], </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">completionHandler</span></span></span></span>: @escaping ((<span class="hljs-keyword"><span class="hljs-keyword">Data</span></span>) -&gt; Void)) { // (K.<span class="hljs-number"><span class="hljs-number">1</span></span>) self.completionHandler = completionHandler // (K.<span class="hljs-number"><span class="hljs-number">2</span></span>) func postBody(params: <span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">String</span></span></span><span class="hljs-function">: </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">Int</span></span></span><span class="hljs-function">]) -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">Data</span></span></span></span>? { // (K.<span class="hljs-number"><span class="hljs-number">3</span></span>) var paramsArr: <span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">String</span></span></span><span class="hljs-function">] = [] </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">for</span></span></span></span> (key, value) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> params { paramsArr.append(<span class="hljs-string"><span class="hljs-string">"\(key)=\(value)"</span></span>) } let postBodyString: String = paramsArr.joined(separator: <span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>) let postBodyData: <span class="hljs-keyword"><span class="hljs-keyword">Data</span></span>? = postBodyString.data(using: .utf8) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> postBodyData } var request: URLRequest = URLRequest(url: url) // (K.<span class="hljs-number"><span class="hljs-number">4</span></span>) request.httpMethod = <span class="hljs-string"><span class="hljs-string">"POST"</span></span> request.httpBody = postBody(params: params) let session: URLSession = URLSession(configuration: .default, delegate: self, delegateQueue: nil) // (K.<span class="hljs-number"><span class="hljs-number">5</span></span>) let task: URLSessionDownloadTask = session.downloadTask(with: request) task.resume() }</code> </pre> <br>  (K.1) Avec la fermeture, nous travaillerons en dehors de cette fonction, nous la d√©signons donc par @escaping. <br>  (K.2) Nous stockons la fermeture r√©ussie dans la propri√©t√© d'ach√®vementHandler. <br>  (K.3) Nous √©crivons une m√©thode qui convertit le dictionnaire des param√®tres pass√©s sous forme de cha√Æne, puis encodons cette cha√Æne en type de donn√©es dans le codage utf8. <br>  (K.4) Nous cr√©ons une requ√™te avec l'URL transmise et la configurons: d√©finissez POST comme m√©thode, et d√©finissez nos param√®tres de type Data avec utf8 comme corps de requ√™te. <br>  (K.5) Enfin, cr√©ez une session avec une configuration par d√©faut et un d√©l√©gu√© comme nous-m√™mes.  Et nous cr√©ons une t√¢che pour charger le r√©sultat de cette demande dans un stockage temporaire.  √Ä la fin, d√©congelez la t√¢che. <br><br>  Ajoutons maintenant l'interface n√©cessaire √† MainViewController.swift.  Ajoutez deux boutons pour voter voteUp et voteDown, ce qui augmentera ou diminuera respectivement la note de la blague actuelle.  Nous ajoutons √©galement le bouton ¬´Chuck Who?¬ª, Que nous remplirons de fonctionnalit√©s dans la section sur la vue Web. <br><br>  Dans le MainViewController.swift, ins√©rez le code d'initialisation voteUpButton, voteDownButton et chuckWhoButton. <br><br>  <b>MainViewController.swift</b> <br><br><pre> <code class="hljs swift"><span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jokeLabel: <span class="hljs-type"><span class="hljs-type">UILabel!</span></span> = ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jokeID: <span class="hljs-type"><span class="hljs-type">Int!</span></span> <span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> activityView: <span class="hljs-type"><span class="hljs-type">UIActivityIndicatorView!</span></span> = ‚Ä¶ <span class="hljs-comment"><span class="hljs-comment">//</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">    lazy var stackView: UIStackView! = ‚Ä¶</span></span></code> </pre><br>  Code d'initialisation du bouton <br><pre> <code class="hljs pgsql">lazy var voteUpButton: UIButton! = { // (L<span class="hljs-number"><span class="hljs-number">.1</span></span>) let button: UIButton = UIButton(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: .<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>) // (L<span class="hljs-number"><span class="hljs-number">.2</span></span>) button.setTitle("Vote Up", <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: .normal) button.sizeToFit() button.addTarget(self, action: #selector(self.voteUp), <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: .touchUpInside) // (L<span class="hljs-number"><span class="hljs-number">.3</span></span>) self.<span class="hljs-keyword"><span class="hljs-keyword">view</span></span>.addSubview(button) // (L<span class="hljs-number"><span class="hljs-number">.4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> button // (L<span class="hljs-number"><span class="hljs-number">.5</span></span>) }() lazy var voteDownButton: UIButton! = { let button: UIButton = UIButton(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: .<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>) button.setTitle("Vote Down", <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: .normal) button.sizeToFit() button.addTarget(self, action: #selector(self.voteDown), <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: .touchUpInside) self.<span class="hljs-keyword"><span class="hljs-keyword">view</span></span>.addSubview(button) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> button }() lazy var chuckWhoButton: UIButton! = { let button: UIButton = UIButton(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: .<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>) button.setTitle("Chuck Who?", <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: .normal) button.sizeToFit() button.addTarget(self, action: #selector(self.chuckWho), <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: .touchUpInside) self.<span class="hljs-keyword"><span class="hljs-keyword">view</span></span>.addSubview(button) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> button }()</code> </pre> <br>  Le code d'initialisation pour les trois boutons est le m√™me. <br><br>  (L.1) Nous d√©clarons une variable paresseuse et l'initialisons avec une fermeture. <br>  (L.2) √Ä l'int√©rieur de la fermeture, nous d√©finissons une variable locale pour le bouton, un type de syst√®me, sp√©cifions le nom et la taille. <br>  (L.3) Nous associons au bouton l'action correspondante lorsqu'il est press√©. <br>  (L.4) Ajouter √† la hi√©rarchie des vues. <br>  (L.5) Et nous attribuons cette variable locale √† notre variable paresseuse. <br><br>  Ensuite, dans MainViewController.swift, ins√©rez le code de m√©thode pour les boutons <br><br>  <b>MainViewController.swift</b> <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ ‚Ä¶ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">retrieveRandomJokes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { ‚Ä¶ } <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">    } // end of class MainViewController</span></span></code> </pre><br>  Code de m√©thode pour les boutons <br><pre> <code class="hljs powershell">func voteUp() { let http: HTTPCommunication = HTTPCommunication() // (M.<span class="hljs-number"><span class="hljs-number">1</span></span>) let params: [<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>] = [<span class="hljs-string"><span class="hljs-string">"joke_id"</span></span>: <span class="hljs-type"><span class="hljs-type">self.jokeID</span></span>, <span class="hljs-string"><span class="hljs-string">"vote"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>] // (M.<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let url = URL(string: <span class="hljs-string"><span class="hljs-string">"http://example.com/rater/vote"</span></span>) { // (M.<span class="hljs-number"><span class="hljs-number">3</span></span>) http.postURL(url, params: params) { (<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> // (M.<span class="hljs-number"><span class="hljs-number">4</span></span>) print(<span class="hljs-string"><span class="hljs-string">"\(data). Voted Up"</span></span>) } } } func voteDown() { let http: HTTPCommunication = HTTPCommunication() let params: [<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>] = [<span class="hljs-string"><span class="hljs-string">"joke_id"</span></span>: <span class="hljs-type"><span class="hljs-type">self.jokeID</span></span>, <span class="hljs-string"><span class="hljs-string">"vote"</span></span>: -<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let url = URL(string: <span class="hljs-string"><span class="hljs-string">"http://example.com/rater/vote"</span></span>) { http.postURL(url, params: params) { (<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> print(<span class="hljs-string"><span class="hljs-string">"\(data). Voted Down"</span></span>) } } } func chuckWho() { }</code> </pre> <br>  Le code des m√©thodes de vote de haut en bas est le m√™me. <br><br>  (M.1) Cr√©ez un objet de classe pour la communication avec le serveur. <br>  (M.2) Nous cr√©ons un dictionnaire de param√®tres qui inclut l'id de la blague pour laquelle nous votons, et la valeur r√©elle du vote est +1 ou -1. <br>  (M.3) Ensuite, nous obtenons l'URL en toute s√©curit√© dans la barre d'adresse de notre domaine de formation <code>http://example.com/rater/vote.</code> <br>  (M.4) Et nous envoyons via POST une demande d'url de nos param√®tres.  Et imprimez sur la console une ligne indiquant la fin de la demande. <br><br>  Ensuite, dans MainViewController.swift, nous r√©√©crivons le code de la m√©thode configStackView, en tenant compte des modifications apport√©es √† l'interface utilisateur. <br><br>  <b>MainViewController.swift</b> <br><br><pre> <code class="hljs powershell">func configStackView() -&gt; UIStackView { let innerStackView: UIStackView = UIStackView(arrangedSubviews: [<span class="hljs-type"><span class="hljs-type">self.voteUpButton</span></span>, <span class="hljs-type"><span class="hljs-type">self.voteDownButton</span></span>]) // (N.<span class="hljs-number"><span class="hljs-number">1</span></span>) innerStackView.axis = .horizontal // (N.<span class="hljs-number"><span class="hljs-number">2</span></span>) innerStackView.distribution = .fillEqually let mainStackView: UIStackView = UIStackView(arrangedSubviews: [<span class="hljs-type"><span class="hljs-type">self.jokeLabel</span></span>, <span class="hljs-type"><span class="hljs-type">innerStackView</span></span>, <span class="hljs-type"><span class="hljs-type">self.chuckWhoButton</span></span>]) // (N.<span class="hljs-number"><span class="hljs-number">3</span></span>) mainStackView.spacing = <span class="hljs-number"><span class="hljs-number">50</span></span> // (N.<span class="hljs-number"><span class="hljs-number">4</span></span>) mainStackView.axis = .vertical mainStackView.distribution = .fillEqually self.view.addSubview(mainStackView) // (N.<span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mainStackView }</code> </pre> <br>  (N.1) Cr√©ez un innerStackView contenant deux boutons pour voter. <br>  (N.2) Nous exposons l'axe vertical;  la distribution est la m√™me. <br>  (N.3) Dans le mainStackView principal, ajoutez le innerStackView et le bouton sur Chuck Norris √† l'√©tiquette de la derni√®re partie. <br>  (N.4) Configurez mainStackView. <br>  (N.5) Ajoutez mainStackView √† la hi√©rarchie des vues. <br><br>  Nous lan√ßons notre application et voyons l'interface comme sur la Fig.  1 <br><br><img src="https://habrastorage.org/webt/wj/nv/ur/wjnvurcfmrxazb2lhifxl689zqa.png"><br>  <i>Fig.1 L'interface de notre application avec des boutons ajout√©s pour voter</i> <br><br>  nous v√©rifions que lorsque vous votez pour ou contre une blague, les messages suivants s'affichent dans la console: <br><br> <code>345 bytes. Voted Up</code> <br> <br>  ou <br><br> <code>345 bytes. Voted Down</code> <br> <br>  qui indique une requ√™te POST r√©ussie au serveur. <br><br>  Nous avons √©crit une application de blague en utilisant l'API icndb et le verbe HTTP GET.  Nous avons pu montrer ces blagues sur UIView et chaque blague peut √™tre appr√©ci√©e.  Ces actions envoient une requ√™te POST au serveur distant, ce qui devrait enregistrer notre estimation. <br><br><h2>  Utilisation de webViews pour afficher des pages Web </h2><br>  Nous allons ajouter une vue Web pour afficher la page wikipedia de Chuck Norris.  Elle devient confuse au simple toucher d'un bouton. <br><br>  Dans le fichier WebViewController.swift, √©crivez le stub de fonction suivant: <br><br>  <b>WebViewController.swift</b> <br><br><pre> <code class="hljs haskell"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> UIKit class WebViewController: UIViewController { lazy var webView: UIWebView = { // (<span class="hljs-type"><span class="hljs-type">O</span></span>.1) self.configWebView() }() lazy var toolbar: UIToolbar = { // (<span class="hljs-type"><span class="hljs-type">O</span></span>.2) self.configToolbar() }() override func viewDidLoad() { super.viewDidLoad() } func back() { // (<span class="hljs-type"><span class="hljs-type">O</span></span>.3) self.webView.goBack() } func forward() { self.webView.goForward() } } extension WebViewController { func configWebView() -&gt; UIWebView { // (<span class="hljs-type"><span class="hljs-type">O</span></span>.4) } func configToolbar() -&gt; UIToolbar { // (<span class="hljs-type"><span class="hljs-type">O</span></span>.5) } func configConstraints() { // (<span class="hljs-type"><span class="hljs-type">O</span></span>.6) } }</code> </pre> <br>  (O.1) Nous cr√©ons des variables paresseuses pour webView <br>  (O.2) et barre d'outils. <br>  (O.3) Nous cr√©ons des m√©thodes d'avant en arri√®re, pour la navigation sur l'historique de visite des liens. <br>  (O.4) Nous ajoutons des m√©thodes d'initialisation webView √† l'extension <br>  (O.5) et toolBar <br>  (O.6) et contraintes pour l'interface. <br><br>  Maintenant, nous peignons le code de chaque fonction: <br><br><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configWebView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UIWebView</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> webView: <span class="hljs-type"><span class="hljs-type">UIWebView</span></span> = <span class="hljs-type"><span class="hljs-type">UIWebView</span></span>() <span class="hljs-comment"><span class="hljs-comment">// (P.1) self.view.addSubview(webView) return webView }</span></span></code> </pre> <br>  (P.1) Nous initialisons la webView et ajoutons la vue √† la hi√©rarchie. <br><br><pre> <code class="hljs smalltalk">func configToolbar() -&gt; <span class="hljs-type"><span class="hljs-type">UIToolbar</span></span> { let toolbar: <span class="hljs-type"><span class="hljs-type">UIToolbar</span></span> = <span class="hljs-type"><span class="hljs-type">UIToolbar</span></span>(frame: <span class="hljs-type"><span class="hljs-type">CGRect</span></span>.zero) // (<span class="hljs-type"><span class="hljs-type">Q</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>) let backButton: <span class="hljs-type"><span class="hljs-type">UIBarButtonItem</span></span> = <span class="hljs-type"><span class="hljs-type">UIBarButtonItem</span></span>(title: <span class="hljs-comment"><span class="hljs-comment">"&lt;"</span></span>, style: .plain, target: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, action: <span class="hljs-symbol"><span class="hljs-symbol">#selector</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.back)) // (<span class="hljs-type"><span class="hljs-type">Q</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>) let forwardButton: <span class="hljs-type"><span class="hljs-type">UIBarButtonItem</span></span> = <span class="hljs-type"><span class="hljs-type">UIBarButtonItem</span></span>(title: <span class="hljs-comment"><span class="hljs-comment">"&gt;"</span></span>, style: .plain, target: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, action: <span class="hljs-symbol"><span class="hljs-symbol">#selector</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.forward)) toolbar.setItems([backButton, forwardButton], animated: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) // (<span class="hljs-type"><span class="hljs-type">Q</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>) toolbar.backgroundColor = <span class="hljs-type"><span class="hljs-type">UIColor</span></span>.lightGray // (<span class="hljs-type"><span class="hljs-type">Q</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.addSubview(toolbar) return toolbar }</code> </pre> <br>  (Q.1) Cr√©ez une barre d'outils avec un cadre nul. <br>  (Q.2) Nous cr√©ons deux boutons pour naviguer dans l'historique des liens de visite.  Avec les noms ¬´&lt;¬ª et ¬´&gt;¬ª et les actions attach√©s √† la m√©thode correspondante dans webView. <br>  (Q.3) Ajoutez ces boutons √† la barre d'outils. <br>  (Q.4) D√©finissez la couleur d'arri√®re-plan, comme la barre de navigation, gris clair.  Et ajoutez la vue √† la hi√©rarchie. <br><br><pre> <code class="hljs powershell">func configConstraints() { self.webView.translatesAutoresizingMaskIntoConstraints = false // (R.<span class="hljs-number"><span class="hljs-number">1</span></span>) NSLayoutConstraint.activate([ // (<span class="hljs-type"><span class="hljs-type">R.2</span></span>) <span class="hljs-type"><span class="hljs-type">self.webView.topAnchor.constraint</span></span>(<span class="hljs-type"><span class="hljs-type">equalTo</span></span>: <span class="hljs-type"><span class="hljs-type">self.topLayoutGuide.topAnchor</span></span>), <span class="hljs-type"><span class="hljs-type">self.webView.leadingAnchor.constraint</span></span>(<span class="hljs-type"><span class="hljs-type">equalTo</span></span>: <span class="hljs-type"><span class="hljs-type">self.view.leadingAnchor</span></span>), <span class="hljs-type"><span class="hljs-type">self.webView.trailingAnchor.constraint</span></span>(<span class="hljs-type"><span class="hljs-type">equalTo</span></span>: <span class="hljs-type"><span class="hljs-type">self.view.trailingAnchor</span></span>), <span class="hljs-type"><span class="hljs-type">self.webView.bottomAnchor.constraint</span></span>(<span class="hljs-type"><span class="hljs-type">equalTo</span></span>: <span class="hljs-type"><span class="hljs-type">self.toolbar.topAnchor</span></span>) ]) self.toolbar.translatesAutoresizingMaskIntoConstraints = false NSLayoutConstraint.activate([ // (<span class="hljs-type"><span class="hljs-type">R.3</span></span>) <span class="hljs-type"><span class="hljs-type">self.toolbar.leadingAnchor.constraint</span></span>(<span class="hljs-type"><span class="hljs-type">equalTo</span></span>: <span class="hljs-type"><span class="hljs-type">self.view.leadingAnchor</span></span>), <span class="hljs-type"><span class="hljs-type">self.toolbar.trailingAnchor.constraint</span></span>(<span class="hljs-type"><span class="hljs-type">equalTo</span></span>: <span class="hljs-type"><span class="hljs-type">self.view.trailingAnchor</span></span>), <span class="hljs-type"><span class="hljs-type">self.toolbar.bottomAnchor.constraint</span></span>(<span class="hljs-type"><span class="hljs-type">equalTo</span></span>: <span class="hljs-type"><span class="hljs-type">self.view.bottomAnchor</span></span>), <span class="hljs-type"><span class="hljs-type">self.toolbar.heightAnchor.constraint</span></span>(<span class="hljs-type"><span class="hljs-type">equalToConstant</span></span>: <span class="hljs-number"><span class="hljs-number">44.0</span></span>) ]) }</code> </pre> <br>  (R.1) D√©sactiver les masques de redimensionnement automatique afin qu'ils n'entrent pas en conflit avec nos contraintes <br>  (R.2) Pour webView, configurez les quatre c√¥t√©s de la vue. <br>  (R.3) Pour la barre d'outils, configurez trois c√¥t√©s de la vue, √† l'exception du haut, mais d√©finissez √©galement la hauteur √† la taille standard 44,0. <br><br>  Et r√©√©crivez le code ViewDidLoad () comme suit: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.configConstraints() <span class="hljs-comment"><span class="hljs-comment">// (S.1) if let url = URL(string: "http://en.wikipedia.org/wiki/Chuck_Norris") { // (S.2) let request: URLRequest = URLRequest(url: url) // (S.3) self.webView.loadRequest(request) // (S.4) } }</span></span></code> </pre> <br>  (S.1) Invoquer la d√©finition de contraintes. <br>  (S.2) Obtenez l'URL en toute s√©curit√© dans la barre d'adresse de la page Wikipedia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">en.wikipedia.org/wiki/Chuck_Norris</a> <br>  (S.3) Nous cr√©ons une demande √† partir de l'URL. <br>  (S.4) Et nous ex√©cutons la demande donn√©e dans webView. <br><br>  Nous revenons au MainViewController et le remplissons avec la m√©thode d'appel des informations sur Chuck Norris. <br><br>  <b>MainViewController.swift</b> <br><br><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chuckWho</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.navigationController?.show(<span class="hljs-type"><span class="hljs-type">WebViewController</span></span>(), sender: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) <span class="hljs-comment"><span class="hljs-comment">// (T.1) }</span></span></code> </pre> <br>  (T.1) Lorsque vous cliquez sur ce bouton dans la pile navigationController, placez une nouvelle instance de webView. <br><br>  Fig.  2 montre √† quoi ressemble webView dans notre application. <br><br><img src="https://habrastorage.org/webt/cj/tv/-a/cjtv-a57shzmktsq3btfccu6hme.png"><br>  <i>Fig.</i>  <i>2. La vue finale de la webView que nous avons impl√©ment√©e</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr415615/">https://habr.com/ru/post/fr415615/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr415599/index.html">L'Inde veut √©galement obtenir de l'h√©lium-3</a></li>
<li><a href="../fr415601/index.html">Cluster Kubernetes HA avec containerd. Ou y a-t-il une vie sans docker?</a></li>
<li><a href="../fr415605/index.html">Comment nous avons √©conomis√© le traitement des cartes avec Exadata</a></li>
<li><a href="../fr415611/index.html">PKI: biblioth√®ques GCrypt et KSBA comme alternative √† OpenSSL avec prise en charge de la cryptographie russe. Continuation</a></li>
<li><a href="../fr415613/index.html">Pourquoi vous ne devriez pas acheter de lustres √† LED</a></li>
<li><a href="../fr415617/index.html">Utilisation de la biblioth√®que FPC InternetPCools dans Delphi</a></li>
<li><a href="../fr415619/index.html">Apple et Samsung terminent une guerre des brevets de 7 ans</a></li>
<li><a href="../fr415621/index.html">Syst√®me de surveillance mini√®re</a></li>
<li><a href="../fr415623/index.html">La dynamique du vol vertical d'un avion plus l√©ger que l'air</a></li>
<li><a href="../fr415625/index.html">Kubernetes: webinaire (4 juillet √† 19h30) et intensif (3-5 ao√ªt)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>