<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§üüèª ü§¶üèº üë®‚ÄçüöÄ Como renderizar o quadro da Terra M√©dia: Sombra de Mordor ‚õπüèº üåï üë∞üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Middle Earth: Shadow of Mordor foi lan√ßado em 2014. O jogo em si foi uma grande surpresa, e o fato de ser um spin-off da hist√≥ria do universo do Senho...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como renderizar o quadro da Terra M√©dia: Sombra de Mordor</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/430518/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ow/br/se/owbrsedfx4zll9o8sxbxx2fbnza.gif"></div><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener">Middle Earth: Shadow of Mordor</a> foi lan√ßado em 2014.  O jogo em si foi uma grande surpresa, e o fato de ser um spin-off da hist√≥ria do universo do Senhor do Anel foi bastante inesperado.  O jogo obteve grande sucesso e, no momento em que escrevia, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener">Monolith</a> j√° havia lan√ßado uma sequ√™ncia - Shadow of War.  Os gr√°ficos do jogo s√£o muito bonitos, especialmente considerando que ele foi lan√ßado para diferentes gera√ß√µes de consoles, incluindo o Xbox 360 e PS3.  A vers√£o para PC √© muito bem polida, cont√©m op√ß√µes gr√°ficas adicionais e pacotes de textura de alta resolu√ß√£o que revelam completamente o potencial do jogo. <br><br>  O jogo usa o relativamente novo renderizador adiado DX11.  Eu usei o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Renderdoc</a> para aprender profundamente as t√©cnicas de renderiza√ß√£o do jogo.  Durante o trabalho, foram utilizados os par√¢metros gr√°ficos m√°ximos poss√≠veis (ultra) e todas as poss√≠veis "lo√ß√µes", como transpar√™ncia independente da ordem, mosaico, oclus√£o no espa√ßo da tela e v√°rios desfoque de movimento. <br><a name="habracut"></a><br><h2>  Moldura </h2><br>  Aqui est√° um quadro que iremos analisar.  O jogador est√° localizado em uma plataforma de madeira na regi√£o de Udun.  Shadow of Mordor usa mec√¢nica semelhante √† mec√¢nica de jogos como Assassin's Creed, onde voc√™ pode escalar edif√≠cios e torres e depois apreciar a paisagem digital ao redor dos telhados. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/73d/325/3e0/73d3253e0323327f95babf989f060f93.jpg" alt="imagem"></div><br><h2>  Passagem de profundidade </h2><br>  As aproximadamente 140 primeiras chamadas de renderiza√ß√£o fazem um r√°pido passo preliminar para renderizar os maiores elementos e edif√≠cios de eleva√ß√£o para o buffer de profundidade.  A maioria dos objetos n√£o se enquadra nesse passe preliminar, mas ajuda quando o jogo tem um n√∫mero muito grande de chamadas de empate e voc√™ pode olhar para longe.  Curiosamente, um personagem que est√° sempre no centro da tela e ocupa uma fra√ß√£o decente do espa√ßo da tela n√£o se enquadra nessa passagem.  Como em muitos outros jogos de mundo aberto, o mecanismo usa os valores z inversos.  Essa t√©cnica liga o plano pr√≥ximo a 1,0 e o plano distante a 0,0 para aumentar a precis√£o em grandes dist√¢ncias e evitar conflitos-z.  Leia mais sobre a precis√£o do buffer z <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/181/ba6/57d/181ba657ddc430ee3a892e852cc276e9.png" alt="imagem"></div><br><h4>  Buffer G </h4><br>  Imediatamente ap√≥s isso, a passagem do buffer G √© iniciada, realizada em aproximadamente 2700 chamadas de empate.  Se voc√™ leu minha <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">an√°lise anterior de Castlevania: Lords of Shadow 2</a> ou estudou outros artigos semelhantes, essa passagem deve ser familiar para voc√™.  A propriedade das superf√≠cies √© registrada em um conjunto de buffers, que s√£o lidos nas passagens do c√°lculo da ilumina√ß√£o para calcular as rea√ß√µes das superf√≠cies √† luz.  Shadow of Mordor usa um renderizador diferido cl√°ssico, mas um n√∫mero relativamente pequeno de destinos de renderiza√ß√£o do buffer G √© usado para atingir esse objetivo (3).  Para compara√ß√£o: o Unreal Engine nesta passagem usa 5-6 buffers.  O buffer G possui o seguinte esquema: <br><br><h5>  Buffer normal </h5><br><table><tbody><tr><td>  <strong><font color="#ff0000">R</font></strong> </td><td>  <strong><font color="#00ff00">G</font></strong> </td><td>  <strong><font color="#0000ff">B</font></strong> </td><td>  <strong>Um</strong> </td></tr><tr><td>  <strong>Normal.x</strong> </td><td>  <strong>Normal.y</strong> </td><td>  <strong>Normal.z</strong> </td><td>  <strong>ID</strong> </td></tr></tbody></table><br>  O buffer de normais armazena os normais no espa√ßo mundial no formato de "8 bits por canal".  Isso √© apenas o suficiente, e √†s vezes nem um pouco, para descrever superf√≠cies planas que variam suavemente.  Se voc√™ olhar de perto, isso pode ser visto em algumas po√ßas do jogo.  O canal alfa √© usado como um ID que marca v√°rios tipos de objetos.  Por exemplo, descobri que 255 se refere ao personagem, 128 √† parte animada da bandeira, e o c√©u √© marcado com o ID 1, porque posteriormente esses identificadores s√£o usados ‚Äã‚Äãpara filtr√°-lo no est√°gio de adi√ß√£o (o c√©u recebe sua pr√≥pria flor radial). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/za/jf/y8/zajfy84cg-abqarjiybgm3qcztw.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9k/aq/4v/9kaq4vempyj-n14_kdfte3d51ss.png"></div><br>  <i>No artigo original, essas e muitas outras imagens s√£o animadas para maior clareza, por isso recomendo procurar l√°.</i> <br><br><h5>  Buffer Albedo </h5><br><table><tbody><tr><td>  <strong><font color="#ff0000">R</font></strong> </td><td>  <strong><font color="#00ff00">G</font></strong> </td><td>  <strong><font color="#0000ff">B</font></strong> </td><td>  <strong>Um</strong> </td></tr><tr><td>  <strong>Albedo.r</strong> </td><td>  <strong>Albedo.g</strong> </td><td>  <strong>Albedo.b</strong> </td><td>  <b>Oclus√£o da cavidade</b> </td></tr></tbody></table><br>  O buffer albedo armazena todos os tr√™s componentes albedo e uma oclus√£o em pequena escala (√†s vezes chamada de oclus√£o de cavidade), usada para sombrear pequenos detalhes que n√£o podem ser alcan√ßados por um mapa de sombras ou p√≥s-processamento no espa√ßo da tela.  √â usado principalmente para fins decorativos, por exemplo, buracos e vincos nas roupas, pequenas rachaduras na √°rvore, pequenos padr√µes nas roupas da Talion, etc. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/t6/ul/bz/t6ulbzqtlw3ncodrlnd49uxtmwa.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/28/52/lr/2852lrdq75bxtqpkywvutfsm4se.png"></div><br>  Ao processar inimigos no shader, albedo leva em considera√ß√£o a textura do sangue (curiosamente, Talion nunca fica ferido vis√≠vel).  A textura do sangue √© a entrada para a fase de renderiza√ß√£o das roupas e do corpo dos inimigos, mas n√£o especifica a cor do sangue, que √© a entrada no buffer constante, mas determina os fatores / n√≠veis sangu√≠neos para controlar a quantidade exibida de sangue.  Al√©m disso, a orienta√ß√£o normal √© usada para dimensionar o efeito, permitindo controlar a dire√ß√£o dos respingos de sangue.  Em seguida, albedo sombreia essencialmente o brilho das feridas recebidas pelo inimigo, tiradas do local apropriado no mapa de sangue, e tamb√©m modifica outras propriedades, como a especular, para obter um efeito sangu√≠neo convincente.  N√£o consegui encontrar a parte do quadro em que o mapa √© renderizado, mas presumo que eles sejam gravados logo no in√≠cio do quadro, quando a espada √© exposta, e depois usados ‚Äã‚Äãaqui. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1y/_r/rt/1y_rrtgi8bsuryvjmqmpdvzwpfk.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mi/tv/nu/mitvnumojb0zx4qhzohrgrj810e.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qp/wx/t7/qpwxt7y4r-k3ugakdasysx1vtvm.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6d/-r/lz/6d-rlzgi7fvdep6xrxnakmjp9yg.png"></div><br><h5>  Buffer especular </h5><br><table><tbody><tr><td>  <strong><font color="#ff0000">R</font></strong> </td><td>  <strong><font color="#00ff00">G</font></strong> </td><td>  <strong><font color="#0000ff">B</font></strong> </td><td>  <strong>Um</strong> </td></tr><tr><td>  <b>Rugosidade</b> </td><td>  <b>Intensidade especular</b> </td><td>  <b>Fresnel</b> </td><td>  <b>Fator de espalhamento subterr√¢neo</b> </td></tr></tbody></table><br>  O buffer especular cont√©m outras propriedades de superf√≠cie que podem ser vistas em jogos, como rugosidade (n√£o √© exatamente rugosidade, mas um grau especular em escala, mas pode ser interpretado dessa maneira), intensidade especular (o brilho da reflex√£o especular) que escala albedo para obter o fator de refletividade especular de cor correto (comumente referido na literatura como F0, porque √© a entrada para a resposta do espelho de Fresnel) e o componente de espalhamento de subsuperf√≠cie (espalhamento de subsuperf√≠cie).  O √∫ltimo componente √© usado para iluminar materiais transl√∫cidos, como tecidos finos, plantas e pele.  Se mais tarde mergulharmos no estudo do shader de ilumina√ß√£o, descobrimos que aqui usamos a varia√ß√£o do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">modelo especular normalizado de acordo com Blinn-Fong</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qx/rv/8c/qxrv8c9xk-4-akibiogsgnvxszw.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wv/xw/_f/wvxw_f6h-5vgmu6cvlucuum3sei.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fb/f3/v1/fbf3v1y8ardyfkjtshlv8zf5ld8.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ql/zq/lz/qlzqlzbbxwy_mlx05pwxwpxmrga.png"></div><br><h5>  Decalques diferidos </h5><br>  Como vimos acima, Shadow of Mordor exibe tra√ßos bastante detalhados de sangue nos personagens feridos.  Quando Talion agita sua espada, o ambiente tamb√©m recebe sua parcela de sangue orc escuro.  No entanto, outra t√©cnica √© usada para ambientes - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">adesivos adiados</a> .  Essa t√©cnica consiste em projetar um conjunto de texturas planas na superf√≠cie do que foi renderizado anteriormente.  Dessa forma, o conte√∫do do buffer G √© substitu√≠do por esse novo conte√∫do antes de executar o passo de ilumina√ß√£o.  No caso do sangue, basta apenas um spray sangrento e, ao renderizar muitos decalques, uma paisagem sombria √© criada rapidamente. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8_/zo/no/8_zonoux0rx6h_cemftpprebcke.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pk/sc/qn/pkscqng3m2s0c2hj-e-fs1eonis.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/a4/uf/rs/a4ufrsgki8blucgm4g8zq3n95ha.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dj/jl/3c/djjl3c5s2dsimxwtoim-c5vk3rg.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wj/hj/cb/wjhjcbcfdu0ts1kpnmh_2_tvhdq.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8r/tk/fi/8rtkfinzlyym0jweyx0gpizv4zs.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uh/ns/pw/uhnspwmomqsrlnoctsokx8q878a.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/di/7m/70/di7m700h63pqtmaiydgrezyt0w4.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8t/ky/sz/8tkyszkhinic56jqebsteeudram.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0a/tu/kj/0atukjo4vjzv3djehm6sttjhqps.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/-5/vm/ja/-5vmjatrsxyfdjhqm5nhsmu_vxw.png"></div><br>  A √∫ltima coisa que √© renderizada na passagem do buffer G √© o c√©u, a textura do c√©u √© de alta resolu√ß√£o (8192 √ó 2048) no formato HDR BC6H.  Eu tive que fazer uma pequena corre√ß√£o de tom, porque no HDR todas as cores s√£o muito escuras. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/95a/6b2/dda/95a6b2dda3a632aebe8fc902f143232d.jpg" alt="imagem"></div><br><h3>  Mosaico </h3><br>  Um "recurso" muito interessante do jogo (se estiver ativado) √© o mosaico.  √â usado para muitas coisas diferentes, desde o terreno at√© a renderiza√ß√£o de personagens (assim como adere√ßos e objetos de personagens).  Aqui, o mosaico n√£o subdivide a malha poli baixa, mas cria pol√≠gonos a partir de uma nuvem de pontos, usando o grau necess√°rio de subdivis√£o, dependendo dos crit√©rios para o n√≠vel de detalhe, por exemplo, a dist√¢ncia da c√¢mera.  Um exemplo interessante √© a capa Talion, que √© transmitida √† GPU como uma nuvem de pontos (ap√≥s simula√ß√£o f√≠sica), e o shader de mosaico recria os pol√≠gonos. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1i/jf/3i/1ijf3ikncscrhyvhjyyan6kdx80.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wj/fp/il/wjfpil_rw7_t1z7pxrfntobcrse.png"></div><br><h3>  Transpar√™ncia independente do pedido </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b78/f09/897/b78f09897b7ed45f990f51f91291c967.png"></div><br>  Uma das primeiras coisas que me impressionou com sua estranheza √© o passe de tratamento capilar, porque ele executa um shader especial muito complexo.  Nas op√ß√µes gr√°ficas, √© mencionada a op√ß√£o OIT (Transpar√™ncia independente do pedido) para cabelos, ou seja, deve ser.  Primeiro, ele executa a sa√≠da em um buffer separado e calcula o n√∫mero total de pixels transparentes sobrepostos, salvando propriedades em uma estrutura "profunda" semelhante a um buffer G.  Mais tarde, outro shader classifica fragmentos individuais individuais de acordo com sua profundidade.  Parece que as flechas tamb√©m s√£o renderizadas dessa maneira (provavelmente, sua plumagem requer classifica√ß√£o adequada).  Esse √© um efeito muito sutil que n√£o adiciona diferen√ßas gr√°ficas especiais, mas ainda √© um detalhe interessante.  Aqui est√° um exemplo simples: a imagem acima mostra o n√∫mero de fragmentos sobrepostos (quanto mais vermelhos, mais fragmentos).  A transpar√™ncia regular ainda √© classificada pela CPU e renderizada como alfa tradicional.  Somente entidades individuais se enquadram no passe OIT. <br><br><h3>  Sombras de Mordor </h3><br>  SoM tem muitas fontes de sombra.  Al√©m dos tradicionais mapas de sombras de fontes de luz din√¢micas, o SoM usa uma oclus√£o ambiental de dois canais no espa√ßo da tela, uma oclus√£o em microescala criada para quase todos os objetos no jogo e uma textura de oclus√£o semelhante a um mapa de altura com uma vista superior. <br><br><h5>  Oclus√£o no espa√ßo da tela </h5><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2cb/58c/fc5/2cb58cfc57777d65a15af4813977c962.png"></div><br>  A primeira passagem √© processada usando o buffer G ambiente e a oclus√£o especular no espa√ßo da tela.  O sombreador em si √© um enorme ciclo desdobrado que mostra o mapa de profundidade em tamanho real e o mapa de profundidade m√©dio anteriormente reduzido, procurando amostras vizinhas em um determinado padr√£o.  Ele usa uma textura quadrada 4x4 para selecionar vetores pseudoaleat√≥rios em busca de fontes de oclus√£o.  Ele produz um buffer de oclus√£o barulhento, que √© suavizado por um simples borr√£o em duas passagens.  A caracter√≠stica mais interessante aqui √© que existem dois canais de oclus√£o diferentes: um deles √© usado como oclus√£o especular e o outro como oclus√£o difusa.  Nas implementa√ß√µes padr√£o do SSAO, √© calculado um canal que se aplica a toda ilumina√ß√£o cozida.  Aqui, o cart√£o SSAO tamb√©m √© lido para transmiss√£o √† passagem de ilumina√ß√£o direcional, onde √© usado. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/re/xf/kj/rexfkjx49htyufzecfeg2n7lsau.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dl/va/nz/dlvanzzg8bpcqughsrout8kaxlg.png"></div><br><h5>  Cart√µes de sombra </h5><br>  O pr√≥ximo evento √© a renderiza√ß√£o do mapa de sombras.  Como a a√ß√£o do jogo ocorre principalmente em espa√ßos abertos, a maior parte da luz e das sombras √© retirada da luz direcional principal.  Aqui, usamos a t√©cnica de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mapas de sombras em cascata</a> (uma varia√ß√£o dos quais s√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=http://">mapas de sombras divididos em paralelo</a> ), uma t√©cnica bastante padr√£o para aplicar sombras a longas dist√¢ncias, que consiste em renderizar a mesma cena de um ponto de vista da fonte de luz para diferentes √°reas do espa√ßo.  Geralmente, os mapas de sombras distantes da √°rea de cobertura da c√¢mera est√£o a grandes dist√¢ncias ou t√™m resolu√ß√£o menor que os anteriores, reduzindo essencialmente a resolu√ß√£o em √°reas nas quais os detalhes ainda n√£o s√£o necess√°rios devido ao fato de a geometria estar muito distante.  Nesta cena, o jogo renderiza tr√™s cascatas de sombras 4096 √ó 4096 (na verdade, o jogo tem lugar para quatro).  A cascata superior est√° muito pr√≥xima de Talion, e a inferior inclui montanhas e objetos muito distantes da c√¢mera.  Ao trabalhar com sombras, o jogo usa o mesmo truque com a coordenada z inversa que no mapa de profundidade. \ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/347/7bc/a65/3477bca65b8cff92dfcfd68c9d66b8a8.jpg"></div><br><h5>  Buffer de sombra </h5><br>  O pr√≥ximo passo √© criar um buffer de sombra.  Essa √© uma textura de canal √∫nico, baseada nas informa√ß√µes de oclus√£o dos mapas de sombras anteriores, que codifica um fator de sombra no intervalo [0, 1].  Para criar suavidade nas bordas, o mapa de sombras √© amostrado 4 vezes usando o estado de um amostrador bilinear especial, que recebe 4 amostras e as compara com um determinado valor (isso √© chamado de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=http://">Filtragem por fechamento por porcentagem</a> ).  Obter v√°rias amostras e calcular a m√©dia de seus resultados costuma ser chamado de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Porcentagens mais pr√≥ximas de sombras suaves</a> .  Al√©m de ler o mapa de sombras, tamb√©m √© amostrado o √∫ltimo componente do buffer especular (ou seja, o coeficiente de dispers√£o do subsolo), multiplicado pelo ‚Äúfator de sangramento leve‚Äù.  Parece que isso √© necess√°rio para eliminar a sombra desses objetos, para que um pouco mais de luz passe por eles. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b7f/b55/63f/b7fb5563faae1553e0f970374ee0b774.jpg"></div><br><h5>  Textura de proje√ß√£o direcional </h5><br>  Outra fonte de luz e sombra √© uma textura da vista superior amostrada por uma fonte de luz direcional.  Essa √© a convers√£o de cores adicionada √† cor da fonte de luz direcional, mais o efeito do sombreamento global que se aplica √† ilumina√ß√£o direcional.  Parece que alguns deles foram criados manualmente em cima de um mapa de ilumina√ß√£o de n√≠vel gerado automaticamente com uma vista superior.  Parece que as arestas das sombras para geometria est√°tica s√£o ajustadas manualmente (talvez para evitar conflitos com o mapa real de sombras), e algumas partes tamb√©m parecem ser levemente pintadas √† m√£o.  Provavelmente, a tarefa dessa textura √© a adi√ß√£o de baixo custo da oclus√£o ambiental em larga escala e simula√ß√µes leves de ilumina√ß√£o global, al√©m da ilumina√ß√£o direcional.  As imagens abaixo mostram o matiz, a oclus√£o e o produto de ambos os fatores, o que nos d√° uma ideia de como ser√° a m√°scara de cor final. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6v/vf/6a/6vvf6aaf5khdrbclmwpzp9_faka.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7e/fs/fe/7efsferrjbdtsu9megpk0gtfidc.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sd/bk/sv/sdbksv3a4jlkgzxui4nvl-suylq.png"></div><br>  O resultado de todas as passagens de ilumina√ß√£o √© salvo no destino de renderiza√ß√£o do formato R11G11B10F.  Aqui est√° a apar√™ncia do resultado.  Realizei uma corre√ß√£o tonal dos resultados para tornar o efeito da ilumina√ß√£o direcional no n√≠vel mais vis√≠vel. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f2a/28e/a63/f2a28ea6372642667b3778dfc32b193f.jpg"></div><br>  Todas as montanhas distantes (n√£o mostradas na imagem acima) tamb√©m s√£o iluminadas pela luz direcional, mas s√£o destacadas como um caso separado, para que a ilumina√ß√£o possa ser melhor controlada.  Alguns s√£o redimensionados, mas os mais distantes s√£o na verdade impostores com mapas normais e albedo criados de maneira inteligente.  Eles t√™m fontes especiais de ilumina√ß√£o direcional que afetam apenas as montanhas. <br><br><h3>  Ilumina√ß√£o est√°tica </h3><br>  O Shadow of Mordor usa uma implementa√ß√£o muito intensiva de mem√≥ria da ilumina√ß√£o est√°tica, que utiliza texturas de volume muito grandes.  A imagem abaixo mostra tr√™s texturas est√°ticas para a quantidade de ilumina√ß√£o usada para iluminar difusamente parte dessa √°rea.  Cada um deles √© uma textura compactada enorme de 512x512x128 BC6H, ou seja, eles ocupam 32 MB por textura ou 96 MB em geral (tocamos com configura√ß√µes de qualidade m√°xima).  A textura da cor indica a intensidade que entra no voxel.  Os outros dois indicam a for√ßa ou magnitude dessa intensidade ao longo de todas as seis dire√ß√µes xyz e -xyz, e o normal √© usado para selecionar tr√™s componentes (xyz positivo ou negativo, aqueles que s√£o mais consistentes com o normal).  Tendo constru√≠do esse vetor, tomamos seu produto vetorial pelo quadrado do normal, e isso se torna o fator de escala para a intensidade.  A f√≥rmula √© a seguinte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/l9/yw/vk/l9ywvkgxuoti8bbppke_2c8o068.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ez/j3/uf/ezj3ufolhefyqxafjqskci0msho.png"></div><br>  Os volumes de luz est√°tica tamb√©m renderizam um mapa c√∫bico para ilumina√ß√£o especular, que provavelmente √© capturada no centro do SLV.  Curiosamente, as texturas de volume armazenam valores HDR compactados em BC6H e os mapas c√∫bicos s√£o armazenados no formato BC3 (DXT5), que n√£o pode armazenar valores de ponto flutuante.  Para compensar essa limita√ß√£o, o canal alfa ret√©m o brilho, que ent√£o varia de 1 a 10.  Essa √© uma decis√£o um pouco estranha e, para mim, parece mais uma implementa√ß√£o do Legacy.  N√£o esque√ßa que o jogo foi lan√ßado para os consoles da gera√ß√£o anterior, que n√£o suportam os novos formatos de textura HDR. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/k3/qo/z-/k3qoz-zblorjdxi7jyqthripztg.png"></div><br>  Os quadros abaixo mostram os resultados ‚Äúantes e depois‚Äù, levando em considera√ß√£o o impacto da imagem m√©dia.  Para visualiza√ß√£o, realizei a corre√ß√£o tonal. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4i/iq/yo/4iiqyosjg2tmdud840rxbhstofa.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/su/of/cd/suofcd-ls4myfuivd5vqb9ykbgi.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/37/rq/wb/37rqwb76ngards_rywaxhb_x9xw.png"></div><br><h3>  Nevoeiro atmosf√©rico </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9af/086/c47/9af086c474cada9250daae007ec3c8bc.jpg"></div><br>  Shadow of Mordor tem um sistema de tempo e tempo, gra√ßas ao qual o sol brilha ou a chuva flui atrav√©s do jogo em Mordor.  Este sistema √© controlado pela soma dos componentes, e um dos mais importantes √© o nevoeiro.  Shadow of Mordor usa um modelo bastante simples, mas fisicamente s√≥lido, de neblina atmosf√©rica, incluindo espalhamento √∫nico de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Rayleigh</a> , bem como espalhamento por uma part√≠cula esf√©rica (espalhamento de Mie). <br><br>  Come√ßa calculando a posi√ß√£o da c√¢mera em rela√ß√£o ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">centro da terra</a> .  V√°rias f√≥rmulas trigonom√©tricas permitem determinar onde a c√¢mera est√° localizada na atmosfera, onde est√° o pixel e qual a dist√¢ncia que o feixe viaja na atmosfera a uma determinada altura m√°xima da atmosfera.  No nosso caso, a atmosfera √© definida a uma altura de 65.000 metros acima da superf√≠cie do planeta.  Com essas informa√ß√µes em mente, Rayleigh e os coeficientes de part√≠culas esf√©ricos s√£o usados ‚Äã‚Äãpara calcular os tipos de densidades das part√≠culas de nevoeiro e suas cores.  Essas densidades obscurecem os pixels j√° sombreados, espalhando a luz que entra na c√¢mera a partir da superf√≠cie sombreada e contribuindo para o nevoeiro.  Ao simular essa dispers√£o, o brilho e a dire√ß√£o do sol s√£o levados em considera√ß√£o. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ye/at/id/yeatidzdiemga1gntnm1zg9uz8k.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zj/39/zr/zj39zryuhmwdyadmcp0nb_g1uz8.png"></div><br><h3>  Velocidade do obturador e corre√ß√£o de tom </h3><br>  Ao calcular a velocidade do obturador, √© utilizada uma abordagem bastante padr√£o: reduzir sequencialmente a resolu√ß√£o do buffer de brilho, calculado a partir do buffer de cores HDR principal, em uma cadeia de texturas, cada uma com metade do tamanho da textura anterior, come√ßando com uma textura 1/3 do buffer do quadro principal.  Com essa diminui√ß√£o na resolu√ß√£o, s√£o coletadas 4 amostras, com m√©dia dos valores dos pixels vizinhos, ou seja, ap√≥s a convers√£o de todos os valores m√©dios em um √∫nico texel, o resultado final se torna brilho m√©dio.  Depois que a textura atinge o tamanho de 16 √ó 9 texels, um sombreador de computa√ß√£o √© iniciado, resumindo todos os texels restantes.  Este valor √© lido imediatamente no passo de corre√ß√£o de tom para alterar os valores de brilho. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ig/bi/h4/igbih41dc2x9aytucfgq1z_iuye.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/os/gw/t8/osgwt8co0pqgvomovsydsemapuw.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qh/bc/qv/qhbcqvqxy5hgvtn9x0c9kd1an6e.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/g-/dw/fm/g-dwfm48oqtvuu1bizc1sikm7sq.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zg/8w/oz/zg8wozwpviq0nnt4-kef9b9azis.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/56/ik/dc/56ikdcoixmrbo0whghswhxdzxhk.png"></div><br>  Para corre√ß√£o de tom, √© utilizado o operador Reinhardt, cuja f√≥rmula otimizada pode ser encontrada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .  No c√≥digo hlsl, isso ser√° parecido com isto: <br><br><pre><code class="cpp hljs">float3 hdrColor = tex2D(HDRTexture, uv.xy); hdrColor *= exposureValue; <span class="hljs-comment"><span class="hljs-comment">// This was calculated by the compute shader in the luminance downsampling pass float3 x = max(0.0, hdrColor - 0.004); float3 finalColor = (x * (6.2 * x + 0.5)) / (x * (6.2 * x + 1.7) + 0.06);</span></span></code> </pre> <br>  Se tra√ßarmos essa curva, veremos que esse operador descarta 10% dos valores de branco, mesmo com um valor de entrada de 2,0, ao mesmo tempo que deixa for√ßosamente uma pequena parte do intervalo inferior completamente preta.  Isso cria uma imagem escura e desaturada. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cc2/ea1/097/cc2ea10970239fb761b995496c049a8b.jpg" alt="imagem"></div><br><h3>  Alpha Stage </h3><br>  A etapa alfa √© um pouco incomum porque renderiza objetos diretamente no buffer LDR.  Outros jogos tamb√©m os renderizam no buffer HDR para que eles possam participar do passe do obturador.  Seja como for, a textura de brilho calculada anteriormente √© limitada a todos os objetos iluminados por alfa (em alguns casos, por exemplo, para objetos emissores de luz, a velocidade do obturador √© calculada usando as constantes do shader, n√£o a pesquisa de textura) e, portanto, a velocidade do obturador √© aplicada automaticamente ao renderizar, e n√£o realizado no p√≥s-processamento.  Um caso muito espec√≠fico de usar alfa em um jogo √© uma transi√ß√£o para o modo fantasma (nele o fantasma de Celebrimbor √© renderizado em cima do personagem do jogador, forjado nos an√©is soberanos do universo LOTR; assim, o jogo mostra que ele est√° sempre por perto, embora invis√≠vel).  O jogo passa v√°rios par√¢metros para as malhas dos dois personagens, que controlam a opacidade e permitem que o jogo oculte parcialmente Talion e gradualmente mostre o Celebrimore.  Outros objetos no jogo no modo fantasma tamb√©m renderizam vers√µes fantasma em cima de objetos opacos, como inimigos e torres.  Aqui est√° outra cena com a transi√ß√£o para o mundo fantasmag√≥rico. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ux/ca/zs/uxcazsok9pqzuusfrb__dutdphw.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6g/1c/9e/6g1c9esdqit50db_mbck516ma-0.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/f_/dq/ss/f_dqss-avlzlyrb4s6_z6kqog0e.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uw/yy/va/uwyyvakydfnsksy49ntfltpbwp8.png"></div><br><h3>  Chuva </h3><br>  No quadro principal que examinamos, n√£o h√° chuva, mas o clima √© uma parte t√£o importante do jogo que eu gostaria de mencionar aqui.  Ele √© gerado e simulado na GPU e renderizado no final da fase alfa.  √â executado um sombreador de computa√ß√£o que executa a simula√ß√£o e grava as posi√ß√µes no buffer.  Essas posi√ß√µes s√£o ocupadas por outro sombreador, que, com a ajuda de chamadas indiretas instanciadas, processa tantas c√≥pias de quads quanto as posi√ß√µes calculadas no passe anterior.  O sombreador de v√©rtices possui um quad simples, que, se necess√°rio, √© deformado e gira em dire√ß√£o √† c√¢mera.  Para impedir que a chuva penetre nas superf√≠cies, o sombreador de v√©rtice tamb√©m l√™ mapas de altura de uma vista superior, o que permite rejeitar todas as gotas abaixo da superf√≠cie sobreposta.  Esse mapa de altura √© renderizado logo no in√≠cio do quadro.  O mesmo shader de v√©rtice informa ao shader de pixel onde obter a amostra da textura da gota;  se a gota estiver pr√≥xima da superf√≠cie, ela seleciona uma √°rea de textura contendo uma anima√ß√£o de abertura.  Al√©m disso, as gotas de chuva realizam c√°lculos de neblina no sombreador de pixels para combinar perfeitamente com o resto da cena.  Aqui est√° uma captura de tela da mesma perspectiva em um dia chuvoso. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xv/yv/ds/xvyvds_w25ybjxilgvr5crbcpo4.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3c/ox/ax/3coxaxhejifprppkaheiahszfcm.png"></div><br>  Quando o efeito da chuva √© ativado, o buffer especular √© globalmente modificado para criar superf√≠cies molhadas, e as ondas da chuva s√£o renderizadas no buffer normal.  A anima√ß√£o √© cronometrada, portanto, apenas um quadro da anima√ß√£o em loop √© usado.  O buffer normal mostrado abaixo √© modificado para mostrar as ondas renderizadas no buffer. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ur/du/mz/urdumzhuebf1o2pnud_b2ztlfik.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/p3/cv/t_/p3cvt_qq7vo9txgwycf7l2oec2y.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vc/3d/u3/vc3du3ytthqfsw1h7vwzr0tfxom.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6y/tk/rk/6ytkrkj0w38kvccrtrjpey95c_w.png"></div><br><h3>  Alargamentos da lente e flor </h3><br>  Ap√≥s a conclus√£o da renderiza√ß√£o alfa, os reflexos da lente s√£o renderizados sobre ela.  Uma s√©rie de quadr√≠ceps deslocados √© renderizada a partir do ponto em que a luz direcional vem (no nosso caso, o sol).  Imediatamente ap√≥s isso, um passe de bloom √© realizado.  Essa √© uma t√©cnica bastante padr√£o, que consiste em uma s√©rie de tamanho reduzido e texturas borradas contendo pixels cujo brilho excede um determinado limite.  S√£o utilizados dois passes de flora√ß√£o, comuns com o desfoque gaussiano para toda a cena e um desfoque radial especial que se aplica apenas ao c√©u.  O desfoque radial √© uma das opera√ß√µes que usam um ID especial do buffer G de mapas normais, porque apenas os pixels no c√©u s√£o levados em considera√ß√£o.  Como um b√¥nus, esse desfoque ir√° amostrar o mapa de profundidade e pode criar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">raios crepusculares de</a> baixo custo.  Como estamos trabalhando com um buffer LDR nesse est√°gio, o valor do limite de bloom √© diferente do valor do tapete HDR (valores acima do limite, geralmente 1,0, levam ao c√°lculo), e isso significa que o valor do bloom obtido dele √© um pouco limitado.  De qualquer forma, isso √© bom para o jogo e aqui est√£o os resultados.  Nas imagens abaixo, as cores da textura bloom mip parecem um pouco estranhas, pois cada pixel √© dimensionado pelo brilho contido no canal alfa.  Esse brilho foi calculado anteriormente, no est√°gio de corre√ß√£o de tons.  Na composi√ß√£o final, bloom √© calculado como <strong>bloom.rgb ¬∑ bloom.a ¬∑ bloomScale</strong> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/h3/2y/ra/h32yra8lvz_-pxsab9raxyfobei.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/le/2k/dx/le2kdxxuaqtjrdnhdvxfobubyhw.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jb/kz/mk/jbkzmkd2ans3vxvs_we9eowudvs.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xs/gs/dg/xsgsdgnvhckxgckfhs7k4hvpc7u.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/v3/yr/hh/v3yrhhxazolya5nu8fn7id66p6k.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/q8/r1/wl/q8r1wlekxf0tae6ivo6bfyjngie.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gw/5c/tj/gw5ctjh8owpukokne73nskb4n48.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8k/te/sg/8ktesgsr6ser_l6ssaorfcpniww.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/j6/u6/ts/j6u6tsvqcjuwqqzepsfeogf330i.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ee/tf/vg/eetfvgkcuahvbbonuhfnpinh32w.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/m-/zw/bc/m-zwbcp4qvnr69vn1unq1clh3ws.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ei/ta/-s/eita-ssnu2cqzwkspcrjan42-ua.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/db/cb/cs/dbcbcsoo_znq2ex30ixasi-c8le.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i4/ja/ro/i4jarols6px4f0nnbai-rk5r87u.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/na/ag/mj/naagmjq8e75kxcxmyhberqpslag.png"></div><br><h3>  Antialiasing + profundidade de campo </h3><br>  N√£o h√° muito o que dizer sobre essas duas opera√ß√µes; abordagens padr√£o do setor s√£o usadas.  Uma simples passagem pelo antialiasing FXAA √© realizada imediatamente ap√≥s a composi√ß√£o do bloom com a imagem LDR, e a profundidade de campo √© realizada imediatamente ap√≥s.  Para profundidade de campo, o jogo renderiza duas vers√µes borradas diminu√≠das do buffer final.  Em seguida, a profundidade do pixel √© usada para misturar imagens borradas e normais, o que d√° o efeito de desfocar.  Por uma quest√£o de clareza, nessa captura, exagerei o efeito da profundidade de campo.  O jogo possui um modo de captura de tela embutido, permitindo que voc√™ configure facilmente essas condi√ß√µes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ug/et/zf/ugetzfmh2jbbcpvrzb1e6dpwbhu.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/p_/x4/fk/p_x4fkleolfxxnpvs9vnveywipy.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bi/vg/bp/bivgbpqa_nmzkx4zgiuzmu3nm6e.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w2/vn/hg/w2vnhg6eoxe92rjat51qf65pggo.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uf/0g/kj/uf0gkjnripqq4ctkcpsremqrqnk.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bx/k5/z4/bxk5z47piwcgchqepehqpyypwgu.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ue/dc/xq/uedcxqx7svcjyq6g0-tp4uc1gho.png"></div><br><h3>  Desfoque de movimento </h3><br>  O desfoque de movimento consiste em duas passagens.  Primeiro, os dados das orienta√ß√µes anteriores e atuais da c√¢mera s√£o transferidos para o buffer de velocidade de tela cheia.  Nesse caso, dois canais da textura s√£o preenchidos com velocidade no espa√ßo da tela.  Agora, o canal r cont√©m a magnitude da mudan√ßa de pixel na dire√ß√£o horizontal da tela e o canal g cont√©m a magnitude na dire√ß√£o vertical.  √â assim que as faixas radiais s√£o obtidas ao mover a c√¢mera.  O personagem √© renderizado novamente, desta vez preenchendo o canal azul com base em suas poses atuais e anteriores, como √© o caso da c√¢mera.  O canal azul √© usado para marcar se a renderiza√ß√£o deve ou n√£o ser renderizada.  O canal alfa tamb√©m √© preenchido com um valor constante (0,0598), mas eu n√£o investiguei seu valor ou seus objetivos.  A resolu√ß√£o do buffer de velocidade √© reduzida para uma textura muito pequena, calculando a m√©dia de uma faixa relativamente ampla de velocidades na textura original.  Na √∫ltima passagem, isso d√° a cada pixel uma id√©ia aproximada do raio do desfoque em uma passagem de desfoque real. <br><br>  Em seguida, o desfoque l√™ as texturas de velocidade, um mapa de profundidade, o buffer de cores original e a textura do ru√≠do.  O √∫ltimo √© usado para ocultar o efeito de uma imagem espelhada, que pode ocorrer com esse tipo de desfoque com um raio grande.  Em seguida, o buffer de imagem √© amostrado v√°rias vezes na dire√ß√£o indicada pelo buffer de velocidade, as cores s√£o calculadas como m√©dias, o que leva ao desfoque da imagem na dire√ß√£o dos vetores de movimento.  Al√©m disso, esse efeito √© dimensionado de acordo com a taxa de quadros com a qual o jogo funciona.  Para esta captura, tive que limitar o jogo a 30fps, porque a 60fps e acima disso quase n√£o se nota. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zn/4r/-7/zn4r-7rgnvx9zuh6asjnzqxknno.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hr/x_/yu/hrx_yug350grzjbnn6r6d9b7spa.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/94/i5/bc/94i5bcpjozmzuykcwfh9vksqjk8.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/n7/mr/zo/n7mrzoppnprexpqv5h7uj-xobvu.png"></div><br><h3>  Corre√ß√£o de cores </h3><br>  A passagem final da corre√ß√£o de cores √© realizada usando os "cubos de cores".  Um cubo de cores √© uma textura 3D cujos componentes rgb se ajustam √†s coordenadas xyz da textura.  Essas coordenadas xyz cont√™m a cor com a qual precisamos substituir a cor original.  No nosso caso, a tabela de pesquisa (LUT) √© neutra (ou seja, as coordenadas e a cor cont√™m o mesmo valor), ent√£o modifiquei a mesma cena usando as predefini√ß√µes que o jogo fornece no editor de c√¢mera. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/-i/dk/rd/-idkrdltmru5ndotkyzhmdbwth4.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/az/-x/it/az-xitiqseycg8t_mz0kuhjxh1m.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/em/p0/ds/emp0dsyarj3nhdi-s453p0p0rsa.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1e/9q/fa/1e9qfapyuezjdafa8licevb6csu.png"></div><br><h3>  Quadro final </h3><br>  Ap√≥s a cria√ß√£o do quadro principal em um buffer separado, a interface do usu√°rio √© renderizada.  Isso garante que, independentemente do tamanho selecionado para o buffer traseiro, a interface do usu√°rio sempre fique clara e bonita no tamanho da janela nativa, enquanto o jogo poder√° alterar a resolu√ß√£o, se necess√°rio, para garantir a velocidade.  No final, as duas texturas s√£o misturadas com base nos dados do canal alfa da interface do usu√°rio e renderizadas no buffer de quadro final, que est√° pronto para exibi√ß√£o na tela. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cv/ba/t9/cvbat95whbpymp0cfpnjmohp_oo.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i0/y0/qm/i0y0qmb9x6liyqlpcd4vs2rli3y.png"></div><br>  Espero que tenham gostado da minha an√°lise.  Quero agradecer a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener">Adrian Correge</a> pelo incr√≠vel trabalho que me inspirou a estudar os gr√°ficos, bem como a equipe do est√∫dio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Monolith</a> por este jogo verdadeiramente inesquec√≠vel. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt430518/">https://habr.com/ru/post/pt430518/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt430506/index.html">Arte escura da ressurrei√ß√£o: como recuperar dados de m√≠dia danificada</a></li>
<li><a href="../pt430508/index.html">DevOps: o que √© realmente</a></li>
<li><a href="../pt430510/index.html">Como escrever um c√≥digo que todos entender√£o?</a></li>
<li><a href="../pt430512/index.html">Como vivem os freelancers: n√£o trabalhe com clientes oniscientes e permita-se procrastinar</a></li>
<li><a href="../pt430514/index.html">Caridade Blockchain - DataArt vence a Hackathon Summit de Blockchain de Malta</a></li>
<li><a href="../pt430520/index.html">Apresentando o Spring Data MongoDB</a></li>
<li><a href="../pt430522/index.html">Voc√™ precisa de uma cultura corporativa em TI? Confiss√£o do gerente de marca do est√∫dio Krasnodar Plarium</a></li>
<li><a href="../pt430524/index.html">Arquitetura de rede neural</a></li>
<li><a href="../pt430526/index.html">M√°quinas ca√ßa-n√≠queis: de onde eles vieram na URSS e como est√£o organizados</a></li>
<li><a href="../pt430528/index.html">Programando com PyUSB 1.0</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>