<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ•µğŸ¼ ğŸ¦ ğŸ‘‰ğŸ¾ Geschenk Engineering ğŸŒ€ ğŸ‘©ğŸ¿â€ğŸ³ ğŸ‘©ğŸ»â€ğŸ¤â€ğŸ‘¨ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor dem Fenster regnet es, der Dezember steht auf dem Kalender. Die Zeit fÃ¼r Feiertage rÃ¼ckt nÃ¤her und daher die Zeit fÃ¼r Geschenke. Kollege Pavel wÃ¼n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Geschenk Engineering</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480792/"><img src="https://habrastorage.org/webt/md/lw/ph/mdlwpht7vhixr2jkxrftetb8hv4.jpeg"><br><br>  Vor dem Fenster regnet es, der Dezember steht auf dem Kalender.  Die Zeit fÃ¼r Feiertage rÃ¼ckt nÃ¤her und daher die Zeit fÃ¼r Geschenke.  Kollege Pavel wÃ¼nscht sich einen neuen Laptop und Freundin Masha ein Haus am Meer.  Und trotz des wÃ¼rdigen Gehalts des Berufs des Programmierers leben wir nicht in einer Welt der unbegrenzten MÃ¶glichkeiten, was bedeutet, dass ich diesen Menschen nicht genau das geben kann, was sie am meisten wollen (auch wenn Pascha mÃ¶glicherweise mein bester Pawel ist, der Ich weiÃŸ, aber Mascha geht es gut. <br><br>  Hier taucht das Problem der â€billigen Geschenkeâ€œ auf.  Es ist nicht gut, jedem ein teures Geschenk zu machen, aber ich mÃ¶chte nicht noch eine Schachtel Pralinen, eine Kerze oder eine undeutliche Figur geben.  Sie mÃ¼ssen also GeschÃ¤ft mit VergnÃ¼gen verbinden - ich mache Dinge gerne mit meinen eigenen HÃ¤nden, und das Ergebnis ist groÃŸartig als Geschenk.  Dies ist eine Geschichte darÃ¼ber, wie ich wieder einmal vorgab, ein Ingenieur zu sein und verschiedene Geschenke handgefertigt zu haben. <br><a name="habracut"></a><br><h2>  Ein kleiner Exkurs vom Hauptthema </h2><br>  Ich kann nicht sofort zum Hauptthema gehen, also fange ich von weitem an.  Vor einigen Jahren wurde das Spiel â€The Witcher 3â€œ verÃ¶ffentlicht.  Mein Freund riet mir zu spielen, und im Allgemeinen habe ich das Spiel wirklich bewundert.  Dann habe ich entschieden, was zu tun ist, und ihr etwas zum Thema des Spiels gegeben ... Ich werde nicht zu tief in die Beschreibung des Spiels eingehen (Google wird allen helfen) oder sagen, dass mir nicht viele Dinge in den Sinn gekommen sind fÃ¼r die SchlÃ¼sselwÃ¶rter "The Witcher, Engineer, Gift." <br><br>  Die Hauptfigur des Spiels hat ein Pferd namens "Roach" (in russischer Sprache), der Held treibt sie von Zeit zu Zeit mit der Phrase "Move, Roach".  Ich beschloss, ein mechanisches Spielzeug zum Thema â€Kakerlaken rÃ¼hrenâ€œ herzustellen. <br><br>  NatÃ¼rlich wurde das Geschenk als eine vÃ¶llig nutzlose, dumme, aber lustige Sache konzipiert, daher lautete der Plan wie folgt: <br><br><ol><li>  Es gibt eine Box, die den Mechanismus in sich verbirgt. </li><li>  Der Mechanismus ist eine Welle, die sich dreht und die das Pferd bewegt. </li><li>  Die maximale "HartnÃ¤ckigkeit" der Pferdebewegung ist willkommen.  Anfangs dachte man sogar, dass sich das Pferd wie ein Fisch bewegen sollte und nicht wie ein Pferd (immerhin Rotauge), aber das Ergebnis war â€etwas dazwischenâ€œ. </li><li>  All dies wird aus Sperrholz gefertigt, das gemÃ¤ÃŸ den Zeichnungen mit einem Laser prÃ¤zise auf Bestellung zugeschnitten werden kann. </li></ol><br>  Der Hauptnachteil der Materialauswahl und der Tatsache, dass das Zuschneiden auf Bestellung erfolgt, war die Tatsache, dass ich die Gelegenheit zur Erstellung eines Prototyps verpasst habe, was bedeutet, dass sich alle Probleme mit krummen HÃ¤nden und die Nichteinhaltung der Regel des â€Siebenfachen MaÃŸesâ€œ schnell bemerkbar machten: <br><br><img src="https://habrastorage.org/webt/bq/9h/e2/bq9he2doyiixrvhr47zha5frml0.jpeg"><br><br>  Obwohl am Ende die Tatsache, dass viele Details des Spielmechanismus aufgrund zu groÃŸer LÃ¼cken dazu beigetragen haben, die Tatsache zu kompensieren, dass ich die Teile und die Welle ziemlich schief verbunden habe.  Hier, wie sie sagen, "minus minus gibt plus" und der Mechanismus als Ganzes hat funktioniert, wie es beabsichtigt war: <br><br><img src="https://habrastorage.org/webt/cn/x2/gf/cnx2gfjjm2rasl3jtcd3oah-ors.gif"><br><br>  Nachdem es nur ein kleines GemÃ¤lde gab und das Ergebnis so eine Schachtel war: <br><br><img src="https://habrastorage.org/webt/fe/x9/uf/fex9ufxoprduhzobingucsoinm4.jpeg"><br><br>  Dann wird jemand sagen, dass es notwendig war, die Schachtel transparent zu machen, um die Arbeit der Innenseiten beobachten zu kÃ¶nnen, aber tatsÃ¤chlich vermutete ich zunÃ¤chst, dass ich den gesamten Mechanismus und die Schachtel von innen nicht so sauber und ordentlich zusammenbauen konnte, dass es nicht wehtat schau durch die transparenten WÃ¤nde der Kiste.  Daher ist eine lichtundurchlÃ¤ssige Box eine notwendige MaÃŸnahme. <br><br>  Es bleibt nur noch zu packen, einen Bogen auf eine Schachtel zu binden und das Geschenk ist fertig: <br><br><img src="https://habrastorage.org/webt/k9/47/k_/k947k_nkfln04gnb6adkqda9vs4.jpeg"><br><br>  Um das innere Kind nicht zu verÃ¤rgern, das sich in einer Situation wie ein Ingenieur fÃ¼hlen wollte, in der ich tatsÃ¤chlich ein paar SperrholzstÃ¼cke geklebt hatte, beschloss ich, eine â€Zeichnungâ€œ anzufertigen.  Verzeihen Sie mir alle, die etwas in den technischen Zeichnungen verstehen, denn  Ich verstehe, dass dies mehr eine Parodie der Zeichnung als eine echte Zeichnung ist, aber wie es mir schien, hat er einem einfachen Spielzeug einen Mehrwert verliehen: <br><br><img src="https://habrastorage.org/webt/pk/t2/ms/pkt2msf9f2s496bchyrmdi6fs0w.png"><br><br><h2>  Heute habe ich ... </h2><br>  Manchmal spielt das Schicksal mit uns und deutet irgendwie an, dass bald etwas passieren sollte.  Die Geschichte eines meiner GerÃ¤te beginnt genauso.  Ich bestellte eine kleine Elektronik im Wert von ungefÃ¤hr 5 USD, die wie Ã¼blich einen Monat unterwegs war. Danach erhielt ich eine SMS, dass das Paket bei der Ã¶rtlichen Post auf mich wartete.  Die Schachtel erwies sich als viel grÃ¶ÃŸer als erwartet und lieÃŸ sofort Zweifel am Inhalt aufkommen.  Zweifel wurden bestÃ¤tigt - im Inneren befand sich neben den Kleinigkeiten, die ich bestellt hatte, auch ein dreifarbiges E-Ink-Display mit einer Diagonale von 4,2 Zoll.  Ich habe den VerkÃ¤ufer kontaktiert, er hat bestÃ¤tigt, dass er beim Packen etwas durcheinander gebracht hat, sagte aber, dass ich dies als Geschenk betrachten und es verwenden kann, wie ich es fÃ¼r richtig halte. <br><br>  Das Schicksal wies mich darauf hin, dass es an der Zeit ist, ein neues Projekt zu starten, und dieses Projekt wird etwas mit einem E-Ink-Display sein.  Nachdem ich mich kurz mit den technischen Daten des GerÃ¤ts vertraut gemacht und das Display an die Steuerung angeschlossen hatte, stellte ich sicher, dass die technischen Daten nicht Ã¼ber die Aktualisierungszeit lagen.  Der Bildschirm wurde fÃ¼r mehr als 10 Sekunden aktualisiert, blinkte und versuchte, einen epileptischen Anfall zu verursachen: <br><br><img src="https://habrastorage.org/webt/ni/w1/h5/niw1h5wpnfczyud_2593yvxq-mg.gif"><br>  (Ich habe keine frÃ¼hen Fotos zum AnschlieÃŸen des Displays, daher hat das GerÃ¤t hier bereits ein aussagekrÃ¤ftigeres Aussehen.) <br><br>  Es wurde klar, dass Sie ein einfaches GerÃ¤t benÃ¶tigen, das keine komplexen Animationen (und Animationen im Allgemeinen) erfordert.  Und dann bin ich auf einen Stimmungskalender gestoÃŸen: <br><img src="https://habrastorage.org/webt/zm/a0/dg/zma0dglgpkea9lkxbnqlndawc-o.jpeg"><br><br>  Der Stimmungskalender besteht aus einfachen Bildern und ironischen Signaturen.  Ich habe beschlossen, einen Kalender mit dem Namen "Today I" zu erstellen (der eigentlich Ã¼berhaupt kein Kalender ist). Es wird ein einfaches GerÃ¤t sein, das jeden Tag ein Bild anzeigt, das den heutigen "Geisteszustand" charakterisiert, und eine Beschreibung davon.  ZusÃ¤tzlich kÃ¶nnte der Kalender einige andere Funktionen haben, aber der Hauptkalender wÃ¤re genau der "Kalender" - ein eigenes Bild fÃ¼r jeden Tag. <br><br>  Das elektronische Papiermodul erlaubte die Anzeige von drei Farben (schwarz, rot und weiÃŸ), die wie zwei Bilder - schwarz und weiÃŸ und rot und weiÃŸ - auf das Modul Ã¼bertragen werden sollten.  TatsÃ¤chlich wÃ¤re es richtiger zu sagen, dass der Bildschirm einfach eine monochrome Bitmap erwartet, bei der jedes Bit die Farbe eines Pixels bestimmt (ich bin mir nicht sicher, ob dieser Begriff auf elektronisches Papier anwendbar ist, aber ich hoffe, dass die Idee klar ist).  FÃ¼r den schwarzen oder roten Kanal kann eine separate Bitmap festgelegt werden.  Somit gibt es eine Menge von Bytes, bei denen jedes Bit, das auf 1 gesetzt ist, einem Farbpixel entspricht, und alle Bits, die 0 bleiben, sind weiÃŸe Pixel auf dem Bildschirm.  Die BildschirmauflÃ¶sung betrÃ¤gt 400 x 300 Pixel, d.h.  FÃ¼r ein SchwarzweiÃŸbild sind 15.000 Byte erforderlich (8 Pixel werden in einem Byte codiert).  FÃ¼r die drei Farben werden 30.000 Byte benÃ¶tigt, wenn Sie nicht versuchen, das Bild kompakter zu packen.  Unter dem Gesichtspunkt der Implementierung kÃ¶nnten die Ersteller des Displays einfach zwei Bits pro Pixel auswÃ¤hlen und den tatsÃ¤chlichen Zustand der Dinge (wo rot ist, wo schwarz ist und wo weiÃŸ ist) speichern, aber dies wÃ¼rde dieselben 30.000 Bytes erfordern, aber selbst fÃ¼r monochrome Bilder wÃ¼rde die Ãœbertragung von 30.000 Bytes erfordern. <br><br>  Wie in jedem meiner anderen â€Handwerkeâ€œ begann ich, Aufgaben fÃ¼r mich selbst zu erfinden, damit sich nicht alles in â€Verkabelung einstecken und Bibliothek herunterladenâ€œ verwandelte.  Selbst wenn wir die MÃ¶glichkeit in Betracht ziehen, eine Art Bildkomprimierungsalgorithmus auf der Controllerseite zu implementieren, wurde klar, dass der Controller ohne externen Speicher fÃ¼r Bilddateien sehr deprimiert wÃ¤re.  Es wurde beschlossen, eine SD-Karte zu nehmen und einen einfachen Code-Wrapper fÃ¼r die Arbeit mit FAT32 zu schreiben.  NatÃ¼rlich wÃ¤re es mÃ¶glich, auf ein Dateisystem zu verzichten und Daten direkt auf eine Speicherkarte zu schreiben, aber es schien mir weniger praktisch, neue Dateien hinzuzufÃ¼gen, und es war fÃ¼r mich interessant, die grundlegenden VorgÃ¤nge fÃ¼r die Arbeit mit FAT32 mit meinen eigenen HÃ¤nden zu implementieren. <br><br>  Es ist wichtig klarzustellen, dass ich es gewohnt bin, Dinge selbst zu schreiben (Sie sollten mir nicht sagen, dass es ein Meer von Bibliotheken gibt, ich weiÃŸ darÃ¼ber Bescheid und mit Google), wenn ich solche Dinge mache, aber seitdem  Vorher hatte ich nicht das VergnÃ¼gen, mit FAT32 auf einem niedrigen Niveau zu arbeiten, es war ein ziemlich unterhaltsamer Prozess. <br><br>  Ich werde nicht nÃ¤her auf die Arbeit mit FAT32 und der SD-Karte als Ganzes eingehen  Das Internet ist voll von Artikeln zu diesem Thema (und ich mÃ¶chte meine Geschichte nicht in eine NacherzÃ¤hlung von Spezifikationen verwandeln), aber ich werde Ã¼ber einige Dinge sprechen, die implementiert werden mussten.  Es ist notwendig, nicht nur die Funktionen zum Lesen aus einer Datei und zum Schreiben in eine Datei zu implementieren (ich habe beschlossen, einige Einstellungen und ZustÃ¤nde auf derselben SD-Karte und nicht im EEPROM zu speichern), sondern auch die Funktionen zum Suchen nach einer Datei im Dateisystem, wenn Sie arbeiten mÃ¼ssen auf die Ã¼bliche Weise. <br><br>  Alle Daten auf der Speicherkarte sind in Cluster unterteilt (die wichtigste adressierbare Einheit im FAT32-Dateisystem), und die Cluster sind bereits in Sektoren unterteilt.  Um die Datei â€habr.txtâ€œ von der SD-Karte in FAT32 zu lesen, benÃ¶tigen Sie: <br><br><ol><li>  Initialisieren Sie die Speicherkarte. </li><li>  Lesen Sie den Sektor an der Nulladresse und Ã¼berprÃ¼fen Sie, ob das FAT32-Dateisystem einen bestimmten Header hat (Sie kÃ¶nnen diesen Schritt Ã¼berspringen, wenn wir an GlÃ¼ck glauben). </li><li>  Lesen Sie den Sektor bei Adresse Null und erhalten Sie "Logical Block Addressing" (LBA). </li><li>  Lesen Sie den Sektor an der empfangenen Adresse (LBA) und rufen Sie die erforderlichen Daten ab (welcher Cluster ist das Stammverzeichnis, wie viele Sektoren befinden sich im Cluster usw.). </li><li>  Lesen Sie den Cluster "Root Directory" (tatsÃ¤chlich erfolgt das Lesen nach Sektoren, Sie mÃ¼ssen nur so viele Sektoren lesen, wie Sektoren im Cluster vorhanden sind) nach seiner Nummer.  Es hat eine eigene Formel zum Konvertieren von Cluster-Seriennummern in physikalische Adressen.  Dateiinformationen werden hier gespeichert, sodass wir die Daten auf der Suche nach der gewÃ¼nschten Datei lesen.  Bei Dateinamen gibt es noch eine Kleinigkeit: Der Name kann kurz oder lang sein, abhÃ¤ngig davon werden die Daten entweder an einem Ort (in der gleichen Struktur) oder in einem zusÃ¤tzlichen Datensatz gespeichert, der auch separat gelesen werden muss.  Wenn eine Datei mit dem gewÃ¼nschten Namen gefunden wird, erhalten wir den Cluster, in dem sich der Anfang befindet (oder mÃ¶glicherweise die gesamte Datei, wenn sie in die ClustergrÃ¶ÃŸe passt), sowie die DateigrÃ¶ÃŸe.  Wird die Datei in diesem Cluster nicht gefunden, suchen wir nach dem nÃ¤chsten Cluster und wiederholen den Dateisuchvorgang. </li><li>  Lesen Sie den Cluster an der gefundenen Adresse.  Lesen Sie die Cluster weiter und suchen Sie nach dem nÃ¤chsten Cluster, bis alle Daten gelesen wurden. </li></ol><br>  Es scheint mir, dass es einfacher ist, das Prinzip des Dateisystems denen zu erklÃ¤ren, die verknÃ¼pfte Listen mindestens einmal implementiert haben, weil  TatsÃ¤chlich besteht das FAT32-Dateisystem aus einer Reihe von DatenblÃ¶cken und einer Art Tabelle, in der angegeben ist, wo nach dem nÃ¤chsten Datenblock gesucht werden soll.  Das Lesen von Daten aus FAT32 ist ein Prozess, bei dem wir die Daten lesen, nach der Adresse des nÃ¤chsten Blocks suchen, die Daten lesen, nach der Adresse des nÃ¤chsten Blocks suchen usw. <br><br>  Ich habe nicht alle mÃ¶glichen Szenarien implementiert und einige Dinge vereinfacht: <br><br><ul><li>  Alle Dateien befinden sich im Stammverzeichnis der Speicherkarte, und das Durchsuchen von Verzeichnissen wird nicht verwendet. </li><li>  Alle Dateien haben Kurznamen. </li><li>  Die Steuerung liest beim Start eine Liste von Dateien und speichert sie im Speicher, um nicht erneut nach jeder Datei zu suchen. </li><li>  Die maximale Anzahl von Dateien ist durch eine Konstante begrenzt (und tatsÃ¤chlich habe ich nur ein paar Dutzend Bilder gezeichnet). </li></ul><br>  Kurz gesagt, all das ist ein Ã¼berzeugender Grund, eine fertige Bibliothek zu nehmen und nicht viel Zeit mit dem Lesen, Entwickeln und Debuggen von Dokumentationen zu verbringen.  Ich wÃ¼rde mir raten, solche Dinge nur fÃ¼r pÃ¤dagogische Zwecke oder "zum SpaÃŸ" zu implementieren. <br><br>  Das Display hat auch einige EinschrÃ¤nkungen auferlegt, wie  Jedes Bild darauf wird folgendermaÃŸen angezeigt: <br><br><ol><li>  Wir wachen auf und initialisieren das Display (um dessen Lebensdauer zu verlÃ¤ngern und Energie zu sparen, schlÃ¤ft das Display grundsÃ¤tzlich). </li><li>  Wir belichten den notwendigen Kanal (zum Beispiel schwarz). </li><li>  Wir leiten 15000 Bytes des Bildes weiter. </li><li>  Wir belichten den notwendigen Kanal (zum Beispiel rot). </li><li>  Wir leiten 15000 Bytes des Bildes weiter. </li><li>  Wir weisen das Display an, Daten aus dem Puffer zu ziehen. </li><li>  Wir warten, bis die Anzeige fertig ist. </li><li>  Wir sagen dem Display, dass es schlafen soll. </li></ol><br>  Bei SchwarzweiÃŸbildern kÃ¶nnen Sie die Schritte 4 und 5 Ã¼berspringen. Bei einem Dreifarbenbild ist die Ãœbertragungsreihenfolge von SchwarzweiÃŸ- und RotweiÃŸbildern nicht wichtig, da  Rot wird immer Ã¼ber Schwarz gemalt, Schwarz ist nur Ã¼ber WeiÃŸ, und nur die weiÃŸen Pixel sind weiÃŸ und schwarz und weiÃŸ und rot und weiÃŸ. <br><br>  Der Einfachheit halber (um die Gesamtzahl der Dateien nicht zu erhÃ¶hen) habe ich beschlossen, die SchwarzweiÃŸ- und RotweiÃŸbilder als einzelne Datei zu speichern, auf die das SchwarzweiÃŸbild unmittelbar das RotweiÃŸbild folgt: <br><br><img src="https://habrastorage.org/webt/qo/p-/4j/qop-4jlidhtf82tthoxxspebl2o.png"><br><br>  Das Ergebnis des Vergleichs dieser Bilder war ungefÃ¤hr so â€‹â€‹(es scheint mir, dass sich jeder von uns mindestens einmal in seinem Leben wie ein Reh mit HÃ¶rnern anfÃ¼hlte - ein Bein): <br><br><img src="https://habrastorage.org/webt/7o/tb/cs/7otbcsv6yqjrqivfjutep87b1am.png"><br><br>  TatsÃ¤chlich folgte auf die beiden Bilder ein weiteres Bild, das eine Beschreibung des Zustands enthielt (durch Klicken auf die SchaltflÃ¤che erhalten Sie eine Beschreibung, die mit dem heute angezeigten Bild Ã¼bereinstimmt). <br><br>  Aufgrund des begrenzten Speichers der Steuerung werden Daten von der Speicherkarte niemals vollstÃ¤ndig in den Speicher der Steuerung eingelesen.  Das Bild von der Speicherkarte wird in Fragmenten gelesen, die von der GrÃ¶ÃŸe des Sektors bestimmt werden (der Einfachheit halber nehmen wir an, dass diese GrÃ¶ÃŸe immer statisch ist und sich nicht von Karte zu Karte Ã¤ndern kann) und in den Prozess der Datenverarbeitung von der Karte fallen.  In meiner Implementierung werden beim Lesen einer Datei die Clusternummer, die DateigrÃ¶ÃŸe und der RÃ¼ckruf fÃ¼r jeden gelesenen Sektor als Eingabe verwendet.  Dieser Ansatz ermÃ¶glichte es uns, verschiedene Funktionen der Dateiverarbeitung zum Lesen und Anzeigen des Bildes selbst oder seiner Beschreibung zu verwenden. <br><br>  Die folgende Logik ist auf die RÃ¼ckruffunktion beim Lesen von Bildern von einer Speicherkarte zurÃ¼ckzufÃ¼hren: <br><br><ol><li>  Stellen Sie den gewÃ¼nschten Kanal ein (der Kanal wird zufÃ¤llig bestimmt), bevor Sie Daten an das Display senden. </li><li>  Verfolgen Sie die Ã¼bertragenen Daten, um den Kanal zu wechseln, wenn das Senden der Daten fÃ¼r den vorherigen Kanal abgeschlossen ist. </li><li>  Senden Sie die von der Karte empfangenen Daten. </li><li>  Stellen Sie fest, dass die erforderlichen Daten Ã¼bertragen wurden und dass der Rest der Daten (Bild mit Beschreibung) ignoriert werden kann. </li></ol><br>  Die Tatsache, dass ich Bilder eingegeben habe, die mehr Daten enthielten, als auf dem Bildschirm angezeigt werden sollten, hat mich erschwert.  Das heiÃŸt  Es gibt ein Bild, das der Hintergrund ist und immer statisch ist und der GrÃ¶ÃŸe des Bildschirms entspricht, und es gibt ein viel grÃ¶ÃŸeres Bild, von dem Sie einen zufÃ¤lligen Bereich (die GrÃ¶ÃŸe des Bildschirms) und die Anzeige aufnehmen mÃ¼ssen. <br><br>  Ein solches Bild stellte zusÃ¤tzliche Anforderungen an den Handler - es musste berechnet werden, wie viele Bytes von der aktuellen Zeile des Bildschirms Ã¼bertragen wurden, wie viele weitere beim nÃ¤chsten Aufruf hinzugefÃ¼gt werden mussten (wenn die Zeile an den Rand der SektorgrÃ¶ÃŸe fiel) und wie viele Ã¼bersprungen werden sollten. <br><br>  Visuell kann diese Situation wie folgt dargestellt werden: <br><br><img src="https://habrastorage.org/webt/22/iy/sr/22iysrbf7x-8n4ptpq4mtbq6kjc.png"><br><br>  Es gibt einen bestimmten Puffer, in dem sich ein "Fenster" der erforderlichen GrÃ¶ÃŸe befindet (grÃ¼ner Bereich), und Sie mÃ¼ssen nur die Daten aus diesem Fenster lesen und die Daten aus dem Puffer in Fragmenten von N Bytes lesen.  Es wÃ¤re mÃ¶glich, einen solchen Lesevorgang so zu visualisieren: <br><br><img src="https://habrastorage.org/webt/cp/me/qo/cpmeqoznzfnhkflphfxdhscxhq0.gif"><br><br>  Im Allgemeinen hat es sich als nicht so einfach herausgestellt, die Logik der Arbeit mit dem Bildschirm zu einer Funktion hinzuzufÃ¼gen, die immer einen 512-Byte-Puffer erhÃ¤lt und die bestimmen sollte, welches dieser 512 Byte benÃ¶tigt wird (wenn Ã¼berhaupt etwas benÃ¶tigt wird) "Auf der Stirn".  Genauer gesagt war die Aufgabe im Vergleich zu alltÃ¤glichen LÃ¶sungen weniger kompliziert als ungewÃ¶hnlich, weshalb es Ã¼berraschenderweise sehr interessant war, sie zu lÃ¶sen.  FÃ¼r mich war es wie eine â€Olympiadenaufgabeâ€œ, bei der die Menge an Strom berechnet werden musste, die zum Kontrahieren der Muskeln benÃ¶tigt wird, um mit zwei LÃ¶ffeln (je einem LÃ¶ffel in jeder Hand) Wasser von einem Eimer in einen anderen zu Ã¼bertragen. <br><br>  Um die Schwierigkeit besser zu verstehen, fÃ¼ge ich hier eine weitere Animation hinzu, die sich nur auf den Inhalt des Clusters und nicht auf die gesamte Datei bezieht (alle anderen Informationen mÃ¼ssen separat gespeichert werden): <br><br><img src="https://habrastorage.org/webt/ba/vk/zg/bavkzgmfovjycovxj1uasy7kwae.gif"><br><br>  Wie geplant sollte der Kalender jeden Tag ein neues Bild anzeigen, d. H.  es muss in der Lage sein, die Zeit zu Ã¼berwachen (auch wenn es ausgeschaltet ist), was bedeutet, dass auch ein Echtzeituhrmodul (RTC) benÃ¶tigt wird.  Und trotz der Tatsache, dass mein Controller eine eingebaute Echtzeituhr hat, ist es fast unmÃ¶glich, eine Batterie dafÃ¼r zu finden, weil  Kontakte sind nicht mit der Platine verbunden.  Ich beschloss, die Beine des Controllers nicht zu vergewaltigen, um sie anzulÃ¶ten, und nahm die externe chinesische RTC.  Die Arbeit mit RTC sollte ganz einfach sein: <br><br><ul><li>  Wenn eingeschaltet, erhalte die Zeit von der chinesischen RTC. </li><li>  Uhrzeit in interner RTC einstellen. </li><li>  Verwenden Sie die interne Echtzeituhr, um die Zeit zu zÃ¤hlen und die Chinesen bis zum nÃ¤chsten Herunterfahren zu vergessen. </li></ul><br>  Aber hier stellte sich heraus, dass alles nicht so einfach war, da die interne RTC des Controllers mit der Zeit im Ã¼blichen Format (UNIX-Zeitstempel) arbeitet und sein chinesischer Freund Binary Coded Decimal (BCD) verwendet.  Zuvor bin ich nicht auf dieses Format gestoÃŸen und war sehr Ã¼berrascht, dass es auch von modernen Modulen fÃ¼r Arduino verwendet wird.  Die Essenz des Formats ist recht einfach - es gibt ein Byte, in dem beispielsweise die Anzahl der Sekunden gespeichert wird.  Die vier hÃ¶herwertigen Bits speichern zehn und die vier niederwertigen Bits speichern Einheiten.  Es stellt sich heraus, dass die hexadezimale Darstellung dieses Bytes selbst eine lesbare Zeit enthÃ¤lt - Byte 0x49 entspricht einem Wert von 49 Sekunden (obwohl dieses Byte im Dezimalsystem 72 entspricht). <br><br>  So wie ich es verstehe, passierte es so historisch, dass es einfacher war, RTC direkt mit Bildschirmcodierern zu verwenden, um eine Uhr zu erstellen, aber ich musste BDC mit Stiften in UNIX-Zeitstempel konvertieren. <br><br>  ZusÃ¤tzlich zu der Anzeige, dem Echtzeituhrmodul, der Speicherkarte und dem Dateisystem war es notwendig, alle diese DrÃ¼sen in einem GehÃ¤use zu verpacken, das ebenfalls hergestellt werden musste, d. H.  "Zeichnen".  Sie kÃ¶nnen ausfÃ¼hrlicher Ã¼ber all die Schmerzen lesen, die mir in meiner letzten VerÃ¶ffentlichung begegnet sind. Hier war alles genau das gleiche: <br><br><img src="https://habrastorage.org/webt/f_/6i/jh/f_6ijh7_nag2fpzyjwzkdkapips.jpeg"><br>  (Ich hatte keine Massenproduktion geplant, alle Details sind das Ergebnis falscher Messungen oder schlecht durchdachter LÃ¶sungen.) <br><br>  Als Ergebnis wurden der Fall und die notwendigen Details gezeichnet (es gibt keine vordere Abdeckung im Bild): <br><br><img src="https://habrastorage.org/webt/pg/k9/w-/pgk9w-ajyangtju3ianmi1dm9jo.jpeg"><br><br>          (,   - -     ): <br><br><img src="https://habrastorage.org/webt/lp/c_/i8/lpc_i8kkwazohmmz2ujiynl2lea.jpeg"><br><br>   (     )    : <br><br><img src="https://habrastorage.org/webt/ah/yq/un/ahyqun2x2cwbvpn2hk5o59dupbw.jpeg"><br><br>     .      ,    . <br><br>       (    ): <br><br><img src="https://habrastorage.org/webt/tv/kh/pz/tvkhpznwutzclmhqaf_0q1abk_a.jpeg"><br><br>      ,       â€” : <br><br><img src="https://habrastorage.org/webt/cw/s0/y9/cws0y9bk4nre9kwyjwjar2cvsui.jpeg"><br><br>    ,    ,       : <br><br><img src="https://habrastorage.org/webt/ec/dj/d6/ecdjd6m9-d85udrkqee-vphi1qe.jpeg"><br><br><h2>       ! </h2><br>   -,      : â€œ    ?!      100500   ,    !â€.       ,  ,              â€”              (        - ),     ,       ,        ,   . <br><br> ,      ,     ,      . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jetzt ist es allgemein in Mode, Dinge auf einem 3D-Drucker zu drucken. </font><font style="vertical-align: inherit;">DruckgerÃ¤te sind viel zugÃ¤nglicher geworden, und die Software zum Erstellen von Modellen ist fÃ¼r Kinder einfach genug, um verstanden zu werden.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hilfeschrei </font></font></h2><br>        ,    ,      -   .   ,    ,         ,         , ,  -  . <br><br> ,   ,                    .      â€œ--â€,     â€œMP3 Music Player Module for Arduinoâ€,   Arduino Nano,  ,   mp3    . <br><br> ,   ,         , ,   ,   ,         / ,      .   â€œâ€  ,      . <br><br>      3 ,               .      : <br><br><ol><li>    ,     . </li><li>  â€œâ€      (, , ,  ). </li></ol><br>     (        ): <br><br><img src="https://habrastorage.org/webt/r7/nz/9_/r7nz9_z7qibv9mqtowdvp038dki.jpeg"><br><br>   ,      , ..   ,               ( : playSound(rand() &amp; 3);). <br><br>          .     â€œâ€ (   ,    ),    USB        ,  â€œ  â€: <br><br><img src="https://habrastorage.org/webt/ec/xg/ts/ecxgtsytg7czrd89196s2bwm8de.jpeg"><br><br><h2>  ? </h2><br>    ,    ,    .    3      : <br><br><img src="https://habrastorage.org/webt/kg/zz/jv/kgzzjvkhncuwiektwjpkjqciv54.jpeg"><br><br>     â€” .      ,     : <br><br><img src="https://habrastorage.org/webt/ce/vm/k5/cevmk5j74alm2qbuzodzsk5uplc.jpeg"><br><br><h2>  ! </h2><br> ,   : <br><br><ol><li>        . </li><li>    3  2 ,     ~0.4. </li><li>     â€” . </li><li> 3  (     ). </li><li>  . </li></ol><br>    â€¦  : <br><br><img src="https://habrastorage.org/webt/l6/z_/uv/l6z_uvppvank9lg9tnt00clmeeq.png"><br><br>   : <br><br><img src="https://habrastorage.org/webt/aa/xi/yd/aaxiydolfoszxdnh8duxmhk3io0.jpeg"><br><br>            â€œâ€: <br><br><img src="https://habrastorage.org/webt/ux/up/w9/uxupw9tma7hqfuhatlg6n2loies.jpeg"><br><br><h2>     ? </h2><br> â€œ      -   ,   -  .â€        ,    ,   -.       â€œâ€,        ,  ,         FAT32,      BCD ,    RTC. <br><br> , -    (   )  : â€œ ,     ,     !â€      - . <br><br>   ,   .   ,     .     ,     ,    __! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de480792/">https://habr.com/ru/post/de480792/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de480780/index.html">Wie man eine Illustration aus WÃ¼rfeln und Piktogrammen zusammensetzt</a></li>
<li><a href="../de480782/index.html">5 Dinge, die ich gerne wissen wÃ¼rde, als ich mit Angular anfing</a></li>
<li><a href="../de480786/index.html">UnabhÃ¤ngiges Klonen von Objekten in JavaScript</a></li>
<li><a href="../de480788/index.html">Weihnachtsbaum auf der Kommandozeile</a></li>
<li><a href="../de480790/index.html">"Werkseffizienz". Suche nach einem Engpass und Implementierung eines Pull-Systems zur Steigerung der ProduktivitÃ¤t</a></li>
<li><a href="../de480794/index.html">Ein wenig Ã¼ber den Spezialfall der Implementierung von Suchalgorithmen fÃ¼r offene TÃ¼ren</a></li>
<li><a href="../de480796/index.html">SchrÃ¶dinger Programmierer, Entwickler und Katzen</a></li>
<li><a href="../de480798/index.html">C ++ Russia Piter 2019 berichtet RÃ¼ckblick</a></li>
<li><a href="../de480800/index.html">Auf der Suche nach einem Jobtester? Machen Sie sich bereit, um EntwicklerfÃ¤higkeiten zu demonstrieren</a></li>
<li><a href="../de480802/index.html">Chaos Engineering, Teil 3: Methoden und Werkzeuge</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>