<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯУ╡ уА╜я╕П тЬМЁЯП╗ рдЕрд╡рд░реБрджреНрдз рдХрд░рдиреЗ рдкрд░ рдирд┐рд▓рдВрдмрди ЁЯЧ╗ ЁЯЪЙ ЁЯМД</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдЗрд╕ рд▓реЗрдЦ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдпрд╣ рджрд┐рдЦрд╛рдирд╛ рд╣реИ рдХрд┐ рдХреЛрдЯрд▓рд┐рди рдХреЙрд░рдЯрд╛рдЗрдиреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░реЗрдВ рдФрд░ рд░рд┐рдПрдХреНрд╕реЗрдЯрд┐рд╡ рдПрдХреНрд╕рдПрдХреНрд╕рдЯреЗрдВрд╢рди (рдЖрд░рдПрдХреНрд╕) рдХреЛ рд╣рдЯрд╛ рджреЗрдВред 
 рд▓рд╛рдн 


 рдЖрд░рдПрдХреНрд╕ рдкрд░ рдХреЛрд░рд╛рдЯрд╛рдЗрди рдХ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдЕрд╡рд░реБрджреНрдз рдХрд░рдиреЗ рдкрд░ рдирд┐рд▓рдВрдмрди</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465529/"><p>  рдЗрд╕ рд▓реЗрдЦ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдпрд╣ рджрд┐рдЦрд╛рдирд╛ рд╣реИ рдХрд┐ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреЛрдЯрд▓рд┐рди рдХреЙрд░рдЯрд╛рдЗрдиреНрд╕</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░реЗрдВ рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд░рд┐рдПрдХреНрд╕реЗрдЯрд┐рд╡ рдПрдХреНрд╕рдПрдХреНрд╕рдЯреЗрдВрд╢рди (рдЖрд░рдПрдХреНрд╕) рдХреЛ</a> рд╣рдЯрд╛ рджреЗрдВред </p><br><h2 id="benefits">  рд▓рд╛рдн </h2><br><p>  рдЖрд░рдПрдХреНрд╕ рдкрд░ рдХреЛрд░рд╛рдЯрд╛рдЗрди рдХреЗ рдЪрд╛рд░ рд▓рд╛рднреЛрдВ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП: </p><br><h3 id="suspending-over-blocking">  рдЕрд╡рд░реБрджреНрдз рдХрд░рдиреЗ рдкрд░ рдирд┐рд▓рдВрдмрди </h3><br><p>  Rx рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЧреИрд░-рдЕрд╡рд░реЛрдзрдХ рдХреЛрдб рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рд╕реЗ рд▓рд┐рдЦреЗрдВрдЧреЗ: </p><br><pre><code class="kotlin hljs">Observable.interval(<span class="hljs-number"><span class="hljs-number">1</span></span>, TimeUnit.SECONDS) .subscribe { textView.text = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$it</span></span></span><span class="hljs-string"> seconds have passed"</span></span> }</code> </pre> <br><p>  рдЬреЛ рдкреНрд░рднрд╛рд╡реА рд░реВрдк рд╕реЗ рдПрдХ рдирдпрд╛ рд╕реВрддреНрд░ рдмрдирд╛ рд░рд╣рд╛ рд╣реИред  рдереНрд░реЗрдб рд╕реНрдореГрддрд┐ рдФрд░ рдкреНрд░рджрд░реНрд╢рди рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рднрд╛рд░реА рд╡рд╕реНрддреБрдПрдВ рд╣реИрдВред </p><br><p>  рджреЛрдиреЛрдВ рдореЛрдмрд╛рдЗрд▓ рд╡рд┐рдХрд╛рд╕ рдХреА рджреБрдирд┐рдпрд╛ рдореЗрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИрдВред </p><br><p>  рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдирд┐рдкреЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдорд╛рди рд╡реНрдпрд╡рд╣рд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="kotlin hljs">launch { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>){ textView.text = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${it++}</span></span></span><span class="hljs-string"> seconds have passed"</span></span> delay(<span class="hljs-number"><span class="hljs-number">1000</span></span>) } }</code> </pre> <br><p>  рдореВрд▓ рд░реВрдк рд╕реЗ, рдХреЛрд░рдЖрдЙрдЯреНрд╕ рд╣рд▓реНрдХреЗ рд╡рдЬрди рдХреЗ рдзрд╛рдЧреЗ рд╣реЛрддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рд╣рдо рдХреЛрдИ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдзрд╛рдЧрд╛ рдирд╣реАрдВ рдмрдирд╛рддреЗ рд╣реИрдВред <br>  рдпрд╣рд╛рдВ рд╣рдо рдиреЙрди-рдмреНрд▓реЙрдХрд┐рдВрдЧ рджреЗрд░реА () рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдЬреЛ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдирд┐рд▓рдВрдмрд┐рдд рдлрд╝рдВрдХреНрд╢рди рд╣реИ рдЬреЛ рдПрдХ рдереНрд░реЗрдб рдХреЛ рдмреНрд▓реЙрдХ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ рд▓реЗрдХрд┐рди рдХреЛрд░рдЖрдЙрдЯ рдХреЛ рдирд┐рд▓рдВрдмрд┐рдд рдХрд░рддрд╛ рд╣реИред <a name="habracut"></a></p><br><h3 id="natural-backpressure-handling-over-manual">  рдореИрдиреБрдЕрд▓ рдкрд░ рдкреНрд░рд╛рдХреГрддрд┐рдХ рдмреИрдХрдкреЗрдЪрд░ рд╣реИрдВрдбрд▓рд┐рдВрдЧ </h3><br><p>  Backpressure рддрдм рд╣реЛрддрд╛ рд╣реИ рдЬрдм рд╡реЗрдзрд╢рд╛рд▓рд╛рдПрдВ рдЙрди рд╡рд╕реНрддреБрдУрдВ рдХрд╛ рдЕрдзрд┐рдХ рддреЗрдЬреА рд╕реЗ рдЙрддреНрдкрд╛рджрди рдХрд░рддреА рд╣реИрдВ рдЬреЛ рдЙрдирдХреЗ рдкрд░реНрдпрд╡реЗрдХреНрд╖рдХ рдЙрдирдХрд╛ рдЙрдкрднреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред <br>  рдЖрд░рдПрдХреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп рдЖрдкрдХреЛ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдЖрдк рдмреИрдХрд╕реНрдкреЗрд╕ рдХреЗ рд╕рд╛рде рдХреИрд╕реЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд░реЗрдВрдЧреЗред <br>  2 рдмреБрдирд┐рдпрд╛рджреА рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╣реИрдВ: </p><br><ul><li>  рдереНрд░реЙрдЯрд▓рд┐рдВрдЧ, рдмрдлрд╝рд░реНрд╕ рдпрд╛ рд╡рд┐рдВрдбреЛ рдСрдкрд░реЗрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ </li><li>  рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рд╢реАрд▓ рдкреБрд▓ рдореЙрдбрд▓ </li></ul><br><p>  рдЬрдмрдХрд┐ Coroutines рд╕рд╕реНрдкреЗрдВрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рд╡реЗ рдмреИрдХрдкреНрд░реЗрд╢рд░ рдХреЛ рд╕рдВрднрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд░рд╛рдХреГрддрд┐рдХ рдЙрддреНрддрд░ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред <br>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдХреЛрдИ рдЕрддрд┐рд░рд┐рдХреНрдд рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </p><br><h3 id="sync-code-style-over-async">  Async рдкрд░ рдХреЛрдб рд╢реИрд▓реА рдХреЛ рд╕рд┐рдВрдХ рдХрд░реЗрдВ </h3><br><p>  рдореЛрдмрд╛рдЗрд▓ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА рдореВрд▓ рдкреНрд░рдХреГрддрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдХреНрд░рд┐рдпрд╛рдУрдВ рдкрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХрд░рдирд╛ рд╣реИред  рдпрд╣реА рдХрд╛рд░рдг рд╣реИ рдХрд┐ рд░рд┐рдПрдХреНрдЯрд┐рд╡ рдИрдПрдХреНрд╕рдЯреЗрдВрд╢рди рдПрдХ рдЕрдЪреНрдЫрд╛ рд╡рд┐рдХрд▓реНрдк рд╣реЛрдЧрд╛ред </p><br><p>  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдкрдХреЛ рдПрдХ рдХрд╛рд░реНрдпрд╛рддреНрдордХ рд╢реИрд▓реА рдореЗрдВ рдПрдХ рдХреЛрдб рд▓рд┐рдЦрдирд╛ рд╣реЛрдЧрд╛ред  рдпрджрд┐ рдЖрдк рдЕрдирд┐рд╡рд╛рд░реНрдп рд╢реИрд▓реА рдореЗрдВ рд▓рд┐рдЦрддреЗ рдереЗ рддреЛ рдпрд╣ рдереЛрдбрд╝рд╛ рдХрдард┐рди рд╣реЛ рд╕рдХрддрд╛ рд╣реИред </p><br><p>  рдЬрдмрдХрд┐ Coroutines рдЖрдкрдХреЛ Async рдХреЛрдб рд▓рд┐рдЦрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдХрд░рддрд╛ рд╣реИ рдЬреИрд╕реЗ рдХрд┐ рдпрд╣ рд╕рд╛рдорд╛рдиреНрдп рд╕рд┐рдВрдХ рдлрд╝рдВрдХреНрд╢рдВрд╕ рдерд╛ред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">suspend</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showTextFromRemote</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> text = remote.getText() textView.text = text }</code> </pre> <br><p>  рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдореИрдВ рд▓рдВрдмреЗ рд╕рдордп рддрдХ рдХрд╛рд░реНрдпрд╛рддреНрдордХ рд╢реИрд▓реА рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реВрдВ, рдлрд┐рд░ рднреА рдПрдХ рдЕрдирд┐рд╡рд╛рд░реНрдп рдХреЛрдб рдХреЛ рдкрдврд╝рдирд╛ рдФрд░ рдбреАрдмрдЧ рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реИред </p><br><h3 id="native-over-3rd-party-lib">  рддреАрд╕рд░реЗ рдкрдХреНрд╖ рдХреЗ рджрд╛рдпрд┐рддреНрд╡ рд╕реЗ рдЕрдзрд┐рдХ рдореВрд▓ </h3><br><p>  рдХреЙрд░рдЯреАрди рдПрдХ рдореВрд▓ рдмрд┐рд▓реНрдб-рдЗрди рдХреЛрдЯрд▓рд┐рди рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛ рд╣реИред </p><br><p>  рдЖрдкрдХреЛ рдХреЛрдИ рдЕрддрд┐рд░рд┐рдХреНрдд рдирд┐рд░реНрднрд░рддрд╛ рдирд╣реАрдВ рдорд┐рд▓рд╛рдиреА рд╣реИред  рд╡рд░реНрддрдорд╛рди рдореЗрдВ, рд╕рднреА рдореБрдЦреНрдп рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЛрд░рдЖрдЙрдЯреНрд╕ рд╕реЗ рдирд┐рдкрдЯ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, </p><br><p>  рдкреБрд░рд╛рдирд╛ рд╡рд╛рдкрд╕ </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Api</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Get(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"users"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">suspend</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadUsers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> : List&lt;User&gt; }</code> </pre> <br><p>  рдХрдХреНрд╖ </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Dao</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Update</span></span> <span class="hljs-keyword"><span class="hljs-keyword">suspend</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(user: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">UserEntity</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> }</code> </pre> <br><p>  рддреЛ, рдЖрдк рдПрдХ рдРрдк рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рд╕рднреА рддрд░рд╣ рд╕реЗ рдирд┐рд▓рдВрдмрд┐рдд рд╣реИ - рдпреВрдЖрдИ рдкрд░рдд рд╢реБрд░реВ рдХрд░рдирд╛, рдбреЛрдореЗрди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдФрд░ рдбреЗрдЯрд╛ рдкрд░рдд рдореЗрдВ рд╕рдорд╛рдкреНрдд рд╣реЛрдирд╛ред </p><br><h2 id="app">  рдРрдк </h2><br><p>  рдЪрд▓реЛ рд╡реНрдпрд╛рдкрд╛рд░ рдХреЗ рд▓рд┐рдП рдиреАрдЪреЗ рдЬрд╛рдУред  рд╣рдо рдПрдХ рдХреНрд▓рд╛рд╕рд┐рдХ рдорд╛рд╕реНрдЯрд░-рдбрд┐рдЯреЗрд▓ рдРрдк рдмрдирд╛рдПрдВрдЧреЗред <br>  рдкрд╣рд▓реЗ рдкреГрд╖реНрда рдореЗрдВ рдкреНрд░рд╕рд╡ рдХреА рдЕрдирдВрдд рд╕реВрдЪреА рд╣реЛрдЧреАред <br>  рдЖрдЗрдЯрдо рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рдиреЗ рдкрд░, рд╣рдо рдПрдХ рд╡рд┐рд╡рд░рдг рдкреГрд╖реНрда рдЦреЛрд▓реЗрдВрдЧреЗред <br>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдо рдСрдлрд╝рд▓рд╛рдЗрди рдореЛрдб рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВрдЧреЗ - рд╕рднреА рдбреЗрдЯрд╛ рдХреИрд╢ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред <br>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдореИрдВ MVVM рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реВрдВрдЧрд╛ рдЬрд╣рд╛рдВ AACM рд╕реЗ ViewModel рдХреЗ рдмрдЬрд╛рдп ViewModel рдХреА рднреВрдорд┐рдХрд╛ Fragment рджреНрд╡рд╛рд░рд╛ рдирд┐рднрд╛рдИ рдЬрд╛рддреА рд╣реИред  рдЗрд╕рдХреЗ рдХрдИ рдХрд╛рд░рдг рд╣реИрдВ: <br>  рдЯреБрдХрдбрд╝реЗ рдЖрдорддреМрд░ рдкрд░ рдмрд╣реБрдд рдЧрдВрдЬреЗ рд╣реЛрддреЗ рд╣реИрдВ - рдмрд╕ рджреГрд╢реНрдпрдореЙрдбрд▓ рдХреЛ XML рд╕реЗ рдмрд╛рдВрдзреЗрдВред </p><br><p>  рд╕реНрдерд┐рддрд┐ рдмрд╛рд░ рд░рдВрдЧ рд╕реЗрдЯ рдХрд░рдиреЗ рдЬреИрд╕реА рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ AAC ViewModel рдореЗрдВ рдирд╣реАрдВ рдХреА рдЬрд╛ рд╕рдХреАрдВ - рдЖрдкрдХреЛ рдЯреБрдХрдбрд╝реЗ рдХреА рд╡рд┐рдзрд┐ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  ViewModel рдХреЗ рд░реВрдк рдореЗрдВ рдЯреБрдХрдбрд╝реЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рд╣рдореЗрдВ рдПрдХ рд╡рд░реНрдЧ рдореЗрдВ рд╕рднреА рд╕рдВрдмрдВрдзрд┐рдд рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ (рдПрдХ рд╕реНрдХреНрд░реАрди рдХреЛ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдирд╛) рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓реЗрдЧреАред </p><br><p>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, BaseViewModel рдмрдирд╛рдПрдБ: </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseViewModel</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">B : BaseBindings, V : ViewDataBinding</span></span></span><span class="hljs-class">&gt; : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Fragment</span></span></span></span>(), CoroutineScope <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> CoroutineScope(Dispatchers.IO){ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> layoutId: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> bindings: B <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> viewBinding: V <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState) retainInstance = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(inflater: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">LayoutInflater</span></span></span></span><span class="hljs-function"><span class="hljs-params">, container: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ViewGroup</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span>: View? { viewBinding = DataBindingUtil.inflate(inflater, layoutId, container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> viewBinding.root } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onViewCreated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">, savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onViewCreated(view, savedInstanceState) viewBinding.lifecycleOwner = viewLifecycleOwner viewBinding.setVariable(BR.bindings, bindings) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDestroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { cancel() <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onDestroy() } }</code> </pre> <br><p>  рд╣рдо рдЕрдкрдиреЗ ViewModel рдХреЛ CoroutineScope рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рддрд╛рдХрд┐ рд╣рдо рд╡реНрдпреВ рдореЙрдбрд▓ рдХреЗ рдЕрдВрджрд░ рдХреЙрд░рдЖрдЙрдЯ рд╢реБрд░реВ рдХрд░ рд╕рдХреЗрдВ рдФрд░ рдХрд┐рд╕реА рднреА рд▓реЙрдиреНрдЪ рдХрд┐рдП рдЧрдП рдХреЙрд░рдЖрдЙрдЯ рдХреЛ рдПрдХ рдЯреБрдХрдбрд╝реЗ рдХреЗ рдЬреАрд╡рдирдЪрдХреНрд░ рддрдХ рд╕реАрдорд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред </p><br><p>  рд╣рдореЗрдВ рдореЗрдореЛрд░реА рд▓реАрдХ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рд╕рднреА рдЪрд▓ рд░рд╣реЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд░рджреНрдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдХреЛрдк рдХреЗ рдЬреАрд╡рдирдЪрдХреНрд░ рдХреЙрд▓рд┐рдВрдЧ <code>cancel()</code> рд╡рд┐рдзрд┐ рдХреЗ рдЕрдВрдд рдХреЛ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </p><br><p>  рд╣рдордиреЗ <code>retainInstance = true</code> рд╕реЗрдЯ рдХрд┐рдпрд╛ <code>retainInstance = true</code> рддрд╛рдХрд┐ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдкрд░рд┐рд╡рд░реНрддрди рдореЗрдВ рдЯреБрдХрдбрд╝реЗ рдХреЛ рдлрд┐рд░ рд╕реЗ рди рдмрдирд╛рдпрд╛ рдЬрд╛рдП рддрд╛рдХрд┐ рд╣рдо рд╕рднреА рд▓рдВрдмреЗ рд╕рдордп рд╕реЗ рдЪрд▓ рд░рд╣реЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдкреВрд░рд╛ рдХрд░ рд╕рдХреЗрдВред </p><br><p>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдореЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рджреЛ-рддрд░рдлрд╝рд╛ рдбреЗрдЯрд╛ рдмрд╛рдЗрдВрдбрд┐рдВрдЧ</a> рдХреЛ рдЪрд╛рд▓реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рдЬреАрд╡рдирдЪрдХреНрд░ рд╕реЗрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </p><br><h2 id="exception-handling">  рдЕрдкрд╡рд╛рдж рд╕рдВрднрд╛рд▓рдирд╛ </h2><br><p>  Coroutines <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреНрд░рд▓реЗрдЦрди рдХреЗ</a> рдЕрдиреБрд╕рд╛рд░: </p><br><pre> <code class="plaintext hljs">Coroutine builders come in two flavors: propagating exceptions automatically (launch and actor) or exposing them to users (async and produce). The former treat exceptions as unhandled, similar to Java's Thread.uncaughtExceptionHandler</code> </pre> <br><p>  рдЪреВрдВрдХрд┐ рд╣рдо рдЬреНрдпрд╛рджрд╛рддрд░ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рд▓реЙрдиреНрдЪ рдмрд┐рд▓реНрдбрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">CoroutineExceptionHandler</a> рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ <br>  CoroutineExceptionHandler CoroutineContext.Element рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рд╕реА рдЕрдиреНрдп рдСрдкрд░реЗрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреЛрд░рдЯрд╛рдЗрди рд╕рдВрджрд░реНрдн рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br>  рдореИрдВ рд╕реНрдереИрддрд┐рдХ рд╣реИрдВрдбрд▓рд░ рдХреА рдШреЛрд╖рдгрд╛ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХрд░реЗрдЧрд╛: </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> exceptionHandler = CoroutineExceptionHandler { _, throwable -&gt; Timber.e(throwable) }</code> </pre> <br><p>  рдФрд░ BaseViewModel рдмрджрд▓реЗрдВ: </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseViewModel</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">B : BaseBindings, V : ViewDataBinding</span></span></span><span class="hljs-class">&gt; : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Fragment</span></span></span></span>(), CoroutineScope <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> CoroutineScope(Dispatchers.IO + exceptionHandler)</code> </pre> <br><p>  рдпрд╣рд╛рдБ рд╕реЗ ViewModel рдХреЗ рджрд╛рдпрд░реЗ рдореЗрдВ рд▓реЙрдиреНрдЪ рдХрд┐рдП рдЧрдП рдХреЛрд░рдЖрдЙрдЯ рдореЗрдВ рдХрд┐рд╕реА рднреА рдЕрдкрд╡рд╛рдж рдХреЛ рджрд┐рдП рдЧрдП рд╣реИрдВрдбрд▓рд░ рдХреЛ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред <br>  рдЗрд╕рдХреЗ рдмрд╛рдж, рдореБрдЭреЗ рдЕрдкрдирд╛ API рдФрд░ DAO рдШреЛрд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DeliveriesApi</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@GET(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"deliveries"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">suspend</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDeliveries</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">@Query(</span></span></span><span class="hljs-meta-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta"><span class="hljs-meta-string">"offset"</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">)</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offset: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">@Query(</span></span></span><span class="hljs-meta-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta"><span class="hljs-meta-string">"limit"</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">)</span></span></span></span><span class="hljs-function"><span class="hljs-params"> limit: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: List&lt;DeliveryResponse&gt; } <span class="hljs-meta"><span class="hljs-meta">@Dao</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DeliveryDao</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Query(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"SELECT * FROM </span></span><span class="hljs-subst"><span class="hljs-meta"><span class="hljs-meta-string"><span class="hljs-subst">${DeliveryEntity.TABLE_NAME}</span></span></span></span><span class="hljs-meta"><span class="hljs-meta-string">"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: DataSource.Factory&lt;<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, DeliveryEntity&gt; <span class="hljs-meta"><span class="hljs-meta">@Insert(onConflict = OnConflictStrategy.REPLACE)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">suspend</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">insert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(delivery: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DeliveryEntity</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> }</code> </pre> <br><p>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдореИрдВрдиреЗ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЛ рдирд┐рд▓рдВрдмрд┐рдд рдХрд░ рджрд┐рдпрд╛ рд╣реИ рддрд╛рдХрд┐ рд╣рдо рдХреЗрд╡рд▓ рдЕрдкреЗрдХреНрд╖рд┐рдд рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╡рд╕реНрддреБрдУрдВ рдХреА рдШреЛрд╖рдгрд╛ рдХрд░ рд╕рдХреЗрдВред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдореВрд▓ рдХреЙрд░рдЖрдЙрдЯ рдХреЗ рд░рджреНрдж рд╣реЛрдиреЗ рд╕реЗ рдиреЗрдЯрд╡рд░реНрдХ рдХреЙрд▓ рднреА рд░рджреНрдж рд╣реЛ рдЬрд╛рдПрдЧреАред <br>  DAO рдХреЗ рд▓рд┐рдП рднреА рдпрд╣реАред <br>  рдЕрдВрддрд░ рдХреЗрд╡рд▓ рдЗрддрдирд╛ рд╣реИ рдХрд┐ рд╣рдо рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЛ рджреЗрдЦрдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред <br>  рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдбреЗрдЯрд╛ рд╕рдорд░реНрдерди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдЕрдЧрд░ рд╣рдо getAll () рдХреЛ рдирд┐рд▓рдВрдмрд┐рдд рдХрд░ рджреЗрдВрдЧреЗ, рддреЛ рдпрд╣ рдПрдХ рд╕рдВрдХрд▓рди рддреНрд░реБрдЯрд┐ рдХрд╛ рдХрд╛рд░рдг рд╣реЛрдЧрд╛ <br>  рддреНрд░реБрдЯрд┐: </p><br><pre> <code class="plaintext hljs">Not sure how to convert a Cursor to this method's return type ...</code> </pre> <br><p>  рдпрд╣рд╛рдБ рд╣рдореЗрдВ рд╕рд╕реНрдкреЗрдВрдб рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐: </p><br><ul><li>  рдбреАрдмреА рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдкреГрд╖реНрдарднреВрдорд┐ рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ </li><li>  рдкрд░рд┐рдгрд╛рдореА LiveData рдЬреАрд╡рдирдЪрдХреНрд░ рдЬрд╛рдЧрд░реВрдХ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдЗрд╕реЗ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рд░рджреНрдж рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ </li></ul><br><p>  рд╣рдореЗрдВ рдХрд┐рд╕реА рддрд░рд╣ рджреВрд░рд╕реНрде рдФрд░ рд╕реНрдерд╛рдиреАрдп рдбреЗрдЯрд╛ рд╕реНрд░реЛрддреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ред <br>  рдпрд╣ рдпрд╛рдж рд░рдЦрдиреЗ рдпреЛрдЧреНрдп рд╣реИ - рд╕рддреНрдп рдХрд╛ рдПрдХ рд╣реА рдмрд┐рдВрджреБ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдСрдлрд╝рд▓рд╛рдЗрди-рдкреНрд░рдердо рдбрд┐рдЬрд╝рд╛рдЗрди рдХреЗ</a> рдЕрдиреБрд╕рд╛рд░, рдпрд╣ рд╕реНрдерд╛рдиреАрдп рднрдВрдбрд╛рд░рдг рд╣реЛрдЧрд╛ред  рдЗрд╕рд▓рд┐рдП, рд╣рдо рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реНрдерд┐рддрд┐ рдХрд╛ рдирд┐рд░реАрдХреНрд╖рдг рдХрд░реЗрдВрдЧреЗред  рдЬрдм рдХреЛрдИ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ рддреЛ рд╣рдо рд░рд┐рдореЛрдЯ рд╕реЗ рдбреЗрдЯрд╛ рдкреВрдЫреЗрдВрдЧреЗ рдФрд░ рдЗрд╕реЗ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдбрд╛рд▓реЗрдВрдЧреЗред <br>  рд╣рдо рд╕реВрдЪреА рд╡рд░реНрдЧ рдХрд╛ рдкрд░рд┐рдЪрдп рджреЗрдВрдЧреЗ </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Listing</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt;</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pagedList: LiveData&lt;PagedList&lt;T&gt;&gt;, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dataState: LiveData&lt;DataState&gt;, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> refreshState: LiveData&lt;DataState&gt;, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> refresh: () -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> retry: () -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> )</code> </pre> <br><p>  рдЖрдЗрдП рдЬрд╛рдиреЗ рд╡реИрд▓ рд╕реЗ рд╡реИрд▓: </p><br><ul><li>  pagedList - рдореБрдЦреНрдп рдбреЗрдЯрд╛ рдЬрд┐рд╕реЗ PagedList рдХреЗ рд░реВрдк рдореЗрдВ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рддрд╛рдХрд┐ рдЕрдирдВрдд рд╕реНрдХреНрд░реЙрд▓рд┐рдВрдЧ рдХреЛ рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдФрд░ рдбреЗрдЯрд╛ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП LiveData рдХреЗ рд╕рд╛рде рд▓рд┐рдкрдЯреЗ </li><li>  dataState - рддреАрди рдореЗрдВ рд╕реЗ рдПрдХ рд╕реНрдерд┐рддрд┐ рдЬрд┐рд╕рдореЗрдВ рд╣рдорд╛рд░рд╛ рдбреЗрдЯрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ: рд╕рдХреНрд╕реЗрд╕, рд░рдирд┐рдВрдЧ, рдПрд░рд░ред  рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЛ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рд▓рд╛рдЗрд╡рдбрд╛рдЯрд╛ рд╕реЗ рднреА рд▓рд┐рдкрдЯрд╛ </li><li>  рд░рд┐рдлреНрд░реЗрд╢рд╕реНрдЯреЗрдЯ - рдЬрдм рд╣рдо рд╕реНрд╡рд╛рдЗрдк-рд░рд┐рдлреНрд░реЗрд╢ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд░рд┐рдлреНрд░реЗрд╢рд┐рдВрдЧ рдбреЗрдЯрд╛ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рд╣рдореЗрдВ рдХреБрдЫ рдЯреВрд▓ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЬрд┐рд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ рд╣рдо рд░рд┐рдлреНрд░реЗрд╢ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рдлреАрдбрдмреИрдХ рдФрд░ рдЕрдЧрд▓реЗ рдкреЗрдЬ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рдлреАрдбрдмреИрдХ рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рдХрд░рддреЗ рд╣реИрдВред  рдкреВрд░реНрд╡ рдХреЗ рд▓рд┐рдП, рд╣рдо рд╕реВрдЪреА рдХреЗ рдЕрдВрдд рдореЗрдВ рдПрдХ рддреНрд░реБрдЯрд┐ рджрд┐рдЦрд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рддрд╛рдЬрд╝рд╛ рддреНрд░реБрдЯрд┐ рдХреЗ рд▓рд┐рдП, рд╣рдо рдПрдХ рдЯреЛрд╕реНрдЯ рд╕рдВрджреЗрд╢ рджрд┐рдЦрд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдФрд░ рдПрдХ рд▓реЛрдбрд░ рдХреЛ рдЫрд┐рдкрд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред </li><li>  рд░рд┐рдлреНрд░реЗрд╢ () - рд╕реНрд╡рд╛рдЗрдк-рд░рд┐рдлреНрд░реЗрд╢ рдкрд░ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрд▓рдмреИрдХ </li><li><p>  рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ () - рдкреГрд╖реНрдард╛рдВрдХрд┐рдд рд▓реЛрдбрд┐рдВрдЧ рддреНрд░реБрдЯрд┐ рдкрд░ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрд▓рдмреИрдХ <br>  рдЕрдЧрд▓рд╛, рд╕реВрдЪреА рджреГрд╢реНрдп рдореЙрдбрд▓: </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DeliveryListViewModel</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">BaseViewModel</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DeliveryListBindings, DeliveryListBinding</span></span></span><span class="hljs-class">&gt;</span></span>(), DeliveryListBindings, DeliveryListItemBindings, DeliveryListErrorBindings { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> layoutId: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> = R.layout.delivery_list <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> bindings: DeliveryListBindings = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> deliveryGateway: DeliveryGateway <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> inject { parametersOf(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> listing = deliveryGateway.getDeliveries() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dataState = listing.dataState <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> isRefreshing = Transformations.switchMap(listing.refreshState) { MutableLiveData(it == DataState.Loading) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onViewCreated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">, savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onViewCreated(view, savedInstanceState) setupList() setupRefresh() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> adapter = DeliveriesAdapter(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) viewBinding.deliveries.adapter = adapter viewBinding.deliveries.setHasFixedSize(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) listing.pagedList.observe(viewLifecycleOwner, Observer { adapter.submitList(it) }) listing.dataState.observe(viewLifecycleOwner, Observer { adapter.updateDataState(it) }) } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupRefresh</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { listing.refreshState.observe(viewLifecycleOwner, Observer { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (it <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> DataState.Error) { Toast.makeText(context, it.message, LENGTH_SHORT).show() } }) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">refresh</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { listing.refresh() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDeliveryClicked</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(delivery: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Delivery</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { view?.findNavController()?.navigate(DeliveryListViewModelDirections.toDetails(delivery)) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onRetryClicked</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { listing.retry() } }</code> </pre> <br><p>  рдХрдХреНрд╖рд╛ рдШреЛрд╖рдгрд╛ рд╕реЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред </p><br></li></ul><br><p>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ DeliveryListBindings рдФрд░ DeliveryListBindingред  рдкрд╣рд▓реЗ рдПрдХреНрд╕рдПрдордПрд▓ рджреГрд╢реНрдп рдХреЗ рд╕рд╛рде рджреГрд╢реНрдп рдореЙрдбрд▓ рдХреЛ рдЧреЛрдВрдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░рд╛ рдШреЛрд╖рд┐рдд рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рд╣реИред  рджреВрд╕рд░рд╛ XML рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдСрдЯреЛрдЬреЗрдирд░реЗрдЯреЗрдб рдХреНрд▓рд╛рд╕ рд╣реИред  рд╣рдореЗрдВ рдЕрдкрдиреЗ рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдФрд░ рдЬреАрд╡рдирдЪрдХреНрд░ рдХреЛ XML рдкрд░ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджреВрд╕рд░реЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </p><br><p>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдХреЛрдЯрд▓рд┐рди рдХреЗ рд╕рд┐рдВрдереЗрдЯрд┐рдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп рдЗрд╕ рдСрдЯреЛрдЬреЗрдирд░реЗрдЯреЗрдб рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рдЪрд╛рд░реЛрдВ рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рдирд╛ рдЕрдЪреНрдЫрд╛ рд╣реИред </p><br><p>  рд╡рд░реНрддрдорд╛рди рджреГрд╢реНрдп рдореЗрдВ рд╕рд┐рдВрдереЗрдЯрд┐рдХ рджреГрд╢реНрдп рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдВрджрд░реНрднрд┐рдд рд╣реЛрдиреЗ рдкрд░ рдорд╛рдорд▓рд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  рдбреЗрдЯрд╛ рдмрд╛рдзреНрдпрдХрд╛рд░реА рдХреЗ рд╕рд╛рде, рдЖрдк рд╕рдВрдХрд▓рди рдЪрд░рдг рдкрд░ рднреА рддреЗрдЬреА рд╕реЗ рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рдПрдВрдЧреЗред </p><br><p>  рдЗрд╕рдХреЗ рдмрд╛рдж, рддреАрди рдЗрдВрдЯрд░рдлреЗрд╕: рдбрд┐рд▓рд┐рд╡рд░реА рд▓рд┐рд╕реНрдЯрдмрд╛рдЗрдВрдбрд┐рдВрдЧ, рдбрд┐рд▓рд┐рд╡рд░реА рд▓рд┐рд╕реНрдЯрдЗрдордмрд╛рдЗрдВрдбрд┐рдВрдЧ, рдбрд┐рд▓рд┐рд╡рд░реА рд▓рд┐рд╕реНрдЯреНрд░рд╛рд░ рдмрд┐рдВрджрд┐рдВрдЧреНрд╕ред </p><br><ol><li>  <em>DeliveryListBindings</em> - рд╕реНрдХреНрд░реАрди рдХреЗ рд▓рд┐рдП рд╣реА рдмрд╛рдЗрдВрдбрд┐рдВрдЧред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЗрд╕рдореЗрдВ рддрд╛рдЬрд╝рд╛ () рд╡рд┐рдзрд┐ рд╢рд╛рдорд┐рд▓ рд╣реИ рдЬрд┐рд╕реЗ рдКрд░реНрдзреНрд╡рд╛рдзрд░ рд╕реНрд╡рд╛рдЗрдк рдкрд░ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред </li><li>  <em>DeliveryListItemBindings</em> - рд╕реВрдЪреА рдореЗрдВ рдПрдХ рдЖрдЗрдЯрдо рдХреЗ рд▓рд┐рдП рдмрд╛рдЗрдВрдбрд┐рдВрдЧред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, onClicked () </li><li>  <em>DeliveryListErrorBindings</em> - рддреНрд░реБрдЯрд┐ рджреГрд╢реНрдп рдХреЗ рд▓рд┐рдП рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рдЬреЛ рддреНрд░реБрдЯрд┐ рд╕реНрдерд┐рддрд┐ рдкрд░ рджрд┐рдЦрд╛рдИ рдЧрдИ рд╕реВрдЪреА рдЖрдЗрдЯрдо рднреА рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЗрд╕рдореЗрдВ рдкреБрдирд░реНрдкреНрд░рдпрд╛рд╕ () рд╡рд┐рдзрд┐ рд╢рд╛рдорд┐рд▓ рд╣реИ </li></ol><br><p>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╣рдо рд╕рд┐рдВрдЧрд▓ рд╡реНрдпреВ рдореЙрдбрд▓ рдореЗрдВ рд╕рдм рдХреБрдЫ рд╕рдВрднрд╛рд▓ рд░рд╣реЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╕рд┐рдВрдЧрд▓ рд╕реНрдХреНрд░реАрди рд╣реИ, рд▓реЗрдХрд┐рди <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЗрдВрдЯрд░рдлреЗрд╕ рд╕реЗрдЧреНрд░реАрдЧреЗрд╢рди</a> рд╕рд┐рджреНрдзрд╛рдВрдд рдХрд╛ рднреА рдкрд╛рд▓рди рдХрд░ рд░рд╣рд╛ рд╣реИ </p><br><p>  рдЖрдЗрдП рдЗрд╕ рд▓рд╛рдЗрди рдкрд░ рд╡рд┐рд╢реЗрд╖ рдзреНрдпрд╛рди рджреЗрдВ: </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> deliveryGateway: DeliveryGateway <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> inject { parametersOf(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) }</code> </pre> <br><p>  <em>DeliveryGateway</em> рдХреЛ рдореБрдЦреНрдп рдереНрд░реЗрдб рд╕реЗ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рдЗрд╕ рджрд╛рдпрд░реЗ рдореЗрдВ рдирдП рдХреЙрд░рдЖрдЙрдЯреНрд╕ рдХреЛ рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╛ рддреЛ рддрд░реАрдХреЛрдВ рдХреЛ рдирд┐рд▓рдВрдмрд┐рдд рдХрд░рдиреЗ рдпрд╛ рдХреЛрд░рдЯрд╛рдЗрдирд╕реНрд╕реНрдХреЛрдк рдШреЛрд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рд╣рдо рджреВрд╕рд░реЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЪрдпрди рдХрд░реЗрдВрдЧреЗ рдХреНрдпреЛрдВрдХрд┐ рд╣рдореЗрдВ рдЕрдкрдиреА LiveData рдХреЛ рд╢реБрд░реВ рд╕реЗ рд╣реА рдЬрд░реВрд░рдд рд╣реИ рдФрд░ рдлрд┐рд░ рд╣рдо рдмрд╕ рдЗрд╕рдХреЗ рдЕрдкрдбреЗрдЯ рдХрд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░реЗрдВрдЧреЗред  рдпрд╣ liveData рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рд╕рджрд╕реНрдпрддрд╛ рд▓реЗрдиреЗ рдХреЗ рд╕рдорд╛рди рд╣реИ рдЬрдм рд╣рдо рдЬреАрд╡рдирдЪрдХреНрд░ рдкрд╛рд╕ рдХрд░ рд░рд╣реЗ рд╣реЛрддреЗ рд╣реИрдВ (рдЬреЛ рдЕрдХреНрд╕рд░ 'рдЗрд╕' рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рддрд╛ рд╣реИ)ред  рдпрд╣рд╛рдВ рд╣рдо рдЙрд╕реА рддрд░рд╣ рд╕реЗ 'рдЗрд╕' рдХреЛ рдХреЛрд░рдЯрд╛рдЗрдирд╕реНрд╕реНрдХреЛрдк рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд░рд┐рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВ </p><br><p>  CoroutineScope рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдореЗрдВ рдПрдХрдорд╛рддреНрд░ рдлрд╝реАрд▓реНрдб рд╣реИ - CoroutineContextред  рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ, рдПрдХ рдЧреБрдВрдЬрд╛рдЗрд╢ рдФрд░ рдПрдХ рд╕рдВрджрд░реНрдн рд╕рдорд╛рди рдЪреАрдЬреЗрдВ рд╣реИрдВред  рдПрдХ рд╕рдВрджрд░реНрдн рдФрд░ рдПрдХ рджрд╛рдпрд░реЗ рдХреЗ рдмреАрдЪ рдХрд╛ рдЕрдВрддрд░ рдЙрдирдХреЗ рдЗрдЪреНрдЫрд┐рдд рдЙрджреНрджреЗрд╢реНрдп рдореЗрдВ рд╣реИред </p><br><p>  рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдореИрдВ рд░реЛрдорди рдПрд▓рд┐рд╕реИрд░реЛрд╡ рдХреЗ рдПрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд▓реЗрдЦ</a> рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХрд░реВрдВрдЧрд╛ред  рдЗрд╕рд▓рд┐рдП, рдбрд┐рд▓реАрд╡рд░реАрдЧреЗрдЯ рдХреЛ рдЧреБрдВрдЬрд╛рдЗрд╢ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рд╕реЗ рднреА рдЙрд╕реА рд╕рдВрджрд░реНрдн рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдзрд╛рдЧрд╛, рдиреМрдХрд░реА рдФрд░ рдЕрдкрд╡рд╛рдж рд╣реИрдВрдбрд▓рд░ред <br>  рдЕрдм рд╣рдо рдЦреБрдж рдбрд┐рд▓реАрд╡рд░реАрдЧреЗрдЯ рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓рддреЗ рд╣реИрдВ: </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DeliveryBoundGateway</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> db: DataBase, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> api: DeliveriesApi, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> deliveryDao: DeliveryDao, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> coroutineScope: CoroutineScope ) : DeliveryGateway { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> boundaryCallback = DeliveriesBoundaryCallback( api = api, coroutineScope = coroutineScope, handleResponse = { insertIntoDatabase(it) } ) <span class="hljs-meta"><span class="hljs-meta">@MainThread</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDeliveries</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Listing&lt;Delivery&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> refreshTrigger = MutableLiveData&lt;<span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> refreshState = Transformations.switchMap(refreshTrigger) { refresh() } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pagingConfig = Config( initialLoadSizeHint = PAGE_SIZE, pageSize = PAGE_SIZE, prefetchDistance = PAGE_SIZE ) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> deliveries = deliveryDao.getAll() .toLiveData( config = pagingConfig, boundaryCallback = boundaryCallback ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Listing( pagedList = deliveries, dataState = boundaryCallback.dataState, retry = { boundaryCallback.helper.retryAllFailed() }, refresh = { refreshTrigger.value = <span class="hljs-literal"><span class="hljs-literal">null</span></span> }, refreshState = refreshState ) } <span class="hljs-comment"><span class="hljs-comment">/** * When refresh is called, we simply run a fresh network request and when it arrives, clear * the database table and insert all new items in a transaction. * &lt;p&gt; * Since the PagedList already uses a database bound data source, it will automatically be * updated after the database transaction is finished. */</span></span> <span class="hljs-meta"><span class="hljs-meta">@MainThread</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">refresh</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: LiveData&lt;DataState&gt; { boundaryCallback.refresh() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dataState = MutableLiveData&lt;DataState&gt;() dataState.value = DataState.Loading coroutineScope.launch { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> deliveries = api.getDeliveries(<span class="hljs-number"><span class="hljs-number">0</span></span>, PAGE_SIZE) db.withTransaction { deliveryDao.clear() insertIntoDatabase(deliveries) } dataState.postValue(DataState.Loaded) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (throwable: Throwable) { Timber.w(throwable) dataState.postValue(DataState.Error(throwable.message)) } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dataState } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">suspend</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">insertIntoDatabase</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(deliveries: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">List</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DeliveryResponse</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { deliveries.forEach { delivery -&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> entity = deliveryConverter.fromNetwork(delivery) deliveryDao.insert(entity) } } <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> PAGE_SIZE = <span class="hljs-number"><span class="hljs-number">20</span></span> } }</code> </pre> <br><p>  рдпрд╣рд╛рдВ рд╣рдо рд╢реБрд░реБрдЖрдд рд╕реЗ рд╣реА LiveData рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рдХреЛрд░рдЯрд╛рдЗрди рд▓реЛрдб рдбреЗрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рдЗрд╕реЗ LiveData рдкрд░ рдкреЛрд╕реНрдЯ рдХрд░ рд░рд╣реЗ рд╣реИрдВред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдо <em>рд╕реНрдерд╛рдиреАрдп рдбреЗрдЯрд╛рдмреЗрд╕ рдФрд░ рджреВрд░рд╕реНрде рдПрдкреАрдЖрдИ рдХреЛ рдЧреЛрдВрдж</em> рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <em>PagedList.BoundaryCallback ()</em> рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ <em>ред</em>  <em>рдЬрдм рд╣рдо рдкреГрд╖реНрдард╛рдВрдХрд┐рдд рд╕реВрдЪреА рдХреЗ рдЕрдВрдд рддрдХ рдкрд╣реБрдБрдЪрддреЗ рд╣реИрдВ рддреЛ <em>рд╕реАрдорд╛ рд╡рд╛рдкрд╕</em> рдЪрд╛рд▓реВ рд╣реЛ рдЬрд╛рддреА рд╣реИ рдФрд░ рдбреЗрдЯрд╛ рдХрд╛ рдЕрдЧрд▓рд╛ рд╣рд┐рд╕реНрд╕рд╛ рд▓реЛрдб рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред</em> <br></p><p>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рд╣рдо рдирдП coroutines рдХреЛ рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП coroutineScope рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВред </p><br><p>  рдЪреВрдБрдХрд┐ рдпрд╣ рджрд╛рдпрд░рд╛ рдЦрдВрдб рдХреЗ рдЬреАрд╡рдирдЪрдХреНрд░ рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИ - рд╕рднреА рд▓рдВрдмрд┐рдд рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдЦрдВрдб рдХреЗ <code>onDestroy()</code> рдХреЙрд▓рдмреИрдХ рдкрд░ рд░рджреНрдж рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </p><br><p>  рдбрд┐рд▓реАрд╡рд░реА рдбрд┐рдЯреЗрд▓ рдкреЗрдЬ рдХрд╛рдлреА рд╕реАрдзрд╛ рд╣реИ - рд╣рдо рд╕рд┐рд░реНрдл рдиреЗрд╡рд┐рдЧреЗрд╢рди рд╕реНрдХреНрд░реАрди рд╕реЗрд╡ рдСрд░реНрдЧреНрд╕ рдкреНрд▓рдЧрдЗрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдорд╛рд╕реНрдЯрд░ рд╕реНрдХреНрд░реАрди рд╕реЗ рдкрд╛рд░реНрд╕рд▓ рдХреЗ рд░реВрдк рдореЗрдВ рдбрд┐рд▓реАрд╡рд░реА рдСрдмреНрдЬреЗрдХреНрдЯ рдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВред  рд╡рд┐рд╡рд░рдг рд╕реНрдХреНрд░реАрди рдкрд░ рдмрд╕ рдПрдХ рдПрдХреНрд╕рдПрдордПрд▓ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд╕реНрддреБ рджреА рдмрд╛рдБрдзред </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DeliveryViewModel</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">BaseViewModel</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DeliveryBindings, DeliveryBinding</span></span></span><span class="hljs-class">&gt;</span></span>(), DeliveryBindings { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> layoutId: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> = R.layout.delivery <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> bindings: DeliveryBindings = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> args: DeliveryViewModelArgs <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> navArgs() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onViewCreated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">, savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onViewCreated(view, savedInstanceState) viewBinding.delivery = args.delivery viewBinding.image.clipToOutline = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre> <br><h2 id="contact-me">  рдореБрдЭрд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВ </h2><br><p>  рдпрд╣рд╛рдБ github рд╕реНрд░реЛрдд рдХреЛрдб рдХрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд▓рд┐рдВрдХ</a> рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред </p><br><p>  рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдФрд░ рдЦреБрд▓реЗ рдореБрджреНрджреЛрдВ рдХреЛ рдЫреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИред </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi465529/">https://habr.com/ru/post/hi465529/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi465519/index.html">рдкреНрд░рджрд░реНрд╢рдиреА PRO // Movement.Expo</a></li>
<li><a href="../hi465521/index.html">рдлреНрд▓рд╛рдИ-рдлреНрд▓рд╛рдИ-рдкреЗрдЯрд▓ ... рдпрд╛ рдпреВрдПрдХреНрд╕ рдбрд┐рдЬрд╛рдЗрдирд░ рдиреЗ рдЗрдВрд╕реНрдЯрд╛рдЧреНрд░рд╛рдо рдкрд░ рдЕрдкрдиреЗ рдЙрддреНрдкрд╛рдж рдХреЛ рдХреИрд╕реЗ рдмрдврд╝рд╛рд╡рд╛ рджрд┐рдпрд╛, рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рдХрд╣рд╛рдиреА</a></li>
<li><a href="../hi465523/index.html">рдЕрднреА рддрдХ рдХрд┐рд╡реА, рдЕрдЬрдЧрд░ рдХреЗ рд╕рд╛рде рдПрдХ рдФрд░ рдПрдВрдбреНрд░реЙрдЗрдб рд╕рд╛рдВрдк</a></li>
<li><a href="../hi465525/index.html">Oracle BI EE 12c рдкрд░ рдореЛрдмрд╛рдЗрд▓ рд░рд┐рдкреЛрд░реНрдЯ - рдПрдХ, рджреЛ, рддреАрдиред рдУрд░реЗрдХрд▓ рдмреАрдЖрдИ рдИрдИ 12 рд╕реА рд╕реАрдПрдбреА рдХреЛрд░реНрд╕ рд╕реЗ рдкрджреНрдзрддрд┐</a></li>
<li><a href="../hi465527/index.html">RFC 4357 рд╕реЗ RFC 8645 рддрдХ рд▓рдВрдмреА рдпрд╛рддреНрд░рд╛ рдпрд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬреА рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХреИрд╕реЗ рдХрд░реЗрдВ</a></li>
<li><a href="../hi465531/index.html">рдЕрдирд┐рд╢реНрдЪрд┐рддрдХрд╛рд▓реАрди рдЧрд╣рд░рд╛рдИ рдХреА рдиреЗрд╕реНрдЯреЗрдб рд╕реВрдЪрд┐рдпреЛрдВ рдХреЛ рдЦреЛрд▓рдирд╛</a></li>
<li><a href="../hi465535/index.html">IPv6 рдХреЛ рдХреМрди рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдЗрд╕рдХреЗ рд╡рд┐рдХрд╛рд╕ рдореЗрдВ рдХреНрдпрд╛ рдмрд╛рдзрд╛ рдЖрддреА рд╣реИ</a></li>
<li><a href="../hi465537/index.html">рдпреИрдВрдбреЗрдХреНрд╕: рдПрдХ рд╡рдпрд╕реНрдХ рд╕реНрдорд╛рд░реНрдЯ рд╣реЛрдо</a></li>
<li><a href="../hi465539/index.html">766 рдХрд┐рдореА - рд▓реЛрд░рд╛рд╡рди рдХреЗ рд▓рд┐рдП рдПрдХ рдирдИ рд░реЗрдВрдЬ рд░рд┐рдХреЙрд░реНрдб</a></li>
<li><a href="../hi465541/index.html">рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЬ рд╕реЗ рдПрд╕рдПрдордмреА рддрдХ: рд╣рдо рд╕рд╛рд╕ рдореЙрдбрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рдореБрджреНрд░реАрдХрд░рдг рдХреЗ рд╕рд╛рде рдЫреЛрдЯреЗ рдФрд░ рдордзреНрдпрдо рд╡реНрдпрд╡рд╕рд╛рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдХреЙрд░реНрдкреЛрд░реЗрдЯ рд╕рдорд╛рдзрд╛рди рдЕрдкрдирд╛рдиреЗ рдореЗрдВ рдЕрдкрдирд╛ рдЕрдиреБрднрд╡ рд╕рд╛рдЭрд╛ рдХрд░рддреЗ рд╣реИрдВ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>