<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ…ğŸ½ ğŸ¤·ğŸ¼ â›¹ğŸ½ ä½¿ç”¨C ++ä¸­çš„ç¡¬ä»¶å¯„å­˜å™¨çš„10ç§++æ–¹æ³•ï¼ˆä¾‹å¦‚IARå’ŒCortex Mï¼‰ ğŸ‘©ğŸ¿â€ğŸ¤â€ğŸ‘¨ğŸ½ ğŸ¤¶ğŸ¾ ğŸ‘©ğŸ½â€âš–ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å›¾ ä¸€æ¸…å­ 

 å¤§å®¶èº«ä½“å¥åº·ï¼ 

 æ‚¨å¯èƒ½è¿˜è®°å¾—ä¸€ä¸ªå¤§èƒ¡å­çš„è½¶äº‹ï¼Œä¹Ÿè®¸æ˜¯ä¸€ä¸ªçœŸå®çš„æ•…äº‹ï¼Œå…³äºå¦‚ä½•å‘å­¦ç”Ÿè¯¢é—®ä½¿ç”¨æ°”å‹è®¡æµ‹é‡å»ºç­‘ç‰©é«˜åº¦çš„æ–¹æ³•ã€‚ åœ¨æˆ‘çœ‹æ¥ï¼Œå­¦ç”Ÿåˆ—ä¸¾äº†å¤§çº¦20æˆ–30ç§æ–¹æ³•ï¼Œè€Œæ²¡æœ‰æåŠè€å¸ˆæœŸæœ›çš„ç›´æ¥ï¼ˆé€šè¿‡å‹åŠ›å·®å¼‚ï¼‰ã€‚ 

 åŒæ ·ï¼Œæˆ‘æƒ³ç»§ç»­è®¨è®ºå°†C ++ç”¨äºå¾®æ§åˆ¶å™¨ï¼Œå¹¶è€ƒè™‘ä½¿ç”¨C ++å¤„ç†...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨C ++ä¸­çš„ç¡¬ä»¶å¯„å­˜å™¨çš„10ç§++æ–¹æ³•ï¼ˆä¾‹å¦‚IARå’ŒCortex Mï¼‰</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459204/"><img src="https://habrastorage.org/webt/fd/id/cl/fdidclwtjklierjxrqybnqmttui.jpeg" alt="é€‰æ‹©æœ€å®‰å…¨çš„é“è·¯"><br>  <sub><b>å›¾</b></sub>  <sub><b>ä¸€æ¸…å­</b></sub> <br><br> å¤§å®¶èº«ä½“å¥åº·ï¼ <br><br> æ‚¨å¯èƒ½è¿˜è®°å¾—ä¸€ä¸ªå¤§èƒ¡å­çš„è½¶äº‹ï¼Œä¹Ÿè®¸æ˜¯ä¸€ä¸ªçœŸå®çš„æ•…äº‹ï¼Œå…³äºå¦‚ä½•å‘å­¦ç”Ÿè¯¢é—®ä½¿ç”¨æ°”å‹è®¡æµ‹é‡å»ºç­‘ç‰©é«˜åº¦çš„æ–¹æ³•ã€‚ åœ¨æˆ‘çœ‹æ¥ï¼Œå­¦ç”Ÿåˆ—ä¸¾äº†å¤§çº¦20æˆ–30ç§æ–¹æ³•ï¼Œè€Œæ²¡æœ‰æåŠè€å¸ˆæœŸæœ›çš„ç›´æ¥ï¼ˆé€šè¿‡å‹åŠ›å·®å¼‚ï¼‰ã€‚ <br><br> åŒæ ·ï¼Œæˆ‘æƒ³ç»§ç»­è®¨è®ºå°†C ++ç”¨äºå¾®æ§åˆ¶å™¨ï¼Œå¹¶è€ƒè™‘ä½¿ç”¨C ++å¤„ç†å¯„å­˜å™¨çš„æ–¹å¼ã€‚ æˆ‘æƒ³æŒ‡å‡ºï¼Œè¦å®ç°å¯¹å¯„å­˜å™¨çš„å®‰å…¨è®¿é—®ï¼Œå°†æ²¡æœ‰ç®€å•çš„æ–¹æ³•ã€‚ æˆ‘å°†å°è¯•å±•ç¤ºè¯¥æ–¹æ³•çš„æ‰€æœ‰ä¼˜ç¼ºç‚¹ã€‚ å¦‚æœæ‚¨çŸ¥é“æ›´å¤šæ–¹æ³•ï¼Œè¯·å°†å…¶æ”¾å…¥æ³¨é‡Šä¸­ã€‚ å› æ­¤ï¼Œè®©æˆ‘ä»¬å¼€å§‹ï¼š <br><a name="habracut"></a><br><h3> æ–¹æ³•1ã€‚æ˜¾è€Œæ˜“è§ï¼Œæ˜¾ç„¶ä¸æ˜¯æœ€å¥½çš„ </h3><br> æœ€å¸¸è§çš„æ–¹æ³•ï¼ˆä¹Ÿåœ¨C ++ä¸­ä½¿ç”¨ï¼‰æ˜¯ä½¿ç”¨åˆ¶é€ å•†çš„å¤´æ–‡ä»¶ä¸­çš„å¯„å­˜å™¨ç»“æ„æè¿°ã€‚ ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘å°†ä½¿ç”¨STM32F411å¾®æ§åˆ¶å™¨çš„ä¸¤ä¸ªç«¯å£Aå¯„å­˜å™¨ï¼ˆODR-è¾“å‡ºæ•°æ®å¯„å­˜å™¨å’ŒIDR-è¾“å…¥æ•°æ®å¯„å­˜å™¨ï¼‰ï¼Œä»¥ä¾¿æ‰§è¡Œâ€œåˆºç»£â€â€œ Hello worldâ€æ“ä½œ-ä½¿LEDé—ªçƒã€‚ <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ GPIOA-&gt;ODR ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>) ; GPIOA-&gt;IDR ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>) ; <span class="hljs-comment"><span class="hljs-comment">//,      }</span></span></code> </pre> <br> è®©æˆ‘ä»¬çœ‹çœ‹è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆä»¥åŠè¯¥è®¾è®¡å¦‚ä½•å·¥ä½œã€‚ å¾®å¤„ç†å™¨å¤´åŒ…å«<code>GPIO_TypeDef</code>ç»“æ„å’ŒæŒ‡å‘è¯¥<code>GPIOA</code>ç»“æ„çš„æŒ‡é’ˆå®šä¹‰ã€‚ çœ‹èµ·æ¥åƒè¿™æ ·ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> __IO <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> MODER; <span class="hljs-comment"><span class="hljs-comment">//port mode register, Address offset: 0x00 __IO uint32_t OTYPER; //port output type register, Address offset: 0x04 __IO uint32_t OSPEEDR; //port output speed register, Address offset: 0x08 __IO uint32_t PUPDR; //port pull-up/pull-down register, Address offset: 0x0C __IO uint32_t IDR; //port input data register, Address offset: 0x10 __IO uint32_t ODR; //port output data register, Address offset: 0x14 __IO uint32_t BSRR; //port bit set/reset register, Address offset: 0x18 __IO uint32_t LCKR; //port configuration lock register, Address offset: 0x1C __IO uint32_t AFR[2]; //alternate function registers, Address offset: 0x20-0x24 } GPIO_TypeDef; #define PERIPH_BASE 0x40000000U //Peripheral base address in the alias region #define AHB1PERIPH_BASE (PERIPH_BASE + 0x00020000U) #define GPIOA_BASE (AHB1PERIPH_BASE + 0x0000U) #define GPIOA ((GPIO_TypeDef *) GPIOA_BASE)</span></span></code> </pre><br> ç”¨ç®€å•çš„è¯­è¨€æ¥è¯´ï¼Œ <code>GPIO_TypeDef</code>ç±»å‹çš„æ•´ä¸ªç»“æ„ä¼šåœ¨åœ°å€<code>GPIOA_BASE</code>æ”¾ä¸‹' <code>GPIOA_BASE</code> ï¼Œå½“æ‚¨å¼•ç”¨ç»“æ„çš„ç‰¹å®šå­—æ®µæ—¶ï¼Œæ‚¨å®é™…ä¸Šæ˜¯åœ¨å¼•ç”¨æ­¤ç»“æ„çš„åœ°å€+è¯¥ç»“æ„å…ƒç´ çš„åç§»é‡ã€‚ å¦‚æœåˆ é™¤<code>#define GPIOA</code> ï¼Œåˆ™ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="cpp hljs">((GPIO_TypeDef *) GPIOA_BASE)-&gt;ODR ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>) ; ((GPIO_TypeDef *) GPIOA_BASE)-&gt;IDR ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>) ; <span class="hljs-comment"><span class="hljs-comment">//</span></span></code> </pre><br> å…³äºC ++ç¼–ç¨‹è¯­è¨€ï¼Œæ•´æ•°åœ°å€è¢«è½¬æ¢ä¸º<code>GPIO_TypeDef</code>ç»“æ„çš„æŒ‡é’ˆç±»å‹ã€‚ ä½†æ˜¯åœ¨C ++ä¸­ï¼Œå½“ä½¿ç”¨Cè½¬æ¢æ—¶ï¼Œç¼–è¯‘å™¨å°†å°è¯•æŒ‰ä»¥ä¸‹é¡ºåºæ‰§è¡Œè½¬æ¢ï¼š <br><br><ul><li>  const_cast </li><li>  static_cast </li><li>  const_castæ—è¾¹çš„static_castï¼Œ </li><li>  reinterpret_cast </li><li>  const_castæ—è¾¹çš„reinterpret_cast </li></ul><br> å³ å¦‚æœç¼–è¯‘å™¨æ— æ³•ä½¿ç”¨const_castè½¬æ¢ç±»å‹ï¼Œåˆ™å®ƒå°†å°è¯•åº”ç”¨static_castç­‰ç­‰ã€‚ ç»“æœï¼Œè¯¥è°ƒç”¨ï¼š <br><br><pre> <code class="cpp hljs">((GPIO_TypeDef *) GPIOA_BASE)-&gt;ODR ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>) ;</code> </pre> <br> æ²¡æœ‰ä»€ä¹ˆåƒï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;GPIO_TypeDef *&gt; (GPIOA_BASE)-&gt;ODR ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>) ;</code> </pre> <br> å®é™…ä¸Šï¼Œå¯¹äºC ++åº”ç”¨ç¨‹åºï¼Œå°†ç»“æ„â€œæ‹‰â€åˆ°åœ°å€ä¸Šæ˜¯æ­£ç¡®çš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="cpp hljs">GPIO_TypeDef * GPIOA{<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;GPIO_TypeDef *&gt;(GPIOA_BASE)} ;</code> </pre> <br> åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œç”±äºç±»å‹è½¬æ¢ï¼Œå¯¹äºC ++è€Œè¨€ï¼Œè¿™ç§æ–¹æ³•éƒ½æœ‰å¾ˆå¤§çš„ç¼ºç‚¹ã€‚ å…¶åŸå› åœ¨äºï¼Œæ—¢ä¸èƒ½åœ¨<code>constexpr</code>æ„é€ å‡½æ•°å’Œå‡½æ•°ä¸­ä¹Ÿä¸èƒ½åœ¨æ¨¡æ¿å‚æ•°ä¸­ä½¿ç”¨<code>reinterpret_cast</code> ï¼Œè¿™å¤§å¤§å‡å°‘äº†å¾®æ§åˆ¶å™¨ä½¿ç”¨C ++åŠŸèƒ½çš„å¯èƒ½æ€§ã€‚ <br> æˆ‘å°†ä¸¾ä¾‹è¯´æ˜ã€‚ å¯ä»¥è¿™æ ·åšï¼š <br><br><pre> <code class="cpp hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b; } ; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;Test* mystruct&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Geta</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mystruct-&gt;a; } Test test{<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Geta&lt;&amp;test&gt;() ; }</code> </pre><br> ä½†æ˜¯æ‚¨è¿˜ä¸èƒ½è¿™æ ·åšï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;GPIO_TypeDef * mystruct&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">volatile</span></span></span><span class="hljs-function"> uint32_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetIdr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mystruct-&gt;IDR; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//GPIOA  reinterpret_cast&lt;GPIO_TypeDef *&gt; (GPIOA_BASE) //  ,        GetIdr&lt;GPIOA&gt;() ; // } //      : struct Port { constexpr Port(GPIO_TypeDef * ptr): port(*ptr) {} GPIO_TypeDef &amp; port ; } //  GPIOA  reinterpret_cast,   //  constexpr      constexpr Port portA{GPIOA}; //   </span></span></code> </pre><br> å› æ­¤ï¼Œè¿™ç§æ–¹æ³•çš„ç›´æ¥ä½¿ç”¨å¯¹C ++çš„ä½¿ç”¨æ–½åŠ äº†å¾ˆå¤§çš„é™åˆ¶ã€‚ ä½¿ç”¨è¯­è¨€å·¥å…·ï¼Œæˆ‘ä»¬å°†æ— æ³•åœ¨ROMä¸­æ‰¾åˆ°è¦ä½¿ç”¨<code>GPIOA</code>çš„å¯¹è±¡ï¼Œä¹Ÿæ— æ³•åˆ©ç”¨æ­¤ç±»å¯¹è±¡çš„å…ƒç¼–ç¨‹ä¼˜åŠ¿ã€‚ <br> å¦å¤–ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™ç§æ–¹æ³•å¹¶ä¸å®‰å…¨ï¼ˆå°±åƒæˆ‘ä»¬çš„è¥¿æ–¹ä¼™ä¼´æ‰€è¯´çš„é‚£æ ·ï¼‰ã€‚ æ¯•ç«Ÿï¼Œå¾ˆå¯èƒ½ä¼šåšå‡ºä¸€äº›éä¹è¶£ <br> ç»“åˆä»¥ä¸Šå†…å®¹ï¼Œæˆ‘ä»¬æ€»ç»“ï¼š <br><blockquote><h4> ä¼˜ç‚¹ </h4><br><ul><li> ä½¿ç”¨åˆ¶é€ å•†çš„æ ‡é¢˜ï¼ˆå·²æ£€æŸ¥ï¼Œæ²¡æœ‰é”™è¯¯ï¼‰ </li><li> æ‚¨æ— éœ€æ‰¿æ‹…å…¶ä»–é¢å¤–çš„æ‰‹åŠ¿å’Œè´¹ç”¨ </li><li> æ˜“ç”¨æ€§ </li><li> æ¯ä¸ªäººéƒ½çŸ¥é“å¹¶ç†è§£è¿™ç§æ–¹æ³•ã€‚ </li><li> æ— å¼€é”€ </li></ul><br><h4> ç¼ºç‚¹ </h4><br><ul><li> å…ƒç¼–ç¨‹çš„æœ‰é™ä½¿ç”¨ </li><li> æ— æ³•åœ¨constexpræ„é€ å‡½æ•°ä¸­ä½¿ç”¨ </li><li> åœ¨ç±»ä¸­ä½¿ç”¨åŒ…è£…å™¨æ—¶ï¼ŒRAMçš„é¢å¤–æ¶ˆè€—æ˜¯æŒ‡å‘æ­¤ç»“æ„çš„å¯¹è±¡çš„æŒ‡é’ˆ </li><li> ä½ å¯ä»¥å˜å¾—æ„šè ¢ </li></ul></blockquote> ç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ–¹æ³•2 <br><br><h3> æ–¹æ³•2ï¼šæ®‹é…· </h3><br> æ˜¾ç„¶ï¼Œæ¯ä¸ªåµŒå…¥å¼ç¼–ç¨‹äººå‘˜éƒ½ç‰¢è®°æ‰€æœ‰å¾®æ§åˆ¶å™¨çš„æ‰€æœ‰å¯„å­˜å™¨çš„åœ°å€ï¼Œå› æ­¤æ‚¨å¯ä»¥å§‹ç»ˆä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä»ç¬¬ä¸€ä¸ªå¼€å§‹ï¼š <br><br><pre> <code class="cpp hljs">*<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> *&gt;(GpioaOdrAddr) ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt;<span class="hljs-number"><span class="hljs-number">5</span></span>) ; *<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> *&gt;(GpioaIdrAddr) ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt;<span class="hljs-number"><span class="hljs-number">5</span></span>) ; <span class="hljs-comment"><span class="hljs-comment">//</span></span></code> </pre> <br> åœ¨ç¨‹åºä¸­çš„ä»»ä½•ä½ç½®ï¼Œæ‚¨å§‹ç»ˆå¯ä»¥å°†è½¬æ¢è°ƒç”¨åˆ°<code>volatile uint32_t</code>å¯„å­˜å™¨åœ°å€ï¼Œå¹¶åœ¨å…¶ä¸­è‡³å°‘å®‰è£…ä¸€äº›å†…å®¹ã€‚ <br> è¿™é‡Œæ²¡æœ‰ç‰¹åˆ«çš„å¥½å¤„ï¼Œä½†æ˜¯ç»™é‚£äº›ç¼ºç‚¹å¸¦æ¥äº†ä½¿ç”¨ä¸Šçš„ä¸ä¾¿ï¼Œå¹¶ä¸”éœ€è¦è‡ªå·±å°†æ¯ä¸ªå¯„å­˜å™¨çš„åœ°å€å†™å…¥ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬è½¬å‘æ–¹æ³•3ã€‚ <br><br><h3> æ–¹æ³•3ã€‚æ˜æ˜¾ï¼Œæ˜¾ç„¶æ›´æ­£ç¡® </h3><br> å¦‚æœé€šè¿‡ç»“æ„å­—æ®µè®¿é—®å¯„å­˜å™¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ•´æ•°ç»“æ„åœ°å€ä»£æ›¿ç»“æ„å¯¹è±¡çš„æŒ‡é’ˆã€‚ ç»“æ„çš„åœ°å€ä½äºåˆ¶é€ å•†çš„å¤´æ–‡ä»¶ä¸­ï¼ˆä¾‹å¦‚ï¼Œç”¨äºGPIOAçš„GPIOA_BASEï¼‰ï¼Œå› æ­¤æ‚¨æ— éœ€è®°ä½å®ƒï¼Œä½†æ˜¯å¯ä»¥åœ¨æ¨¡æ¿å’Œconstexprè¡¨è¾¾å¼ä¸­ä½¿ç”¨å®ƒï¼Œç„¶åå°†ç»“æ„â€œè¦†ç›–â€åˆ°è¯¥åœ°å€ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> addr, <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> pinNum&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pin</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Registers = GPIO_TypeDef ; __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Toggle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     addr Registers *GpioPort{reinterpret_cast&lt;Registers*&gt;(addr)}; GpioPort-&gt;ODR ^= (1 &lt;&lt; pinNum) ; } }; int main() { using Led1 = Pin&lt;GPIOA_BASE, 5&gt; ; Led1::Toggle() ; }</span></span></code> </pre><br> ä»æˆ‘çš„è§’åº¦æ¥çœ‹ï¼Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ç¼ºç‚¹ã€‚ åŸåˆ™ä¸Šæ˜¯ä¸€ç§å·¥ä½œé€‰æ‹©ã€‚ ä½†æ˜¯ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å…¶ä»–æ–¹å¼ã€‚ <br><br><h3> æ–¹æ³•4ã€‚å¤–åŒ…è£… </h3><br> å¯¹äºå¯ä»¥ç†è§£çš„ä»£ç çš„é‰´èµå®¶ï¼Œæ‚¨å¯ä»¥åœ¨å¯„å­˜å™¨ä¸Šè¿›è¡ŒåŒ…è£…ï¼Œä»¥ä¾¿äºè®¿é—®å®ƒä»¬å¹¶çœ‹ä¸Šå»â€œç¾ä¸½â€ï¼Œæ„é€ ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œé‡æ–°å®šä¹‰è¿ç®—ç¬¦ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Register</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">explicit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Register</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> addr)</span></span></span><span class="hljs-function"> : ptr</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> *&gt;(addr) } { } __forceinline <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> Register&amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>^=(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> right) { *ptr ^= right; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> *ptr; <span class="hljs-comment"><span class="hljs-comment">//    }; int main() { Register Odr{GpioaOdrAddr}; Odr ^= (1 &lt;&lt; 5); Register Idr{GpioaIdrAddr}; Idr ^= (1 &lt;&lt; 5); // }</span></span></code> </pre><br> å¦‚æ‚¨æ‰€è§ï¼Œæ‚¨å°†ä¸å¾—ä¸å†æ¬¡è®°ä½æ‰€æœ‰å¯„å­˜å™¨çš„æ•´æ•°åœ°å€ï¼Œæˆ–è€…å°†å®ƒä»¬è®¾ç½®åœ¨æŸä¸ªä½ç½®ï¼Œå¹¶ä¸”è¿˜å¿…é¡»å­˜å‚¨æŒ‡å‘å¯„å­˜å™¨åœ°å€çš„æŒ‡é’ˆã€‚ ä½†æ˜¯åˆä¸æ˜¯å¾ˆå¥½ï¼Œ <code>reinterpret_cast</code>åœ¨æ„é€ å‡½æ•°ä¸­å†æ¬¡å‘ç”Ÿ <br> ä¸€äº›ç¼ºç‚¹ï¼Œä»¥åŠåœ¨ç¬¬ä¸€ç‰ˆå’Œç¬¬äºŒç‰ˆä¸­å¢åŠ äº†ä¸€ä¸ªéœ€æ±‚ï¼Œå³æ¯ä¸ªä½¿ç”¨çš„å¯„å­˜å™¨éƒ½éœ€è¦åœ¨RAMä¸­å­˜å‚¨æŒ‡å‘4ä¸ªå­—èŠ‚çš„æŒ‡é’ˆã€‚ é€šå¸¸ï¼Œè¿™ä¸æ˜¯ä¸€ç§é€‰æ‹©ã€‚ æˆ‘ä»¬çœ‹ä¸‹é¢çš„å†…å®¹ã€‚ <br><br><h3> æ–¹æ³•4,5ã€‚ å¸¦å›¾æ¡ˆçš„å¤–åŒ…è£… </h3><br> æˆ‘ä»¬æ·»åŠ äº†ä¸€äº›å…ƒç¼–ç¨‹ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å¤ªå¤šå¥½å¤„ã€‚ æ­¤æ–¹æ³•ä¸ä¸Šä¸€ä¸ªæ–¹æ³•çš„ä¸åŒä¹‹å¤„ä»…åœ¨äºåœ°å€æœªä¼ è¾“åˆ°æ„é€ å‡½æ•°ï¼Œè€Œæ˜¯åœ¨æ¨¡æ¿å‚æ•°ä¸­ï¼Œå½“å°†åœ°å€ä¼ é€’ç»™æ„é€ å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬åœ¨å¯„å­˜å™¨ä¸ŠèŠ‚çœäº†ä¸€ç‚¹ï¼Œè¿™å·²ç»å¾ˆå¥½ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> addr&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Register</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Register() : ptr{<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> *&gt;(addr)} { } __forceinline <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> Register &amp;<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>^=(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> right) { *ptr ^= right; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> *ptr; }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> GpioaOdr = Register&lt;GpioaOdrAddr&gt;; GpioaOdr Odr; Odr ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> GpioaIdr = Register&lt;GpioaIdrAddr&gt;; GpioaIdr Idr; Idr ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>); <span class="hljs-comment"><span class="hljs-comment">// }</span></span></code> </pre><br> å› æ­¤ï¼Œç›¸åŒçš„è€™å­ï¼Œä¾§è§†å›¾ã€‚ <br><br><h3> æ–¹æ³•5.åˆç† </h3><br> æ˜¾ç„¶ï¼Œæ‚¨éœ€è¦åˆ é™¤æŒ‡é’ˆï¼Œæ‰€ä»¥æˆ‘ä»¬åšåŒæ ·çš„äº‹æƒ…ï¼Œåªæ˜¯ä»ç±»ä¸­åˆ é™¤ä¸å¿…è¦çš„æŒ‡é’ˆã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> addr&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Register</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: __forceinline Register &amp;<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>^=(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> right) { *<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> *&gt;(addr) ^= right; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } }; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> GpioaOdr = Register&lt;GpioaOdrAddr&gt;; GpioaOdr Odr; Odr ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> GpioaIdr = Register&lt;GpioaIdrAddr&gt;; GpioaIdr Idr; Idr ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>); <span class="hljs-comment"><span class="hljs-comment">//</span></span></code> </pre><br> æ‚¨å¯ä»¥å¾…åœ¨è¿™é‡Œæ€è€ƒä¸€ä¸‹ã€‚ æ­¤æ–¹æ³•ç«‹å³è§£å†³äº†ä»¥å‰ä»ç¬¬ä¸€ç§æ–¹æ³•ç»§æ‰¿çš„2ä¸ªé—®é¢˜ã€‚ é¦–å…ˆï¼Œç°åœ¨æˆ‘å¯ä»¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨æŒ‡å‘<code>Register</code>å¯¹è±¡çš„æŒ‡é’ˆï¼Œå…¶æ¬¡ï¼Œå¯ä»¥å°†å…¶ä¼ é€’ç»™<code>constexrp</code>æ„é€ å‡½æ•°ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;Register * <span class="hljs-keyword"><span class="hljs-keyword">register</span></span>&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Xor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mask)</span></span></span><span class="hljs-function"> </span></span>{ *<span class="hljs-keyword"><span class="hljs-keyword">register</span></span> ^= mask ; } Register&lt;GpioaOdrAddr&gt; GpioaOdr; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Xor&lt;&amp;GpioaOdr&gt;(<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>) ; <span class="hljs-comment"><span class="hljs-comment">//  } //   struct Port { constexpr Port(Register&amp; ref): register(ref) {} Register &amp; register ; } constexpr Port portA{GpioaOdr};</span></span></code> </pre><br> å½“ç„¶ï¼Œå†æ¬¡æœ‰å¿…è¦ä¸ºå¯„å­˜å™¨çš„åœ°å€ä¿ç•™æ¼‚äº®çš„å†…å­˜ï¼Œæˆ–è€…åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­çš„æŸä¸ªä½ç½®æ‰‹åŠ¨ç¡®å®šå¯„å­˜å™¨çš„æ‰€æœ‰åœ°å€... <br><blockquote><h4> ä¼˜ç‚¹ </h4><br><ul><li> æ˜“ç”¨æ€§ </li><li> ä½¿ç”¨å…ƒç¼–ç¨‹çš„èƒ½åŠ› </li><li> å¯ä»¥åœ¨constexpræ„é€ å‡½æ•°ä¸­ä½¿ç”¨ </li></ul><br><h4> ç¼ºç‚¹ </h4><br><ul><li> æœªä½¿ç”¨åˆ¶é€ å•†éªŒè¯çš„å¤´æ–‡ä»¶ </li><li> æ‚¨å¿…é¡»è‡ªå·±è®¾ç½®å¯„å­˜å™¨çš„æ‰€æœ‰åœ°å€ </li><li> æ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªæ³¨å†Œç±»çš„å¯¹è±¡ </li><li> ä½ å¯ä»¥å˜å¾—æ„šè ¢ </li></ul></blockquote><br> å¾ˆå¥½ï¼Œä½†ä»æœ‰å¾ˆå¤šç¼ºç‚¹... <br><br><h3> æ–¹æ³•6ï¼šæ¯”åˆç†æ›´èªæ˜ </h3><br> åœ¨ä»¥å‰çš„æ–¹æ³•ä¸­ï¼Œä¸ºäº†è®¿é—®å¯„å­˜å™¨ï¼Œå¿…é¡»åˆ›å»ºè¯¥å¯„å­˜å™¨çš„å¯¹è±¡ï¼Œè¿™æ˜¯ä¸å¿…è¦çš„RAMå’ŒROMæµªè´¹ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨é™æ€æ–¹æ³•è¿›è¡ŒåŒ…è£…ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> addr&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Register</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Xor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mask)</span></span></span><span class="hljs-function"> </span></span>{ *<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> *&gt;(addr) ^= mask; } }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> Case6 ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Odr = Register&lt;GpioaOdrAddr&gt;; Odr::Xor(<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Idr = Register&lt;GpioaIdrAddr&gt;; Idr::Xor(<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>); <span class="hljs-comment"><span class="hljs-comment">// }</span></span></code> </pre><br> ä¸€åŠ  <br><blockquote><ul><li> æ²¡æœ‰å¼€é”€ã€‚ å¿«é€Ÿç´§å‡‘çš„ä»£ç ï¼Œä¸é€‰é¡¹1ç›¸åŒï¼ˆåœ¨ç±»ä¸­ä½¿ç”¨åŒ…è£…å™¨æ—¶ï¼Œæ²¡æœ‰é¢å¤–çš„RAMå¼€é”€ï¼Œå› ä¸ºæ²¡æœ‰åˆ›å»ºå¯¹è±¡ï¼Œä½†æ˜¯ä½¿ç”¨é™æ€æ–¹æ³•è€Œä¸åˆ›å»ºå¯¹è±¡ï¼‰ </li></ul></blockquote> ç»§ç»­... <br><br><h3> æ–¹æ³•7ï¼šæ¶ˆé™¤æ„šè ¢ </h3><br> æ˜¾ç„¶ï¼Œæˆ‘ç»å¸¸åœ¨ä»£ç ä¸­åšNON-FUNNYï¼Œç„¶åå°†æŸäº›å†…å®¹å†™åˆ°å¯„å­˜å™¨ä¸­ï¼Œè¿™å®é™…ä¸Šå¹¶ä¸æ˜¯è¦å†™çš„ã€‚ æ²¡å…³ç³»ï¼Œä½†æ˜¯å¿…é¡»ç¦æ­¢STUPIDnessã€‚ æˆ‘ä»¬ç¦æ­¢èƒ¡è¯´å…«é“ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¼•å…¥è¾…åŠ©ç»“æ„ï¼š <br><br><pre> <code class="cpp hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WriteReg</span></span></span><span class="hljs-class"> {</span></span>}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReadReg</span></span></span><span class="hljs-class"> {</span></span>}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReadWriteReg</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> WriteReg, <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ReadReg {};</code> </pre> <br> ç°åœ¨æˆ‘ä»¬å¯ä»¥è®¾ç½®è¦å†™å…¥çš„å¯„å­˜å™¨ï¼Œå¹¶ä¸”è¿™äº›å¯„å­˜å™¨æ˜¯åªè¯»çš„ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> addr, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> RegisterType&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Register</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-comment"><span class="hljs-comment">//       WriteReg,    // ,  ,       __forceinline template &lt;typename T = RegisterType, class = typename std::enable_if_t&lt;std::is_base_of&lt;WriteReg, T&gt;::value&gt;&gt; Register &amp;operator^=(const uint32_t right) { *reinterpret_cast&lt;volatile uint32_t *&gt;(addr) ^= right; return *this; } };</span></span></code> </pre><br> ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°è¯•ç¼–è¯‘æˆ‘ä»¬çš„æµ‹è¯•ï¼Œçœ‹çœ‹è¯¥æµ‹è¯•æ²¡æœ‰ç¼–è¯‘ï¼Œå› ä¸º<code>Idr</code>å¯„å­˜å™¨çš„<code>^=</code>è¿ç®—ç¬¦ä¸å­˜åœ¨ï¼š <br><br><pre> <code class="cpp hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> GpioaOdr = Register&lt;GpioaOdrAddr, WriteReg&gt; ; GpioaOdr Odr ; Odr ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>) ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> GpioaIdr = Register&lt;GpioaIdrAddr, ReadReg&gt; ; GpioaIdr Idr ; Idr ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>) ; <span class="hljs-comment"><span class="hljs-comment">//,  Idr    }</span></span></code> </pre> <br> æ‰€ä»¥ï¼Œç°åœ¨æœ‰æ›´å¤šä¼˜ç‚¹... <br><blockquote><h4> ä¼˜ç‚¹ </h4><br><ul><li> æ˜“ç”¨æ€§ </li><li> ä½¿ç”¨å…ƒç¼–ç¨‹çš„èƒ½åŠ› </li><li> å¯ä»¥åœ¨constexpræ„é€ å‡½æ•°ä¸­ä½¿ç”¨ </li><li> å¿«é€Ÿç´§å‡‘çš„ä»£ç ï¼Œä¸é€‰é¡¹1ç›¸åŒ </li><li> åœ¨ç±»ä¸­ä½¿ç”¨åŒ…è£…å™¨æ—¶ï¼Œæ²¡æœ‰é¢å¤–çš„RAMå¼€é”€ï¼Œå› ä¸ºæ²¡æœ‰åˆ›å»ºå¯¹è±¡ï¼Œä½†æ˜¯ä½¿ç”¨é™æ€æ–¹æ³•è€Œä¸åˆ›å»ºå¯¹è±¡ </li><li> ä½ ä¸èƒ½åšè ¢äº‹ </li></ul><br><h4> ç¼ºç‚¹ </h4><br><ul><li> æœªä½¿ç”¨åˆ¶é€ å•†éªŒè¯çš„å¤´æ–‡ä»¶ </li><li> æ‚¨å¿…é¡»è‡ªå·±è®¾ç½®å¯„å­˜å™¨çš„æ‰€æœ‰åœ°å€ </li><li> æ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªæ³¨å†Œç±»çš„å¯¹è±¡ </li></ul></blockquote><br> å› æ­¤ï¼Œè®©æˆ‘ä»¬æ¶ˆé™¤åˆ›å»ºç±»ä»¥ä¿å­˜æ›´å¤šå†…å®¹çš„æœºä¼š <br><br><h3> æ–¹æ³•8ã€‚æ²¡æœ‰NONSENSEï¼Œæ²¡æœ‰ç±»å¯¹è±¡ </h3><br> ç«‹å³ç¼–ç ï¼š <br><br><pre> <code class="cpp hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WriteReg</span></span></span><span class="hljs-class"> {</span></span>}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReadReg</span></span></span><span class="hljs-class"> {</span></span>}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReadWriteReg</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> WriteReg, <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ReadReg {}; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> addr, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Register</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: __forceinline <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T1 = T, class = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">enable_if_t</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_base_of&lt;WriteReg, T1&gt;::value&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Xor(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> mask) { *<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>*&gt;(addr) ^= mask; } }; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> main { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> GpioaOdr = Register&lt;GpioaOdrAddr, WriteReg&gt; ; GpioaOdr::Xor(<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>) ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> GpioaIdr = Register&lt;GpioaIdrAddr, ReadReg&gt; ; GpioaIdr::Xor(<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>) ; <span class="hljs-comment"><span class="hljs-comment">//,  Idr    }</span></span></code> </pre><br> æˆ‘ä»¬å†åŠ ä¸Šä¸€ä¸ªåŠ å·ï¼Œä½†ä¸åˆ›å»ºå¯¹è±¡ã€‚ ä½†æ˜¯ç»§ç»­å‰è¿›ï¼Œæˆ‘ä»¬ä»ç„¶æœ‰ç¼ºç‚¹ <br><br><h3> æ–¹æ³•9.å…·æœ‰ç»“æ„é›†æˆçš„æ–¹æ³•8 </h3><br> åœ¨ä»¥å‰çš„æ–¹æ³•ä¸­ï¼Œä»…å®šä¹‰äº†å¤§å°å†™ã€‚ ä½†æ˜¯åœ¨æ–¹æ³•1ä¸­ï¼Œæ‰€æœ‰å¯„å­˜å™¨éƒ½ç»„åˆä¸ºç»“æ„ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥é€šè¿‡æ¨¡å—æ–¹ä¾¿åœ°è®¿é—®å®ƒä»¬ã€‚ è®©æˆ‘ä»¬åšå§... <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> Case9 { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WriteReg</span></span></span><span class="hljs-class"> {</span></span>}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReadReg</span></span></span><span class="hljs-class"> {</span></span>}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReadWriteReg</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> WriteReg, <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ReadReg {}; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> addr, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Register</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: __forceinline <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T1 = T, class = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">enable_if_t</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_base_of&lt;WriteReg, T1&gt;::value&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Xor(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> mask) { *<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>*&gt;(addr) ^= mask; } }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> addr&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Gpio</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Moder = Register&lt;addr, ReadWriteReg&gt;; <span class="hljs-comment"><span class="hljs-comment">//      using Otyper = Register&lt;addr + OtyperShift, ReadWriteReg&gt; ; using Ospeedr = Register&lt;addr + OspeedrShift,ReadWriteReg&gt; ; using Pupdr = Register&lt;addr + PupdrShift,ReadWriteReg&gt; ; using Idr = Register&lt;addr + IdrShift, ReadReg&gt; ; using Odr = Register&lt;addr + OdrShift, WriteReg&gt; ; }; int main() { using Gpioa = Gpio&lt;GPIOA_BASE&gt; ; Gpioa::Odr::Xor(1 &lt;&lt; 5) ; Gpioa::Idr::Xor((1 &lt;&lt; 5) ); //,  Idr    }</span></span></code> </pre><br> è¿™é‡Œçš„ç¼ºç‚¹æ˜¯ç»“æ„å°†éœ€è¦é‡æ–°æ³¨å†Œï¼Œå¹¶ä¸”æ‰€æœ‰å¯„å­˜å™¨çš„åç§»éƒ½åº”åœ¨æŸä¸ªä½ç½®è®°ä½å¹¶ç¡®å®šã€‚ å¦‚æœåç§»æ˜¯ç”±ç¼–è¯‘å™¨è€Œä¸æ˜¯ç”±äººå‘˜è®¾ç½®çš„ï¼Œé‚£å°†æ˜¯å¾ˆå¥½çš„é€‰æ‹©ï¼Œä½†è¿™æ˜¯ç¨åçš„æ“ä½œï¼Œä½†æ˜¯ç°åœ¨ï¼Œæˆ‘ä»¬å°†è€ƒè™‘åŒäº‹å»ºè®®çš„å¦ä¸€ç§æœ‰è¶£çš„æ–¹æ³•ã€‚ <br><br><h3> æ–¹æ³•10.é€šè¿‡æŒ‡å‘ç»“æ„æˆå‘˜çš„æŒ‡é’ˆå°†å¯„å­˜å™¨æ¢è¡Œ </h3><br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™æ ·çš„æ¦‚å¿µä½œä¸ºæŒ‡å‘ç»“æ„æˆå‘˜çš„æŒ‡é’ˆå¹¶å¯¹å…¶è¿›è¡Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è®¿é—®</a> ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> addr, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RegisterStructWrapper</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: __forceinline <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> P&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Xor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PT::*member, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mask)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;T*&gt;(addr)-&gt;*member ^= mask ; <span class="hljs-comment"><span class="hljs-comment">//   ,     . } } ; using GpioaWrapper = RegisterStructWrapper&lt;GPIOA_BASE, GPIO_TypeDef&gt; ; int main() { GpioaWrapper::Xor(&amp;GPIO_TypeDef::ODR, (1 &lt;&lt; 5)) ; GpioaWrapper::Xor(&amp;GPIO_TypeDef::IDR, (1 &lt;&lt; 5)) ; // return 0 ; }</span></span></code> </pre><br><blockquote><h4> ä¼˜ç‚¹ </h4><br><ul><li> æ˜“ç”¨æ€§ </li><li> ä½¿ç”¨å…ƒç¼–ç¨‹çš„èƒ½åŠ› </li><li> å¯ä»¥åœ¨constexpræ„é€ å‡½æ•°ä¸­ä½¿ç”¨ </li><li> å¿«é€Ÿç´§å‡‘çš„ä»£ç ï¼Œä¸é€‰é¡¹1ç›¸åŒ </li><li> åœ¨ç±»ä¸­ä½¿ç”¨åŒ…è£…å™¨æ—¶ï¼Œæ²¡æœ‰é¢å¤–çš„RAMå¼€é”€ï¼Œå› ä¸ºæ²¡æœ‰åˆ›å»ºå¯¹è±¡ï¼Œä½†æ˜¯ä½¿ç”¨é™æ€æ–¹æ³•è€Œä¸åˆ›å»ºå¯¹è±¡ </li><li> ä½¿ç”¨åˆ¶é€ å•†éªŒè¯çš„å¤´æ–‡ä»¶ã€‚ </li><li> æ— éœ€è‡ªå·±è®¾ç½®æ‰€æœ‰å¯„å­˜å™¨åœ°å€ </li><li> æ— éœ€åˆ›å»ºRegisterç±»çš„å¯¹è±¡ </li></ul><br><h4> ç¼ºç‚¹ </h4><br><ul><li> æ‚¨å¯ä»¥ä½¿ä»£ç å˜å¾—æ„šè ¢ï¼Œç”šè‡³æ¨æµ‹ä»£ç çš„å¯ç†è§£æ€§ã€‚ </li></ul></blockquote><br><h3> æ–¹æ³•10.5ã€‚ ç»“åˆæ–¹æ³•9å’Œ10 </h3><br> è¦æ‰¾å‡ºç›¸å¯¹äºç»“æ„å¼€å¤´çš„å¯„å­˜å™¨ç§»ä½ï¼Œå¯ä»¥ä½¿ç”¨æŒ‡å‘è¯¥ç»“æ„æˆå‘˜çš„æŒ‡é’ˆï¼š <code>volatile uint32_t T::*member</code> ï¼Œå®ƒå°†è¿”å›è¯¥ç»“æ„æˆå‘˜ç›¸å¯¹äºå…¶å¼€å¤´çš„åç§»é‡ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å…·æœ‰<code>GPIO_TypeDef</code>ç»“æ„ï¼Œé‚£ä¹ˆåœ°å€<code>&amp;GPIO_TypeDef::ODR</code>å°†ä¸º0x14ã€‚ <br> æˆ‘ä»¬æŠ“ä½äº†è¿™ä¸ªæœºä¼šï¼Œå¹¶ä½¿ç”¨ç¼–è¯‘å™¨ä»æ–¹æ³•9è®¡ç®—å¯„å­˜å™¨çš„åœ°å€ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WriteReg</span></span></span><span class="hljs-class"> {</span></span>}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReadReg</span></span></span><span class="hljs-class"> {</span></span>}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReadWriteReg</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> WriteReg, <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ReadReg {}; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> addr, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> T::*member, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> RegType&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Register</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: __forceinline <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T1 = RegType, class = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">enable_if_t</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_base_of&lt;WriteReg, T1&gt;::value&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Xor(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> mask) { <span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;T*&gt;(addr)-&gt;*member ^= mask ; } }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> addr, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Gpio</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Moder = Register&lt;addr, GPIO_TypeDef, &amp;GPIO_TypeDef::ODR, ReadWriteReg&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Otyper = Register&lt;addr, GPIO_TypeDef, &amp;GPIO_TypeDef::OTYPER, ReadWriteReg&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Ospeedr = Register&lt;addr, GPIO_TypeDef, &amp;GPIO_TypeDef::OSPEEDR, ReadWriteReg&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pupdr = Register&lt;addr, GPIO_TypeDef, &amp;GPIO_TypeDef::PUPDR, ReadWriteReg&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Idr = Register&lt;addr, GPIO_TypeDef, &amp;GPIO_TypeDef::IDR, ReadReg&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Odr = Register&lt;addr, GPIO_TypeDef, &amp;GPIO_TypeDef::ODR, WriteReg&gt;; } ;</code> </pre> <br> æ‚¨å¯ä»¥æ›´çµæ´»åœ°ä½¿ç”¨å¯„å­˜å™¨ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> Case11 ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Gpioa = Gpio&lt;GPIOA_BASE, GPIO_TypeDef&gt; ; Gpioa::Odr::Xor(<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>) ; <span class="hljs-comment"><span class="hljs-comment">//Gpioa::Idr::Xor((1 &lt;&lt; 5) ); //,  Idr   </span></span></code> </pre> <br> æ˜¾ç„¶ï¼Œè¿™é‡Œæ‰€æœ‰ç»“æ„éƒ½å¿…é¡»å†æ¬¡é‡å†™ã€‚ è¿™å¯ä»¥é€šè¿‡Phytonä¸­çš„æŸäº›è„šæœ¬åœ¨æ–‡ä»¶è¾“å‡ºä¸­è‡ªåŠ¨è¾“å…¥ï¼Œä¾‹å¦‚stm32f411xe.hï¼Œå¹¶åœ¨C ++ä¸­ä½¿ç”¨ç»“æ„ã€‚ <br> æ— è®ºå¦‚ä½•ï¼Œåœ¨ç‰¹å®šé¡¹ç›®ä¸­å¯èƒ½æœ‰å‡ ç§ä¸åŒçš„å·¥ä½œæ–¹å¼ã€‚ <br><br><h3> çº¢åˆ© æˆ‘ä»¬ä½¿ç”¨Phytonä»‹ç»è¯­è¨€æ‰©å±•å’Œparsimä»£ç  </h3><br> åœ¨C ++ä¸­ä½¿ç”¨å¯„å­˜å™¨çš„é—®é¢˜å·²ç»å­˜åœ¨äº†ä¸€æ®µæ—¶é—´ã€‚ äººä»¬ä»¥ä¸åŒçš„æ–¹å¼è§£å†³å®ƒã€‚ å½“ç„¶ï¼Œå¦‚æœè¯¥è¯­è¨€åœ¨ç¼–è¯‘æ—¶æ”¯æŒè¯¸å¦‚é‡å‘½åç±»ä¹‹ç±»çš„è¯ï¼Œé‚£å°†æ˜¯å¾ˆå¥½çš„ã€‚ å¥½å§ï¼Œè®©æˆ‘ä»¬è¯´ï¼Œå¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;classname = [PortName]&gt; class Gpio[Portname] { __forceinline <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Xor(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> mask) { GPIO[PortName]-&gt;ODR ^= mask ; } }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> GpioA = Gpio&lt;<span class="hljs-string"><span class="hljs-string">"A"</span></span>&gt; ; GpioA::Xor(<span class="hljs-number"><span class="hljs-number">5</span></span>) ; }</code> </pre><br> ä½†æ˜¯å¾ˆé—æ†¾ï¼Œè¿™ç§è¯­è¨€ä¸æ”¯æŒã€‚ å› æ­¤ï¼Œäººä»¬ä½¿ç”¨çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨Pythonè§£æä»£ç ã€‚ å³ å¼•å…¥äº†ä¸€äº›è¯­è¨€æ‰©å±•ã€‚ ä½¿ç”¨æ­¤æ‰©å±•åçš„ä»£ç è¢«é¦ˆé€åˆ°Pythonè§£æå™¨ï¼Œè¯¥è§£æå™¨å°†å…¶è½¬æ¢ä¸ºC ++ä»£ç ã€‚ è¿™æ ·çš„ä»£ç çœ‹èµ·æ¥åƒè¿™æ ·ï¼šï¼ˆç¤ºä¾‹æ¥è‡ªmodmåº“ï¼› <a href="">è¿™æ˜¯å®Œæ•´çš„æºä»£ç </a> ï¼‰ï¼š <br><br><pre> <code class="cpp hljs">%% <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> port = gpio[<span class="hljs-string"><span class="hljs-string">"port"</span></span>] | upper %% <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> reg = <span class="hljs-string"><span class="hljs-string">"GPIO"</span></span> ~ port %% <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> pin = gpio[<span class="hljs-string"><span class="hljs-string">"pin"</span></span>] class Gpio{{ port ~ pin }} : <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Gpio { __forceinline <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Xor() { GPIO{{port}}-&gt;ODR ^= <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; {{pin}} ; } } <span class="hljs-comment"><span class="hljs-comment">//        class Gpio5 : public Gpio { __forceinline inline static void Xor() { GPIO-&gt;ODR ^= 1 &lt;&lt; 5 ; } } //     using Led = Gpio5; Led::Xor();</span></span></code> </pre><br><br><h3> æ›´æ–°ï¼šå¥–é‡‘ã€‚  Phytonä¸Šçš„SVDæ–‡ä»¶å’Œè§£æå™¨ </h3><br> å¿˜è®°æ·»åŠ å…¶ä»–é€‰é¡¹ã€‚  ARMä¸ºæ¯ä¸ªSVDåˆ¶é€ å•†å‘å¸ƒäº†ä¸€ä¸ªå¯„å­˜å™¨æè¿°æ–‡ä»¶ã€‚ ç„¶åï¼Œæ‚¨å¯ä»¥ä»ä¸­ç”Ÿæˆå¸¦æœ‰å¯„å­˜å™¨æè¿°çš„C ++æ–‡ä»¶ã€‚  Paul Osborneåœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHubä¸Š</a>ç¼–è¯‘äº†æ‰€æœ‰è¿™äº›æ–‡ä»¶ã€‚ ä»–è¿˜ç¼–å†™äº†Pythonè„šæœ¬æ¥è§£æå®ƒä»¬ã€‚ <br><br> ä»…æ­¤è€Œå·²...æˆ‘çš„æƒ³è±¡åŠ›å·²è€—å°½ã€‚ å¦‚æœæ‚¨ä»æœ‰æƒ³æ³•ï¼Œè¯·éšæ—¶ã€‚ æ‰€æœ‰æ–¹æ³•çš„ä¸€ä¸ªä¾‹å­<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å°±åœ¨è¿™é‡Œã€‚</a> <br><br><h4> å‚è€ƒæ–‡çŒ® </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">C ++ä¸­çš„ç±»å‹å®‰å…¨å¯„å­˜å™¨è®¿é—®</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åšäº‹æƒ…-ä»C ++è®¿é—®ç¡¬ä»¶</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä½¿äº‹æƒ…åšäº‹-ç¬¬3éƒ¨åˆ†</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åšäº‹æƒ…-ç»“æ„å åŠ </a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN459204/">https://habr.com/ru/post/zh-CN459204/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN459184/index.html">åŸºæœ¬åŸºæœ¬æŠ€èƒ½</a></li>
<li><a href="../zh-CN459188/index.html">Debian 10 Busterå’ŒLinux 5.2å‘å¸ƒäº†</a></li>
<li><a href="../zh-CN459194/index.html">æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨UI Kitä¸»é¢˜é€šè¿‡CSSå˜é‡ä¸SCSSæˆä¸ºæœ‹å‹</a></li>
<li><a href="../zh-CN459196/index.html">ä»æ•´ä½“åˆ°æ¨¡å—åŒ–å›¢é˜Ÿ</a></li>
<li><a href="../zh-CN459198/index.html">ClickHouseä¸­çš„æŸ¥è¯¢æ€§èƒ½åˆ†æã€‚ YandexæŠ¥å‘Š</a></li>
<li><a href="../zh-CN459206/index.html">åœ¨Node.JSçš„å·¨çŸ³ä¸­å‘†äº†9å¹´</a></li>
<li><a href="../zh-CN459208/index.html">å‡è‚¢è·‘æ­¥ï¼šåˆ©ç”¨è‚Œè‚‰ï¼Œéª¨éª¼å’Œç¥ç»ç½‘ç»œå¯¹Nekstgenè¿›è¡Œäººä½“è¿åŠ¨çš„æ¨¡æ‹Ÿ</a></li>
<li><a href="../zh-CN459212/index.html">C ++ä¸­çš„å±æ€§å®ç°</a></li>
<li><a href="../zh-CN459214/index.html">Qsanå­˜å‚¨ä¸­çš„å®¹é”™èƒ½åŠ›</a></li>
<li><a href="../zh-CN459216/index.html">Bæ ‘æ•°æ®ç»“æ„</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>