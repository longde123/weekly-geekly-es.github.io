<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíê üßë‚Äçü§ù‚Äçüßë üë≤üèº DDoS hilft: wie wir Stress und Stresstests durchf√ºhren üéç üë®‚Äçüë¶‚Äçüë¶ ü§ß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Variti entwickelt Schutz vor Bots und DDoS-Angriffen und f√ºhrt auch Stress- und Lasttests durch. Auf der HighLoad ++ 2018-Konferenz haben wir dar√ºber ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DDoS hilft: wie wir Stress und Stresstests durchf√ºhren</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/variti/blog/448626/"><img src="https://habrastorage.org/webt/ze/th/rb/zethrbwkfxc_3voyzfevkonnzao.png"><br><br>  <i>Variti entwickelt Schutz vor Bots und DDoS-Angriffen und f√ºhrt auch Stress- und Lasttests durch.</i>  <i>Auf der HighLoad ++ 2018-Konferenz haben wir dar√ºber gesprochen, wie Ressourcen vor verschiedenen Arten von Angriffen gesch√ºtzt werden k√∂nnen.</i>  <i>Kurz gesagt: Isolieren Sie Teile des Systems, verwenden Sie Cloud-Dienste und CDN und aktualisieren Sie diese regelm√§√üig.</i>  <i>Aber ohne spezialisierte Unternehmen kann man Schutz immer noch nicht tun :)</i> <br><a name="habracut"></a><br>  Bevor Sie den Text lesen, k√∂nnen Sie sich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auf der Konferenzwebsite</a> mit kurzen Abstracts vertraut machen. <br>  Und wenn Sie nicht gerne lesen oder nur ein Video ansehen m√∂chten, finden Sie die Aufzeichnung unseres Berichts unten unter dem Spoiler. <br><br><div class="spoiler">  <b class="spoiler_title">Video melden</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/Lu4tsUvfYRc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br>  Viele Unternehmen wissen bereits, wie man Stresstests durchf√ºhrt, aber nicht alle f√ºhren Stresstests durch.  Einige unserer Kunden halten ihre Website f√ºr unverwundbar, da sie √ºber ein Hochlastsystem verf√ºgen, das vor Angriffen sch√ºtzt.  Wir zeigen, dass dies nicht ganz stimmt. <br><br>  Nat√ºrlich erhalten wir vor der Durchf√ºhrung der Tests die Erlaubnis des Kunden, unterschrieben und abgestempelt, und mit unserer Hilfe k√∂nnen wir niemanden mit einem DDoS-Angriff angreifen.  Die Tests werden zu dem vom Kunden gew√§hlten Zeitpunkt durchgef√ºhrt, wenn die Anwesenheit seiner Ressource minimal ist und Zugriffsprobleme den Kunden nicht betreffen.  Da w√§hrend des Testprozesses immer etwas schief gehen kann, haben wir au√üerdem st√§ndigen Kontakt zum Kunden.  Dies erm√∂glicht nicht nur, √ºber die erzielten Ergebnisse zu berichten, sondern auch w√§hrend des Tests etwas zu √§ndern.  Am Ende der Tests erstellen wir immer einen Bericht, in dem wir auf die festgestellten M√§ngel hinweisen und Empfehlungen zur Behebung der Schwachstellen der Website geben. <br><br><h3>  Wie arbeiten wir? </h3><br>  W√§hrend des Testens emulieren wir ein Botnetz.  Da wir mit Clients arbeiten, die sich nicht in unseren Netzwerken befinden, laden wir die Last nicht von einer IP-Adresse, sondern von unserem eigenen Subnetz, um zu verhindern, dass der Test aufgrund des Ausl√∂sens von Grenzwerten oder des Schutzes in der ersten Minute endet.  Um eine erhebliche Last zu erzeugen, verf√ºgen wir √ºber einen eigenen, ziemlich leistungsstarken Testserver. <br><br><h3>  Postulate </h3><br><blockquote>  <b>Viel ist nicht gut</b> <br><br>  Je weniger Last wir die Ressource zum Ausfall bringen k√∂nnen, desto besser.  Wenn Sie es schaffen, dass die Website aufgrund einer Anforderung pro Sekunde oder sogar aufgrund einer Anforderung pro Minute nicht mehr funktioniert, ist dies in Ordnung.  Denn nach dem Gesetz der Gemeinheit fallen Benutzer oder Angreifer versehentlich in diese Sicherheitsl√ºcke. </blockquote><blockquote> <b>Teilversagen ist besser als vollst√§ndiges Versagen</b> <br><br>  Wir empfehlen immer, Systeme heterogen zu machen.  Dar√ºber hinaus lohnt es sich, sie auf physischer Ebene zu trennen und nicht nur zu containerisieren.  Im Falle einer physischen Trennung ist es wahrscheinlich, dass die Funktion nicht vollst√§ndig aufh√∂rt, selbst wenn auf der Site ein Fehler auftritt, und die Benutzer weiterhin Zugriff auf mindestens einen Teil der Funktionen haben. </blockquote><blockquote>  <b>Die richtige Architektur ist die Grundlage f√ºr Nachhaltigkeit</b> <br><br>  Die Fehlertoleranz einer Ressource und ihre F√§higkeit, Angriffen und Belastungen standzuhalten, sollten in der Entwurfsphase festgelegt werden, und zwar in der Phase des Zeichnens der ersten Blockdiagramme in einem Notizbuch.  Denn wenn sich schwerwiegende Fehler einschleichen, k√∂nnen Sie diese in Zukunft korrigieren, dies ist jedoch sehr schwierig. </blockquote><blockquote>  <b>Nicht nur Code sollte gut sein, sondern auch eine Konfiguration</b> <br><br>  Viele Leute denken, dass ein gutes Entwicklungsteam eine Garantie f√ºr Service-Ausfallsicherheit ist.  Ein gutes Entwicklungsteam ist wirklich notwendig, aber es muss auch einen guten Betrieb geben, gute DevOps.  Das hei√üt, wir brauchen Spezialisten, die Linux und das Netzwerk richtig konfigurieren, Konfigurationen in Nginx richtig schreiben, Limits konfigurieren und vieles mehr.  Andernfalls funktioniert die Ressource nur beim Test gut, und in der Produktion wird irgendwann alles kaputt gehen. </blockquote><blockquote>  <b>Unterschiede zwischen Stress und Stresstests</b> <br><br>  Mit Lasttests k√∂nnen Sie die Grenzen des Systems identifizieren.  Stresstests zielen darauf ab, die Schw√§chen des Systems zu ermitteln. Sie dienen dazu, dieses System zu besch√§digen und festzustellen, wie es sich beim Ausfall bestimmter Teile verh√§lt.  Gleichzeitig bleibt dem Kunden die Art der Belastung bis zum Beginn der Stresstests in der Regel unbekannt. </blockquote><h3>  Besonderheiten von L7-Angriffen </h3><br>  Normalerweise teilen wir die Lasttypen in Lasten auf der Ebene von L7 und L3 &amp; 4 auf.  L7 ist eine Last auf Anwendungsebene, meistens wird es nur als HTTP verstanden, aber wir meinen jede Last auf TCP-Protokollebene. <br><br>  L7-Angriffe weisen bestimmte Unterscheidungsmerkmale auf.  Erstens kommen sie direkt zur Anwendung, das hei√üt, es ist unwahrscheinlich, dass sie durch Netzwerkmittel reflektiert werden k√∂nnen.  Solche Angriffe verwenden Logik und verbrauchen daher CPU, Speicher, Festplatte, Datenbank und andere Ressourcen sehr effizient und mit wenig Verkehr. <br><br><h3>  HTTP-Flut </h3><br>  Im Falle eines Angriffs ist die Last einfacher zu erstellen als zu handhaben, und im Fall von L7 gilt dies auch.  Angriffsverkehr ist nicht immer leicht von legitim zu unterscheiden und kann meistens nach H√§ufigkeit durchgef√ºhrt werden. Wenn jedoch alles richtig geplant ist, ist es unm√∂glich zu verstehen, wo sich der Angriff befindet und wo legitime Anforderungen aus den Protokollen stammen. <br><br>  Betrachten Sie als erstes Beispiel einen HTTP-Flood-Angriff.  Die Grafik zeigt, dass solche Angriffe normalerweise sehr m√§chtig sind. Im folgenden Beispiel hat die maximale Anzahl von Anforderungen 600.000 pro Minute √ºberschritten. <br><br><img src="https://habrastorage.org/webt/rl/-i/qz/rl-iqze06e8bg4epyzgcsfpwddu.png"><br><br>  HTTP Flood ist der einfachste Weg, eine Last zu erstellen.  Normalerweise wird daf√ºr eine Art Lasttest-Tool verwendet, z. B. ApacheBench, und die Anforderung und der Zweck werden festgelegt.  Mit einem so einfachen Ansatz kann es wahrscheinlich zu Server-Caching kommen, aber es ist einfach, sich fortzubewegen.  F√ºgen Sie der Abfrage beispielsweise zuf√§llige Zeilen hinzu, wodurch der Server gezwungen wird, st√§ndig eine neue Seite zu erstellen. <br>  Vergessen Sie auch nicht, den Benutzeragenten beim Erstellen einer Last zu ber√ºcksichtigen.  Viele Benutzeragenten g√§ngiger Testtools werden von Systemadministratoren gefiltert. In diesem Fall erreicht die Last m√∂glicherweise einfach nicht das Backend.  Sie k√∂nnen das Ergebnis erheblich verbessern, indem Sie einen mehr oder weniger g√ºltigen Header aus dem Browser in die Anforderung einf√ºgen. <br>  Bei aller Einfachheit haben HTTP-Flood-Angriffe ihre Nachteile.  Erstens sind gro√üe Kapazit√§ten erforderlich, um eine Last zu erzeugen.  Zweitens sind solche Angriffe sehr leicht zu erkennen, insbesondere wenn sie von derselben Adresse stammen.  Infolgedessen werden Anforderungen sofort entweder von Systemadministratoren oder sogar auf Anbieterebene gefiltert. <br><br><h3>  Worauf zu achten ist </h3><br>  Um die Anzahl der Anfragen pro Sekunde zu reduzieren und dennoch nicht an Effizienz zu verlieren, m√ºssen Sie ein wenig Fantasie zeigen und die Site erkunden.  Sie k√∂nnen also nicht nur den Kanal oder Server laden, sondern auch einzelne Teile der Anwendung, z. B. Datenbanken oder Dateisysteme.  Sie k√∂nnen auch nach Orten auf der Website suchen, die hervorragende Berechnungen durchf√ºhren: Taschenrechner, Produktauswahlseiten und mehr.  Schlie√ülich kommt es h√§ufig vor, dass es auf der Site ein PHP-Skript gibt, das eine Seite mit mehreren hunderttausend Zeilen generiert.  Ein solches Skript l√§dt auch den Server stark und kann zum Angriffsziel werden. <br><br><h3>  Wo soll man suchen? </h3><br>  Wenn wir eine Ressource vor dem Testen scannen, schauen wir uns nat√ºrlich zun√§chst die Site selbst an.  Wir suchen nach allen Arten von Eingabefeldern, schweren Dateien - im Allgemeinen nach allem, was Probleme f√ºr eine Ressource verursachen und deren Betrieb verlangsamen kann.  Hier zeigen g√§ngige Entwicklungstools in Google Chrome und Firefox die Antwortzeit der Seite an. <br><br>  Wir scannen auch Subdomains.  Zum Beispiel gibt es einen bestimmten Online-Shop, abc.com, und er hat eine Subdomain admin.abc.com.  Dies ist h√∂chstwahrscheinlich das Admin-Panel mit Berechtigung. Wenn Sie jedoch eine Last in das Panel einf√ºgen, kann dies zu Problemen f√ºr die Hauptressource f√ºhren. <br><br>  Die Site hat m√∂glicherweise eine Subdomain api.abc.com.  Dies ist h√∂chstwahrscheinlich eine Ressource f√ºr mobile Anwendungen.  Die Anwendung kann im App Store oder bei Google Play gefunden werden, einen speziellen Zugangspunkt einrichten, die API zerlegen und Testkonten registrieren.  Das Problem ist, dass die Leute oft denken, dass alles, was durch Autorisierung gesch√ºtzt ist, immun gegen Denial-of-Service-Angriffe ist.  Angeblich ist die Autorisierung das beste CAPTCHA, aber nicht.  Das Erstellen von 10 bis 20 Testkonten ist einfach. Durch das Erstellen dieser Konten erhalten wir Zugriff auf komplexe und unverh√ºllte Funktionen. <br><br>  Nat√ºrlich schauen wir uns den Verlauf an, bei robots.txt und WebArchive, ViewDNS, suchen wir nach alten Versionen der Ressource.  Manchmal kommt es vor, dass die Entwickler beispielsweise mail2.yandex.net eingef√ºhrt haben, aber die alte Version mail.yandex.net blieb erhalten.  Dieses mail.yandex.net wird nicht mehr unterst√ºtzt, Entwicklungsressourcen werden ihm nicht zugewiesen, es verbraucht jedoch weiterhin die Datenbank.  Dementsprechend k√∂nnen Sie mit der alten Version die Ressourcen des Backends und alles, was sich hinter dem Layout befindet, effektiv nutzen.  Das passiert nat√ºrlich nicht immer, aber so etwas begegnen wir immer noch. <br><br>  Nat√ºrlich analysieren wir alle Anforderungsparameter und die Cookie-Struktur.  Sie k√∂nnen beispielsweise einen Wert in das JSON-Array innerhalb des Cookies verschieben, mehr Verschachtelung erstellen und die Ressource unangemessen lange arbeiten lassen. <br><br><h3>  Suchlast </h3><br>  Das erste, was bei der Recherche einer Website in den Sinn kommt, ist das Laden der Datenbank, da fast jeder eine Suche hat und leider fast jeder schlecht gesch√ºtzt ist.  Aus irgendeinem Grund schenken die Entwickler der Suche nicht gen√ºgend Aufmerksamkeit.  Es gibt jedoch eine Empfehlung: Stellen Sie nicht die gleiche Art von Anforderungen, da m√∂glicherweise Caching auftritt, wie dies bei der HTTP-Flut der Fall ist. <br><br>  Zuf√§llige Abfragen in der Datenbank sind ebenfalls nicht immer effizient.  Es ist viel besser, eine Liste von Schl√ºsselw√∂rtern zu erstellen, die f√ºr die Suche relevant sind.  Wenn Sie zum Beispiel eines Online-Shops zur√ºckkehren: Nehmen wir an, die Website verkauft Autoreifen und erm√∂glicht es Ihnen, den Radius der Reifen, den Autotyp und andere Parameter festzulegen.  Dementsprechend f√ºhren Kombinationen relevanter W√∂rter dazu, dass die Datenbank unter viel komplexeren Bedingungen funktioniert. <br><br>  Dar√ºber hinaus lohnt es sich, die Paginierung zu verwenden: Bei einer Suche ist es viel schwieriger, die vorletzte Seite eines Problems zur√ºckzugeben als bei der ersten.  Das hei√üt, mit Hilfe der Paginierung k√∂nnen Sie die Last ein wenig diversifizieren. <br><br>  Im folgenden Beispiel zeigen wir die Last in der Suche.  Es ist ersichtlich, dass ab der ersten Sekunde des Tests mit einer Geschwindigkeit von zehn Anfragen pro Sekunde die Site ausfiel und nicht reagierte. <br><br><img src="https://habrastorage.org/webt/dg/bu/oa/dgbuoarg4u2ufo9_jw1w2nxkurq.png"><br><br><h3>  Wenn es keine Suche gibt? </h3><br>  Wenn keine Suche durchgef√ºhrt wird, bedeutet dies nicht, dass die Site keine anderen anf√§lligen Eingabefelder enth√§lt.  Dieses Feld kann eine Autorisierung sein.  Jetzt erstellen Entwickler gerne komplexe Hashes, um die Anmeldedatenbank vor Angriffen auf Regenbogentabellen zu sch√ºtzen.  Das ist gut, aber solche Hashes verbrauchen gro√üe CPU-Ressourcen.  Ein gro√üer Strom falscher Berechtigungen f√ºhrt zu einem Prozessorausfall. Infolgedessen arbeitet die Site nicht mehr an der Ausgabe. <br><br>  Das Vorhandensein von Formularen aller Art f√ºr Kommentare und R√ºckmeldungen auf der Website ist eine Gelegenheit, sehr gro√üe Texte dorthin zu senden oder einfach eine massive Flut zu erzeugen.  Manchmal akzeptieren Websites Dateianh√§nge, auch im gzip-Format.  In diesem Fall nehmen wir eine 1-TB-Datei, komprimieren sie mit gzip auf einige Bytes oder Kilobyte und senden sie an die Site.  Dann wird es entpackt und ein sehr interessanter Effekt erzielt. <br><br><h3>  Rest API </h3><br>  Ich m√∂chte ein wenig auf so beliebte Dienste wie die Rest-API achten.  Der Schutz der Rest-API ist viel schwieriger als eine normale Site.  F√ºr die Rest-API funktionieren selbst triviale Methoden zum Schutz vor Passwort-Cracking und anderen illegitimen Aktivit√§ten nicht. <br><br>  Die Rest-API ist sehr leicht zu brechen, da sie direkt auf die Datenbank zugreift.  Gleichzeitig hat der Ausfall eines solchen Dienstes schwerwiegende Folgen f√ºr das Unternehmen.  Tatsache ist, dass die Rest-API normalerweise nicht nur die Hauptwebsite, sondern auch die mobile Anwendung und einige interne Gesch√§ftsressourcen umfasst.  Und wenn all dies abf√§llt, ist der Effekt viel st√§rker als im Fall des Ausfalls einer einfachen Site. <br><br><h3>  Starke Inhaltslast </h3><br>  Wenn uns angeboten wird, eine gew√∂hnliche einseitige Anwendung, Zielseite oder Visitenkarten-Website zu testen, die keine komplexen Funktionen aufweisen, suchen wir nach umfangreichen Inhalten.  Zum Beispiel gro√üe Bilder, die der Server liefert, Bin√§rdateien, PDF-Dokumentation - wir versuchen, alles herauszupumpen.  Solche Tests laden das Dateisystem gut und verstopfen die Kan√§le und sind daher effektiv.  Das hei√üt, selbst wenn Sie den Server nicht herunterfahren und eine gro√üe Datei mit niedriger Geschwindigkeit herunterladen, verstopfen Sie einfach den Kanal des Zielservers und es kommt zu einem Denial-of-Service. <br>  Ein Beispiel f√ºr einen solchen Test zeigt, dass die Site bei einer Geschwindigkeit von 30 RPS nicht mehr reagierte oder 500 Serverfehler generierte. <br><br><img src="https://habrastorage.org/webt/qc/wt/o-/qcwto-1m01beyofdf9vwgov8a6g.png"><br><br>  Vergessen Sie nicht, Server einzurichten.  Sie k√∂nnen h√§ufig feststellen, dass eine Person eine virtuelle Maschine gekauft, Apache dort installiert, standardm√§√üig alles konfiguriert, eine PHP-Anwendung gefunden und unten das Ergebnis angezeigt hat. <br><br><img src="https://habrastorage.org/webt/js/ji/xj/jsjixjh1afv4981burqrqtopx8i.png"><br><br>  Hier ging die Last zur Wurzel und betrug nur 10 RPS.  Wir haben 5 Minuten gewartet und der Server ist abgest√ºrzt.  Bis zum Ende ist jedoch nicht bekannt, warum er gefallen ist, aber es besteht die Annahme, dass er einfach voller Erinnerungen war und daher nicht mehr reagierte. <br><br><h3>  Wellenbasiert </h3><br>  In den letzten ein oder zwei Jahren sind Wellenangriffe sehr beliebt geworden.  Dies liegt an der Tatsache, dass viele Unternehmen bestimmte Hardwarekomponenten zum Schutz vor DDoS kaufen, f√ºr die eine bestimmte Anzahl von Statistiken erforderlich ist, um Angriffe zu filtern.  Das hei√üt, sie filtern den Angriff nicht in den ersten 30 bis 40 Sekunden, da sie Daten sammeln und lernen.  Dementsprechend k√∂nnen Sie in diesen 30 bis 40 Sekunden so viel starten, dass die Ressource lange Zeit liegen bleibt, bis alle Anforderungen geharkt sind. <br><br>  Im Falle des Angriffs gab es ein Intervall von 10 Minuten darunter, wonach ein neuer, modifizierter Teil des Angriffs eintraf. <br><br><img src="https://habrastorage.org/webt/tx/b4/l7/txb4l7l3s0yneaz0dn5__jzozmu.png"><br><br>  Das hei√üt, die Verteidigung trainierte, begann zu filtern, aber ein neuer, v√∂llig anderer Teil des Angriffs traf ein und die Verteidigung begann erneut zu trainieren.  Tats√§chlich funktioniert die Filterung nicht mehr, der Schutz wird unwirksam und die Site ist nicht mehr zug√§nglich. <br><br>  Wellenangriffe zeichnen sich durch sehr hohe Spitzenwerte aus, sie k√∂nnen im Fall von L7 hunderttausend oder eine Million Anfragen pro Sekunde erreichen.  Wenn wir √ºber L3 &amp; 4 sprechen, kann es Hunderte von Gigabit Verkehr geben, oder dementsprechend Hunderte von MPPs, wenn Sie in Paketen z√§hlen. <br><br>  Das Problem bei solchen Angriffen ist die Synchronisation.  Angriffe kommen von einem Botnetz, und um einen sehr gro√üen einmaligen Peak zu erzeugen, ist ein hoher Grad an Synchronisation erforderlich.  Und diese Koordination funktioniert nicht immer: Manchmal ist die Ausgabe eine Art parabolischer Peak, der ziemlich erb√§rmlich aussieht. <br><br><h3>  Nicht HTTP Unified </h3><br>  Neben HTTP auf L7-Ebene nutzen wir gerne andere Protokolle.  In der Regel sind auf einer regul√§ren Website, insbesondere auf einem regul√§ren Hosting, Mail-Protokolle und MySQL hervorzuheben.  Mail-Protokolle sind weniger betroffen als Datenbanken, k√∂nnen aber auch sehr effizient geladen werden und am Ausgang eine √ºberlastete CPU auf dem Server erhalten. <br><br>  Mit Hilfe der SSH-Schwachstelle 2016 waren wir recht erfolgreich.  Jetzt wurde diese Sicherheitsanf√§lligkeit f√ºr fast alle behoben, dies bedeutet jedoch nicht, dass SSH nicht geladen werden kann.  Du kannst.  Es wird nur eine gro√üe Menge an Berechtigungen bereitgestellt, SSH verbraucht fast die gesamte CPU auf dem Server, und die Website besteht bereits aus ein oder zwei Anforderungen pro Sekunde. <br><br>  Dementsprechend k√∂nnen diese ein oder zwei Protokollabfragen nicht von einer legitimen Last unterschieden werden. <br>  Die vielen Verbindungen, die wir auf den Servern √∂ffnen, bleiben relevant.  Fr√ºher hat Apache ges√ºndigt, jetzt hat Nginx tats√§chlich ges√ºndigt, da es oft standardm√§√üig konfiguriert ist.  Die Anzahl der Verbindungen, die nginx offen halten kann, ist begrenzt. Daher √∂ffnen wir diese Anzahl von Verbindungen, die neue nginx-Verbindung wird nicht mehr akzeptiert und die Site funktioniert bei der Ausgabe nicht. <br><br>  Unser Testcluster verf√ºgt √ºber gen√ºgend CPU, um den SSL-Handshake anzugreifen.  Wie die Praxis zeigt, tun Botnets dies im Prinzip manchmal auch gerne.  Einerseits ist klar, dass Sie nicht auf SSL verzichten k√∂nnen, da Google die Ausgabe, das Ranking und die Sicherheit von Google ber√ºcksichtigt.  SSL hingegen hat leider ein CPU-Problem. <br><br><h3>  L3 &amp; 4 </h3><br>  Wenn wir √ºber einen Angriff auf den Ebenen L3 und 4 sprechen, sprechen wir normalerweise √ºber einen Angriff auf Kanalebene.  Eine solche Last ist fast immer von legitim zu unterscheiden, wenn es sich nicht um einen SYN-Flutangriff handelt.  Das Problem von SYN-Flood-Angriffen auf Sicherheitsfunktionen ist gro√ü.  Der Maximalwert von L3 &amp; 4 betrug 1,5-2 Tb / s.  Dieser Datenverkehr ist selbst f√ºr gro√üe Unternehmen wie Oracle und Google sehr schwierig zu handhaben. <br><br>  SYN und SYN-ACK sind die Pakete, mit denen die Verbindung hergestellt wird.  Daher ist es schwierig, SYN-Flood von einer legitimen Last zu unterscheiden: Es ist nicht klar, dass dies SYN ist, das die Verbindung hergestellt hat, oder ein Teil der Flood. <br><br><h3>  UDP-Flut </h3><br>  In der Regel verf√ºgen Angreifer nicht √ºber die erforderlichen Funktionen, sodass die Verst√§rkung zum Organisieren von Angriffen verwendet werden kann.  Das hei√üt, ein Angreifer durchsucht das Internet und findet entweder anf√§llige oder nicht ordnungsgem√§√ü konfigurierte Server, die beispielsweise als Antwort auf ein SYN-Paket mit drei SYN-ACKs antworten.  Durch F√§lschen der Quelladresse von der Adresse des Zielservers k√∂nnen Sie ein Paket verwenden, um die Kapazit√§t beispielsweise dreimal zu erh√∂hen und den Datenverkehr an das Opfer umzuleiten. <br><br><img src="https://habrastorage.org/webt/nd/yu/qz/ndyuqzpld7k2bu58rqqmbriass4.png"><br><br>  Das Problem bei Verst√§rkungen ist ihre komplexe Erkennung.  Aus den neuesten Beispielen k√∂nnen wir den sensationellen Fall mit dem verwundbaren Memcached zitieren.  Au√üerdem gibt es jetzt viele IoT-Ger√§te, IP-Kameras, die meistens auch standardm√§√üig konfiguriert sind und standardm√§√üig falsch konfiguriert sind. Daher f√ºhren Angreifer √ºber solche Ger√§te am h√§ufigsten Angriffe durch. <br><br><img src="https://habrastorage.org/webt/h-/si/2n/h-si2n6jf8q84xzuzbfgwgwnd6o.png"><br><br><h3>  Schwierige SYN-Flut </h3><br>  SYN-Flood ist aus Sicht des Entwicklers wahrscheinlich die interessanteste Ansicht aller Angriffe.  Das Problem ist, dass Systemadministratoren h√§ufig IP-Blockierung zum Schutz verwenden.  Dar√ºber hinaus betrifft die IP-Blockierung nicht nur Systemadministratoren, die gem√§√ü Skripten arbeiten, sondern leider auch einige Sicherheitssysteme, die f√ºr viel Geld gekauft werden. <br><br>  Diese Methode kann zu einer Katastrophe werden, denn wenn die Angreifer ihre IP-Adressen √§ndern, blockiert das Unternehmen sein eigenes Subnetz.  Wenn die Firewall ihren eigenen Cluster blockiert, st√ºrzen externe Interaktionen am Ausgang ab und die Ressource wird unterbrochen. <br><br>  Und das Blockieren Ihres eigenen Netzwerks ist einfach.  Wenn das B√ºro des Kunden √ºber ein Wi-Fi-Netzwerk verf√ºgt oder der Zustand der Ressourcen mithilfe verschiedener √úberwachungen gemessen wird, verwenden wir die IP-Adresse dieses √úberwachungssystems oder Office-Wi-Fi-Clients und verwenden sie als Quelle.  Am Ausgang scheint die Ressource verf√ºgbar zu sein, aber die Ziel-IP-Adressen sind blockiert.  So kann das Wi-Fi-Netzwerk der HighLoad-Konferenz, in dem ein neues Produkt des Unternehmens vorgestellt wird, blockiert werden, was bestimmte gesch√§ftliche und wirtschaftliche Kosten mit sich bringt. <br><br>  W√§hrend des Testens k√∂nnen wir keine Verst√§rkung durch Memcaching durch einige externe Ressourcen verwenden, da Vereinbarungen bestehen, Datenverkehr nur an zul√§ssige IP-Adressen zu liefern.  Dementsprechend verwenden wir die Verst√§rkung durch SYN und SYN-ACK, wenn das System mit dem Senden von zwei oder drei SYN-ACKs zum Senden eines SYN antwortet und die Ausgabe mit dem Zwei- bis Dreifachen multipliziert wird. <br><br><h3>  Die Werkzeuge </h3><br>  Eines der Hauptwerkzeuge, die wir f√ºr die Ladung auf L7-Ebene verwenden, ist der Yandex-Tank.  Insbesondere wird ein Phantom als Pistole verwendet, und es gibt mehrere Skripte zum Generieren von Patronen und zum Analysieren der Ergebnisse. <br><br>  Tcpdump wird zur Analyse des Netzwerkverkehrs und Nmap zur Analyse des Serververkehrs verwendet.  Um eine Last auf L3- und 4-Ebene zu erstellen, wird OpenSSL verwendet und mit der DPDK-Bibliothek ein wenig von seiner eigenen Magie.  DPDK ist eine Bibliothek von Intel, mit der Sie mit einer Netzwerkschnittstelle arbeiten, den Linux-Stack umgehen und dadurch die Effizienz steigern k√∂nnen.  Nat√ºrlich verwenden wir DPDK nicht nur auf L3- und 4-Ebene, sondern auch auf L7-Ebene, da Sie so einen sehr hohen Lastfluss innerhalb weniger Millionen Anfragen pro Sekunde von einer Maschine aus erstellen k√∂nnen. <br>  Wir verwenden auch bestimmte Verkehrsgeneratoren und spezielle Tools, die wir f√ºr bestimmte Tests schreiben.  Wenn wir uns an die Sicherheitsanf√§lligkeit unter SSH erinnern, kann sie mit dem oben genannten Satz nicht behoben werden.  Wenn wir das Mail-Protokoll angreifen, nehmen wir Mail-Dienstprogramme oder schreiben einfach Skripte darauf. <br><br><blockquote><h3>  Schlussfolgerungen </h3><br>  Infolgedessen m√∂chte ich sagen: <br><br><ul><li>  Neben der klassischen Belastungspr√ºfung m√ºssen auch Belastungspr√ºfungen durchgef√ºhrt werden.  Wir haben ein Beispiel aus der Praxis, bei dem ein Subunternehmer eines Partners nur Lasttests durchgef√ºhrt hat.  Es zeigte sich, dass die Ressource der Standardlast standh√§lt.  Aber dann trat eine abnormale Belastung auf, die Besucher der Website begannen, die Ressource etwas anders zu nutzen, und am Ausgang legte der Subunternehmer fest.  Es lohnt sich daher, nach Sicherheitsl√ºcken zu suchen, auch wenn Sie bereits vor DDoS-Angriffen gesch√ºtzt sind. </li><li>  Es ist notwendig, einige Teile des Systems von anderen zu isolieren.     ,      ,      .       ,    -  .    -      ,   , ,    ,    OAuth2. </li><li>      . </li><li>  CDN      ,               . </li><li>     .  L3&amp;4        ,    ,  ,    .  L7      ,     . ,     -   ,  . </li><li>  .     ,   SSH daemon,       .  ,    ,            . </li></ul></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de448626/">https://habr.com/ru/post/de448626/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de448610/index.html">DIY: Wie wir einen Live-Zeitplan f√ºr Codefest X erstellt haben</a></li>
<li><a href="../de448612/index.html">Was beim Feature Freeze 2019 eingefroren wurde. Teil I. JSONPath</a></li>
<li><a href="../de448618/index.html">Douglas-Pecker-Algorithmus</a></li>
<li><a href="../de448622/index.html">PHP GR8: Verbessert JIT die Leistung von PHP 8</a></li>
<li><a href="../de448624/index.html">Daten anzeigen? Nein. Also ich sehe nicht, aber sie sind. Wir zerst√∂ren Daten auf SSD-Laufwerken und stellen sogar die Geschwindigkeit wieder her</a></li>
<li><a href="../de448628/index.html">Sowjetische technische √Ñsthetik und Technologie</a></li>
<li><a href="../de448632/index.html">Java ist jetzt bezahlt? Ger√ºchte entlarven (oder nicht?)</a></li>
<li><a href="../de448634/index.html">Ukrainischunterricht</a></li>
<li><a href="../de448636/index.html">Hackaday Retro Computer Fall</a></li>
<li><a href="../de448638/index.html">Buildroot - Teil 1. Allgemeine Informationen, Aufbau eines Minimalsystems, Einstellung √ºber das Men√º</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>