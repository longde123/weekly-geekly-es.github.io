<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òùüèæ üï¥üèΩ üëâüèæ C√≥mo hicimos un juego de mesa con control remoto - Parte 2 ‚õπüèø üè¢ üåî</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La √∫ltima vez que te cont√© sobre el componente t√©cnico de nuestro juego de mesa "inteligente", qu√© problemas encontramos y qu√© sucedi√≥ al final. 



 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo hicimos un juego de mesa con control remoto - Parte 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427227/">  La √∫ltima vez que te cont√© sobre el componente t√©cnico de nuestro juego de mesa "inteligente", qu√© problemas encontramos y qu√© sucedi√≥ al final. <br><br><img src="https://habrastorage.org/webt/7b/zs/wb/7bzswbw1i1yrk7qfvosf0xv7b7c.png" alt="imagen"><br><br>  Hoy quiero hablar con m√°s detalle sobre la aplicaci√≥n m√≥vil, el primer juego y c√≥mo crear miniaturas para √©l. <br><br>  El primer art√≠culo se puede encontrar aqu√≠: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C√≥mo hicimos un juego de mesa con control remoto - Parte 1</a> <br><br>  <b><font color="#cc0000">Atencion</font></b>  Muchas fotos en. <br><a name="habracut"></a><br>  En los comentarios al √∫ltimo art√≠culo, se√±alaron correctamente que es mejor no hacer un juego, sino una plataforma sobre la cual ya se pueden crear juegos utilizando la mec√°nica disponible.  Inicialmente, lo planeamos, pero como resultado, nos dimos cuenta de que no pod√≠amos hacer algo aparte del juego.  Solo por la falta de experiencia en dise√±o de juegos o dise√±adores de juegos familiares que podr√≠an decirnos qu√© mecanismos deber√≠an ser compatibles. <br><br>  Por lo tanto, decidimos que implementaremos todas las funciones b√°sicas de la plataforma (movimiento, resaltado din√°mico, indicaciones) en nuestro primer juego, que nosotros mismos inventaremos.  Y luego, utilizando la experiencia adquirida, haremos un dise√±ador de juegos completo. <br><br><h3>  Aplicaci√≥n m√≥vil </h3><br>  Como escrib√≠ anteriormente, toda la gesti√≥n de la plataforma se lleva a cabo a trav√©s de una aplicaci√≥n m√≥vil que se conecta a trav√©s del protocolo BLE. <br><br><div class="spoiler">  <b class="spoiler_title">Varios GIF</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/e5/0e/fs/e50efsqkimivhagtli1vdysilu8.gif" alt="GIF &quot;&quot; /"><br><br><img src="https://habrastorage.org/webt/kj/k2/vn/kjk2vnrwqu1j-ev5p3nyc8jezla.gif" alt="GIF"><br><br><img src="https://habrastorage.org/webt/-h/mc/83/-hmc83p5j2mm4kfcheuz_awfvki.gif" alt="GIF"><br><br><img src="https://habrastorage.org/webt/s5/3a/l7/s53al7pmllagcyitcbb6ocxrtne.gif" alt="GIF &quot;&quot; /"><br></div></div><br>  De hecho, para implementar cualquier juego, debes escribir una aplicaci√≥n m√≥vil completa para √©l, en la que describas todas las reglas y la mec√°nica. <br><br>  En el proceso de redacci√≥n de la aplicaci√≥n, realizamos todas las pruebas conect√°ndonos a la plataforma, lo que no es muy conveniente.  Por lo tanto, para simplificar la depuraci√≥n, creamos un emulador de software simple dentro del marco de la aplicaci√≥n, en el que los datos se muestran de la misma manera que se mostrar√≠an en el campo de juego. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/je/wx/0q/jewx0qwcurqcpbxmm0d5nlbn2s4.jpeg"></div><br>  Al principio, encontramos un problema de que los datos que abandonan la aplicaci√≥n se pierden.  Descubrimos que cuando se usa BLE, el tama√±o m√°ximo de paquete que se puede enviar es de 20 bytes.  Por lo tanto, dividimos todos los datos salientes en BLE en paquetes de 20 bytes, el par√°metro "Puerta" se escribe en el encabezado.  Este par√°metro ayuda a Arduino a comprender a qu√© componente de la plataforma pertenece este paquete.  Desde el lado de Arduino, el procesamiento de estos paquetes es elemental: <br><br><pre><code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (NewCommandReady) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (CurrentGate) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: processLEDCommand(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: processDriverCommand(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>: processMagnetCommand(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>: <span class="hljs-comment"><span class="hljs-comment">// break; } //  NewCommandReady = false; }</span></span></code> </pre> <br>  Despu√©s de dividir la transmisi√≥n de datos entre el tel√©fono inteligente y el m√≥dulo BLE en paquetes de 20 bytes, los datos dejaron de desaparecer, pero a menudo llegaron al Arduino en forma distorsionada.  Result√≥ que no tomamos en cuenta que el puerto serie Arduino tiene un b√∫fer de 64 bytes.  Cuando el b√∫fer se desborda, los datos se pierden y los siguientes se distorsionan.  Aumentar el tama√±o y crear su propio b√∫fer no siempre ayud√≥.  Tuve que escribir un protocolo contenedor encima del transporte BLE para enviar y recibir datos de manera confiable. <br><br>  Debido al uso de dicho "protocolo", el intercambio de datos se ralentiz√≥ un poco al verificar la integridad de los datos transmitidos, sin embargo, la confiabilidad es m√°s cr√≠tica para el juego: ser√° una pena si la visualizaci√≥n de <abbr title="√Årea de efecto">AOE</abbr> de alguna habilidad est√° incompleta o si el h√©roe no se mueve al confirmar el movimiento en un tel√©fono m√≥vil. <br><br>  Para mostrar objetos en el campo de juego, utilizamos el principio de capas en los subsistemas de ventanas del sistema operativo: <br><br><ul><li>  Cada objeto o acci√≥n que se resalta (h√©roes, obst√°culos, la forma en que se mueve el h√©roe, el alcance disponible de la habilidad y el resto) usa su propia capa. </li><li>  Cuando se aplican capas (por ejemplo, la regi√≥n AOE sobre el alcance disponible de la capacidad), se recuerda el estado inicial de los LED.  Como resultado, es posible devolver el color original cuando la capa superior desaparece. </li></ul><br>  La mayor parte de los datos transferidos entre la aplicaci√≥n m√≥vil y la plataforma es el repintado de los LED.  Para fines de optimizaci√≥n, se agregaron un par de algoritmos: <br><br><ul><li>  Para volver a pintar diodos, se utiliza un b√∫fer en el que se realizan cambios hasta el momento en que estos cambios deben mostrarse en la placa f√≠sica. </li><li>  Repintar un solo LED dentro del mismo comando est√° excluido. </li><li>  Al volver a pintar (por ejemplo, el desplazamiento del √°rea de capacidad AOE en 1 celda), se analiza el estado actual de la placa LED.  Si el color del LED en el nuevo estado no difiere del anterior, el Arduino no recibir√° ning√∫n comando para volver a pintarlo. </li></ul><br><h3>  Jugabilidad </h3><br>  Entonces, decidiste jugar.  A continuaci√≥n describir√© c√≥mo se ve desde un lado: <br><br><ol><li>  Insertamos el enchufe en la salida y encendemos el juego. </li><li>  En cada inicio, se realiza una calibraci√≥n autom√°tica para determinar el n√∫mero exacto de pasos del motor paso a paso para mover 1 celda. </li><li>  Paralelamente, conectamos el tel√©fono inteligente al juego mediante Bluetooth. </li><li>  En la aplicaci√≥n m√≥vil, cada jugador selecciona el personaje que quiere jugar.  Despu√©s de que todos hayan elegido, presione "INICIAR". <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ht/cs/ci/htcsciajzb7sebcj6twnq0vns2w.jpeg"></div></li><li>  Cada uno de los personajes tiene su propio color.  El juego resaltar√° autom√°ticamente la celda donde debes colocar la figura de tu h√©roe. </li><li>  El juego tiene lugar secuencialmente.  El primer movimiento lo realiza el jugador que primero eligi√≥ al h√©roe, el segundo, el segundo, etc. </li><li>  Cada h√©roe tiene un cierto n√∫mero de Puntos de Acci√≥n (OD) que pueden gastarse en moverse por la arena o aplicar habilidades. </li><li>  Cada habilidad tiene su propio tiempo de recuperaci√≥n, que se calcula en rondas.  Dentro del marco de la aplicaci√≥n m√≥vil, hay 2 conceptos: Mover: el intervalo desde el principio hasta el final de las acciones actuales del jugador.  Ronda: la suma de los movimientos de todos los jugadores que participan en el juego.  Actualmente, el turno de un jugador est√° limitado a 30 segundos. </li><li>  Los obst√°culos se colocan en el campo a trav√©s del cual el jugador no podr√° pasar o usar la mayor√≠a de las habilidades.  Ahora simplemente se resaltan en rojo en el campo de juego, pero en el futuro tendr√°n una encarnaci√≥n f√≠sica. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4z/o8/us/4zo8ushsn3n14do9lsiofemo9_o.jpeg"></div></li><li>  Puedes mover el campo con la ayuda de habilidades especiales que tiene cada h√©roe.  Por ejemplo, la teletransportaci√≥n de un mago.  A diferencia del movimiento est√°ndar, cuando un jugador pavimenta la ruta de su h√©roe celda por celda, cuando usa estas habilidades, el jugador indica solo el punto final.  Como resultado, existe la necesidad de un algoritmo para encontrar la ruta m√°s corta a un punto espec√≠fico, evitando todos los objetos con los que es posible la colisi√≥n (figuras de otros h√©roes, figuras de obst√°culos, etc.). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0s/bn/ww/0sbnwwaio74vz1ltxzkxb_6kuga.gif"></div><br>  Este problema se resuelve simplemente con la ayuda de gr√°ficos y el paso de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">BFS a</a> trav√©s de las celdas. <br>  En resumen, la esencia del algoritmo es marcar las celdas por distancia, desde la posici√≥n actual del h√©roe hasta la celda especificada (indicada en naranja), a la que debe moverse el h√©roe. <br><br>  Despu√©s de encontrar la celda deseada, se busca la ruta de retorno en las celdas de tal manera que la distancia desde el punto de partida hasta la celda siguiente sea 1 menor que la celda actual (el pasaje est√° marcado en amarillo).  Despu√©s de regresar a la posici√≥n inicial (celda verde), se forma una secuencia de puntos, que es el camino m√°s corto.  Es esta secuencia la que se transmite a Arduino como equipos para mover al h√©roe. <br></li><li>  Despu√©s de la muerte del h√©roe, el juego mueve autom√°ticamente su figura a la "zona de origen".  Zona de inicio: una celda en la que se coloca la figura al comienzo del juego.  Cada jugador tiene el suyo.  Despu√©s de comenzar el juego, no puedes ingresar o usar la habilidad en la zona de inicio.  Esto se hace para que sea imposible atrapar al jugador en el avivamiento.  Para un jugador cuyo h√©roe es derrotado, el juego termina en 1 ronda.  Despu√©s se reincorpora a la batalla. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fw/sr/w7/fwsrw7vyy3iyxmuagm-apvvgb5c.gif"></div></li><li>  En este momento, el jugador cuyo h√©roe fue el √∫ltimo en permanecer en el campo derrotando a los oponentes est√° ganando.  Pero la condici√≥n puede ser diferente, por ejemplo, el que obtuvo N frags primero gana. </li></ol><br>  Esta es una jugabilidad que funciona en la versi√≥n actual.  Debido a la falta de experiencia en el dise√±o de juegos, quiz√°s no vemos escuelas u oportunidades obvias.  Por ejemplo, siempre es doloroso esperar su pr√≥ximo movimiento.  En la implementaci√≥n actual, el tiempo de espera puede llegar a 1,5 minutos.  En la pr√≥xima versi√≥n del prototipo, planeamos agregar lectores de etiquetas RFID, lo que diversificar√° el juego.  Por ejemplo, use tarjetas con etiquetas RFID que pueda aplicar fuera de su turno. <br><br><h3>  Miniaturas </h3><br>  ¬°Las miniaturas aman todo!  Y no somos la excepci√≥n.  Por lo tanto, en paralelo con la colecci√≥n de mec√°nica y programaci√≥n, nos dedicamos a inventar nuestras propias miniaturas.  Creo que de las fotos est√° claro que nuestro juego es sobre gatos de fantas√≠a que luchan en la arena. <br>  Porque  no sabemos c√≥mo dibujar la palabra en absoluto, recurrimos a nuestro amigo, quien con gran placer comenz√≥ a dibujar "gatos de pelea". <br><br>  Ella tom√≥ a nuestras mascotas como base.  Entonces, en su casa viv√≠a un gato enorme y vicioso apodado "Pirata", es √©l quien yace en el coraz√≥n del Guerrero en miniatura. <br><br>  Despu√©s de un par de semanas, obtuvimos nuestros primeros bocetos. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yu/gw/gd/yugwgdwzp3rivxzrgvqkmic4weg.jpeg"></div><br>  De los art√≠culos sobre la producci√≥n de juegos de mesa, me di cuenta de que en Rusia, la creaci√≥n de miniaturas es bastante mala y muchas las ordenan en Finlandia o Alemania. <br><br>  Antes de participar en la producci√≥n de miniaturas, necesit√°bamos hacer modelos maestros de cada h√©roe, que son suficientes para un prototipo.  Al principio quer√≠amos hacerlos con arcilla polim√©rica, pero result√≥ que entre nuestros amigos no hab√≠a miniaturistas, y por encargo era demasiado caro en ese momento.  Por lo tanto, decidimos que primero los imprimir√≠amos en una impresora 3D.  Para hacer esto, nuestro amigo nos hizo modelos 3D de nuestros primeros h√©roes en Zbrush. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/au/3e/pf/au3epfmxhadbisknm0p8hy5lmro.jpeg"></div><br>  Con la ayuda de la impresi√≥n FDM, no fue posible imprimir figuras de calidad aceptable, lo cual era bastante esperado. <br><br>  Afortunadamente, mi esposa tiene impresoras 3D SLA en el trabajo. <br><br>  La estereolitograf√≠a (SLA) es una tecnolog√≠a de impresi√≥n 3D que le permite convertir materiales l√≠quidos en objetos s√≥lidos utilizando una fuente de luz, capa por capa, utilizando el proceso de fotopolimerizaci√≥n.  El grosor de la capa durante la impresi√≥n con tecnolog√≠a SLA es varias veces menor que durante la impresi√≥n con FDM, por lo tanto, la calidad del producto terminado es mayor. <br><br>  Pocos d√≠as despu√©s nos dieron nuestras primeras miniaturas. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cb/gj/vu/cbgjvui3dpstddssij_nxgkspyy.jpeg"></div><br>  La calidad de estas miniaturas es mucho mayor, pero a√∫n no alcanza la producci√≥n obtenida por moldeo de pl√°stico.  La culpa de esto es el soporte, que despu√©s de la eliminaci√≥n deja marcas notables.  En teor√≠a, podr√≠amos "cortar" las figuras en partes separadas e imprimirlas individualmente, sin el uso de soportes, y luego pegarlas.  Pero llevar√≠a mucho tiempo y, adem√°s, a√∫n podr√≠a cambiar en el futuro. <br><br>  Cada figura se encuentra en su propia base, que tambi√©n imprimimos en una impresora 3D.  Dentro de la base hay un im√°n de neodimio.  El tama√±o y el grosor del im√°n se seleccionaron emp√≠ricamente para que la figura se magnetizara tranquilamente al electroim√°n en el carro de la plataforma, pero no reaccion√≥ a las figuras vecinas. <br><br><h3>  Total </h3><br>  Por el momento, estamos comprometidos a mejorar las caracter√≠sticas f√≠sicas de la plataforma y la confiabilidad de todos los componentes.  Reemplazaremos la madera contrachapada con policarbonato y pl√°stico ABS, mejoraremos la fijaci√≥n de los componentes de la plataforma entre s√≠ y haremos que el campo de juego sea extra√≠ble para que pueda cambiarse a un campo de otro factor de forma (por ejemplo, hexagonal).  El siguiente paso es crear un MVP completo, lo cual no es una pena mostrarle a la gente. <br><br>  Con el juego un poco m√°s dif√≠cil.  Por supuesto, quiero concentrarme completamente en la implementaci√≥n de la plataforma, sin referencia a un juego espec√≠fico.  Sin embargo, somos conscientes de que nadie est√° interesado en una plataforma sin un juego. <br><br>  Gracias a todos por sus cr√≠ticas / consejos / intereses.  Tuvimos una idea sobre la creaci√≥n de una versi√≥n sin utilizar la mec√°nica, pero con la capacidad de determinar la posici√≥n y el tipo de la figura en el campo.  Creo que el pr√≥ximo art√≠culo ser√° escrito despu√©s de la creaci√≥n de <abbr title="Producto m√≠nimo viable">MVP</abbr> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es427227/">https://habr.com/ru/post/es427227/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es427217/index.html">An√°lisis de rendimiento de los servidores WSGI: segunda parte</a></li>
<li><a href="../es427219/index.html">Mensajer√≠a diferida in√∫til no bloqueada en MPI: an√°lisis ligero y tutorial para aquellos que est√°n un poco "en el tema"</a></li>
<li><a href="../es427221/index.html">Lo que me di cuenta de camino a mi sue√±o de inteligencia artificial</a></li>
<li><a href="../es427223/index.html">¬øCu√°l es la responsabilidad del desarrollador principal?</a></li>
<li><a href="../es427225/index.html">Oracle Database 18c XE lanzado</a></li>
<li><a href="../es427229/index.html">Programa de gesti√≥n de proyectos de juegos de 4 a√±os</a></li>
<li><a href="../es427231/index.html">Eventos digitales en Mosc√∫ del 22 al 28 de octubre.</a></li>
<li><a href="../es427233/index.html">Negocios sobre datos personales: ¬øc√≥mo tener √©xito y no violar la ley?</a></li>
<li><a href="../es427235/index.html">El fin de la dualidad onda-part√≠cula</a></li>
<li><a href="../es427237/index.html">Mira la sombra</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>