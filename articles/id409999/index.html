<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🖋️ 🏑 💑 Klien HTML + JS untuk Sistem Pengawasan Garis 👨🏽‍🚀 🍲 ⏳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Di Geektimes, saya sering bertemu dan menikmati membaca posting dari seri DIY. Setelah memutuskan untuk memberikan kontribusi kecil pada perbendaharaa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Klien HTML + JS untuk Sistem Pengawasan Garis</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/devline/blog/409999/"><img src="https://habrastorage.org/webt/ac/om/m5/acomm5x6os3ra7c0uew3upys2tm.jpeg"><br><br>  Di Geektimes, saya sering bertemu dan menikmati membaca posting dari seri DIY.  Setelah memutuskan untuk memberikan kontribusi kecil pada perbendaharaan pengalaman berharga yang dikumpulkan di sini, saya akan menjelaskan secara terperinci proses menciptakan klien untuk web berdasarkan server Line. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Sistem pengawasan garis</a> menyediakan API terbuka, dan pengembang mengatakan bahwa memungkinkan untuk menulis klien Anda sendiri berdasarkan pada itu untuk melihat arsip video dan kamera online.  Juga, jika diinginkan, Anda dapat mengimplementasikan fungsi-fungsi seperti menambahkan acara ke arsip, overlay OSD di atas video.  Deskripsi semua fitur disajikan dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">spesifikasi di situs web resmi</a> . <br><br>  Artikel ini adalah contoh nyata tentang bagaimana saya, pengguna dengan pengetahuan awal tentang JS, HTML, menulis aplikasi saya sendiri yang mengimplementasikan prinsip-prinsip dasar bekerja dengan server Line melalui server web bawaan. <br><a name="habracut"></a><br>  Masukkan data <br><br>  <b>Penulis</b> adalah pemula dalam pengembangan klien HTML, dan terlibat dalam pengembangan sistem pengawasan video Line. <br>  <b>Tingkat pengetahuan JS, HTML</b> - awal. <br>  <b>Tugasnya</b> adalah menulis klien HTML untuk bekerja dengan perangkat berdasarkan perangkat lunak Line menggunakan spesifikasi dari situs. <br><br>  Saya akan mengungkapkan intrik utama segera - Saya sampai pada dua kesimpulan: <br><br><ol><li>  Spesifikasinya nyata, dijelaskan dengan sangat jelas, Anda dapat menulis klien menggunakan C ++, PHP. </li><li>  Anda tidak dapat menulis klien HTML lengkap hanya menggunakan JS - hanya pemantauan online sesuai spesifikasi sebelum RPC. </li></ol><br>  Kesimpulan pertama cukup logis, mengingat banyaknya integrasi dengan program pihak ketiga.  Semuanya dijelaskan di situs: ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sistem kontrol akses</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">berat</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sistem POS</a> , program untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menentukan nomor mobil</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">1C</a> . <br><br>  Kesimpulan kedua lebih menarik, simak di bawah ini. <br><br><h2>  Mengapa Anda tidak dapat membuat klien lengkap dalam HTML + JS? </h2><br>  Jawab: permintaan lintas-domain. <br><br>  Saat ini, server web Line terbatas, dan hanya dengan menyalin kode ke folder www, akses tidak dapat diperoleh.  Namun, pengembang berjanji bahwa dalam versi baru untuk Linux dan di "Line 8.0" server web akan berfungsi sebagai standar: jika ada permintaan, jika ada file, itu akan mengembalikannya. <br><br>  Sekarang buat proyek baru dan mulai coding.  Seperti semua pendatang baru dalam pemrograman untuk web, menetapkan bahwa server "Lines" menjawab "*" di header Access-Control-Allow-Origin, saya mulai bekerja keras pada kode, memeriksa hasilnya pada Firefox 57.0.4 (64-bit).  Permintaan ke server dikirim oleh XMLHttpRequest. <br><br>  Awalnya, akan berguna untuk mempelajari informasi tentang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sumber daya ini</a> .  Semuanya dijelaskan dengan sangat terperinci di sana, tetapi saya benar-benar ingin menyelesaikan tugas dengan cepat.  Dan, sayangnya, karena kurangnya informasi, setengah hari hilang karena hantaman keras di dinding kebijakan keamanan browser modern. <br><br>  Pada saat penulisan ini, empat browser modern utama tidak memungkinkan untuk membaca header yang diterima dari server.  Menurut spesifikasi, perlu untuk mengimplementasikan otentikasi Digest, yang tidak mungkin tanpa header. <br><br>  Pada akhir hari pertama, saya menyadari bahwa tanpa menambahkan pemrosesan OPSI ke server web Line, tidak ada yang akan berhasil, karena untuk permintaan dengan metode "sulit" atau tajuk khusus, browser membuat pra-permintaan OPSI, menunjukkannya dalam Access-Control-Request-Method dan Header Akses-Kontrol-Permintaan.  Jadi saya mulai mencari opsi otorisasi lain, tetapi Basic atau Digest yang asli tidak lepas landas. <br><br>  Metode alternatif telah dijelaskan dalam spesifikasi, itu masih menghabiskan beberapa waktu korespondensi dengan departemen program "Lines".  Karena kesulitan semacam itu muncul bukan untuk pertama kalinya, sudah ada penopang untuk otorisasi, dan bahkan disebutkan dalam spesifikasi: <br><blockquote>  Pada klien yang tidak mungkin mengotorisasi permintaan menggunakan cara standar (HTTP Digest / Otentikasi Dasar), tajuk Otorisasi dapat dikirim menggunakan salah satu parameter permintaan, misalnya <br>  /kfd3ado1sdrms/streaming/main.flv?authorization=Basic%20d2ViOg== </blockquote><br>  Setelah semua manipulasi, permintaan lintas domain standar mulai dijalankan dengan benar!  Anda juga perlu menambahkan header Terima dengan jenis yang benar ke permintaan - Saya memutuskan untuk menggunakan JSON. <br><br>  Kode Permintaan: <br><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_request_url</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">method,current_server_data, resource, additional</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = current_server_data.server_ip + <span class="hljs-string"><span class="hljs-string">':'</span></span> +current_server_data.port +resource+<span class="hljs-string"><span class="hljs-string">'?authorization=Basic '</span></span>+ utf8_to_b64(current_server_data.user+<span class="hljs-string"><span class="hljs-string">':'</span></span>+current_server_data.password); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (additional != <span class="hljs-string"><span class="hljs-string">''</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> additional != <span class="hljs-string"><span class="hljs-string">"undefined"</span></span>) { request += <span class="hljs-string"><span class="hljs-string">'&amp;'</span></span> + additional; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> request; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">http_request_of_resource</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">server_index , resource, auth_attempt</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = get_request_url(<span class="hljs-string"><span class="hljs-string">'GET'</span></span>, servers_array[server_index], resource,<span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> req_ = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); req_.open(<span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://'</span></span>+ request, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-comment"><span class="hljs-comment">//req_.timeout = 9000; //  ,    req_.onreadystatechange = function() { if (this.readyState == 2) { if (this.status == 401) { //console.log('---unauthorized'); hideModal(); update_nessecary_structure(resource, 'unauthorized', server_index); } } else if (this.readyState === 4) { if (this.status === 0) { hideModal(); update_nessecary_structure(resource, 'server_down',server_index) } if (this.status == 200) { if (auth_attempt) hideModal(); else resource =(resource =='/cameras') ? resource+'_update_info': resource; //console.log('200' + this.responseText); update_nessecary_structure(resource, this.responseText, server_index); } else if (this.status == 404) { //console.log('404'); update_nessecary_structure(resource, '404', server_index); } } }; //   req_.setRequestHeader('Content-type', 'text/plain; charset=utf-8'); req_.setRequestHeader('Accept', 'application/json'); req_.send(); }</span></span></code> </pre> <br>  Kami mengubah sumber daya ke yang kami butuhkan sesuai dengan spesifikasi dan mendapatkan data ini atau itu.  Variabel tambahan berisi parameter tambahan untuk permintaan, jika perlu.  Mengenai hal ini, pengembangan spesifikasi paruh pertama, yaitu penerimaan / pengiriman data teks melalui permintaan GET, dapat dianggap tertutup. <br><br>  Lebih jauh, saya menemukan fakta bahwa tag IMG di IE tidak memutar aliran MJPEG, dan Anda perlu mengimplementasikan secara mandiri memperbarui gambar dari kamera.  Kode terbuka, dapat dilihat dan diubah jika diinginkan.  Dalam implementasi saat ini, pemutaran simultan dari maksimum enam stream MJPEG tersedia, sehingga Anda harus melakukan pekerjaan dengan tampilan yang menampilkan lebih banyak kamera.  Semua ini ada dalam <a href="">contoh</a> , jika Anda mau, Anda dapat menemukan dan memahami, tetapi jika Anda memiliki pertanyaan, pastikan untuk bertanya di komentar. <br><br><h2>  Spesifikasi RPC </h2><br>  Kami diundang untuk mengirim dan menerima data baik dalam JSON (versi server "Baris 7.1.1" dan lebih tinggi) atau MessagePack (versi "Baris 7.0" dan lebih tinggi).  Disebutkan bahwa MessagePack memiliki bobot lebih sedikit dan bekerja lebih cepat, tetapi jujur ​​saja, saya akan memilih JSON (sudah dibangun di JS), jika bukan karena satu hal tetapi dalam spesifikasi: menerima bingkai dari arsip hanya mungkin di MessagePack.  Saya harus pergi ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">situs web resmi</a> mereka dan mengunduh file JS, yang memiliki metode encode dan decode di papan. <br><br>  Fungsi pengiriman permintaan sudah siap!  Tetapi terlalu dini untuk merayakan kemenangan: ketika Anda mencoba mengubah tajuk permintaan tipe konten, browser bersumpah dan tidak mengirim data ke server.  Faktanya adalah bahwa server Lines menganalisis bidang ini dan mem-parsingnya tergantung pada jenisnya.  Saya tidak bisa melakukannya sendiri. <br><br>  Saya mengirim permintaan ke departemen program, dan setelah diskusi, mereka menambahkan kruk kepada saya, seperti dalam kasus otorisasi, - Tipe konten akan dikirim dalam permintaan url: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rpc_request_of_resource</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">current_server_data , rpc_method, rpc_request</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = get_request_url(<span class="hljs-string"><span class="hljs-string">'POST'</span></span>, current_server_data, <span class="hljs-string"><span class="hljs-string">'/rpc'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-comment"><span class="hljs-comment">//console.log("i'm here request = " + request + ' '+ current_server_data.user); request += "&amp;content-type='application/x-msgpack'"; var req_ = new XMLHttpRequest(); req_.open('POST', 'http://'+ request, true); //  ,    req_.responseType = 'arraybuffer'; req_.onreadystatechange = function() { if (this.readyState == 2) { if (this.status == 401) { //console.log('401' + this.getAllResponseHeaders()); console.log('unauthorized'); } } else if (this.readyState == 4) { if (this.status == 200) { //if (auth_attempt) hideModal(); //console.log('200' + this.responseText); rpc_update_nessecary_method(rpc_method, this.response); } else if (this.status == 404) { console.log('404'); } else if (this.status == 500) { //console.log('500'); rpc_update_nessecary_method(rpc_method, '500'); } } }; //   //req_.setRequestHeader('Content-type', 'text/plain; charset=utf-8'); //req_.setRequestHeader('Content-type', 'application/x-msgpack'); req_.setRequestHeader('Accept', 'application/x-msgpack'); req_.send(rpc_request); }</span></span></code> </pre> <br>  Perubahan ini akan bekerja dengan versi "Baris 7.4.1" dan lebih tinggi.  Untuk semua server di bawah versi ini, bekerja dengan sumber daya / rpc tidak akan tersedia. <br><br>  Pada akhirnya, saya ingin mengucapkan terima kasih kepada semua pelanggan yang mengirimi kami pertanyaan / keinginan terkait dengan penerapan aplikasi berdasarkan API kami.  Terima kasih kepada Anda, sebuah penelitian dilakukan, dalam kerangka di mana beberapa kekurangan diidentifikasi dan diperbaiki. <br><br>  Contoh yang dijelaskan dalam artikel ini secara bertahap akan tumbuh menjadi klien HTML lengkap untuk Lines.  Semua kode dapat dibaca, Anda dapat mengubahnya atau menggunakannya sebagai dasar untuk membangun solusi Anda sendiri.  API, seiring waktu, akan diisi dengan lebih banyak fitur, yang pasti akan kami informasikan. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id409999/">https://habr.com/ru/post/id409999/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id409989/index.html">Memerangi pemanasan global membutuhkan teknologi yang tidak kita miliki</a></li>
<li><a href="../id409991/index.html">Nakraudfandili: proyek terbaik untuk Januari 2018</a></li>
<li><a href="../id409993/index.html">Proyek Samsung Academy IoT - Pengajaran Internet Teknologi Hal</a></li>
<li><a href="../id409995/index.html">Cara membangun proses belajar bahasa Inggris - dari awal hingga menengah</a></li>
<li><a href="../id409997/index.html">Tiga film dokumenter menarik bagi para insinyur</a></li>
<li><a href="../id410001/index.html">Bagaimana persepsi manusia tentang ruang berkembang, dan mengapa kita perlu pengukuran</a></li>
<li><a href="../id410003/index.html">Temuan Penelitian: Pembajakan Membantu Meningkatkan Penjualan untuk Banyak Seniman</a></li>
<li><a href="../id410005/index.html">Memadamkan listrik</a></li>
<li><a href="../id410007/index.html">Distr. Tinjauan program yang bermanfaat terlambat selama 16 tahun</a></li>
<li><a href="../id410009/index.html">Apakah keamanan pribadi blockchain atau bahaya pribadi?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>