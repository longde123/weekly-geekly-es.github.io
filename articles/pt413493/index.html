<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö¥üèæ ü§∞ üö± Infra-estrutura de chave p√∫blica (continua√ß√£o): Autoridade de Certifica√ß√£o baseada em OpenSSL e SQLite3 „Ä∞Ô∏è ‚ÄºÔ∏è üîß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Se um dos principais objetos da infraestrutura de chave p√∫blica (PKI) for certificados X509, o assunto central da PKI ser√£o as Autoridades de Certific...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Infra-estrutura de chave p√∫blica (continua√ß√£o): Autoridade de Certifica√ß√£o baseada em OpenSSL e SQLite3</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413493/"><img src="https://habrastorage.org/webt/60/9k/sk/609ksklwykcs1xqbwuoyvqw7wg8.png" align="left" alt="imagem">  Se um dos principais objetos da infraestrutura de chave p√∫blica (PKI) for certificados X509, o assunto central da PKI ser√£o as Autoridades de Certifica√ß√£o (CAs).  √â a CA que emite certificados, encerra sua validade (revoga√ß√£o de certificado), confirma sua validade.  Nas p√°ginas do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Habrahabr,</a> voc√™ pode encontrar v√°rias publica√ß√µes sobre a emiss√£o de certificados digitais usando o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">OpenSSL</a> . <a name="habracut"></a>  Basicamente, esses artigos discutem o uso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">do utilit√°rio openssl</a> , descrevem sua interface de linha de comando e trabalham com arquivos que armazenam tudo: chaves, solicita√ß√µes, certificados, incluindo a raiz, etc.  Por√©m, se voc√™ desenvolver um CA (centro de certifica√ß√£o) completo baseado no OpenSSL, √© natural querer se livrar dessa variedade de arquivos e passar a trabalhar com bancos de dados, al√©m de ter uma interface gr√°fica para emitir e gerenciar certificados.  E se voc√™ se lembra da Lei Federal de 6 de abril de 2011.  No. 63- Nas assinaturas eletr√¥nicas, √© necess√°rio que a CA cumpra os requisitos desta lei, bem como os requisitos para o formul√°rio de um certificado qualificado para uma chave de verifica√ß√£o de assinatura eletr√¥nica, aprovada pela Ordem do Servi√ßo de Seguran√ßa Federal da R√∫ssia de 27 de dezembro de 2011 no 795. <br><br>  Os cidad√£os comuns t√™m a impress√£o de que as UTs s√£o algo enorme (bem, o Centro, quase como o Centro de Controle de Miss√µes). <br><br><img src="https://habrastorage.org/webt/b5/3v/g7/b53vg7cflxhkndwjyavz3ppfcuy.png" align="right" alt="imagem">  Do ponto de vista da responsabilidade da CA - √© exatamente isso.  Afinal, os certificados emitidos pela CA s√£o realmente iguais no passaporte hoje. <br><br>  Do ponto de vista de um programador, nem tudo √© t√£o assustador.  Assim, o projeto do centro de certifica√ß√£o CAFL63 nasceu.  A implementa√ß√£o do projeto CAFL63 √© baseada em tr√™s "pilares", a saber, OpenSSL, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SQLite3</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tcl / Tk</a> . <br><br>  Ent√£o, o que √© uma autoridade de certifica√ß√£o hoje?  Em primeiro lugar, √© o Centro de Registro, onde representantes de pessoas jur√≠dicas, indiv√≠duos e empreendedores individuais solicitam certificados com um pacote de documentos necess√°rios, em particular, identificando a identidade e a autoridade do solicitante.  Eles podem vir com aplicativos prontos eletronicamente.  O CR verifica os documentos, a solicita√ß√£o (dados preenchidos, a exatid√£o da assinatura eletr√¥nica etc.) e, se tudo correu bem, eles aceitam a solicita√ß√£o, a aprovam e a enviam para o Centro de Certifica√ß√£o (CA).  Mas isso √© ideal.  Na pr√°tica, tudo parece diferente. <br><br>  Cidad√£os, as organiza√ß√µes precisam de um certificado (para acesso ao portal dos Servi√ßos de Estado, para declara√ß√£o de impostos, para licita√ß√£o), mas n√£o sabem o que √© e o que fazer com ele.  Eles est√£o sinceramente convencidos de que a CA recebe uma assinatura eletr√¥nica como um fac-s√≠mile.  Mas esses s√£o problemas de ilumina√ß√£o.  Portanto, os candidatos v√™m √† Administra√ß√£o Central da Administra√ß√£o Central e apresentam documentos.  Juntamente com o funcion√°rio do Escrit√≥rio Central, eles v√£o para um local de trabalho separado e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">preparam uma solicita√ß√£o de</a> certificado: <br><br><img src="https://habrastorage.org/webt/-i/ni/fr/-inifrinlnabszqrmm9w11vpz98.png"><br><br>  Uma solicita√ß√£o preparada em m√≠dia eletr√¥nica, como j√° mencionado, √© recebida pelo CR.  O que o candidato precisa se lembrar?  Em primeiro lugar, pegue a m√≠dia com a chave privada criada! <br>  Uma solicita√ß√£o aprovada em m√≠dia eletr√¥nica √© transmitida √† CA, onde um certificado ser√° emitido em sua base. <br><br>  Este √© um diagrama esquem√°tico do trabalho da CA.  Os detalhes ficar√£o claros abaixo.  Uma observa√ß√£o, para conveni√™ncia da demonstra√ß√£o, o utilit√°rio para preparar uma solicita√ß√£o, CR e CA s√£o combinados em um complexo de demonstra√ß√£o.  Mas n√£o h√° problemas com a diversidade funcional.  O mais simples deles √© ter uma inst√¢ncia CAFL63 em cada local de trabalho e usar apenas a funcionalidade necess√°ria. <br><br>  Quando o projeto estava em pleno andamento, o projeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SimpleCA</a> chamou minha aten√ß√£o.  O estudo deste projeto ajudou muito na implementa√ß√£o final do CAFL63 CA. <br><br>  O c√≥digo fonte do utilit√°rio e suas distribui√ß√µes para plataformas Linux e MS Windows podem ser encontrados <div class="spoiler">  <b class="spoiler_title">aqui:</b> <div class="spoiler_text"><ul><li>  <a href="">c√≥digo fonte</a> </li><li>  <a href="">Linux32</a> </li><li>  <a href="">Linux64</a> </li><li>  <a href="">WIN32</a> </li><li>  <a href="">WIN64</a> </li></ul><br></div></div><br>  Portanto, execute o utilit√°rio CAFL63 e a p√°gina inicial aparece na tela: <br><br><img src="https://habrastorage.org/webt/ej/d4/6z/ejd46z3sdsymivi7ougryho9q-g.png"><br><br>  Come√ßamos o trabalho pressionando a tecla "Criar banco de dados".  O banco de dados da CA √© criado usando o DBMS entre plataformas do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SQLite3</a> .  O banco de dados da CA cont√©m v√°rias tabelas.  A tabela principal mainDB cont√©m apenas um registro, que armazena o certificado raiz, a chave privada criptografada com uma senha e as configura√ß√µes da CA.  H√° duas tabelas relacionadas √†s solicita√ß√µes de certificado: solicita√ß√µes atuais do reqDB e arquivamento de solicita√ß√£o do reqDBArc.  Tr√™s tabelas s√£o criadas para certificados: a tabela de novos certificados certDBNew, a tabela do arquivo de certificados certDB e a tabela de certificados revogados certDBRev: <br><br><pre><code class="sql hljs">. . . certdb eval {<span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> certDB( ckaID <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> , nick <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, sernum <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, certPEM <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, subject <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, notAfter <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, notBefore <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, dateRevoke <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, state <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> )} certdb eval {<span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> certDBRev( ckaID <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> )} certdb eval {<span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> certDBNew( ckaID <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> )} certdb eval {<span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> reqDB (ckaID <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span>, nick <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, sernum <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, subject <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, datereq <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">status</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, reqpem <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, pkcs7 <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>)} certdb eval {<span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> reqDBAr (ckaID <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span>, nick <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, sernum <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, subject <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, datereq <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">status</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, reqpem <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, pkcs7 <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>)} certdb eval {<span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> crlDB(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> autoincrement, signtype <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, issuer <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, publishdate <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, nextdate <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, crlpem <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>)} . . .</code> </pre> <br>  Todas as tabelas de solicita√ß√£o e certificado usam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o valor de hash</a> (sha1) da chave p√∫blica como chave (chave prim√°ria).  Por conveni√™ncia, no futuro, o valor do hash do valor da chave p√∫blica ser√° chamado CKAID (terminologia PKCS # 11).  Isso se mostrou muito conveniente, por exemplo, ao procurar um certificado mediante solicita√ß√£o ou vice-versa.  H√° outra tabela crlDB no banco de dados que armazena listas de certificados revogados. <br><br>  O valor da chave p√∫blica √© armazenado na solicita√ß√£o e no certificado.  Portanto, antes de coloc√°-los no banco de dados, voc√™ deve extrair a chave p√∫blica deles e calcular o CKAID.  Para extrair o valor da chave p√∫blica, √© conveniente usar o pacote pki (o pacote exige pki), que cont√©m ferramentas para trabalhar com certificados e solicita√ß√µes.  No entanto, este pacote n√£o foi projetado para funcionar com criptografia russa.  Nesse sentido, com base nos procedimentos parse_cert e parse_csr inclu√≠dos no pacote pki, escreva os procedimentos parceiros_cert_gost e parse_csr_gost: <br><br><pre> <code class="plaintext hljs">... ## Convert Pubkey type to string set pubkey_type [::pki::_oid_number_to_name $pubkey_type] # Parse public key, based on type switch -- $pubkey_type { "rsaEncryption" { set pubkey [binary format B* $pubkey] binary scan $pubkey H* ret(pubkey) ::asn::asnGetSequence pubkey pubkey_parts ::asn::asnGetBigInteger pubkey_parts ret(n) ::asn::asnGetBigInteger pubkey_parts ret(e) set ret(n) [::math::bignum::tostr $ret(n)] set ret(e) [::math::bignum::tostr $ret(e)] set ret(l) [expr {int([::pki::_bits $ret(n)] / 8.0000 + 0.5) * 8}] set ret(type) rsa } "1.2.643.2.2.19" - "1.2.643.7.1.1.1.1" - "1.2.643.7.1.1.1.2" { # gost2001, gost2012-256,gost2012-512 set pubkey [binary format B* $pubkey] binary scan $pubkey H* ret(pubkey) set ret(type) $pubkey_type ::asn::asnGetSequence pubkey_algoid pubalgost #OID -  ::asn::asnGetObjectIdentifier pubalgost oid1 #OID -   ::asn::asnGetObjectIdentifier pubalgost oid2 } default { error "Unknown algorithm" } } ...</code> </pre> <br>  Diferentemente dos procedimentos "nativos", eles permitem que voc√™ trabalhe com objetos n√£o apenas no formato PEM, mas tamb√©m no formato DER.  Para trabalhar com listas de revoga√ß√£o de certificados CRL, o procedimento parse_crl foi gravado.  Todos esses procedimentos podem ser encontrados no c√≥digo fonte, que √© armazenado com a distribui√ß√£o. <br><br>  Tamb√©m no pacote pki n√£o h√° oid-s russo, por exemplo, TIN, SNILS, etc.  Esse problema √© facilmente resolvido adicionando oid-s russo ao array :: pki :: oids: <br><br><pre> <code class="plaintext hljs">. . . set ::pki::oids(1.2.643.100.1) "OGRN" set ::pki::oids(1.2.643.100.5) "OGRNIP" set ::pki::oids(1.2.643.3.131.1.1) "INN" set ::pki::oids(1.2.643.100.3) "SNILS" #  set ::pki::oids(1.2.643.2.2.3) "  34.10-2001" set ::pki::oids(1.2.643.7.1.1.3.2) "  34.10-2012-256" set ::pki::oids(1.2.643.7.1.1.3.3) "  34.10-2012-512" . . .</code> </pre> <br>  Tendo as fun√ß√µes parse_cert_gost e parse_csr_gost, os valores de CKAID (chave prim√°ria para o banco de dados) s√£o calculados da seguinte maneira: <br><br><pre> <code class="plaintext hljs">. . . array set b [parse_csr_gost $req] set pem $b(pem) set subject $b(subject) set pubkey $b(pubkey) set key1 [binary format H* $pubkey] set ckaID [::sha1::sha1 $key1] . . .</code> </pre> <br>  Ent√£o, clique no bot√£o "Criar banco de dados": <br><br><img src="https://habrastorage.org/webt/fj/uh/3q/fjuh3qvrwugzxspgjchbonu9is0.png"><br><br>  A cria√ß√£o da CA come√ßa com a escolha do diret√≥rio no qual armazenaremos as configura√ß√µes de banco de dados e senha para acessar a chave privada da CA.  O utilit√°rio CAFL63 monitora cuidadosamente o tamanho da senha: <br><br><img src="https://habrastorage.org/webt/dw/eb/hf/dwebhfn5hqfjh8bv3jge5jxllx8.png"><br><br>  A senha √© armazenada no banco de dados da CA como um hash: <br><br><pre> <code class="plaintext hljs">. . . set hash256 [::sha2::sha256 $wizData(capassword)] . . .</code> </pre> <br>  Depois de pressionar a tecla ‚ÄúRastrear‚Äù, o processo de forma√ß√£o de um certificado raiz autoassinado da CA implantada √© iniciado.  Na primeira etapa deste processo, o tipo e os par√¢metros do par de chaves s√£o selecionados: <br><br><img src="https://habrastorage.org/webt/zr/e4/ag/zre4agh8ilw-tvjiy354y_o337c.png"><br><br>  Depois de escolher o par de chaves para o certificado raiz do centro de certifica√ß√£o criado, continuamos a preencher o formul√°rio com informa√ß√µes sobre o propriet√°rio (a primeira captura de tela est√° faltando). <br><br>  Observe que o utilit√°rio CAFL63 possui uma certa ‚Äúintelig√™ncia‚Äù e, portanto, controla n√£o apenas a disponibilidade de dados nos campos, mas tamb√©m a corre√ß√£o (destaque vermelho - incorreto) do preenchimento de campos como TIN, PSRN, SNILS, PSRNIP, endere√ßo de email, etc .: <br><br><img src="https://habrastorage.org/webt/4o/pt/vr/4optvrvc8o6gfd413eh5ggshby4.png"><br><br>  Depois de preencher os campos com informa√ß√µes sobre o propriet√°rio da CA, ela ser√° oferecida para determinar as configura√ß√µes do sistema da CA: <br><br><img src="https://habrastorage.org/webt/it/wq/nc/itwqnccdburbtmsdybckzdqf1u8.png"><br><br>  Se voc√™ n√£o trabalhar com criptografia russa, poder√° usar o OpenSSL usual.  Para trabalhar com criptografia russa, voc√™ deve selecionar a vers√£o apropriada, uma modifica√ß√£o do OpenSSL.  Para mais detalhes, leia README.txt na distribui√ß√£o baixada.  Como est√° planejado emitir certificados qualificados, tamb√©m √© necess√°rio fornecer informa√ß√µes sobre a certifica√ß√£o da pr√≥pria CA e o sistema de prote√ß√£o de informa√ß√µes criptogr√°ficas usado por ela (consulte ‚ÄúRequisitos para o formul√°rio de certificado qualificado de uma chave de verifica√ß√£o de assinatura eletr√¥nica‚Äù, aprovado pela Ordem do Servi√ßo de Seguran√ßa Federal da R√∫ssia de 27 de dezembro de 2011, n¬∫ 795). <br><br>  Depois de preencher corretamente todos os campos, mais uma vez, ser√° oferecido para verificar a precis√£o e clicar no bot√£o "Concluir": <br><br><img src="https://habrastorage.org/webt/zo/pd/xf/zopdxfb8rtzcvoei5xuvpt7udqe.png"><br><br>  Ap√≥s clicar no bot√£o "Concluir", o banco de dados da CA ser√° criado no qual o certificado raiz da CA, a chave privada, as configura√ß√µes do sistema ser√£o salvas e a p√°gina inicial do utilit√°rio CAFL63 ser√° exibida na tela novamente.  Agora que criamos o banco de dados da CA rec√©m-criada, clicamos no bot√£o "Abrir banco de dados", selecionamos o diret√≥rio com o banco de dados, vamos para a janela principal de trabalho da CA e clique no bot√£o "Exibir CA CA", verifique se o certificado raiz que criamos : <br><br><img src="https://habrastorage.org/webt/c-/x_/3r/c-x_3r8rrexuvvbov7ayzay6pze.png"><br><br>  O pr√≥ximo passo √© preparar modelos / perfis de aplicativos para entidades legais, indiv√≠duos e empreendedores individuais ( <b><i>Ferramentas-&gt; Configura√ß√µes-&gt; Tipos de Certificados-&gt; Novo</i></b> ): <br><br><img src="https://habrastorage.org/webt/hw/-o/ml/hw-omloedtpyfgtfq1vex8h3mug.png"><br><br>  Ap√≥s especificar o nome do novo perfil, ser√° proposto determinar sua composi√ß√£o: <br><br><img src="https://habrastorage.org/webt/bf/yc/g_/bfycg_oxromnvlpisghe64bbuwe.png"><br><br>  A composi√ß√£o do perfil √© determinada pelo nome distinto.  Cada perfil possui sua pr√≥pria composi√ß√£o com campos / oids obrigat√≥rios (obrigat√≥rios) ou n√£o.  A composi√ß√£o do perfil para pessoas jur√≠dicas, indiv√≠duos e empreendedores individuais √© determinada pelos requisitos da Lei Federal 63 e pelo FSB da R√∫ssia "Requisitos para o formul√°rio de certificado qualificado de um certificado de chave de verifica√ß√£o de assinatura eletr√¥nica". <br><br>  Depois de preparar os perfis, a CA est√° pronta para receber solicita√ß√µes e solicita√ß√µes deles.  Como observado acima, o requerente pode vir com ou sem uma solicita√ß√£o pronta para um certificado. <br>  Se o requerente veio com um aplicativo pronto, depois de verificar seus documentos, o aplicativo √© importado para o banco de dados da CA.  Para fazer isso, selecione a guia "Solicita√ß√µes de certificados" na janela principal de trabalho, clique no bot√£o "Solicita√ß√£o de importa√ß√£o / CSR" e selecione o arquivo com a solicita√ß√£o.  Depois disso, uma janela com informa√ß√µes sobre a solicita√ß√£o ser√° exibida: <br><br><img src="https://habrastorage.org/webt/rd/dz/ry/rddzryagss1nr3eodjcs08bwero.png"><br><br>  Ap√≥s revisar a solicita√ß√£o e verificar se ela foi preenchida corretamente, voc√™ pode clicar no bot√£o "Importar" para inseri-la no banco de dados.  Imediatamente, observamos que quando voc√™ tenta refazer uma solicita√ß√£o no banco de dados da CA, uma mensagem ser√° exibida: <br><br><img src="https://habrastorage.org/webt/ih/dy/q_/ihdyq_rplawbuh56jkw2czs8cto.png"><br><br>  As solicita√ß√µes no banco de dados da CA s√£o marcadas (coluna "Tipo") como "Localidade" criada no centro de registro da CA ou como "Importa√ß√£o" criada pelo pr√≥prio solicitante, e o hor√°rio de recebimento do aplicativo na CA tamb√©m √© registrado.  Isso pode ser √∫til na resolu√ß√£o de situa√ß√µes de conflito.  Portanto, ao importar uma solicita√ß√£o de certificado, voc√™ deve indicar quem criou a solicita√ß√£o (consulte a captura de tela). <br>  O aplicativo importado est√° localizado no banco de dados da CA e √© exibido na janela principal na guia "Solicita√ß√µes de certificado".  As solicita√ß√µes recebidas est√£o no est√°gio "considera√ß√£o" (a coluna "Status" das guias "Solicita√ß√µes de certificado" e "Arquivos de solicita√ß√£o").  Para cada solicita√ß√£o rec√©m-recebida, uma decis√£o deve ser tomada (menu suspenso quando voc√™ clica com o bot√£o direito do mouse na solicita√ß√£o selecionada): <br><br><img src="https://habrastorage.org/webt/2e/08/l1/2e08l1p6pmp0ebvd_l1yi1b7aiy.png"><br><br>  Cada solicita√ß√£o deve ser rejeitada ou aprovada: <br><br><img src="https://habrastorage.org/webt/hx/al/pt/hxalptjfajymsui_5xmtpxqnemc.png"><br><br>  Se a solicita√ß√£o for rejeitada, ela ser√° movida da tabela de solicita√ß√µes reqDB atuais para a tabela do archive de solicita√ß√µes reqDBArc e, consequentemente, desaparecer√° na guia "Solicita√ß√µes de certificado" e aparecer√° na guia "Solicitar arquivamento". <br><br>  O aplicativo aprovado permanece na tabela reqDB e na guia "Solicita√ß√µes de certificado" at√© que o certificado seja emitido e, em seguida, tamb√©m termina no arquivo morto. <br><br>  Antes de emitir o certificado, √© necess√°rio esclarecer com o solicitante para que fins (por exemplo, para acessar o portal dos Servi√ßos de Estado) o certificado ser√° usado ( <b><i>Ferramentas-&gt; Configura√ß√µes-&gt; Tipos de Certificado -&gt; Individual -&gt; Editar -&gt; Uso da Chave</i></b> ): <br><br><img src="https://habrastorage.org/webt/2p/kt/jm/2pktjm2nczklrb2mime0exznj7u.png"><br><br>  Para emitir um certificado, voc√™ deve selecionar o aplicativo aprovado na guia "Solicita√ß√£o de certificados", clicar com o bot√£o direito do mouse e selecionar "Emitir certificado" no menu suspenso.  No widget exibido, voc√™ precisar√° selecionar o perfil ao qual o perfil da solicita√ß√£o / certificado deve corresponder: <br><br><img src="https://habrastorage.org/webt/tl/b6/x0/tlb6x0l6lk9i8c01qnyvqma-4si.png"><br><br>  Observe que, no processo de emiss√£o de um certificado, voc√™ pode esclarecer os valores de um campo espec√≠fico: <br><br><img src="https://habrastorage.org/webt/v1/07/4k/v1074kdeoyswmznoaaxx-gi7pee.png"><br><br>  O procedimento para emitir um certificado em si (item de menu "Emitir um certificado") difere pouco do procedimento para criar um certificado raiz ou emitir um aplicativo: <br><br><img src="https://habrastorage.org/webt/xc/yk/ls/xcyklse8bwkvsqwwqfakk_o0dvu.png"><br><br>  O certificado emitido aparecer√° imediatamente na guia Certificados.  Nesse caso, o pr√≥prio certificado cai na tabela certDBNew do banco de dados da CA e permanece l√° at√© ser publicado.  Um certificado √© considerado publicado ap√≥s ser exportado para o dump SQL de novos certificados, que √© transferido para um servi√ßo p√∫blico.  A publica√ß√£o de um certificado o move da tabela certDBNew para a tabela certDB. <br><br>  Se voc√™ clicar com o bot√£o direito do mouse na linha selecionada na guia "Certificados", um menu com as seguintes fun√ß√µes ser√° exibido: <br><br><img src="https://habrastorage.org/webt/pz/f1/yn/pzf1ynfqhicu8ferbge-gtgyc9i.png"><br><br>  Essas fun√ß√µes permitem visualizar o certificado em si e a solicita√ß√£o com base na qual foi emitido.  Voc√™ tamb√©m pode exportar o certificado para um arquivo ou para a unidade flash de um candidato.  A fun√ß√£o mais importante aqui √© a fun√ß√£o de revoga√ß√£o de certificado!  H√° um recurso t√£o ex√≥tico como exportar um certificado para um cont√™iner seguro PKCS # 12.  √â utilizado quando o requerente deseja receber esse recipiente.  Para esses solicitantes, √© especialmente fornecida uma fun√ß√£o de gera√ß√£o de solicita√ß√£o com o salvamento da chave privada em um arquivo (bot√£o "Criar solicita√ß√£o / CSR" na guia "Solicita√ß√µes de certificado"). <br><br>  Ent√£o, a CA come√ßou sua vida, emitiu o primeiro certificado.  Um dos objetivos da CA √© a organiza√ß√£o do acesso livre aos certificados emitidos.  A publica√ß√£o de certificados geralmente passa por servi√ßos da Web.  O CAFL63 tamb√©m possui este servi√ßo: <br><br><img src="https://habrastorage.org/webt/xt/a7/6w/xta76wp2bsjapckltfuqkl0pr2y.png"><br><br>  Para publicar certificados e listas de certificados revogados em um servi√ßo p√∫blico, a CA pr√©-carrega os certificados em arquivos ( <b><i>Certificados-&gt; Exportar Certificados</i></b> ) ou faz um despejo SQL de toda a tabela de certificados a partir da qual voc√™ pode criar um banco de dados de certificados e carreg√°-los nele, e depois execut√°-los. Despejo SQL de novos certificados dos quais eles ser√£o adicionados ao banco de dados de servi√ßo p√∫blico: <br><br><img src="https://habrastorage.org/webt/he/_d/1n/he_d1nxytwkmjwe-skvpzlzadig.png"><br><br>  A fun√ß√£o fundamental de uma AC √© publicar uma lista de certificados revogados, semelhante √† maneira como o Minist√©rio da Administra√ß√£o Interna faz com rela√ß√£o aos passaportes vencidos.  O certificado pode ser revogado a pedido do propriet√°rio.  O principal motivo da revoga√ß√£o √© a perda da chave privada ou a confian√ßa nela. <br><br>  Para revogar um certificado, selecione-o na guia "Certificados", clique com o bot√£o direito do mouse e selecione o item de menu "Revoga√ß√£o de certificado": <br><br><img src="https://habrastorage.org/webt/ai/7p/hk/ai7phklvqrbu1a0z7yl-xi-5xxw.png"><br><br>  O procedimento de revoga√ß√£o n√£o √© diferente do procedimento de aprova√ß√£o de uma solicita√ß√£o ou emiss√£o de um certificado.  O certificado revogado cai na tabela cerDBRev do banco de dados da CA e aparece na guia "Certificados revogados". <br><br>  Resta considerar a √∫ltima fun√ß√£o da CA - o lan√ßamento da CRL - uma lista de certificados revogados.  A lista da CRL √© formada na guia "Certificados revogados" quando voc√™ clica no bot√£o "Criar SOS / CRL".  Tudo o que √© necess√°rio para o administrador √© digitar a senha da CA e confirmar sua inten√ß√£o de emitir a CRL: <br><br><img src="https://habrastorage.org/webt/5t/db/_c/5tdb_csh_qehcmmlaws9t75pssc.png"><br><br>  A CRL emitida cai na tabela crlDB do banco de dados e √© exibida na guia CRL / SOS. <br><br>  Para analisar a CRL antes de coloc√°-la no banco de dados, o procedimento parse_crl foi gravado: <br><br><pre> <code class="plaintext hljs">proc parse_crl {crl} { array set ret [list] if { [string range $crl 0 9 ] == "-----BEGIN" } { array set parsed_crl [::pki::_parse_pem $crl "-----BEGIN X509 CRL-----" "-----END X509 CRL-----"] set crl $parsed_crl(data) } ::asn::asnGetSequence crl crl_seq ::asn::asnGetSequence crl_seq crl_base ::asn::asnGetSequence crl_base crl_full ::asn::asnGetObjectIdentifier crl_full ret(signtype) #puts "KEY_TYPE=$ret(signtype)" ::::asn::asnGetSequence crl_base crl_issue set ret(issue) [::pki::x509::_dn_to_string $crl_issue] #puts "ISSUE=$ret(issue)" ::asn::asnGetUTCTime crl_base ret(publishDate) ::asn::asnGetUTCTime crl_base ret(nextDate) #puts "publishDate=$ret(publishDate)" return [array get ret] }</code> </pre> <br>  Para visualizar a CRL ou export√°-la para publica√ß√£o em um servi√ßo p√∫blico, voc√™ deve, como sempre, selecionar a linha desejada, clicar com o bot√£o direito do mouse e selecionar o item de menu apropriado: <br><br><img src="https://habrastorage.org/webt/np/c7/f2/npc7f2i1qb_rvyreerzj6wrbjgc.png"><br><br>  Isso √© tudo, a Autoridade de Certifica√ß√£o est√° pronta. <br><img src="https://habrastorage.org/webt/q1/i1/vs/q1i1vspugm4raux1pq5chgyysd4.png" align="left" alt="imagem">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Descubra</a> como montar e conectar o OpenSSL √† criptografia russa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt413493/">https://habr.com/ru/post/pt413493/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt413481/index.html">Exportar √°rvore de teste do JMeter para texto</a></li>
<li><a href="../pt413485/index.html">Lan√ßamento do GitLab 10.8: espelhamento de push de c√≥digo aberto e implanta√ß√£o incremental</a></li>
<li><a href="../pt413487/index.html">O que um desenvolvedor deve esperar no campo das finan√ßas: condi√ß√µes de trabalho, projetos e habilidades necess√°rias</a></li>
<li><a href="../pt413489/index.html">Como escolher um messenger verdadeiramente seguro e o que a blockchain tem a ver com isso</a></li>
<li><a href="../pt413491/index.html">Food Design Digest, maio de 2018</a></li>
<li><a href="../pt413495/index.html">Implanta√ß√£o r√°pida ou como implantar front-end em 15 minutos</a></li>
<li><a href="../pt413499/index.html">Abertura de um programa de mestrado conjunto no JetBrains e ITMO</a></li>
<li><a href="../pt413501/index.html">O ano passado com o React: conclus√µes e recomenda√ß√µes</a></li>
<li><a href="../pt413503/index.html">Corrija-me se puder: como estamos depurando a produ√ß√£o. Parte 1</a></li>
<li><a href="../pt413505/index.html">2 ingressos gratuitos para a In-Memory Computing Summit Europe</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>