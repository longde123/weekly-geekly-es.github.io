<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤙🏾 🛌🏽 🤘🏽 El no te necesita 💪 🤘🏾 🖖🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En relación con la creciente popularidad de Rook, quiero hablar sobre sus trampas y los problemas que le esperan en el camino. 

 Acerca de mí: experi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>El no te necesita</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452174/"> En relación con la creciente popularidad de Rook, quiero hablar sobre sus trampas y los problemas que le esperan en el camino. <br><br>  Acerca de mí: experiencia de administración de Ceph con la versión hammer, fundador de la comunidad <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">t.me/ceph_ru</a> en telegramas. <br><br>  Para no ser infundado, me referiré a publicaciones aceptadas por Habr (a juzgar por la calificación) sobre problemas con ceph.  Encontré la mayoría de los problemas en estas publicaciones también.  Enlaces al material utilizado al final de la publicación. <br><br>  En la publicación sobre Rook, mencionamos ceph por una razón: Rook es esencialmente ceph envuelto en kubernetes, lo que significa que hereda todos sus problemas.  Comenzaremos con problemas cefálicos. <br><a name="habracut"></a><br><h3>  Simplifique la gestión de clústeres </h3><br>  Una de las ventajas de Rook es la conveniencia de administrar ceph a través de kuberentes. <br><br>  Sin embargo, ceph contiene más de 1000 parámetros para afinar, al mismo tiempo a través de la torre podemos editar solo una pequeña parte de ellos. <br><blockquote>  Ejemplo luminoso <br>  &gt; ceph daemon mon.a config show |  wc -l <br>  1401 </blockquote>  <b>Rook se posiciona como una forma conveniente de instalar y actualizar ceph</b> <br>  No hay problemas con la instalación de ceph sin Rook: el libro de jugadas se escribe en 30 minutos, pero hay muchos problemas con la actualización de los problemas. <br><br>  <i>Cita de la publicación de Krok</i> <br><br><blockquote>  Ejemplo: operación incorrecta de los elementos ajustables después de actualizar de hummer a joya <br><br>  &gt; ceph osd crush show-tunables <br>  { <br>  ... <br>  "Straw_calc_version": 1, <br>  "Allowed_bucket_algs": 22, <br>  "Perfil": "desconocido", <br>  Óptimas optimizables: 0, <br>  ... <br>  } </blockquote>  Pero incluso dentro de las versiones menores hay problemas. <br><br>  Ejemplo: la actualización 12.2.6 lleva el clúster al error de salud y PG condicionalmente roto <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ceph.com/releases/v12-2-8-released</a> <br><br>  No actualizar, esperar y probar?  Pero también utilizamos Rook para la comodidad de las actualizaciones. <br><br><h3>  La complejidad del clúster de recuperación ante desastres en Rook </h3><br>  Ejemplo: OSD bloquea errores de erupción bajo sus pies.  Sospecha que el problema está en uno de los parámetros en la configuración, desea cambiar la configuración para un demonio específico, pero no puede, porque tiene kubernetes y DaemonSet. <br><br>  No hay alternativa  ceph tell osd. Num injectargs no funciona - OSD miente. <br><br><h3>  Complejidad de depuración </h3><br>  Para algunas configuraciones y pruebas de rendimiento, debe conectarse directamente al zócalo del demonio osd.  En el caso de Rook, primero debe encontrar el contenedor correcto, luego entrar en él, encontrar los que faltan para la optimización de depuración y estar muy molesto. <br><br><h3>  La dificultad de elevar secuencialmente el OSD </h3><br>  Ejemplo: OSD cae en OOM, comienza el reequilibrio, luego el siguiente otoño. <br><br>  Solución: aumente el OSD de uno en uno, espere a que se incluya por completo en el clúster y aumente los siguientes.  (Más en el informe de Ceph. Anatomy of a disaster.) <br><br>  En el caso de la instalación de metal desnudo, esto se hace simplemente a mano, en el caso de Rook y una OSD en el nodo no hay problemas particulares, ocurrirán problemas con el levantamiento sucesivo si OSD&gt; 1 en el nodo. <br><br>  Por supuesto, son solucionables, pero llevamos Rook para simplificar, pero tenemos complicaciones. <br><br><h3>  La dificultad de seleccionar límites para ceph demonios </h3><br>  Para instalaciones cefálicas de metal desnudo, es bastante fácil calcular los recursos necesarios por conglomerado: hay fórmulas y hay estudios.  Cuando se utilizan CPU débiles, aún debe realizar una serie de pruebas de rendimiento para descubrir qué es Numa, pero sigue siendo más simple que en Rook. <br><br>  En el caso de Rook, además de los límites de memoria que se pueden calcular, surge la cuestión de establecer el límite de la CPU. <br><br>  Y luego tienes que sudar con las pruebas de rendimiento.  En caso de subestimar los límites, obtendrá un clúster lento, en el caso de no establecer límites, obtendrá un uso activo de la CPU con reequilibrio, lo que afectará gravemente sus aplicaciones en kubernetes. <br><br><h3>  Problemas de red v1 </h3><br>  Para ceph, se recomienda usar una red de 2x10gb.  Uno para tráfico de clientes, otro para uso de oficina ceph (reequilibrio).  Si vives con ceph en baremetal, entonces esta separación es fácil de configurar, si vives con Rook, entonces con la separación por redes te causará problemas, porque lejos de cada configuración de clúster te permite alimentar dos redes diferentes a pod. <br><br><h3>  Problemas de red v2 </h3><br>  Si se niega a compartir redes, con el reequilibrio, el tráfico ceph obstruirá todo el canal y sus aplicaciones en kubernetes se ralentizarán o se bloquearán.  Puede reducir la tasa de reequilibrio cefálico, pero luego, debido al reequilibrio prolongado, aumenta el riesgo de que el segundo nodo se caiga del clúster en discos u OOM, y ya se garantiza la lectura solo en el clúster. <br><br><h3>  Reequilibrio largo: frenos de aplicación larga </h3><br>  <i>Cita de una publicación de Ceph.</i>  <i>Anatomía del desastre.</i> <br><blockquote>  Prueba de rendimiento del clúster: <br><br>  Una operación de escritura de 4 KB toma 1 ms, rendimiento 1000 operaciones / segundo en 1 flujo. <br><br>  Una operación de 4 MB de tamaño (tamaño de objeto) toma 22 ms, rendimiento 45 operaciones / segundo. <br><br>  Por lo tanto, cuando uno de los tres dominios falla, el clúster se encuentra en un estado degradado durante algún tiempo y la mitad de los objetos calientes se propagarán según las diferentes versiones, luego la mitad de las operaciones de escritura comenzarán con una recuperación forzada. <br><br>  El tiempo de recuperación forzada se calcula aproximadamente: operaciones de escritura en un objeto degradado. <br><br>  Primero, leemos 4 MB en 22 ms, escribimos 22 ms, y luego 1 ms escribimos 4 KB de datos en sí.  En total, 45 ms para una operación de escritura en un objeto degradado en el SSD, cuando el rendimiento estándar fue de 1 ms, una caída de rendimiento de 45 veces. <br><br>  Cuanto más tengamos el porcentaje de objetos degradados, peor será. </blockquote>  Resulta que la tasa de reequilibrio es crítica para el correcto funcionamiento del clúster. <br><br><h3>  Configuraciones específicas del servidor para ceph </h3><br>  ceph puede necesitar un ajuste de host específico. <br><br>  Ejemplo: configuración de sysctl y el mismo JumboFrame, algunas de estas configuraciones pueden afectar negativamente su carga útil. <br><br><h3>  La verdadera necesidad de una torre sigue en cuestión </h3><br>  Si está en la nube, tiene almacenamiento de su proveedor de nube, lo cual es mucho más conveniente. <br><br>  Si está en sus servidores, entonces la administración de ceph será más conveniente sin kubernetes. <br><br>  ¿Alquila un servidor en algún alojamiento de bajo costo?  Entonces encontrará mucha diversión con la red, sus retrasos y ancho de banda, lo que obviamente afecta negativamente a ceph. <br><br>  <b>Total:</b> La introducción de kuberentes y la introducción del repositorio son tareas diferentes con diferentes opciones introductorias y diferentes soluciones: mezclarlas y luego hacer una compensación peligrosa por el bien de esto o aquello.  Combinar estas soluciones será muy difícil incluso en la etapa de diseño, y todavía hay un período de operación. <br><br>  Lista de literatura utilizada: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Post # 1</a> Pero tú dices Ceph ... pero ¿es bueno? <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Puesto # 2</a> Ceph.  Anatomía del desastre </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/452174/">https://habr.com/ru/post/452174/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../452158/index.html">TOPchik: un complemento abierto de WordPress para la verificación gratuita de las posiciones del sitio para consultas de búsqueda, a través de la API Yandex.XML</a></li>
<li><a href="../452162/index.html">Bot para VK en Python con MySQL en una hora, parte 1</a></li>
<li><a href="../452164/index.html">ModLook: escáner de registro ModBus. Celebrando el 20 aniversario del programa</a></li>
<li><a href="../452168/index.html">Creando un juego de ritmo en Unity</a></li>
<li><a href="../452172/index.html">Sistemas complejos Alcanzando un nivel crítico</a></li>
<li><a href="../452178/index.html">Análisis: 23 errores populares en inglés escrito y cómo evitarlos</a></li>
<li><a href="../452180/index.html">Elevamos el rendimiento de SSD desde las rodillas, dónde hacer clic y por qué</a></li>
<li><a href="../452182/index.html">Encuesta de empleados. El principal error</a></li>
<li><a href="../452184/index.html">Sobre el anonimato en blockchains basados ​​en cuentas</a></li>
<li><a href="../452186/index.html">Los lenguajes de programación más raros y caros</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>