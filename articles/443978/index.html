<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòó üë©üèø‚Äçüé§ ü¶ë ATtiny13 vs PLC, o c√≥mo obtener 14 E / S de un controlador de 8 pies üë®üèº‚Äç‚úàÔ∏è üßëüèø‚Äçü§ù‚Äçüßëüèº ü•Ç</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Antes de continuar, me gustar√≠a advertir a un lector entusiasta. 



1. Lo que describo no se puede hacer por muchas razones, estas razones se te indi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ATtiny13 vs PLC, o c√≥mo obtener 14 E / S de un controlador de 8 pies</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443978/"><img src="https://habrastorage.org/webt/lk/bp/pb/lkbppbhy4dv1ifgmfeoc3w_mcua.jpeg" alt="imagen"><br><br>  Antes de continuar, me gustar√≠a advertir a un lector entusiasta. <br><br><ol><li>  Lo que describo no se puede hacer por muchas razones, estas razones se te indicar√°n con alegr√≠a en los comentarios, y de ninguna manera te insto a que lo hagas.  Y en ning√∫n caso afirmo que el dispositivo descrito a continuaci√≥n puede reemplazar un PLC real.  Todo lo descrito se hizo solo para demostrarme a m√≠ mismo que esto es t√©cnicamente posible y no se aplica a equipos reales. </li><li>  Si te sientes mal solo por mencionar la palabra "Arduino", es mejor que no leas.  Realic√© todas las acciones con el controlador en Arduino IDE, es m√°s f√°cil para m√≠.  Pero nada impide hacer lo mismo sin usarlo. </li></ol><a name="habracut"></a><br>  Durante mucho tiempo quise escribir un art√≠culo sobre mis experimentos con ATtiny13, pero me asust√≥ principalmente la actitud hacia los arduinoistas en el sitio.  Adem√°s, he estado trabajando con controladores por solo unos a√±os (gracias de nuevo a Arduino, ¬°oh, d√≥nde has estado antes!).  Comentarios sobre el art√≠culo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tres ojos cuelgan de la publicaci√≥n ...</a> mostraron que el tema sigue siendo interesante para un n√∫mero suficiente de usuarios.  Por cierto, se supon√≠a que el t√≠tulo del art√≠culo era "PLC en ATtiny13", pero en los mismos comentarios, cort√©smente me explicaron <s>en la mesa</s> que el dispositivo descrito no pod√≠a llamarse "PLC".  Pues no, no. <br><br><h3>  ¬øQu√© necesitamos del PLC? </h3><br>  Comenz√≥ con el hecho de que quer√≠a hacer un an√°logo funcional de los PLC que se usan en mi empresa, teniendo en cuenta c√≥mo se usan.  La mayor√≠a de los circuitos de control tenemos rel√© con todas las deficiencias subsiguientes.  Los PLC de varios tipos tambi√©n se usan en lugares, a partir de los a√±os 90.  B√°sicamente, realizan la tarea l√≥gica del circuito de control, comenzando desde el estado de los interruptores de l√≠mite y sensores de proximidad. <br><br>  Sin interfaces complejas, sin se√±ales anal√≥gicas.  Encendido / Apagado  Eso es todo.  En su mayor parte, incluso la carga para las salidas del PLC es proporcionada por los mismos rel√©s de los que estaban tan ansiosos por deshacerse.  (Lo curioso es que en casi todas partes se utilizan salidas de rel√© PLC, que conmutan rel√©s externos, que conmutan electroimanes de distribuidores hidr√°ulicos ... A veces se agrega un enlace m√°s desde el arrancador). Entonces, ¬øqu√© necesito del PLC: <br><br><ol><li>  Entradas discretas para un nivel de se√±al de 24 voltios. </li><li>  Salidas discretas con un voltaje de 24 voltios. </li><li>  Probar el algoritmo interno de acuerdo con un esquema dado, que se puede cambiar si es necesario (principalmente durante la depuraci√≥n). </li><li>  Velocidad de aproximadamente 50 ms, ya no es necesaria para reemplazar los circuitos de rel√©. </li></ol><br>  Y eso es todo.  Sin interfaces  Sin interrupciones  No hay pantallas  Ah, s√≠, las pantallas ... No har√° da√±o mostrar el estado de las entradas y salidas; aqu√≠, los LED a√∫n no tienen LED m√°s confiables.  Bueno, no olvides que todo se hace por inter√©s deportivo, respectivamente, el presupuesto recae sobre los hombros del desarrollador.  Por cierto, un muy buen incentivo. <br><br>  Si no tiene en cuenta el nivel de se√±al de 24 voltios, absolutamente cualquier microcontrolador con el n√∫mero de E / S (entradas / salidas) no menos que el requerido puede hacer frente f√°cilmente a la tarea. <br><br><h3>  Nos ocupamos de los niveles. </h3><br>  Inicialmente, quer√≠a usar optoacopladores en las entradas.  Cualquiera que est√© m√°s o menos versado en electr√≥nica, especialmente industrial, sabe que no hay muchos optoacopladores.  Los comentarios le explicar√°n en detalle por qu√© es imposible sin optoacopladores.  Pero sopes√© los pros y los contras, y decid√≠ negarme.  Por lo tanto, algunos pueden no seguir leyendo e inmediatamente proceder a escribir un comentario. <br>  Entonces, tenemos una se√±al de entrada de 24 voltios, o 0 voltios en ausencia de una se√±al.  Esto permitir√° el uso de un sensor de posici√≥n inductivo sin contacto o un interruptor de l√≠mite de contacto convencional.  A partir de 24 voltios, debe obtener el voltaje de la unidad l√≥gica segura para el controlador.  El viejo divisor de voltaje hace frente a esto lo mejor posible. <br><br><img src="https://habrastorage.org/webt/k4/mh/5u/k4mh5u-z5xmykgkjexscgcu_pba.jpeg" alt="imagen"><br><br>  Las resistencias se calculan teniendo en cuenta que para cualquier desviaci√≥n del voltaje de entrada en m√°s o menos el 20% del voltaje nominal en la entrada del microcontrolador, debe haber m√°s del voltaje de conmutaci√≥n (generalmente es la mitad del voltaje del controlador), pero no m√°s que el voltaje del controlador, lo consideramos igual a 5 V.  Apto para cualquier controlador de la familia AVR.  Adem√°s, la corriente estimada a trav√©s del divisor es de aproximadamente 7 mA, lo que reduce la probabilidad de interferencia y, al mismo tiempo, no carga demasiado la salida del sensor y la fuente de alimentaci√≥n.  Un diodo zener de 4.7 V sirve para proteger contra sobretensiones en la misma interferencia.  Todav√≠a hay un rebote de contactos, podemos luchar con √©l mediante programaci√≥n o no, es solo una maqueta.  Ahora todav√≠a tendr√≠a que indicar el estado de la entrada.  Y aqu√≠ puedes aplicar salvavidas, matando dos p√°jaros de un tiro: <br><br><img src="https://habrastorage.org/webt/q9/rd/bj/q9rdbjjfnccqucc0cl6h9_19pr0.jpeg" alt="imagen"><br><br>  El LED en el circuito realiza dos funciones: funciona como un diodo zener, limitando el voltaje a 2.8 ... 2.9 voltios (¬°solo para LED azules y blancos!), Bueno, tambi√©n brilla.  ¬°Debo advertirle que en algunos casos el voltaje en el LED no es suficiente para cambiar la entrada del controlador!  Cuando se utilizan varias entradas de controlador, simplificamos la instalaci√≥n y ahorramos varios diodos zener.  Al aumentar suavemente el voltaje de entrada, puede notar que el momento de encendido del LED y el momento de cambiar la entrada no coinciden un poco.  Pero esto no nos molesta mucho, ya que no deber√≠a haber niveles intermedios en la entrada, solo 0 V o 24 V. Naturalmente, en este momento deber√≠a tener al menos el firmware de prueba m√≠nimo para una entrada y una salida en el controlador. <br><br>  Ahora, la se√±al de salida del controlador tambi√©n debe adaptarse para 24 V, y teniendo en cuenta que el cable com√∫n, que tambi√©n es negativo, es com√∫n a todos los rel√©s de salida.  Aqu√≠ necesita al menos 2 transistores y 2 resistencias: <br><br><div class="spoiler">  <b class="spoiler_title">esquema</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/v6/ap/um/v6apumv_nl09p0ozminlcjzajp8.jpeg" alt="imagen"><br></div></div><br>  De hecho, se necesitar√≠a una resistencia m√°s y un diodo protector paralelo al rel√©, pero no se trata de eso.  Al principio us√© este circuito.  Pero en un momento, llam√© la atenci√≥n sobre los optoacopladores, que rechac√© al principio. <br><blockquote>  El que nos molesta nos ayudar√°. </blockquote><br><div class="spoiler">  <b class="spoiler_title">esquema</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/gr/hp/hf/grhphftzdbeeqn4qplwr1pup8z4.jpeg" alt="imagen"><br></div></div>  Observamos los par√°metros de los optoacopladores por hojas de datos: el PC817C m√°s barato y asequible por salida le permite cambiar U o: 35 V: I o: 50 mA.  Los rel√©s que est√°n conectados al PLC en nuestro lugar (en la empresa) toman hasta 45 mA.  Sin stock, pero bastante adecuado.  La mayor√≠a de los rel√©s de peque√±o tama√±o a 24 V extraen hasta 15 ... 20 mA.  Al final, puede comprar un optoacoplador m√°s costoso, si realmente lo necesita, hay corriente de hasta 80 mA y voltaje de hasta 60 V. Somos adecuados para el dise√±o y 817.  Para que no aprenda de sus errores, le advierto que para una corriente de salida m√°xima a trav√©s del LED del optoacoplador, debe pasar m√°s de 7 mA. <br><br>  Bueno, de nuevo, recuerda la indicaci√≥n.  Para mostrar el estado de la salida, agregamos un LED en serie con el LED del optoacoplador, todav√≠a tenemos m√°s de 3 voltios inactivos all√≠.  Y es hora de dibujar un diodo protector antes de quemar el optoacoplador.  Por cierto, no pude encontrar un m√©todo para elegir un diodo protector, dependiendo de los par√°metros del rel√©.  Por un lado, debe ser pulsado, por otro lado, de alto voltaje.  Adem√°s, se puede colocar paralelo al transistor, ¬øcu√°l es mejor?  La pr√°ctica muestra que un diodo IN4148 de potencia suficientemente baja en este caso, pero me gustar√≠a una justificaci√≥n te√≥rica. <br><br><div class="spoiler">  <b class="spoiler_title">esquema</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/yb/w6/-y/ybw6-ymcrmjzgumo8m3bcss2gek.jpeg" alt="imagen"><br></div></div><br>  Se indica una resistencia de 220 ohmios con el c√°lculo nuevamente en un LED azul o blanco, si se pone rojo, la corriente en el circuito de 3.5 mA aumentar√° a 9 mA, esto debe tenerse en cuenta. <br><br><h3>  Un poco sobre programaci√≥n </h3><br>  Bueno, hay tantas letras, pero a√∫n no he llegado al final del t√≠tulo, ni a ATtiny13.  Para programar mi controlador, utilic√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el proyecto FLProg</a> , un entorno de programaci√≥n visual que acerca la programaci√≥n del controlador lo m√°s posible a la programaci√≥n del PLC en LAD y FBD.  El circuito creado en este entorno, que tambi√©n es un proyecto, se compila en un boceto Arduino, que ya cargu√© desde el entorno Arduino a ATtiny13 u otro controlador de la familia AVR.  Por ejemplo, un esquema tan simple <br><br><img src="https://habrastorage.org/webt/wl/i9/1m/wli91mdh38s505j7e5qlz4dpxym.png" alt="imagen"><br><br>  compila en c√≥digo como este: <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> _k1 = <span class="hljs-number"><span class="hljs-number">0</span></span>;
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">
</span></span>{
pinMode(<span class="hljs-number"><span class="hljs-number">1</span></span>, INPUT);
pinMode(<span class="hljs-number"><span class="hljs-number">2</span></span>, INPUT);
pinMode(<span class="hljs-number"><span class="hljs-number">3</span></span>, OUTPUT);
}
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">
</span></span>{
_k1 = (((((!(digitalRead (<span class="hljs-number"><span class="hljs-number">1</span></span>)))) &amp;&amp;((digitalRead (<span class="hljs-number"><span class="hljs-number">2</span></span>))))) || ((((!(digitalRead (<span class="hljs-number"><span class="hljs-number">1</span></span>)))) &amp;&amp;(_k1))));
digitalWrite (<span class="hljs-number"><span class="hljs-number">3</span></span>, _k1);
}</code></pre><br>
     -   - ,   .     FLProg  ,       ¬´¬ª    .       ,      . , pin     ‚Äì      ,      .      ATtiny13,    : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">    Attiny13  Attiny13a   Arduino IDE</a> ,  : FLProg     ATtiny13 (     ),   ,     ,  ATmega168.  FLProg     ,    ATtiny13,     .    Arduino IDE     ,    .<br>
<br>
<h3>    </h3><br>
    ?    ATtiny13,      5 ,       .   ,   6 ,   ,  , : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> ?  RESET</a>.<br>
<br>
,  6,   .   ?<br>
<br>
  :<br>
<br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/i-/bo/y8/i-boy8fj5pf1ryijqu4pjdpyjto.jpeg" alt="image"><br>
</div></div><br>
 ,           .      .       ,    .  . <br>
<br>
  ,       50 . ,    50     ,    ,       .     ,   . <br>
<br>
        0   2,8 ,       ,           .  ,      ,    1,1  (   )  2,9 ,   4 .      ,  .<br>
<br>
   .      ,        ,  .      ,       ,    5 ,      --  ,       .          3  (   )  680 .      ,     .         ,   ,           .<br>
<br>
    ?       50 ,    1 ,    50 .  ,  1     ,             .       ,    .<br>
<br>
   ,     .       ,     . <br>
<br>
    6+6=12 -,    2?<br>
<br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><img src="https://habrastorage.org/webt/kf/rj/nu/kfrjnufoiyvhmwvetvqlf8x3mx4.jpeg" alt="image"><br>
</div></div><br>
,   ?     ,    )   4 , ,      ,     .          0 ,        ,  2,8 ,       (    ).        24,    0,  ,    2  ‚Äì 0,93   1,87 .         ,       .   Arduino IDE       ,            ATtiny,   .       ,    .<br>
<br>
,  , 6   10 (!)    ATtiny13     (     ). ,     ,     .         ,     ¬´¬ª  ATtiny. ,         ATmega8,     .     :-)<br>
<br>
            ,      .<br>
<br>
        ,        ,    ,     .   I/O     . ,   (8/6)    ,       ,     ¬´   ¬ª.<br>
<br>
 ,       , ,       ¬´¬ª,    <s></s>.  .<br>
<br>
P.S.       ,  : ¬´    ?¬ª<br>
<br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/uu/9d/ah/uu9dahstj6whlhfckbfknzfdth4.png" alt="image"><br>
</div></div></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/443978/">https://habr.com/ru/post/443978/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../443966/index.html">Google Docs: un chat favorito entre los estudiantes</a></li>
<li><a href="../443968/index.html">C√≥mo compramos una casa con paneles solares, y qu√© sali√≥ de ella</a></li>
<li><a href="../443972/index.html">Yandex buscar√° piratas usando un robot</a></li>
<li><a href="../443974/index.html">Memoria y Span pt. 1</a></li>
<li><a href="../443976/index.html">Memoria y Span pt.2</a></li>
<li><a href="../443980/index.html">Memoria y Span pt.3</a></li>
<li><a href="../443984/index.html">El nuevo est√°ndar basado en PCIe 5.0 "conectar√°" la CPU y la GPU, lo que se sabe al respecto</a></li>
<li><a href="../443986/index.html">Como una ardilla en una rueda o un poco sobre investigaci√≥n de usuarios en un entorno de discapacidad</a></li>
<li><a href="../443988/index.html">Arquitectura de microservicios = Computaci√≥n distribuida</a></li>
<li><a href="../443990/index.html">13 nuevos juegos introducidos como parte del programa ID @ Xbox</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>