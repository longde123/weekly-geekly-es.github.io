<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤽 🎬 📔 Wie die Hackathon-Schulkinder der NASA ein Fitness-Armband zur Steuerung einer Drohne rückentwickeln 👼🏿 🤾🏾 🎰</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor einem Jahr habe ich einen SONY SmartBand SWR10 Fitness-Tracker gekauft. Wie die meisten anderen Fitness-Tracker spielte das Gerät in meinem Leben ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie die Hackathon-Schulkinder der NASA ein Fitness-Armband zur Steuerung einer Drohne rückentwickeln</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/394095/"><img src="https://habrastorage.org/getpro/geektimes/post_images/86f/4c2/625/86f4c262532981aeea3de11fbcc89bb9.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vor einem Jahr habe ich einen SONY SmartBand SWR10 Fitness-Tracker gekauft. Wie die meisten anderen Fitness-Tracker spielte das Gerät in meinem Leben keine große Rolle, seine Hauptbeschäftigung lag auf meinem Tisch. Dies ist jedoch ein interessantes elektronisches Gerät, und als mich ein Freund einlud, seinem Team beim </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NASA Space Apps-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hackathon beizutreten </font><font style="vertical-align: inherit;">, entschied ich mich für den Tracker. Wir haben den Abschnitt Nicht meine Drohne abstürzen ausgewählt, in dem wir eine Lösung für die Steuerung der Drohne erstellen mussten. Es wurde beschlossen, diesen Tracker zur Steuerung der Drohne zu verwenden.</font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/641/1f3/df3/6411f3df36e060d9cbe9129335e14f1e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sobald der Hackathon begann, suchte ich nach der API meines Armbands oder nach Tools für Entwickler, aber es wurde nichts gefunden. Einige Forumbenutzer gaben an, dass SONY über ein proprietäres SDK verfügt, das Entwicklern zur Verfügung gestellt wird, die sich für eine Zusammenarbeit mit dem Unternehmen entscheiden. Im Rahmen des Hackathons könnten jedoch nur Open-Source-Lösungen verwendet werden. Also entschied ich, dass es Zeit war, meine eigene Drohnensteuerungsschnittstelle zu erstellen. Ich habe die Tracker-Anwendung gestartet und die Funktion „Bluetooth HCI Snoop Log“ aktiviert. Mit dieser Funktion konnten Sie den Datenverkehr abhören und den Speicherauszug auf der SD-Karte speichern. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe das Protokoll gefunden: </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">~ adb shell echo $ EXTERNAL_STORAGE </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
/ sdcard </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
~ adb pull /sdcard/btsnoop_hci.log</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
und habe es in WireShark geöffnet:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/249/211/2a8/2492112a8f554b0fa377477d68a86254.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es scheint, dass die Datenübertragung unter Verwendung des Bluetooth Low Energy-Protokolls oder genauer über das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GATT-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Protokoll durchgeführt wurde </font><font style="vertical-align: inherit;">. Dies ist eine bidirektionale Datenübertragung, bei der das Telefon als Server fungiert, "GATT-Server" und Peripheriegeräte "GATT-Eigenschaften" empfangen, die beliebige Binärdaten enthalten können. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe die erste UUID (00000208–37cb-11e3–8682–0002a5d5c51b) ausgewählt und bei Google gesucht. Ich hatte erwartet, den üblichen standardisierten GATT-Service zu finden, fand aber etwas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interessanteres</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich entschied, dass wir jemandes Git-Repository entdeckt haben, das von einer Person erstellt wurde, die das Protokoll rückentwickelt hat. Und dies stimmte teilweise: Das Projekt enthielt mehrere Arbeitsfunktionen, darunter Verbinden, Reagieren auf Handbewegungen, Lesen des Batteriestatus und Aktivieren der Verbindung. Aber die Implementierung des Beschleunigungsmessers war seltsam. Ich habe die Beschleunigungsmesserdaten zu </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MPAndroidChart</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hinzugefügt und </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Folgendes erhalten</font></a><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/b4f/fd0/f78/b4ffd0f78e643833a3288e83aefa159d.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obwohl die Informationen auf den Steigungen korrekt waren, wurden die Werte nicht angezeigt. Nach dem Studium des Funktionscodes stellte sich heraus, dass die 32-Bit-Zahl mit einfacher Genauigkeit drei 10-Bit-Werte enthielt. Dies ist sinnvoll, da die meisten Beschleunigungsmesser mit einer Genauigkeit von 10 Bit arbeiten (wie die meisten ADCs, Analog-Digital-Wandler). Hier sind die Quelldaten, achten Sie auf die ersten beiden Bits:</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acc Daten: 0b00101110 0b10110101 0b10111100 0b10111000 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
acc Daten: 0b00111010 0b11110001 0b00011101 0b11101011 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
acc Daten: 0b00111110 0b01110110 0b10100110 0b10011001 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
acc Daten: 0b00001011 0b11011101 0b10111101 0b00111001</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Aber Parsing - </font><font style="vertical-align: inherit;">Daten als die drei 10-Bit - </font><font style="vertical-align: inherit;">Werte ziemlich seltsam war, alle paar Grad Neigung verändert Wert 511 -512, und der Offset änderte sich nicht (außerdem gab es hier kein Problem mit ganzzahligen Überläufen). Deshalb habe ich beschlossen, dass SONY eine proprietäre binäre Verpackungsmethode verwendet oder dass das Unternehmen arithmetische Codierung und Komprimierung verwendet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe Protobuf, MsgPack, Thrift und mehrere Parser ausprobiert, aber nichts hat funktioniert. Ich hatte nur einen Tag Zeit, um mein Gerät mit dem WLAN der Drohne zu verbinden. Bereits verzweifelt versuchte ich die DEX-Dekompilierung der Unternehmensanwendung und nach einer halben Stunde stellte sich </font><i><font style="vertical-align: inherit;">
Folgendes</font></i><font style="vertical-align: inherit;"> heraus: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">// Ungefähr </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1: iconst_0 512 iconst_1 1023 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2: r1 xor iconst_0 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3: istore_0 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4: iload_0 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5: ifneq 8 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6: r1 xor iconst_1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7: istore_0 </font></font></i><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if ((data &amp; 0x200)! = 0) { </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 data = - ((data ^ 1023) + 1); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
} </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
return (((float) (-data)) * 15.625f) / GRAVITY_FACTOR;</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die erste Hälfte [0, 512] wurde invertiert, und daher trat die oben beschriebene Situation auf. </font><font style="vertical-align: inherit;">Ich habe es mit normalem XOR behoben und es hat geklappt. </font><font style="vertical-align: inherit;">Ich fügte den Schwerkraftfaktor hinzu, mit dem Ergebnis [-1,1] für ± 1 g, und alles, was als nächstes getan werden musste, war die Verwendung der Beschleunigungsmesserdaten zur Steuerung der Drohne.</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://www.youtube.com/embed/kYYg1lKzZnU%3Ffeature%3Doembed&amp;usg=ALkJrhi2pn4EyED59jOyYioqWQZHaDIlRQ" frameborder="0" allowfullscreen=""></iframe></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de394095/">https://habr.com/ru/post/de394095/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de394081/index.html">Hyperloop plant, heute die erste Site zu testen [UPD: Test war erfolgreich]</a></li>
<li><a href="../de394083/index.html">Arduino UNO Wärmebildkamera</a></li>
<li><a href="../de394087/index.html">Die essbare umweltfreundliche Beschichtung hält die Früchte länger als eine Woche ohne Kühlschrank frisch</a></li>
<li><a href="../de394089/index.html">Роскомнадзор героически предотвратил самоубийства школьников, которых зомбируют через группы «ВКонтакте»</a></li>
<li><a href="../de394093/index.html">DIY Laserschneider. Teilenummer Null. Macht</a></li>
<li><a href="../de394097/index.html">[HASS] Schmerz. Formatieren Sie RusMARC</a></li>
<li><a href="../de394101/index.html">Umfrage: Welche Sprache wird in Ihrem Betriebssystem verwendet?</a></li>
<li><a href="../de394103/index.html">Wind und Eis auf dem Mars</a></li>
<li><a href="../de394105/index.html">Der intelligente Bluetooth-Tupfer zeigt an, wann Änderungen erforderlich sind</a></li>
<li><a href="../de394107/index.html">Shadowplay LED Watch auf der Arduino Uno Plattform</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>