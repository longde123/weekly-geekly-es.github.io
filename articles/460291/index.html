<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚è±Ô∏è üëçüèæ üëµüèª Problemas de procesamiento por lotes de solicitudes y sus soluciones (parte 1) üßö üë©‚Äçüëß üö•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Casi todos los productos de software modernos consisten en varios servicios. A menudo, los largos tiempos de respuesta del canal entre servicios se co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Problemas de procesamiento por lotes de solicitudes y sus soluciones (parte 1)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/custis/blog/460291/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/sb/0r/ap/sb0raprlu2jwllu3gasyznuom40.jpeg"></div>  Casi todos los productos de software modernos consisten en varios servicios.  A menudo, los largos tiempos de respuesta del canal entre servicios se convierten en una fuente de problemas de rendimiento.  La soluci√≥n est√°ndar para este tipo de problema es empacar varias solicitudes interservicios en un solo paquete, que se llama procesamiento por lotes. <br><br>  Si utiliza el procesamiento por lotes, es posible que no est√© satisfecho con su resultado en t√©rminos de rendimiento o comprensi√≥n del c√≥digo.  Este m√©todo no es tan f√°cil para la persona que llama como podr√≠a pensar.  Para diferentes prop√≥sitos y en diferentes situaciones, las decisiones pueden variar mucho.  En ejemplos espec√≠ficos, mostrar√© los pros y los contras de varios enfoques. <br><a name="habracut"></a><br><h2>  Proyecto de demostraci√≥n </h2><br>  Para mayor claridad, considere un ejemplo de uno de los servicios en la aplicaci√≥n en la que estoy trabajando actualmente. <br><br><div class="spoiler">  <b class="spoiler_title">Una explicaci√≥n de la elecci√≥n de plataforma para ejemplos.</b> <div class="spoiler_text">  El problema del bajo rendimiento es bastante general y no se aplica a ning√∫n idioma y plataforma espec√≠ficos.  Este art√≠culo utilizar√° ejemplos de c√≥digo Spring + Kotlin para demostrar tareas y soluciones.  Kotlin es igualmente comprensible (o incomprensible) para los desarrolladores de Java y C #, adem√°s, el c√≥digo es m√°s compacto y comprensible que en Java.  Para facilitar la comprensi√≥n de los desarrolladores de Java puro, evitar√© la magia negra de Kotlin y usar√© solo el blanco (en el esp√≠ritu de Lombok).  Habr√° algunos m√©todos de extensi√≥n, pero en realidad son familiares para todos los programadores de Java como m√©todos est√°ticos, por lo que ser√° un poco de az√∫car que no estropear√° el sabor del plato. </div></div><br>  Hay un servicio de aprobaci√≥n de documentos.  Alguien crea un documento y lo env√≠a para su discusi√≥n, durante el cual se realizan ediciones y, en √∫ltima instancia, el documento es coherente.  El servicio de reconciliaci√≥n en s√≠ mismo no sabe nada sobre documentos: es solo un chat de coordinadores con peque√±as funciones adicionales, que no consideraremos aqu√≠. <br><br>  Por lo tanto, hay salas de chat (correspondientes a documentos) con un conjunto predefinido de participantes en cada uno de ellos.  Al igual que en los chats regulares, los mensajes contienen texto y archivos y pueden ser respuestas y reenv√≠os: <br><br> <code><font color="7f0055"><b>data class</b></font> <font color="3e7eff"><b>ChatMessage</b></font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="3f7f5f">// nullable      persist <br></font> <font color="3f7f5f">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">id</font> : <font color="3e7eff"><b>Long</b></font> ? <font color="333333">=</font> <font color="7f0055"><b>null</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**    */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">author</font> : <font color="3e7eff"><b>UserReference</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**  */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">message</font> : <font color="3e7eff"><b>String</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**    */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="3f7f5f">// -   JPA+    null,    <br></font> <font color="3f7f5f">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">files</font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>FileReference</b></font> <font color="333333">&gt;</font> ? <font color="333333">=</font> <font color="7f0055"><b>null</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**   ,     */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">replyTo</font> : <font color="3e7eff"><b>ChatMessage</b></font> ? <font color="333333">=</font> <font color="7f0055"><b>null</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**   ,     */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">forwardFrom</font> : <font color="3e7eff"><b>ChatMessage</b></font> ? <font color="333333">=</font> <font color="7f0055"><b>null <br></b></font> <font color="000066">)</font></code> <br> <br>  Los enlaces al archivo y al usuario son enlaces a otros dominios.  Vive con nosotros as√≠: <br><br> <code><font color="7f0055"><b>typealias</b></font> <font color="3e7eff"><b>FileReference</b></font> <font color="333333">=</font> <font color="3e7eff"><b>Long <br></b></font> <font color="7f0055"><b>typealias</b></font> <font color="3e7eff"><b>UserReference</b></font> <font color="333333">=</font> <font color="3e7eff"><b>Long <br></b></font></code> <br>  Los datos del usuario se almacenan en Keycloak y se recuperan a trav√©s de REST.  Lo mismo ocurre con los archivos: los archivos y la metainformaci√≥n sobre ellos viven en un servicio de almacenamiento de archivos separado. <br><br>  Todas las llamadas a estos servicios son <strong>solicitudes pesadas</strong> .  Esto significa que la sobrecarga para transportar estas solicitudes es mucho mayor que el tiempo que tardan en ser procesadas por un servicio de terceros.  En nuestros bancos de pruebas, el tiempo de llamada t√≠pico para dichos servicios es de 100 ms, por lo que en el futuro utilizaremos estos n√∫meros. <br><br>  Necesitamos hacer un controlador REST simple para recibir los √∫ltimos N mensajes con toda la informaci√≥n necesaria.  Es decir, creemos que en el frontend, el modelo de mensaje es casi el mismo y necesitamos enviar todos los datos.  La diferencia entre el modelo frontend es que el archivo y el usuario deben presentarse en una forma ligeramente descifrada para que sean enlaces: <br><br> <code><font color="395da1">/**          */ <br></font> <font color="7f0055"><b>data class</b></font> <font color="3e7eff"><b>ReferenceUI</b></font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="395da1">/**   url */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">ref</font> : <font color="3e7eff"><b>String</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**     */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">name</font> : <font color="3e7eff"><b>String <br></b></font> <font color="000066">) <br></font> <font color="7f0055"><b>data class</b></font> <font color="3e7eff"><b>ChatMessageUI</b></font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">id</font> : <font color="3e7eff"><b>Long</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**    */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">author</font> : <font color="3e7eff"><b>ReferenceUI</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**  */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">message</font> : <font color="3e7eff"><b>String</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**    */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">files</font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>ReferenceUI</b></font> <font color="333333">&gt;, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**   ,     */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">replyTo</font> : <font color="3e7eff"><b>ChatMessageUI</b></font> ? <font color="333333">=</font> <font color="7f0055"><b>null</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**   ,     */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">forwardFrom</font> : <font color="3e7eff"><b>ChatMessageUI</b></font> ? <font color="333333">=</font> <font color="7f0055"><b>null <br></b></font> <font color="000066">)</font></code> <br> <br>  Necesitamos implementar lo siguiente: <br><br> <code><font color="7f0055"><b>interface</b></font> <font color="3e7eff"><b>ChatRestApi</b></font> <font color="000066">{ <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getLast</b></font> <font color="000066">(</font> <font color="000066"><i>n</i></font> : <font color="3e7eff"><b>Int</b></font> <font color="000066">)</font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>ChatMessageUI</b></font> <font color="333333">&gt; <br></font> <font color="000066">}</font></code> <br> <br>  Postfix UI significa modelos DTO para la interfaz, es decir, lo que debemos dar a trav√©s de REST. <br><br>  Puede parecer sorprendente aqu√≠ que no pasemos ning√∫n identificador de chat e incluso en el modelo ChatMessage / ChatMessageUI no lo es.  Hice esto a prop√≥sito, para no saturar el c√≥digo de los ejemplos (los chats est√°n aislados, por lo que podemos suponer que tenemos uno). <br><br><div class="spoiler">  <b class="spoiler_title">Retiro filos√≥fico</b> <div class="spoiler_text">  Tanto la clase ChatMessageUI como el m√©todo ChatRestApi.getLast usan el tipo de datos Lista, mientras que en realidad es un Conjunto ordenado.  En el JDK, todo esto es malo, por lo que la declaraci√≥n del orden de los elementos en el nivel de la interfaz (mantener el orden al agregar y extraer) fallar√°.  Por lo tanto, es una pr√°ctica com√∫n usar List en los casos en que necesita un Set ordenado (todav√≠a hay un LinkedHashSet, pero esto no es una interfaz). </div></div><br>  <b>Una limitaci√≥n importante:</b> suponemos que no hay largas cadenas de respuestas o reenv√≠os.  Es decir, lo son, pero su longitud no supera los tres mensajes.  La cadena de mensajes front-end se debe transmitir en su totalidad. <br><br>  Para recibir datos de servicios externos, existen tales API: <br><br> <code><font color="7f0055"><b>interface</b></font> <font color="3e7eff"><b>ChatMessageRepository</b></font> <font color="000066">{ <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>findLast</b></font> <font color="000066">(</font> <font color="000066"><i>n</i></font> : <font color="3e7eff"><b>Int</b></font> <font color="000066">)</font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>ChatMessage</b></font> <font color="333333">&gt; <br></font> <font color="000066">} <br></font> <font color="7f0055"><b>data class</b></font> <font color="3e7eff"><b>FileHeadRemote</b></font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">id</font> : <font color="3e7eff"><b>FileReference</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">name</font> : <font color="3e7eff"><b>String <br></b></font> <font color="000066">) <br></font> <font color="7f0055"><b>interface</b></font> <font color="3e7eff"><b>FileRemoteApi</b></font> <font color="000066">{ <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getHeadById</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>FileReference</b></font> <font color="000066">)</font> : <font color="3e7eff"><b>FileHeadRemote <br></b></font> <font color="3e7eff"><b>&nbsp;&nbsp;</b></font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getHeadsByIds</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>Set</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>FileReference</b></font> <font color="333333">&gt;</font> <font color="000066">)</font> : <font color="3e7eff"><b>Set</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>FileHeadRemote</b></font> <font color="333333">&gt; <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getHeadsByIds</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>FileReference</b></font> <font color="333333">&gt;</font> <font color="000066">)</font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>FileHeadRemote</b></font> <font color="333333">&gt; <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getHeadsByChat</b></font> <font color="000066">()</font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>FileHeadRemote</b></font> <font color="333333">&gt; <br></font> <font color="000066">} <br></font> <font color="7f0055"><b>data class</b></font> <font color="3e7eff"><b>UserRemote</b></font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">id</font> : <font color="3e7eff"><b>UserReference</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">name</font> : <font color="3e7eff"><b>String <br></b></font> <font color="000066">) <br></font> <font color="7f0055"><b>interface</b></font> <font color="3e7eff"><b>UserRemoteApi</b></font> <font color="000066">{ <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getUserById</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>UserReference</b></font> <font color="000066">)</font> : <font color="3e7eff"><b>UserRemote <br></b></font> <font color="3e7eff"><b>&nbsp;&nbsp;</b></font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getUsersByIds</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>Set</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>UserReference</b></font> <font color="333333">&gt;</font> <font color="000066">)</font> : <font color="3e7eff"><b>Set</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>UserRemote</b></font> <font color="333333">&gt; <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getUsersByIds</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>UserReference</b></font> <font color="333333">&gt;</font> <font color="000066">)</font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>UserRemote</b></font> <font color="333333">&gt; <br></font> <font color="000066">}</font></code> <br> <br>  Se puede ver que el procesamiento por lotes se proporcion√≥ inicialmente en servicios externos, y en ambos casos: a trav√©s de Set (sin preservar el orden de los elementos, con claves √∫nicas) y a trav√©s de List (puede haber duplicados: el orden se conserva). <br><br><h2>  Implementaciones simples </h2><br><h4>  Implementaci√≥n ingenua </h4><br>  La primera implementaci√≥n ingenua de nuestro controlador REST se ver√° as√≠ en la mayor√≠a de los casos: <br><br> <code><font color="7f0055"><b>class</b></font> <font color="3e7eff"><b>ChatRestController</b></font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>private val</b></font> <font color="566874">messageRepository</font> : <font color="3e7eff"><b>ChatMessageRepository</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="7f0055"><b>private val</b></font> <font color="566874">userRepository</font> : <font color="3e7eff"><b>UserRemoteApi</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="7f0055"><b>private val</b></font> <font color="566874">fileRepository</font> : <font color="3e7eff"><b>FileRemoteApi <br></b></font> <font color="000066">)</font> : <font color="3e7eff"><b>ChatRestApi</b></font> <font color="000066">{ <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>override fun</b></font> <font color="170591"><b>getLast</b></font> <font color="000066">(</font> <font color="000066"><i>n</i></font> : <font color="3e7eff"><b>Int</b></font> <font color="000066">)</font> <font color="333333">= <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="566874">messageRepository</font> <font color="333333">.</font> <font color="170591">findLast</font> <font color="000066">(</font> <font color="000066"><i>n</i></font> <font color="000066">) <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="333333">.</font> <i><b>map</b></i> <font color="000066"><b>{</b></font> <font color="000066"><i>it</i></font> <font color="333333">.</font> <i><b>toFrontModel</b></i> <font color="000066">()</font> <font color="000066"><b>} <br></b></font> <font color="000066"><b><br></b></font> <font color="000066"><b>&nbsp;&nbsp;</b></font> <font color="7f0055"><b>private fun</b></font> <font color="3e7eff"><b>ChatMessage</b></font> <font color="333333">.</font> <font color="170591"><b>toFrontModel</b></font> <font color="000066">()</font> : <font color="3e7eff"><b>ChatMessageUI</b></font> <font color="333333">= <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="170591">ChatMessageUI</font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">id =</font> <font color="566874">id</font> ?: <font color="7f0055"><b>throw</b></font> <font color="170591">IllegalStateException</font> <font color="000066">(</font> <b>"</b> <font color="333333"><b>$</b></font> <font color="7f0055"><b>this</b></font> <b>must be persisted"</b> <font color="000066">)</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">author =</font> <font color="566874">userRepository</font> <font color="333333">.</font> <font color="170591">getUserById</font> <font color="000066">(</font> <font color="566874">author</font> <font color="000066">)</font> <font color="333333">.</font> <i><b>toFrontReference</b></i> <font color="000066">()</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">message =</font> <font color="566874">message</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">files =</font> <font color="566874">files</font> <font color="333333">?.</font> <i><b>let</b></i> <font color="000066"><b>{</b></font> <font color="000066"><i>files</i></font> <font color="000066"><b>-&gt; <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <font color="566874">fileRepository</font> <font color="333333">.</font> <font color="170591">getHeadsByIds</font> <font color="000066">(</font> <font color="000066"><i>files</i></font> <font color="000066">) <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="333333">.</font> <i><b>map</b></i> <font color="000066"><b>{</b></font> <b>it</b> <font color="333333">.</font> <i><b>toFrontReference</b></i> <font color="000066">()</font> <font color="000066"><b>} <br></b></font> <font color="000066"><b>}</b></font> ?: <i><b>listOf</b></i> <font color="000066">()</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">forwardFrom =</font> <font color="566874">forwardFrom</font> <font color="333333">?.</font> <i><b>toFrontModel</b></i> <font color="000066">()</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">replyTo =</font> <font color="566874">replyTo</font> <font color="333333">?.</font> <i><b>toFrontModel</b></i> <font color="000066">() <br></font> <font color="000066">) <br></font> <font color="000066">} <br></font></code> <br>  Todo est√° muy claro, y esta es una gran ventaja. <br><br>  Utilizamos el procesamiento por lotes y recibimos datos de un servicio externo en lotes.  Pero, ¬øqu√© est√° pasando con el rendimiento? <br><br>  Para cada mensaje, se realizar√° una llamada a UserRemoteApi para obtener datos en el campo de autor y una llamada a FileRemoteApi para recibir todos los archivos adjuntos.  Parece ser todo.  Suponga que los campos forwardFrom y replyTo para ChatMessage se obtienen para que esto no requiera llamadas adicionales.  Pero convertirlos en ChatMessageUI conducir√° a la recursividad, es decir, el rendimiento del recuento de llamadas puede aumentar considerablemente.  Como notamos anteriormente, digamos que no tenemos mucho anidamiento y la cadena est√° limitada a tres mensajes. <br><br>  Como resultado, recibimos de dos a seis llamadas a servicios externos por mensaje y una llamada JPA a todo el paquete de mensajes.  El n√∫mero total de llamadas variar√° de 2 * N + 1 a 6 * N + 1.  ¬øCu√°nto cuesta esto en unidades reales?  Suponga que necesita 20 publicaciones para representar una p√°gina.  Para obtenerlos, necesita de 4 sa 10 s.  Horrible  Me gustar√≠a conocer los 500 ms.  Y dado que el front-end so√±aba con hacer un desplazamiento continuo, los requisitos de rendimiento de este punto final pueden duplicarse. <br><br>  <b>Pros:</b> <br><br><ol><li>  El c√≥digo es conciso y autodocumentado (el sue√±o del soporte). </li><li>  El c√≥digo es simple, por lo que casi no hay oportunidades para disparar en la pierna. </li><li>  El procesamiento por lotes no parece extra√±o y se ajusta org√°nicamente a la l√≥gica. </li><li>  Los cambios l√≥gicos se realizar√°n f√°cilmente y ser√°n locales. </li></ol><br>  <b>Menos:</b> <br><br>  Terrible rendimiento debido al hecho de que los paquetes son muy peque√±os. <br><br>  Este enfoque a menudo se puede ver en servicios simples o en prototipos.  Si la velocidad de cambio es importante, apenas vale la pena complicar el sistema.  Al mismo tiempo, para nuestro servicio muy simple, el rendimiento es terrible, por lo que el alcance de la aplicabilidad de este enfoque es muy limitado. <br><br><h4>  Ingenuo procesamiento paralelo </h4><br>  Puede comenzar a procesar todos los mensajes en paralelo; esto eliminar√° un aumento lineal en el tiempo dependiendo de la cantidad de mensajes.  Esta no es una forma particularmente buena, ya que dar√° lugar a una gran carga m√°xima en el servicio externo. <br><br>  La implementaci√≥n del procesamiento paralelo es muy simple: <br><br> <code><font color="7f0055"><b>override fun</b></font> <font color="170591"><b>getLast</b></font> <font color="000066">(</font> <font color="000066"><i>n</i></font> : <font color="3e7eff"><b>Int</b></font> <font color="000066">)</font> <font color="333333">= <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="566874">messageRepository</font> <font color="333333">.</font> <font color="170591">findLast</font> <font color="000066">(</font> <font color="000066"><i>n</i></font> <font color="000066">)</font> <font color="333333">.</font> <font color="170591">parallelStream</font> <font color="000066">() <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="333333">.</font> <font color="170591">map</font> <font color="000066"><b>{</b></font> <b>it</b> <font color="333333">.</font> <i><b>toFrontModel</b></i> <font color="000066">()</font> <font color="000066"><b>} <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <font color="333333">.</font> <font color="170591">collect</font> <font color="000066">(</font> <font color="170591">toList</font> <font color="000066">())</font></code> <br> <br>  Al usar el procesamiento de mensajes paralelos, lo ideal es obtener 300‚Äì700 ms, lo cual es mucho mejor que con una implementaci√≥n ingenua, pero a√∫n no lo suficientemente r√°pido. <br><br>  Con este enfoque, las solicitudes a userRepository y fileRepository se ejecutar√°n sincr√≥nicamente, lo que no es muy eficiente.  Para solucionar esto, tendr√° que cambiar bastante la l√≥gica de las llamadas.  Por ejemplo, a trav√©s de CompletionStage (tambi√©n conocido como CompletableFuture): <br><br> <code><font color="7f0055"><b>private fun</b></font> <font color="3e7eff"><b>ChatMessage</b></font> <font color="333333">.</font> <font color="170591"><b>toFrontModel</b></font> <font color="000066">()</font> : <font color="3e7eff"><b>ChatMessageUI</b></font> <font color="333333">= <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="3e7eff"><b>CompletableFuture</b></font> <font color="333333">.</font> <font color="170591">supplyAsync</font> <font color="000066"><b>{ <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <font color="566874">userRepository</font> <font color="333333">.</font> <font color="170591">getUserById</font> <font color="000066">(</font> <font color="566874">author</font> <font color="000066">)</font> <font color="333333">.</font> <i><b>toFrontReference</b></i> <font color="000066">() <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="000066"><b>}</b></font> <font color="333333">.</font> <font color="170591">thenCombine</font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="566874">files</font> <font color="333333">?.</font> <i><b>let</b></i> <font color="000066"><b>{ <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <font color="3e7eff"><b>CompletableFuture</b></font> <font color="333333">.</font> <font color="170591">supplyAsync</font> <font color="000066"><b>{ <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <font color="566874">fileRepository</font> <font color="333333">.</font> <font color="170591">getHeadsByIds</font> <font color="000066">(</font> files <font color="000066">)</font> <font color="333333">.</font> <i><b>map</b></i> <font color="000066"><b>{</b></font> <b>it</b> <font color="333333">.</font> <i><b>toFrontReference</b></i> <font color="000066">()</font> <font color="000066"><b>} <br></b></font> <font color="000066"><b>} <br></b></font> <font color="000066"><b>}</b></font> ?: <font color="3e7eff"><b>CompletableFuture</b></font> <font color="333333">.</font> <font color="170591">completedFuture</font> <font color="000066">(</font> <i><b>listOf</b></i> <font color="000066">()) <br></font> <font color="000066">)</font> <font color="000066"><b>{</b></font> <font color="000066"><i>author</i></font> <font color="333333">,</font> <font color="000066"><i>files</i></font> <font color="000066"><b>-&gt; <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <font color="170591">ChatMessageUI</font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">id =</font> <font color="566874">id</font> ?: <font color="7f0055"><b>throw</b></font> <font color="170591">IllegalStateException</font> <font color="000066">(</font> <b>"</b> <font color="333333"><b>$</b></font> <font color="7f0055"><b>this</b></font> <b>must be persisted"</b> <font color="000066">)</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">author =</font> <font color="000066"><i>author</i></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">message =</font> <font color="566874">message</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">files =</font> <font color="000066"><i>files</i></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">forwardFrom =</font> <font color="566874">forwardFrom</font> <font color="333333">?.</font> <i><b>toFrontModel</b></i> <font color="000066">()</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">replyTo =</font> <font color="566874">replyTo</font> <font color="333333">?.</font> <i><b>toFrontModel</b></i> <font color="000066">() <br></font> <font color="000066">) <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="000066"><b>}</b></font> <font color="333333">.</font> <font color="170591">get</font> <font color="000066">()</font> <font color="333333">!!</font></code> <br> <br>  Se puede ver que el c√≥digo de mapeo inicialmente simple se ha vuelto menos claro.  Esto se debe a que tuvimos que separar las llamadas de servicio externas de donde se utilizaron los resultados.  Esto en s√≠ mismo no es malo.  Pero la combinaci√≥n de llamadas no se ve muy elegante y se asemeja a un t√≠pico "fideo" reactivo. <br><br>  Si usa corutinas, todo se ver√° m√°s decente: <br><br> <code><font color="7f0055"><b>private fun</b></font> <font color="3e7eff"><b>ChatMessage</b></font> <font color="333333">.</font> <font color="170591"><b>toFrontModel</b></font> <font color="000066">()</font> : <font color="3e7eff"><b>ChatMessageUI</b></font> <font color="333333">= <br></font> <font color="333333">&nbsp;&nbsp;</font> <i><b>join</b></i> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="000066"><b>{</b></font> <font color="566874">userRepository</font> <font color="333333">.</font> <font color="170591">getUserById</font> <font color="000066">(</font> <font color="566874">author</font> <font color="000066">)</font> <font color="333333">.</font> <i><b>toFrontReference</b></i> <font color="000066">()</font> <font color="000066"><b>}</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="000066"><b>{</b></font> <font color="566874">files</font> <font color="333333">?.</font> <i><b>let</b></i> <font color="000066"><b>{</b></font> <font color="566874">fileRepository</font> <font color="333333">.</font> <font color="170591">getHeadsByIds</font> <font color="000066">(</font> files <font color="000066">) <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="333333">.</font> <i><b>map</b></i> <font color="000066"><b>{</b></font> <b>it</b> <font color="333333">.</font> <i><b>toFrontReference</b></i> <font color="000066">()</font> <font color="000066"><b>} }</b></font> ?: <i><b>listOf</b></i> <font color="000066">()</font> <font color="000066"><b>} <br></b></font> <font color="000066"><b>&nbsp;&nbsp;</b></font> <font color="000066">)</font> <font color="333333">.</font> <i><b>let</b></i> <font color="000066"><b>{</b></font> <font color="000066">(</font> <font color="170591">author</font> <font color="333333">,</font> <font color="170591">files</font> <font color="000066">)</font> <font color="000066"><b>-&gt; <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <font color="170591">ChatMessageUI</font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">id =</font> <font color="566874">id</font> ?: <font color="7f0055"><b>throw</b></font> <font color="170591">IllegalStateException</font> <font color="000066">(</font> <b>"</b> <font color="333333"><b>$</b></font> <font color="7f0055"><b>this</b></font> <b>must be persisted"</b> <font color="000066">)</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">author =</font> <font color="170591">author</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">message =</font> <font color="566874">message</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">files =</font> <font color="170591">files</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">forwardFrom =</font> <font color="566874">forwardFrom</font> <font color="333333">?.</font> <i><b>toFrontModel</b></i> <font color="000066">()</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">replyTo =</font> <font color="566874">replyTo</font> <font color="333333">?.</font> <i><b>toFrontModel</b></i> <font color="000066">() <br></font> <font color="000066">) <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="000066"><b>}</b></font></code> <br> <br>  Donde: <br><br> <code><font color="7f0055"><b>fun</b></font> <font color="333333">&lt;</font> <font color="000066"><i>A</i></font> <font color="333333">,</font> <font color="000066"><i>B</i></font> <font color="333333">&gt;</font> <font color="170591"><b>join</b></font> <font color="000066">(</font> <font color="000066"><i>a</i></font> : <font color="000066">() -&gt;</font> <font color="000066"><i>A</i></font> <font color="333333">,</font> <font color="000066"><i>b</i></font> : <font color="000066">() -&gt;</font> <font color="000066"><i>B</i></font> <font color="000066">)</font> <font color="333333">= <br></font> <font color="333333">&nbsp;&nbsp;</font> <i><b>runBlocking</b></i> <font color="000066">(</font> <font color="05314d"><b>IO</b></font> <font color="000066">)</font> <font color="000066"><b>{ <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <i><b>awaitAll</b></i> <font color="000066">(</font> <i><b>async</b></i> <font color="000066"><b>{</b></font> <font color="3e7eff"><b>a</b></font> <font color="000066">()</font> <font color="000066"><b>}</b></font> <font color="333333">,</font> <i><b>async</b></i> <font color="000066"><b>{</b></font> <font color="3e7eff"><b>b</b></font> <font color="000066">()</font> <font color="000066"><b>}</b></font> <font color="000066">) <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="000066"><b>}</b></font> <font color="333333">.</font> <i><b>let</b></i> <font color="000066"><b>{ <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <font color="000066"><i>it</i></font> <font color="000066">[</font> <font color="333333"><b>0</b></font> <font color="000066">]</font> <font color="7f0055"><b>as</b></font> <font color="000066"><i>A</i></font> <i><b>to</b></i> <font color="000066"><i>it</i></font> <font color="000066">[</font> <font color="333333"><b>1</b></font> <font color="000066">]</font> <font color="7f0055"><b>as</b></font> <font color="000066"><i>B <br></i></font> <font color="000066"><i>&nbsp;&nbsp;</i></font> <font color="000066"><b>}</b></font></code> <br> <br>  Te√≥ricamente, utilizando dicho procesamiento paralelo, obtenemos 200‚Äì400 ms, que ya est√° cerca de nuestras expectativas. <br><br>  Desafortunadamente, no ocurre una paralelizaci√≥n tan buena, y la recuperaci√≥n es bastante cruel: con solo unos pocos usuarios trabajando al mismo tiempo, caer√° una gran cantidad de solicitudes en los servicios, que a√∫n no se procesar√°n en paralelo, por lo que volveremos a nuestros tristes 4 s. <br><br>  Mi resultado cuando uso dicho servicio es 1300-1700 ms para procesar 20 mensajes.  Esto es m√°s r√°pido que en la primera implementaci√≥n, pero a√∫n as√≠ no resuelve el problema. <br><br><div class="spoiler">  <b class="spoiler_title">Uso alternativo de consultas paralelas.</b> <div class="spoiler_text">  ¬øQu√© sucede si el procesamiento por lotes no se proporciona en servicios de terceros?  Por ejemplo, puede ocultar la falta de implementaci√≥n del procesamiento por lotes dentro de los m√©todos de interfaz: <br><br> <code><font color="7f0055"><b>interface</b></font> <font color="3e7eff"><b>UserRemoteApi</b></font> <font color="000066">{ <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getUserById</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>UserReference</b></font> <font color="000066">)</font> : <font color="3e7eff"><b>UserRemote <br></b></font> <font color="3e7eff"><b>&nbsp;&nbsp;</b></font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getUsersByIds</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>Set</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>UserReference</b></font> <font color="333333">&gt;</font> <font color="000066">)</font> : <font color="3e7eff"><b>Set</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>UserRemote</b></font> <font color="333333">&gt; = <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="000066"><i>id</i></font> <font color="333333">.</font> <font color="170591">parallelStream</font> <font color="000066">() <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="333333">.</font> <font color="170591">map</font> <font color="000066"><b>{</b></font> <font color="170591">getUserById</font> <font color="000066">(</font> <b>it</b> <font color="000066">)</font> <font color="000066"><b>}</b></font> <font color="333333">.</font> <font color="170591">collect</font> <font color="000066">(</font> <font color="170591">toSet</font> <font color="000066">()) <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getUsersByIds</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>UserReference</b></font> <font color="333333">&gt;</font> <font color="000066">)</font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>UserRemote</b></font> <font color="333333">&gt; = <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="000066"><i>id</i></font> <font color="333333">.</font> <font color="170591">parallelStream</font> <font color="000066">() <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="333333">.</font> <font color="170591">map</font> <font color="000066"><b>{</b></font> <font color="170591">getUserById</font> <font color="000066">(</font> <font color="000066"><i>it</i></font> <font color="000066">)</font> <font color="000066"><b>}</b></font> <font color="333333">.</font> <font color="170591">collect</font> <font color="000066">(</font> <font color="170591">toList</font> <font color="000066">()) <br></font> <font color="000066">}</font></code> <br> <br>  Esto tiene sentido si hay esperanza de que el procesamiento por lotes aparezca en futuras versiones. </div></div><br>  <b>Pros:</b> <br><br><ol><li>  F√°cil implementaci√≥n del procesamiento de mensajes concurrentes. </li><li>  Buena escalabilidad. </li></ol><br>  <b>Contras:</b> <br><br><ol><li>  La necesidad de separar la recepci√≥n de datos de su procesamiento en solicitudes de procesamiento en paralelo para diferentes servicios. </li><li>  Mayor carga en servicios de terceros. </li></ol><br>  Se puede ver que el alcance de la aplicabilidad es aproximadamente el mismo que el del enfoque ingenuo.  El uso del m√©todo de consulta paralela tiene sentido si desea aumentar el rendimiento de su servicio varias veces debido a la explotaci√≥n despiadada de los dem√°s.  En nuestro ejemplo, la productividad aument√≥ 2.5 veces, pero esto claramente no es suficiente. <br><br><h4>  Almacenamiento en cach√© </h4><br>  Puede realizar el almacenamiento en cach√© de estilo JPA para servicios externos, es decir, almacenar objetos recibidos dentro de la sesi√≥n para no recibirlos nuevamente (incluso durante el procesamiento por lotes).  Puede hacer estos cach√©s usted mismo, puede usar Spring con su @Cacheable, adem√°s de que siempre puede usar un cach√© listo como EhCache manualmente. <br><br>  El problema general estar√° relacionado con el hecho de que las memorias cach√© solo tienen sentido si hay visitas.  En nuestro caso, es muy probable que haya aciertos en el campo del autor (por ejemplo, 50%) y no habr√° aciertos en los archivos.  Este enfoque traer√° algunas mejoras, pero el rendimiento no cambiar√° radicalmente (y necesitamos un gran avance). <br><br>  Las memorias cach√© entre sesiones (largas) requieren una l√≥gica de invalidaci√≥n compleja.  En general, cuanto m√°s tarde llegue al punto de resolver problemas de rendimiento con cach√©s entre sesiones, mejor. <br><br>  <b>Pros:</b> <br><br><ol><li>  Implemente el almacenamiento en cach√© sin cambiar el c√≥digo. </li><li>  El rendimiento aumenta varias veces (en algunos casos). </li></ol><br>  <b>Contras:</b> <br><br><ol><li>  Posibilidad de degradaci√≥n del rendimiento si se usa incorrectamente. </li><li>  Gran sobrecarga de memoria, especialmente con cach√©s largos. </li><li>  Invalidaci√≥n compleja, errores en los que dar√° lugar a problemas dif√≠ciles en tiempo de ejecuci√≥n. </li></ol><br>  Muy a menudo, los cach√©s solo se usan para reparar r√°pidamente problemas de dise√±o.  Esto no significa que no necesitan ser utilizados.  Sin embargo, siempre vale la pena tratarlos con precauci√≥n y primero evaluar la ganancia de rendimiento resultante, y solo luego tomar una decisi√≥n. <br><br>  En nuestro ejemplo, los cach√©s tendr√°n un aumento de rendimiento de alrededor del 25%.  Al mismo tiempo, los cach√©s tienen muchas desventajas, por lo que no los usar√≠a aqu√≠. <br><br><h4>  Resumen </h4><br>  Por lo tanto, analizamos la implementaci√≥n ingenua de un servicio que utiliza el procesamiento por lotes y algunas formas simples de acelerarlo. <br><br>  La principal ventaja de todos estos m√©todos es la simplicidad, de la que hay muchas consecuencias agradables. <br><br>  Un problema com√∫n con estos m√©todos es el bajo rendimiento, principalmente debido al tama√±o del paquete.  Por lo tanto, si estas soluciones no le convienen, entonces vale la pena considerar m√©todos m√°s radicales. <br><br>  Hay dos √°reas principales en las que puede buscar soluciones: <br><br><ul><li>  Trabajo asincr√≥nico con datos (requiere un cambio de paradigma, por lo tanto, este art√≠culo no se considera) </li><li>  ampliaci√≥n de paquetes mientras se mantiene el procesamiento sincr√≥nico. </li></ul><br>  La ampliaci√≥n de los paquetes reducir√° en gran medida el n√∫mero de llamadas externas y al mismo tiempo mantendr√° el c√≥digo sincr√≥nico.  La siguiente parte del art√≠culo estar√° dedicada a este tema. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/460291/">https://habr.com/ru/post/460291/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../460279/index.html">Contrato de 10 mil millones: ¬øqui√©n se ocupar√° de la nube para el Pent√°gono?</a></li>
<li><a href="../460281/index.html">C√≥mo UX Writer ayuda a mejorar el producto</a></li>
<li><a href="../460283/index.html">Nuevo lenguaje de programaci√≥n h√°galo usted mismo</a></li>
<li><a href="../460285/index.html">Estamos preparando PHP. ¬øC√≥mo son while, foreach, array_walk y algunas otras palabras de miedo</a></li>
<li><a href="../460287/index.html">Visualizaci√≥n de noticias runet</a></li>
<li><a href="../460295/index.html">¬øQu√© significa inseguro en Rust?</a></li>
<li><a href="../460297/index.html">WeakRef - propuesta para agregar al est√°ndar ECMAScript</a></li>
<li><a href="../460301/index.html">L√°mparas LED de alta potencia de nueva generaci√≥n.</a></li>
<li><a href="../460305/index.html">AERODISCO Motor: catastr√≥fico. Parte 2. Metrocluster</a></li>
<li><a href="../460307/index.html">Experiencia de modelado del equipo de Computer Vision Mail.ru</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>