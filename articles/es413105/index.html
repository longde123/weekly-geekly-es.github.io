<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüíº ü§™ üî¶ Notas del proveedor de IoT. Activaci√≥n y seguridad en LoraWAN üö≠ üí¥ üêï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola queridos amantes de Internet de las cosas. Continuaci√≥n de notas del proveedor de IoT. 
 La primera parte > || > Segunda parte > || > Tercera par...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Notas del proveedor de IoT. Activaci√≥n y seguridad en LoraWAN</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413105/"><p>  Hola queridos amantes de Internet de las cosas.  Continuaci√≥n de notas del proveedor de IoT. </p><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">La primera parte</a> &gt; ||  &gt; <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Segunda parte</a> &gt; ||  &gt; <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tercera parte</a> &gt; ||  &gt; <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">La cuarta parte</a> <br><br><p>  Hoy es hora de hablar sobre seguridad en LoRaWAN.  Hay muchos rumores y leyendas.  Intentaremos averiguar c√≥mo funciona y cu√°les son los riesgos. <br><br>  Para continuar con el tema de la seguridad, tendr√° que hacer una peque√±a introducci√≥n y hablar sobre la inicializaci√≥n inicial del m√≥dulo de radio en la red.  Este proceso en LoRaWAN se llama activaci√≥n. </p><br><p>  Por brevedad, enumerar√© a continuaci√≥n los t√©rminos que necesitamos.  Si te confundes un poco, puedes volver aqu√≠ y comprobar.  Probablemente tengas que volver, porque  Las abreviaturas de muchos t√©rminos son muy similares.  Adem√°s, en esta descripci√≥n le dar√© analog√≠as para que comprenda aproximadamente con qu√© se puede comparar este o aquel t√©rmino.  No siempre es posible seleccionar analog√≠as exactas, por lo tanto, no juzgue esta columna demasiado estrictamente. </p><br><img src="https://habrastorage.org/webt/z4/v-/68/z4v-68a8ov1o-2rz2chxuprmpto.png"><br><a name="habracut"></a><p>  Por lo tanto, la activaci√≥n en LoRaWAN se puede hacer por aire (OTAA) o por preajuste (ABP). </p><br><h2>  OTAA (Activaci√≥n por aire) </h2><br><p>  En el caso de activaci√≥n por aire, se deben establecer tres par√°metros en nuestro m√≥dulo de radio.  Su identificador √∫nico (DevEUI), el identificador del servidor (AppEUI) y la clave del servidor (AppKey). </p><br><p>  En el lado del servidor, el identificador del m√≥dulo de radio, el identificador del servidor y la clave tambi√©n deben estar registrados.  Es decir  el servidor debe conocer inicialmente el dispositivo que intentar√° unirse a √©l.  Si conocemos los identificadores y las claves del servidor, pero nuestro DevEUI no est√° registrado en su base de datos, la conexi√≥n fallar√°. </p><br><p>  Tras el encendido inicial, la radio env√≠a el paquete join_request al aire en una de las tres frecuencias de uni√≥n predefinidas.  Con este paquete, pregunta si hay una red cercana que lo "reconozca".  La siguiente es la composici√≥n del paquete join_request.  Como puede ver, contiene DevEUI y AppEUI, as√≠ como DevNonce. </p><br><img src="https://habrastorage.org/webt/6p/gh/kd/6pghkd5kbylskdzbcasmwylqdnq.png"><br><p>  DevNonce es una variable aleatoria.  El servidor lo almacena en la memoria durante alg√∫n tiempo y si join_request llega con el mismo DevNonce que uno de los anteriores, el servidor ignorar√° esta solicitud.  Esto es para protegerse contra un ataque repetido cuando un atacante puede escribir una solicitud de activaci√≥n y luego repetirla desde su dispositivo.  Por cierto, no todos los est√°ndares de IoT pueden presumir de protecci√≥n contra este ataque. </p><br><p>  AppKey no se usa directamente en este mensaje, pero a trav√©s de √©l se considera la suma de verificaci√≥n MIC al final del marco. <br>  Necesitaremos esta clave un poco m√°s, en el mensaje de respuesta del servidor join_accept. </p><br><p>  Join_request se transmite sin cifrar. </p><br><p>  Join_accept se recibir√° si el servidor conoce AppEUI y DevEUI, as√≠ como si no hay coincidencia en el campo DevNonce y no hay problemas con el MIC.  De lo contrario, no habr√° respuesta. Si se pasan todas las comprobaciones, el servidor genera un mensaje de respuesta join_accept.  Su composici√≥n se muestra en la imagen a continuaci√≥n. </p><br><img src="https://habrastorage.org/webt/w7/tv/j7/w7tvj7iwfjeynonywqmtqlrwmac.png"><br><p>  De hecho, se generan dos claves de sesi√≥n: el servidor de red (NwkSKey) y el servidor de aplicaciones (AppSKey).  Estas claves junto con otra informaci√≥n son encriptadas por AppKey y enviadas al m√≥dulo de radio.  Adem√°s, todos los mensajes se producen con doble cifrado con claves de sesi√≥n (con la excepci√≥n de los paquetes con comandos MAC, no se cifran con la clave del servidor de la aplicaci√≥n).  NwkSKey no participa en el cifrado de paquetes solo con datos (sin comandos), sino que se considera una suma de verificaci√≥n a trav√©s de √©l. <br>  NwkSkey y AppSKey son exclusivos de cada m√≥dulo de radio individual. </p><br><p>  Se utilizan dos claves para la protecci√≥n de informaci√≥n adicional.  Cada vez que llega un paquete del m√≥dulo de radio a nuestro sistema, se encriptar√° parcialmente para el servidor de red y parcialmente para el servidor de aplicaciones.  Es decir  el servidor de red solo podr√° descifrar los mensajes que se dirigen a √©l (varios mensajes de servicio).  El servidor de aplicaciones solo ver√° el componente √∫til de los paquetes (en realidad, los datos que se reenv√≠an).  Esto es necesario porque el servidor de red con una probabilidad del 99 por ciento estar√° en el proveedor.  Pero el servidor de aplicaciones bien puede ser alojado por el cliente.  El doble cifrado dificulta que el proveedor descubra el contenido del paquete. </p><br><p>  Adem√°s de las dos claves, hay otra cosa importante para unir_aceptar en OTAA: la lista de frecuencias extendida (CFList).  Perm√≠tame recordarle que inicialmente un m√≥dulo de radio solo conoce tres frecuencias en las que puede operar.  Despu√©s de la activaci√≥n, se registran frecuencias adicionales para que se comunique. <br><br>  Esto es muy conveniente si no se sabe exactamente en qu√© red funcionar√° el dispositivo.  Podemos acordar que en todas las redes 3 frecuencias (+ RX2) siempre coincidir√°n, y las cinco restantes quedan a criterio del proveedor. <br><br>  Adem√°s, para el futuro, para trabajar con una gran cantidad de dispositivos, CFList se puede utilizar para la agrupaci√≥n <br><br>  Esto es cuando divide la red en grupos y dentro de los grupos hay una planificaci√≥n de frecuencia.  Digamos que nuestro m√≥dulo de radio conoce las tres frecuencias F1, F2 y F3.  Se activa en una de las frecuencias y, si est√° en el cl√∫ster1, recibe una tabla de frecuencias adicional en forma de F4-1, F5-1 y F6-1.  Para el grupo 2, obtendr√° completamente diferente F4-2, F5-2, F6-2.  Al mismo tiempo, podemos configurar todos los m√≥dulos de radio de la misma manera y realmente no pensamos cu√°l caer√° en qu√© cl√∫ster.  Y en los grupos vecinos, la probabilidad de colisiones disminuir√° considerablemente. </p><br><h2>  ABP (activaci√≥n por personalizaci√≥n) </h2><br><p>  Un procedimiento simplificado cuando las claves de sesi√≥n se conectan inmediatamente al m√≥dulo de radio y se registran inicialmente en el lado del servidor.  Conveniente porque no necesita activar, el m√≥dulo de radio est√° listo para usar de inmediato.  Nada m√°s conveniente, porque  La seguridad en este caso es regular.  Adem√°s, no puede extraer frecuencias del servidor.  Nunca he visto ning√∫n caso de uso real.  No lo consideraremos, y todo lo siguiente es sobre OTAA. </p><br><h2>  ¬øY qu√© hay de la seguridad? </h2><br><p>  Entonces, en esencia, tenemos la carga principal de cifrado en las claves de sesi√≥n del servidor de red y el servidor de aplicaciones. <br><br>  Consid√©relos un poco m√°s cuidadosamente. </p><br><p>  La principal queja de los cr√≠ticos del est√°ndar LoRaWAN es que cuando el dispositivo se activa en la red, tenemos dos claves, que luego pueden permanecer sin cambios durante meses.  M√°s precisamente, no pueden cambiar durante a√±os hasta que el dispositivo se vuelva a activar.  En condiciones normales, activamos y olvidamos el m√≥dulo de radio, por lo que una vida clave de tres a cuatro a√±os es una perspectiva muy realista.  En realidad, desde la instalaci√≥n hasta dejar la bater√≠a en cero. <br>  ¬øQu√© tan confiables son nuestras llaves? </p><br><p>  La especificaci√≥n dice que cumplen con el misterioso RFC4493. <br>  Que es esto  Este es un algoritmo de cifrado, mejor conocido como AES-CMAC. <br><br>  No nos metamos en la naturaleza de la criptograf√≠a y limitemos a una comprensi√≥n com√∫n de la imagen.  Se presenta en la figura a continuaci√≥n. </p><br><img src="https://habrastorage.org/webt/kv/zs/7k/kvzs7k4joixbwltc1wkfxkpmotw.png"><br><p>  El principio de AES-CMAC es aproximadamente el siguiente: el mensaje cifrado se divide en bloques de 128 bits.  Cada bloque se cifra por separado con una clave AES.  Adem√°s, cuando se cifra el segundo bloque, adem√°s de la clave, se utiliza el resultado de cifrado del primero.  Y al cifrar el tercero, el resultado del segundo y (indirectamente) el primero.  Tal cadena de complicaciones. </p><br><p>  ¬øQu√© tan confiable es este principio? </p><br><p>  Muy confiable  El algoritmo sali√≥ hace m√°s de diez a√±os.  Desde entonces, ha sido atacado por muchos ataques diferentes y finalmente, en teor√≠a, demostraron que puede ser pirateado. El problema es que se necesitar√° una gran muestra de paquetes, varios miles, para romperlo.  Entonces existe la posibilidad de comprender qu√© hay dentro de los bloques cifrados. </p><br><p>  ¬øPuede un atacante con el conocimiento necesario obtener esta muestra si estamos hablando de interceptar paquetes LoRaWAN?  Vamos a estimar  Deje ir los paquetes una vez por hora.  En un mes, se enviar√°n 720 paquetes desde el m√≥dulo de radio.  No es suficiente <br><br>  Para una amenaza real, necesitamos un paciente muy paciente que estar√° escribiendo paquetes durante meses.  Y no es un hecho que todav√≠a pueda descifrar el algoritmo y obtener las claves atesoradas.  No olvide que ser√° necesario mostrar tanta paciencia con respecto a cada m√≥dulo de radio por separado.  Y recuerde que enviar paquetes una vez por hora es MUY frecuente.  En la pr√°ctica, los intervalos son mucho m√°s largos: seis horas o incluso un d√≠a. </p><br><p>  Pero incluso esta oportunidad fantasmal ahora se cierra despu√©s del lanzamiento de la especificaci√≥n 1.1, donde se implementan los comandos de reactivaci√≥n y uni√≥n al servidor.  Hablemos de esta especificaci√≥n de alguna manera.  Por ahora, recuerdo mi pensamiento del art√≠culo anterior: cuando el est√°ndar est√° abierto y tiene una comunidad, todos sus agujeros son visibles.  Durante la actualizaci√≥n, los desarrolladores saben exactamente qu√© mirar primero. </p><br><p>  Como resultado, entendemos que la amenaza de seguridad es bastante ilusoria.  En alg√∫n lugar de la teor√≠a profunda, el pirateo se puede hacer, pero en la pr√°ctica pr√°cticamente no es realista.  Ahora multiplique por el valor de la informaci√≥n recibida.  ¬øComenzar√° nuestro atacante a escribir paquetes durante meses para descubrir el contador?  Poco probable <br><br>  LoRaWAN cumple con esa razonable relaci√≥n precio-rendimiento.  Entendemos que la protecci√≥n se puede mejorar.  Pero esta es la potencia inform√°tica del final, esta es una carga adicional en la bater√≠a, es posible aumentar el tama√±o de los paquetes o reducir la carga √∫til. <br><br>  Para m√≠, es m√°s que una tarea de telemetr√≠a. </p><br><p>  En los comentarios, me alegrar√° escuchar tanto a mis oponentes como a mis seguidores.  Recuerde que el tema de la seguridad siempre requiere discusi√≥n y nunca debe descansar en la opini√≥n de una persona. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es413105/">https://habr.com/ru/post/es413105/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es413095/index.html">Aplicaci√≥n de tecnolog√≠as de redes neuronales: desarrollo de software</a></li>
<li><a href="../es413097/index.html">Basado en software de nivel empresarial, probado millones de veces: se lanz√≥ openSUSE Leap 15</a></li>
<li><a href="../es413099/index.html">Descarga de ram en macbook</a></li>
<li><a href="../es413101/index.html">Placa de depuraci√≥n STM32F4 en factor de forma Raspberry Pi</a></li>
<li><a href="../es413103/index.html">3CX v15.5 Actualizaci√≥n 5 Beta e integraci√≥n REST con AmoCRM lanzado</a></li>
<li><a href="../es413107/index.html">Traducci√≥n del wiki del proyecto Svelto.ECS. Marco ECS para Unity3D</a></li>
<li><a href="../es413109/index.html">C√≥mo construir una plataforma de integraci√≥n de productos SaaS: experiencia de pago de Cloud Poster</a></li>
<li><a href="../es413111/index.html">STM32 + NetBeans =?</a></li>
<li><a href="../es413113/index.html">Soporte de serializaci√≥n JavaScript JavaScript de clase</a></li>
<li><a href="../es413117/index.html">C√≥mo programar de forma segura en bash</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>