<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚞 🦉 🧒🏻 Laurent模块和智能家居（第1部分）。管家 🕝 🎤 🚶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="我想提醒您注意有关KernelChip的 Laurent控制模块的系列文章。在本系列中，我将向您介绍如何将这些模块集成到智能家居中，如何从流行的MajorDoMo家庭自动化系统，Arduino草图，Arduino Mega Server系统中学习如何管理这些模块，以及如何将这些模块用于完全出乎意料的...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Laurent模块和智能家居（第1部分）。管家</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/384485/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我想提醒您注意有关</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KernelChip的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Laurent控制模块的系列文章</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在本系列中，我将向您介绍如何将这些模块集成到智能家居中，如何从流行的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MajorDoMo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">家庭自动化</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">系统</font></a><font style="vertical-align: inherit;">，Arduino草图，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arduino Mega Server系统中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">学习如何管理</font><font style="vertical-align: inherit;">这些模块，以及如何将这些模块用于完全出乎意料的目的-教您的孩子进行处理编程。</font></font><br>
<br>
<img src="https://habrastorage.org/files/915/0cb/0cb/9150cb0cbde940e588d1badce05af5bb.jpg" alt="图片"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常，如果您具有一定的想象力和创造力，那么对家庭本身非常有趣的模块可能会意外地在家庭中非常有用。</font></font><br>
<a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为什么选择洛朗？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因为这些模块已经在我的智能家居系统中成功运行了很长时间（超过三年），并且我在使用它们方面积累了一些经验，所以我有一些要讲述的地方。</font><font style="vertical-align: inherit;">我也有一些经验和现成的，经过测试的代码可以管理这些模块，我想与您分享。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您将能够基于此代码开发软件解决方案，这将非常简单，因为我已经完成了大部分工作。</font><font style="vertical-align: inherit;">此外，还将对代码进行详细说明，这无疑有助于您理解其工作原理，学习编程并构建智能家居系统。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块本身</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当我为自己选择一些现成的解决方案来管理通过网络的电力负荷时，Laurent凭借解决方案的完整性和简便性向我行贿。为了开始控制设备的开和关以及照明的网络，几乎不需要什么。不必学习编程语言，也不需要焊接任何东西，将模块连接到本地网络，将负载连接到中继端子就足够了（而且不要忘记给模块本身加电），仅此而已。之后，可以直接从计算机（从终端程序）发送命令。模块立即开始按照我的命令乖乖地打开和关闭灯。当时，我不需要更多。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我可以说说模块本身，在整个操作过程中，没有崩溃和死机，一切都像时钟一样工作和工作，实际上，这是这些模块正常工作所必需的。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设计和建造质量</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仅查看模块就足以表明它是出于“仅”的原因而开发的，但试图做一件真正有价值的事情就足够了。</font><font style="vertical-align: inherit;">我也没有抱怨建造质量，一切都做得井井有条，应该做到：没有弯曲的零件，焊锡之类的东西或类似的东西，一切都干净整洁。</font><font style="vertical-align: inherit;">总的来说，构建质量与“品牌”计算机组件和“工厂” Arduino没有区别。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果我自己发布这些模块，我唯一要做的就是安装多色端子而不是单色端子来连接电线，至少要突出显示电源连接端子，但这是小巧的选择（当然，所有东西都经过整齐地签名）。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该系列的第一篇文章是关于什么的？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
所有信息均分为三篇逻辑上已完成的文章。第一篇文章将重点介绍将Laurent模块与MajorDoMo（流行的开源家庭自动化平台）集成。将给出具体示例和PHP代码。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
第二篇文章是关于与Arduino生态系统的集成。您可以根据程序从各个草图管理模块，或将Laurent与</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arduino Mega Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（也基于Arduino代码）</font><font style="vertical-align: inherit;">集成，</font><font style="vertical-align: inherit;">并通过方便的界面或自动管理Laurents。还将提供现成的解决方案和经过测试的代码。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
第三点-关于通过Processing上的草图管理Laurent模块。也就是说，直接从家用计算机的桌面即可。同一篇文章将描述如何提高儿童对学习编程的兴趣，以及这些模块在此过程中可以发挥什么作用。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该系列致力于将Laurent模块与家庭自动化系统集成，并且不考虑模块本身的体系结构和操作。这在使用它可以阅读其他文章中描述</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，将在后面讨论。在这里，我们仅关注集成。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在撰写本文的过程中，使用了带有La01固件和LW1.0 Web界面版本的Laurent模块，即，已经使用了三年的“战斗”模块。</font><font style="vertical-align: inherit;">在新版本的模块中，实现细节可能略有不同，但是保留了与控制团队的兼容性，因此此处所说的内容也适用于较新的修改。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块管理的工作方式</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
与模块的所有信息交换都是通过网络进行的，要开始使用它们，您需要在端口2424上建立TCP / IP连接。</font><font style="vertical-align: inherit;">建立连接后，您可以发送控制模块的文本命令（所谓的KE命令）。</font><font style="vertical-align: inherit;">该</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KernelChip网站</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有详细的文档，包括KE命令的访问描述。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
KernelChip照顾用户，并为其模块提供了方便的Web界面，但这是“手动控制”，如果我们从智能家居中学习如何管理模块，该解决方案的便利性，价值和实用性将得到提高。</font></font><br>
<br>
<img src="https://habrastorage.org/files/0ad/e7b/6e3/0ade7b6e3ff2446e969b922121a3c87d.jpg" alt="图片"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Web界面默认受密码保护，要查看网页内容，您需要输入用户名“ admin”和密码“ Laurent”。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管家</font></font></h2><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MajorDoMo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
系统</font><font style="vertical-align: inherit;">非常受欢迎，在这里我将不对其进行详细介绍。</font><font style="vertical-align: inherit;">假定您已经安装了该系统并使用了一段时间。</font><font style="vertical-align: inherit;">对于那些根本不了解最新信息的人，我将解释说这是一个开放的家庭自动化平台，该平台可在Windows和Linux上运行，并基于Web服务器，是一种功能广泛的专业CMS（内容管理系统），对于家庭自动化。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MajorDoMo的可能性确实是无止境的，管理Laurent模块只是该系统的才能之一。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">技术细节</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MajorDoMo包含laurent.class.php文件，该文件位于目录中</font></font><br>
<br>
<pre><code class="dos hljs">\htdocs\lib\<font></font>
<font></font>
</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完整代码laurent.class.php</font></font></b><div class="spoiler_text">&lt;?<br>
<br>
function laurent_command($host, $command, $password='Laurent') {<br>
<br>
$socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);<br>
 if ($socket === false) {<br>
 echo «socket_create() failed: reason: ». socket_strerror(socket_last_error()). "\n";<br>
 return 0;<br>
 }<br>
<br>
$result = socket_connect($socket, $host, 2424);<br>
 if ($result === false) {<br>
 echo «socket_connect( $socket, $host, 2424) failed.\nReason: ($result) ». socket_strerror(socket_last_error($socket)). "\n";<br>
 return 0;<br>
 }<br>
<br>
$in='$KE'."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
$in='$KE,PSW,SET,'.$password."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
$in=$command."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
socket_close($socket);<br>
 return trim($res);<br>
 <br>
 }<br>
<br>
function laurent_getStat($host, $password='Laurent') {<br>
<br>
$socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);<br>
 if ($socket === false) {<br>
 echo «socket_create() failed: reason: ». socket_strerror(socket_last_error()). "\n";<br>
 return 0;<br>
 }<br>
<br>
$result = socket_connect($socket, $host, 2424);<br>
 if ($result === false) {<br>
 echo «socket_connect( $socket, $host, 2424) failed.\nReason: ($result) ». socket_strerror(socket_last_error($socket)). "\n";<br>
 return 0;<br>
 }<br>
<br>
$in='$KE'."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
$in='$KE,PSW,SET,'.$password."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
$command='$KE,DAT,ON';<br>
 $in=$command."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 $started=0;<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "#TIME,"))) {<br>
 if (!$started) {<br>
 $started=1;<br>
 } else {<br>
 break;<br>
 }<br>
 }<br>
 }<br>
<br>
$command='$KE,DAT,OFF';<br>
 $in=$command."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
 sleep(1);<br>
 socket_write($socket, $in, strlen($in));<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
socket_close($socket);<br>
 return trim($res);<br>
 <br>
 }<br>
<br>
?&gt;<br>
<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
并包含使用Laurent模块所需的一切。</font><font style="vertical-align: inherit;">该文件包含PHP编程语言中的函数，并且可能以最终形式或进行了最小的修改后可以使用该编程语言传输到任何系统。</font><font style="vertical-align: inherit;">因此，如果您在其他平台上有一个Smart Home项目，则可以尝试使用此文件将Laurent与您的系统集成。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
用于控制模块的主要功能是</font></font><br>
<br>
<pre><code class="php hljs">laurent_command(<span class="hljs-string">'&lt; &gt;'</span>, <span class="hljs-string">'&lt;&gt;'</span>, <span class="hljs-string">'&lt;  &gt;'</span>);<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例如，</font></font><br>
<br>
<pre><code class="php hljs">$result = laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,INF'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
，其中“ 192.168.2.19”是模块的IP地址，“ $ KE，INF”是命令本身，“ Laurent”是密码（默认值）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
函数的工作结果将进入变量$ result，即模块的响应，您可以使用标准PHP语言工具来分析和解释该结果。默认指定密码。如果您更改了用于访问模块的密码，则需要在功能调用中将其替换为新密码。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
团队应该清楚一切，您可以从目录中获取任何命令并根据需要管理模块。 IP地址也不应该引起任何问题。只需指定Laurent模块真正具有的IP地址即可。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以以此结束理论，现在我将通过一个实际示例向您展示如何直接从MajorDoMo菜单进行灯光（或设备）控制。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实际例子</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作为一个实际示例，让我们看一下MajorDoMo系统主菜单中两个按钮“打开”和“关闭”的创建。使用这些按钮，您可以打开或关闭灯或任何电器（在这里，您只需要记住安装在模块上的继电器就不能直接控制电炉或热水器等强大的负载）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我们创建了“启用”按钮，为此，我们转到MajorDoMo管理面板，输入用户名和密码（默认情况下为admin / admin），然后单击“对象/控制菜单”，然后单击绿色大按钮“添加新部分”。</font></font><br>
<br>
<img src="https://habrastorage.org/files/fb3/4af/d8b/fb34afd8babe4df5a78392f9b6025857.png" alt="图片"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，我们找到“类型”下拉列表，然后从显示的所有类型中选择“按钮”，然后单击“保存”。</font></font><br>
<br>
<img src="https://habrastorage.org/files/2de/95f/137/2de95f13747c4887b12cc1a6b51315ae.png" alt="图片"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，选择“父菜单项”是我们的按钮“钩”的地方。</font><font style="vertical-align: inherit;">我有Laurent，您可以有任何方便的菜单项。</font><font style="vertical-align: inherit;">默认情况下，存在“ ROOT”（根），这意味着该按钮将立即可见，而无需单击任何菜单项。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在输入字段“标题”中，将要写入的内容写在按钮上。</font><font style="vertical-align: inherit;">最后，在“代码”字段中，编写我们已经熟悉的laurent_command函数代码：</font></font><br>
<br>
<pre><code class="php hljs">laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,REL,2,1'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此处与理论示例相同，只是缺少$结果变量（我们不需要），并且该命令由'$ KE，REL，2,1'代替，这意味着启用2号继电器。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们对“关闭”按钮执行相同的操作，只是不要忘记更改按钮的名称，而不是“ $ KE，REL，2.1”而不是“ $ KE，REL，2.0”，这意味着要关闭继电器2：</font></font><br>
<br>
<pre><code class="php hljs">laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,REL,2,0'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
就这样。</font><font style="vertical-align: inherit;">我们使用MajorDoMo界面重新加载页面，出现了两个新按钮，可以直接从MajorDoMo界面精美地打开和关闭灯（或设备），几乎没有延迟。</font><font style="vertical-align: inherit;">我们想要实现的目标。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动控制</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，让我们尝试自动控制模块，而无需人工干预。</font><font style="vertical-align: inherit;">现在您将看到，比使用按钮来控制模块还要容易。</font></font><br>
<br>
<img src="https://habrastorage.org/files/13a/34b/f74/13a34bf74e8943b5a0613e972ef09b85.png" alt="图片"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们在MajorDoMo管理面板的主菜单中找到“对象”项，单击它，然后找到对象“ ClockChime”及其方法“ onNewMinute”。</font><font style="vertical-align: inherit;">我们需要他。</font><font style="vertical-align: inherit;">对于那些不知道的人，这是MajorDoMo的“中央”方法，每分钟都会调用一次，非常流行。</font><font style="vertical-align: inherit;">通过这种方法，有许多功能和脚本调用可提供系统的用户功能。</font></font><br>
<br>
<img src="https://habrastorage.org/files/1c6/88b/2ea/1c688b2ead4642b4934a67a00b19d9d2.png" alt="图片"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们要做的就是将代码添加到该方法中。</font><font style="vertical-align: inherit;">例如对于考虑这种情况。</font><font style="vertical-align: inherit;">您的Laurent模块可控制家庭庭院中的夜间照明。</font><font style="vertical-align: inherit;">例如，您希望灯光在21.00点打开，并在早上7.30点关闭。</font><font style="vertical-align: inherit;">没有什么比这更简单了，这是您应该添加到onNewMinute方法中的代码：</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">if</span> (timeIs(<span class="hljs-string">'21:00'</span>)) {<font></font>
  laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,REL,2,1'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">if</span> (timeIs(<span class="hljs-string">'7:30'</span>)) {<font></font>
  laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,REL,2,0'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
}<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
就是这样！</font><font style="vertical-align: inherit;">您必须承认这一点都不困难。</font><font style="vertical-align: inherit;">这只是一个例子，工作的逻辑可以是任何逻辑，而且非常复杂。</font><font style="vertical-align: inherit;">Laurent模块的才华并没有随着负载的打开和关闭而结束，它们的功能更加广泛，但这不是本文的主题，这里我们仅通过简单的示例来考虑集成问题。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接收和输出模块数据</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最后一个示例将是如何在MajorDoMo网页上获取和显示从Laurent模块接收的信息。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MajorDoMo是一个面向对象的系统，其所有工作都通过创建对象以及使用其数据（变量）和方法（程序代码）来进行。有点困难？其实没关系，现在您会自己看到。</font></font><br>
<br>
<img src="https://habrastorage.org/files/adc/f9a/1c0/adcf9a1c0940400798e8392da8690c52.png" alt="图片"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，作为示例，我们将使用现有对象“ ThisComputer”，并将新属性“ test”添加到该对象中。为此，请在MajorDoMo管理区域中单击我们已经熟悉的“对象”菜单项，找到“ ThisComputer”对象，然后单击“属性”项，滚动到底部并找到“添加新属性”输入字段，输入“测试”并单击“刷新”（将值保留为空）。</font></font><br>
<br>
<img src="https://habrastorage.org/files/81a/bd8/8f8/81abd88f8596487ca7415eb6526d6d40.png" alt="图片"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在此基础上，准备操作可以视为已完成，我们在对象“ ThisComputer”中添加了一个新属性“ test”，我们将在实验中使用该属性。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，我们的任务是从Laurent模块请求必要的信息，并将其放入对象“ ThisComputer”的“ test”的属性（变量）中。</font><font style="vertical-align: inherit;">这个怎么做？</font><font style="vertical-align: inherit;">很简单。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将此代码添加到我们已经知道的onNewMinute方法中：</font></font><br>
<br>
<pre><code class="php hljs">$result = laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,INF'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
setGlobal(<span class="hljs-string">'ThisComputer.test'</span>, $result); <font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MajorDoMo每分钟都会向模块询问必要的信息，并更新“ test”变量，我们可以根据需要使用该变量。</font><font style="vertical-align: inherit;">例如，显示在网页上。</font><font style="vertical-align: inherit;">为此，我们将以下代码放置在所需页面上的任何位置：</font></font><br>
<br>
<pre><code class="php hljs">%ThisComputer.test%<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这就是所谓的。</font><font style="vertical-align: inherit;">一个宏，在加载页面时，该宏将替代变量值而不是变量本身，该宏存储在“ ThisComputer”对象的“ test”属性中。</font><font style="vertical-align: inherit;">结果，您会在网页上看到Laurent模块发送的信息，以响应您的请求。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如何在页面上添加宏？</font><font style="vertical-align: inherit;">我们进入管理菜单，选择“主页”项，然后选择所需的任何页面，或使用绿色的大按钮“新建页面”创建一个新页面。</font><font style="vertical-align: inherit;">并将宏添加到页面上任何所需的位置。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小计</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这就是全部。</font><font style="vertical-align: inherit;">有了本文中的信息，您就可以真正理解Laurents，并将这些模块集成到Smart Home系统中。</font><font style="vertical-align: inherit;">在本系列的下一篇文章中，您将学习如何在Arduino和</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arduino Mega Server系统</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上通过草图管理模块</font><font style="vertical-align: inherit;">。</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN384485/">https://habr.com/ru/post/zh-CN384485/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN384475/index.html">该评论不是一个小工具。为智能手机选择最佳的训练盒和其他配件：阿迪达斯敷料，袋子和硅胶袋</a></li>
<li><a href="../zh-CN384477/index.html">美国宇航局将测试利用太阳光发展小行星的技术</a></li>
<li><a href="../zh-CN384479/index.html">通过Arduino Uno开发板进行带控制的游戏开发</a></li>
<li><a href="../zh-CN384481/index.html">战争迫使叙利亚科学家从“世界末日避难所”补充种子库存。</a></li>
<li><a href="../zh-CN384483/index.html">由太阳能电池板供电的实验电话。RC 1.0</a></li>
<li><a href="../zh-CN384487/index.html">法院命令公开演唱《祝你生日快乐》</a></li>
<li><a href="../zh-CN384489/index.html">韩国制造商推出的新型最快固态硬盘-三星950 Pro</a></li>
<li><a href="../zh-CN384491/index.html">机器人比人类更好地停车</a></li>
<li><a href="../zh-CN384493/index.html">Qlocktwo型电子手表</a></li>
<li><a href="../zh-CN384499/index.html">Acer Revo One：具有多种功能的微型计算机</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>