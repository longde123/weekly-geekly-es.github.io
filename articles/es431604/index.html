<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äçüé® ü¶É üëêüèº Localizaci√≥n en Go con paquetes b√°sicos üïô ü§™ üí®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Crear una buena aplicaci√≥n no es f√°cil. Cualquier aplicaci√≥n √∫nica y √∫til que escriba, si al usuario no le gusta, entonces, como dicen, tiene un gran ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Localizaci√≥n en Go con paquetes b√°sicos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431604/"><p>  Crear una buena aplicaci√≥n no es f√°cil.  Cualquier aplicaci√≥n √∫nica y √∫til que escriba, si al usuario no le gusta, entonces, como dicen, tiene un gran problema.  A la mayor√≠a de las personas no les gusta y ahuyentan todo lo que no entienden.  A menudo, la interfaz de usuario y las letras son la punta visible del iceberg de su aplicaci√≥n, seg√∫n la cual el usuario la eval√∫a.  Por lo tanto, la localizaci√≥n de todo lo que ve el usuario es extremadamente importante. </p><br><p>  Recuerde que hace diez a√±os, cuando Internet apenas comenzaba a entrar en la vida de las masas, y muchos de los gigantes de TI de la actualidad se encontraban en la etapa de inicio de enanos con un par de docenas de empleados, estaba en el orden de las cosas enviarle una carta al usuario en ingl√©s.  Y los usuarios simpatizaban con esto.  Hoy, cuando todo est√° presente en Internet y no necesita tener siete tramos en la frente, tener una educaci√≥n superior o saber ingl√©s para usarlo, se considera una mala forma no admitir la localizaci√≥n en su aplicaci√≥n.  Por cierto, en nuestra empresa, la localizaci√≥n de todos los textos de IU ya se lleva a cabo en 20 idiomas y la lista de idiomas admitidos est√° en constante crecimiento. </p><br><p> En Go, como en un lenguaje bastante joven, todas las tendencias modernas de desarrollo web se implementan a nivel de paquetes b√°sicos y no requieren "bailar con una pandereta" adicional.  (Comenc√© a aprender Go hace unos a√±os, pero a√∫n recuerdo la sensaci√≥n de "superpoderes descubiertos" que experiment√© los primeros d√≠as despu√©s de aprender este idioma. Parec√≠a que ahora puedo realizar cualquier tarea escribiendo solo un par de l√≠neas). </p><br><p>  Por supuesto, la localizaci√≥n tampoco se salv√≥ en Go.  La localizaci√≥n en √©l est√° disponible pr√°cticamente "fuera de la caja" usando los paquetes b√°sicos: <b>golang.org/x/text/language</b> , <b>golang.org/x/text/message</b> y <b>golang.org/x/text/feature/plural</b> .  Veamos lo f√°cil que es en Go en solo media hora, con estos paquetes, puede implementar una tarea no trivial como la localizaci√≥n de mensajes. </p><a name="habracut"></a><br><p>  Mirando hacia el futuro, dir√© que el prop√≥sito de este art√≠culo es principalmente mostrar el poder y la belleza de Go y resaltar las caracter√≠sticas b√°sicas de los paquetes de mensajes para trabajar con localizaciones.  Si est√° buscando una soluci√≥n para una aplicaci√≥n de producci√≥n, es posible que desee una mejor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">biblioteca est√°ndar</a> .  Las ventajas de <i>go-i18n</i> son muchas estrellas en github (entre ellas est√° la m√≠a) y una gran flexibilidad.  Sin embargo, existen argumentos en contra de su uso: es posible que no necesite toda esa flexibilidad y funcionalidad;  por qu√© usar una biblioteca externa cuando todo ya est√° implementado en el lenguaje mismo;  si ya tiene su propio sistema de traducci√≥n con sus propios formatos, esta biblioteca "tal cual" probablemente no funcionar√° y tendr√° que modificarla de todos modos;  y, al final, usar una biblioteca de terceros no es tan interesante e informativo como hacer algo usted mismo. </p><br><p>  Formulamos los requisitos b√°sicos para la tarea que se implementa.  Hay: a) etiquetas en formato yaml: <i>"nombre_etiqueta: texto de traducci√≥n"</i> ;  el idioma de traducci√≥n se especifica en el nombre del archivo, por ejemplo ru.yml;  b) plantillas de correo electr√≥nico en html.  Es necesario, en funci√≥n de los par√°metros de entrada: configuraci√≥n regional y matriz de datos, generar texto localizado del mensaje. </p><br><p>  Y empecemos ... Pero primero, algunas palabras m√°s sobre el paquete de mensajes (golang.org/x/text/message).  Est√° dise√±ado para formatear la salida de cadenas localizadas.  Message implementa la interfaz del paquete fmt est√°ndar y puede reemplazarlo.  Ejemplo de uso: <br><br></p><pre><code class="go hljs">message.SetString(language.Russian, <span class="hljs-string"><span class="hljs-string">"toxic"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) message.SetString(language.Japanese, <span class="hljs-string"><span class="hljs-string">"toxic"</span></span>, <span class="hljs-string"><span class="hljs-string">"ÊØíÊÄß"</span></span>) message.NewPrinter(language.Russian).Println(‚Äútoxic‚Äù) message.NewPrinter(language.Japanese).Println(‚Äútoxic‚Äù) <span class="hljs-comment"><span class="hljs-comment">//: // //ÊØíÊÄß</span></span></code> </pre> <br>  Para que el paquete "vea" la etiqueta, primero debe declararse.  En el ejemplo, la funci√≥n SetString se usa para esto.  A continuaci√≥n, se crea una impresora para el idioma seleccionado y se muestra directamente una cadena localizada. <br><p>  Para resolver nuestro problema, podr√≠amos generar un archivo go con todas las etiquetas, pero esto no es muy conveniente, ya que cuando agregue nuevas etiquetas, tendr√° que volver a generar este archivo cada vez y volver a compilar la aplicaci√≥n.  Otra forma de comunicar mensajes sobre nuestras etiquetas es usar diccionarios.  Un diccionario es una estructura que implementa la b√∫squeda de interfaz de b√∫squeda de etiquetas <i>(cadena de clave) (cadena de datos, ok bool)</i> . <br><br>  La opci√≥n de diccionarios nos conviene.  Primero, definimos la estructura del diccionario e implementamos la interfaz de b√∫squeda: <br><br></p><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> dictionary <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Data <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d *dictionary)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Lookup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, ok </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> value, ok := d.Data[key]; ok { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"\x02"</span></span> + value, <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre><br><p>  Esparza todas las etiquetas de los archivos yaml en una colecci√≥n de diccionarios, que es un <i>mapa de</i> formato de <i>diccionario [lang] *</i> , donde <i>lang</i> es una etiqueta de idioma en formato <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">BCP47</a> . <br><br></p><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseYAMLDict</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">map</span></span></span></span><span class="hljs-function"><span class="hljs-params">[</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">]catalog.Dictionary, error)</span></span></span></span> { dir := <span class="hljs-string"><span class="hljs-string">"./translations"</span></span> files, err := ioutil.ReadDir(dir) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, err } translations := <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]catalog.Dictionary{} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, f := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> files { yamlFile, err := ioutil.ReadFile(dir + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + f.Name()) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, err } data := <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>{} err = yaml.Unmarshal(yamlFile, &amp;data) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, err } lang := strings.Split(f.Name(), <span class="hljs-string"><span class="hljs-string">"."</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>] translations[lang] = &amp;dictionary{Data: data} } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> translations, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> }</code> </pre><br>  Instalamos la colecci√≥n de diccionarios en la funci√≥n init para que el paquete de mensajes pueda usar los diccionarios cuando se inicie la aplicaci√≥n. <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { dict, err := parseYAMLDict() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">panic</span></span>(err) } cat, err := catalog.NewFromMap(dict) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">panic</span></span>(err) } message.DefaultCatalog = cat }</code> </pre><br><p>  Entonces, en este momento, hemos logrado la disponibilidad de localizaci√≥n de etiquetas de nuestros archivos en cualquier parte del programa: <br><br></p><pre> <code class="go hljs">message.NewPrinter(language.Russian).Println(‚Äúlabel_name‚Äù)</code> </pre> <br><p>  Es hora de pasar a la segunda parte de la tarea y sustituir nuestras etiquetas localizadas en las plantillas de correo electr√≥nico.  Por ejemplo, considere un mensaje simple: una carta de bienvenida al registrar un usuario: <br>  <i>Hola Bill Smith!</i> </p><br><p>  Para el an√°lisis, utilizamos otro paquete est√°ndar: <b>html / template</b> .  Al analizar plantillas en plantilla, puede configurar sus funciones a trav√©s de <i>.Funcs ()</i> : <br></p><pre> <code class="go hljs">template.New(tplName).Funcs(fmap).ParseFiles(tplName)</code> </pre> <br><p>  Agregue una funci√≥n a la plantilla que traducir√° etiquetas y sustituir√° variables en ellas, y ll√°mela <i>traducir</i> .  C√≥digo de an√°lisis de plantilla: <br><br></p><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">//  lang:=language.Russian //  tplName:=‚Äù./templates/hello.html‚Äù //   data := &amp;struct { Name string LastName string }{Name: "Bill", LastName: "Smith"} fmap := template.FuncMap{ //   "translate": message.NewPrinter(lang).Sprintf, } t, err := template.New(tplName).Funcs(fmap).ParseFiles(tplName) if err != nil { panic(err) } buf := bytes.NewBuffer([]byte{}) if err := t.Execute(buf, data); err != nil { panic(err) } fmt.Println(buf.String())</span></span></code> </pre><br>  La plantilla de carta resultante ./templates/hello.html: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>{{translate "hello_subject"}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> {{translate "hello_msg" .Name .LastName}} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Dado que en la <i>traducci√≥n</i> usamos la funci√≥n <i>Sprintf</i> para la localizaci√≥n, las variables en el texto de la etiqueta se coser√°n usando la sintaxis de esta funci√≥n.  Por ejemplo, <i>% s</i> es una cadena, <i>% d</i> es un n√∫mero entero. <br>  Archivos etiquetados <br>  en.yml <br><br><pre> <code class="plaintext hljs">hello_subject: Greeting mail hello_msg: Hello, %s %s!</code> </pre><br>  ru.yml <br><br><pre> <code class="plaintext hljs">hello_subject:   hello_msg: , %s %s!</code> </pre><br><p>  Sobre esto, en principio, eso es todo, ¬°la localizaci√≥n de las letras est√° lista!  Habiendo escrito solo unas pocas docenas de l√≠neas de c√≥digo, obtuvimos una funcionalidad poderosa que hace posible localizar letras de cualquier complejidad en docenas de idiomas. </p><br><p>  Si le gust√≥ este ejemplo, puede ir m√°s all√° e implementar independientemente la pluralizaci√≥n, utilizando nombres de variables para las variables en las etiquetas en lugar de <i>% sy</i> utilizando funciones en las etiquetas.  Deliberadamente, no hice esto para dejar espacio a tu imaginaci√≥n. </p><br><p>  El c√≥digo en los ejemplos est√° escrito espec√≠ficamente para demostrar las capacidades del paquete de mensajes y no pretende ser ideal; una lista completa del c√≥digo est√° disponible en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es431604/">https://habr.com/ru/post/es431604/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es431590/index.html">La modernizaci√≥n de los parques e√≥licos obsoletos del Reino Unido aumentar√° la generaci√≥n de energ√≠a en un 171%</a></li>
<li><a href="../es431596/index.html">Veeam Backup y prueba de carga de replicaci√≥n</a></li>
<li><a href="../es431598/index.html">Traemos a Internet una m√°quina virtual QEMU p√∫blica sin una tarjeta de red e intentamos extraer</a></li>
<li><a href="../es431600/index.html">Elevar IDS / NMS: Mikrotik y Suricata con una interfaz web</a></li>
<li><a href="../es431602/index.html">Desarrolladores rusos presentaron en Londres un sistema de rehabilitaci√≥n virtual</a></li>
<li><a href="../es431608/index.html">La empresa estadounidense DriveSavers es la primera en el mundo en lanzar el servicio de pirateo de iPhone para particulares</a></li>
<li><a href="../es431610/index.html">Project Manager Lifehacks</a></li>
<li><a href="../es431612/index.html">Caja musical y codificador giratorio en placa FPGA</a></li>
<li><a href="../es431614/index.html">Creando arte usando DCGAN en Keras</a></li>
<li><a href="../es431616/index.html">Introducci√≥n a las propiedades CSS personalizadas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>