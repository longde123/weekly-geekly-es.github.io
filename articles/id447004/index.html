<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⛑️ 👩🏽‍🎤 🕴🏾 Universal Watchdog di ATtiny13 🧛🏿 👩🏽‍🔬 👩‍🎨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pengawas waktu eksternal adalah penopang bagi pengembang miskin yang tidak dapat mengembangkan program yang berfungsi dengan baik untuk mikrokontroler...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Universal Watchdog di ATtiny13</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447004/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/w_/9m/qn/w_9mqnozp0ioc7v4qkraqqocl1u.gif"></div><br>  Pengawas waktu eksternal adalah penopang bagi pengembang miskin yang tidak dapat mengembangkan program yang berfungsi dengan baik untuk mikrokontroler atau sirkuit yang bekerja dengan stabil. <br><br>  Selain itu, WDT bawaan tersedia di sebagian besar mikrokontroler modern. <br><br>  Tetapi ada kalanya Anda harus berurusan dengan papan atau modul jadi dengan masalah tertentu.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Saya membuat WDT pertama saya</a> untuk menangani gantungan ESP8266 yang langka, tetapi masih terkadang terjadi.  Selain itu, soft reset tidak disimpan dan ESP-cabinet tidak ingin terhubung kembali ke WiFi.  Mendistorsi daya dengan WDT eksternal menyelesaikan masalah. <br><br>  Masalah kedua muncul dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kontroler GSM Elecrow ATMEGA 32u4 A9G</a> .  Di sini, sangat jarang terjadi pembekuan kartu SIM.  (Omong-omong, masalah yang sama terjadi dengan modem USB 3G dan 4G).  Untuk mengatasi pembekuan ini, Anda perlu mengubah daya pada SIM-ke.  Dan tampaknya bahkan modem GSM memiliki kesimpulan untuk ini, tetapi fitur ini tidak termasuk dalam rangkaian perangkat.  Dan untuk mencapai keandalan maksimum, saya sekali lagi harus beralih ke anjing penjaga eksternal. <br><a name="habracut"></a><br>  Saya tidak mengulangi sirkuit pada timer 555.  Terlalu banyak kekurangan yang dia ungkapkan: <br><br><ul><li>  Dimensi besar dan cukup tegap </li><li>  Pengaturan ketidaknyamanan waktu respons dengan resistor tuning </li><li>  Waktu reset yang cukup lama (pelepasan kapasitor diperlukan) </li><li>  Nah, potensi hang dari MK dengan level rendah pada output dari timer, ketika timer hanya berhenti bekerja. </li><li>  Dan saya tidak menemukan proyek OpenSource di Internet yang sepenuhnya memenuhi persyaratan saya. </li></ul><br><h3>  Persyaratan untuk WDT Baru </h3><br><ul><li>  Biaya perangkat yang rendah, kemudahan pembuatan dan dimensi kecil </li><li>  Kontrol perubahan level logika berkala 0/1 pada input </li><li>  Penyesuaian sederhana dari waktu respons (sebagai opsi, pilihan interval yang telah ditentukan) </li></ul><br><h3>  Pengembangan besi </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mikrokontroler ATtiny13</a> dipilih sebagai sirkuit mikro utama.  Kemampuannya lebih dari cukup untuk tugas saya.  Dan harganya, dengan mempertimbangkan pengurangan elemen pengikat, hampir sama dengan 555 mikrosirkuit. <br><br><img src="https://habrastorage.org/webt/6b/dz/ey/6bdzeyh1bowur2gidmkemmap2lc.jpeg"><br><br>  Lima kesimpulan MK (RESET memutuskan untuk tidak menyentuh) didistribusikan sebagai berikut: <br><br><ol><li>  Output pengatur waktu </li><li>  Setel ulang input </li><li>  Tiga kesimpulan yang tersisa adalah waktu respons. </li></ol><br>  Untuk mengalihkan daya, MOSFET saluran-P digunakan.  Kasing apa pun yang cocok cocok, tetapi disarankan untuk membawanya dengan apa yang disebut "level kontrol logis" - artinya, sepenuhnya terbuka dari tegangan rendah 3-5V: IRLML2502, AO3415, dll.  Meskipun ukurannya kecil, transistor ini mampu mengendalikan beban 4A.  Jika Anda perlu beralih sesuatu yang lain, Anda dapat langsung menghubungkan relay 5V ke output ini. <br><br>  LED menyala ketika timer diaktifkan dan unit utama dimatikan. <br><br>  Konektor utama untuk menghubungkan ke papan mikrokontroler memiliki empat output <br><br><ol><li>  Bis umum </li><li>  Input - reset timer </li><li>  + 5V output (dikontrol oleh timer) </li><li>  Input + 5V </li></ol><br>  Dua konektor - programmer ICSP dan power jumper tidak dapat dipasang di papan.  Flash mikrokontroler di programmer terlebih dahulu, dan atur waktu respons dengan jumper konstan. <br><br><h3>  Daftar Bagian </h3><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">MK Attiny13-SSU ~ $ 0,3 (dengan pembelian 10 pcs)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">MOSFET P-channel IRLML5203 - $ 0,09 (urutan 50)</a> atau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">MOSFET AO3415 - $ 0,05</a> </li><li>  1K SMD1206 Resistor </li><li>  Resistor 470 SMD1206 </li><li>  1206 LED warna apa pun </li><li>  Konektor PLS-6, PLS-3 dan PLS-4R (PLD-3 dan PLS-4R) - biasanya terputus dari sisir panjang </li></ul><br><h3>  Pembuatan </h3><br>  Papan ternyata berukuran kecil - 18 × 22 mm.  Saya menyebarkan dua opsi: <br><br>  Untuk pembuatan satu sisi oleh LUT: <br><br><img src="https://habrastorage.org/webt/kh/yp/26/khyp26ytvqxcj437volrrhkfcuw.jpeg"><br><br><img src="https://habrastorage.org/webt/8d/yl/ef/8dylefeebfvbkrpf2iaqymdhvh4.jpeg"><br><br>  Dan untuk pemesanan di pabrik dengan desain dan transisi yang ditingkatkan antara para pihak.  (Saya akan memesan dari Cina, kadang-kadang) <br><br><img src="https://habrastorage.org/webt/5h/s4/ey/5hs4eynikwmqazhhyix7oljkb2a.jpeg"><br><br><img src="https://habrastorage.org/webt/fd/ff/gu/fdffgubsoonrbwva_lc_noy7mao.jpeg"><br><br>  Teknologi rumah memberikan prototipe seperti ini. <br><br><img src="https://habrastorage.org/webt/ax/cd/ir/axcdirbr10irmp46awb4gnlrytg.jpeg"><br><br><img src="https://habrastorage.org/webt/84/fz/is/84fzissob7kg5rq24f7qhwe-az4.jpeg"><br><br><img src="https://habrastorage.org/webt/_d/zp/yz/_dzpyzgeqzjau8szktiqfcwqplc.jpeg"><br><br><h3>  Firmware </h3><br>  Untuk firmware saya menggunakan pemrogram buatan sendiri berdasarkan Arduino Nano <br><br><img src="https://habrastorage.org/webt/us/ls/fx/uslsfxv9iq2s3ex0vgflqyedsbs.jpeg"><br><br>  Saya diprogram dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">IDE Arduino</a> dengan dukungan yang diinstal untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Attiny13 - MicroCore</a> .  Versi terbaru dari IDE memiliki masalah dengan programmer ArduinoISP, tetapi bekerja dengan baik di versi Arduino IDE 1.6.13.  Tim ramah arduino.cc tidak memiliki keinginan untuk <s>mencari</s> tahu apa yang <s>kacau di</s> sana)))) <br><br><img src="https://habrastorage.org/webt/gh/ci/pv/ghcipvlpi0kom2xxlrrlwjqqbic.jpeg"><br><br>  Tinku disetel untuk bekerja dari resonator internal dengan frekuensi 1,2 MHz.  Program ini sederhana - kami mengkonfigurasi input / output, membaca PB2 -PB4 dan menentukan waktu respons, mengatur timer dan beralih ke mode IDLE.  Menurut penghentian waktu, kami menentukan status input kontrol.  Jika keadaan telah berubah ke yang sebaliknya, reset penghitung.  Jika penghitung membaca melebihi waktu respons yang ditetapkan, kami mendistorsi daya output. <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> F_CPU 1200000UL #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;avr/io.h&gt; #include &lt;util/delay.h&gt; #include &lt;avr/interrupt.h&gt; boolean pb1_state; volatile uint16_t pb1_count; //     TIMER0 ISR(TIM0_OVF_vect){ pb1_count++; } int main(){ //   PB0 DDRB |= (1 &lt;&lt; PB0); // pinMode(PB0, OUTPUT); PORTB &amp;= ~(1 &lt;&lt; PB0); // digitalWrite(PB0, LOW);} //   PB1   DDRB &amp;= ~(1 &lt;&lt; PB1); // pinMode(PB1, INPUT_PULLUP); PORTB |= (1 &lt;&lt; PB1); //   PB2   DDRB &amp;= ~(1 &lt;&lt; PB2); // pinMode(PB2, INPUT_PULLUP); PORTB |= (1 &lt;&lt; PB2); //   PB3   DDRB &amp;= ~(1 &lt;&lt; PB3); // pinMode(PB3, INPUT_PULLUP); PORTB |= (1 &lt;&lt; PB3); //   PB4   DDRB &amp;= ~(1 &lt;&lt; PB4); // pinMode(PB4, INPUT_PULLUP); PORTB |= (1 &lt;&lt; PB4); //       PB2,PB3,PB4 (   ) (,  = TM/4 ) uint16_t TM = 0; bool pb2 = false; bool pb3 = false; bool pb4 = false; if( PINB &amp; (1 &lt;&lt; PINB2) )pb2 = true; if( PINB &amp; (1 &lt;&lt; PINB3) )pb3 = true; if( PINB &amp; (1 &lt;&lt; PINB4) )pb4 = true; if( pb2 == true &amp;&amp; pb3 == true &amp;&amp; pb4 == true )TM = 4; // 1  else if( pb2 == false &amp;&amp; pb3 == true &amp;&amp; pb4 == true )TM = 8; // 2  else if( pb2 == true &amp;&amp; pb3 == false &amp;&amp; pb4 == true )TM = 20; // 5  else if( pb2 == false &amp;&amp; pb3 == false &amp;&amp; pb4 == true )TM = 40; // 10  else if( pb2 == true &amp;&amp; pb3 == true &amp;&amp; pb4 == false )TM = 80; // 20  else if( pb2 == false &amp;&amp; pb3 == true &amp;&amp; pb4 == false )TM = 120; // 30  else if( pb2 == true &amp;&amp; pb3 == false &amp;&amp; pb4 == false )TM = 240; // 60  else if( pb2 == false &amp;&amp; pb3 == false &amp;&amp; pb4 == false )TM = 480; // 120  pb1_count = 0; pb1_state = false; //  ADC PRR = (1&lt;&lt;PRADC); // shut down ADC //   TIMSK0 = (1&lt;&lt;TOIE0); //   TIMER0 TCCR0B = (1&lt;&lt;CS02) | (1&lt;&lt;CS00); //    1/1024 //    MCUCR &amp;= ~(1&lt;&lt;SM1); // idle mode MCUCR &amp;= ~(1&lt;&lt;SM0); // idle mode MCUCR |= (1&lt;&lt;SE); sei(); while(1) { //      asm("sleep"); //   TIMSK0 &amp;= ~ (1&lt;&lt;TOIE0); //  TIMER0 //   PB1 bool pb1 = false; if( PINB &amp; (1 &lt;&lt; PINB1) )pb1 = true; //    ,   if( pb1 != pb1_state )pb1_count = 0; pb1_state = pb1; //      if( pb1_count &gt;= TM ){ PORTB |= (1 &lt;&lt; PB0); // digitalWrite(PB0, HIGH);} _delay_ms(1000); //   PORTB &amp;= ~(1 &lt;&lt; PB0); // digitalWrite(PB0, LOW);} pb1_count = 0; //   } TIMSK0 = (1&lt;&lt;TOIE0); //   TIMER0 sei(); } return 0; }</span></span></span></span></code> </pre> <br>  Semua kode cocok dalam 340 byte - tepat sepertiga dari satu kilobyte memori tinky.  Pengoperasian timer diperiksa hanya - tergantung pada waktu pemasangan - LED menyala secara berkala selama 1 detik.  Pada saat ini, tegangan output Vout 5V menghilang.  Jika kontak "input" ditutup ke ground dengan frekuensi 1 detik, reset tidak dilakukan dan LED tidak menyala. <br><br>  Manajemen WDT dalam program utama adalah sebagai berikut <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PIN_WDT 5 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//GPIO ,   WDT bool WDT_flag = false; //    void WDT_begin(){ pinMode(PIN_WDT,OUTPUT); digitalWrite(PIN_WDT,WDT_FLAG); } //   (   1    WDT,  ) void WDT_reset(){ if( WDT_flag)WDT_flag = false; else WDT_flag = true; digitalWrite(PIN_WDT,WDT_FLAG); }</span></span></span></span></code> </pre> <br>  Itu saja.  Semua file sumber, sirkuit, dan papan sirkuit dapat diunduh dari <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Github</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id447004/">https://habr.com/ru/post/id447004/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id446994/index.html">Ruang sebagai memori yang tidak jelas</a></li>
<li><a href="../id446996/index.html">Metode Pomodoro tidak sekeren mungkin</a></li>
<li><a href="../id446998/index.html">Mulai SAP GUI dari browser</a></li>
<li><a href="../id447000/index.html">Perang format audio: 10 bahan di media digital dan analog</a></li>
<li><a href="../id447002/index.html">Tur bersama rekan kerja di Kabinet foto</a></li>
<li><a href="../id447006/index.html">Panduan: cara membuat bot sederhana untuk JS Telegram untuk pemula dalam pemrograman</a></li>
<li><a href="../id447008/index.html">Bagaimana mengendalikan infrastruktur jaringan Anda. Daftar isi</a></li>
<li><a href="../id447010/index.html">Tidak lama musik dimainkan ... atau bagaimana OS Elbrus tidak pernah menjadi gratis</a></li>
<li><a href="../id447014/index.html">Struktur referensi pakai di C # 8.0</a></li>
<li><a href="../id447016/index.html">25 tahun kemudian: sebuah wawancara dengan Linus Torvalds</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>