<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëáüèª ‚òùüèΩ üéì Le traitement des erreurs irr√©cup√©rables dans Swift üìÑ üßë‚Äçü§ù‚Äçüßë üëø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pr√©face 


 Cet article est un exemple de la fa√ßon dont nous pouvons effectuer des recherches sur le comportement des fonctions de la biblioth√®que sta...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Le traitement des erreurs irr√©cup√©rables dans Swift</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440884/"><h2 id="preface">  Pr√©face </h2><br><p> Cet article est un exemple de la fa√ßon dont nous pouvons effectuer des recherches sur le comportement des fonctions de la biblioth√®que standard Swift en renfor√ßant nos connaissances non seulement sur la documentation de la biblioth√®que, mais √©galement sur son code source. </p><br><h2 id="unrecoverable-errors">  Erreurs irr√©cup√©rables </h2><br><p>  Tous les √©v√©nements que les programmeurs appellent des "erreurs" peuvent √™tre s√©par√©s en deux types. </p><br><ul><li>  √âv√©nements caus√©s par des facteurs externes tels qu'une panne de connexion r√©seau. </li><li>  √âv√©nements caus√©s par l'erreur d'un programmeur, comme atteindre un bo√Ætier d'op√©rateur de commutateur qui devrait √™tre inaccessible. </li></ul><a name="habracut"></a><br><p>  Les √©v√©nements du premier type sont trait√©s dans un flux de contr√¥le r√©gulier.  Par exemple, nous r√©agissons √† une d√©faillance du r√©seau en affichant un message √† un utilisateur et en configurant une application pour attendre la r√©cup√©ration de la connexion r√©seau. </p><br><p>  Nous essayons de d√©couvrir et d'√©liminer les √©v√©nements du deuxi√®me type le plus t√¥t possible avant la mise en production du code.  Une des approches ici consiste √† ex√©cuter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des v√©rifications d'ex√©cution mettant fin √† l'ex√©cution du programme</a> dans un √©tat d√©bogable et √† imprimer un message avec une indication de l'endroit o√π le code s'est produit. </p><br><p>  Par exemple, un programmeur peut mettre fin √† l'ex√©cution si l'initialiseur requis n'a pas √©t√© fourni mais a √©t√© appel√©.  Cela sera invariablement remarqu√© et corrig√© lors du premier test. </p><br><pre><code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">required</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>?(coder aDecoder: <span class="hljs-type"><span class="hljs-type">NSCoder</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">fatalError</span></span>(<span class="hljs-string"><span class="hljs-string">"init(coder:) has not been implemented"</span></span>) }</code> </pre> <br><p>  Un autre exemple est la commutation entre les indices (supposons que pour une raison quelconque, vous ne pouvez pas utiliser l'√©num√©ration). </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> index { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-comment"><span class="hljs-comment">// something is done here case 1: // other thing is done here case 2: // and other thing is done here default: assertionFailure("Impossible index") }</span></span></code> </pre> <br><p>  Encore une fois, un programmeur va provoquer un crash lors du d√©bogage ici afin de remarquer in√©vitablement un bogue dans l'indexation. </p><br><p>  Il existe cinq fonctions de terminaison de la biblioth√®que standard Swift (comme pour Swift 4.2). </p><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">precondition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> condition: @autoclosure </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span>, <span class="hljs-number"><span class="hljs-number">_</span></span> message: <span class="hljs-meta"><span class="hljs-meta">@autoclosure</span></span> () -&gt; <span class="hljs-type"><span class="hljs-type">String</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>, file: <span class="hljs-type"><span class="hljs-type">StaticString</span></span> = #file, line: <span class="hljs-type"><span class="hljs-type">UInt</span></span> = #line)</code> </pre> <br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preconditionFailure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> message: @autoclosure </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">String</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>, file: <span class="hljs-type"><span class="hljs-type">StaticString</span></span> = #file, line: <span class="hljs-type"><span class="hljs-type">UInt</span></span> = #line) -&gt; <span class="hljs-type"><span class="hljs-type">Never</span></span></code> </pre> <br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">assert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> condition: @autoclosure </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span>, <span class="hljs-number"><span class="hljs-number">_</span></span> message: <span class="hljs-meta"><span class="hljs-meta">@autoclosure</span></span> () -&gt; <span class="hljs-type"><span class="hljs-type">String</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>, file: <span class="hljs-type"><span class="hljs-type">StaticString</span></span> = #file, line: <span class="hljs-type"><span class="hljs-type">UInt</span></span> = #line)</code> </pre> <br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">assertionFailure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> message: @autoclosure </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">String</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>, file: <span class="hljs-type"><span class="hljs-type">StaticString</span></span> = #file, line: <span class="hljs-type"><span class="hljs-type">UInt</span></span> = #line)</code> </pre> <br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fatalError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> message: @autoclosure </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">String</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>, file: <span class="hljs-type"><span class="hljs-type">StaticString</span></span> = #file, line: <span class="hljs-type"><span class="hljs-type">UInt</span></span> = #line) -&gt; <span class="hljs-type"><span class="hljs-type">Never</span></span></code> </pre> <br><p>  <strong>Laquelle des cinq fonctions terminales devrions-nous pr√©f√©rer?</strong> </p><br><h2 id="source-code-vs-documentation">  Code source vs documentation </h2><br><p>  Regardons le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">code source</a> .  On voit tout de suite ce qui suit: </p><br><ol><li>  Chacune de ces cinq fonctions met fin √† l'ex√©cution du programme ou ne fait rien. </li><li>  La r√©siliation possible se produit de deux mani√®res. <br><ul><li>  Avec l'impression d'un message de d√©bogage pratique en appelant <code>_assertionFailure(_:_:file:line:flags:)</code> . </li><li>  Sans le message de d√©bogage simplement en appelant <code>Builtin.condfail(error._value)</code> ou <code>Builtin.int_trap()</code> . </li></ul></li><li>  La diff√©rence entre les cinq fonctions terminales r√©side dans les conditions dans lesquelles tout ce qui pr√©c√®de se produit. </li><li>  <code>fatalError(_:file:line)</code> appelle <code>_assertionFailure(_:_:file:line:flags:)</code> sans condition. </li><li>  Les quatre autres fonctions terminales √©valuent les conditions en appelant les fonctions d'√©valuation de configuration suivantes.  (Ils commencent par un trait de soulignement, ce qui signifie qu'ils sont internes et ne sont pas cens√©s √™tre appel√©s directement par un programmeur qui utilise la biblioth√®que standard Swift). <br><ul><li> <code>_isReleaseAssertConfiguration()</code> </li> <li> <code>_isDebugAssertConfiguration()</code> </li> <li> <code>_isFastAssertConfiguration()</code> </li> </ul></li></ol><br><p>  Examinons maintenant la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> .  Nous pouvons voir tout de suite ce qui suit. </p><br><ol><li>  <code>fatalError(_:file:line)</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">imprime inconditionnellement un message donn√© et arr√™te l'ex√©cution</a> . </li><li>  Les effets des quatre autres fonctions de terminaison varient en fonction de l'indicateur de g√©n√©ration utilis√©: <code>-Onone</code> , <code>-O</code> , <code>-Ounchecked</code> .  Par exemple, consultez la documentation de <code>preconditionFailure(_:file:line:)</code> . </li><li>  Nous pouvons d√©finir ces indicateurs de g√©n√©ration dans Xcode via le <code>SWIFT_OPTIMIZATION_LEVEL</code> compilateur <code>SWIFT_OPTIMIZATION_LEVEL</code> . </li><li>  Nous savons √©galement √† partir de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> Xcode 10 qu'un autre indicateur d'optimisation - <code>-Osize</code> - a √©t√© introduit. </li><li>  Nous avons donc les quatre indicateurs de construction d'optimisation √† consid√©rer. <br><ul><li>  <code>-Onone</code> (ne pas optimiser) </li><li>  <code>-O</code> (optimiser pour la vitesse) </li><li>  <code>-Osize</code> (optimiser la taille) </li><li>  <code>-Ounchecked</code> (d√©sactiver de nombreuses v√©rifications du compilateur) </li></ul></li></ol><br><p>  Nous pouvons conclure que la configuration √©valu√©e dans les quatre fonctions terminales est d√©finie par ces drapeaux de construction. </p><br><h2 id="running-configuration-evaluation-functions">  Ex√©cution des fonctions d'√©valuation de la configuration </h2><br><p>  Bien que les fonctions d'√©valuation de la configuration soient con√ßues pour un usage interne, certaines d'entre elles sont <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">publiques √† des fins de test</a> , et nous pouvons les essayer via CLI en donnant les commandes suivantes dans Bash. </p><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'print(_isFastAssertConfiguration())'</span></span> &gt;conf.swift $ swift conf.swift <span class="hljs-literal"><span class="hljs-literal">false</span></span> $ swift -Onone conf.swift <span class="hljs-literal"><span class="hljs-literal">false</span></span> $ swift -O conf.swift <span class="hljs-literal"><span class="hljs-literal">false</span></span> $ swift -Osize conf.swift <span class="hljs-literal"><span class="hljs-literal">false</span></span> $ swift -Ounchecked conf.swift <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> <br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'print(_isDebugAssertConfiguration())'</span></span> &gt;conf.swift $ swift conf.swift <span class="hljs-literal"><span class="hljs-literal">true</span></span> $ swift -Onone conf.swift <span class="hljs-literal"><span class="hljs-literal">true</span></span> $ swift -O conf.swift <span class="hljs-literal"><span class="hljs-literal">false</span></span> $ swift -Osize conf.swift <span class="hljs-literal"><span class="hljs-literal">false</span></span> $ swift -Ounchecked conf.swift <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br><p>  Ces tests et l'inspection du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">code source</a> nous conduisent aux conclusions approximatives suivantes. </p><br><p>  Il existe trois configurations mutuellement exclusives. </p><br><ul><li>  <em>La</em> configuration des <code>-Osize</code> est d√©finie en fournissant un <code>-Osize</code> build <code>-O</code> ou <code>-Osize</code> . </li><li>  <em>La</em> configuration de <em>d√©bogage</em> est d√©finie en fournissant soit un <code>-Onone</code> build <code>-Onone</code> , soit aucun indicateur d'optimisation. </li><li>  <code>_isFastAssertConfiguration()</code> est √©valu√© √† <code>true</code> si un <code>-Ounchecked</code> build <code>-Ounchecked</code> est d√©fini.  Bien que cette fonction ait un mot ¬´rapide¬ª dans son nom, elle n'a rien √† voir avec l'optimisation de l'indicateur de build speed <code>-O</code> . </li></ul><br><p>  <strong>NB:</strong> Ces conclusions ne sont pas la d√©finition stricte du moment o√π les versions de <em>d√©bogage</em> ou de <em>version</em> ont lieu.  C'est une question plus complexe.  Mais ces conclusions sont correctes pour le contexte d'utilisation des fonctions de terminaison. </p><br><h2 id="simplifying-the-picture">  Simplifier l'image </h2><br><h3 id="-ounchecked"> <code>-Ounchecked</code> </h3> <br><p>  Examinons non pas √† <strong>quoi <code>-Ounchecked</code> indicateur <code>-Ounchecked</code></strong> (il n'est pas pertinent ici), mais <strong>quel est son r√¥le</strong> dans le contexte de la fin de l'utilisation des fonctions. </p><br><ul><li>  La documentation de la <code>precondition(_:_:file:line:)</code> et de l' <code>assert(_:_:file:line:)</code> indique: "Dans les versions <code>-Ounchecked</code> , la condition n'est pas √©valu√©e, mais l'optimiseur peut supposer qu'elle a toujours la valeur true. Le non-respect de cette hypoth√®se est une grave erreur de programmation. " </li><li>  La documentation de <code>preconditionFailure(_:file:line)</code> et <code>assertionFailure(_:file:line:)</code> indique: "Dans les versions <code>-Ounchecked</code> , l'optimiseur peut supposer que cette fonction n'est jamais appel√©e. Le non-respect de cette hypoth√®se est une grave erreur de programmation. " </li><li>  Nous pouvons voir dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">code source</a> que l'√©valuation de <code>_isFastAssertConfiguration()</code> sur <code>true</code> <strong>ne devrait pas se produire</strong> .  (Si cela se produit, √©trange <code>_conditionallyUnreachable()</code> est appel√©. Voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">voir lignes 136 et</a> <code>_conditionallyUnreachable()</code> ) </li></ul><br><p>  En parlant plus directement, vous <strong>ne devez pas autoriser l'accessibilit√©</strong> des quatre fonctions de terminaison suivantes avec l' <code>-Ounchecked</code> construction <code>-Ounchecked</code> d√©fini pour votre programme. </p><br><ul><li> <code>precondition(_:_:file:line:)</code> </li> <li> <code>preconditionFailure(_:file:line)</code> </li> <li> <code>assert(_:_:file:line:)</code> </li> <li> <code>assertionFailure(_:file:line:)</code> </li> </ul><br><p>  Utilisez uniquement <code>fatalError(_:file:line)</code> tout en appliquant <code>-Ounchecked</code> et en m√™me temps, ce qui permet que le point de votre programme avec l' <code>fatalError(_:file:line)</code> soit accessible. </p><br><h3 id="the-role-of-a-condition-check">  Le r√¥le d'un contr√¥le d'√©tat </h3><br><p>  Deux des fonctions de terminaison nous permettent de v√©rifier les conditions.  L'inspection du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">code source</a> nous permet de voir que si la condition √©choue alors le comportement de la fonction est le m√™me que le comportement de son cousin respectif: </p><br><ul><li>  <code>precondition(_:_:file:line:)</code> devient <code>preconditionFailure(_:file:line)</code> , </li><li>  <code>assert(_:_:file:line:)</code> devient <code>assertionFailure(_:file:line:)</code> . </li></ul><br><p>  Cette connaissance facilite l'analyse approfondie. </p><br><h3 id="release-vs-debug-configurations">  Versions vs configurations de d√©bogage </h3><br><p>  Finalement, une documentation suppl√©mentaire et une inspection du code source nous permettent de formuler le tableau suivant. </p><br><p><img src="https://habrastorage.org/webt/x3/tq/vs/x3tqvsckgpqpyxso3flqfhyyddo.png" alt="Fonctions de terminaison"></p><br><p>  Il est clair maintenant que le choix le plus important pour un programmeur est le comportement du programme <strong>dans la <em>version</em></strong> si une v√©rification d'ex√©cution r√©v√®le une erreur. </p><br><p>  La cl√© √† retenir ici est que <code>assert(_:_:file:line:)</code> et <code>assertionFailure(_:file:line:)</code> rendent l'impact de l'√©chec du programme moins grave.  Par exemple, une application iOS peut avoir corrompu l'interface utilisateur (car certaines v√©rifications importantes de l'ex√©cution ont √©chou√©), mais elle ne se bloquera pas. </p><br><p>  Mais ce sc√©nario n'est peut-√™tre pas celui que vous vouliez.  Vous avez le choix. </p><br><h2 id="never-return-type">  <code>Never</code> renvoyer le type </h2><br><p>  <code>Never</code> est utilis√© comme type de fonction de retour qui g√©n√®re sans condition une erreur, intercepte ou ne se termine pas normalement.  Ces types de fonctions ne reviennent pas r√©ellement, ils <strong>ne</strong> reviennent <strong>jamais</strong> . </p><br><p>  Parmi les cinq fonctions terminales, seules <code>preconditionFailure(_:file:line)</code> et <code>fatalError(_:file:line)</code> renvoient <code>Never</code> car seules ces deux fonctions arr√™tent inconditionnellement les ex√©cutions de programme et ne reviennent donc jamais. </p><br><p>  Voici un bel exemple d'utilisation de <code>Never</code> type dans une application en ligne de commande.  (Bien que cet exemple n'utilise pas les fonctions de terminaison de la biblioth√®que standard Swift mais la fonction C <code>exit()</code> standard √† la place). </p><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printUsagePromptAndExit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Never</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Usage: command directory"</span></span>) exit(<span class="hljs-number"><span class="hljs-number">1</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-type"><span class="hljs-type">CommandLine</span></span>.argc == <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { printUsagePromptAndExit() } <span class="hljs-comment"><span class="hljs-comment">// ...</span></span></code> </pre> <br><p>  Si <code>printUsagePromptAndExit()</code> renvoie <code>Void</code> au lieu de <code>Never</code> , vous obtenez une erreur de g√©n√©ration avec le message " <em>le corps de 'guard' ne doit pas tomber, envisagez d'utiliser un 'return' ou 'throw' pour quitter la port√©e</em> ".  En utilisant <code>Never</code> vous dites √† l'avance que vous <strong>ne</strong> quittez <strong>jamais</strong> la port√©e et que le compilateur ne vous donnera donc pas d'erreur de compilation.  Sinon, vous devez ajouter un <code>return</code> √† la fin du bloc de code de garde, ce qui n'est pas joli. </p><br><h2 id="takeaways">  Plats √† emporter </h2><br><ul><li>  Peu importe la fonction de terminaison √† utiliser si vous √™tes s√ªr que toutes vos v√©rifications d'ex√©cution ne sont pertinentes que pour la configuration de <em>d√©bogage</em> . </li><li>  Utilisez uniquement <code>fatalError(_:file:line)</code> tout en appliquant <code>-Ounchecked</code> et en m√™me temps, ce qui permet que le point de votre programme avec l' <code>fatalError(_:file:line)</code> soit accessible. </li><li>  Utilisez <code>assert(_:_:file:line:)</code> et <code>assertionFailure(_:file:line:)</code> si vous craignez que les v√©rifications d'ex√©cution puissent √©chouer d'une mani√®re ou d'une autre dans la version.  Au moins, votre application ne se bloquera pas. </li><li>  Utilisez <code>Never</code> pour que votre code soit net. </li></ul><br><h2 id="useful-links">  Liens utiles </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vid√©o WWDC "Quoi de neuf dans Swift"</a> d√©crivant le <code>SWIFT_OPTIMIZATION_LEVEL</code> g√©n√©ration <code>SWIFT_OPTIMIZATION_LEVEL</code> (√† partir de 11 minutes). </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment ne fonctionne jamais en interne dans Swift</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>NSHipster's article about nature of Never</code></a> </li> <li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Discussion Swift Forums</a> sur la suggestion de d√©pr√©cier <code>-Ounchecked</code> . </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr440884/">https://habr.com/ru/post/fr440884/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr440872/index.html">PostGIS et JPA</a></li>
<li><a href="../fr440874/index.html">Impl√©mentation du mouvement des particules libres sur ReactJS</a></li>
<li><a href="../fr440878/index.html">Web Analytics pour les entreprises</a></li>
<li><a href="../fr440880/index.html">Top 10 des capteurs IoT en 2019</a></li>
<li><a href="../fr440882/index.html">√âchapper √† Crypto Pro. √âdition GOST 34.10-2012</a></li>
<li><a href="../fr440886/index.html">Suppression logicielle dans l'API REST</a></li>
<li><a href="../fr440888/index.html">Tests ind√©pendants du Ba√Økal-T1 - le premier SoC russe de 28 nm - et de la carte d'√©valuation BFK 3.1</a></li>
<li><a href="../fr440890/index.html">Patriotisme dans les jeux vid√©o: l'avis d'un ancien joueur</a></li>
<li><a href="../fr440892/index.html">L'efficacit√© inattendue des s√©quences quasi al√©atoires</a></li>
<li><a href="../fr440894/index.html">Conception du son pour Pathfinder: Kingmaker</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>