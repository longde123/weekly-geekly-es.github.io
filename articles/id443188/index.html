<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§¥üèº üë≤ üë©‚Äçüë©‚Äçüëß Tiga mata tergantung pada pilar, atau kisah bahwa lima kaki ATtiny13 sudah cukup üë®üèΩ üïú üë®üèª‚Äç‚öñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="KDPV "Oh, itu dia." 


 Ada kemungkinan kecil bahwa longrid ini akan menjadi sumber kebijaksanaan yang memberi kehidupan bagi para intelektual, canggi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tiga mata tergantung pada pilar, atau kisah bahwa lima kaki ATtiny13 sudah cukup</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443188/"><p><img src="https://habrastorage.org/webt/51/tw/-p/51tw-pewtw_nf5txookeohz5qga.jpeg"><br>  <em>KDPV "Oh, itu dia."</em> </p><br><p>  Ada kemungkinan kecil bahwa longrid ini akan menjadi sumber kebijaksanaan yang memberi kehidupan bagi para intelektual, canggih dalam rahasia ramalan pada kartu Carnot dan mengetahui makna rahasia dari Bentuk Normal Ketiga.  Tetapi jika karena alasan tertentu Anda menyentuh Arduino Anda dengan tangan Anda, besi solder mengumpulkan debu di dapur, Anda mengerti mengapa baterai memiliki satu plus, dan C ++ memiliki dua, maka keajaiban yang benar-benar ajaib dan menakjubkan tidak akan membuat Anda acuh tak acuh.  Jadi, dengan senang hati saya merekomendasikan kepada Anda jumlah pertunjukan sirkus gelandangan <abbr title="ini bukan nama-nama seniman, batu bata terbuat dari cabang, tanah liat dan benda-benda lain, tetapi kayu box - spesies pohon berharga.">"Saman dengan Boxwood" hari ini</abbr> : </p><br><ul><li>  Menambahkan RAM dan ROM ke ATtiny13! </li><li>  Kecerdasan buatan dalam mikroprosesor - pro dan kontra, atau kecantikan tidur - yah, bukankah dia bodoh? </li><li>  Atau masih dura lex sed lex? </li><li>  Bagaimana cara menambahkan kaki ke ATtiny13? </li><li>  Beberapa kata tentang dimensi kelima: bagaimana menjejalkan yang tak tertahankan? </li><li>  Menggergaji setengah non-perawan dengan mencampur isi bagian (dengan jaminan pemulihan). </li><li>  ‚ÄúMemberi Makan Penderitaan‚Äù (lihat kasus sebelumnya tentang lima ribu orang yang jenuh dengan lima roti jelai dan dua ikan). </li></ul><br><p>  Jika setidaknya salah satu trik berguna di masa depan bagi setiap pembaca kedua puluh, saya akan puas, artikel itu ditulis tidak sia-sia. </p><a name="habracut"></a><br><h2 id="svetofor-pervyy-ili-kaa-prinimaet-boy">  Lampu lalu lintas pertama atau Kaa melakukan perlawanan. </h2><br><p>  Ceritanya dimulai, seperti dalam video Natal pra-Natal klasik, ketika kamera melihat melalui jendela buram ke sebuah ruangan kecil yang nyaman: pohon Natal di perada, kapas dan mainan, aroma jeruk keprok dan anggur yang dipoles, getaran hangat bayangan dari cahaya lilin.  Di sofa besar, Dia meluruskan kotak-kotak dan dengan lembut menempelkan pipinya ke bahu-Nya, tanpa sadar mendengarkan gadis kecil yang penuh semangat seperti malaikat ... </p><br><p>  Mereka yang memiliki pengalaman sebagai orang tua tahu betul apa yang pada saat seperti itu dapat Anda dengar.  Saya akan menjelaskan kepada mereka yang belum memperoleh keterampilan seperti itu - dengan tingkat probabilitas tinggi, orang tua sekarang tercengang oleh sesuatu seperti: "Ayah!  Kita besok!  Ke TK!  Saya harus!  Bawa kerajinan ke kontes pohon Natal!  Dan saya ingin tempat pertama! " </p><br><p>  Itu perlu.  Besok  Untuk kita  Kerajinan tangan  Yang terbaik </p><br><p>  Wawancara yang terlibat dengan pelanggan menunjukkan kontur pernyataan kerja: kita membutuhkan lampu lalu lintas.  Dan untuk menjadi cantik dan bersinar seperti yang asli.  Sudah pada tahap ini, jajaran kandidat untuk proyek ISU secara dramatis menipis: Ayah tidak dapat mendukung gagasan bahwa lampu lalu lintas yang cantik, lembut, dijahit dari tambal sulam atau rajutan atau kaitan adalah representasi yang diwujudkan dari mimpi Pelanggan: lampu lalu lintas harus menyala - apa yang tidak jelas? </p><br><p>  Malam bergulir di seluruh negeri, dan pekerjaan mulai mendidih di negara kita. </p><br><p>  Bahan tubuh lampu lalu lintas adalah selongsong kertas toilet, dikompresi untuk membentuk sebuah kotak.  Koin sepuluh rubel itu dikelilingi oleh pensil, dan kemudian lubang-lubang dipotong dengan pisau klerikal di bawah lampu-lampu pensinyalan cahaya (pekerjaan traumatis tidak dipercaya oleh anak-anak). </p><br><p><img src="https://habrastorage.org/webt/op/0f/az/op0fazb4pjg1z5mtam3hvudxve4.jpeg"></p><br><p>  Tutup bagian atas dan bawah lampu lalu lintas dipotong dari karton di tempat.  Puncak atas lampu sesuai dengan pola yang dibuat dilingkari pada kertas 80 gram biasa dan dipotong secara manual. </p><br><p><img src="https://habrastorage.org/webt/rm/ga/5u/rmga5uloolpi1di2umlqxn9lzmw.jpeg"></p><br><p>  Kemudian mereka terpaku pada PVA. </p><br><p><img src="https://habrastorage.org/webt/9x/ql/ff/9xqlfftsq_fphcorsj7nimjlqo8.jpeg"></p><br><p>  Struktur yang dirakit diseret ke halaman dan dicat dengan cat semprot akrilik: murah hati perak, kemudian sedikit hitam di atasnya. </p><br><p><img src="https://habrastorage.org/webt/hh/bm/ha/hhbmhaz7bod1ntgplrtyfeu3bgq.jpeg"></p><br><p>  Jika terjadi kerusakan pada tahap apa pun, tiga salinan dibuat sekaligus.  Tiga strip kertas berwarna - merah, kuning, dan hijau - ditempel dengan filter cahaya di dalam yang paling sukses. </p><br><p>  Menyoroti dari dalam diputuskan oleh sepasang LED putih super terang dari tempat sampah yang luas di tanah air (SHZR).  Kodok Kaptershchitskaya dengan datar menolak untuk memberikan kepada ayah kehadiran SCHR bahkan tiga baterai lithium tablet, dan LED tidak setuju untuk bersinar dari satu, menyatakan bahwa mereka putih dan cerah, dan tegangan jatuh pada mereka dari 2,8 menjadi 3,9 volt.  Maksimum yang berhasil kami tawar-menawar dengan kodok adalah untuk satu baterai AA, cincin ferit dari throttle motherboard yang terbakar dan transistor KT315.  Berpikir dan googling, ayah harus menerima tawaran itu.  Dan mengingat jumlah pena lucu di setiap kelompok TK, ide dengan baterai lithium tidak terlihat sangat menarik. </p><br><p>  Lambung lampu lalu lintas pada baterai menggantikan aroma jarum dan jeruk keprok dengan aroma cat yang keras, ayahku dengan hati-hati menyodok besi solder pada rosin, anak-anak melukai transformator untuk memblokir generator (duplikasi salinan), semuanya berjalan sesuai rencana ... </p><br><p>  Dan tidak, "tiba-tiba" malam itu tidak terjadi: semua trik ketika melilitkan trafo adalah dengan segera memutar jumlah belokan maksimum yang mungkin dengan kawat ganda.  Jangan bingung antara anoda dan katoda LED dan terminal transistor KT315 dan hubungkan ujung gulungan dengan benar (atau tukar jika tidak menyala) sesuai dengan diagram sirkuit.  J1 - saklar daya dari jumper komputer, kemudian ditampilkan "di atap" lampu lalu lintas. </p><br><p>  Sirkuit yang benar-benar sederhana untuk menghasilkan tegangan AC dengan puncak 3-7V dari baterai 1.5V G1 telah lama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dikenal</a> . </p><br><p><img src="https://habrastorage.org/webt/fx/on/h5/fxonh57exbpayjclrpo3k05sazg.png"></p><br><p>  Secara fisik, diagram rangkaian diwujudkan sebagai berikut: </p><br><p><img src="https://habrastorage.org/webt/tt/aq/4u/ttaq4unttq55rdeg-f0tr0ti3zq.png"></p><br><p>  Pita merah memiliki baterai alkaline AA. </p><br><p>  Dan lampu lalu lintas itu sendiri seperti itu. </p><br><p><img src="https://habrastorage.org/webt/2s/5w/dd/2s5wddfdxjkcl34w1mgj_neduyg.jpeg"></p><br><p>  Di pagi hari, anak yang sombong menyeret produk itu ke taman kanak-kanak, tempat mainan membuat percikan dan menjadi pusat perhatian di pohon Natal. </p><br><p><img src="https://habrastorage.org/webt/zz/fy/yc/zzfyyckk-i-jdncvaangd1cee8u.jpeg"></p><br><p>  Benar, itu tidak berhasil dengan tempat pertama dalam kompetisi - batas waktu untuk mengirimkan entri, ternyata, sudah beberapa hari yang lalu. </p><br><p>  Di rumah, ada dua bangunan di ambang jendela dan ketidakpuasan gatal ayah saya dengan solusi untuk tugas "Saya ingin itu seperti lampu lalu lintas yang nyata".  Dan idenya berputar "apakah mungkin untuk mencocokkan solusi yang lengkap, katakanlah pada hal ke-13, bahwa katak telah berbaring di <abbr title="Tempat sampah yang murah hati di Tanah Air, atau, dalam kata-kata istrinya, Plyushkin cadangan.">ShchZR untuk waktu yang</abbr> lama? Apakah akan ada cukup lima kaki, satu kilobyte untuk kode dan 64 byte RAM dan itu, seperti yang dipesan, seperti yang asli?" </p><br><p>  Jadi semua ini hanya perkataan, dongeng tentang solusi akhir dari masalah lampu lalu lintas di depan. </p><br><h2 id="svetofor-vtoroy-kak-nastoyaschiy">  Lampu lalu lintas kedua, seperti yang asli </h2><br><h3 id="ispolzuemyy-instrumentariy-materialy-i-dokumentaciya">  Alat, bahan, dan dokumentasi bekas </h3><br><p>  <em>Bahasa / kerangka kerja</em> : C / Arduino 1.6 / 1.8. <br>  <em>IDE</em> : MS Visual Studio 2012 + Plugin Visual Micro + git. <br>  <em>CAD</em> : DipTrace. <br>  <em>HW</em> : ATtiny13 MK, klon Arduino Nano pada ATmega328, USB-UART pada FT232R, programmer USBISP china-noname. <br>  <em>Teknologi <abbr title="Papan sirkuit.">PP</abbr></em> : <abbr title="Teknologi Laser dan Besi.">LUT</abbr> . <br>  <em>Alat</em> : Solder, pistol lem, oven dapur, pisau, gunting, pemotong kawat. <br>  <em>Bahan</em> : Dari <abbr title="Repositori komponen elektronik dengan takdir yang sulit - disolder, digunakan, pernah dibeli di Aliexpress, dll.">ShchZR</abbr> - 4 LED keluaran merah, kuning, hijau dari merek noname, kapasitor tantalum SMD dan sepasang resistor 0805 masing-masing 10k, setengah lusin output 0,25W resistor pembatas arus MF-25, konverter DC-DC 5V pembatas arus Cina, kaleng aerosol dengan cat perak dan hitam, kertas A4, tanah liat polimer dari penjualan. </p><br><p>  <em>Sumber dan dokumen tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Github di</a> bawah lisensi MIT, kode sumber melakukan bersamaan dengan iterasi dari firmware yang dijelaskan di bawah, semua jalur file yang disebutkan relatif terhadap akar repositori.</em> </p><br><p>  <em>Dokumentasi</em> : <br>  ./docs/ATtiny13A datasheet.pdf [Spesifikasi untuk MK Atmel ATtiny13A] <br>  ./docs/ATmega328 datasheet.pdf [Spesifikasi Atmel ATmega328 MK] <br>  ./docs/AVR4027 - Kiat dan Trik untuk Mengoptimalkan Kode C Anda.pdf [Atmel AVR4027: Kiat dan Trik untuk Mengoptimalkan Kode C Anda untuk Mikrokontroler AVR 8-bit] <br>  ./docs/AVR4013 - PicoPower basics.pdf [Catatan tentang Mode Penghematan Daya] </p><br><p>  Dari <abbr title="Bahasa inggris Lingkungan Pengembangan Terpadu">IDE</abbr> Arduino, seperti selimut dari awan.  Wiz mereka adalah ejekan halus Jesuit tentang segala hal yang dapat disakralkan di kalangan programmer embed.  Tetapi Arduino, sebagai ekosistem, hidup, akan hidup dan akan hidup, dan karena kesederhanaan menginstal lingkungan pada komputer di bawah berbagai OS, dan karena mereka adalah yang pertama kali mengaktifkan, tanpa biaya khusus untuk debugger perangkat keras, menggunakan sen UART dan bootloader eksklusif, pengembangan dalam isian MK yang cukup serius.  Dan di sini adalah Paman Liao, siap untuk menjual beberapa klon dengan harga satu asli.  Fakta bahwa di atmegs senior Anda dapat men-debug logika dan operasi program, dan kemudian dengan perubahan minimal untuk mentransfer ke tinka yang sama - ini juga merupakan argumen. </p><br><p>  Itu normal dan nyaman bagi saya untuk bekerja di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">MS VisualStudio</a> , saya tidak punya terlalu banyak ruang untuk AtmelStudio atau WinAVR dan saya tidak ingin menemukannya, tanpa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">debugger perangkat keras</a> mereka tidak memiliki fasilitas terbaik.  Tentang plugin VisualMicro, yang menambahkan dukungan Arduino ke MS VisualStudio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">, sudah</a> ditulis dengan cukup detail dan ditulis dengan cerdas di Haber. <br>  Fokus "Arduino pada ATtiny13" pada hub juga telah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dipertimbangkan</a> sejak lama dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">berulang kali</a> . </p><br><p>  Secara singkat, tambahkan modul <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">MicroCore</a> ke instalasi yang diinstal dari lingkungan Arduino, setelah itu menjadi mungkin untuk memilih ATtiny13 MK dalam kartu target. </p><br><p><img src="https://habrastorage.org/webt/9f/rm/fe/9frmfek8wvpfsphvtyhedqiiuoy.png"></p><br><p>  Git - tidak ada alternatif untuk apa pun, bahkan sebagian besar proyek rumah.  Kebiasaannya sederhana, tetapi benar: ketika mulai bekerja pada program apa pun, cukup ketik "git init" di direktori pada baris perintah.  Dukungan bawaan MS Visual Studio untuk komit di repositori lokal akan menghemat waktu dan waktu lebih dari sekali. </p><br><p>  DipTrace, seperti CAD untuk sirkuit dan papan sirkuit tercetak, nyaman, domestik, sirkuit dan kabel ramah pengguna, mudah untuk menambahkan komponen khusus (UGO, kontak), jika diinginkan, papan sirkuit cetak dengan komponen dapat diputar dalam 3D, bantuan berkualitas tinggi dan pelajaran pelatihan disertakan.  Selain itu, saya terkesan dengan kebijakan lisensi mereka: batasan lisensi standar nirlaba (1000 pin, 4 lapisan sinyal), gratis untuk Rusia, Ukraina, dan Republik Belarus, dalam 99% kasus sudah cukup untuk kerajinan rumah. </p><br><p>  Saya tidak bisa mengatur agar Arduino Nano berfungsi dengan baik, sebagai programmer yang cerdik, tetapi dengan programmer ISP USB, masalahnya diselesaikan dengan mudah.  Dengan cepat membuat sketsa file batch untuk kompilasi / firmware - di direktori ./gcc di proyek. </p><br><p>  File .ino (tetapi sebenarnya C / C ++) dapat dikompilasi dengan benar di studio "di bawah arduino di bawah ATtiny13", itu hanya dilayani oleh parameter file batch ini pada baris perintah: </p><br><pre><code class="plaintext">&gt;"./gcc/0_MAKE &amp; upload.cmd" MyArduinoFile.ino</code></pre><br>
<p>     ISP ,     ,      .</p><br>
<pre><code class="plaintext">&gt;"./gcc/0_MAKE &amp; asm.cmd" MyArduinoFile.ino</code></pre><br>
<p>   , ,     ‚Äî   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">  AVR</a>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a> . <strong></strong>: <em>         ,  </em>.</p><br>
<h3 id="dusha-svetofora"> </h3><br>
<h4 id="upgrade-romram-pod-arduino-dlya-attiny13">Upgrade ROM&amp;RAM  Arduino  ATtiny13</h4><br>
<p> Arduino  ( setup(){...}; loop(){...};)       ""   - int main(){setup(); loop();}, <em></em>        by Arduino. </p><br>
<pre><code class="cpp">uint8_t cnt;
void setup() {
    cnt=0;
}
void loop() {
  cnt++;
}
//Program size: 164 bytes (used 16% of a 1 024 byte maximum) (0,57 secs)
//Minimum Memory Usage: 5 bytes (8% of a 64 byte maximum)</code></pre><br>
<p>    ,       :</p><br>
<pre><code class="cpp">uint8_t cnt;
int main(){
    cnt=0;      // &lt; setup()
    while(1){
        cnt++;  // &lt; loop()
    }
}
//Program size: 60 bytes (used 6% of a 1 024 byte maximum) (1,23 secs)
//Minimum Memory Usage: 1 bytes (2% of a 64 byte maximum)</code></pre><br>
<p>   16%  6%   ,  ,  6%     .                   ,   ‚Äî      64  . </p><br>
<h4 id="intellekt-spyaschey-krasavicy">  </h4><br>
<p>  , ,  :       .         ,     ,   ,    ,     .   , ,   ,     .         ,       :  <abbr title="   = -  +      +   + ">CPU</abbr>     ,       .    ‚Äî   ,     N  .      ""-CPU     ,       (9.6     /    1024 = 9370 ,      ) 1/9370 = 0.0001067 .      8-   .  ,   ,    ,     " ".      ,   ,  ,           "".      37    (256  0.0001067 = 0.027315; 0.027315  37 = 1.01065 ~= 1s). </p><br>
<p>  :     - (HW ,     1024 ),   8   ‚Äî    ,         ,    .</p><br>
<p><strong></strong>: <em> globalTimer   volatile,  ,         ,  ,     CPU        ,           </em>.</p><br>
<pre><code class="cpp">#include &lt;avr/io.h&gt;         //     IDE -  
#include &lt;avr/sleep.h&gt;      // ,  
#include &lt;avr/interrupt.h&gt;          //   
volatile uint16_t  globalTimer;     //     64   
//  -    globalTimer  1/37 
ISR(TIM0_OVF_vect){
    globalTimer++;  //       . , ,  while(1)   .
}
int main() {
    //     "  -". 
    set_sleep_mode(SLEEP_MODE_IDLE);    //   - .
    sleep_enable();                 //    
    TCCR0B = _BV(CS02) | _BV(CS00); //  0 - clock frequency / 1024
    TIMSK0 |= _BV(TOIE0);           //      overflow interrupt
    sei();                          //    
    while(1){
        //.........   
        sleep_cpu();    //     -   .
    }
}
//Program size: 128 bytes (used 13% of a 1 024 byte maximum) (0,86 secs)
//Minimum Memory Usage: 2 bytes (3% of a 64 byte maximum)</code></pre><br>
<h4 id="u-koshki-4-nogi-vhod-vyhod-zemlya-i-pitanies-zhalostlivaya-studencheskaya-pesnya">"  4 : , ,   "()   </h4><br>
<p> , ,       .<br>
   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> </a>,   ,    CPU,   /  /    .     <abbr title="General-Purpose Input/Output,  / (I/O)  ">GPIO</abbr>.</p><br>
<p>      Arduino   :     Arduino  pin_number      ( ):</p><br>
<pre><code class="cpp">pinMode(pin_number, OUTPUT); //   INPUT -   </code></pre><br>
<p>    /     ,   ‚Äî       .</p><br>
<pre><code class="cpp">Value = digitalRead(pin_input_number);  //Value -  HIGH  LOW (1  0)
digitalWrite(pin_outpit_number, Value);       //   pin_outpit_number - HIGH  LOW</code></pre><br>
<p> ""  ,   Wiring    ,  ,    Arduino (        )     (  )     (  ) (    ).</p><br>
<p><img src="https://habrastorage.org/webt/fp/di/ni/fpdiniruiiujuodrtyzrcfyljr8.png"></p><br>
<p>..   Arduino 7    11  PD7 ‚Äî    D.<br>
  digitalRead, digitalWrite, pinMode  ..,             ,   , ,      Wiring-      ,       .</p><br>
<p>   ‚Äî   ,    . ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">DIHALT</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>          .</p><br>
<p><img src="https://habrastorage.org/webt/rk/y8/sj/rky8sjzln3u1k3lndv0inksdxjm.jpeg"></p><br>
<p>   -    (<abbr title=" -  ">GPIO</abbr>)     ,  8-   ‚Äî  8    .     ,   6     (. ATtiny13 pinout,   ),  PB0  PB5,      PB5 ‚Äî     MK    .    -    : (     "B") <abbr title="Data Direction Register B,   -   ">DDRB</abbr>, <abbr title="Port B Input Pins Register,    0  1  ,  ">PINB</abbr>  <abbr title="Port B Data Register,      ">PORTB</abbr>.    ‚Äî  ,    ,   .  PB0, PB1, PB2, PB3, PB4, PB5 ‚Äî       B.      #include &lt;avr/io.h&gt; (   iotn13.h  ),      (PB0  0,..., PB5 ‚Äî 5)      IDE,        Arduino. </p><br>
<p><strong></strong>: <em>      ,    ,       .  ,  -      , , ,   DDRx GPIO ,   ‚Äî .       PORTx ‚Äî    ,  "-    ",   ,      ‚Äî   ,    PINx.       ,  50       0  1.        ,      </em>.</p><br>
<div class="spoiler"><b class="spoiler_title">, </b><div class="spoiler_text"><p>  PB2   HIGH, +5,   PB3  LOW, 0,    PB0 ,  ‚Äî      .<br>
DDRB   ,    PB0,   ( ) = 0 (PB0   ),     = 1 (PB2, PB3 ‚Äî ), ..     110,   ‚Äî  ,  1  0 ‚Äî    . </p><br>
<pre><code class="cpp">DDRB = 12;  //  000001100    - 12
//        (!)
//        pinMode().</code></pre><br>
<p>      ‚Äî  PORTB ,    =1 (PB2  HIGH),   ‚Äî  (PB3  LOW),  ‚Äî  , 01</p><br>
<pre><code class="cpp">PORTB = 8;  //(dec)8 === (bin)000001000
//  -        .</code></pre><br>
<p>             PINB,   ,    ‚Äî      .<br>
  ,          ‚Äî  .<br>
    3 (PB3)  :   1   ,    3  .<br>
3&lt;&lt;00000001 === PB3&lt;&lt;1 //  ‚Äî 00001000<br>
     , _BV(x),      (x&lt;&lt;1), .. _BV(PB3) ‚Äî     1.<br>
 _BV(PB3) | _BV(PB2)      00001100 (| ‚Äî   ).<br>
<strong></strong>: <em>      ,       ,     </em>.</p><br>
<pre><code class="cpp">PORTB |= _BV(PB3) | _BV(PB2); // 2  3   == 1,     PB2  PB3  HIGH,   PORTB  </code></pre><br>
<p>  0    ,          ,    .     0     1  .       ,  ,  1     ,   0 ‚Äî   0 .</p><br>
<pre><code class="cpp">PORTB &amp;= ~(_BV(PB3) | _BV(PB2)); //   PORTB 2  3  -  , LOW,   .</code></pre></div></div><br>
<p>     HW , - 0, Timer0.   GPIO,    ,   ,      datasheet ATtiny13,  -     -,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a> <abbr title="     328,     .">Ilya Ananev</abbr>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">- 0</a>   ATmega328. </p><br>
<p>   ,    ,   .</p><br>
<pre><code class="cpp">TCCR0B = _BV(CS02) | _BV(CS00);    //    CS02  CS00  1 -   0 = clock frequency / 1024
TIMSK0 |= _BV(TOIE0);           //   TOIE0  1 -     TIM0_OVF
//      TIMSK0 = _BV(TOIE0);</code></pre><br>
<h4 id="gost-ili-zakon-est-zakon">    .</h4><br>
<p>      ,       .    ,    ,          .    -  ,        ,      ,    (!)   . </p><br>
<p>    ,       .           "<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">   27.02.13</a>"  7    52289-2004     ,          .<br>
     (  ): ,   , ,  , , .</p><br>
<p>"*    "  "     2 ,    ‚Äî 3 . </p><br>
<p>               3        1 /.*"</p><br>
<p>   ,      (    ,      /  ‚Äî PERIOD_0  PERIOD_4,    ‚Äî  ).</p><br>
<pre><code class="cpp">#define ONE_SECOND  37      //     1 
#define QT_SECOND   9       //  

#define PERIOD_FLASH_GREEN  QT_SECOND           //    ( ) -    
#define PERIOD_FLASH_YELLOW ONE_SECOND * 1      //    -    - 
                                                        //  --- 
#define PERIOD_0    ONE_SECOND * 10 //R G R G   0.  ---   (10 )
#define PERIOD_1    ONE_SECOND * 3  //R g R g   1.  ---   (3 )     
#define PERIOD_2    ONE_SECOND * 1  //R Y R Y   2.  ---  (1 )
#define PERIOD_3    ONE_SECOND * 2  //RY Y RY Y 3. + ---  (2 ) 
#define PERIOD_4    ONE_SECOND * 7  //G R G R   4.  ---   (7 )
#define PERIOD_5    ONE_SECOND * 3  //g R g R   5.   --- (3 )
#define PERIOD_6    ONE_SECOND * 1  //Y R Y R   6.  ---  (1 )
#define PERIOD_7    ONE_SECOND * 2  //Y RY Y RY 7.  --- + (2 )</code></pre><br>
<p>  ,      ,    .</p><br>
<pre><code class="cpp">typedef struct{
    const uint8_t ddr_val_0;    // DDRB value -   
    const uint8_t port_val_0;   // PORTB value   -   
    const uint8_t ddr_val_1;    // DDRB value  -   "",   
    const uint8_t port_val_1;   // PORTB value - 
    const uint16_t flash_period;    // period of flashing -   _val_1  _val_0
    const uint16_t signal_period;   // period of this lighting state
}lightSignalization;            //   , _0  _1 -   , flash_long -   
// flash_period == 0,   ,   _val_0.
// signal_period == 0,         .</code></pre><br>
<p>  ,        128  ‚Äî     ,      .</p><br>
<h4 id="kak-nayti-v-attiny13-vosem-ili-devyat-pinov-vvoda-vyvoda">   ATtiny13  ( ?)  -</h4><br>
<p>   ,  ,   -  -     ,  :       6  . -  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">denvo</a>   "<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> ?  RESET</a>"       5-     ,     ,      ,      ,   -   .</p><br>
<p>   -     :    --, ..      ,  7  .</p><br>
<p>     ‚Äî   , ,  ,   8,  ? </p><br>
<p> ,  -,      "reset", PB5,      . </p><br>
<p>   ,  ? , ,   ,    . , , ,  ,   ,  .</p><br>
<p> ,  , 8  9  -  ,    8  ‚Äî       .    ,    -,   , , ,   . </p><br>
<p>   ‚Äî    .</p><br>
<p>   :           ‚Äî         .           .</p><br>
<p>        :</p><br>
<p><img src="https://habrastorage.org/webt/hw/6_/6a/hw6_6aeekqqdlt7a0cqnk9kf2pa.png"></p><br>
<p> 1    PORTB |= _BV(GREEN_PIN) ‚Äî    (  ) ,   0 .. PORTB &amp;= ~(_BV(GREEN_PIN)) ‚Äî  (  ).<br>
  ,     ,      ?<br>
     (DDRB |= _BV(GREEN_PIN))   , DDRB &amp;= ~(_BV(GREEN_PIN)), GREEN_PIN   Hi-Z      .      (2.2 * 4)    5,   <abbr title=".  ,       ,        .">   </abbr>.</p><br>
<p>          .<br>
            ‚Äî ..    ,     ,    .</p><br>
<div class="spoiler"><b class="spoiler_title">, ,      </b><div class="spoiler_text"><p>,               .   ,    ‚Äî     ,   37/2=18      ,          ,    . :<br>
)   ,     ,  ,  ,     ;<br>
)   ‚Äî        ,      " "       4  ;<br>
)  ,       4 ( PERIOD_2-&gt;PERIOD_3  PERIOD_6-&gt;PERIOD_7);<br>
)  4                 .</p></div></div><br>
<p>  .</p><br>
<p><img src="https://habrastorage.org/webt/35/in/ym/35inymyguij4kl6qnsuckgz_ukq.png"></p><br>
<pre><code class="cpp">// PINB === 0 0 0 g r y0 btt y1
#define RED_PIN     PB3     // OUT: 1 - "-" , 0 - "-" , IN -  , ,  (!) 
#define YELLOW0_PIN PB2     // OUT: 1 -  "-" 
#define YELLOW1_PIN PB0     // OUT: 1 -  "-" 
#define GREEN_PIN   PB4     // OUT: 1 - "-" , 0 - "-" , IN -  , ,  (!) 

#define RED     _BV(RED_PIN)        // _BV -     (), 1&lt;&lt;VALUE
#define YELL0   _BV(YELLOW0_PIN)        //    -
#define YELL1   _BV(YELLOW1_PIN)
#define GREEN   _BV(GREEN_PIN)      //    - (  0 -   -)  DDRB.GreenPin=1</code></pre><br>
<p> ‚Äî  <abbr title=" ,      reset,     ISP "> </abbr> .    ,            ,   ‚Äî      ,    .</p><br>
<pre><code class="cpp">#define BUTTON_PIN      PB1
#define BUTTON_ON  !(PINB &amp; _BV(BUTTON_PIN))    //( (PINB &amp; _BV(BUTTON_PIN)) == 0)  //  " " -   LOW
#define BUTTON_OFF (PINB &amp; _BV(BUTTON_PIN))     //  " " -    HIGH, (     )</code></pre><br>
<p><strong><em>       ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>,   n   ( ) n(n‚àí1) = n¬≤‚àín .  4   12  ,         .   <abbr title=" +  + ">¬´ , ¬ª</abbr>  <abbr title=" + ">¬´ ,   ¬ª</abbr>        .</em></strong></p><br>
<div class="spoiler"><b class="spoiler_title">    12 LED</b><div class="spoiler_text"><p><img src="https://habrastorage.org/webt/oq/sn/le/oqsnlertvho7jlbhqt5ehp_fcks.png"></p></div></div><br>
<p>*** ‚Äî   ,         DDRx|PORTx,       , ..       .          ‚Äî   ,        ,         . </p><br>
<p>                     .***</p><br>
<h4 id="paru-slov-o-pyatom-izmerenii-kak-vpihnut-nevpihuemoe">    :   ?</h4><br>
<p>         lightSignalization.    lightSignalization        .    0  7  , 8 ‚Äî  ,  9 ‚Äî ,   ""   .     ,         0  7,      . ,  ,      .     3    ( 0  7)  8   --             .   if-   ,    .     ,   .</p><br>
<pre><code class="cpp">lightSignalization traffic_signals[] = {//   
 // {DDRB0, PORTB0,   DDRB_when_flashingif, PORTB_when_flasingif (if flashing),   continous of half-period flashing,   continous curr mode runing}
    {RED|GREEN, RED,   0, 0,   0, PERIOD_0},                    // R G R G
    {RED, RED,  RED|GREEN, RED,   QT_SECOND, PERIOD_1},     // R g R g - flash east green
    {RED|YELL1, RED|YELL1,   0, 0,   0, PERIOD_2 },         // R Y1 R Y1
    {RED|YELL0|YELL1, RED|YELL0|YELL1,  0, 0,   0, PERIOD_3 },  // RY0 Y1 RY0 Y1
    {RED|GREEN, GREEN,   0, 0,   0, PERIOD_4},              // G R G R
    {RED|GREEN, GREEN,   RED, 0,    QT_SECOND, PERIOD_5 },  // g R g R - flash nord green
    {RED|YELL0, YELL0,   0, 0,   0, PERIOD_6},                  // Y0 R Y0 R
    {RED|YELL0|YELL1,  YELL0|YELL1,   0, 0,   0, PERIOD_7  },       // Y0 RY1 Y0 RY1

    {YELL0|YELL1, YELL0|YELL1,   YELL0|YELL1, 0,  ONE_SECOND, 0},   // y0 y1 y0 y1 - flash yellows lights 
    {0, 0,   0, 0,   0, 0}          // traffic lights off, DDR in, Hi-Z
};

//       lightSignalization traffic_signals[]
#define LIGHT_NUM_YELLOW_FLASH  8       //       -  - flash yellows lights
#define LIGHT_NUM_STD_START     0       //       
#define LIGHT_NUM_LIGHTS_OFF    9       //      -   - traffic lights off</code></pre><br>
<p>  lightSignalization  8   . ..     traffic_signals[]  10     80  (,  64  ,  2     ).  ,        .</p><br>
<p> ,  , ,          ‚Äî    ROM,  ,    RAM   ,     .</p><br>
<p>-     </p><br>
<pre><code class="plaintext">const lightSignalization traffic_signals[] PROGMEM= {...</code></pre><br>
<p> ,           </p><br>
<pre><code class="plaintext">&lt;avr/pgmspace.h&gt; pgm_read_byte_near()  pgm_read_word_near()</code></pre><br>
<p> char  shortint .</p><br>
<p>     3   . </p><br>
<ol>
<li><p> ,   .<br>
   traffic_signals[] ‚Äî <strong>LIGHT_NUM_LIGHTS_OFF</strong><br>
{0, 0, 0, 0, 0, 0} // traffic lights off<br>
   ‚Äî  lightSignalization  ,     ‚Äî ,   lightSignalization.signal_period==0 (.. ),   lightSignalization.flash_period==0, ..   . </p><br>
</li>
<li><p> ,  .<br>
   traffic_signals[] ‚Äî <strong>LIGHT_NUM_YELLOW_FLASH</strong><br>
{YELL0|YELL1, YELL0|YELL1, YELL0|YELL1, 0, ONE_SECOND, 0}, // y0 y1 y0 y1 ‚Äî flash yellows lights<br>
   : lightSignalization.signal_period==0.      lightSignalization.flash_period=ONE_SECOND,    :</p><br>
<pre><code class="cpp">DDRB = YELL0|YELL1;     // YELL0, YELL1 - 
PORTB = YELL0|YELL1;    // YELL0, YELL1 = HIGH -  </code></pre><br>
<p></p><br>
<pre><code class="cpp">DDRB = YELL0|YELL1;     // // YELL0, YELL1 -   
PORTB = 0;              // YELL0, YELL1 = LOW -  </code></pre><br>
</li>
<li><p> , --.</p><br>
</li>
</ol><br>
<p> ,   . </p><br>
<p>  traffic_signals[]     ‚Äî <strong>LIGHT_NUM_STD_START</strong><br>
{RED|GREEN, RED, 0, 0, 0, PERIOD_0}, // R G R G<br>
   : lightSignalization.flash_period==0.<br>
DDRB = RED|GREEN; //RED  GREEN ‚Äî  ,  .<br>
PORTB = RED; //  RED ‚Äî HIGH (-      )<br>
//   GREEN ‚Äî LOW (  ,  - ‚Äî  )<br>
      lightSignalization.signal_period==PERIOD_0,       . </p><br>
<p>        current_signal.   2   ‚Äî        ,     lightSignalization.</p><br>
<pre><code class="cpp">uint8_t current_signal;     // 1    ,   traffic_signals
uint16_t tl_flash_end;      // 2       ( !0), 
uint16_t tl_signal_end;     // 2            ( !0)</code></pre><br>
<p> tl_signal_end != 0,   globalTimer&gt;tl_signal_end  current_signal.     0   current_signal,  3, .<br>
current_signal = current_signal &amp; B00000111;<br>
  </p><br>
<pre><code class="plaintext">current_signal &amp;= LIGHT_NUM_STD_MASK ;   //current_signal &amp; B00000111;</code></pre><br>
<p>  current_signal  ,       0  7.<br>
   globalTimer ‚Äî       . </p><br>
<div class="spoiler"><b class="spoiler_title">   </b><div class="spoiler_text"><pre><code class="cpp">#include &lt;limits.h&gt;         // USHRT_MAX
#include &lt;avr/sleep.h&gt;      // ,  
#include &lt;avr/interrupt.h&gt;  //   
#include &lt;avr/pgmspace.h&gt;   //    

#define ONE_SECOND  37      //     1 
#define QT_SECOND   9       //  
#define MAX_GLOBAL_TIMER_VALUE  (USHRT_MAX / 2)     // uint16_t globalTimer -   . 65535 /2 
//     ,  MAX_GLOBAL_TIMER_VALUE - 1
#define PERIOD_FLASH_GREEN  QT_SECOND           //    ( ) -    
#define PERIOD_FLASH_YELLOW ONE_SECOND * 1      //    -    - 
                                                        //  --- 
#define PERIOD_0        ONE_SECOND * 10     //R G R G   0.  ---   (15 )
#define PERIOD_1        ONE_SECOND * 3      //R g R g   1.  ---   (3 )     
#define PERIOD_2        ONE_SECOND * 1      //R Y R Y   2.  ---  (1 )
#define PERIOD_3        ONE_SECOND * 2      //RY Y RY Y 3. + ---  (2 ) 
#define PERIOD_4        ONE_SECOND * 7      //G R G R   4.  ---   (10 )
#define PERIOD_5        ONE_SECOND * 3      //g R g R   5.   --- (3 )
#define PERIOD_6        ONE_SECOND * 1      //Y R Y R   6.  ---  (1 )
#define PERIOD_7        ONE_SECOND * 2      //Y RY Y RY 7.  --- + (2 )

typedef struct{
    const uint8_t ddr_val_0;    // DDRB value    
    const uint8_t port_val_0;   // PORTB value  
    const uint8_t ddr_val_1;    // DDRB value    
    const uint8_t port_val_1;   // PORTB value
    const uint16_t flash_period;    // period of flashing -   _val_1  _val_0
    const uint16_t signal_period;   // period of this lighting state
}lightSignalization;            //   , _0  _1 -   , flash_long -   

//    (PINS === 0 0 0 g r y0 btt y1):
 //     ""     
#define BUTTON      PB1
#define RED_PIN     PB3     // OUT: 1 - "-" , 0 - "-" , IN -  , ,  (!) 
#define YELLOW0_PIN PB2     // OUT: 1 -  "-" 
#define YELLOW1_PIN PB0     // OUT: 1 -  "-" 
#define GREEN_PIN   PB4     // OUT: 1 - "-" , 0 - "-" , IN -  , ,  (!) 

#define BUTTON_ON  !(PINB &amp; _BV(BUTTON))    //( (PINB &amp; _BV(BUTTON)) == 0)  //  " "
#define BUTTON_OFF  (PINB &amp; _BV(BUTTON))    // ~(PINB &amp; _BV(BUTTON)) -\\- " "

#define RED     _BV(RED_PIN)            // _BV -     (), 1&lt;&lt;VALUE
#define YELL0   _BV(YELLOW0_PIN)        //
#define YELL1   _BV(YELLOW1_PIN)
#define GREEN   _BV(GREEN_PIN)

//       lightSignalization traffic_signals[]
#define LIGHT_NUM_YELLOW_FLASH  8       //       -  - flash yellows lights
#define LIGHT_NUM_STD_START     0       //       
#define LIGHT_NUM_LIGHTS_OFF    9       //      -   - traffic lights off
#define LIGHT_NUM_STD_MASK      7       // ___++ &amp;LIGHT_NUM_STD_MASK -    0  7   

//....................................  
// 
const lightSignalization traffic_signals[] PROGMEM= {   //   ,  ,   -, PINS === 0 0 0 g r y0 btt y1
 // {DDRB0, PORTB0,   DDRB_flashing, PORTB_flasinf (if flashing),   continuous of half-period flashing,   continuous id mode running}
    {RED|GREEN, RED,   0, 0,   0, PERIOD_0},                    // R G R G
    {RED, RED,  RED|GREEN, RED,   QT_SECOND, PERIOD_1},     // R g R g - flash east green
    {RED|YELL1, RED|YELL1,   0, 0,   0, PERIOD_2 },             // R Y1 R Y1
    {RED|YELL0|YELL1, RED|YELL0|YELL1,  0, 0,   0, PERIOD_3 },  // RY0 Y1 RY0 Y1
    {RED|GREEN, GREEN,   0, 0,   0, PERIOD_4},                  // G R G R
    {RED|GREEN, GREEN,   RED, 0,    QT_SECOND, PERIOD_5 },      // g R g R - flash nord green
    {RED|YELL0, YELL0,   0, 0,   0, PERIOD_6},                  // Y0 R Y0 R
    {RED|YELL0|YELL1,  YELL0|YELL1,   0, 0,   0, PERIOD_7  },   // Y0 RY1 Y0 RY1

    {YELL0|YELL1, YELL0|YELL1,   YELL0|YELL1, 0,  ONE_SECOND, 0},   // y0 y1 y0 y1 - flash yellows lights 
    {0, 0,   0, 0,   0, 0}              //  traffic lights off, 
};

volatile uint16_t  globalTimer;     //     64   
uint8_t current_signal;     // 1    ,   traffic_signals
uint16_t tl_flash_end;      // 2       ( !0), 
uint16_t tl_signal_end;     // 2            ( !0)

//....................................  
void setPeriods(uint8_t num, bool set_both_flash_and_signal);   //  tl_flash_end, tl_signal_end
void setPorts(uint8_t num, bool use_main_values);               //    

//....................................  
//
//  -    globalTimer  1/37 
ISR(TIM0_OVF_vect){
    globalTimer++;  //       . ,   while(1)   .
}

int main() {
//
bool use_main_values = true;            // lightSignalization._val_0 (1)  lightSignalization._val_1 (0)? -  
current_signal = LIGHT_NUM_STD_START;   //   .     .

    //     "  -". 
    set_sleep_mode(SLEEP_MODE_IDLE);    //   - .
    sleep_enable();                 //    

    TCCR0B = _BV(CS02) | _BV(CS00); //  0 - clock frequency / 1024
    TIMSK0 |= _BV(TOIE0);           //      overflow interrupt

    sei();      //    
    while(1){
        //   ? 
        if(globalTimer &gt; MAX_GLOBAL_TIMER_VALUE){
            globalTimer -= MAX_GLOBAL_TIMER_VALUE;          //   
            // 
            if(tl_flash_end){
                tl_flash_end -= MAX_GLOBAL_TIMER_VALUE;     //   ,  
            }
            if(tl_signal_end){
                tl_signal_end -= MAX_GLOBAL_TIMER_VALUE;    // //   ,  
            }
            // setPeriods(currentMode, false); //   12  ,  tl_.._end   ,     
        }

                //      (tl_flash_end !=0 )
        if(tl_flash_end){
            //     
            if(globalTimer &gt; tl_flash_end){
                use_main_values = !use_main_values;             // !use_main_values -      ))
                setPorts(current_signal, use_main_values);      //      
                setPeriods(current_signal, false);              //     ,   
            }
        }

        //         -    operating_std     - --
        if(tl_signal_end){
            //       (use_main_values -       -  )
            if((globalTimer &gt; tl_signal_end)  &amp;&amp; use_main_values){
                current_signal ++;                          //   
                current_signal &amp;= LIGHT_NUM_STD_MASK;       //    3-,        0  7
                use_main_values = true;                     //  -    
                setPorts(current_signal, use_main_values);  //        
                setPeriods(current_signal, true);           //       
            }
        }

        sleep_cpu();    //      -   .
    }
}

    //   
 void setPorts(uint8_t num, bool use_main_values){
    uint8_t val;
    DDRB = 0; PORTB = 0;
    //    () - ddr_val_0, else = ddr_val_1
//  val = (use_main_values) ? pgm_read_byte_near(&amp;(traffic_signals[num].ddr_val_0))
//                          : pgm_read_byte_near(&amp;(traffic_signals[num].ddr_val_1));

    //   ,  , ,  ,   ,   14 (!!!)   .
    val = pgm_read_byte_near(&amp;(traffic_signals[num].ddr_val_0)+( (use_main_values) ? 0 : 2) ); 
    val &amp;= ~_BV(BUTTON);    //     - 
    DDRB = val;             //    

    val = (use_main_values) ? pgm_read_byte_near(&amp;(traffic_signals[num].port_val_0)) 
                            : pgm_read_byte_near(&amp;(traffic_signals[num].port_val_1));
    val|= _BV(BUTTON);  //     -  -    
    PORTB = val;        //      
}

 //     ( 
void setPeriods(uint8_t num, bool set_both_flash_and_signal){
//  
    tl_flash_end = pgm_read_word_near (&amp;(traffic_signals[num].flash_period));   //  
    tl_flash_end = (tl_flash_end)? tl_flash_end + globalTimer : 0;  //    -      
    //if(tl_flash_end){         tl_flash_end += globalTimer;    } &lt;-     8  

    //     -    
    if(set_both_flash_and_signal){
        tl_signal_end = pgm_read_word_near(&amp;(traffic_signals[num].signal_period));  
        tl_signal_end = (tl_signal_end)? tl_signal_end + globalTimer : 0;           //     ,    
    }
}

//Program size: 610 bytes (used 60% of a 1 024 byte maximum) (0,58 secs)
//Minimum Memory Usage: 7 bytes (11% of a 64 byte maximum)</code></pre></div></div><br>
<h4 id="slozhnaya-logika-prostoy-knopki">   </h4><br>
<p>     ,          .         ‚Äî   btn_cnt (     ),    (        )               .</p><br>
<pre><code class="cpp">#define PERIOD_PRESS_BUTTON_SHORT   QT_SECOND           //      -  
#define PERIOD_PRESS_BUTTON_LONG    QT_SECOND*6         //      - /
uint8_t scan_button_cnt;    //    
        //  
        if(BUTTON_ON){
            if(scan_button_cnt&lt;USHRT_MAX){
                scan_button_cnt++;      //   1/37     
            }
            if(scan_button_cnt &gt; PERIOD_PRESS_BUTTON_SHORT){
                    // ,     
            }
            if(scan_button_cnt &gt; PERIOD_PRESS_BUTTON_LONG){
                    //     
            }
        }
</code></pre><br>
<p>    ‚Äî      .</p><br>
<p><img src="https://habrastorage.org/webt/fe/k6/6_/fek66_j4lcziqglnpmyudph1ujc.jpeg"></p><br>
<p>     SLEEP_MODE_IDLE (     CPU),   PwrDown    SLEEP_MODE_PWR_DOWN ‚Äî         <del>  </del>   watchdog     INT0,   ,     ‚Äî      INT0.</p><br>
<p><img src="https://habrastorage.org/webt/0w/82/0k/0w820klrlwg0enib-pznejydfp0.png"></p><br>
<p> <abbr title=""></abbr>      .   7.Power management and sleep modes   ATtiny13  ,      5-10 ,          . </p><br>
<p>             8- ,    ‚Äî 2        . </p><br>
<pre><code class="cpp">//  uint8_t f_button_state_flags;       //        

//      MODES:  wakeup 11 -&gt; work 00 -&gt; tosleep 01 -&gt; pwrdown 11 -&gt; wakeup 11
#define MODE_LBIT 0
#define MODE_HBIT 1
#define FORCE_SET_NEW_SIGNAL_BIT        2   //             current_signal
//    3
#define LIGHT_SIGNAL_ALT_MODE_BIT       4   // =0 (--)  =1 ( )   
#define USE_FIRST_VALUES_LIGHT_BIT      5   //     -  lightSignalization  
#define SHORT_PRESS_FLAG_BIT    6   // , 1       
#define LONG_PRESS_FLAG_BIT     7 // , 1       </code></pre><br>
<p> ,       ‚Äî    ,    ‚Äî   CPU     .          ,         if-.</p><br>
<div class="spoiler"><b class="spoiler_title">   </b><div class="spoiler_text"><pre><code class="cpp">#include &lt;limits.h&gt;         // USHRT_MAX
#include &lt;avr/io.h&gt;         //     IDE
#include &lt;avr/sleep.h&gt;      // ,     
#include &lt;avr/interrupt.h&gt;  //   
#include &lt;avr/pgmspace.h&gt;   //    

#ifdef GIMSK    //  ATtiny13 -       
#define F_CPU 9600000UL     //      ,   
#define ONE_SECOND  37      //     1 
#define QT_SECOND   9       //  
// GIMSK &amp;= ~_BV(INT0); -   INT0  
#define DISABLE_EXTERNAL_INT0   GIMSK &amp;= ~(_BV(INT0)); GIFR  &amp;= ~(_BV(INTF0))   //EIMSK/EIFR  
//GIMSK |= _BV(INT0) -   INT0
#define ENABLE_EXTERNAL_INT0    GIMSK |= _BV(INT0)  ; GIFR  &amp;= ~(_BV(INTF0))
#else           // 328 -   
#define F_CPU 16000000UL
#define ONE_SECOND  64      //     1  - .   
#define QT_SECOND   16      //  
// 328 INT0 -  PD2...     ,       (,  ),            
#define DISABLE_EXTERNAL_INT0   EIMSK &amp;= ~(_BV(INT0)); EIFR  &amp;= ~(_BV(INTF0)) 
// ,   -  EICRA - ISC00-ISC01 == 00, lo level, EIMSK - INT0, EIFR-INTF0  
#define ENABLE_EXTERNAL_INT0    EIMSK |= _BV(INT0)  ; EIFR  &amp;= ~(_BV(INTF0))
#endif

#define MAX_GLOBAL_TIMER_VALUE  (USHRT_MAX / 2)     // uint16_t globalTimer -   . 65535 /2 
//     ,  MAX_GLOBAL_TIMER_VALUE - 1
#define PERIOD_PRESS_BUTTON_SHORT   QT_SECOND/2         //      ( - ) -  
#define PERIOD_PRESS_BUTTON_LONG    QT_SECOND*4         //      - /
#define PERIOD_FLASH_GREEN          QT_SECOND           //     ( ) -    
#define PERIOD_FLASH_YELLOW         ONE_SECOND * 1      //     -    - 

                                            //  --- 
#define PERIOD_0        ONE_SECOND * 5      // R G R G  0.  ---   (5 )
#define PERIOD_1        ONE_SECOND * 3      //R g R g   1.  ---   (3 )     
#define PERIOD_2        ONE_SECOND * 1      //R Y R Y   2.  ---  (1 )
#define PERIOD_3        ONE_SECOND * 2      //RY Y RY Y 3. + ---  (2 ) 
#define PERIOD_4        ONE_SECOND * 7      // G R G R  4.  ---   (7 )
#define PERIOD_5        ONE_SECOND * 3      //g R g R   5.   --- (3 )
#define PERIOD_6        ONE_SECOND * 1      //Y R Y R   6.  ---  (1 )
#define PERIOD_7        ONE_SECOND * 2      //Y RY Y RY 7.  --- + (2 )

//  /  .     -     
typedef struct{
    const uint8_t ddr_val_0;    // DDRB value    
    const uint8_t port_val_0;   // PORTB value  
    const uint8_t ddr_val_1;    // DDRB value    
    const uint8_t port_val_1;   // PORTB value
    const uint16_t flash_period;    // period of flashing -   _val_1  _val_0 ( =0,  )
    const uint16_t signal_period;   // period of this lighting state ( =0,       )
}lightSignalization;            //   , _0  _1 -   , flash_long -   

//    (PINS === 0 0 0 g r y0 btt y1):
 //     ""     
#define BUTTON_PIN  PB1     // ,   INT0. ,   ,  = LOW
#define RED_PIN     PB3     // OUT: 1 - "-" , 0 - "-" , IN -  , ,  (!) 
#define YELLOW0_PIN PB2     // OUT: 1 -  "-" 
#define YELLOW1_PIN PB0     // OUT: 1 -  "-" 
#define GREEN_PIN   PB4     // OUT: 1 - "-" , 0 - "-" , IN -  , ,  (!) 

#define BUTTON_ON  !(PINB &amp; _BV(BUTTON_PIN))    //( (PINB &amp; _BV(BUTTON)) == 0)  //  " "
#define BUTTON_OFF  (PINB &amp; _BV(BUTTON_PIN))    // ~(PINB &amp; _BV(BUTTON)) -\\- " "

#define RED     _BV(RED_PIN)            // _BV -     (), 1&lt;&lt;VALUE
#define YELL0   _BV(YELLOW0_PIN)        //    -
#define YELL1   _BV(YELLOW1_PIN)
#define GREEN   _BV(GREEN_PIN)          //    - (  0 -   -)  DDR=1

//      lightSignalization traffic_signals[]
#define LIGHT_NUM_YELLOW_FLASH  8       //       ( ) -  - flash yellows lights
#define LIGHT_NUM_STD_START     0       //        (--)
#define LIGHT_NUM_LIGHTS_OFF    9       //      -   - traffic lights off
#define LIGHT_NUM_START_SHOW    10      //         
#define LIGHT_NUM_ERR           11      //   -     

#define MASK_LIGHT_NUM_STD      7       // ___++ &amp;= LIGHT_NUM_STD_MASK -    0  7   

//....................................  
// 
const lightSignalization traffic_signals[] PROGMEM= {   //   ,  ,   -, PINS === 0 0 0 g r y0 btt y1
 // {DDRB0, PORTB0,   DDRB_flashing, PORTB_flasinf (if flashing),   continuous of half-period flashing,   continuous id mode running}
    {RED|GREEN, RED,   0, 0,   0, PERIOD_0},                    // R G R G
    {RED, RED,  RED|GREEN, RED,   QT_SECOND, PERIOD_1},         // R g R g - flash east green
    {RED|YELL1, RED|YELL1,   0, 0,   0, PERIOD_2 },             // R Y1 R Y1
    {RED|YELL0|YELL1, RED|YELL0|YELL1,  0, 0,   0, PERIOD_3 },  // RY0 Y1 RY0 Y1
    {RED|GREEN, GREEN,   0, 0,   0, PERIOD_4},                  // G R G R
    {RED|GREEN, GREEN,   RED, 0,    QT_SECOND, PERIOD_5 },      // g R g R - flash nord green
    {RED|YELL0, YELL0,   0, 0,   0, PERIOD_6},                  // Y0 R Y0 R
    {RED|YELL0|YELL1,  YELL0|YELL1,   0, 0,   0, PERIOD_7  },   // Y0 RY1 Y0 RY1

    {YELL0|YELL1, YELL0|YELL1,   YELL0|YELL1, 0,  ONE_SECOND, 0},   // y0 y1 y0 y1 - flash yellows lights 
    {0, 0,   0, 0,   0, 0},             //  traffic lights off, 
    {RED|GREEN|YELL0, RED|YELL0,   RED|GREEN|YELL1, GREEN|YELL1,   1, PERIOD_2},        //  PERIOD_2  -      ,     

    {YELL0|GREEN, YELL0,   YELL1|GREEN, YELL1|GREEN,  1, 0}     //  -     
};

volatile uint16_t  globalTimer; //      64   
uint8_t scan_button_cnt;        //      
uint16_t tl_flash_end;          // 2       ( !0), 
uint16_t tl_signal_end;         // 2            ( !0) 
uint8_t f_button_state_flags;   // 1,        
// , 8    

#pragma region bits_of_f_button_state_flags 
    //      MODES:  wakeup 11 -&gt; work 00 -&gt; tosleep 01 -&gt; pwrdown 11 -&gt; wakeup 11
#define MODE_LBIT 0
#define MODE_HBIT 1
#define MODE_VALUE          ( f_button_state_flags &amp; 3 )    //  -   MODE_
#define SET_MODE_WORK       f_button_state_flags &amp;= ~(_BV(MODE_HBIT) );  f_button_state_flags &amp;= ~(_BV(MODE_LBIT) );// 00 - work
//  f_button_state_flags &amp;= ~( _BV(MODE_HBIT) | _BV(MODE_LBIT) ) -    ,  
#define MODE_WORK_VALUE     0
#define SET_MODE_TOSLEEP    f_button_state_flags &amp;= ~(_BV(MODE_HBIT)); f_button_state_flags |= _BV(MODE_LBIT)   // 01 - tosleep
#define MODE_TOSLEEP_VALUE  1
#define SET_MODE_PWRDOWN    f_button_state_flags |= _BV(MODE_HBIT); f_button_state_flags &amp;= ~(_BV(MODE_LBIT))   // 10 - pwrdown 
#define MODE_PWRDOWN_VALUE  2
#define SET_MODE_WAKEUP     f_button_state_flags |= _BV(MODE_HBIT); f_button_state_flags |= _BV(MODE_LBIT)      // 11 - wakeup  
#define MODE_WAKEUP_VALUE   3

#define FORCE_SET_NEW_SIGNAL_BIT        2   //             current_signal
#define IF_FORCE_SET_SIGNAL_FLAG        ( f_button_state_flags &amp; _BV(FORCE_SET_NEW_SIGNAL_BIT) )    // IF_ -    
#define SET_FORCE_SET_SIGNAL_FLAG       f_button_state_flags |=  _BV(FORCE_SET_NEW_SIGNAL_BIT)      // SET_ -    1
#define RES_FORCE_SET_SIGNAL_FLAG       f_button_state_flags &amp;= ~( _BV(FORCE_SET_NEW_SIGNAL_BIT) )  // RES_ -    0

//  3   

#define LIGHT_SIGNAL_ALT_MODE_BIT       4   // =0 (--)  =1 ( )   
#define IF_LIGHT_SIGNAL_ALT_MODE_FLAG   ( f_button_state_flags &amp; _BV(LIGHT_SIGNAL_ALT_MODE_BIT) )   //1( )  0(--)   ?
#define SET_LIGHT_SIGNAL_ALT_MODE_FLAG  f_button_state_flags |=  _BV(LIGHT_SIGNAL_ALT_MODE_BIT)
#define RES_LIGHT_SIGNAL_ALT_MODE_FLAG  f_button_state_flags &amp;= ~( _BV(LIGHT_SIGNAL_ALT_MODE_BIT) )
#define FLIP_LIGHT_SIGNAL_ALT_MODE_FLAG f_button_state_flags ^= _BV(LIGHT_SIGNAL_ALT_MODE_BIT)

#define USE_FIRST_VALUES_LIGHT_BIT      5   //     -  lightSignalization  
#define IF_USE_FIRST_VALUES_LIGHT_FLAG  (f_button_state_flags &amp; _BV(USE_FIRST_VALUES_LIGHT_BIT)) // lightSignalization._val_0 (1)  lightSignalization._val_1 (0)? -  
#define SET_USE_FIRST_VALUES_LIGHT_FLAG     f_button_state_flags |= _BV(USE_FIRST_VALUES_LIGHT_BIT)
#define RES_USE_FIRST_VALUES_LIGHT_FLAG     f_button_state_flags &amp;= ~( _BV(USE_FIRST_VALUES_LIGHT_BIT))
#define FLIP_USE_FIRST_VALUES_LIGHT_FLAG    f_button_state_flags ^= _BV(USE_FIRST_VALUES_LIGHT_BIT)     //  

#define SHORT_PRESS_FLAG_BIT    6   // , 1       
#define IF_SHORT_PRESS_FLAG     ( f_button_state_flags &amp; _BV(SHORT_PRESS_FLAG_BIT) )        // -   == 1
#define SET_SHORT_PRESS_FLAG    f_button_state_flags |= _BV(SHORT_PRESS_FLAG_BIT)
#define RES_SHORT_PRESS_FLAG    f_button_state_flags &amp;= ~(_BV(SHORT_PRESS_FLAG_BIT))

#define LONG_PRESS_FLAG_BIT     7 // , 1       
#define IF_LONG_PRESS_FLAG      ( f_button_state_flags &amp; _BV(LONG_PRESS_FLAG_BIT) )     // -   == 1
#define SET_LONG_PRESS_FLAG     f_button_state_flags |= _BV(LONG_PRESS_FLAG_BIT)
#define RES_LONG_PRESS_FLAG     f_button_state_flags &amp;= ~(_BV(LONG_PRESS_FLAG_BIT))
#pragma endregion

//....................................  
void setPeriods(uint8_t num, bool set_both_flash_and_signal);   //  tl_flash_end, tl_signal_end
void setPorts(uint8_t num, bool use_main_values);               //    
void inline init_timer_clock(){     //     
#ifdef GIMSK    //  ATtiny13 - 
    TCCR0B = _BV(CS02) | _BV(CS00); //  0 - clock frequency / 1024
    TIMSK0 |= _BV(TOIE0);           //      overflow interrupt
#else           //   , 328/16
    // 100 - prescaler 64; Foverflow = 16M/64*256 ~=976.56Hz,
    TCCR2B = (1&lt;&lt;CS22) | (1&lt;&lt;CS21) | (1&lt;&lt;CS20) ;  // 111 - CLK/1024, 16M/1024*254 - 1/64 
    TIMSK2 |=(1&lt;&lt;TOIE0);  // interrupt ovfl enable
    //Serial.begin(115200);
#endif
}

//....................................  
//
//  -  -    globalTimer  1/37 
#ifdef GIMSK    //  ATtiny13
ISR(TIM0_OVF_vect){
    globalTimer++;  //       . ,   while(1)   .
}
#else
//   0 -     , -   - -     2
ISR(TIMER2_OVF_vect){
    globalTimer++;
}
#endif
//   -    (,  ,    0)
ISR(INT0_vect){
    DISABLE_EXTERNAL_INT0;
    SET_MODE_WAKEUP;        //      POWER DOWN
    globalTimer = 0;        //  -  
    scan_button_cnt = 0;    //   
    RES_SHORT_PRESS_FLAG;   //
    RES_LONG_PRESS_FLAG;    //  
}

/*
//   - 
void inline dbg(){
    DDRB |= YELL0; PORTB ^= YELL0;
}
*/

//....................................  
//
int main() {
    uint8_t current_signal;             // 1    ,   traffic_signals

#pragma region Initialisation&amp;setup
    //     "  -". 
    set_sleep_mode(SLEEP_MODE_IDLE);    //   - .
    sleep_enable();             //    

    init_timer_clock();         //     

    globalTimer = 0;            //  -  
    SET_MODE_WORK;              //    
    SET_USE_FIRST_VALUES_LIGHT_FLAG;    //  
    scan_button_cnt = 0;        //   

    //       
    current_signal = LIGHT_NUM_START_SHOW;  //     -   /
    SET_FORCE_SET_SIGNAL_FLAG;              //    current_signal

    sei();      //    

#pragma endregion
    while(1){

#pragma region TimerOVF
        //   ? 
        if(globalTimer &gt; MAX_GLOBAL_TIMER_VALUE){
            globalTimer -= MAX_GLOBAL_TIMER_VALUE;          //   
            // 
            if(tl_flash_end){
                tl_flash_end -= MAX_GLOBAL_TIMER_VALUE;     //   ,  
            }
            if(tl_signal_end){
                tl_signal_end -= MAX_GLOBAL_TIMER_VALUE;    // //   ,  
            }
            // setPeriods(currentMode, false); //   12  ,  tl_.._end   ,     
        }
#pragma endregion

#pragma region ButtonState
        //  
        if(BUTTON_ON){
            if(scan_button_cnt &lt; USHRT_MAX){
                scan_button_cnt++;              //   1/37     
            }
            //   -  ,    
            if(scan_button_cnt &gt; PERIOD_PRESS_BUTTON_SHORT){
                SET_SHORT_PRESS_FLAG;       // ,     , 
            }
            if(scan_button_cnt &gt; PERIOD_PRESS_BUTTON_LONG){
                SET_LONG_PRESS_FLAG;        //     
            }
        }
#pragma endregion
#pragma region LightWorkLogic
        //      (tl_flash_end !=0 )
        if(tl_flash_end){
            //     
            if(globalTimer &gt; tl_flash_end){
                FLIP_USE_FIRST_VALUES_LIGHT_FLAG;               // !use_main_values -      ))
                setPorts(current_signal, IF_USE_FIRST_VALUES_LIGHT_FLAG);       //      
                setPeriods(current_signal, false);          //     ,   
            }
        }

        //         
        // -    operating_std     - -- 
        //    ,   +1   7
        if(tl_signal_end){
            //       (use_main_values -       -  )
            if((globalTimer &gt; tl_signal_end)  &amp;&amp; IF_USE_FIRST_VALUES_LIGHT_FLAG){
                current_signal ++;                          //   
                current_signal &amp;= MASK_LIGHT_NUM_STD;       //    3-,        0  7
                SET_FORCE_SET_SIGNAL_FLAG;      //    current_signal
            }
        }
#pragma endregion

#pragma region MODE_VALUELogic
        //   , 2  f_button_state_flags
        //? MODE_VALUE === pwrdown -&gt; wakeup -&gt; work -&gt; tosleep -&gt; pwrdown
        switch (MODE_VALUE){
        case (MODE_WAKEUP_VALUE):
            set_sleep_mode(SLEEP_MODE_IDLE);        //  !
            //   ,       - IF_BUTTON_LONG_FLAG
            if(IF_LONG_PRESS_FLAG){
                //      ?   !
                if(current_signal == LIGHT_NUM_LIGHTS_OFF){
                    //          ? LIGHT_NUM_ERR
                    current_signal = (IF_LIGHT_SIGNAL_ALT_MODE_FLAG) ? LIGHT_NUM_YELLOW_FLASH : LIGHT_NUM_STD_START;
                    SET_FORCE_SET_SIGNAL_FLAG;      //    current_signal
                }
            }
            //,  ...
            if(BUTTON_OFF){
                //      ,   
                if(IF_LONG_PRESS_FLAG){
                    SET_MODE_WORK;
                }else{  
                    //  , ,   ,  
                    SET_MODE_PWRDOWN;   //        
                }
                scan_button_cnt = 0;    //       
                RES_SHORT_PRESS_FLAG;   //   , 
                RES_LONG_PRESS_FLAG;
            }
            break;

        case (MODE_WORK_VALUE):
            //  ?
            if(scan_button_cnt &gt; 0){
                //   ?
                if(IF_LONG_PRESS_FLAG){
                    current_signal = LIGHT_NUM_LIGHTS_OFF;      //  
                    SET_FORCE_SET_SIGNAL_FLAG;                  //   -   " "
                    SET_MODE_TOSLEEP;                           //   !
                }
                // ? 
                if(BUTTON_OFF){
                    //     ?
                    if(IF_SHORT_PRESS_FLAG){
                        FLIP_LIGHT_SIGNAL_ALT_MODE_FLAG;    //     
                        current_signal = (IF_LIGHT_SIGNAL_ALT_MODE_FLAG) ? LIGHT_NUM_YELLOW_FLASH : LIGHT_NUM_STD_START; //    . 
                        SET_FORCE_SET_SIGNAL_FLAG;          //      current_signal
                    }
                    scan_button_cnt=0;
                    RES_SHORT_PRESS_FLAG; //    
                    RES_LONG_PRESS_FLAG;
                }
            }
            break;

        case (MODE_TOSLEEP_VALUE):
            //    -    .
            if(BUTTON_OFF){
                SET_MODE_PWRDOWN;       //    
            }
            break;

        case (MODE_PWRDOWN_VALUE):
            // !  , !  ?
            if(BUTTON_ON){
                set_sleep_mode(SLEEP_MODE_IDLE);
                SET_MODE_WAKEUP;
            }else{  
                //  ?  .
                scan_button_cnt = 0;
                RES_LONG_PRESS_FLAG;
                RES_SHORT_PRESS_FLAG;
                current_signal = LIGHT_NUM_LIGHTS_OFF;      // 
                SET_FORCE_SET_SIGNAL_FLAG;
                set_sleep_mode(SLEEP_MODE_PWR_DOWN);    //    -   while(1)
                ENABLE_EXTERNAL_INT0;                   //     
            }
            break;

        default:
            //!       -    .  -      
            current_signal = LIGHT_NUM_ERR;
            SET_FORCE_SET_SIGNAL_FLAG;
            //setPorts(current_signal,true);
            //setPeriods(current_signal,true);
            break;
        }
#pragma endregion

        //   ,      - ?
        if(IF_FORCE_SET_SIGNAL_FLAG){       //       current_signal
            RES_FORCE_SET_SIGNAL_FLAG;      //  
            SET_USE_FIRST_VALUES_LIGHT_FLAG;    //   -   0-   -
            setPorts(current_signal, IF_USE_FIRST_VALUES_LIGHT_FLAG);   //      #current_signal  
            setPeriods(current_signal, true);
        }

        //    1/37 . , ,  .
        sleep_cpu();    //       -   .
        }
}

//.................................... 
//
//    
 void setPorts(uint8_t num, bool  use_main_values){
    uint8_t val;
    DDRB = 0; PORTB = 0;
    //    () - ddr_val_0, else = ddr_val_1
//  val = (use_main_values) ? pgm_read_byte_near(&amp;(traffic_signals[num].ddr_val_0))
//                          : pgm_read_byte_near(&amp;(traffic_signals[num].ddr_val_1));

    //   ,    ,  ,   ,   14 (!!!)   .
    val = pgm_read_byte_near(&amp;(traffic_signals[num].ddr_val_0)+( (use_main_values) ? 0 : sizeof(uint8_t)*2 ) ); 

    val &amp;= ~_BV(BUTTON_PIN);    //    ,    - 
    DDRB = val;                 //    

    val = (use_main_values) ? pgm_read_byte_near(&amp;(traffic_signals[num].port_val_0)) 
                            : pgm_read_byte_near(&amp;(traffic_signals[num].port_val_1));
    val|= _BV(BUTTON_PIN);  //     -  -    
    PORTB = val;        //      
}

 //     (    )
void setPeriods(uint8_t num, bool set_both_flash_and_signal){
//  
    tl_flash_end = pgm_read_word_near (&amp;(traffic_signals[num].flash_period));   //  
    tl_flash_end = (tl_flash_end)? tl_flash_end + globalTimer : 0;  //    -      
    //if(tl_flash_end){         tl_flash_end += globalTimer;    } &lt;-     8  

    //     -    
    if(set_both_flash_and_signal){
        tl_signal_end = pgm_read_word_near(&amp;(traffic_signals[num].signal_period));  
        tl_signal_end = (tl_signal_end)? tl_signal_end + globalTimer : 0;           //     ,    
    }
}
//Program size: 976 bytes (used 95% of a 1 024 byte maximum) (0,83 secs)
//Minimum Memory Usage: 8 bytes (13% of a 64 byte maximum)</code></pre></div></div><br>
<p><em>Program size: 976 bytes (used 95% of a 1 024 byte maximum) (0,83 secs)<br>
Minimum Memory Usage: 8 bytes (13% of a 64 byte maximum)</em></p><br>
<p>.</p><br>
<p>    <del>  </del>      ATtiny13 .</p><br>
<h3 id="anatomiya--samshitovo-samannogo-svetofora"> - </h3><br>
<p>  (    ?)   .   ‚Äî   .           ,    ,  ,   .  ,     ,    .</p><br>
<div class="spoiler"><b class="spoiler_title">,  </b><div class="spoiler_text"><h4 id="mozgi"></h4><br>
<p> DipTrace       ¬´¬ª      ¬´PCB Layout¬ª,     .        ,    . </p><br>
<p><img src="https://habrastorage.org/webt/0j/vq/ag/0jvqagommqperqd6t4vsqpuywbg.png"></p><br>
<p>   ‚Äî       .</p><br>
<p><img src="https://habrastorage.org/webt/ye/zr/b0/yezrb07pnfknal2yrkkkt8z24ew.jpeg"></p><br>
<p>,           ,    .</p><br>
<p>              (      ,      80-    ).</p><br>
<p><img src="https://habrastorage.org/webt/a-/vw/zq/a-vwzqrzc8ttmxfyidyx5gku_e0.jpeg"></p><br>
<p>       CD .</p><br>
<p><img src="https://habrastorage.org/webt/be/84/yr/be84yr9lcf5qr9xmhfubcc0xi-q.jpeg"></p><br>
<p>  , ,  ,  .</p><br>
<p><img src="https://habrastorage.org/webt/4w/4p/ed/4w4pedh-im9ttbm6uhngc24vpge.jpeg"></p><br>
<p>  ‚Äî    .</p><br>
<p><strong></strong>: <em>        ,                 </em>.</p><br>
<p> ,  ,             .    ‚Äî   ,    .</p><br>
<p><img src="https://habrastorage.org/webt/wd/mv/p_/wdmvp_puf54uysk-0og-9lhogvk.jpeg"></p><br>
<h4 id="vnutrennosti"></h4><br>
<p>       ‚Äî  .  -  - "Craft&amp;Clay" 50-     70.    ,        .</p><br>
<p><img src="https://habrastorage.org/webt/v2/jw/q6/v2jwq6mmb4gvxkpljgamjqavhj4.jpeg"></p><br>
<p>          .</p><br>
<p><img src="https://habrastorage.org/webt/w9/jf/8f/w9jf8f1ze2h5lytg9rgy0c4yy8s.jpeg"></p><br>
<p>       15     130   .</p><br>
<p><img src="https://habrastorage.org/webt/a4/uf/n-/a4ufn-djsbpg3386o4pvqqcpjua.jpeg"></p><br>
<p>      ‚Äî    .</p><br>
<p><img src="https://habrastorage.org/webt/ud/tf/nz/udtfnznphbnuq_wmaap31rafnuq.jpeg"></p><br>
<p><img src="https://habrastorage.org/webt/ex/7j/xb/ex7jxbgh1bhqsmzbep9t9fnrije.jpeg"></p><br>
<p>   ‚Äî    .</p><br>
<p><img src="https://habrastorage.org/webt/5i/qs/1v/5iqs1v1pa6jqhnmjjfyuxmcqhgy.jpeg"></p><br>
<p>  ‚Äî     .</p><br>
<p><img src="https://habrastorage.org/webt/8l/hs/8x/8lhs8xpxud7pcd-w9ixy-qg-9a0.jpeg"></p><br>
<p>     .</p><br>
<p><img src="https://habrastorage.org/webt/xj/se/tn/xjsetne6jay2dlqlk_3mgsq4ica.jpeg"></p><br>
<p>  4     ,   2-3  , <br>
  ,      .</p><br>
<p><img src="https://habrastorage.org/webt/xu/6y/pl/xu6yplqtnq8o2yhdtj2cyjcbd3e.jpeg"></p><br>
<p>  .  , ,   ,  "   ". </p><br>
<p><img src="https://habrastorage.org/webt/ck/w7/id/ckw7idpowfs9zlrxpok7gqrhsso.jpeg"></p><br>
<p>,          . </p><br>
<p><img src="https://habrastorage.org/webt/wo/jn/rj/wojnrj1diuqw5hf8h56sxjdxyzs.jpeg"></p><br>
<p>       KSP.        ‚Äî    4  LED     5     .</p><br>
<p><img src="https://habrastorage.org/webt/kg/f7/qy/kgf7qyhiebdqb5seavzrvekyqaq.jpeg"></p><br>
<p>                ,    ,   DC-DC 0.9-5  ,     .</p><br>
<p><img src="https://habrastorage.org/webt/ol/5v/bz/ol5vbz1tlc-lmcmuczwf77obixc.jpeg"></p><br>
<p>     .  ,    ,         .</p><br>
<p><img src="https://habrastorage.org/webt/fb/jf/8-/fbjf8-u-p8gjm2u3ccnwfk9wzdk.jpeg"></p><br>
<h4 id="ozhivlenie"></h4><br>
<p>, ,  ,   .</p><br>
<p><img src="https://habrastorage.org/webt/wm/8v/ej/wm8vejbxienobpdzeretpbxp3yi.jpeg"></p><br>
<p>      ISP     10-   .</p><br>
<p><img src="https://habrastorage.org/webt/tn/eu/7u/tneu7uxc7bewhl9g_lfsajgx9ra.png"></p></div></div><br>
<h3 id="izuchenie-zhiznedeyatelnosti-svetofora">  </h3><br>
<p>     , ,  ,  -   .        ,     ,      "  ".      1.5 ,         ‚Äî   .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">  </a>     ,      .</p><br>
<table>
<thead>
<tr>
<th> </th>
<th>, </th>
<th>, %/</th>
<th> , </th>
</tr>
</thead>
<tbody>
<tr>
<td>CR1212</td>
<td>18</td>
<td>1</td>
<td>0.250</td>
</tr>
<tr>
<td>CR1620</td>
<td>68</td>
<td>1</td>
<td>0.950</td>
</tr>
<tr>
<td>CR2032</td>
<td>210</td>
<td>1</td>
<td>3</td>
</tr>
<tr>
<td>NiCD AAA</td>
<td>350</td>
<td>20</td>
<td>98</td>
</tr>
<tr>
<td>NiMH AAA</td>
<td>900</td>
<td>30</td>
<td>375</td>
</tr>
<tr>
<td>NiCd AA</td>
<td>1000</td>
<td>20</td>
<td>270</td>
</tr>
<tr>
<td>Alkaline AAA</td>
<td>1250</td>
<td>2</td>
<td>35</td>
</tr>
<tr>
<td>NiMH AA</td>
<td>2400</td>
<td>30</td>
<td>1000</td>
</tr>
<tr>
<td><strong>Alkaline AA</strong></td>
<td><strong>2890</strong></td>
<td><strong>2</strong></td>
<td><strong>80</strong></td>
</tr>
<tr>
<td>Li-Ion</td>
<td>4400</td>
<td>10</td>
<td>600</td>
</tr>
</tbody>
</table><br>
<p>     ,      . ,    ,     (2/100)<em>2890/(24</em>30) = 80 .  ,    2    ,  32      ATtiny13.</p><br>
<p>         :       ,    GPIO,      .    ‚Äî ,        ( 4   14   ""),      ,        40 . </p><br>
<p>,        ‚Äî    .      ,      .  ,      :      5      DC-DC ,   ,          DC-DC      1.5  -&gt; 5 .        , -       +-20%,   .</p><br>
<p><img src="https://habrastorage.org/webt/ab/3v/sb/ab3vsbnwkhp2rc9tvyzv6ltyypy.png"></p><br>
<p>  ,     ""   4-5 (5 ) ,    , 25 (1.5 ),    </p><br>
<p><img src="https://habrastorage.org/webt/wx/nl/q5/wxnlq5fnsspt1cpgsdpwngtbwos.png"></p><br>
<p>.. 2890       116 ,    .   ATtiny13    POWER DOWN        . ,       ‚Äî       .         20-50 ,    , Hi-Z,   1 .  ,   DC-DC      .</p><br>
<p>         2  5 . :         .</p><br>
<h2 id="nekotorye-processy-mozhno-tolko-prekratit-no-ne-zakonchit">    ,   </h2><br>
<p>  ,      :</p><br>
<ul>
<li>   ,   ‚Äî ,      R2,       ,    .     .</li>
<li>   .           ‚Äî         1/37 ,          .</li>
<li>               ,      ,  .    POWER_DOWN     30 ,      ,     ,         .</li>
<li>  traffic_signals   8   4,   .   4 pin ‚Äî  1     DDR  PORTB</li>
<li>  uint16_t  signal_period  flash_period ‚Äî  ,     ,   1    .</li>
<li>   ‚Äî  ROM    2 ,    ‚Äî     -      .</li>
<li>             /UART.</li>
<li>   main   ‚Äî      ‚Äî  +50   ROM.</li>
<li>       9,6    128 ,       .</li>
</ul><br>
<p>.</p><br>
<p>       :    " ", ,  8 ,   ,    ¬´¬ª    .</p><br>
<p>         .</p><br>
<h2 id="video-raboty"> </h2><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/23ju4JVKMeA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<p>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Github</a>,   MIT.</p></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id443188/">https://habr.com/ru/post/id443188/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id443178/index.html">Crystal Blockchain Analytics: Investigasi Kasus Hacks dan Pencurian</a></li>
<li><a href="../id443180/index.html">Kru pendaratan Naga dan tangkapan video asteroid</a></li>
<li><a href="../id443182/index.html">Tarik YPbPr dari Commodore 64</a></li>
<li><a href="../id443184/index.html">Dari cinta hingga kontrol satu langkah</a></li>
<li><a href="../id443186/index.html">3CX Dukungan Teknis Menanggapi - 5 Aturan Keamanan IP PBX</a></li>
<li><a href="../id443190/index.html">Pengantar Kebijakan Jaringan Kubernet untuk Profesional Keamanan</a></li>
<li><a href="../id443192/index.html">Metode pribadi tanpa menggarisbawahi dan antarmuka dalam Python</a></li>
<li><a href="../id443194/index.html">Insinyur WFIRM menemukan bioprinter yang mencetak kulit langsung pada luka</a></li>
<li><a href="../id443196/index.html">Tidak semenit offline - Memilih router LTE industri</a></li>
<li><a href="../id443198/index.html">Mark Zuckerberg mengatakan Facebook sedang bekerja pada antarmuka saraf untuk membaca pikiran</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>