<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòº üíª üë®‚Äçüëß‚Äçüë¶ Fonctionnement du rendu de jeu 3D: traitement des sommets ‚õ∫Ô∏è üçé üìº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, nous consid√©rerons la phase de travail avec les sommets. Autrement dit, nous devrons √† nouveau obtenir les manuels de math√©matiques ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Fonctionnement du rendu de jeu 3D: traitement des sommets</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472688/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/070/e30/bd5/070e30bd57f6af2d7c1e36abe15f949b.jpg" alt="image"></div><br>  Dans cet article, nous consid√©rerons la phase de travail avec les sommets.  Autrement dit, nous devrons √† nouveau obtenir les manuels de math√©matiques et rappeler l'alg√®bre lin√©aire, les matrices et la trigonom√©trie.  Hourra! <br><br>  Nous d√©couvrirons comment les mod√®les 3D sont transform√©s et les sources lumineuses prises en compte.  Nous expliquerons √©galement en d√©tail la diff√©rence entre les vertex et les shaders g√©om√©triques, et vous d√©couvrirez √† quel stade est le lieu de la tessellation.  Pour faciliter la compr√©hension, nous utilisons des diagrammes et des exemples de code qui montrent comment le jeu effectue les calculs et traite les valeurs. <br><br>  La capture d'√©cran au d√©but de l'article montre le jeu GTA V en mode d'affichage filaire.  Comparez-le avec le wireframe demi-vie beaucoup moins complexe 2. Les images ont √©t√© cr√©√©es par thalixte avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ReShade</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4c4/562/7ee/4c45627ee9916f0bcdce6858b510b6a6.jpg"></div><a name="habracut"></a><br><h2>  √Ä quoi √ßa sert? </h2><br>  Dans le monde des math√©matiques, un point est simplement une place dans l'espace g√©om√©trique.  Il n'y a rien de plus petit qu'un point, il n'a pas de taille, donc les points peuvent √™tre utilis√©s pour sp√©cifier l'emplacement exact du d√©but et de la fin des objets tels que les segments de ligne, les plans et les volumes. <br><br>  Pour les graphiques 3D, ces informations sont extr√™mement importantes, l'apparence de tout en d√©pend, car tous les objets sont affich√©s sous forme d'ensembles de segments de ligne, d'avions, etc.  L'image ci-dessous montre une capture d'√©cran de Bethesda 2015 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Fallout 4</a> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/87b/33c/f82/87b33cf825a8ed9d87b7c8a7cc873e69.jpg"></div><br>  Il peut ne pas √™tre facile pour vous de voir qu'il ne s'agit que d'un √©norme tas de points et de lignes, nous allons donc vous montrer √† quoi ressemble la m√™me sc√®ne en mode filaire.  Dans ce mode, le moteur de rendu 3D ignore les textures et les effets effectu√©s √† l'√©tape des pixels et ne dessine que des lignes multicolores reliant les points. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/430/8a0/f67/4308a0f6729ff459c600275d8755f12c.jpg"></div><br>  Maintenant, tout semble compl√®tement diff√©rent, mais nous voyons comment toutes les lignes sont combin√©es pour former divers objets, environnements et arri√®re-plans.  Certains ne comportent que des dizaines de lignes, par exemple des pierres au premier plan, tandis que d'autres contiennent tellement de lignes qu'elles semblent solides. <br><br>  Chaque point au d√©but et √† la fin de chaque ligne est trait√© en effectuant tout un tas de calculs.  Certains calculs sont tr√®s simples et rapides, d'autres sont beaucoup plus compliqu√©s.  En traitant les points en groupes, en particulier sous la forme de triangles, vous pouvez obtenir une augmentation significative de la productivit√©, alors examinons-les de plus pr√®s. <br><br><h2>  De quoi a-t-on besoin pour un triangle? </h2><br>  Le <em>triangle du</em> nom indique clairement que la figure a trois coins internes;  Pour ce faire, elle a besoin de trois points d'angle et de trois segments les reliant.  Il est correct d'appeler un point d'angle un <em>sommet (sommet)</em> (au pluriel - sommets);  chaque sommet est d√©fini par un point.  Puisque nous sommes dans un monde g√©om√©trique tridimensionnel, le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">syst√®me de coordonn√©es cart√©siennes est</a> utilis√© pour les points.  Habituellement, les coordonn√©es sont √©crites sous la forme de trois valeurs, par exemple (1, 8, -3) ou de mani√®re g√©n√©rique ( <em>x, y, z</em> ). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/64c/b9e/77f/64cb9e77ffcc16159b4d201026a4ba04.png"></div><br>  Ensuite, nous pouvons ajouter deux sommets suppl√©mentaires pour former un triangle: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/732/482/c6b/732482c6b6faef01c7a7281f9b30da31.png"></div><br>  Notez que les lignes affich√©es sont facultatives - nous pouvons d√©finir les points et dire au syst√®me que ces trois sommets forment un triangle.  Toutes les donn√©es de sommet sont stock√©es dans un bloc de m√©moire contigu appel√© <em>tampon de sommet</em> ;  les informations sur la figure qu'elles forment sont soit encod√©es directement dans le programme de rendu, soit stock√©es dans un autre bloc de m√©moire appel√© <em>tampon d'index</em> . <br><br>  Si les informations sont cod√©es dans un programme de rendu, les diff√©rentes formes qui peuvent √™tre form√©es par des sommets sont appel√©es <em>primitives</em> .  Direct3D sugg√®re d'utiliser une liste pour eux, des bandes et des ventilateurs sous forme de points, de lignes et de triangles.  Lorsqu'elles sont utilis√©es correctement, les bandes de triangles utilisent des sommets pour plus d'un triangle, ce qui am√©liore la productivit√©.  Dans l'exemple ci-dessous, nous voyons que pour cr√©er deux triangles connect√©s ensemble, seuls quatre sommets sont n√©cessaires - s'ils sont s√©par√©s, nous avons besoin de six sommets. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/41e/9cb/a1e/41e9cba1ee23a0b9787994ef7249d6ff.png"></div><br>  <i>De gauche √† droite: liste des points, liste des lignes et bande de triangles</i> <br><br>  Si nous devons traiter un plus grand ensemble de sommets, par exemple, dans un mod√®le de jeu NPC, il est pr√©f√©rable d'utiliser un objet appel√© <em>maillage</em> , un autre bloc de m√©moire, mais compos√© de plusieurs tampons (sommets, index, etc.) et de ressources de texture de mod√®le .  La <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation en ligne</a> de Microsoft explique bri√®vement comment utiliser ces tampons. <br><br>  Pour l'instant, concentrons-nous sur ce qui arrive √† ces sommets dans un jeu 3D lors du rendu de chaque nouvelle image.  En bref, ils effectuent l'une des deux op√©rations: <br><br><ul><li>  Le sommet se d√©place vers une nouvelle position. </li><li>  Changements de couleur de sommet </li></ul><br>  Pr√™t pour les math√©matiques?  Excellent, car nous en avons besoin. <br><br><h2>  Le vecteur appara√Æt sur sc√®ne. </h2><br>  Imaginez que vous avez un triangle sur l'√©cran et que vous appuyez sur une touche pour le d√©placer vers la gauche.  Naturellement, nous nous attendons √† ce que les nombres ( <em>x, y, z</em> ) de chaque sommet changent en cons√©quence;  c'est ce qui se passe, mais une fa√ßon plut√¥t inattendue <em>de</em> mettre <em>en</em> ≈ìuvre des changements  Au lieu de simplement changer les coordonn√©es, la grande majorit√© des syst√®mes de rendu graphique 3D utilisent un outil math√©matique sp√©cial: nous voulons dire des <em>vecteurs</em> . <br><br>  Un vecteur peut √™tre repr√©sent√© par une fl√®che pointant vers un point sp√©cifique de l'espace et ayant la longueur souhait√©e.  Les sommets sont g√©n√©ralement d√©finis √† l'aide de vecteurs bas√©s sur des coordonn√©es cart√©siennes: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c5/5e4/79d/1c55e479dbf4da359cfa6ef7e3d55e8f.png"></div><br>  Notez que la fl√®che bleue commence √† un endroit (dans ce cas, le <em>point d'origine</em> ) et s'√©tend jusqu'au sommet.  Pour d√©finir le vecteur, nous avons utilis√© un <em>enregistrement dans une colonne</em> , mais il est tout √† fait possible d'utiliser un <em>enregistrement dans une ligne</em> .  Vous avez peut-√™tre remarqu√© qu'il existe une autre quatri√®me valeur, commun√©ment appel√©e <em>composante w</em> .  Il est utilis√© pour montrer ce que signifie le vecteur: position du point ( <em>vecteur de position</em> ) ou direction g√©n√©rale (vecteur de <em>direction</em> ).  Dans le cas d'un vecteur direction, il ressemblera √† ceci: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bb2/73e/525/bb273e52588aa21666075a11a34ee32d.png"></div><br>  Ce vecteur pointe dans la m√™me direction et a la m√™me longueur que le vecteur de position pr√©c√©dent, c'est-√†-dire que les valeurs ( <em>x, y, z</em> ) seront les m√™mes;  cependant, la composante <em>w</em> n'est pas 1, mais z√©ro.  Nous expliquerons l'utilisation des vecteurs directeurs plus tard, mais pour l'instant, rappelez-vous que tous les sommets de la sc√®ne 3D seront d√©crits de cette fa√ßon.  Pourquoi?  Parce que dans ce format, il est beaucoup plus facile de les d√©placer. <br><br><h2>  Math√©matiques, math√©matiques et encore math√©matiques </h2><br>  Rappelons que nous avons un triangle simple et que nous voulons le d√©placer vers la gauche.  Chaque sommet est d√©crit par un vecteur de position, donc les ¬´math√©matiques du mouvement¬ª (appel√©es <em>transformations</em> ) doivent fonctionner avec ces vecteurs.  Un nouvel outil appara√Æt: les <em>matrices</em> ( <em>matrice</em> au singulier).  Il s'agit d'un tableau de valeurs √©crites dans un format similaire √† une feuille de calcul Excel, avec des lignes et des colonnes. <br><br>  Pour chaque type de transformation il y a une matrice correspondante, et pour une transformation il suffit de multiplier simplement la matrice de transformation et le vecteur position.  Nous n'entrerons pas dans les d√©tails de comment et pourquoi cela se produit, mais voyons simplement √† quoi cela ressemble. <br><br>  Le d√©placement d'un sommet dans l'espace 3D est appel√© <em>translation,</em> et il n√©cessite le calcul suivant: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/530/c9b/eca/530c9beca19d9b0c8d61db78ecb8682a.png"></div><br>  Valeurs <em>x <sub>0</sub></em> , etc.  repr√©sentent les coordonn√©es d'origine du vecteur;  <em>les</em> valeurs <em>delta</em> - <em>x</em> repr√©sentent la quantit√© de d√©placement du sommet.  La multiplication de la matrice et du vecteur conduit au fait qu'ils se r√©sument simplement (notez que la composante <em>w</em> reste inchang√©e de sorte que la r√©ponse finie reste le vecteur position comme pr√©c√©demment). <br><br>  En plus de se d√©placer, nous pouvons √©galement avoir besoin de faire pivoter le triangle ou de changer son √©chelle - pour ces op√©rations, il y a aussi des transformations. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1fc/ba4/d0b/1fcba4d0b2a678e94c17c49a09af0591.png"></div><br>  <i>Cette transformation fait pivoter le sommet autour de l'axe z dans le plan XY</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5eb/1d5/26e/5eb1d526eb15b522f3fddb0dadffa8cf.png"></div><br>  <em>Et cela est utilis√© si vous devez changer l'√©chelle de la figure</em> <br><br>  Nous pouvons utiliser l'outil graphique bas√© sur WebGL de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rendu en temps r√©el</a> pour visualiser ces calculs pour la figure enti√®re.  Commen√ßons par la case en position standard: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/220/5d7/3d2/2205d73d2920758e3fb11f6829cb924d.jpg"></div><br>  Dans cet outil en ligne, le point de mod√®le est le vecteur de position, la matrice mondiale est la matrice de transformation et le point espace-monde est le vecteur de position du sommet transform√©. <br><br>  Appliquons diverses transformations √† la bo√Æte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/820/d7b/5d6/820d7b5d618f68de9446d0ee005a50da.jpg"></div><br>  Dans l'image ci-dessus, la figure a √©t√© <em>d√©plac√©e de</em> 5 unit√©s le long de chaque axe.  Ces valeurs peuvent √™tre vues dans la derni√®re colonne de la grande matrice du milieu.  Le vecteur de position d'origine (4, 5, 3, 1) reste le m√™me qu'il devrait, mais le sommet transform√© est maintenant d√©plac√© vers (9, 10, 8, 1). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9a1/8c4/6fd/9a18c46fd6df9936f3632fd4e4b2a287.jpg"></div><br>  Dans cette transformation, tout a √©t√© mis √† l'√©chelle par un facteur 2: maintenant les c√¥t√©s de la bo√Æte sont devenus deux fois plus longs.  Enfin, regardez l'exemple de rotation: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/21c/beb/340/21cbeb3409b55b736d2dd1322a1d80b0.jpg"></div><br><br>  Le parall√©l√©pip√®de a √©t√© tourn√© d'un angle de 45 ¬∞, mais le <em>sinus</em> et le <em>cosinus de</em> cet angle sont utilis√©s dans la matrice.  Apr√®s avoir v√©rifi√© sur une calculatrice scientifique, nous pouvons voir que <em>sin (45 ¬∞)</em> = 0,7071 ..., qui est arrondi √† la valeur indiqu√©e de 0,71.  Nous obtenons la m√™me r√©ponse pour la valeur du <em>cosinus</em> . <br><br>  Les matrices et les vecteurs sont facultatifs;  Une alternative populaire pour eux, en particulier lors de la manipulation de virages complexes, est l'utilisation de nombres complexes et de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">quaternions</a> .  Ces calculs sont tr√®s diff√©rents des vecteurs, nous ne les consid√©rerons donc pas en continuant √† travailler avec les transformations. <br><br><h2>  Vertex Shader Power </h2><br>  √Ä ce stade, nous devons comprendre que tout cela est fait par des personnes programmant le code de rendu.  Si un d√©veloppeur de jeux utilise un moteur tiers (par exemple, Unity ou Unreal), alors tout cela a d√©j√† √©t√© fait pour lui;  mais si quelqu'un fait son moteur √† partir de z√©ro, alors il devra effectuer tous ces calculs avec des sommets. <br><br>  Mais √† quoi cela ressemble-t-il en termes de code? <br><br>  Pour comprendre cela, nous utiliserons des exemples de l'incroyable site Web de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Braynzar Soft</a> .  Si vous voulez commencer √† travailler vous-m√™me avec la programmation 3D, c'est le bon endroit pour apprendre les bases, ainsi que des choses plus complexes ... <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/726/99f/664/72699f66423a8f3094cb911bc99a18e2.png"></div><br>  Ceci est un exemple de transformation tout-en-un.  Il cr√©e les matrices de transformation appropri√©es en fonction de la saisie au clavier, puis les applique au vecteur de position d'origine en une seule op√©ration.  Notez que cela se fait toujours dans l'ordre donn√© (mise √† l'√©chelle - rotation - transfert), car toute autre mani√®re ruinera compl√®tement le r√©sultat. <br><br>  De tels blocs de code sont appel√©s <em>vertex shaders</em> , leur complexit√© et leur taille peuvent varier √©norm√©ment.  L'exemple ci-dessus est simple, ce n'est <em>qu'un</em> vertex shader qui n'utilise pas la nature enti√®rement programmable des shaders.  Une s√©quence plus complexe de shaders pourrait transformer des objets dans l'espace 3D, traiter leur apparence du point de vue de la cam√©ra de sc√®ne, puis transf√©rer des donn√©es √† l'√©tape suivante du processus de rendu.  En consid√©rant l'ordre de traitement des sommets, nous √©tudierons d'autres exemples. <br><br>  Bien s√ªr, ils peuvent √™tre utilis√©s pour beaucoup plus, donc lorsque vous jouez √† un jeu 3D, n'oubliez pas que tous les mouvements que vous voyez sont effectu√©s par un GPU ex√©cutant des commandes de vertex shader. <br><br>  Mais cela n'a pas toujours √©t√© le cas.  Si vous remontez au milieu des ann√©es 90, les cartes graphiques de cette √©poque n'avaient pas la capacit√© de traiter ind√©pendamment les sommets et les primitives, le processeur central seul a fait tout cela. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/954/1d1/c15/9541d1c150a6ef926d98449addf51206.jpg"></div><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nvidia GeForce, sorti en 2000</a> , a √©t√© l'un des premiers processeurs avec leur propre acc√©l√©ration mat√©rielle de ce processus, et cette fonctionnalit√© a √©t√© appel√©e <em>Hardware Transform and Lighting</em> (pour faire court, Hardware TnL).  Les processus que cet √©quipement pouvait g√©rer √©taient tr√®s limit√©s en termes d'√©quipes, mais avec la sortie de nouvelles puces, la situation a chang√© rapidement.  Aujourd'hui, il n'y a pas d'√©quipement s√©par√© pour le traitement des sommets, et un seul appareil fait tout √† la fois: points, primitives, pixels, textures, etc. <br><br>  Soit dit en passant, √† propos de l' <em>√©clairage</em> : il convient de noter que nous voyons tout gr√¢ce √† la lumi√®re, voyons donc comment il peut √™tre trait√© au stade du sommet.  Pour ce faire, nous devons profiter de ce dont nous avons parl√© plus t√¥t. <br><br><h2>  Lumi√®re, cam√©ra, moteur! </h2><br>  Imaginez cette image: le joueur se tient dans une pi√®ce sombre, √©clair√© par une source lumineuse √† droite.  Au milieu de la pi√®ce se trouve une immense bouilloire.  Vous aurez peut-√™tre besoin d'aide pour cela, alors utilisons le site Web de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rendu en temps r√©el</a> et voyons √† quoi il ressemble: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b1a/6a4/5f4/b1a6a45f47e81bec587c4f7bda1bf3ae.jpg"></div><br>  N'oubliez pas que cet objet est un ensemble de triangles plats reli√©s entre eux;  c'est-√†-dire que le plan de chaque triangle sera dirig√© dans une certaine direction.  Certains d'entre eux sont dirig√©s vers l'appareil photo, certains - √† l'autre, certains seront d√©form√©s.  La lumi√®re de la source tombe sur chaque plan et en est r√©fl√©chie sous un certain angle. <br><br>  Selon l'endroit o√π la lumi√®re est r√©fl√©chie, la couleur et la luminosit√© de l'avion peuvent changer, et pour que la couleur de l'objet soit correcte, tout cela doit √™tre calcul√© et pris en compte. <br><br>  Pour commencer, nous devons savoir o√π chaque plan est dirig√©, et pour cela, nous avons besoin <em>du vecteur normal du</em> plan.  Il s'agit d'une autre fl√®che, mais contrairement au vecteur de position, sa taille n'est pas importante (en fait, apr√®s avoir calcul√© l'√©chelle des vecteurs normaux, elle diminue toujours pour qu'ils aient une longueur de 1), et elle est toujours dirig√©e <em>perpendiculairement</em> (√† angle droit) par rapport au plan. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/228/84c/836/22884c83697e201f3b00bb7d06f6f95f.png"></div><br>  La normale au plan de chaque triangle est calcul√©e en d√©terminant le produit vectoriel de deux vecteurs de direction (montr√©s ci-dessus <strong>p</strong> et <strong>q</strong> ) qui forment les c√¥t√©s du triangle.  En fait, il vaut mieux les calculer pour chaque sommet, et non pour un triangle, mais comme il y a toujours plus de premiers que de seconds, il sera plus rapide de calculer les normales des triangles. <br><br>  Apr√®s avoir re√ßu la normale √† la surface, vous pouvez commencer √† consid√©rer la source de lumi√®re et la cam√©ra.  Dans le rendu 3D, les sources lumineuses peuvent √™tre de diff√©rents types, mais dans cet article, nous ne consid√©rerons que les sources <em>directionnelles</em> , par exemple les projecteurs.  Comme le plan du triangle, le projecteur et la cam√©ra pointeront dans une certaine direction, quelque chose comme ceci: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3a8/f24/b91/3a8f24b915d631a9608faaf106b04300.png"></div><br>  Le vecteur source lumineuse et le vecteur normal peuvent √™tre utilis√©s pour calculer l'angle auquel la lumi√®re tombe sur la surface (en utilisant la relation entre le produit scalaire des vecteurs et le produit de leur taille).  Les sommets du triangle contiendront des informations suppl√©mentaires sur leur couleur et leur mat√©riau.  Le mat√©riau d√©crit ce qui arrive √† la lumi√®re lorsqu'elle frappe la surface. <br><br>  Une surface m√©tallique lisse r√©fl√©chira presque toute la lumi√®re incidente √† l'angle auquel elle est tomb√©e et changera √† peine la couleur de l'objet.  Le mat√©riau mat rugueux disperse la lumi√®re d'une mani√®re moins pr√©visible et change l√©g√®rement de couleur.  Pour en tenir compte, vous devez ajouter des valeurs suppl√©mentaires aux sommets: <br><br><ul><li>  Couleur de base d'origine </li><li>  Attribut de mat√©riau ambiant - une valeur qui d√©termine la quantit√© d'√©clairage ¬´d'arri√®re-plan¬ª qui peut absorber et refl√©ter un sommet </li><li>  L'attribut du mat√©riau diffus est une autre valeur, mais cette fois, la d√©termination de la ¬´rugosit√©¬ª du sommet, qui, √† son tour, affecte la quantit√© d'absorption et de r√©flexion de la lumi√®re diffus√©e </li><li>  Attributs de mat√©riau sp√©culaire - Deux valeurs qui sp√©cifient le brillant du sommet </li></ul><br>  Diff√©rents mod√®les d'√©clairage utilisent diff√©rentes formules math√©matiques pour regrouper tous ces attributs, et le r√©sultat du calcul est le vecteur d'√©clairage sortant.  En combinaison avec le vecteur de la cam√©ra, il vous permet de d√©terminer l'apparence globale du triangle. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/627/648/a21/627648a213ed357982314f7ed7fdd915.jpg"></div><br>  <i>Une source lumineuse directionnelle √©claire de nombreuses <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©mos Nvidia</a> diff√©rentes</i> <br><br>  Nous avons omis de nombreux d√©tails d√©taill√©s, et pour cause: ouvrez n'importe quel didacticiel de rendu 3D, et vous verrez que des chapitres entiers sont consacr√©s √† ce processus.  Cependant, dans les jeux modernes, la majeure partie de tous les calculs d'√©clairage et d'effets de mat√©riaux sont effectu√©s au stade du traitement des pixels, nous y reviendrons donc dans le prochain article. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d7c/8b7/3b0/d7c8b73b0185c20eb23b2a9fdee1cba6.png"></div><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Exemple de code</a> B. Anguelov montrant comment le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mod√®le de r√©flexion de la lumi√®re Phong</a> peut √™tre trait√© dans le vertex shader.</i> <br><br>  Tout ce que nous avons examin√© ci-dessus est fait par des vertex shaders, et il semble que rien ne leur soit impossible;  ce n'est malheureusement pas le cas.  Les shaders de sommet ne peuvent pas cr√©er de nouveaux sommets, et chaque shader doit traiter chaque sommet individuel.  Il serait pratique que vous puissiez utiliser le code pour cr√©er de nouveaux triangles entre ceux que nous avons d√©j√† (pour am√©liorer la qualit√© visuelle), et avoir un shader qui traite toute une primitive (pour acc√©l√©rer le traitement).  Eh bien, dans les GPU modernes, nous <em>pouvons le</em> faire! <br><br><h2>  S'il vous pla√Æt monsieur, je veux plus (triangles) </h2><br>  Les puces graphiques modernes sont extr√™mement puissantes et capables d'effectuer des millions de calculs matrice-vecteur chaque seconde;  ils font facilement face √† un √©norme tas de pics √† la fois.  D'un autre c√¥t√©, la cr√©ation de mod√®les tr√®s d√©taill√©s pour le rendu est un processus tr√®s long, et si le mod√®le est √† une certaine distance de la sc√®ne, tous ces d√©tails seront perdus. <br><br>  Autrement dit, nous devons en quelque sorte ordonner au processeur de diviser une grande primitive, par exemple, un triangle plat en un ensemble de triangles plus petits situ√©s √† l'int√©rieur de celui d'origine.  Un tel processus est appel√© <em>tesselation,</em> et les puces graphiques ont d√©j√† appris √† le r√©aliser tr√®s bien;  au cours des ann√©es de d√©veloppement, le degr√© de contr√¥le que les programmeurs ont sur ce processus a augment√©. <br><br>  Pour regarder cela en action, nous utiliserons l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">outil de r√©f√©rence Heaven du moteur Unigine</a> , car il nous permet d'appliquer diff√©rentes valeurs de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pavage</a> aux mod√®les utilis√©s dans le test. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d11/630/5fd/d116305fd0fa789635bc3631a4463829.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour commencer, prenons une place dans le benchmark et √©tudions-le sans utiliser de pavage. </font><font style="vertical-align: inherit;">Notez que les pav√©s au sol ne semblent pas tr√®s naturels - la texture utilis√©e est efficace, mais elle semble fausse. </font><font style="vertical-align: inherit;">Appliquons la tessellation √† la sc√®ne: le moteur Unigine ne l'applique qu'aux parties individuelles, mais la diff√©rence sera significative.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e1c/8fb/399/e1c8fb3998d448711164832c4b3af2ff.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le terrain, les bords des b√¢timents et la porte semblent beaucoup plus r√©alistes. </font><font style="vertical-align: inherit;">Nous pouvons voir comment cela a √©t√© r√©alis√© en red√©marrant le processus, mais cette fois avec la s√©lection de toutes les primitives (c'est-√†-dire en mode filaire):</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0c2/691/fec/0c2691fec046708d4c65058ed3cec016.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On voit clairement pourquoi la terre a l'air si √©trange - elle est compl√®tement plate! La porte se confond avec les murs et les bords du b√¢timent sont de simples parall√©l√©pip√®des. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans Direct3D, les primitives peuvent √™tre divis√©es en un groupe de parties plus petites (ce processus est appel√© une </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sous-division) en</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> effectuant un processus en trois √©tapes. Premi√®rement, les programmeurs √©crivent un </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shader de surface (shader shader)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - en fait, ce code cr√©e une structure appel√©e </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">patch g√©om√©trique</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Vous pouvez le consid√©rer comme une carte indiquant au processeur o√π de nouveaux points et lignes appara√Ætront √† l'int√©rieur de la primitive initiale. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ensuite, le bloc tessellateur √† l'int√©rieur du GPU applique ce patch √† la primitive. √Ä la fin, un </font><em><font style="vertical-align: inherit;">shader de domaine</font></em><font style="vertical-align: inherit;"> est ex√©cut√©</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calculer les positions de tous les nouveaux sommets. Si n√©cessaire, ces donn√©es peuvent √™tre retransf√©r√©es vers le tampon de vertex afin que les calculs d'√©clairage puissent √™tre effectu√©s √† nouveau, mais cette fois avec de meilleurs r√©sultats. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä quoi √ßa ressemble? Lan√ßons la version filaire de la sc√®ne en mosa√Øque:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3c0/ca9/5af/3c0ca95af3ce89f1ae854706dfd04adc.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Honn√™tement, nous avons d√©fini un degr√© de pavage assez √©lev√© pour rendre l'explication du processus plus visible. Peu importe la qualit√© des puces graphiques modernes, cela ne devrait pas √™tre fait dans chaque sc√®ne - regardez, par exemple, la lampe √† c√¥t√© de la porte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans les images avec filaire d√©sactiv√©, vous ne trouveriez gu√®re de diff√©rences √† cette distance, et nous voyons qu'un tel niveau de pavage a ajout√© tellement de triangles qu'il est difficile de les s√©parer les uns des autres. Cependant, lorsqu'elle est utilis√©e correctement, cette fonction de traitement des sommets peut cr√©er des effets visuels fantastiques, en particulier lors de la simulation de collisions de corps mous. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voyons √† quoi cela pourrait ressembler en termes de code Direct3D; pour cela, nous utilisons l'exemple d'un autre grand site Web, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RasterTek</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Voici un simple triangle vert tessell√© en plusieurs petits triangles ... </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/13a/3bd/3d4/13a3bd3d482f26404d92d3ab60694fa3.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le </font><font style="vertical-align: inherit;">traitement des </font><font style="vertical-align: inherit;">sommets </font><font style="vertical-align: inherit;">est effectu√© par trois shaders distincts (voir l' </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemple de code</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ): un vertex shader qui pr√©pare un triangle pour la pavage, un surface shader qui g√©n√®re un patch et un domaine shader qui traite les nouveaux sommets. </font><font style="vertical-align: inherit;">Le r√©sultat est suffisamment compr√©hensible, mais l'exemple Unigine d√©montre √† la fois les avantages potentiels et les dangers de l'utilisation g√©n√©ralis√©e de la tessellation.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "Iron" ne peut pas le supporter! </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rappelez-vous, nous avons dit que les vertex shaders traitent toujours chaque sommet d'une sc√®ne? Il est facile de comprendre que la pavage peut √™tre un probl√®me grave ici. Et il existe de nombreux effets visuels o√π vous devez traiter diff√©rentes versions d'une primitive, mais sans les cr√©er d√®s le d√©but, par exemple, les cheveux, la fourrure, l'herbe et les particules d'explosions. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Heureusement, en particulier pour de telles choses, il existe un autre shader - un </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shader g√©om√©trique</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il s'agit d'une version plus limit√©e du vertex shader, mais elle peut √™tre appliqu√©e √† l'ensemble de la primitive. En combinaison avec la tessellation, elle donne aux programmeurs un contr√¥le accru sur de grands groupes de sommets.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/602/97d/f09/60297df09a132ab07b00140fa2a07b77.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UL Benchmark 3DMark Vantage - les shaders g√©om√©triques traitent les particules et</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> les </font><i><font style="vertical-align: inherit;">drapeaux</font></i><font style="vertical-align: inherit;"> Direct3D, comme toutes les API graphiques modernes, il vous permet d'effectuer de nombreux calculs avec des sommets. Les donn√©es finies peuvent √™tre soit transf√©r√©es √† l'√©tape suivante du processus de rendu ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tramage</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), soit retourn√©es au pool de m√©moire pour √™tre retrait√©es ou lues par le processeur central √† d'autres fins. Comme le dit la documentation Microsoft sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Direct3D</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cela peut √™tre impl√©ment√© en tant que flux de donn√©es:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/638/134/de2/638134de2960977f2847aab27c88df84.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L' </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©tape de sortie du flux est</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> facultative, en particulier parce qu'elle ne peut transf√©rer que des primitives enti√®res (plut√¥t que des sommets individuels) au cycle de rendu, mais elle est utile pour les effets n√©cessitant un grand nombre de particules. La m√™me astuce peut √™tre effectu√©e √† l'aide d'un </font><font style="vertical-align: inherit;">tampon de sommet </font><font style="vertical-align: inherit;">variable ou </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dynamique</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais il est pr√©f√©rable de conserver les tampons d'entr√©e inchang√©s, car lorsque vous les ouvrez pour les modifier, les performances sont r√©duites. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le traitement des sommets est un √©l√©ment essentiel du rendu, car il d√©termine √† quoi ressemblera la sc√®ne du point de vue de la cam√©ra. Dans les jeux modernes, des millions de triangles peuvent √™tre utilis√©s pour construire des mondes, et chacun de ces sommets est en quelque sorte transform√© et illumin√©.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bdd/760/829/bdd760829e81753b4938fd8ff3076b6d.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Triangles. </font><font style="vertical-align: inherit;">Il y en a des millions. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le traitement de tous ces calculs et calculs peut sembler un cauchemar logistique, mais les processeurs graphiques (GPU) et les API sont con√ßus dans cet esprit - imaginez une usine fonctionnant parfaitement et passant un produit √† la fois dans le pipeline de production. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les programmeurs de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rendu de jeu 3D</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> exp√©riment√©s </font><font style="vertical-align: inherit;">ont des connaissances fondamentales en math√©matiques et en physique; </font><font style="vertical-align: inherit;">ils utilisent toutes les astuces et outils possibles pour optimiser les op√©rations, en compressant l'√©tape de traitement des sommets en quelques millisecondes seulement. </font><font style="vertical-align: inherit;">Mais ce n'est que le tout d√©but de la construction d'un cadre 3D - la prochaine √©tape est la pixellisation, puis le traitement extr√™mement complexe des pixels et des textures, et alors seulement l'image p√©n√®tre sur le moniteur.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr472688/">https://habr.com/ru/post/fr472688/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr472674/index.html">Variables d'environnement pour les projets Python</a></li>
<li><a href="../fr472676/index.html">Nous cr√©ons le d√©partement de jones pour aider les √©quipes principales, en utilisant uniquement Slack, Jira et le ruban √©lectrique bleu</a></li>
<li><a href="../fr472682/index.html">Ralentir le vieillissement avec des synergies de m√©dicaments chez C. elegans</a></li>
<li><a href="../fr472684/index.html">Envoyer une surprise √† fsync () PostgreSQL</a></li>
<li><a href="../fr472686/index.html">Studio vid√©o bas√© sur i486</a></li>
<li><a href="../fr472690/index.html">Nouveaut√©s de Zabbix 4.4</a></li>
<li><a href="../fr472694/index.html">Plus que Ceph: MCS Block Cloud Storage</a></li>
<li><a href="../fr472702/index.html">JH Rainwater ¬´Comment faire pa√Ætre les chats¬ª: races de programmeurs et caract√©ristiques de leur √©levage</a></li>
<li><a href="../fr472708/index.html">Imperva a r√©v√©l√© les d√©tails techniques du hack Cloud WAF</a></li>
<li><a href="../fr472714/index.html">O√π trouver le travailleur frontal pour chercher du travail et ne pas tomber amoureux: T√©l√©gramme, Slack et pas seulement</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>