<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÇ ü¶Ç üíë Pourquoi les √©l√©ments React ont-ils une propri√©t√© $ typeof? üîñ ü§∞üèΩ üè¥Û†ÅßÛ†Å¢Û†Å∑Û†Å¨Û†Å≥Û†Åø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="√Ä propos du m√©canisme React pour emp√™cher la possibilit√© d'une injection JSON pour XSS et pour √©viter les vuln√©rabilit√©s courantes. 
 


 Vous pourrie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pourquoi les √©l√©ments React ont-ils une propri√©t√© $$ typeof?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/432350/"><p>  <em>√Ä propos du m√©canisme React pour emp√™cher la possibilit√© d'une injection JSON pour XSS et pour √©viter les vuln√©rabilit√©s courantes.</em> <em><br></em> </p><a name="habracut"></a><br><p>  Vous pourriez penser que vous √©crivez JSX: </p><br><pre><code class="javascript hljs">&lt;marquee bgcolor=<span class="hljs-string"><span class="hljs-string">"#ffa7c4"</span></span>&gt;hi&lt;<span class="hljs-regexp"><span class="hljs-regexp">/marquee&gt;</span></span></code> </pre> <br><p>  Mais en fait, vous appelez la fonction: </p><br><pre> <code class="javascript hljs">React.createElement( <span class="hljs-comment"><span class="hljs-comment">/* type */</span></span> <span class="hljs-string"><span class="hljs-string">'marquee'</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* props */</span></span> { <span class="hljs-attr"><span class="hljs-attr">bgcolor</span></span>: <span class="hljs-string"><span class="hljs-string">'#ffa7c4'</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* children */</span></span> <span class="hljs-string"><span class="hljs-string">'hi'</span></span> )</code> </pre> <br><p>  Et cette fonction vous renvoie un objet r√©gulier appel√© √©l√©ment React.  En cons√©quence, apr√®s avoir travers√© tous les composants, un arbre d'objets similaires est obtenu: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'marquee'</span></span>, <span class="hljs-attr"><span class="hljs-attr">props</span></span>: { <span class="hljs-attr"><span class="hljs-attr">bgcolor</span></span>: <span class="hljs-string"><span class="hljs-string">'#ffa7c4'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: <span class="hljs-string"><span class="hljs-string">'hi'</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">key</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">ref</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">$$typeof</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.for(<span class="hljs-string"><span class="hljs-string">'react.element'</span></span>), }</code> </pre> <br><p>  Si vous avez d√©j√† utilis√© React, vous connaissez peut-√™tre les champs type, props, key et ref.  <strong>Mais quelle est la propri√©t√© <code>$$typeof</code> ?</strong>  <strong>Et pourquoi at-il le symbole <code>Symbol()</code> comme valeur?</strong> </p><br><hr><br><p>  Avant que les biblioth√®ques d'interface utilisateur ne deviennent populaires, pour afficher l'entr√©e client dans le code d'application, une ligne contenant le balisage HTML a √©t√© g√©n√©r√©e et ins√©r√©e directement dans le DOM, via innerHTML: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> messageEl = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'message'</span></span>); messageEl.innerHTML = <span class="hljs-string"><span class="hljs-string">'&lt;p&gt;'</span></span> + message.text + <span class="hljs-string"><span class="hljs-string">'&lt;/p&gt;'</span></span>;</code> </pre> <br><p>  Ce m√©canisme fonctionne <code>&lt;img src onerror="stealYourPassword()"&gt;</code> sauf si <code>message.text</code> est d√©fini sur <code>&lt;img src onerror="stealYourPassword()"&gt;</code> .  Par cons√©quent, nous concluons que vous <strong>n'avez pas besoin d'interpr√©ter toutes les entr√©es client comme du balisage HTML.</strong> </p><br><p>  Pour vous prot√©ger contre de telles attaques, vous pouvez utiliser des API s√©curis√©es, telles que <code>document.createTextNode()</code> ou <code>textContent</code> , qui n'interpr√®tent pas le texte.  Et comme mesure suppl√©mentaire, √©chappez aux cha√Ænes en rempla√ßant les caract√®res potentiellement dangereux comme <code>&lt;</code> , <code>&gt;</code> par des caract√®res s√ªrs. </p><br><p>  N√©anmoins, la probabilit√© d'erreur est √©lev√©e, car il est difficile de suivre tous les endroits o√π vous utilisez les informations enregistr√©es par l'utilisateur dans votre page.  C'est pourquoi les biblioth√®ques modernes telles que React fonctionnent en toute s√©curit√© avec n'importe quel texte par d√©faut: </p><br><pre> <code class="javascript hljs">&lt;p&gt; {message.text} &lt;<span class="hljs-regexp"><span class="hljs-regexp">/p&gt;</span></span></code> </pre> <br><p>  Si <code>message.text</code> est une cha√Æne malveillante avec une <code>&lt;img&gt;</code> , elle ne se transformera pas en une vraie <code>&lt;img&gt;</code> .  React √©chappe au contenu texte, puis l'ajoute au DOM.  Par cons√©quent, au lieu de voir la <code>&lt;img&gt;</code> , vous voyez simplement son balisage sous forme de cha√Æne. </p><br><p>  Pour afficher un code HTML arbitraire √† l'int√©rieur d'un √©l√©ment React, vous devez utiliser la construction suivante: <code>dangerouslySetInnerHTML={{ __html: message.text }}</code> .  <strong>Le design est intentionnellement inconfortable.</strong>  En raison de son absurdit√©, il devient plus visible et attire l'attention lors de la visualisation du code. </p><br><hr><br><p>  <strong>Est-ce √† dire que React est totalement s√ªr?</strong>  <strong>Non.</strong>  Il existe de nombreuses m√©thodes d'attaque connues bas√©es sur HTML et DOM.  Les attributs des balises m√©ritent une attention particuli√®re.  Par exemple, si vous √©crivez <code>&lt;a href={user.website}&gt;</code> , vous pouvez remplacer un code malveillant sous forme de lien texte: <code>'javascript: stealYourPassword()'</code> . </p><br><p>  Dans la plupart des cas, la pr√©sence de vuln√©rabilit√©s c√¥t√© client est le r√©sultat de probl√®mes c√¥t√© serveur et doit √™tre corrig√©e en premier lieu. </p><br><p>  Cependant, l'affichage s√ªr du contenu texte personnalis√© est une premi√®re ligne de d√©fense raisonnable qui refl√®te de nombreuses attaques potentielles. </p><br><p>  Sur la base de consid√©rations pr√©c√©dentes, nous pouvons conclure que le code suivant doit √™tre compl√®tement s√ªr: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   &lt;p&gt; {message.text} &lt;/p&gt;</span></span></code> </pre> <br><p>  <strong>Mais ce n'est pas le cas non plus.</strong>  Et ici, nous nous rapprochons de l'explication de la pr√©sence de <code>$$typeof</code> dans l'√©l√©ment React. </p><br><hr><br><p>  Comme nous l'avons expliqu√© pr√©c√©demment, les √©l√©ments React sont des objets simples: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'marquee'</span></span>, <span class="hljs-attr"><span class="hljs-attr">props</span></span>: { <span class="hljs-attr"><span class="hljs-attr">bgcolor</span></span>: <span class="hljs-string"><span class="hljs-string">'#ffa7c4'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: <span class="hljs-string"><span class="hljs-string">'hi'</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">key</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">ref</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">$$typeof</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.for(<span class="hljs-string"><span class="hljs-string">'react.element'</span></span>), }</code> </pre> <br><p>  Habituellement, un √©l√©ment React est cr√©√© en appelant la fonction <code>React.createElement()</code> , mais vous pouvez le cr√©er imm√©diatement avec un litt√©ral, comme je viens de le faire ci-dessus. </p><br><p>  Supposons que nous stockons sur le serveur une cha√Æne que l'utilisateur nous a envoy√©e pr√©c√©demment, et √† chaque fois que nous l'afficherons c√¥t√© client.  Mais quelqu'un, au lieu d'une cha√Æne, nous a envoy√© JSON: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> expectedTextButGotJSON = { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'div'</span></span>, <span class="hljs-attr"><span class="hljs-attr">props</span></span>: { <span class="hljs-attr"><span class="hljs-attr">dangerouslySetInnerHTML</span></span>: { <span class="hljs-attr"><span class="hljs-attr">__html</span></span>: <span class="hljs-string"><span class="hljs-string">'/*     */'</span></span> }, }, <span class="hljs-comment"><span class="hljs-comment">// ... }; let message = { text: expectedTextButGotJSON }; //    React 0.13 &lt;p&gt; {message.text} &lt;/p&gt;</span></span></code> </pre> <br><p>  Autrement dit, au lieu de la cha√Æne attendue, la valeur de la variable attenduTextButGotJSON s'est av√©r√©e √™tre JSON.  Qui sera trait√© par React comme un litt√©ral, et ex√©cutera ainsi du code malveillant. </p><br><p>  React 0.13 est vuln√©rable √† une attaque de type XSS, mais √† partir de la version 0.14, chaque √©l√©ment est marqu√© d'un symbole: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'marquee'</span></span>, <span class="hljs-attr"><span class="hljs-attr">props</span></span>: { <span class="hljs-attr"><span class="hljs-attr">bgcolor</span></span>: <span class="hljs-string"><span class="hljs-string">'#ffa7c4'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: <span class="hljs-string"><span class="hljs-string">'hi'</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">key</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">ref</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">$$typeof</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.for(<span class="hljs-string"><span class="hljs-string">'react.element'</span></span>), }</code> </pre> <br><p>  Cette protection fonctionne car les caract√®res ne sont pas une valeur JSON valide.  Par cons√©quent, m√™me si le serveur pr√©sente une vuln√©rabilit√© potentielle et renvoie JSON au lieu de texte, JSON ne peut pas contenir <code>Symbol.for('response.element')</code> .  React v√©rifie l'√©l√©ment pour l' <code>element.$$typeof</code> et refuse de traiter l'√©l√©ment s'il est manquant ou non valide. </p><br><p>  Le principal avantage de <code>Symbol.for()</code> est que les symboles sont globaux entre les contextes car ils utilisent un registre global.  Cela garantit la m√™me valeur de retour m√™me dans un iframe.  Et m√™me s'il y a plusieurs exemplaires de React sur la page, ils pourront toujours ¬´correspondre¬ª √† travers une seule valeur de <code>$$typeof</code> . </p><br><hr><br><p>  Qu'en est-il des navigateurs qui ne prennent pas en charge les caract√®res? </p><br><p>  H√©las, ils ne pourront pas impl√©menter la protection suppl√©mentaire discut√©e ci-dessus, mais les √©l√©ments React contiendront toujours la propri√©t√© <code>$$typeof</code> pour la coh√©rence, mais ce ne sera qu'un nombre - <code>0xeac7</code> . </p><br><p>  Pourquoi exactement <code>0xeac7</code> ?  Parce que √ßa ressemble √† React. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr432350/">https://habr.com/ru/post/fr432350/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr432338/index.html">Robotaxi Waymo One a gagn√© en tant que r√©seau de transport commercial</a></li>
<li><a href="../fr432342/index.html">Camunda BPM Meetup Raiffeisenbank UPD Broadcast</a></li>
<li><a href="../fr432344/index.html">Quatre √©tapes de d√©veloppement des ing√©nieurs</a></li>
<li><a href="../fr432346/index.html">Nouvelles du monde d'OpenStreetMap n ¬∞ 436 (20/11/2018 - 26/06/2018)</a></li>
<li><a href="../fr432348/index.html">Master class: moulage sous vide de plastiques en silicone</a></li>
<li><a href="../fr432352/index.html">Profondeurs SIEM: corr√©lations pr√™tes √† l'emploi. Partie 3.1. Cat√©gorisation des √©v√©nements</a></li>
<li><a href="../fr432354/index.html">Les fuites de donn√©es les plus importantes en 2018. Premi√®re partie (janvier-juin)</a></li>
<li><a href="../fr432356/index.html">Comment r√©diger un excellent fil d'actualit√©s VKontakte en 20 heures</a></li>
<li><a href="../fr432360/index.html">"Descendant" AlphaGo a ind√©pendamment appris √† jouer aux √©checs, au shogi et √† aller</a></li>
<li><a href="../fr432362/index.html">Chang'e 4 - La mission de l'autre c√¥t√© de la lune commence aujourd'hui</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>