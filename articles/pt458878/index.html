<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîó üíí üë©‚Äçüë©‚Äçüë¶‚Äçüë¶ O que √© GitOps? üíÉ ü¶Ñ üë†</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nota perev. : Ap√≥s a recente publica√ß√£o de material sobre m√©todos pull e push no GitOps, vimos interesse nesse modelo como um todo; no entanto, havia ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>O que √© GitOps?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/458878/"> <i><b>Nota</b></i>  <i><b>perev.</b></i>  <i>: Ap√≥s a recente publica√ß√£o de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">material</a> sobre m√©todos pull e push no GitOps, vimos interesse nesse modelo como um todo; no entanto, havia muito poucas publica√ß√µes em russo sobre esse t√≥pico (elas simplesmente n√£o est√£o no hub).</i>  <i>Portanto, temos o prazer de chamar a aten√ß√£o para a tradu√ß√£o de outro artigo - h√° quase um ano!</i>  <i>- da empresa Weaveworks, cujo chefe cunhou o termo "GitOps".</i>  <i>O texto explica a ess√™ncia da abordagem e as principais diferen√ßas das existentes.</i> <br><br><img src="https://habrastorage.org/webt/i0/8b/fc/i08bfcph3kkhapzkitpwhylzdhc.png"><br><br>  H√° um ano, publicamos uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">introdu√ß√£o ao GitOps</a> .  Depois, conversamos sobre como a equipe do Weaveworks lan√ßou o SaaS baseado em Kubernetes e desenvolveu um conjunto de pr√°ticas recomendadas prescritivas para implantar, gerenciar e monitorar em um ambiente nativo da nuvem. <a name="habracut"></a><br><br>  O artigo acabou sendo popular.  Outras pessoas come√ßaram a falar sobre GitOps, come√ßaram a publicar novas ferramentas para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">git push</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">desenvolvimento</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">segredos</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fun√ß√µes</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">integra√ß√£o cont√≠nua</a> etc.  Um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">grande n√∫mero de</a> publica√ß√µes e casos de uso do GitOps apareceu em nosso site.  Mas algumas pessoas ainda t√™m d√∫vidas.  Como o modelo difere da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">infraestrutura</a> tradicional <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">como c√≥digo</a> e entrega cont√≠nua?  √â obrigat√≥rio usar o Kubernetes? <br><br>  Logo percebemos que era necess√°ria uma nova descri√ß√£o, oferecendo: <br><br><ol><li>  Um grande n√∫mero de exemplos e hist√≥rias; </li><li>  A defini√ß√£o espec√≠fica de GitOps; </li><li>  Compara√ß√£o com entrega cont√≠nua tradicional. </li></ol><br>  Neste artigo, tentamos abordar todos esses t√≥picos.  Nele, voc√™ encontrar√° uma introdu√ß√£o atualizada ao GitOps e uma vis√£o do lado dos desenvolvedores e do CI / CD.  N√≥s nos concentramos principalmente no Kubernetes, embora o modelo possa ser generalizado. <br><br><h2>  Conhe√ßa GitOps </h2><br>  Imagine Alice.  Ela administra a Family Insurance, uma empresa que oferece ap√≥lices de seguro de sa√∫de, carro, im√≥veis e viagens para pessoas que est√£o ocupadas demais para entender as nuances de seus contratos por conta pr√≥pria.  Seu neg√≥cio come√ßou como um projeto paralelo quando Alice trabalhou no banco como cientista de dados.  Uma vez que ela percebeu que poderia usar algoritmos avan√ßados de computador para analisar com mais efici√™ncia os dados e formar pacotes de seguros.  Os investidores financiaram o projeto e agora sua empresa fatura mais de US $ 20 milh√µes por ano e est√° crescendo rapidamente.  Atualmente, 180 pessoas trabalham em v√°rios cargos.  Entre eles, uma equipe de tecnologia que desenvolve, mant√©m um site, um banco de dados e analisa a base de clientes.  Uma equipe de 60 pessoas √© liderada por Bob, diretor t√©cnico da empresa. <br><br>  A equipe de Bob est√° implantando sistemas de produ√ß√£o na nuvem.  Seus principais aplicativos s√£o executados no GKE, aproveitando o Kubernetes no Google Cloud.  Al√©m disso, eles usam v√°rias ferramentas para trabalhar com dados e an√°lises em seu trabalho. <br><br>  O Family Insurance n√£o usaria cont√™ineres, mas estava infectado com entusiasmo por Docker.  Em breve, os especialistas da empresa descobriram que o GKE facilita e facilita a implanta√ß√£o de clusters para testar novos recursos.  Foram adicionados Jenkins para CI e Quay para organizar o registro de cont√™iner, foram escritos scripts para Jenkins que enviam ou novos cont√™ineres e configura√ß√µes no GKE. <br><br>  Algum tempo se passou.  Alice e Bob ficaram desapontados com o desempenho da abordagem escolhida e seu impacto nos neg√≥cios.  A introdu√ß√£o de cont√™ineres n√£o aumentou a produtividade tanto quanto a equipe esperava.  √Äs vezes, as implanta√ß√µes eram interrompidas e n√£o era claro se as altera√ß√µes no c√≥digo eram respons√°veis.  Tamb√©m se mostrou dif√≠cil rastrear altera√ß√µes nas configura√ß√µes.  Muitas vezes, era necess√°rio criar um novo cluster e mover aplicativos para ele, pois era a maneira mais f√°cil de eliminar a bagun√ßa na qual o sistema se transformou.  Alice temia que a situa√ß√£o piorasse √† medida que o aplicativo se desenvolvesse (al√©m disso, um novo projeto baseado no aprendizado de m√°quina estava sendo produzido).  Bob automatizou a maior parte do trabalho e n√£o entendeu por que o pipeline ainda √© inst√°vel, n√£o escala bem e requer interven√ß√£o manual de tempos em tempos? <br><br>  <b>Ent√£o eles aprenderam sobre o GitOps.</b>  <b>Essa decis√£o acabou sendo exatamente o que eles precisavam para avan√ßar com confian√ßa.</b> <br><br>  Alice e Bob ouviram falar sobre fluxos de trabalho baseados em Git, DevOps e infraestrutura como c√≥digo h√° anos.  A singularidade do GitOps √© que ele traz v√°rias pr√°ticas recomendadas - categ√≥ricas e normativas - para implementar essas id√©ias no contexto do Kubernetes.  Este t√≥pico <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">foi levantado repetidamente</a> , inclusive <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no blog do Weaveworks</a> . <br><br>  O Seguro de Fam√≠lia decide implementar GitOps.  A empresa agora possui um modelo operacional automatizado compat√≠vel com o Kubernetes que combina <i>velocidade</i> com <i>estabilidade</i> , pois: <br><br><ul><li>  descobriu que a equipe dobrou a produtividade e ningu√©m est√° ficando louco; </li><li>  parou de executar scripts.  Em vez disso, agora eles podem se concentrar em novos recursos e melhorar os m√©todos de engenharia - por exemplo, introduzir lan√ßamentos de can√°rios e melhorar os testes; </li><li>  processo de implanta√ß√£o aprimorado - agora raramente quebra; </li><li>  teve a oportunidade de recuperar implanta√ß√µes ap√≥s falhas parciais sem interven√ß√£o manual; </li><li>  ganhou maior confian√ßa nos sistemas de suprimentos.  Alice e Bob descobriram que a equipe pode ser dividida em grupos que trabalham em microsservi√ßos e trabalham em paralelo; </li><li>  pode fazer de 30 a 50 mudan√ßas no projeto todos os dias pelos esfor√ßos de cada grupo e tentar novas t√©cnicas; </li><li>  eles s√£o facilmente atra√≠dos para o projeto por novos desenvolvedores que t√™m a capacidade de lan√ßar atualiza√ß√µes na produ√ß√£o usando solicita√ß√µes pull em poucas horas; </li><li>  auditado facilmente no SOC2 <i>(para conformidade dos provedores de servi√ßos com requisitos para gerenciamento seguro de dados; leia mais, por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> - trad. aprox.)</i> . </li></ul><br><h3>  O que aconteceu </h3><br>  GitOps s√£o duas coisas: <br><br><ol><li>  Modelo de opera√ß√£o para Kubernetes e nativo da nuvem.  Ele fornece um conjunto de pr√°ticas recomendadas para implantar, gerenciar e monitorar clusters e aplicativos em cont√™iner.  Defini√ß√£o elegante em um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√∫nico slide</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Luis Faceira</a> : <br><br><img src="https://habrastorage.org/webt/or/fl/uu/orfluutk_hcqu6dnclf6pu1ewes.jpeg"></li><li>  O caminho para criar um ambiente orientado ao desenvolvedor para gerenciar aplicativos.  Aplicamos o fluxo de trabalho do Git √† explora√ß√£o e desenvolvimento.  Observe que n√£o se trata apenas de push do Git, mas de organizar todo o conjunto de ferramentas de CI / CD e UI / UX. </li></ol><br><h3>  Algumas palavras sobre o Git </h3><br>  Se voc√™ n√£o estiver familiarizado com os sistemas de controle de vers√£o e o fluxo de trabalho baseado em Git, √© altamente recomend√°vel que voc√™ os estude.  A princ√≠pio, trabalhar com solicita√ß√µes de ramifica√ß√µes e pull pode parecer magia negra, mas os profissionais valem o esfor√ßo.  Aqui est√° um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bom artigo</a> para voc√™ come√ßar. <br><br><h2>  Como o Kubernetes funciona </h2><br>  Em nossa hist√≥ria, Alice e Bob se voltaram para o GitOps depois de trabalhar com o Kubernetes por um tempo.  De fato, o GitOps est√° intimamente ligado ao Kubernetes - √© um modelo operacional para a infraestrutura e aplicativos baseados no Kubernetes. <br><br><h3>  O que o Kubernetes oferece aos usu√°rios? </h3><br>  Aqui est√£o alguns dos principais recursos: <br><br><ol><li>  No modelo Kubernetes, tudo pode ser descrito de forma declarativa. </li><li>  O servidor da API do Kubernetes aceita essa declara√ß√£o como entrada e, em seguida, tenta constantemente trazer o cluster para o estado descrito na declara√ß√£o. </li><li>  As declara√ß√µes s√£o suficientes para descrever e gerenciar uma ampla variedade de cargas de trabalho - "aplicativos". </li><li>  Como resultado, as altera√ß√µes no aplicativo e no cluster devem-se a: <br><ul><li>  altera√ß√µes nas imagens do cont√™iner; </li><li>  altera√ß√µes na especifica√ß√£o declarativa; </li><li>  erros no ambiente - por exemplo, travamentos de cont√™ineres. </li></ul></li></ol><br><h3>  As grandes habilidades de converg√™ncia de Kubernetes </h3><br>  Quando um administrador faz altera√ß√µes na configura√ß√£o, o orquestrador do Kubernetes as aplicar√° ao cluster at√© que seu estado se <i>aproxime da nova configura√ß√£o</i> .  Este modelo funciona para qualquer recurso Kubernetes e se estende √†s Defini√ß√µes de Recursos Customizados (CRDs).  Portanto, as implanta√ß√µes do Kubernetes t√™m as seguintes propriedades maravilhosas: <br><br><ul><li>  <b>Automa√ß√£o</b> : as atualiza√ß√µes do Kubernetes fornecem um mecanismo para automatizar o processo de aplica√ß√£o das altera√ß√µes corretamente e em tempo h√°bil. </li><li>  <b>Converg√™ncia</b> : o Kubernetes continuar√° tentando as atualiza√ß√µes at√© o sucesso. </li><li>  <b>Idempot√™ncia</b> : aplica√ß√µes repetidas de converg√™ncia produzem o mesmo resultado. </li><li>  <b>Determinismo</b> : com recursos suficientes, o estado do cluster atualizado depende apenas do estado desejado. </li></ul><br><h2>  Como o GitOps funciona </h2><br>  N√≥s aprendemos o suficiente sobre o Kubernetes para explicar como o GitOps funciona. <br><br>  Vamos voltar √†s equipes de Seguros familiares relacionadas aos microsservi√ßos.  O que eles geralmente t√™m que fazer?  Veja a lista abaixo (se algum ponto parecer estranho ou desconhecido - adie as cr√≠ticas e fique conosco).  Estes s√£o apenas exemplos de fluxos de trabalho baseados em Jenkins.  Existem muitos outros processos ao trabalhar com outras ferramentas. <br><br>  O principal √© que vemos que cada atualiza√ß√£o termina com altera√ß√µes nos arquivos de configura√ß√£o e nos reposit√≥rios Git.  Essas altera√ß√µes no Git fazem com que a "instru√ß√£o GitOps" atualize o cluster: <br><br>  1. Fluxo de trabalho: " <i>Jenkins Build - filial principal</i> ". <br>  A lista de tarefas: <br><br><ul><li>  Jenkins envia imagens marcadas no Quay; </li><li>  Jenkins envia gr√°ficos de configura√ß√£o e Helm para o bucket de armazenamento principal; </li><li>  A fun√ß√£o cloud copia a configura√ß√£o e os gr√°ficos do bucket de armazenamento principal para o reposit√≥rio master git; </li><li>  A instru√ß√£o GitOps atualiza o cluster. </li></ul><br>  2. <i>Jenkins build - release ou hotfix branch</i> : <br><br><ul><li>  Jenkins envia imagens n√£o identificadas no Quay; </li><li>  Jenkins envia os gr√°ficos de configura√ß√£o e Helm para o balde de armazenamento tempor√°rio; </li><li>  A fun√ß√£o de nuvem copia a configura√ß√£o e os gr√°ficos do bucket do armazenamento tempor√°rio para o armazenamento tempor√°rio do reposit√≥rio Git; </li><li>  A instru√ß√£o GitOps atualiza o cluster. </li></ul><br>  3. <i>Jenkins build - ramo de desenvolvimento ou recurso</i> : <br><br><ul><li>  Jenkins envia imagens n√£o identificadas no Quay; </li><li>  Jenkins envia os gr√°ficos de configura√ß√£o e Helm para o dep√≥sito de desenvolvimento; </li><li>  A fun√ß√£o de nuvem copia a configura√ß√£o e os gr√°ficos do dep√≥sito de armazenamento de desenvolvimento para o reposit√≥rio git de desenvolvimento; </li><li>  A instru√ß√£o GitOps atualiza o cluster. </li></ul><br>  4. <i>Adicionando um novo cliente</i> : <br><br><ul><li>  Um gerente ou administrador (LCM / ops) chama a Gradle para implantar e configurar inicialmente os balanceadores de carga de rede (NLBs); </li><li>  LCM / ops confirma uma nova configura√ß√£o para preparar a implanta√ß√£o para atualiza√ß√µes; </li><li>  A instru√ß√£o GitOps atualiza o cluster. </li></ul><br><h3>  Breve descri√ß√£o do GitOps </h3><br><ol><li>  Descreva o estado desejado de todo o sistema usando especifica√ß√µes declarativas para cada ambiente (em nosso hist√≥rico, a equipe de Bob define toda a configura√ß√£o do sistema no Git). <br><br><ul><li>  O reposit√≥rio git √© a √∫nica fonte de verdade sobre o estado desejado de todo o sistema. </li><li>  Todas as altera√ß√µes no estado desejado s√£o feitas atrav√©s de confirma√ß√µes no Git. </li><li>  Todos os par√¢metros de cluster desejados tamb√©m s√£o observ√°veis ‚Äã‚Äãno pr√≥prio cluster.  Assim, podemos determinar se os estados desejados e observados coincidem (convergem, <i>convergem</i> ) ou diferem ( <i>divergem</i> , <i>divergem</i> ). </li></ul></li><li>  Se os estados desejados e observados forem diferentes, ent√£o: <br><br><ul><li>  Existe um mecanismo de converg√™ncia que, mais cedo ou mais tarde, sincroniza automaticamente o destino e os estados observados.  Dentro do cluster, o Kubernetes faz isso. </li><li>  O processo come√ßa imediatamente com uma notifica√ß√£o de "altera√ß√£o confirmada". </li><li>  Ap√≥s um per√≠odo de tempo configur√°vel, um alerta de diferen√ßa pode ser enviado se os estados forem diferentes. </li></ul></li><li>  Portanto, todas as confirma√ß√µes no Git acionam atualiza√ß√µes verific√°veis ‚Äã‚Äãe idempotentes no cluster. <br><br><ul><li>  A revers√£o √© uma converg√™ncia para um estado anteriormente desejado. </li></ul></li><li>  A converg√™ncia √© final.  Sobre o seu in√≠cio, testemunhe: <br><br><ul><li>  Falta de alertas "diff" por um determinado per√≠odo de tempo. </li><li>  Um alerta convergente (por exemplo, webhook, evento de write-back do Git). </li></ul></li></ol><br><h3>  O que √© diverg√™ncia? </h3><br>  Repetimos novamente: <i>todas as propriedades desejadas do cluster devem ser observ√°veis ‚Äã‚Äãno pr√≥prio cluster</i> . <br><br>  Alguns exemplos de diverg√™ncia: <br><br><ul><li>  Mudan√ßa no arquivo de configura√ß√£o devido √† mesclagem de ramifica√ß√µes no Git. </li><li>  Uma altera√ß√£o no arquivo de configura√ß√£o devido a uma confirma√ß√£o no Git feita pelo cliente da GUI. </li><li>  V√°rias altera√ß√µes no estado desejado devido ao PR no Git com a montagem subsequente da imagem do cont√™iner e altera√ß√µes na configura√ß√£o. </li><li>  Altera√ß√£o do estado do cluster devido a um erro, conflito de recursos levando a "mau comportamento" ou apenas um desvio acidental do estado original. </li></ul><br><h3>  O que √© um mecanismo de converg√™ncia? </h3><br>  Alguns exemplos: <br><br><ul><li>  Para cont√™ineres e clusters, o mecanismo de converg√™ncia fornece o Kubernetes. </li><li>  O mesmo mecanismo pode ser usado para gerenciar aplicativos e designs baseados no Kubernetes (por exemplo, Istio e Kubeflow). </li><li>  O mecanismo para gerenciar a intera√ß√£o de trabalho entre o Kubernetes, os reposit√≥rios de imagens e o Git √© fornecido <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pelo operador Weave Flux GitOps</a> , que faz parte do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Weave Cloud</a> . </li><li>  Para m√°quinas de base, o mecanismo de converg√™ncia deve ser declarativo e aut√¥nomo.  De nossa pr√≥pria experi√™ncia, podemos dizer que o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Terraform est√°</a> mais pr√≥ximo dessa defini√ß√£o, mas ainda requer controle humano.  Nesse sentido, o GitOps estende a tradi√ß√£o da infraestrutura como c√≥digo. </li></ul><br>  O GitOps combina o Git com o excelente mecanismo de converg√™ncia do Kubernetes, oferecendo um modelo para opera√ß√£o. <br><br>  O GitOps nos permite declarar que <i>apenas os sistemas que podem ser descritos e observados podem ser automatizados e controlados</i> . <br><br><h3>  GitOps √© para toda a pilha nativa da nuvem (por exemplo, Terraform etc.) </h3><br>  GitOps n√£o √© apenas Kubernetes.  Queremos que todo o sistema seja gerenciado declarativamente e use converg√™ncia.  Por um sistema inteiro, queremos dizer um conjunto de ambientes que trabalham com o Kubernetes - por exemplo, ‚Äúdev cluster 1‚Äù, ‚Äúprodu√ß√£o‚Äù etc. Cada ambiente inclui m√°quinas, clusters, aplicativos, bem como interfaces para servi√ßos externos que fornecem dados, monitoramento e etc. <br><br>  Observe como o Terraform √© importante neste caso para o problema de inicializa√ß√£o.  O Kubernetes precisa ser implantado em algum lugar, e o uso do Terraform significa que podemos usar os mesmos fluxos de trabalho do GitOps para criar a camada de controle subjacente ao Kubernetes e aplicativos.  Essa √© uma boa pr√°tica recomendada. <br><br>  √â dada muita aten√ß√£o √† aplica√ß√£o dos conceitos do GitOps a camadas sobre o Kubernetes.  Atualmente, existem solu√ß√µes do tipo GitOps para Istio, Helm, Ksonnet, OpenFaaS e Kubeflow, bem como, por exemplo, para Pulumi, que criam uma camada para o desenvolvimento de aplicativos nativos da nuvem. <br><br><h2>  Kubernetes CI / CD: comparando GitOps com outras abordagens </h2><br>  Como afirmado, GitOps s√£o duas coisas: <br><br><ol><li>  O modelo operacional para o Kubernetes e o nativo da nuvem descrito acima. </li><li>  O caminho para organizar um ambiente de gerenciamento de aplicativos centrado no desenvolvedor. </li></ol><br>  Para muitos, o GitOps √© principalmente um fluxo de trabalho baseado em push do Git.  N√≥s tamb√©m gostamos dele.  Mas isso n√£o √© tudo: vamos agora olhar para os pipelines de CI / CD. <br><br><h3>  GitOps fornece implanta√ß√£o cont√≠nua (CD) para Kubernetes </h3><br>  O GitOps oferece um mecanismo de implanta√ß√£o cont√≠nua que elimina a necessidade de "sistemas de gerenciamento de implanta√ß√£o" separados.  O Kubernetes faz todo o trabalho para voc√™. <br><br><ul><li>  A atualiza√ß√£o do aplicativo requer atualiza√ß√£o no Git.  Esta √© uma atualiza√ß√£o transacional para o estado desejado.  A ‚Äúimplanta√ß√£o‚Äù √© realizada dentro do cluster pelo pr√≥prio Kubernetes com base em uma descri√ß√£o atualizada. </li><li>  Devido √†s especificidades do Kubernetes, essas atualiza√ß√µes s√£o convergentes.  Isso fornece um mecanismo para implanta√ß√£o cont√≠nua em que todas as atualiza√ß√µes s√£o at√¥micas. </li><li>  Nota: O <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Weave Cloud</a> oferece um operador GitOps que integra o Git e o Kubernetes e permite executar um CD, correspondendo ao estado desejado e atual do cluster. </li></ul><br><h3>  Sem kubectl e scripts </h3><br>  Evite usar o Kubectl para atualizar o cluster e, especialmente, scripts para agrupar comandos do kubectl.  Em vez disso, com um pipeline GitOps, um usu√°rio pode atualizar seu cluster Kubernetes atrav√©s do Git. <br><br>  Os benef√≠cios incluem: <br><br><ol><li>  <b>Corre√ß√£o</b> .  Um grupo de atualiza√ß√µes pode ser aplicado, convergido e finalmente validado, o que nos aproxima do objetivo da implanta√ß√£o at√¥mica.  Pelo contr√°rio, o uso de scripts n√£o oferece nenhuma garantia de converg√™ncia (mais sobre isso abaixo). </li><li>  <b>Seguran√ßa</b>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Citando</a> Kelsey Hightower: ‚ÄúLimite o acesso ao cluster Kubernetes a ferramentas de automa√ß√£o e administradores respons√°veis ‚Äã‚Äãpela depura√ß√£o ou manuten√ß√£o do mesmo‚Äù.  Veja tamb√©m <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">minha publica√ß√£o</a> sobre seguran√ßa e conformidade, bem como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um artigo sobre hackers da Homebrew</a> roubando credenciais de um script de Jenkins descuidadamente escrito. </li><li>  <b>Experi√™ncia do usu√°rio</b> .  O Kubectl exp√µe a mec√¢nica do modelo de objetos Kubernetes, que √© bastante complexo.  Idealmente, os usu√°rios devem interagir com o sistema em um n√≠vel mais alto de abstra√ß√£o.  Aqui, refiro-me novamente a Kelsey e recomendo examinar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">esse curr√≠culo</a> . </li></ol><br><h3>  A diferen√ßa entre IC e CD </h3><br>  O GitOps aprimora os modelos de CI / CD existentes. <br><br>  O servidor de CI moderno √© um instrumento para orquestra√ß√£o.  Em particular, √© um instrumento para orquestrar pipelines de IC.  Eles incluem compila√ß√£o, teste, mesclagem ao tronco, etc. Os servidores de CI automatizam o gerenciamento de pipelines complexos de v√°rias etapas.  Uma tenta√ß√£o comum √© criar um script para o conjunto de atualiza√ß√µes do Kubernetes e execut√°-lo como um elemento de pipeline para enviar altera√ß√µes ao cluster.  De fato, √© isso que muitos especialistas fazem.  No entanto, isso n√£o √© ideal, e aqui est√° o porqu√™. <br><br>  O IC deve ser usado para fazer atualiza√ß√µes no tronco, e o cluster Kubernetes deve mudar automaticamente com base nessas atualiza√ß√µes para gerenciar o CD "internamente".  Chamamos isso de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">modelo pull para o CD</a> , diferentemente do modelo push de IC.  O CD faz parte de uma <i>orquestra√ß√£o de tempo</i> de <i>execu√ß√£o</i> . <br><br><h3>  Por que os servidores de CI n√£o devem criar CDs por meio de atualiza√ß√µes diretas no Kubernetes </h3><br>  <i>N√£o use o servidor de IC para orquestrar atualiza√ß√µes diretas no Kubernetes como um conjunto de tarefas de IC.</i>  <i>Esse √© o antipadr√£o que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">j√° falamos</a> em nosso blog.</i> <br><br>  Vamos voltar para Alice e Bob. <br><br>  Que problemas eles encontraram?  O servidor de IC de Bob aplica as altera√ß√µes ao cluster, mas se ele cair no processo, Bob n√£o saber√° em que estado o cluster est√° (ou deveria estar) e como corrigi-lo.  O mesmo vale se for bem-sucedido. <br><br>  Vamos supor que a equipe de Bob montou uma nova imagem e depois corrigiu suas implanta√ß√µes para implantar a imagem (todas do pipeline de IC). <br><br>  Se a imagem for criada normalmente, mas o pipeline cair, a equipe precisar√° descobrir: <br><br><ul><li>  A atualiza√ß√£o foi implantada? </li><li>  Estamos iniciando uma nova compila√ß√£o?        ‚Äî           ? </li><li>      ,    ? </li><li>     ?     (     )? </li></ul><br> <i>   Git'    ,        .  -    push' ,    -  ;          --.</i> <br><br> ,   CI-    CD: <br><br><ul><li>     ;     . </li><li> CI-      . </li><li>   .       . </li><li>      . </li></ul><br> <i>  Helm'e:     Helm,      GitOps-,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Flux-Helm</a> .    .    Helm    ,  .</i> <br><br><h2> GitOps     Continuous Delivery  Kubernetes </h2><br>      GitOps  ,        ,     .     , ,     . ,         ,  GitOps      . <br><br><h3>    Kubernetes </h3><br>    .   Git            : <br><br><ul><li>   ,       Git      . </li><li>  Runtime GitOps,      .       Git     . </li></ul><br><img src="https://habrastorage.org/webt/0h/mo/vs/0hmovs2jg182thgg_hxll6jabwk.png"><br><br><h3>   ? </h3><br><ol><li> <b> </b> :  ,      ,   Git   .  ,     CI  runtime-.    ¬´ ¬ª <i>(immutability firewall)</i> ,       .          72-87 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> . </li><li> <b>   CI-  Git-</b> : GitOps    .       CI-  Git-,     .      Continuous Delivery     CI-/Git-   .        cloud native.   GitOps     . </li><li> <b>   </b> :     Git , Weave Flux (  Weave Cloud)    runtime.  ,  Kubernetes   , Git .           GitOps,   . </li></ol><br><img src="https://habrastorage.org/webt/xh/wn/83/xhwn83itzgegzohc4vyp2sprpe8.png"><br><br><h2>  Conclus√£o </h2><br> GitOps    ,     CI/CD: <br><br><ul><li> ; </li><li> ; </li><li> ; </li><li> . </li></ul><br>  ,          cloud native. <br><br><ul><li>           ,    runbook' <i>(     ‚Äî . .)</i> ,    deployment'. </li><li>   cloud native-         ,        . </li></ul><br>   ,              . GitOps  -      . <br><br><h2>  PS do tradutor </h2><br>  Leia tamb√©m em nosso blog: <br><br><ul><li> ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> werf 1.0 stable:    GitOps,   </a> ¬ª; </li><li> ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitOps:   Pull  Push</a> ¬ª; </li><li> ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  kubedog     Kubernetes</a> ¬ª; </li><li> ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   Kubernetes (   )</a> ¬ª. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt458878/">https://habr.com/ru/post/pt458878/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt458866/index.html">Como o balanceador de equipe funciona no World of Tanks Blitz</a></li>
<li><a href="../pt458868/index.html">Barulho no big data. An√°lise de entropia</a></li>
<li><a href="../pt458870/index.html">Problemas de computador mais populares que enfrentamos todos os dias</a></li>
<li><a href="../pt458874/index.html">Lista de verifica√ß√£o ASO: otimiza√ß√£o de texto</a></li>
<li><a href="../pt458876/index.html">Friday Mini CTF</a></li>
<li><a href="../pt458880/index.html">Desenvolvimento Linux no Windows com WSL e Visual Studio Code Remote</a></li>
<li><a href="../pt458882/index.html">Falar em p√∫blico. Brevemente sobre o principal</a></li>
<li><a href="../pt458884/index.html">Um pouco sobre os padr√µes de comunica√ß√£o espacial</a></li>
<li><a href="../pt458886/index.html">Mais √∫teis Mail.ru Design Conf √ó Dribbble Meetup 2019 Papers por True Engineering</a></li>
<li><a href="../pt458888/index.html">Summer Droid Meetup</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>