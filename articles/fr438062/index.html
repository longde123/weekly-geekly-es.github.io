<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïí ü§∞üèΩ üîÉ Mon adresse n'est pas une maison ou une rue, mon adresse est l'Union sovi√©tique? ü§∑üèø üâë üôÜ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="microBIGDATA ou FIAS dans votre poche 


 Peter Brueghel le Jeune, paiement des imp√¥ts , 1640 

 La derni√®re entr√©e sur le rasoir sur les objets a dis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mon adresse n'est pas une maison ou une rue, mon adresse est l'Union sovi√©tique?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438062/">  <b>microBIGDATA ou FIAS dans votre poche</b> <br><br><img src="https://habrastorage.org/webt/gq/le/vh/gqlevhij14f0jkubb4pmbjwvb5u.jpeg"><br>  <i>Peter Brueghel le Jeune, <b>paiement des imp√¥ts</b> , 1640</i> <br><br>  La derni√®re entr√©e sur le rasoir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur les objets a</a> disparu.  Nous continuerons la reconnaissance au combat.  Aujourd'hui, nous allons parler du difficile.  Il ne s'agit pas encore de BIG DATA, mais il est d√©j√† peu pratique de travailler - de tr√®s grandes quantit√©s de donn√©es.  Tout le monde ne rentrera pas dans toute la RAM, mais certains ne rentreront m√™me pas sur le disque (il n'y a pas assez d'espace, mais beaucoup de d√©chets).  Le nom de notre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">base de donn√©es FIAS de</a> confiance est la base de donn√©es du syst√®me f√©d√©ral d'information sur les adresses.  Archive de 5,5 Go.  Et il est compress√© dans une archive XML.  Apr√®s le d√©ballage, il y aura 53 Go (stockez 110 Go pour le d√©ballage).  Et lorsque vous commencez √† l'analyser et √† le convertir, 110 Go ne suffiront pas.  √Ä propos de la quantit√© requise de RAM sera √©galement. <br><a name="habracut"></a><br>  Tout irait bien, mais vous pouvez creuser plus loin.  Il existe un tel projet international de collecte et de syst√©matisation de donn√©es open source - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">OpenAddresses</a> .  Il y aura donc plus de bases de donn√©es.  La couverture actuelle de la plan√®te comporte de nombreux points blancs, par exemple, la Russie est presque absente.  La taille de l'archive est de 10 Go. <br><br>  Ou une base de donn√©es d'un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">projet OpenStreetMaps</a> assez connu.  Il est construit par des b√©n√©voles sur la base de Wikip√©dia.  Assez d√©taill√© et multilingue.  Maintenant une archive compl√®te de XML compress√© d'une taille de 74 Go. <br><blockquote>  S'ils ont commenc√© √† parler d'adresses, des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nouvelles</a> inattendues <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sont arriv√©es √† temps de DuckDuckGo</a> , le meilleur moteur de recherche s√©curis√© pour aujourd'hui, sur sa transition vers les cartes Apple.  Plus pr√©cis√©ment sur Apple MapKit JS.  La caract√©ristique la plus int√©ressante dans notre contexte est la ¬´recherche d'adresse am√©lior√©e¬ª.  Apple est-il le meilleur qui collecte et prot√®ge minutieusement nos donn√©es?  Il faudra tracer ... </blockquote>  Donc le d√©fi.  Comment mettre toute cette richesse d'adresses dans un r√©f√©rentiel agr√©able √† utiliser, pour vous permettre de r√™ver d'une API gratuite (en Python, bien s√ªr) et de ne pas laisser votre cher fer √† repasser sur une charge non lue.  Appelons √ßa MicroBigData - mcBD ou ŒºBG en anglais :-) <br><br>  Dans l'√©conomie de chaque deuxi√®me (ou m√™me premier) d√©veloppeur, cette chose est un r√©pertoire d'adresses, c'est aussi un r√©pertoire de toponymes, chose tr√®s n√©cessaire.  Et quand c'est aussi normatif, pr√©par√©, nettoy√© et bien document√© par le bon corps, c'est juste un conte de f√©es.  Il faut rendre hommage, le fisc russe fait bien sa production num√©rique.  Autant que possible.  Il y a probablement des d√©fauts √† l'int√©rieur et le nettoyage des donn√©es se poursuit.  Comment r√©soudre ce probl√®me, laissez les chefs d'√âtat r√©fl√©chir.  Ils d√©cident pour nous-m√™mes et pour notre b√©n√©fice √† tous.  √Ä propos, une faute de frappe de FIAS a √©t√© trouv√©e dans l'exemple ci-dessous.  Le r√©sultat n'est pas affect√©.  Je ne l'ai pas r√©par√©.  Trouverez-vous? <br><br>  Je ne sais pas dans quelle mesure les donn√©es d'adresse sont pertinentes dans vos projets - ce sont toutes les r√©gions, les villes, les rues.  Mais il semble que pas un seul projet pour les gens ne puisse s'en passer.  C'est l'adresse o√π chercher une personne ou o√π lui envoyer des colis.  Les d√©tails du passeport ou de tout autre document doivent √™tre enregistr√©s.  Ou peut-√™tre que c'est l'adresse du bureau de travail ou des attractions qu'il est recommand√© de visiter.  Et que faire?  O√π trouver <br><br>  La solution la plus simple, sans tenir compte des erreurs et des doublons, est des objets primitifs contenant de simples litt√©raux de cha√Æne (ce sont des constantes de cha√Æne, ils sont √©galement de la cha√Æne).  Laissez les utilisateurs y entrer les prochaines entr√©es re√ßues.  Et les objets sont capables de se sauver - nous avons d√©j√† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©ussi cela</a> . <br><br>  De tels objets sont, par exemple, tels que d√©crits dans la classe ci-dessous.  <a href="">Directement √† partir du manuel</a> , quoique am√©ricain, mais adapt√© √† notre r√©alit√© russe - au lieu de leur ZIP, il y aura notre code postal.  Je voudrais √©galement remplacer le code postal par un num√©ro, mais pour des raisons de monotonie, je laisse une cha√Æne.  Quiconque reconna√Æt imm√©diatement un langage, et c'est ObjectScript, a droit √† un semblable encourageant. <br><br><pre><code class="plaintext hljs">Class Soviet.Address Extends %Persistent { Property streetName As %String; Property cityName As %String; Property areaName As %String; Property postalCode As %String; }</code> </pre> <br>  Bien s√ªr, beaucoup seront indign√©s, ils disent que tout sort des poches de l‚Äôobjet (litt√©raux).  O√π l'a-t-on vu, pour que l'objet fasse briller ses champs publiquement?!  Laissons-le de cette fa√ßon, cela fait trop mal un exemple √©loquent et est compr√©hensible pour tout √©tudiant. <br><br>  C'est en fait tout ce qui est n√©cessaire.  Rempli dans les champs.  Mettez en stockage.  Transf√©r√© √† d'autres objets pour le travail.  H√©rit√©e √† la suite de quelqu'un.  Tout fonctionne.  Et stock√©! <br><blockquote>  Mais quelques mots pourquoi cela ne vaut pas la peine, il faut le dire.  Quelle est notre adresse d'objet?  Pourquoi ne peut-il pas s'agir simplement d'un groupe de cha√Ænes de texte?  Les objections les plus √©videntes qui viennent √† l'esprit viennent du contexte - qui utilise cette adresse, sous quelle forme et dans quel but?  Essayez de mettre de c√¥t√© votre r√©flexion sur la programmation et imaginez comment un ¬´touriste √©tranger¬ª, un ¬´historien¬ª, un ¬´inspecteur des imp√¥ts¬ª, un ¬´avocat¬ª, etc. <br><br>  Je pense qu'imm√©diatement, une multitude de questions et de clarifications suppl√©mentaires se posent: quelle langue utiliser, dans quel codage stocker et donner, √† quelle √©poque classer, quels documents sont mis en ≈ìuvre, l√©gaux ou postaux?  Une ville est-elle un r√®glement nomm√© ou quoi?  M√™me une rue peut se r√©v√©ler √™tre un boulevard, une rue lat√©rale, une avenue ou autre chose.  Que faire de tous ces d√©tails d'impl√©mentation importants? <br><br>  Prenons un exemple vivant.  Google est d√©sormais g√©r√© par Sundar Pichai.  Lui-m√™me est originaire de l'Inde.  N√© dans la ville de Chennai (alias Chennai).  Ou √† Madras?  En 1996, les Indiens ont d√©cid√© que le nom de la ville √©tait tr√®s portugais et renomm√© la capitale du Tamil Nadu de Madras √† Chennai.  Et que devraient √©crire Sundar et 72 millions de ses compatriotes dans ses documents √©lectroniques? <br><br>  En g√©n√©ral, toute la science traite de cela - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la toponymie appliqu√©e</a> . </blockquote>  Donc, des questions se posent.  Comment g√©rer l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">heure et la date</a> ?  L' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">argent</a> est-il si <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©vident</a> ?  Les coordonn√©es g√©ographiques sont-elles si simples?  Et comment est-ce impl√©ment√© dans votre code?  Pouvez-vous transf√©rer vers le SGBD s√©lectionn√© sans abaisser le niveau d'abstraction?  Comment ne pas glisser dans les types atomiques de donn√©es machine et penser constamment √† leur reconstruction?  Ici, il vaut la peine de chercher la source d'une API primitive ou, inversement, saine.  Pensez-y √† votre guise. <br><br>  Bref, le contexte est le plus important.  Et le mod√®le objet nous permet de l'utiliser directement √† travers l'encapsulation de ¬´donn√©es machine¬ª et la mise en ≈ìuvre d'un comportement ¬´live¬ª sensible au contexte.  Pas du tout que les tuples de bas niveau dispos√©s dans des tableaux ;-) <br><br>  En attendant, revenons √† l'impl√©mentation ¬´primitive¬ª et compliquons nos vies.  Pour commencer, √©liminez les erreurs et les doublons.  Autrement dit, nous chercherons un moyen d'√©crire des adresses tout de suite tout de suite.  Dans le m√™me temps, nous aiderons les d√©veloppeurs de l'interface utilisateur √† organiser des conseils pour les utilisateurs lors du remplissage des champs de saisie de donn√©es. <br><blockquote>  Lorsque deux personnes se r√©unissent en un seul endroit - les textes et la plate-forme de donn√©es InterSystems IRIS, le d√©veloppeur a une r√©elle opportunit√© de se d√©ployer pleinement sans quitter la machine.  Par exemple, en utilisant les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">composants d'objet int√©gr√©s iKnow et iFind</a> .  Ce sont des composants pour travailler avec des donn√©es non structur√©es et la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">recherche en texte int√©gral</a> , respectivement.  Le russe est pris en charge ¬´pr√™t √† l'emploi¬ª. </blockquote>  Tout d'abord, nous apprendrons √† l'adresse √† lire les donn√©es n√©cessaires √† partir de la source d'origine.  Heureusement, l'ensemble de donn√©es du service fiscal f√©d√©ral contient des descriptions toutes faites de la structure des documents XML.  Selon la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">description</a> jointe aux donn√©es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">du site FIAS</a> , nous avons besoin de l'ensemble de donn√©es ADDROBJ, qui, dans mon cas, correspond au fichier AS_ADDROBJ_2_250_01_04_01_01.xsd <br><br>  Ensuite, nous utiliserons le convertisseur syst√®me du mod√®le XSD vers la structure de champ correspondante de la classe% XML.Adaptor, aimablement pr√©par√©e pour nous par les d√©veloppeurs IRIS.  Le signe de pourcentage au d√©but signifie simplement qu'il s'agit d'une classe de la biblioth√®que syst√®me.  <a href="">Les d√©tails d'utilisation sont dans la documentation</a> .  Nous effectuerons des op√©rations dans le terminal. <br><br><pre> <code class="plaintext hljs">set xmlScheme = ##class(%XML.Utils.SchemaReader).%New() do xmlScheme.Process("http://localhost/AS_ADDROBJ_2_250_01_04_01_01.xsd")</code> </pre> <br>  La m√™me chose peut √™tre obtenue dans l' <a href="">Atelier IDE</a> (dans le menu Outils&gt; Compl√©ments&gt; Assistant de sch√©ma XML) ou par des requ√™tes similaires aux objets directement √† partir du code du programme. <br><br><img src="https://habrastorage.org/webt/ed/3k/8c/ed3k8cfd9t_jc8gklg_euthhihy.png"><br><br>  Puisque nous avons utilis√© le constructeur sans sp√©cifier les param√®tres, √† savoir le nom du package pour placer les classes r√©sultantes, ils se sont retrouv√©s dans le package Test.  Comme vous pouvez le voir dans la deuxi√®me commande, j'ai donn√© le fichier de sch√©ma via mon serveur Web local en Python: <br><br><pre> <code class="bash hljs">python3 -m http.server 80</code> </pre> <br>  Vous pouvez utiliser n'importe quel autre serveur http que vous aimez.  Ou t√©l√©chargez le fichier sur votre serveur IRIS et indiquez le chemin d'acc√®s direct √† celui-ci. <br><br>  En cons√©quence, nous avons deux classes qui refl√®tent pleinement la structure de notre XML adressable: <br><br><div class="spoiler">  <b class="spoiler_title">Test.AddressObjects</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">///            Class Test.AddressObjects Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "AddressObjects"; Parameter XMLSEQUENCE = 1; ///    Relationship Object As Test.Object(XMLNAME = "Object", XMLPROJECTION = "ELEMENT") [ Cardinality = many, Inverse = AddressObjects ]; }</code> </pre> <br></div></div><div class="spoiler">  <b class="spoiler_title">Test.object</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">///  : http://localhost:28869/AS_ADDROBJ_2_250_01_04_01_01.xsd Class Test.Object Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "Object"; Parameter XMLSEQUENCE = 1; ///      Property AOGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOGUID", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property FORMALNAME As %String(MAXLEN = 120, MINLEN = 1, XMLNAME = "FORMALNAME", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property REGIONCODE As %String(MAXLEN = 2, MINLEN = 2, XMLNAME = "REGIONCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property AUTOCODE As %String(MAXLEN = 1, MINLEN = 1, XMLNAME = "AUTOCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property AREACODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "AREACODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property CITYCODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "CITYCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property CTARCODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "CTARCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property PLACECODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "PLACECODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///     Property PLANCODE As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "PLANCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property STREETCODE As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "STREETCODE", XMLPROJECTION = "ATTRIBUTE"); ///     Property EXTRCODE As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "EXTRCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///      Property SEXTCODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "SEXTCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property OFFNAME As %String(MAXLEN = 120, MINLEN = 1, XMLNAME = "OFFNAME", XMLPROJECTION = "ATTRIBUTE"); ///   Property POSTALCODE As %String(MAXLEN = 6, MINLEN = 6, XMLNAME = "POSTALCODE", XMLPROJECTION = "ATTRIBUTE"); ///    Property IFNSFL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "IFNSFL", XMLPROJECTION = "ATTRIBUTE"); ///      Property TERRIFNSFL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "TERRIFNSFL", XMLPROJECTION = "ATTRIBUTE"); ///    Property IFNSUL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "IFNSUL", XMLPROJECTION = "ATTRIBUTE"); ///      Property TERRIFNSUL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "TERRIFNSUL", XMLPROJECTION = "ATTRIBUTE"); /// OKATO Property OKATO As %String(MAXLEN = 11, MINLEN = 11, XMLNAME = "OKATO", XMLPROJECTION = "ATTRIBUTE"); /// OKTMO Property OKTMO As %String(MAXLEN = 11, MINLEN = 8, XMLNAME = "OKTMO", XMLPROJECTION = "ATTRIBUTE"); ///    Property UPDATEDATE As %Date(XMLNAME = "UPDATEDATE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///     Property SHORTNAME As %String(MAXLEN = 10, MINLEN = 1, XMLNAME = "SHORTNAME", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property AOLEVEL As %Integer(XMLNAME = "AOLEVEL", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///     Property PARENTGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "PARENTGUID", XMLPROJECTION = "ATTRIBUTE"); ///   .  . Property AOID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOID", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///        Property PREVID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "PREVID", XMLPROJECTION = "ATTRIBUTE"); ///        Property NEXTID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "NEXTID", XMLPROJECTION = "ATTRIBUTE"); ///           4.0. Property CODE As %String(MAXLEN = 17, MINLEN = 0, XMLNAME = "CODE", XMLPROJECTION = "ATTRIBUTE"); ///      4.0      (  ) Property PLAINCODE As %String(MAXLEN = 15, MINLEN = 0, XMLNAME = "PLAINCODE", XMLPROJECTION = "ATTRIBUTE"); ///     .     .      . /// 0 ‚Äì   /// 1 -  Property ACTSTATUS As %Integer(XMLNAME = "ACTSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///   Property CENTSTATUS As %Integer(XMLNAME = "CENTSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///     ‚Äì    (.   OperationStatus): /// 01 ‚Äì ; /// 10 ‚Äì ; /// 20 ‚Äì ; /// 21 ‚Äì  ; /// 30 ‚Äì ; /// 31 -     ; /// 40 ‚Äì    (); /// 41 ‚Äì     ; /// 42 -        ; /// 43 -         ; /// 50 ‚Äì ; /// 51 ‚Äì     ; /// 60 ‚Äì    ; /// 61 ‚Äì        Property OPERSTATUS As %Integer(XMLNAME = "OPERSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///    4 (    ) Property CURRSTATUS As %Integer(XMLNAME = "CURRSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///    Property STARTDATE As %Date(XMLNAME = "STARTDATE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property ENDDATE As %Date(XMLNAME = "ENDDATE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///      Property NORMDOC As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "NORMDOC", XMLPROJECTION = "ATTRIBUTE"); ///     Property LIVESTATUS As %xsd.byte(VALUELIST = ",0,1", XMLNAME = "LIVESTATUS", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///  : /// 0 -   /// 1 - ; /// 2 - - Property DIVTYPE As %xsd.int(VALUELIST = ",0,1,2", XMLNAME = "DIVTYPE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; Relationship AddressObjects As Test.AddressObjects(XMLPROJECTION = "NONE") [ Cardinality = one, Inverse = Object ]; }</code> </pre> <br></div></div><br>  De la liste compl√®te des fichiers xml dans FIAS, nous n'utiliserons qu'un fichier avec les noms des r√©gions, des villes et des rues.  Au moment de pr√©parer la publication, j'avais ceci: <br>  AS_ADDROBJ_20190106_90809714-fe22-45b2-929c-52bd950963e0.XML <br><br>  La taille du fichier n'est ni grande ni petite, mais presque 3 Go.  Vous ne l'ouvrirez pas avec des outils de texte ordinaires - ils ne dig√®rent pas cette taille. <br><blockquote>  Soit dit en passant, la longueur maximale d'un litt√©ral de cha√Æne (type String) dans InterSystems IRIS ne d√©passe pas 3 641 144 caract√®res.  Autrement dit, le t√©l√©chargement direct du fichier ou l'URL dans celui-ci √©chouera.  D'autres restrictions peuvent √™tre trouv√©es <a href="">dans la documentation</a> .  Pour travailler avec de grands volumes de donn√©es, vous pouvez utiliser des flux de donn√©es (flux) qui n'ont pas une telle limite de longueur. </blockquote>  Voyons voir ce que nous obtenons? <br><br>  Cuisson du poivron farci FIAS.  Ce n'est qu'une pr√©paration pour un avenir merveilleux.  Nous obtenons d'abord l'ensemble minimal initial.  Nous n'avons besoin que de ces ingr√©dients: <br><br><pre> <code class="plaintext hljs">Class FIAS.AddressObject Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "Object"; Parameter XMLSEQUENCE = 1; ///      Property AOGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOGUID", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property OFFNAME As %String(MAXLEN = 120, MINLEN = 1, XMLNAME = "OFFNAME", XMLPROJECTION = "ATTRIBUTE"); ///   Property POSTALCODE As %String(MAXLEN = 6, MINLEN = 6, XMLNAME = "POSTALCODE", XMLPROJECTION = "ATTRIBUTE"); ///     Property SHORTNAME As %String(MAXLEN = 10, MINLEN = 1, XMLNAME = "SHORTNAME", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property AOLEVEL As %Integer(XMLNAME = "AOLEVEL", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///     Property PARENTGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "PARENTGUID", XMLPROJECTION = "ATTRIBUTE"); ///   .  . Property AOID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOID", XMLPROJECTION = "ATTRIBUTE") [ Required ];</code> </pre><br>  Ensuite, faites <a href="https://docs.intersystems.com/irislatest/csp/docbook/DocBook.UI.Page.cls?KEY=GXML_import#GXML_import_">l'√©criture</a> .  Nous cr√©ons un objet qui comprend XML comme natif - nous utilisons une classe de la biblioth√®que syst√®me% XML.Reader: <br><br><pre> <code class="plaintext hljs">set reader = ##class(%XML.Reader).%New()</code> </pre> <br>  Et nous lui donnons des instructions, qui prendre, et ignorons le reste.  Nous prendrons une portion: <br><br><pre> <code class="plaintext hljs">do reader.Correlate("Object","FIAS.AddressObject")</code> </pre> <br>  Ensuite, il existe des variantes sur la fa√ßon d'obtenir le fichier microbd d'origine.  Si cela vous convient, vous pouvez le placer √† c√¥t√© du r√©f√©rentiel - localement dans le syst√®me de fichiers du serveur IRIS.  Ou, comme dans mon exemple, demandez √† envoyer via HTTP.  Il existe une option encore plus universelle, sur laquelle il y aura quelques mots ci-dessous. <br><br><pre> <code class="plaintext hljs">set url="http://localhost/AS_ADDROBJ_20190106_90809714-fe22-45b2-929c-52bd950963e0.XML" write reader.OpenUrl(url)</code> </pre> <br><blockquote>  Important!  En ce moment, la majorit√© qui se transmettra cet exemple aura une chose terrible.  Le syst√®me reviendra au lieu du joyeux "1" (tout est en ordre), quelque chose commen√ßant par "0 ¬∏ STORE ...".  Et √ßa ne plaira pas.  Autrement dit, le fichier avec une microbase apparemment n'est pas tout √† fait micro et ne rentre pas dans notre objet.  La m√©moire qui lui √©tait allou√©e n'√©tait pas suffisante.  Solvable?  Bien s√ªr.  La plateforme de donn√©es IRIS vous permet de cr√©er des objets jusqu'√† 4 To en RAM.  Alors qu'est-ce qui a mal tourn√©?  Par d√©faut, les param√®tres syst√®me sont d√©finis sur 256 Mo par objet.  Et nous aurions besoin de beaucoup plus.  Et rappelez-vous, ce sont des exigences de RAM.  Y a-t-il suffisamment de stock sur votre ordinateur / serveur? </blockquote>  De quelle taille de m√©moire nous avons besoin pour installer ce g√©ant que nous avons install√© empiriquement - pr√®s de 10 Go.  Ce que vous devez sp√©cifier dans les param√®tres (Menu&gt; Configurer la m√©moire&gt; M√©moire maximale par processus (Ko)) ou via la <a href="">variable syst√®me $ ZSTORAGE</a> (en kilo-octets): <br><br><pre> <code class="plaintext hljs">set $ZSTORAGE=10000000</code> </pre> <br>  Vous avez lanc√© un nouveau processus avec les param√®tres de m√©moire n√©cessaires?  Ensuite, tout est encore plus simple - nous lisons et sauvegardons. <br><br>  Il existe une option alternative (et probablement pr√©f√©r√©e) - <a href="">utilisez la propri√©t√© UsePPGHandler</a> de la classe% XML.Reader qui vous permet de ne pas stocker XML en m√©moire et fonctionne avec les param√®tres de m√©moire standard. <br><br><pre> <code class="plaintext hljs">set reader = ##class(%XML.Reader).%New() set reader.UsePPGHandler = 1</code> </pre> <br>  plus ... Corr√©lation / Lecture, etc.  ... <br><br><pre> <code class="plaintext hljs">do reader.Next(.object) do object.%Save()</code> </pre> <br>  Et donc 3 722 548 fois pour chaque op√©ration :-) <br><br>  C'est fatigant.  Par cons√©quent, nous compl√©tons notre classe FIAS.AddressObject avec une m√©thode d'importation, bas√©e sur les commandes qui viennent d'√™tre affich√©es: <br><br><pre> <code class="plaintext hljs">ClassMethod Import() { //     XML Set reader = ##class(%XML.Reader).%New() //   XML   Set status = reader.OpenURL("http://localhost/AS_ADDROBJ_20190106_90809714-fe22-45b2-929c-52bd950963e0.XML") If $$$ISERR(status) {Do $System.Status.DisplayError(status)} //       Do reader.Correlate("Object","FIAS.AddressObject") //       While (reader.Next(.object,.status)) { Set status = object.%Save() If $$$ISERR(status) {do $System.Status.DisplayError(status)} } //      ,   If $$$ISERR(status) {Do $System.Status.DisplayError(status)} }</code> </pre> <br>  Utilisons la puissance de notre exocortex informatique - une seule commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dans le terminal</a> : <br><br><pre> <code class="plaintext hljs">do ##class(FIAS.AddressObject).Import()</code> </pre> <br><img src="https://habrastorage.org/webt/bd/mh/t7/bdmht7k0urpyo07qcdcmkj5_nym.gif"><br><br>  Je demande √† tout le monde √† table.  Il y avait MCD, et maintenant le plat fini sous la forme d'un global avec les noms v√©rifi√©s des villes et des poids russes est pr√™t. <br><br><img src="https://habrastorage.org/webt/1u/he/a6/1uhea6bdexgrpwlfpmtn2b2gdyy.png"><br><br>  Et enfin quelques mots sur le moment o√π 4 To ne suffisent pas.  Dans ce cas, <a href="">nous suivons les flux</a> (ou les flux si vous le souhaitez).  La documentation est dispos√©e sur des √©tag√®res.  Vous pouvez binaire, vous pouvez symbolique.  Le stockage dans le monde n'est pas non plus interdit.  La recette est la suivante: on prend un ruisseau, on le coupe en morceaux et on le donne aux objets dont on a besoin pour la consommation. <br><br>  De plus, les beaux objets ObjectScript adressables et les API en Python ne convenaient pas.  Il y aura une histoire distincte. <br><blockquote>  Agr√©able: Gartner vient de terminer la collecte annuelle de v√©ritables √©valuations et avis d'utilisateurs dans la cat√©gorie SGBD et, sur cette base, a publi√© sa note du meilleur SGBD de 2019.  Les produits InterSystems Cach√© et InterSystems IRIS Data Platform ont re√ßu la note de choix du consommateur la plus √©lev√©e.  De qui vous avez choisi et comment vous avez √©valu√©, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vous pouvez jeter un ≈ìil vous-m√™me</a> . </blockquote>  Meilleur logiciel de syst√®mes de gestion de base de donn√©es op√©rationnelle de 2019, tel que examin√© par les clients <br><br><img src="https://habrastorage.org/webt/gw/jg/dd/gwjgdd1segqlvnnpfzgo9buww4y.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr438062/">https://habr.com/ru/post/fr438062/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr438044/index.html">Analyse Hello World</a></li>
<li><a href="../fr438050/index.html">Filtre de Kalman pour minimiser la valeur d'entropie d'une erreur al√©atoire avec une distribution non gaussienne</a></li>
<li><a href="../fr438052/index.html">Interacteur, mod√®le d'op√©ration</a></li>
<li><a href="../fr438058/index.html">"Analyse des donn√©es en Python" en deux parties</a></li>
<li><a href="../fr438060/index.html">Estimation de l'orientation spatiale, ou Comment ne pas avoir peur des filtres Mahoney et Majwik</a></li>
<li><a href="../fr438064/index.html">Liste de contr√¥le: ce qui devait √™tre fait avant de d√©marrer les microservices dans prod</a></li>
<li><a href="../fr438066/index.html">10 cha√Ænes YouTube √©ducatives en anglais dont vous n'avez jamais entendu parler</a></li>
<li><a href="../fr438070/index.html">Comment la g√©n√©ration Y est-elle devenue une g√©n√©ration √©puis√©e?</a></li>
<li><a href="../fr438074/index.html">[Annonce pour Iekaterinbourg, Novossibirsk, Saint-P√©tersbourg] Session de test d'automatisation: Nous couvrirons tout de la Neva √† l'Ob avec des tests</a></li>
<li><a href="../fr438078/index.html">Facebook paie 20 $ par mois pour la mise en place de son pseudo-VPN</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>