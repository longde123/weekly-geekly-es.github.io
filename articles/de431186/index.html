<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌂 👇 👊🏻 Entwurf nach Typen: So machen Sie ungültige Zustände in C # unaussprechlich 🎸 🔴 🏣</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In der Regel enthalten Artikel zum Schriftdesign Beispiele in funktionalen Sprachen - Haskell, F # und andere. Dieses Konzept scheint möglicherweise n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Entwurf nach Typen: So machen Sie ungültige Zustände in C # unaussprechlich</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431186/"><p>  In der Regel enthalten Artikel zum Schriftdesign Beispiele in funktionalen Sprachen - Haskell, F # und andere.  Dieses Konzept scheint möglicherweise nicht auf objektorientierte Sprachen anwendbar zu sein, ist es aber nicht. </p><br><p>  In diesem Artikel werde ich Beispiele aus einem Artikel von <abbr title="Scott Wlaschin">Scott Vlaschin Type</abbr> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Design übersetzen: Wie man ungültige Zustände</a> in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">idiomatischem</a> C # <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">unaussprechlich macht</a> .  Ich werde auch versuchen zu zeigen, dass dieser Ansatz nicht nur als Experiment, sondern auch im Arbeitscode anwendbar ist. </p><a name="habracut"></a><br><h1 id="sozdayom-domennye-tipy">  Erstellen Sie Domänentypen </h1><br><p>  Zuerst müssen Sie die Typen aus dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vorherigen Artikel der Serie</a> portieren, die in den Beispielen in F # verwendet werden. </p><br><h2 id="oborachivaem-primitivnye-tipy-v-domennye">  Primitive Typen in Domäne einschließen </h2><br><p>  In den F # -Beispielen werden Domänentypen anstelle von Grundelementen für E-Mail-Adresse, US-Postleitzahl und Statuscode verwendet.  Versuchen wir, einen primitiven Typ in C # zu verpacken: </p><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EmailAddress</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Value { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EmailAddress</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Regex.IsMatch(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, <span class="hljs-string"><span class="hljs-string">@"^\S+@\S+\.\S+$"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-string"><span class="hljs-string">"Email address must contain an @ sign"</span></span>); } Value = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; Value; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> obj</span></span></span><span class="hljs-function">)</span></span> =&gt; obj <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> EmailAddress otherEmailAddress &amp;&amp; Value.Equals(otherEmailAddress.Value); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetHashCode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; Value.GetHashCode(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">implicit</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">operator</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EmailAddress address</span></span></span><span class="hljs-function">)</span></span> =&gt; address?.Value; }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmailAddress(<span class="hljs-string"><span class="hljs-string">"a@example.com"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmailAddress(<span class="hljs-string"><span class="hljs-string">"b@example.com"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> receiverList = String.Join(<span class="hljs-string"><span class="hljs-string">";"</span></span>, a, b);</code> </pre> <br><p>  Ich habe die Adressvalidierung von der Factory-Funktion in den Konstruktor verschoben, da eine solche Implementierung eher für C # typisch ist.  Wir mussten auch einen Vergleich und eine Konvertierung in einen String implementieren, was auf F # vom Compiler durchgeführt werden würde. </p><br><p>  Einerseits sieht die Implementierung recht umfangreich aus.  Andererseits wird die Spezifität der E-Mail-Adresse hier nur durch Überprüfungen im Konstruktor und möglicherweise durch die Vergleichslogik ausgedrückt.  Das meiste davon ist Infrastrukturcode, der sich darüber hinaus wahrscheinlich nicht ändern wird.  Sie können also entweder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">eine</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vorlage</a> erstellen oder im schlimmsten Fall den allgemeinen Code von Klasse zu Klasse kopieren. </p><br><p>  Es ist zu beachten, dass die Erstellung von Domänentypen aus primitiven Werten nicht die Spezifität der funktionalen Programmierung ist.  Im Gegenteil, die Verwendung primitiver Typen wird <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in OOP</a> als Zeichen für <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">schlechten Code angesehen</a> .  Sie können Beispiele für solche Wrapper beispielsweise <a href="">in NLog</a> und <a href="">NBitcoin sehen</a> , und der Standardtyp von TimeSpan ist in der Tat ein Wrapper über die Anzahl der Ticks. </p><br><h2 id="sozdayom-obekty-znacheniya">  Wertobjekte erstellen </h2><br><p>  Jetzt müssen wir ein Analogon des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Eintrags</a> erstellen: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EmailContactInfo</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> EmailAddress EmailAddress { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsEmailVerified { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EmailContactInfo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EmailAddress emailAddress, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isEmailVerified</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (emailAddress == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(emailAddress)); } EmailAddress = emailAddress; IsEmailVerified = isEmailVerified; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{EmailAddress}</span></span></span><span class="hljs-string">, </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{(IsEmailVerified ? </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">"verified"</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> : </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">"not verified"</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">"</span></span>; }</code> </pre> <br><p>  Auch hier war mehr Code als F # erforderlich, aber der größte Teil der Arbeit kann durch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Refactoring in der IDE</a> erledigt werden. </p><br><p>  <code>EmailContactInfo</code> ist wie <code>EmailAddress</code> ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wertobjekt</a> (im Sinne von <abbr title="Fachorientiertes Design">DDD</abbr> , keine <code>EmailContactInfo</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in .NET</a> ), das seit langem bekannt ist und in der Objektmodellierung verwendet wird. </p><br><p>  Andere Typen - <code>StateCode</code> , <code>ZipCode</code> , <code>PostalAddress</code> und <code>PersonalName</code> auf ähnliche Weise nach C # portiert. </p><br><h1 id="sozdayom-kontakt">  Kontakt erstellen </h1><br><p>  Der Code sollte daher die Regel "Der Kontakt muss eine E-Mail-Adresse oder eine Postanschrift (oder beide Adressen) enthalten" ausdrücken.  Diese Regel muss ausgedrückt werden, damit die Richtigkeit des Status in der Typdefinition sichtbar ist und vom Compiler überprüft wird. </p><br><h2 id="vyrazhaem-razlichnye-sostoyaniya-kontakta">  Drücken Sie verschiedene Kontaktzustände aus </h2><br><p>  Dies bedeutet, dass ein Kontakt ein Objekt ist, das den Namen der Person und entweder eine E-Mail-Adresse oder eine Postanschrift oder beides enthält.  Offensichtlich kann eine Klasse nicht drei verschiedene Sätze von Eigenschaften enthalten, daher müssen drei verschiedene Klassen definiert werden.  Alle drei Klassen müssen den Namen des Kontakts enthalten und gleichzeitig sollte es möglich sein, Kontakte unterschiedlichen Typs auf dieselbe Weise zu verarbeiten, ohne zu wissen, welche Adressen der Kontakt enthält.  Daher wird der Kontakt durch eine abstrakte Basisklasse mit dem Namen des Kontakts und drei Implementierungen mit unterschiedlichen Feldern dargestellt. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> PersonalName Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Contact</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PersonalName name</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (name == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(name)); } Name = name; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PostOnlyContact</span></span> : <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> PostalContactInfo post_; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PostOnlyContact</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PersonalName name, PostalContactInfo post</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (post == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(post)); } post_ = post; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EmailOnlyContact</span></span> : <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> EmailContactInfo email_; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EmailOnlyContact</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PersonalName name, EmailContactInfo email</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (email == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(email)); } email_ = email; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EmailAndPostContact</span></span> : <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> EmailContactInfo email_; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> PostalContactInfo post_; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EmailAndPostContact</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PersonalName name, EmailContactInfo email, PostalContactInfo post</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (email == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(email)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (post == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(post)); } email_ = email; post_ = post; } }</code> </pre> <br><p>  Sie können argumentieren, dass <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sie Komposition</a> und nicht Vererbung verwenden müssen, und im Allgemeinen müssen Sie Verhalten und nicht Daten erben.  Die Bemerkungen sind fair, aber meiner Meinung nach ist die Verwendung der Klassenhierarchie hier gerechtfertigt.  Erstens stellen Unterklassen nicht nur Sonderfälle der Basisklasse dar, die gesamte Hierarchie ist ein Konzept - Kontakt.  Drei Kontaktimplementierungen spiegeln sehr genau die drei Fälle wider, die in der Geschäftsregel festgelegt sind.  Zweitens ist das Verhältnis der Basisklasse und ihrer Erben, die Aufteilung der Verantwortlichkeiten zwischen ihnen leicht nachzuvollziehen.  Drittens, wenn die Hierarchie wirklich zu einem Problem wird, können Sie den Kontaktstatus in eine separate Hierarchie aufteilen, wie im ursprünglichen Beispiel.  In F # ist die Vererbung von Datensätzen nicht möglich, aber neue Typen werden ganz einfach deklariert, sodass die Aufteilung sofort durchgeführt wurde.  In C # wäre eine natürlichere Lösung, die Namensfelder in der Basisklasse zu platzieren. </p><br><h2 id="sozdanie-kontakta">  Kontakt erstellen </h2><br><p>  Das Erstellen eines Kontakts ist ganz einfach. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Contact </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FromEmail</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PersonalName name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> emailStr</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> email = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmailAddress(emailStr); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> emailContactInfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmailContactInfo(email, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmailOnlyContact(name, emailContactInfo); } }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PersonalName(<span class="hljs-string"><span class="hljs-string">"A"</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"Smith"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> contact = Contact.FromEmail(name, <span class="hljs-string"><span class="hljs-string">"abc@example.com"</span></span>);</code> </pre> <br><p>  Wenn die E-Mail-Adresse falsch ist, löst dieser Code eine Ausnahme aus, die im ursprünglichen Beispiel als Analogie zur Rückgabe <code>None</code> . </p><br><h2 id="obnovlenie-kontakta">  Kontakt Update </h2><br><p>  Das Aktualisieren eines Kontakts ist ebenfalls unkompliziert. Sie müssen dem <code>Contact</code> lediglich eine abstrakte Methode hinzufügen. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> Contact </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdatePostalAddress</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PostalContactInfo newPostalAddress</span></span></span><span class="hljs-function">)</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EmailOnlyContact</span></span> : <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> Contact </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdatePostalAddress</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PostalContactInfo newPostalAddress</span></span></span><span class="hljs-function">)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmailAndPostContact(Name, email_, newPostalAddress); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PostOnlyContact</span></span> : <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> Contact </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdatePostalAddress</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PostalContactInfo newPostalAddress</span></span></span><span class="hljs-function">)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PostOnlyContact(Name, newPostalAddress); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EmailAndPostContact</span></span> : <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> Contact </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdatePostalAddress</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PostalContactInfo newPostalAddress</span></span></span><span class="hljs-function">)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmailAndPostContact(Name, email_, newPostalAddress); }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StateCode(<span class="hljs-string"><span class="hljs-string">"CA"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> zip = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ZipCode(<span class="hljs-string"><span class="hljs-string">"97210"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newPostalAddress = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PostalAddress(<span class="hljs-string"><span class="hljs-string">"123 Main"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"Beverly Hills"</span></span>, state, zip); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newPostalContactInfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PostalContactInfo(newPostalAddress, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newContact = contact.UpdatePostalAddress(newPostalContactInfo);</code> </pre> <br><p>  Wie bei option.Value in F # ist das Auslösen einer Ausnahme von den Konstruktoren möglich, wenn die E-Mail-Adresse, die Postleitzahl oder der Status falsch sind. Für C # ist dies jedoch gängige Praxis.  Natürlich muss der Ausnahmecode hier oder irgendwo im aufrufenden Code im Arbeitscode angegeben werden. </p><br><h2 id="obrabotka-kontaktov-vne-ierarhii">  Umgang mit Kontakten außerhalb der Hierarchie </h2><br><p>  Es ist logisch, die Logik zum Aktualisieren eines Kontakts in der Kontakthierarchie selbst zu platzieren.  Aber was ist, wenn Sie etwas erreichen wollen, das nicht in ihren Verantwortungsbereich passt?  Angenommen, Sie möchten Kontakte auf der Benutzeroberfläche anzeigen. </p><br><p>  Sie können die abstrakte Methode natürlich erneut zur Basisklasse hinzufügen und jedes Mal eine neue Methode hinzufügen, wenn Sie Kontakte irgendwie verarbeiten müssen.  Dann wird jedoch das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Prinzip der alleinigen Verantwortung</a> verletzt, die <code>Contact</code> wird unübersichtlich und die Verarbeitungslogik wird zwischen den <code>Contact</code> und den Stellen, die tatsächlich für die Verarbeitung von Kontakten verantwortlich sind, verwischt.  Es gab kein solches Problem in F #, ich möchte, dass der C # -Code nicht schlechter wird! </p><br><p>  Das dem Mustervergleich in C # am nächsten kommende Äquivalent ist das Schalterkonstrukt.  Wir könnten <code>Contact</code> eine Aufzählungseigenschaft hinzufügen, mit der wir den tatsächlichen Kontakttyp bestimmen und die Konvertierung durchführen können.  Es wäre auch möglich, die neueren Funktionen von C # zu verwenden und einen Wechsel als Instanz von <code>Contact</code> durchzuführen.  Wir wollten jedoch, dass der Compiler sich selbst auffordert, wenn neue korrekte <code>Contact</code> hinzugefügt werden, bei denen nicht genügend neue Fälle verarbeitet werden und switch nicht die Verarbeitung aller möglichen Fälle garantiert. </p><br><p>  OOP bietet jedoch auch einen bequemeren Mechanismus für die Auswahl der Logik je nach Typ, den wir nur beim Aktualisieren eines Kontakts verwendet haben.  Und da die Auswahl jetzt vom aufrufenden Typ abhängt, muss sie auch polymorph sein.  Die Lösung ist die Besuchervorlage.  Sie können einen Handler abhängig von der <code>Contact</code> auswählen, die Kontaktverarbeitungsmethoden von ihrer Hierarchie trennen und wenn ein neuer Kontakttyp hinzugefügt wird, und dementsprechend eine neue Methode in der Besucherschnittstelle, müssen Sie diese in allen Implementierungen der Schnittstelle schreiben.  Alle Anforderungen sind erfüllt! </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AcceptVisitor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IContactVisitor visitor</span></span></span><span class="hljs-function">)</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IContactVisitor</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Visit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PersonalName name, EmailContactInfo email</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Visit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PersonalName name, PostalContactInfo post</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Visit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PersonalName name, EmailContactInfo email, PostalContactInfo post</span></span></span><span class="hljs-function">)</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EmailOnlyContact</span></span> : <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AcceptVisitor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IContactVisitor visitor</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (visitor == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(visitor)); } visitor.Visit(Name, email_); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PostOnlyContact</span></span> : <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AcceptVisitor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IContactVisitor visitor</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (visitor == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(visitor)); } visitor.Visit(Name, post_); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EmailAndPostContact</span></span> : <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AcceptVisitor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IContactVisitor visitor</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (visitor == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(visitor)); } visitor.Visit(Name, email_, post_); } }</code> </pre> <br><p>  Jetzt können Sie Code schreiben, um Kontakte anzuzeigen.  Der Einfachheit halber werde ich die Konsolenschnittstelle verwenden. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ContactUi</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Visitor</span></span> : <span class="hljs-title"><span class="hljs-title">IContactVisitor</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> IContactVisitor.Visit(PersonalName name, EmailContactInfo email) { Console.WriteLine(name); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"* Email: {0}"</span></span>, email); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> IContactVisitor.Visit(PersonalName name, PostalContactInfo post) { Console.WriteLine(name); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"* Postal address: {0}"</span></span>, post); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> IContactVisitor.Visit(PersonalName name, EmailContactInfo email, PostalContactInfo post) { Console.WriteLine(name); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"* Email: {0}"</span></span>, email); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"* Postal address: {0}"</span></span>, post); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Display</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Contact contact</span></span></span><span class="hljs-function">)</span></span> =&gt; contact.AcceptVisitor(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Visitor()); }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ui = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ContactUi(); ui.Display(newContact);</code> </pre> <br><h2 id="dalneyshie-uluchsheniya">  Weitere Verbesserungen </h2><br><p>  Wenn <code>Contact</code> in der Bibliothek deklariert <code>Contact</code> und das Auftreten neuer Erben in den Bibliotheksclients unerwünscht ist, können Sie den Bereich des <code>Contact</code> Konstruktors in <code>internal</code> ändern oder sogar seine verschachtelten Klassen für Nachkommen festlegen, die Sichtbarkeit der Implementierungen und des Konstruktors als <code>private</code> deklarieren und Instanzen nur mit statischen Factory-Methoden erstellen. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EmailOnlyContact</span></span> : <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EmailOnlyContact</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PersonalName name, EmailContactInfo email</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">)</span></span> { } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Contact</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PersonalName name</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Contact </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EmailOnly</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PersonalName name, EmailContactInfo email</span></span></span><span class="hljs-function">)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmailOnlyContact(name, email); }</code> </pre> <br><p>  Somit ist es möglich, die Nichterweiterbarkeit der Typensumme zu reproduzieren, obwohl dies in der Regel nicht erforderlich ist. </p><br><h1 id="zaklyuchenie">  Fazit </h1><br><p>  Ich hoffe, ich konnte zeigen, wie der korrekte Status der Geschäftslogik mithilfe von Typen mit OOP-Tools eingeschränkt werden kann.  Der Code erwies sich als umfangreicher als bei F #.  Irgendwo ist dies auf die relative Umständlichkeit von OOP-Entscheidungen zurückzuführen, irgendwo auf die Ausführlichkeit der Sprache, aber Lösungen können nicht als unpraktisch bezeichnet werden. </p><br><p>  Interessanterweise haben wir ausgehend von einer rein funktionalen Lösung die Empfehlung einer themenorientierten Programmierung und von OOP-Mustern ausgearbeitet.  In der Tat ist dies nicht überraschend, da die Ähnlichkeit von Typensummen und dem Besuchermuster seit geraumer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zeit bekannt ist</a> .  Der Zweck dieses Artikels war es, nicht so sehr einen konkreten Trick aufzuzeigen, als vielmehr die Anwendbarkeit von Ideen aus dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">„Elfenbeinturm“</a> in der imperativen Programmierung zu demonstrieren.  Natürlich kann nicht alles so einfach übertragen werden, aber mit dem Aufkommen von immer mehr Funktionen in den gängigen Programmiersprachen werden sich die Grenzen des Anwendbaren erweitern. </p><br><hr><br><p>  → Beispielcode ist auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GitHub</a> verfügbar </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de431186/">https://habr.com/ru/post/de431186/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de431174/index.html">Simulationstheorie: das Verhältnis von quantenchemischen Berechnungen und Realität</a></li>
<li><a href="../de431176/index.html">Microservices, APIs und Innovationen: Die Leistungsfähigkeit von APIs</a></li>
<li><a href="../de431178/index.html">Parasitenwörter auf Englisch</a></li>
<li><a href="../de431180/index.html">Ext JS auf dem Server</a></li>
<li><a href="../de431184/index.html">WIFI-Multi-Hop-Mesh-Netzwerke mit Mesh Connex-Technologie</a></li>
<li><a href="../de431188/index.html">Technische Aspekte der Blockierung des Internets in Russland. Herausforderungen und Perspektiven</a></li>
<li><a href="../de431190/index.html">Wie man das Niveau eines SEO-Unternehmens bewertet, ohne eine Vereinbarung damit zu schließen</a></li>
<li><a href="../de431192/index.html">AWC führt Firecracker ein - Mikrovirtualisierung für Linux</a></li>
<li><a href="../de431194/index.html">Warmer Röhren-Hardcore. Wie war DotNext 2018 Moskau</a></li>
<li><a href="../de431196/index.html">Wie Yandex.Taxi die Lieferzeit von Autos mithilfe von maschinellem Lernen vorhersagt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>