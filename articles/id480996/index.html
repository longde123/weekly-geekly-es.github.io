<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👌🏻 ⚱️ 👼🏼 Catatan Pentester: kasus perburuan - 2 ☁️ 👨🏾 🥃</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kami melanjutkan percakapan untuk kasus-kasus menarik dalam karya pentester. Dalam posting terakhir , kami berbicara tentang pengujian penetrasi ekste...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Catatan Pentester: kasus perburuan - 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/solarsecurity/blog/480996/"><img src="https://habrastorage.org/webt/vr/xh/gw/vrxhgwizzyqzqg0cr2e2qarsfqi.png"><br><br>  Kami melanjutkan percakapan untuk kasus-kasus menarik dalam karya pentester.  Dalam <a href="https://habr.com/ru/company/solarsecurity/blog/463971/">posting</a> terakhir <a href="https://habr.com/ru/company/solarsecurity/blog/463971/">,</a> kami berbicara tentang pengujian penetrasi eksternal, hari ini kita akan berbicara tentang tes pentest internal paling menarik yang telah kami terapkan baru-baru ini.  Esensi mereka adalah bahwa kita harus, berada dalam batas internal pelanggan, menerima hak istimewa maksimum dalam domain dan mendapatkan data penting apa pun.  Kebetulan itu mengejutkan.  Tetapi hal pertama yang pertama. <br><a name="habracut"></a><br><h2>  Kasus 1. Pengelola kata sandi baik, tetapi harus dapat digunakan </h2><br>  Kami melakukan pengujian penetrasi internal untuk klien besar yang sudah melatih sysadmin dan layanan IS.  Dalam perjalanan pekerjaan, kami menerima beberapa akun yang dengannya kami sudah dapat masuk ke jaringan dan terhubung ke mesin-mesin pengguna lain.  Pada titik tertentu, mereka menetap di mobil salah satu administrator sistem dan menemukan eldorado di sana.  Administrator sistem menggunakan kata sandi yang sangat rumit (akan sulit untuk menemukan yang seperti itu) dan bahkan menyimpannya di keepass.  Tapi ini nasib buruk: pengelola kata sandi itu sendiri tidak pernah diblokir - tidak setelah 15 menit, atau pada saat kunci layar.  Dengan bonus ini, kami mendapatkan hak administratif dalam sistem pelanggan kritis tanpa kebisingan dan debu. <br><br>  Klien lain memiliki kasus serupa.  Juga password yang rumit, juga keepass, meskipun masih ada kunci otomatis setelah 15 menit.  Bagaimana kita bisa menggunakan ini?  Mereka menunggu sampai administrator mengunci desktop dan pergi (untuk makan siang?).  Lalu itu masalah kecil. <br><br>  Jika Anda menggunakan pengelola kata sandi, gunakan dengan bijak - nyalakan opsi kunci dengan layar kunci dan tanpa aktivitas selama 1-5 menit. <br><br><h2>  Kasus 2. Karyawan yang diberhentikan </h2><br>  Sangat sering selama pentest internal kita mendapatkan akses dengan memilih kata sandi - pengguna biasanya terlalu malas untuk menghasilkan kombinasi yang kompleks, terutama ketika kebijakan kata sandi mengharuskan pembaruan setiap bulan.  Seringkali angkanya hanya berubah - jadi, superpassword_03.2019 sebulan kemudian berubah menjadi superpassword_04.2019 dan semakin jauh ke bawah daftar. <br><br>  Tetapi kadang-kadang pelanggan datang tiba-tiba.  Jadi, melakukan serangan penyemprotan kata sandi di salah satu perusahaan, kami mendapat sejumlah akun dan salah satunya menarik bagi kami: dia memiliki hak yang cukup luas, meskipun bukan hak admin.  Kata sandi yang mudah dibuat untuknya (qaz12345), dan komentar pada entri ini dalam AD menunjukkan bahwa karyawan dipecat - dihakimi berdasarkan tanggal, hampir setahun yang lalu.  Artinya, setelah pemberhentian, akun itu tidak diblokir, tetapi cukup mengatur ulang kata sandi ke "default" dan mengatur opsi "ubah kata sandi pada login pertama".  Demi kebahagiaan pelanggan, kami adalah orang pertama yang diundang untuk melakukan ini. <br><br><h2>  Kasus 3. Tambalan?  Nah, jangan </h2><br>  Bagian tersulit dari pentest internal adalah mendapatkan akun pertama.  Ada banyak alat dan cara untuk melakukan ini, dimulai dengan peragaan busana spionase di kantor mencari stiker yang dihargai dengan kata sandi dan menangkap orang yang dirugikan dengan kantor Wi-Fi hasil kloning, berakhir dengan serangan terhadap Kerberos dan pemecahan kata sandi akun.  Tetapi kadang-kadang, bahkan dengan pemindaian awal, Anda dapat menemukan perangkat lunak yang belum ada yang diperbarui selama sepuluh ribu tahun (mengapa repot-repot memperbarui perangkat lunak dalam infrastruktur internal?). <br><br>  Dalam satu proyek seperti itu, mereka menemukan perangkat lunak manajemen dari HP, di mana RCE ditemukan tanpa otentikasi - dari sana mereka mendapat bagian dari akun. <br><br>  ¯ \ _ (ツ) _ / ¯ <br><br>  Tampaknya semuanya akan menjadi lebih sederhana - Mimikatz, dan masalahnya ada di topi, tetapi ternyata akun yang diterima tidak memiliki hak istimewa yang kami butuhkan.  Seperti yang mereka katakan, kekuatan kami adalah dalam kesiapan untuk cloud: menggunakan keajaiban nmap dan skrip smb-enum-share, kami menemukan bahwa salah satu akun memiliki hak admin lokal di server pengujian, di mana administrator domain terlibat secara aktif pada saat itu =). <br><br><h2>  Kasus 4. Kunci </h2><br>  Akhirnya, mari kita bicara sedikit tentang kemungkinan pemblokiran akses.  Bekerja pada "vnutryanka" yang paling sering kami lakukan dengan akses jarak jauh.  Skema terlihat seperti ini: kita terhubung ke VPN, kita mendapatkan alamat internal, kemudian kita berpegang teguh pada mesin yang dialokasikan untuk kita melalui RDP.  Dan dengan mesin ini kami sudah mulai melakukan pekerjaan, tetapi untuk ini kami perlu menyampaikan alat kami.  Banyak klien kami menggunakan server proxy dengan daftar situs putih, kadang-kadang bahkan dengan daftar putih port, untuk mengakses Internet (misalnya, Anda dapat terhubung ke situs web dengan port 80, tetapi Anda tidak dapat lagi terhubung ke 8081).  Ini benar-benar membuat pekerjaan sedikit lebih sulit, terutama jika copy-paste melalui RDP dilarang. <br><br>  Tetapi di mana dalam bisnis kami tanpa nuansa.  Satu klien memiliki aturan yang sangat ketat dan kami tidak diizinkan untuk mengisi alat kami dengan cara resmi, sehingga dapat dikatakan, mereka mencegah penetrasi melalui "pintu masuk utama".  Seperti, ini mesin virtual dan hak minimal untuk Anda - menderita seperti peretas sejati. <br><br>  Saya tidak harus menderita lama.  Proxy benar-benar banyak diblokir, bahkan tidak mungkin untuk hanya terhubung ke server http-nya (tidak ada dalam daftar putih), copy-paste dilarang, browser menolak untuk pergi ke mana pun kecuali http (80 / tcp) dan https (443 / tcp), dan tempat lain selain portal internal.  Kami mencoba melewati PowerShell - itu juga tidak berfungsi, itu tidak berjalan tanpa proxy, dan proxy melarangnya.  Tetapi utilitas FTP bawaan Windows berfungsi dengan baik - tidak ada aturan pada firewall yang akan memblokir lalu lintas tersebut.  Jadi kami menyeret semua alat kami di dalam perimeter dan mampu melakukan pekerjaan dengan baik. <br><br><h2>  Pada akhirnya </h2><br>  Saya akan mengulangi rekomendasi dari bagian sebelumnya, karena pengulangan adalah ibu dari ajaran yang <s>gagap</s> .  Lakukan pengujian penetrasi berkala - mereka akan membantu Anda menemukan titik-titik halus di pertahanan Anda, seperti, misalnya, dalam kasus 3. Anda dapat mempertimbangkan bahwa tidak perlu menambal sistem dalam perimeter internal, tetapi kadang-kadang itu menyebabkan konsekuensi yang serius. <br><br>  Bangun sistem manajemen tambalan - tidak hanya menghilangkan kerentanan "profil tinggi" (seperti EternalBlue atau BlueKeep), tetapi juga kurang dikenal, tetapi tidak kurang berbahaya dalam hal operasi mereka (seperti halnya dengan HP AM).  Singkatnya, catat semua sistem Anda. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id480996/">https://habr.com/ru/post/id480996/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id480982/index.html">3. Fortinet Memulai v6.0. Persiapan tata letak</a></li>
<li><a href="../id480984/index.html">Menghindari Kesalahan Keamanan Jaringan Populer</a></li>
<li><a href="../id480986/index.html">LEGO Education WeDo 2.0 dan Scratch - bundel baru untuk pengajaran robotika anak-anak</a></li>
<li><a href="../id480990/index.html">Intisari retro: 30 sumber daya menarik tentang teknologi dan permainan beberapa tahun terakhir</a></li>
<li><a href="../id480992/index.html">Tentang profesi manajer produk: bagaimana mencapai yang ideal? (bagian 2)</a></li>
<li><a href="../id480998/index.html">MERCH! MERCH! MERCH! dan ... unicorn</a></li>
<li><a href="../id481000/index.html">Komputasi tanpa server berdasarkan OpenWhisk, bagian 4</a></li>
<li><a href="../id481004/index.html">Java Digest untuk tanggal 18 Desember</a></li>
<li><a href="../id481010/index.html">16 tips pengembangan untuk android di Kotlin. Bagian 3</a></li>
<li><a href="../id481012/index.html">Apa yang saya pelajari dalam 10 tahun tentang Stack Overflow</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>