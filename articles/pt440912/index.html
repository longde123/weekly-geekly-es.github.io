<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÖøÔ∏è ü§±üèø ‚õ∫Ô∏è Tal dor, tanta dor, infra-estrutura como um servi√ßo 1: 0 ü§òüèª üë®üèΩ‚Äçüíº üßû</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Estamos criando o melhor sistema de detec√ß√£o de empr√©stimos na R√∫ssia e nos pa√≠ses vizinhos. Em um mundo ideal, lidar√≠amos apenas com o design e o des...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tal dor, tanta dor, infra-estrutura como um servi√ßo 1: 0</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/antiplagiat/blog/440912/"><p>  Estamos criando o melhor sistema de detec√ß√£o de empr√©stimos na R√∫ssia e nos pa√≠ses vizinhos.  Em um mundo ideal, lidar√≠amos apenas com o design e o desenvolvimento do sistema.  Mas, infelizmente, o Anti-pl√°gio n√£o funciona no v√°cuo e, para que nossos usu√°rios usem nossos desenvolvimentos de maneira conveniente e confort√°vel, tamb√©m precisamos desenvolver o ambiente em torno de nosso servi√ßo.  Nosso software ainda n√£o funciona sem ferro de passar, os usu√°rios precisam fornecer suporte t√©cnico, √© necess√°rio receber pagamento dos usu√°rios sem violar a lei etc.  Em suma, a rotina √© suficiente. </p><br><p>  Este artigo √© o primeiro de uma s√©rie de <strike>dramas</strike> de <strike>produ√ß√£o</strike> sobre como melhoramos nosso servi√ßo com a terceiriza√ß√£o.  Compartilhamos problemas e conclus√µes reais. </p><br><h1>  Nuvens, cavalos de cabelos loiros ... </h1><br><img src="https://habrastorage.org/webt/zv/gk/jj/zvgkjjsz7yiiggzxydco6uvippi.png"><br>  <sup><em>(de algum lugar da Internet, vi pela primeira vez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .)</em></sup> <br><p>  A carga no nosso sistema √© muito desigual: em primeiro lugar, durante o dia, a carga muda 5 vezes.  Em segundo lugar, h√° uma sazonalidade pronunciada.  O m√°ximo di√°rio de verifica√ß√µes ap√≥s o final da sess√£o de ver√£o √© reduzido em 10 vezes!  A sess√£o de inverno n√£o √© t√£o brilhante, mas tamb√©m n√£o √© um presente.  Al√©m disso, cada sess√£o de ver√£o subsequente √© mais pesada (em termos de n√∫mero de verifica√ß√µes) e mais dif√≠cil (novas tecnologias e funcionalidade de pesquisa) da anterior.  Portanto, por um lado, quero ter um bom suprimento de recursos, por outro lado, n√£o pagamos muito durante um decl√≠nio na atividade.  Em uma sess√£o, voc√™ pode implantar mais servidores e, no ver√£o, reduzir a quantidade de recursos consumidos.  Obviamente, esse √© apenas o caso dos provedores de nuvem.  Neste artigo, falarei sobre v√°rios aspectos da intera√ß√£o com v√°rios provedores de nuvem (AWS, IT Grad, MCS, YC).  Se algu√©m parecer que isso √© um grito da alma, ele n√£o ficar√° muito enganado.  Ent√£o vamos l√°! <br></p><a name="habracut"></a><br><h2>  Aws </h2><br><p>  Come√ßamos a usar os recursos da nuvem em fevereiro de 2013, quando alugamos nosso primeiro servidor na AWS.  De fato, a Amazon √© a primeira e mais antiga experi√™ncia Anti-Pl√°gio com as nuvens.  Em seguida, come√ßamos com uma m√°quina e agora nosso or√ßamento na AWS √© uma ordem de magnitude maior que o or√ßamento para todas as nuvens russas.  O primeiro amor, como voc√™ sabe, nunca √© esquecido.  Todos os problemas e oportunidades com outras nuvens neste artigo foram considerados com base na experi√™ncia do uso da AWS. </p><br><p>  √â verdade que tamb√©m havia uma mosca na pomada nas rela√ß√µes com a Amaz√¥nia.  A seguir, apresentamos os recursos ou inconvenientes que temos com a Amazon: <br><br></p><ol><li>  Voc√™ n√£o pode acessar o console de uma m√°quina virtual atrav√©s de um navegador.  E √†s vezes aqui √© realmente necess√°rio!  Uma vez que exclu√≠mos por engano a interface de rede, o acesso foi perdido em uma das m√°quinas.  Por sorte, algu√©m j√° havia encontrado esse problema. Em meia hora, encontramos e aplicamos a solu√ß√£o com sucesso.  Atrav√©s do console, essa opera√ß√£o pode ser feita em um minuto. </li><li>  Os custos s√£o em d√≥lares e ganhamos em rublos.  Assim, a lucratividade depende do d√≥lar. </li><li>  N√£o h√° data center na R√∫ssia, o mais pr√≥ximo quando come√ßamos era na Irlanda.  Isso significa um grande ping e algumas restri√ß√µes no armazenamento de dados que surgem devido aos requisitos da lei russa. </li><li>  Roskomnadzor bloqueia regularmente os endere√ßos da AWS.  Atualmente, h√° disponibilidade de servidor diferente na AWS em sites diferentes.  Por motivos desconhecidos, a conex√£o com a m√°quina pode cair.  Normalmente, alterar o endere√ßo IP, a VPN e o proxy ajuda. </li><li>  A Amazon √© significativamente mais cara que as nuvens russas.  √â verdade que voc√™ pode reduzir o custo atrav√©s de um programa de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">backup</a> flex√≠vel e do uso de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">inst√¢ncias spot</a> .  E estamos usando ativamente os dois.  Infelizmente, ainda n√£o vimos essa funcionalidade nas nuvens dom√©sticas (atualiza√ß√£o: a YC anunciou ‚ÄúVMs interrompidas‚Äù no boletim de not√≠cias de 18 de fevereiro, estamos aguardando detalhes). </li><li>  O problema com mensagens insuficientemente informativas.  Durante a transi√ß√£o da 3¬™ gera√ß√£o de m√°quinas para a 4 ou 5, o hardware virtual mudou seriamente, em particular, o m√©todo de conex√£o de unidades, e as m√°quinas simplesmente n√£o foram iniciadas ap√≥s a altera√ß√£o do tipo.  A interface de gerenciamento da inst√¢ncia retornou uma mensagem concisa: capacidade insuficiente.  Havia limites suficientes para criar os tipos necess√°rios de m√°quinas com uma margem e, por cerca de seis meses, torturamos sem sucesso o suporte t√©cnico gratuito √†s custas da altera√ß√£o dos limites.  N√£o ajudou.  Como resultado, eles mesmos pesquisaram a solu√ß√£o - uma recrea√ß√£o banal das m√°quinas ajuda. </li><li>  Algumas vezes apagamos os SSDs em falhas: os discos simplesmente desapareceram do sistema junto com todos os dados.  Dado que estes eram <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">discos ef√™meros</a> , ou seja,  os dados s√£o perdidos quando a m√°quina para, n√£o armazenamos algo insubstitu√≠vel neles. </li></ol><br><p>  Em princ√≠pio, era poss√≠vel conviver com essas defici√™ncias.  No entanto, exatamente no momento em que a Amazon finalmente percebeu o mercado russo, nossa conta n√£o se tornou muito conveniente para o pagamento com cart√£o.  Felizmente, a Amazon rapidamente corrigiu a situa√ß√£o e nos forneceu um gerente de contas que nos ajudou a deixar de pagar atrav√©s de um cart√£o para um contrato direto, pagar uma fatura e elaborar v√°rios tipos de acordos.  Em geral, ele vem regularmente √† R√∫ssia e, quando chega at√© n√≥s, fala sobre oportunidades para otimizar a infraestrutura e o pagamento.  √Äs vezes, ele traz com ele um arquiteto de solu√ß√µes, com o qual ele pode discutir a arquitetura atual de nossa solu√ß√£o, falar sobre ‚Äúlista de desejos‚Äù e problemas e obter v√°rias solu√ß√µes, n√£o apenas atrav√©s dos servi√ßos da AWS.  Os funcion√°rios da Amazon declaram que seu objetivo n√£o √© fornecer mais servi√ßos, mas garantir que os servi√ßos adquiridos beneficiem os neg√≥cios.  Parece que isso √© realmente verdade.  O n√∫mero de servi√ßos, a velocidade de seu desenvolvimento e a profundidade da integra√ß√£o m√∫tua s√£o impressionantes.  A AWS tem tudo para organizar o processo de desenvolvimento e a opera√ß√£o de sistemas altamente carregados de qualquer escala.  At√© agora, apenas um problema global √© caro! </p><br><h2>  IT Grad 2016 </h2><br><p>  Em 2015, decidimos que era hora de abandonar completamente nosso pr√≥prio ferro.  Eu queria colocar os problemas na confiabilidade do equipamento especificamente em outros e me concentrar mais na melhoria dos processos de nosso pr√≥prio desenvolvimento.  De acordo com nossas previs√µes, em 2016 ter√≠amos o suficiente do equipamento que possu√≠mos no momento e gostar√≠amos de ter uma reserva para todos os eventos de inc√™ndio.  Abordamos minuciosamente a escolha do fornecedor: preparamos um teste de carga e um question√°rio com perguntas importantes para n√≥s e escolhemos meticulosamente cinco fornecedores: ActiveCloud, Cloud4Y, CloudOne, IT Grad, Softline. </p><br><p>  Como resultado, optamos pelas nuvens de TI Grad.  Suas vantagens: <br></p><ol><li>  Posi√ß√£o de vida ativa, respostas √†s nossas perguntas foram dadas rapidamente, era f√°cil de se comunicar. </li><li>  A presen√ßa de unidades SSD r√°pidas, at√© 30 IOPS por GB.  O n√∫mero de opera√ß√µes de leitura aleat√≥ria √© um indicador muito importante para n√≥s, pois valores altos nos permitem colocar nossos m√≥dulos de digitaliza√ß√£o na nuvem. </li><li>  Plataforma VCloud com a capacidade de controlar m√°quinas e a presen√ßa de um console para cada m√°quina. </li><li>  A capacidade de aumentar os recursos de uma m√°quina virtual sem reiniciar. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Faturamento flex√≠vel</a> - o pagamento √© feito pelos recursos que estavam em uso no dia no meio do per√≠odo do relat√≥rio (nos dias 14 a 15 de cada m√™s).  Al√©m disso, existe uma op√ß√£o "Pague conforme o uso", no entanto, √© mais cara e o c√°lculo da quantidade de recursos consumidos √© feito pela carga m√©dia de CPU e RAM a cada 2 horas. </li></ol><br><p>  Em 2016, nos mudamos para o IT Grad.  Aqui est√° o que aconteceu nos tr√™s anos incompletos de nossa vida juntos: <br><br></p><ol><li>  Uma vez tivemos um problema.  Exatamente √†s 21:00, come√ßou uma queda dr√°stica no desempenho.  O n√∫mero de verifica√ß√µes que o sistema poderia fazer caiu de 150 para 20-30 por minuto, enquanto depois de algumas horas tudo foi restaurado e resolvido a uma velocidade de 600 verifica√ß√µes por minuto.  Pesquisamos uma semana em casa, verificamos usu√°rios, pegamos bots e DDoS, mas n√£o encontramos nada.  Voltamos ao suporte da IT-Grad e descobrimos que "ah, e estamos fazendo backups aqui".  Como resultado, eles nos esmagaram com uma fonte de problemas para diferentes sistemas de disco e configuraram o trabalho. </li><li>  Normalmente (recursos de uso do produto), durante uma sess√£o, nosso tr√°fego excede 100 megabits por segundo.  A prop√≥sito, esse valor geralmente √© definido por padr√£o para o canal n√£o reservado em muitos provedores de nuvem.  Quando cruzamos essa fronteira, surgiram v√°rios problemas: o Edge interno n√£o conseguia lidar com a VPN entre o ponto de entrada localizado em nossos equipamentos e a m√°quina virtual do servidor da Web localizado na nuvem.  Como esperado, eles se voltaram para o suporte, onde nos foi oferecido o aumento de recursos no Edge.  Ok, sem d√∫vida, substitu√≠mos sua configura√ß√£o de pequena para grande e tamb√©m expandimos o canal para o tamanho do nosso pico de tr√°fego com uma margem.  N√£o ajudou.  Em geral, n√£o conseguimos encontrar a solu√ß√£o ideal, tive que reduzir o volume de tr√°fego movendo parte da produ√ß√£o para outros sites. </li><li>  √Äs vezes, a conex√£o VPN ao site IT Grad √© interrompida por 1-2 minutos.  Para a pergunta de por que isso acontece, nem n√≥s nem o suporte t√©cnico podemos encontrar a resposta.  At√© agora eu tenho que conviver com esse problema. </li><li>  O mecanismo para redimensionar recursos funciona mal, tanto em tempo real quanto no estado desligado.  Parece-me, no entanto, que isso √© um problema com o fornecedor da plataforma (VMware).  No entanto, j√° descobrimos o fato de que, para aplicar todas as extens√µes de maneira confi√°vel, era necess√°rio reiniciar a m√°quina convidada (Windows Server 2012 R2).  Ap√≥s o redimensionamento, a pr√≥pria m√°quina n√£o inicializou v√°rias vezes.  O suporte solucionou esse problema das 2 √†s 4 da manh√£ durante a sess√£o - nossa pr√≥pria esta√ß√£o.  Estava quente mesmo √† noite! </li><li>  Em 2016, t√≠nhamos um mon√≥lito enorme, como o Everest, que exigia muitos recursos.  Tantos que √†s vezes precis√°vamos exceder o tamanho m√°ximo de m√°quinas convidadas recomendado para um determinado host.  O suporte persistentemente nos pediu para reduzir o tamanho das m√°quinas virtuais para pelo menos metade do tamanho do host.  Devemos prestar homenagem ao IT Grad - nos foi oferecido o uso de um hardware separado, com a capacidade de us√°-lo inteiramente, por um pouco mais de dinheiro, e a flexibilidade da nuvem foi perdida. </li><li>  O faturamento uma vez por m√™s para medir a quantidade de recursos consumidos foi um truque para n√≥s duas vezes.  No in√≠cio, perguntamos diretamente sobre a oportunidade de reduzir recursos entre 14 e 15 de um m√™s para pagar menos.  N√≥s fomos respondidos diretamente que √© assim que funciona.  A primeira vez que isso nos atingiu dolorosamente durante a transfer√™ncia de uma parte da venda para a nossa nuvem.  O fator humano funcionou - eles tentaram terminar tudo rapidamente at√© o dia 14 e, em seguida, anotaram notavelmente.  Na segunda vez, aproveitamos essa oportunidade ap√≥s quase tr√™s anos de coopera√ß√£o, ap√≥s o qual fomos cobrados em m√©dia no 5¬∫, 15¬∫ e 20¬∫ dia.  Ent√£o, o fator humano funcionou para eles - depois da liga√ß√£o, eles cometeram um erro a seu favor (o rec√°lculo foi feito manualmente), pediu desculpas, deu um desconto. </li><li>  O desempenho de discos e m√°quinas como um todo atendeu √†s caracter√≠sticas declaradas.  No entanto, v√°rias vezes n√£o conseguimos entender por que tudo estava funcionando t√£o lentamente, at√© a interface desacelerou sem piedade.  O suporte garantiu que tudo estava em ordem e que eles n√£o tiveram problemas com o equipamento.  O que aconteceu l√° - nosso servidor naquele momento migrou para um host vizinho ou algu√©m fez backup do subsistema de disco - continua sendo um mist√©rio para n√≥s. </li><li>  Os discos podem ser alternados entre m√°quinas de forma independente apenas por meio de suporte.  No in√≠cio do uso, era imposs√≠vel ter discos de tipos diferentes na m√°quina; era necess√°rio sair (iSCSI, Samba e NFS).  Depois de algum tempo, o uso de diferentes tipos de discos em uma m√°quina tornou-se poss√≠vel primeiro pelo suporte e depois por conta pr√≥pria (aparentemente feito no vCloudDirector).  A prop√≥sito, a atualiza√ß√£o do sistema de gerenciamento de virtualiza√ß√£o ocorre regularmente.  Recebemos uma carta 1-2 vezes por m√™s, informando que por uma hora ou duas o sistema de controle de m√°quina virtual realiza trabalhos t√©cnicos e ficar√° indispon√≠vel por algum tempo, as pr√≥prias m√°quinas continuam a trabalhar nesse momento. </li><li>  Em 16 de fevereiro de 2018, uma parte de nossas vendas localizadas em IT Grad residia devido a problemas de fornecimento de energia do data center em que o equipamento estava localizado.  N√≥s aprendemos sobre o incidente de fato; n√£o conseguimos entrar em contato com o suporte t√©cnico.  Eu tive que ligar para o nosso gerente de contas, ele imediatamente disse em um minuto o que e como, e desconectou, aparentemente dizendo o resto.  Do agrad√°vel - est√°vamos deitados ao lado de VKontakte. </li></ol><br><p>  Depois de passar algum tempo em uma casa alugada e confrontado com tudo isso, em 2017, decidimos que era bom visitar, mas melhor em casa, e come√ßamos a criar uma nuvem com discos NVMe r√°pidos e a capacidade de controlar tudo completamente.  Assim que foi feito: eles transferiram as vendas para sua nuvem de clientes corporativos e m√≥dulos de pesquisa (no total, mais de 90% da carga), deixando monitoramento, estat√≠sticas e clientes particulares no IT Grad.  Em 2018, todos calcularam novamente e descobriu-se que era mais lucrativo dividir a produ√ß√£o: manter parte da nuvem alugada e parte pr√≥pria.  O que veio disso - contamos mais. </p><br><h2>  Solu√ß√µes de nuvem de correio </h2><br><p>  Honestamente, eu queria, como na AWS, mas na R√∫ssia.  Portanto, come√ßamos a olhar para as nuvens com conjuntos de servi√ßos semelhantes (a quem estou enganando, pelo menos com o an√°logo de EC2 e S3).  A pesquisa teve vida curta - encontramos a "Amaz√¥nia Russa" na pessoa do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MCS</a> .  Uma grande empresa com uma ampla gama de servi√ßos diversos, por todas as indica√ß√µes, eles devem ser capazes de preparar as nuvens! </p><br><p>  O come√ßo do conhecido foi maravilhoso.  Um gerente de contas veio ao nosso escrit√≥rio, contou tudo em detalhes, descreveu as oportunidades e os planos atuais para o futuro pr√≥ximo.  A sa√≠da foi uma imagem maravilhosa: pre√ßos baixos para recursos de computa√ß√£o, existe um armazenamento de objetos e uma sa√≠da antecipada para a produ√ß√£o de banco de dados (semelhante ao RDS).  Tamb√©m recebemos um s√≥lido limite de caixa para testes (ainda mais do que o Azure oferece). </p><br><p>  Naquela √©poca, j√° t√≠nhamos a parte de IaC pronta para implantar todas as m√°quinas por terraform.  O MCS tinha abertura aberta e era bem suportado!  A prop√≥sito, o suporte t√©cnico √© realizado por meio de um canal de telegrama - comunica√ß√£o "ao vivo" e √© claro que eles querem ajudar.  Existe um sistema de tickets, mas ainda n√£o o usamos.  SLA de Suporte T√©cnico refere-se a solicita√ß√µes criadas no sistema de tickets. </p><br><p>  Em dezembro de 2018, t√≠nhamos escrito scripts de implanta√ß√£o de infraestrutura via terraform.  Est√° na hora de mudar.  Para come√ßar, decidimos transferir o sistema com clientes particulares, que passaram todo esse tempo com equipamentos no IT Grad.  Ent√£o tudo √© como em um filme: <br></p><blockquote><code>7  (), 18:00     .  ,          . <br> 10  (), 10:00   ‚Äì     . <br> 12  () ‚Äì  . <br> 10:00     terraform.     ,   ,    . <br> 12:00   ansible'.   .   ! <br> 15:30  .         30 ,            16:30. <br> 15:45      .      . <br> 15:55     .     :  ,     . <br> 16:20 ,       .   ,    . ,     -            . <br> 17:30     ,    ,    . <br> 18:00        .       1,5 . <br></code> </blockquote><br><p>  O problema identificado com diferentes formatos com uma nova tentativa n√£o deveria ter aparecido, mas o encontramos e, por via das d√∫vidas, o corrigimos. <br></p><blockquote> <code>17  (),   . <br> 15:30    .      ,      . <br> 16:00        .   . <br> 16:30      ,      100%.   -?   ! <br> 17:00       ,   ,  , , iotop, top, ProcessExplorer, PerformanceMonitor.  . <br> 21:45    ,   ,  ,    2000 . <br> 22:00  ,  . <br></code> </blockquote><br><p>  O antigo produto da IT Grad atendeu facilmente √† demanda adiada por verifica√ß√µes de usu√°rios, sem problemas. </p>  No dia seguinte (18 de dezembro), percebemos o seguinte: <br><br><ol><li>  N√£o sab√≠amos o que especificamente desacelerava o sistema.  Antes do friso, praticamente n√£o havia carga em lugar algum.  Sim, ainda temos chamadas de bloqueio profundo dentro do sistema e provavelmente h√° um bloqueio em algum lugar, mas onde exatamente, n√£o conseguimos, foi necess√°rio investigar mais. </li><li>  Nosso teste de carga atual n√£o corresponde ao perfil de carga do prod.  Foi incr√≠vel porque  Gra√ßas a esse teste, nos preparamos para a √∫ltima sess√£o, identificamos e eliminamos um grande n√∫mero de gargalos.  Mas essa √© a realidade - √© necess√°rio refazer o teste com base na experi√™ncia adquirida. </li><li>  Produzido em IT Grade com recursos compar√°veis ‚Äã‚Äãde CPU e RAM, pode lidar facilmente com o dobro da carga. </li></ol><br>  Ent√£o, constru√≠mos rapidamente um teste que alcan√ßa o mesmo resultado que vimos em primeira m√£o.  Fomos ao suporte do MCS para descobrir se estamos consumindo algum limite de CPU, mas em geral √© nosso completamente ou n√£o, e est√° tudo bem com a rede.  Eles ainda n√£o responderam √† segunda pergunta, encontraram algo na terceira e nos recomendaram fazer altera√ß√µes nos sistemas com v√°rios n√∫cleos.  Em geral, desenvolvemos uma atividade vibrante, o fim do ano est√° pr√≥ximo e todos querem sair para as f√©rias com um sentimento de realiza√ß√£o. <br><p>  Aqui est√° o que acabamos trabalhando no MCS: <br><br></p><ol><li>  Mesmo no est√°gio de sele√ß√£o, recebemos uma tabela com as caracter√≠sticas de hardware virtual e SLA por disco.  Uma das vantagens foi que eles prometeram 50 IOPS / GB (IT Grad: 30 IOPS / GB) para o SSD.  O contrato acabou sendo diferente: ‚Äúlendo: 5000 IOPS, escrevendo: 2000 IOPS‚Äù e perdemos isso, n√£o esper√°vamos isso.  As mesas s√£o id√™nticas, a diferen√ßa est√° em apenas um lugar!  A prop√≥sito, n√£o vimos as depend√™ncias de desempenho no tamanho do disco.  Quando testamos, descobriu-se que, com uma unidade maior, a velocidade diminui.  O segredo desses indicadores pequenos √© que o MCS possui ceph geodistribu√≠do, o que significa que at√© que o n√≥ remoto diga que os dados foram gravados, o cliente n√£o ser√° informado de que a grava√ß√£o est√° conclu√≠da.  A prop√≥sito, ningu√©m parece ter essa confiabilidade "pronta para uso" entre os provedores com quem conversamos.  Mas, para n√≥s, essa confiabilidade apenas coloca paus nas rodas!  Se algo acontecer, precisamos mudar rapidamente para outro controlador de dom√≠nio quando surgirem problemas e, portanto, teremos nossa pr√≥pria replica√ß√£o ass√≠ncrona.  Temos <abbr title="Plano de recupera√ß√£o de desastres">DRP</abbr> e estamos preparados para a perda de uma pequena quantidade de dados em caso de acidente.  Devemos prestar homenagem ao MCS, eles aceleraram o comissionamento de uma matriz SSD local, cujo desempenho foi muito maior. </li><li>  Quanto aos par√¢metros das m√°quinas, eles n√£o s√£o arbitr√°rios.  H√° um certo conjunto de CPU-RAM- {SSD / HDD} (quase como na AWS) e outros tipos de m√°quinas podem ser criados apenas atrav√©s do suporte.  Todo o processo leva cerca de 2 horas, n√£o h√° limite para o n√∫mero de tipos, o principal √© que o n√∫mero de n√∫cleos n√£o deve ser superior a metade dos hypervisor ~ 40-48 processadores.  Durante a cria√ß√£o da m√°quina, voc√™ pode adicionar discos e altern√°-los entre m√°quinas. </li><li>  Depois de ligar o SSD local, a altera√ß√£o dos par√¢metros da m√°quina impossibilitou a inicializa√ß√£o.  Eles s√≥ poderiam ser lan√ßados atrav√©s do suporte.  Em algum lugar em um m√™s, eles resolveram o problema. </li><li>  Pela primeira vez, confrontado com o suporte t√©cnico por telegrama.  Em geral, √© conveniente, especialmente no in√≠cio, quando h√° muitas perguntas e h√° uma moagem no servi√ßo.  Por√©m, quanto mais longe, mais dif√≠ceis s√£o as perguntas e a velocidade da resposta e do conte√∫do da informa√ß√£o diminui lentamente.  At√© o final do ano, quando, √© claro, os prazos de todos estavam cumpridos, a baixa velocidade das respostas me enfureceu terrivelmente.  Em algum momento, eles at√© perguntaram sobre os SLAs.  Foi a√≠ que entendeu que o SLA est√° no sistema de tickets e n√£o no telegrama!  Em 19 de fevereiro, v√°rias perguntas n√£o respondidas, feitas em 24 de dezembro, est√£o neste canal ... </li><li>  O suporte t√©cnico atrav√©s do sistema de tickets n√£o leva em considera√ß√£o que estamos conectados e requer uma notifica√ß√£o adicional do n√∫mero do contrato.  Em resposta, ele envia uma carta "entraremos em contato com voc√™", mas n√£o indica o n√∫mero ou o status do ticket. </li></ol><br><p>  Enquanto trabalhava com o MCS, outra nuvem come√ßou a parecer em paralelo. </p><br><h2>  Mais uma nuvem (Yandex Cloud) </h2><br><p>  O primeiro dos outros foi Yandex.  No final de 2018, eles tinham apenas m√°quinas virtuais e armazenamento de objetos, seu pr√≥prio shell de sistema de virtualiza√ß√£o, API aberta.  O plugin terraform estava em alfa e foi aceito pela HashiCorp.  O suporte, como sempre, √© via telegrama, mas √© menos ativo do que no MCS.  O limite de dinheiro do teste √© pequeno o suficiente e n√£o nos permitiu realizar testes normais.  Eu tive que concluir rapidamente um contrato (3 dias √∫teis) e pagar pelos testes.  De acordo com os resultados do teste, obtivemos o mesmo que no MCS.  Come√ßou a nos parecer que havia dois problemas: todo mundo tem drives muito lentos e temos um teste muito severo. </p><br><h2>  Graduado em TI 2019 </h2><br><p>  Em geral, estabelecemos um prazo para a mudan√ßa j√° em 22 de dezembro, para que houvesse mais uma semana para identificar e resolver os problemas ocultos de uma nova resid√™ncia.  Tendo perdido a esperan√ßa de passar para o prazo final e um pouco cansado da abund√¢ncia de novas informa√ß√µes na pessoa do MCS e da YC, decidimos que o IT Grad n√£o √© t√£o ruim assim.  N√≥s at√© nos sentimos um pouco nost√°lgicos e pensamos que tudo que √© novo √© antigo e bem estabelecido.  J√° na IT Grad, definitivamente trabalharemos bem - h√° um precedente.  Al√©m disso, o IT Grad aumentou: havia um data center em Moscou, N√≠vel III, tempo de atividade no momento em que ainda possui 100% (nunca falha) e o equipamento interno √© Intel Xeon Scalable de 4 soquetes (at√© 42 n√∫cleos x 3 Xeon Gold 6154 de GHz).  Que diabos n√£o est√° brincando, vamos dar uma segunda chance! <br></p><blockquote> <code>28  (), 18:10   -     vDC      ,    ,          . <br> 29  ( ), 17:04    ,   .   .iso  ,          .           ,   .  ,    .   ,    . <br> 30  (), 22:00 ,            .iso,             .       ,   - . <br> 31  (), 3:15    Edge   vDC    vDC. ,              .      . <br> <br>  ,   . <br> <br> 2  (), 15:30       . <br> 2  (), 21:50 ,   Guest OS Customization  . <br> 3  (), 18:05   !</code> </blockquote> <br><p></p><ol><li>  Agora, na prepara√ß√£o do artigo, eles descobriram que o hor√°rio exato das solicita√ß√µes e respostas n√£o se reflete no sistema de tickets.  Em vez disso, diz "cerca de 2 meses atr√°s", a hora exata √© mostrada apenas em uma dica de ferramenta.  Por correio, tamb√©m √© dif√≠cil restaurar a sequ√™ncia de eventos.  As mensagens enviadas pelo correio s√£o l√≥gicas n√£o √≥bvias e n√£o cont√™m uma descri√ß√£o da a√ß√£o.  Os tickets s√£o criados no sistema ap√≥s algum tempo em nome de um funcion√°rio do suporte t√©cnico da IT Grad. </li><li>  Ap√≥s uma an√°lise mais detalhada do equipamento ap√≥s as f√©rias, vimos o Xeon v2 l√°.  N√£o foi nisso que concordamos.  Ok, decidimos esta pergunta com o gerente da conta.  Houve algumas dificuldades devido ao fato de que, no novo ano de 2019, o IT Grad foi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">inclu√≠do no MTS</a> e logo ap√≥s as f√©rias houve uma pequena bagun√ßa.  Do vDC em novos equipamentos no Moscow DC n√£o era vis√≠vel o vDC criado antes do ano novo.  Somente atrav√©s da Internet aberta, o suporte t√©cnico nos agradou que a velocidade de movimenta√ß√£o n√£o excede 1 TB / dia.  E n√≥s j√° carregamos 7 TB de dados!  Como resultado, eles criaram um aplicativo para mudar na quinta-feira √† noite.  Um dia depois, na sexta-feira √† noite, perguntei como voc√™ est√° e quando eles planejam come√ßar (espere quase uma semana!)?  Um dia depois, no s√°bado √† noite, fomos informados de que todos os carros haviam se mudado.  N√£o gostei daqueles 2,5 dias em que n√£o havia informa√ß√µes sobre o andamento do trabalho e que as estimativas em andamento eram muito pessimistas. </li><li>  Em setembro de 2018, quando come√ßamos a implementar o IaC, percebemos que o terraform funciona muito mal com o vCloudDirector (atual: no momento da reda√ß√£o, aprendemos que o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">VMware vCloud Director Provider 2.0 apareceu</a> , mas ainda n√£o o testamos).  No in√≠cio, n√£o conseguimos nem criar uma m√°quina devido ao fato de que o vCloud nos informou de um erro no esp√≠rito de "algo deu errado, voc√™ tem um erro de 512 caracteres 136 linhas (a linha era mais curta!) Xml da configura√ß√£o da m√°quina".  Pedimos apoio.  A pergunta foi redirecionada para os engenheiros; no final, fomos informados de que o terraform n√£o √© suportado - resolva voc√™ mesmo.  De qualquer forma, descobrimos que o culpado era o empacotador, com o qual coletamos a imagem da m√°quina, ele n√£o conseguia lidar com o formato de configura√ß√£o propriet√°rio do VMware.  O Terraform √© muito ruim com o vCloudDirector, tudo √© encadeado lentamente e o conector foi abandonado por um longo tempo e n√£o se desenvolve.  Ningu√©m nos daria acesso ao vSphere.  Se voc√™ permanecer no VMware, precisar√° ver sua automa√ß√£o atrav√©s da API. </li></ol><br><p>  Organizamos uma bancada de testes em um novo local.  O resultado foi incr√≠vel - o teste falhou, os sintomas s√£o os mesmos do MCS.  Provavelmente, no momento atual, no auge da batalha pela sess√£o, algumas configura√ß√µes do sistema operacional foram alteradas que impedem o congelamento do sistema, mas que agora n√£o podem ser restauradas.  Para impedir que isso aconte√ßa novamente, estamos apresentando o IaC.  Realizamos mais 2 testes: criamos novas m√°quinas a partir de imagens limpas dos sistemas operacionais da venda atual - falha;  nas m√°quinas de produ√ß√£o existentes - sucesso.  Assim, foi confirmado que fizemos alguns ajustes no sistema operacional ou no banco de dados, mas n√£o nos lembramos de qual deles.  Nesse ponto, a solu√ß√£o do nosso desenvolvimento chegou a tempo: os frisos param quando sess√µes confi√°veis ‚Äã‚Äãs√£o desativadas no WCF. </p><br><p>  Realizamos um teste de carga com as configura√ß√µes recomendadas pelos desenvolvedores em paralelo no MCS (2 GHz, Xeon v4) e IT Grad (3 GHz, Xeon v2) - o n√∫mero de n√∫cleos e a mem√≥ria √© o mesmo.  No MCS, o teste passou mais r√°pido (um quarto) e mais suave (no IT Grad, o teste foi inst√°vel, depois mais r√°pido e depois mais lento). </p><br><h2>  Compara√ß√£o de desempenho de disco </h2><br><p>  Est√°vamos mais preocupados com o desempenho de discos para bancos de dados e √≠ndices, motivo pelo qual testamos principalmente SSDs.  N√£o julgue estritamente pelos testes, quando precis√°vamos entender o desempenho das nuvens, no habr.com ainda n√£o havia v√°rios testes de discos, processadores, mem√≥ria ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">uma vez</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dois</a> ) provedores de nuvem.  O tempo era limitado e precis√°vamos comparar rapidamente o desempenho para ter uma id√©ia da diferen√ßa de desempenho.  Portanto, o requisito para o teste era um - ele pode ser repetido rapidamente em qualquer local.  Usamos as m√°quinas o mais pr√≥ximo poss√≠vel dos par√¢metros j√° implantados, fio - para testar o desempenho dos discos e pgbench - para avaliar o desempenho do banco de dados nesse disco.  Como padr√£o, fizemos medi√ß√µes da produ√ß√£o atual - MARS (porque nosso equipamento tem o nome dos her√≥is da s√©rie animada sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ratos de rocha de Marte</a> ). </p><br><p>  Normalmente, o desempenho do disco depende do tamanho.  Observamos esse comportamento na cidade de TI e na AWS, mas no MCS n√£o vimos essa depend√™ncia, ela tamb√©m n√£o existe no SLA e os testes deram um resultado paradoxal (e possivelmente impreciso) - o desempenho diminui com o aumento do disco. </p><br><p>  Contamos as op√ß√µes para discos HDD e SSD, bem como tps (transa√ß√µes por segundo) para o banco de dados postgres em discos SSD.  Existem dois tipos de discos no MCS: SSDs e HDDs regulares com distribui√ß√£o geogr√°fica distribu√≠da e SSDs locais (apenas em um DC) (seu desempenho √© mostrado entre colchetes).  Tamb√©m em janeiro de 2019, na correspond√™ncia do MCS, lemos que eles aumentaram o desempenho do disco em 20%, o resultado do teste tamb√©m est√° na tabela (MCS 2019).  Em fevereiro, outra acelera√ß√£o foi relatada, mas n√£o realizamos testes aqui. </p><br><p>  Resultados: </p><div class="scrollable-table"><table><tbody><tr><th><br></th><th colspan="2">  HDD, iops </th><th colspan="2">  SSD, iops </th><th>  SSD, tps </th></tr><tr><th><br></th><th>  ler </th><th colspan="1">  escrever </th><th>  ler </th><th colspan="1">  escrever </th><th>  ler escrever </th></tr><tr><th><p>  Marte </p></th><td>  1336 </td><td colspan="1">  445 </td><td>  17196 </td><td colspan="1">  5729 </td><td>  2000 </td></tr><tr><th><p>  Graduado em TI <br></p></th><td>  4544 </td><td colspan="1">  1515 </td><td>  13231 </td><td colspan="1">  4407 </td><td>  3063 </td></tr><tr><th colspan="1">  Mcs </th><td colspan="1">  1185 </td><td colspan="1">  395 </td><td colspan="1">  8931 (22857) </td><td colspan="1">  2980 (7637) </td><td colspan="1">  497 (1.402) </td></tr><tr><th colspan="1">  MCS 2019 </th><td colspan="1">  3229 </td><td colspan="1">  1080 </td><td colspan="1">  9334 (22270) </td><td colspan="1">  3113 (7418) </td><td colspan="1">  463 (1342) </td></tr><tr><th colspan="1">  Yc </th><td colspan="1">  2202 </td><td colspan="1">  735 </td><td colspan="1">  5522 </td><td colspan="1">  1843 </td><td colspan="1">  1824 </td></tr></tbody></table></div><br><h3>  Metodologia de teste </h3><br><p>  <strong>iops foi</strong> calculado como a m√©dia de 4 execu√ß√µes de fio: <br> <code>/root/fio-2.0.9/fio --randrepeat=1 --ioengine=libaio --direct=1 --gtod_reduce=1 --name=test --filename=test --bs=4k --iodepth=64 --size=4G --readwrite=randrw --rwmixread=75</code> </p> <br><p>  <strong>tps</strong> , como uma m√©dia de 3 execu√ß√µes pgbench: <br> <code>pgbench -c 10 -j 2 -t 10000 example</code> </p> <br><h3>  Descri√ß√£o dos stands </h3><br><h4>  Marte </h4><br><p>  Xeon v4, 2 GHz <strong>;</strong>  <strong>HDD:</strong> ceph, 3 n√≥s de 9x 2Tb ST2000NX0253, r√©plica 2;  <strong>SSD:</strong> ceph, 3 n√≥s em 2 TB NVMe Intel DC P4600, r√©plica 2 </p><p>  <strong>CPU</strong> : 4, <strong>RAM</strong> : 8GB, <strong>HDD</strong> : 32GB, <strong>SSD</strong> : 150GB;  A produ√ß√£o paralela est√° girando. </p><br><h4>  Graduado em TI </h4><br><p>  Xeon v4 / v2, 2 GHz <strong>;</strong>  <strong>HDD</strong> : 0,1 IOPS / GB <strong>;</strong>  <strong>SSD:</strong> 30 IOPS / GB </p><p>  <strong>CPU</strong> : 4, <strong>RAM</strong> : 4GB, <strong>HDD</strong> : 250GB, <strong>SSD</strong> : 200GB </p><br><h4>  Mcs </h4><br><p>  Xeon v4;  HDD: r / w: 1500/1000 IOPS;  SSD: r / w: 5000/2000 IOPS </p><p>  Para testar <strong>HDD: CPU</strong> : 2, <strong>RAM</strong> : 4GB, <strong>HDD</strong> : 50GB </p><p>  Para testar <strong>SSD, TPS</strong> : <strong>CPU</strong> : 8, <strong>RAM</strong> : 16GB, <strong>SSD</strong> : 600GB </p><br><h4>  Y </h4><br><p>  Xeon v4, 2GHz <strong><br></strong> </p><p>  <strong>CPU</strong> : 8, <strong>RAM</strong> : 8GB, <strong>HDD</strong> : 20GB, <strong>SSD</strong> : 50GB </p><br><h2>  Compara√ß√£o das estimativas de TCO para o ano </h2><br><p>  Contamos com o <abbr title="Custo total de propriedade">TCO</abbr> para quatro op√ß√µes.  Os valores relativos s√£o mostrados na tabela abaixo.  Devo dizer que este √© um c√°lculo para o nosso caso espec√≠fico e tudo pode ser diferente para voc√™. <br></p><div class="scrollable-table"><table><tbody><tr><th>  Mcs </th><th>  Yc </th><th>  Graduado em TI </th><th>  Aws </th></tr><tr><td>  1 </td><td>  1,23 </td><td>  1,37 </td><td>  2,28 </td></tr></tbody></table></div><br><p>  Fizemos o c√°lculo da seguinte maneira.  O ano foi dividido em duas partes: sess√µes (com maior carga de trabalho) e o resto do tempo.  Para cada parte, foi calculada a quantidade necess√°ria de recursos de CPU e RAM.  O volume de disco necess√°rio, devido ao constante crescimento do servi√ßo, cresce apenas com o tempo, portanto, levamos a m√©dia entre o in√≠cio e o final do ano para avalia√ß√£o. </p><br><p>  Houve pouca dificuldade em avaliar com a AWS, pois  n√£o h√° custo direto para o kernel e gigabytes de mem√≥ria.  Pegamos tr√™s m√°quinas m√≠nimas c5.large, r5.large e m5.large e calculamos seu custo aos pre√ßos do MCS (alterando proporcionalmente o custo do n√∫cleo da CPU, pois o MCS tem uma frequ√™ncia de 2 GHz).  Aconteceu assim: em m√©dia, o custo de inst√¢ncias simples da AWS √© 2,5-2,8 vezes maior que o custo do MCS.  A AWS publica <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pre√ßos</a> sem IVA.  Portanto, para o custo da AWS, adicionamos 20%, a taxa m√©dia anual do d√≥lar √© de 70 rublos.  Os discos s√£o considerados simplesmente pelos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pre√ßos do EBS</a> (usamos diferentes tipos de gp2, sc1, st1).  Em alguns lugares, precisamos de unidades NVMe de inst√¢ncias da fam√≠lia i3.  O pre√ßo por gigabyte √© calculado de maneira muito simples: a diferen√ßa de custo entre o i3 e um processador an√°logo e a inst√¢ncia de mem√≥ria da fam√≠lia r4, dividida pela quantidade de NVMe.  Acontece 3,1 rublos por gigabyte em 30 dias. </p><br><p>  Mesmo na conversa sobre or√ßamentos, gostaria de observar a diferen√ßa no custo de uma licen√ßa do Windows para um n√∫cleo por m√™s para todos os provedores de nuvem.  Na AWS, a diferen√ßa entre o custo das inst√¢ncias do Linux OnDemand e do Windows OnDemand dividido pelo n√∫mero de n√∫cleos √© uma constante de cerca de 2.800 rublos por m√™s.  No YC, a licen√ßa do Windows para o kernel √© 3 vezes mais barata, cerca de 900 rublos por m√™s, e no MCS, quase 9 (!) Vezes mais barata, cerca de 300 rublos por m√™s.  Ainda estamos muito dependentes do Windows: agora, gra√ßas ao n√∫cleo .net, estamos come√ßando a criar uma plataforma cruzada contra o pl√°gio, inclusive para reduzir o custo de manuten√ß√£o. </p><p>  O custo agregado da YC tamb√©m inclui o custo do tr√°fego. </p><br><h2>  Conclus√µes </h2><br><h3>  Atrav√©s das nuvens </h3><br><p>  <strong>AWS</strong>  Eles dizem que na R√∫ssia existem 4 bons provedores de nuvem: AWS, GCP, Azure e DO, e todos eles n√£o est√£o na R√∫ssia. <br>  <em><u>Pr√≥s:</u></em> √≥timo servi√ßo, equipamentos modernos de alta qualidade, boas configura√ß√µes no EC2, um grande n√∫mero de servi√ßos. <br>  <em><u>Contras:</u></em> caro (mais riscos de taxa de c√¢mbio) e n√£o na R√∫ssia (ILV, o grande firewall russo no horizonte).  Eu realmente quero que nossas nuvens sigam este exemplo a seguir. <br>  <em><u>Recursos:</u></em> O suporte t√©cnico gratuito pode resolver um m√≠nimo de problemas, mas, para ser sincero, entramos em contato apenas para expandir os limites de uso.  Pago, a prop√≥sito, custa cerca de 10% da conta. </p><br><p>  <strong>Graduado em TI</strong> .  Bom servi√ßo para a nuvem corporativa.  Existem an√°logos de EC2 e S3 baseados no Swift. <br>  <em><u>Pr√≥s:</u></em> bom desempenho (CPU 1-2-3 GHz, SSD, HDD), equipamento novo (em um dos DCs) entre nuvens dom√©sticas, configura√ß√µes arbitr√°rias da m√°quina. <br>  <em><u>Contras:</u></em> cobran√ßa incompreens√≠vel, VMware (interface flash mal automatizada), um pouco de caos e goivagem no suporte t√©cnico. <br>  <em><u>Recursos:</u></em> aprimorados mais no uso corporativo (depois de configurados, depois em mudan√ßas raras) do que em um sistema p√∫blico altamente carregado (atualiza√ß√µes frequentes, altera√ß√µes constantes).  Desde 2019, os neg√≥cios de IaaS s√£o vendidos junto com pessoas e equipamentos na MTS, agora tudo pode mudar em qualquer dire√ß√£o.  Comunica√ß√£o atrav√©s do sistema de tickets e telefone, gostaria de uma rea√ß√£o mais r√°pida e uma mensagem dos prazos previstos. </p><br><p>  <strong>MCS</strong> .  Existem an√°logos dos servi√ßos EC2 (existem GPUs), S3, ECS, RDS, EMR, servi√ßos pr√≥prios: Machine Learning, Recupera√ß√£o de desastres na nuvem, Backup na nuvem <br>  <em><u>Pr√≥s:</u></em> barato, desenvolvendo ativamente, existem GPUs (Tesla V100 e Grid K2). <br>  <em><u>Contras:</u></em> drives lentos, h√∫mido e mau karma da empresa-m√£e. <br>  <em><u>Recursos:</u></em> o suporte t√©cnico no in√≠cio √© √∫til, um grande n√∫mero de funcion√°rios liga, ajuda √© sentida, mas h√° um decl√≠nio not√°vel na atividade (eles n√£o responderam nada desde 24 de dezembro, estou at√© preocupado com os caras). </p><br><p>  <strong>YC</strong> .  Temos muito pouca experi√™ncia em trabalhar com esse provedor, √© dif√≠cil dizer algo espec√≠fico.  Existem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">an√°logos de</a> EC2, S3, RDS, DS, SQS (alfa), ELB (alfa), seus servi√ßos exclusivos: SpeechKit, Translate. <br>  <em><u>Pr√≥s: as</u></em> unidades s√£o mais r√°pidas que o MCS. <br>  <em><u>Contras: o</u></em> provedor de terraforma√ß√£o √© √∫mido;  o software do shell de virtualiza√ß√£o com API aberta n√£o √© muito grande para a comunidade, o que significa que, at√© o momento, voc√™ pode confiar apenas nos pontos fortes da equipe do YC no desenvolvimento do provedor para terraform. <br>  <em><u>Caracter√≠sticas:</u></em> pagar pelo tr√°fego. </p><br><br><h3>  Li√ß√µes aprendidas </h3><br><ol><li>  Percebemos que os testes de estresse s√£o moralmente obsoletos.  Eles atualizaram o teste, encontraram novos gargalos, os corrigiram e melhoraram o produto.  Lembramos que o teste de carga deve ser adequado e deve haver configura√ß√µes nas quais ele definitivamente n√£o passa, para que voc√™ possa ver o limite de sua aplicabilidade. </li><li>  Apesar da cren√ßa generalizada de que o software n√£o est√° sendo otimizado no momento e que todos os gargalos est√£o sendo inundados com recursos, tivemos que descobrir e otimizar nosso sistema.  Acabou melhor do que era, a nova vers√£o do Anti-Pl√°gio requer menos recursos e funciona mais r√°pido.  J√° descrevi v√°rios outros lugares onde voc√™ pode reduzir o consumo de recursos. </li><li>  Fizemos a IaC, implantamos e atualizamos atrav√©s do ansible, aprendemos a passar de nuvem em nuvem (com replica√ß√£o preliminar de dados) em quase 10 a 15 minutos.  Se os dados s√£o copiados e a replica√ß√£o regular √© configurada, aqui est√° o Plano de Recupera√ß√£o de Desastres: movendo-se em meia hora com perda de dados nos √∫ltimos 15 minutos. </li></ol><br><h3>  O que queremos das nuvens </h3><br><ol><li>  Respostas r√°pidas do suporte t√©cnico.  Infelizmente, n√£o podemos us√°-lo como na AWS, at√© agora - h√° muito pouca informa√ß√£o dispon√≠vel. </li><li>  Suporte para automa√ß√£o da implanta√ß√£o da infraestrutura por meio de fundos gratuitos (terraform). </li><li>  Previsibilidade no desempenho.  Isso se aplica a cobran√ßa, desempenho da CPU, RAM e discos. </li><li>  A presen√ßa de an√°logos funcionais EC2, S3, RDS agora.  Num futuro pr√≥ximo, precisamos de suporte para c√°lculos de k8s e GPU (j√° o usamos na AWS). </li></ol><br><p>  Al√©m de mudar para as nuvens, nos √∫ltimos meses, conseguimos tocar o ancinho em outras √°reas.  Como foi - contaremos um pouco mais tarde. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt440912/">https://habr.com/ru/post/pt440912/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt440902/index.html">Metade do reino da IA: quanto os bancos economizam em aprendizado de m√°quina, redes neurais e bots de bate-papo</a></li>
<li><a href="../pt440904/index.html">Compara√ß√£o das arquiteturas Viper e MVVM: como aplicar os dois</a></li>
<li><a href="../pt440906/index.html">Semin√°rio on-line "167-–§–ó. Como os bancos podem atender aos requisitos do Banco Central para sistemas antifraude ‚Äù- 26 de fevereiro de 2019 √†s 11:00 Hora de Moscou</a></li>
<li><a href="../pt440908/index.html">Servir tudo</a></li>
<li><a href="../pt440910/index.html">Por que os bancos monopolizam a blockchain?</a></li>
<li><a href="../pt440914/index.html">Perdi a f√© na ind√∫stria, queimei, mas o culto da ferramenta me salvou</a></li>
<li><a href="../pt440916/index.html">Radia√ß√£o: unidades</a></li>
<li><a href="../pt440918/index.html">Semana de seguran√ßa 08: hacking VFEMail live</a></li>
<li><a href="../pt440920/index.html">Implementando a interface do usu√°rio no iOS: melhor, mais r√°pido e escal√°vel</a></li>
<li><a href="../pt440922/index.html">Como o Level Flow funciona em Uncharted 4 e The Last Of Us</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>