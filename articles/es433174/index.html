<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üç¥ üíáüèø üî∞ No todos los parches son igualmente √∫tiles. üòè üïì üó£Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Esta publicaci√≥n contin√∫a la discusi√≥n de las mejoras de rendimiento que podr√≠an hacerse realidad si no fuera por los diferentes peros. La parte anter...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>No todos los parches son igualmente √∫tiles.</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433174/"><p> Esta publicaci√≥n contin√∫a la discusi√≥n de las mejoras de rendimiento que podr√≠an hacerse realidad si no fuera por los diferentes peros.  La parte anterior sobre <code>StringBuilder</code> est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . </p><br><p>  Aqu√≠ observamos varias "mejoras" rechazadas debido a la falta de comprensi√≥n de las sutilezas de la especificaci√≥n del lenguaje, los casos de esquina no obvios y otras razones.  Vamos! </p><a name="habracut"></a><br><h4 id="kogda-nichto-ne-predveschaet-bedy">  Cuando nada presagia problemas </h4><br><p>  Creo que cada uno de nosotros trabaj√≥ con los m√©todos <code>Collections.emptySet()</code> / <code>Collections.emptyList()</code> .  Estos son m√©todos muy √∫tiles que le permiten devolver una colecci√≥n inmutable vac√≠a sin crear un nuevo objeto.  Mirando dentro de la clase <code>EmptyList</code> veremos esto: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EmptyList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">E</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Iterator&lt;E&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">iterator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> emptyIterator(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Object[] toArray() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } }</code> </pre> <br><p>  ¬øVes un fuerte potencial de mejora?  El m√©todo <code>EmptyList.iterator()</code> devuelve un iterador vac√≠o de la presencia, ¬øpor qu√© no hacer la misma finta con sus o√≠dos para la matriz devuelta por el m√©todo <code>toArray()</code> ? </p><br><div class="spoiler">  <b class="spoiler_title">Hay uno pero, y se llama documentaci√≥n</b> <div class="spoiler_text"><blockquote>  La matriz devuelta ser√° "segura" ya que esta lista no mantiene referencias a ella.  (En otras palabras, este m√©todo debe asignar una nueva matriz incluso si esta lista est√° respaldada por una matriz).  La persona que llama puede modificar la matriz devuelta. </blockquote><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">http://mail.openjdk.java.net/pipermail/core-libs-dev/2017-September/049170.html</a> <br>  <a href="" rel="nofollow">http://hg.openjdk.java.net/jdk/jdk12/file/ffac5eabbf28/src/java.base/share/classes/java/util/List.java#l185</a> </p></div></div><br><p>  En otras palabras, el m√©todo siempre debe devolver una <strong>nueva</strong> matriz. </p><br><p>  Dir√°s: "¬°√âl es inmutable! ¬øQu√© puede salir mal?" </p><br><p>  Solo expertos experimentados pueden responder esta pregunta: </p><br><blockquote>  - ¬øQui√©n es responsable? <br>  - Expertos responsables Paul Sandoz y Tagir Valeev </blockquote><br><div class="spoiler">  <b class="spoiler_title">La respuesta de los expertos.</b> <div class="spoiler_text"><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">http://mail.openjdk.java.net/pipermail/core-libs-dev/2017-September/049171.html</a> </p><br><blockquote>  Tambi√©n tenga en cuenta que esto cambia el comportamiento visible.  E. g.  alguien podr√≠a sincronizarse en el objeto de matriz devuelto por la llamada a Array, por lo que este cambio podr√≠a causar un <strong>intercambio de bloqueo</strong> no deseado. <br><br>  Una vez que suger√≠ una mejora similar: devolver EMPTY_LIST de Arrays.asList () cuando la matriz suministrada tiene una longitud cero.  Se rechaz√≥ con la misma raz√≥n [1]. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">http://mail.openjdk.java.net/pipermail/core-libs-dev/2015-September/035197.html</a> <br><br>  Por cierto, probablemente sea razonable que Arrays.asList compruebe la longitud de la matriz como: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">List&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">asList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T... a)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(a.length == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Collections.emptyList(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(a); }</code> </pre> <br><br>  Suena razonable, ¬øverdad?  ¬øPor qu√© crear una nueva lista para una matriz vac√≠a si puede tomar una lista preparada de forma gratuita? <br>  Hay una raz√≥n para no hacer esto.  Por el momento, Arrays.asList no especifica restricciones en la identidad de la Lista devuelta.  Agregar la microoptimizaci√≥n cambiar√° eso.  Es un caso marginal y un caso de uso cuestionable tambi√©n, pero teniendo en cuenta que dejar√≠a las cosas conservadoramente como est√°n. </blockquote></div></div><br><p>  Esta afirmaci√≥n probablemente te causar√° desconcierto: </p><br><blockquote>  E. g.  alguien podr√≠a sincronizarse en el objeto de matriz devuelto por la llamada a Array, por lo que este cambio podr√≠a causar un intercambio de bloqueo no deseado. </blockquote><p>  Dir√°: "¬øQui√©n en su sano juicio se sincronizar√° en la matriz (!) Devuelto (!!!) de la colecci√≥n!?" </p><br><p>  No parece muy cre√≠ble, pero el lenguaje brinda esa oportunidad, lo que significa que existe la posibilidad de que cierto usuario haga esto (o incluso que ya lo haya hecho).  Luego, el cambio propuesto cambiar√° en el mejor de los casos el comportamiento del c√≥digo y, en el peor de los casos, provocar√° un colapso en la sincronizaci√≥n (vaya m√°s tarde, ag√°rrelo).  El riesgo es tan injustificado y la ganancia esperada es tan insignificante que es mejor dejar todo como est√°. </p><br><p>  En general, la capacidad de sincronizar cualquier objeto, kmk, fue un error de los desarrolladores del lenguaje.  En primer lugar, el encabezado de cada objeto contiene una estructura responsable de la sincronizaci√≥n, y en segundo lugar, nos encontramos en la situaci√≥n descrita anteriormente cuando un objeto aparentemente inmutable no puede devolverse varias veces, ya que puede sincronizarse en √©l. </p><br><p>  La moraleja de esta f√°bula es esta: la especificaci√≥n y la compatibilidad con versiones anteriores son vacas sagradas de Java.  Ni siquiera intentes invadirlos: el guardia dispara sin previo aviso. </p><br><h4 id="staraeshsya-staraeshsya">  Intentando, intentando ... </h4><br><p>  Hay varias clases basadas en matrices en el JDK a la vez, y todas ellas implementan los m√©todos <code>List.indexOf()</code> y <code>List.lastIndexOf()</code> : </p><br><ul><li>  java.util.ArrayList </li><li>  java.util.Arrays $ ArrayList </li><li>  java.util.Vector </li><li>  java.util.concurrent.CopyOnWriteArrayList </li></ul><br><p>  El c√≥digo de estos m√©todos en estas clases se repite casi uno a uno.  Muchas aplicaciones y marcos tambi√©n ofrecen sus soluciones para el mismo problema: </p><br><ul><li>  <a href="" rel="nofollow">org.hibernate.bytecode.enhance.internal.tracker.SimpleFieldTracker</a> </li><li>  <a href="" rel="nofollow">com.intellij.util.ArrayUtil</a> </li><li>  <a href="" rel="nofollow">com.intellij.util.ArrayUtilRt</a> </li><li>  <a href="" rel="nofollow">org.springframework.oxm.jibx.JibxMarshaller</a> </li></ul><br><p>  Como resultado, tenemos un c√≥digo perdido que debe compilarse (a veces a veces varias veces), que tiene lugar en ReserverCodeCache, que debe probarse y que simplemente va de clase en clase casi sin cambios. </p><br><p>  Los desarrolladores, a su vez, son muy aficionados a escribir algo como </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = Arrays.asList(array).indexOf(obj); <span class="hljs-comment"><span class="hljs-comment">//  boolean contains = Arrays.asList(array).contains(obj); //    boolean contains = Arrays.stream(names).anyMatch(nm -&gt; nm.equals(name));</span></span></code> </pre> <br><p>  Me gustar√≠a introducir m√©todos de utilidad generalizados en el JDK y usarlos en todas partes, como se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">sugiere</a> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">El parche es</a> tan simple como dos centavos: </p><br><p>  1) las implementaciones de <code>List.indexOf()</code> y <code>List.lastIndexOf()</code> mueven a <code>java.util.Arrays</code> <br>  2) en su lugar, se <code>Arrays.indexOf()</code> y <code>Arrays.lastIndexOf()</code> , respectivamente </p><br><p>  Parece que lo que podr√≠a salir mal?  El beneficio de este enfoque es [aparentemente] obvio.  Pero el art√≠culo trata sobre fracasos, as√≠ que piense qu√© podr√≠a salir mal. </p><br><blockquote>  - ¬øQui√©n es responsable? <br>  - Expertos responsables Martin Buchholz y Paul Sandoz </blockquote><br><div class="spoiler">  <b class="spoiler_title">En mi humilde opini√≥n, un poco tenso, pero no obstante</b> <div class="spoiler_text"><p>  Martin Buchholz: </p><br><blockquote>  Sergey, estoy manteniendo todas esas clases de colecci√≥n, y en ocasiones tambi√©n he querido tener m√©todos indexOf en Array.java.  Pero: <br><br>  Las matrices generalmente se desaconsejan.  Cualquier m√©todo est√°tico nuevo en matrices (o, donde realmente las quiero, en el objeto matriz ¬°Requiere un cambio de lenguaje java!) Encontrar√° resistencia. <br><br>  Nos hemos arrepentido de admitir nulos en colecciones, por lo que las nuevas clases de colecci√≥n como ArrayDeque no los admiten. <br><br>  Otra variante que los usuarios pueden desear es qu√© tipo de comparaci√≥n de igualdad usar. <br><br>  Hemos lamentado tener ArrayList con un √≠ndice de inicio basado en cero; hubiera sido mejor tener el comportamiento de matriz circular de ArrayDeque desde el primer d√≠a. <br><br>  El c√≥digo para buscar segmentos de matriz es muy peque√±o, por lo que no est√° ahorrando mucho.  Es f√°cil cometer un error off-by-one, pero eso tambi√©n es cierto para una API de arrays. </blockquote><p>  Paul Sandoz: </p><br><blockquote>  No ir√≠a tan lejos como para decir que las matrices est√°n desalentadas, lo girar√≠a positivamente como "usar con cuidado", ya que son espinosas, por ejemplo, siempre mutables. Sin duda podr√≠an mejorarse. Me encantar√≠a ver que las matrices implementan una matriz com√∫n En esta interfaz, podr√≠amos avanzar un poco despu√©s de los sedimentos de los tipos de valor. <br><br>  Sin embargo, cualquier nueva adici√≥n a Arrays se enfrentar√≠a con cierta resistencia, al menos por m√≠ :-) Nunca agrega solo uno o dos m√©todos, muchos otros tambi√©n quieren venir (todas las primitivas m√°s las variantes de rango).  Por lo tanto, cualquier caracter√≠stica nueva debe ser lo suficientemente beneficiosa y, en este caso, no creo que los beneficios sean lo suficientemente fuertes (como una posible presi√≥n de cach√© de c√≥digo de reducci√≥n). </blockquote><p>  Paul </p></div></div><br><p>  Correspondencia: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">http://mail.openjdk.java.net/pipermail/core-libs-dev/2018-March/051968.html</a> </p><br><p>  La moraleja de esta f√°bula es la siguiente: su ingenioso parche puede ser sacrificado para su revisi√≥n simplemente porque no ver√° ning√∫n valor especial en √©l.  Bueno, s√≠, hay un c√≥digo duplicado, pero no molesta a nadie, as√≠ que d√©jalo vivir. </p><br><h4 id="uluchsheniya-dlya-arraylist-a-ih-est-u-menya">  ¬øMejoras para ArrayList?  Los tengo </h4><br><p><del>  Ciclomotor </del>  el parche no es m√≠o, solo lo publicar√© para que lo pienses.  La propuesta en s√≠ fue expresada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">aqu√≠</a> , y se ve muy atractiva.  V√©alo usted mismo: </p><br><div class="spoiler">  <b class="spoiler_title">Cambio propuesto</b> <div class="spoiler_text"><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">Enlace</a> </p></div></div><br><p>  A simple vista, la propuesta es muy, muy l√≥gica.  Puede medir el rendimiento utilizando un <a href="" rel="nofollow">punto de referencia</a> simple: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@State</span></span>(Scope.Benchmark) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArrayListBenchmark</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@State</span></span>(Scope.Benchmark) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Data</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Param</span></span>({<span class="hljs-string"><span class="hljs-string">"10"</span></span>, <span class="hljs-string"><span class="hljs-string">"100"</span></span>, <span class="hljs-string"><span class="hljs-string">"1000"</span></span>, <span class="hljs-string"><span class="hljs-string">"10000"</span></span>}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size; ArrayList&lt;Integer&gt; arrayRandom = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;Integer&gt;(size); <span class="hljs-meta"><span class="hljs-meta">@Setup</span></span>(Level.Invocation) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initArrayList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Random rand = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Random(); rand.setSeed(System.currentTimeMillis()); <span class="hljs-comment"><span class="hljs-comment">// Populate the ArrayList with size-5 elements for (int i = 0; i &lt; size - 5; i++) { Integer r = rand.nextInt() % 256; arrayRandom.add(r); } } } @Benchmark public ArrayList construct_new_array_list(Data d) { ArrayList al = new ArrayList(d.arrayRandom); // once a new ArrayList is created add a new element al.add(new Integer(900)); return al; } }</span></span></code> </pre> <br><p>  Resumen: </p><br><pre> <code class="plaintext hljs">Benchmark (size) Mode Cnt Score Error Units  construct_new_array_list 10 thrpt 25 388.212 ¬± 23.110 ops/s construct_new_array_list 100 thrpt 25 90.208 ¬± 7.995 ops/s construct_new_array_list 1000 thrpt 25 23.289 ¬± 1.687 ops/s construct_new_array_list 10000 thrpt 25 7.659 ¬± 0.560 ops/s  construct_new_array_list 10 thrpt 25 562.678 ¬± 37.370 ops/s construct_new_array_list 100 thrpt 25 119.791 ¬± 13.232 ops/s construct_new_array_list 1000 thrpt 25 33.811 ¬± 3.812 ops/s construct_new_array_list 10000 thrpt 25 10.889 ¬± 0.564 ops/s</code> </pre> <br><p>  Nada mal para un cambio tan simple.  Lo principal es que parece que no hay trampa.  Honestamente cree una matriz, honestamente copie los datos y no se olvide del tama√±o.  ¬°Ahora definitivamente deben aceptar el parche! </p><br><div class="spoiler">  <b class="spoiler_title">Pero ah√≠ estaba</b> <div class="spoiler_text"><p>  Martin Buchholz: </p><br><blockquote>  No hay duda de que podemos optimizar el caso de ArrayList -&gt; ArrayList, pero ¬øqu√© pasa con todas las otras implementaciones de Collection?  ArrayDeque y CopyOnWriteArrayList vienen a la mente. <br>  ArrayList es una clase popular para hacer copias de Colecciones.  ¬øD√≥nde te detienes? <br><br>  Una subclase patol√≥gica de ArrayList podr√≠a decidir no almacenar elementos en la matriz de respaldo, con la consiguiente rotura. <br><br>  La soluci√≥n bendecida al problema de copia de la lista es probablemente List.copyOf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/List.html#copyOf(java .util.Collection</a> ) que podr√≠a hacer la optimizaci√≥n que espera. </blockquote><p>  Alan Bateman </p><br><blockquote>  ArrayList no es final, por lo que es posible que alguien lo haya extendido para usar algo que no sea elementData.  Puede ser m√°s seguro usar la identidad de clase en lugar de la instancia de. </blockquote></div></div><br><p>  Nada me proh√≠be desasociarme de <code>ArrayList</code> y almacenar datos en una lista vinculada.  Luego, <code>c instanceof ArrayList</code> devolver√° la verdad, llegaremos al √°rea de copia y caeremos con seguridad. </p><br><p>  La moraleja de esta f√°bula es la siguiente: un <em>posible</em> cambio en el comportamiento puede ser la causa del fracaso.  En otras palabras, uno debe tener en cuenta la probabilidad de incluso el cambio m√°s absurdo, si lo permite el lenguaje.  Y s√≠, podr√≠a haber funcionado si <code>ArrayList</code> hubiera declarado <code>final</code> desde el principio. </p><br><h4 id="snova-specifikaciya">  Especificaci√≥n de nuevo </h4><br><p>  Mientras depuraba mi aplicaci√≥n, accidentalmente ca√≠ en las entra√±as de Spring y encontr√© el siguiente <a href="" rel="nofollow">c√≥digo</a> : </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//      paramTypes for (Constructor&lt;?&gt; candidate : candidates) { Class&lt;?&gt;[] paramTypes = candidate.getParameterTypes(); if (constructorToUse != null &amp;&amp; argsToUse != null &amp;&amp; argsToUse.length &gt; paramTypes.length) { // Already found greedy constructor that can be satisfied -&gt; // do not look any further, there are only less greedy constructors left. break; } if (paramTypes.length &lt; minNrOfArgs) { continue; }</span></span></code> </pre> <br><p>  Afortunadamente, al entrar en <code>java.lang.reflect.Constructor.getParameterTypes()</code> desplac√© el c√≥digo un poco m√°s abajo y encontr√© uno hermoso: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Class&lt;?&gt;[] getParameterTypes() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parameterTypes.clone(); } <span class="hljs-comment"><span class="hljs-comment">/** * {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@inheritDoc</span></span></span><span class="hljs-comment">} * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@since</span></span></span><span class="hljs-comment"> 1.8 */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getParameterCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parameterTypes.length; }</code> </pre> <br><p>  Ya ves, si?  Si necesitamos averiguar el n√∫mero de argumentos de constructor / m√©todo, simplemente llame a <code>java.lang.reflect.Method.getParameterCount()</code> y no copie la matriz.  Comprueba si el juego vale la pena en el caso m√°s simple, en el que el m√©todo no tiene par√°metros: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@State</span></span>(Scope.Thread) <span class="hljs-meta"><span class="hljs-meta">@BenchmarkMode</span></span>(Mode.AverageTime) <span class="hljs-meta"><span class="hljs-meta">@OutputTimeUnit</span></span>(TimeUnit.NANOSECONDS) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MethodToStringBenchmark</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Method method; <span class="hljs-meta"><span class="hljs-meta">@Setup</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ method = getClass().getMethod(<span class="hljs-string"><span class="hljs-string">"toString"</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Benchmark</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getParameterCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> method.getParameterCount(); } <span class="hljs-meta"><span class="hljs-meta">@Benchmark</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getParameterTypes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> method.getParameterTypes().length; } }</code> </pre> <br><p>  En mi m√°quina y con JDK 11 resulta as√≠: </p><br><pre> <code class="plaintext hljs">Benchmark Mode Cnt Score Error Units getParameterCount avgt 25 2,528 ¬± 0,085 ns/op getParameterCount:¬∑gc.alloc.rate avgt 25 ‚âà 10‚Åª‚Å¥ MB/sec getParameterCount:¬∑gc.alloc.rate.norm avgt 25 ‚âà 10‚Åª‚Å∑ B/op getParameterCount:¬∑gc.count avgt 25 ‚âà 0 counts getParameterTypes avgt 25 7,299 ¬± 0,410 ns/op getParameterTypes:¬∑gc.alloc.rate avgt 25 1999,454 ¬± 89,929 MB/sec getParameterTypes:¬∑gc.alloc.rate.norm avgt 25 16,000 ¬± 0,001 B/op getParameterTypes:¬∑gc.churn.G1_Eden_Space avgt 25 2003,360 ¬± 91,537 MB/sec getParameterTypes:¬∑gc.churn.G1_Eden_Space.norm avgt 25 16,030 ¬± 0,045 B/op getParameterTypes:¬∑gc.churn.G1_Old_Gen avgt 25 0,004 ¬± 0,001 MB/sec getParameterTypes:¬∑gc.churn.G1_Old_Gen.norm avgt 25 ‚âà 10‚Åª‚Åµ B/op getParameterTypes:¬∑gc.count avgt 25 2380,000 counts getParameterTypes:¬∑gc.time avgt 25 1325,000 ms</code> </pre> <br><p>  ¬øQu√© podemos hacer al respecto?  Podemos buscar el uso del antipatr√≥n <code>Method.getParameterTypes().length</code> en el JDK (al menos en <code>java.base</code> ) y reemplazarlo donde tenga sentido: </p><br><p> <code>java.lang.invoke.MethodHandleProxies</code> </p> <br><p><img src="https://habrastorage.org/webt/l_/3j/h1/l_3jh1hu3swdedxqktlxboz0tu0.png"></p><br><p> <code>java.util.concurrent.ForkJoinTask</code> </p> <br><p><img src="https://habrastorage.org/webt/0o/rt/q7/0ortq71mnf3-bwsa4wyi-jmzf5y.png"></p><br><p> <code>java.lang.reflect.Executable</code> </p> <br><p><img src="https://habrastorage.org/webt/sm/_h/pm/sm_hpm8eahlmqavobjqg9gejvse.png"></p><br><p> <code>sun.reflect.annotation.AnnotationType</code> </p> <br><p><img src="https://habrastorage.org/webt/yw/bv/il/ywbvil_doi3fzy6uzkpcm42g6zu.png"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">El parche</a> fue enviado junto con una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">carta de presentaci√≥n</a> . </p><br><p>  De repente, result√≥ que durante varios a√±os ha habido una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">tarea similar,</a> e incluso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">se han</a> preparado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">cambios</a> para ello.  Los comentarios se√±alaron un aumento de rendimiento bastante decente para cambios tan simples.  Sin embargo, tanto ellos como mi parche est√°n limpios hasta ahora y permanecen inm√≥viles.  Por qu√©  Probablemente porque los desarrolladores est√°n demasiado ocupados con cosas m√°s necesarias y est√∫pidamente no lo tienen en sus manos. </p><br><p>  La moraleja de esta f√°bula es la siguiente: sus ingeniosos cambios pueden congelarse simplemente debido a la falta de trabajadores. </p><br><p>  ¬°Pero este no es el final!  Durante la discusi√≥n sobre la racionalidad del reemplazo descrito en otros proyectos, los camaradas m√°s experimentados presentaron una contrapropuesta: tal vez no deber√≠a hacer el reemplazo de <code>Method.getParameterTypes().length -&gt; Method.getParameterCount()</code> con sus manos, ¬øpero confiar esto al compilador?  ¬øEs esto posible y ser√° "legal"? </p><br><p>  Intentemos verificar usando la prueba: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">arrayClone</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Object[] objects = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object[<span class="hljs-number"><span class="hljs-number">3</span></span>]; objects[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-string"><span class="hljs-string">"azaza"</span></span>; objects[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">365</span></span>; objects[<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-number"><span class="hljs-number">9876L</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Object[] clone = objects.clone(); assertEquals(objects.length, clone.length); assertSame(objects[<span class="hljs-number"><span class="hljs-number">0</span></span>], clone[<span class="hljs-number"><span class="hljs-number">0</span></span>]); assertSame(objects[<span class="hljs-number"><span class="hljs-number">1</span></span>], clone[<span class="hljs-number"><span class="hljs-number">1</span></span>]); assertSame(objects[<span class="hljs-number"><span class="hljs-number">2</span></span>], clone[<span class="hljs-number"><span class="hljs-number">2</span></span>]); }</code> </pre> <br><p>  que pasa y que muestra que si la matriz clonada no abandona el alcance, se puede eliminar, porque el acceso a cualquier elemento desde sus celdas o el campo de <code>length</code> se puede obtener del original. </p><br><p>  ¬øPuede el JDK hacer esto?  Comprobamos: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@State</span></span>(Scope.Thread) <span class="hljs-meta"><span class="hljs-meta">@BenchmarkMode</span></span>(Mode.AverageTime) <span class="hljs-meta"><span class="hljs-meta">@OutputTimeUnit</span></span>(TimeUnit.NANOSECONDS) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArrayAllocationEliminationBenchmark</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> length = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Benchmark</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">baseline</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[length].length; } <span class="hljs-meta"><span class="hljs-meta">@Benchmark</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">baselineClone</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[length].clone().length; } }</code> </pre> <br><p>  Salida para JDK 13: </p><br><pre> <code class="plaintext hljs">Benchmark Mode Cnt Score Error Units baseline avgt 50 6,135 ¬± 0,140 ns/op baseline:¬∑gc.alloc.rate.norm avgt 50 56,000 ¬± 0,001 B/op clone avgt 50 18,359 ¬± 0,619 ns/op clone:¬∑gc.alloc.rate.norm avgt 50 112,000 ¬± 0,001 B/op</code> </pre> <br><p>  Resulta que openjdk no sabe c√≥mo lanzar una <code>new int[length]</code> , a diferencia del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">Grial</a> , jeje: </p><br><pre> <code class="plaintext hljs">Benchmark Mode Cnt Score Error Units baseline avgt 25 2,470 ¬± 0,156 ns/op baseline:¬∑gc.alloc.rate.norm avgt 25 0,005 ¬± 0,008 B/op lone avgt 25 13,086 ¬± 1,059 ns/op lone:¬∑gc.alloc.rate.norm avgt 25 112,113 ¬± 0,115 B/op</code> </pre> <br><p>  Resulta que puedes ajustar un poco el compilador de optimizaci√≥n de OpenJDK para que pueda hacer lo que el Grial puede hacer.  Dado que no solo todos pueden obtener un anuncio positivo en el c√≥digo VM y presentar algo significativo, me limit√© a una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">carta</a> en la que expres√© mis observaciones. </p><br><p>  Result√≥, y hay varias sutilezas.  Vladimir Ivanov <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">indica</a> que: </p><br><blockquote>  Teniendo en cuenta que no hay forma de aumentar / reducir las matrices Java, <br>  La transformaci√≥n "cloned_array.length =&gt; original_array.length" es correcta <br>  independientemente de si la variante clonada escapa o no. <br><br>  Adem√°s, la transformaci√≥n ya est√° ah√≠: <br><br>  <a href="" rel="nofollow">http://hg.openjdk.java.net/jdk/jdk/file/tip/src/hotspot/share/opto/memnode.cpp#l2388</a> <br><br>  No he examinado los puntos de referencia que mencionaste, pero parece que <br>  cloned_array.length access no es la raz√≥n por la cual la matriz clonada sigue siendo <br>  ahi <br><br>  En cuanto a sus otras ideas, redirige los accesos desde la instancia clonada a <br>  el original es problem√°tico (en el caso general) ya que el compilador tiene que demostrar <br>  no hubo cambios en ambas versiones y los accesos indexados lo hacen incluso <br>  m√°s duro  Y los puntos seguros tambi√©n causan problemas (para la rematerializaci√≥n). <br><br>  Pero estoy de acuerdo en que ser√≠a bueno cubrir (al menos) casos simples de <br>  copia defensiva </blockquote><p>  Es decir, golpear un clon parece ser posible, y no particularmente dif√≠cil.  Pero con la conversi√≥n </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> len = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[arrayLength].length;</code> </pre> <br><p>  -&gt; </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> len = arrayLength;</code> </pre> <br><p>  surgen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">dificultades</a> : </p><br><blockquote>  No eliminamos las asignaciones de matriz que no tienen una longitud conocida <br>  porque pueden causar una excepci√≥n NegativeArraySize.  En este caso nosotros <br>  Sin embargo, deber√≠a poder demostrar que la longitud es positiva. <br><br>  De todos modos, tengo un parche casi terminado que reemplaza la matriz no utilizada <br>  asignaciones con un guardia adecuado. </blockquote><p>  En otras palabras, no puede simplemente tomar y descartar la creaci√≥n de una matriz, porque de acuerdo con la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">especificaci√≥n, la</a> ejecuci√≥n <em>debe</em> arrojar una <code>NegativeArraySizeException</code> y no hay nada que podamos hacer al respecto: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">arrayWithNwgativeSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> length = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> newLen = -<span class="hljs-number"><span class="hljs-number">3</span></span>; length = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object[newLen].length; <span class="hljs-comment"><span class="hljs-comment">//  new Object[newLen]  fail(); } catch (NegativeArraySizeException e) { assert length == 0; } }</span></span></code> </pre> <br><p>  ¬øPor qu√© pudo el Grial?  Creo que la raz√≥n es que el valor del campo de <code>length</code> en el punto de referencia anterior fue constante y siempre igual a 10, lo que permiti√≥ al analizador concluir que no es necesario verificar un valor negativo, lo que significa que se puede eliminar junto con la creaci√≥n de la matriz en s√≠.  Correcto en los comentarios si comet√≠ un error. </p><br><p>  Eso es todo por hoy :) Agregue sus ejemplos en los comentarios, lo entenderemos. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es433174/">https://habr.com/ru/post/es433174/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es433164/index.html">R√°pido y furioso: Forza Horizon 4 acelera con los sombreadores de ventanas</a></li>
<li><a href="../es433166/index.html">Predecir el tiempo de soluci√≥n de tickets utilizando Machine Learning</a></li>
<li><a href="../es433168/index.html">¬øPor qu√© un programador tiene una pasant√≠a en la cocina? Una conversaci√≥n con Dodo Pizza sobre gemba, .NET y apertura.</a></li>
<li><a href="../es433170/index.html">C√≥mo no pudimos rehacer la arquitectura de la empresa</a></li>
<li><a href="../es433172/index.html">Fijamos el modo multijugador al juego m√≥vil "Hacer palabras a partir de palabras" en iOS y Android, escrito en C ++</a></li>
<li><a href="../es433176/index.html">Certificado de Docker Remote API de autenticaci√≥n con verificaci√≥n de revocaci√≥n</a></li>
<li><a href="../es433178/index.html">C√≥mo restauramos un archivo .wav da√±ado</a></li>
<li><a href="../es433180/index.html">Resolver problemas de tipo de datos en Ruby o hacer que los datos sean confiables nuevamente</a></li>
<li><a href="../es433182/index.html">¬øEs posible capacitar a un agente para negociar en el mercado de valores con refuerzos? Implementaci√≥n de lenguaje R</a></li>
<li><a href="../es433184/index.html">ASP.NET Core 2.2 lanzado. Que hay de nuevo (2 de 3)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>