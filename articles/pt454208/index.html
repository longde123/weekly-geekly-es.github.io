<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî∂ üöµüèª üë®‚Äçüëß RISC-V do zero üñäÔ∏è üåï üå©Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Neste artigo, exploramos v√°rios conceitos de baixo n√≠vel (compila√ß√£o e layout, tempos de execu√ß√£o primitivos, assembler e muito mais) por meio do pris...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>RISC-V do zero</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454208/">  Neste artigo, exploramos v√°rios conceitos de baixo n√≠vel (compila√ß√£o e layout, tempos de execu√ß√£o primitivos, assembler e muito mais) por meio do prisma da arquitetura RISC-V e de seu ecossistema.  Sou desenvolvedor web, n√£o fa√ßo nada no trabalho, mas √© muito interessante para mim, √© da√≠ que veio o artigo!  Junte-se a mim nesta jornada agitada para as profundezas do caos de baixo n√≠vel. <br><br>  Primeiro, vamos falar um pouco sobre o RISC-V e a import√¢ncia dessa arquitetura, configurar a cadeia de ferramentas RISC-V e executar um programa C simples em hardware RISC-V emulado. <br><a name="habracut"></a><br><h1>  Conte√∫do </h1><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O que √© o RISC-V?</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Configurando ferramentas QEMU e RISC-V</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ol√° RISC-V!</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Abordagem ing√™nua</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Levantando a cortina -v</a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Pesquise nossa pilha</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Layout</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Pare com isso!</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><s>Hammertime!</s></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tempo de execu√ß√£o!</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Depurar, mas agora de verdade</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O que vem a seguir?</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Opcional</a> </li></ol><br><a name="1"></a><h1>  O que √© o RISC-V? </h1><br>  O RISC-V √© uma arquitetura de conjunto de instru√ß√µes gratuita.  O projeto teve origem na Universidade da Calif√≥rnia em Berkeley em 2010.  Um papel importante em seu sucesso foi desempenhado pela abertura de c√≥digo e liberdade de uso, muito diferente de muitas outras arquiteturas.  Tome o ARM: para criar um processador compat√≠vel, voc√™ deve pagar uma taxa antecipada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">de US $ 1 milh√£o a US $ 10 milh√µes e tamb√©m pagar royalties de 0,5 a 2% nas vendas</a> .  Um modelo livre e aberto torna o RISC-V uma op√ß√£o atraente para muitos, inclusive para startups que n√£o podem pagar uma licen√ßa para um ARM ou outro processador, para pesquisadores acad√™micos e (obviamente) para a comunidade de c√≥digo aberto. <br><br>  O r√°pido crescimento da popularidade do RISC-V n√£o passou despercebido.  A ARM <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">lan√ßou um site</a> que tentou (sem √™xito) destacar os supostos benef√≠cios do ARM sobre o RISC-V (o site j√° est√° fechado).  O projeto RISC-V √© suportado por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">muitas grandes empresas</a> , incluindo Google, Nvidia e Western Digital. <br><br><a name="2"></a><h1>  Configurando ferramentas QEMU e RISC-V </h1><br>  N√£o podemos executar o c√≥digo no processador RISC-V at√© que configuremos o ambiente.  Felizmente, isso n√£o requer um processador RISC-V f√≠sico; em vez disso, adotamos o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">qemu</a> .  Siga as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">instru√ß√µes para</a> a instala√ß√£o do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">seu sistema operacional</a> .  Eu tenho o MacOS, ent√£o basta digitar um comando: <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># also available via MacPorts - `sudo port install qemu` brew install qemu</span></span></code> </pre> <br>  Convenientemente, o <code>qemu</code> vem com <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">v√°rias m√°quinas prontas para</a> <code>qemu-system-riscv32 -machine</code> (consulte a op√ß√£o <code>qemu-system-riscv32 -machine</code> ). <br><br>  Em seguida, instale o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">OpenOCD</a> para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ferramentas</a> RISC-V e RISC-V. <br><br>  Fa√ßa o download de montagens prontas das ferramentas RISC-V OpenOCD e RISC-V <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br>  N√≥s extra√≠mos os arquivos para qualquer diret√≥rio, eu tenho <code>~/usys/riscv</code> .  Lembre-se disso para uso futuro. <br><br><pre> <code class="bash hljs">mkdir -p ~/usys/riscv <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Downloads cp openocd-&lt;date&gt;-&lt;platform&gt;.tar.gz ~/usys/riscv cp riscv64-unknown-elf-gcc-&lt;date&gt;-&lt;platform&gt;.tar.gz ~/usys/riscv <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/usys/riscv tar -xvf openocd-&lt;date&gt;-&lt;platform&gt;.tar.gz tar -xvf riscv64-unknown-elf-gcc-&lt;date&gt;-&lt;platform&gt;.tar.gz</code> </pre> <br>  Defina as vari√°veis ‚Äã‚Äãde ambiente <code>RISCV_OPENOCD_PATH</code> e <code>RISCV_PATH</code> para que outros programas possam encontrar nossa cadeia de ferramentas.  Isso pode parecer diferente dependendo do sistema operacional e do shell: adicionei os caminhos ao <code>~/.zshenv</code> . <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># I put these two exports directly in my ~/.zshenv file - you may have to do something else. export RISCV_OPENOCD_PATH="$HOME/usys/riscv/openocd-&lt;date&gt;-&lt;version&gt;" export RISCV_PATH="$HOME/usys/riscv/riscv64-unknown-elf-gcc-&lt;date&gt;-&lt;version&gt;" # Reload .zshenv with our new environment variables. Restarting your shell will have a similar effect. source ~/.zshenv</span></span></code> </pre> <br>  Crie um link simb√≥lico em <code>/usr/local/bin</code> para esse arquivo execut√°vel, para que voc√™ possa execut√°-lo a qualquer momento sem especificar o caminho completo para <code>~/usys/riscv/riscv64-unknown-elf-gcc-&lt;date&gt;-&lt;version&gt;/bin/riscv64-unknown-elf-gcc</code> . <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Symbolically link our gcc executable into /usr/local/bin. Repeat this process for any other executables you want to quickly access. ln -s ~/usys/riscv/riscv64-unknown-elf-gcc-8.2.0-&lt;date&gt;-&lt;version&gt;/bin/riscv64-unknown-elf-gcc /usr/local/bin</span></span></code> </pre> <br>  E pronto, temos um kit de ferramentas RISC-V em funcionamento!  Todos os nossos execut√°veis, como <code>riscv64-unknown-elf-gcc</code> , <code>riscv64-unknown-elf-gdb</code> , <code>riscv64-unknown-elf-ld</code> e outros, est√£o em <code>~/usys/riscv/riscv64-unknown-elf-gcc-&lt;date&gt;-&lt;version&gt;/bin/</code> . <br><br><a name="3"></a><h1>  Ol√° RISC-V! </h1><br>  <i>Atualiza√ß√£o de 26 de maio de 2019:</i> <i><br><br></i>  <i>Infelizmente, devido a um erro no RISC-V QEMU, o programa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">freedom-e-sdk</a> 'ol√° mundo' no QEMU n√£o funciona mais.</i>  <i>Um patch foi lan√ßado para resolver esse problema, mas, por enquanto, pule esta se√ß√£o.</i>  <i>Este programa n√£o ser√° necess√°rio nas se√ß√µes subseq√ºentes do artigo.</i>  <i>Acompanho a situa√ß√£o e atualizo o artigo ap√≥s corrigir o erro.</i> <i><br><br></i>  <i>Veja <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">este coment√°rio</a> para mais informa√ß√µes.</i> <br><br>  Com as ferramentas configuradas, vamos executar o simples programa RISC-V.  Vamos come√ßar clonando o reposit√≥rio SiFive <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">freedom-e-sdk</a> : <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/wherever/you/want/to/<span class="hljs-built_in"><span class="hljs-built_in">clone</span></span>/this git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> --recursive https://github.com/sifive/freedom<span class="hljs-_"><span class="hljs-_">-e</span></span>-sdk.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> freedom<span class="hljs-_"><span class="hljs-_">-e</span></span>-sdk</code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Por tradi√ß√£o</a> , vamos come√ßar com o programa 'Hello, world' do reposit√≥rio <code>freedom-e-sdk</code> .  Usamos o <code>Makefile</code> pronto que eles fornecem para compilar este programa no modo de depura√ß√£o: <br><br><pre> <code class="bash hljs">make PROGRAM=hello TARGET=sifive-hifive1 CONFIGURATION=debug software</code> </pre> <br>  E execute no QEMU: <br><br><pre> <code class="bash hljs">qemu-system-riscv32 -nographic -machine sifive_e -kernel software/hello/debug/hello.elf Hello, World!</code> </pre> <br>  Este √© um √≥timo come√ßo.  Voc√™ pode executar outros exemplos no <code>freedom-e-sdk</code> .  Depois disso, escreveremos e tentaremos depurar nosso pr√≥prio programa em C. <br><br><h1>  Abordagem ing√™nua </h1><br>  Vamos come√ßar com um programa simples que adiciona infinitamente dois n√∫meros. <br><br><pre> <code class="cpp hljs">cat add.<span class="hljs-function"><span class="hljs-function">c </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">12</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c = a + b; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br>  Queremos executar este programa e a primeira coisa que precisamos compil√°-lo para o processador RISC-V. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># -O0 to disable all optimizations. Without this, GCC might optimize # away our infinite addition since the result 'c' is never used. # -g to tell GCC to preserve debug info in our executable. riscv64-unknown-elf-gcc add.c -O0 -g</span></span></code> </pre> <br>  Isso cria o arquivo <code>a.out</code> , cujo padr√£o √© o <code>gcc</code> para arquivos execut√°veis.  Agora execute este arquivo no <code>qemu</code> : <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># -machine tells QEMU which among our list of available machines we want to # run our executable against. Run qemu-system-riscv64 -machine help to list # all available machines. # -m is the amount of memory to allocate to our virtual machine. # -gdb tcp::1234 tells QEMU to also start a GDB server on localhost:1234 where # TCP is the means of communication. # -kernel tells QEMU what we're looking to run, even if our executable isn't # exactly a "kernel". qemu-system-riscv64 -machine virt -m 128M -gdb tcp::1234 -kernel a.out</span></span></code> </pre> <br>  Escolhemos a m√°quina <code>riscv-qemu</code> qual o <code>riscv-qemu</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">veio originalmente</a> . <br><br>  Agora que nosso programa √© executado dentro do QEMU com o servidor GDB no <code>localhost:1234</code> , nos conectamos a ele com o cliente RISC-V GDB a partir de um terminal separado: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># --tui gives us a (t)extual (ui) for our GDB session. # While we can start GDB without any arguments, specifying 'a.out' tells GDB # to load debug symbols from that file for the newly created session. riscv64-unknown-elf-gdb --tui a.out</span></span></code> </pre> <br>  E n√≥s estamos dentro do GDB! <br><br><pre>  Este GDB foi configurado como "--host = x86_64-apple-darwin17.7.0 --target = riscv64-unknown-elf".  ‚îÇ
 Digite "show configuration" para obter detalhes da configura√ß√£o.  ‚îÇ
 Para obter instru√ß√µes sobre relat√≥rios de erros, consulte: ‚îÇ
 &lt;http://www.gnu.org/software/gdb/bugs/&gt;.  ‚îÇ
 Encontre o manual do GDB e outros recursos de documenta√ß√£o on-line em: ‚îÇ
     &lt;http://www.gnu.org/software/gdb/documentation/&gt;.  ‚îÇ
                                                                                                       ‚îÇ
 Para obter ajuda, digite "ajuda".  ‚îÇ
 Digite "palavra apropriada" para procurar comandos relacionados √† "palavra" ... ‚îÇ
 Lendo s√≠mbolos de a.out ... ‚îÇ
 (gdb) </pre><br>  Podemos tentar executar os comandos <code>run</code> ou <code>start</code> do arquivo execut√°vel <code>a.out</code> no GDB, mas no momento isso n√£o funcionar√° por um motivo √≥bvio.  N√≥s compilamos o programa como <code>riscv64-unknown-elf-gcc</code> , para que o host seja executado na arquitetura <code>riscv64</code> . <br><br>  Mas h√° uma sa√≠da!  Essa situa√ß√£o √© uma das principais raz√µes para a exist√™ncia do modelo cliente-servidor do GDB.  Podemos pegar o arquivo execut√°vel <code>riscv64-unknown-elf-gdb</code> e, em vez de inici√°-lo no host, especificar um destino remoto (servidor GDB).  Como voc√™ se lembra, n√≥s apenas iniciamos o <code>riscv-qemu</code> e nos disse para iniciar o servidor GDB no <code>localhost:1234</code> .  Basta conectar-se a este servidor: <br><br><pre>  (gdb) destino remoto: 1234 ‚îÇ
 Depura√ß√£o remota usando: 1234 </pre><br>  Agora voc√™ pode definir alguns pontos de interrup√ß√£o: <br><br><pre> <code class="bash hljs">(gdb) b main Breakpoint 1 at 0x1018e: file add.c, line 2. (gdb) b 5 <span class="hljs-comment"><span class="hljs-comment"># this is the line within the forever-while loop. int c = a + b; Breakpoint 2 at 0x1019a: file add.c, line 5.</span></span></code> </pre> <br>  E, finalmente, especifique GDB <code>continue</code> (comando abreviado <code>c</code> ) at√© chegarmos ao ponto de interrup√ß√£o: <br><br><pre> <code class="bash hljs">(gdb) c Continuing.</code> </pre> <br>  Voc√™ notar√° rapidamente que o processo n√£o termina de forma alguma.  Isso √© estranho ... n√£o devemos chegar imediatamente ao ponto de interrup√ß√£o <code>b 5</code> ?  O que aconteceu <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a53/834/210/a538342106336ef7ed1b8f9e53a47f48.png"><br><br>  Aqui voc√™ pode ver v√°rios problemas: <br><br><ol><li>  A interface do usu√°rio do texto n√£o pode encontrar a fonte.  A interface deve exibir nosso c√≥digo e quaisquer pontos de interrup√ß√£o pr√≥ximos. <br></li><li>  O GDB n√£o v√™ a linha de execu√ß√£o atual ( <code>L??</code> ) e exibe o contador 0x0 ( <code>PC: 0x0</code> ). <br></li><li>  Algum texto na linha de entrada, que na sua totalidade se parece com isso: <code>0x0000000000000000 in ?? ()</code> <code>0x0000000000000000 in ?? ()</code> </li></ol><br>  Combinado com o fato de que n√£o podemos alcan√ßar o ponto de interrup√ß√£o, esses indicadores indicam: fizemos <i>algo</i> errado.  Mas o que? <br><br><a name="5"></a><h1>  Levantando a cortina -v </h1><br>  Para entender o que est√° acontecendo, voc√™ precisa dar um passo atr√°s e falar sobre como nosso simples programa C realmente funciona.  A fun√ß√£o <code>main</code> faz uma adi√ß√£o simples, mas o que √© realmente?  Por que deveria ser chamado de <code>main</code> , n√£o de <code>origin</code> ou <code>begin</code> ?  De acordo com a conven√ß√£o, todos os arquivos execut√°veis ‚Äã‚Äãcome√ßam a ser executados com a fun√ß√£o <code>main</code> , mas que m√°gica fornece esse comportamento? <br><br>  Para responder a essas perguntas, repita nossa equipe do GCC com o sinalizador <code>-v</code> para obter uma sa√≠da mais detalhada do que realmente est√° acontecendo. <br><br><pre> <code class="bash hljs">riscv64-unknown-elf-gcc add.c -O0 -g -v</code> </pre> <br>  Como a sa√≠da √© grande, n√£o exibiremos a listagem inteira.  √â importante observar que, embora o GCC seja formalmente um compilador, o padr√£o √© compilar (para limitar-se √† compila√ß√£o e montagem, voc√™ deve especificar o sinalizador <code>-c</code> ).  Por que isso √© importante?  Bem, d√™ uma olhada no fragmento da sa√≠da detalhada do <code>gcc</code> : <br><br><pre>  # O comando `gcc -v` atual gera caminhos completos, mas esses s√£o bastante
 # long, ent√£o finja que essas vari√°veis ‚Äã‚Äãexistem.
 # $ RV_GCC_BIN_PATH = / Usu√°rios / twilcock / usys / riscv / riscv64-unknown-elf-gcc- &lt;data&gt; - &lt;vers√£o&gt; / bin /
 # $ RV_GCC_LIB_PATH = $ RV_GCC_BIN_PATH /../ lib / gcc / riscv64-unknown-elf / 8.2.0<font></font>
<font></font>
 $ RV_GCC_BIN_PATH /../ libexec / gcc / riscv64-unknown-elf / 8.2.0 / collect2 \
   ... truncado ... 
   $ RV_GCC_LIB_PATH /../../../../ riscv64-unknown-elf / lib / rv64imafdc / lp64d / crt0.o \ 
   $ RV_GCC_LIB_PATH / riscv64-unknown-elf / 8.2.0 / rv64imafdc / lp64d / crtbegin.o \
   -lgcc --start-group -lc -lgloss --end-group -lgcc \ 
   $ RV_GCC_LIB_PATH / rv64imafdc / lp64d / crtend.o
   ... truncado ...
 COLLECT_GCC_OPTIONS = '- O0' '-g' '-v' '-march = rv64imafdc' '-mabi = lp64d' </pre><br>  Entendo que mesmo de forma abreviada isso √© muito, ent√£o deixe-me explicar.  Na primeira linha, o <code>gcc</code> executa o programa <code>collect2</code> , transmite os argumentos <code>crt0.o</code> , <code>crtbegin.o</code> e <code>crtend.o</code> , os <code>-lgcc</code> e <code>--start-group</code> .  A descri√ß√£o do collect2 pode ser encontrada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> : em resumo, o collect2 organiza v√°rias fun√ß√µes de inicializa√ß√£o na inicializa√ß√£o, fazendo o layout em uma ou mais passagens. <br><br>  Assim, o GCC compila v√°rios arquivos <code>crt</code> com o nosso c√≥digo.  Como voc√™ pode imaginar, <code>crt</code> significa 'C runtime'.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Aqui est√°</a> descrito em detalhes para que cada <code>crt</code> destina, mas estamos interessados ‚Äã‚Äãem <code>crt0</code> , que faz uma coisa importante: <br><br><blockquote>  <i>"√â esperado que este objeto [crt0] contenha o caractere <code>_start</code> , que indica a autoinicializa√ß√£o do programa."</i> </blockquote><br>  A ess√™ncia do ‚Äúbootstrap‚Äù depende da plataforma, mas geralmente envolve tarefas importantes, como configurar um quadro de pilha, passar argumentos de linha de comando e chamar <code>main</code> .  Sim, <i>finalmente</i> encontramos a resposta para a pergunta: √© <code>_start</code> chama nossa fun√ß√£o principal! <br><br><a name="6"></a><h1>  Pesquise nossa pilha </h1><br>  Resolvemos um enigma, mas como isso nos aproxima do objetivo original - executar um programa C simples em <code>gdb</code> ?  Resta resolver v√°rios problemas: o primeiro deles est√° relacionado a como o <code>crt0</code> configura nossa pilha. <br><br>  Como vimos acima, o padr√£o do <code>gcc</code> √© o <code>crt0</code> .  Os par√¢metros padr√£o s√£o selecionados com base em v√°rios fatores: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Objetivo trig√™meo</a> correspondente √† estrutura do sistema <code>machine-vendor-operatingsystem</code> .  N√≥s temos <code>riscv64-unknown-elf</code> <br></li><li>  Arquitetura de destino, <code>rv64imafdc</code> <br></li><li>  Alvo ABI, <code>lp64d</code> </li></ul><br>  Geralmente tudo funciona bem, mas n√£o para todos os processadores RISC-V.  Como mencionado anteriormente, uma das tarefas do <code>crt0</code> √© configurar a pilha.  Mas ele n√£o sabe exatamente onde a pilha deve estar para nossa CPU ( <code>-machine</code> )?  Ele n√£o pode fazer isso sem a nossa ajuda. <br><br>  No <code>qemu-system-riscv64 -machine virt -m 128M -gdb tcp::1234 -kernel a.out</code> usamos a m√°quina <code>virt</code> .  Felizmente, o <code>qemu</code> facilita o despejo de informa√ß√µes da m√°quina em um despejo <code>dtb</code> (blob da √°rvore de dispositivos). <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Go to the ~/usys/riscv folder we created before and create a new dir # for our machine information. cd ~/usys/riscv &amp;&amp; mkdir machines cd machines # Use qemu to dump info about the 'virt' machine in dtb (device tree blob) # format. # The data in this file represents hardware components of a given # machine / device / board. qemu-system-riscv64 -machine virt -machine dumpdtb=riscv64-virt.dtb</span></span></code> </pre> <br>  √â dif√≠cil ler dados dtb porque √© basicamente um formato bin√°rio, mas existe um utilit√°rio de linha de comando <code>dtc</code> (compilador de √°rvore de dispositivos) que pode converter o arquivo em algo mais leg√≠vel. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># I'm running MacOS, so I use Homebrew to install this. If you're # running another OS you may need to do something else. brew install dtc # Convert our .dtb into a human-readable .dts (device tree source) file. dtc -I dtb -O dts -o riscv64-virt.dts riscv64-virt.dtb</span></span></code> </pre> <br>  O arquivo de sa√≠da √© <code>riscv64-virt.dts</code> , onde vemos muitas informa√ß√µes interessantes sobre <code>virt</code> : o n√∫mero de n√∫cleos de processador dispon√≠veis, a localiza√ß√£o da mem√≥ria de v√°rios dispositivos perif√©ricos, como UART, a localiza√ß√£o da mem√≥ria interna (RAM).  A pilha deve estar nessa mem√≥ria, ent√£o procure-a com <code>grep</code> : <br><br><pre> <code class="bash hljs">grep memory riscv64-virt.dts -A 3 memory@80000000 { device_type = <span class="hljs-string"><span class="hljs-string">"memory"</span></span>; reg = &lt;0x00 0x80000000 0x00 0x8000000&gt;; };</code> </pre> <br>  Como voc√™ pode ver, este n√≥ possui 'mem√≥ria' especificada como <code>device_type</code> .  Aparentemente, encontramos o que est√°vamos procurando.  Pelos valores dentro de <code>reg = &lt;...&gt; ;</code>  Voc√™ pode determinar onde o banco de mem√≥ria √© iniciado e qual o seu comprimento. <br><br>  Na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">especifica√ß√£o devicetree,</a> vemos que a sintaxe <code>reg</code> √© um n√∫mero arbitr√°rio de pares <code>(base_address, length)</code> .  No entanto, existem quatro significados dentro de <code>reg</code> .  Estranho, n√£o existem dois valores suficientes para um banco de mem√≥ria? <br><br>  Novamente, a partir da especifica√ß√£o devicetree (procure a propriedade <code>reg</code> ), descobrimos que o n√∫mero de c√©lulas <code>&lt;u32&gt;</code> para especificar o endere√ßo e o comprimento √© determinado pelas propriedades <code>#address-cells</code> e <code>#size-cells</code> no n√≥ pai (ou no pr√≥prio n√≥).  Esses valores n√£o s√£o especificados em nosso n√≥ de mem√≥ria e o n√≥ de mem√≥ria pai √© simplesmente a raiz do arquivo.  Vamos procurar por esses valores: <br><br><pre> <code class="plaintext hljs">head -n8 riscv64-virt.dts /dts-v1/; / { #address-cells = &lt;0x02&gt;; #size-cells = &lt;0x02&gt;; compatible = "riscv-virtio"; model = "riscv-virtio,qemu";</code> </pre> <br>  Acontece que o endere√ßo e o comprimento exigem dois valores de 32 bits.  Isso significa que com <code>reg = &lt;0x00 0x80000000 0x00 0x8000000&gt;;</code>  nossa mem√≥ria come√ßa <code> 0x00 + 0x80000000 (0x80000000)</code> e ocupa <code>0x00 + 0x8000000 (0x8000000)</code> bytes, ou seja, termina em <code>0x88000000</code> , o que corresponde a 128 megabytes. <br><br><a name="7"></a><h1>  Layout </h1><br>  Usando <code>qemu</code> e <code>dtc</code> encontramos os endere√ßos de RAM na m√°quina virtual virtual.  Tamb√©m sabemos que o <code>gcc</code> comp√µe <code>crt0</code> por padr√£o, sem configurar a pilha conforme necess√°rio.  Mas como usar essas informa√ß√µes para eventualmente executar e depurar o programa? <br><br>  Como <code>crt0</code> n√£o nos conv√©m, existe uma op√ß√£o √≥bvia: escreva seu pr√≥prio c√≥digo e componha-o com o arquivo de objeto que obtivemos ap√≥s compilar nosso programa simples.  Nosso <code>crt0</code> precisa saber onde a parte superior da pilha √© iniciada para inicializ√°-la corretamente.  Poder√≠amos <code>crt0</code> valor <code>0x80000000</code> diretamente para <code>crt0</code> , mas essa n√£o √© uma solu√ß√£o muito adequada, levando em considera√ß√£o as altera√ß√µes que possam ser necess√°rias no futuro.  E se quisermos usar outra CPU, como <code>sifive_e</code> , com caracter√≠sticas diferentes no emulador? <br><br>  Felizmente, n√£o somos os primeiros a fazer essa pergunta e j√° existe uma boa solu√ß√£o.  O vinculador GNU <code>ld</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">permite definir o caractere</a> dispon√≠vel em nosso <code>crt0</code> .  Podemos definir o s√≠mbolo <code>__stack_top</code> adequado para diferentes processadores. <br><br>  Em vez de escrever seu pr√≥prio arquivo vinculador do zero, faz sentido pegar o script padr√£o com <code>ld</code> e modific√°-lo um pouco para suportar caracteres adicionais.  O que √© um script vinculador?  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=http://www.scoberlin.de/content/media/">Aqui est√° uma boa descri√ß√£o</a> : <br><br><blockquote>  <i>O principal objetivo do script do vinculador √© descrever como as se√ß√µes do arquivo s√£o correspondidas na entrada e na sa√≠da e controlar o layout da mem√≥ria do arquivo de sa√≠da.</i> </blockquote><br>  Sabendo disso, vamos copiar o script do vinculador padr√£o <code>riscv64-unknown-elf-ld</code> para um novo arquivo: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/usys/riscv <span class="hljs-comment"><span class="hljs-comment"># Make a new dir for custom linker scripts out RISC-V CPUs may require. mkdir ld &amp;&amp; cd ld # Copy the default linker script into riscv64-virt.ld riscv64-unknown-elf-ld --verbose &gt; riscv64-virt.ld</span></span></code> </pre> <br>  Este arquivo possui <i>muitas</i> informa√ß√µes interessantes, muito mais do que podemos discutir neste artigo.  Sa√≠da detalhada com a <code>--Verbose</code> inclui informa√ß√µes sobre a vers√£o <code>ld</code> , arquiteturas suportadas e muito mais.  √â bom saber tudo isso, mas essa sintaxe √© inaceit√°vel no script do vinculador, portanto, abra um editor de texto e exclua tudo o que √© sup√©rfluo do arquivo. <br><br><pre>  vim riscv64-virt.ld<font></font>
<font></font>
 # Remova tudo acima e incluindo a linha =============
 GNU ld (GNU Binutils) 2.32
   Emula√ß√µes suportadas:
    elf64lriscv
    elf32lriscv
 usando script vinculador interno:
 =====================================================
 / * Script para -z combreloc: combina e ordena se√ß√µes de realoca√ß√£o * /
 / * Copyright (C) 2014-2019 Free Software Foundation, Inc.
    A c√≥pia e distribui√ß√£o deste script, com ou sem modifica√ß√£o,
    s√£o permitidos em qualquer meio sem royalties, desde que os direitos autorais
    aviso e este aviso s√£o preservados.  * /
 OUTPUT_FORMAT ("elf64-littleriscv", "elf64-littleriscv",
	       "elf64-littleriscv")
 ... restante do script do vinculador ... </pre><br>  Depois disso, execute o comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MEMORY</a> para determinar manualmente onde <code>__stack_top</code> estar√°.  Localize a linha que come√ßa com <code>OUTPUT_ARCH(riscv)</code> , ela deve estar na parte superior do arquivo e adicione o comando <code>MEMORY</code> abaixo: <br><br><pre> <code class="plaintext hljs">OUTPUT_ARCH(riscv) /* &gt;&gt;&gt; Our addition. &lt;&lt;&lt; */ MEMORY { /* qemu-system-risc64 virt machine */ RAM (rwx) : ORIGIN = 0x80000000, LENGTH = 128M } /* &gt;&gt;&gt; End of our addition. &lt;&lt;&lt; */ ENTRY(_start)</code> </pre> <br>  Criamos um bloco de mem√≥ria chamado <code>RAM</code> , para o qual a leitura ( <code>r</code> ), a grava√ß√£o ( <code>w</code> ) e o armazenamento do c√≥digo execut√°vel ( <code>x</code> ) s√£o permitidos. <br><br>  √ìtimo, definimos um layout de mem√≥ria que corresponde √†s especifica√ß√µes de nossa m√°quina <code>virt</code> RISC-V.  Agora voc√™ pode us√°-lo.  Queremos colocar nossa pilha na mem√≥ria. <br><br>  Voc√™ precisa definir o caractere <code>__stack_top</code> .  Abra o script do vinculador ( <code>riscv64-virt.ld</code> ) em um editor de texto e adicione algumas linhas: <br><br><pre> <code class="plaintext hljs">SECTIONS { /* Read-only sections, merged into text segment: */ PROVIDE (__executable_start = SEGMENT_START("text-segment", 0x10000)); . = SEGMENT_START("text-segment", 0x10000) + SIZEOF_HEADERS; /* &gt;&gt;&gt; Our addition. &lt;&lt;&lt; */ PROVIDE(__stack_top = ORIGIN(RAM) + LENGTH(RAM)); /* &gt;&gt;&gt; End of our addition. &lt;&lt;&lt; */ .interp : { *(.interp) } .note.gnu.build-id : { *(.note.gnu.build-id) }</code> </pre> <br>  Como voc√™ pode ver, definimos <code>__stack_top</code> usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o comando PROVIDE</a> .  O s√≠mbolo estar√° acess√≠vel a partir de qualquer programa associado a esse script (supondo que o pr√≥prio programa n√£o determine algo com o nome <code>__stack_top</code> ).  Defina <code>__stack_top</code> como <code>ORIGIN(RAM)</code> .  Sabemos que esse valor √© <code>0x80000000</code> mais <code>LENGTH(RAM)</code> , que √© de 128 megabytes ( <code>0x8000000</code> bytes).  Isso significa que nosso <code>__stack_top</code> definido como <code>0x88000000</code> . <br><br>  Por uma quest√£o de brevidade, n√£o listarei o arquivo vinculador inteiro <a href="">aqui</a> ; voc√™ pode v√™-lo <a href="">aqui</a> . <br><br><a name="8"></a><h1>  Pare com isso!  <s>Hammertime!</s>  Tempo de execu√ß√£o! </h1><br>  Agora, temos tudo o que precisamos para criar nosso pr√≥prio tempo de execu√ß√£o C. Na verdade, essa √© uma tarefa bastante simples, eis o arquivo <code>crt0.s</code> inteiro: <br><br><pre> <code class="plaintext hljs">.section .init, "ax" .global _start _start: .cfi_startproc .cfi_undefined ra .option push .option norelax la gp, __global_pointer$ .option pop la sp, __stack_top add s0, sp, zero jal zero, main .cfi_endproc .end</code> </pre> <br>  Atrai imediatamente um grande n√∫mero de linhas que come√ßam com um ponto.  Este √© um arquivo para o assembler <code>as</code> .  Linhas com pontos s√£o chamadas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">diretivas assembler</a> : fornecem informa√ß√µes para assembler.  Este n√£o √© um c√≥digo execut√°vel, como as instru√ß√µes do RISC-V assembler, como <code>jal</code> e <code>add</code> . <br><br>  Vamos analisar o arquivo linha por linha.  Trabalharemos com v√°rios registradores RISC-V padr√£o; portanto, confira <a href="">esta tabela</a> , que abrange todos os registradores e sua finalidade. <br><br><pre> <code class="plaintext hljs">.section .init, "ax"</code> </pre> <br>  Conforme indicado no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">manual do GNU assembler 'as'</a> , esta linha diz ao assembler para inserir o seguinte c√≥digo na se√ß√£o <code>.init</code> , que √© alocada ( <code>a</code> ) e execut√°vel ( <code>x</code> ).  Esta se√ß√£o √© outra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">conven√ß√£o comum</a> para a execu√ß√£o de c√≥digo no sistema operacional.  Trabalhamos em hardware puro sem sistema operacional, portanto, no nosso caso, essas instru√ß√µes podem n√£o ser absolutamente necess√°rias, mas, em qualquer caso, √© uma boa pr√°tica. <br><br><pre> <code class="plaintext hljs">.global _start _start:</code> </pre> <br>  <code>.global</code> disponibiliza o seguinte caractere para <code>ld</code> .  Sem isso, o link n√£o funcionar√°, porque o <code>ENTRY(_start)</code> no script do vinculador aponta para o s√≠mbolo <code>_start</code> como o ponto de entrada para o arquivo execut√°vel.  A pr√≥xima linha informa ao assembler que estamos iniciando a defini√ß√£o do caractere <code>_start</code> . <br><br><pre> <code class="plaintext hljs">_start: .cfi_startproc .cfi_undefined ra ...other stuff... .cfi_endproc</code> </pre> <br>  Essas diretivas <code>.cfi</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">informam</a> sobre a estrutura do quadro e como lidar com ele.  As <code>.cfi_startproc</code> e <code>.cfi_endproc</code> sinalizam o in√≠cio e o fim de uma fun√ß√£o, e <code>.cfi_undefined ra</code> informa ao assembler que o registro <code>ra</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">n√£o deve ser restaurado</a> para qualquer valor que ele contenha antes do <code>_start</code> . <br><br><pre> <code class="plaintext hljs">.option push .option norelax la gp, __global_pointer$ .option pop</code> </pre> <br>  Essas diretivas <code>.option</code> alteram o comportamento do assembler de acordo com o c√≥digo quando voc√™ precisa aplicar um conjunto espec√≠fico de op√ß√µes.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Aqui est√° uma</a> descri√ß√£o detalhada de por que o uso de <code>.option</code> neste segmento √© importante: <br><br><blockquote>  <i>... como possivelmente relaxamos o endere√ßamento de seq√º√™ncias para sequ√™ncias mais curtas em rela√ß√£o ao GP, o carregamento inicial do GP n√£o deve ser enfraquecido e deve ser algo como isto:</i> <i><br><br></i> <pre> <code class="plaintext hljs">.option push .option norelax la gp, __global_pointer$ .option pop</code> </pre> <br>  para que, ap√≥s o relaxamento, voc√™ obtenha o seguinte c√≥digo: <br><br><pre> <code class="plaintext hljs">auipc gp, %pcrel_hi(__global_pointer$) addi gp, gp, %pcrel_lo(__global_pointer$)</code> </pre> <br>  em vez de simples: <br><br><pre> <code class="plaintext hljs">addi gp, gp, 0</code> </pre> </blockquote><br>  E agora a √∫ltima parte do nosso <code>crt0.s</code> : <br><br><pre> <code class="plaintext hljs">_start: ...other stuff... la sp, __stack_top add s0, sp, zero jal zero, main .cfi_endproc .end</code> </pre> <br>  Aqui podemos finalmente usar o s√≠mbolo <code>__stack_top</code> , que trabalhamos duro para criar.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A pseudo-instru√ß√£o</a> <code>la</code> (endere√ßo de carregamento) carrega o valor <code>__stack_top</code> no registrador <code>sp</code> (ponteiro da pilha), configurando-o para uso no restante do programa. <br><br>  Em seguida, <code>add s0, sp, zero</code> adiciona os valores dos registradores <code>sp</code> e <code>zero</code> (que na verdade √© o registrador <code>x0</code> com uma refer√™ncia r√≠gida a 0) e coloca o resultado no registrador <code>s0</code> .  Este √© um <a href="">registro especial</a> que √© incomum em v√°rios aspectos.  Primeiro, √© um ‚Äúregistro persistente‚Äù, ou seja, √© salvo quando chamadas de fun√ß√£o.  Em segundo lugar, <code>s0</code> √†s vezes atua como um ponteiro de quadro, o que concede a cada fun√ß√£o um pequeno espa√ßo na pilha para armazenar os par√¢metros passados ‚Äã‚Äãpara essa fun√ß√£o.  Como as chamadas de fun√ß√£o funcionam com os ponteiros de pilha e quadro √© um t√≥pico muito interessante que voc√™ pode dedicar facilmente a um artigo separado, mas, por enquanto, saiba que em nosso tempo de execu√ß√£o √© importante inicializar o ponteiro de quadro <code>s0</code> . <br><br>  Em seguida, vemos o <code>jal zero, main</code> declara√ß√£o <code>jal zero, main</code> .  Aqui <code>jal</code> significa pular e vincular.  A instru√ß√£o espera operandos na forma de <code>jal rd (destination register), offset_address</code> .  Funcionalmente, <code>jal</code> grava o valor da pr√≥xima instru√ß√£o (registrador <code>pc</code> mais quatro) em <code>rd</code> e, em seguida, define o registro <code>pc</code> valor atual do <code>pc</code> mais o endere√ßo de deslocamento com <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">extens√£o de sinal</a> , efetivamente "chamando" esse endere√ßo. <br><br>  Como mencionado acima, <code>x0</code> fortemente vinculado ao valor literal 0 e a grava√ß√£o nele √© in√∫til.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, pode parecer estranho usarmos um registro como o registro de destino </font></font><code>zero</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que os montadores do RISC-V interpretam como um registro </font></font><code>x0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Afinal, isso significa uma transi√ß√£o incondicional para </font></font><code>offset_address</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Por que fazer isso, porque em outras arquiteturas h√° uma instru√ß√£o expl√≠cita para uma transi√ß√£o incondicional? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esse padr√£o estranho </font></font><code>jal zero, offset_address</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© realmente otimiza√ß√£o inteligente. O suporte para cada nova instru√ß√£o significa um aumento e, consequentemente, um aumento no custo do processador. Portanto, quanto mais simples o ISA, melhor. Em vez de poluir o espa√ßo de instru√ß√µes com duas instru√ß√µes </font></font><code>jal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>unconditional jump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, a arquitetura RISC-V suporta apenas </font></font><code>jal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, e saltos incondicionais s√£o suportados </font></font><code>jal zero, main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O RISC-V possui muitas dessas otimiza√ß√µes, a maioria das quais toma a forma das chamadas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pseudo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">instru√ß√µes</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Os montadores sabem como traduzi-los em instru√ß√µes reais de hardware. </font><font style="vertical-align: inherit;">Por exemplo, </font></font><code>j offset_address</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">montadores RISC-V convertem </font><font style="vertical-align: inherit;">pseudo- </font><font style="vertical-align: inherit;">instru√ß√µes para saltos </font><font style="vertical-align: inherit;">incondicionais </font><font style="vertical-align: inherit;">em </font></font><code>jal zero, offset_address</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Para obter uma lista completa das pseudo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instru√ß√µes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oficialmente suportadas </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">,</font></a><font style="vertical-align: inherit;"> consulte </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">a especifica√ß√£o RISC-V (vers√£o 2.2)</font></a><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="plaintext hljs">_start: ...other stuff... jal zero, main .cfi_endproc .end</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nossa √∫ltima linha √© a diretiva assembler </font></font><code>.end</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que simplesmente marca o final do arquivo.</font></font><br><br><a name="9"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Depurar, mas agora de verdade </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tentando depurar um programa C simples em um processador RISC-V, resolvemos muitos problemas. </font><font style="vertical-align: inherit;">Primeiro, usei </font></font><code>qemu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>dtc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">encontrei nossa mem√≥ria na m√°quina virtual </font></font><code>virt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RISC-V. </font><font style="vertical-align: inherit;">Em seguida, usamos essas informa√ß√µes para controlar manualmente a aloca√ß√£o de mem√≥ria em nossa vers√£o do script padr√£o do vinculador </font></font><code>riscv64-unknown-elf-ld</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o que nos permitiu determinar com precis√£o o s√≠mbolo </font></font><code>__stack_top</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Em seguida, use este s√≠mbolo em sua pr√≥pria vers√£o </font></font><code>crt0.s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que define os nossos √≠ndices de pilha e globais, e, finalmente, chamou a fun√ß√£o </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Agora voc√™ pode atingir seu objetivo e come√ßar a depurar nosso programa simples no GDB. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lembre-se aqui √© o pr√≥prio programa C:</font></font><br><br><pre> <code class="cpp hljs">cat add.<span class="hljs-function"><span class="hljs-function">c </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">12</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c = a + b; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Compilando e vinculando: </font></font><br><br><pre> <code class="bash hljs">riscv64-unknown-elf-gcc -g -ffreestanding -O0 -Wl,--gc-sections -nostartfiles -nostdlib -nodefaultlibs -Wl,-T,riscv64-virt.ld crt0.s add.c</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui indicamos muito mais sinalizadores do que da √∫ltima vez, ent√£o vamos ver os que n√£o descrevemos antes. </font></font><br><br> <code>-ffreestanding</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">informa ao compilador que a biblioteca padr√£o pode n√£o existir</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , portanto, n√£o h√° necessidade de fazer suposi√ß√µes sobre sua presen√ßa obrigat√≥ria. Esse par√¢metro n√£o √© necess√°rio ao iniciar o aplicativo em seu host (no sistema operacional), mas, neste caso, n√£o √©, portanto, √© importante informar o compilador dessas informa√ß√µes. </font></font><br><br> <code>-Wl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Uma lista de sinalizadores separados por v√≠rgula para passar ao vinculador ( </font></font><code>ld</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). Aqui, </font></font><code>--gc-sections</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">significa "se√ß√µes de coleta de lixo" e </font></font><code>ld</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© instru√≠do a remover se√ß√µes n√£o utilizadas ap√≥s a vincula√ß√£o. Bandeiras </font></font><code>-nostartfiles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>-nostdlib</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>-nodefaultlibs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o ligador n√£o processa os arquivos de inicializa√ß√£o do sistema padr√£o (por exemplo, padr√£o</font></font><code>crt0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), implementa√ß√µes padr√£o do sistema stdlib e bibliotecas vinculadas padr√£o do sistema padr√£o. </font><font style="vertical-align: inherit;">Como temos nosso pr√≥prio script </font></font><code>crt0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e vinculador, √© importante passar esses sinalizadores para que os valores padr√£o n√£o entrem em conflito com nossas prefer√™ncias do usu√°rio. </font></font><br><br> <code>-T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indica o caminho para o script do vinculador, o que √© simples no nosso caso </font></font><code>riscv64-virt.ld</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Por fim, especificamos os arquivos que queremos compilar, compilar e compor: </font></font><code>crt0.s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>add.c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Como antes, o resultado √© um arquivo completo e pronto para executar, chamado </font></font><code>a.out</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora execute o nosso novo execut√°vel nov√≠ssimo em </font></font><code>qemu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># -S freezes execution of our executable (-kernel) until we explicitly tell # it to start with a 'continue' or 'c' from our gdb client qemu-system-riscv64 -machine virt -m 128M -gdb tcp::1234 -S -kernel a.out</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora execute </font></font><code>gdb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, lembre-se de carregar os s√≠mbolos de depura√ß√£o </font></font><code>a.out</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, especificando-o com o √∫ltimo argumento:</font></font><br><br><pre> <code class="bash hljs">riscv64-unknown-elf-gdb --tui a.out GNU gdb (GDB) 8.2.90.20190228-git Copyright (C) 2019 Free Software Foundation, Inc. License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt; This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. Type <span class="hljs-string"><span class="hljs-string">"show copying"</span></span> and <span class="hljs-string"><span class="hljs-string">"show warranty"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> details. This GDB was configured as <span class="hljs-string"><span class="hljs-string">"--host=x86_64-apple-darwin17.7.0 --target=riscv64-unknown-elf"</span></span>. Type <span class="hljs-string"><span class="hljs-string">"show configuration"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> configuration details. For bug reporting instructions, please see: &lt;http://www.gnu.org/software/gdb/bugs/&gt;. Find the GDB manual and other documentation resources online at: &lt;http://www.gnu.org/software/gdb/documentation/&gt;. For <span class="hljs-built_in"><span class="hljs-built_in">help</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">"help"</span></span>. Type <span class="hljs-string"><span class="hljs-string">"apropos word"</span></span> to search <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> commands related to <span class="hljs-string"><span class="hljs-string">"word"</span></span>... Reading symbols from a.out... (gdb)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em seguida, conecte nosso cliente </font></font><code>gdb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ao servidor </font></font><code>gdb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que lan√ßamos como parte do comando </font></font><code>qemu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="bash hljs">(gdb) target remote :1234 ‚îÇ Remote debugging using :1234</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Defina um ponto de interrup√ß√£o no principal: </font></font><br><br><pre> <code class="bash hljs">(gdb) b main Breakpoint 1 at 0x8000001e: file add.c, line 2.</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> E inicie o programa: </font></font><br><br><pre> <code class="bash hljs">(gdb) c Continuing. Breakpoint 1, main () at add.c:2</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A partir da sa√≠da fornecida, √© claro que atingimos com sucesso o ponto de interrup√ß√£o na linha 2! </font><font style="vertical-align: inherit;">Isso tamb√©m √© vis√≠vel na interface de texto, finalmente temos a linha correta </font></font><code>L</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o valor </font></font><code>PC:</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© </font></font><code>L2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>PC:</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><code>0x8000001e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Se voc√™ fez tudo como no artigo, a sa√≠da ser√° mais ou menos assim: a </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/bd8/aa9/78d/bd8aa978df4289f584b5c422cdb6e44c.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">partir de agora, voc√™ pode us√°-lo </font></font><code>gdb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como de costume: </font></font><code>-s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para ir para a pr√≥xima instru√ß√£o, </font></font><code>info all-registers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para verificar os valores dentro dos registros enquanto o programa √© executado, etc. Experimente o seu prazer ... n√≥s, √© claro , trabalhou muito para isso!</font></font><br><br><a name="10"></a><h1>  O que vem a seguir? </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hoje conseguimos muito e, espero, aprendemos muito! Eu nunca tive um plano formal para este e outros artigos, apenas segui o que era mais interessante para mim a cada momento. Portanto, n√£o tenho certeza do que acontecer√° a seguir. Eu gostei especialmente da imers√£o profunda nas instru√ß√µes </font></font><code>jal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, portanto, talvez no pr√≥ximo artigo tomemos como base o conhecimento adquirido aqui, mas substitua-o por </font></font><code>add.c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">algum programa em puro montador RISC-V. Se voc√™ tiver algo espec√≠fico que gostaria de ver ou tiver alguma d√∫vida, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">abra tickets</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obrigado pela leitura! Espero encontrar no pr√≥ximo artigo!</font></font><br><br><a name="11"></a><h1>  Opcional </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ gostou do artigo e quer saber mais, confira a apresenta√ß√£o de Matt Godbolt intitulada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúBits entre bits: como entramos no main ()‚Äù</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> da confer√™ncia CppCon2018. </font><font style="vertical-align: inherit;">Ela aborda o assunto um pouco diferente do que estamos aqui. </font><font style="vertical-align: inherit;">Realmente boa palestra, veja por si mesmo!</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt454208/">https://habr.com/ru/post/pt454208/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt454190/index.html">O que voc√™ n√£o precisa fazer se seu telefone for roubado</a></li>
<li><a href="../pt454196/index.html">Impress√£o 3D de eletr√¥nicos usando um exemplo de drone: fios e placas n√£o s√£o mais necess√°rios</a></li>
<li><a href="../pt454198/index.html">Criando um projeto Gradle SpringBoot + Angular com v√°rios m√≥dulos no IDEA</a></li>
<li><a href="../pt454204/index.html">O rastreamento comportamental n√£o √© uma panac√©ia?</a></li>
<li><a href="../pt454206/index.html">Dias 9: An√°lise de AI CTF</a></li>
<li><a href="../pt454210/index.html">Enchantjs esquecidos + novo 1C-Bitrix = Jogo para motiva√ß√£o do cliente</a></li>
<li><a href="../pt454214/index.html">Eu odeio quase todo software</a></li>
<li><a href="../pt454216/index.html">Foram encontradas evid√™ncias de que todas as altera√ß√µes s√£o uma mistura de ordem e chance</a></li>
<li><a href="../pt454220/index.html">Term√¥metro de dois d√≠gitos</a></li>
<li><a href="../pt454222/index.html">Atualize o subsistema de disco do servidor antigo com o barramento PCIe 1.0 - 2.0</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>