<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚵 🤙🏽 🦃 Evaluación comparativa de ORM utilizada al crear aplicaciones de Android 🦂 👴🏽 🤚🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr! Mi nombre es Artyom Dobrovinsky y soy desarrollador de Android en FINCH . 


 Una vez, envolviéndome en el humo de un cigarro matutino, est...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Evaluación comparativa de ORM utilizada al crear aplicaciones de Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/477940/"><p>  Hola Habr!  Mi nombre es Artyom Dobrovinsky y soy desarrollador de Android en <a href="https://www.facebook.com/FinchMoscow">FINCH</a> . </p><br><p> Una vez, envolviéndome en el humo de un cigarro matutino, estudié el código fuente de un ORM para Android.  Al ver allí, un paquete llamado <code>benchmarks</code> inmediatamente miró allí, y me sorprendió que todas las evaluaciones se hicieran usando <code>Log.d(System.nanoTime())</code> .  Esta no es la primera vez que veo esto.  Para ser honesto, incluso vi puntos de referencia realizados con <code>System.currentTimeMillis()</code> .  El colapso de la conciencia de que algo debe cambiarse me obligó a dejar a un lado un vaso de whisky y sentarme al teclado. </p><a name="habracut"></a><br><h3 id="pochemu-napisana-eta-statya">  ¿Por qué está escrito este artículo? </h3><br><p>  La situación con la comprensión de cómo medir el rendimiento del código en Android es triste. <br>  No hable de los perfiladores, pero en 2019 alguien sigue confiando en que la JVM hace todo lo que escribió el desarrollador y en el orden exacto en que se escribe el código.  En realidad, no hay nada más lejos de la verdad. </p><br><p>  De hecho, la desafortunada máquina virtual lucha contra un billón de lectores de botones descuidados que escriben su propio código, sin tener que preocuparse de cómo funcionará el procesador con todo esto.  Esta batalla ha estado sucediendo durante varios años, y ella tiene un millón de optimizaciones difíciles en su manga que (si se ignoran) convertirán cualquier medición del rendimiento del programa en una pérdida de tiempo. </p><br><p>  Es decir, los desarrolladores a veces no consideran necesario medir el rendimiento del código, y aún más a menudo no saben cómo.  La dificultad radica en el hecho de que para realizar una evaluación del desempeño, es necesario crear las condiciones más similares e ideales para todos los casos; esta es la única forma de obtener información útil.  Estas condiciones son creadas por soluciones no escritas en la rodilla. </p><br><p>  Si necesita argumentos sobre si usar marcos de terceros para medir el rendimiento, siempre puede leer <a href="https://shipilev.net/blog/2014/nanotrusting-nanotime/">Alexei Shipilev</a> y maravillarse con la profundidad del problema.  Todo está en el artículo por referencia: por qué se necesita calentamiento antes de realizar el punto de referencia, por qué no se puede confiar en <code>System.currentTimeMillis()</code> al contar el tiempo transcurrido, y bromas por 300. Excelente lectura. </p><br><h5 id="pochemu-ya-mogu-ob-etom-rasskazyvat">  ¿Por qué puedo hablar de esto? </h5><br><p>  El hecho es que soy un desarrollador completamente desarrollado: no solo soy dueño del SDK de Android como si fuera mi proyecto favorito, sino que durante otro mes escribí el código para el backend. </p><br><p>  Cuando traje mi primer microservicio a la revisión, y no había ninguna evaluación comparativa en <code>README</code> , me miró con un malentendido.  Recordé esto y nunca más volví a repetir este error.  Porque se fue en una semana. </p><br><p>  Vamos </p><br><h3 id="chto-izmeryaem">  ¿Qué estamos midiendo? </h3><br><p>  Como parte del caso de las bases de datos de referencia para Android, decidí medir la velocidad de inicialización y la velocidad de escritura / lectura para ORM como Paper, Hawk, Realm y Room. <br>  Sí, mido en una prueba NoSQL y una base de datos relacional: ¿cuál es la siguiente pregunta? </p><br><h3 id="chem-izmeryaem">  De lo que medimos </h3><br><p>  Parece que si estamos hablando de la JVM, entonces la elección es obvia: hay una <a href="https://openjdk.java.net/projects/code-tools/jmh/">JMH</a> <a href="https://mvnrepository.com/tags/benchmark">glorificada</a> , <a href="https://groups.google.com/d/msg/mechanical-sympathy/m4opvy4xq3U/7lY8x8SvHgwJ">perfecta</a> e <a href="http://hg.openjdk.java.net/code-tools/jmh/file/f2e982b7c51b/jmh-samples/src/main/java/org/openjdk/jmh/samples/">impecablemente documentada</a> .  Pero no, no inicia las pruebas de instrumentación para Android. </p><br><p>  Google <a href="https://github.com/google/caliper">Calipher los</a> sigue, con el mismo resultado. </p><br><p>  Hay una bifurcación de Calipher llamada <a href="https://github.com/cmelchior/spanner">Spanner</a> , que durante muchos años ha sido zeppercay y fomenta el uso de <a href="https://developer.android.com/jetpack/androidx/releases/benchmark">Androidx Benchmark</a> . </p><br><p>  Centrémonos en lo último.  Si solo porque no teníamos otra opción. </p><br><p>  Al igual que todo lo que se agregó a Jetpack y no se repensó al migrar desde la Biblioteca de soporte, Androidx Benchmark se ve y se comporta como si estuviera escrito en una semana y media como una tarea de prueba, y nadie más lo tocará.  Además, esta biblioteca está un poco pasada, porque es más para evaluar las pruebas de IU.  Pero por falta de lo mejor, puedes trabajar con ella.  Esto nos salvará al menos de <a href="">errores obvios</a> y también ayudará con el calentamiento. </p><br><p>  Para reducir la ridiculez de los resultados, haré todas las pruebas 10 veces y calcularé el promedio. </p><br><p>  Dispositivo de prueba: Xiaomi A1.  No es el más débil del mercado, Android "limpio". </p><br><h3 id="podklyuchenie-biblioteki-v-proekt">  Conectar una biblioteca a un proyecto </h3><br><p>  Hay <a href="">excelentes instrucciones</a> para conectar Andoridx Benchmark a un proyecto.  Le recomiendo encarecidamente que no sea flojo y que conecte un módulo separado para realizar mediciones. </p><br><h3 id="hod-eksperimenta">  Progreso del experimento </h3><br><p>  Todos nuestros puntos de referencia se ejecutarán en el siguiente orden: </p><br><ol><li>  Primero, iniciamos la base de datos en el cuerpo de prueba. </li><li>  Luego, en el bloque <code>benchmarkRule.scope.runWithTimingDisabled</code> , generamos datos que alimentamos a la base de datos.  El código colocado en este circuito no se tendrá en cuenta en la evaluación. </li><li>  En el mismo cierre agregamos la lógica de borrar la base de datos;  asegúrese de que la base de datos esté vacía antes de escribir. </li><li>  La siguiente es la lógica de la escritura y la lectura.  Asegúrese de inicializar la variable con el resultado de la lectura para que la JVM no elimine esta lógica del recuento de ejecución como no utilizada. </li><li>  Medimos el rendimiento de la inicialización de la base de datos en una función separada. </li><li>  Nos sentimos como un hombre de ciencia. </li></ol><br><p>  El código se puede encontrar <a href="https://github.com/dobrowins/androiddbbenchmarks/tree/master/tests/src/androidTest/java/com/dobrowins/dbbenchmarking/tests">aquí</a> .  Si tiene pereza para caminar, la función de medición para PaperDb se ve así: </p><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">paperdbInsertReadTest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = benchmarkRule.measureRepeated { <span class="hljs-comment"><span class="hljs-comment">//   (     ) benchmarkRule.scope.runWithTimingDisabled { Paper.book().destroy() if (Paper.book().allKeys.isNotEmpty()) throw RuntimeException() } //    repository.store(persons, { list -&gt; Paper.book().write(KEY_CONTACTS, list) }) val persons = repository.read { Paper.book().read&lt;List&lt;Person&gt;&gt;(KEY_CONTACTS, emptyList()) } }</span></span></code> </pre> <br><p>  Los puntos de referencia para el resto de ORM se parecen. </p><br><h4 id="rezultaty">  Resultados </h4><br><h5 id="inicializaciya">  Inicialización </h5><br><div class="scrollable-table"><table><thead><tr><th>  nombre de prueba </th><th>  malvado </th><th>  1 </th><th>  2 </th><th>  3 </th><th>  4 4 </th><th>  5 5 </th><th>  6 6 </th><th>  7 7 </th><th>  8 </th><th>  9 9 </th><th>  10 </th></tr></thead><tbody><tr><td>  HawkInitTest </td><td>  49_512 </td><td>  49_282 </td><td>  50_021 </td><td>  49_119 </td><td>  50_145 </td><td>  49_970 </td><td>  50_047 </td><td>  46_649 </td><td>  50_230 </td><td>  49_863 </td><td>  49_794 </td></tr><tr><td>  PaperdbInitTest </td><td>  224 </td><td>  223 </td><td>  223 </td><td>  223 </td><td>  233 </td><td>  223 </td><td>  223 </td><td>  223 </td><td>  223 </td><td>  223 </td><td>  223 </td></tr><tr><td>  RealmInitTest </td><td>  218 </td><td>  217 </td><td>  217 </td><td>  217 </td><td>  217 </td><td>  217 </td><td>  217 </td><td>  217 </td><td>  227 </td><td>  217 </td><td>  217 </td></tr><tr><td>  RoomInitTest </td><td>  61_695.5 </td><td>  63_450 </td><td>  59_714 </td><td>  58_527 </td><td>  59_175 </td><td>  63_544 </td><td>  62_980 </td><td>  63_252 </td><td>  59_670 </td><td>  63_868 </td><td>  62_775 </td></tr></tbody></table></div><br><p>  El ganador es Realm, en segundo lugar es Paper.  Lo que está haciendo Room, todavía puede imaginar que Hawk hace casi la misma cantidad de tiempo, es completamente incomprensible. </p><br><h5 id="zapis-i-chtenie">  Escritura y lectura </h5><br><div class="scrollable-table"><table><thead><tr><th>  nombre de prueba </th><th>  malvado </th><th>  1 </th><th>  2 </th><th>  3 </th><th>  4 4 </th><th>  5 5 </th><th>  6 6 </th><th>  7 7 </th><th>  8 </th><th>  9 9 </th><th>  10 </th></tr></thead><tbody><tr><td>  HawkInsertReadTest </td><td>  278_736_469.2 </td><td>  278_098_654 </td><td>  283_956_846 </td><td>  276_748_308 </td><td>  282_447_384 </td><td>  272_609_500 </td><td>  284_699_653 </td><td>  271_869_770 </td><td>  278_719_693 </td><td>  278_836_115 </td><td>  279_378_769 </td></tr><tr><td>  PaperdbInsertReadTest </td><td>  173_519_957.3 </td><td>  172_953_347 </td><td>  174_702_000 </td><td>  169_740_846 </td><td>  174_401_192 </td><td>  173_930_037 </td><td>  174_179_616 </td><td>  173_937_460 </td><td>  173_739_115 </td><td>  176_215_038 </td><td>  171_400_922 </td></tr><tr><td>  RealmInsertReadTest </td><td>  111_644_042.3 </td><td>  108_501_578 </td><td>  110_616_078 </td><td>  102_056_461 </td><td>  112_946_577 </td><td>  111_701_231 </td><td>  114_922_962 </td><td>  106_198_000 </td><td>  118_742_498 </td><td>  120_888_230 </td><td>  109_866_808 </td></tr><tr><td>  RoomInsertReadTest </td><td>  1_863_499_483.3 </td><td>  187_250_3614 </td><td>  1_837_078_614 </td><td>  1_872_482_538 </td><td>  1_827_338_460 </td><td>  1_869_147_999 </td><td>  1_857_126_229 </td><td>  1_842_427_537 </td><td>  1_870_630_652 </td><td>  1_878_862_538 </td><td>  1_907_396_652 </td></tr></tbody></table></div><br><p>  Aquí nuevamente el ganador de Realm, pero en estos resultados huele a fracaso. </p><br><p>  La diferencia de cuatro veces entre las dos bases de datos "más lentas" y las dieciséis veces entre las "más rápidas" y las "más lentas" es muy sospechosa.  Incluso teniendo en cuenta el hecho de que la diferencia es estable. </p><br><h3 id="zaklyuchenie">  Conclusión </h3><br><p>  Medir el rendimiento de su código es al menos por curiosidad.  Incluso si hablamos de los casos más lanzados por la industria (como la evaluación de pruebas instrumentales para Android). </p><br><p>  Hay muchas razones para usar marcos de terceros para este negocio (en lugar de escribir el suyo propio con el tiempo y las animadoras). </p><br><p>  La situación en las bases de código es tal que todos están tratando de escribir en una arquitectura limpia, para la mayoría, el módulo con lógica de negocios es un módulo java, para conectar un módulo con JMH cercano y verificar el código para detectar cuellos de botella, funciona por un día.  Y los beneficios, durante muchos años por venir. </p><br><p>  ¡Feliz codificación! </p><br><p>  PD: Si un lector atento conoce el marco para realizar pruebas comparativas de pruebas instrumentales para Android, que no figuran en el artículo, por favor comparta en los comentarios. </p><br><p>  PPS: <a href="https://github.com/dobrowins/androiddbbenchmarks/">el repositorio de</a> prueba <a href="https://github.com/dobrowins/androiddbbenchmarks/">está</a> abierto para solicitudes de extracción. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/477940/">https://habr.com/ru/post/477940/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../477924/index.html">Tutorial JavaFX: estilo CSS</a></li>
<li><a href="../477930/index.html">La mejor arquitectura para MVP: monolito, SOA, microservicios o sin servidor ... Parte 2</a></li>
<li><a href="../477934/index.html">Descuentos de hosters en Black Friday 2019</a></li>
<li><a href="../477936/index.html">Diccionario de TI o ¿Qué? Donde A donde Parte 2</a></li>
<li><a href="../477938/index.html">El mercado de servidores usados ​​en Rusia: todo comenzó con Habr</a></li>
<li><a href="../477946/index.html">"Cúbrete y vete para el fin de semana": cómo retirarte de los servicios más populares</a></li>
<li><a href="../477950/index.html">La primera regla del antifraude es no contarle a nadie sobre el antifraude</a></li>
<li><a href="../477954/index.html">Cómo las publicaciones de respuesta harán que Internet sea más inteligente</a></li>
<li><a href="../477956/index.html">JavaScript en 3D: una introducción a Three.js</a></li>
<li><a href="../477958/index.html">Las 10 principales tendencias del nuevo informe de tendencias de delincuencia de alta tecnología 2019/2020 Group-IB</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>