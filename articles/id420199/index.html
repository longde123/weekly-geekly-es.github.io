<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥥 🦋 ✊🏿 Otomasi sistem pemantauan berdasarkan Icinga2 dan Wayang 🔲 👨🏿‍🏭 🌝</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Otomasi sistem pemantauan berdasarkan Icinga2 dan Wayang 
 Mari kita bicara sedikit tentang ... Infrastruktur sebagai kode (IaC). 
 Di Habré ada beber...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Otomasi sistem pemantauan berdasarkan Icinga2 dan Wayang</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420199/"><h1><img src="https://habrastorage.org/webt/do/po/ex/dopoexqmfbzwvbyt6vlwvvaqqus.png">  Otomasi sistem pemantauan berdasarkan Icinga2 dan Wayang </h1><br><h3>  Mari kita bicara sedikit tentang ... Infrastruktur sebagai kode (IaC). </h3><br>  Di Habré ada beberapa artikel bagus tentang Icinga2, ada juga artikel bagus tentang Wayang: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Icinga2 adalah opsi yang mudah</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kami meningkatkan pemantauan mikro pada icinga2 dengan biaya minimum</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Menyiapkan server Wayang modern dari awal</a> <br><br>  Namun, topik otomatisasi dan integrasi kedua sistem yang menakjubkan ini tidak diungkapkan sama sekali. <br>  Dalam panduan ini, saya akan menunjukkan dalam contoh "hidup" bagaimana Anda dapat menggabungkan keduanya <br>  sistem, dapatkan alat yang ampuh untuk memantau infrastruktur Anda dengan semua fungsi yang diperlukan.  Artikel ini adalah semacam panduan untuk bertindak tentang menginstal paket "semua dalam satu botol."  Setelah menyelesaikan panduan ini, Anda akan memiliki solusi pemantauan operasional penuh yang tersedia, yang selanjutnya dapat "diselesaikan" sendiri.  Ayo kita coba! <br><a name="habracut"></a><br><h1>  Jadi: </h1><br><h2>  Kami mengangkat tuan rumah baru.  Dan kita membutuhkan: </h2><br><h2>  1. Sehingga pemantauannya secara otomatis muncul di Icinga2, dan pemeriksaan dasar dibuat: </h2><br><table><tbody><tr><td>  <font color="#337788"><b>Cek</b></font> <br></td><td>  <font color="#337788"><b>Jepretan</b></font> <br></td><td>  <font color="#337788"><b>Penjelasan</b></font> <br></td></tr><tr><td>  <font color="#337788"><b>Tuan rumah</b></font> <font color="#337788"><br></font> <br></td><td> <a href=""><img src="https://habrastorage.org/webt/kj/3z/hj/kj3zhjnnftl0e_bymn0ffsp-cps.png"><br></a> <br></td><td>  Pada frekuensi yang diberikan, kami memeriksa dengan perintah ping bahwa tuan rumah "hidup". <br></td></tr><tr><td>  <font color="#337788"><b>Penggunaan disk</b></font> <font color="#337788"><br></font> <br></td><td> <a href=""><img src="https://habrastorage.org/webt/_k/od/6-/_kod6-txtpme2ygoeq_y5ixhpga.png"><br></a> <br></td><td>  Periksa apakah kami memiliki cukup ruang disk kosong. </td></tr><tr><td>  <font color="#337788"><b>Rata-rata beban</b></font> <font color="#337788"><br></font> <br></td><td> <a href=""><img src="https://habrastorage.org/webt/ts/4x/nm/ts4xnmllobanjgmtc-nzlgp5o2i.png"><br></a> <br></td><td>  Kami memantau beban di server secara dinamis.  Jumlah prosesor di dalamnya diperhitungkan. </td></tr><tr><td>  <font color="#337788"><b>Memori bebas</b></font> <font color="#337788"><br></font> <br></td><td> <a href=""><img src="https://habrastorage.org/webt/m0/c_/7k/m0c_7kx6vpz7x6lmdyzhs1nxqgw.png"><br></a> <br></td><td>  Kami memeriksa bahwa kami memiliki cukup memori bebas di server. </td></tr><tr><td>  <font color="#337788"><b>Buka port</b></font> <font color="#337788"><br></font> <br></td><td> <a href=""><img src="https://habrastorage.org/webt/qe/ww/d6/qewwd6qbleu9rokn11av0bbesge.png"><br></a> <br></td><td>  Kami memindai port di server dan membuat peta port terbuka.  Kami memantau bahwa kami tidak memiliki port terbuka atau tertutup baru. </td></tr><tr><td>  <font color="#337788"><b>Pembaruan kritis</b></font> <font color="#337788"><br></font> <br></td><td> <a href=""><img src="https://habrastorage.org/webt/ac/in/y5/aciny5yddcavhdjfrfjxitrn4fo.png"><br></a> <br></td><td>  Kami memantau keberadaan pembaruan penting di server. </td></tr></tbody></table><br><br><h2>  2. Tambahkan pemeriksaan khusus untuk berbagai layanan dengan cara yang nyaman dan mudah dimengerti.  Apa yang kemudian akan menunjukkan kepada sutradara betapa bagusnya kita dan dapatkan hadiah! <br></h2><br>  Beberapa contoh: <br><table><tbody><tr><th>  <font color="#337788"><b>Layanan</b></font> <br></th><th>  <font color="#337788"><b>Kode verifikasi YAML</b></font> <br></th></tr><tr><td><div class="spoiler">  <b class="spoiler_title">Tuan rumah virtual</b> <div class="spoiler_text">  Periksa host "langsung" atau tidak. <br></div></div><br><br> <a href=""><img src="https://habrastorage.org/webt/fa/q_/8m/faq_8muc2rwor0d9jp4ywh86qe8.png"><br></a> <br></td><td><pre><code class="hljs ruby"><span class="hljs-string"><span class="hljs-string">'%{::fqdn} virtual host'</span></span> : <span class="hljs-symbol"><span class="hljs-symbol">target:</span></span> /etc/icinga2/zones.d/master/<span class="hljs-string"><span class="hljs-string">%{::fqdn}</span></span>.conf <span class="hljs-symbol"><span class="hljs-symbol">apply:</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-symbol"><span class="hljs-symbol">assign:</span></span> [ <span class="hljs-string"><span class="hljs-string">'host.name == %{::fqdn}'</span></span> ] <span class="hljs-symbol"><span class="hljs-symbol">display_name:</span></span> <span class="hljs-string"><span class="hljs-string">'%{::fqdn} virtualhost'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">check_command:</span></span> <span class="hljs-string"><span class="hljs-string">'http'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">vars:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">http_uri:</span></span> / <span class="hljs-symbol"><span class="hljs-symbol">http_ssl:</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-symbol"><span class="hljs-symbol">http_vhost:</span></span> <span class="hljs-string"><span class="hljs-string">'hostname'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">http_address:</span></span> <span class="hljs-string"><span class="hljs-string">"%{lookup('host_address')}"</span></span></code> </pre> <br></td></tr><tr><td><div class="spoiler">  <b class="spoiler_title">PostgreSQL</b> <div class="spoiler_text">  Periksa apakah kita dapat terhubung ke database PostgreSQL. <br></div></div><br><br> <a href=""><img src="https://habrastorage.org/webt/ct/c2/wz/ctc2wzluely2l7lsbkxwx5du8i4.png"><br></a> <br></td><td><pre> <code class="hljs javascript"> <span class="hljs-string"><span class="hljs-string">'%{::fqdn} PostgreSQL'</span></span>: target: <span class="hljs-regexp"><span class="hljs-regexp">/etc/i</span></span>cinga2/zones.d/master/%{::fqdn}.conf apply: <span class="hljs-literal"><span class="hljs-literal">true</span></span> assign: [ <span class="hljs-string"><span class="hljs-string">'host.name == %{::fqdn}'</span></span> ] display_name: <span class="hljs-string"><span class="hljs-string">'PostgreSQL'</span></span> command_endpoint: <span class="hljs-string"><span class="hljs-string">'%{::fqdn}'</span></span> check_command: <span class="hljs-string"><span class="hljs-string">"postgres"</span></span> vars: postgres_host: <span class="hljs-string"><span class="hljs-string">"localhost"</span></span> postgres_action: <span class="hljs-string"><span class="hljs-string">"connection"</span></span> phone_notifications: <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre><br></td></tr><tr><td><div class="spoiler">  <b class="spoiler_title">Status nginx</b> <div class="spoiler_text">  Kami memantau status Nginx melalui stub_status. <br></div></div><br><br> <a href=""><img src="https://habrastorage.org/webt/ht/el/a9/htela9efivyadlyw4vuxdouiqbk.png"><br></a> <br></td><td><pre> <code class="hljs pgsql"> <span class="hljs-string"><span class="hljs-string">'%{::fqdn} nginx status'</span></span> : target: /etc/icinga2/zones.d/master/%{::fqdn}.conf apply: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> assign: [ <span class="hljs-string"><span class="hljs-string">'host.name == %{::fqdn}'</span></span> ] command_endpoint: <span class="hljs-string"><span class="hljs-string">'%{::fqdn}'</span></span> display_name: <span class="hljs-string"><span class="hljs-string">'nginx status'</span></span> check_command: <span class="hljs-string"><span class="hljs-string">'nginx_status'</span></span> vars: nginx_status_host_address: localhost nginx_status_servername: <span class="hljs-keyword"><span class="hljs-keyword">server</span></span>.com nginx_status_critical: <span class="hljs-string"><span class="hljs-string">'1600,60,30'</span></span> nginx_status_warn: <span class="hljs-string"><span class="hljs-string">'1500,55,25'</span></span></code> </pre><br></td></tr></tbody></table><br><h2>  3. Bahwa semuanya rapi, dapat diandalkan, dan indah.  Dan yang paling penting, habiskan tidak lebih dari 30 menit meributkan dengan pengaturan awal. <br></h2><br>  <i>Anda harus memiliki pengalaman dengan Docker, dan karenanya dengan Linux - dengan sendirinya.</i> <i><br><br></i>  <i>Pengaturan ini dijelaskan di bawah Debian / Ubuntu.</i>  <i>Dan, meskipun saya tidak melihat alasan baginya untuk tidak bekerja pada sistem mirip Unix lainnya, saya sendiri tidak dapat memberikan jaminan seperti itu.</i>  <i>Saya memiliki beberapa mesin dengan CentOS, ini berfungsi di sana, tetapi kebanyakan, bagaimanapun, adalah Debian / Ubuntu.</i> <i><br></i> <br><h2>  Mari kita mulai </h2><br>  Saya akan katakan segera, nyaman bagi saya ketika seluruh konfigurasi host adalah layanan, konfigurasi, perangkat lunak, akun, dll.  - mereka dijelaskan oleh satu file yaml, ini sebenarnya menghindari mendokumentasikan infrastruktur dan memberikan konfigurasi yang jelas.  Dia membuka proyek yang sesuai di repositori git, di mana nama file sesuai dengan nama host, kemudian membuka konfigurasi host yang diinginkan.  Dan Anda dapat segera melihat layanan apa yang ada di host, apa yang didukung dari ini, apa yang dipantau, dll. <br><br>  <b>Ini adalah bagaimana struktur proyek dalam repositori terlihat:</b> <br><br><pre> <code class="hljs">project_1/hostname1.com.yaml project_2/hostname2.com.yaml project_3/hostname3.com.yaml</code> </pre><br>  Di sini saya menggunakan templat seperti itu, yang menjelaskan konfigurasi server kami: <br><br><div class="spoiler">  <b class="spoiler_title">Template lengkap</b> <div class="spoiler_text"><pre> <code class="hljs smalltalk">#============================|<span class="hljs-type"><span class="hljs-type">INPUT</span></span> <span class="hljs-type"><span class="hljs-type">DATA</span></span>|=================================# #---------------------------------------|<span class="hljs-type"><span class="hljs-type">VARS</span></span>|----------------------------# #---//<span class="hljs-type"><span class="hljs-type">Information</span></span> about variables, keys &amp; contacts//----------------------# host_address: xxxx my_company: my_mail_domain: my_ssh_port: #---------------------------------------|<span class="hljs-type"><span class="hljs-type">CLASSES</span></span>|-------------------------# #---//<span class="hljs-type"><span class="hljs-type">Classes</span></span> are modules installed on the server.//----------------------# #---//<span class="hljs-type"><span class="hljs-type">These</span></span> modules process the arguments typed below.//------------------# #---//<span class="hljs-type"><span class="hljs-type">Without</span></span> classes nothing will work.//--------------------------------# #---//<span class="hljs-type"><span class="hljs-type">Class</span></span> default_role is mandatory. <span class="hljs-type"><span class="hljs-type">This</span></span> class will install//----------# #---//etckeeper, some required perl modules and manages all the logics.//-# classes: - default_role #---------------------------------------|<span class="hljs-type"><span class="hljs-type">TIMEZONE</span></span>|------------------------# #---//<span class="hljs-type"><span class="hljs-type">Set</span></span> timezone, which will be used on the host.//---------------------# timezone::timezone: <span class="hljs-type"><span class="hljs-type">Europe</span></span>/<span class="hljs-type"><span class="hljs-type">Moscow</span></span> #---------------------------------------|<span class="hljs-type"><span class="hljs-type">FACTS</span></span>|---------------------------# #---//<span class="hljs-type"><span class="hljs-type">Facts</span></span> are variables which puppet agent uses.//----------------------# facter::facts_hash: role: value: <span class="hljs-string"><span class="hljs-string">'name'</span></span> company: value: <span class="hljs-string"><span class="hljs-string">'name of company'</span></span> file: <span class="hljs-string"><span class="hljs-string">'location.txt'</span></span> #=========================================================================# #============================|<span class="hljs-type"><span class="hljs-type">PUPPET</span></span>|=====================================# #---//<span class="hljs-type"><span class="hljs-type">Settings</span></span> for puppet agent.//----------------------------------------# puppet::runmode: cron puppet::ca_server: <span class="hljs-comment"><span class="hljs-comment">"%{lookup('puppet_ca')}"</span></span> puppet::puppetmaster: <span class="hljs-comment"><span class="hljs-comment">"%{lookup('puppet_master')}"</span></span> #=========================================================================# #============================|<span class="hljs-type"><span class="hljs-type">CRON</span></span> <span class="hljs-type"><span class="hljs-type">TASKS</span></span>|=================================# cron_tasks: <span class="hljs-type"><span class="hljs-type">Name</span></span>: command: <span class="hljs-comment"><span class="hljs-comment">""</span></span> user: minute: <span class="hljs-string"><span class="hljs-string">''</span></span> hour: <span class="hljs-string"><span class="hljs-string">''</span></span> #=========================================================================# #============================|<span class="hljs-type"><span class="hljs-type">SUPERVISOR</span></span>|=================================# #---//<span class="hljs-type"><span class="hljs-type">Supervisor</span></span> is a process manager//-----------------------------------# supervisord::install_pip: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> supervisord::install_init: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> supervisord::service_name: supervisor supervisord::package_provider: apt supervisord::executable: /usr/bin/supervisord supervisord::executable_ctl: /usr/bin/supervisorctl supervisord::config_file: /etc/supervisor/supervisord.conf supervisord::programs: <span class="hljs-string"><span class="hljs-string">'name'</span></span>: ensure: present command: <span class="hljs-string"><span class="hljs-string">'su - rails -c "/home/name/s2"'</span></span> autostart: no autorestart: <span class="hljs-string"><span class="hljs-string">'false'</span></span> directory: /home/name/domainName/current #=========================================================================# #============================|<span class="hljs-type"><span class="hljs-type">SECURITY</span></span>|===================================# #-------------------------------------|<span class="hljs-type"><span class="hljs-type">FIREWALL</span></span>|--------------------------# #---//<span class="hljs-type"><span class="hljs-type">Iptables</span></span> rules//----------------------------------------------------# firewall: <span class="hljs-number"><span class="hljs-number">096</span></span> <span class="hljs-type"><span class="hljs-type">Allow</span></span> inbound <span class="hljs-type"><span class="hljs-type">SSH</span></span>: dport: <span class="hljs-comment"><span class="hljs-comment">"%{lookup('my_ssh_port')}"</span></span> proto: tcp action: accept #-------------------------------------|<span class="hljs-type"><span class="hljs-type">FAIL2BAN</span></span>|--------------------------# #-------------------------------------|<span class="hljs-type"><span class="hljs-type">ACCESS</span></span>|----------------------------# #--------------------------------------------|<span class="hljs-type"><span class="hljs-type">ACCOUNTS</span></span>|-------------------# #---//<span class="hljs-type"><span class="hljs-type">Discription</span></span> of accounts which will be created on server.//----------# accounts: user: shell: <span class="hljs-string"><span class="hljs-string">'/bin/bash'</span></span> password: <span class="hljs-string"><span class="hljs-string">''</span></span> locked: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> purge_sshkeys: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> groups: - docker sshkeys: - <span class="hljs-comment"><span class="hljs-comment">"%{alias('admins_ssh_keys')}"</span></span> #--------------------------------------------|<span class="hljs-type"><span class="hljs-type">SUDO</span></span>|-----------------------# #---//<span class="hljs-type"><span class="hljs-type">Appointment</span></span> permissions for users.//--------------------------------# sudo::config_file_replace: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> sudo::configs: user: content: <span class="hljs-comment"><span class="hljs-comment">"user ALL=(ALL) NOPASSWD: ALL"</span></span> #--------------------------------------------|<span class="hljs-type"><span class="hljs-type">SSH</span></span>|------------------------# #--------//<span class="hljs-type"><span class="hljs-type">Settings</span></span> for ssh server.//-------------------------------------# ssh::storeconfigs_enabled: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ssh::server_options: <span class="hljs-type"><span class="hljs-type">Protocol</span></span>: <span class="hljs-string"><span class="hljs-string">'2'</span></span> <span class="hljs-type"><span class="hljs-type">Port</span></span>: <span class="hljs-comment"><span class="hljs-comment">"%{lookup('my_ssh_port')}"</span></span> <span class="hljs-type"><span class="hljs-type">PasswordAuthentication</span></span>: <span class="hljs-string"><span class="hljs-string">'yes'</span></span> <span class="hljs-type"><span class="hljs-type">PermitRootLogin</span></span>: <span class="hljs-string"><span class="hljs-string">'without-password'</span></span> <span class="hljs-type"><span class="hljs-type">SyslogFacility</span></span>: <span class="hljs-string"><span class="hljs-string">'AUTHPRIV'</span></span> <span class="hljs-type"><span class="hljs-type">UsePAM</span></span>: <span class="hljs-string"><span class="hljs-string">'yes'</span></span> <span class="hljs-type"><span class="hljs-type">X11Forwarding</span></span>: <span class="hljs-string"><span class="hljs-string">'no'</span></span> #--------------------------------------------|<span class="hljs-type"><span class="hljs-type">VPN</span></span>|------------------------# #---//<span class="hljs-type"><span class="hljs-type">Settings</span></span> for vpn server.//------------------------------------------# openvpn::servers: <span class="hljs-string"><span class="hljs-string">'namehost'</span></span>: country: <span class="hljs-string"><span class="hljs-string">''</span></span> province: <span class="hljs-string"><span class="hljs-string">''</span></span> city: <span class="hljs-string"><span class="hljs-string">''</span></span> organization: <span class="hljs-string"><span class="hljs-string">''</span></span> email: <span class="hljs-string"><span class="hljs-string">''</span></span> server: <span class="hljs-string"><span class="hljs-string">'xxxx 255.255.255.0'</span></span> dev: tun local: <span class="hljs-comment"><span class="hljs-comment">"%{lookup('host_address')}"</span></span> openvpn::client_defaults: server: <span class="hljs-string"><span class="hljs-string">'namehost'</span></span> openvpn::clients: # <span class="hljs-type"><span class="hljs-type">Firstname</span></span> <span class="hljs-type"><span class="hljs-type">Lastname</span></span> <span class="hljs-string"><span class="hljs-string">'user'</span></span>: {} openvpn::client_specific_configs: <span class="hljs-string"><span class="hljs-string">'user'</span></span>: server: <span class="hljs-string"><span class="hljs-string">'namehost'</span></span> redirect_gateway: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> route: - xxxx <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span> #=========================================================================# #============================|<span class="hljs-type"><span class="hljs-type">OPERATING</span></span> <span class="hljs-type"><span class="hljs-type">SYSTEM</span></span>|===========================# #---------------------------------------------|<span class="hljs-type"><span class="hljs-type">SYSCTL</span></span>|--------------------# #---//set sysctl parameters//---------------------------------------------# sysctl::base::values: fs.file-max: value: <span class="hljs-string"><span class="hljs-string">'2097152000'</span></span> net.netfilter.nf_conntrack_max: value: <span class="hljs-string"><span class="hljs-string">'1048576'</span></span> net.nf_conntrack_max: value: <span class="hljs-string"><span class="hljs-string">'1048576'</span></span> net.ipv6.conf.all.disable_ipv6: value: <span class="hljs-string"><span class="hljs-string">'1'</span></span> vm.oom_kill_allocating_task: value: <span class="hljs-string"><span class="hljs-string">'1'</span></span> net.ipv4.ip_forward: value: <span class="hljs-string"><span class="hljs-string">'0'</span></span> net.ipv4.tcp_keepalive_time: value: <span class="hljs-string"><span class="hljs-string">'3'</span></span> net.ipv4.tcp_keepalive_intvl: value: <span class="hljs-string"><span class="hljs-string">'60'</span></span> net.ipv4.tcp_keepalive_probes: value: <span class="hljs-string"><span class="hljs-string">'9'</span></span> #---------------------------------------------|<span class="hljs-type"><span class="hljs-type">RCS</span></span>|-----------------------# #---//<span class="hljs-type"><span class="hljs-type">Managment</span></span> of <span class="hljs-type"><span class="hljs-type">RC</span></span> scenario//------------------------------------------# rcs::tmptime: <span class="hljs-string"><span class="hljs-string">'-1'</span></span> #---------------------------------------------|<span class="hljs-type"><span class="hljs-type">WEB</span></span> <span class="hljs-type"><span class="hljs-type">SERVERS</span></span>|---------------# #---------------------------------------------------------|<span class="hljs-type"><span class="hljs-type">HAPROXY</span></span>|-------# #---//<span class="hljs-type"><span class="hljs-type">HAProxy</span></span> is software that provides a high availability load//--------# #---//balancer and proxy server for <span class="hljs-type"><span class="hljs-type">TCP</span></span> and <span class="hljs-type"><span class="hljs-type">HTTP</span></span>-based applications//-----# #---// that spreads requests across multiple servers.//-------------------# haproxy::merge_options: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> haproxy::defaults_options: log: global maxconn: <span class="hljs-number"><span class="hljs-number">20000</span></span> option: [ <span class="hljs-string"><span class="hljs-string">'tcplog'</span></span>, <span class="hljs-string"><span class="hljs-string">'redispatch'</span></span>, <span class="hljs-string"><span class="hljs-string">'dontlognull'</span></span> ] retries: <span class="hljs-number"><span class="hljs-number">3</span></span> stats: enable timeout: [ <span class="hljs-string"><span class="hljs-string">'http-request 10s'</span></span>, <span class="hljs-string"><span class="hljs-string">'queue 1m'</span></span>, <span class="hljs-string"><span class="hljs-string">'check 10s'</span></span>, <span class="hljs-string"><span class="hljs-string">'connect 300000000ms'</span></span>, <span class="hljs-string"><span class="hljs-string">'client 300000000ms'</span></span>, <span class="hljs-string"><span class="hljs-string">'server 300000000ms'</span></span> ] haproxy_server: stats: ipaddress: <span class="hljs-comment"><span class="hljs-comment">"%{lookup('host_address')}"</span></span> ports: <span class="hljs-string"><span class="hljs-string">'9090'</span></span> options: mode: <span class="hljs-string"><span class="hljs-string">'http'</span></span> stats: [ <span class="hljs-string"><span class="hljs-string">'uri /'</span></span>, <span class="hljs-string"><span class="hljs-string">'auth puppet:123123123'</span></span> ] postgres: collect_exported: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> ipaddress: <span class="hljs-string"><span class="hljs-string">'0.0.0.0'</span></span> ports: <span class="hljs-string"><span class="hljs-string">'5432'</span></span> options: option: - tcplog balance: roundrobin haproxy_balancemember: hostname1: listening_service: postgres server_names: hostname1 ipaddresses: <span class="hljs-comment"><span class="hljs-comment">"%{lookup('host1_ip')}"</span></span> ports: <span class="hljs-number"><span class="hljs-number">6432</span></span> options: check hostname2: listening_service: postgres server_names: hostname2 ipaddresses: <span class="hljs-comment"><span class="hljs-comment">"%{lookup('host2_ip')}"</span></span> ports: <span class="hljs-number"><span class="hljs-number">6432</span></span> options: - check - backup #---------------------------------------------|<span class="hljs-type"><span class="hljs-type">NGINX</span></span>|---------------------# #---//<span class="hljs-type"><span class="hljs-type">Nginx</span></span> is a web server which can also be used as a reverse proxy,//--# #---//load balancer, mail proxy and <span class="hljs-type"><span class="hljs-type">HTTP</span></span> cache//--------------------------# nginx::nginx_cfg_prepend: <span class="hljs-string"><span class="hljs-string">'load_module'</span></span>: - modules/ngx_http_geoip_module.so nginx::http_raw_append: - <span class="hljs-string"><span class="hljs-string">'real_ip_header X-Forwarded-For;'</span></span> - <span class="hljs-string"><span class="hljs-string">'geoip_country /usr/share/GeoIP/GeoIP.dat;'</span></span> - <span class="hljs-string"><span class="hljs-string">'set_real_ip_from 0.0.0.0/0;'</span></span> nginx::worker_rlimit_nofile: <span class="hljs-number"><span class="hljs-number">16384</span></span> nginx::confd: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> nginx::server_purrge: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> nginx::server::maintenance: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> #---------------------------------------------nginx-|<span class="hljs-type"><span class="hljs-type">MAPS</span></span>|----------------# nginx::string_mappings: allowed_country: ensure: present string: <span class="hljs-string"><span class="hljs-string">'$geoip_country_code'</span></span> mappings: - key: <span class="hljs-string"><span class="hljs-string">'default'</span></span> value: <span class="hljs-string"><span class="hljs-string">'yes'</span></span> - key: <span class="hljs-string"><span class="hljs-string">'US'</span></span> value: <span class="hljs-string"><span class="hljs-string">'no'</span></span> #---------------------------------------------nginx-|<span class="hljs-type"><span class="hljs-type">UPSTREAMS</span></span>|-----------# nginx::nginx_upstreams: <span class="hljs-comment"><span class="hljs-comment">"upstreamName"</span></span>: ensure: present members: - <span class="hljs-comment"><span class="hljs-comment">"localhost:9999"</span></span> #---------------------------------------------nginx-|<span class="hljs-type"><span class="hljs-type">VHOSTS</span></span>|--------------# nginx::nginx_servers: <span class="hljs-string"><span class="hljs-string">'hostname'</span></span>: proxy: <span class="hljs-string"><span class="hljs-string">'http://'</span></span> location_raw_append: - <span class="hljs-string"><span class="hljs-string">'if ($allowed_country = no) {return 403;}'</span></span> try_files: - <span class="hljs-string"><span class="hljs-string">''</span></span> - /index.html - =<span class="hljs-number"><span class="hljs-number">404</span></span> ssl: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ssl_cert: <span class="hljs-comment"><span class="hljs-comment">"/etc/letsencrypt/live/hostname/fullchain.pem"</span></span> ssl_key: <span class="hljs-comment"><span class="hljs-comment">"/etc/letsencrypt/live/hostname/privkey.pem"</span></span> ssl_trusted_cert: <span class="hljs-comment"><span class="hljs-comment">"/etc/letsencrypt/live/hostname/chain.pem"</span></span> ssl_redirect: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> ssl_port: <span class="hljs-number"><span class="hljs-number">443</span></span> error_pages: <span class="hljs-string"><span class="hljs-string">'403'</span></span>: /usa-restrict.html #---------------------------------------------nginx-|<span class="hljs-type"><span class="hljs-type">HTTPAUTH</span></span>|------------# httpauth: <span class="hljs-string"><span class="hljs-string">'admin'</span></span>: file: <span class="hljs-comment"><span class="hljs-comment">"/etc/nginx/htaccess"</span></span> password: <span class="hljs-string"><span class="hljs-string">''</span></span> realm: realm mechanism: basic ensure: present #---------------------------------------------nginx-|<span class="hljs-type"><span class="hljs-type">LOCATIONS</span></span>|-----------# nginx::nginx_locations: <span class="hljs-string"><span class="hljs-string">'domain1.com/usa-restricted'</span></span>: location: /usa-restrict.html www_root: /home/clientName1/clientName1-client-release/current/dist server: domain1.com ssl: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> <span class="hljs-string"><span class="hljs-string">'^~ domain2.com/resources/upload/'</span></span>: location: <span class="hljs-string"><span class="hljs-string">'^~ /resources/upload/'</span></span> server: domain2.com location_alias: <span class="hljs-string"><span class="hljs-string">'/home/clientName2/upload/'</span></span> raw_append: - <span class="hljs-string"><span class="hljs-string">'if ($allowed_country = no) {return 403;}'</span></span> <span class="hljs-string"><span class="hljs-string">'/nginx_status-domain3.com'</span></span>: location: /nginx_status stub_status: on raw_append: - access_log off; - allow <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>; - deny all; #---------------------------------------------nginx-|<span class="hljs-type"><span class="hljs-type">WELL</span></span>-<span class="hljs-type"><span class="hljs-type">KNOWN</span></span>|----------# #---//<span class="hljs-type"><span class="hljs-type">These</span></span> locations are needed for <span class="hljs-type"><span class="hljs-type">SSL</span></span> certificates generating//--------# #---//with <span class="hljs-type"><span class="hljs-type">Letsencrypt</span></span>.//-------------------------------------------------# <span class="hljs-string"><span class="hljs-string">'x.hostname.zz/.well-known'</span></span>: location: <span class="hljs-string"><span class="hljs-string">'/.well-known'</span></span> server: x.hostname.zz proxy: <span class="hljs-string"><span class="hljs-string">'http://kibana'</span></span> auth_basic: <span class="hljs-comment"><span class="hljs-comment">"ciao"</span></span> auth_basic_user_file: <span class="hljs-comment"><span class="hljs-comment">"/etc/nginx/htaccess www_root: /var/www/html ssl: true 'hostname.zz/~* \.(?:ico|css|js|html|map|gif|jpg|png|svg|ttf|woff|appcache|pdf)$': location: '~* \.(?:ico|css|js|html|map|gif|jpg|png|svg|ttf|woff|appcache|pdf)$' www_root: '/home/hostname/hostname-client-release/current/dist' expires: max raw_append: - "</span></span>add_header <span class="hljs-type"><span class="hljs-type">Pragma</span></span> public;<span class="hljs-comment"><span class="hljs-comment">" - 'add_header Cache-Control "</span></span>public, must-revalidate, proxy-revalidate<span class="hljs-comment"><span class="hljs-comment">";' #---------------------------------------------------|NGINS STATUS|--------# #----------------------------|LETSENCRYPT|--------------------------------# #---//Let's Encrypt is a certificate authority that provides #---//free X.509 certificates for Transport Layer Security (TLS)//--------# #---//encryption via an automated process designed to eliminate//---------# #---//the hitherto complex process of manual creation, validation,//------# #---//signing, installation, and renewal of certificates//----------------# #---//for secure websites.//----------------------------------------------# letsencrypt::email: client@mail.com letsencrypt_certonly: hostname: manage_cron: true domains: - hostname plugin: webroot webroot_paths: - '/var/www/html' #----------------------------|FILE SERVERS|-------------------------------# #-----------------------------------------|FILES|-------------------------# #---//Creating files &amp; folders on the server.//---------------------------# file: "</span></span>/home/hostname/hostname-release/shared/ecosystem.config.js<span class="hljs-comment"><span class="hljs-comment">": ensure: present owner: hostname content: | module.exports = { /** * Application configuration section * http://pm2.keymetrics.io/docs/usage/application-declaration/ */ apps : [ // First application { name : 'api', script : '/home/hostname/hostname-release/current/dist/index.js', cwd : '/home/hostname/hostname-release/current/dist/', watch : false, ignore_watch : ["</span></span>logs<span class="hljs-comment"><span class="hljs-comment">"], "</span></span>log_type<span class="hljs-comment"><span class="hljs-comment">": "</span></span>format<span class="hljs-comment"><span class="hljs-comment">", env: { COMMON_VARIABLE: 'true' }, env_production : { NODE_ENV: 'production', PORT: 9999, DEBUG : '*' }, env_development : { NODE_ENV: 'development', PORT: 9999, DEBUG : '*' } }, // Second application { name : 'WEB', script : 'web.js' } ], /** * Deployment section * http://pm2.keymetrics.io/docs/usage/deployment/ */ deploy : { production : { user : 'node', host : '0.0.0.0', ref : 'origin/master', repo : 'name@name.com:repo.git', path : '/var/www/production', 'post-deploy' : 'npm install &amp;&amp; pm2 reload ecosystem.config.js --env production' }, dev : { user : 'node', host : '0.0.0.0', ref : 'origin/master', repo : 'name@name.com:repo.git', path : '/var/www/development', 'post-deploy' : 'npm install &amp;&amp; pm2 reload ecosystem.config.js --env dev', env : { NODE_ENV: 'dev' } } } }; #-----------------------------------------|FTP|----------------------------# #---//Very Secure FTP Daemon is an FTP server for Unix-like systems.//-----# vsftpd::ftpd_banner: 'ASCII FTP Server' vsftpd::anonymous_enable: 'NO' vsftpd::write_enable: 'YES' vsftpd::chroot_local_user: 'YES' vsftpd::allow_writeable_chroot: 'YES' vsftpd::userlist_enable: 'YES' vsftpd::userlist_deny: 'NO' #-----------------------------------------|NFS|---------------------------# #---//Network File System is a distributed file system protocol,//--------# #---//allowing a user on a client computer to access files over//---------# #---//a computer network much like local storage is accessed.//-----------# nfs::server_enabled: true nfs::client_enabled : false nfs::nfs_v4: true nfs::nfs_v4_idmap_domain: "</span></span>%{::domain}<span class="hljs-comment"><span class="hljs-comment">" nfs::nfs_v4_export_root: '/share' nfs::nfs_v4_export_root_clients: "</span></span>%{lookup(<span class="hljs-string"><span class="hljs-string">'host_address'</span></span>)}/<span class="hljs-number"><span class="hljs-number">32</span></span>(rw,fsid=root,insecure,no_subtree_check,async,no_root_squash)<span class="hljs-comment"><span class="hljs-comment">" nfs::nfs_exports_global: /var/www: {} /var/smb: {} #----------------------------|PACKAGES|-----------------------------------# #---//Install of packages to server.//------------------------------------# packages: namePackage: ensure: installed #-------------------------------------|APT|-------------------------------# #---//Management of repository of packages.//---# apt::sources: 'debian_unstable': comment: 'This is the iWeb Debian unstable mirror' location: 'http://debian.mirror.iweb.ca/debian/' release: 'unstable' repos: 'main contrib non-free' pin: '-10' key: id: 'IDIDIDIDIDIDIDIDIDIDIDIDIDIDIDID' server: 'subkeys.pgp.net' include: src: true deb: true 'puppetlabs': location: 'http://apt.puppetlabs.com' repos: 'main' key: id: 'IDIDIDIDIDIDIDIDIDIDIDIDIDIDIDID' server: 'pgp.mit.edu' #-------------------------------------|PHP|-------------------------------# php_pool: myadmin: listen: 'xxxx:x' #-------------------------------------|RVM|-------------------------------# #---//Ruby Version Manager is a unix-like software platform designed//---# #---//to manage multiple installations of Ruby on the same device.//------# rvm_ruby: user1_rvm: user: user1 version: ruby-2.5.1 white_label_platform: default #-------------------------------------|PYTHON|----------------------------# python::version: system python::dev: present python::virtualenv: true #----------------------------|NODEJS|-------------------------------------# #-----------------------------------|NVM|---------------------------------# #---//Node Version Manager for Node.js//----------------------------------# #---//Node.js lets developers use JavaScript to write Command Line//------# #---//tools and for server-side scripting—running scripts server-side//---# #---//to produce dynamic web page content before the page is sent//-------# #---//to the user's web browser.//----------------------------------------# nodejs::repo_url_suffix: '8.x' nvm::user: name nvm::install_node: 8.10.0 #----------------------------|DOCKER|-------------------------------------# #---//Docker's management//-----------------------------------------------# docker::run_instance::instance: nats: image: 'nats' extra_parameters: '-p 8222:8222 -p 4222:4222 -p 6222:6222 --name nats --network admin_default' docker::compose::ensure: present docker_compose: /etc/admin/gitlab/docker-compose.yaml: ensure: present docker::iptables: false docker::tcp_bind: tcp://0.0.0.0:2375 docker::compose::ensure: present docker_swarm: 'agent': ensure: present join: true advertise_addr: '%{::ipaddress_enp2s0}' listen_addr: '%{::ipaddress_enp2s0}' manager_ip: '%{lookup("</span></span>host_address<span class="hljs-comment"><span class="hljs-comment">")}' token: '' docker_registry: 'host.com:5000': username: '' password: '' email: 'mail@mail.com' #=========================================================================# #============================|BACKUPS UPDATES|============================# #--------------------------------------------|UPDATES|--------------------# #---//Unattended upgrades is the linux-like mechanism//-------------------# #---//automatic updates.//------------------------------------------------# unattended_upgrades::origins: - "</span></span>o=<span class="hljs-type"><span class="hljs-type">Debian</span></span>,n=<span class="hljs-string"><span class="hljs-string">${</span></span>distro_codename}<span class="hljs-comment"><span class="hljs-comment">" - "</span></span>o=<span class="hljs-type"><span class="hljs-type">Debian</span></span>,n=<span class="hljs-string"><span class="hljs-string">${</span></span>distro_codename}-security<span class="hljs-comment"><span class="hljs-comment">" - "</span></span>o=<span class="hljs-type"><span class="hljs-type">Debian</span></span>,n=<span class="hljs-string"><span class="hljs-string">${</span></span>distro_codename}-updates<span class="hljs-comment"><span class="hljs-comment">" - "</span></span>o=<span class="hljs-type"><span class="hljs-type">Debian</span></span>,n=<span class="hljs-string"><span class="hljs-string">${</span></span>distro_codename}-proposed<span class="hljs-comment"><span class="hljs-comment">" - "</span></span>o=<span class="hljs-type"><span class="hljs-type">Debian</span></span>,n=<span class="hljs-string"><span class="hljs-string">${</span></span>distro_codename}-backports<span class="hljs-comment"><span class="hljs-comment">" - "</span></span>o=debian icinga,n=icinga-<span class="hljs-string"><span class="hljs-string">${</span></span>distro_codename}<span class="hljs-comment"><span class="hljs-comment">" - "</span></span>o=<span class="hljs-type"><span class="hljs-type">Zabbix</span></span>,n=<span class="hljs-string"><span class="hljs-string">${</span></span>distro_codename}<span class="hljs-comment"><span class="hljs-comment">" #--------------------------------------------|BACKUPS|--------------------# #---//The backups are processed by gembackup.//---------------------------# backup_jobs: #Creates full backup type_files: types: ['archive'] add: - '/path' storage_type: 'ftp' storage_host: "</span></span>%{lookup(<span class="hljs-string"><span class="hljs-string">'my_ftp_hostname'</span></span>)}<span class="hljs-comment"><span class="hljs-comment">" path: '/files/' storage_username: "</span></span>%{lookup(<span class="hljs-string"><span class="hljs-string">'my_backup_ftp_username'</span></span>)}<span class="hljs-comment"><span class="hljs-comment">" storage_password: "</span></span>%{lookup(<span class="hljs-string"><span class="hljs-string">'my_backup_ftp_password'</span></span>)}<span class="hljs-comment"><span class="hljs-comment">" compressor: "</span></span>%{lookup(<span class="hljs-string"><span class="hljs-string">'my_backup_compressor'</span></span>)}<span class="hljs-comment"><span class="hljs-comment">" keep: 7 weekday: [1-7] hour: 0 minute: 0 #--------------------------------------------|MOUNT|----------------------# #---//ontrol the mounting of remote &amp; local mount points.//--------------# mount: #Mount folder from other server to keep backups "</span></span>/tmp/mediastagetv_netbynet<span class="hljs-comment"><span class="hljs-comment">": device: "</span></span>%{lookup(<span class="hljs-string"><span class="hljs-string">'host_address'</span></span>)}:/<span class="hljs-comment"><span class="hljs-comment">" ensure: mounted fstype: nfs4 options: defaults atboot: false #--------------------------------------------|S3 AMAZON|------------------# #---//Simple Storage Service is a cloud computing web service.//----------# hostname1-archives: '/home/hostname1/hostname1/shared/log_amazon' hostname2-archives: '/home/hostname2/hostname2/shared/log_amazon' yas3fs::mounts: #=========================================================================# #============================|MONITORING|=================================# #---------------------------------------|ICINGA SERVICES|-----------------# #---//Managment of monitoring system.//-----------------------------------# icinga2_service: '%{::fqdn} virtual host' : target: /etc/icinga2/zones.d/master/%{::fqdn}.conf apply: true assign: [ 'host.name == %{::fqdn}' ] display_name: '%{::fqdn} virtualhost' check_command: 'http' vars: http_uri: / http_ssl: true http_vhost: 'hostname' http_address: "</span></span>%{lookup(<span class="hljs-string"><span class="hljs-string">'host_address'</span></span>)}<span class="hljs-comment"><span class="hljs-comment">" '%{::fqdn} nginx status' : target: /etc/icinga2/zones.d/master/%{::fqdn}.conf apply: true assign: [ 'host.name == %{::fqdn}' ] command_endpoint: '%{::fqdn}' display_name: 'nginx status' check_command: 'nginx_status' vars: nginx_status_host_address: localhost nginx_status_servername: server.com nginx_status_critical: '1600,60,30' nginx_status_warn: '1500,55,25' '%{::fqdn} redis': target: /etc/icinga2/zones.d/master/%{::fqdn}.conf apply: true assign: [ 'host.name == %{::fqdn}' ] display_name: 'Redis' command_endpoint: '%{::fqdn}' check_command: "</span></span>redis<span class="hljs-comment"><span class="hljs-comment">" vars: redis_hostname: localhost redis_port: 6379 redis_perfvars: '*' #=========================================================================# #============================|MAIL &amp; LOGS|================================# #----------------------------------------|MAIL|---------------------------# #---------------------------------------------|POSTFIX|-------------------# #---//Management of mail-server Postfix.//--------------------------------# postfix::manage_conffiles: false postfix_config: relayhost: ensure: present value: "</span></span>%{lookup(<span class="hljs-string"><span class="hljs-string">'host_address'</span></span>)}<span class="hljs-comment"><span class="hljs-comment">" virtual_maps: value: hash:/etc/postfix/virtual ensure: present sender_canonical_map: value: hash:/etc/postfix/canonical_sender ensure: present postfix_hash: '/etc/postfix/virtual': ensure: present content: | root %{lookup('hostname_admin_emails')} rails %{lookup('hostname_emails')} '/etc/postfix/canonical_sender': ensure: present content: | name@%{lookup('my_domain')} name@my_domain.com root@%{lookup('my_domain')} root@my_domain.com #----------------------------------------|LOGS|---------------------------# #---------------------------------------------|RSYSLOG|-------------------# #---//Rsyslog is a software utility for forwarding log messages//---------# #---//in an IP network. It implements the basic syslog protocol,//--------# #---//extends it with content-based filtering, rich filtering//-----------# #---//capabilities, flexible configuration options and adds features//----# #---//such as using TCP for transport.//----------------------------------# rsyslog::client: log_local: true my_rsyslog_snippet: 99_everything: content: "</span></span>*.*;auth,authpriv.none /var/log/syslog\n<span class="hljs-comment"><span class="hljs-comment">" 01_mail: content: "</span></span>mail.* -/var/log/mail.log\n&amp; stop<span class="hljs-comment"><span class="hljs-comment">" 02_auth: content: "</span></span>auth,authpriv.* /var/log/auth\n&amp; stop<span class="hljs-comment"><span class="hljs-comment">" 03_puppetagent: content: "</span></span>:programname,contains,\<span class="hljs-comment"><span class="hljs-comment">"puppet-agent\"</span></span> /var/log/puppetlabs/puppet/puppet-agent.log\n&amp; stop<span class="hljs-comment"><span class="hljs-comment">" 04_iptables: content: "</span></span>:msg,contains,\<span class="hljs-comment"><span class="hljs-comment">"IPTABLES INPUT\"</span></span> /var/log/iptables/iptables.log\n&amp; stop<span class="hljs-comment"><span class="hljs-comment">" 05_pam_unix: content: "</span></span>:msg,regex,\<span class="hljs-comment"><span class="hljs-comment">".*session opened for.*(uid=0)\"</span></span> /var/log/admin/auth.log\n&amp; stop<span class="hljs-comment"><span class="hljs-comment">" 06_sshd: content: "</span></span>:msg,regex,\<span class="hljs-comment"><span class="hljs-comment">".*publickey for username.*0.0.0.0\"</span></span> /var/log/admin/auth.log\n&amp; stop #---------------------------------------------|<span class="hljs-type"><span class="hljs-type">LOGWATCH</span></span>|------------------# #---//<span class="hljs-type"><span class="hljs-type">Logwatch</span></span> is a log-analysator for create short reports.//------------# logwatch::format: text logwatch::service: # <span class="hljs-type"><span class="hljs-type">Ignore</span></span> this servie - -http - -iptables #---------------------------------------------|<span class="hljs-type"><span class="hljs-type">LOGROTATE</span></span>|-----------------# #---//<span class="hljs-type"><span class="hljs-type">Management</span></span> of rotation of log files.//------------------------------# my_rclogs_path: <span class="hljs-string"><span class="hljs-string">'/home/hostname/hostname/shared/log'</span></span> my_rclogs_amazon_path: <span class="hljs-string"><span class="hljs-string">'/home/hostname1/hostname1/shared/log_amazon'</span></span> my_ttlogs_path: <span class="hljs-string"><span class="hljs-string">'/home/hostname2/hostname2/shared/log'</span></span> my_ttlogs_amazon_path: <span class="hljs-string"><span class="hljs-string">'/home/hostname/hostname/shared/log_amazon'</span></span> logrotate::ensure: latest logrotate::config: dateext: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> compress: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> logrotate::rules: booking-logs: path: <span class="hljs-string"><span class="hljs-string">'%{lookup("my_rclogs_path")}/booking_com.log'</span></span> size: <span class="hljs-number"><span class="hljs-number">2500</span></span>M rotate: <span class="hljs-number"><span class="hljs-number">20</span></span> copytruncate: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> delaycompress: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> dateext: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> dateformat: -%<span class="hljs-type"><span class="hljs-type">Y</span></span>%m%d-%s compress: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> postrotate: mv %{lookup(<span class="hljs-string"><span class="hljs-string">'my_rclogs_path'</span></span>)}/booking_com.log*.gz %{lookup(<span class="hljs-string"><span class="hljs-string">'my_rclogs_amazon_path'</span></span>)}/ #---------------------------------------------|<span class="hljs-type"><span class="hljs-type">ATOP</span></span>|----------------------# #---//<span class="hljs-type"><span class="hljs-type">ATOP</span></span> service displays a new information about <span class="hljs-type"><span class="hljs-type">CPU</span></span>//-----------------# #---//and memory utilization.//-------------------------------------------# atop::service: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> atop::interval: <span class="hljs-number"><span class="hljs-number">30</span></span> #----------------------------------------|<span class="hljs-type"><span class="hljs-type">DNS</span></span>|----------------------------# #---//<span class="hljs-type"><span class="hljs-type">Management</span></span> of file /etc/resolv.conf//-------------------------------# resolv_conf::nameservers: - <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> - <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> #=========================================================================# #============================|<span class="hljs-type"><span class="hljs-type">DATABASES</span></span>|==================================# #--------------------------------------|<span class="hljs-type"><span class="hljs-type">MYSQL</span></span>|----------------------------# #---//<span class="hljs-type"><span class="hljs-type">MySQL</span></span> is a relational database management system.//-----------------# mysql::server::package_ensure: <span class="hljs-string"><span class="hljs-string">'installed'</span></span> #· mysql::server::root_password: <span class="hljs-comment"><span class="hljs-comment">"ooy5ieneePahnei"</span></span> mysql::server::manage_config_file: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> mysql::server::service_name: <span class="hljs-string"><span class="hljs-string">'mysql'</span></span> # required for puppet module mysql::server::override_options: <span class="hljs-string"><span class="hljs-string">'mysqld'</span></span>: <span class="hljs-string"><span class="hljs-string">'bind-address'</span></span>: <span class="hljs-string"><span class="hljs-string">'*'</span></span> <span class="hljs-comment"><span class="hljs-comment">"userName"</span></span>: <span class="hljs-comment"><span class="hljs-comment">""</span></span>, <span class="hljs-comment"><span class="hljs-comment">"password"</span></span>: <span class="hljs-comment"><span class="hljs-comment">""</span></span>, <span class="hljs-comment"><span class="hljs-comment">"databaseName"</span></span>: <span class="hljs-comment"><span class="hljs-comment">""</span></span>, mysql::server::db: <span class="hljs-comment"><span class="hljs-comment">"hostname"</span></span>: user: <span class="hljs-comment"><span class="hljs-comment">""</span></span> password: <span class="hljs-comment"><span class="hljs-comment">""</span></span> host: <span class="hljs-comment"><span class="hljs-comment">"%"</span></span> grant: - <span class="hljs-comment"><span class="hljs-comment">"ALL"</span></span> #-------------------------------------|<span class="hljs-type"><span class="hljs-type">ELASTICSEARCH</span></span>|---------------------# #---//<span class="hljs-type"><span class="hljs-type">Elasticsearch</span></span> is a search engine based on <span class="hljs-type"><span class="hljs-type">Lucene</span></span>.//-----------------# #---//<span class="hljs-type"><span class="hljs-type">It</span></span> provides a distributed, multitenant-capable full-text search//---# #---//engine with an <span class="hljs-type"><span class="hljs-type">HTTP</span></span> web interface and schema-free <span class="hljs-type"><span class="hljs-type">JSON</span></span> documents.//-# elasticsearch::version: <span class="hljs-number"><span class="hljs-number">5.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> elasticsearch::manage_repo: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> elasticsearch::repo_version: <span class="hljs-number"><span class="hljs-number">5.</span></span>x elasticsearch::java_install: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> elasticsearch::restart_on_change: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> elasticsearch_instance: <span class="hljs-string"><span class="hljs-string">'es-01'</span></span>: ensure: <span class="hljs-string"><span class="hljs-string">'present'</span></span> #-------------------------------------|<span class="hljs-type"><span class="hljs-type">REDIS</span></span>|-----------------------------# #---//<span class="hljs-type"><span class="hljs-type">Redis</span></span> is an in-memory database project implementing//---------------# #---//a distributed, in-memory key-value store with//---------------------# #---//optional durability.//----------------------------------------------# redis::bind: <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> #-------------------------------------|<span class="hljs-type"><span class="hljs-type">ZOOKEPER</span></span>|--------------------------# #---//<span class="hljs-type"><span class="hljs-type">Zooker</span></span> is a centralized service for distributed systems//-----------# #---//to a hierarchical key-value store, which is used to provide//-------# #---//a distributed configuration service, synchronization service,//-----# #---//and naming registry for large distributed systems.//----------------# zookeeper::init_limit: <span class="hljs-string"><span class="hljs-string">'1000'</span></span> zookeeper::id: <span class="hljs-string"><span class="hljs-string">'1'</span></span> zookeeper::purge_interval: <span class="hljs-string"><span class="hljs-string">'1'</span></span> zookeeper::servers: - <span class="hljs-comment"><span class="hljs-comment">"%{lookup('host')}"</span></span> #-------------------------------------|<span class="hljs-type"><span class="hljs-type">POSTGRES</span></span>|--------------------------# #---//<span class="hljs-type"><span class="hljs-type">Postgres</span></span>, is an object-relational database management system//------# #---//with an emphasis on extensibility and standards compliance.//-------# #---//<span class="hljs-type"><span class="hljs-type">As</span></span> a database server, its primary functions are to store data//----# #---//securely and return that data in response to requests from other//--# #---//software applications.//--------------------------------------------# postgresql::server::postgres_password: postgresql::server::ip_mask_allow_all_users: <span class="hljs-string"><span class="hljs-string">'0.0.0.0/0'</span></span> postgresql::postgresql::server: ip_mask_allow_all_users: <span class="hljs-string"><span class="hljs-string">'0.0.0.0/32'</span></span> postgres_db: master: user: password: confluence: user: password: postgres_config: <span class="hljs-string"><span class="hljs-string">'max_connections'</span></span>: value: <span class="hljs-number"><span class="hljs-number">300</span></span> postgres_hba: <span class="hljs-string"><span class="hljs-string">'Allow locals without password'</span></span>: order: <span class="hljs-number"><span class="hljs-number">1</span></span> description: <span class="hljs-string"><span class="hljs-string">'locals postgres no password'</span></span> type: <span class="hljs-string"><span class="hljs-string">'host'</span></span> address: <span class="hljs-string"><span class="hljs-string">'127.0.0.1/32'</span></span> database: <span class="hljs-string"><span class="hljs-string">'all'</span></span> user: <span class="hljs-string"><span class="hljs-string">'all'</span></span> auth_method: <span class="hljs-string"><span class="hljs-string">'trust'</span></span> #----------------------------------------------|<span class="hljs-type"><span class="hljs-type">PGBOUNCER</span></span>|----------------# #---//<span class="hljs-type"><span class="hljs-type">PgBouncer</span></span> is a connection pooler for <span class="hljs-type"><span class="hljs-type">PostgreSQL</span></span>//-------------------# pgbouncer::group: postgres pgbouncer::user: postgres pgbouncer::userlist: - user: password: pgbouncer::databases: - source_db: recommender host: <span class="hljs-comment"><span class="hljs-comment">"%{lookup('')}"</span></span> dest_db: recommender auth_user: recommender pool_size: <span class="hljs-number"><span class="hljs-number">200</span></span> auth_pass: - source_db: master host: <span class="hljs-comment"><span class="hljs-comment">"%{lookup('')}"</span></span> dest_db: recommender auth_user: recommender pool_size: <span class="hljs-number"><span class="hljs-number">50</span></span> auth_pass: - source_db: slave host: <span class="hljs-comment"><span class="hljs-comment">"%{lookup('')}"</span></span> dest_db: recommender auth_user: recommender pool_size: <span class="hljs-number"><span class="hljs-number">200</span></span> auth_pass: #=========================================================================# #==============================|<span class="hljs-type"><span class="hljs-type">APPLICATION</span></span> <span class="hljs-type"><span class="hljs-type">SERVICES</span></span>|=====================# #---------------------------------------------------|<span class="hljs-type"><span class="hljs-type">CONFLUENCE</span></span>|----------# #---------------------------------------------------|<span class="hljs-type"><span class="hljs-type">JENKINS</span></span>|-------------# #=========================================================================#</code> </pre><br></div></div><br><br><h3>  Contoh bagian pemantauan: </h3><br><pre> <code class="hljs smalltalk">#============================|<span class="hljs-type"><span class="hljs-type">MONITORING</span></span>|=================================# #---------------------------------------|<span class="hljs-type"><span class="hljs-type">ICINGA</span></span> <span class="hljs-type"><span class="hljs-type">SERVICES</span></span>|-----------------# #---//<span class="hljs-type"><span class="hljs-type">Managment</span></span> of monitoring system.//-----------------------------------# icinga2_service: <span class="hljs-string"><span class="hljs-string">'%{::fqdn} virtual host'</span></span> : target: /etc/icinga2/zones.d/master/%{::fqdn}.conf apply: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> assign: [ <span class="hljs-string"><span class="hljs-string">'host.name == %{::fqdn}'</span></span> ] display_name: <span class="hljs-string"><span class="hljs-string">'%{::fqdn} virtualhost'</span></span> check_command: <span class="hljs-string"><span class="hljs-string">'http'</span></span> vars: http_uri: / http_ssl: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> http_vhost: <span class="hljs-string"><span class="hljs-string">'hostname'</span></span> http_address: <span class="hljs-comment"><span class="hljs-comment">"%{lookup('host_address')}"</span></span> <span class="hljs-string"><span class="hljs-string">'%{::fqdn} nginx status'</span></span> : target: /etc/icinga2/zones.d/master/%{::fqdn}.conf apply: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> assign: [ <span class="hljs-string"><span class="hljs-string">'host.name == %{::fqdn}'</span></span> ] command_endpoint: <span class="hljs-string"><span class="hljs-string">'%{::fqdn}'</span></span> display_name: <span class="hljs-string"><span class="hljs-string">'nginx status'</span></span> check_command: <span class="hljs-string"><span class="hljs-string">'nginx_status'</span></span> vars: nginx_status_host_address: localhost nginx_status_servername: server.com nginx_status_critical: <span class="hljs-string"><span class="hljs-string">'1600,60,30'</span></span> nginx_status_warn: <span class="hljs-string"><span class="hljs-string">'1500,55,25'</span></span> <span class="hljs-string"><span class="hljs-string">'%{::fqdn} redis'</span></span>: target: /etc/icinga2/zones.d/master/%{::fqdn}.conf apply: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> assign: [ <span class="hljs-string"><span class="hljs-string">'host.name == %{::fqdn}'</span></span> ] display_name: <span class="hljs-string"><span class="hljs-string">'Redis'</span></span> command_endpoint: <span class="hljs-string"><span class="hljs-string">'%{::fqdn}'</span></span> check_command: <span class="hljs-comment"><span class="hljs-comment">"redis"</span></span> vars: redis_hostname: localhost redis_port: <span class="hljs-number"><span class="hljs-number">6379</span></span> redis_perfvars: <span class="hljs-string"><span class="hljs-string">'*'</span></span> #=========================================================================#</code> </pre><br><br><h2>  Skema operasi umum dari skema semacam itu hanya terdiri dari dua tindakan sederhana: </h2><br><ol><li>  <b>Kami mulai boneka pada tuan rumah - tuan rumah melihat cek yang menjadi miliknya dan mengekspornya ke puppetDB.</b> <b><br></b> <br></li><li>  <b>Jalankan boneka dalam wadah icinga2 - cek dari puppetdb berubah menjadi konfigurasi Icinga2 nyata.</b> <b><br></b> <br></li></ol><br>  Di sini, banyak yang akan mengatakan: <i>"Mengapa saya harus membuat semua ini terjadi, jika saya dapat meningkatkan icinga2 seperti biasa dan menambahkan cek dengan tangan saya atau melalui antarmuka web?"</i> <br><br>  Memang, jika Anda perlu memantau selusin host dengan ratusan layanan, dan Anda adalah orang yang cukup rapi dengan memori yang baik (tidak ditemukan di alam), maka tidak masuk akal untuk pagar taman.  Ini masalah yang sama sekali berbeda jika Anda memiliki infrastruktur yang agak besar dan ada perasaan bahwa Anda mungkin telah melupakan sesuatu di suatu tempat.  Pada saat-saat seperti itu, otomatisasi sangat membantu, karena  membantu meletakkan segala sesuatu di rak dan menghindari, dalam banyak hal, faktor manusia. <br><br><h2>  Nyatakan keunggulan utama: </h2><br>  <b>Mari kita lihat templat ini:</b> <br><br><pre> <code class="hljs pgsql">icinga2_service: <span class="hljs-string"><span class="hljs-string">'%{::fqdn} disk service'</span></span>: target: /etc/icinga2/zones.d/master/%{::fqdn}.conf apply: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> assign: [ <span class="hljs-string"><span class="hljs-string">'host.name == %{::fqdn}'</span></span> ] display_name: <span class="hljs-string"><span class="hljs-string">'Disk usage'</span></span> command_endpoint: <span class="hljs-string"><span class="hljs-string">'%{::fqdn}'</span></span> check_command: <span class="hljs-string"><span class="hljs-string">'disk'</span></span> vars: #<span class="hljs-keyword"><span class="hljs-keyword">All</span></span> disks disk_all: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> disk_exclude_type: - aufs - tmpfs disk_ignore_ereg_path: - /run/docker<span class="hljs-comment"><span class="hljs-comment">/* - /sys/* - /var/lib/docker* - /var/lib/ureadahead/debugfs/* - /run/user/*</span></span></code> </pre><br> <b>+ 1.     Hiera            — ..  .    Icinga2,   ,         .   ,     , ,    . <br></b> <br> <b>+ 2.    ,     .       —           . <br></b> <br> <b>+ 3.        , ..       ,          Icinga2     ,  puppet   Icinga2. <br></b> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ 4. Jadi, semua cek yang kami simpan di database puppetDB tunggal kami dapat membuat skrip yang cukup kuat untuk otomatisasi lebih lanjut, di mana kami akan menggunakan informasi ini. </font></font><br></b> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Jadi ayo pergi </font></font></h2><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1. Siapkan boneka. </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semoga Anda telah mengkonfigurasi buruh pelabuhan dan susunan buruh pelabuhan. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika tidak, maka Anda harus menginstalnya: </font></font><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menginstal Docker ... </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menginstal Docker-compose ...</font></font></a> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2. Kami mengkloning repositori ke server kami: </font></font></h3><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> http://git.comgress64.com/external/puppet-icinga2-how-to.git</code> </pre><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3. Buka docker-compose.yaml dengan editor favorit Anda dan lihatlah. </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami melihat bahwa dalam bundel ini kami memiliki beberapa wadah yang naik sekaligus - PuppetServer, PuppetDb, server PostgreSQL, dan PuppetBoard. </font><font style="vertical-align: inherit;">Volume yang dipasang juga dari direktori saat ini. </font><font style="vertical-align: inherit;">Konfigurasi ini tidak optimal untuk semua orang, jadi pertimbangkan infrastruktur Anda. </font><font style="vertical-align: inherit;">Seseorang sudah memiliki server PostgreSQL, seseorang ingin menyimpan kode di bagian lain - ini kebebasan untuk kreativitas. </font><font style="vertical-align: inherit;">Pada tahap ini, saya sarankan untuk meninggalkan template default - Anda selalu dapat kembali lagi nanti. </font><font style="vertical-align: inherit;">Mari mengambil paket wadah kami dan melihat apa yang terjadi:</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4. Luncurkan wadah Wayang, Postgres, Boneka, dan Grafit. </font></font></h3><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  Puppet, Postgres  Puppetdb #  Puppet, Postgres, Puppetdb  Graphite cd puppet-icinga2-how-to docker-compose up -d puppet puppetdb-postgres puppetdb graphite &amp;&amp; docker-compose logs -f</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sekarang kami telah memuat beberapa gambar dan meluncurkan wadah, membuat basis data di PostgreSQL. </font><font style="vertical-align: inherit;">Biarkan kami menunggu sampai semua server dimulai - kesalahan dapat diabaikan, karena mereka akan stabil setelah beberapa waktu. </font><font style="vertical-align: inherit;">Tekan Ctrl + C untuk keluar dari mode tampilan log.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 5. Periksa karya master boneka kami: </font></font></h3><br><pre> <code class="bash hljs">docker run --net puppeticinga2howto_default --link puppet:puppet puppet/puppet-agent</code> </pre><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6. Jika semuanya baik-baik saja, Anda akan melihat kesimpulan ini: </font></font></h3><br><pre> <code class="bash hljs">Notice: Applied catalog <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 0.03 seconds Changes: Total: 1 Events: Success: 1 Total: 1 Resources: Changed: 1 Out of sync: 1 Total: 8 Time: Schedule: 0.00 File: 0.00 Transaction evaluation: 0.01 Catalog application: 0.03 Convert catalog: 0.04 Config retrieval: 0.45 Node retrieval: 1.38 Last run: 1532605377 Fact generation: 2.24 Plugin sync: 4.50 Filebucket: 0.00 Total: 8.65 Version: Config: 1532605376 Puppet: 5.5.1</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Siapkan server Icinga2. </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7. Buat gambar dari Dockerfile dengan melakukan: </font></font></h3><br><pre> <code class="bash hljs">docker-compose build icinga</code> </pre><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8. Jalankan wadah tempat server Icinga2 akan hidup. </font></font></h3><br><pre> <code class="bash hljs">docker-compose up -d icinga</code> </pre><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9. Sejauh ini, wadah kami kosong. </font><font style="vertical-align: inherit;">Mari kita mengkonfigurasi server icinga2 menggunakan server Wayang kami dengan melakukan:</font></font></h3><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   puppet  librarian-puppet   puppet docker-compose exec puppet bash -c 'cd /etc/puppetlabs/code &amp;&amp; gem install librarian-puppet &amp;&amp; librarian-puppet install --verbose' # Puppet   Icinga     docker-compose exec icinga puppet agent --server puppet --waitforcert 60 --test</span></span></code> </pre><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 10. Instal dan konfigurasikan Icinga, Icingaweb2, dan Apache. </font></font></h3><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Server Icinga2 Anda sudah siap! </font></font></h2><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Icingaweb2 </font></font></h2><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1. Mari kita lihat apa yang kita dapatkan. </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lebih mudah untuk melihat keadaan sistem pemantauan di browser, lakukan: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buka di browser </font></font><font color="#0000aa"><u><code>http://ip___:8081/icingaweb2</code></u></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan buka Icinga dengan login default: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">icingaadmin / icinga</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami melihat gambar ini: </font></font></b> <br><br><img src="https://habrastorage.org/webt/vg/hr/zn/vghrznlioinsw68lgide-onot9o.png"><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setelah beberapa menit, kami melihat bahwa semua pemeriksaan berhasil bagi kami: </font></font></b> <br><br><img src="https://habrastorage.org/webt/ju/5a/ds/ju5adsckudygkhbejybx4k7fmz4.png"><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafik juga berfungsi:</font></font></b> <br><br><img src="https://habrastorage.org/webt/hy/6i/lw/hy6ilwnlp0ua6fdoouzo-8t7rog.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kami memiliki lingkungan web yang berfungsi untuk Icinga2, tetapi belum ada host yang terhubung ke Icinga, mari hubungkan host pertama kami.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2. Hubungkan host baru ke sistem pemantauan </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sekarang kami hanya memiliki satu host yang terhubung ke icinga2 - Icinga itu sendiri. </font><font style="vertical-align: inherit;">Mari kita hubungkan yang lain. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya menunjukkan contoh di buruh pelabuhan, tetapi semuanya akan bekerja pada bare metal: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pertama, Anda perlu menyiapkan template dan memberikan beberapa informasi tentang host untuk boneka:</font></font></b> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    cd puppet-icinga2-how-to/code/environments/production/hieradata/nodes #    (   ) cp template.yaml example.com.yaml #       : host_address: 172.18.0.7 my_company: COMGRESS64 my_package_manager: apt my_ssh_port: 22 #   </span></span></code> </pre><br> <b>  .      hostname      ,     :</b> <br><br><pre> <code class="bash hljs">docker run --hostname example.com --rm -t --link puppet:puppet --net puppeticinga2howto_default -i phusion/baseimage:latest /sbin/my_init -- bash -l</code> </pre><br> <b> puppet   :</b> <br><br><pre> <code class="bash hljs">apt-get update &amp;&amp; apt-get install -y ruby make gcc perl-modules &amp;&amp; gem install --no-ri --no-rdoc puppet</code> </pre><br> <b> puppet:</b> <br><br><pre> <code class="bash hljs">puppet agent --server puppet --waitforcert 60 --<span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre><br> <b>    icinga2             puppetDB.   ,  puppet   icinga2:</b> <br><br><pre> <code class="bash hljs">docker-compose <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> icinga puppet agent --server puppet --waitforcert 60 --<span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami melihat melalui browser apa yang kami dapatkan: </font></font></b> <br><br><img src="https://habrastorage.org/webt/tc/ko/uc/tckoucinbkuwoqh_bhquehthj-i.png"><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cek telah ditambahkan dan sedang menunggu penyelesaian. </font></font></b> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setelah 5 menit:</font></font></b> <br><br><img src="https://habrastorage.org/webt/-9/va/dv/-9vadvzxjwxepukpbjoinxt0h9a.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dengan cara yang sama, semua host lain ditambahkan ke sistem. Saya ingin menarik perhatian Anda pada kenyataan bahwa panduan ini adalah bukti konsep dan tidak dapat digunakan dalam lingkungan produksi tanpa modifikasi apa pun. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika artikelnya tampak menarik, lain kali saya akan menunjukkan bagaimana Anda dapat menambahkan semua jenis pemeriksaan kustom yang menarik, berbagi rahasia dan menceritakan semua jenis seluk-beluk. Juga, jika ada keinginan, saya akan menceritakan lebih detail tentang bagaimana semua ini bekerja dari dalam.</font></font><br><br>  <b>Terima kasih atas perhatian anda!</b> <br><br><hr><br> <b>      Confluence:</b> <br> <i>/    ./</i> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><b>docs.comgress64.com/...</b></a> <br><br> <b>  :</b> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://github.com/Icinga/puppet-icinga2</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://forge.puppet.com/icinga/icingaweb2</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://docs.docker.com/</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://docs.puppet.com/</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://docs.puppet.com/hiera/</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id420199/">https://habr.com/ru/post/id420199/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id420189/index.html">Klub Tanpa Alasan: ketekunan Massimiliano Sichi yang tak terbatas</a></li>
<li><a href="../id420191/index.html">Tim SONIA: masa depan kendaraan bawah air otonom</a></li>
<li><a href="../id420193/index.html">Printer dengan CISS: pilih dan bandingkan dengan biaya cetak</a></li>
<li><a href="../id420195/index.html">Tempat bekerja di ibukota - ikhtisar singkat tentang 15 rekan kerja di Moskow</a></li>
<li><a href="../id420197/index.html">Pembuatan AI menggunakan metode glock cuzdra. Pengembaraan Intelektual</a></li>
<li><a href="../id420201/index.html">Mengapa orang Barat takut pada robot, tetapi orang Jepang tidak?</a></li>
<li><a href="../id420203/index.html">Remaja itu mencegah kesuksesan serius dalam komputasi kuantum</a></li>
<li><a href="../id420205/index.html">ROM berbasis DNA, memori asam nukleat dan substrat untuk OxRAM</a></li>
<li><a href="../id420209/index.html">OpenAI menunjukkan transfer manipulasi kompleks dari simulasi ke dunia nyata</a></li>
<li><a href="../id420211/index.html">Pemikiran magis tentang pembelajaran mesin tidak akan membuat AI nyata lebih dekat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>