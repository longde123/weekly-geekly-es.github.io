<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëê üçÆ ü§æüèº Gerador de capa de m√∫sica Python no Blender üöª üîπ ü•™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Neste artigo, falarei sobre meu complemento para o liquidificador, sobre os motivos que me levaram a cri√°-lo, o processo de desenvolvimento e o "suces...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gerador de capa de m√∫sica Python no Blender</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471086/">  Neste artigo, falarei sobre meu complemento para o liquidificador, sobre os motivos que me levaram a cri√°-lo, o processo de desenvolvimento e o "sucesso" no YouTube. <br><br><img src="https://habrastorage.org/webt/se/0l/3z/se0l3z14g4hz9us38mpb1yetci0.jpeg"><br><a name="habracut"></a><br><br><h3>  Antecedentes </h3><br>  Tudo come√ßou com o fato de que h√° cerca de um ano (em novembro de 2018) eu vi na oferta do YouTube uma capa t√£o incomum em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">The Ultimate Canon</a> <br><br>  O cara gravou as amostras de cada nota da m√∫sica e, atrav√©s de edi√ß√£o cuidadosa, montou a m√∫sica inteira a partir delas.  Para quem √©, mas acho que √© pelo menos engra√ßado.  E o n√∫mero de visualiza√ß√µes (na √©poca um pouco mais de 1.000.000) indicava que o t√≥pico ( <i>1% de habilidade de guitarra e 99% de edi√ß√£o</i> ) era popular. <br><br>  Tenho certeza de que aqueles que estavam pelo menos um pouco envolvidos na mixagem de m√∫sicas sabem que √†s vezes √© mais f√°cil cortar e mover a faixa um pouco do que pedir ao guitarrista descuidado que reproduza a parte.  Eu tamb√©m costumava fazer capas cl√°ssicas e, mesmo assim, tive a ideia de criar uma capa exatamente como o cara do v√≠deo.  E agora vejo que "minha ideia foi descaradamente roubada" e tive um bom escapamento.  Fiquei aborrecido porque meu trem partiu, mas de repente me ocorreu que eu poderia fazer o mesmo, mas em um n√≠vel diferente, adicionando uma nova etapa - <i>1% de guitarra 1% editando 98% de habilidades de programa√ß√£o</i> . <br><br>  Al√©m disso, isso permitir√° criar composi√ß√µes muito mais complexas que, quando editadas manualmente, poucas pessoas t√™m paci√™ncia. <br><br><h3>  Desenvolvimento </h3><br>  Portanto, a tarefa era automatizar o processo de fatiar amostras de som em uma composi√ß√£o musical. <br><br>  Antes de tudo, era necess√°rio transmitir de algum modo aos dados futuros do programa sobre a composi√ß√£o, suas notas, faixas, instrumentos.  Pensei imediatamente no GuitarPro e suas op√ß√µes de exporta√ß√£o de dados: MusicXML e MIDI. <br><br>  Pesquisas me levaram a escolher um analisador para arquivos midi no Python <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">music21</a> .  Este n√£o √© apenas um analisador, mas, al√©m disso, n√£o preciso de nada do m√≥dulo.  E os an√°logos estavam com documenta√ß√£o terr√≠vel ou n√£o podiam fazer o que eu precisava t√£o facilmente quanto a m√∫sica21. <br><br>  √ìtimo, agora posso obter dados de arquivos midi sobre faixas, anota√ß√µes, posi√ß√£o e dura√ß√£o.  N√≥s estamos indo al√©m. <br><br>  Agora, com base nesses dados, voc√™ precisa cortar de arquivos de v√≠deo / √°udio.  Ent√£o eu escolhi r√°pido o suficiente.  Definitivamente o Blender, apesar de suas modestas capacidades como editor de v√≠deo.  Tenho experi√™ncia em trabalhar com o Adobe PremierePro, After Effects, mas existe meu pr√≥prio dialeto de script, que n√£o √© √∫til em nenhum outro lugar, e seus recursos s√£o desconhecidos para mim.  No Blender, quase qualquer a√ß√£o pode ser executada atrav√©s de um script Python.  E isso j√° corresponde √† linguagem da m√∫sica21.  Vale a pena explicar que, naquela √©poca, eu n√£o conhecia o Python, portanto, tamb√©m considerei esse projeto uma excelente ocasi√£o para me familiarizar com essa linguagem popular.  Bingo! <br><br>  Gradualmente, comecei a me aprofundar no idioma, emitindo notas de arquivos m√©dios para o console por meio do music21, rapidamente observei como criar complementos no liquidificador e passei √† primeira tarefa pr√°tica: gerar dados de amostra.  Ele gravou todas as notas √∫nicas no viol√£o e come√ßou a cortar, mas logo parou.  Meu programador interno protestou contra esse trabalho meticuloso (e pode haver muitas notas para cada instrumento: 30-50).  E isso teria que cortar as notas e renderiz√°-las individualmente em arquivos separados, e, para isso, ajustar cada nota de trilha no in√≠cio da linha do tempo ... Em geral, esse processo teve que ser simplificado. <br><br>  A solu√ß√£o foi usar algo no Blender como marcadores.  Estes s√£o essencialmente pontos com informa√ß√µes textuais que podem ser definidas em um quadro espec√≠fico.  A l√≥gica era a seguinte: o usu√°rio organiza seu v√≠deo e √°udio (se o √°udio foi gravado em uma faixa separada), direciona-os um para o outro e marca com os marcadores o in√≠cio de cada nota no v√≠deo, e no texto do marcador indica que tipo de nota √© (A #, D, C e etc.) e sua dura√ß√£o m√°xima no registro.  Em seguida, as informa√ß√µes sobre os marcadores s√£o registradas em um arquivo e j√° s√£o usadas ao cortar notas individuais. <br><br><img src="https://habrastorage.org/webt/hj/nh/sp/hjnhspqu2nigpktwpavzf5pk-as.png"><br><br>  O pr√≥ximo ponto j√° era o ‚Äún√∫cleo‚Äù real do funcional - notas de corte e seu posicionamento na linha do tempo.  Ironicamente, n√£o h√° nada de especial a dizer: havia muita documenta√ß√£o de leitura, a documenta√ß√£o do Blender estava longe de ser sempre bastante detalhada, mas gradualmente eu consegui o que queria.  Quando vi (e ouvi) o primeiro resultado (era uma composi√ß√£o curta do grupo Epidemic - Frodo), a felicidade n√£o tinha limites.  Eu acho que todo mundo conhece o sentimento quando algo finalmente sai. <br><br><img src="https://habrastorage.org/webt/tj/c9/eu/tjc9euayeaoekq8pan04okdssl4.png"><br><br>  A qualidade do c√≥digo √© ruim.  Eu tentei faz√™-lo √†s pressas, porque  Imaginei que n√£o era o √∫nico que pensava em algo assim e n√£o gostaria de me antecipar aqui (spoiler! Qu√£o ing√™nuo eu era).  Portanto, n√£o houve tempo para aderir ao estilo e refletir sobre a estrutura, tentei obter um prot√≥tipo de trabalho mais r√°pido. <br><br><h3>  Nuances </h3><br>  Agora, as nuances da implementa√ß√£o.  O Blender tem um limite nas camadas do editor, no m√°ximo 32. Na imagem, voc√™ pode ver que as amostras de √°udio e v√≠deo (verde e roxo) ocupam 14 camadas cada e s√£o formadas em ordem crescente, e novamente no in√≠cio de seu setor.  Isso se deve ao fato de o Blender n√£o permitir que voc√™ crie uma amostra em cima de outra.  E na m√∫sica, muitas vezes acontece que a pr√≥xima nota come√ßa mesmo antes do final do som anterior.  Portanto, para evitar sobreposi√ß√£o, decidi gerar a pr√≥xima nota em uma camada superior √† anterior e, quando as camadas do setor terminarem, come√ßar novamente a partir da primeira camada (√© improv√°vel que a primeira nota soe at√© 14 camadas √† frente).  Sim, isso poderia ser feito de maneira mais inteligente, salvando camadas, mas como eu disse, estava com pressa. <br><br>  O mais atento pode notar que o setor inteiro √© de 2 por 14 camadas, isso √© 28 e o m√°ximo no Blender √© 32. O fato √© que, para notas de desova, voc√™ precisa gerar 2 faixas originais (v√≠deo e √°udio) atrav√©s de um script e depois cort√°-las nota.  E voc√™ n√£o pode aparecer em cima de outra faixa, ent√£o reservei as camadas 31 e 32 para esse neg√≥cio.  Os dias 29 e 30 s√£o usados ‚Äã‚Äãpara armazenamento intermedi√°rio de faixas j√° geradas: a gera√ß√£o ocorre em uma faixa do arquivo midi, as notas s√£o agrupadas em uma faixa, transferidas para a camada 29/30, geramos a pr√≥xima faixa etc. <br><br>  H√° tamb√©m uma nuance: nas pontua√ß√µes m√©dias, existe uma propriedade como a velocidade de reprodu√ß√£o.  E isso pode mudar muitas vezes dentro da composi√ß√£o.  Na music21, nunca encontrei a oportunidade de acompanhar essas mudan√ßas de velocidade.  Portanto, a velocidade das notas geradas coincidir√° com a primeira velocidade especificada no arquivo midi.  Existem 2 solu√ß√µes: <br><br><ol><li>  para cada se√ß√£o com uma nova velocidade, fa√ßa um novo arquivo midi somente com ele; </li><li>  gere notas de se√ß√£o novamente com o modificador de velocidade Tempo (fator multiplicativo √† velocidade inicial). </li></ol><br><img src="https://habrastorage.org/webt/ul/8s/1j/ul8s1jkhijfs4uebefv9losylik.png"><br><br>  Prefiro adicionar minhas pr√≥prias faixas para cada velocidade no GuitarPro, depois no Blender, basta ger√°-las com um modificador de velocidade, √© mais r√°pido e mais dif√≠cil ficar confuso. <br><br><h3>  Utilit√°rios de edi√ß√£o de v√≠deo </h3><br>  Agora que voc√™ possui um conjunto de rascunhos de faixas geradas, √© necess√°rio montar uma capa assist√≠vel de assistir.  I.e.  posicione as faixas nos cantos do v√≠deo, troque de acordo com a m√∫sica etc.  No liquidificador, isso √© muito ruim.  Para aplicar o efeito √† faixa, voc√™ precisa ‚Äúcolar‚Äù outra faixa de cima, que ser√° renderizada ao renderizar e coloc√°-la na posi√ß√£o correta. <br><br>  De nota particular s√£o acordes.  √â quando v√°rias notas tocam ao mesmo tempo, ou seja,  ao renderizar um v√≠deo, apenas a nota de topo do acorde ser√° exibida.  A solu√ß√£o foi adicionar o mesmo efeito (felizmente, eles n√£o se quebram quando sobrepostos).  Se durante a edi√ß√£o normal das faixas geradas eu pudesse fazer tudo manualmente, editar demais todas as notas do acorde.  Como voc√™ sabe, eu tamb√©m automatizei essa nuance.  Agora, com o clique do bot√£o "Chordify strips", as amostras selecionadas ser√£o transformadas conforme necess√°rio e cada nota do acorde ser√° desenhada. <br><br><img src="https://habrastorage.org/webt/ft/3y/gg/ft3yggjgwv4_na3gaycf8kxtnma.png"><br><br><img src="https://habrastorage.org/webt/7y/ak/fy/7yakfyj859n2xayjhj5ehl9xvm8.png"><br><br>  E mais um ponto de automa√ß√£o: √†s vezes as amostras geradas t√™m partes vazias entre si.  Isso se deve ao fato de que as pontua√ß√µes nesses locais s√£o subitamente vazias.  No GuitarPro, isso soa normal, devido a v√°rios efeitos, o som da nota √© mantido no meio.  No entanto, vazios se formam no liquidificador.  Eles devem ser preenchidos esticando a nota anterior antes da pr√≥xima.  Exatamente essa tarefa √© realizada pelo bot√£o "Preencher lacunas". <br><br>  A funcionalidade para trabalhar com o volume, bem como a capacidade de substituir uma nota ausente por uma nota diferente, mas com um valor diferente da afina√ß√£o, tamb√©m foi escrita para pequenas coisas, o que permite ir al√©m dos limites da faixa do instrumento (embora na pr√°tica n√£o ultrapasse 1 oitava). <br><br><h3>  Gl√≥ria no youtube </h3><br>  Ent√£o, o complemento est√° pronto.  Cerca de um m√™s e meio foi gasto desde o in√≠cio da id√©ia, ele trabalhava √† noite nas horas vagas.  Est√° na hora de fazer uma capa que vai bater na capa da m√£o daquele cara.  Eu escolhi a mesma m√∫sica, mas em um arranjo de rock: Canon Rock.  √â muito mais mel√≥dico e complicado do que o original e demonstrar√° claramente o novo n√≠vel da minha abordagem.  Sim, e como resposta a um v√≠deo j√° popular, pode atrair a aten√ß√£o de um p√∫blico. <br><br>  No texto acima, eu me enganei um pouco, porque  Comecei a trabalhar na capa no processo de cria√ß√£o do complemento, para que, usando o exemplo dele, entenda que funcionalidade √© necess√°ria e a implemente. <br><br>  E agora a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">capa est√° pronta e polida</a> !  Ele filmou a introdu√ß√£o e o final, nos quais, em ingl√™s quebrado, ele tentou explicar a inclina√ß√£o da minha resposta.  Ele falou algumas palavras deliberadamente com erros (elogiado, duplo efeito), esperando que os espectadores alterassem os coment√°rios.  Preparou uma visualiza√ß√£o.  Com a respira√ß√£o suspensa, antecipando o triunfo esperado, carregou e publicou o v√≠deo.  Enviei-os em grupos de capas e joguei o link no Instagram para aquele cara.  A prop√≥sito, ele tem um apelido muito triunfante: Ralph Jay Triumfo. <br><br>  O tempo passou.  N√£o houve triunfo.  No primeiro dia, obtive cerca de 100 visualiza√ß√µes, metade das quais eram minhas e minhas amigas.  Ent√£o houve uma pausa.  A cada novo dia eu ficava cada vez mais decepcionado com todo esse empreendimento.  As pessoas realmente n√£o entendem o qu√£o legal eu fiz isso?  Por que o boca a boca n√£o funciona?  Ou talvez a ideia em si fosse legal apenas na minha cabe√ßa? <br><br>  Seja como for, gostei do resultado e gradualmente comecei a fazer mais e mais capas novas. <br>  Naquela √©poca, participei das filmagens do programa ‚ÄúModelagem Cerebral‚Äù na TV local e uma vez mencionei meu of√≠cio em uma conversa com o apresentador.  O resultado foi um pequeno relat√≥rio sobre mim.  M√£e, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">eu estou na TV</a> ! <br><br>  Eu entendi perfeitamente que os aposentados assistem principalmente √† TV local, ent√£o n√£o havia expectativas disso. <br><br>  Mesmo assim, eu queria trazer o c√≥digo do complemento √† minha mente, otimizar a gera√ß√£o e colocar o complemento em dom√≠nio p√∫blico, mas a falha do triunfo diminuiu meu ardor.  Al√©m disso, o lan√ßamento completo da nova vers√£o do Blender estava sendo preparado e a API estava mudando.  Eu queria esperar pelo seu lan√ßamento no ver√£o e transferir o complemento para a nova vers√£o, e depois lan√ß√°-lo, mas, novamente, n√£o havia nenhum desejo em particular. <br><br>  E agora, depois de quase um ano, quando as visualiza√ß√µes do primeiro v√≠deo mal excederam 600, decidi colocar um complemento no p√∫blico e escrever este artigo, talvez pelo menos isso ilumine meu tempo de lazer, mas ao mesmo tempo eu falei. <br><br>  Obviamente, tentei transferir o complemento para a nova vers√£o 2.80, mas o editor de v√≠deo n√£o apenas n√£o foi melhorado, mas tamb√©m piorado.  O desempenho √© muito pior, √†s vezes falha ao gerar faixas pesadas.  O pr√≥prio editor come√ßou a desacelerar.  A incapacidade de abafar certas faixas de √°udio (espero que isso seja um bug, e elas ser√£o corrigidas no pr√≥ximo lan√ßamento menor).  Enquanto isso, o complemento precisa da boa e antiga vers√£o 2.79 <br><br>  Aqui est√° um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">link para o complemento</a> , n√£o esque√ßa de colocar music21 no interpretador python blender.  Estou ansioso pela apar√™ncia maci√ßa de capas sintetizadas suas. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt471086/">https://habr.com/ru/post/pt471086/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt471074/index.html">Synet - uma estrutura para o lan√ßamento de redes neurais pr√©-treinadas na CPU</a></li>
<li><a href="../pt471076/index.html">Como a Matrix criou um legado √† prova de balas</a></li>
<li><a href="../pt471078/index.html">O Chrome bloquear√° completamente o conte√∫do misto</a></li>
<li><a href="../pt471080/index.html">Quem √© respons√°vel pela qualidade de testar o aplicativo? 10 raz√µes para obter erros na produ√ß√£o</a></li>
<li><a href="../pt471084/index.html">Padr√µes de procedimentos que podem ser usados ‚Äã‚Äãcom cart√µes lado a lado</a></li>
<li><a href="../pt471088/index.html">Especialistas em TI Burn Out: 4 hist√≥rias do gerente, desenvolvedor, produto e administrador. E a receita de Southbridge</a></li>
<li><a href="../pt471090/index.html">[N√£o] use CDN</a></li>
<li><a href="../pt471092/index.html">Comando cp: copiando pastas de arquivo para * nix corretamente</a></li>
<li><a href="../pt471094/index.html">O Tutu.ru e o Clube de Programadores de Moscou s√£o convidados para uma reuni√£o de back-end em 17 de outubro</a></li>
<li><a href="../pt471096/index.html">Teste p√∫blico: solu√ß√£o para privacidade e escalabilidade no Ethereum</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>