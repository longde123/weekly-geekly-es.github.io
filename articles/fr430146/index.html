<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëäüèø ü§õüèø üôçüèΩ Les math√©matiques dans Gamedev sont simples. Vecteurs et int√©grales üíô ü§¶üèº ‚§¥Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous! Aujourd'hui, je voudrais parler des math√©matiques. Les math√©matiques sont une science tr√®s int√©ressante et peuvent √™tre tr√®s utiles lo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Les math√©matiques dans Gamedev sont simples. Vecteurs et int√©grales</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/430146/">  Bonjour √† tous!  Aujourd'hui, je voudrais parler des math√©matiques.  Les math√©matiques sont une science tr√®s int√©ressante et peuvent √™tre tr√®s utiles lors du d√©veloppement de jeux, et en g√©n√©ral lorsque vous travaillez avec des graphiques informatiques.  Beaucoup (en particulier les d√©butants) ne savent tout simplement pas comment il est utilis√© dans le d√©veloppement.  Il existe de nombreux probl√®mes qui ne n√©cessitent pas une compr√©hension approfondie de concepts tels que: int√©grales, nombres complexes, groupes, anneaux, etc., mais gr√¢ce aux math√©matiques, vous pouvez r√©soudre de nombreux probl√®mes int√©ressants.  Dans cet article, nous consid√©rons les vecteurs et les int√©grales.  Si vous √™tes int√©ress√©, bienvenue au chat.  L'illustration du projet Unity, comme toujours, est jointe. <br><br><img src="https://habrastorage.org/webt/si/-v/9f/si-v9fgzx1j01amuhr9eueauiie.jpeg"><br><a name="habracut"></a><br>  <b>Math√©matiques de vecteur.</b> <br><br>  Les vecteurs et les math√©matiques vectorielles sont des outils essentiels pour le d√©veloppement de jeux.  De nombreuses op√©rations et actions y sont enti√®rement li√©es.  C'est dr√¥le que pour impl√©menter une classe qui affiche la fl√®che d'un vecteur dans Unity, cela a d√©j√† pris la plupart des op√©rations typiques.  Si vous connaissez bien les math√©matiques vectorielles, ce bloc ne vous int√©ressera pas. <br><br>  <b>Arithm√©tique vectorielle et fonctions utiles</b> <br><br>  Les formules analytiques et autres d√©tails sont faciles √† google, nous ne perdrons donc pas de temps √† ce sujet.  Les op√©rations elles-m√™mes seront illustr√©es par des animations gif ci-dessous. <br><br>  <i>Il est important de comprendre que tout point essentiel est un vecteur dont le point de d√©part est z√©ro.</i> <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Votre navigateur ne prend pas en charge la vid√©o HTML5. <source src="https://media.giphy.com/media/cNIrQX8PrV1J62zzKJ/giphy.mp4" type="video/mp4"></video></div></div></div><br><br>  Les gifs ont √©t√© cr√©√©s en utilisant Unity, il serait donc n√©cessaire d'impl√©menter une classe qui est responsable du rendu des fl√®ches.  Une fl√®che vectorielle se compose de trois composants principaux: une ligne, une pointe et du texte avec le nom d'un vecteur.  Pour tracer une ligne et une astuce, j'ai utilis√© LineRenderer.  Regardons la classe du vecteur lui-m√™me: <br><br><div class="spoiler">  <b class="spoiler_title">Classe de fl√®che</b> <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> TMPro; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">VectorArrow</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Vector3 _VectorStart; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Vector3 _VectorEnd; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> TextOffsetY; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TMP_Text _Label; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Color _Color; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> LineRenderer _Line; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> _CupLength; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> LineRenderer _Cup; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnValidate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { UpdateVector(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateVector</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(_Line == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || _Cup == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; SetColor(_Color); _Line.positionCount = _Cup.positionCount = <span class="hljs-number"><span class="hljs-number">2</span></span>; _Line.SetPosition(<span class="hljs-number"><span class="hljs-number">0</span></span>, _VectorStart); _Line.SetPosition(<span class="hljs-number"><span class="hljs-number">1</span></span>, _VectorEnd - (_VectorEnd - _VectorStart).normalized * _CupLength); _Cup.SetPosition(<span class="hljs-number"><span class="hljs-number">0</span></span>, _VectorEnd - (_VectorEnd - _VectorStart).normalized * _CupLength); _Cup.SetPosition(<span class="hljs-number"><span class="hljs-number">1</span></span>, _VectorEnd ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_Label != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dv = _VectorEnd - _VectorStart; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> normal = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(-dv.y, dv.x).normalized; normal = normal.y &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? normal : -normal; _Label.transform.localPosition = (_VectorEnd + _VectorStart) / <span class="hljs-number"><span class="hljs-number">2</span></span> + normal * TextOffsetY; _Label.transform.up = normal; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetPositions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 start, Vector3 end</span></span></span><span class="hljs-function">)</span></span> { _VectorStart = start; _VectorEnd = end; UpdateVector(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetLabel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> label</span></span></span><span class="hljs-function">)</span></span> { _Label.text = label; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetColor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Color color</span></span></span><span class="hljs-function">)</span></span> { _Color = color; _Line.startColor = _Line.endColor = _Cup.startColor = _Cup.endColor = _Color; } }</code> </pre> <br></div></div><br>  Puisque nous voulons que le vecteur soit d'une certaine longueur et corresponde exactement aux points que nous sp√©cifions, la longueur de la ligne est calcul√©e par la formule: <br><br><pre> <code class="cs hljs">_VectorEnd - (_VectorEnd - _VectorStart).normalized * _CupLength</code> </pre> <br>  Dans cette formule <i>(_VectorEnd - _VectorStart). Normalis√©</i> est la direction du vecteur.  Cela peut √™tre compris √† partir de l'animation avec la diff√©rence de vecteurs, en supposant que <i>_VectorEnd</i> et <i>_VectorStart</i> sont des vecteurs avec un d√©but √† (0,0,0). <br><br>  Ensuite, nous analysons les deux op√©rations de base restantes: <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Votre navigateur ne prend pas en charge la vid√©o HTML5. <source src="https://media.giphy.com/media/ki8xgF72Ym8iLzByVS/giphy.mp4" type="video/mp4"></video></div></div></div><br>  Trouver la normale (perpendiculaire) et le milieu du vecteur sont des t√¢ches tr√®s courantes lors du d√©veloppement de jeux.  Analysons-les par l'exemple de la mise en place d'une signature sur un vecteur. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dv = _VectorEnd - _VectorStart; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> normal = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(-dv.y, dv.x).normalized; normal = normal.y &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? normal : -normal; _Label.transform.localPosition = (_VectorEnd + _VectorStart) / <span class="hljs-number"><span class="hljs-number">2</span></span> + normal * TextOffsetY; _Label.transform.up = normal;</code> </pre> <br>  Pour placer le texte perpendiculairement au vecteur, nous avons besoin d'une normale.  Dans les graphiques 2D, la normale est assez simple. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dv = _VectorEnd - _VectorStart; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> normal = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(-dv.y, dv.x).normalized;</code> </pre> <br>  Nous avons donc obtenu la normale au segment. <br><br>  normal = normal.y&gt; 0?  normal: -normal;  - cette op√©ration est charg√©e de s'assurer que le texte est toujours affich√© au-dessus du vecteur. <br><br>  Il reste ensuite √† le placer au milieu du vecteur et √† le relever normalement √† une distance qui sera magnifique. <br><br><pre> <code class="cs hljs">_Label.transform.localPosition = (_VectorEnd + _VectorStart) / <span class="hljs-number"><span class="hljs-number">2</span></span> + normal * TextOffsetY;</code> </pre> <br>  Le code utilise des positions locales pour que vous puissiez d√©placer la fl√®che r√©sultante. <br><br>  Mais il s'agissait de 2D, mais qu'en est-il de la 3D? <br><br>  En 3D, plus ou moins est le m√™me.  Seule la formule normale diff√®re, car la normale est d√©j√† prise non pas dans le segment, mais dans le plan. <br><br><div class="spoiler">  <b class="spoiler_title">Script pour appareil photo</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SphereCameraController</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Camera _Camera; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> _DistanceFromPlanet = <span class="hljs-number"><span class="hljs-number">10</span></span>; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> _Offset = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> _IsMoving; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Vector3, Vector3, Vector3, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt; OnMove; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetMouseButtonDown(<span class="hljs-number"><span class="hljs-number">0</span></span>) &amp;&amp; !_IsMoving) { RaycastHit hit; Debug.Log(<span class="hljs-string"><span class="hljs-string">"Click"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ray = _Camera.ScreenPointToRay(Input.mousePosition); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Physics.Raycast(ray, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> hit)) { Debug.Log(<span class="hljs-string"><span class="hljs-string">"hit"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> startPosition = _Camera.transform.position; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> right = Vector3.Cross(hit.normal, Vector3.up).normalized; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> endPosition = hit.point + hit.normal * _DistanceFromPlanet + right * _Offset; StartCoroutine(MoveCoroutine(startPosition, endPosition, hit.point + right * _Offset)); OnMove?.Invoke(startPosition, hit.point, hit.normal, _DistanceFromPlanet, _Offset); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveCoroutine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 start, Vector3 end, Vector3 lookAt</span></span></span><span class="hljs-function">)</span></span> { _IsMoving = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> startForward = transform.forward; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> timer = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (timer &lt; Scenario.AnimTime) { transform.position = Vector3.Slerp(start, end, timer / Scenario.AnimTime); transform.forward = Vector3.Slerp(startForward, (lookAt - transform.position).normalized, timer / Scenario.AnimTime); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; timer += Time.deltaTime; } transform.position = end; transform.forward = (lookAt - transform.position).normalized; _IsMoving = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }</code> </pre> <br></div></div><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Votre navigateur ne prend pas en charge la vid√©o HTML5. <source src="https://media.giphy.com/media/bbB1tdbYPoWPKPH7tD/giphy.mp4" type="video/mp4"></video></div></div></div><br>  Dans cet exemple de contr√¥le, la normale √† l'avion est utilis√©e pour d√©caler le point final de la trajectoire vers la droite afin que l'interface ne bloque pas la plan√®te.  Normal dans les graphiques 3D est un produit vectoriel normalis√© de deux vecteurs.  Ce qui est pratique, dans Unity il y a ces deux op√©rations et nous obtenons un beau disque compact: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> right = Vector3.Cross(hit.normal, Vector3.up).normalized;</code> </pre> <br>  Je pense que pour beaucoup de ceux qui pensent que les math√©matiques ne sont pas n√©cessaires et pourquoi vous devez le savoir, il est devenu un peu plus clair quels probl√®mes peuvent √™tre r√©solus avec cela simplement et avec √©l√©gance.  Mais c'√©tait une option simple que chaque d√©veloppeur de jeu ne devrait pas conna√Ætre en tant que stagiaire.  √âlevez la barre - parlez des int√©grales. <br><br>  <b>Int√©grales</b> <br><br>  En g√©n√©ral, les int√©grales ont de nombreuses applications, telles que: les simulations physiques, les effets visuels, l'analyse et bien plus encore.  Je ne suis pas pr√™t √† tout d√©crire en d√©tail maintenant.  Je veux d√©crire un simple et visuellement compr√©hensible.  Parlons de physique. <br><br>  Supposons qu'il y ait une t√¢che - d√©placer un objet vers un certain point.  Par exemple, lorsque vous entrez un certain d√©clencheur, les livres des √©tag√®res doivent s'envoler.  Si vous voulez vous d√©placer uniform√©ment et sans physique, alors la t√¢che est triviale et ne n√©cessite pas d'int√©grales, mais lorsqu'un fant√¥me pousse un livre hors d'une √©tag√®re, une telle distribution de vitesse sera compl√®tement diff√©rente. <br><br>  Qu'est-ce qu'une int√©grale? <br><br>  En fait, c'est l'aire sous la courbe.  Mais qu'est-ce que cela signifie dans le contexte de la physique?  Supposons que vous ayez une distribution de vitesse dans le temps.  Dans ce cas, la zone sous la courbe est le chemin que traversera l'objet, et c'est exactement ce dont nous avons besoin. <br><br><img src="https://habrastorage.org/webt/v2/j1/fi/v2j1firdsma31y_gey3e6kmquok.png"><br><br>  Passer de la th√©orie √† la pratique, Unity a un excellent outil appel√© AnimationCurve.  En l'utilisant, vous pouvez sp√©cifier la distribution de la vitesse dans le temps.  Cr√©ons une telle classe. <br><br><div class="spoiler">  <b class="spoiler_title">classe MoveObj</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; [RequireComponent(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Rigidbody))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MoveObject</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Transform _Target; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> GraphData _Data; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Rigidbody _Rigidbody; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _Rigidbody = GetComponent&lt;Rigidbody&gt;(); Move(<span class="hljs-number"><span class="hljs-number">2f</span></span>, _Data.AnimationCurve); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Move</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> time, AnimationCurve speedLaw</span></span></span><span class="hljs-function">)</span></span> { StartCoroutine(MovingCoroutine(time, speedLaw)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MovingCoroutine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> time, AnimationCurve speedLaw</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> timer = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dv = (_Target.position - transform.position); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> distance = dv.magnitude; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> direction = dv.normalized; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> speedK = distance / (Utils.GetApproxSquareAnimCurve(speedLaw) * time); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (timer &lt; time) { _Rigidbody.velocity = speedLaw.Evaluate(timer / time) * direction * speedK; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">yield</span></span></span><span class="hljs-function"> return new </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WaitForFixedUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; timer += Time.fixedDeltaTime; } _Rigidbody.isKinematic = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } }</code> </pre> <br></div></div><br>  La m√©thode GetApproxSquareAnimCurve est notre int√©gration.  Nous en faisons la m√©thode num√©rique la plus simple, il suffit de parcourir les valeurs des fonctions et de les r√©sumer un certain nombre de fois.  J'ai mis 1000 pour la fid√©lit√©, en g√©n√©ral, vous pouvez choisir le meilleur. <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Iterations = <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetApproxSquareAnimCurve</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">AnimationCurve curve</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> square = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt;= Iterations; i++) { square += curve.Evaluate((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) i / Iterations); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> square / Iterations; }</code> </pre> <br>  Gr√¢ce √† cette zone, nous savons d√©j√† quelle est la distance relative.  Et puis en comparant les deux chemins parcourus, nous obtenons le coefficient de vitesse speedK, qui est responsable de s'assurer que nous marchons sur la distance donn√©e. <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Votre navigateur ne prend pas en charge la vid√©o HTML5. <source src="https://media.giphy.com/media/yxfjOIjg8k9agGpCZ9/giphy.mp4" type="video/mp4"></video></div></div></div><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Votre navigateur ne prend pas en charge la vid√©o HTML5. <source src="https://media.giphy.com/media/azI2ni7K6kwFr3LHDw/giphy.mp4" type="video/mp4"></video></div></div></div><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Votre navigateur ne prend pas en charge la vid√©o HTML5. <source src="https://media.giphy.com/media/t8XCi5GR2uiat4vfQ4/giphy.mp4" type="video/mp4"></video></div></div></div><br>  Vous pouvez remarquer que les objets ne correspondent pas exactement, cela est d√ª √† une erreur de flottement.  En g√©n√©ral, vous pouvez recalculer la m√™me chose en d√©cimal, puis d√©passer en flottant pour une plus grande pr√©cision. <br><br>  En fait, c'est tout pour aujourd'hui.  Comme toujours, √† la fin, il y a un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lien vers le projet GitHub</a> , dans lequel se trouvent toutes les sources de cet article.  Et vous pouvez jouer avec eux. <br><br>  Si l'article arrive, je ferai une suite dans laquelle je vous parlerai de l'utilisation de concepts l√©g√®rement plus complexes, tels que des nombres complexes, des champs, des groupes, etc. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr430146/">https://habr.com/ru/post/fr430146/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr430136/index.html">Comment ils vont lancer Starlink - Internet par satellite √† partir de Ilona Mask</a></li>
<li><a href="../fr430138/index.html">Optimiser un robot de trading: un algorithme g√©n√©tique</a></li>
<li><a href="../fr430140/index.html">Cinq raisons de l'√©chec du r√©f√©rencement. Analyse de l'exp√©rience de promotion infructueuse avec des exemples</a></li>
<li><a href="../fr430142/index.html">Votre Windows est-il si vieux?</a></li>
<li><a href="../fr430144/index.html">Nous simulons une rivi√®re r√©aliste dans Houdini et Unreal Engine 4</a></li>
<li><a href="../fr430148/index.html">Fuite de donn√©es personnelles des MFC de Moscou</a></li>
<li><a href="../fr430152/index.html">Mettre votre propre amplificateur audio de qualit√© professionnelle n'est pas (tr√®s) cher</a></li>
<li><a href="../fr430154/index.html">La ¬´renaissance de l'IA¬ª n'est rien d'autre que du mat√©riel co√ªteux et de la publicit√© abandonn√©e pour mettre en ≈ìuvre une vieille id√©e</a></li>
<li><a href="../fr430156/index.html">¬´D√©collez ou pas¬ª: un nouveau lecteur appara√Ætra sur le march√© des services de streaming vid√©o</a></li>
<li><a href="../fr430158/index.html">10 commandements de s√©curit√© qui pourraient √™tre utiles √† toute organisation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>