<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëäüèø üëæ üë©üèº Comment rendre votre infrastructure informatique ennuyeuse üÜò ü§¢ ‚ò™Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Michael DeHaan est l'homme qui a cr√©√© Ansible. Beaucoup de choses que les administrateurs syst√®me, les ing√©nieurs des versions et DevOps font r√©guli√®r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment rendre votre infrastructure informatique ennuyeuse</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/redhatrussia/blog/412725/">  Michael DeHaan est l'homme qui a cr√©√© Ansible.  Beaucoup de choses que les administrateurs syst√®me, les ing√©nieurs des versions et DevOps font r√©guli√®rement sont, pour le moins, sans int√©r√™t.  DeHaan veut que ces personnes lib√®rent leur temps pour des choses plus int√©ressantes (au travail ou devant la porte du bureau) et √©crivent un code produit qui lib√®re du temps d'administrateur. <br>  Plus de temps, moins d'adr√©naline pendant les heures de bureau, moins de scripts et moins d'erreurs. <br>  √Ä propos, vous pouvez terminer la lecture de ce paragraphe en vous connectant √† la diffusion en direct le 6 juin <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br><img src="https://habrastorage.org/webt/4p/xi/b6/4pxib6asllealgf8sje7orcjsbg.png" width="100%"><br><a name="habracut"></a><br>  Si vous continuiez √† lire ... <br><br><h3>  Ansible: int√©gration et livraison continues </h3><br>  Ansible est un puissant langage d'automatisation open source.  Oui, c'est formidable non seulement pour la gestion, mais aussi pour le d√©ploiement et l'orchestration des syst√®mes informatiques.  Ansible a √©t√© initialement cr√©√© pour r√©soudre efficacement un large √©ventail de t√¢ches d'automatisation et comme base universelle simple pour remplacer les commandes traditionnelles, mais il s'est finalement av√©r√© tr√®s utile dans de nombreux domaines.  Par exemple, tout en garantissant z√©ro temps d'arr√™t lors de l'int√©gration continue et de la livraison des applications (CI / CD).  Habituellement, ce probl√®me est r√©solu gr√¢ce au raffinement extensif des logiciels, √† l'utilisation de divers progiciels et √† de nombreuses astuces propres √† chaque configuration sp√©cifique.  Ansible a √©t√© initialement con√ßu sp√©cifiquement pour de tels sc√©narios d'orchestration et propose une solution cl√© en main "tout en un". <br><br><h3>  Int√©gration continue et livraison d'applications (CI / CD) </h3><br>  Quelques v√©rit√©s communes.  La pratique de d√©veloppement de syst√®mes logiciels au cours des 10 derni√®res ann√©es montre que le cycle de vie long des versions logicielles (mod√®le de d√©veloppement en cascade) a des frais g√©n√©raux beaucoup plus √©lev√©s par rapport √† un cycle court (le d√©veloppement dit "it√©ratif" ou agile).  Il s'agit d'arythmie: lorsque les programmeurs commencent √† peine √† travailler sur une nouvelle version, il n'y a tout simplement rien √† faire pour le personnel informatique responsable des tests et du d√©ploiement.  Mais plus la version est proche de la version, plus les informaticiens sont occup√©s et le plus souvent les programmeurs doivent changer de contexte, alternant entre travailler sur les bugs et planifier la prochaine version. <br><br><img src="https://habrastorage.org/webt/qv/sl/b1/qvslb1fsnltkxftsz2hxtgebghg.png" align="right">  De plus, un long cycle augmente l'intervalle entre l'identification et l'√©limination des erreurs et des d√©fauts logiciels, ce qui est particuli√®rement critique pour les grands syst√®mes Web avec une audience d'utilisateurs de plusieurs millions de dollars.  Par cons√©quent, l'industrie du logiciel adopte rapidement des m√©thodologies agiles sous le slogan ¬´publier plus rapidement et plus souvent¬ª afin que les participants au processus de d√©veloppement puissent changer leur contexte de travail moins souvent et cr√©er, d√©boguer et mettre en ≈ìuvre des am√©liorations et des innovations beaucoup plus rapidement. <br><br>  L'automatisation du contr√¥le qualit√©, le d√©veloppement TDD par le biais de tests et d'autres techniques connexes augmentent encore l'efficacit√© des nouvelles m√©thodes de travail.  O√π est l'automatisation?  O√π sont les technologies qui font tourner les engrenages plus rapidement et r√©duisent la participation humaine au strict n√©cessaire? <br><br>  Et ici, par exemple, Ansible et Ansible Tower de Red Hat pour orchestrer des syst√®mes informatiques dans le cadre de processus de d√©veloppement logiciel modernes. <br><br><h3>  Aucun temps d'arr√™t </h3><br>  Un peu plus √©vident.  Les temps d'arr√™t signifient une perte de profits et des clients insatisfaits.  Par cons√©quent, dans les syst√®mes de files d'attente Web, dont les utilisateurs sont r√©partis sur tous les fuseaux horaires, l'arr√™t planifi√© n'est autoris√© que dans des cas vraiment graves, dont la liste n'inclut pas explicitement la mise √† jour des versions d'application.  La situation est similaire dans les environnements d'entreprise o√π l'inaccessibilit√© d'un intranet ou d'un syst√®me comptable r√©duit consid√©rablement la productivit√© des employ√©s.  Ainsi, toute automatisation de processus doit fournir des mises √† jour sans interrompre les op√©rations - en d'autres termes, sans temps d'arr√™t. <br><br>  Il est tout √† fait possible d'obtenir un temps d'arr√™t nul, mais pour cela, nous avons besoin d'outils appropri√©s - tels que pour fournir une orchestration avanc√©e, √† plusieurs niveaux et √† plusieurs √©tapes, comme, par exemple, le syst√®me Ansible. <br><br><h3>  Syst√®mes de cr√©ation d'applications </h3><br>  La livraison continue (CD) commence par l'int√©gration continue (CI).  Un syst√®me qui surveille les r√©f√©rentiels de code source pour les modifications, ex√©cute ind√©pendamment les tests correspondants et cr√©e automatiquement (et id√©alement teste) une nouvelle version de l'application avec chaque mise √† jour de code, par exemple, le projet Jenkins (jenkins.io). <br><br>  Pour relayer le t√©moin au syst√®me de CD apr√®s avoir correctement assembl√© la nouvelle version de l'application, le sous-syst√®me de construction du syst√®me CI peut appeler Ansible pour fournir imm√©diatement cette nouvelle version √† ceux qui effectuent des tests unitaires ou d'int√©gration.  En particulier, Jenkins peut utiliser Tower pour d√©ployer des assemblages dans divers environnements, et l'environnement de test ou interm√©diaire peut √™tre mod√©lis√© sur la base de l'environnement de production, ce qui am√©liore consid√©rablement la pr√©visibilit√© tout au long du cycle de vie du logiciel.  Les donn√©es renvoy√©es par Ansible √† partir des r√©sultats de l'ex√©cution des scripts d'automatisation peuvent √™tre directement impliqu√©es dans les jobs Build Systems du syst√®me Tower.  En fait, Tower vous permet m√™me de tester des sc√©narios de d√©ploiement dans un environnement interm√©diaire avant de les ex√©cuter sur des serveurs "de combat". <br><br><h3>  Mise √† jour d'application multiniveau une par une </h3><br>  Le syst√®me de CD doit √™tre capable d'orchestrer les processus de mise √† jour continue des applications multiniveaux.  Gr√¢ce √† l'architecture push et aux capacit√©s d'orchestration multi-niveaux multi-niveaux, Ansible peut faire face √† cette t√¢che en mettant √† jour n'importe quelle application niveau par niveau, tout en √©changeant des donn√©es entre elles. <br><br>  Pour impl√©menter les mises √† jour une par une, Ansible utilise des scripts Play qui vous permettent de sp√©cifier avec pr√©cision le groupe d'h√¥tes cibles et d'affecter des t√¢ches (r√¥le) qui doivent √™tre effectu√©es sur eux.  Les t√¢ches sont g√©n√©ralement des annonces selon lesquelles une ressource informatique sp√©cifique doit √™tre dans un √©tat donn√©, par exemple, pour une version d'un logiciel, un certain package doit √™tre install√©, et pour une autre, il est n√©cessaire de v√©rifier le r√©f√©rentiel de code.  Les topologies d'application Web, en r√®gle g√©n√©rale, n√©cessitent de les mettre √† jour dans un ordre strict, et vous ne pouvez toujours pas mettre √† jour les applications et les configurations syst√®me sur toutes les machines en m√™me temps. <br><br>  Lorsque le service est red√©marr√©, il reste indisponible pendant un certain temps et le remplacement de la version de l'application ne se produit pas non plus instantan√©ment.  Par cons√©quent, avant de mettre √† jour le syst√®me, nous le retirons du pool d'√©quilibrage.  Par cons√©quent, vous devez avoir la possibilit√© d'automatiser les op√©rations de connexion et de d√©connexion des machines du pool.  Est toujours le mot cl√©.  Ansible peut contr√¥ler tr√®s pr√©cis√©ment la taille de la fen√™tre d'une mise √† jour successive.  Eh bien, le d√©veloppement de ces mises √† jour est effectu√© tr√®s soigneusement, et si √† un certain stade une d√©faillance se produit, la mise √† jour est suspendue afin de ne pas d√©sactiver le reste de l'infrastructure informatique. <br><br><h3>  D√©ploiement continu pour les scripts d'automatisation </h3><br>  En plus de la fonctionnalit√© CD pour les services fonctionnant en mode de fonctionnement commercial, vous pouvez √©galement organiser le d√©ploiement continu des scripts d'automatisation eux-m√™mes (jeux d'instructions Ansible Playbook. N'arr√™tez pas la lecture, dans la deuxi√®me partie il y aura des exemples de playbooks).  Cela permet aux administrateurs syst√®me et aux d√©veloppeurs de g√©rer les scripts √† l'aide du r√©f√©rentiel de code source, de tester ces scripts dans un environnement interm√©diaire et de les transf√©rer automatiquement vers l'environnement de production en cas de rodage r√©ussi.  En d'autres termes, lorsque vous travaillez avec des scripts, vous b√©n√©ficiez de tous les avantages m√©thodologiques et autres du r√©f√©rentiel de code central auquel vous √™tes habitu√© lors du d√©veloppement de logiciels. <br><br>  Apporter des modifications aux configurations logicielles et syst√®me est l'une des principales raisons des pannes impr√©vues.  Par cons√©quent, en plus des tests automatis√©s, il existe un contr√¥le humain.  Il peut √™tre organis√© en s'int√©grant √† un syst√®me d'inspection de code comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Gerrit</a> , et n'appliquer les modifications qu'apr√®s avoir √©t√© approuv√© par les camarades responsables. <br><br><h3>  Mises √† jour et syst√®mes d'√©quilibrage de charge alternatifs </h3><br>  Ansible fonctionne de mani√®re tr√®s ind√©pendante avec les syst√®mes d'√©quilibrage de charge lors de l'ex√©cution de mises √† jour successives.  Par cons√©quent, vous pouvez simplement √©crire dans un script Playbook, dans n'importe quel cycle pour un groupe d'h√¥tes, quelque chose comme "effectuer cette action sur le syst√®me X au nom de l'h√¥te Y", et Ansible se chargera du reste. <br><br>  Ansible interagit bien avec les √©quilibreurs de charge de toutes sortes et est en mesure de d√©finir un indicateur pour d√©connecter temporairement un h√¥te afin de d√©sactiver la surveillance de la disponibilit√© pour lui pendant la p√©riode de mise √† jour.  Le sch√©ma simple "d√©sactiver la surveillance - retirer du pool - mettre √† jour le niveau de logiciel souhait√© - revenir au pool - activer la surveillance" impl√©mente facilement une mise √† jour s√©quentielle avec z√©ro temps d'arr√™t et sans fausses alarmes.  Et tout cela en mode enti√®rement automatis√©, sans intervention de l'op√©rateur. <br><br><h3>  Tests interm√©diaires int√©gr√©s </h3><br>  Tower peut fonctionner avec diff√©rents fichiers d'inventaire de ressources (Inventaire), ce qui facilite le test de sc√©narios de mise √† jour successifs dans un environnement interm√©diaire avant de les ex√©cuter sur des serveurs "de combat".  Pour ce faire, il suffit de simuler l'environnement de production dans l'environnement de test, d'ex√©cuter Ansible avec le param√®tre ¬´-i¬ª et d'indiquer quel fichier d'inventaire doit √™tre utilis√© lors de l'ex√©cution du script - pour l'environnement de test ou pour l'environnement de production.  Le script lui-m√™me n'a pas besoin d'√™tre modifi√©. <br><br><h3>  D√©ploiement du contr√¥le de version </h3><br>  Certaines personnes aiment emballer des applications avec des packages de syst√®me d'exploitation (RPM, debs, etc.) plus chaud, mais souvent, en particulier pour les applications Web, un tel empaquetage n'est pas n√©cessaire.  Par cons√©quent, Ansible comprend plusieurs modules pour d√©ployer des applications directement √† partir de syst√®mes de contr√¥le de version.  Dans le script Playbook, vous pouvez √©crire une r√©conciliation avec le r√©f√©rentiel de codes pour la balise ou le num√©ro de version sp√©cifi√©, apr√®s quoi Ansible v√©rifiera cette condition sur tous les serveurs cibles et activera les √©tapes suivantes uniquement si la version doit √™tre remplac√©e, √©liminant ainsi les red√©marrages de service inutiles. <br><br><h3>  Int√©gration avec des outils de surveillance </h3><br>  En tant que syst√®me d'orchestration √† part enti√®re, Ansible prend en charge l'int√©gration avec les syst√®mes de gestion des performances des applications bas√©es sur APM au niveau de la surveillance.  Par exemple, pendant la phase de test de d√©ploiement ou d'int√©gration, vous devez installer ou mettre √† niveau l'agent logiciel APM avec l'application.  Ansible a un r√¥le sp√©cial pour cela, et apr√®s avoir install√© et activ√© l'agent, Ansible peut le configurer dans la pile de surveillance APM (s'il n'est pas d√©j√† configur√©) afin que les gestionnaires d'applications puissent imm√©diatement v√©rifier que la nouvelle version a √©t√© install√©e et fonctionne sans probl√®me . <br><br>  En cas de probl√®me apr√®s la mise √† jour de l'application dans l'environnement de production, les outils de surveillance peuvent appeler Ansible pour revenir √† la version pr√©c√©dente.  Bien s√ªr, seulement si un tel retour en arri√®re est autoris√©. <br><br><h3>  Notification d'√©v√©nement </h3><br>  Dans le paradigme CI / CD, tout le monde veut recevoir les notifications d'√©v√©nements le plus rapidement possible.  Ansible offre √† la fois des fonctions int√©gr√©es, y compris un module de messagerie √©lectronique, ainsi qu'une int√©gration avec des outils de notification externes, tels que les messageries instantan√©es, les r√©seaux sociaux ou les syst√®mes d'enregistrement d'√©v√©nements. <br><br><h3>  D√©ploiement √† l'aide d'un mod√®le d'√©tat des ressources </h3><br>  L'une des principales caract√©ristiques d'Ansible, qui en fait un outil tr√®s utile pour le d√©ploiement d'applications, est l'utilisation r√©guli√®re du mod√®le d'√©tat des ressources dans les processus de mise √† jour logicielle, qui a gagn√© en popularit√© dans la gestion des configurations syst√®me.  Contrairement aux contr√¥les open source traditionnels, Ansible n'a pas besoin d'√™tre √©quip√© d'un logiciel suppl√©mentaire ou de scripts sp√©ciaux pour organiser la livraison des applications. <br><br>  Dans Ansible, vous pouvez tr√®s pr√©cis√©ment enregistrer et contr√¥ler l'ordre des √©v√©nements √† diff√©rents niveaux architecturaux, ce qui vous permet de d√©l√©guer des actions √† d'autres syst√®mes, ainsi que de combiner les directives du mod√®le de ressource (comme ¬´le package X doit √™tre dans l'√©tat Y¬ª) et les commandes de script traditionnelles (comme ¬´ex√©cuter le script¬ª .sh ") dans un m√™me processus. <br><br>  Ansible facilite √©galement l'ex√©cution de v√©rifications de diverses conditions et la prise de d√©cisions en fonction de leurs r√©sultats.  La combinaison des processus de configuration du syst√®me et de d√©ploiement d'applications au sein d'une cha√Æne d'outils unique est beaucoup plus efficace qu'un sch√©ma avec plusieurs outils sp√©cialis√©s et, en outre, augmente la coh√©rence des politiques et des applications du syst√®me d'exploitation. <br><br><h3>  Test de d√©ploiement </h3><br>  Plus il y a d'opportunit√©s, plus la responsabilit√© est √©lev√©e.  L'automatisation des processus de livraison continue augmente consid√©rablement le risque de d√©ployer une configuration d√©faillante sur tous les n≈ìuds du syst√®me.  Pour r√©duire les risques, Ansible sugg√®re d'ins√©rer des tests de contr√¥le dans le script, ce qui interrompra la mise √† jour s√©quentielle en cas de probl√®me.  Pour tester diverses conditions, y compris l'√©tat du fonctionnement des services, vous pouvez d√©ployer des tests arbitraires √† l'aide des modules de commande ou de script, et m√™me cr√©er de tels tests en tant que modules Ansible distincts. <br><br>  Le module Fail peut interrompre l'ex√©cution du script sur l'h√¥te √† tout moment, ce qui vous permet de d√©tecter les √©checs √† un stade pr√©coce de la mise √† jour s√©quentielle.  Par exemple, du fait de la diff√©rence entre l'environnement interm√©diaire et l'environnement de production, ce dernier g√©n√®re une erreur de configuration qui d√©sactive les serveurs ¬´combat¬ª.  Dans ce cas, une issue de secours peut √™tre enregistr√©e dans le script Playbooks √† la premi√®re √©tape de la mise √† jour s√©quentielle.  Et si vous avez 100 serveurs et que la taille de la fen√™tre de mise √† jour successive est de 10, un tel arr√™t d'urgence vous donnera le temps de le comprendre calmement, de corriger le script et de continuer la mise √† jour. <br><br>  En cas de panne, Ansible ne continue pas de fonctionner, laissant les syst√®mes dans un √©tat semi-configur√©, et g√©n√®re une erreur pour attirer l'attention de l'op√©rateur et lui dire quels h√¥tes le cycle de mise √† jour s'est accompagn√© d'erreurs et combien de modifications ont √©t√© apport√©es sur chaque plateforme.  Ansible a un mode d'ex√©cution de simulation, lorsque le syst√®me g√©n√®re un rapport sur les modifications qui auraient √©t√© apport√©es si le script avait √©t√© ex√©cut√© sans sa v√©ritable ex√©cution. <br><br><h3>  Contr√¥le de conformit√© </h3><br>  Il existe des environnements o√π les configurations ne changent que lorsqu'il n'y a aucun moyen sans cela.  Tout changement dans de tels environnements est pr√©-analys√©.  Il utilise des syst√®mes de livraison continue ¬´avec r√©serves¬ª. <br><br>  Ansible a un mode d'ex√©cution de simulation (activ√© par le drapeau ¬´--check¬ª), lorsque le syst√®me g√©n√®re un rapport sur les modifications qui seraient apport√©es lors de l'ex√©cution du script.  Dans ce cas, l'ex√©cution r√©elle du script ne se produit pas, la simulation ne permet pas de d√©tecter les erreurs, mais aide √† mieux comprendre et analyser les d√©tails et les r√©sultats des modifications propos√©es. <br><br>  D'un autre c√¥t√©, m√™me avec le d√©ploiement continu de nouveaux assemblages, Ansible vous permet d'effectuer des contr√¥les de conformit√© beaucoup plus souvent pour saisir le moment o√π certaines choses dans l'environnement de production changent √† la suite d'une intervention humaine et doivent √™tre corrig√©es en ex√©cutant le script Ansible correspondant, par exemple, pour changer version du logiciel, ajuster les autorisations, etc. <br><br><h3>  D√©ploiement du pilote automatique </h3><br>  Si vous vivez dans un monde d'orchestration √† plusieurs niveaux et √† plusieurs niveaux de processus de mise √† jour logicielle s√©quentielle avec aucun temps d'arr√™t, le CI / CD est probablement ex√©cut√© exclusivement par les op√©rateurs (√† la fois manuellement et avec une automatisation partielle) et n√©cessite, comme dans une danse ronde, des actions coordonn√©es de tous les participants au processus.  Ansible ainsi que son architecture unique et l'absence d'agents logiciels sur les h√¥tes cibles (augmentant la s√©curit√© et √©liminant le besoin de g√©rer le syst√®me de gestion lui-m√™me) peuvent facilement d√©crire et automatiser facilement les processus de d√©ploiement complexes, c'est-√†-dire qu'Ansible impl√©mente ici le mode de pilote automatique complet. <br><br>  Des exemples de scripts d'automatisation Ansible peuvent √™tre trouv√©s sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub</a> , et maintenant nous allons donner une base et un exemple de la fa√ßon d'√©crire un script Playbook qui peut √™tre ex√©cut√© dans Ansible ou Ansible Tower.  Avec une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">liste de modules</a> et d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">autres documents,</a> elle vous aidera √† apprendre √† cr√©er vos propres scripts Playbooks. <br><br><h3>  Qu'est-ce qu'un playbook? </h3><br>  Un script Playbook est essentiellement un ensemble de lectures qui est envoy√© pour s'ex√©cuter sur un seul h√¥te distant ou groupe d'h√¥tes.  C'est comme un guide d'assemblage de meubles IKEA: suivez exactement les instructions et obtenez exactement ce que vous avez vu dans le magasin.  C‚Äôest ainsi que fonctionnent les scripts. <br><br><h3>  Modules </h3><br>  Nous allons cr√©er un Playbook qui installera le serveur Web sur l'h√¥te RHEL / CentOS 7 et cr√©era un fichier index.html sur celui-ci en fonction du mod√®le sp√©cifi√© dans le script.  L'exemple de script pr√©sent√© ici est enti√®rement op√©rationnel et pr√™t √† l'emploi.  Ci-dessous, nous allons voir un exemple de script Playbook et montrer comment utiliser les modules. <br><br><h3>  Auteurs (Auteurs) </h3><br>  Un auteur est quelqu'un qui cr√©e des instructions qui seront ex√©cut√©es par des modules (souvent avec des valeurs suppl√©mentaires: arguments, emplacements, etc.).  Les modules sont ex√©cut√©s sur l'h√¥te cible dans l'ordre dans lequel ils suivent dans le script Playbook (y compris include'y et les autres fichiers suppl√©mentaires qui y sont inclus).  L'√©tat de l'h√¥te change (ou ne change pas) en fonction des r√©sultats de l'ex√©cution du module, qui sont affich√©s sous forme de sortie Ansible et Tower. <br><br><h3>  Ex√©cution du script Playbook </h3><br>  Tout d'abord, vous devez savoir certaines choses sur l'ex√©cution des scripts Playbook.  Playbook est une sorte de syst√®me symbolique qui informe le module de la n√©cessit√© d'effectuer une t√¢che.  Pour lancer votre Playbook avec succ√®s, il est important de comprendre les points suivants: <br><br>  <b>1. Syst√®me cible (cible)</b> <br>  √âtant donn√© que les scripts Playbook fournissent des instructions et interagissent avec les modules, Ansible croit que vous comprenez ce que vous essayez de faire et qu'il automatise simplement.  C'est pourquoi nous disons que les Playbooks sont comme des instructions ou des directions: vous dites aux √©l√©ments automatis√©s comment vous souhaitez configurer la t√¢che.  Mais en m√™me temps, vous devez vous-m√™me tr√®s bien comprendre comment l'h√¥te cible sur lequel le script Playbook s'ex√©cute fonctionne. <br><br>  <b>2. T√¢ches</b> <br>  Si vous devez d√©marrer un serveur Web dans une partie du Playbook, vous devez comprendre comment cela se fait afin de savoir quel module de service utiliser pour cela et d√©marrer le serveur Web par son nom.  Si le Playbook installe le package logiciel, vous devez savoir comment proc√©der sur l'h√¥te cible.  Vous devez √©galement comprendre, au moins au niveau de base, l'essence des t√¢ches effectu√©es.  Une configuration d'h√¥te suppl√©mentaire est-elle requise pour le logiciel que vous souhaitez installer?  Existe-t-il des branches en fonction des conditions et des valeurs des arguments?  Si des variables sont pass√©es dans le processus, vous devez comprendre exactement quoi et pourquoi. <br><br>  <b>Exemple de script Playbook</b> <br>  L'exemple de script Playbook suivant vous aidera √† comprendre ce que vous venez de lire.  L'h√¥te cible est le serveur RHEL / CentOS 7, sur lequel notre script installe le serveur Web NGINX, puis cr√©e le fichier index.html dans le r√©pertoire webroot par d√©faut.      ,   -. <br><br> <i>*:      Playbook  Ansible Tower    inventory  .</i> <br><br> Playbooks     YAML (---),   : <br><br> <b>Name</b> :   ,    Playbook. <br><br> <b>Hosts</b> :   ,     Ansible. <br><br> <b>Become</b> :     ,  ,  nginx    (    ). <br><br><pre><code class="hljs css">1 <span class="hljs-selector-tag"><span class="hljs-selector-tag">---</span></span> 2 <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">name</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Install</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">nginx</span></span> 3 <span class="hljs-selector-tag"><span class="hljs-selector-tag">hosts</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">host</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.name</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ip</span></span> 4 <span class="hljs-selector-tag"><span class="hljs-selector-tag">become</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">true</span></span></code> </pre> <br>  Avec l'indentation comme les trois lignes pr√©c√©dentes, il y a les <b>t√¢ches</b> : directive, apr√®s quoi, avec une indentation suppl√©mentaire (selon les r√®gles d'imbrication YAML), les t√¢ches sont r√©pertori√©es (jeux).  Dans cet exemple, nous avons deux t√¢ches, et les deux utilisent le module Yum.  La premi√®re t√¢che ajoute un r√©f√©rentiel epel-release afin que vous puissiez installer nginx.  Une fois epel affich√© sur le syst√®me, la deuxi√®me t√¢che installe le package nginx. <br><br>  La directive <b>state</b> : signifie qu'Ansible doit v√©rifier l'√©tat de l'h√¥te cible avant d'effectuer d'autres actions.  Dans notre exemple, s'il existe d√©j√† un r√©f√©rentiel ou nginx sur l'h√¥te, Ansible comprend qu'il n'est pas n√©cessaire d'effectuer ces deux t√¢ches et passe aux √©tapes suivantes. <br><br><pre> <code class="hljs sql">1 tasks: 2 - name: Add epel-<span class="hljs-keyword"><span class="hljs-keyword">release</span></span> repo <span class="hljs-number"><span class="hljs-number">3</span></span> yum: <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: epel-<span class="hljs-keyword"><span class="hljs-keyword">release</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> state: <span class="hljs-keyword"><span class="hljs-keyword">present</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Install</span></span> nginx <span class="hljs-number"><span class="hljs-number">8</span></span> yum: <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: nginx <span class="hljs-number"><span class="hljs-number">10</span></span> state: <span class="hljs-keyword"><span class="hljs-keyword">present</span></span></code> </pre> <br>  La page de t√©l√©chargement, qui est utilis√©e par d√©faut dans nginx, est id√©ale pour v√©rifier que nginx s'est correctement install√©, mais vous voudrez probablement le faire avec votre fichier html de d√©marrage.  Dans cet exemple, par souci de simplicit√©, le mod√®le de fichier d'index se trouve dans le m√™me r√©pertoire o√π le Playbook d√©marre.  La destination est juste le chemin par d√©faut dans nginix avec aucun site configur√©. <br><br><pre> <code class="hljs pgsql"><span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Index</span></span> Page <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span> src: <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.html <span class="hljs-number"><span class="hljs-number">4</span></span> dest: /usr/<span class="hljs-keyword"><span class="hljs-keyword">share</span></span>/nginx/html/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.html</code> </pre> <br>  La derni√®re ligne de notre Playbook sert uniquement √† v√©rifier que le service nginx a √©t√© d√©marr√© avec succ√®s (ou √† le d√©marrer sinon). <br><br><pre> <code class="hljs pgsql"><span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Start</span></span> NGiNX <span class="hljs-number"><span class="hljs-number">2</span></span> service: <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>: nginx <span class="hljs-number"><span class="hljs-number">4</span></span> state: started</code> </pre> <br>  L'ensemble du script Playbook √©tait √† peu pr√®s de la m√™me longueur que le paragraphe d'ouverture de ce post: <br><br><pre> <code class="hljs delphi"><span class="hljs-number"><span class="hljs-number">1</span></span> --- <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: Install nginx <span class="hljs-number"><span class="hljs-number">3</span></span> hosts: host.<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>.ip <span class="hljs-number"><span class="hljs-number">4</span></span> become: true <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> tasks: <span class="hljs-number"><span class="hljs-number">7</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: Add epel-release repo <span class="hljs-number"><span class="hljs-number">8</span></span> yum: <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: epel-release <span class="hljs-number"><span class="hljs-number">10</span></span> state: present <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: Install nginx <span class="hljs-number"><span class="hljs-number">13</span></span> yum: <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: nginx <span class="hljs-number"><span class="hljs-number">15</span></span> state: present <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: Insert <span class="hljs-keyword"><span class="hljs-keyword">Index</span></span> Page <span class="hljs-number"><span class="hljs-number">18</span></span> template: <span class="hljs-number"><span class="hljs-number">19</span></span> src: <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.html <span class="hljs-number"><span class="hljs-number">20</span></span> dest: /usr/share/nginx/html/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.html <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: Start NGiNX <span class="hljs-number"><span class="hljs-number">23</span></span> service: <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: nginx <span class="hljs-number"><span class="hljs-number">25</span></span> state: started</code> </pre> <br><h3>  R√©sum√© </h3><br>  Les scripts Playbook sont un moyen facile et pratique de faire beaucoup de choses avec un peu de code.  Dans l'exemple ci-dessus, nous avons utilis√© trois modules - yum, mod√®le et service, pour installer le r√©f√©rentiel et le package logiciel sur le serveur, cr√©er un fichier √† partir du mod√®le local, puis d√©marrer le service qui vient d'√™tre install√©.  Dans le m√™me temps, notre script Playbook est sorti un peu plus longtemps que cette offre!  Et bien que nous l'ayons ex√©cut√© sur un seul h√¥te, il pourrait tout aussi bien le faire sur des dizaines et des centaines de serveurs, pour cela, il n'a besoin que de tr√®s petites modifications.  De plus, Tower vous permet de placer un script Playbook dans un mod√®le de t√¢che √† ex√©cuter sur un groupe de serveurs dans le cloud AWS ou dans un centre de donn√©es d'entreprise. <br><br>  Les fonctionnalit√©s architecturales possibles et la possibilit√© de s'int√©grer aux syst√®mes CI, comme Jenkins, automatisent non seulement les processus de gestion de la configuration, mais √©galement une gamme beaucoup plus large de t√¢ches informatiques.  C'est pourquoi nous appelons affectueusement Ansible un syst√®me d'orchestration int√©gr√©, et pas seulement un outil de d√©ploiement de logiciel et de gestion de configuration. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr412725/">https://habr.com/ru/post/fr412725/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr412715/index.html">Apprendre la programmation Go multithread avec des images</a></li>
<li><a href="../fr412717/index.html">Bonjour les √©trangers; s'il te plait ne nous tue pas</a></li>
<li><a href="../fr412719/index.html">MDG annonce un concours de synth√®se vocale</a></li>
<li><a href="../fr412721/index.html">Trois espoirs de l'humanit√© pour la d√©couverte des extraterrestres</a></li>
<li><a href="../fr412723/index.html">√Ä la recherche d'une nouvelle couleur d'un milliard de dollars</a></li>
<li><a href="../fr412727/index.html">Comment choisir un outil de prototypage en 2018?</a></li>
<li><a href="../fr412729/index.html">GDPR. Faut-il l'ex√©cuter en Russie?</a></li>
<li><a href="../fr412735/index.html">Laissez le concours ATM seul les PHDays 8</a></li>
<li><a href="../fr412737/index.html">Protection des donn√©es personnelles de 3 milliards de personnes - similitudes et diff√©rences de l√©gislation dans les pays BRICS</a></li>
<li><a href="../fr412739/index.html">Chien de berger</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>