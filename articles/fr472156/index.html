<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💗 ♎️ ⛔️ Implémentation du modèle d'objet de page en Python + pytest 🧔🏽 👰🏾 🏆</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quand j'ai commencé à étudier l'automatisation des tests, je ne pouvais pas comprendre - «qu'est-ce que Page Object et comment l'implémenter en Python...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Implémentation du modèle d'objet de page en Python + pytest</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472156/"><p>  Quand j'ai commencé à étudier l'automatisation des tests, je ne pouvais pas comprendre - «qu'est-ce que Page Object et comment l'implémenter en Python + pytest?».  En étudiant Internet, j'ai trouvé une implémentation dans d'autres langages et frameworks: des articles pédagogiques qui m'étaient incompréhensibles.  J'ai donc décidé d'écrire cette analyse.  L'idée est de montrer l'implémentation en Python + pytest et de l'expliquer dans un langage accessible. </p><br><p>  <strong>Qu'est-ce qu'un objet de page</strong> </p><br><p>  Il s'agit d'un modèle populaire qui est la norme de facto dans l'automatisation des tests de produits Web.  L'idée de base est de séparer la logique de test de l'implémentation. </p><br><p>  Chaque page Web de projet peut être décrite comme un objet de classe.  L'interaction utilisateur est décrite dans les méthodes de classe et seule la logique métier reste dans les tests.  Cette approche permet d'éviter les problèmes de tests lors de la modification de la présentation d'une application Web.  Vous devez corriger uniquement la classe qui décrit la page. <a name="habracut"></a></p><br><p>  L'objet Page définit les parties: </p><br><ul><li>  Page de base \ Classe de base - Implémente les méthodes nécessaires pour travailler avec le pilote Web. </li><li>  Page Object \ Page Class - Implémente des méthodes pour travailler avec des éléments sur des pages Web. </li><li>  Tests - Implémente les tests décrits par la logique métier du scénario de test. </li></ul><br><p> <em>Schéma du modèle d'objet de page.</em> <br><img src="https://habrastorage.org/getpro/habr/post_images/65b/a48/f96/65ba48f96f103448e75b8df25ab4dd63.png" alt="image"><br>  Pour expliquer clairement le sujet, nous implémentons un test automatisé. </p><br><p>  <strong>La partie théorique de la mise en œuvre</strong> </p><br><p>  <em>Étapes</em> : </p><br><ol><li>  L'utilisateur ouvre un navigateur; </li><li>  L'utilisateur entre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://ya.ru/</a> dans la barre d'adresse; </li><li>  L'utilisateur entre le mot «Bonjour» dans la barre de recherche; </li><li>  L'utilisateur clique sur le bouton «Rechercher». </li></ol><br><p>  <em>Résultat attendu</em> : <br>  L'utilisateur est redirigé vers la recherche.  Les résultats de la recherche comportent des sous-éléments (vidéo, photos, etc.). </p><br><p>  <em>Vérifiez</em> : sur la page de recherche, il y a une barre de navigation et des éléments «image» et «vidéo». </p><br><p>  <strong>La partie pratique de la mise en œuvre</strong> </p><br><p>  Pour comprendre l'article, vous devez connaître les constructions de base de Python, OOP, comprendre les principes et les fonctions de Selenium. </p><br><p>  Nous utiliserons les bibliothèques: sélénium et pytest.  Vous pouvez les installer via le gestionnaire de packages pip. </p><br><pre><code class="plaintext hljs">pip install selenium pip install pytest</code> </pre> <br><p>  N'oubliez pas non plus de télécharger le pilote pour le navigateur.  Cet article utilise un pilote Web Chrome.  Vous pouvez le télécharger <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><strong>ici</strong></a> .  Pour l'utiliser, placez le fichier dans le répertoire racine du projet. </p><br><p>  <strong>Créer un appareil</strong> </p><br><p>  Vous devez d'abord implémenter l'initialisation pour WebDriver.  Nous le décrirons dans les luminaires.  Les fixtures dans pytest sont des fonctions qui ont leur propre périodicité d'exécution. <br>  Il s'agit d'un remplacement alternatif pour les méthodes SetUp et TearDown dans unittest.  À l'aide d'appareils, vous pouvez préparer l'état initial du système pour les tests. </p><br><p>  Dans pytest il y a un nom réservé pour le fichier de fixture - <em>conftest.py</em> . </p><br><p>  Nous créons le fichier conftest.py et implémentons la fonction avec le nom - navigateur. </p><br><p>  Nous le marquons avec le décorateur @ pytest.fixture et passons le paramètre scope avec une valeur de session.  Cela signifie que cette fonction de fixture ne sera exécutée qu'une seule fois par session de test. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> selenium <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> webdriver @pytest.fixture(scope=<span class="hljs-string"><span class="hljs-string">"session"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">browser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> driver = webdriver.Chrome(executable_path=<span class="hljs-string"><span class="hljs-string">"./chromedriver"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> driver driver.quit()</code> </pre> <br><p>  Ensuite, nous décrivons la partie qui sera exécutée avant les tests.  Il initialise le pilote Web avec une indication de l'emplacement du pilote chromé.  Ensuite, nous utilisons la construction yield, qui divise la fonction en parties - avant les tests et après les tests. </p><br><p>  Dans la partie «après les tests», nous appelons la fonction quit, qui termine la session et tue l'instance de webdriver. </p><br><p>  <strong>Page de base</strong> </p><br><p>  Créez le fichier BaseApp.py.  Dans la classe BasePage, nous définissons les méthodes de base pour travailler avec WebDriver. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> selenium.webdriver.support.wait <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> WebDriverWait <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> selenium.webdriver.support <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> expected_conditions <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> EC <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BasePage</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, driver)</span></span></span><span class="hljs-function">:</span></span> self.driver = driver self.base_url = <span class="hljs-string"><span class="hljs-string">"https://ya.ru/"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_element</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, locator,time=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> WebDriverWait(self.driver,time).until(EC.presence_of_element_located(locator), message=<span class="hljs-string"><span class="hljs-string">f"Can't find element by locator </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{locator}</span></span></span><span class="hljs-string">"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_elements</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, locator,time=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> WebDriverWait(self.driver,time).until(EC.presence_of_all_elements_located(locator), message=<span class="hljs-string"><span class="hljs-string">f"Can't find elements by locator </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{locator}</span></span></span><span class="hljs-string">"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">go_to_site</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.driver.get(self.base_url)</code> </pre> <br><p>  Dans la classe BasePage, créez un constructeur qui accepte un pilote - une instance de webdriver.  Spécifiez base_url, qui sera utilisé pour ouvrir la page. </p><br><p>  Ensuite, nous créons les méthodes find_element (recherche un élément et le renvoie) et find_elements (recherche l'ensemble et retourne sous forme de liste). </p><br><p>  Il s'agit d'un wrapper sur WebdriverWait, qui est responsable des attentes explicites dans Selenium. </p><br><p>  Dans la fonction, nous déterminons le temps, qui est par défaut de 10 secondes.  C'est le moment de rechercher l'article.  Méthode Go_to_site - Appelle la fonction get depuis WebDriver.  La méthode vous permet d'accéder à la page indiquée.  Nous lui passons base_url. </p><br><p>  <strong>Objet de page</strong> </p><br><p>  Notre classe de page Web est implémentée dans le fichier YandexPages.py. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> BaseApp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BasePage <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> selenium.webdriver.common.by <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> By <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">YandexSeacrhLocators</span></span></span><span class="hljs-class">:</span></span> LOCATOR_YANDEX_SEARCH_FIELD = (By.ID, <span class="hljs-string"><span class="hljs-string">"text"</span></span>) LOCATOR_YANDEX_SEARCH_BUTTON = (By.CLASS_NAME, <span class="hljs-string"><span class="hljs-string">"search2__button"</span></span>) LOCATOR_YANDEX_NAVIGATION_BAR = (By.CSS_SELECTOR, <span class="hljs-string"><span class="hljs-string">".service__name"</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SearchHelper</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(BasePage)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">enter_word</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, word)</span></span></span><span class="hljs-function">:</span></span> search_field = self.find_element(YandexSeacrhLocators.LOCATOR_YANDEX_SEARCH_FIELD) search_field.click() search_field.send_keys(word) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> search_field <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">click_on_the_search_button</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.find_element(YandexSeacrhLocators.LOCATOR_YANDEX_SEARCH_BUTTON,time=<span class="hljs-number"><span class="hljs-number">2</span></span>).click() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_navigation_bar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> all_list = self.find_elements(YandexSeacrhLocators.LOCATOR_YANDEX_NAVIGATION_BAR,time=<span class="hljs-number"><span class="hljs-number">2</span></span>) nav_bar_menu = [x.text <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> all_list <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(x.text) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nav_bar_menu</code> </pre> <br><p>  Nous créons la classe YandexSeacrhLocators.  Ce ne sera que pour stocker des localisateurs. <br>  Dans la classe, nous décrivons les localisateurs: </p><br><p>  LOCATOR_YANDEX_SEARCH_FIELD - localisateur de chaîne de recherche <br>  LOCATOR_YANDEX_SEARCH_BUTTON - localisateur du bouton "Rechercher" <br>  LOCATOR_YANDEX_NAVIGATION_BAR - localisateur de barre de navigation (photos, vidéos, etc.) </p><br><p>  Créez une classe SearchHelper, héritez de BasePage. </p><br><p>  Nous implémentons des méthodes auxiliaires pour travailler avec la recherche: <br>  enter_word - recherche un élément de la chaîne de recherche, clique et entre le mot souhaité dans la recherche; <br>  click_on_the_search_button - Recherche un élément du bouton de recherche et clique dessus; <br>  check_navigation_bar - Recherche des éléments de navigation et obtient l'attribut text.  Crée une liste et filtre par condition.  Si la longueur de la chaîne est supérieure à zéro, ajoute alors l'élément à la liste.  Par exemple, redéfinissez l'heure par défaut en la définissant sur 2 secondes. </p><br><p>  <strong>Les tests</strong> </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> YandexPages <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> SearchHelper <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_yandex_search</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(browser)</span></span></span><span class="hljs-function">:</span></span> yandex_main_page = SearchHelper(browser) yandex_main_page.go_to_site() yandex_main_page.enter_word(<span class="hljs-string"><span class="hljs-string">"Hello"</span></span>) yandex_main_page.click_on_the_search_button() elements = yandex_main_page.check_navigation_bar() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> elements</code> </pre> <br><p>  Nous créons la fonction de test test_yandex_seacrh, qui acceptera le montage du navigateur.  Ensuite, la première ligne crée l'objet page - yandex_main_page.  De l'objet, nous appelons les méthodes d'interaction avec les éléments de page.  La fonction décrit la logique de niveau supérieur des actions utilisateur. </p><br><p>  Transférons tout ce que nous avons implémenté dans le schéma, similaire au schéma Page Object.  Renommez les blocs sous le nom des fichiers de l'article. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a24/e37/5bf/a24e375bf82872ef51e261f9c6813ab5.png" alt="image"></p><br><p>  Comme vous pouvez le voir, nous avons pu mettre le modèle en pratique. </p><br><p>  Je vais laisser un lien vers le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">référentiel</a> terminé.  Merci d'avoir lu! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr472156/">https://habr.com/ru/post/fr472156/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr472138/index.html">Numérisation de l'éducation</a></li>
<li><a href="../fr472144/index.html">Sifflez tout le monde sur Linux, le tonnerre et la foudre</a></li>
<li><a href="../fr472148/index.html">Retrogaming: PAL vs NTSC. Ou pourquoi PAL n'est pas nécessaire</a></li>
<li><a href="../fr472152/index.html">Test de code multithread et asynchrone</a></li>
<li><a href="../fr472154/index.html">Comment ne pas rater le budget de la production en série des bâtiments-2: prix du moulage plastique à petite échelle</a></li>
<li><a href="../fr472158/index.html">"Le processus éducatif en informatique et pas seulement": concours et événements technologiques de l'Université ITMO</a></li>
<li><a href="../fr472160/index.html">Phantom OS: sous-système de fenêtre - faire des contrôles</a></li>
<li><a href="../fr472162/index.html">Marketing par e-mail externalisé: comment construire et à quoi s'attendre</a></li>
<li><a href="../fr472168/index.html">Une pratique divertissante pour le développeur</a></li>
<li><a href="../fr472170/index.html">Qui a suggéré de décentraliser la zone racine DNS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>