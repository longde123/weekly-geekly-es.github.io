<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê∫ üë©üèæ‚Äçüè´ üè° Membuat Circuit Breaker berbasis cache sederhana di Spring üßñüèº üòæ üìß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Artikel ini ditujukan bagi mereka yang menggunakan cache yang efektif dalam aplikasi mereka dan ingin menambahkan stabilitas tidak hanya untuk aplikas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Membuat Circuit Breaker berbasis cache sederhana di Spring</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451858/">  Artikel ini ditujukan bagi mereka yang menggunakan cache yang efektif dalam aplikasi mereka dan ingin menambahkan stabilitas tidak hanya untuk aplikasi, tetapi juga untuk seluruh lingkungan hanya dengan menambahkan 1 kelas ke proyek. <br><br>  Jika Anda mengenali diri sendiri, baca terus. <br><br><h2>  Apa itu Pemutus Sirkuit? </h2><br><img src="https://habrastorage.org/webt/w-/bn/xj/w-bnxjrhl9n7nnjby9grw571koa.png" alt="Bingkai dari film Kembali ke Masa Depan"><br><a name="habracut"></a><br>  Tema ini basi seperti dunia dan saya tidak akan membuat Anda bosan, meningkatkan entropi dan mengulangi hal yang sama.  Dari sudut pandang saya, Martin Fowler berbicara paling baik di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> , tetapi saya akan mencoba mencocokkan definisi menjadi satu kalimat: <br>  <i>fungsionalitas yang mencegah permintaan dengan sengaja terhadap layanan yang tidak tersedia, memungkinkannya untuk ‚Äúbangun dari lututnya‚Äù dan melanjutkan operasi normal</i> . <br><br>  Idealnya, mencegah permintaan yang gagal, Circuit Breaker (selanjutnya disebut CB) tidak boleh merusak aplikasi Anda.  Sebagai gantinya, adalah praktik yang baik untuk mengembalikan, jika bukan data terkini, tetapi masih relevan ("tidak busuk"), atau, jika ini tidak mungkin, beberapa nilai default. <br><br><h2>  Tujuan </h2><br>  Kami memilih hal utama: <br><br><ol><li>  Hal ini diperlukan untuk memungkinkan sumber data pulih, menghentikan permintaan untuk sementara waktu </li><li>  Dalam hal menghentikan permintaan ke layanan target, Anda harus memberikan, jika bukan yang terbaru, tetapi masih data yang relevan </li><li>  Jika layanan target tidak tersedia dan tidak ada data yang relevan, berikan strategi perilaku (mengembalikan nilai default atau strategi lain yang cocok untuk kasus tertentu) </li></ol><br><h2>  Mekanisme implementasi </h2><br><h3>  Kasus: layanan tersedia (permintaan pertama) </h3><br><ol><li>  Ayo pergi ke cache.  Dengan kunci (CRT lihat di bawah).  Kami melihat bahwa tidak ada apa pun di cache </li><li>  Kami pergi ke layanan target.  Kami mendapatkan nilainya </li><li>  Kami menyimpan nilai dalam cache, mengaturnya ke TTL yang akan mencakup waktu maksimum yang mungkin bahwa layanan target tidak tersedia, tetapi pada saat yang sama tidak boleh melebihi periode relevansi data yang siap Anda berikan kepada klien jika terjadi kehilangan koneksi dengan layanan target </li><li>  Waktu Refresh Cache (CRT) disimpan dalam cache untuk nilai dari klausa 3 - waktu setelah itu Anda perlu mencoba untuk pergi ke layanan target dan memperbarui nilai. </li><li>  Kembalikan nilai dari item 2 ke pengguna </li></ol><br><h3>  Kasus: CRT tidak kedaluwarsa </h3><br><ol><li>  Ayo pergi ke cache.  Kami menemukan CRT.  Kami melihat bahwa itu relevan </li><li>  Dapatkan nilai untuk itu dari cache. </li><li>  Kembalikan nilai ke pengguna. </li></ol><br><h3>  Kasus: CRT kedaluwarsa, layanan target tersedia </h3><br><ol><li>  Ayo pergi ke cache.  Kami menemukan CRT.  Kami melihat bahwa itu tidak relevan </li><li>  Kami pergi ke layanan target.  Kami mendapatkan nilainya </li><li>  Memperbarui nilai dalam cache dan TTL-nya </li><li>  Perbarui CRT untuknya dengan menambahkan Cache Refresh Periode (CRP) - ini adalah nilai yang perlu ditambahkan ke CRT untuk mendapatkan CRT berikutnya </li><li>  Kembalikan nilai ke pengguna. </li></ol><br><h3>  Kasus: CRT kedaluwarsa, layanan target tidak tersedia </h3><br><ol><li>  Ayo pergi ke cache.  Kami menemukan CRT.  Kami melihat bahwa itu tidak relevan </li><li>  Kami pergi ke layanan target.  Dia tidak tersedia </li><li>  Dapatkan nilai dari cache.  Bukan yang terbaru (dengan CRT busuk), tetapi masih relevan, karena TTL-nya belum kedaluwarsa </li><li>  Kami mengembalikannya ke pengguna </li></ol><br><h3>  Kasus: CRT kedaluwarsa, layanan target tidak tersedia, tidak ada dalam cache </h3><br><ol><li>  Ayo pergi ke cache.  Kami menemukan CRT.  Kami melihat bahwa itu tidak relevan </li><li>  Kami pergi ke layanan target.  Dia tidak tersedia </li><li>  Dapatkan nilai dari cache.  Bukan dia </li><li>  Kami mencoba menerapkan strategi khusus untuk kasus-kasus seperti itu.  Misalnya, mengembalikan nilai default untuk bidang yang ditentukan, atau nilai khusus dari jenis "Informasi ini saat ini tidak tersedia".  Secara umum, jika ini memungkinkan, lebih baik mengembalikan sesuatu dan tidak merusak aplikasi.  Jika ini tidak memungkinkan, maka Anda perlu menerapkan strategi melempar pengecualian dan respons cepat ke pengguna pengecualian. </li></ol><br><h2>  Apa yang akan kita gunakan </h2><br>  Saya menggunakan Spring Boot 1.5 dalam proyek saya, masih belum menemukan waktu untuk meningkatkan ke versi kedua. <br><br>  Bahwa artikelnya tidak berubah 2 kali lebih lama, saya akan menggunakan Lombok. <br><br>  Sebagai penyimpanan Key-Value (selanjutnya hanya disebut sebagai KV) saya menggunakan Redis 5.0.3, tetapi saya yakin bahwa Hazelcast atau analog akan melakukannya.  Yang utama adalah bahwa ada implementasi antarmuka CacheManager.  Dalam kasus saya, ini adalah RedisCacheManager dari spring-boot-starter-data-redis. <br><br><h2>  Implementasi </h2><br>  Di atas, di bagian "Mekanisme Implementasi", dua definisi penting dibuat: CRT dan CRP.  Saya akan menulisnya lagi dengan lebih detail, karena  mereka sangat penting untuk memahami kode berikut: <br><br>  Cache Refresh Time ( <b>CRT</b> ) adalah entri terpisah di KV (kunci + postfix "_crt"), yang menunjukkan waktu kapan waktunya untuk pergi ke layanan target untuk data baru.  Tidak seperti TTL, permulaan CRT tidak berarti bahwa data Anda "busuk", tetapi hanya bahwa itu kemungkinan akan lebih baru dalam layanan target.  Menjadi segar - yah, jika tidak, dan arus akan turun. <br><br>  Periode Refresh Cache ( <b>CRP</b> ) adalah nilai yang ditambahkan ke CRT setelah polling layanan target (tidak masalah apakah itu berhasil atau tidak).  Berkat dia, layanan jarak jauh memiliki kemampuan untuk "menarik napas" dan mengembalikan pekerjaannya jika jatuh. <br><br>  Jadi, secara tradisional, kita mulai dengan mendesain antarmuka utama.  Melalui itu Anda perlu bekerja dengan cache jika Anda membutuhkan logika CB.  Seharusnya sesederhana mungkin: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CircuitBreakerService</span></span></span><span class="hljs-class"> </span></span>{ &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStableValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StableValueParameter parameter)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evictValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EvictValueParameter parameter)</span></span></span></span>; }</code> </pre> <br>  Parameter antarmuka: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Getter</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StableValueParameter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String cachePrefix; <span class="hljs-comment"><span class="hljs-comment">//    private String objectCacheKey; private long crpInSeconds; // Cache Refresh Period private Supplier&lt;T&gt; targetServiceAction; //      private DisasterStrategy disasterStrategy; //   : CRT ,   ,     public StableValueParameter( String cachePrefix, String objectCacheKey, long crpInSeconds, Supplier&lt;T&gt; targetServiceAction ) { this.cachePrefix = cachePrefix; this.objectCacheKey = objectCacheKey; this.crpInSeconds = crpInSeconds; this.targetServiceAction = targetServiceAction; this.disasterStrategy = new ThrowExceptionDisasterStrategy(); } }</span></span></code> </pre><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Getter</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EvictValueParameter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String cachePrefix; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String objectCacheKey; }</code> </pre><br>  Inilah cara kami akan menggunakannya: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> AccountDataResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findAccount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String accountId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> StableValueParameter&lt;?&gt; parameter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StableValueParameter&lt;&gt;( ACCOUNT_CACHE_PREFIX, accountId, properties.getCrpInSeconds(), () -&gt; bankClient.findById(accountId) ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> circuitBreakerService.getStableValue(parameter); }</code> </pre><br>  Jika Anda perlu menghapus cache, maka: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evictAccount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String accountId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> EvictValueParameter parameter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EvictValueParameter( ACCOUNT_CACHE_PREFIX, accountId ); circuitBreakerService.evictValue(parameter); }</code> </pre><br>  Sekarang hal yang paling menarik adalah implementasinya (dijelaskan dalam komentar dalam kode): <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStableValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StableValueParameter parameter)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Cache cache = cacheManager.getCache(parameter.getCachePrefix()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cache == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> logAndThrowUnexpectedCacheMissing(parameter.getCachePrefix(), parameter.getObjectCacheKey()); } <span class="hljs-comment"><span class="hljs-comment">//   .   CRT final String crtKey = parameter.getObjectCacheKey() + CRT_CACHE_POSTFIX; //  CRT  ,    final LocalDateTime crt = Optional.ofNullable(cache.get(crtKey, LocalDateTime.class)) .orElseGet(() -&gt; DateTimeUtils.now().minusSeconds(1)); if (DateTimeUtils.now().isBefore(crt)) { //  CRT   ,     final Optional&lt;T&gt; valueFromCache = getFromCache(parameter, cache); if (valueFromCache.isPresent()) { return valueFromCache.get(); } } //  CRT  ,        return getFromTargetServiceAndUpdateCache(parameter, cache, crtKey, crt); } private static &lt;T&gt; Optional&lt;T&gt; getFromCache(StableValueParameter parameter, Cache cache) { return (Optional&lt;T&gt;) Optional.ofNullable(cache.get(parameter.getObjectCacheKey())) .map(Cache.ValueWrapper::get); }</span></span></code> </pre><br>  Jika layanan target tidak tersedia, cobalah untuk mendapatkan data yang masih relevan dari cache: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFromTargetServiceAndUpdateCache</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( StableValueParameter parameter, Cache cache, String crtKey, LocalDateTime crt )</span></span></span><span class="hljs-function"> </span></span>{ T result; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { result = getFromTargetService(parameter); } <span class="hljs-comment"><span class="hljs-comment">/* Circuit breaker exceptions */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (WebServiceIOException ex) { log.warn( <span class="hljs-string"><span class="hljs-string">"[CircuitBreaker] Service responded with error: {}. Try get from cache {}: {}"</span></span>, ex.getMessage(), parameter.getCachePrefix(), parameter.getObjectCacheKey()); result = getFromCacheOrDisasterStrategy(parameter, cache); } cache.put(parameter.getObjectCacheKey(), result); cache.put(crtKey, crt.plusSeconds(parameter.getCrpInSeconds())); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFromTargetService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StableValueParameter parameter)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (T) parameter.getTargetServiceAction().get(); }</code> </pre><br>  Jika tidak ada data aktual dalam cache (mereka dihapus oleh TTL, dan layanan target masih tidak tersedia), maka kami menggunakan DisasterStrategy: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFromCacheOrDisasterStrategy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StableValueParameter parameter, Cache cache)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (T) getFromCache(parameter, cache).orElseGet(() -&gt; parameter.getDisasterStrategy().getValue()); }</code> </pre><br>  Menghapus dari cache tidak ada yang menarik, saya akan berikan di sini hanya untuk kelengkapan: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFromCacheOrDisasterStrategy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StableValueParameter parameter, Cache cache)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (T) getFromCache(parameter, cache).orElseGet(() -&gt; parameter.getDisasterStrategy().getValue()); }</code> </pre><br>  Menghapus dari cache tidak ada yang menarik, saya akan berikan di sini hanya untuk kelengkapan: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evictValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EvictValueParameter parameter)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Cache cache = cacheManager.getCache(parameter.getCachePrefix()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cache == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { logAndThrowUnexpectedCacheMissing(parameter.getCachePrefix(), parameter.getObjectCacheKey()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String crtKey = parameter.getObjectCacheKey() + CRT_CACHE_POSTFIX; cache.evict(crtKey); }</code> </pre><br><h2>  Strategi bencana </h2><br><img src="https://habrastorage.org/webt/ka/fw/_0/kafw_0jvueyuguwcdbjz4eksnz8.png" alt="Bingkai dari film Kembali ke Masa Depan"><br><br>  Ini, pada kenyataannya, adalah logika yang terjadi jika CRT kedaluwarsa, layanan target tidak tersedia, dan tidak ada dalam cache. <br><br>  Saya ingin menggambarkan logika ini secara terpisah, karena  banyak yang tidak mendapatkan tangan mereka untuk memikirkan bagaimana mengimplementasikannya.  Tetapi inilah yang membuat sistem kami benar-benar stabil. <br><br>  Tidakkah Anda ingin merasakan kebanggaan terhadap gagasan Anda ketika segala sesuatu yang hanya bisa gagal ditolak, dan sistem Anda masih berfungsi.  Meskipun fakta bahwa, misalnya, bukan harga sebenarnya dari barang yang akan ditampilkan di bidang "harga", tetapi tulisan: "itu sedang ditentukan sekarang", tetapi seberapa jauh ini lebih baik daripada jawaban "500 layanan tidak tersedia".  Lagi pula, misalnya, 10 bidang yang tersisa: deskripsi produk, dll.  kamu kembali.  Seberapa besar perubahan kualitas layanan seperti itu? .. Panggilan saya adalah untuk lebih memperhatikan detail, menjadikannya lebih baik. <br><br>  Menyelesaikan penyimpangan lirik.  Jadi, antarmuka strategi adalah sebagai berikut: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DisasterStrategy</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre><br>  Anda harus memilih implementasinya tergantung pada kasus spesifik.  Misalnya, jika Anda dapat mengembalikan beberapa nilai default, maka Anda dapat melakukan sesuatu seperti ini: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefaultValueDisasterStrategy</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DisasterStrategy</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"   "</span></span>; } }</code> </pre><br>  Atau, jika dalam kasus tertentu Anda tidak perlu mengembalikan apa pun, maka Anda dapat melemparkan pengecualian: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ThrowExceptionDisasterStrategy</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DisasterStrategy</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Object</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CircuitBreakerNullValueException(<span class="hljs-string"><span class="hljs-string">"Ops! Service is down and there's null value in cache"</span></span>); } }</code> </pre><br>  Dalam hal ini, CRT tidak akan bertambah dan permintaan berikutnya akan mengikuti layanan target. <br><br><h2>  Kesimpulan </h2><br>  Saya berpegang pada sudut pandang berikut - jika Anda memiliki kesempatan untuk menggunakan solusi yang sudah jadi, dan tidak membuat keributan, pada kenyataannya, meskipun sederhana, tetapi tetap bersepeda dalam artikel ini, jadi lakukanlah.  Gunakan artikel ini untuk memahami cara kerjanya, dan bukan sebagai panduan untuk bertindak. <br><br>  Ada begitu banyak solusi yang sudah jadi, terutama jika Anda menggunakan Spring Boot 2, seperti Hystrix. <br><br>  Yang paling penting untuk dipahami adalah bahwa solusi ini didasarkan pada cache dan efektivitasnya sama dengan efektivitas cache.  Jika cache tidak efektif (beberapa hit, banyak misses), maka Circuit Breaker ini akan sama-sama tidak efisien: setiap cache miss akan disertai dengan perjalanan ke layanan target, yang, mungkin, dalam kesakitan dan kesedihan pada saat ini, mencoba untuk bangkit. <br><br>  Pastikan untuk mengukur efektivitas cache Anda sebelum menerapkan pendekatan ini.  Ini dapat dilakukan dengan ‚ÄúCache Hit Rate‚Äù = hits / (hits + misses), seharusnya cenderung ke 1, bukan 0. <br><br>  Dan ya, tidak ada yang mengganggu Anda untuk menyimpan beberapa varietas CB dalam proyek Anda sekaligus, menggunakan salah satu yang paling baik memecahkan masalah spesifik. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id451858/">https://habr.com/ru/post/id451858/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id451842/index.html">Tentang menemukan diri sendiri</a></li>
<li><a href="../id451848/index.html">Mengotomatiskan Mari Mengenkripsi Manajemen Sertifikat SSL Menggunakan tantangan DNS-01 dan AWS</a></li>
<li><a href="../id451852/index.html">Eksekusi kode arbitrer jarak jauh di RDP</a></li>
<li><a href="../id451854/index.html">Wawancara - 10 pertanyaan tentang Swift. Bagian 1</a></li>
<li><a href="../id451856/index.html">Instal openmeetings 5.0.0-M1. WEB-konferensi tanpa Flash</a></li>
<li><a href="../id451860/index.html">Matematikawan telah menemukan cara sempurna untuk melipatgandakan angka</a></li>
<li><a href="../id451862/index.html">Musikal Petir Joe Diprim: Insinyur otodidak membuat gulungan Tesla untuk hiburan dan penghasilan</a></li>
<li><a href="../id451864/index.html">Kerentanan RCE kritis tingkat EternalBlue terdeteksi di OS Windows</a></li>
<li><a href="../id451866/index.html">Pilih node terdekat di jaringan</a></li>
<li><a href="../id451870/index.html">Fitur C ++ modern yang perlu diketahui oleh semua programmer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>