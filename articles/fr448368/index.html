<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚶🏿 🍚 🌬️ SQL: la tâche du temps de travail ⛄️ 🥉 👩🏻‍🤝‍👨🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Radio SQL est à nouveau diffusée! Pétrir les ganglions, propager des pseudopodes (ou vice versa?) Et syntoniser notre onde gravitationnelle! ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>SQL: la tâche du temps de travail</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/postgrespro/blog/448368/">  Bonjour, Radio SQL est à nouveau diffusée!  Pétrir les ganglions, propager des pseudopodes (ou vice versa?) Et syntoniser notre onde gravitationnelle! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rc/a6/z4/rca6z4cduxlps2le_c4l_3rwnrg.png"></div><a name="habracut"></a><br>  La dernière fois, j'ai été presque ostracisé pour analyser ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://habr.com/en/post/359064/</a> ) le problème de l'Olympiade SQL, soi-disant il n'était pas assez proche de la vie.  Comme si les balises "programmation anormale" et "Jeux olympiques" ne parlaient pas d'elles-mêmes.  Mais évidemment, personne ne lit les balises!  Néanmoins, je continuerai le sujet de l'analyse des tâches dans le merveilleux langage de programmation SQL.  Parce que les pattes (démangeaisons). <br><br>  Aujourd'hui, nous sommes confrontés à une tâche exclusivement mortelle, voire pratique.  Je suis tombé dessus, essayant de calculer les performances du SLA à la demande d'utilisateurs aimants.  L'essence du problème initial est la suivante: il fallait calculer la durée du travail pour chaque candidature et comparer avec ce que nous avions promis.  Tout irait bien, mais le temps dans les obligations a été déclaré fonctionnel, et à partir des changements de statut dans les applications, je n'ai pu obtenir que le calendrier.  Et voici une pensée!  La voici, tâche!  Pas trop compliqué, mais pas tout à fait banal non plus.  Juste pour étirer les parties centrales de vos systèmes nerveux autonomes, les rendant plus sympathiques! <br><br>  Donc, j'énonce la condition. <br><br>  Il y a plusieurs intervalles de temps spécifiés par la date-heure de son début et de sa fin (un exemple dans la syntaxe PostgreSQL): <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> periods(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, start_time, stop_time) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'2019-03-29 07:00:00'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span>, <span class="hljs-string"><span class="hljs-string">'2019-04-08 14:00:00'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'2019-04-10 07:00:00'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span>, <span class="hljs-string"><span class="hljs-string">'2019-04-10 20:00:00'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span>), (<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'2019-04-11 12:00:00'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span>, <span class="hljs-string"><span class="hljs-string">'2019-04-12 16:07:12'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span>), (<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'2018-12-28 12:00:00'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span>, <span class="hljs-string"><span class="hljs-string">'2019-01-16 16:00:00'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span>) )</code> </pre> <br>  Il est requis dans une requête SQL (c) pour calculer la durée de chaque intervalle en heures de travail.  Nous pensons que nous travaillons en semaine du lundi au vendredi, les heures de travail sont toujours de 10h00 à 19h00.  En outre, conformément au calendrier de production de la Fédération de Russie, il existe un certain nombre de jours fériés officiels qui ne sont pas des jours ouvrables, et certains jours de congé, au contraire, sont des jours ouvrables en raison du transfert de ces mêmes jours fériés.  Le raccourcissement des jours de pré-vacances n'est pas nécessaire, nous les considérons comme complets.  Étant donné que les vacances varient d'une année à l'autre, c'est-à-dire qu'elles sont fixées par une liste explicite, nous nous limiterons aux dates uniquement de 2018 et 2019.  Je suis sûr que, si nécessaire, la solution peut être facilement complétée. <br><br>  Il est nécessaire d'ajouter une colonne avec la durée en heures de travail aux périodes initiales des <i>périodes</i> .  Voici le résultat: <br><br><pre> <code class="sql hljs"> id | start_time | stop_time | work_hrs <span class="hljs-comment"><span class="hljs-comment">----+---------------------+---------------------+---------- 1 | 2019-03-29 07:00:00 | 2019-04-08 14:00:00 | 58:00:00 2 | 2019-04-10 07:00:00 | 2019-04-10 20:00:00 | 09:00:00 3 | 2019-04-11 12:00:00 | 2019-04-12 16:07:12 | 13:07:12 4 | 2018-12-28 12:00:00 | 2019-01-16 16:00:00 | 67:00:00</span></span></code> </pre> <br>  Nous ne vérifions pas l'exactitude des données initiales; nous considérons toujours <i>start_time &lt;= stop_time</i> . <br><br>  Les constructions spéciales de dialecte SQL de PostgreSQL peuvent être utilisées, mais pas abusées.  Pour une exactitude complète des conditions, j'ajoute que la requête doit être exécutée sur PostgreSQL version 10 ou ultérieure. <br><br>  Dans un mois, il y aura une analyse de la tâche.  Je ne prends aucune décision de sorte qu'il y ait une incitation à résoudre par moi-même.  Nous vous prions de bien vouloir - placer le code dans les commentaires sous les spoilers! <br><br>  <b>Dernier point mais non le moindre</b> .  Si j'ai déjà réussi à publier cet article sur le blog d'entreprise de Postgres Professional, nous utiliserons des goodies d'entreprise: pour la solution la plus intéressante à ce problème, nous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">jouerons</a> un voyage gratuit à <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PGConf.Russia 2020</a> .  Les critères d'intérêt seront personnellement les miens, ainsi que ceux des collègues avec lesquels j'estime nécessaire de consulter.  Bonne chance <br><br>  <b>MISE À JOUR!</b>  Quelque chose que je vois que les heures de travail sont perçues pour une raison exclusivement sans minutes de travail.  N'oubliez pas les minutes!  J'ai ajusté les intervalles initiaux et la réponse attendue pour souligner la disponibilité des minutes. <br><br>  Résumé <b>UPDATE2</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://habr.com/en/company/postgrespro/blog/457722/</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr448368/">https://habr.com/ru/post/fr448368/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr448358/index.html">Nous écoutons de la musique et des conférences de Youtube avec un écran de smartphone verrouillé et sans publicité en utilisant Telegram</a></li>
<li><a href="../fr448360/index.html">Une petite porte dérobée sur Flask ou comment contrôler un ordinateur sur un réseau local</a></li>
<li><a href="../fr448362/index.html">J'ai pensé que je devais envoyer des designers à ...</a></li>
<li><a href="../fr448364/index.html">Stormglass - prédicteurs de cristaux</a></li>
<li><a href="../fr448366/index.html">Rust 1.34 Release</a></li>
<li><a href="../fr448372/index.html">Arrêtez de rejeter les grands demandeurs d'emploi avec vos mauvaises questions.</a></li>
<li><a href="../fr448374/index.html">De nouvelles preuves de l'activité volcanique, qui a provoqué l'extinction la plus massive de l'histoire, sont reçues.</a></li>
<li><a href="../fr448376/index.html">Les mathématiques disent aux cellules ce qu'elles devraient être</a></li>
<li><a href="../fr448378/index.html">Sécurité DHCP dans Windows 10: exploration de la vulnérabilité critique CVE-2019-0726</a></li>
<li><a href="../fr448382/index.html">Comment nous avons évalué la qualité de la documentation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>