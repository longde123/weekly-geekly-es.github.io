<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äçüè≠ üë®üèø‚Äçüåæ üéé Bibliotecas PHP para comercio electr√≥nico: trabajando con ATOL y Payture, analizando c√≥digos GS1 y otras tareas üöá üë®‚Äçüè´ „ÄΩÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola, mi nombre es Pavel Savelyev, soy el jefe del departamento de automatizaci√≥n de procesos de negocios en Lamoda. Trabajamos con tareas muy diferen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bibliotecas PHP para comercio electr√≥nico: trabajando con ATOL y Payture, analizando c√≥digos GS1 y otras tareas</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lamoda/blog/466039/">  Hola, mi nombre es Pavel Savelyev, soy el jefe del departamento de automatizaci√≥n de procesos de negocios en Lamoda.  Trabajamos con tareas muy diferentes e intentamos elegir las herramientas m√°s convenientes para cada una.  En consecuencia, utilizamos diferentes idiomas: en nuestros sistemas puede encontrar Java, Go y un poco de Kotlin para Android.  Al mismo tiempo, una parte importante del desarrollo se lleva a cabo en PHP; se escriben m√°s de dos docenas de servicios que automatizan no solo el trabajo con pedidos, sino tambi√©n los procesos operativos de una amplia red de entrega, centros de llamadas en tres pa√≠ses y nuestro propio estudio fotogr√°fico, adem√°s de proporcionar todo esto en forma servicios a nuestros socios B2B.  Estos servicios est√°n respaldados y desarrollados por 5 equipos de desarrollo de nuestro departamento. <br><br><img src="https://habrastorage.org/webt/vv/vz/ia/vvvziajvf5uazdok_tjzpzs-5ae.png" alt="imagen"><br><br>  A medida que los servicios mismos y la infraestructura que los rodea se desarrollan, tareas similares surgen con mayor frecuencia en estos sistemas, como iniciar sesi√≥n en el CLS (Sistema de registro centralizado) com√∫n, probar el almacenamiento de archivos, recopilar m√©tricas para Prometheus y otros.  Intentamos estandarizar formas de resolver tales problemas y utilizar componentes comunes para diferentes sistemas. <br><a name="habracut"></a><br><blockquote>  Cuando uno de los equipos se enfrenta a la adaptaci√≥n o integraci√≥n de un nuevo servicio / herramienta que puede ser com√∫n para todos, iniciamos el desarrollo de la biblioteca en este equipo.  Y luego el componente terminado se prepara para su futura reutilizaci√≥n y se presenta en el dominio p√∫blico. <br></blockquote><br>  Por lo tanto, este proceso se lleva a cabo regularmente con nosotros, creamos una directriz que nos permite llevarlo a cabo sin problemas. Intentar√© informar sobre esto en una de las pr√≥ximas conferencias. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">M√°s de dos docenas de nuestras bibliotecas PHP</a> se han hecho p√∫blicas en GitHub.  Y planeamos extendernos a√∫n m√°s.  Por qu√©  Bueno, invertimos muchos recursos y (quiero creer) lo hicimos bien.  Y astutamente esperamos que otros desarrolladores usen nuestras bibliotecas, les ayuden a terminar y desarrollar m√°s, en lugar de perder tiempo escribiendo sus an√°logos desde cero.  En este art√≠culo, quiero hablar brevemente sobre siete bibliotecas dise√±adas para resolver tareas comunes para el comercio electr√≥nico. Estar√© encantado si son √∫tiles para usted, y estar√© a√∫n m√°s feliz de desarrollarlas conjuntamente :) <br><br><h2>  1. Fiscalizaci√≥n en l√≠nea: un cliente para ATOL Online </h2><br>  Al igual que otras empresas rusas, estamos obligados a cumplir plenamente con los requisitos de FZ-54, uno de los cuales es la fiscalizaci√≥n en l√≠nea.  Todos los pedidos prepagos en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">lamoda.ru</a> siempre se fiscalizan: generan cheques en l√≠nea que se env√≠an a los clientes.  Nuestro servicio de fiscalizaci√≥n funciona por API con el sistema <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ATOL Online,</a> y la primera <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">biblioteca</a> de nuestra lista es un cliente completo para este servicio.  Adem√°s de la biblioteca en s√≠, tambi√©n publicamos un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">paquete</a> , con el que puede conectarlo f√°cilmente a cualquier proyecto basado en el marco de Symfony.  La biblioteca en s√≠ se puede incrustar en cualquier otro marco PHP: Laravel, Yii, etc., simplemente escriba un "contenedor" para la biblioteca. <br><br><h2>  2. Pagos prepagos: interacci√≥n con Payture </h2><br>  Para procesar pagos prepagos, interactuamos activamente con el servicio Payture.  Este servicio tiene varias interfaces de software.  Usamos la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">opci√≥n Payture InPay</a> y hemos escrito nuestro propio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cliente API</a> para ello.  La biblioteca le permite manipular m√∫ltiples terminales, admite el registro est√°ndar de PSR-3.  Tambi√©n es posible utilizar el cliente Guzzle preconfigurado, lo que facilita la organizaci√≥n de las pruebas con el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Guzzle Mock Handler</a> . <br><br>  Nuestro paquete de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">biblioteca</a> proporciona una configuraci√≥n sem√°ntica de terminales y le permite configurar convenientemente la configuraci√≥n del cliente (hasta ahora solo tiempos de espera) para varias operaciones de API. <br><br><h2>  3. Etiquetado del producto: analizador de c√≥digo GS1 Datamatrix </h2><br>  Uno de los proyectos m√°s importantes de 2019 en nuestra empresa es el apoyo al etiquetado estatal de productos.  Como parte de este proyecto, se aplicar√°n c√≥digos √∫nicos especiales a todos los productos de ciertas categor√≠as, en el formato GS1 Datamatrix.  Estos c√≥digos permitir√°n a cualquier comprador verificar la autenticidad de los productos, su origen e historial.  Para que los sistemas internos de Lamoda funcionen con estos c√≥digos de barras, hemos desarrollado una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">biblioteca</a> para el an√°lisis correcto de los c√≥digos GS1. <br>  En el futuro cercano, tambi√©n planeamos dise√±ar los c√≥digos fuente de nuestros clientes desarrollados para interactuar con el Sistema de Informaci√≥n de Marcado y Trazabilidad (IP MP). <br><br><h2>  4. Gesti√≥n de microservicios: middleware para el bus del equipo Tactician </h2><br>  Tenemos m√°s de un centenar de microservicios que realizan muchas operaciones separadas: comprueban el estado de los pagos o los archivos nuevos almacenados, env√≠an comandos de control a los cajeros, descargan y procesan fotograf√≠as de servicios externos.  Casi todas estas operaciones se realizan en segundo plano, y el patr√≥n del bus de comando es excelente para administrarlas.  Para implementar el bus en sistemas PHP, elegimos una soluci√≥n preparada: la biblioteca abierta de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tactician</a> . <br><br>  Sin embargo, surgi√≥ un problema: nuestros equipos de fondo a menudo interact√∫an con servicios externos, que tienen un l√≠mite en la cantidad de operaciones en n segundos.  Y Tactician no tiene la capacidad de controlar la cantidad de comandos ejecutables en una ventana de tiempo espec√≠fica.  Por lo tanto, desarrollamos un middleware adicional: la biblioteca de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">l√≠mite de velocidad t√°ctico</a> .  Con su ayuda, puede agregar una nueva capa de procesamiento que rastrea el n√∫mero de comandos ejecutados en el bus de acuerdo con la estrategia de limitaci√≥n de velocidad seleccionada.  Las estrategias son conectables, las estrategias de la biblioteca de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">stiphle</a> est√°n disponibles de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">f√°brica</a> . <br><br>  Tambi√©n en el dominio p√∫blico est√° nuestro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">paquete Symfony</a> para la biblioteca. <br><br><h2>  5. Recopilaci√≥n y representaci√≥n de m√©tricas para Prometheus </h2><br>  Nuestros microservicios generan m√©tricas t√©cnicas y comerciales, que luego se recopilan a trav√©s del operador Prometheus de todo el cl√∫ster k8s.  Para gestionar todo esto, escribimos una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">biblioteca</a> que procesa m√©tricas personalizadas de acuerdo con el escenario "collect-save-show".  Al mismo tiempo, la biblioteca admite modos operativos en los que se puede omitir uno de los elementos del script para aumentar la eficiencia.  Por ejemplo, para m√©tricas computables r√°pidas, se puede ejecutar un escenario simplificado de "recopilaci√≥n-presentaci√≥n".  Y trabajar con m√©tricas comerciales lentas puede traducirse parcialmente en segundo plano, mientras se divide en dos etapas: "recopilar-guardar" + "recopilar (desde el almacenamiento) - mostrar". <br><br>  La biblioteca tiene los niveles necesarios de abstracci√≥n tanto para escribir sus generadores m√©tricos como para escribir repositorios.  Fuera de la caja hay un adaptador abstracto para Doctrine, que se puede configurar en la entidad para guardar datos en la base de datos. <br><br>  Como formatos de renderizado m√©trico, prometheus y telegraf httpjson son actualmente compatibles. <br><br>  La biblioteca viene con un paquete de Symfony, que proporciona una configuraci√≥n sem√°ntica de fuentes de m√©tricas, repositorios y m√©tricas de enrutamiento.  Tambi√©n tiene comandos de ayuda para depurar y guardar m√©tricas de fuentes (por ejemplo, para calcular m√©tricas cron). <br><br><h2>  6. Prueba del almacenamiento de archivos: trabajar con diferentes sistemas de archivos </h2><br>  Para automatizar las pruebas, utilizamos el marco de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Codeception</a> , que nos permite escribir pruebas de varios niveles y tiene una biblioteca bastante extensa de m√≥dulos est√°ndar.  Recientemente escribimos m√°s sobre nuestros enfoques para el desarrollo de pruebas en un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> separado y hablamos en una conferencia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PHP Rusia</a> .  Codeception tiene m√≥dulos listos para interactuar con FTP y el FileSystem local, pero en nuestras pruebas existe la necesidad de trabajar con m√°s sistemas de archivos.  Como m√≠nimo, tambi√©n utilizamos AWS S3 y Webdav.  Adem√°s, me gustar√≠a interactuar con todos los sistemas de archivos utilizando la misma API (esto es todos los sistemas de archivos :)). <br><br>  Afortunadamente, hay una biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">FlySystem</a> abierta que proporciona una √∫nica interfaz de software para trabajar con diferentes sistemas de archivos.  Por lo tanto, solo necesit√°bamos combinar las dos herramientas, lo que hicimos escribiendo un contenedor sobre FlySystem como un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">m√≥dulo Codeception-flysystem</a> .  Ahora es compatible con SFTP, S3 y Webdav.  Es suficiente configurar los ajustes una vez para conectarse al sistema de archivos deseado en la configuraci√≥n de prueba yml, y despu√©s de eso puede trabajar con todos los sistemas de archivos utilizando el mismo conjunto de m√©todos: escribir el archivo, copiar el archivo, limpiar el directorio, etc.  El m√≥dulo ya est√° incluido en la p√°gina de adiciones y recomendaciones de Codeception: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">codeception.com/addons</a> . <br><br><h2>  7. Trabajar con variables de entorno en modo multiinquilino </h2><br>  En el departamento de automatizaci√≥n de procesos de negocios, existen sistemas que operan en modo multiinquilino.  Para garantizar su trabajo, es necesario poder trabajar con variables de entorno, para determinar qu√© variable usar en el momento actual. <br><br>  Nuestra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">biblioteca</a> proporciona varias estrategias para trabajar con variables de entorno en modo multiinquilino.  En funci√≥n de los par√°metros pasados ‚Äã‚Äãen la etapa de inicializaci√≥n, la biblioteca determina a qu√© variable de entorno se debe acceder en la solicitud actual. <br><br><h2>  Para continuar </h2><br>  Esta es solo la primera parte de las bibliotecas.  Tenemos una docena m√°s adentro: est√°n esperando en la fila cuando los "peinamos" un poco y los ponemos en el dominio p√∫blico.  Me motiva comprender que estas bibliotecas pueden ser √∫tiles para otra persona.  Me alegro de los comentarios y las estrellas en el github, y espero continuar desarrollando bibliotecas con otros desarrolladores.  De hecho, muchos proyectos de comercio electr√≥nico de Rusia trabajan con ATOL y Payture.  Para Datamatrix, adem√°s del analizador de c√≥digo descrito en el art√≠culo, tambi√©n tenemos un par de clientes que ya utilizamos internamente: estas bibliotecas son las primeras en la cola en GitHub. <br><br>  Tratamos de no olvidarnos de los otros idiomas: ya hemos publicado la primera biblioteca en Go ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">escribimos</a> m√°s sobre esto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠ en Habr√©</a> ) y estamos preparando otros.  Est√©n atentos! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/466039/">https://habr.com/ru/post/466039/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../466021/index.html">C√≥mo le ense√±√© a Yandex.Alice a hablar sobre juguetes sexuales</a></li>
<li><a href="../466027/index.html">El libro "El camino de Python. Cintur√≥n negro para desarrollo, escalado, prueba y despliegue ‚Äù</a></li>
<li><a href="../466029/index.html">C√≥mo convertir una computadora cu√°ntica en un generador de n√∫meros aleatorios perfecto</a></li>
<li><a href="../466031/index.html">La misi√≥n √©pica de DeepMind para resolver el problema cient√≠fico m√°s complejo</a></li>
<li><a href="../466033/index.html">C√≥mo involucrar a un equipo en la b√∫squeda de ideas y obtener mucho m√°s que ideas</a></li>
<li><a href="../466041/index.html">El primer evento fuera de l√≠nea del C√≠rculo de desarrolladores de Facebook: comunidad de Mosc√∫ - Evento de lanzamiento</a></li>
<li><a href="../466045/index.html">C√≥mo revitalizar una marca: una narraci√≥n que funcion√≥</a></li>
<li><a href="../466047/index.html">Dise√±o de tiendas online. Parte 3. P√°gina de inicio y cat√°logo</a></li>
<li><a href="../466049/index.html">Desde copiar y pegar hasta componentes: reutilizar c√≥digo en diferentes aplicaciones</a></li>
<li><a href="../466051/index.html">Automatizaci√≥n de perfiles de reuni√≥n de Java 10/09</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>