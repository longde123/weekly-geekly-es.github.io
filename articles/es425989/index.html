<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÉüèΩ üêÖ üìÅ Bajo el cap√≥ de Graveyard Keeper: c√≥mo se implementan los efectos gr√°ficos üôÜ ‚ùî üïû</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos! Durante los 4 a√±os completos no he escrito en Habr. Mi √∫ltima serie de publicaciones fue sobre varias herramientas y trucos que utilizam...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bajo el cap√≥ de Graveyard Keeper: c√≥mo se implementan los efectos gr√°ficos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/425989/">  Hola a todos!  Durante los 4 a√±os completos no he escrito en Habr.  Mi √∫ltima <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">serie de publicaciones</a> fue sobre varias herramientas y trucos que utilizamos en nuestro √∫ltimo juego (desarroll√°ndolo en Unity).  Desde entonces, lanzamos con √©xito el juego y tambi√©n lanzamos uno nuevo.  As√≠ que ahora puedes exhalar un poco y escribir algunos art√≠culos nuevos que pueden ser √∫tiles para alguien. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wb/qc/nc/wbqcnc2xkeiepxqphi3iphwnoo0.gif"></div><br>  Hoy quiero hablar sobre los trucos gr√°ficos y trucos que utilizamos para crear la imagen que ves en el GIF de arriba. <br><br>  Somos muy sensibles a las im√°genes de nuestros juegos y, por lo tanto, hemos invertido mucho tiempo y esfuerzo en varios efectos y otros beneficios que har√≠an nuestro pixel art lo m√°s atractivo posible.  Quiz√°s alguien encuentre algo √∫til para s√≠ mismo. <br><br>  Para comenzar, enumerar√© brevemente cu√°l ser√° la imagen en nuestro juego: <a name="habracut"></a><br><br><ol><li>  Luz ambiental variable: un cambio banal en la iluminaci√≥n seg√∫n la hora del d√≠a. </li><li>  Correcci√≥n de color LUT: es responsable de cambiar el tono de la imagen seg√∫n la hora del d√≠a (o el tipo de zona). </li><li>  Fuentes de luz din√°micas: antorchas, estufas, l√°mparas. </li><li>  Mapas normales: responsables de dar volumen a los objetos, especialmente al mover fuentes de luz. </li><li>  Matem√°ticas de la distribuci√≥n de luz 3D: es responsable de garantizar que la fuente de luz en el centro de la pantalla ilumine correctamente un objeto que es m√°s alto, pero no ilumina un objeto que es m√°s bajo (es decir, girado hacia la c√°mara con el lado apagado). </li><li>  Sombras: formadas por sprites, rotan y responden a la posici√≥n de las fuentes de luz. </li><li>  Simulaci√≥n de la altura de los objetos: para la correcta visualizaci√≥n de la niebla. </li><li>  Otros decoradores: lluvia, viento, animaciones (incluida la animaci√≥n de sombreado de follaje y hierba), etc. </li></ol><br>  Ahora con m√°s detalle. <br><br><h2>  Luz ambiental variable </h2><br>  Aqu√≠, en principio, nada especial.  Por la noche, m√°s oscuro, durante el d√≠a, m√°s claro.  El color de la luz lo establece el gradiente de tiempo.  Por la noche, la fuente de luz no solo se oscurece, sino que adquiere un tinte azul. <br><br>  Se ve as√≠: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kz/uc/z6/kzucz6juapnzkaxln72k6h6o5pk.png"></div><br><h2>  Correcci√≥n de color LUT </h2><br>  LUT (tabla de consulta): tablas de intercambio de colores.  Hablando en t√©rminos generales, esta es una matriz RGB tridimensional donde en cada nodo hay un valor de color, que debe ser reemplazado por el correspondiente.  Es decir, si un punto rojo se encuentra en las coordenadas (1, 1, 1), esto significa que todo el color blanco en la imagen ser√° reemplazado por rojo.  Si las coordenadas (1, 1, 1) son blancas (R = 1, G = 1, B = 1), entonces no hay cambio.  En consecuencia, la LUT sin cambios tiene un color para cada coordenada correspondiente a estas mismas coordenadas.  Es decir  en el punto (0.4, 0.5, 0.8) est√° el color (R = 0.4, G = 0.5, B = 0.8). <br><br>  Bueno, vale la pena se√±alar que, por conveniencia, presentan una textura 3D como bidimensional.  Por ejemplo, as√≠ es como se ve la LUT "predeterminada" (sin cambiar la reproducci√≥n del color): <br><br><img src="https://habrastorage.org/webt/ev/dp/a_/evdpa_vrtx8qpwetg0a1lsbnvv4.png"><br><br>  Se implementa de manera elemental, funciona de manera r√°pida y conveniente. <br><br>  Tambi√©n es muy f√°cil de configurar: le das al artista cualquier imagen del juego y dices "tono de color para que parezca de noche".  Despu√©s de eso, aplique todas las capas de correcci√≥n de color a la LUT predeterminada y obtenga la LUT de la tarde. <br><br>  En nuestro caso, el artista se atasc√≥ un poco y cre√≥ hasta 10 LUT diferentes para diferentes momentos del d√≠a (noche, crep√∫sculo, tarde, etc.).  As√≠ es como se ve su configuraci√≥n: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ra/rw/le/rarwlem4o5aoufvhb8vmficb-za.png"></div><br>  Como resultado, dependiendo de la hora del d√≠a, la misma ubicaci√≥n se ve diferente: <br><br><img src="https://habrastorage.org/webt/k2/fz/1w/k2fz1wmhn9yw-rcgvticox4_bh4.png"><br><br>  Aqu√≠, la transparencia de los sprites de luz de las ventanas tambi√©n cambia seg√∫n la hora del d√≠a. <br><br><h3>  Fuentes de luz din√°micas y mapas normales. </h3><br>  Las fuentes de luz se utilizan absolutamente ordinarias, desde Unity.  Adem√°s, se dibujan mapas normales para cada sprite, lo que le permite tener una sensaci√≥n de volumen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hy/dv/vf/hydvvfxlld52gux9o0mnz2gavbe.gif"></div><br>  Tales normales se dibujan de manera bastante simple.  El artista pinta aproximadamente una luz con un pincel desde 4 lados: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0o/mv/jv/0omvjvscrffh1o8exichnqylnia.png"></div><br>  Y luego este script va al mapa normal: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_4/md/oa/_4mdoakkf1puyp5lyvwjn6zmm-g.png"></div><br>  Si est√° buscando un sombreador (y software) que haga esto, puede mirar en la direcci√≥n de Sprite Lamp. <br><br><h3>  Simulaci√≥n de luz 3D </h3><br>  Esto es un poco m√°s complicado.  No puedes simplemente recoger y resaltar sprites.  Necesitamos considerar si el sprite est√° "detr√°s" de la fuente de luz o "al frente". <br><br>  Presta atenci√≥n a esta imagen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/k1/tr/51/k1tr51sgx_4fmnzjkhtkv176ye0.png"></div><br>  Ambos √°rboles est√°n a la misma distancia de la fuente de luz, sin embargo, el √°rbol distante est√° iluminado y el √°rbol m√°s cercano no (porque su parte no iluminada se gira hacia la c√°mara). <br><br>  Resolv√≠ este problema de manera bastante simple.  El sombreador calcula la distancia a lo largo del eje vertical y entre la fuente de luz y el sprite.  Y si es positivo (la fuente de luz antes del sprite), entonces iluminamos el sprite como de costumbre, pero si es negativo (el sprite bloquea la fuente de luz), pero la intensidad de la luz decae mucho desde una distancia con un coeficiente muy grande.  Es precisamente el coeficiente que se hizo, y no solo "sin iluminaci√≥n", de modo que cuando la fuente de luz se mueve y aparece repentinamente detr√°s del sprite, el sprite no se vuelve negro instant√°neamente, sino gradualmente.  Pero a√∫n as√≠ bastante r√°pido. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vy/d7/cw/vyd7cwsfbrkbe4majwq81fynkck.gif"></div><br><h2>  Sombras </h2><br>  Las sombras est√°n formadas por sprites que giran alrededor de un punto.  Intent√© agregarles m√°s compresi√≥n (sesgo), pero result√≥ ser innecesario. <br><br>  En total, cada objeto puede tener un m√°ximo de 4 sombras.  Uno es del Sol, y tres son de fuentes de luz din√°micas.  La siguiente imagen muestra el principio: <br><br><img src="https://habrastorage.org/webt/8r/8_/u2/8r8_u21cgbiicmqpdvpjywl5rb4.png"><br><br>  La tarea "encontrar las siguientes 3 fuentes de luz y calcular la distancia / √°ngulo de las sombras hacia ellas" se resuelve mediante un script que gira en Actualizaci√≥n.  S√≠, no funciona muy r√°pido, porque  Tienes que hacer muchas matem√°ticas.  Si escribiera ahora, usar√≠a los sistemas novedosos de trabajos paralelos en Unity.  Pero entonces esto a√∫n no era as√≠, as√≠ que simplemente optimic√© los scripts ordinarios tanto como pude. <br><br>  Lo √∫nico que importa es que hice que la rotaci√≥n del sprite no se transformara, sino dentro del sombreador de v√©rtices.  Es decir  la rotaci√≥n no se mueve.  Es solo que un par√°metro est√° configurado en el sprite (us√© el color para esto, porque de todos modos, todas las sombras son negras), y el sombreador ya es responsable de la rotaci√≥n del sprite.  Esto es m√°s r√°pido porque  no tienes que tirar de la geometr√≠a en Unity. <br><br>  Otro inconveniente de este enfoque es que las sombras deben configurarse (y a veces pintarse) individualmente para cada objeto.  Es cierto que, probablemente, logramos con una docena de sprites diferentes m√°s o menos universales (delgados, gruesos, ovalados, etc.). <br><br>  La segunda desventaja es que a veces es dif√≠cil hacer una sombra para un objeto cuyo punto de contacto con la tierra es muy alargado.  Por ejemplo, mira la sombra de la cerca: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mo/i2/dr/moi2drffv8hi9ynls99ve-gqjnc.gif"></div><br>  No perfecto  Esto es lo que parece si hace que el sprite de la cerca sea transl√∫cido: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7j/0t/fz/7j0tfz3lovxbfy2d2zu1afhtl_e.gif"></div><br>  Aqu√≠, sin embargo, vale la pena se√±alar que el sprite todav√≠a est√° muy deformado verticalmente (el sprite de sombra original se ve casi como un c√≠rculo).  Es por eso que su turno no parece tanto un giro, sino una distorsi√≥n. <br><br><h2>  Simulaciones de niebla y altura </h2><br>  Hay niebla en el juego.  Se ve as√≠ (arriba es la versi√≥n normal, debajo hay una niebla extrema del 100% para demostrar el efecto). <br><br><img src="https://habrastorage.org/webt/4i/2r/c_/4i2rc__pzbgrqecd4oq83piemsu.png"><br><br>  Como puede ver, las copas de las casas y los √°rboles sobresalen de la niebla.  De hecho, lograr este efecto fue bastante simple.  La niebla consta de muchas nubes horizontales que se distribuyen a lo largo de la profundidad del escenario.  Y como resultado, resulta que la parte superior de todos los sprites est√° bloqueada por menos sprites de niebla: <br><br><img src="https://habrastorage.org/webt/43/gd/gr/43gdgrxqrdisek50lynbramf4bc.png"><br><br><h2>  El viento </h2><br>  Pixel art wind es otra historia.  No hay muchas opciones  O animar con las manos (que es casi imposible con nuestra cantidad de arte), o escribir un sombreador deformante, pero a veces tienes que soportar distorsiones feas.  Puede, por supuesto, no animar en absoluto, pero la imagen se ve inanimada. <br><br>  Elegimos la opci√≥n de distorsi√≥n usando el sombreador.  Se ve as√≠: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cb/uh/nn/cbuhnnzyx14un9chz96mma0qmyq.gif"></div><br>  Si aplica este sombreador a una textura a cuadros, queda claro lo que sucede: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uo/ag/n5/uoagn5vbuxpeee_71sn-frkklyk.gif"></div><br>  Tambi√©n vale la pena se√±alar que no estamos animando toda la corona, sino solo hojas individuales: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2s/iu/my/2siumyhll6pl84c_hn6ursn-cpe.png"></div><br>  Tambi√©n sacudimos el trigo al viento, pero todo es simple: el sombreador de v√©rtices deforma las coordenadas x, teniendo en cuenta el componente y.  Cuanto m√°s alto sea el punto, m√°s fuerte ser√° el escalonamiento.  Esto se hace para que solo los principales se tambaleen, pero la ra√≠z no.  Adem√°s, la fase de oscilaci√≥n cambia de las coordenadas x / y para que los diferentes sprites en la pantalla oscilen aleatoriamente. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gy/ks/z6/gyksz6p4hodfgv4e-shli_gelyg.gif"></div><br>  El mismo sombreador tambi√©n se usa para crear el efecto de balancear el trigo y la hierba cuando un jugador los atraviesa. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sz/oo/q9/szooq97kmlmd9wmmlqnjohyyqdm.gif"></div><br>  Eso es probablemente todo por ahora.  Intencionalmente no abord√© el tema de la construcci√≥n de la escena y su geometr√≠a, porque  Esto es material para un art√≠culo separado.  Por lo dem√°s, habl√≥ sobre las principales soluciones que se utilizaron en el desarrollo. <br><br>  <b>PD:</b> Si alguien est√° interesado en algunos aspectos t√©cnicos, escriba los comentarios.  Quiz√°s lo cuente en otro art√≠culo.  A menos, por supuesto, necesario. <br><br>  <b>PPS:</b> Aprovecho esta oportunidad para decir que ahora queremos encontrar varias personas competentes en el equipo (programador, PM, KM, artista).  Los detalles est√°n en el sitio web del estudio.  Espero que esta frase no haya violado las reglas. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es425989/">https://habr.com/ru/post/es425989/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es425975/index.html">Convierte palabras y frases a anagramas</a></li>
<li><a href="../es425977/index.html">Flexbox: ¬øqu√© tama√±o tiene esta caja flexible?</a></li>
<li><a href="../es425981/index.html">Newbie‚Äôs Career at LK: pasos agigantados para avanzar lentamente</a></li>
<li><a href="../es425983/index.html">Seguridad de vuelo</a></li>
<li><a href="../es425985/index.html">Ejecuci√≥n de c√≥digo personalizado en GO</a></li>
<li><a href="../es425991/index.html">C√≥mo creamos hosting</a></li>
<li><a href="../es425993/index.html">C√≥mo cerrar la brecha de g√©nero en tecnolog√≠a</a></li>
<li><a href="../es425995/index.html">Visualice FHIR: el est√°ndar de TI para la medicina</a></li>
<li><a href="../es425997/index.html">Curso MIT "Seguridad de sistemas inform√°ticos". Lecci√≥n 11: Ur / Lenguaje de programaci√≥n web, Parte 1</a></li>
<li><a href="../es425999/index.html">Curso MIT "Seguridad de sistemas inform√°ticos". Lecci√≥n 11: Ur / Lenguaje de programaci√≥n web, Parte 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>