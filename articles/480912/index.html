<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úçüèª üßì üêó Dap en acci√≥n. Escribiendo TodoMVC. Parte 1 üëáüèº üë®üèø‚Äçüé§ üßïüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El primer art√≠culo sobre dap , obviamente, no se convirti√≥ en mi √©xito de escritura: la gran mayor√≠a de los comentarios se redujeron a "niasilil" y "n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dap en acci√≥n. Escribiendo TodoMVC. Parte 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480912/"> El primer <a href="https://habr.com/ru/post/478330/">art√≠culo</a> sobre <a href="https://dap.js.org/" rel="nofollow">dap</a> , obviamente, no se convirti√≥ en mi √©xito de escritura: la gran mayor√≠a de los comentarios se redujeron a "niasilil" y "niasilil, pero lo condeno".  Y el premio para <s>el</s> √∫nico comentario constructivo de alto nivel va a <a href="https://habr.com/en/users/oldvitus/" class="user_link">OldVitus</a> , para que le aconsejen demostrar el dap usando TodoMVC como ejemplo, para que haya algo para comparar.  ¬øQu√© har√© en este art√≠culo? <br><br>  <a href="http://todomvc.com/" rel="nofollow">TodoMVC</a> , si alguien no lo sabe, este es un mundo de llamadas de interfaz de usuario tan est√°ndar, que le permite comparar soluciones al mismo problema, la "lista de tareas" condicional, usando diferentes marcos.  La tarea, con toda su simplicidad (su <a href="https://dap.js.org/samples/todo.html" rel="nofollow">soluci√≥n en dap</a> breaks "en una pantalla"), es muy ilustrativa.  Por lo tanto, usando su ejemplo, intentar√© mostrar c√≥mo las tareas t√≠picas para un front-end web se implementan usando dap. <br><br>  No busqu√© ni estudi√© la descripci√≥n formal del problema, pero decid√≠ simplemente revertir uno de los ejemplos.  El backend de este art√≠culo no es interesante para nosotros, por lo que no lo escribiremos nosotros mismos, pero use <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">uno de los listos</a> del sitio <a href="https://www.todobackend.com/" rel="nofollow">www.todobackend.com</a> , y de ah√≠ tomaremos <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">un cliente de ejemplo</a> y un <a href="" rel="nofollow">archivo CSS</a> est√°ndar. <br><br>  Para usar dap no necesita descargar ni instalar nada.  No <code>npm install</code> y eso es todo.  No es necesario crear ning√∫n proyecto con una estructura de directorio espec√≠fica, manifiestos y otros atributos de √©xito de TI.  Suficiente editor de texto y navegador.  Para depurar solicitudes XHR, tambi√©n puede necesitar un servidor web, uno bastante simple, como esta <a href="https://chrome.google.com/webstore/detail/web-server-for-chrome/ofhbbkphhbklhfoeikjpcbhemlocgigb" rel="nofollow">extensi√≥n</a> para Chrome.  Toda nuestra interfaz consistir√° en un √∫nico archivo .html (por supuesto, en referencia al script del motor dap y al archivo CSS est√°ndar TodoMVC) <br><br>  Entonces, desde cero. <br><a name="habracut"></a><br><h2>  1. Crear un archivo .html </h2><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Todo -- dap sample<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://www.todobackend.com/client/css/vendor/todomvc-common.css"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://dap.js.org/0.4.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">//   dap </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  La preparaci√≥n html habitual en la que incluimos el archivo CSS, amablemente proporcionado por el sitio <a href="https://www.todobackend.com/" rel="nofollow">www.todobackend.com</a> y el motor dap, no menos amablemente proporcionado por el sitio <a href="https://dap.js.org/" rel="nofollow">dap.js.org</a> <br><br><h2>  2. Copie la estructura DOM del ejemplo original </h2><br>  Para usar el archivo CSS est√°ndar sin alteraciones, nos adheriremos a la misma estructura DOM que el <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">ejemplo original</a> .  √Åbralo en el navegador Chrome, presione Ctr + Shift + I, seleccione la pesta√±a Elementos y vea que la aplicaci√≥n en s√≠ est√° en la <code>section id="todo-app"&gt;</code> elemento <code>section id="todo-app"&gt;</code> <br><br><img src="https://habrastorage.org/webt/3d/ks/mq/3dksmqoxzyif_tgnxfc3v-wf_us.png"><br><br>  Al abrir este sub√°rbol uno por uno, reescribimos su estructura en nuestro archivo .html.  Ahora estamos simplemente dibujando de una manera r√°pida, y no escribiendo c√≥digo, as√≠ que solo escribimos las firmas de los elementos entre 'comillas simples' y entre par√©ntesis de sus hijos.  Si no hay ni√±os, dibujamos corchetes vac√≠os.  Monitoreamos los √≠ndices y el equilibrio de los corchetes. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   dap '#todoapp'( '#header'( 'H1'() 'INPUT#new-todo placeholder="What needs to be done?" autofocus'() ) '#main'( '#toggle-all type=checkbox'() 'UL#todo-list'( 'LI'( 'INPUT.toggle type=checkbox'() 'LABEL'() 'BUTTON.destroy'() ) ) ) '#footer'( '#todo-count'() 'UL#filters'( 'LI'() ) '#clear-completed'() ) )</span></span></code> </pre><br>  Nota: los elementos repetidos (por ejemplo, aqu√≠ son elementos <code>LI</code> ) los escribimos a la estructura una vez, incluso si hay varios de ellos en el original;  obviamente, estos son matrices del mismo patr√≥n. <br><br>  El formato de firma, creo, es comprensible para cualquiera que haya escrito HTML y CSS con sus manos, por lo que no me detendr√© en detalles por ahora.  Solo puedo decir que las etiquetas est√°n escritas en letras MAY√öSCULAS, y la ausencia de una etiqueta es equivalente a la presencia de una etiqueta DIV.  La abundancia de elementos # (con id) se debe a los detalles del archivo CSS incluido, que utiliza principalmente selectores de id. <br><br><h2>  3. Recuerde que el programa dap es Javascript </h2><br>  Para salvarnos de los corchetes innecesarios en el c√≥digo, el motor dap inyecta varios m√©todos directamente en <code>String.prototype</code> (soy consciente de que implementar sus m√©todos en objetos est√°ndar es ayahay, pero ... en resumen, lo hemos aprobado), que convierte la cadena de firma en dap plantilla  Uno de estos m√©todos es <code>.d(rule, ...children)</code> .  El primer argumento que toma es una regla de generaci√≥n (regla <i>d</i> ), y el resto de los argumentos son un n√∫mero arbitrario de hijos. <br><br>  En base a este nuevo conocimiento, agregamos nuestro c√≥digo para que en lugar de cada llave de apertura tengamos la secuencia <code>.d(""</code> , y antes de cada comilla simple de apertura, excepto la primera, hay una coma. Hack de vida: puede usar el reemplazo autom√°tico. <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'#todoapp'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'#header'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'H1'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'INPUT#new-todo placeholder="What needs to be done?" autofocus'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) ,<span class="hljs-string"><span class="hljs-string">'#main'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'#toggle-all type=checkbox'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'UL#todo-list'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'INPUT.toggle type=checkbox'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'LABEL'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'BUTTON.destroy'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) ) ) ,<span class="hljs-string"><span class="hljs-string">'#footer'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'#todo-count'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'UL#filters'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) ,<span class="hljs-string"><span class="hljs-string">'#clear-completed'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) )</code> </pre><br>  Voila!  Tenemos un √°rbol de llamadas al m√©todo <code>.d</code> , que est√° listo para transformarse en una plantilla dap.  Las cadenas vac√≠as <code>""</code> son las semillas de futuras reglas d, y los childs son argumentos separados por comas.  Formalmente, este es un programa dap v√°lido, aunque a√∫n no completamente con el escape que necesitamos.  ¬°Pero ya se puede lanzar!  Para hacer esto, despu√©s del cierre del corchete ra√≠z, agregue el m√©todo <code>.RENDER()</code> .  Este m√©todo, como su nombre lo indica, representa la plantilla resultante. <br><br>  Entonces, en esta etapa, tenemos un archivo .html con este contenido: <br><br><pre> <code class="javascript hljs">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Todo -- dap sample&lt;/title&gt; &lt;link rel="stylesheet" href="https://www.todobackend.com/client/css/vendor/todomvc-common.css"/&gt; &lt;script src="https://dap.js.org/0.4.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; '#todoapp'.d("" ,'#header'.d("" ,'H1'.d("") ,'INPUT#new-todo placeholder="What needs to be done?" autofocus'.d("") ) ,'#main'.d("" ,'#toggle-all type=checkbox'.d("") ,'UL#todo-list'.d("" ,'LI'.d("" ,'INPUT.toggle type=checkbox'.d("") ,'LABEL'.d("") ,'BUTTON.destroy'.d("") ) ) ) ,'#footer'.d("" ,'#todo-count'.d("") ,'UL#filters'.d("" ,'LI'.d("") ) ,'#clear-completed'.d("") ) ) .RENDER() //   dap   &lt;/script&gt; &lt;/body&gt; &lt;/html&gt;</code> </pre><br>  Puede <a href="http://dap.js.org/samples/tutorial/3.html" rel="nofollow">abrirlo en un navegador</a> para asegurarse de que se generen elementos DOM, se apliquen estilos CSS, solo queda llenar esta plantilla con datos. <br><br><h2>  4. Obtenga los datos </h2><br>  Vamos a <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">la p√°gina original</a> , abrimos la pesta√±a Red en las herramientas, activamos el filtro XHR y vemos de d√≥nde provienen los datos y de qu√© forma. <br><br><img src="https://habrastorage.org/webt/vf/ff/4l/vfff4lreh7nhj6jpgb8re83wb-s.png"><br><br><img src="https://habrastorage.org/webt/qi/lh/ga/qilhganpuhmmtevpnyuytm1uadu.png"><br><br>  Vale, vale.  La lista de tareas se toma directamente de <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">todo-backend-express.herokuapp.com</a> como una matriz json de objetos.  Genial <br><br>  Para recibir datos, dap tiene un convertidor incorporado <code>:query</code> que asincr√≥nicamente "convierte" la URL en los datos recibidos de ella.  No escribiremos la URL en s√≠ directamente en la regla, pero la designaremos con <code>todos</code> constantes;  entonces todo el dise√±o de miner√≠a de datos se ver√° as√≠: <br><br><pre> <code class="javascript hljs">todos:query</code> </pre><br>  y escriba la constante <code>todos</code> en el diccionario, en la secci√≥n <code>.DICT</code> , justo antes de <code>.RENDER()</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'#todoapp'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ... ) .DICT({ <span class="hljs-attr"><span class="hljs-attr">todos</span></span> : <span class="hljs-string"><span class="hljs-string">"https://todo-backend-express.herokuapp.com/"</span></span> }) .RENDER()</code> </pre><br>  Una vez recibido el conjunto de <code>todos</code> , construimos una lista de tareas a partir de √©l: para cada caso tomamos el nombre del campo <code>.title</code> y lo escribimos en el elemento <code>LABEL</code> , y desde el campo <code>.completed</code> tomamos el signo de "integridad" y escribimos en la propiedad <code>checked</code> del elemento de <code>checked</code> <code>INPUT.toggle</code> .  Se hace as√≠: <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'UL#todo-list'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"*@ todos:query"</span></span> <span class="hljs-comment"><span class="hljs-comment">//  *       ,'LI'.d("" ,'INPUT.toggle type=checkbox'.d("#.checked=.completed") // #  " " ,'LABEL'.d("! .title") //  !      ,'BUTTON.destroy'.d("") ) )</span></span></code> </pre><br>  Actualizamos nuestra p√°gina en el navegador y ... si la inicia desde el sistema de archivos, no pasa nada.  El problema es que los navegadores modernos no permiten solicitudes XHR entre dominios de documentos locales. <br><br><img src="https://habrastorage.org/webt/tm/fy/bi/tmfybiqw7s2geblqodepfg7k7lk.png"><br><br>  Es hora de ver nuestra p√°gina a trav√©s de http, utilizando cualquier servidor web local.  Bueno, o si no est√° listo para escribir dap con sus propias manos, vea versiones secuenciales de la p√°gina usando mis enlaces (no olvide mirar la fuente; en Chrome, esto se hace usando Ctrl + U) <br><br>  Entonces, vamos <a href="http://dap.js.org/samples/tutorial/4.html" rel="nofollow">a nuestra p√°gina en http: //</a> y vemos que los datos est√°n llegando, la lista est√° siendo construida.  Genial  ¬°Ya has dominado el <code>*</code> y los operadores <code>!</code>  , convertidor <code>:query</code> , constantes y acceso a los campos del elemento de matriz actual.  Mire nuevamente el c√≥digo resultante.  ¬øTodav√≠a te parece ilegible? <br><br><h2>  5. A√±adir estado </h2><br>  Quiz√°s ya haya intentado hacer clic en las marcas de verificaci√≥n en la lista de tareas pendientes.  Las casillas de verificaci√≥n cambian de color, pero, a diferencia del original, el elemento primario <code>LI</code> no cambia su estilo (el "trabajo completado" debe volverse gris y tachado, pero esto no sucede): las cosas no cambian su <i>estado</i> .  Pero estos elementos a√∫n no tienen ning√∫n estado y, en consecuencia, no pueden cambiarlo.  Ahora lo arreglaremos. <br><br>  Agregue un estado de "finalizaci√≥n" al elemento <code>LI</code> .  Para hacer esto, defina la <i>variable de estado</i> <code>$completed</code> en su regla d.  Al <code>INPUT.toggle</code> , que puede cambiar este estado, asignaremos una regla de reacci√≥n apropiada ( <i>ui-rule</i> ), que establecer√° la variable <code>$completed</code> de acuerdo con su propia marca <code>checked</code> ("daw est√° activado").  Dependiendo del estado de <code>$completed</code> elemento <code>LI</code> habilitar√° o deshabilitar√° la clase CSS "completada". <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'UL#todo-list'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"*@ todos:query"</span></span> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed"</span></span><span class="hljs-comment"><span class="hljs-comment">//  ,    .completed ,'INPUT.toggle type=checkbox' .d("#.checked=.completed") //       .ui("$completed=#.checked") //    $completed ,'LABEL'.d("! .title") ,'BUTTON.destroy'.d("") ) .a("!? $completed") //     $completed,    css- completed )</span></span></code> </pre><br>  Tales manipulaciones con clases CSS son bastante comunes, ¬°as√≠ que hay un operador especial en dap para ellas! <br>  Tenga en cuenta que hacemos esto en la <i>regla a</i> (de la palabra acumular).  ¬øPor qu√© no en la regla d?  La diferencia entre estos dos tipos de reglas es que, al actualizar, la regla d reconstruye completamente el contenido del elemento, eliminando las antiguas y las nuevas, mientras que la regla a no toca el contenido existente del elemento, sino que "agrega" el resultado a lo que ya est√° all√≠.  Cambiar un solo atributo de un elemento <code>LI</code> no requiere reestructurar el resto de su contenido, por lo que es m√°s racional hacerlo en la regla a. <br><br>  Nos fijamos en el <a href="http://dap.js.org/samples/tutorial/5-1.html" rel="nofollow">resultado</a> .  Ya es mejor: hacer clic en las casillas de verificaci√≥n cambia el estado del elemento de tarea pendiente correspondiente y, de acuerdo con este estado, el estilo visual del elemento tambi√©n cambia.  Pero todav√≠a hay un problema: si la lista de tareas completadas estaba inicialmente presente, no ser√°n grises, porque de forma predeterminada la regla a no se ejecuta cuando se genera el elemento.  Para ejecutarlo incluso durante la generaci√≥n, agregamos el operador <code>a!</code> A la regla d del elemento <code>LI</code> <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed; a!"</span></span> <span class="hljs-comment"><span class="hljs-comment">//      $completed    a-</span></span></code> </pre><br>  <a href="http://dap.js.org/samples/tutorial/5-2.html" rel="nofollow">Nosotros miramos</a> .  Esta bien  Con el estado de <code>$completed</code> resuelto.  Los casos completados se estilizan correctamente tanto en el arranque inicial como durante el cambio manual posterior. <br><br><h2>  6. Edici√≥n de nombres de casos </h2><br>  De vuelta al <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">original</a> .  Al hacer doble clic en el nombre del caso, se activa el modo de edici√≥n, en el que se puede cambiar este nombre.  All√≠ se implementa de tal manera que la plantilla del modo de vista "ver" (con un daw, un t√≠tulo y un bot√≥n de eliminaci√≥n) est√° completamente oculta, y se muestra el elemento <code>INPUT class="edit"</code> .  Lo haremos un poco diferente: ocultaremos solo el elemento <code>LABEL</code> , ya que los otros dos elementos no interfieren con nuestra edici√≥n.  Simplemente agregue la clase de <code>view</code> al elemento <code>LABEL</code> . <br><br>  Para el estado "edici√≥n", defina la variable <code>$editing</code> en el elemento <code>LI</code> .  Inicialmente, se restablece (estado), se activa mediante <code>dblclick</code> en el elemento <code>LABEL</code> y se desactiva cuando el elemento <code>INPUT.edit</code> est√° desenfocado.  Entonces escribimos: <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed $editing=; a!"</span></span> <span class="hljs-comment"><span class="hljs-comment">//       ,'INPUT.toggle type=checkbox' .d("#.checked=.completed") .ui("$completed=#.checked") ,'LABEL.view' .d("? $editing:!; ! .title") //  $editing ,     .e("dblclick","$editing=`yes") //  dblclick  $editing ,'INPUT.edit' .d("? $editing; !! .title@value") //  $editing  .ui(".title=#.value") //  .title   change (ui     INPUT) .e("blur","$editing=") //  $editing   blur ,'BUTTON.destroy'.d("") ).a("!? $completed $editing") //   $completed  $editing  css-  'LI'</span></span></code> </pre><br>  Ahora podemos editar los nombres de los casos. <br><br><h2>  7. Enviar datos al servidor </h2><br>  Ok, ya podemos editar cosas en el navegador, pero estos cambios tambi√©n deben transferirse al servidor.  Vemos c√≥mo lo hace el original: <br><br><img src="https://habrastorage.org/webt/jd/r5/bw/jdr5bwsa8yi7wu4sbwxqr3bwcdi.png"><br><br>  Los cambios se env√≠an al servidor utilizando el m√©todo PATCH con una determinada URL del formulario <code>http://todo-backend-express.herokuapp.com/28185</code> , que, obviamente, es √∫nico para cada caso.  El servidor indica esta URL en el campo <code>.url</code> para cada caso de la lista.  Es decir, todo lo que se requiere de nosotros para actualizar el caso en el servidor es enviar una solicitud PATCH a la direcci√≥n especificada en el campo <code>.url</code> , con los datos modificados en formato JSON: <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'INPUT.edit'</span></span> .d(<span class="hljs-string"><span class="hljs-string">"? $editing; !! .title@value"</span></span>) .ui(<span class="hljs-string"><span class="hljs-string">".title=#.value; (@method`PATCH .url (@Content-type`application/json)@headers (.title):json.encode@body):query"</span></span>) .e(<span class="hljs-string"><span class="hljs-string">"blur"</span></span>,<span class="hljs-string"><span class="hljs-string">"$editing="</span></span>)</code> </pre><br>  Aqu√≠ usamos el mismo conversor <code>:query</code> , pero en una versi√≥n m√°s detallada.  Cuando <code>:query</code> se aplica a una cadena simple, esta cadena se trata como una URL y se ejecuta una solicitud GET.  Si <code>:query</code> recibe un objeto complejo, como en este caso, lo trata como una descripci√≥n detallada de la solicitud que contiene los campos <code>.url</code> , <code>.headers</code> , <code>.headers</code> y <code>.headers</code> , y ejecuta la solicitud de acuerdo con ellos.  Aqu√≠, inmediatamente despu√©s de actualizar <code>.title</code> enviamos al servidor una solicitud de PATCH con este <code>.title</code> actualizado <br><br>  Pero hay un matiz.  Obtenemos el campo <code>.url</code> del servidor, se ve m√°s o menos as√≠: <code>http://todo-backend-express.herokuapp.com/28185</code> , es decir, el protocolo http: // est√° codificado si nuestro cliente tambi√©n est√° abierto a trav√©s de http: // entonces todo est√° bien.  Pero si el cliente est√° abierto a trav√©s de https: //, surge un problema: por razones de seguridad, el navegador bloquea el tr√°fico http desde la fuente https. <br><br>  Se resuelve simplemente: si elimina el protocolo de <code>.url</code> , la solicitud pasar√° por el protocolo de la p√°gina.  As√≠ que hag√°moslo: escriba el convertidor apropiado - <code>dehttp</code> , y pasaremos <code>.url</code> trav√©s de √©l.  Los convertidores personalizados (y otras funciones) se <code>.FUNC</code> en la secci√≥n <code>.FUNC</code> : <br><br><pre> <code class="javascript hljs"> .ui(<span class="hljs-string"><span class="hljs-string">".title=#.value; (@method`PATCH .url:dehttp (@Content-type`application/json)@headers (.title):json.encode@body):query"</span></span>) ... .FUNC({ <span class="hljs-attr"><span class="hljs-attr">convert</span></span>:{ <span class="hljs-comment"><span class="hljs-comment">//  -         dehhtp: url=&gt;url.replace(/^https?\:/,'')//    URL } })</span></span></code> </pre><br>  Tambi√©n tiene sentido poner el objeto de encabezado en el diccionario para que pueda usarse en otras consultas: <br><br><pre> <code class="javascript hljs"> .ui(<span class="hljs-string"><span class="hljs-string">".title=#.value; (@method`PATCH .url:dehttp headers (.title):json.encode@body):query"</span></span>) ... .DICT({ <span class="hljs-attr"><span class="hljs-attr">todos</span></span> : <span class="hljs-string"><span class="hljs-string">"//todo-backend-express.herokuapp.com/"</span></span>, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: {<span class="hljs-string"><span class="hljs-string">"Content-type"</span></span>:<span class="hljs-string"><span class="hljs-string">"application/json"</span></span>} })</code> </pre><br>  Bueno, para el feng shui completo, utilizaremos otra propiedad √∫til del convertidor <code>:query</code> : codificaci√≥n autom√°tica del cuerpo de la solicitud en json de acuerdo con el <code>Content-type:application/json</code> encabezado de <code>Content-type:application/json</code> .  Como resultado, la regla se ver√° as√≠: <br><br><pre> <code class="javascript hljs"> .ui(<span class="hljs-string"><span class="hljs-string">".title=#.value; (@method`PATCH .url:dehttp headers (.title)):query"</span></span>)</code> </pre><br>  Entonces, <a href="http://dap.js.org/samples/tutorial/7-2.html" rel="nofollow">mira</a> .  De acuerdo, los nombres de los casos ahora cambian no solo en el navegador, sino tambi√©n en el servidor.  Pero!  No solo el nombre del caso puede cambiar, sino tambi√©n su estado de finalizaci√≥n: <code>completed</code> .  Por lo tanto, tambi√©n debe enviarse al servidor. <br>  Puede agregar la misma solicitud PATCH al elemento <code>INPUT.toggle</code> , solo env√≠e <code>(.completed)</code> lugar de <code>(.completed)</code> : <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'INPUT.toggle type=checkbox'</span></span> .d(<span class="hljs-string"><span class="hljs-string">"#.checked=.completed"</span></span>) .ui(<span class="hljs-string"><span class="hljs-string">"$completed=#.checked; (@method`PATCH .url:dehttp headers (.completed:?)):query"</span></span>)</code> </pre><br>  Y puede poner esta solicitud de PARCHE "entre par√©ntesis": <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed $editing= $patch=; a!"</span></span> <span class="hljs-comment"><span class="hljs-comment">// $patch - ""   ,'INPUT.toggle type=checkbox' .d("#.checked=.completed") .ui("$patch=($completed=#.checked)") //   $patch  completed ,'LABEL.view' .d("? $editing:!; ! .title") .e("dblclick","$editing=`yes") ,'INPUT.edit' .d("? $editing; !! .title@value") .ui("$patch=(.title=#.value)") //   $patch  title .e("blur","$editing=") ,'BUTTON.destroy'.d("") ) .a("!? $completed $editing") //  $patch  ,   ,   .u("? $patch; (@method`PATCH .url:dehttp headers $patch@):query $patch=")</span></span></code> </pre><br>  Aqu√≠ est√° la cosa.  Las reglas de reacci√≥n pertenecen al grupo de "reglas superiores", que se ejecutan "de abajo hacia arriba", desde el descendiente hasta el padre, hasta la ra√≠z misma (esta secuencia puede interrumpirse si es necesario).  Esto es algo as√≠ como los eventos emergentes en el DOM.  Por lo tanto, algunos fragmentos de la reacci√≥n com√∫n a varios descendientes pueden asignarse a un antepasado com√∫n. <br><br>  Espec√≠ficamente, en nuestro caso, la ganancia de dicha delegaci√≥n no es particularmente notable, pero si hubiera m√°s campos editables, poner esta solicitud voluminosa (por est√°ndares dap, por supuesto) en una regla general ayudar√≠a enormemente a mantener el c√≥digo simple y legible.  Por eso lo recomiendo. <br><br>  <a href="http://dap.js.org/samples/tutorial/7-3.html" rel="nofollow">Buscamos</a> : ahora tanto los cambios de nombre como los cambios de estado se env√≠an al servidor. <br><br>  En el siguiente art√≠culo, si est√° interesado, considere agregar, eliminar y filtrar casos.  Mientras tanto, puede ver el <a href="https://dap.js.org/samples/todo.html" rel="nofollow">resultado final</a> y otros ejemplos de c√≥digo dap en <a href="https://dap.js.org/docs/" rel="nofollow">dap.js.org/docs</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/480912/">https://habr.com/ru/post/480912/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../480900/index.html">¬°Trae de vuelta a mi beb√©! (N.-F. historia)</a></li>
<li><a href="../480902/index.html">Nuevas caracter√≠sticas de monitoreo de Postgres_exporter PostgreSQL</a></li>
<li><a href="../480904/index.html">PHP Microservice Framework: entorno de desarrollo para Swoft</a></li>
<li><a href="../480906/index.html">Escribir un simple juego de pit√≥n</a></li>
<li><a href="../480910/index.html">C√≥mo hacer una clase de prueba b√°sica para las pruebas de selenio e inicializar a trav√©s de JUnit RuleChain</a></li>
<li><a href="../480914/index.html">Microservicios para principiantes</a></li>
<li><a href="../480918/index.html">Apache Hadoop Code Quality: Production VS Test</a></li>
<li><a href="../480920/index.html">Prueba de interruptores TP-Link con PoE de largo alcance. Y un poco sobre actualizaciones de modelos antiguos</a></li>
<li><a href="../480922/index.html">Evgeny Usvitsky: "Todos en el mundo saben d√≥nde obtener geodatos libremente, solo en OSM"</a></li>
<li><a href="../480924/index.html">C√≥mo y por qu√© los creadores del remake de MediEvil redise√±aron al jefe de culto del juego</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>