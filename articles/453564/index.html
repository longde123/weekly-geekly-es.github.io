<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìπ üëÉüèº üë®‚Äçüëß‚Äçüë¶ Make it True: desarrollo de un juego de l√≥gica en Unity üéÖüèº ‚õàÔ∏è üë©üèΩ‚Äçü§ù‚Äçüë®üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quiero compartir el proceso de desarrollo de un juego m√≥vil simple por dos desarrolladores y un artista. Este art√≠culo es en gran parte una descripci√≥...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Make it True: desarrollo de un juego de l√≥gica en Unity</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453564/"><img src="https://habrastorage.org/webt/4k/h-/6e/4kh-6e4-iwvtuaz42eqb2gg81iu.png"><br><br>  Quiero compartir el proceso de desarrollo de un juego m√≥vil simple por dos desarrolladores y un artista.  Este art√≠culo es en gran parte una descripci√≥n de la implementaci√≥n t√©cnica. <br>  ¬°Atenci√≥n, mucho texto! <br><br>  El art√≠culo no es una gu√≠a o lecci√≥n, aunque espero que los lectores puedan aprender algo √∫til de √©l.  Dise√±ado para desarrolladores familiarizados con Unity con cierta experiencia en programaci√≥n. <br><a name="habracut"></a><br><a name="Content"></a><h4>  Contenido: </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Idea</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jugabilidad</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parcela</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Desarrollo</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">N√∫cleo</a> <br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Elementos electricos</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Solucionador</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ElementsProvider</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CircuitGenerator</a> </li></ol><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Clases de juego</a> <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enfoque de desarrollo y DI</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Configuracion</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Elementos electricos</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Gesti√≥n del juego</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Carga de nivel</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Escenas de corte</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jugabilidad adicional</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Monetizaci√≥n</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Interfaz de usuario</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Anal√≠tica</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Posicionamiento de c√°mara y diagramas</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Esquemas de color</a> </li></ol><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Extensiones de editor</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><br></a> <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Generador</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Solucionador</a> </li></ol><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">√ötil</a> <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ayudar</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SceneObjectsHelper</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Coroutinestarter</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Gizmo</a> </li></ol><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Prueba</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Resumen de desarrollo</a> <br><br><a name="Idea"></a><h2>  Idea </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Contenido</a> <br><br>  Hubo una idea para hacer un juego m√≥vil simple en un per√≠odo corto. <br><br>  T√©rminos: <br><br><ul><li>  Juego f√°cil de implementar </li><li>  Requisitos m√≠nimos de arte </li><li>  Tiempo de desarrollo corto (varios meses) </li><li>  Con f√°cil automatizaci√≥n de la creaci√≥n de contenido (niveles, ubicaciones, elementos del juego) </li><li>  Crea r√°pidamente un nivel si el juego consta de un n√∫mero finito de niveles </li></ul><br>  Para decidir, pero ¬øqu√© hacer realmente?  Despu√©s de todo, surgi√≥ la idea de hacer un juego, no la idea de un juego.  Se decidi√≥ buscar inspiraci√≥n en la tienda de aplicaciones. <br><br>  A los elementos anteriores se agregan: <br><br><ul><li>  El juego debe tener cierta popularidad entre los jugadores (n√∫mero de descargas + calificaciones) </li><li>  La tienda de aplicaciones no debe estar llena de juegos similares </li></ul><br>  Se encontr√≥ un juego con un juego basado en puertas l√≥gicas.  No hubo similares en gran n√∫mero. El juego tiene muchas descargas y calificaciones positivas.  Sin embargo, despu√©s de intentarlo, hubo algunos inconvenientes que se pueden tener en cuenta en su juego. <br><br>  La jugabilidad del juego es que el nivel es un circuito digital con muchas entradas y salidas.  El jugador debe elegir una combinaci√≥n de entradas para que la salida sea l√≥gica 1. No suena muy dif√≠cil.  El juego tambi√©n ha generado niveles autom√°ticamente, lo que sugiere la capacidad de automatizar la creaci√≥n de niveles, aunque no suena muy simple.  El juego tambi√©n es bueno para aprender, lo que realmente me gust√≥. <br><br>  Pros: <br><br><ul><li>  Simplicidad t√©cnica de juego </li><li>  Parece f√°cil de probar con pruebas autom√°ticas </li><li>  Capacidad para generar niveles autom√°ticamente </li></ul><br>  Contras: <br><br><ul><li>  Primero debes crear niveles </li></ul><br>  Ahora explore los defectos del juego que inspiraron. <br><br><ul><li>  No adaptado a la relaci√≥n de aspecto personalizada, como 18: 9 </li><li>  No hay forma de saltear un nivel dif√≠cil u obtener una pista </li><li>  En las revisiones hubo quejas sobre un peque√±o n√∫mero de niveles </li><li>  Las cr√≠ticas se quejaron de la falta de variedad de elementos. </li></ul><br>  Procedemos a la planificaci√≥n de nuestro juego: <br><br><ul><li>  Utilizamos puertas l√≥gicas est√°ndar (AND, NAND, OR, NOR, XOR, XNOR, NOR, NOT) </li><li>  Las puertas se muestran con una imagen en lugar de una designaci√≥n de texto, que es m√°s f√°cil de distinguir.  Como los elementos tienen notaci√≥n ANSI est√°ndar, los usamos. </li><li>  Descartamos el interruptor que conecta una entrada a una de las salidas.  Debido al hecho de que requiere que hagas clic en ti mismo y no encaja un poco en los elementos digitales reales.  S√≠, y es dif√≠cil imaginar un interruptor de palanca en un chip. </li><li>  Agregue los elementos del codificador y decodificador. </li><li>  Introducimos un modo en el que el jugador debe seleccionar el elemento deseado en la celda con valores fijos en las entradas del circuito. </li><li>  Brindamos ayuda al jugador: pista + nivel de omisi√≥n. </li><li>  Ser√≠a bueno agregar alguna trama. </li></ul><br><a name="Gameplay"></a><h2>  Jugabilidad </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Contenido</a> <br><br>  Modo 1: el jugador recibe un circuito y tiene acceso para cambiar los valores en las entradas. <br>  Modo 2: el jugador recibe un circuito en el que puede cambiar los elementos pero no puede cambiar los valores en las entradas. <br><br>  La jugabilidad ser√° en forma de niveles preparados previamente.  Despu√©s de completar el nivel, el jugador debe obtener alg√∫n resultado, que se har√° en forma de las tres estrellas tradicionales, dependiendo del resultado del pasaje. <br><br>  Cu√°les pueden ser los indicadores de rendimiento: <br>  N√∫mero de acciones: cada interacci√≥n con los elementos del juego aumenta el contador. <br>  El n√∫mero de diferencias en el estado resultante del original.  No tiene en cuenta cu√°ntos intentos tuvo que completar el jugador.  Desafortunadamente, no encaja con el segundo r√©gimen. <br>  Ser√≠a bueno agregar el mismo modo con generaci√≥n de nivel aleatorio.  Pero por ahora, posponga para m√°s tarde. <br><br><a name="Plot"></a><h2>  Parcela </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Contenido</a> <br><br>  Mientras pensaba en la jugabilidad y comenzaba el desarrollo, aparecieron varias ideas para mejorar el juego.  Y apareci√≥ una idea bastante interesante: agregar una trama. <br><br>  Se trata de un ingeniero que dise√±a circuitos.  No est√° mal, pero no est√° completo. ¬øQuiz√°s vale la pena mostrar la fabricaci√≥n de fichas en funci√≥n de lo que hace el jugador?  De alguna manera rutinaria, no hay un resultado comprensible y simple. <br><br>  La idea!  Un ingeniero desarrolla un robot genial usando sus circuitos l√≥gicos.  El robot es algo bastante simple y comprensible y se adapta perfectamente a la jugabilidad. <br><br>  ¬øRecuerdas el primer p√°rrafo, "Requisitos m√≠nimos para el arte"?  Algo no encaja con las escenas en la trama.  Luego, un artista familiar viene al rescate, que acept√≥ ayudarnos. <br><br>  Ahora decidamos el formato y la integraci√≥n de las escenas en el juego. <br><br>  La trama debe mostrarse como escenas sin puntuaci√≥n o una descripci√≥n de texto que eliminar√° los problemas de localizaci√≥n, simplificar√° su comprensi√≥n y muchos reproducir√°n en dispositivos m√≥viles sin sonido.  El juego es un elemento muy real de los circuitos digitales, es decir, es muy posible conectar esto con la realidad. <br><br>  Las escenas y niveles deber√≠an ser escenas separadas.  Antes de cierto nivel, se carga una escena espec√≠fica. <br><br>  Bueno, la tarea est√° establecida, hay recursos que cumplir, el trabajo ha comenzado a hervir. <br><br><a name="Development"></a><h2>  Desarrollo </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Contenido</a> <br><br>  Inmediatamente me decid√≠ por la plataforma, esta es la Unidad.  S√≠, un poco exagerado, pero no obstante la conozco. <br><br>  Durante el desarrollo, el c√≥digo se escribe inmediatamente con pruebas o incluso despu√©s.  Pero para una narrativa hol√≠stica, las pruebas se colocan en una secci√≥n separada a continuaci√≥n.  La secci√≥n actual describir√° el proceso de desarrollo por separado de las pruebas. <br><br><a name="Core"></a><h3>  N√∫cleo </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Contenido</a> <br><br>  El n√∫cleo del juego parece bastante simple y no est√° vinculado al motor, por lo que comenzamos con el dise√±o en forma de c√≥digo C #.  Parece que puede seleccionar una l√≥gica de n√∫cleo central separada.  Ll√©velo a un proyecto separado. <br><br>  Unity funciona con una soluci√≥n C # y los proyectos en el interior son un poco inusuales para un desarrollador regular .Net, los archivos .sln y .csproj son generados por la propia Unity y los cambios dentro de estos archivos no se aceptan para su consideraci√≥n por parte de Unity.  Simplemente los sobrescribir√° y eliminar√° todos los cambios.  Para crear un nuevo proyecto, debe usar el archivo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">definici√≥n de ensamblaje</a> . <br><br><img src="https://habrastorage.org/webt/b2/84/92/b28492ps5o-_mv62mdvo1frk4l8.png"><br><br><img src="https://habrastorage.org/webt/vd/xk/_k/vdxk_k9ydjfhu1aiee8ctlx3eau.png"><br><br>  Unity ahora genera un proyecto con el nombre apropiado.  Todo lo que se encuentra en la carpeta con el archivo .asmdef estar√° relacionado con este proyecto y ensamblaje. <br><br><a name="CoreElectricalElements"></a><h4>  Elementos electricos </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Contenido</a> <br><br>  La tarea es describir en el c√≥digo la interacci√≥n de elementos l√≥gicos entre s√≠. <br><br><ul><li>  Un elemento puede tener m√∫ltiples entradas y m√∫ltiples salidas. </li><li>  La entrada del elemento debe estar conectada a la salida de otro elemento </li><li>  El elemento en s√≠ debe contener su propia l√≥gica. </li></ul><br>  Empecemos <br><br><ul><li>  <b>El elemento</b> contiene su propia l√≥gica de operaci√≥n y enlaces a sus entradas.  Al solicitar un valor de un elemento, toma valores de las entradas, les aplica l√≥gica y devuelve el resultado.  Puede haber varias salidas, por lo que se solicita el valor para una salida espec√≠fica, el valor predeterminado es 0. </li><li>  Para tomar los valores en la entrada, habr√° un <b>conector de entrada</b> p, que almacena un enlace a otro: el conector de salida. </li><li>  <b>El conector de salida se</b> refiere a un elemento espec√≠fico y almacena un enlace a su elemento, cuando solicita un valor, lo solicita al elemento. </li></ul><br><img src="https://habrastorage.org/webt/am/7q/yo/am7qyonro-bohnomthogk8qy8o0.png"><br><br>  Las flechas indican la direcci√≥n de los datos, la dependencia de los elementos en la direcci√≥n opuesta. <br>  Definir la interfaz del conector.  Puedes obtener el valor de ello. <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IConnector</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Value { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } }</code> </pre> <br>  ¬øC√≥mo conectarlo a otro conector? <br><br>  Definir m√°s interfaces. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IInputConnector</span></span> : <span class="hljs-title"><span class="hljs-title">IConnector</span></span> { IOutputConnector ConnectedOtherConnector { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br>  IInputConnector es un conector de entrada, tiene un enlace a otro conector. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IOutputConnector</span></span> : <span class="hljs-title"><span class="hljs-title">IConnector</span></span> { IElectricalElement Element { <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } }</code> </pre> <br>  El conector de salida se refiere a su elemento desde el cual solicitar√° un valor. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IElectricalElement</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetValue</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">)</span></span>; }</code> </pre> <br>  El elemento el√©ctrico debe contener un m√©todo que devuelva un valor en una salida espec√≠fica, n√∫mero es el n√∫mero de la salida. <br><br>  <i>Lo llam√© IElectricalElement, aunque solo transmite niveles l√≥gicos de voltaje, pero por otro lado puede ser un elemento que no agrega l√≥gica en absoluto, solo transmite un valor, como un conductor.</i> <br><br>  Ahora pasemos a la implementaci√≥n <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">InputConnector</span></span> : <span class="hljs-title"><span class="hljs-title">IInputConnector</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IOutputConnector ConnectedOtherConnector { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Value { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ConnectedOtherConnector?.Value ?? <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } }</code> </pre> <br>  El conector entrante puede no estar conectado, en cuyo caso devolver√° falso. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">OutputConnector</span></span> : <span class="hljs-title"><span class="hljs-title">IOutputConnector</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> number; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OutputConnector</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.number = number; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IElectricalElement Element { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Value =&gt; Element.GetValue(number); } }</code> </pre> <br>  La salida debe tener un enlace a su elemento y su n√∫mero en relaci√≥n con el elemento. <br>  Adem√°s, usando este n√∫mero, solicita un valor al elemento. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ElectricalElementBase</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IInputConnector[] Input { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br>  La clase base para todos los elementos, solo contiene una matriz de entradas. <br><br>  Ejemplo de implementaci√≥n de un elemento: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">And</span></span> : <span class="hljs-title"><span class="hljs-title">ElectricalElementBase</span></span>, <span class="hljs-title"><span class="hljs-title">IElectricalElement</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetValue</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> outputValue = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input?.Length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { outputValue = Input[<span class="hljs-number"><span class="hljs-number">0</span></span>].Value; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Input) { outputValue &amp;= item.Value; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> outputValue; } }</code> </pre> <br>  La implementaci√≥n se basa completamente en operaciones l√≥gicas sin una tabla de verdad dura.  Quiz√°s no sea tan expl√≠cito como con la tabla, pero ser√° flexible, funcionar√° en cualquier cantidad de entradas. <br>  Todas las puertas l√≥gicas tienen una salida, por lo que el valor en la salida no depender√° del n√∫mero de entrada. <br><br>  Los elementos invertidos se realizan de la siguiente manera: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Nand</span></span> : <span class="hljs-title"><span class="hljs-title">And</span></span>, <span class="hljs-title"><span class="hljs-title">IElectricalElement</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> new </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetValue</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !<span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.GetValue(number); } }</code> </pre> <br>  Vale la pena se√±alar que aqu√≠ el m√©todo GetValue se anula y no se anula virtualmente.  Esto se hace en base a la l√≥gica de que si Nand guarda en Y, continuar√° comport√°ndose como Y.  Tambi√©n fue posible aplicar la composici√≥n, pero esto requerir√≠a un c√≥digo adicional, lo que no tiene mucho sentido. <br><br>  Adem√°s de las v√°lvulas convencionales, se crearon los siguientes elementos: <br>  Fuente: una fuente de valor constante de 0 o 1. <br>  Conductor: exactamente el mismo O conductor, solo tiene una aplicaci√≥n ligeramente diferente, ver generaci√≥n. <br>  AlwaysFalse: siempre devuelve 0, necesario para el segundo modo. <br><br><a name="Solver"></a><h4>  Solucionador </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Contenido</a> <br><br>  Luego, una clase es √∫til para encontrar autom√°ticamente combinaciones que den 1 en la salida del circuito. <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ISolver</span></span> { ICollection&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>[]&gt; GetSolutions(IElectricalElement root, <span class="hljs-keyword"><span class="hljs-keyword">params</span></span> Source[] sources); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Solver</span></span> : <span class="hljs-title"><span class="hljs-title">ISolver</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ICollection&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>[]&gt; GetSolutions(IElectricalElement root, <span class="hljs-keyword"><span class="hljs-keyword">params</span></span> Source[] sources) { <span class="hljs-comment"><span class="hljs-comment">// max value can be got with this count of bits(sources count), also it's count of combinations -1 // for example 8 bits provide 256 combinations, and max value is 255 int maxValue = Pow(sources.Length); // inputs that can solve circuit var rightInputs = new List&lt;bool[]&gt;(); for (int i = 0; i &lt; maxValue; i++) { var inputs = GetBoolArrayFromInt(i, sources.Length); for (int j = 0; j &lt; sources.Length; j++) { sources[j].Value = inputs[j]; } if (root.GetValue()) { rightInputs.Add(inputs); } } return rightInputs; } private static int Pow(int power) { int x = 2; for (int i = 1; i &lt; power; i++) { x *= 2; } return x; } private static bool[] GetBoolArrayFromInt(int value, int length) { var bitArray = new BitArray(new[] {value}); var boolArray = new bool[length]; for (int i = length - 1; i &gt;= 0; i‚Äî) { boolArray[i] = bitArray[i]; } return boolArray; }</span></span></code> </pre> <br>  Las soluciones son la fuerza bruta.  Para esto, se determina el n√∫mero m√°ximo que puede expresarse mediante un conjunto de bits en una cantidad igual al n√∫mero de fuentes.  Es decir, 4 fuentes = 4 bits = n√∫mero m√°ximo 15. Ordenamos todos los n√∫meros del 0 al 15. <br><br><a name="ElementsProvider"></a><h4>  ElementsProvider </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Contenido</a> <br><br>  Por conveniencia de generaci√≥n, decid√≠ definir un n√∫mero para cada elemento. Para hacer esto, cre√© la clase ElementsProvider con la interfaz IElementsProvider. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IElementsProvider</span></span> { IList&lt;Func&lt;IElectricalElement&gt;&gt; Gates { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } IList&lt;Func&lt;IElectricalElement&gt;&gt; Conductors { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } IList&lt;ElectricalElementType&gt; GateTypes { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } IList&lt;ElectricalElementType&gt; ConductorTypes { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ElementsProvider</span></span> : <span class="hljs-title"><span class="hljs-title">IElementsProvider</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IList&lt;Func&lt;IElectricalElement&gt;&gt; Gates { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Func&lt;IElectricalElement&gt;&gt; { () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> And(), () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Nand(), () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Or(), () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Nor(), () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Xor(), () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Xnor() }; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IList&lt;Func&lt;IElectricalElement&gt;&gt; Conductors { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Func&lt;IElectricalElement&gt;&gt; { () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Conductor(), () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Not() }; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IList&lt;ElectricalElementType&gt; GateTypes { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;ElectricalElementType&gt; { ElectricalElementType.And, ElectricalElementType.Nand, ElectricalElementType.Or, ElectricalElementType.Nor, ElectricalElementType.Xor, ElectricalElementType.Xnor }; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IList&lt;ElectricalElementType&gt; ConductorTypes { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;ElectricalElementType&gt; { ElectricalElementType.Conductor, ElectricalElementType.Not }; }</code> </pre> <br>  Las dos primeras listas son algo as√≠ como las f√°bricas que dan un art√≠culo en el n√∫mero especificado.  Las dos √∫ltimas listas son una muleta que debe usarse debido a las caracter√≠sticas de Unity.  Sobre esto m√°s all√°. <br><br><a name="CircuitGenerator"></a><h4>  CircuitGenerator </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Contenido</a> <br><br>  Ahora la parte m√°s dif√≠cil del desarrollo es la generaci√≥n de circuitos. <br><br>  La tarea es generar una lista de esquemas a partir de los cuales puede seleccionar el que desee en el editor.  La generaci√≥n es necesaria solo para v√°lvulas simples. <br><br>  Se establecen ciertos par√°metros del esquema, estos son: el n√∫mero de capas (l√≠neas horizontales de elementos) y el n√∫mero m√°ximo de elementos en la capa.  Tambi√©n es necesario determinar desde qu√© compuertas necesita generar circuitos. <br><br>  Mi enfoque consist√≠a en dividir la tarea en dos partes: generaci√≥n de estructura y selecci√≥n de opciones. <br><br>  El generador de estructura determina las posiciones y conexiones de los elementos l√≥gicos. <br>  El generador de variantes selecciona combinaciones v√°lidas de elementos en posiciones. <br><br><h4>  Structuregener </h4><br>  La estructura consta de capas de elementos l√≥gicos y capas de conductores / inversores.  Toda la estructura no contiene elementos reales sino contenedores para ellos. <br><br>  El contenedor es una clase heredada de IElectricalElement, que contiene una lista de elementos v√°lidos y puede cambiar entre ellos.  Cada art√≠culo tiene su propio n√∫mero en la lista. <br><br><pre> <code class="cs hljs">ElectricalElementContainer : ElectricalElementBase, IElectricalElement</code> </pre> <br><br>  Un contenedor puede establecerse "en s√≠ mismo" en uno de los elementos de la lista.  Durante la inicializaci√≥n, debe proporcionarle una lista de delegados que crear√°n los elementos.  En el interior, llama a cada delegado y obtiene el art√≠culo.  Luego puede establecer el tipo espec√≠fico de este elemento, esto conecta el elemento interno a las mismas entradas que en el contenedor y la salida del contenedor se tomar√° de la salida de este elemento. <br><br><img src="https://habrastorage.org/webt/wq/kt/bn/wqktbn6x7esbfnqxkuwh606qvqa.png"><br><br>  M√©todo para configurar la lista de elementos: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetElements</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IList&lt;Func&lt;IElectricalElement&gt;&gt; elements</span></span></span><span class="hljs-function">)</span></span> { Elements = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;IElectricalElement&gt;(elements.Count); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> elements) { Elements.Add(item()); } }</code> </pre> <br>  A continuaci√≥n, puede establecer el tipo de esta manera: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetType</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isInitialized == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidOperationException(UnitializedElementsExceptionMessage); } SelectedType = number; RealElement = Elements[number]; ((ElectricalElementBase) RealElement).Input = Input; }</code> </pre> <br>  Despu√©s de lo cual funcionar√° como el elemento especificado. <br><br>  Se cre√≥ la siguiente estructura para el circuito: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CircuitStructure</span></span> : <span class="hljs-title"><span class="hljs-title">ICloneable</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, ElectricalElementContainer[]&gt; Gates; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, ElectricalElementContainer[]&gt; Conductors; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Source[] Sources; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> And FinalDevice; }</code> </pre> <br>  Los diccionarios aqu√≠ almacenan el n√∫mero de capa en la clave y una matriz de contenedores para esta capa.  El siguiente es un conjunto de fuentes y un Dispositivo Final al que todo est√° conectado. <br><br>  As√≠, el generador estructural crea contenedores y los conecta entre s√≠.  Todo esto se crea en capas, de abajo hacia arriba.  El fondo es el m√°s ancho (la mayor√≠a de los elementos).  La capa de arriba contiene dos veces menos elementos y as√≠ sucesivamente hasta llegar a un m√≠nimo.  Las salidas de todos los elementos de la capa superior est√°n conectadas al dispositivo final. <br><br>  La capa del elemento l√≥gico contiene contenedores para puertas.  En la capa de conductores hay elementos con una entrada y salida.  Los elementos pueden ser un conductor o un elemento NO.  El conductor pasa a la salida lo que lleg√≥ a la entrada, y el elemento NO devuelve el valor invertido en la salida. <br><br>  El primero en crear una variedad de fuentes.  La generaci√≥n se produce de abajo hacia arriba, la capa de conductores se genera primero, luego la capa de l√≥gica y, a su salida, nuevamente conductores. <br><br><img src="https://habrastorage.org/webt/pq/bj/hs/pqbjhsbn3xxxi6r6wosryczrdjc.png"><br><br>  ¬°Pero tales esquemas son muy aburridos!  Quer√≠amos simplificar a√∫n m√°s nuestra vida y decidimos hacer que las estructuras generadas fueran m√°s interesantes (complejas). Se decidi√≥ agregar modificaciones de estructura con ramificaci√≥n o conexi√≥n a trav√©s de muchas capas. <br><br>  Bueno, decir "simplificado", esto significa complicarte la vida en otra cosa. <br>  Generar circuitos con el m√°ximo nivel de modificabilidad result√≥ ser una tarea laboriosa y poco pr√°ctica.  Por lo tanto, nuestro equipo decidi√≥ hacer lo que cumpl√≠a con estos criterios: <br>  El desarrollo de esta tarea no llev√≥ mucho tiempo. <br>  Generaci√≥n m√°s o menos adecuada de estructuras modificadas. <br>  No hubo intersecciones entre los conductores. <br>  Como resultado de una programaci√≥n larga y dif√≠cil, la soluci√≥n se escribi√≥ a las 4 pm. <br>  Echemos un vistazo al c√≥digo y Ã∂Ã∂Ã∂Ã∂Ã∂Ã∂Ã∂Ã∂Ã∂Ã∂. <br><br>  <i>Aqu√≠ se encuentra la clase OverflowArray.</i>  <i>Por razones hist√≥ricas, se agreg√≥ despu√©s de la generaci√≥n estructural b√°sica y tiene m√°s que ver con la generaci√≥n de variantes, por lo tanto, se encuentra a continuaci√≥n.</i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enlace</a></i> <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IEnumerable&lt;CircuitStructure&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateStructure</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> lines, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> maxElementsInLine, StructureModification modification</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> baseStructure = GenerateStructure(lines, maxElementsInLine); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; lines; i++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxValue = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> branchingSign = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (modification == StructureModification.All) { maxValue = <span class="hljs-number"><span class="hljs-number">2</span></span>; branchingSign = <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lengthOverflowArray = baseStructure.Gates[(i * <span class="hljs-number"><span class="hljs-number">2</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>].Length; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> elementArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OverflowArray(lengthOverflowArray, maxValue); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> numberOfOption = Math.Pow(<span class="hljs-number"><span class="hljs-number">2</span></span>, lengthOverflowArray); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k = <span class="hljs-number"><span class="hljs-number">1</span></span>; k &lt; numberOfOption - <span class="hljs-number"><span class="hljs-number">1</span></span>; k++) { elementArray.Increase(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (modification == StructureModification.Branching || modification == StructureModification.All) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!CheckOverflowArrayForAllConnection(elementArray, branchingSign, lengthOverflowArray)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } } <span class="hljs-comment"><span class="hljs-comment">// Clone CircuitStructure var structure = (CircuitStructure) baseStructure.Clone(); ConfigureInputs(lines, structure.Conductors, structure.Gates); var sources = AddSourcesLayer(structure.Conductors, maxElementsInLine); var finalElement = AddFinalElement(structure.Conductors); structure.Sources = sources; structure.FinalDevice = finalElement; int key = (i * 2) + 1; ModifyStructure(structure, elementArray, key, modification); ClearStructure(structure); yield return structure; } } }</span></span></code> </pre> <br>  Despu√©s de ver este c√≥digo, me gustar√≠a entender qu√© est√° sucediendo en √©l. <br>  No te preocupes!  Una breve explicaci√≥n sin detalles te apura. <br><br>  Lo primero que hacemos es crear una estructura ordinaria (base). <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> baseStructure = GenerateStructure(lines, maxElementsInLine);</code> </pre> <br>  Luego, como resultado de una simple verificaci√≥n, establecemos el signo de ramificaci√≥n (branchingSign) en el valor apropiado. ¬øPor qu√© es esto necesario?  Adem√°s ser√° claro. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxValue = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> branchingSign = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (modification == StructureModification.All) { maxValue = <span class="hljs-number"><span class="hljs-number">2</span></span>; branchingSign = <span class="hljs-number"><span class="hljs-number">2</span></span>; }</code> </pre> <br>  Ahora determinamos la longitud de nuestro OverflowArray e inicializamos. <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lengthOverflowArray = baseStructure.Gates[(i * <span class="hljs-number"><span class="hljs-number">2</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>].Length; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> elementArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OverflowArray(lengthOverflowArray, maxValue);</code> </pre> <br>  Para que podamos continuar nuestras manipulaciones con la estructura, necesitamos encontrar el n√∫mero de posibles variaciones de nuestro OverflowArray.  Para hacer esto, hay una f√≥rmula que se aplic√≥ en la siguiente l√≠nea. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lengthOverflowArray = baseStructure.Gates[(i * <span class="hljs-number"><span class="hljs-number">2</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>].Length;</code> </pre> <br>  El siguiente es un bucle anidado en el que se lleva a cabo toda la "magia" y para el cual hab√≠a todo este prefacio. Al principio, aumentamos los valores de nuestra matriz. <br><br><pre> <code class="cs hljs">elementArray.Increase();</code> </pre><br>  Despu√©s de eso, vemos una verificaci√≥n de validaci√≥n, como resultado de lo cual vamos m√°s all√° o la pr√≥xima iteraci√≥n. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (modification == StructureModification.Branching || modification == StructureModification.All) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!CheckOverflowArrayForAllConnection(elementArray, branchingSign, lengthOverflowArray)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } }</code> </pre><br>  Si la matriz pas√≥ la verificaci√≥n de validaci√≥n, entonces clonamos nuestra estructura base.  La clonaci√≥n es necesaria ya que modificaremos nuestra estructura para muchas m√°s iteraciones. <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Clone CircuitStructure var structure = (CircuitStructure) baseStructure.Clone(); ConfigureInputs(lines, structure.Conductors, structure.Gates); var sources = AddSourcesLayer(structure.Conductors, maxElementsInLine); var finalElement = AddFinalElement(structure.Conductors); structure.Sources = sources; structure.FinalDevice = finalElement;</span></span></code> </pre> <br>  Y finalmente, comenzamos a modificar la estructura y limpiarla de elementos innecesarios.  Se volvieron innecesarios como resultado de la modificaci√≥n estructural. <br><br><pre> <code class="cs hljs">ModifyStructure(structure, elementArray, key, modification); ClearStructure(structure);</code> </pre> <br>  No veo el punto con m√°s detalle para analizar docenas de peque√±as funciones que se realizan "en alg√∫n lugar" en las profundidades. <br><br><h4>  Generador de variantes </h4><br>  La estructura + elementos que deber√≠an estar en ella se llaman CircuitVariant. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> CircuitVariant { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CircuitStructure Structure; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[]&gt; Gates; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[]&gt; Conductors; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IList&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>[]&gt; Solutions; }</code> </pre> <br>  El primer campo es un enlace a la estructura.  Los segundos dos diccionarios en los que la clave es el n√∫mero de la capa, y el valor es una matriz que contiene el n√∫mero de elementos en sus lugares en la estructura. <br><br>  Procedemos a la selecci√≥n de combinaciones.  Podemos tener un cierto n√∫mero de elementos l√≥gicos y conductores v√°lidos.  En total, puede haber 6 elementos l√≥gicos y 2 conductores. <br>  Puede imaginar un sistema de n√∫meros con una base de 6 y obtener en cada categor√≠a los n√∫meros que corresponden a los elementos.  Por lo tanto, al aumentar este n√∫mero hexadecimal, puede pasar por todas las combinaciones de elementos. <br><br>  Es decir, un n√∫mero hexadecimal de tres d√≠gitos ser√° de 3 elementos.  Solo vale la pena considerar que el n√∫mero de elementos no 6 sino 4 puede transmitirse. <br><br>  Para descargar tal n√∫mero, determin√© la estructura <br><a name="ClampedInt"></a><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> ClampedInt { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Value { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = Mathf.Clamp(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, MaxValue); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> MaxValue; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClampedInt</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> maxValue</span></span></span><span class="hljs-function">)</span></span> { MaxValue = maxValue; <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TryIncrease</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Value + <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;= MaxValue) { Value++; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// overflow return true; } }</span></span></code> </pre> <br><a name="OverflowArray"></a><br>  La siguiente es una clase con el extra√±o nombre <b>OverflowArray</b> .  Su esencia es que almacena la matriz <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ClampedInt</a></b> y aumenta el orden superior en caso de que <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ocurra</a></b> un desbordamiento <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en el</a></b> orden <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">bajo</a></b> y as√≠ sucesivamente hasta que alcance el valor m√°ximo en todas las celdas. <br><br>  De acuerdo con cada ClampedInt, se establecen los valores del ElectricalElementContainer correspondiente.  Por lo tanto, es posible ordenar todas las combinaciones posibles.  Vale la pena se√±alar que si desea generar un esquema con elementos (por ejemplo, And (0) y Xor (4)), no necesita ordenar todas las opciones, incluidos los elementos 1,2,3.  Para esto, durante la generaci√≥n, los elementos obtienen sus n√∫meros locales (por ejemplo, And = 0, Xor = 1), y luego se vuelven a convertir en n√∫meros globales. <br><br>  Por lo tanto, puede iterar sobre todas las combinaciones posibles en todos los elementos. <br><br>  Despu√©s de establecer los valores en los contenedores, el circuito se verifica para encontrar soluciones con <b>Solver</b> .  Si el circuito pasa la decisi√≥n, vuelve. <br><br>  Despu√©s de que se genera el circuito, se verifica el n√∫mero de soluciones.  No debe exceder el l√≠mite y no debe tener decisiones que consisten enteramente en 0 o 1. <br><br><div class="spoiler">  <b class="spoiler_title">Mucho c√≥digo</b> <div class="spoiler_text"><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IVariantsGenerator</span></span> { <span class="hljs-function"><span class="hljs-function">IEnumerable&lt;CircuitVariant&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Generate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IEnumerable&lt;CircuitStructure&gt; structures, ICollection&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; availableGates, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> useNot, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> maxSolutions = </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">.MaxValue</span></span></span><span class="hljs-function">)</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">VariantsGenerator</span></span> : <span class="hljs-title"><span class="hljs-title">IVariantsGenerator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ISolver solver; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IElementsProvider elementsProvider; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VariantsGenerator</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ISolver solver, IElementsProvider elementsProvider</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.solver = solver; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elementsProvider = elementsProvider; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IEnumerable&lt;CircuitVariant&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Generate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IEnumerable&lt;CircuitStructure&gt; structures, ICollection&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; availableGates, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> useNot, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> maxSolutions = </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">.MaxValue</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> manyGates = availableGates.Count &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> availableLeToGeneralNumber = GetDictionaryFromAllowedElements(elementsProvider.Gates, availableGates); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gatesList = GetElementsList(availableLeToGeneralNumber, elementsProvider.Gates); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> availableConductorToGeneralNumber = useNot ? GetDictionaryFromAllowedElements(elementsProvider.Conductors, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}) : GetDictionaryFromAllowedElements(elementsProvider.Conductors, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] {<span class="hljs-number"><span class="hljs-number">0</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> conductorsList = GetElementsList(availableConductorToGeneralNumber, elementsProvider.Conductors); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> structure <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> structures) { InitializeCircuitStructure(structure, gatesList, conductorsList); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gates = GetListFromLayersDictionary(structure.Gates); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> conductors = GetListFromLayersDictionary(structure.Conductors); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gatesArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OverflowArray(gates.Count, availableGates.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> conductorsArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OverflowArray(conductors.Count, useNot ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useNot &amp;&amp; conductorsArray.EqualInts) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } SetContainerValuesAccordingToArray(conductors, conductorsArray); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (manyGates &amp;&amp; gatesArray.Length &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; gatesArray.EqualInts) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } SetContainerValuesAccordingToArray(gates, gatesArray); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> solutions = solver.GetSolutions(structure.FinalDevice, structure.Sources); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (solutions.Any() &amp;&amp; solutions.Count &lt;= maxSolutions &amp;&amp; !(solutions.Any(s =&gt; s.All(b =&gt; b)) || solutions.Any(s =&gt; s.All(b =&gt; !b)))) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> variant = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CircuitVariant { Conductors = GetElementsNumberFromLayers(structure.Conductors, availableConductorToGeneralNumber), Gates = GetElementsNumberFromLayers(structure.Gates, availableLeToGeneralNumber), Solutions = solutions, Structure = structure }; <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> variant; } } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!gatesArray.Increase()); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (useNot &amp;&amp; !conductorsArray.Increase()); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitializeCircuitStructure</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">CircuitStructure structure, IList&lt;Func&lt;IElectricalElement&gt;&gt; gates, IList&lt;Func&lt;IElectricalElement&gt;&gt; conductors</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lElements = GetListFromLayersDictionary(structure.Gates); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> lElements) { item.SetElements(gates); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cElements = GetListFromLayersDictionary(structure.Conductors); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> cElements) { item.SetElements(conductors); } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> IList&lt;Func&lt;IElectricalElement&gt;&gt; GetElementsList(IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; availableToGeneralGate, IReadOnlyList&lt;Func&lt;IElectricalElement&gt;&gt; elements) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> list = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Func&lt;IElectricalElement&gt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> availableToGeneralGate) { list.Add(elements[item.Value]); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> list; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IDictionary&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">, </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetDictionaryFromAllowedElements</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IReadOnlyCollection&lt;Func&lt;IElectricalElement&gt;&gt; allElements, IEnumerable&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; availableElements</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> enabledDic = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;(allElements.Count); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; allElements.Count; i++) { enabledDic.Add(i, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> availableElements) { enabledDic[item] = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> availableToGeneralNumber = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enabledDic) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item.Value) { availableToGeneralNumber.Add(index, item.Key); index++; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> availableToGeneralNumber; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetContainerValuesAccordingToArray</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IReadOnlyList&lt;ElectricalElementContainer&gt; containers, IOverflowArray overflowArray</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; containers.Count; i++) { containers[i].SetType(overflowArray[i].Value); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IReadOnlyList&lt;ElectricalElementContainer&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetListFromLayersDictionary</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IDictionary&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, ElectricalElementContainer[]&gt; layers</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> elements = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;ElectricalElementContainer&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> layer <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> layers) { elements.AddRange(layer.Value); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> elements; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[]&gt; GetElementsNumberFromLayers(IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, ElectricalElementContainer[]&gt; layers, IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; elementIdToGlobal = <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dic = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[]&gt;(layers.Count); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> convert = elementIdToGlobal != <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> layer <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> layers) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> values = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[layer.Value.Length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; layer.Value.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!convert) { values[i] = layer.Value[i].SelectedType; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { values[i] = elementIdToGlobal[layer.Value[i].SelectedType]; } } dic.Add(layer.Key, values); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dic; } }</code> </pre> <br></div></div><br>  Cada uno de los generadores devuelve una variante utilizando la declaraci√≥n de rendimiento.  Por lo tanto, CircuitGenerator usando StructureGenerator y VariantsGenerator genera IEnumerable. (El enfoque con rendimiento ayud√≥ mucho en el futuro, ver m√°s abajo) <br><br>  Siguiendo del hecho de que el generador de opciones recibe la lista de estructuras.  Puede generar opciones para cada estructura de forma independiente.  Esto podr√≠a ser paralelo, pero agregar AsParallel no funcion√≥ (probablemente el rendimiento interfiere).  Paralelizar manualmente ser√° mucho tiempo, porque descartamos esta opci√≥n.  <i>De hecho, intent√© hacer una generaci√≥n paralela, funcion√≥, pero hubo algunas dificultades, porque no fue al repositorio.</i> <br><br><a name="GameClasses"></a><h3>  Clases de juego </h3><br><a name="Approach"></a><h4>  Enfoque de desarrollo y DI </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Contenido</a> <br><br>  El proyecto se construye bajo <b>inyecci√≥n de dependencia</b> (DI).  Esto significa que las clases simplemente pueden requerir alg√∫n tipo de objeto correspondiente a la interfaz y no participar en la creaci√≥n de este objeto.  ¬øCu√°les son los beneficios? <br><br><ul><li>  El lugar de creaci√≥n e inicializaci√≥n del objeto de dependencia se define en un lugar y se separa de la l√≥gica de las clases dependientes, lo que elimina la duplicaci√≥n de c√≥digo. </li><li>  Elimina la necesidad de desenterrar todo el √°rbol de dependencias e instanciar todas las dependencias. </li><li>  Le permite cambiar f√°cilmente la implementaci√≥n de la interfaz, que se utiliza en muchos lugares. </li></ul><br>  Como contenedor DI en el proyecto, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://github.com/modesttree/Zenject">se</a> utiliza <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://github.com/modesttree/Zenject">Zenject</a> . <br><br>  Zenject tiene varios contextos, solo uso dos de ellos: <br><br><ul><li>  Contexto del proyecto: registro de dependencias dentro de toda la aplicaci√≥n. </li><li>  Contexto de la escena: el registro de clases que existen solo en una escena particular y su vida est√° limitada por el tiempo de vida de la escena. </li><li>  Un contexto est√°tico es un contexto general para todo en general, la peculiaridad es que existe en el editor.  Yo uso para inyecci√≥n en el editor </li></ul><br>  El registro de la clase se almacena en el <b>instalador</b> .  Uso <b>ScriptableObjectInstaller</b> para el contexto del proyecto y <b>MonoInstaller</b> para el contexto de la escena. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La mayor√≠a de las clases con las que me registro en AsSingle, ya que no contienen estado, son m√°s probablemente contenedores de m√©todos. Uso AsTransient para clases donde hay un estado interno que no deber√≠a ser com√∫n a otras clases. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despu√©s de eso, debe crear de alguna manera las clases MonoBehaviour que representar√°n estos elementos. Tambi√©n asign√© clases relacionadas con Unity a un proyecto separado dependiendo del proyecto Core. </font></font><br><br><img src="https://habrastorage.org/webt/eg/s1/se/egs1seui5csmxylqk9we7qhedwc.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para las clases MonoBehaviour, prefiero crear mis propias interfaces. Esto, adem√°s de las ventajas est√°ndar de las interfaces, le permite ocultar una gran cantidad de miembros de MonoBehaviour.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por conveniencia, DI a menudo crea una clase simple que ejecuta toda la l√≥gica y el envoltorio MonoBehaviour para ello. </font><font style="vertical-align: inherit;">Por ejemplo, la clase tiene m√©todos de Inicio y Actualizaci√≥n, creo tales m√©todos en la clase, luego en la clase MonoBehaviour agrego un campo de dependencia y en los m√©todos correspondientes llamo Inicio y Actualizaci√≥n. </font><font style="vertical-align: inherit;">Esto le da la inyecci√≥n "correcta" al constructor, el desprendimiento de la clase principal del contenedor DI y la capacidad de probar f√°cilmente.</font></font><br><br><a name="Config"></a><h4>  Configuracion </h4><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Por configuraci√≥n, me refiero a los datos comunes a toda la aplicaci√≥n. </font><font style="vertical-align: inherit;">En mi caso, estos son prefabricados, identificadores para publicidad y compras, etiquetas, nombres de escenas, etc. </font><font style="vertical-align: inherit;">Para estos fines, uso ScriptableObjects:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para cada grupo de datos, se asigna una clase descendiente ScriptableObject. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Crea los campos serializables necesarios. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Se agregan las propiedades de lectura de estos campos. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La interfaz con los campos anteriores est√° resaltada </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Una clase se registra en una interfaz en un contenedor DI </font></font></li><li>  Ganancia </li></ol><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ITags</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FixedColor { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> BackgroundColor { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ForegroundColor { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> AccentedColor { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } } [CreateAssetMenu(fileName = <span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(Tags), menuName = <span class="hljs-string"><span class="hljs-string">"Configuration/"</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(Tags))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Tags</span></span> : <span class="hljs-title"><span class="hljs-title">ScriptableObject</span></span>, <span class="hljs-title"><span class="hljs-title">ITags</span></span> { [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> fixedColor; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> backgroundColor; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> foregroundColor; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> accentedColor; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FixedColor =&gt; fixedColor; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> BackgroundColor =&gt; backgroundColor; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ForegroundColor =&gt; foregroundColor; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> AccentedColor =&gt; accentedColor; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { fixedColor.AssertNotEmpty(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(fixedColor)); backgroundColor.AssertNotEmpty(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(backgroundColor)); foregroundColor.AssertNotEmpty(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(foregroundColor)); accentedColor.AssertNotEmpty(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(accentedColor)); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para la configuraci√≥n, un instalador separado (c√≥digo abreviado): </font></font><br><br><pre> <code class="cs hljs">CreateAssetMenu(fileName = <span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(ConfigurationInstaller), menuName = <span class="hljs-string"><span class="hljs-string">"Installers/"</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(ConfigurationInstaller))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ConfigurationInstaller</span></span> : <span class="hljs-title"><span class="hljs-title">ScriptableObjectInstaller</span></span>&lt;<span class="hljs-title"><span class="hljs-title">ConfigurationInstaller</span></span>&gt; { [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> EditorElementsPrefabs editorElementsPrefabs; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> LevelCompletionSteps levelCompletionSteps; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CommonValues commonValues; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AdsConfiguration adsConfiguration; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CutscenesConfiguration cutscenesConfiguration; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Colors colors; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Tags tags; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InstallBindings</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Container.Bind&lt;IEditorElementsPrefabs&gt;().FromInstance(editorElementsPrefabs).AsSingle(); Container.Bind&lt;ILevelCompletionSteps&gt;().FromInstance(levelCompletionSteps).AsSingle(); Container.Bind&lt;ICommonValues&gt;().FromInstance(commonValues).AsSingle(); Container.Bind&lt;IAdsConfiguration&gt;().FromInstance(adsConfiguration).AsSingle(); Container.Bind&lt;ICutscenesConfiguration&gt;().FromInstance(cutscenesConfiguration).AsSingle(); Container.Bind&lt;IColors&gt;().FromInstance(colors).AsSingle(); Container.Bind&lt;ITags&gt;().FromInstance(tags).AsSingle(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { editorElementsPrefabs.AssertNotNull(); levelCompletionSteps.AssertNotNull(); commonValues.AssertNotNull(); adsConfiguration.AssertNotNull(); cutscenesConfiguration.AssertNotNull(); colors.AssertNOTNull(); tags.AssertNotNull(); } }</code> </pre> <br><a name="GameElectricalElements"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Elementos electricos </font></font></h4><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ahora necesitas imaginar de alguna manera los elementos el√©ctricos</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IElectricalElementMb</span></span> { GameObject GameObject { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } IElectricalElement Element { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } IOutputConnectorMb[] OutputConnectorsMb { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } IInputConnectorMb[] InputConnectorsMb { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } Transform Transform { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetInputConnectorsMb</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">InputConnectorMb[] inputConnectorsMb</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetOutputConnectorsMb</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">OutputConnectorMb[] outputConnectorsMb</span></span></span><span class="hljs-function">)</span></span>; } [DisallowMultipleComponent] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ElectricalElementMb</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span>, <span class="hljs-title"><span class="hljs-title">IElectricalElementMb</span></span> { [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> OutputConnectorMb[] outputConnectorsMb; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> InputConnectorMb[] inputConnectorsMb; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform Transform =&gt; transform; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> GameObject GameObject =&gt; gameObject; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> =&gt; name; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> =&gt; name = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> IElectricalElement Element { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IOutputConnectorMb[] OutputConnectorsMb =&gt; outputConnectorsMb; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IInputConnectorMb[] InputConnectorsMb =&gt; inputConnectorsMb; }</code> </pre> <br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Provide additional data to be able to configure it after manual install. </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> public interface IElectricalElementMbEditor : IElectricalElementMb { ElectricalElementType Type { get; } } public class ElectricalElementMbEditor : ElectricalElementMb, IElectricalElementMbEditor { [SerializeField] private ElectricalElementType type; public ElectricalElementType Type =&gt; type; }</span></span></code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IInputConnectorMb</span></span> : <span class="hljs-title"><span class="hljs-title">IConnectorMb</span></span> { IOutputConnectorMb OutputConnectorMb { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } IInputConnector InputConnector { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } }</code> </pre> <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">InputConnectorMb</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span>, <span class="hljs-title"><span class="hljs-title">IInputConnectorMb</span></span> { [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> OutputConnectorMb outputConnectorMb; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform Transform =&gt; transform; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IOutputConnectorMb OutputConnectorMb { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> =&gt; outputConnectorMb; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> =&gt; outputConnectorMb = (OutputConnectorMb) <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IInputConnector InputConnector { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputConnector(); <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> UNITY_EDITOR private void OnDrawGizmos() { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (outputConnectorMb != null) { Handles.DrawLine(transform.position, outputConnectorMb.Transform.position); } } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tenemos la l√≠nea public IElectricalElement Element {get; </font><font style="vertical-align: inherit;">conjunto</font></font> } <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øSolo aqu√≠ est√° c√≥mo instalar este art√≠culo? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una buena opci√≥n ser√≠a hacer gen√©ricos: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">public class ElectricalElementMb: MonoBehaviour, IElectricalElementMb donde T: IElectricalElement </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pero el problema es que Unity no admite gen√©ricos en las clases MonoBehavior. </font><font style="vertical-align: inherit;">Adem√°s, Unity no admite la serializaci√≥n de propiedades e interfaces. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin embargo, en tiempo de ejecuci√≥n es bastante posible pasar IElectricalElement Element {get; </font><font style="vertical-align: inherit;">conjunto</font></font> } <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor deseado </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hice enum ElectricalElementType en el que habr√° todos los tipos necesarios. </font><font style="vertical-align: inherit;">Enum est√° bien serializado por Unity y se muestra muy bien en el Inspector como una lista desplegable. </font><font style="vertical-align: inherit;">Se definieron dos tipos de elementos: los que se crean en tiempo de ejecuci√≥n y los que se crean en el editor y se pueden guardar. </font><font style="vertical-align: inherit;">Por lo tanto, hay IElectricalElementMb e IElectricalElementMbEditor, que adem√°s contiene un campo de tipo ElectricalElementType. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El segundo tipo tambi√©n debe inicializarse en tiempo de ejecuci√≥n. </font><font style="vertical-align: inherit;">Para hacer esto, hay una clase que al principio omitir√° todos los elementos y los inicializar√° seg√∫n el tipo en el campo enum. </font><font style="vertical-align: inherit;">Como sigue:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Dictionary&lt;ElectricalElementType, Func&lt;IElectricalElement&gt;&gt; ElementByType = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;ElectricalElementType, Func&lt;IElectricalElement&gt;&gt; { {ElectricalElementType.And, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> And()}, {ElectricalElementType.Or, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Or()}, {ElectricalElementType.Xor, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Xor()}, {ElectricalElementType.Nand, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Nand()}, {ElectricalElementType.Nor, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Nor()}, {ElectricalElementType.NOT, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NOT()}, {ElectricalElementType.Xnor, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Xnor()}, {ElectricalElementType.Source, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Source()}, {ElectricalElementType.Conductor, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Conductor()}, {ElectricalElementType.Placeholder, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AlwaysFalse()}, {ElectricalElementType.Encoder, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Encoder()}, {ElectricalElementType.Decoder, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Decoder()} };</code> </pre> <br><a name="GameManagement"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gesti√≥n del juego </font></font></h4><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A continuaci√≥n, surge la pregunta, ¬ød√≥nde colocar la l√≥gica del juego en s√≠ (verificar las condiciones del pasaje, contar las lecturas del pasaje y ayudar al jugador)? Tambi√©n hay preguntas sobre la ubicaci√≥n de la l√≥gica para guardar y cargar el progreso, la configuraci√≥n y otras cosas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para esto, distingo ciertas clases de gerentes que son responsables de una determinada clase de tareas. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DataManager</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es responsable de almacenar datos de los resultados de pasar la configuraci√≥n del usuario y del juego. Est√° registrado por AsSingle en el contexto del proyecto. Esto significa que √©l es uno para toda la aplicaci√≥n. Mientras se ejecuta la aplicaci√≥n, los datos se almacenan directamente en la memoria, dentro del DataManager. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utiliza el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IFileStoreService</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que es responsable de cargar y guardar datos e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IFileSerializer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">responsable de serializar archivos en un formato listo para guardar. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LevelGameManager</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es un administrador de juegos en una sola escena. </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obtuve un poco de GodObject, porque todav√≠a es responsable de la interfaz de usuario, es decir, abrir y cerrar el men√∫, reacci√≥n a los botones. Pero es aceptable, dado el tama√±o del proyecto y la falta de la necesidad de expandirlo, por lo que una secuencia de acciones a√∫n m√°s f√°cil y m√°s visible.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hay dos opciones Esto es </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lo que</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se llama </font><b><font style="vertical-align: inherit;">LevelGameManager1</font></b><font style="vertical-align: inherit;"> y </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LevelGameManager2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para los modos 1 y 2, respectivamente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En el primer caso, la l√≥gica se basa en la reacci√≥n al evento de un cambio en el valor en una de las Fuentes y en la verificaci√≥n del valor en la salida del circuito.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En el segundo caso, la l√≥gica responde a un evento de cambio de elemento y tambi√©n verifica los valores en la salida del circuito. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existe informaci√≥n de nivel actual, como el n√∫mero de nivel y la asistencia al jugador. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los datos sobre el nivel actual se almacenan en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CurrentLevelData</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . All√≠ se almacena un n√∫mero de nivel: una propiedad booleana con un cheque de ayuda, una bandera de oferta para evaluar el juego y datos para ayudar al jugador.</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ICurrentLevelData</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LevelNumber { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> HelpExist { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ProposeRate { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ICurrentLevelDataMode1</span></span> : <span class="hljs-title"><span class="hljs-title">ICurrentLevelData</span></span> { IEnumerable&lt;SourcePositionValueHelp&gt; PartialHelp { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ICurrentLevelDataMode2</span></span> : <span class="hljs-title"><span class="hljs-title">ICurrentLevelData</span></span> { IEnumerable&lt;PlaceTypeHelp&gt; PartialHelp { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La ayuda para el primer modo son los n√∫meros de origen y los valores en ellos. En el segundo modo, este es el tipo de elemento que debe establecerse en la celda. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La colecci√≥n contiene estructuras que almacenan la posici√≥n y el valor que deben establecerse en la posici√≥n especificada. Un diccionario ser√≠a m√°s bonito, pero Unity no puede serializar diccionarios. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las diferencias entre las escenas de diferentes modos son que en el contexto de la escena, se establecen otro </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LevelGameManager</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y otro </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ICurrentLevelData</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En general, tengo un enfoque basado en eventos para la comunicaci√≥n de elementos. </font><font style="vertical-align: inherit;">Por un lado, es l√≥gico y conveniente. </font><font style="vertical-align: inherit;">Por otro lado, existe la oportunidad de obtener problemas sin darse de baja cuando sea necesario. </font><font style="vertical-align: inherit;">Sin embargo, no hubo problemas en este proyecto, y la escala no es demasiado grande. </font><font style="vertical-align: inherit;">Por lo general, se produce una suscripci√≥n durante el inicio de la escena para todo lo que necesita. </font><font style="vertical-align: inherit;">Casi nada se crea en tiempo de ejecuci√≥n, por lo que no hay confusi√≥n.</font></font><br><br><a name="LevelsLoading"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Carga de nivel </font></font></h4><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cada nivel en el juego est√° representado por una escena de Unity, debe contener un prefijo de nivel y un n√∫mero, por ejemplo, "Nivel23". </font><font style="vertical-align: inherit;">El prefijo est√° incluido en la configuraci√≥n. </font><font style="vertical-align: inherit;">La carga del nivel se produce por nombre, que se forma a partir del prefijo. </font><font style="vertical-align: inherit;">Por lo tanto, la clase </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LevelsManager</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> puede cargar niveles por n√∫mero.</font></font><br><br><a name="Cutscenes"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Escenas de corte </font></font></h4><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los contenidos de la</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escena son escenas de unidad ordinarias con n√∫meros en el t√≠tulo, similares a los niveles. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La animaci√≥n en s√≠ se implementa utilizando la l√≠nea de tiempo. </font><font style="vertical-align: inherit;">Desafortunadamente, no tengo habilidades de animaci√≥n ni la capacidad de trabajar con Timeline, as√≠ que "no le dispares al pianista, √©l juega como puede". </font></font><br><br><img src="https://habrastorage.org/webt/h8/ny/rf/h8nyrfwesvjp8v6kmy70tcfiduc.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La verdad result√≥ que una escena l√≥gica deber√≠a consistir en diferentes escenas con diferentes objetos. </font><font style="vertical-align: inherit;">Result√≥ que esto se not√≥ un poco tarde, pero se decidi√≥ simplemente: colocando partes de las escenas en el escenario en diferentes lugares y moviendo la c√°mara al instante.</font></font><br><br><img src="https://habrastorage.org/webt/s1/jq/jc/s1jqjces_osngyiexu03i3inrlk.png"><br><br><a name="AdditionalGameplay"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Jugabilidad adicional </font></font></h4><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> El juego se eval√∫a por el n√∫mero de acciones por nivel y el uso de pistas. Cuanta menos acci√≥n, mejor. El uso de la informaci√≥n sobre herramientas reduce la calificaci√≥n m√°xima a 2 estrellas, saltando el nivel a 1 estrella. Para evaluar el pasaje, se almacena el n√∫mero de pasos para pasar. Se compone de dos valores: el valor m√≠nimo (para 3 estrellas) y el m√°ximo (1 estrella). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El n√∫mero de pasos para pasar niveles no se almacena en el archivo de escena en s√≠, sino en el archivo de configuraci√≥n, ya que debe mostrar el n√∫mero de estrellas para el nivel pasado. Esto complic√≥ ligeramente el proceso de creaci√≥n de niveles. Fue especialmente interesante ver cambios en el sistema de control de versiones:</font></font><br><br><img src="https://habrastorage.org/webt/fl/uc/4q/fluc4q2iu7946a11fywzat8afck.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intenta adivinar a qu√© nivel pertenece. Era posible almacenar el diccionario, por supuesto, pero en primer lugar, Unity no lo serializar√≠a, en segundo lugar, tendr√≠a que establecer manualmente los n√∫meros. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si es dif√≠cil para el jugador completar el nivel, puede obtener una pista: los valores correctos en algunas entradas o el elemento correcto en el segundo modo. Esto tambi√©n se hizo manualmente, aunque podr√≠a automatizarse. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la ayuda del jugador no ayud√≥, puede omitir completamente el nivel. En caso de perder un nivel, el jugador obtiene 1 estrella por √©l. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un usuario que ha pasado un nivel con una pista no puede volver a ejecutarlo por un tiempo, por lo que ser√≠a dif√≠cil volver a ejecutar el nivel con memoria nueva, como si no tuviera una pista.</font></font><br><br><a name="Monetization"></a><h4>  Monetizaci√≥n </h4><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hay dos tipos de monetizaci√≥n en el juego: mostrar anuncios y deshabilitar anuncios por dinero. Una visualizaci√≥n de anuncios incluye la visualizaci√≥n de anuncios entre niveles y la visualizaci√≥n de anuncios premiados para omitir un nivel. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si el jugador est√° dispuesto a pagar por desactivar la publicidad, puede hacerlo. En este caso, no se mostrar√°n anuncios entre niveles y al omitir un nivel. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para la publicidad, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se cre√≥</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> una clase llamada </font><b><font style="vertical-align: inherit;">AdsService</font></b><font style="vertical-align: inherit;"> , con una interfaz</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IAdsService</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> AdsDisabled { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadBetweenLevelAd</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShowBetweenLevelAd</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> force = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadHelpAd</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action onLoaded = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShowHelpAd</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action onRewarded, Action onClosed</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> HelpAdLoaded { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqu√≠ HelpAd es un anuncio recompensado por saltar un nivel. Inicialmente, llamamos a ayuda parcial y total. Parcial es una pista, y completo es un nivel de omisi√≥n. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta clase contiene dentro de la limitaci√≥n de la frecuencia de mostrar anuncios por tiempo, despu√©s del primer lanzamiento del juego. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La implementaci√≥n utiliza </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Mobile Ads Unity Plugin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Con publicidad recompensada, pis√© un rastrillo; resulta que los delegados leales pueden ser llamados en otro hilo, no est√° muy claro por qu√©. Por lo tanto, es mejor que esos delegados no llamen a nada en el c√≥digo relacionado con Unity. Si se realiz√≥ una compra para deshabilitar la publicidad, el anuncio no se mostrar√° y el delegado ejecutar√° inmediatamente la exhibici√≥n exitosa del anuncio. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hay una interfaz para comprar</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IPurchaseService</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsAdsDisablePurchased { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action DisableAdsPurchased; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BuyDisableAds</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveDisableAd</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity IAP se</font></font></a> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utiliza en la implementaci√≥n </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Hay un truco para comprar desconexiones de anuncios. </font><font style="vertical-align: inherit;">Google Play no parece proporcionar informaci√≥n de que el jugador compr√≥ una compra. </font><font style="vertical-align: inherit;">Solo llegar√° la confirmaci√≥n de que ella pas√≥ una vez. </font><font style="vertical-align: inherit;">Pero si coloca el estado del producto despu√©s de la compra, no </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Completo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sino </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pendiente,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> esto le permitir√° verificar la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propiedad del</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> producto </font><b><font style="vertical-align: inherit;">hasReceipt</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Si es cierto, la compra se ha completado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aunque, por supuesto, confunde este enfoque, sospecho que puede que no todo sea sencillo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El m√©todo RemoveDisableAd es necesario en el momento de la prueba, elimina la interrupci√≥n de la publicidad comprada.</font></font><br><br><a name="UI"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Interfaz de usuario </font></font></h4><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Todos los elementos de la interfaz funcionan de acuerdo con un enfoque orientado a eventos. </font><font style="vertical-align: inherit;">Los elementos de interfaz en s√≠ mismos generalmente no contienen l√≥gica m√°s que eventos llamados por m√©todos p√∫blicos que Unity puede usar. </font><font style="vertical-align: inherit;">Aunque tambi√©n sucede que realiza algunas tareas relacionadas solo con la interfaz.</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">UiElementBase</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span>, <span class="hljs-title"><span class="hljs-title">IUiElement</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action ShowClick; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action HideCLick; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Show</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { gameObject.SetActive(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); ShowClick?.Invoke(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hide</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { gameObject.SetActive(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); HideCLick?.Invoke(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PauseMenu</span></span> : <span class="hljs-title"><span class="hljs-title">UiElementEscapeClose</span></span>, <span class="hljs-title"><span class="hljs-title">IPauseMenu</span></span> { [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Text levelNumberText; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> LocalizedText finishedText; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> GameObject restartButton; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> levelNumber; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action GoToMainMenuClick; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action RestartClick; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LevelNumber { <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> =&gt; levelNumberText.text = <span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{finishedText.Value}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-string"><span class="hljs-subst">}</span></span></span><span class="hljs-string">"</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DisableRestartButton</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { restartButton.SetActive(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GoToMainMenu</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { GoToMainMenuClick?.Invoke(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Restart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { RestartClick?.Invoke(); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De hecho, este no es siempre el caso. </font><font style="vertical-align: inherit;">Es bueno dejar estos elementos como Vista activa, hacer que un evento escuche de ella, algo as√≠ como un controlador que activar√° las acciones necesarias en los administradores.</font></font><br><br><a name="Analytics"></a><h4>  Anal√≠tica </h4><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> En el camino de menor resistencia, se eligi√≥ el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">an√°lisis de Unity</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . F√°cil de implementar, aunque limitado para una suscripci√≥n gratuita, es imposible exportar los datos de origen. Tambi√©n hay un l√≠mite en el n√∫mero de eventos: 100 / hora por jugador. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para an√°lisis, cre√≥ la clase de contenedor </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AnalyticsService</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Tiene m√©todos para cada tipo de evento, recibe los par√°metros necesarios y hace que el evento se env√≠e utilizando las herramientas integradas en Unity. Crear un m√©todo para cada evento ciertamente no es la mejor pr√°ctica en su conjunto, pero en un proyecto a sabiendas peque√±o es mejor que hacer algo grande y complicado. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todos los eventos utilizados son </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CustomEvent.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Se crean a partir del nombre del evento y el nombre y el valor del par√°metro del diccionario. </font><font style="vertical-align: inherit;">AnalyticsService obtiene los valores requeridos de los par√°metros y crea un diccionario dentro. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todos los nombres y par√°metros de eventos se colocan en constantes. </font><font style="vertical-align: inherit;">No en la forma de un enfoque tradicional con ScriptableObject, ya que estos valores nunca deber√≠an cambiar. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo de m√©todo:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LevelComplete</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> stars, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> actionCount, TimeSpan timeSpent, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> levelMode</span></span></span><span class="hljs-function">)</span></span> { CustomEvent(LevelCompleteEventName, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; { {LevelNumber, number}, {LevelStars, stars}, {LevelActionCount, actionCount}, {LevelTimeSpent, timeSpent}, {LevelMode, levelMode} }); }</code> </pre> <br><a name="CameraAlign"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Posicionamiento de c√°mara y diagramas </font></font></h4><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido La</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tarea es colocar FinalDevice en la parte superior de la pantalla, a la misma distancia del borde superior y las Fuentes desde la parte inferior tambi√©n siempre a la misma distancia del borde inferior. </font><font style="vertical-align: inherit;">Adem√°s, las pantallas vienen en diferentes relaciones de aspecto, debe ajustar el tama√±o de la c√°mara antes de comenzar el nivel para que se ajuste correctamente al circuito. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para hacer esto, se </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crea la</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> clase </font><b><font style="vertical-align: inherit;">CameraAlign</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Algoritmo de tama√±o:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Encuentra todos los elementos necesarios en el escenario </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Encuentre el ancho y la altura m√≠nimos en funci√≥n de la relaci√≥n de aspecto </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Determinar el tama√±o de la c√°mara </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Coloca la c√°mara en el centro </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mueva FinalDevice a la parte superior de la pantalla </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mover fuentes a la parte inferior de la pantalla </font></font></li></ol><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CameraAlign</span></span> : <span class="hljs-title"><span class="hljs-title">ICameraAlign</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ISceneObjectsHelper sceneObjectsHelper; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ICommonValues commonValues; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CameraAlign</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ISceneObjectsHelper sceneObjectsHelper, ICommonValues commonValues</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.sceneObjectsHelper = sceneObjectsHelper; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.commonValues = commonValues; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Align</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Camera camera</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> elements = sceneObjectsHelper.FindObjectsOfType&lt;IElectricalElementMb&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> finalDevice = sceneObjectsHelper.FindObjectOfType&lt;IFinalDevice&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sources = elements.OfType&lt;ISourceMb&gt;().ToArray(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (finalDevice != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; sources.Length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> leftPos = elements.Min(s =&gt; s.Transform.position.x); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> rightPos = elements.Max(s =&gt; s.Transform.position.x); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> width = Mathf.Abs(leftPos - rightPos); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fPos = finalDevice.Transform.position; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> height = Mathf.Abs(sources.First().Transform.position.y - fPos.y) * camera.aspect; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> size = Mathf.Max(width * commonValues.CameraOffset, height * commonValues.CameraOffset); camera.orthographicSize = Mathf.Clamp(size, commonValues.MinCameraSize, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>.MaxValue); camera.transform.position = GetCenterPoint(elements, <span class="hljs-number"><span class="hljs-number">-1</span></span>); fPos = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(fPos.x, camera.ScreenToWorldPoint(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(Screen.width, Screen.height)).y - commonValues.FinalDeviceTopOffset * camera.orthographicSize); finalDevice.Transform.position = fPos; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sourceY = camera.ScreenToWorldPoint(Vector2.zero).y + commonValues.SourcesBottomOffset; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sources) { item.Transform.position = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(item.Transform.position.x, sourceY); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Debug.Log(<span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">nameof</span></span></span></span><span class="hljs-string"><span class="hljs-subst">(CameraAlign)}</span></span></span><span class="hljs-string">: No final device or no sources in scene"</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCenterPoint</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ICollection&lt;IElectricalElementMb&gt; elements, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> top = elements.Max(e =&gt; e.Transform.position.y); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> bottom = elements.Min(e =&gt; e.Transform.position.y); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> left = elements.Min(e =&gt; e.Transform.position.x); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> right = elements.Max(e =&gt; e.Transform.position.x); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x = left + ((right - left) / <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> y = bottom + ((top - bottom) / <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(x, y, z); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Este m√©todo se llama cuando la escena comienza en la clase contenedora. </font></font><br><br><a name="Colors"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Esquemas de color </font></font></h4><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dado que el juego tendr√° una interfaz muy primitiva, decid√≠ hacerlo con dos esquemas de color, blanco y negro. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para hacer esto, cre√≥ una interfaz</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IColors</span></span> { Color ColorAccent { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } Color Background { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } Color Foreground { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action ColorsChanged; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los colores se pueden configurar directamente en el editor de Unity; esto se puede utilizar para probar. Luego se pueden cambiar y tener dos juegos de colores. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los colores de fondo y primer plano pueden cambiar, un acento de color en cualquier modo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como el reproductor puede establecer un tema no est√°ndar, los datos de color deben almacenarse en el archivo de configuraci√≥n. Si el archivo de configuraci√≥n no conten√≠a datos de color, entonces se rellenan con valores est√°ndar. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Luego hay varias clases: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CameraColorAdjustment</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : responsable de establecer el color de fondo de la c√°mara, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UiColorAdjustment</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : establecer los colores de los elementos de la interfaz y </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TextMeshColorAdjustment</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- establece el color de los n√∫meros en las fuentes. </font><font style="vertical-align: inherit;">UiColorAdjustment tambi√©n usa etiquetas. </font><font style="vertical-align: inherit;">En el editor, puede marcar cada elemento con una etiqueta que indicar√° para qu√© tipo de color se debe establecer (Fondo, Primer plano, AccentColor y FixedColor). </font><font style="vertical-align: inherit;">Todo esto se establece al comienzo de la escena o por el evento de un cambio de esquema de color.</font></font><br><br>  Resultado: <br><br><img src="https://habrastorage.org/webt/jk/6o/zz/jk6ozzdaz6h8ixxrykmnocrtgze.png"><br><br><img src="https://habrastorage.org/webt/kl/4d/u6/kl4du6hxim70hyncofiakaiqsi4.png"><br><br><a name="Editor"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Extensiones de editor </font></font></h4><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para simplificar y acelerar el proceso de desarrollo, a menudo es necesario crear la herramienta correcta, que no es proporcionada por las herramientas de edici√≥n est√°ndar. </font><font style="vertical-align: inherit;">El enfoque tradicional en Unity es crear una clase descendiente EditorWindow. </font><font style="vertical-align: inherit;">Tambi√©n hay un enfoque con UiElements, pero todav√≠a est√° en desarrollo, por lo que decid√≠ usar el enfoque tradicional. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si simplemente crea una clase que usa algo del espacio de nombres UnityEditor al lado de otras clases para el juego, entonces el proyecto simplemente no se ensamblar√°, ya que este espacio de nombres no est√° disponible en la compilaci√≥n. </font><font style="vertical-align: inherit;">Hay varias soluciones:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Seleccione un proyecto separado para los scripts del editor. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Coloque archivos en la carpeta Activos / Editor </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Envuelva estos archivos en #if UNITY_EDITOR </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El proyecto utiliza el primer enfoque y, a veces, #if UNITY_EDITOR, si es necesario, agrega una peque√±a parte para el editor a la clase que se requiere en la compilaci√≥n. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todas las clases que solo se necesitan en el editor que defin√≠ en el ensamblado, que estar√°n disponibles solo en el editor. </font><font style="vertical-align: inherit;">Ella no ir√° a la construcci√≥n del juego. </font></font><br><br><img src="https://habrastorage.org/webt/-u/yv/ie/-uyviepp1z3u4aal0mgbzlothxg.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ser√≠a bueno tener DI en las extensiones de su editor. </font><font style="vertical-align: inherit;">Para esto utilizo Zenject.StaticContext. </font><font style="vertical-align: inherit;">Para configurarlo en el editor, se utiliza una clase con el atributo InitializeOnLoad, en el que hay un constructor est√°tico.</font></font><br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">InitializeOnLoad</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EditorInstaller</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditorInstaller</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> container = StaticContext.Container; container.Bind&lt;IElementsProvider&gt;().To&lt;ElementsProvider&gt;().AsSingle(); container.Bind&lt;ISolver&gt;().To&lt;Solver&gt;().AsSingle(); .... } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para registrar las clases ScriptableObject en un contexto est√°tico, utilizo el siguiente c√≥digo: </font></font><br><br><pre> <code class="cs hljs">BindFirstScriptableObject&lt;ISceneNameConfiguration, SceneNameConfiguration&gt;(container); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> BindFirstScriptableObject&lt;TInterface, TImplementation&gt;(DiContainer container) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> TImplementation : ScriptableObject, TInterface { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj = GetFirstScriptableObject&lt;TImplementation&gt;(); container.Bind&lt;TInterface&gt;().FromInstance(obj).AsSingle(); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> T GetFirstScriptableObject&lt;T&gt;() <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : ScriptableObject { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> guids = AssetDatabase.FindAssets(<span class="hljs-string"><span class="hljs-string">"t:"</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(T).Name); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> path = AssetDatabase.GUIDToAssetPath(guids.First()); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj = AssetDatabase.LoadAssetAtPath&lt;T&gt;(path); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La implementaci√≥n de TI solo es necesaria para esta l√≠nea. AssetDatabase.LoadAssetAtPath (ruta) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No es posible </font><font style="vertical-align: inherit;">agregar una </font><font style="vertical-align: inherit;">dependencia al constructor. </font><font style="vertical-align: inherit;">En su lugar, agregue el atributo [Inject] en los campos de dependencia a la clase de ventana y llame a </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StaticContext.Container.Inject (this) </font><font style="vertical-align: inherit;">al </font><font style="vertical-align: inherit;">inicio de la </font><font style="vertical-align: inherit;">ventana </font><font style="vertical-align: inherit;">; </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tambi√©n recomiendo agregar al ciclo de actualizaci√≥n de la ventana una comprobaci√≥n nula de uno de los campos dependientes, y si el campo est√° vac√≠o, realice la l√≠nea anterior. </font><font style="vertical-align: inherit;">Porque despu√©s de cambiar el c√≥digo en el proyecto, Unity puede recrear la ventana y no llamar a Awake en ella.</font></font><br><br><a name="GeneratorWindow"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Generador </font></font></h4><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido La</font></font></a> <br><br><img src="https://habrastorage.org/webt/4i/cp/ud/4icpudizv2-8r-bwrbkk3bva8kq.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vista inicial del generador </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La ventana debe proporcionar una interfaz para generar una lista de esquemas con par√°metros, mostrar una lista de esquemas y colocar el esquema seleccionado en la escena actual. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La ventana consta de tres secciones de izquierda a derecha:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ajustes de generaci√≥n </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lista de opciones en forma de botones </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> opci√≥n seleccionada como texto </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las columnas se crean con EditorGUILayout.BeginVertical () y EditorGUILayout.EndVertical (). Desafortunadamente, no funcion√≥ arreglar y limitar los tama√±os, pero esto no es tan cr√≠tico. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Result√≥ que el proceso de generaci√≥n en una gran cantidad de circuitos no es tan r√°pido. Se obtienen muchas combinaciones con los elementos de I. Como mostr√≥ el generador de perfiles, la parte m√°s lenta es el circuito en s√≠. Paralelizarlo no es una opci√≥n; todas las opciones usan un esquema, pero es dif√≠cil clonar esta estructura.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entonces pens√© que probablemente todo el c√≥digo de las extensiones del editor funciona en modo de depuraci√≥n. En Release, la depuraci√≥n no funciona tan bien, los puntos de interrupci√≥n no se detienen, se omiten las l√≠neas, etc. De hecho, habiendo medido el rendimiento, result√≥ que la velocidad del generador en Unity corresponde al ensamblaje de depuraci√≥n lanzado desde la aplicaci√≥n de consola, que es ~ 6 veces m√°s lenta que la versi√≥n.</font></font> Ten esto en cuenta. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alternativamente, puede hacer un ensamblaje externo y agregar a la DLL de Unity con el ensamblaje, pero esto complica enormemente el ensamblaje y la edici√≥n del proyecto. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inmediatamente llev√© el proceso de generaci√≥n a una Tarea separada con un c√≥digo que contiene esto: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">circuitGenerator.Generate (lines, maxElementsInLine, availableLogicalElements, useNOT, modificaci√≥n) .ToList () </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ya mejor, el editor no se bloquea en el momento de la generaci√≥n. </font><font style="vertical-align: inherit;">Pero a√∫n es necesario esperar mucho tiempo, durante varios minutos (m√°s de 20 minutos en circuitos de gran tama√±o). </font><font style="vertical-align: inherit;">Adem√°s, hab√≠a un problema que la tarea no se puede completar tan f√°cilmente y contin√∫a funcionando hasta que se completa la generaci√≥n.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mucho c√≥digo</font></font></b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Ext</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IEnumerable&lt;CircuitVariant&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OrderVariants</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IEnumerable&lt;CircuitVariant&gt; circuitVariants</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> circuitVariants.OrderBy(a =&gt; a.Solutions.Count()) .ThenByDescending(a =&gt; a.Solutions .Select(b =&gt; b.Sum(i =&gt; i ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">-1</span></span>)) .OrderByDescending(b=&gt;b) .First()); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IEditorGenerator</span></span> : <span class="hljs-title"><span class="hljs-title">IDisposable</span></span> { CircuitVariant[] FilteredVariants { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LastPage { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FilterVariants</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> page</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> lines, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> maxElementsInLine, ICollection&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; availableGates, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> useNOT, StructureModification? modification, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> maxSolutions</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Fetch</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EditorGenerator</span></span> : <span class="hljs-title"><span class="hljs-title">IEditorGenerator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> PageSize = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ICircuitGenerator circuitGenerator; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ConcurrentBag&lt;CircuitVariant&gt; variants; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;CircuitVariant&gt; sortedVariants; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Thread generatingThread; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditorGenerator</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ICircuitGenerator circuitGenerator</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.circuitGenerator = circuitGenerator; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dispose</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { generatingThread?.Abort(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CircuitVariant[] FilteredVariants { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LastPage { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FilterVariants</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> page</span></span></span><span class="hljs-function">)</span></span> { CheckVariants(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sortedVariants == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Fetch(); } FilteredVariants = sortedVariants.Skip(page * PageSize) .Take(PageSize) .ToArray(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = sortedVariants.Count; LastPage = count % PageSize == <span class="hljs-number"><span class="hljs-number">0</span></span> ? (count / PageSize) - <span class="hljs-number"><span class="hljs-number">1</span></span> : count / PageSize; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Fetch</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { CheckVariants(); sortedVariants = variants.OrderVariants() .ToList(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> lines, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> maxElementsInLine, ICollection&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; availableGates, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> useNOT, StructureModification? modification, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> maxSolutions</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (generatingThread != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Stop(); } variants = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcurrentBag&lt;CircuitVariant&gt;(); generatingThread = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Thread(() =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> v = circuitGenerator.Generate(lines, maxElementsInLine, availableGates, useNOT, modification, maxSolutions); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> v) { variants.Add(item); } }); generatingThread.Start(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { generatingThread?.Abort(); sortedVariants = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; variants = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; generatingThread = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; FilteredVariants = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckVariants</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (variants == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidOperationException(<span class="hljs-string"><span class="hljs-string">"VariantsGeneration is not started. Use Start before."</span></span>); } } ~EditorGenerator() { generatingThread.Abort(); } }</code> </pre> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La idea es que se genere el fondo y, previa solicitud, se actualizar√° la lista interna de opciones ordenadas. Luego puede p√°gina por p√°gina para seleccionar opciones. Por lo tanto, no es necesario ordenar cada vez, lo que acelera significativamente el trabajo en listas grandes. Los esquemas se ordenan por "inter√©s": por el n√∫mero de soluciones, por aumento y por c√≥mo se requieren varios valores para la soluci√≥n. Es decir, un circuito con una soluci√≥n de 1 1 1 1 es menos interesante que 1 0 1 1. </font></font><br><br><img src="https://habrastorage.org/webt/mr/ud/aa/mrudaajqtmoetizlrvzd1muja4q.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por lo tanto, result√≥, sin esperar el final de la generaci√≥n, seleccionar un circuito para el nivel. Otra ventaja es que debido a la paginaci√≥n, el editor no se ralentiza como el ganado.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La caracter√≠stica de Unity es muy inquietante porque al hacer clic en Reproducir, el contenido de la ventana se restablece, como todos los datos generados. </font><font style="vertical-align: inherit;">Si fueran f√°cilmente serializables, podr√≠an almacenarse como archivos. </font><font style="vertical-align: inherit;">De esta manera, incluso puede almacenar en cach√© los resultados de la generaci√≥n. </font><font style="vertical-align: inherit;">Pero, por desgracia, es dif√≠cil serializar una estructura compleja donde los objetos se refieren entre s√≠. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adem√°s, agregu√© l√≠neas a cada puerta, como</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.Length == <span class="hljs-number"><span class="hljs-number">2</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Input[<span class="hljs-number"><span class="hljs-number">0</span></span>].Value &amp;&amp; Input[<span class="hljs-number"><span class="hljs-number">1</span></span>].Value; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lo que mejor√≥ enormemente el rendimiento. </font></font><br><br><a name="SolverWindow"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Solucionador </font></font></h4><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cuando ensambla un circuito en el editor, debe ser capaz de comprender r√°pidamente si se est√° resolviendo y cu√°ntas soluciones tiene. </font><font style="vertical-align: inherit;">Para hacer esto, cre√© una ventana de "solucionador". </font><font style="vertical-align: inherit;">Proporciona soluciones al esquema actual en forma de texto. </font></font><br><br><img src="https://habrastorage.org/webt/k4/4e/pk/k44epkd08ngv_gh2rpejtr6jzkg.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La l√≥gica de su "backend":</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSourcesLabel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sourcesMb = sceneObjectsHelper.FindObjectsOfType&lt;SourceMb&gt;().OrderBy(s =&gt; s.name); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sourcesLabelSb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sourcesMb) { sourcesLabelSb.Append(<span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{item.name.Replace(</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">"Source"</span></span></span></span><span class="hljs-string"><span class="hljs-subst">, </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">"Src"</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">\t"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sourcesLabelSb.ToString(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IEnumerable&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>[]&gt; FindSolutions() { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> elementsMb = sceneObjectsHelper.FindObjectsOfType&lt;IElectricalElementMbEditor&gt;(); elementsConfigurator.Configure(elementsMb); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> root = sceneObjectsHelper.FindObjectOfType&lt;FinalDevice&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (root == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidOperationException(<span class="hljs-string"><span class="hljs-string">"No final device in scene"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sourcesMb = sceneObjectsHelper.FindObjectsOfType&lt;SourceMb&gt;().OrderBy(s =&gt; s.name); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sources = sourcesMb.Select(mb =&gt; (Source) mb.Element).ToArray(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> solver.GetSolutions(root.Element, sources); }</code> </pre> <br><a name="Useful"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √ötil </font></font></h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido</font></font></a> <br><br><a name="AssertHelper"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ayudar </font></font></h4><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para verificar que los valores est√°n establecidos en activos, utilizo m√©todos de extensi√≥n que llamo en OnEnable</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AssertHelper</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AssertType</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IElectricalElementMbEditor elementMbEditor, ElectricalElementType expectedType</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (elementMbEditor.Type != expectedType) { Debug.LogError(<span class="hljs-string"><span class="hljs-string">$"Field for </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{expectedType}</span></span></span><span class="hljs-string"> require element with such type, but given element is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{elementMbEditor.Type}</span></span></span><span class="hljs-string">"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> AssertNOTNull&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> T obj, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> fieldName = <span class="hljs-string"><span class="hljs-string">""</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(fieldName)) { fieldName = <span class="hljs-string"><span class="hljs-string">$"of type </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">typeof</span></span></span></span><span class="hljs-string"><span class="hljs-subst">(T).Name}</span></span></span><span class="hljs-string">"</span></span>; } Debug.LogError(<span class="hljs-string"><span class="hljs-string">$"Field </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{fieldName}</span></span></span><span class="hljs-string"> is not installed"</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AssertNOTEmpty</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> str, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fieldName = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(str)) { Debug.LogError(<span class="hljs-string"><span class="hljs-string">$"Field </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{fieldName}</span></span></span><span class="hljs-string"> is not installed"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AssertSceneCanBeLoaded</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Application.CanStreamedLevelBeLoaded(name)) { Debug.LogError(<span class="hljs-string"><span class="hljs-string">$"Scene </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{name}</span></span></span><span class="hljs-string"> can't be loaded."</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La verificaci√≥n de que la escena tiene la capacidad de cargarse a veces puede fallar, aunque la escena puede cargarse. </font><font style="vertical-align: inherit;">Quiz√°s esto sea un error en Unity. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplos de uso:</font></font><br><br><pre> <code class="cs hljs">mainMenuSceneName.AssertNOTEmpty(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(mainMenuSceneName)).AssertSceneCanBeLoaded(); levelNamePrefix.AssertNOTEmpty(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(levelNamePrefix)); editorElementsPrefabs.AssertNOTNull(); not.AssertType(ElectricalElementType.NOT); <span class="hljs-comment"><span class="hljs-comment">//     enum    </span></span></code> </pre> <br><a name="SceneObjectsHelper"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SceneObjectsHelper </font></font></h4><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para trabajar con elementos de escena, la clase SceneObjectsHelper tambi√©n fue √∫til:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mucho c√≥digo</font></font></b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Circuit.Game.Utility</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ISceneObjectsHelper</span></span> { T[] FindObjectsOfType&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> includeDisabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>; T FindObjectOfType&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> includeDisabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>; T Instantiate&lt;T&gt;(T prefab) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : Object; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> DestroyObjectsOfType&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> includeDisabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> immediate = <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Destroy&lt;T&gt;(T obj, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> immediate = <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : Object; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DestroyAllChildren</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Transform transform</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Inject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> obj</span></span></span><span class="hljs-function">)</span></span>; T GetComponent&lt;T&gt;(GameObject obj) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SceneObjectsHelper</span></span> : <span class="hljs-title"><span class="hljs-title">ISceneObjectsHelper</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> DiContainer diContainer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SceneObjectsHelper</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DiContainer diContainer</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.diContainer = diContainer; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T GetComponent&lt;T&gt;(GameObject obj) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj.GetComponents&lt;Component&gt;().OfType&lt;T&gt;().FirstOrDefault(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T[] FindObjectsOfType&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> includeDisabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (includeDisabled) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Resources.FindObjectsOfTypeAll(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Object)).OfType&lt;T&gt;().ToArray(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Object.FindObjectsOfType&lt;Component&gt;().OfType&lt;T&gt;().ToArray(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> DestroyObjectsOfType&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> includeDisabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> immediate = <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> objects = includeDisabled ? Resources.FindObjectsOfTypeAll(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Object)).OfType&lt;T&gt;().ToArray() : Object.FindObjectsOfType&lt;Component&gt;().OfType&lt;T&gt;().ToArray(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> objects) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (immediate) { Object.DestroyImmediate((item <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Component)?.gameObject); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Object.Destroy((item <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Component)?.gameObject); } } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Destroy&lt;T&gt;(T obj, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> immediate = <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : Object { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (immediate) { Object.DestroyImmediate(obj); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Object.Destroy(obj); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DestroyAllChildren</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Transform transform</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> childCount = transform.childCount; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; childCount; i++) { Destroy(transform.GetChild(i).gameObject); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T FindObjectOfType&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> includeDisabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (includeDisabled) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Resources.FindObjectsOfTypeAll(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Object)).OfType&lt;T&gt;().FirstOrDefault(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Object.FindObjectsOfType&lt;Component&gt;().OfType&lt;T&gt;().FirstOrDefault(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Inject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> obj</span></span></span><span class="hljs-function">)</span></span> { diContainer.Inject(obj); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T Instantiate&lt;T&gt;(T prefab) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : Object { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj = Object.Instantiate(prefab); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Component) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> components = ((Component) (<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>) obj).gameObject.GetComponents&lt;Component&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> component <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> components) { Inject(component); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Inject(obj); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj; } } }</code> </pre> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqu√≠, algunas cosas pueden no ser muy efectivas cuando se necesita un alto rendimiento, pero rara vez se las solicita y no crean ninguna influencia. </font><font style="vertical-align: inherit;">Pero le permiten encontrar objetos por la interfaz, por ejemplo, que se ve bastante bonita.</font></font><br><br><a name="CoroutineStarter"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Coroutinestarter </font></font></h4><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenidos</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Launch Coroutine solo puede MonoBehaviour. </font><font style="vertical-align: inherit;">As√≠ que cre√© la clase CoroutineStarter y la registr√© en el contexto de la escena.</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ICoroutineStarter</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BeginCoroutine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IEnumerator routine</span></span></span><span class="hljs-function">)</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CoroutineStarter</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span>, <span class="hljs-title"><span class="hljs-title">ICoroutineStarter</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BeginCoroutine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IEnumerator routine</span></span></span><span class="hljs-function">)</span></span> { StartCoroutine(routine); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adem√°s de la conveniencia, la introducci√≥n de tales herramientas facilit√≥ la prueba autom√°tica. </font><font style="vertical-align: inherit;">Por ejemplo, la ejecuci√≥n de corutina en pruebas:</font></font><br><br><pre> <code class="cs hljs">coroutineStarter.When(x =&gt; x.BeginCoroutine(Arg.Any&lt;IEnumerator&gt;())).Do(info =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = (IEnumerator) info[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (a.MoveNext()) { } });</code> </pre> <br><a name="Gizmo"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gizmo </font></font></h4><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para la conveniencia de mostrar elementos invisibles, recomiendo usar im√°genes de artefactos que solo sean visibles en la escena. </font><font style="vertical-align: inherit;">Facilitan la selecci√≥n de un elemento invisible con un clic. </font><font style="vertical-align: inherit;">Tambi√©n se hicieron conexiones de elementos en forma de l√≠neas:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnDrawGizmos</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (outputConnectorMb != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Handles.DrawLine(transform.position, outputConnectorMb.Transform.position); } }</code> </pre> <br><img src="https://habrastorage.org/webt/ta/ce/d5/taced5wyeyhwkpj5vtiuvauu68s.png"><br><br><a name="Testing"></a><h3>  Prueba </h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Quer√≠a aprovechar al m√°ximo las pruebas autom√°ticas, porque las pruebas se usaban siempre que era posible y eran f√°ciles de usar. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para las pruebas unitarias, es habitual usar objetos simulados en lugar de las clases que implementan la interfaz de la que depende la clase de prueba. Para esto, utilic√© la biblioteca </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSubstitute</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Lo que est√° muy contento. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity no es compatible con NuGet, por lo que tuve que obtener la DLL por separado, luego el ensamblado, ya que una dependencia se agrega al archivo AssemblyDefinition y se usa sin problemas. </font></font><br><br><img src="https://habrastorage.org/webt/y-/bh/sp/y-bhsprsfvxo-j9javgdhdzzhig.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para las pruebas autom√°ticas, Unity ofrece TestRunner, que funciona con el popular marco de prueba </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NUnit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Desde el punto de vista de TestRunner, hay dos tipos de pruebas:</font></font><br><br><ul><li> EditMode ‚Äî     ,   .    Nunit .    ,    .        GameObject  Monobehaviour .   ,     EditMode . </li><li> PlayMode ‚Äî     .    </li></ul><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EditMode En mi experiencia, ha habido muchos inconvenientes y comportamientos extra√±os en este modo. Sin embargo, son convenientes para verificar autom√°ticamente el estado de la aplicaci√≥n en su conjunto. Tambi√©n proporcionan una verificaci√≥n honesta del c√≥digo en m√©todos como Inicio, Actualizaci√≥n y similares. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las pruebas de PlayMode pueden describirse como pruebas normales de NUnit, pero existe una alternativa. En PlayMode, es posible que deba esperar un tiempo o una cierta cantidad de fotogramas. Para hacer esto, las pruebas deben describirse de manera similar a Coroutine. El valor devuelto debe ser IEnumerator / IEnumerable y dentro, para omitir el tiempo, debe usar, por ejemplo:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>;</code> </pre> <br>  o <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">yield</span></span></span><span class="hljs-function"> return new </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WaitForSeconds</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hay otros valores de retorno. </font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dicha prueba debe establecer el atributo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UnityTest</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Tambi√©n hay </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atributos UnitySetUp y UnityTearDown con los que debe utilizar un enfoque similar. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yo, a su vez, comparto las pruebas de EditMode para Modular e Integraci√≥n. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las pruebas unitarias prueban solo una clase en completo aislamiento de otras clases. </font><font style="vertical-align: inherit;">Tales pruebas a menudo facilitan la preparaci√≥n del entorno para la clase probada y los errores, cuando se pasan, le permiten localizar el problema con mayor precisi√≥n. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En las pruebas unitarias, pruebo muchas clases principales y clases necesarias directamente en el juego. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las pruebas de los elementos del circuito son muy similares, as√≠ que cre√© una clase base</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ElectricalElementTestsBase</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TElement</span></span>&gt; <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">TElement</span></span> : <span class="hljs-title"><span class="hljs-title">ElectricalElementBase</span></span>, <span class="hljs-title"><span class="hljs-title">IElectricalElement</span></span>, <span class="hljs-title"><span class="hljs-title">new</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> TElement element; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> IInputConnector mInput1; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> IInputConnector mInput2; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> IInputConnector mInput3; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> IInputConnector mInput4; [OneTimeSetUp] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Setup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { element = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TElement(); mInput1 = Substitute.For&lt;IInputConnector&gt;(); mInput2 = Substitute.For&lt;IInputConnector&gt;(); mInput3 = Substitute.For&lt;IInputConnector&gt;(); mInput4 = Substitute.For&lt;IInputConnector&gt;(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetValue_3Input</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> input1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> input2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> input3, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> expectedOutput</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// arrange mInput1.Value.Returns(input1); mInput2.Value.Returns(input2); mInput3.Value.Returns(input3); element.Input = new[] {mInput1, mInput2, mInput3}; // act bool result = element.GetValue(); // assert Assert.AreEqual(expectedOutput, result); } protected void GetValue_2Input(bool input1, bool input2, bool expectedOutput) { // arrange mInput1.Value.Returns(input1); mInput2.Value.Returns(input2); element.Input = new[] {mInput1, mInput2}; // act bool result = element.GetValue(); // assert Assert.AreEqual(expectedOutput, result); } protected void GetValue_1Input(bool input, bool expectedOutput) { // arrange mInput1.Value.Returns(input); element.Input = new[] {mInput1}; // act bool result = element.GetValue(); // assert Assert.AreEqual(expectedOutput, result); } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Las pruebas de elementos adicionales se ven as√≠: </font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AndTests</span></span> : <span class="hljs-title"><span class="hljs-title">ElectricalElementTestsBase</span></span>&lt;<span class="hljs-title"><span class="hljs-title">And</span></span>&gt; { [TestCase(<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] [TestCase(<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] [TestCase(<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] [TestCase(<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> new </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetValue_2Input</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> input1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> input2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> output</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.GetValue_2Input(input1, input2, output); } [TestCase(<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] [TestCase(<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> new </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetValue_1Input</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> input, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> expectedOutput</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.GetValue_1Input(input, expectedOutput); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quiz√°s esto sea una complicaci√≥n en t√©rminos de facilidad de comprensi√≥n, que generalmente no es necesaria en las pruebas, pero no quer√≠a copiar y pegar lo mismo 11 veces. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tambi√©n hay pruebas de GameManagers. </font><font style="vertical-align: inherit;">Como tienen mucho en com√∫n, tambi√©n obtuvieron una clase base de pruebas. </font><font style="vertical-align: inherit;">Los administradores de juegos en ambos modos deben tener una funcionalidad id√©ntica y otra diferente. </font><font style="vertical-align: inherit;">Las cosas generales se prueban con las mismas pruebas para cada sucesor y se prueba adem√°s el comportamiento espec√≠fico. </font><font style="vertical-align: inherit;">A pesar del enfoque del evento, no fue dif√≠cil probar el comportamiento realizado por el evento:</font></font><br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Test</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FullHelpAgree_FinishLevel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// arrange levelGameManager.Start(); helpMenu.ClearReceivedCalls(); dataManager.ClearReceivedCalls(); // act helpMenu.FullHelpClick += Raise.Event&lt;Action&gt;(); fullHelpWindow.Agreed += Raise.Event&lt;Action&lt;bool&gt;&gt;(true); // assert dataManager.Received().SaveGame(); helpMenu.Received().Hide(); } [Test] public void ChangeSource_RootOutBecomeTrue_SavesGameOpensMenu() { // arrange currentLevelData.IsTestLevel.Returns(false); rootOutputMb.OutputConnector.Value.Returns(true); // act levelGameManager.Start(); levelFinishedMenu.ClearReceivedCalls(); dataManager.ClearReceivedCalls(); source.ValueChanged += Raise.Event&lt;Action&lt;bool&gt;&gt;(true); // assert dataManager.Received().SaveGame(); levelFinishedMenu.Received().Show(); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En las pruebas de integraci√≥n, tambi√©n prob√© clases para el editor y las tom√© del contexto est√°tico del contenedor DI. </font><font style="vertical-align: inherit;">Por lo tanto, la verificaci√≥n incluye la inyecci√≥n correcta, que no es menos importante que la prueba unitaria.</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PlacerTests</span></span> { [Inject] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ICircuitEditorPlacer circuitEditorPlacer; [Inject] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ICircuitGenerator circuitGenerator; [Inject] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IEditorSolver solver; [Inject] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ISceneObjectsHelper sceneObjectsHelper; [TearDown] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TearDown</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { sceneObjectsHelper.DestroyObjectsOfType&lt;IElectricalElementMb&gt;(immediate: <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } [OneTimeSetUp] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Setup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> container = StaticContext.Container; container.Inject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } [TestCase(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>)] [TestCase(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>)] [TestCase(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PlaceSolve_And_NoModifications_AllVariantsSolved</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> lines, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> elementsInLine</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> variants = circuitGenerator.Generate(lines, elementsInLine, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; {<span class="hljs-number"><span class="hljs-number">0</span></span>}, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> variant <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> variants) { circuitEditorPlacer.PlaceCircuit(variant); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> solutions = solver.FindSolutions(); CollectionAssert.IsNOTEmpty(solutions); } } [TestCase(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, StructureModification.Branching)] [TestCase(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, StructureModification.ThroughLayer)] [TestCase(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, StructureModification.All)] [TestCase(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, StructureModification.Branching)] [TestCase(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, StructureModification.ThroughLayer)] [TestCase(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, StructureModification.All)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PlaceSolve_And_Modifications_AllVariantsSolved</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> lines, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> elementsInLine, StructureModification modification</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> variants = circuitGenerator.Generate(lines, elementsInLine, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; {<span class="hljs-number"><span class="hljs-number">0</span></span>}, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, modification); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> variant <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> variants) { circuitEditorPlacer.PlaceCircuit(variant); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> solutions = solver.FindSolutions(); CollectionAssert.IsNOTEmpty(solutions); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta prueba utiliza implementaciones reales de todas las dependencias y tambi√©n establece objetos en el escenario, lo cual es bastante posible en las pruebas de EditMode. Es cierto probar que los puso en su sano juicio: tengo poca idea de c√≥mo hacerlo, as√≠ que verifico que el circuito publicado tenga soluciones. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En integraci√≥n, tambi√©n hay pruebas para CircuitGenerator (StructureGenerator + VariantsGenerator) y Solver</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CircuitGeneratorTests</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ICircuitGenerator circuitGenerator; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ISolver solver; [SetUp] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Setup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { solver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Solver(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gates = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Func&lt;IElectricalElement&gt;&gt; { () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> And(), () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Or(), () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Xor() }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> conductors = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Func&lt;IElectricalElement&gt;&gt; { () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Conductor(), () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Not() }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> elements = Substitute.For&lt;IElementsProvider&gt;(); elements.Conductors.Returns(conductors); elements.Gates.Returns(gates); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> structGenerator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StructureGenerator(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> variantsGenerator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VariantsGenerator(solver, elements); circuitGenerator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CircuitGenerator(structGenerator, variantsGenerator); } [Test] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Generate_2l_2max_ReturnsVariants</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// act var variants = circuitGenerator.Generate(2, 2, new[] {0, 1, 2}, false).ToArray(); // assert Assert.True(variants.Any()); AssertLayersNotContains(variants.First().Structure.Gates, typeof(Nand)); AssertLayersNotContains(variants.First().Structure.Gates, typeof(Nor)); AssertLayersNotContains(variants.First().Structure.Gates, typeof(Xnor)); AssertLayersNotContains(variants.First().Structure.Conductors, typeof(Not)); AssertLayersContains(variants.First().Structure.Gates, typeof(Or)); AssertLayersContains(variants.First().Structure.Gates, typeof(Xor)); AssertLayersContains(variants.First().Structure.Conductors, typeof(Conductor)); } [Test] public void Generate_2l_2max_RestrictedElementsWithConductors() { // arrange var available = new[] {0}; // act var variants = circuitGenerator.Generate(2, 2, available, true).ToArray(); // assert Assert.True(variants.Any()); var lElements = new List&lt;int&gt;(); var layers = variants.Select(v =&gt; v.Gates); foreach (var layer in layers) { foreach (var item in layer.Values) { lElements.AddRange(item); } } Assert.True(lElements.Contains(0)); Assert.False(lElements.Contains(1)); Assert.False(lElements.Contains(2)); AssertLayersContains(variants.First().Structure.Gates, typeof(And)); AssertLayersContains(variants.First().Structure.Conductors, typeof(Conductor)); AssertLayersContains(variants.First().Structure.Conductors, typeof(Not)); AssertLayersNotContains(variants.First().Structure.Gates, typeof(Nand)); AssertLayersNotContains(variants.First().Structure.Gates, typeof(Or)); AssertLayersNotContains(variants.First().Structure.Gates, typeof(Nor)); AssertLayersNotContains(variants.First().Structure.Gates, typeof(Xnor)); AssertLayersNotContains(variants.First().Structure.Gates, typeof(Xor)); } private static void AssertLayersContains(IDictionary&lt;int, ElectricalElementContainer[]&gt; layers, Type elementType) { AssertLayersContains(layers, elementType, true); } private static void AssertLayersNotContains(IDictionary&lt;int, ElectricalElementContainer[]&gt; layers, Type elementType) { AssertLayersContains(layers, elementType, false); } private static void AssertLayersContains(IDictionary&lt;int, ElectricalElementContainer[]&gt; layers, Type elementType, bool shouldContain) { bool contains = false; foreach (var layer in layers) { foreach (var item in layer.Value) { contains |= item.Elements.Select(e =&gt; e.GetType()).Contains(elementType); } } Assert.AreEqual(shouldContain, contains); } } }</span></span></code> </pre> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las pruebas de PlayMode se usan como pruebas del sistema. Verifican prefabricados, inyecci√≥n, etc. Una buena opci√≥n es usar escenas preparadas en las que la prueba solo se carga y produce algunas interacciones. Pero utilizo una escena vac√≠a preparada para las pruebas, en la que el entorno es diferente del que habr√° en el juego. Hubo un intento de usar PlayMode para probar todo el proceso del juego, como ingresar al men√∫, ingresar al nivel, etc., pero el trabajo de estas pruebas result√≥ ser inestable, por lo que se decidi√≥ posponerlo para m√°s tarde (nunca). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es conveniente usar herramientas de evaluaci√≥n de cobertura para escribir pruebas, pero desafortunadamente no he encontrado ninguna soluci√≥n que funcione con Unity.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encontr√© un problema que con la actualizaci√≥n de Unity a 2018.3, las pruebas comenzaron a funcionar mucho m√°s lento, hasta 10 veces m√°s lento (en un ejemplo sint√©tico). </font><font style="vertical-align: inherit;">El proyecto contiene 288 pruebas EditMode que se ejecutan durante 11 segundos, aunque no se ha hecho nada durante tanto tiempo.</font></font><br><br><a name="Resume"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Resumen de desarrollo </font></font></h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"></font></a> <br><br><img src="https://habrastorage.org/webt/kl/4d/u6/kl4du6hxim70hyncofiakaiqsi4.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Captura de pantalla de </font></font></i> <font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">contenido </font></a><i><font style="vertical-align: inherit;">del nivel del juego La</font></i></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> l√≥gica de algunos juegos se puede formular independientemente de la plataforma. En una etapa temprana, esto proporciona facilidad de desarrollo y capacidad de prueba por medio de pruebas autom√°ticas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DI es conveniente. Incluso teniendo en cuenta el hecho de que Unity no lo tiene de forma nativa, el atornillado en el lateral funciona de manera bastante tolerable. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity le permite probar autom√°ticamente un proyecto. Es cierto, dado que todos los componentes integrados de GameObject no tienen interfaces y solo se pueden usar directamente para burlarse de cosas como Collider, SpriteRenderer, MeshRenderer, etc. No funcionar√°. Aunque GetComponent le permite obtener componentes en la interfaz. Como opci√≥n, escriba sus propios envoltorios para todo.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El uso de pruebas autom√°ticas simplific√≥ el proceso de generar la l√≥gica inicial, mientras que no hab√≠a una interfaz de usuario para el c√≥digo. Las pruebas encontraron varias veces un error inmediatamente durante el desarrollo. Naturalmente, los errores aparecieron a√∫n m√°s, pero a menudo fue posible escribir pruebas adicionales / modificar las existentes y luego detectarlas autom√°ticamente. Los errores con DI, prefabricados, objetos programables y similares, pruebas son dif√≠ciles de atrapar, pero es posible, ya que puede usar instaladores reales para Zenject, lo que reforzar√° las dependencias, como sucede en la compilaci√≥n.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La unidad genera una gran cantidad de errores, fallas. </font><font style="vertical-align: inherit;">A menudo, los errores se resuelven reiniciando el editor. </font><font style="vertical-align: inherit;">Frente a una extra√±a p√©rdida de referencias a objetos en prefabricados. </font><font style="vertical-align: inherit;">A veces, el prefab por referencia se destruye (ToString () devuelve "nulo"), aunque todo parece funcionar, el prefab se arrastra a la escena y el enlace no est√° vac√≠o. </font><font style="vertical-align: inherit;">A veces se pierden algunas conexiones en todas las escenas. </font><font style="vertical-align: inherit;">Todo parece estar instalado, funcion√≥, pero al cambiar a otra rama, todas las escenas se rompen, no hay enlaces entre los elementos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Afortunadamente, estos errores a menudo se corrigieron reiniciando el editor o algunas veces eliminando la carpeta Biblioteca. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En total, ha pasado aproximadamente medio a√±o desde la idea hasta su publicaci√≥n en Google Play. </font><font style="vertical-align: inherit;">El desarrollo en s√≠ tom√≥ alrededor de 3 meses, en tiempo libre del trabajo principal.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/453564/">https://habr.com/ru/post/453564/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../453546/index.html">Necesita un teclado peque√±o: h√°galo usted mismo</a></li>
<li><a href="../453548/index.html">Revivimos el frenado Samsung Galaxy TAB 2 WiFi</a></li>
<li><a href="../453554/index.html">C√≥mo ha cambiado Starlink de SpaceX</a></li>
<li><a href="../453558/index.html">Introducci√≥n al aprendizaje autom√°tico</a></li>
<li><a href="../453562/index.html">Eventos digitales en Mosc√∫ del 27 de mayo al 2 de junio</a></li>
<li><a href="../453566/index.html">Restaurar la leyenda: un llamado para el intercambio de datos abiertos que pueden ayudar en la restauraci√≥n de Notre Dame</a></li>
<li><a href="../453568/index.html">Reconstrucci√≥n de un icono: una llamada para compartir datos abiertos para ayudar a restaurar Notre-Dame</a></li>
<li><a href="../453570/index.html">Microsoft Edge para macOS</a></li>
<li><a href="../453572/index.html">Microsoft Edge para macOS</a></li>
<li><a href="../453574/index.html">Gesti√≥n de productos B2B</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>