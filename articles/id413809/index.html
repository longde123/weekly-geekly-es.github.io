<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚋 👶🏿 🤹🏽 Set-Top-Box dan percobaan dengan Android di wadah LXC 🕊️ 🐟 📠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bagaimana kebutuhan aneh muncul untuk menjalankan Android dalam wadah Linux, dan apa yang terjadi 

 Latar belakang 
 Menjalankan Android dalam wadah ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Set-Top-Box dan percobaan dengan Android di wadah LXC</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413809/">  Bagaimana kebutuhan aneh muncul untuk menjalankan Android dalam wadah Linux, dan apa yang terjadi <br><br><h3>  Latar belakang </h3><br>  Menjalankan Android dalam wadah LXC, menurut saya, adalah keputusan logis jika Anda ingin memiliki transparansi dan keandalan Bare Linux dan menggunakan potensi besar aplikasi Android pihak ketiga yang baik (dan tidak begitu baik).  Juga, konfigurasi ini menarik sebagai platform untuk men-debug gambar AOSP Anda sendiri dalam kondisi sedekat mungkin dengan pertempuran. <a name="habracut"></a><br>  Untuk percobaan, dipilih set-top box Cina progresif dan murah berdasarkan 64-bit ARMv8 dari Amlogic S905x dipilih (CPU - 4 core, RAM - 2GB, MMC - 8GB).  Juga, argumen yang baik (dibandingkan dengan vendor lain) adalah basis kode di OpenSource dan keberadaan driver kernel kernel sumber untuk Mali-450.  Perpustakaan pengguna-ruang Mali hari ini di domain publik di situs web resmi ARM Limited.  Pustaka akses biner untuk Linux-FB, Linux-Wayland, dan Android. <br><br>  Tujuan utama percobaan adalah aplikasi bioskop online dan aplikasi untuk bekerja dengan hosting media jaringan.  Misalnya, dengan Youtube di Linux, masalah langsung dimulai.  Pertama: metode peretas untuk mendapatkan tautan ke konten dengan mem-parsing skrip JS dan menghasilkan tanda tangan (sebelumnya diimplementasikan dalam minitube dari Tordini dan di youtube-dl) mulai mogok secara teratur karena perjuangan Google tanpa ampun dengan metode perayapan iklan.  Kedua: resolusi maksimum konten adalah 720p - lebih banyak Google-API tidak mengeluarkan.  Ketiga: WebKit telah kehilangan dukungan normal dan baru-baru ini hanya didukung oleh sekelompok kecil penggemar.  Nasib yang sama menimpa port Qt-nya.  Akibatnya, pada satu titik, halaman youtube / tv menolak untuk bekerja, mengutip usia mesin web.  Nah, pada akhirnya, dia mengemukakan kejutan WebEngine (Qt-Chromium).  Ternyata keindahan ini tidak mendukung akselerasi perangkat keras.  Pengecualian hanya dibuat untuk port Android-nya, dan cabang VAAPI marginal di Linux.  Jalan buntu.  Secara umum, saya tidak menemukan cara sederhana untuk mengaktifkan decoding video akselerasi perangkat keras untuk Chromium di Linux.  Menerapkan VAAPI untuk Amlogic tampak seperti pekerjaan yang sulit dan tidak berguna bagi saya.  Saya juga merasakan lada plugin - sayangnya PPAPI tidak mengizinkan memutar video layar. <br><br><h3>  Android </h3><br>  Mengapa tidak menjalankan Android dalam sebuah wadah?  Proyek Anbox menginspirasi prestasi tersebut.  Sebuah studi menyeluruh tentang Anbox telah menunjukkan bahwa itu tidak cocok untuk kita.  Tapi idenya jelas.  Artikel oleh penulis lain mengklaim bahwa menjalankan Android dalam sebuah wadah adalah tugas yang bodoh.  Tetapi pada kenyataannya, semuanya ternyata jauh lebih rumit.  Dengan hanya mengkonfigurasi file konfigurasi, kami tidak bisa turun. <br><br>  Jadi, saya mengumpulkan LXC dan menginstalnya di sistem.  Tes konfigurasi kernel mengungkapkan masalah: Anda perlu mengaktifkan dukungan namespace.  Karena platform ini built-in, segala macam hal yang tidak perlu dinonaktifkan.  Saya harus mengidentifikasi ini tidak perlu. <br><br>  Tes pertama memeriksa Busybox di wadah.  Setelah memastikan semuanya bekerja, saya mulai bereksperimen. <br><br>  <i>Tampilan awal adalah /var/lib/lxc/abox.conf:</i> <br><br><pre><code class="hljs ruby">lxc.rootfs = <span class="hljs-regexp"><span class="hljs-regexp">/var/lib</span></span><span class="hljs-regexp"><span class="hljs-regexp">/lxc/abox</span></span><span class="hljs-regexp"><span class="hljs-regexp">/rootfs lxc.rootfs.backend = dir lxc.utsname = abox lxc.pts = 1024 lxc.cap.drop = mac_admin mac_override</span></span></code> </pre> <br>  Unduh tangan Cina rampasan AOSP 6.0.19.  Ini berbeda dari versi vanilla dengan kehadiran launcher yang normal, dipertajam oleh surfacelinger yang distash dan hard-patched dengan dukungan untuk beberapa fitur platform perangkat keras Amlogic.  Vanilla AOSP selanjutnya juga diuji. <br><br>  <i>Sedikit keluar dari topik: Cina, mengadaptasi perangkat lunak, meludahi semua aturan yang ditetapkan oleh komunitas.</i>  <i>Sebagai contoh, kernel 3.14.29.</i>  <i>Nomor rilis kernel diam ini digunakan pada hampir semua perangkat keras pada prosesor Amlogic S8xx dan S9xx.</i>  <i>Tapi, hampir selalu, mereka sangat berbeda satu sama lain, hingga ketidakcocokan lengkap modul lama dengan gambar baru dan sebaliknya.</i>  <i>Tampaknya inti dikoreksi sesuai dengan prinsip: "secepat mungkin masuknya produk ke pasar".</i>  <i>Kode ini tidak hanya kotor - kualitasnya menjijikkan.</i>  <i>Mengubah konfigurasi biasanya menyebabkan kesalahan saat mengkompilasi atau menautkan gambar atau modul.</i>  <i>Android yang ditambal memiliki kualitas yang sama, dan prinsip-prinsip adaptasi serupa.</i>  <i>Hampir semua rekomendasi dari tim AOSP diabaikan.</i> <br><br>  Nah ke mana harus pergi!  Kami mengumpulkan. <br><br>  <b>Percobaan No. 1</b> Instal gambar dalam wadah, jalankan.  Tidak bekerja  Analisis menunjukkan bahwa tidak ada objek kernel: binder dan ashmem.  Kami menambahkan modul kernel. <br><br>  <b>Percobaan No. 2</b> Kita mulai lagi.  Installd lumpuh.  Ternyata pengikat aslinya tidak tahu tentang ruang nama.  Tarik binder dari Anbox. <br><br>  <b>Percobaan nomor 3</b> dimulai dan segera reboot.  Ternyata init ingin SELinux dan menolak untuk bekerja tanpanya. <br><br>  <b>Percobaan No. 4</b> Nyalakan SELinux.  Kami mendapatkan banyak masalah untuk sistem host.  Saya harus mematikannya, setidaknya untuk sekarang - sampai esensi dan teori dari proses itu diklarifikasi.  SELinux juga dapat dinonaktifkan pada baris perintah saat memuat kernel, tapi saya masih tidak mengerti bagaimana cara mengirimkan parameter ke wadah.  Saya harus masuk ke sumber init dan secara kasar memperbaiki perilakunya.  Ini adalah intervensi bedah pertama dan terakhir yang kembali kepada saya nanti. <br><br>  <b>Percobaan No. 5</b> Proses booting mencapai zygote.  Dalam log, bersumpah dari kernel pada init UID.  Di binder (dan binder dari Anbox), UID proses pemilik mudah dibandingkan dengan kesatuan.  Satu-satunya cara adalah menonaktifkan cek, terutama karena cek ini tidak ada artinya dalam wadah. <br><br>  <b>Percobaan No. 6</b> Konflik yang terkait dengan berbagi akses ke manajemen peralatan muncul.  Saya mengomentari kontrol USB dan Bluetooth di skrip init.  Saya menghapus semua entri dari fstab, dan melarang pemasangan dan verifikasi semua media dalam skrip.  Sekarang tambahkan kartu mount ke konfigurasi wadah.  Ini hanya berisi satu baris.  Direktori /mnt/lxc.data dipasang pada host di partisi MMC nyata. <br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">lxc</span></span>.mount.entry = /mnt/lxc.<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> auto rw,bind 0 0</span></span></code> </pre> <br>  <b>Percobaan No. 7</b> Bola memantul muncul di layar, memuat membutuhkan waktu lama, karena gambar Android dipasang pada NFS, dan dexx juga dihasilkan di direktori / data.  Memuat ulang jauh lebih cepat.  Dan akhirnya, peluncur muncul. <br>  Kami akan menganggap ini sebagai upaya terakhir, karena, secara umum, semuanya berfungsi dan Anda harus menyelesaikan detailnya. <br><br>  Jaringan tidak berfungsi, ia bekerja lebih tepatnya, tetapi beberapa aplikasi mengevaluasi kinerjanya dengan keadaan antarmuka jaringan.  Tangan bengkok, singkatnya.  Untuk menghilangkan kelemahan ini pada host, kami menaikkan network bridge (jembatan) dan antarmuka virtual (veth). <br><br><pre> <code class="hljs ruby">lxc.network.type = veth lxc.network.flags = up lxc.network.name = eth1 lxc.network.link = br<span class="hljs-number"><span class="hljs-number">0</span></span> lxc.network.veth.pair = veth-<span class="hljs-number"><span class="hljs-number">01</span></span> lxc.network.ipv4 = <span class="hljs-number"><span class="hljs-number">10.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> lxc.network.ipv4.gateway = <span class="hljs-number"><span class="hljs-number">10.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> lxc.network.hwaddr = <span class="hljs-number"><span class="hljs-number">00</span></span><span class="hljs-symbol"><span class="hljs-symbol">:FE</span></span><span class="hljs-symbol"><span class="hljs-symbol">:CD</span></span><span class="hljs-symbol"><span class="hljs-symbol">:BA</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>09<span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">87</span></span></code> </pre> <br>  Anda juga perlu menaikkan server DHCP, jika tidak akan ada masalah dengan DNS.  Sayangnya, Android tidak menganalisis resolv.conf dan lokasinya di sistem file tidak memainkan peran apa pun.  Anda dapat mengkonfigurasi koneksi jaringan secara manual, tetapi jika Anda menghapus data dari bagian data, semua pengaturan akan diatur ulang. <br><br><h3>  Ringkasan </h3><br>  Semua aplikasi stok berfungsi.  Dengan diinstal dari pasar ada masalah.  Sebagai contoh: Youtube.tv versi 3 menuntut untuk memperbarui kerangka layanan Google, setelah itu sistem macet.  Masalah dengan keystore muncul (belum terselesaikan).  TEE juga dinonaktifkan sementara, jadi widevine tidak berfungsi.  Mainan dan aplikasi berfungsi dengan baik tanpa persyaratan perangkat keras khusus.  Chrome memutar video HTML5 dengan decoder perangkat lunak, menolak untuk menghubungkan decoder perangkat keras.  Pada kesempatan ini, ada pendapat tentang AOSP yang dibengkokkan oleh Cina.  Tapi vanilla AOSP meluncurkan peluncur dengan layar sentuh - tidak mungkin untuk mengendalikan distacha. <br><br><h3>  Kata penutup </h3><br>  Dalam waktu dekat - untuk membuat peluncur untuk meluncurkan aplikasi Android langsung dari Linux.  Contoh dari ini tersedia di sumber pemohon wpa.  Anda juga dapat mengintip bagaimana hal ini dilakukan di Anbox. <br><br>  Terima kasih atas perhatian anda! <br><br><h3>  Penambahan 1 </h3><br>  Suatu hari saya memeriksa skalabilitas aplikasi Qt.  Awalnya, aplikasi klien IPTV ditulis dalam QML untuk Linux.  Pemain bekerja melalui plugin QtMultimedia.  Selama kompilasi, dependensi yang bermasalah muncul.  Untungnya, semuanya terbatas pada QtDbus, yang tidak ada di Android.  Saya masih tidak bisa mengerti mengapa Android perlu menemukan kembali pengikat roda.  Apa yang tidak disukai pengembang DBus?  Bahwa itu berfungsi di ruang pengguna?  Atau pertimbangan lisensi? <br>  DBus terputus.  Ini tidak menyakitkan, karena saluran diperlukan untuk sedikit fungsionalitas yang terkait dengan sistem operasi.  Gathered apk.  Tidak ada kesulitan dengan perakitan, karena saya menggunakan QtCreator (dan saya merekomendasikannya kepada Anda). <br>  Di AOSP, saya harus menggambar jembatan Mediaplayer - pewaris dari android :: MediaPlayerInterface.  Metode setDataSource () dan stop () diimplementasikan di dalamnya.  Colokan dibuat untuk yang lainnya.  setDataSource memiliki tiga antarmuka.  Itu diperlukan untuk mengimplementasikan saja: <br><pre> <code class="hljs objectivec">setDataSource(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> sp&lt;IMediaHTTPService&gt; &amp;httpService, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *uri, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> KeyedVector&lt;String8, String8&gt; *headers)</code> </pre><br><br>  <i>Jika Anda ingin memutar file dari media, Anda harus mengotak-atik</i> <i><br></i> <pre> <i><code class="hljs cpp">setDataSource(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fd, <span class="hljs-keyword"><span class="hljs-keyword">int64_t</span></span> offset, <span class="hljs-keyword"><span class="hljs-keyword">int64_t</span></span> length)</code></i> </pre> <i><br></i>  <i>Nama file harus diperoleh melalui "/ proc / self / fd /" + fd;</i> <br><br>  Setelah instalasi, aplikasi diterima dan siaran pergi.  Hebat!  Saya mengharapkan banyak masalah, tetapi hampir tidak ada.  Terima kasih kepada pengembang Qt dan QtCreator untuk pekerjaan yang hebat dan bermanfaat! <br>  Akibatnya, saya mendapat banyak: pemain daemon tuan rumah.  Dalam wadah, ada program klien dan panggilan siaran android :: Mediaplayer ke tuan rumah.  Bundel bekerja melalui soket UDP. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id413809/">https://habr.com/ru/post/id413809/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id413799/index.html">Penghitungan Lebah Ras Neural Pi Neural Network</a></li>
<li><a href="../id413801/index.html">"Roskosmos" menawarkan untuk membuat meriam laser ... sebuah teleskop optik</a></li>
<li><a href="../id413803/index.html">Python dan steganografi</a></li>
<li><a href="../id413805/index.html">Bagaimana server dilupakan selama 12 tahun dapat menelan biaya 120.000 pound</a></li>
<li><a href="../id413807/index.html">Penentuan karakteristik balistik-temporal dari gerakan pusat massa penerjun payung dari pesawat terbang</a></li>
<li><a href="../id413811/index.html">Intisari bahan-bahan segar dari dunia front-end untuk minggu terakhir No. 318 (4 - 10 Juni, 2018)</a></li>
<li><a href="../id413813/index.html">PHP Digest No. 132 (27 Mei - 10 Juni 2018)</a></li>
<li><a href="../id413815/index.html">Lokakarya kontribusi Go di Rusia</a></li>
<li><a href="../id413817/index.html">Pemrosesan data kompetitif heterogen real-time secara ketat satu kali</a></li>
<li><a href="../id413819/index.html">Jujur tentang pasar TI di Rusia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>