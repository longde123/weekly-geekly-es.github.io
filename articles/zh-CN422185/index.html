<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😚 🔗 👩‍🌾 用于模型训练的数据（不类似于样本）多少？ 🔍 🉑 🤸🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="考虑一种您的机器学习模型可能一文不值的情况。 

 有句俗话： “不要把苹果和桔子相提并论 。 ” 但是，如果您需要将一组苹果与橙子与另一组苹果进行比较，但是两组水果的分配不同，该怎么办呢？ 您可以使用数据吗？ 您将如何做？ 


 在实际情况下，这种情况很常见。 在开发机器学习模型时，我们会遇到这...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>用于模型训练的数据（不类似于样本）多少？</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422185/"> 考虑一种您的机器学习模型可能一文不值的情况。 <br><br> 有句俗话： <i>“不要把苹果和桔子相提并论</i> 。 <i>”</i> 但是，如果您需要将一组苹果与橙子与另一组苹果进行比较，但是两组水果的分配不同，该怎么办呢？ 您可以使用数据吗？ 您将如何做？ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lt/0y/oi/lt0yoiaq5fua0l1gfpguoigfxfa.png"></div><a name="habracut"></a><br> 在实际情况下，这种情况很常见。 在开发机器学习模型时，我们会遇到这样的情况，即我们的模型在训练集中可以很好地工作，但是模型的质量在测试数据上急剧下降。 <br><br> 这与再培训无关。 假设我们建立了一个模型，该模型在交叉验证中给出了出色的结果，但是在测试中却显示出了差的结果。 因此，在测试样本中有一些我们没有考虑的信息。 <br><br> 想象一下我们预测商店中顾客行为的情况。 如果训练样本和测试样本如下图所示，这是一个明显的问题： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vk/ki/j2/vkkij2n5rlshttroh8mqfse-zf4.png"></div><br>  <i>在此示例中，模型在属性“客户年龄”的平均值低于测试中类似属性的平均值的数据上训练。</i>  <i>在学习过程中，模型从未“看到”“ age”属性的较大值。</i>  <i>如果年龄是模型的重要特征，则不应期望测试样品获得良好的结果。</i> <br><br> 在本文中，我们将讨论“天真的”方法，这些方法使我们能够识别并消除这些现象。 <br><br><h3> 协变移位 </h3><br> 让我们对这个概念给出更准确的定义。  <b>协方差</b>是指特征值， <b>协方差移位</b>是指训练样本和测试样本中的特征值分布具有不同特征（参数）的情况。 <br><br> 在具有大量变量的实际问题中，协变量偏移难以检测。 本文讨论了用于识别以及说明数据中协变偏移的方法。 <br><br><img src="https://habrastorage.org/webt/no/ta/lj/notaljh1r3c8nimkt45_lp3yyco.png"><br><br><h3> 主要思想 </h3><br>  <i>如果数据发生偏移，则在将两个样本混合时，我们可以构建一个分类器，以确定对象是否属于训练样本或测试样本。</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pw/v-/42/pwv-42li1_tl9jqyghnph6czcsg.png"></div><br> 让我们了解为什么会这样。 让我们以客户为例，年龄是培训和测试样本的“转变”标志。 如果我们采用分类器（例如，基于随机森林）并尝试将混合样本分为训练和测试，那么年龄将是此类分类的一个非常重要的标志。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/j1/29/wf/j129wfqmbguam_2axs1h6liyt4e.png"></div><br><h3> 实作 </h3><br> 让我们尝试将描述的想法应用于真实数据集。 使用Kaggle竞赛中的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">数据集</a> 。 <br><br><h4> 步骤1：资料准备 </h4><br> 首先，我们将遵循一系列标准步骤：清洁，填入空白处，对分类标志进行标签编码。 所需数据集无需执行任何步骤，因此请跳过其描述。 <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-comment"><span class="hljs-comment">#  train  test train = pd.read_csv('train.csv',low_memory=True) test = pd.read_csv('test.csv',low_memory=True)</span></span></code> </pre> <br><h4> 步骤2：添加数据源指示器 </h4><br> 有必要向数据集的两个部分（培训和测试）添加新的指标指标。 对于值为“ 1”的训练样本，对于测试，分别为“ 0”。 <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#    ,   test,   train test['is_train'] = 0 train['is_train'] = 1</span></span></code> </pre><br><h4> 步骤3：结合学习样本和测试样本 </h4><br> 现在，您需要组合两个数据集。 由于训练数据集包含目标值“ target”的列，该列不在测试数据集中，因此必须删除此列。 <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#  train, test df_combine = pd.concat([train, test], axis=0, ignore_index=True) #  target df_combine = df_combine.drop('target', axis =1) y = df_combine['is_train'].values #  x = df_combine.drop('is_train', axis=1).values #  tst, trn = test.values, train.values</span></span></code> </pre><br><h4> 步骤4：建立和测试分类器 </h4><br> 为了进行分类，我们将使用“随机森林分类器”，将其配置为预测组合数据集中数据源的标签。 您可以使用任何其他分类器。 <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.ensemble <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> RandomForestClassifier <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np rfc = RandomForestClassifier(n_jobs=<span class="hljs-number"><span class="hljs-number">-1</span></span>, max_depth=<span class="hljs-number"><span class="hljs-number">5</span></span>, min_samples_leaf = <span class="hljs-number"><span class="hljs-number">5</span></span>) predictions = np.zeros(y.shape) <span class="hljs-comment"><span class="hljs-comment">#    </span></span></code> </pre><br> 我们使用4层分层随机分组。 这样，我们将像原始合并的样本一样，保持每个折叠中“ is_train”标签的比率。 对于每个分区，我们在大部分分区上训练分类器，并为较小的递延部分预测分类标签。 <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.model_selection <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> StratifiedKFold, cross_val_score skf = StratifiedKFold(n_splits=<span class="hljs-number"><span class="hljs-number">4</span></span>, shuffle=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, random_state=<span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> fold, (train_idx, test_idx) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(skf.split(x, y)): X_train, X_test = x[train_idx], x[test_idx] y_train, y_test = y[train_idx], y[test_idx] rfc.fit(X_train, y_train) probs = rfc.predict_proba(X_test)[:, <span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-comment"><span class="hljs-comment">#   predictions[test_idx] = probs</span></span></code> </pre><br><h4> 步骤5：解释结果 </h4><br> 我们为分类器计算ROC AUC指标的值。 基于此值，我们得出结论，我们的分类器显示数据的协变程度如何。 <br><br>  <i>如果分类器c将对象很好地分为训练和测试数据集，则ROC AUC度量的值应显着大于0.5，理想情况下应接近1。此图表明数据中有很强的协变偏移。</i> <br><br> 查找ROC AUC的值： <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.metrics <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> roc_auc_score print(<span class="hljs-string"><span class="hljs-string">'ROC-AUC:'</span></span>, roc_auc_score(y_true=y, y_score=predictions)) <span class="hljs-comment"><span class="hljs-comment"># ROC-AUC: 0.49974692698385287</span></span></code> </pre><br> 结果值接近0.5。 这意味着我们的质量分类器与随机标签预测器相同。 没有证据表明数据发生了协变。 <br><br> 由于数据集来自Kaggle，因此结果是可以预料的。 与其他机器学习竞赛一样，对数据进行仔细验证以确保不发生任何变化。 <br><br> 但是，这种方法可以应用到数据科学的其他问题中，以在解决方案开始之前检查是否存在协变偏移。 <br><br><h2> 进一步的步骤 </h2><br> 因此，我们是否观察到协变偏移。 如何提高测试中模型的质量？ <br><br><ol><li> 删除有偏见的功能 </li><li> 根据密度系数估算值使用对象重要性权重 </li></ol><br><h3> 删除有偏差的功能： </h3><br>  <i><b>注意：</b>如果数据存在协变偏移，则<b>该</b>方法适用。</i> <br><br><ul><li> 从我们之前构建和训练的随机森林分类器中提取属性的重要性。 </li><li> 最重要的标志恰好是那些有偏见并导致数据移位的标志。 </li><li> 首先从最重要的角度出发，一次删除，构建目标模型并查看其质量。 收集所有不会降低模型质量的标志。 </li><li> 丢弃数据中收集的特征并建立最终模型。 </li></ul><br><img src="https://habrastorage.org/webt/oa/ga/08/oaga08t43dtyoazhcor8bk3mb8w.png"><br>  <i>该算法允许您从图中的红色篮子中删除符号。</i> <br><br><h3> 根据密度系数估算值使用对象重要性权重 </h3><br>  <i><b>注意：</b>无论数据中是否存在协变移位，该方法均适用。</i> <br><br> 让我们看看上一节中收到的预测。 对于每个对象，预测都包含该对象属于我们的分类器训练集的概率。 <br><br><pre> <code class="python hljs">predictions[:<span class="hljs-number"><span class="hljs-number">10</span></span>] <span class="hljs-comment"><span class="hljs-comment">#array([0.39743827 ...</span></span></code> </pre><br> 例如，对于第一个对象，我们的随机森林分类器认为它属于训练集，概率为0.397。 叫这个值 <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x706B;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x8F66;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.456ex" height="2.298ex" viewBox="0 -780.1 4071.4 989.6" role="img" focusable="false" style="vertical-align: -0.487ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhgYsGbx6y0qnmvC-F9thFhhHA_54A#MJMATHI-50" x="0" y="0"></use><g transform="translate(751,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><g transform="translate(1581,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">火</text></g><g transform="translate(2411,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">车</text></g><g transform="translate(3241,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>火</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>车</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow></math></span></span><script type="math/tex" id="MathJax-Element-1"> P（火车）</script>  。 或者我们可以说属于测试数据的概率为0.603。 同样，我们称概率 <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x6D4B;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x8BD5;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.456ex" height="2.298ex" viewBox="0 -780.1 4071.4 989.6" role="img" focusable="false" style="vertical-align: -0.487ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhgYsGbx6y0qnmvC-F9thFhhHA_54A#MJMATHI-50" x="0" y="0"></use><g transform="translate(751,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><g transform="translate(1581,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">测</text></g><g transform="translate(2411,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">试</text></g><g transform="translate(3241,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>测</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>试</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow></math></span></span><script type="math/tex" id="MathJax-Element-2"> P（测试）</script>  。 <br><br> 现在有一个小技巧：对于训练数据集的每个对象，我们计算系数 <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>w</mi><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x6D4B;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x8BD5;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x706B;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x8F66;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28.82ex" height="2.419ex" viewBox="0 -780.1 12408.4 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhgYsGbx6y0qnmvC-F9thFhhHA_54A#MJMATHI-77" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhgYsGbx6y0qnmvC-F9thFhhHA_54A#MJMAIN-3D" x="994" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhgYsGbx6y0qnmvC-F9thFhhHA_54A#MJMATHI-66" x="2300" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhgYsGbx6y0qnmvC-F9thFhhHA_54A#MJMATHI-72" x="2851" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhgYsGbx6y0qnmvC-F9thFhhHA_54A#MJMATHI-61" x="3302" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhgYsGbx6y0qnmvC-F9thFhhHA_54A#MJMATHI-63" x="3832" y="0"></use><g transform="translate(4265,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhgYsGbx6y0qnmvC-F9thFhhHA_54A#MJMATHI-50" x="0" y="0"></use><g transform="translate(751,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><g transform="translate(1581,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">测</text></g><g transform="translate(2411,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">试</text></g><g transform="translate(3241,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g></g><g transform="translate(8336,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhgYsGbx6y0qnmvC-F9thFhhHA_54A#MJMATHI-50" x="0" y="0"></use><g transform="translate(751,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><g transform="translate(1581,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">火</text></g><g transform="translate(2411,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">车</text></g><g transform="translate(3241,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>w</mi><mo>=</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>P</mi><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>测</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>试</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow></mrow><mrow class="MJX-TeXAtom-ORD"><mi>P</mi><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>火</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>车</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow></mrow></math></span></span><script type="math/tex" id="MathJax-Element-3"> w = \ frac {P（测试）} {P（火车）} </script>  。 <br><br> 系数 <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>w</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.664ex" height="1.455ex" viewBox="0 -520.7 716.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhgYsGbx6y0qnmvC-F9thFhhHA_54A#MJMATHI-77" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>w</mi></math></span></span><script type="math/tex" id="MathJax-Element-4"> w </script> 告诉我们距离训练集中的对象距测试数据有多近。 主要思想： <br><br>  <i>我们可以使用</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>w</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.664ex" height="1.455ex" viewBox="0 -520.7 716.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhgYsGbx6y0qnmvC-F9thFhhHA_54A#MJMATHI-77" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>w</mi></math></span></span><script type="math/tex" id="MathJax-Element-5"> w </script></i>   <i>像任何模型中的权重一样，以增加看起来类似于测试样本的那些观测值的权重。</i>  <i>直观上讲，这是有道理的，因为我们的模型将像测试套件中那样更加面向数据。</i> <br><br> 可以使用以下代码计算这些权重： <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> seaborn <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> sns <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> matplotlib.pyplot <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> plt plt.figure(figsize=(<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>)) predictions_train = predictions[:len(trn)] weights = (<span class="hljs-number"><span class="hljs-number">1.</span></span>/predictions_train) - <span class="hljs-number"><span class="hljs-number">1.</span></span> weights /= np.mean(weights) <span class="hljs-comment"><span class="hljs-comment">#  plt.xlabel('  w') plt.ylabel(' ') sns.distplot(weights, kde=False)</span></span></code> </pre><br> 可以将获得的系数转移到模型中，例如，如下所示： <br><br><pre> <code class="python hljs">rfc = RandomForestClassifier(n_jobs=<span class="hljs-number"><span class="hljs-number">-1</span></span>,max_depth=<span class="hljs-number"><span class="hljs-number">5</span></span>) m.fit(X_train, y_train, sample_weight=weights)</code> </pre><br><br><img src="https://habrastorage.org/webt/_z/nw/rn/_znwrn70amqpw4xosahu1hgj6oa.png"><br><br> 关于结果直方图的几句话： <br><br><ul><li> 较大的重量值对应于更类似于测试样品的观察值。 </li><li> 训练集中几乎70％的对象的权重接近1，因此位于与训练集和测试集相似的子空间中。 这对应于我们之前计算的AUC值。 </li></ul><br><h2> 结论 </h2><br> 我们希望这篇文章能帮助您识别数据中的“协变偏移”并加以应对。 <br><br><h2> 参考文献 </h2><br>  [1] Shimodaira，H.（2000）。 通过加权对数似然函数来改善协变量偏移下的预测推理。 统计计划与推断杂志，90，227-244。 <br>  [2] Bickel，S.等。  （2009）。 协变量移位下的判别学习。 机器学习研究杂志，10，2137–2155 <br>  [3] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github.com/erlendd/covariate-shift-adaption</a> <br>  [4] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">链接到使用的数据集</a> <br><br>  PS：带有本文代码的笔记本电脑可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>查看。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN422185/">https://habr.com/ru/post/zh-CN422185/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN422175/index.html">环境污染降低了人类的认知能力</a></li>
<li><a href="../zh-CN422177/index.html">为什么Arduino这么慢，该怎么办</a></li>
<li><a href="../zh-CN422179/index.html">从云到地球：如何在任何环境中创建生产级Kubernetes</a></li>
<li><a href="../zh-CN422181/index.html">如何在一个在线平台上收集公司服务：MegaFon的历史。</a></li>
<li><a href="../zh-CN422183/index.html">那又便宜吗？</a></li>
<li><a href="../zh-CN422187/index.html">Sberseasons：我今年夏天过得如何</a></li>
<li><a href="../zh-CN422189/index.html">关于Intranet门户实施的真相</a></li>
<li><a href="../zh-CN422191/index.html">我如何创建有利可图的Android文本识别应用程序</a></li>
<li><a href="../zh-CN422195/index.html">ACS在采矿中的使用</a></li>
<li><a href="../zh-CN422197/index.html">我们谈谈继电器</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>