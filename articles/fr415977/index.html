<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ¾â€âš–ï¸ ğŸ’š ğŸ‘©ğŸ½â€ğŸ¤â€ğŸ‘¨ğŸ» Tunnels et VPN rÃ©sistants au DPI ğŸ’· â¿ ğŸ£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nous vivons Ã  une Ã©poque intÃ©ressante. Je dirais mÃªme de faÃ§on Ã©tonnante. D'un cÃ´tÃ©, nous voyons des gens qui veulent vraiment savoir ce que les autre...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tunnels et VPN rÃ©sistants au DPI</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415977/"> Nous vivons Ã  une Ã©poque intÃ©ressante.  Je dirais mÃªme de faÃ§on Ã©tonnante.  D'un cÃ´tÃ©, nous voyons des gens qui veulent vraiment savoir ce que les autres se parlent et veulent vraiment leur dire ce qui peut Ãªtre lu et ce qui ne peut pas Ãªtre lu.  D'autre part, les citoyens qui veulent faire valoir leurs droits aux secrets de la correspondance personnelle et des informations gratuites, et ne veulent pas que les faits de cette correspondance et la rÃ©ception de ces informations soient utilisÃ©s contre eux.  Un grand nombre de sites, services et entreprises tiers touchÃ©s par des Â«serrures de tapisÂ» souffrent en prime. <br><br>  Mais non, cet article n'est pas sur la sociÃ©tÃ©, mais sur la technologie. <br><br><img src="https://habrastorage.org/webt/ai/x5/4v/aix54v5uoghgxq1dmmisvj-brke.jpeg" alt="image"><br><a name="habracut"></a><br>  La culture technique des gens, grÃ¢ce Ã  tout ce qui se passe, se dÃ©veloppe Ã©galement.  Si auparavant les mots Â«VPNÂ» et Â«mandatairesÂ» n'Ã©taient familiers qu'aux informaticiens, maintenant mÃªme les femmes au foyer les connaissent, et en plus, elles utilisent ce que ces mots signifient. <br><br>  En gÃ©nÃ©ral, les nouvelles sont rÃ©cemment devenues assez divertissantes.  Par exemple, la fourniture de services VPN et similaires pour crypter le trafic et contourner les verrous est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dÃ©sormais punissable</a> , et en Chine, ils les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">emprisonnent</a> gÃ©nÃ©ralement pour cela.  Et il n'y a pas si longtemps, ILV a commencÃ© Ã  utiliser l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">analyse de paquets pour bloquer</a> le protocole MTProxy.  Vous pouvez Ã©galement vous rÃ©fÃ©rer Ã  l'expÃ©rience des autres pays qui rÃ©ussissent le mieux dans ces domaines: Chine, Iran, Kazakhstan, Venezuela.  Au Venezuela, par exemple, ils <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bloquent</a> directement les connexions directes Ã  Tor et le trafic obscurci vers les ponts.  Sur la base de tout cela, nous pouvons supposer que l'avenir nous attend est Ã©galement trÃ¨s intÃ©ressant, surtout si les "personnes responsables" cessent de faire de la fakapy stupide encore et encore, et agissent plus intelligemment et plus sophistiquÃ©es. <br><br>  Sur HabrÃ©, Ã  plusieurs reprises dans les commentaires, des prÃ©visions ont Ã©tÃ© exprimÃ©es sur la faÃ§on dont la lutte avec les technologies de cryptage pour les citoyens ordinaires peut se poursuivre.  En analysant les pensÃ©es exprimÃ©es et en examinant les tÃ©moignages d'autres pays, j'ai essayÃ© de suggÃ©rer dans quelle direction les mesures visant Ã  limiter la communication pourraient aller plus loin.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">DistortNeo</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">shifttstas</a> ont <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">proposÃ©</a> des idÃ©es plus intÃ©ressantes et j'ai <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">finalement</a> promis Ã  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">el777 d'</a> ajouter cet article. <br><br>  Avec les filtres ACL, tout est clair.  Ils agissent maintenant, et avec plus ou moins de succÃ¨s, ils rÃ©ussissent et Ã©chouent Ã  se battre (bien qu'il y ait des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">prÃ©visions</a> assez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pessimistes</a> ).  DPI est plus intÃ©ressant. <br><br>  Les mÃ©thodes de "dÃ©termination" du type de trafic pour DPI peuvent Ãªtre divisÃ©es en deux groupes: <br><br><ul><li>  Analyse de signature.  Ã€ savoir, dÃ©monter l'emballage "par les os", comparer les en-tÃªtes et la structure avec les Ã©chantillons, et ainsi dÃ©terminer son objectif.  Ainsi, de nombreux tunnels sont dÃ©tectÃ©s, par exemple, OpenVPN, L2TP / IPSec, SOCKS, etc. </li><li>  Une analyse prÃ©liminaire des modÃ¨les d'Ã©change de trafic, par exemple, le rapport du flux entrant / sortant, la frÃ©quence de la demande-rÃ©ponse et d'autres critÃ¨res nous permettra de sÃ©parer le Â«trafic rÃ©elÂ» d'un protocole et le tunnel qui se fait uniquement passer pour un protocole. </li></ul><br><img src="https://habrastorage.org/webt/xj/a3/ny/xja3nye4iqnsser5zm2gxgbcjbq.jpeg" alt="image"><br><br>  Vous pouvez rÃ©partir le trafic en plusieurs groupes et supposer ce qu'ils feront avec chacun d'eux. <br><br><ol><li>  <b>VPN, tunnels et mandataires Â«explicitesÂ» (OpenVPN, L2TP / IPSec, SOCKS, etc.)</b> Les VPN et tunnels ordinaires peuvent trÃ¨s bien Ãªtre bloquÃ©s automatiquement, comme cela se produit par exemple en Chine et au Venezuela.  Si certaines organisations ou entreprises en ont besoin pour travailler, laissez-les s'inscrire et certifier, comme le dit tout particuliÃ¨rement la loi russe mentionnÃ©e ci-dessus.  Avec un proxy, il est encore plus facile - que HTTP, que SOCKS transmette les adresses et les contenus en texte clair, ce qui ne pose gÃ©nÃ©ralement pas de problÃ¨me pour la Â«coupeÂ» sÃ©lective des demandes et l'Ã©coute Ã©lectronique des informations transmises. </li><li>  <b>Technologies Ã  double usage telles que SSH</b> .  Peu de temps aprÃ¨s l'Ã©tablissement de la session, la vitesse est rÃ©duite Ã  une tortue, de sorte que vous pouvez toujours travailler au moins d'une maniÃ¨re ou d'une autre dans la console, mais il n'y a plus de navigation et de tÃ©lÃ©chargement.  Le fait que cela crÃ©e des problÃ¨mes pendant le travail normal ne dÃ©range personne (ce qui nous a Ã©tÃ© montrÃ© plus d'une fois par ILV ces derniers temps). </li><li>  <b>Protocoles trÃ¨s spÃ©cifiques, tels que messagers, clients de jeux, etc.</b> </li><li>  <b>ComposÃ©s dont le type ne peut Ãªtre dÃ©terminÃ©</b> . </li></ol><br>  Pour les Ã©lÃ©ments 3 et 4, des Â«listes blanchesÂ» sont tout Ã  fait possibles (dans lesquelles, par exemple, des sous-rÃ©seaux de serveurs de jeu officiels ou des messagers Â«correctsÂ» sont entrÃ©s, et tout ce que les propriÃ©taires de serveurs veulent dÃ©clarer et organiser selon les besoins afin qu'ils ne soient pas touchÃ©s, par analogie avec celles que ILV possÃ¨de dÃ©jÃ  pour les domaines et les adresses IP).  Et ceux qui ne figurent pas dans ces listes seront confrontÃ©s au mÃªme sort que le paragraphe 1 ou le paragraphe 2, bien qu'il soit tout Ã  fait possible de ne pas bloquer ou couper carrÃ©ment la vitesse, mais d'analyser les modÃ¨les d'Ã©change prÃ©cÃ©demment mentionnÃ©s afin de dÃ©terminer si le trafic est Â«purÂ» "Ou" suspect. " <br><br>  Autrement dit, si vous voulez vous dÃ©guiser en protocoles spÃ©ciaux, ou pour obscurcir les connexions afin qu'il soit impossible de dÃ©terminer leur type, vous devrez Ã©galement prendre soin de crÃ©er du "bruit" qui empÃªche la dÃ©tection de vÃ©ritables modÃ¨les d'Ã©change.  Jusqu'Ã  prÃ©sent, de tels dÃ©veloppements ne m'ont pas traversÃ© les yeux. <br><br>  Vous ne vous souvenez mÃªme pas des diffÃ©rents tunnels ICMP et DNS - une grande quantitÃ© de trafic Â«lÃ  oÃ¹ ils nâ€™en sont pas nÃ©cessairesÂ» soulÃ¨ve automatiquement des soupÃ§ons. <br><br>  5. <b>TLS et SSL, HTTPS</b> .  Il est impossible de couper net, car cela signifie automatiquement bloquer tout Internet.  L'analyse de modÃ¨le n'a pas de sens, car la navigation sur le Web n'est que l'objectif principal de l'utilisation de HTTPS.  De tout ce qui prÃ©cÃ¨de, SSL / TLS sur le port 443 ressemble Ã  l'option la plus Â«sans mÃ©fianceÂ» et la plus fiable.  Par consÃ©quent, essayons de nous dÃ©guiser en lui. <br><br><img src="https://habrastorage.org/webt/sj/3u/2z/sj3u2zoggi2ofngemk1maytasyw.jpeg" alt="image"><br><br><h3>  Se dÃ©guiser </h3><br>  Pour examen, il a Ã©tÃ© dÃ©cidÃ© de choisir les solutions Streisand et SoftEther. <br><br>  <a href="" rel="nofollow">Streisand</a> - un ensemble complet de services diffÃ©rents: OpenConnect / AnyConnect, OpenVPN, stunnel, Shadowsocks, WireGuard.  Tout cela est dÃ©fini en mode Â«clÃ© en mainÂ» automatique ou semi-automatique, et Ã  la sortie, l'utilisateur reÃ§oit un serveur configurÃ©, ainsi que des fichiers et une documentation dÃ©taillÃ©e pour la configuration des clients. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">SoftEther</a> est un serveur VPN qui peut lever L2TP / IPsec, OpenVPN, SSTP et d'autres protocoles, et possÃ¨de Ã©galement son propre protocole SSL-VPN, qui, selon les auteurs, ne se distingue pas du trafic HTTPS normal. <br><br>  Alors ... <br><br>  <b>OpenConnect / AnyConnect.</b>  ImplÃ©mentation open source du protocole SSL Cisco AnyConnect.  Lorsqu'une connexion est Ã©tablie, non seulement les paquets TLS (TCP), mais aussi les paquets DTLS (UDP) sont visibles.  DTLS, en principe, est Ã©galement beaucoup utilisÃ© "Ã  des fins pacifiques", mais ce n'est pas du tout comme "HTTPS normal".  Cependant, si vous coupez le trafic UDP sur le pare-feu, AnyConnect bascule immÃ©diatement vers TCP et de l'extÃ©rieur ressemble, encore une fois, complÃ¨tement et complÃ¨tement au TLS normal, et mÃªme l'authentification Ã  l'intÃ©rieur du tunnel cryptÃ© est presque comme dans HTTP. <br><br>  <b>Shadowsocks</b> .  Proxy SOCKS cryptÃ©.  Apparemment, si vous le souhaitez, il <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">peut Ãªtre dÃ©tectÃ©</a> , cependant, il existe des plugins qui le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">dÃ©guisent en Â«HTTPS purÂ»</a> .  Il existe Ã©galement un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">plugin</a> pour travailler via les websockets, mais plus Ã  ce sujet plus tard. <br><br>  <b>Wireguard</b>  Ã€ en juger par la description, il dispose d'un cryptage bien tordu et d'un mÃ©canisme de configuration de session, mais toutes les communications se font via UDP.  Wireshark dÃ©finit le type de packages comme quelque chose de complÃ¨tement inaudible, et quelle opinion de ce qui se passe avec un DPI tiers est une trÃ¨s, trÃ¨s grande question.  <b>Mise Ã  jour: les</b> versions plus rÃ©centes dÃ©finissent Wireguard uniquement comme Wireguard, donc la rÃ©ponse Ã  la question est Ã©vidente. <br><br>  <b>obfs3, obfs4</b> .  Les paquets seront obscurcis de sorte que de l'extÃ©rieur, ils ressemblent Ã  un ensemble de valeurs complÃ¨tement alÃ©atoire.  Autrement dit, ils relÃ¨vent du point 4 de la liste ci-dessus. <br><br>  <b>SoftEther</b>  Il ressemble Ã  HTTPS, mais avec une prise.  En plus de TLS directement sur TCP, il envoie activement des paquets de paquets UDP.  Comme cela a Ã©tÃ© dÃ©couvert dans la documentation, UDP peut Ãªtre utilisÃ© pour accÃ©lÃ©rer le transfert de donnÃ©es dans le cas oÃ¹ il n'est pas tuÃ© sur le pare-feu.  Cette fonctionnalitÃ© est dÃ©sactivÃ©e dans la configuration et une fois dÃ©sactivÃ©e, tout devient comme il se doit. <br><br>  <b>SSTP</b> .  VPN prokotol de Microsoft.  Prise en charge native sur Windows, prise en charge des logiciels sur GNU / Linux.  De l'extÃ©rieur, cela ressemble Ã  HTTPS, et Wireshark le confirme pleinement. <br><br><h3>  Mais ce n'est pas tout </h3><br>  Supposons que vous ayez installÃ© un serveur VPN ou l'extrÃ©mitÃ© d'un tunnel sur un hÃ´te et que vous l'ayez configurÃ© pour Ã©couter sur le port 443.  Il semblerait que tout va bien, mais il y en a un MAIS: si nous nous dÃ©guisons en HTTPS, vous pouvez vÃ©rifier qu'en fait il se bloque sur le port 443 simplement en essayant de vous enterrer dans ce port avec un simple navigateur ou CURL, ou de toute autre maniÃ¨re.  Dans certains articles, une telle mÃ©thode est appelÃ©e "connexion de plomb" et, comme mentionnÃ©, est dÃ©jÃ  assez utilisÃ©e en Chine. <br><br>  Par consÃ©quent, nous avons besoin que sur le 443e port, nous ayons le serveur Web le plus ordinaire et le plus dÃ©cent.  Et ici se pose un problÃ¨me intÃ©ressant. <br><br>  Aucun des services ci-dessus dans la documentation principale n'a trouvÃ© de description du mÃ©canisme de fonctionnement du partage de port.  L' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">option SSLH</a> ne convient pas, ne serait-ce que parce que sslh n'est pas en mesure de partager le trafic entre HTTPS et les services ci-dessus.  Au moins, parce que si le type de trafic sans dÃ©cryptage complet pouvait distinguer sslh, alors DPI serait en mesure de le faire. <br><br>  La plupart des hommes, comme <a href="" rel="nofollow">celui-ci</a> , suggÃ¨rent d'utiliser l'indication de nom de serveur (SNI) - une extension TLS qui vous permet de spÃ©cifier un nom d'hÃ´te, puis d'utiliser HAProxy, sniproxy et d'autres outils pour disperser les connexions pour les services.  Le problÃ¨me est que dans les implÃ©mentations TLS modernes, le nom d'hÃ´te spÃ©cifiÃ© lors de l'utilisation de SNI est transmis en texte brut, c'est-Ã -dire sous forme non chiffrÃ©e, et, par consÃ©quent, peut Ã©galement Ãªtre espionnÃ© et utilisÃ© Ã  l'avenir. <br><br>  Par consÃ©quent, nous allons improviser, puis deux options me sont venues Ã  l'esprit. <br><br><h4>  Coup de port </h4><br><img src="https://habrastorage.org/webt/54/_n/v7/54_nv7qxgj4idvoek-ooxn6r6ju.jpeg" alt="image"><br><br>  Le dÃ©tournement de port est juste conÃ§u pour activer des "services cachÃ©s" sur le serveur.  Par exemple, d'une maniÃ¨re similaire, le port sur lequel le dÃ©mon SSH se bloque est souvent fermÃ© "pour" afin d'Ã©viter la force brute et l'utilisation de vulnÃ©rabilitÃ©s 0-day.  Dans la version classique (voir, par exemple, l'implÃ©mentation du dÃ©mon knockd), le knocking est gÃ©nÃ©ralement compris comme des tentatives d'Ã©tablir une connexion ou d'envoyer des paquets Ã  certains ports hÃ´tes dans une certaine sÃ©quence, Ã  la suite de quoi le dÃ©mon vous Â«reconnaÃ®tÂ» comme lui-mÃªme et active une rÃ¨gle de pare-feu qui permet d'accÃ©der Ã  un port spÃ©cifique uniquement Ã  partir de votre IP. <br><br>  Dans notre cas, cette option n'est pas entiÃ¨rement acceptable.  PremiÃ¨rement, les ports Â«non standardÂ» eux-mÃªmes peuvent Ãªtre bloquÃ©s quelque part en cours de route, et deuxiÃ¨mement, la procÃ©dure elle-mÃªme, lorsqu'elle est analysÃ©e de l'extÃ©rieur, peut sembler suspecte.  Puisque nous nous faisons passer pour HTTPS, nous devons Â«frapperÂ» sur HTTPS. <br><br>  Ã‰tonnamment, il n'y avait pas de heurteurs HTTP / HTTPS avec la fonctionnalitÃ© requise, et donc un nocker est nÃ© avec le nom romantique <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Labean</a> (hussards, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">tais-toi</a> !). <br><br>  Ã‰lÃ©ments fournis: notre serveur, sur lequel Nginx s'exÃ©cute sur le port 443 avec des certificats correctement configurÃ©s et affiche du contenu complÃ¨tement inoffensif, par exemple, des GIF avec des chats, des images ISO de distributions GNU / Linux ou un miroir Wikipedia et une bibliothÃ¨que Moshkov. <br><br>  En mÃªme temps, les lignes du formulaire se cachaient dans la configuration Nginx <br><br><pre><code class="nginx hljs"> <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> <span class="hljs-regexp"><span class="hljs-regexp">~ ^/somesecret/(.*)</span></span> {
    <span class="hljs-attribute"><span class="hljs-attribute">auth_basic</span></span>      <span class="hljs-string"><span class="hljs-string">"Administrator Login"</span></span>;
    <span class="hljs-attribute"><span class="hljs-attribute">auth_basic_user_file</span></span>  /var/www/.htpasswd;
    <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span>  X-Real-IP  <span class="hljs-variable"><span class="hljs-variable">$remote_addr</span></span>;
    <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://127.0.0.1:8080/<span class="hljs-variable"><span class="hljs-variable">$1</span></span>;
  }
</code></pre><br>
      ,       CURL'   <br>
<code>https://ourserver.org/somesecret/vpn/on</code><br>
  ,   ,     ,           IP-,  - <br>
<code>iptables -t nat -A PREROUTING -p tcp -s {clientIP} --dport 443 -j REDIRECT --to-port 4443</code><br>
    .<br>
<br>
  N  (,   )  ,    ,        ,         IP       .<br>
<br>
     ,    ,  URL   ,   /off  .<br>
<br>
       ,     IPv6 (v6-    X-Real-IP  ).<br>
<br>
   Go,    ,   ,    . ,      nginx  init-    Gihub:<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">https://github.com/uprt/labean</a><br>
<br>
<h4>Websockets</h4><br>
<img src="https://habrastorage.org/webt/as/nw/yn/asnwynceu_p8gghmcgf13e3ryiq.jpeg" alt="image"><br>
<br>
     :      HTTPS â€”    .  Web-         TCP    ,    Websocket (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">RFC 6455</a>).    HTTP-,      ,             TCP-.  , ,       HTTPS       .<br>
<br>
      WS  ,  - â€”    ,     CDN, , Cloudflare    .  ,        :    IP  CDN/proxy          CDN,          VPN/proxy   CDN,       .<br>
<br>
 WS-   (    Haskell),     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">wstunnel</a>,   nodejs   ,       .<br>
<br>
       .       wss://-, <br>
<br>
<pre><code class="bash hljs">wstunnel -t 33 wss://server:443</code></pre><br>
   ,  Â«Â» ws-      Â«Â» .   wstunnel,    ,      URI    -  :<br>
<br>
<pre><code class="bash hljs">wstunnel -t 33 wss://ourserver.org:443/hiddenws/</code></pre><br>
  :     <br>
<br>
   ,    443   Nginx c -  . <br>
<br>
    proxy-   Websockets-:<br>
<br>
<pre><code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">location</span></span> /hiddenws {
    <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://127.0.0.1:8081;
    <span class="hljs-attribute"><span class="hljs-attribute">proxy_http_version</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>;
    <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Upgrade <span class="hljs-variable"><span class="hljs-variable">$http_upgrade</span></span>;
    <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Connection <span class="hljs-string"><span class="hljs-string">"Upgrade"</span></span>;
  }</code></pre><br>
        websockets-.        SOCKS- (, Dante),  OpenVPN, ,   ,    .<br>
<br>
<div class="spoiler"><b class="spoiler_title"> selinux</b><div class="spoiler_text">   RHEL  ,   SELinux,    nginx   <br>
<code>2018/07/05 13:28:03 [crit] 7724#0: *11 connect() to 127.0.0.1:8081 failed (13: Permission denied) while connecting to upstream, client: IP_ADDRES, server: _, request: Â«GET /hiddenws/?dst=localhost:22 HTTP/1.1Â», upstream: Â«127.0.0.1:8081/hiddenws/?dst=localhost:22Â»,</code><br>
<br>
        :<br>
<br>
<pre><code class="bash hljs">semanage port -a -t http_port_t -p tcp 22
semanage port -m -t http_port_t -p tcp 22
semanage port -a -t http_port_t -p tcp 8081</code></pre><br>
<br>
 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Renatk</a>        .<br>
</div></div><br>
<br>
    â€”   SOCKS-  VPN-       wstunnel,           Â«Â» .<br>
<br>
 ,   v2ray  shadowcocks,   websockets    shadowsocks.    : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">https://github.com/shadowsocks/v2ray-plugin</a><br>
<br>
<h3> </h3><br>
 â€”   VPN- -   MTU,  1400;<br>
 â€”   VPN- 2 IP-.        VPN/,       ;<br>
 â€”  Â«Â» IP-   ,    ICMP ping;<br>
 â€”     -  reverse DNS ,     -, , gateway-001.somehomeisp.net;<br>
 â€”      VPN/  DNS- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"> OpenNIC</a>;<br>
         (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"> </a>).<br>
<br>
<h3> </h3><br>
<img src="https://habrastorage.org/webt/dz/mp/tf/dzmptf35twb-e_wzib77grk3ksq.jpeg" alt="image"><br>
<br>
      - ,     â€”  .     ,   ,   â€”   ,    ,   . ,   HTTPS      â€” ,     ,    -    Â«   Â»/   /etc.,  ,      Â« Â»,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   </a>. <br>
<br>
 ,  ,   ,            ,     â€”  ,   ,    ,   . <br>
 .</div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr415977/">https://habr.com/ru/post/fr415977/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr415965/index.html">Ã€ lire en juillet: 19 nouveaux livres pour les professionnels du numÃ©rique</a></li>
<li><a href="../fr415967/index.html">SolidFire - Stockage pour ces ** cking hate stockage</a></li>
<li><a href="../fr415969/index.html">HyperX Pulsefire Surge RGB - un tueur nÃ© naturel</a></li>
<li><a href="../fr415973/index.html">Comment ne pas casser le cluster Apache Ignite dÃ¨s le dÃ©but</a></li>
<li><a href="../fr415975/index.html">Les Chinois ont prÃ©sentÃ© un pistolet laser d'une portÃ©e de prÃ¨s d'un kilomÃ¨tre</a></li>
<li><a href="../fr415979/index.html">Security Week 24: Rowhammer sur Android et la complexitÃ© des vulnÃ©rabilitÃ©s matÃ©rielles</a></li>
<li><a href="../fr415981/index.html">Google et HTTP</a></li>
<li><a href="../fr415983/index.html">Premier univers 5. DÃ©calage cosmologique et dynamique d'un univers en expansion uniforme, partie 1</a></li>
<li><a href="../fr415987/index.html">SuperJob de rencontre QA</a></li>
<li><a href="../fr415989/index.html">Analyse de l'utilisation des signatures numÃ©riques: 10 des 15 principales crypto-monnaies ne signent pas de logiciel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>