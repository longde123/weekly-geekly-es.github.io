<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ›ŒğŸ½ ğŸ†— âš—ï¸ ä¸¤å¹´æ¥ï¼Œæˆ‘ä»¬å¼€å‘äº†ç›‘æ§ç³»ç»Ÿã€‚ ç‚¹å‡»ä»¥... âš”ï¸ ğŸ§œ ğŸ¤´ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¤§å®¶å¥½ï¼ 


 æˆ‘å·²ç»åœ¨æ­¤åšå®¢ä¸­è°ˆåˆ°äº†å¾®æœåŠ¡ä½“ç³»ç»“æ„çš„æ¨¡å—åŒ–ç›‘è§†ç³»ç»Ÿçš„ç»„ç»‡ä»¥åŠä»Graphite + Whisperåˆ°Graphite + ClickHouseçš„è¿‡æ¸¡ï¼Œä»¥åœ¨é«˜è´Ÿè½½ä¸‹å­˜å‚¨æŒ‡æ ‡ ã€‚ ä¹‹åï¼Œæˆ‘çš„åŒäº‹Sergey Noskov å†™äº†å…³äºæˆ‘ä»¬çš„ç›‘æ§ç³»ç»Ÿçš„ç¬¬ä¸€ä¸ªé“¾æ¥-ç”±æˆ‘ä»¬å¼€å‘çš„Bioyino...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä¸¤å¹´æ¥ï¼Œæˆ‘ä»¬å¼€å‘äº†ç›‘æ§ç³»ç»Ÿã€‚ ç‚¹å‡»ä»¥...</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/avito/blog/467995/"><p> å¤§å®¶å¥½ï¼ </p><br><p> æˆ‘å·²ç»åœ¨æ­¤åšå®¢ä¸­è°ˆåˆ°äº†å¾®æœåŠ¡ä½“ç³»ç»“æ„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">çš„æ¨¡å—åŒ–ç›‘è§†ç³»ç»Ÿ</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç»„ç»‡</a>ä»¥åŠ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»Graphite + Whisperåˆ°Graphite + ClickHouse</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿‡æ¸¡ï¼Œä»¥</a>åœ¨é«˜è´Ÿè½½ä¸‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å­˜å‚¨æŒ‡æ ‡</a> ã€‚ ä¹‹åï¼Œæˆ‘çš„åŒäº‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Sergey Noskov</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å†™äº†</a>å…³äºæˆ‘ä»¬çš„ç›‘æ§ç³»ç»Ÿçš„ç¬¬ä¸€ä¸ªé“¾æ¥-ç”±æˆ‘ä»¬å¼€å‘çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Bioyino</a> ï¼Œè¿™æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼å¯æ‰©å±•çš„æŒ‡æ ‡èšåˆå™¨ã€‚ </p><br><p> ç°åœ¨è¯¥åˆ·æ–°æœ‰å…³æˆ‘ä»¬å¦‚ä½•åœ¨Avitoä¸­å‡†å¤‡ç›‘è§†çš„ä¿¡æ¯äº†-æˆ‘ä»¬çš„ä¸Šä¸€ç¯‡æ–‡ç« æ—©åœ¨2018å¹´ï¼Œåœ¨æ­¤æœŸé—´ï¼Œç›‘è§†ä½“ç³»ç»“æ„ï¼Œè§¦å‘å™¨å’Œé€šçŸ¥ç®¡ç†ï¼ŒClickHouseä¸­çš„å„ç§æ•°æ®ä¼˜åŒ–ä»¥åŠå…¶ä»–åˆ›æ–°éƒ½æœ‰ä¸€äº›æœ‰è¶£çš„å˜åŒ–ï¼Œå…³äºæˆ‘åªæƒ³å‘Šè¯‰ä½ çš„ã€‚ </p><br><p><img src="https://habrastorage.org/webt/wy/zd/u6/wyzdu6fyb-3ehjdbzwi8jgxhvec.png"></p><a name="habracut"></a><br><p> ä½†æ˜¯ï¼Œè®©æˆ‘ä»¬ä»é¡ºåºå¼€å§‹ã€‚ </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ—©åœ¨2017å¹´ï¼Œ</a>æˆ‘å°±å±•ç¤ºäº†å½“æ—¶ç›¸å…³çš„ç»„ä»¶äº¤äº’å›¾ï¼Œæˆ‘æƒ³å†æ¬¡è¿›è¡Œæ¼”ç¤ºï¼Œè¿™æ ·æ‚¨å°±ä¸å¿…å†æ¬¡åˆ‡æ¢é€‰é¡¹å¡äº†ã€‚ </p><br><p> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/4e9/d52/d3e/4e9d52d3e19df15d928d29d2394095fa.jpg"></a> </p><br><p> ä»é‚£ä¸€åˆ»èµ·ï¼Œå‘ç”Ÿäº†ä»¥ä¸‹äº‹æƒ…ã€‚ </p><br><ul><li><p> Graphiteç¾¤é›†ä¸­çš„æœåŠ¡å™¨æ•°é‡å·²ä»3å¢åŠ åˆ°6ã€‚ <br>  ï¼ˆ <code>56 CPU 2.60GHz, 384GB RAM, 10 SSD SAS 745GB, Raid 6, 10GBit/s Net</code> ï¼‰ã€‚ </p><br></li><li><p> æˆ‘ä»¬ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">bioyino</a>ä»£æ›¿äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">brubeck-</a>æˆ‘ä»¬è‡ªå·±çš„Rustå®ç°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">StatsD</a> ï¼Œç”šè‡³<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ’°å†™äº†</a>æ•´ç¯‡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡ç« </a> ã€‚ ä½†æ˜¯ï¼Œåœ¨æ–‡ç« å‘å¸ƒä¹‹åï¼Œæˆ‘ä»¬æå‡ºäº†å¯¹æ ‡è®°ï¼ˆGraphiteï¼‰å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Raftçš„</a>æ”¯æŒä»¥é€‰æ‹©é¢†å¯¼è€…ã€‚ </p><br></li><li><p> æˆ‘ä»¬ç¡®å®šäº†ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç”Ÿç‰©æŠ‘åˆ¶å‰‚</a>ä½œä¸ºStatsDä»£ç†çš„å¯èƒ½æ€§ï¼Œå¹¶å°†æ­¤ç±»ä»£ç†æ”¾ç½®åœ¨æ•´å—å®ä¾‹é™„è¿‘ä»¥åŠk8ä¸­éœ€è¦çš„ä½ç½®ã€‚ </p><br></li><li><p> æˆ‘ä»¬ç»ˆäºæ‘†è„±äº†æ—§çš„Muninç›‘è§†ç³»ç»Ÿï¼ˆä»¥å‰æˆ‘ä»¬ä»ç„¶æ‹¥æœ‰å®ƒï¼Œä½†æ˜¯ä¸å†ä½¿ç”¨å…¶æ•°æ®ï¼‰ã€‚ </p><br></li><li><p> ç”±äºæ–°ç‰ˆæœ¬çš„Kubernetesä¸æ”¯æŒHeapsterï¼Œå› æ­¤é€šè¿‡Prometheus / Federationsç»„ç»‡äº†æ¥è‡ªKubernetesé›†ç¾¤çš„æ•°æ®æ”¶é›†ã€‚ </p><br></li></ul><br><h1 id="monitoring"> ç›‘æ§æ–¹å¼ </h1><br><p> åœ¨è¿‡å»çš„ä¸¤å¹´ä¸­ï¼Œæ¥å—å’Œå¤„ç†çš„æŒ‡æ ‡æ•°é‡å¢é•¿äº†çº¦9å€ã€‚ </p><br><p> <a href=""><img src="https://habrastorage.org/webt/r2/yu/zm/r2yuzm1rt5ok64zh2utwrpdtzbk.png"></a> </p><br><p> å ç”¨çš„æœåŠ¡å™¨ç©ºé—´ç™¾åˆ†æ¯”ä¹Ÿåœ¨æ— æƒ…åœ°æ”€å‡ï¼Œæˆ‘ä»¬æ­£åœ¨é‡‡å–å„ç§æªæ–½æ¥é™ä½å®ƒã€‚ è¿™åœ¨å›¾è¡¨ä¸Šæ¸…æ™°å¯è§ã€‚ </p><br><p> <a href=""><img src="https://habrastorage.org/webt/s2/uj/ml/s2ujmlqnrsoo0yb0kgtxkdcf4ek.png"></a> </p><br><p> æˆ‘ä»¬åˆ°åº•åœ¨åšä»€ä¹ˆï¼Ÿ </p><br><ul><li> æˆ‘ä»¬å¼€å§‹å°†å¤æ‚çš„å‹ç¼©æ–¹æ³•åº”ç”¨äºæ•°æ®åˆ—ã€‚ <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> graphite.data <span class="hljs-keyword"><span class="hljs-keyword">MODIFY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> UInt32 CODEC(Delta, ZSTD)</code> </pre> </li><li> æˆ‘ä»¬ä¼šç»§ç»­å°†è¶…è¿‡5å‘¨çš„æ•°æ®ä»30ç§’é—´éš”å‹ç¼©åˆ°5åˆ†é’Ÿé—´éš”ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªcronä»»åŠ¡ï¼Œè¯¥ä»»åŠ¡æ¯æœˆï¼ˆå¤§çº¦ï¼‰å¯åŠ¨ä¸€æ¬¡ä»¥ä¸‹è¿‡ç¨‹ï¼š </li></ul><br><pre> <code class="bash hljs">10 10 10 * * clickhouse-client -q <span class="hljs-string"><span class="hljs-string">"select distinct partition from system.parts where active=1 and database='graphite' and table='data' and max_date between today()-55 AND today()-35;"</span></span> | <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> PART; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> clickhouse-client -u systemXXX --password XXXXXXX -q <span class="hljs-string"><span class="hljs-string">"OPTIMIZE TABLE graphite.data PARTITION ('"</span></span><span class="hljs-variable"><span class="hljs-variable">$PART</span></span><span class="hljs-string"><span class="hljs-string">"') FINAL"</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> <br><ul><li> æˆ‘ä»¬å…±äº«äº†æ•°æ®è¡¨ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº†ä¸‰ä¸ªå¸¦æœ‰ä¸¤ä¸ªå‰¯æœ¬çš„ç¢ç‰‡ï¼Œæ¯ä¸ªå‰¯æœ¬éƒ½æœ‰ä¸€ä¸ªä»£è¡¨åº¦é‡çš„å“ˆå¸Œç¢ç‰‡é”®ã€‚ è¿™ç§æ–¹æ³•ä¸ºæˆ‘ä»¬æä¾›äº†æ‰§è¡Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ±‡æ€»è¿‡ç¨‹</a>çš„æœºä¼šï¼Œå› ä¸ºç‰¹å®šæŒ‡æ ‡çš„æ‰€æœ‰å€¼éƒ½åœ¨åŒä¸€ä¸ªåˆ†ç‰‡å†…ï¼Œå¹¶ä¸”æ‰€æœ‰åˆ†ç‰‡ä¸Šçš„ç£ç›˜ç©ºé—´éƒ½è¢«ç»Ÿä¸€ç”¨å®Œã€‚ </li></ul><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åˆ†å¸ƒå¼è¡¨</a>æ¶æ„å¦‚ä¸‹ã€‚ </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> graphite.data_all ( <span class="hljs-string"><span class="hljs-string">`Path`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">String</span></span>, <span class="hljs-string"><span class="hljs-string">`Value`</span></span> Float64, <span class="hljs-string"><span class="hljs-string">`Time`</span></span> UInt32, <span class="hljs-string"><span class="hljs-string">`Date`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>, <span class="hljs-string"><span class="hljs-string">`Timestamp`</span></span> UInt32 ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">Distributed</span></span> ( <span class="hljs-string"><span class="hljs-string">'graphite_cluster'</span></span>, <span class="hljs-string"><span class="hljs-string">'graphite'</span></span>, <span class="hljs-string"><span class="hljs-string">'data'</span></span>, jumpConsistentHash(cityHash64(<span class="hljs-keyword"><span class="hljs-keyword">Path</span></span>), <span class="hljs-number"><span class="hljs-number">3</span></span>) )</code> </pre> <br><p> æˆ‘ä»¬è¿˜ä¸ºç”¨æˆ·åˆ†é…äº†â€œé»˜è®¤â€åªè¯»æƒé™ï¼Œå¹¶å°†å¯¹è¡¨çš„å†™å…¥è¿‡ç¨‹çš„æ‰§è¡Œæƒäº¤ç»™äº†å•ç‹¬çš„ç”¨æˆ·<code>systemXXX</code> ã€‚ </p><br><p>  ClickHouseä¸­çš„Graphiteç¾¤é›†çš„é…ç½®å¦‚ä¸‹ã€‚ </p><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">remote_servers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">graphite_cluster</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shard</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">internal_replication</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">internal_replication</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">replica</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span>graphite-clickhouse01<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span>9000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span>systemXXX<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span>XXXXXX<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">replica</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">replica</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span>graphite-clickhouse04<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span>9000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span>systemXXX<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span>XXXXXX<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">replica</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shard</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shard</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">internal_replication</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">internal_replication</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">replica</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span>graphite-clickhouse02<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span>9000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span>systemXXX<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span>XXXXXX<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">replica</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">replica</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span>graphite-clickhouse05<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span>9000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span>systemXXX<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span>XXXXXX<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">replica</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shard</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shard</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">internal_replication</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">internal_replication</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">replica</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span>graphite-clickhouse03<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span>9000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span>systemXXX<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span>XXXXXX<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">replica</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">replica</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span>graphite-clickhouse06<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span>9000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span>systemXXX<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span>XXXXXX<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">replica</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shard</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">graphite_cluster</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">remote_servers</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p> é™¤äº†å†™å…¥è´Ÿè½½ä¹‹å¤–ï¼Œä»Graphiteè¯»å–æ•°æ®çš„è¯·æ±‚æ•°é‡ä¹Ÿå¢åŠ äº†ã€‚ è¯¥æ•°æ®ç”¨äºï¼š </p><br><ul><li> è§¦å‘å¤„ç†å¹¶ç”Ÿæˆè­¦æŠ¥ï¼› </li><li> åœ¨è¶Šæ¥è¶Šå¤šçš„å…¬å¸å‘˜å·¥çš„åŠå…¬å®¤ï¼Œç¬”è®°æœ¬ç”µè„‘å’ŒPCå±å¹•ä¸Šçš„æ˜¾ç¤ºå™¨ä¸Šæ˜¾ç¤ºå›¾å½¢ã€‚ </li></ul><br><p> <a href=""><img src="https://habrastorage.org/webt/ch/rb/wh/chrbwhdiyl3x3cxjqmwgtohph6y.png"></a> </p><br><p> ä¸ºäº†é˜²æ­¢ç›‘è§†ç¨‹åºåœ¨æ­¤è´Ÿè½½ä¸‹æ·¹æ²¡ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†å¦ä¸€ç§æ–¹æ³•ï¼šå°†æœ€è¿‘ä¸¤å¤©çš„æ•°æ®å­˜å‚¨åœ¨å•ç‹¬çš„â€œå°â€ç›˜ä¸­ï¼Œç„¶åå°†è¿‡å»ä¸¤å¤©çš„æ‰€æœ‰è¯»å–è¯·æ±‚å‘é€åˆ°é‚£é‡Œï¼Œä»¥å‡å°‘ä¸»åˆ†ç‰‡è¡¨çš„è´Ÿè½½ã€‚ åŒæ ·å¯¹äºè¿™ç§â€œå°å‹â€å¹³æ¿ç”µè„‘ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†åå‘åº¦é‡å­˜å‚¨æ–¹æ¡ˆï¼Œè¯¥æ–¹æ¡ˆæå¤§åœ°åŠ å¿«äº†å¯¹å…¶ä¸­åŒ…å«çš„æ•°æ®çš„æœç´¢ï¼Œå¹¶ä¸ºå®ƒç»„ç»‡äº†æ¯æ—¥åˆ†åŒºã€‚ è¯¥æ¿çš„æ–¹æ¡ˆå¦‚ä¸‹ã€‚ </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> graphite.data_reverse ( <span class="hljs-string"><span class="hljs-string">`Path`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">String</span></span>, <span class="hljs-string"><span class="hljs-string">`Value`</span></span> Float64, <span class="hljs-string"><span class="hljs-string">`Time`</span></span> UInt32 CODEC(Delta(<span class="hljs-number"><span class="hljs-number">4</span></span>), ZSTD(<span class="hljs-number"><span class="hljs-number">1</span></span>)), <span class="hljs-string"><span class="hljs-string">`Date`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>, <span class="hljs-string"><span class="hljs-string">`Timestamp`</span></span> UInt32 ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span> = ReplicatedGraphiteMergeTree ( <span class="hljs-string"><span class="hljs-string">'/clickhouse/tables/{cluster}/data_reverse'</span></span>, <span class="hljs-string"><span class="hljs-string">'{replica}'</span></span>, <span class="hljs-string"><span class="hljs-string">'graphite_rollup'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Path</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SETTINGS</span></span> index_granularity = <span class="hljs-number"><span class="hljs-number">4096</span></span></code> </pre> <br><p> ä¸ºäº†å‘å…¶ä¸­å®šå‘æ•°æ®ï¼Œæˆ‘ä»¬åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">carbon-clickhouse</a>åº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶ä¸­æ·»åŠ äº†ä¸€ä¸ªæ–°éƒ¨åˆ†ã€‚ </p><br><pre> <code class="plaintext hljs">[upload.graphite_reverse] type = "points-reverse" table = "graphite.data_reverse" threads = 2 url = "http://systemXXX:XXXXXXX@localhost:8123/" timeout = "60s" cache-ttl = "6h0m0s" zero-timestamp = true</code> </pre> <br><p> ä¸ºäº†åˆ é™¤è¶…è¿‡ä¸¤å¤©çš„åˆ†åŒºï¼Œæˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªcronä»»åŠ¡ã€‚ çœ‹èµ·æ¥åƒè¿™æ ·ã€‚ </p><br><pre> <code class="bash hljs">1 12 * * * clickhouse-client -q <span class="hljs-string"><span class="hljs-string">"select distinct partition from system.parts where active=1 and database='graphite' and table='data_reverse' and max_date&lt;today()-2;"</span></span> | <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> PART; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> clickhouse-client -u systemXXX --password XXXXXXX -q <span class="hljs-string"><span class="hljs-string">"ALTER TABLE graphite.data_reverse DROP PARTITION ('"</span></span><span class="hljs-variable"><span class="hljs-variable">$PART</span></span><span class="hljs-string"><span class="hljs-string">"')"</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> <br><p> ä¸ºäº†ä»è¡¨ä¸­è¯»å–æ•°æ®ï¼Œåœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">graphite-clickhouse</a>é…ç½®æ–‡ä»¶ä¸­æ·»åŠ äº†ä¸€ä¸ªéƒ¨åˆ†ï¼š </p><br><pre> <code class="plaintext hljs">[[data-table]] table = "graphite.data_reverse" max-age = "48h" reverse = true</code> </pre> <br><p> ç»“æœï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªè¡¨ï¼Œå…¶ä¸­100ï¼…çš„æ•°æ®å·²å¤åˆ¶åˆ°æ‰€æœ‰å…­å°æœåŠ¡å™¨ï¼Œè¿™äº›æœåŠ¡å™¨åœ¨ä¸åˆ°ä¸¤å¤©çš„æ—¶é—´å†…å¤„ç†äº†æ¥è‡ªè¯·æ±‚çš„å…¨éƒ¨è¯»å–è´Ÿè½½ï¼ˆå…¶ä¸­æœ‰95ï¼…ï¼‰ã€‚ å¦å¤–ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªåˆ†ç‰‡è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªåˆ†ç‰‡ä¸Šçš„æ•°æ®ä¸º1/3ï¼Œå¯è¯»å–æ‰€æœ‰å†å²æ•°æ®ã€‚ å³ä½¿è¿™æ ·çš„è¯·æ±‚å¾ˆå°ï¼Œæ¥è‡ªå®ƒä»¬çš„è´Ÿè½½ä¹Ÿè¦é«˜å¾—å¤šã€‚ </p><br><p>  CPUå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ ç”±äºGraphiteç¾¤é›†ä¸­å·²è®°å½•å’Œè¯»å–çš„æ•°æ®é‡å¢åŠ ï¼ŒæœåŠ¡å™¨ä¸Šçš„æ€»CPUè´Ÿè½½ä¹Ÿå¢åŠ äº†ã€‚ çœ‹èµ·æ¥åƒè¿™æ ·ã€‚ </p><br><p> <a href=""><img src="https://habrastorage.org/webt/_u/mg/m3/_umgm3dd9lgetkopu45jjrqqodw.png"></a> </p><br><p> æˆ‘æƒ³æè¯·æ³¨æ„ä»¥ä¸‹ç»†å¾®å·®åˆ«ï¼šä¸€åŠçš„CPUç”¨äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Carbon-c-relay</a> ï¼ˆ2018-09-05ç‰ˆæœ¬v3.2ï¼Œè´Ÿè´£ä¼ è¾“åº¦é‡æ ‡å‡†ï¼‰ä¸­çš„åº¦é‡æ ‡å‡†çš„è§£æå’Œä¸»å¤„ç†ï¼Œå®ƒä½äºå…­å°æœåŠ¡å™¨ä¸­çš„ä¸‰å°ä¸­ã€‚ ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸‰ä¸ªæœåŠ¡å™¨ä½äºTOPä¸­ã€‚ </p><br><h1 id="alerting"> è­¦æŠ¥ </h1><br><p> ä½œä¸ºè­¦æŠ¥ç³»ç»Ÿï¼Œæˆ‘ä»¬ä»ç„¶æœ‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Moira</a>å’Œä¸ºå…¶ç¼–å†™çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">moira-client</a> ã€‚ ä¸ºäº†çµæ´»åœ°ç®¡ç†è§¦å‘å™¨ï¼Œé€šçŸ¥å’Œå‡çº§ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªç§°ä¸ºalert.yamlçš„å£°æ˜æ€§æè¿°ã€‚ å®ƒæ˜¯é€šè¿‡PaaSåˆ›å»ºæœåŠ¡æ—¶è‡ªåŠ¨ç”Ÿæˆçš„ï¼ˆæœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§Vadim Madisonçš„æ–‡ç« <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">â€œæˆ‘ä»¬å¯¹å¾®æœåŠ¡çš„äº†è§£â€</a> ï¼‰ï¼Œå¹¶å°†å…¶æ”¾ç½®åœ¨å…¶å­˜å‚¨åº“ä¸­ã€‚ ä¸ºäº†ä½¿ç”¨alert.yamlï¼Œæˆ‘ä»¬åœ¨moira-clientä¸Šè¿›è¡Œäº†ç»‘å®šï¼Œå¹¶å°†å…¶å‘½åä¸ºalert-autoconfï¼ˆæˆ‘ä»¬è®¡åˆ’å¼€æ”¾ï¼‰ã€‚ åœ¨TeamCityä¸­ç»„è£…æœåŠ¡æœ‰ä¸€ä¸ªæ­¥éª¤ï¼Œå³é€šè¿‡alert-autoconfå°†è§¦å‘å™¨å’Œé€šçŸ¥å¯¼å‡ºåˆ°Moiraã€‚ å°†æ›´æ”¹æäº¤åˆ°alert.yamlæ—¶ï¼Œå°†è¿è¡Œè‡ªåŠ¨æµ‹è¯•ï¼Œä»¥æ£€æŸ¥yamlæ–‡ä»¶çš„æœ‰æ•ˆæ€§ï¼Œå¹¶é’ˆå¯¹æ¯ä¸ªåº¦é‡æ ‡å‡†æ¨¡æ¿å‘Graphiteå‘å‡ºè¯·æ±‚ï¼Œä»¥éªŒè¯å…¶æ­£ç¡®æ€§ã€‚ </p><br><p> å¯¹äºä¸ä½¿ç”¨PaaSçš„åŸºç¡€æ¶æ„å›¢é˜Ÿï¼Œæˆ‘ä»¬ç»„ç»‡äº†ä¸€ä¸ªå•ç‹¬çš„å­˜å‚¨åº“ï¼Œç§°ä¸ºâ€œè­¦æŠ¥â€ã€‚ å®ƒçš„æ ¼å¼å¦‚ä¸‹ï¼šTeam / Project / alert.yamlã€‚ å¯¹äºæ¯ä¸ªalert.yamlï¼Œæˆ‘ä»¬åœ¨TeamCityä¸­ç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„ç¨‹åºé›†ï¼Œè¯¥ç¨‹åºé›†è¿è¡Œæµ‹è¯•å¹¶åœ¨Moiraä¸­æ¨é€alert.yamlçš„å†…å®¹ã€‚ </p><br><p> å› æ­¤ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„å‘˜å·¥éƒ½å¯ä»¥ä½¿ç”¨ä¸€ç§æ–¹æ³•æ¥ç®¡ç†è§¦å‘å™¨ï¼Œé€šçŸ¥å’Œå‡çº§ã€‚ </p><br><p> ç”±äºåœ¨é€šè¿‡GUIè§¦å‘è§¦å‘å™¨ä¹‹å‰ï¼Œæˆ‘ä»¬å®ç°äº†ä»¥yamlæ ¼å¼ä¸Šä¼ è§¦å‘å™¨çš„åŠŸèƒ½ã€‚ å¯ä»¥å°†æ¥æ”¶åˆ°çš„yamlæ–‡æ¡£çš„å†…å®¹æ’å…¥åˆ°alert.yamlä¸­ï¼Œè€Œæ— éœ€è¿›è¡Œä»»ä½•å…¶ä»–è½¬æ¢ï¼Œç„¶åå°†æ›´æ”¹æ¨é€åˆ°å‘å¯¼ä¸­ã€‚ åœ¨æ„å»ºæœŸé—´ï¼Œalert-autoconfå°†äº†è§£è¿™æ ·çš„è§¦å‘å™¨å·²ç»å­˜åœ¨ï¼Œå¹¶å°†å…¶æ³¨å†Œåˆ°æˆ‘ä»¬åœ¨Redisä¸­çš„æ³¨å†Œè¡¨ä¸­ã€‚ </p><br><p> ä¸ä¹…å‰ï¼Œæˆ‘ä»¬å…¨å¤©å€™24x7è½®ç­å·¥ä½œã€‚ ä¸ºäº†å°†è§¦å‘å™¨è½¬ç§»ç»™ä»–ä»¬ä»¥è¿›è¡Œç»´ä¿®ï¼Œè¯·åœ¨alert.yamlä¸­è¶³å¤Ÿæ­£ç¡®åœ°å¡«å†™â€œçœ‹åˆ°åè¯¥æ€ä¹ˆåŠâ€çš„è¯´æ˜ï¼Œå°†æ ‡ç­¾[24x7]æ”¾ç½®åˆ°å‘å¯¼ä¸­ã€‚ æ»šåŠ¨alert.yamlåï¼Œå…¶ä¸­æè¿°çš„æ‰€æœ‰è§¦å‘å™¨å°†è‡ªåŠ¨ç½®äº24x7çš„24å°æ—¶è½®ç­ç›‘æ§ä¹‹ä¸‹ã€‚  U-ç®€åŒ–ï¼ ç¾å¥³ï¼ </p><br><h1 id="sbor-biznes-metrik"> ä¸šåŠ¡æŒ‡æ ‡æ”¶é›† </h1><br><p> è‡ªä¸Š<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸€ç¯‡</a>æœ‰å…³æ”¶é›†å’Œå¤„ç†ä¸šåŠ¡æŒ‡æ ‡çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡ç« </a>ä»¥æ¥ï¼Œæˆ‘ä»¬çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">bioyino</a>å˜å¾—æ›´å¥½ã€‚ </p><br><ol><li> è€Œä¸æ˜¯é€šè¿‡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é¢†äº‹</a>æ¥é€‰æ‹©é¢†å¯¼è€…ï¼Œè€Œæ˜¯ä½¿ç”¨å†…ç½®çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Raft</a> ã€‚ </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ ‡ç­¾ä»¥Graphiteæ ¼å¼</a>æ­£ç¡®å¤„ç†ã€‚ </li><li> ç°åœ¨æ‚¨å¯ä»¥å°†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">bioyino</a> ï¼ˆStatsDæœåŠ¡å™¨ï¼‰ç”¨ä½œä»£ç†ã€‚ </li><li> ä¸ºäº†è®¡ç®—å”¯ä¸€å€¼ï¼Œæ”¯æŒâ€œè®¾ç½®â€æ ¼å¼ã€‚ </li><li> æŒ‡æ ‡çš„æœ€ç»ˆæ±‡æ€»å¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å®Œæˆã€‚ </li><li> æ•°æ®å¯ä»¥é€šè¿‡å¤šä¸ªå¹¶è¡Œè¿æ¥å‘é€åˆ°Graphiteå—ã€‚ </li><li> ä¿®å¤äº†å‘ç°çš„æ‰€æœ‰é”™è¯¯ã€‚ </li></ol><br><p> ç°åœ¨å®ƒåƒè¿™æ ·å·¥ä½œã€‚ </p><br><p> æˆ‘ä»¬å¼€å§‹åœ¨æ‰€æœ‰å¤§å‹åº¦é‡ç”Ÿæˆå™¨æ—è¾¹ç§¯æå¼•å…¥StatsDä»£ç†ï¼šåœ¨å…·æœ‰æ•´ä½“å®ä¾‹çš„å®¹å™¨ä¸­ï¼Œåœ¨æœåŠ¡æ—è¾¹çš„k8s podä¸­ï¼Œåœ¨å…·æœ‰åŸºç¡€ç»“æ„ç»„ä»¶çš„ä¸»æœºä¸Šç­‰ã€‚ <br>  Statsdä»£ç†ä½äºåº”ç”¨ç¨‹åºæ—è¾¹ã€‚ å®ƒé€šè¿‡UDPä½¿ç”¨æ­¤åº”ç”¨ç¨‹åºä¸­çš„åº¦é‡æ ‡å‡†ï¼Œä½†ä¸å†ä½¿ç”¨ç½‘ç»œå­ç³»ç»Ÿï¼ˆç”±äºLinuxå†…æ ¸ä¸­çš„ä¼˜åŒ–ï¼‰ã€‚ æ‰€æœ‰äº‹ä»¶éƒ½æ˜¯é¢„å…ˆæ±‡æ€»çš„ï¼Œå¹¶ä¸”æ¯ç§’æ”¶é›†çš„æ•°æ®ï¼ˆå¯ä»¥é…ç½®æ—¶é—´é—´éš”ï¼‰ä»¥Cap'n Protoæ ¼å¼å‘é€åˆ°StatsDæœåŠ¡å™¨çš„ä¸»è¦ç¾¤é›†ï¼ˆbioyino0 [1-3]ï¼‰ã€‚ </p><br><p> åº¦é‡æ ‡å‡†çš„è¿›ä¸€æ­¥å¤„ç†å’Œèšåˆï¼ŒStatsDç¾¤é›†ä¸­é¢†å¯¼è€…çš„é€‰æ‹©ä»¥åŠé¢†å¯¼è€…å‘Graphiteå‘é€åº¦é‡æ ‡å‡†éƒ½æ²¡æœ‰æ”¹å˜ã€‚ æ‚¨å¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨ä¸Šä¸€ç¯‡æ–‡ç« </a>ä¸­è¯¦ç»†äº†è§£æ­¤<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å†…å®¹</a> ã€‚ </p><br><p> è‡³äºæ•°å­—ï¼Œå®ƒä»¬å¦‚ä¸‹ã€‚ </p><br><p>  <em>æ”¶åˆ°çš„StatsDäº‹ä»¶å›¾</em> <br> <a href=""><img src="https://habrastorage.org/webt/m2/td/56/m2td56sycgexhmsupyp7nfmp2hw.png"></a> <br><img src="https://habrastorage.org/webt/np/5m/hi/np5mhi_4z6pfwpdpbvzfamn7fws.png"></p><br><p>  <em>ä»StatsDå‘é€åˆ°Graphiteçš„æŒ‡æ ‡å›¾</em> <br> <a href=""><img src="https://habrastorage.org/webt/m2/td/56/m2td56sycgexhmsupyp7nfmp2hw.png"></a> </p><br><h1 id="itogo"> åˆè®¡ </h1><br><p> ç›®å‰ï¼Œç›‘è§†ç»„ä»¶ä¹‹é—´äº¤äº’çš„ä¸€èˆ¬æ–¹æ¡ˆå¦‚ä¸‹æ‰€ç¤ºã€‚ </p><br><p> <a href=""><img src="https://habrastorage.org/webt/n6/ym/-b/n6ym-bcuyt3a3ctoda93lassduo.png"></a> </p><br><p> æŒ‡æ ‡æ€»æ•°ï¼š2 189 484 898 474ã€‚ <br> æŒ‡æ ‡çš„æ€»å­˜å‚¨æ·±åº¦ï¼š3å¹´ã€‚ <br> å”¯ä¸€åº¦é‡æ ‡å‡†åç§°çš„æ•°ç›®ï¼š6 585 413 171ã€‚ <br> è§¦å‘å™¨æ•°é‡ï¼š1053ï¼Œå®ƒä»¬çš„ä½œç”¨èŒƒå›´æ˜¯1åˆ°15,000ã€‚ </p><br><p>  <strong>è¿‘æœŸè®¡åˆ’ï¼š</strong> </p><br><ul><li> å¼€å§‹å°†äº§å“æœåŠ¡ç§»è‡³æ ‡è®°çš„åº¦é‡æ ‡å‡†å­˜å‚¨æ–¹æ¡ˆï¼› </li><li> å‘Graphiteé›†ç¾¤æ·»åŠ ä¸‰å°æœåŠ¡å™¨ï¼› </li><li> ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æŒä¹…çš„ç»„ç»‡</a>ç»“äº¤Moiraæœ‹å‹; </li><li> åœ¨ç›‘è§†å›¢é˜Ÿä¸­<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æŸ¥æ‰¾</a>å…¶ä»–å¼€å‘äººå‘˜ã€‚ </li></ul><br><p> æˆ‘å°†å¾ˆä¹æ„åœ¨è¿™é‡Œå‘è¡¨è¯„è®ºå’Œæå‡ºé—®é¢˜-å†™ã€‚ æˆ‘è¿˜å°†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨11æœˆ7</a>æ—¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä½¿ç”¨Highload ++</a>è¿›è¡Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¡¨æ¼”</a> ï¼Œå¦‚æœæ‚¨åœ¨é‚£é‡Œï¼Œæˆ‘ä»¬å¯ä»¥è°ˆè°ˆã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN467995/">https://habr.com/ru/post/zh-CN467995/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN467979/index.html">å¹¿å‘Šæ•´åˆï¼šå¦‚ä½•è¿ä½œï¼Ÿ</a></li>
<li><a href="../zh-CN467981/index.html">æ€ç§‘UCS C240 M5æœºæ¶æœåŠ¡å™¨è£…ç®±</a></li>
<li><a href="../zh-CN467987/index.html">ç”ŸåŠ¨æ´»æ³¼çš„æœå†»ï¼šæ— éœ€CPUå³å¯è¿›è¡Œææ–™çº§å†³ç­–</a></li>
<li><a href="../zh-CN467989/index.html">å¦‚ä½•è®¾è®¡æ±½è½¦æ‚¬æ¶æ§åˆ¶å•å…ƒ</a></li>
<li><a href="../zh-CN467991/index.html">é‰´äºç”Ÿæ´»æˆæœ¬ï¼Œå¼€å‘å•†ä¸è«æ–¯ç§‘çš„åœ°åŒºå·¥èµ„æœ‰å¤šå°‘ä¸åŒ</a></li>
<li><a href="../zh-CN467997/index.html">è½¯ä»¶æ¶æ„è¢«é«˜ä¼°ï¼Œç®€å•è®¾è®¡è¢«ä½ä¼°</a></li>
<li><a href="../zh-CN467999/index.html">å¯¹äºVNAæˆ–æ—¥æ–‡ä¸­æ–‡è®¾å¤‡çš„é—®é¢˜</a></li>
<li><a href="../zh-CN468001/index.html">æ‚¨ä¸è®¤ä¸ºï¼šç¨‹åºç¡®å®å˜å¾—æ›´åŠ æ˜‚è´µäº†</a></li>
<li><a href="../zh-CN468003/index.html">5 GHzé“ï¼šå…³äºå¦‚ä½•æ„å»ºè¶…å¿«VDSçš„æ•…äº‹</a></li>
<li><a href="../zh-CN468005/index.html">è°ˆä¸€è°ˆå…‰è£çš„æ”¯æŒï¼ˆ9æœˆ24æ—¥ï¼Œè«æ–¯ç§‘ï¼‰</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>