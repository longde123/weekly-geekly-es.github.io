<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêÇ ü§üüèΩ ü§±üèæ Guide Kubernetes, Partie 2: Cr√©ation et utilisation d'un cluster üë®üèæ‚Äçü§ù‚Äçüë®üèΩ üÖøÔ∏è ü§±</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La derni√®re fois, nous avons examin√© deux approches pour travailler avec des microservices. En particulier, l'un d'eux implique l'utilisation de conte...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Guide Kubernetes, Partie 2: Cr√©ation et utilisation d'un cluster</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/438984/">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La derni√®re</a> fois, nous avons examin√© deux approches pour travailler avec des microservices.  En particulier, l'un d'eux implique l'utilisation de conteneurs Docker, dans lesquels vous pouvez ex√©cuter le code des microservices et des programmes auxiliaires.  Aujourd'hui, en utilisant nos images de conteneurs existantes, nous travaillerons avec Kubernetes. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/13/lv/dr/13lvdrwhhap-ouchegvweul0fg0.jpeg"></a> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Pr√©sentation de Kubernetes</font> </h2><br>  Je promets, et je n'exag√®re pas du tout que lorsque vous lisez cet article, demandez-vous: "Pourquoi les Kubernetes ne s'appellent-ils pas Supernetes?" <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d76/9f9/e76/d769f9e7670a725759dd7415949177a0.png"></div><br>  <i><font color="#999999">Supernetes</font></i> <br><br>  Si vous lisez la partie pr√©c√©dente de ce document, vous savez que nous avons examin√© beaucoup de choses li√©es √† la pr√©paration des demandes de conteneurisation et au travail avec les conteneurs Docker.  Il peut vous sembler que la chose la plus difficile vous attend maintenant, mais, en fait, ce dont nous allons parler ici est beaucoup plus simple que ce que nous avons d√©j√† compris.  La seule raison pour laquelle l'apprentissage de Kubernetes peut sembler une t√¢che intimidante pour quelqu'un est la quantit√© d'informations suppl√©mentaires dont vous avez besoin pour comprendre Kubernetes et l'utiliser efficacement.  Nous avons d√©j√† discut√© de toutes les "informations suppl√©mentaires" n√©cessaires au succ√®s du d√©veloppement de Kubernetes. <br><br><h3>  <font color="#3AC1EF">HatQu'est-ce que Kubernetes?</font> </h3><br>  Dans la premi√®re partie de cet article, apr√®s avoir lanc√© des microservices dans des conteneurs, on vous a demand√© de r√©fl√©chir √† la question de la mise √† l'√©chelle des applications conteneuris√©es. <br>  Je propose d'y r√©fl√©chir ensemble, sous forme de questions et r√©ponses: <br><br>  <b>Question:</b> Comment les applications conteneuris√©es √©voluent-elles? <br>  <b>R√©ponse:</b> lancez des conteneurs suppl√©mentaires. <br><br>  <b>Question:</b> Et comment la charge est-elle r√©partie entre eux?  Que faire si un certain serveur est d√©j√† utilis√© au maximum et que le conteneur doit √™tre d√©ploy√© sur un autre serveur?  Comment trouver le moyen le plus efficace d'utiliser du mat√©riel? <br>  <b>R√©ponse:</b> Alors ... je vais regarder sur Internet ... <br><br>  <b>Question:</b> Comment mettre √† jour des programmes sans perturber le syst√®me?  Et, si la mise √† jour contient une erreur, comment revenir √† la version de travail de l'application? <br><br>  En fait, c'est la technologie Kubernetes qui donne des r√©ponses valables √† ces questions et √† bien d'autres.  Je vais essayer de limiter la d√©finition de Kubernetes √† une phrase: "Kubernetes est un syst√®me de gestion de conteneurs qui r√©sume l'infrastructure sous-jacente (l'environnement dans lequel les conteneurs s'ex√©cutent)." <br><br>  Je pense que maintenant vous n'√™tes pas particuli√®rement clair sur le concept de ¬´gestion des conteneurs¬ª, m√™me si nous l'avons d√©j√† mentionn√©.  Ci-dessous, nous consid√©rerons cette technologie dans la pratique.  Cependant, le concept ¬´d'abstraire l'infrastructure de base¬ª est d'abord rencontr√©.  Par cons√©quent, nous allons maintenant l'examiner. <br><br><h3>  <font color="#3AC1EF">‚ñç Abstraction des infrastructures de base</font> </h3><br>  Kubernetes permet aux applications de s'√©loigner de l'infrastructure, nous donnant une API simple √† laquelle vous pouvez envoyer des demandes.  Kubernetes essaie de r√©pondre √† ces demandes en utilisant toutes ses capacit√©s.  Par exemple, dans une langue normale, une requ√™te similaire peut √™tre d√©crite comme suit: ¬´Kubernetes, d√©veloppez 4 conteneurs d'images X¬ª.  Apr√®s avoir re√ßu la commande, Kubernetes trouvera des n≈ìuds qui ne sont pas trop occup√©s (ils sont √©galement appel√©s "n≈ìuds" - de l'anglais "n≈ìud"), sur lesquels vous pouvez d√©ployer de nouveaux conteneurs. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/735/b88/a2a/735b88a2a717e9c01bfc197f3c1b20fd.png"></div><br>  <i><font color="#999999">Demande de serveur API</font></i> <br><br>  Qu'est-ce que cela signifie pour le d√©veloppeur?  Cela signifie qu'il n'a pas besoin de se soucier du nombre de n≈ìuds, de l'endroit exact o√π les conteneurs sont lanc√©s ou de la fa√ßon dont ils interagissent.  Il n'a pas √† g√©rer l'optimisation mat√©rielle ni √† s'inqui√©ter des n≈ìuds qui pourraient mal fonctionner (et quelque chose de similaire, selon la loi de Murphy, se produira certainement), car, si n√©cessaire, de nouveaux n≈ìuds peuvent √™tre ajout√©s au cluster Kubernetes.  Si quelque chose ne va pas avec certains n≈ìuds existants, Kubernetes d√©ploiera des conteneurs sur les n≈ìuds qui sont toujours dans un √©tat sain. <br><br>  Une grande partie de ce qui est illustr√© dans la figure pr√©c√©dente vous est d√©j√† famili√®re.  Mais il y a aussi quelque chose de nouveau: <br><br><ul><li>  Serveur API  Faire des appels √† ce serveur est le seul moyen d'interagir avec le cluster que nous avons, qu'il s'agisse de d√©marrer ou d'arr√™ter des conteneurs, de v√©rifier l'√©tat du syst√®me, de travailler avec des journaux ou d'effectuer d'autres actions. </li><li>  Kubelet.  Il s'agit d'un agent qui surveille les conteneurs √† l'int√©rieur du n≈ìud et interagit avec le n≈ìud principal. </li></ul><br>  Veuillez noter que dans quelques phrases pr√©c√©dentes, nous utilisons le terme ¬´conteneur¬ª, mais ici, il serait plus correct d'utiliser le terme ¬´pod¬ª.  Ces entit√©s sont souvent appel√©es ¬´pods¬ª dans les publications en langue russe, et parfois ¬´pods¬ª, dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> , clarifiant le concept de ¬´pod¬ª, elles parlent de ¬´troupeau de baleines¬ª (pod de baleines) ou de ¬´pod de pois¬ª mais personne ne les appelle "troupeaux" ou "pods".  En parlant d'eux, nous utiliserons le mot ¬´sous¬ª.  Maintenant, vous pouvez les consid√©rer comme des conteneurs, nous parlerons plus en d√©tail des pods ci-dessous. <br><br>  Nous nous arr√™terons ici pour le moment, car nous pouvons parler de tout cela plus loin, et, en plus, il y a beaucoup de bons mat√©riaux concernant la th√©orie de Kubernetes.  Par exemple, il s'agit d'une documentation officielle, bien qu'elle ne soit pas facile √† lire, ou de livres comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">celui-ci</a> . <br><br><h3>  <font color="#3AC1EF">‚ñç Standardisation du travail avec les fournisseurs de services cloud</font> </h3><br>  Une autre force de Kubernetes r√©side dans le fait que cette technologie contribue √† la standardisation du travail avec les prestataires de services cloud (Cloud Service Provider, CSP).  Ceci est une d√©claration audacieuse.  Prenons l'exemple suivant.  Un sp√©cialiste qui conna√Æt bien Azure ou Google Cloud Platform doit travailler sur un projet con√ßu pour un environnement cloud compl√®tement nouveau pour lui, avec lequel il n'est pas familier.  Dans cette situation, beaucoup de choses peuvent mal tourner.  Par exemple, les d√©lais de livraison du projet peuvent √™tre perturb√©s, la soci√©t√© cliente du projet peut avoir besoin de louer plus de ressources cloud que pr√©vu, etc. <br><br>  Lors de l'utilisation de Kubernetes, un tel probl√®me ne peut tout simplement pas se poser, car, quel que soit le fournisseur de services cloud dont nous parlons, travailler avec Kubernetes a toujours la m√™me apparence.  Le d√©veloppeur, dans un style d√©claratif, indique au serveur API ce dont il a besoin, et Kubernetes travaille avec les ressources du syst√®me, ce qui permet au d√©veloppeur d'ignorer les d√©tails de la mise en ≈ìuvre de ce syst√®me. <br><br>  Attardez-vous un peu sur cette id√©e, car il s'agit d'une opportunit√© Kubernetes tr√®s puissante.  Pour les entreprises, cela signifie que leurs d√©cisions ne sont pas li√©es √† un CSP sp√©cifique.  Si une entreprise trouve une meilleure offre sur le march√© des services cloud, elle peut librement profiter de cette offre en passant √† un nouveau fournisseur.  De plus, l'exp√©rience acquise par les sp√©cialistes de l'entreprise ne se perd nulle part. <br><br>  Parlons maintenant de l'utilisation pratique de Kubernetes <br><br><h2>  <font color="#3AC1EF">Pratique Kubernetes: Pods</font> </h2><br>  Nous avons configur√© le lancement de microservices dans des conteneurs, le processus de configuration a √©t√© assez fastidieux, mais nous avons r√©ussi √† arriver √† un syst√®me fonctionnel.  De plus, comme d√©j√† mentionn√©, notre solution ne s'adapte pas bien et ne r√©siste pas aux pannes.  Nous allons r√©soudre ces probl√®mes avec Kubernetes.  Ensuite, nous am√®nerons notre syst√®me sous une forme correspondant au sch√©ma suivant.  √Ä savoir, les conteneurs seront g√©r√©s par Kubernetes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/53d/19c/3ba/53d19c3bac2f8cdd66213c9b34e7b05b.png"></div><br>  <i><font color="#999999">Les microservices fonctionnent dans un cluster g√©r√© par Kubernetes</font></i> <br><br>  Ici, nous utiliserons Minikube pour le d√©ploiement local du cluster et pour tester les capacit√©s de Kubernetes, bien que tout ce que nous ferons ici puisse se faire √† l'aide de plateformes cloud telles qu'Azure ou Google Cloud Platform. <br><br><h3>  <font color="#3AC1EF">‚ñçInstallation et d√©marrage de Minikube</font> </h3><br>  Pour installer Minikube, suivez les instructions de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> .  Lors de l'installation de Minikube, vous installerez √©galement Kubectl.  Il s'agit d'un client qui permet de faire des demandes au serveur API Kubernetes. <br><br>  Pour d√©marrer Minikube, ex√©cutez la commande de <code>minikube start</code> et, une fois celle-ci termin√©e, ex√©cutez la commande <code>kubectl get nodes</code> .  Par cons√©quent, vous devriez voir quelque chose comme ceci: <br><br><pre> <code class="plaintext hljs">kubectl get nodes NAME       STATUS ROLES     AGE VERSION minikube   Ready &lt;none&gt;    11m v1.9.0</code> </pre> <br>  Minikube met √† notre disposition un cluster compos√© d'un seul n≈ìud.  Certes, cela nous convient assez bien.  Ceux qui travaillent avec Kubernetes n'ont pas √† se soucier du nombre exact de n≈ìuds dans le cluster, car Kubernetes vous permet de faire abstraction de ces d√©tails. <br><br>  Parlons maintenant des pods. <br><br><h3>  <font color="#3AC1EF">‚ñçPods</font> </h3><br>  J'aime vraiment les conteneurs, et vous les aimez probablement aussi maintenant.  Pourquoi Kubernetes nous propose-t-il d'utiliser des pods, des entit√©s qui sont les unit√©s informatiques minimum d√©ployables dans ce syst√®me?  Sous quelles fonctions exerce-t-il?  Le fait est que l'√¢tre peut comprendre un ou plusieurs conteneurs partageant le m√™me temps d'ex√©cution. <br><br>  Mais est-il n√©cessaire de r√©aliser, par exemple, deux conteneurs dans un foyer?  Comment dire ... Habituellement, il n'y a qu'un seul conteneur par conteneur, et c'est ce que nous allons faire.  Mais dans les cas o√π, par exemple, deux conteneurs ont besoin d'un acc√®s partag√© au m√™me entrep√¥t de donn√©es, ou si une connexion est √©tablie entre eux √† l'aide de la technique de communication interprocessus, ou s'ils sont √©troitement connect√©s pour une autre raison, tout cela peut √™tre r√©alis√© en les faisant fonctionner dans un seul foyer.  Une autre possibilit√© que les pods diff√®rent est qu'ils n'ont pas √† utiliser de conteneurs Docker.  Si n√©cessaire, vous pouvez appliquer ici d'autres technologies pour la conteneurisation d'applications, par exemple - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Rkt</a> . <br><br>  Le diagramme suivant montre les propri√©t√©s num√©rot√©es de l'√¢tre. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4f6/2a4/bb1/4f62a4bb18bddccc49a9d224a4aa919d.png"></div><br>  <i><font color="#999999">Propri√©t√©s du foyer</font></i> <br><br>  Consid√©rez ces propri√©t√©s. <br><br><ol><li>  Chaque pod d'un cluster Kubernetes poss√®de une adresse IP unique. </li><li>  Un foyer peut contenir de nombreux conteneurs.  Ils partagent les num√©ros de port disponibles, c'est-√†-dire qu'ils peuvent par exemple √©changer des informations via <code>localhost</code> (naturellement, ils ne peuvent pas utiliser les m√™mes ports).  L'interaction avec les conteneurs situ√©s dans d'autres pods est organis√©e √† l'aide des adresses IP de ces pods. </li><li>  Les conteneurs dans les modules partagent les volumes de stockage de donn√©es, l'adresse IP, les num√©ros de port et l'espace de noms IPC. </li></ol><br>  Il convient de noter que les conteneurs ont leurs propres syst√®mes de fichiers isol√©s, mais ils peuvent partager des donn√©es √† l'aide de la ressource Kubernetes appel√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Volume</a> . <br><br>  Pour nous, ce qui a d√©j√† √©t√© dit sur les foyers est suffisant pour continuer √† ma√Ætriser les Kubernetes.  En savoir plus √† leur sujet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br><h3>  <font color="#3AC1EF">‚ñç Description du foyer</font> </h3><br>  Ce qui suit est un fichier manifeste pour l'application <code>sa-frontend</code> . <br><br><pre> <code class="plaintext hljs">apiVersion: v1 kind: Pod                                            # 1 metadata: name: sa-frontend                                  # 2 spec:                                                # 3 containers:   - image: rinormaloku/sentiment-analysis-frontend # 4     name: sa-frontend                              # 5     ports:       - containerPort: 80</code> </pre> <br>  Expliquons certains des param√®tres qui y sont sp√©cifi√©s. <br><br><ol><li>  <code>Kind</code> : sp√©cifie le type de ressource Kubernetes que nous voulons cr√©er.  Dans notre cas, c'est <code>Pod</code> . </li><li>  <code>Name</code> : nom de la ressource.  Nous l'avons appel√© <code>sa-frontend</code> . </li><li>  <code>Spec</code> : un objet qui d√©crit l'√©tat souhait√© de la ressource.  La propri√©t√© la plus importante ici est le tableau de conteneurs. </li><li>  <code>Image</code> : l'image du conteneur que nous voulons ex√©cuter dans ce pod. </li><li>  <code>Name</code> : un nom unique pour le conteneur en dessous. </li><li>  <code>ContainerPort</code> : le port sur lequel le conteneur √©coute.  Ce param√®tre peut √™tre consid√©r√© comme une indication pour qui lit ce fichier (si vous omettez ce param√®tre, cela ne limitera pas l'acc√®s au port). </li></ol><br><h3>  <font color="#3AC1EF">‚ñçCr√©ation d'un foyer SA-Frontend</font> </h3><br>  Le fichier de description du pod dont nous avons parl√© se trouve dans <code>resource-manifests/sa-frontend-pod.yaml</code> .  Vous devez soit acc√©der √† ce dossier √† l'aide des outils du terminal, soit, lorsque vous appelez la commande appropri√©e, sp√©cifier le chemin d'acc√®s complet au fichier.  Voici cette commande et un exemple de r√©action du syst√®me √† celle-ci: <br><br><pre> <code class="plaintext hljs">kubectl create -f sa-frontend-pod.yaml pod "sa-frontend" created</code> </pre> <br>  Afin de savoir si cela fonctionne sous, ex√©cutez la commande suivante: <br><br><pre> <code class="plaintext hljs">kubectl get pods NAME                          READY STATUS RESTARTS AGE sa-frontend                   1/1 Running 0 7s</code> </pre> <br>  Si l'√©tat de l'√¢tre pendant l'ex√©cution de cette commande est <code>ContainerCreating</code> , vous pouvez ex√©cuter la m√™me commande avec le <code>--watch</code> .  Pour cette raison, lorsque le foyer est en √©tat de fonctionnement, des informations √† ce sujet s'affichent automatiquement. <br><br><h3>  <font color="#3AC1EF">‚ñçAcc√®s √† l'application depuis l'ext√©rieur</font> </h3><br>  Afin d'organiser l'acc√®s √† l'application depuis l'ext√©rieur, il sera correct de cr√©er une ressource Kubernetes de type Service, dont nous parlerons ci-dessous, mais ici, pour plus de bri√®vet√©, nous utiliserons une simple redirection de port: <br><br><pre> <code class="plaintext hljs">kubectl port-forward sa-frontend 88:80 Forwarding from 127.0.0.1:88 -&gt; 80</code> </pre> <br>  Si vous passez maintenant par un navigateur √† <code>127.0.0.1:88</code> , vous pouvez voir la page d'application React. <br><br><h3>  <font color="#3AC1EF">‚ñç Mauvaise approche de mise √† l'√©chelle</font> </h3><br>  Nous avons d√©j√† dit que l'une des capacit√©s de Kubernetes est la mise √† l'√©chelle des applications.  Pour profiter de cette opportunit√©, nous en ex√©cuterons une autre.  Cr√©ez une description d'une autre ressource <code>Pod</code> en pla√ßant le code suivant dans le fichier <code>sa-frontend-pod2.yaml</code> : <br><br><pre> <code class="plaintext hljs">apiVersion: v1 kind: Pod                                           metadata: name: sa-frontend2      #   spec:                                                containers:   - image: rinormaloku/sentiment-analysis-frontend     name: sa-frontend                                  ports:       - containerPort: 80</code> </pre> <br>  Comme vous pouvez le voir, si vous comparez cette description avec ce que nous avons examin√© ci-dessus, le seul changement est la valeur de la propri√©t√© <code>Name</code> . <br><br>  Cr√©ez-en un nouveau sous: <br><br><pre> <code class="plaintext hljs">kubectl create -f sa-frontend-pod2.yaml pod "sa-frontend2" created</code> </pre> <br>  Assurez-vous qu'il fonctionne: <br><br><pre> <code class="plaintext hljs">kubectl get pods NAME                          READY STATUS RESTARTS AGE sa-frontend                   1/1 Running 0 7s sa-frontend2                  1/1 Running 0 7s</code> </pre> <br>  Maintenant, nous avons deux foyers!  Certes, il n'y a rien de sp√©cial √† appr√©cier ici.  Veuillez noter que la solution au probl√®me de mise √† l'√©chelle des applications pr√©sent√©e ici pr√©sente de nombreux inconv√©nients.  Nous verrons comment le faire correctement dans la section sur une autre ressource Kubernetes appel√©e D√©ploiement. <br><br>  Consid√©rez maintenant ce que nous avons obtenu apr√®s avoir lanc√© deux foyers identiques.  √Ä savoir, le serveur Web Nginx s'ex√©cute d√©sormais dans deux modules diff√©rents.  √Ä cet √©gard, nous pouvons poser deux questions: <br><br><ol><li>  Comment donner acc√®s √† ces serveurs de l'ext√©rieur, par URL? </li><li>  Comment organiser l'√©quilibrage de charge entre eux? </li></ol><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ff/3a9/6f4/1ff3a96f4b930fe55727d1063b3c117b.png"></div><br>  <i><font color="#999999">Mauvaise approche de mise √† l'√©chelle</font></i> <br><br>  Parmi les outils Kubernetes, il existe des ressources du formulaire Service.  Parlons-en. <br><br><h2>  <font color="#3AC1EF">Pratique Kubernetes: Services</font> </h2><br>  Les services Kubernetes agissent comme des points d'acc√®s aux ensembles de foyers qui offrent les m√™mes fonctionnalit√©s que ces foyers.  Les services effectuent la solution des t√¢ches difficiles consistant √† travailler avec des foyers et √† √©quilibrer la charge entre eux. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bbd/95f/bd8/bbd95fbd8562bed4a09ab4930a20f98d.png"></div><br>  <i><font color="#999999">Le service Kubernetes sert des adresses IP</font></i> <br><br>  Dans notre cluster Kubernetes, il y aura des pods qui impl√©menteront diff√©rentes fonctions.  Il s'agit d'une application frontale, d'une application Web Spring et d'une application Flask √©crite en Python.  Cela soul√®ve la question de savoir comment le service doit comprendre avec quel type de pods il doit travailler, c'est-√†-dire comment trouver sur la base de quelles informations le syst√®me doit g√©n√©rer une liste de points de terminaison pour les pods. <br><br>  Cela se fait avec une autre abstraction Kubernetes appel√©e Label.  Le travail avec les balises comprend deux √©tapes: <br><br><ol><li>  L'attribution d'√©tiquette donnera le service avec lequel travailler. </li><li>  En appliquant un ¬´s√©lecteur¬ª au service, qui d√©termine les pods auxquels les √©tiquettes sont affect√©es, le service fonctionnera. </li></ol><br>  C'est peut-√™tre plus facile √† imaginer comme illustration qu'√† d√©crire. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bb9/fcf/f0c/bb9fcff0cded591f1a5ab8a0b825245a.png"></div><br>  <i><font color="#999999">Pods √©tiquet√©s et leurs fichiers manifestes</font></i> <br><br>  Nous voyons ici deux foyers qui, √† l'aide de la construction <code>app: sa-frontend</code> , se voient attribuer les m√™mes √©tiquettes.  Le service s'int√©resse aux pods avec de telles marques. <br><br><h3>  <font color="#3AC1EF">‚ñç√âtiquettes</font> </h3><br>  Les √©tiquettes offrent aux d√©veloppeurs un moyen simple d'organiser les ressources Kubernetes.  Ce sont des paires cl√©-valeur; vous pouvez les affecter √† toutes les ressources.  Modifiez les fichiers de description du foyer de l'application frontale et amenez-les √† la vue illustr√©e dans la figure pr√©c√©dente.  Apr√®s cela, enregistrez ces fichiers et ex√©cutez les commandes suivantes: <br><br><pre> <code class="plaintext hljs">kubectl apply -f sa-frontend-pod.yaml Warning: kubectl apply should be used on resource created by either kubectl create --save-config or kubectl apply pod "sa-frontend" configured kubectl apply -f sa-frontend-pod2.yaml Warning: kubectl apply should be used on resource created by either kubectl create --save-config or kubectl apply pod "sa-frontend2" configured</code> </pre> <br>  Lorsque ces commandes sont ex√©cut√©es, le syst√®me √©met des avertissements (cela ne nous convient pas que nous utilisons <code>apply</code> au lieu de <code>create</code> , nous le comprenons), mais, apr√®s un avertissement, il signale que les pods correspondants sont configur√©s.  Nous pouvons v√©rifier si des √©tiquettes ont √©t√© attribu√©es aux √©tiquettes, en filtrant les journaux pour lesquels nous voulons afficher des informations: <br><br><pre> <code class="plaintext hljs">kubectl get pod -l app=sa-frontend NAME           READY STATUS    RESTARTS AGE sa-frontend    1/1 Running   0 2h sa-frontend2   1/1 Running   0 2h</code> </pre> <br>  Une autre fa√ßon de v√©rifier que des √©tiquettes ont bien √©t√© attribu√©es aux √©tiquettes consiste √† attacher la <code>--show-labels</code> √† la commande pr√©c√©dente.  Pour cette raison, les informations sur leurs modules incluront √©galement des donn√©es sur leurs marques. <br><br>  Maintenant, des balises ont √©t√© attribu√©es et nous sommes pr√™ts √† configurer le service pour fonctionner avec eux.  Par cons√©quent, nous traiterons une description d'un service tel que <code>LoadBalancer</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e0f/081/7e9/e0f0817e9fc090628aa1d0d89577ce80.gif"></div><br>  <i><font color="#999999">√âquilibrage de charge √† l'aide d'un service tel que LoadBalancer</font></i> <br><br><h3>  <font color="#3AC1EF">‚ñç Description du service</font> </h3><br>  Voici une description YAML d'un service comme <code>LoadBalancer</code> : <br><br><pre> <code class="plaintext hljs">apiVersion: v1 kind: Service              # 1 metadata: name: sa-frontend-lb spec: type: LoadBalancer       # 2 ports: - port: 80               # 3   protocol: TCP          # 4   targetPort: 80         # 5 selector:                # 6   app: sa-frontend       # 7</code> </pre> <br>  Expliquez ce texte: <br><br><ol><li>  <code>Kind</code> : nous cr√©ons un service, une ressource <code>Service</code> . </li><li>  <code>Type</code> : le type de ressource indiqu√© dans sa sp√©cification.  Nous avons choisi le type <code>LoadBalancer</code> , car avec ce service nous voulons r√©soudre le probl√®me d'√©quilibrage de la charge entre les foyers. </li><li>  <code>Port</code> : port sur lequel le service accepte les requ√™tes. </li><li>  <code>Protocol</code> : protocole utilis√© par le service. </li><li>  <code>TargetPort</code> : port vers lequel les demandes entrantes sont redirig√©es. </li><li>  <code>Selector</code> : un objet contenant des informations sur les pods avec lesquels le service devrait fonctionner. </li><li>  <code>app: sa-frontend</code> : cette propri√©t√© indique avec quels pods le service fonctionnera.  √Ä savoir, ce sont les pods auxquels l'√©tiquette <code>app: sa-frontend</code> a √©t√© attribu√©e. </li></ol><br>  Pour cr√©er un service, vous devez ex√©cuter la commande suivante: <br><br><pre> <code class="plaintext hljs">kubectl create -f service-sa-frontend-lb.yaml service "sa-frontend-lb" created</code> </pre> <br>  Vous pouvez v√©rifier l'√©tat du service comme suit: <br><br><pre> <code class="plaintext hljs">kubectl get svc NAME             TYPE CLUSTER-IP      EXTERNAL-IP PORT(S) AGE sa-frontend-lb   LoadBalancer 10.101.244.40   &lt;pending&gt; 80:30708/TCP 7m</code> </pre> <br>  Ici, vous pouvez voir que la propri√©t√© <code>EXTERNAL-IP</code> est dans l'√©tat <code>&lt;pending&gt;</code> , mais vous ne pouvez pas attendre de la changer.  Cela est d√ª au fait que nous utilisons Minikube.  Si nous avons cr√©√© un service similaire en travaillant avec un certain fournisseur de services cloud, tel qu'Azure ou la plateforme Google Cloud, alors le service aurait une adresse IP publique qui permettrait d'y acc√©der depuis Internet. <br><br>  Malgr√© cela, Minikube ne nous permettra pas de d√©conner, nous donnant une commande utile pour le d√©bogage local du syst√®me: <br><br><pre> <code class="plaintext hljs">minikube service sa-frontend-lb Opening kubernetes service default/sa-frontend-lb in default browser...</code> </pre> <br>  Gr√¢ce √† cette commande, un navigateur sera lanc√© qui acc√©dera au service.  Une fois que le service a re√ßu la demande, il la redirige vers l'un des foyers (peu importe celui sous lequel il se trouve).  Cette abstraction nous permet de percevoir un groupe de foyers comme une entit√© unique et de travailler avec eux, en utilisant le service comme point d'acc√®s unique √† eux. <br><br>  Dans cette section, nous avons expliqu√© comment attribuer des √©tiquettes aux ressources, comment les utiliser lors de la configuration des services en tant que s√©lecteurs.  Ici, nous avons d√©crit et cr√©√© un service comme <code>LoadBalancer</code> .  Gr√¢ce √† cela, nous avons r√©solu le probl√®me de mise √† l'√©chelle de l'application (la mise √† l'√©chelle consiste √† ajouter de nouveaux foyers avec les √©tiquettes correspondantes au cluster) et √† organiser l'√©quilibrage de charge entre les foyers en utilisant le service comme point d'entr√©e. <br><br><h2>  <font color="#3AC1EF">Pratique Kubernetes: D√©ploiements</font> </h2><br>  Le d√©ploiement est une abstraction de Kubernetes qui nous permet de contr√¥ler ce qui est toujours pr√©sent dans le cycle de vie de l'application.  Il s'agit de g√©rer les changements d'application.  Les applications qui ne changent pas sont pour ainsi dire des applications ¬´mortes¬ª.  Si l'application "vit", vous pouvez rencontrer le fait que ses exigences changent p√©riodiquement, son code se d√©veloppe, ce code est empaquet√© et d√©ploy√©.  De plus, des erreurs peuvent √™tre commises √† chaque √©tape du processus. <br><br>  Une ressource de type D√©ploiement vous permet d'automatiser le processus de transition d'une version d'une application √† une autre.  Cela se fait sans interrompre le syst√®me, et si une erreur se produit pendant ce processus, nous aurons la possibilit√© de revenir rapidement √† la version de travail pr√©c√©dente de l'application. <br><br><h3>  <font color="#3AC1EF">‚ñçUtilisation des d√©ploiements</font> </h3><br>  Maintenant, le cluster dispose de deux foyers et d'un service qui leur donne acc√®s de l'ext√©rieur et √©quilibre la charge sur eux. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/426/651/0c4/4266510c40a1faa6086178e5db23d20c.png"></div><br>  <i><font color="#999999">√âtat actuel du cluster</font></i> <br><br>  Nous avons parl√© du fait que faire fonctionner deux foyers diff√©rents avec la m√™me fonctionnalit√© n'est pas une bonne id√©e.  Lors de l'utilisation d'un tel sch√©ma, nous devons travailler avec chaque foyer individuellement, cr√©er, mettre √† jour, supprimer chaque foyer sp√©cifique, observer son √©tat.  Avec cette approche, il n'est pas n√©cessaire de parler d'une mise √† jour rapide du syst√®me ou de la restauration rapide d'une mise √† jour infructueuse.  Nous ne sommes pas satisfaits de cet √©tat de fait, nous allons donc recourir √† la possibilit√© de ressources de d√©ploiement, qui vise √† r√©soudre les probl√®mes ci-dessus. <br><br>  Avant de poursuivre le travail, formulons ses objectifs, qui nous donneront des directives qui seront utiles lors de l'analyse du fichier manifeste de d√©ploiement.  Voici donc ce dont nous avons besoin: <br><br><ol><li>  Nous voulons √™tre en mesure de cr√©er deux foyers bas√©s sur un conteneur <code>rinormaloku/sentiment-analysis-frontend</code> . </li><li>  Nous avons besoin d'un syst√®me de d√©ploiement d'applications qui lui permet de fonctionner sans interruption lors de sa mise √† jour. </li><li>  Nous voulons que le libell√© de l' <code>app: sa-frontend</code> soit attribu√© <code>app: sa-frontend</code> , qui permettra au service <code>sa-frontend-lb</code> de d√©tecter ces pods. </li></ol><br>  Nous allons maintenant exprimer ces exigences sous la forme d'une description de la ressource de d√©ploiement. <br><br><h3>  <font color="#3AC1EF">‚ñç Description du d√©ploiement</font> </h3><br>  Voici une description YAML d'une ressource de type d√©ploiement, qui a √©t√© cr√©√©e en tenant compte des exigences syst√®me ci-dessus: <br><br><pre> <code class="plaintext hljs">apiVersion: extensions/v1beta1 kind: Deployment                                          # 1 metadata: name: sa-frontend spec: replicas: 2                                             # 2 minReadySeconds: 15 strategy:   type: RollingUpdate                                   # 3   rollingUpdate:     maxUnavailable: 1                                   # 4     maxSurge: 1                                         # 5 template:                                               # 6   metadata:     labels:       app: sa-frontend                                  # 7   spec:     containers:       - image: rinormaloku/sentiment-analysis-frontend         imagePullPolicy: Always                         # 8         name: sa-frontend         ports:           - containerPort: 80</code> </pre> <br>  Analysons cette description: <br><br><ol><li>  <code>Kind</code> : il est dit ici que nous d√©crivons une ressource de la vue <code>Deployment</code> . </li><li>  <code>Replicas</code> : propri√©t√© de l'objet de sp√©cification de d√©ploiement qui d√©finit le nombre d'instances (r√©pliques) de foyers √† ex√©cuter. </li><li>  <code>Type</code> : d√©crit la strat√©gie utilis√©e dans ce d√©ploiement lors du passage de la version actuelle √† une nouvelle.  <code>RollingUpdate</code> strat√©gie <code>RollingUpdate</code> n'offre aucun temps d'arr√™t du syst√®me lors des mises √† niveau. </li><li>  <code>MaxUnavailable</code> : il s'agit d'une propri√©t√© de l'objet <code>RollingUpdate</code> , qui d√©finit le nombre maximal de foyers non disponibles (par rapport au nombre souhait√© de foyers) lors de la mise √† jour s√©quentielle du syst√®me.  Dans notre d√©ploiement, qui implique la pr√©sence de 2 r√©pliques, la valeur de cette propri√©t√© indique qu'apr√®s l'ach√®vement d'un pod, un autre sera ex√©cut√©, ce qui rend l'application disponible lors de la mise √† jour. </li><li>  <code>MaxSurge</code> : il s'agit d'une propri√©t√© de l'objet <code>RollingUpdate</code> qui d√©crit le nombre maximal de foyers pouvant √™tre ajout√©s √† un d√©ploiement (par rapport √† un nombre donn√© de foyers).  Dans notre cas, sa valeur, 1, signifie que, lors du passage √† une nouvelle version du programme, nous pouvons ajouter un autre sous-cluster, ce qui conduira au fait que jusqu'√† trois foyers peuvent √™tre lanc√©s simultan√©ment. </li><li>  <code>Template</code> : cet objet d√©finit le mod√®le de foyer que la ressource de <code>Deployment</code> d√©crite utilisera pour cr√©er de nouveaux foyers.  Vous trouverez probablement ce param√®tre familier. </li><li>  <code>app: sa-frontend</code> : √©tiquette pour les foyers cr√©√©s selon un mod√®le donn√©. </li><li>  <code>ImagePullPolicy</code> : d√©finit l'ordre de travail avec les images.  Dans notre cas, cette propri√©t√© est d√©finie sur <code>Always</code> , c'est-√†-dire que lors de chaque d√©ploiement, l'image correspondante sera t√©l√©charg√©e √† partir du r√©f√©rentiel. </li></ol><br>  Apr√®s avoir examin√© tout cela, passons √† la pratique.  Ex√©cutez le d√©ploiement: <br><br><pre> <code class="plaintext hljs">kubectl apply -f sa-frontend-deployment.yaml deployment "sa-frontend" created</code> </pre> <br>  V√©rifiez l'√©tat du syst√®me: <br><br><pre> <code class="plaintext hljs">kubectl get pods NAME                           READY STATUS RESTARTS AGE sa-frontend                    1/1 Running 0 2d sa-frontend-5d5987746c-ml6m4   1/1 Running 0 1m sa-frontend-5d5987746c-mzsgg   1/1 Running 0 1m sa-frontend2                   1/1 Running 0 2d</code> </pre> <br>  Comme vous pouvez le voir, nous avons maintenant 4 pods.  Deux d'entre eux ont √©t√© cr√©√©s √† l'aide de la ressource D√©ploiement, deux autres sont ceux que nous avons cr√©√©s nous-m√™mes.  Vous pouvez maintenant supprimer les pods que nous avons cr√©√©s nous-m√™mes √† l'aide de commandes du type suivant: <br><br><pre> <code class="plaintext hljs">kubectl delete pod &lt;pod-name&gt;</code> </pre> <br>  Au fait, voici une mission pour un travail ind√©pendant.  Supprimez l'un des foyers cr√©√©s √† l'aide de la ressource D√©ploiement et surveillez le syst√®me.  R√©fl√©chissez aux raisons de ce qui se passe avant de continuer √† lire. <br><br>  Lors de la suppression d'un foyer, la ressource D√©ploiement apprend que l'√©tat actuel du syst√®me (1 sous) est diff√©rent de celui souhait√© (2 sous), donc un autre sous est lanc√©. <br><br>  Quelle est l'utilisation des ressources de d√©ploiement, outre le fait que, lorsqu'elles sont utilis√©es, le syst√®me est maintenu dans le bon √©tat?  Consid√©rez les points forts de ces ressources. <br><br><h3>  <font color="#3AC1EF">‚ñç R√©alisation de d√©ploiements sans interruption du syst√®me</font> </h3><br>  Supposons qu'un chef de produit vienne nous voir et signale que le client pour lequel nous avons cr√©√© ce produit veut un bouton vert dans l'application cliente.  Les d√©veloppeurs impl√©mentent cette exigence et nous donnent la seule chose dont nous avons besoin d'eux - un conteneur d'images appel√© <code>rinormaloku/sentiment-analysis-frontend:green</code> .  Maintenant vient notre temps.  Nous, l'√©quipe DevOps, devons d√©ployer le syst√®me mis √† jour et garantir un temps d'arr√™t nul.  Voyons maintenant si les efforts pour d√©velopper et configurer la ressource de d√©ploiement sont justifi√©s. <br><br>  Modifiez le fichier <code>sa-frontend-deployment.yaml</code> , en rempla√ßant le nom du conteneur d'images par un nouveau, avec <code>rinormaloku/sentiment-analysis-frontend:green</code> , puis enregistrez ce fichier sous <code>sa-frontend-deployment-green.yaml</code> et ex√©cutez la commande suivante: <br><br><pre> <code class="plaintext hljs">kubectl apply -f sa-frontend-deployment-green.yaml --record deployment "sa-frontend" configured</code> </pre> <br>  V√©rifiez l'√©tat du syst√®me avec la commande suivante: <br><br><pre> <code class="plaintext hljs">kubectl rollout status deployment sa-frontend Waiting for rollout to finish: 1 old replicas are pending termination... Waiting for rollout to finish: 1 old replicas are pending termination... Waiting for rollout to finish: 1 old replicas are pending termination... Waiting for rollout to finish: 1 old replicas are pending termination... Waiting for rollout to finish: 1 old replicas are pending termination... Waiting for rollout to finish: 1 of 2 updated replicas are available... deployment "sa-frontend" successfully rolled out</code> </pre> <br>  Conform√©ment aux donn√©es affich√©es en r√©ponse √† cette commande, nous pouvons conclure que le d√©ploiement de la mise √† jour a r√©ussi.  Lors de la mise √† niveau, les anciennes r√©pliques, une √† la fois, ont √©t√© remplac√©es par de nouvelles.  ,   ,    ,   .     ,    ,    . <br><br><h4>   </h4><br>      ,     ,     : <br><br><pre> <code class="plaintext hljs">minikube service sa-frontend-lb</code> </pre> <br>       ,      . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/777/489/902/777489902694f46438ceae41ce59db9b.png"></div><br> <i><font color="#999999"> </font></i> <br><br>  ,     ,  ‚Äî    . <br><br><h4>      RollingUpdate </h4><br>  ,     <code>kubectl apply -f sa-frontend-deployment-green.yaml --record</code> , Kubernetes   ,     ,    .         ,       ,    <code>rinormaloku/sentiment-analysis-frontend:green</code> .       ,    ,   . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/465/7ee/290/4657ee29097dc99e4fa2a0ebd9180e7a.png"></div><br> <i><font color="#999999">     </font></i> <br><br>  <code>RollingUpdate</code>       ,  ,     <code>maxUnavailable: 1</code>  <code>maxSurge: 1</code> .  ,   Deployment ,     ,    ,     .  ,    ,    ,         . <br><br>         Deployment.     ,   .      . <br><br><h3> <font color="#3AC1EF">‚ñç    </font> </h3><br>   ,   ,   . ¬´!  !    !¬ª, ‚Äî  .        . ,   ,      : <br><br><pre> <code class="plaintext hljs">kubectl rollout history deployment sa-frontend deployments "sa-frontend" REVISION  CHANGE-CAUSE 1         &lt;none&gt;    2         kubectl.exe apply --filename=sa-frontend-deployment-green.yaml --record=true</code> </pre> <br>          : ¬´,    ,    ?¬ª. <br><br> ¬´.  ,   ?¬ª, ‚Äî   . <br><br>  ,         ,     : <br><br><pre> <code class="plaintext hljs">kubectl rollout undo deployment sa-frontend --to-revision=1 deployment "sa-frontend" rolled back</code> </pre> <br>      .   ,      . <br><br>       . <br><br>       . <br><br> ! <br><br>   ,  .   Kubernetes         ,  ,      . ,   ! <br><br>           . ,       .  <code>CHANGE-CAUSE</code>      <code>&lt;none&gt;</code> ,    ‚Äî <code>kubectl.exe apply ‚Äìfilename=sa-frontend-deployment-green.yaml ‚Äìrecord=true</code> ? <br><br>   ,         -- <code>record</code>     ,    . <br><br>       ,   ,  ,      . <br><br><h2> <font color="#3AC1EF">   Kubernetes:    </font> </h2><br>      Kubernetes,    ,     .      ,     . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7cb/af4/880/7cbaf4880d435df50761d22508f61e83.png"></div><br> <i><font color="#999999">  </font></i> <br><br>       . <br><br><h3> <font color="#3AC1EF">‚ñç  sa-logic</font> </h3><br>        <code>resource-manifests</code>    : <br><br><pre> <code class="plaintext hljs">kubectl apply -f sa-logic-deployment.yaml --record deployment "sa-logic" created</code> </pre> <br>  <code>sa-logic</code>   .     Python-.    <code>app: sa-logic</code> .          <code>sa-logic</code> ,   .   <code>sa-logic-deployment.yaml</code>     . <br><br>  -,        ,      ‚Äî  <code>sa-logic</code> . <br><br><h3> <font color="#3AC1EF">‚ñç sa-logic</font> </h3><br>   ,       Service.   ,   Java-,        <code>sa-webapp</code> ,      ,  Python-.  ,    ,       ,     Python-,   .     ,  ,  ,  . <br><br>      , ,    ,       ,   .  ,      <code>sa-logic</code>   ,       <code>sa-logic</code> . <br><br>   : <br><br><pre> <code class="plaintext hljs">kubectl apply -f service-sa-logic.yaml service "sa-logic" created</code> </pre> <br>    ,        . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/693/79b/3e3/69379b3e373ad1bc728242db341411ab.png"></div><br> <i><font color="#999999">  </font></i> <br><br>   <code>sa-logic</code> ,   <code>sa-webapp</code> ,    ,    . <br><br>   <code>sa-webapp</code> . <br><br><h3> <font color="#3AC1EF">‚ñç  sa-webapp</font> </h3><br>      ,          Deployment    - . ,     <code>sa-web-app-deployment.yaml</code> ,      : <br><br><pre> <code class="plaintext hljs">- image: rinormaloku/sentiment-analysis-web-app imagePullPolicy: Always name: sa-web-app env:   - name: SA_LOGIC_API_URL     value: "http://sa-logic" ports:   - containerPort: 8080</code> </pre> <br>     <code>env</code> ?  ,   ,  ,   <code>SA_LOGIC_API_URL</code>   <code>http://sa-logic</code> .   ,    ,       .    ? <br><br>             kube-dns. <br><br><h3> <font color="#3AC1EF">‚ñçDNS-  Kubernetes</font> </h3><br>  Kubernetes   ,   <code>kube-dns</code> .        DNS-.     <code>kube-dns</code>   ,     DNS-    . <br><br>  ,      <code>sa-logic</code> ,   IP-.  <code>kube-dns</code>        IP- .        <code>http://sa-logic</code>  IP-. <br><br>      Deployment <code>sa-webapp</code> . <br><br><h3> <font color="#3AC1EF">‚ñç  sa-webapp</font> </h3><br>   : <br><br><pre> <code class="plaintext hljs">kubectl apply -f sa-web-app-deployment.yaml --record deployment "sa-web-app" created</code> </pre> <br>         <code>sa-webapp</code>   ,   .   React-    ,       <code>sa-webapp</code> . <br><br><h3> <font color="#3AC1EF">‚ñç sa-webapp</font> </h3><br>     <code>service-sa-web-app-lb.yaml</code> ,  ,  ,    ,   . ,   ,   : <br><br><pre> <code class="plaintext hljs">kubectl apply -f service-sa-web-app-lb.yaml service "sa-web-app-lb" created</code> </pre> <br>    . ,     ,      . ,     <code>sa-frontend</code> ,        Java- <code>sa-webapp</code> ,    <code>http://localhost:8080/sentiment</code> .      ,       ,   <code>sa-webapp</code> ,    React-  ,     Java-. <br><br>           ,     . ,          ‚Äî  ,    ,     . <br><br>  ,       : <br><br><ol><li>  IP-   <code>sa-webapp</code> ,   : <br><br> <code>minikube service list <br> |-------------|----------------------|-----------------------------| <br> |  NAMESPACE  | NAME         | URL       | <br> |-------------|----------------------|-----------------------------| <br> | default     | kubernetes         | No node port       | <br> | default     | sa-frontend-lb       | http://192.168.99.100:30708 | <br> | default     | sa-logic         | No node port       | <br> | default     | sa-web-app-lb        | http://192.168.99.100:31691 | <br> | kube-system | kube-dns             | No node port | <br> | kube-system | kubernetes-dashboard | http://192.168.99.100:30000 | <br> |-------------|----------------------|-----------------------------|</code> </li> <li>   IP-   <code>sa-frontend/src/App.js</code> .   ,     : <br><br><pre> <code class="plaintext hljs">analyzeSentence() {       fetch('http://192.168.99.100:31691/sentiment', { /*    */})           .then(response =&gt; response.json())           .then(data =&gt; this.setState(data));   }</code> </pre> </li><li>  React-,       <code>sa-frontend</code>    <code>npm run build</code> . </li><li>   : <br><br><pre> <code class="plaintext hljs">docker build -f Dockerfile -t $DOCKER_USER_ID/sentiment-analysis-frontend:minikube.</code> </pre> </li><li>     Docker Hub: <br><br><pre> <code class="plaintext hljs">docker push $DOCKER_USER_ID/sentiment-analysis-frontend:minikube</code> </pre> </li><li>   <code>sa-frontend-deployment.yaml</code> ,       . </li><li>   : <br><br><pre> <code class="plaintext hljs">kubectl apply -f sa-frontend-deployment.yaml</code> </pre> </li></ol><br>     ,   , ,      ,    <code>minikube service sa-frontend-lb</code> .  ,   - . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/53d/19c/3ba/53d19c3bac2f8cdd66213c9b34e7b05b.png"></div><br> <i><font color="#999999">  </font></i> <br><br><h2>  <font color="#3AC1EF">R√©sum√©</font> </h2><br>   Kubernetes     ,        ,   ,   ,     .  Kubernetes   ,     ,           .    Kubernetes  Supernetes. <br><br>    ,   : <br><br><ul><li> ,    ,   React, Java  Python. </li><li>    Docker,  ,        <code>Dockerfile</code> . </li><li>    ,  ,  Docker Hub. </li></ul><br>  ,     Kubernetes: <br><br><ul><li>  </li><li>  </li><li>  </li><li>           </li><li>   </li></ul><br>      ,   ,   Kubernetes. <br><br>  <b>Chers lecteurs!</b>    Kubernetes? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr438984/">https://habr.com/ru/post/fr438984/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr438974/index.html">La r√©alit√© virtuelle aide √† faire face aux troubles mentaux</a></li>
<li><a href="../fr438976/index.html">Le livre "Spring. Tous les mod√®les de conception ¬ª</a></li>
<li><a href="../fr438978/index.html">Apprendre toujours et partout! Podcasts pour les d√©veloppeurs en anglais</a></li>
<li><a href="../fr438980/index.html">Spring Boot 2: quoi de neuf?</a></li>
<li><a href="../fr438982/index.html">Guide Kubernetes, Partie 1: Applications, microservices et conteneurs</a></li>
<li><a href="../fr438986/index.html">Tutoriel React Partie 14: Atelier sur les composants bas√©s sur les classes, √©tat des composants</a></li>
<li><a href="../fr438988/index.html">Tutoriel React Partie 15: Ateliers sur l'√©tat des composants</a></li>
<li><a href="../fr438992/index.html">Journal du d√©veloppeur ou mauvaises d√©cisions</a></li>
<li><a href="../fr438994/index.html">Intel Xeon W-3175X, un batteur √† chaud. Test</a></li>
<li><a href="../fr438996/index.html">R√©seau d'entreprise et MitM. Partie 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>