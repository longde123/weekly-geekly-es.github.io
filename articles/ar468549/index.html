<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐ญ ๐จ๐ฝโ๐คโ๐จ๐ผ GPU ููุถู. ููููุฉ ููู ูู ุดูุก ุฅูู ุจุทุงูุฉ ุงูููุฏูู ูุฃูุซุฑ ูู ุฐูู ุจูููู. ุงูุฑุณูู ุงููุชุญุฑูุฉ ๐ ๐ฅ ๐บ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุฐุงุช ูุฑุฉ ุ ูุงู ุญุฏุซูุง ูุจูุฑูุง ุนูุฏูุง ุธูุฑุช ูุญุฏุฉ ูุนุงูุฌุฉ ุงููุตูุต ุงููุชุนุฏุฏุฉ ุฃู ุชุญููู ุงูุฃุฌูุฒุฉ ูุงูุฅุถุงุกุฉ ุนูู ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฑุณููุงุช. ูุถุน ุฎุท ุฃูุงุจูุจ ูุธููุฉ ุซุงุจุชุฉ ูุงู ุงู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>GPU ููุถู. ููููุฉ ููู ูู ุดูุก ุฅูู ุจุทุงูุฉ ุงูููุฏูู ูุฃูุซุฑ ูู ุฐูู ุจูููู. ุงูุฑุณูู ุงููุชุญุฑูุฉ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468549/" style=";text-align:right;direction:rtl">  ุฐุงุช ูุฑุฉ ุ ูุงู ุญุฏุซูุง ูุจูุฑูุง ุนูุฏูุง ุธูุฑุช ูุญุฏุฉ ูุนุงูุฌุฉ ุงููุตูุต ุงููุชุนุฏุฏุฉ ุฃู ุชุญููู ุงูุฃุฌูุฒุฉ ูุงูุฅุถุงุกุฉ ุนูู ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฑุณููุงุช.  ูุถุน ุฎุท ุฃูุงุจูุจ ูุธููุฉ ุซุงุจุชุฉ ูุงู ุงูุดุงูุงููุฉ ุงูุณุญุฑูุฉ.  ูุฃููุฆู ุงูุฐูู ูุนุฑููู ููููุฉ ุชูููู ูุงุณุชุฎุฏุงู ุงูููุฒุงุช ุงููุชูุฏูุฉ ูุดุฑุงุฆุญ ูุนููุฉ ูู ุฎูุงู ุงุฎุชุฑุงูุงุช D3D9 API ุ ุงูุฐูู ูุนุชุจุฑูู ุฃููุณูู ูุฏ ุชุนูููุง Zen.  ูููู ูุฑูุฑ ุงูููุช ุ ุธูุฑุช ุชุธููู.  ูู ุงูุจุฏุงูุฉ ุ ูุญุฏูุฏุฉ ุจุดุฏุฉ ุณูุงุก ูู ุงููุธุงุฆู ุฃู ูู ุงูุทูู.  ุนูุงูุฉ ุนูู ุฐูู ุ ุงููุฒูุฏ ูุงููุฒูุฏ ูู ุงูููุฒุงุช ุ ุงููุฒูุฏ ูู ุงูุชุนูููุงุช ุ ุงููุฒูุฏ ูู ุงูุณุฑุนุฉ.  ุธูุฑ ุญุณุงุจ (CUDA ุ OpenCL ุ DirectCompute) ุ ูุจุฏุฃ ูุทุงู ูุฏุฑุงุช ุจุทุงูุฉ ุงูููุฏูู ูู ุงูุชูุณุน ุจุณุฑุนุฉ. <br><br>  ูู ูุฐู ุงูุณูุณูุฉ ูู ุงูููุงูุงุช (ูุฃูู) ุ ุณุฃุญุงูู ุฃู ุฃูุถุญ ููู "ุบูุฑ ุนุงุฏู" ููููู ุชุทุจูู ูุฏุฑุงุช GPU ุงูุญุฏูุซุฉ ุนูุฏ ุชุทููุฑ ุงูุฃูุนุงุจ ุ ุจุงูุฅุถุงูุฉ ุฅูู ุงูุชุฃุซูุฑุงุช ุงูุฑุณูููุฉ.  ุณูุชู ุชุฎุตูุต ุงูุฌุฒุก ุงูุฃูู ููุธุงู ุงูุฑุณูู ุงููุชุญุฑูุฉ.  ูู ูุง ูู ูุจูู ูุณุชูุฏ ุฅูู ุงูุฎุจุฑุฉ ุงูุนูููุฉ ุ ูุชูููุฐูุง ููุนูู ูู ูุดุงุฑูุน ุงููุนุจุฉ ุงูุญููููุฉ. <br><a name="habracut"></a><br>  Oooo ุ ูุฑุฉ ุฃุฎุฑู ุงูุฑุณูู ุงููุชุญุฑูุฉ.  ุญูู ูุฐุง ูุงุฆุฉ ูุฑุฉ ููุชูุจุฉ ุจุงููุนู ููุตููุง.  ูุง ูู ูุนูุฏ ุฌุฏุงุ  ูููู ุจุชุนุจุฆุฉ ูุตูููุฉ ุงูุนุธุงู ูู ุงููุฎุฒู ุงููุคูุช / ุงููููุณ ุ ููุณุชุฎุฏููุง ููุชุณูู ูู ุชุธููู ููุฉ ุงูุฑุฃุณ.  ุชู ุชูุถูุญ ุฐูู ูุฑุฉ ุฃุฎุฑู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">GPU Gems 3 (ุงููุตู 2. ุนุฑุถ ุญุดุฏ ูุชุญุฑู)</a> .  ูููุฐุช ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชูุญูุฏ ุนุฑุถ ุชูุฏููู</a> ุญุฏูุซ.  ูู ูู ุงููููู ุจุทุฑููุฉ ุฃุฎุฑูุ <br><br><h4 style=";text-align:right;direction:rtl">  ุชูููุฏููุง ูู ุงููุญุฏุฉ </h4><br>  ุงููุซูุฑ ูู ุงูุถุฌูุฌ ุ ูููู ูู ูู ุฑุงุฆุน ุญููุงุ  ููุฌุฏ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุงู</a> ูู ุงููุญูุฑ ูุตู ุจุงูุชูุตูู ููููุฉ ุนูู ุงูุฑุณูู ุงููุชุญุฑูุฉ ุงููููููุฉ ููุนูู ูู ูุฐุง ุงูุนุฑุถ ุงูุชูุถูุญู ุงูุชููู.  ุงูุนูู ุงูููุงุฒู ูู ูู ุดูุก ุฌูุฏ ุ ููุญู ูุง ูุนุชุจุฑูุง.  ููููุง ุจุญุงุฌุฉ ุฅูู ูุนุฑูุฉ ูุง ูููู ููุงู ุ ูู ุญูุซ ุงูุชูุฏูู. <br><br>  ูู ูุนุฑูุฉ ูุงุณุนุฉ ุงููุทุงู ุ ููุงุชู ุฌูุดุงู ุ ูุชุฃูู ูู ููููุง ูู ููุน ูุงุญุฏ ูู ุงููุญุฏุงุช.  ููุงูู ุนุธููุฉ ุนูู ุงููุณุงุฑ ุ ูุฑุณุงู ุนูู ุงููููู.  ูุฌููุนุฉ ูุชููุนุฉ  ุชุชููู ูู ูุญุฏุฉ ูู 3 ูููุฏ (~ 300 ุ ~ 1000 ุ ~ 4000 ุฑุฃุณูุง ููู ููููุง) ุ ูุชุคุซุฑ ุนุธุงูุงู ููุท ุนูู ุงูุฑุฃุณ.  ูุชููู ูุธุงู ุงูุฑุณูู ุงููุชุญุฑูุฉ ูู 7 ุฑุณูู ูุชุญุฑูุฉ ููู ููุน ูู ุฃููุงุน ุงููุญุฏุงุช (ุฃุฐูุฑ ุฃูู ููุฌุฏ ุจุงููุนู 2 ูููู).  ูุง ุชูุชุฒุฌ ุงูุฑุณูู ุงููุชุญุฑูุฉ ุ ูููููุง ุชุชุญูู ุจุดูู ูููุฑุฏ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุจุณูุทุฉ ุงูุชู ูุชู ุชูููุฐูุง ูู job'ax ุ ูุงูุชู ูุชู ุงูุชุฃููุฏ ุนูููุง ูู ุงูุนุฑุถ ุงูุชูุฏููู.  ูุง ููุฌุฏ ุฌูุงุฒ ุงูุฏููุฉ.  ุนูุฏูุง ูููู ูุฏููุง ููุนุงู ูู ุงูุดุจูุงุช ุ ููููู ุฌุฐุจ ุงูุญุดุฏ ุจุฃูููู ูู ููุงููุงุช ูุณุญูุจุฉ ุจุฑุณููู.  ุงูุฑุณูู ุงููุชุญุฑูุฉ ูููููู ุงูุนุธูู ุ ููุง ูุชุจุช ุจุงููุนู ุ ุชุนุชูุฏ ุนูู ุงูุชูููููุฌูุง ุงูููุตููุฉ ูู ุนุงู 2009. <br>  ูุจุชูุฑุ  ูู ... ุทูุฑุฉุ  ุฃู ... ููุงุณุจุฉ ููุฃูุนุงุจ ุงูุญุฏูุซุฉุ  ุญุณูุง ุ ุฑุจูุง ุ ูุณุจุฉ FPS ุฅูู ุนุฏุฏ ุงููุญุฏุงุช ุชุจุงูู. <br><br>  ุงูุนููุจ ุงูุฑุฆูุณูุฉ ููุฐุง ุงูููุฌ (ูุง ูุจู ุงููุตูููุฉ ูู ุงูููุงู): <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุนุฏู ุงูุฅุทุงุฑ ูุนุชูุฏ.  ูุทููุจ ุถุนูู ุนุฏุฏ ุฅุทุงุฑุงุช ุงูุฑุณูู ุงููุชุญุฑูุฉ - ุฃุนุท ุถุนู ุงูุฐุงูุฑุฉ. </li><li style=";text-align:right;direction:rtl">  ุนุฏู ูุฒุฌ ุงูุฑุณูู ุงููุชุญุฑูุฉ.  ููููู ุตูุนูุง ุ ุจุงูุทุจุน ุ ูููู ูู ุธูุงู ุงูุฌูุฏ ุ ุณูู ุชุชุดูู ููุถู ูุนูุฏุฉ ูู ููุทู ุงููุฒุฌ. </li><li style=";text-align:right;direction:rtl">  ุนุฏู ูุฌูุฏ ุงุฑุชุจุงุท ุฅูู ุขูุฉ ุงูุญุงูุฉ Unity Animator.  ุฃุฏุงุฉ ููุงุฆูุฉ ูุชุฎุตูุต ุณููู ุงูุดุฎุตูุฉ ุ ูุงูุชู ูููู ุชูุตูููุง ุจุฃู ูุธุงู ููุชุณูู ุ ูููู ูู ุญุงูุชูุง ุ ุจุณุจุจ ุงูููุทุฉ 2 ุ ูุตุจุญ ูู ุดูุก ุตุนุจูุง ููุบุงูุฉ (ุชุฎูู ููููุฉ ูุฒุฌ BlendTree ุงููุชุฏุงุฎูุฉ). </li></ol><br><h4 style=";text-align:right;direction:rtl">  GPAS </h4><br>  GPU ูุธุงู ุงูุฑุณูู ุงููุชุญุฑูุฉ ุจุงูุทุงูุฉ.  ุงูุงุณู ุฌุงุก ููุชู. <br>  ูุงู ููุธุงู ุงูุฑุณูู ุงููุชุญุฑูุฉ ุงูุฌุฏูุฏ ุงูุนุฏูุฏ ูู ุงููุชุทูุจุงุช: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุนูู ุจุณุฑุนุฉ (ุญุณูุง ุ ูููููุฉ).  ุชุญุชุงุฌ ุฅูู ุชุญุฑูู ุนุดุฑุงุช ุงูุขูุงู ูู ุงููุญุฏุงุช ุงููุฎุชููุฉ. </li><li style=";text-align:right;direction:rtl">  ูู ุชูุงุซูููุง ูุงููุงู (ุฃู ุชูุฑูุจูุง) ููุธุงู ุงูุฑุณูู ุงููุชุญุฑูุฉ Unity.  ุฅุฐุง ูุงูุช ููุงู ุฑุณูู ูุชุญุฑูุฉ ุชุจุฏู ููุฐุง ุ ูู ุงููุธุงู ุงูุฌุฏูุฏ ุ ูุฌุจ ุฃู ุชุจุฏู ูุชูุงุซูุฉ ุชูุงููุง.  ุงููุฏุฑุฉ ุนูู ุงูุชุจุฏูู ุจูู ุฃูุธูุฉ CPU ู GPU ุงููุฏูุฌุฉ.  ูุฐุง ุถุฑูุฑู ุบุงูุจุงู ูุชุตุญูุญ ุงูุฃุฎุทุงุก.  ุนูุฏูุง ุชููู ุงูุฑุณูู ุงููุชุญุฑูุฉ "ุนุฑุจุงุช ุงูุชู ุชุฌุฑูุง ุงูุฏูุงุจ" ุ ูู ุฎูุงู ุงูุชุญูู ุฅูู ุงูุฑุณูู ุงููุชุญุฑูุฉ ุงูููุงุณูููุฉ ุ ููููู ููู: ูุฐู ูู ููุงุทู ุงูุฎูู ูู ุงููุธุงู ุงูุฌุฏูุฏ ุ ุฃู ุงูุฌูุงุฒ ุงูุฏููุฉ / ุงูุฑุณูู ุงููุชุญุฑูุฉ ููุณูุง. </li><li style=";text-align:right;direction:rtl">  ุฌููุน ุงูุฑุณูู ุงููุชุญุฑูุฉ ูุงุจูุฉ ููุชุฎุตูุต ูู Unity Animator.  ุฃุฏุงุฉ ูุฑูุญุฉ ููุฎุชุจุฑุฉ ูุงูุฃูู ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู.  ุณูุจูู ุงูุฏุฑุงุฌุงุช ูู ููุงู ุขุฎุฑ. </li></ol><br>  ุฏุนููุง ูููุฑ ูู ุฅุนุฏุงุฏ ูุฎุจุฒ ุงูุฑุณูู ุงููุชุญุฑูุฉ.  ูู ูุณุชุฎุฏู ุงููุตูููุงุช.  ุชุนูู ุจุทุงูุงุช ุงูููุฏูู ุงูุญุฏูุซุฉ ุจุดูู ุฌูุฏ ูุน ุงูุญููุงุช ุ ููุง ุชุฏุนู n int ุจุงูุฅุถุงูุฉ ุฅูู ุงูุทูู ุ ูุฐุง ุณูุนูู ูุน ุฅุทุงุฑุงุช ููุชุงุญูุฉ ูุซู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ. <br><br>  ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ูุซุงู ููุฑุณูู ุงููุชุญุฑูุฉ ูู ุนุงุฑุถ ุงูุฑุณูู ุงููุชุญุฑูุฉ: <br><br><img src="https://habrastorage.org/webt/_4/yw/bg/_4ywbgkzw8frqb3pjng98db5zwm.jpeg"><br><br>  ูููู ููุงุญุธุฉ ุฃู ุฅุทุงุฑุงุช ุงูููุงุชูุญ ูุญุฏุฏุฉ ุจุดูู ูููุตู ููููุถุน ูุงูุญุฌู ูุงูุฏูุฑุงู.  ุจุงููุณุจุฉ ูุจุนุถ ุงูุนุธุงู ุ ูุฃูุช ุจุญุงุฌุฉ ุฅูู ุงููุซูุฑ ูููุง ุ ูุจุนุถูุง ูููู ููุท ุ ูุจุงููุณุจุฉ ูุชูู ุงูุนุธุงู ุงูุชู ูู ูุชู ุชุญุฑูููุง ุจุดูู ูููุตู ุ ูุชู ุชุญุฏูุฏ ุงูุฅุทุงุฑุงุช ุงูุฃุณุงุณูุฉ ุงูุฃูููุฉ ูุงูููุงุฆูุฉ ููุท. <br><br>  ูููู - Vector3 ุ ุฑุจุงุนู - Vector4 ุ ูููุงุณ - Vector3.  ุณูููู ูุจููุฉ ุงูุฅุทุงุฑ ุงูุฑุฆูุณู ุดูุก ูุงุญุฏ ูุดุชุฑู (ููุชุจุณูุท) ุ ูุฐูู ูุญู ุจุญุงุฌุฉ ุฅูู 4 ุชุนููู ูุชูุงุณุจ ุฃู ูู ุงูุฃููุงุน ุงููุฐููุฑุฉ ุฃุนูุงู.  ูุญุชุงุฌ ุฃูุถูุง ุฅูู InTangent ู OutTangent ููุงุณุชููุงุก ุงูุตุญูุญ ุจูู ุงูุฅุทุงุฑุงุช ุงูุฃุณุงุณูุฉ ููููุง ููุงูุญูุงุก.  ูุนู ุ ูุงูููุช ุงูุทุจูุนู ูุง ููุณู: <br><br><pre style=";text-align:right;direction:rtl"><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KeyFrame</span></span></span><span class="hljs-class"> {</span></span> float4 v; float4 inTan, outTan; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> time; };</code> </pre> <br>  ููุญุตูู ุนูู ุฌููุน ุงูุฅุทุงุฑุงุช ุงูุฃุณุงุณูุฉ ุ ุงุณุชุฎุฏู AnimationUtility.GetEditorCurve (). <br>  ุฃูุถูุง ุ ูุฌุจ ุฃู ูุชุฐูุฑ ุฃุณูุงุก ุงูุนุธุงู ุ ุญูุซ ุณูููู ูู ุงูุถุฑูุฑู ุฅุนุงุฏุฉ ุฑุณู ุฎุฑูุทุฉ ุนุธุงู ุงูุฑุณูู ุงููุชุญุฑูุฉ ูู ุนุธุงู ุงููููู ุงูุนุธูู (ููุฏ ูุง ุชุชุฒุงูู) ูู ูุฑุญูุฉ ุฅุนุฏุงุฏ ุจูุงูุงุช GPU. <br><br>  ุจููุก ุงููุฎุงุฒู ุงููุคูุชุฉ ุงูุฎุทูุฉ ุจูุตูููุงุช ูู ุงูุฅุทุงุฑุงุช ุงูููุชุงุญูุฉ ุ ุณูุชุฐูุฑ ุงูุฅุฒุงุญุงุช ุงูููุฌูุฏุฉ ุจูุง ูู ุฃุฌู ุงูุนุซูุฑ ุนูู ุชูู ุงููุชุนููุฉ ุจุงูุฑุณูู ุงููุชุญุฑูุฉ ุงูุชู ูุญุชุงุฌูุง. <br><br>  ุงูุขู ูุซูุฑุฉ ููุงูุชูุงู.  GPU ุงูุฑุณูู ุงููุชุญุฑูุฉ ุงููููู ุงูุนุธูู. <br><br>  ูููู ุจุฅุนุฏุงุฏ ูุฎุฒู ูุคูุช ูุจูุฑ ("ุนุฏุฏ ุงูููุงูู ุงูุนุธููุฉ ุงููุชุญุฑูุฉ" X "ุนุฏุฏ ุงูุนุธุงู ูู ุงููููู ุงูุนุธูู" X "ุงููุนุงูู ุงูุชุฌุฑูุจู ูุฃูุตู ุนุฏุฏ ููุฒุฌ ุงูุฑุณูู ุงููุชุญุฑูุฉ").  ูู ุฐูู ุ ุณูุฎุฒู ููุถุน ุงูุนุธู ูุฏูุฑู ูุญุฌูู ูู ูุญุธุฉ ุงูุญุฑูุฉ.  ููุฌููุน ุงูุนุธุงู ุงููุชุญุฑูุฉ ุงููุฎุทุทุฉ ูู ูุฐุง ุงูุฅุทุงุฑ ุ ูู ุจุชุดุบูู ุงูุชุธููู ุงูุญุณุงุจู.  ูู ุงูุฎูุท ููุดุท ุงูุนุธุงู. <br><br>  ูู ุฅุทุงุฑ ููุชุฑุถ ุ ุจุตุฑู ุงููุธุฑ ุนู ุงูุญุฌู ุงูุฐู ููุชูู ุฅููู (ุชุฑุฌูุฉ ุ ุชุฏููุฑ ุ ูููุงุณ) ุ ูุชู ุชุญุฑููู ุจููุณ ุงูุทุฑููุฉ ุชูุงููุง (ุงูุจุญุซ ุนู ุทุฑูู ุงูุจุญุซ ุงูุฎุทู ุ ุณุงูุญูู Knuth): <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InterpolateKeyFrame</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(inout float4 rv, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> startIdx, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> endIdx, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> t)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = startIdx; i &lt; endIdx; ++i) { KeyFrame k0 = keyFrames[i + <span class="hljs-number"><span class="hljs-number">0</span></span>]; KeyFrame k1 = keyFrames[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> lerpFactor = (t - k0.time) / (k1.time - k0.time); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lerpFactor &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || lerpFactor &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; rv = CurveInterpoate(k0, k1, lerpFactor); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre><br>  ุงูููุญูู ูู ููุญูู ุจูุฒููุฑ ููุนุจ ุ ูุจุงูุชุงูู ูุฅู ูุธููุฉ ุงูุงุณุชููุงุก ุชููู ุนูู ุงููุญู ุงูุชุงูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">float4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CurveInterpoate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(KeyFrame v0, KeyFrame v1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> t)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dt = v1.time - v0.time; float4 m0 = v0.outTan * dt; float4 m1 = v1.inTan * dt; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> t2 = t * t; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> t3 = t2 * t; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a = <span class="hljs-number"><span class="hljs-number">2</span></span> * t3 - <span class="hljs-number"><span class="hljs-number">3</span></span> * t2 + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> b = t3 - <span class="hljs-number"><span class="hljs-number">2</span></span> * t2 + t; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> c = t3 - t2; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> d = <span class="hljs-number"><span class="hljs-number">-2</span></span> * t3 + <span class="hljs-number"><span class="hljs-number">3</span></span> * t2; float4 rv = a * v0.v + b * m0 + c * m1 + d * v1.v; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rv; }</code> </pre><br>  ุชู ุญุณุงุจ ุงููููู ุงููุญูู (TRS) ูู ุงูุนุธุงู.  ุจุนุฏ ุฐูู ุ ูุน ุชุธููู ุญุณุงุจ ูููุตู ุ ููุฒุฌ ุฌููุน ุงูุฑุณูู ุงููุชุญุฑูุฉ ุงููุงุฒูุฉ ููุฐุง ุงูุนุธู.  ููููุงู ุจุฐูู ุ ูุฏููุง ูุฎุฒู ูุคูุช ูุน ูุคุดุฑุงุช ุงูุฑุณูู ุงููุชุญุฑูุฉ ูุงูุฃูุฒุงู ููู ุงูุฑุณูู ุงููุชุญุฑูุฉ ูู ุงููุฒูุฌ ุงูููุงุฆู.  ูุญุตู ุนูู ูุฐู ุงููุนูููุงุช ูู ุฌูุงุฒ ุงูุฏููุฉ.  ูุชู ุญู ูุถุน BlendTree ุฏุงุฎู BlendTree ุนูู ุงููุญู ุงูุชุงูู.  ุนูู ุณุจูู ุงููุซุงู ุ ููุงู ุดุฌุฑุฉ: <br><br><img src="https://habrastorage.org/webt/yg/n6/_4/ygn6_4arygdkgbnigucbv0tz0fe.jpeg"><br><br>  ุณูููู ูุฒู BlendTree Walk 0.35 ุ Run - 0.65.  ููููุง ูุฐูู ุ ูุฌุจ ุชุญุฏูุฏ ุงูููุถุน ุงูููุงุฆู ููุนุธุงู ูู ุฎูุงู 4 ุฑุณูู ูุชุญุฑูุฉ: Walk1 ู Walk2 ู Run1 ู Run2.  ุณูููู ูุฃูุฒุงููู ููู (0.35 * 0.92 ุ 0.35 * 0.08 ุ 0.65 * 0.92 ุ 0.65 * 0.08) = (0.322 ุ 0.028 ุ 0.598 ุ 0.052) ุ ุนูู ุงูุชูุงูู.  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃู ูุฌููุน ุงูุฃูุฒุงู ูุฌุจ ุฃู ูููู ุฏุงุฆููุง ูุณุงูููุง ููุงุญุฏ ุ ุฃู ูุชู ุชูููุฑ ุงูุฃุฎุทุงุก ุงูุณุญุฑูุฉ. <br><br>  "ููุจ" ูุธููุฉ ุงููุฒุฌ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> bw = animDef.blendWeight; BoneXForm boneToBlend = animatedBones[srcBoneIndex]; float4 q = boneToBlend.quat; float3 t = boneToBlend.translate; float3 s = boneToBlend.scale; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dot(resultBone.quat, q) &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) q = -q; resultBone.translate += t * bw; resultBone.quat += q * bw; resultBone.scale += s * bw;</code> </pre><br>  ููููู ุงูุขู ุชุฑุฌูุฉ ูุตูููุฉ ุงูุชุญูู.  ุฅููุงู.  ุญูู ุงูุชุณูุณู ุงููุฑูู ููุนุธุงู ููุณู ุชูุงูุง. <br>  ุงุณุชูุงุฏูุง ุฅูู ุงูุจูุงูุงุช ูู ุงููููู ุงูุนุธูู ุ ูููู ุจุจูุงุก ูุฌููุนุฉ ูู ุงููุคุดุฑุงุช ุ ุญูุซ ุชุญุชูู ุงูุฎููุฉ ุงูุชู ุจูุง ูุคุดุฑ ุงูุนุธุงู ุนูู ูุคุดุฑ ุงูุฃุตู.  ูู ุงูุฌุฐุฑ ุ ุงูุชุจ -1. <br><br>  ูุซุงู: <br><br><img src="https://habrastorage.org/webt/c0/8v/tl/c08vtlrw1w80dsczyczusebox34.jpeg"><br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">float4x4 animMat = IdentityMatrix(); float4x4 mat = initialPoses[boneId]; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (boneId &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { BoneXForm b = blendedBones[boneId]; float4x4 xform = MakeTransformMatrix(b.translate, b.quat, b.scale); animMat = mul(animMat, xform); boneId = bonesHierarchyIndices[boneId]; } mat = mul(mat, animMat); resultSkeletons[id] = mat;</code> </pre><br>  ููุง ุ ูู ุญูุซ ุงููุจุฏุฃ ุ ุฌููุน ุงูููุงุท ุงูุฑุฆูุณูุฉ ูุชูุฏูู ููุฒุฌ ุงูุฑุณูู ุงููุชุญุฑูุฉ. <br><br><h4 style=";text-align:right;direction:rtl">  GPSM </h4><br>  GPU ูุฏุนูู ุขูุฉ ุงูุฏููุฉ (ูู ุชููุฑ ูู ุฐูู ุงูุญู).  ุณูุนูู ูุธุงู ุงูุฑุณูู ุงููุชุญุฑูุฉ ุงูููุถุญ ุฃุนูุงู ุจุดูู ูุซุงูู ูุน Unity Animation State Machine ุ ูููู ุจุนุฏ ุฐูู ุณุชููู ูู ุงูุฌููุฏ ุบูุฑ ูุฌุฏูุฉ.  ูุน ุฅููุงููุฉ ุญุณุงุจ ุนุดุฑุงุช (ุฅู ูู ููู ุงููุฆุงุช) ุงูุขูุงู ูู ุงูุฑุณูู ุงููุชุญุฑูุฉ ููู ุฅุทุงุฑ ุ ูู ุชููู UnityAnimator ุจุณุญุจ ุงูุขูุงู ูู ุฃุฌูุฒุฉ ุงูุญุงูุฉ ุงูุนุงููุฉ ูู ููุช ูุงุญุฏ.  ูู ... <br>  ูุง ูู ุขูุฉ ุงูุฏููุฉ ูู ุงููุญุฏุฉุ  ูุฐุง ูู ูุธุงู ูุบูู ูู ุงูุญุงูุงุช ูุงูุงูุชูุงูุงุช ุ ูุงูุชู ูุชู ุงูุชุญูู ูููุง ุจูุงุณุทุฉ ุฎุตุงุฆุต ุฑูููุฉ ุจุณูุทุฉ.  ุชุนูู ูู ุขูุฉ ุฏููุฉ ุจุดูู ูุณุชูู ุนู ุจุนุถูุง ุงูุจุนุถ ุ ูููุณ ูุฌููุนุฉ ุจูุงูุงุช ุงูุฅุฏุฎุงู.  ุงูุชุธุฑ ูุญุธุฉ  ูุฐู ูู ูููุฉ ูุซุงููุฉ ูุฌุฑุงููู ูุญุณุงุจ ุชุธููู! <br><br>  <u>ูุฑุญูุฉ ุงูุฎุจุฒ</u> <br><br>  ุฃููุงู ุ ูุญุชุงุฌ ุฅูู ุฌูุน ุฌููุน ุจูุงูุงุช ุฃุฌูุฒุฉ ุงูุญุงูุฉ ููุถุนูุง ูู ุจููุฉ ููุงุฆูุฉ ููุนุงูุฌ GPU.  ููุฐุง: ุงูุฏูู (ุงูุฏูู) ุ ูุงูุชุญููุงุช (ุงูุชุญููุงุช) ูุงููุนููุงุช (ุงููุนููุงุช). <br>  ูุชู ูุถุน ุฌููุน ูุฐู ุงูุจูุงูุงุช ูู ุงููุฎุงุฒู ุงููุคูุชุฉ ุงูุฎุทูุฉ ุ ูุงูุชู ุชุชูุงูููุง ุงูููุงุฑุณ. <br>  ูุนุชุจุฑ ูู ูุคุดุฑ ุชุฑุงุจุท ุญุณุงุจ ุงูุฌูุงุฒ ุญุงูุชู.  ูููุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">AnimatorController</a> ูุงุฌูุฉ ูุฌููุน ููุงูู ุขูุฉ ุงูุญุงูุฉ ุงูุฏุงุฎููุฉ ุงููุงุฒูุฉ. <br><br>  ุงูููุงูู ุงูุฑุฆูุณูุฉ ูุขูุฉ ุงูุฏููุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">State</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> speed; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> firstTransition; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> numTransitions; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> animDefId; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Transition</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> exitTime; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> duration; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sourceStateId; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> targetStateId; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> firstCondition; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> endCondition; uint properties; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StateData</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> timeInState; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> animationLoop; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TransitionData</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> timeInTransition; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CurrentState</span></span></span><span class="hljs-class"> {</span></span> StateData srcState, dstState; TransitionData transition; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AnimationDef</span></span></span><span class="hljs-class"> {</span></span> uint animId; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nextAnimInTree; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> parameterIdx; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> lengthInSec; uint numBones; uint loop; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ParameterDef</span></span></span><span class="hljs-class"> {</span></span> float2 line0ab, line1ab; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> runtimeParamId; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nextParameterId; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Condition</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> checkMode; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> runtimeParamIndex; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> referenceValue; };</code> </pre><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุญุชูู ุงูุญุงูุฉ ุนูู ุงูุณุฑุนุฉ ุงูุชู ูุชู ุจูุง ุชุดุบูู ุงูุญุงูุฉ ุ ููุคุดุฑุงุช ุดุฑูุท ุงูุงูุชูุงู ุฅูู ุงูุขุฎุฑูู ููููุง ููุงูููุฉ ุงูุญุงูุฉ. </li><li style=";text-align:right;direction:rtl">  ูุญุชูู ุงูุงูุชูุงู ุนูู ูุคุดุฑุงุช ุงูุญุงูุฉ "ูู" ู "ุฅูู".  ููุช ุงูุงูุชูุงู ุ ูููุช ุงูุฎุฑูุฌ ุ ูุฑุงุจุท ููุฌููุนุฉ ูู ุงูุดุฑูุท ูุฅุฏุฎุงู ูุฐู ุงูุญุงูุฉ. </li><li style=";text-align:right;direction:rtl">  CurrentState ุนุจุงุฑุฉ ุนู ูุชูุฉ ุจูุงูุงุช ููุช ุงูุชุดุบูู ุชุญุชูู ุนูู ุจูุงูุงุช ุนู ุงูุญุงูุฉ ุงูุญุงููุฉ ูุฌูุงุฒ ุงูุญุงูุฉ. </li><li style=";text-align:right;direction:rtl">  ูุญุชูู AnimationDef ุนูู ูุตู ููุฑุณูู ุงููุชุญุฑูุฉ ูุน ุฑูุงุจุท ููุขุฎุฑูู ุงููุชุนููุฉ ุจู ุจูุงุณุทุฉ BlendTree. </li><li style=";text-align:right;direction:rtl">  ParameterDef ูู ูุตู ูููุนููุฉ ุงูุชู ุชุชุญูู ูู ุณููู ุฃุฌูุฒุฉ ุงูุญุงูุฉ.  Line0ab ู Line1ab ูู ูุนุงููุงุช ูุนุงุฏูุฉ ุงูุฎุทูุท ูุชุญุฏูุฏ ูุฒู ุงูุญุฑูุฉ ุจูุงุณุทุฉ ูููุฉ ุงููุนููุฉ.  ูู ููุง: <br><br><img src="https://habrastorage.org/webt/ge/dl/wd/gedlwdz-u4iiyqciuy-lewx8xnm.jpeg"><br></li><li style=";text-align:right;direction:rtl">  ุงูุดุฑุท - ุชุญุฏูุฏ ุงูุดุฑุท ูููุงุฑูุฉ ูููุฉ ููุช ุชุดุบูู ุงููุนููุฉ ูุงููููุฉ ุงููุฑุฌุนูุฉ. </li></ul><br>  <u>ูุฑุญูุฉ ุงูุชุดุบูู</u> <br><br>  ูููู ุนุฑุถ ุงูุฏูุฑุฉ ุงูุฑุฆูุณูุฉ ููู ุขูุฉ ุญุงูุฉ ุจุงุณุชุฎุฏุงู ุงูุฎูุงุฑุฒููุฉ ุงูุชุงููุฉ: <br><br><img src="https://habrastorage.org/webt/q_/cu/gc/q_cugcb1tr2krdkztmuxbr1yds8.jpeg"><br><br>  ููุงู 4 ุฃููุงุน ูู ุงููุนููุงุช ูู Unity animator: float ู int ู bool ู trigger (ููู bool).  ุณูู ููุฏู ูู ูููู ููุง ุชุทูู.  ุนูุฏ ุฅุนุฏุงุฏ ุงูุดุฑูุท ุ ูู ุงููููู ุงุฎุชูุงุฑ ูุงุญุฏ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุณุชุฉ</a> ุฃููุงุน ููููุงุฑูุฉ.  ุฅุฐุง == ูุณุงูู.  IfNot == NotEqual.  ูุฐูู ุณูู ูุณุชุฎุฏู ููุท 4. ูุชู ุชูุฑูุฑ ูุคุดุฑ ุงููุดุบู ุฅูู ุญูู checkMode ููููู ุงูุดุฑุท. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = t.firstCondition; i &lt; t.endCondition; ++i) { Condition c = allConditions[i]; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> paramValue = runtimeParameters[c.runtimeParamIndex]; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (c.checkMode) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (paramValue &lt; c.referenceValue) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (paramValue &gt; c.referenceValue) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">abs</span></span>(paramValue - c.referenceValue) &gt; <span class="hljs-number"><span class="hljs-number">0.001f</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">abs</span></span>(paramValue - c.referenceValue) &lt; <span class="hljs-number"><span class="hljs-number">0.001f</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>;</code> </pre><br>  ูุจุฏุก ุงูุงูุชูุงู ุ ูุฌุจ ุฃู ุชููู ุฌููุน ุงูุดุฑูุท ุตุญูุญุฉ.  ุชุณููุงุช ุงูุญุงูุฉ ุงูุบุฑูุจุฉ ูู ููุท (int) AnimatorConditionMode.  ููุทู ุงูููุงุทุนุฉ ูู ููุทู ุตุนุจ ูููุงุทุนุชู ูุงุณุชุนุงุฏุฉ ุงูุชุญููุงุช. <br><br>  ุจุนุฏ ุฃู ูููุง ุจุชุญุฏูุซ ุญุงูุฉ ุฌูุงุฒ ุงูุญุงูุฉ ูุงูุชูููุง ุฅูู ุงูุทูุงุจุน ุงูุฒูููุฉ ุนูู ุฅุทุงุฑ delta t ุ ููุฏ ุญุงู ุงูููุช ูุฅุนุฏุงุฏ ุจูุงูุงุช ุญูู ุงูุฑุณูู ุงููุชุญุฑูุฉ ุงูุชู ููุจุบู ูุฑุงุกุชูุง ูู ูุฐุง ุงูุฅุทุงุฑ ูุงูุฃูุฒุงู ุงูููุงุจูุฉ.  ูุชู ุชุฎุทู ูุฐู ุงูุฎุทูุฉ ุฅุฐุง ูู ููู ุทุฑุงุฒ ุงููุญุฏุฉ ูู ุงูุฅุทุงุฑ (ุชู ุฅุนุฏุงู Frustum).  ููุงุฐุง ูุฌุจ ุนูููุง ุงููุธุฑ ูู ุงูุฑุณูู ุงููุชุญุฑูุฉ ููุง ูู ุบูุฑ ูุฑุฆูุ  ูุฐูุจ ุฅูู ุญุงูุฉ ูุตุฏุฑ ุดุฌุฑุฉ ุงููุฒุฌ ุ ูุญุงูุฉ ูุฌูุฉ ุดุฌุฑุฉ ุงููุฒุฌ ุ ููุถูู ุฌููุน ุงูุฑุณูู ุงููุชุญุฑูุฉ ูููุง ุ ููุญุณุจ ุงูุฃูุฒุงู ุญุณุจ ุงูููุช ุงูุทุจูุนู ููุงูุชูุงู ูู ุงููุตุฏุฑ ุฅูู ุงููุฌูุฉ (ุงูููุช ุงูุฐู ููุถูู ูู ุงูุงูุชูุงู).  ุจุงุณุชุฎุฏุงู ุงูุจูุงูุงุช ุงููุนุฏุฉ ุ ุชุฃุชู GPAS ูู ุงููุนุจุฉ ูุชููู ุจุญุณุงุจ ุงูุฑุณูู ุงููุชุญุฑูุฉ ููู ููุงู ูุชุญุฑู ูู ุงููุนุจุฉ. <br><br>  ุชุฃุชู ูุนููุงุช ุงูุชุญูู ูู ุงููุญุฏุฉ ูู ููุทู ุงูุชุญูู ูู ุงููุญุฏุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ุชุญุชุงุฌ ุฅูู ุชูููู ุงูุชุดุบูู ุ ูุชุนููู ุงููุนููุฉ CharSpeed โโุ ูุฌูุงุฒ ุงูุญุงูุฉ ุงูุฐู ุชู ุชููููู ุจุดูู ุตุญูุญ ููุฒุฌ ุจุณูุงุณุฉ ุงูุฑุณูู ุงููุชุญุฑูุฉ ุงูุงูุชูุงููุฉ ูู "ุงููุดู" ุฅูู "ุงูุชุดุบูู". <br><br>  ุจุทุจูุนุฉ ุงูุญุงู ุ ูุฅู ุงูููุงุณ ุงููุงูู ูุน Unity Animator ูู ููุฌุญ.  ูุจุงุฏุฆ ุงูุนูู ุงูุฏุงุฎููุฉ ุ ุฅุฐุง ูู ุชูู ููุตููุฉ ูู ุงููุซุงุฆู ุ ูุงู ูุง ุจุฏ ูู ุนูุณูุง ูุฌุนู ุงูุชูุงุซููุฉ.  ุจุนุถ ุงููุธุงุฆู ูู ุชูุชูู ุจุนุฏ (ูุฏ ูุง ุชููู).  ุนูู ุณุจูู ุงููุซุงู ุ ูุฏุนู BlendType ูู BlendTree 1D ููุท.  ูุฌุนู ุฃููุงุน ุฃุฎุฑู ุ ูู ุญูุซ ุงููุจุฏุฃ ุ ููุณุช ุตุนุจุฉ ุ ุงูุขู ููุท ููุณ ูู ุงูุถุฑูุฑู.  ูุง ุชูุฌุฏ ุฃุญุฏุงุซ ููุฑุณูู ุงููุชุญุฑูุฉ ุ ูุธุฑูุง ูุฃูู ูู ุงูุถุฑูุฑู ุฅุฌุฑุงุก ุฅุนุงุฏุฉ ูุฑุงุกุฉ ุจุงุณุชุฎุฏุงู ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฑุณููุงุช ุ ูุณุชููู ุงููุฑุงุกุฉ "ุงูุตุญูุญุฉ" ุนุฏุฉ ุฅุทุงุฑุงุช ุ ููู ุฃูุฑ ุบูุฑ ููุจูู ุฏุงุฆููุง.  ููู ูุฐุง ูููู ุฃูุถุง. <br><br><h4 style=";text-align:right;direction:rtl">  ุชูุฏูู </h4><br>  ูุชู ุชูุฏูู ุงููุญุฏุฉ ูู ุฎูุงู instancing.  ููููุง ูู SV_InstanceID ุ ูู ุชุธููู ููุฉ ุงูุฑุฃุณ ุ ูุญุตู ุนูู ูุตูููุฉ ุฌููุน ุงูุนุธุงู ุงูุชู ุชุคุซุฑ ุนูู ููุฉ ุงูุฑุฃุณ ุ ููุญูููุง.  ูุง ุดูุก ุนูู ุงูุฅุทูุงู ุบูุฑ ุนุงุฏู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">float4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ApplySkin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(float3 v, uint vertexID, uint instanceID)</span></span></span><span class="hljs-function"> </span></span>{ BoneInfoPacked bip = boneInfos[vertexID]; BoneInfo bi = UnpackBoneInfo(bip); SkeletonInstance skelInst = skeletonInstances[instanceID]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bonesOffset = skelInst.boneOffset; float4x4 animMat = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>; ++i) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> bw = bi.boneWeights[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bw &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { uint boneId = bi.boneIDs[i]; float4x4 boneMat = boneMatrices[boneId + bonesOffset]; animMat += boneMat * bw; } } float4 rv = float4(v, <span class="hljs-number"><span class="hljs-number">1</span></span>); rv = mul(rv, animMat); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rv; }</code> </pre><br><h4 style=";text-align:right;direction:rtl">  ุงููุชุงุฆุฌ </h4><br>  ูู ูุฐู ุงููุฒุฑุนุฉ ุชุนูู ุจุณุฑุนุฉุ  ูู ุงููุงุถุญ ุฃูู ุฃุจุทุฃ ูู ุฃุฎุฐ ุนููุงุช ุงููุณูุฌ ุจุงุณุชุฎุฏุงู ุงููุตูููุงุช ุ ูููู ูุง ูุฒุงู ุจุฅููุงูู ุฅุธูุงุฑ ุจุนุถ ุงูุฃุฑูุงู (GTX 970). <br><br>  ูููุง ููู 50ุ000 ุฌูุงุฒ ุฏููุฉ: <br><br><img src="https://habrastorage.org/webt/cw/bv/4o/cwbv4oww0dles0lwgt-xlsqxg5m.jpeg"><br><br>  ููุง 280ุ000 ุนุธุงู ูุชุญุฑูุฉ: <br><br><img src="https://habrastorage.org/webt/pe/lt/pv/peltpvbyztjsutrkxmhxyjbimbs.jpeg"><br><br>  ุชุตููู ูุชุตุญูุญ ูู ูุฐุง ูู ุฃูู ุญูููู.  ุญููุฉ ูู ุงููุฎุงุฒู ุงููุคูุชุฉ ูุงูุฅุฒุงุญุฉ.  ูุฌููุนุฉ ูู ุงูููููุงุช ูุชูุงุนูุงุชูุง.  ูุงูุช ููุงู ุฃููุงุช ุชุณูุท ูููุง ุงูุฃูุฏู ุนูุฏูุง ุชุบูุจุช ุนูู ุฑุฃุณู ุจุณุจุจ ูุดููุฉ ูุนุฏุฉ ุฃูุงู ุ ูููู ูุง ููููู ุงูุนุซูุฑ ุนูู ุงููุดููุฉ.  ุฅูู ุฃูุฑ "ูุทูู" ุจุดูู ุฎุงุต ุนูุฏูุง ูุนูู ูู ุดูุก ููุง ูุฌุจ ุนูู ุจูุงูุงุช ุงูุงุฎุชุจุงุฑ ุ ูููู ูู ุญุงูุฉ "ูุชุงู" ุญููููุฉ ูุง ููุฌุฏ ุฃู ููุน ูู ุฎูู ุงูุฑุณูู ุงููุชุญุฑูุฉ.  ููุง ุฃู ุงูุชุจุงููุงุช ุจูู ุชุดุบูู ุขูุงุช ุญุงูุฉ ุงููุญุฏุฉ ูุงูุขููุงุช ุงูุฎุงุตุฉ ุจูุง ุบูุฑ ูุฑุฆูุฉ ุนูู ุงูููุฑ.  ุจุดูู ุนุงู ุ ุฅุฐุง ูุฑุฑุช ุฅุฌุฑุงุก ุชูุซููู ูููุณู ุ ูุฃูุง ูุง ุฃุญุณุฏู.  ูู ุงููุงูุน ุ ูุฅู ุงูุชุทูุฑ ููู ูู ุธู GPU ูู ุดูุก ูุดูู ููู. <br><br>  <b>ุณูุฑุชูุฑ ุฎุงุต</b> ุฃุฑูุฏ ุฑูู ุญุฌุฑ ูู ุญุฏููุฉ ูุทูุฑู Unite TechDemo.  ูุฏููู ุนุฏุฏ ูุจูุฑ ูู ุงูููุงุฐุฌ ุงููุชูุงุซูุฉ ููุฃุทูุงู ูุงูุฌุณูุฑ ุนูู ุฎุดุจุฉ ุงููุณุฑุญ ุ ููู ูุญุณููุง ุชูุฏูููุง ุจุฃูุฉ ุทุฑููุฉ.  ุจุฏูุง ูู ุฐูู ุ ุญุงูููุง ูู ุฎูุงู ูุถุน ุนูุงูุฉ "ุซุงุจุช".  ุงูุขู ููุท ุ ูู ููุงุฑุณ 16 ุจุช ูุง ููููู ุญุดุฑ ุงููุซูุฑ ูู ุงูุฃุดูุงู ุงูููุฏุณูุฉ (ุซูุงุซ ูุฑุงุช ูุงูุง ุ 2017) ููู ูุฌุชูุน ุฃู ุดูุก ุ ูุฃู ุงูููุงุฐุฌ ูุชุนุฏุฏุฉ ุงูุฃุถูุงุน.  ุฃุถุน "ุชูููู Instancing" ูุฌููุน ุงูุชุธููู ุ ููู ูุชู ุชุญุฏูุฏ "ุซุงุจุช".  ูู ููู ููุงู ุฃู ุฏุนู ููููุณ ุ ููู ุ ูุนูุฉ ุ ูุฃูุช ุชููู ุจุนูู ุชุฌุฑูุจู ุชููู ูู ุฃุฌู ูู FPS.  ูุง ููููู ุญูุงูุฉ ูู ูุฐุง ุงููุจูู. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุงู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">*** Summary *** Draw calls: 2553 Dispatch calls: 0 API calls: 8378 Index/vertex bind calls: 2992 Constant bind calls: 648 Sampler bind calls: 395 Resource bind calls: 805 Shader set calls: 682 Blend set calls: 230 Depth/stencil set calls: 92 Rasterization set calls: 238 Resource update calls: 1017 Output set calls: 74 API:Draw/Dispatch call ratio: 3.28163 298 Textures - 1041.01 MB (1039.95 MB over 32x32), 42 RTs - 306.94 MB. Avg. tex dimension: 1811.77x1810.21 (2016.63x2038.98 over 32x32) 216 Buffers - 180.11 MB total 17.54 MB IBs 159.81 MB VBs. 1528.06 MB - Grand total GPU buffer + texture load. *** Draw Statistics *** Total calls: 2553, instanced: 2, indirect: 2 Instance counts: 1: 2: 3: 4: 5: 6: 7: 8: 9: 10: 11: 12: 13: 14: &gt;=15: ******************************************************************************************************************************** (2)</code> </pre><br></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุฃุตุจุญ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">*** Summary *** Draw calls: 1474 Dispatch calls: 0 API calls: 11106 Index/vertex bind calls: 3647 Constant bind calls: 1039 Sampler bind calls: 348 Resource bind calls: 718 Shader set calls: 686 Blend set calls: 230 Depth/stencil set calls: 110 Rasterization set calls: 258 Resource update calls: 1904 Output set calls: 74 API:Draw/Dispatch call ratio: 7.5346 298 Textures - 1041.01 MB (1039.95 MB over 32x32), 42 RTs - 306.94 MB. Avg. tex dimension: 1811.77x1810.21 (2016.63x2038.98 over 32x32) 427 Buffers - 93.30 MB total 9.81 MB IBs 80.51 MB VBs. 1441.25 MB - Grand total GPU buffer + texture load. *** Draw Statistics *** Total calls: 1474, instanced: 391, indirect: 2 Instance counts: 1: 2: ******************************************************************************************************************************** (104) 3: ************************************************* (40) 4: ********************** (18) 5: ****************************** (25) 6: ********************************************************************************************* (76) 7: *********************************** (29) 8: ************************************************** (41) 9: ********* (8) 10: ************** (12) 11: 12: ****** (5) 13: ******* (6) 14: ** (2) &gt;=15: ****************************** (25)</code> </pre><br></div></div><br>  <b>PPS</b> ูู ุฌููุน ุงูุฃููุงุช ุ ูุงูุช ุงูุฃูุนุงุจ ูุฑุชุจุทุฉ ุจุดูู ุฃุณุงุณู ุจูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุ ุฃู  ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ูู ุชูุงูุจ GPU.  ุงููุซูุฑ ูู ุงูููุทู ูุงูููุฒูุงุก.  ุจููู ุฌุฒุก ูู ููุทู ุงููุนุจุฉ ูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุฅูู ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฑุณููุงุช ุ ูููู ุจุฅูุฑุงุบ ุงูุฃูู ููุญููู ุงูุซุงูู ุ ุฃู  ุฌุนู ูุถุน GPU ููุฒูุฉ ุนูู ุงูุฃุฑุฌุญ.  ููู ููุง ูุงู ุนููุงู ุงูููุงู. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar468549/">https://habr.com/ru/post/ar468549/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar468537/index.html">ุฃุณุงุณูุงุช DevOps. ุงูุฏุฎูู ุฅูู ุงููุดุฑูุน ูู ุงูุตูุฑ</a></li>
<li><a href="../ar468541/index.html">ุงูุณุญุจ ูุงูุฅููุงุช ููููุงุช ูููุณุชุฎุฏููู ุงููููููููุ ูู ุชูุฒุญ</a></li>
<li><a href="../ar468543/index.html">ูุฌูุฉ ุจุฑูุงูุฌ ุฃูุงู ุงูุฃุณุจูุน FrontendConf. ููุงุจูุฉ ูุน ุณูุฑุฌู ุจูุจูู</a></li>
<li><a href="../ar468545/index.html">"ุฃููุณ ุ ุฏุนูุง ูุฐูุจ ุฅูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ!"</a></li>
<li><a href="../ar468547/index.html">ุชุญุฏุซ ุงูุฅูุฌููุฒูุฉ ุ CSS ุ ุงูุดุจูุฉ ูุฅููุงููุฉ ุงููุตูู ูู FrontendConf</a></li>
<li><a href="../ar468553/index.html">ุฅุฏุงุฑุฉ ุงููุนููุงุช ูู ุชุทุจููุงุช ุงูุฃุนูุงู ุงููุดุงุจูุฉ ููุธุงู ุงูุชุญูู ูู ุงูุฅุตุฏุงุฑ</a></li>
<li><a href="../ar468555/index.html">ููุฏูุฉ ููุชุฌูุนุงุช ุงูุญุชููุฉ ูู C / C ++. ุงูุฌุฒุก 2</a></li>
<li><a href="../ar468559/index.html">ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุณุญุงุจุฉ ุ ูุงูุฃุตุฏูุงุก</a></li>
<li><a href="../ar468561/index.html">ุฃุณุจูุน ุงูุฃูุงู 39: ุฃุฎุทุงุก ุงูุฃูุงู ูุงูุดุงุฆุนุฉ</a></li>
<li><a href="../ar468563/index.html">Watchmen Watch: ุงูุญุงูุฉ ุงูุญุงููุฉ ููุฑุงูู ุชุชุจุน ุงููุถุงุก</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>