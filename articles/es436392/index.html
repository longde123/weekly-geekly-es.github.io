<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë´ ü§Ωüèø üò∂ Beneficios de analizar aplicaciones de nivel 7 en firewalls. Parte 1. Conceptos b√°sicos üëÉüèΩ üïµüèª üíê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La nueva generaci√≥n de firewalls es m√°s conveniente y segura gracias a la nueva arquitectura del motor y la nueva ideolog√≠a de gesti√≥n de flujos de re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Beneficios de analizar aplicaciones de nivel 7 en firewalls. Parte 1. Conceptos b√°sicos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436392/"><img src="https://habrastorage.org/getpro/habr/post_images/786/9e4/d4e/7869e4d4eac6b07b8bfa763cb3985347.png"><br>  La nueva generaci√≥n de firewalls es m√°s conveniente y segura gracias a la nueva arquitectura del motor y la nueva ideolog√≠a de gesti√≥n de flujos de red. <br><h3>  ¬øPor qu√© apareci√≥ este art√≠culo? </h3><blockquote>  En repetidas ocasiones lleg√≥ a compa√±eros de seguridad que utilizan una nueva generaci√≥n de firewalls y vieron que siguen escribiendo reglas sobre los n√∫meros de puerto.  Ante mi sugerencia de seguir escribiendo por el nombre de las aplicaciones, escuch√© "¬øQu√© pasa si no funciona as√≠?  Si tambi√©n est√° "asustado" o no est√° claro por qu√© escribir las reglas para las aplicaciones, este art√≠culo es para usted. </blockquote><br><a name="habracut"></a><br><h1>  PARTE 1. Conceptos b√°sicos de firewall </h1><br><h3>  CONTENIDO </h3>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Introduccion</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Definiciones</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Cortafuegos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Cortafuegos L3</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Cortafuegos L4</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Cortafuegos L7</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">UTM</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">NGFW</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ejemplos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Servidor proxy</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¬øQu√© es la ID DE USUARIO?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Conceptos err√≥neos sobre la inspecci√≥n estatal: Estado L4 vs L7</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Conceptos err√≥neos sobre la inspecci√≥n de estado: n√∫mero de sesiones L4 vs L7</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Conceptos err√≥neos sobre la inspecci√≥n estatal: L4 Cluster vs L7</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 2. Impacto de seguridad del cortafuegos L7</a> <br><br><a name="Intro"></a><h2>  Introduccion </h2><br>  Skype, TOR, Ultrasurf, TCP sobre DNS y varios cientos de aplicaciones y t√∫neles m√°s pasan silenciosamente a trav√©s del firewall de inspecci√≥n completo y los servidores proxy HTTP.  Muchas protecciones abren conexiones, pero no verifican lo que hay dentro de ellas.  Propongo descubrir c√≥mo controlar las conexiones de la aplicaci√≥n en una nueva generaci√≥n de firewall de manera controlada, donde las reglas se escriben con los nombres de las aplicaciones, que corresponde al nivel 7 del modelo ISO OSI.  Dichos firewalls se denominan firewall de pr√≥xima generaci√≥n, una nueva generaci√≥n de firewalls o simplemente NGFW. <br><blockquote>  El administrador del cortafuegos no solo necesita permitir la conexi√≥n, sino tambi√©n asegurarse de que lo que desea va dentro de la conexi√≥n permitida, incluida la verificaci√≥n de los archivos transferidos.  Esto se llama <b>permiso de aplicaci√≥n segura</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9b2/d52/1e2/9b2d521e2806d725232f208f318014fb.jpg"></blockquote>  Existen varias diferencias importantes en el trabajo con tr√°fico, que solo comprende cuando cambia al uso real de las reglas, donde el criterio es la aplicaci√≥n del nivel 7 del modelo ISO OSI: <br><br><ul><li>  El administrador de TI ve que NGFW visualiza el tr√°fico de red, es decir, muestra el contenido del campo de paquete de datos, los nombres de usuario y qu√© aplicaci√≥n se est√° ejecutando y qu√© archivos transmite. <br></li><li>  La seguridad de TI considera que NGFW proporciona una resoluci√≥n de aplicaci√≥n segura, porque un an√°lisis m√°s profundo de los datos en el paquete le permite ver virus, permitir el env√≠o de archivos desconocidos al sandbox, verificar el tipo de archivo, las palabras clave para DLP, verificar la categor√≠a de URL, verificar lo que est√° dentro de SSL y SSH, Compare con los indicadores de compromiso ya conocidos en todo el mundo, habilite el filtro DNS y otras t√©cnicas modernas. <br></li></ul><br>  Para comprender las razones de esto, compare los registros de firewall L4 y L7. <br><blockquote>  A) Compare la entrada en el registro del <b>cortafuegos L4</b> , que analiza solo el encabezado del nivel de transporte (cuarto) del modelo ISO OSI, en este caso TCP: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d8a/7bd/dbd/d8a7bddbdb4f4b2de47d82f964de4075.png"></blockquote>  S√≠, hay informaci√≥n sobre el origen y el destino, puede adivinar por el n√∫mero de puerto 443 que dentro, con un alto grado de probabilidad (como dicen los ingleses), la conexi√≥n SSL.  Personalmente no puedo ver ning√∫n incidente en esta entrada.  Que hay de ti <br><blockquote>  B) Compare la entrada en el registro del <b>firewall L7</b> para la misma conexi√≥n TCP, donde el contenido en s√≠ tambi√©n se transfiere al campo de datos TCP / IP: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cea/5fc/e07/cea5fce0756312001f33bc13bf101d7a.png"></blockquote>  Aqu√≠ puede ver que Ivanov del departamento de marketing subi√≥ un archivo marcado "no para distribuci√≥n" a Slideshare.  Este es un ejemplo de un incidente real en el que un empleado public√≥ planes confidenciales de desarrollo de la compa√±√≠a durante un a√±o en Internet.  Esta informaci√≥n se obtuvo en el firewall L7 basado en el an√°lisis de la misma conexi√≥n que el anterior para el firewall L4 e inmediatamente la informaci√≥n se vuelve suficiente para comprender que hubo un incidente.  Y este es un enfoque completamente diferente para el an√°lisis del tr√°fico.  Pero, inmediatamente te advertir√© que un an√°lisis tan profundo pone una carga seria en el procesador y la RAM del dispositivo. <br><br>  A veces se considera que el nivel de detalle de las revistas en NGFW es similar al nivel de detalle en los sistemas SIEM que recopilan informaci√≥n poco a poco de diferentes fuentes.  Es por eso que NGFW es una de las mejores fuentes de informaci√≥n para SIEM. <br><br><a name="Def"></a><h2>  Definiciones </h2><br>  Es necesario resaltar los t√©rminos con los que continuaremos operando.  No tengo ning√∫n prop√≥sito en detalle dando todas las definiciones. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/871/b80/69b/871b8069b4cf331d60aeb72e986a6fa1.png"><br><br>  <b>El modelo ISO OSI de siete niveles</b> es un modelo de interacci√≥n entre dispositivos de red, que establece que hay 7 niveles consecutivos de abstracci√≥n de interacci√≥n: el primero es f√≠sico, el siguiente es el canal, la red, el cuarto es el transporte, luego la sesi√≥n, las vistas y el s√©ptimo nivel son aplicaciones (ver imagen arriba) ) <br><br>  Cada dispositivo de red funciona en su propio nivel de abstracci√≥n: el servidor web y el navegador, en el nivel de aplicaci√≥n (nivel 7 o brevemente L7), los enrutadores, se comunican entre s√≠ en el canal (2) y en el nivel de red (3) cuando se transmiten entre s√≠ tramas y paquetes . <br><br>  Los cortafuegos tambi√©n son dispositivos de red y, seg√∫n su tipo, pueden ser conmutadores y enrutadores e incluso ser un "cable virtual" desde el punto de vista de la topolog√≠a de la red, pero estos dispositivos de red tienen una carga adicional: deben analizar el contenido de los paquetes. <br><br>  Y la profundidad del an√°lisis de los paquetes de red puede variar.  Si analizan el nivel 4 o 7 es una diferencia importante. <br><br><a name="FW"></a><h2>  Cortafuegos </h2><br>  <b>Firewall (ITU), Network Firewall</b> es un dispositivo de red que divide la red en segmentos con diferentes pol√≠ticas de seguridad y controla estas pol√≠ticas.  Por ejemplo, el segmento de Internet: todo se puede hacer all√≠.  Y el segmento de su centro de datos: all√≠ solo puede trabajar una lista dedicada de empleados para las aplicaciones permitidas.  Dentro de un √∫nico host VMware, puede haber varias redes virtuales con m√°quinas virtuales y diferentes pol√≠ticas de acceso para ellas. <br><br>  La pol√≠tica de seguridad del cortafuegos contiene reglas que aplican el c√≥digo de programa del dispositivo mediante el an√°lisis de cada marco y paquete que vino y sale del cortafuegos.  En las reglas del firewall, se definen los criterios de inspecci√≥n (calificadores), seg√∫n los cuales se toma la decisi√≥n de permitir o bloquear el tr√°fico.  Ejemplos de calificadores en las reglas son: direcci√≥n, puerto, aplicaci√≥n, usuario, zona.  El firewall secuencialmente, regla por regla, escanea los criterios de arriba a abajo de la lista y si el tr√°fico entrante cumple con todos los criterios de la regla (operaci√≥n l√≥gica ‚ÄúY‚Äù entre los criterios), se aplica la acci√≥n indicada: bloquear u omitir.  La acci√≥n se realiza tanto para el primer paquete como para todos los paquetes posteriores de la misma conexi√≥n TCP / IP. <br><br>  Existen diferentes tipos e implementaciones de firewall.  Consideraremos la clasificaci√≥n seg√∫n el grado de profundidad de an√°lisis de tr√°fico utilizado: L3, L4 y L7. <br><br><a name="L3"></a><h2>  Cortafuegos L3 </h2><br>  <b>El firewall L3</b> es un firewall que pasa el tr√°fico a trav√©s de s√≠ mismo y analiza solo los encabezados del protocolo IP, es decir, la direcci√≥n desde d√≥nde y hacia d√≥nde va el tr√°fico.  Dichos firewalls se denominan <b>filtrado de paquetes</b> .  Las reglas se denominan "lista de acceso" o lista de acceso (ACL) y esta funcionalidad hoy funciona en casi cualquier enrutador y sistema operativo.  Tal an√°lisis no requiere una carga seria en los procesadores y la memoria del firewall. <br><br><a name="L4"></a><h2>  Cortafuegos L4 </h2><br>  <b>El firewall L4</b> es un firewall que pasa el tr√°fico a trav√©s de s√≠ mismo y verifica los encabezados de los protocolos de 4 niveles: TCP, UDP, ICMP, es decir, los principales criterios de verificaci√≥n para pasar el tr√°fico son las direcciones IP y los puertos TCP / UDP o servicios ICMP. <br><br>  El concepto de inspecci√≥n con estado tambi√©n aparece en el firewall L4, donde se almacena cada solicitud de aprobaci√≥n y se almacena el estado de la solicitud para permitir las conexiones de respuesta necesarias.  Es decir, aparece el concepto de un iniciador de conexi√≥n, que es l√≥gico en redes construidas con tecnolog√≠a cliente-servidor.  Dicho firewall gasta memoria en el almacenamiento de datos sobre cada conexi√≥n, es decir, hay un l√≠mite en el n√∫mero m√°ximo de sesiones simult√°neas almacenadas en la memoria.  En el firewall L4, ya no necesita escribir una regla de respuesta para la conexi√≥n inversa, como se requiere en el firewall L3, porque seg√∫n el estado de la conexi√≥n, el firewall autom√°ticamente permite conexiones inversas.  Es decir, el firewall L4 es m√°s conveniente que un filtro de paquetes. <br><br>  Los firewalls L4 modernos almacenan el estado no solo de TCP, UDP e ICMP, sino que tambi√©n rastrean la interacci√≥n de algunas aplicaciones L7.  Por ejemplo, el estado de FTP, HTTP, SIP y otras aplicaciones, que ya depende de la implementaci√≥n espec√≠fica del firewall.  Necesitamos hacerle la pregunta al fabricante del firewall L4: ¬øqu√© aplicaciones espec√≠ficas admite su motor de firewall de inspecci√≥n con estado? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fbb/493/449/fbb49344946f0e1ae8ecde30d879b35e.png"><br><br><a name="L7"></a><h2>  Cortafuegos L7 </h2><br>  <b>El firewall L7</b> es un firewall que pasa el tr√°fico de red IP a trav√©s de s√≠ mismo y verifica los encabezados de nivel 4 y el segmento de datos de cada paquete IP, es decir, comprende el tr√°fico de nivel de aplicaci√≥n L7, hasta qu√© archivos se transfieren y en qu√© direcci√≥n.  Como se analizan m√°s datos, existen m√°s criterios de verificaci√≥n en las reglas del firewall L7: nombre de usuario, aplicaci√≥n, categor√≠a de URL, estado del software en la computadora del usuario. <br><br>  La carga en el firewall L7 es mucho mayor, porque su procesador debe analizar constantemente los megabytes del campo de datos transmitidos por la aplicaci√≥n, mientras que el firewall L4 verifica solo unos pocos bytes del encabezado del paquete IP con las direcciones y puertos de origen y destino.  El tama√±o del b√∫fer para almacenar el estado de cada aplicaci√≥n L7 requiere mucho m√°s, porque se transfieren m√°s datos a L7 que solo en el encabezado TCP / IP.  Debido al aumento del tama√±o del b√∫fer cuando se usa el an√°lisis de aplicaciones, el n√∫mero de sesiones almacenadas simult√°neamente en la memoria del firewall L7 es menor que el firewall L4 con la misma cantidad de memoria.  Dado que el firewall L7 ve por contenido qu√© tipo de aplicaci√≥n pasa por la red, el n√∫mero de puerto no tiene mucho sentido y las reglas pueden escribirse con el nombre de la aplicaci√≥n L7.  Adem√°s, las aplicaciones modernas generan muchas conexiones y todas estas conexiones son parte de una sola aplicaci√≥n.  Este tipo de firewall le permite recuperar el control de las aplicaciones din√°micas modernas que se ejecutan en cualquier puerto, por ejemplo, teamviewer, bittorent, tor, del cual el firewall L4 no sabe nada.  Es decir, el firewall L7 en las realidades modernas es necesario si la red necesita seguridad. <br><blockquote>  Si despu√©s de leer este art√≠culo contin√∫a utilizando el firewall L4, esto significa que no le importa en absoluto la seguridad. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9dd/ded/ecb/9dddedecb30376ea249d293db19a016d.png"><br></blockquote><br><a name="UTM"></a><h2>  UTM </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/ab9/466/fc5/ab9466fc51717a9788e0093244b6261d.png"><br><br>  <b>Un UTM</b> es un dispositivo de red que tiene varios componentes de seguridad diferentes instalados dentro de √©l que analizan secuencialmente el tr√°fico que pasa a trav√©s del dispositivo.  El n√∫cleo del UTM es el firewall L4, el sistema de prevenci√≥n de ataques (IPS), el antivirus y el an√°lisis de las categor√≠as de URL en HTTP y HTTPS.  A menudo, los UTM a√∫n proporcionan funciones de puerta de enlace VPN.  Todos estos componentes generalmente se administran desde varios sistemas de control diferentes.  El tr√°fico dentro del UTM pasa secuencialmente a trav√©s de los m√≥dulos de filtrado y la salida es tr√°fico puro, lo que est√° permitido por las pol√≠ticas de seguridad de cada m√≥dulo.  UTM se puede utilizar como plataforma para otras funciones: protecci√≥n antivirus, IPS, DDoS, QoS, DLP, filtro DNS, base de datos de indicadores de Inteligencia de amenazas, protecci√≥n contra phishing, etc. (seg√∫n el fabricante). <br><br><blockquote>  La par√°bola sobre la persona que orden√≥ siete sombreros de una m√°scara tambi√©n fue escrita para clientes de UTM: cuantas m√°s funciones desee habilitar despu√©s de la compra, mayor ser√° la carga en el procesador UTM para analizar la misma cantidad de tr√°fico.  M√°s funciones: menos velocidad del dispositivo. </blockquote><br><br>  La idea de UTM: cargar un procesador con tantas funciones como sea posible se convirti√≥ en un callej√≥n sin salida evolutivo, porque el n√∫mero de funciones creci√≥ y los procesadores no pudieron soportar toda esta carga.  Hoy, a pesar de las buenas caracter√≠sticas declaradas, nadie incluye toda la funcionalidad en el UTM para eliminar los retrasos en el tr√°fico. <br><blockquote>  El objetivo de UTM: implementar tantas funciones como sea posible en un servidor para reducir el costo del dispositivo para el usuario. </blockquote>  Ahora los fabricantes de UTM han comenzado a instalar motores de an√°lisis de aplicaciones de nivel 7 para decir que son NGFW, que es lo que confunde al consumidor.  Sin embargo, esto es f√°cil de reconocer si observa la pol√≠tica de seguridad: las reglas a√∫n se basan en los criterios para verificar los campos L4.  Y para filtrar aplicaciones L7, se utiliza una secci√≥n de configuraci√≥n separada, es decir, la aplicaci√≥n L7 no es un calificador, como deber√≠a estar en el firewall L7.  Reconocer la aplicaci√≥n L7 y usar la aplicaci√≥n L7 como criterio para la pol√≠tica de seguridad son "dos grandes diferencias". <br><br><a name="NGFW"></a><h2>  NGFW </h2><br>  <b>NGFW</b> es un dispositivo de red dentro del cual se implementa el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">firewall L7</a> .  Como el calificador principal se convierte en el nombre de la aplicaci√≥n L7, las reglas se escriben de acuerdo con nuevos criterios.  En NGFW, la asignaci√≥n din√°mica de direcciones IP a los usuarios de la red siempre funciona, por lo que el nombre de usuario tambi√©n se convierte en un calificador (criterio).  NGFW incluye funciones de descifrado SSL / TLS y SSH para reconocer aplicaciones y ataques dentro de ellas, IPS, antivirus y filtrado de URL. <br><br>  El t√©rmino NGFW fue acu√±ado por primera vez por la empresa de marketing Palo Alto Networks.  Pero gradualmente ech√≥ ra√≠ces en el mercado y todos los fabricantes de UTM ahora tambi√©n se hacen llamar NGFW.  De hecho, NGFW tambi√©n realiza varias funciones simult√°neamente, ¬øpor qu√© entonces NGFW no es UTM?  La diferencia es importante saber.  Es que en la aplicaci√≥n NGFW las funciones de seguridad (IPS, antivirus, filtrado de URL) son aceleradas por el hardware.  Hay chips de hardware especializados: IPS comprueba los ataques en su chip, firma antivirus por s√≠ mismo, descifrado SSL por su cuenta, y as√≠ sucesivamente.  La separaci√≥n de funciones entre diferentes procesadores permite ejecutar funciones de protecci√≥n en paralelo y no esperar a que la funci√≥n anterior termine de funcionar, como en UTM.  Por ejemplo, se instalan hasta 60 en los firewalls de hardware de Palo Alto Networks <br>  Procesadores especializados Cavium que aceleran las funciones de seguridad, red y gesti√≥n.  Es importante que los NGFW contengan una √∫nica interfaz de software para administrar todas las funciones al mismo tiempo. <br><blockquote>  La idea de NGFW, a diferencia de UTM, es implementar cada funci√≥n en un procesador separado, que est√° especializado para la funcionalidad requerida. </blockquote>  Los fabricantes de computadoras sol√≠an seguir el mismo patr√≥n, y tomaron las funciones de las matem√°ticas y los gr√°ficos en coprocesadores matem√°ticos y gr√°ficos separados.  Por lo tanto, NGFW tiene procesadores separados para reconocer aplicaciones L7, para descifrar SSL / SSH, para verificar firmas antivirus, verificar firmas IPS, etc.  Esto le permite habilitar todas las funciones al mismo tiempo, sin degradaci√≥n y retraso del tr√°fico en el dispositivo durante el escaneo.  ¬øPor qu√© nadie compra computadoras sin aceleradores gr√°ficos y cortafuegos sin aceleraci√≥n?  Debido a que la aceleraci√≥n no es necesaria a bajas velocidades, pero cuando las velocidades de an√°lisis de tr√°fico superan los 1-5 Gigabits, ya es imposible implementar todas las funciones de seguridad sin aceleraci√≥n. <br><br>  El prop√≥sito del dispositivo NGFW es permitir a las empresas trabajar de forma segura sin ralentizar el tr√°fico.  Esto le permite comprobar constantemente que las aplicaciones transmiten contenido seguro a la empresa que necesita, y el funcionamiento paralelo de los motores de protecci√≥n con un flujo de tr√°fico garantiza el rendimiento especificado con todas las funciones de seguridad activadas y tambi√©n minimiza el retraso del tr√°fico. <br><br><a name="Ex"></a><h2>  Ejemplos </h2><br><blockquote>  Ejemplo de pol√≠tica L7 en Palo Alto Networks NGFW <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c3d/433/201/c3d433201745dec7e570b6fe82769f2b.png"></blockquote>  ¬øPor qu√© podr√≠a necesitar una categor√≠a de URL como calificador?  Por ejemplo, puede permitir que algunos empleados a√∫n visiten sitios maliciosos con un navegador, pero bloqueen las descargas de archivos para ellos. <br><blockquote>  Un ejemplo de una pol√≠tica de redes de Palo Alto que utiliza comprobaciones de perfil de informaci√≥n de host y URL de categor√≠a. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/957/d22/0a0/957d220a05d44f91fef65d4cebf76b89.png"></blockquote>  Esta pol√≠tica tambi√©n implica verificar la protecci√≥n del host TRAPS en la columna Perfil HIP, lo que evitar√° que los usuarios ingresen al sitio con c√≥digo malicioso y exploits, sin la protecci√≥n instalada en la computadora.  TRAPS es un agente antimalware y de protecci√≥n contra exploits. <br><br>  La descarga de archivos se bloquea en la configuraci√≥n de la columna Perfil, donde se aplica el perfil para bloquear la transferencia de todos los archivos para cualquier aplicaci√≥n.  As√≠ es como se ve su configuraci√≥n: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/480/87e/6e2/48087e6e2f973ee821ef6240828dfd6a.png"><br><br><a name="Proxy"></a><h2>  Servidor proxy </h2><br>  <b>Un servidor proxy</b> es un dispositivo que termina el tr√°fico de una aplicaci√≥n en s√≠ mismo, verifica este tr√°fico utilizando varios m√©todos y env√≠a este tr√°fico a√∫n m√°s.  Se utiliza con mayor frecuencia en redes proxy para HTTP y HTTPS.  Dado que UTM y NGFW analizan las transmisiones HTTP y HTTPS de forma transparente, sin requerir configuraciones expl√≠citas del servidor proxy de los clientes, los servidores proxy HTTP est√°n desapareciendo gradualmente de las empresas. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bf2/e91/3eb/bf2e913eb4c39a379ff76818a6173b6d.png"><br><br><a name="USER-ID"></a><h2>  ¬øQu√© es la ID DE USUARIO? </h2><br>  NGFW invent√≥ un mecanismo para identificar usuarios.  El algoritmo funciona internamente o se ejecuta en un agente externo.  Llamar√© a esto un mecanismo de ID de usuario.  USER-ID crea y mantiene una tabla de mapeo para el nombre de usuario y su direcci√≥n IP actual.  Tambi√©n sucede que en la tabla hay un valor y un puerto para un usuario determinado, si los usuarios trabajan a trav√©s de VDI (es decir, los usuarios provienen de la misma direcci√≥n y solo se pueden distinguir por puerto). <br><img src="https://habrastorage.org/getpro/habr/post_images/37d/0cc/99b/37d0cc99baa26dc2597b17e7ae9ed7a4.png" alt="imagen"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enumerar√© los</a> mecanismos de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ID de</a> usuario en las redes de Palo Alto <br><ol><li>  <b>Supervisi√≥n del servidor</b> : el agente de ID de usuario lee eventos de servidores de Exchange, controladores de dominio o servidores Novell eDirectory </li><li>  <b>Sondeo del cliente</b> : el agente de ID de usuario sondea a los clientes de Windows a trav√©s de WMI </li><li>  <b>Agente de servicios de terminal</b> : el <b>agente de</b> TS distribuye a diferentes usuarios diferentes rangos de puertos TCP / UDP para trabajar con servidores de terminales Windows / Citrix </li><li>  An√°lisis de mensajes de <b>Syslog</b> : el agente de ID de usuario lee mensajes de autenticaci√≥n de Syslog de varios sistemas, controladores inal√°mbricos, dispositivos 802.1x, servidores Apple Open Directory, servidores proxy, puertas de enlace VPN, Cisco ISE </li><li>  Autenticaci√≥n a trav√©s de <b>GlobalProtect</b> Client: VPN + nombre de usuario y contrase√±a se pueden agregar a MFA </li><li>  Autenticaci√≥n a trav√©s del <b>portal cautivo</b> : el tr√°fico web se autentica mediante el formulario web NTLM o AAA (el portal cautivo se utiliza en el metro y los caf√©s de Mosc√∫. NTLM le permite hacer que la autenticaci√≥n sea transparente) </li><li>  <b>API XML</b> : el agente de ID de usuario transmite informaci√≥n sobre la entrada y la salida con comandos especiales a trav√©s del firewall de la API REST </li><li>  <b>X-Forward-For</b> : los proxies llenan este campo en la solicitud HTTP para que quede claro qui√©n se esconde detr√°s del proxy </li></ol><br>  La lectura de registros de los controladores de Active Directory es la caracter√≠stica m√°s utilizada en la ID DE USUARIO.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El agente de ID DE USUARIO lee peri√≥dicamente los mensajes de los registros de AD, donde se registra qu√© usuario desde qu√© direcci√≥n IP inici√≥ sesi√≥n, es de ellos que el ID de USUARIO aprende sobre qu√© direcci√≥n es el usuario y lo almacena dentro de NGFW, por ejemplo, para Windows 2008/2012 estos son mensajes: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 4768 - Boleto de autenticaci√≥n otorgado </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 4769 - Boleto de servicio otorgado </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 4770 - Boleto otorgado Renovada </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 4264 - Inicio de sesi√≥n correcto </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El agente de ID de usuario necesita acceso con privilegios de lector de registro par para leer los registros.</font></font><br><br><a name="Stateful"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Conceptos err√≥neos sobre la inspecci√≥n estatal </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deber√≠a dedicar un cap√≠tulo separado a este concepto sagrado a cada ingeniero de redes e ingeniero de seguridad. </font><font style="vertical-align: inherit;">Es necesario enfatizar y complementar las cosas importantes que a menudo se pierden en los cursos en firewalls. </font><font style="vertical-align: inherit;">Si ya ha aprendido los conceptos b√°sicos de la inspecci√≥n con estado, lo m√°s probable es que tenga algunos conceptos err√≥neos. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hay un error</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que a veces veo entre colegas.</font></font> Atencion<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°La inspecci√≥n con estado no se trata solo del estado de conexi√≥n TCP, UDP o ICMP! </font><font style="vertical-align: inherit;">Tambi√©n se trata del estado de otros protocolos y aplicaciones m√°s complejos: FTP, SIP, RPC, SMTP, SMB, etc.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un ejemplo </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FTP es un protocolo de capa de aplicaci√≥n. </font><font style="vertical-align: inherit;">Y tiene un comando PORT que puede asignar una nueva conexi√≥n TCP. </font><font style="vertical-align: inherit;">Cualquier firewall que se posicione como un firewall de inspecci√≥n con estado debe monitorear los comandos FTP y ver el comando PORT y permitir la conexi√≥n al puerto y la direcci√≥n que se solicitan all√≠. </font><font style="vertical-align: inherit;">Y esto no es todo: el firewall tambi√©n debe reemplazar los par√°metros del comando PORT e insertar la direcci√≥n correcta si el servidor FTP funciona para NAT.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es decir, en cualquier firewall L4 moderno hay un componente que esp√≠a en el nivel L7. </font><font style="vertical-align: inherit;">Y hay m√°s de un protocolo de este tipo: todav√≠a hay HTTP, RPC y otros ... Y estos analizadores de protocolo de capa 7 se denominan Application Layer Gateway (ALG).</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un ejemplo </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El m√°s "favorito" al mismo tiempo para los usuarios de redes y seguridad es ALG para SIP, con el cual muchos que configuran SIP ALG en el firewall L4 est√°n hartos de problemas y, a menudo, terminan desconect√°ndolo.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es decir, ya en el firewall L4 est√°n los inicios del an√°lisis de los protocolos de nivel 7. </font><font style="vertical-align: inherit;">Los firewalls L4 difieren entre s√≠ en la cantidad de ALG implementados. </font><font style="vertical-align: inherit;">Cuando compara los firewalls L4 convencionales, una pregunta justa para el ingeniero de sistemas del fabricante ser√°: ¬øcu√°ntos protocolos y aplicaciones admite su motor de inspecci√≥n de estado? </font><font style="vertical-align: inherit;">Como regla, nadie responde.</font></font><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Resulta que el firewall L7 tambi√©n es un firewall de inspecci√≥n con estado, pero que analiza y almacena el estado de TODAS las aplicaciones, y no solo selectivamente, como el firewall L4. </font></font></blockquote><br><br><a name="Sessions"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El segundo error es</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hecho por los propios fabricantes de firewall. Tome cualquier hoja de datos donde el fabricante escriba un par√°metro como el "n√∫mero de sesiones concurrentes". La pregunta para el fabricante es la siguiente: ¬øqu√© protocolo y sesiones de aplicaci√≥n se midieron y al menos con estado para TCP habilitado, sin mencionar que hubo alguna verificaci√≥n para el nivel L7?</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sabemos que cada protocolo o aplicaci√≥n tiene un estado que el firewall recuerda. Y para almacenar este estado, debe asignar un b√∫fer en la memoria del dispositivo. De hecho, el par√°metro "n√∫mero de sesiones simult√°neas" significa cu√°ntos buffers para almacenar estados se pueden acomodar en la memoria del dispositivo. Debe comprender que para el firewall L4, este par√°metro se mide con mayor frecuencia para TCP desnudo o incluso UDP. Es decir, TCP necesita un b√∫fer en el que solo quepan la IP y el puerto de conexi√≥n. Sin embargo, en la prueba para aplicaciones L7, por ejemplo, HTTP, este b√∫fer ser√° mucho m√°s grande, porque, por ejemplo, almacenar par√°metros de solicitud GET dentro de HTTP requiere m√°s memoria. Y el recuerdo no es de goma. En consecuencia, si el fabricante escribe un par√°metro como "el n√∫mero de sesiones simult√°neas", entonces debe escribir:</font></font><br><ul><li>         /, c  stateful inspection, </li><li>     L4,      TCP/IP, </li><li>   -  L7    . </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mida correctamente el firewall L7 en la cantidad de sesiones HTTP simult√°neas, en paquetes de diferentes longitudes: 64Kb, 44Kb, 16Kb, 1.5Kb. Est√° claro que si alg√∫n fabricante hizo todas las mediciones en UDP 1518 bytes, lo m√°s probable es que dicho dispositivo no funcione en su red, ya que no funcionar√° para obligar a sus usuarios a enviar solo paquetes UDP de 1518 bytes de longitud, y a√∫n m√°s obligarlos a responder con tal Paquetes de servidor HTTP Es necesario decirle a dicho fabricante que el rendimiento del firewall L7 debe medirse al menos en el tr√°fico con el protocolo HTTP. De las compa√±√≠as conocidas que realizan tales pruebas p√∫blicamente: NSS Labs. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los propios fabricantes de firewall realizan pruebas personalizadas en sus laboratorios, que pueden ordenar su perfil de tr√°fico, por ejemplo: 30% del tr√°fico HTTPS, 10% del tr√°fico SMB, 10% del tr√°fico FTP, etc.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un ejemplo </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despu√©s de verificar el dispositivo de uno de los fabricantes de UTM en el generador de tr√°fico IXIA:</font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en modo firewall L4: 4,000,000 sesiones simult√°neas, </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en modo firewall L7: 200,000 sesiones simult√°neas. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Esto indica que hay menos buffers para sesiones L7 en la memoria del dispositivo debido a su gran tama√±o. </font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y, por cierto, tambi√©n ser√° con el rendimiento general del dispositivo: con las comprobaciones de contenido de la aplicaci√≥n desactivadas, el firewall funciona 10 veces m√°s r√°pido que con las activadas. </font><font style="vertical-align: inherit;">Es posible utilizar solo an√°lisis de encabezados de nivel 4 para acelerar el dispositivo, pero ya no hay seguridad.</font></font><br><br><a name="Cluster"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El tercer punto importante</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Trabajar en un cl√∫ster. Todos los cortafuegos deben funcionar en un cl√∫ster, porque si un cortafuegos deja de funcionar, entonces su tarea es "acostarse" y bloquear todo el tr√°fico; esta es la teor√≠a de construir protecci√≥n sobre la base de los cortafuegos. Mientras que un firewall "roto" bloquea el tr√°fico, el firewall vecino debe asumir la tarea de pasar tr√°fico leg√≠timo. Pero, ¬øqu√© pasa con las conexiones que pasaron por el primero? Lo m√°s probable es que el primer cortafuegos haya pasado el estado de todas las conexiones al segundo, pero si solo pas√≥ el estado de los encabezados IP al vecino o el estado completo de todas las aplicaciones de nivel L7: pero hubo algunas conexiones SSL que fueron descifradas y IPS y antivirus funcionaron en ellas. paquetes en el b√∫fer para verificar el contenido. Y aqu√≠ resulta que el firewall L4 y L7 tambi√©n son diferentes:El estado de transmisi√≥n L4 no es lo mismo que el estado de transmisi√≥n L7. Esto tambi√©n es importante de entender.</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existe otro concepto err√≥neo de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que el firewall L7 puede operar en grupos de m√°s de dos dispositivos; esto es incorrecto, ya que la cantidad de datos L7 transmitidos aumenta exponencialmente con cada nuevo nodo en el grupo y el procesamiento de datos de incluso dos vecinos excede el costo de procesar los datos de su propio dispositivo. Es por eso que los cl√∫steres de m√°s de dos dispositivos funcionan solo intercambiando encabezados L4, y al cambiar de cl√∫ster, se reinician todas las funciones de an√°lisis y protecci√≥n de aplicaciones.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por lo tanto, debe comparar de manera competente el firewall L4 y L7, al igual que cuando compara si un autom√≥vil y un tanque son adecuados para usted en la guerra. </font><font style="vertical-align: inherit;">Para aumentar la seguridad de su red, el firewall L7 hace un trabajo m√°s complejo, se trabaja mucho m√°s en sus procesadores y necesita m√°s memoria para almacenar el estado de sus aplicaciones. </font><font style="vertical-align: inherit;">Todo esto debe hacerse por seguridad. </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 2. Impacto de seguridad del cortafuegos L7</font></font></a> <br><a name="Opros"></a></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es436392/">https://habr.com/ru/post/es436392/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es436376/index.html">Descripci√≥n general del robot todo terreno EZ-Robot Roli Rover</a></li>
<li><a href="../es436378/index.html">bobaos.pub - KNX TP / UART, Raspberry Pi y Redis</a></li>
<li><a href="../es436380/index.html">Inicio r√°pido en la impresi√≥n 3D: impresoras econ√≥micas para principiantes o tecnolog√≠a para las masas</a></li>
<li><a href="../es436382/index.html">Antig√ºedades: diez a√±os de evoluci√≥n del port√°til con el ThinkPad X301</a></li>
<li><a href="../es436390/index.html">Hacemos UITableView. Para principiantes</a></li>
<li><a href="../es436394/index.html">Demis Hassabis: el gran intelecto que cre√≥ el gran intelecto</a></li>
<li><a href="../es436396/index.html">¬øPuedo usar la programaci√≥n funcional en mi lenguaje?</a></li>
<li><a href="../es436398/index.html">Agua</a></li>
<li><a href="../es436400/index.html">Configure el entorno de desarrollo para aprender HTML, CSS, PHP en Windows</a></li>
<li><a href="../es436404/index.html">Equilibrio de tr√°fico VoIP tolerante a fallas. Cambio de carga entre centros de datos en la hora pico</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>