<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤹🏿 🚎 👩🏾‍🚒 MIRO ist eine offene Indoor-Roboterplattform. Teil 4 - Softwarekomponente: ARDUINO (AVR) 🎄 🧕🏻 👩🏿‍🌾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wir bauen die Softwarekomponente der MIRO-Plattform weiter auseinander. Ich möchte die Software unter AVR genauer untersuchen. Aus diesem Grund werden...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>MIRO ist eine offene Indoor-Roboterplattform. Teil 4 - Softwarekomponente: ARDUINO (AVR)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475512/"><img src="https://habrastorage.org/webt/yq/gb/cs/yqgbcsglidkja0zh62mzaqgixme.png" alt="Bild"><br><br>  Wir bauen die Softwarekomponente der MIRO-Plattform weiter auseinander.  Ich möchte die Software unter AVR genauer untersuchen.  Aus diesem Grund werden wir dem Thema zwei Teile widmen.  In der ersten beschreiben wir die allgemeine Struktur der Bibliothek und in der zweiten die Implementierung einiger Schlüsselklassenmethoden. <br><a name="habracut"></a><br>  Inhaltsverzeichnis: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 2</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 3</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 4</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 5</a> . <br><br>  Die Software für ARDUINO war die größte der selbstgeschriebenen.  Im Allgemeinen liegt fast die gesamte Logik der direkten Arbeit mit Aktuatoren und Sensoren des Roboters beim AVR.  Und auf dieser Ebene wird API implementiert - eine schnelle Entwicklungssoftware für MIRO. <br><br>  Die API-Struktur ist im Wiki-Abschnitt des entsprechenden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Repositorys beschrieben</a> .  Bisher nur in russischer Sprache.  Und jetzt werden wir den Code genauer analysieren.  Ich werde nicht absichtlich vollständige Klassendeklarationen abgeben, sondern sie mit den Auslassungspunkten "..." abkürzen, sodass nur die im Moment wichtigen Dinge übrig bleiben. <br><br>  In unserem Softwaremodell besteht jeder MIRO-Roboter aus einem Chassis und einer Reihe verbundener Geräte.  Bei der Konstruktion wurde davon ausgegangen, dass das Roboterfahrwerk - es wird immer ein Fahrwerk auf Rädern sein - Laufroboter oder Roboter, die andere Bewegungsprinzipien verwenden, separat betrachtet werden sollten. <br><br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Miro</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Robot { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Miro(byte *PWM_pins, byte *DIR_pins); <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> defined(ENCODERS_ON) Miro(byte *PWM_pins, byte *DIR_pins, byte *ENCODER_pins); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> ~Miro(); ... };</span></span></code> </pre> <br>  Die Miro-Klasse ist eine Klasse der obersten Ebene und beschreibt die vollständige Konfiguration des Roboters.  Diese Klasse ist der Nachfolger der Roboterklasse, die nur die grundlegendsten Funktionen des Roboters beschreibt. <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Robot</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Robot(byte *PWM_pins, byte *DIR_pins); <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> defined(ENCODERS_ON) Robot(byte *PWM_pins, byte *DIR_pins, byte *ENCODER_pins); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> ~Robot(); Chassis chassis; void Sync(); int attachDevice(Device *dev); int dettachDevice(Device *dev); ... protected: Device* _devices[ROBOT_MAX_DEVICES]; byte _device_count; };</span></span></code> </pre><br>  Der Designer führt die Ersteinrichtung der Chassis-Pins und die Anfangswerte der Roboterkonfiguration durch. <br><br>  Die Sync () -Methode implementiert die erforderlichen Operationen für das Chassis und für alle an den Roboter angeschlossenen Geräte in jedem Schritt des Hauptschleifenzyklus () der ARDUINO-Skizze.  Die Miro Sync () -Methoden der Miro-Klasse rufen die entsprechenden Sync () -Methoden des Gehäuses und aller mit dem Roboter verbundenen Geräte auf. <br><br>  Die Robot-Klasse enthält auch einen Zeiger auf ein Array von Geräten, die mit dem Roboter verbunden sind, sowie Methoden zum Arbeiten mit diesem Array (ein neues Gerät verbinden, trennen, nach Index und Name suchen).  Die Roboterklasse enthält auch ein Objekt der Chassis-Klasse - das Chassis. <br><br>  Aber fangen wir mit etwas Einfacherem an - mit Geräten.  Jedes Gerät, das mit dem Roboter verbunden werden kann, sei es eine LED, ein Sensor oder ein Aktor, der nicht direkt mit dem Chassis (Wagen) zusammenhängt, wird durch seine Nachfolgerklasse beschrieben, die für alle Geräte in der virtuellen Geräteklasse gilt: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Device</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sync</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setParam</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(byte pnum, byte *pvalue)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getParam</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(byte pnum, byte *pvalue)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> byte </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPinsCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> byte </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getParamCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: byte *pins[<span class="hljs-number"><span class="hljs-number">2</span></span>]; };</code> </pre><br>  Die virtuellen Methoden setParam, getParam, getParamCount sind mit dem Zuweisen, Empfangen und Bestimmen der Anzahl der Geräteparameter verbunden.  Der Parameter kann eine beliebige Eigenschaft sein: die Helligkeit der LED, die Position des Servoverstärkers usw. Die Nachfolgerklasse jedes Geräts implementiert diese Methoden auf ihre eigene Weise.  Der Zweck der getName- und getPinsCount-Methoden ergibt sich meines Erachtens aus dem Namen.  Die neu entdeckte Sync-Methode ist eine spezielle Methode zur blockierungsfreien Gerätesteuerung und -automatisierung einiger Gerätevorgänge, die regelmäßig bei jeder Iteration der Hauptschleife ausgeführt werden müssen. <br><br>  Betrachten wir nun eine mehr oder weniger allgemeine Implementierung der abgeleiteten Klasse. <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MIROUsonic</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Device { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sync</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setParam</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(byte bnum, byte *pvalue)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getParam</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(byte bnum, byte *pvalue)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">byte </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPinsCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">byte </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getParamCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(byte trig_pin, byte echo_pin)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">On</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> max_dist)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">On</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDist</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> max_dist)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMesCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> _isOn; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _mesCount; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _dist; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _max_dist; };</code> </pre><br>  Bei der Bestimmung der Klasse eines Ultraschall-Entfernungsmessers (oben) gibt es neben den Methoden des Elternteils auch Methoden: <br><br><ul><li>  Init - Initialisierung; </li><li>  Ein und Aus - Gerät einschalten (Entfernungsmesser); </li><li>  getDist - gibt die vom Entfernungsmesser gemessene Entfernung zurück; </li><li>  getMesCount - gibt die Anzahl der Messungen zurück, die seit dem Einschalten des Geräts durchgeführt wurden. </li></ul><br>  Um den internen Status des Geräts zu speichern, werden die folgenden Felder verwendet: <br><br><ul><li>  _isOn (TRUE - das Gerät ist eingeschaltet, gesteuert durch die Methoden On und Off); </li><li>  _mesCount (speichert die Anzahl der Dimensionen, die in der getMesCount-Methode verwendet werden); </li><li>  _max_dist - maximal benötigter Abstand zur Messung *; </li><li>  _dist ist die tatsächlich gemessene Entfernung. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Über den maximalen Messbereich</b> <div class="spoiler_text">  * <i>Es ist bekannt, dass der weit verbreitete HC-SR04 laut Pass Entfernungen von bis zu 4 Metern messen kann.</i>  <i>Das Messverfahren selbst beinhaltet jedoch das Warten auf die Rückkehr des Ultraschallsignals, gefolgt von der Codierung der Dauer in dem Signal auf der Echoleitung.</i>  <i>Und in der Tat, wenn der Benutzer definitiv keine Entfernungen im Bereich von bis zu 4 Metern messen muss, aber genug, beispielsweise 1 Meter, dann können Sie viermal weniger auf das reflektierte Signal warten.</i>  <i>Der Entfernungsmesser selbst erzeugt ein Signal auf der Echo-Leitung, sobald er es empfängt, und führt eine Modulation durch.</i>  <i>Das heißt</i>  <i>Dies hat möglicherweise keinen Einfluss auf die Länge des Zeitraums zwischen benachbarten Messungen, aber die Dauer einer einzelnen Messung kann auf diese Weise verringert werden.</i> <br></div></div><br>  Und nun zur Erläuterung der Sync-Methode.  Wenn das Gerät den Status _isOn == TRUE (on) hat, wird der Messzyklus selbst mit der Methode Sync ausgeführt und das Messergebnis im Feld _dist aufgezeichnet.  In diesem Fall gibt die Methode beim Aufruf von getDist sofort den in _dist aufgezeichneten Wert zurück, es findet kein Messzyklus statt.  Wenn _isOn == FALSE (off) ist, wird der Messzyklus im Gegensatz dazu nur während des Aufrufs von getDist ausgeführt. In der Sync-Methode wird nichts gemessen.  Es wird davon ausgegangen, dass der Programmierer die Sync-Methode des gesamten Roboters aufruft, die wiederum die gleichnamigen Sync-Methoden aller mit dem Roboter verbundenen Geräte und eines Objekts der Chassis-Klasse (Chassis) aufruft. <br><br>  Von den Geräten in der API sind nur die Dinge implementiert, die MIRO jetzt hat: LED, Ultraschall-Entfernungsmesser, Lichtsensor mit Fotowiderstand, Servoantrieb, Zeilensensor. <br><br>  Das Chassis leicht berühren.  Diese Klasse implementiert den "abstrakten Wagen" des Roboters.  Es enthält Methoden, mit denen Sie Mover steuern können. <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Chassis</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Chassis(byte *PWM_pins, byte *DIR_pins); <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> defined(ENCODERS_ON) Chassis(byte *PWM_pins, byte *DIR_pins, byte *ENCODER_pins); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> ~Chassis(); void Sync(); float getVoltage(); int wheelRotatePWMTime(int *speedPWM, unsigned long time); int wheelRotatePWM(int *speedPWM); bool wheelIsMoving(byte wheel) {return this-&gt;_wheel_move[wheel];} byte getWheelCount() { return WHEEL_COUNT; } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> defined(ENCODERS_ON) int wheelRotateAng(float *speed, float *ang, bool en_break); unsigned long wheelGetEncoder(byte wheel); ... #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//ENCODERS_ON private: float _vbat; //Battery volgage bool _wheel_move[WHEEL_COUNT]; char _wheelDir[WHEEL_COUNT]; byte _wheel_PWM_pins[WHEEL_COUNT]; byte _wheel_DIR_pins[WHEEL_COUNT]; void _init(byte *PWM_pins, byte *DIR_pins); #if defined(ENCODERS_ON) byte _wheel_ENCODER_pins[WHEEL_COUNT]; bool _wheel_sync_move; float _wheelAngSpeed[WHEEL_COUNT]; float _wheelSetAng[WHEEL_COUNT]; float _wheelSetAngSpeed[WHEEL_COUNT]; ... #endif //ENCODERS_ON };</span></span></span></span></code> </pre><br>  Betrachten wir einen Wagen ohne Geber und in der Regel ohne Rückmeldung, so gibt es hierfür einfache Steuermethoden mit einem PWM-Signal.  Wenn sich Encoder im Wagen befinden, wird die Klasse viel komplizierter.  Um das Leben des Benutzers zu vereinfachen, erscheinen darin Methoden wie: <br><br><ul><li>  wheelRotateAng - Raddrehung bei vorgegebenen Drehwinkeln mit vorgegebenen Winkelgeschwindigkeiten; </li><li>  wheelGetPath - gibt die Länge des von jedem Rad zurückgelegten Pfades zurück; </li><li>  wheelGetLinSpeed ​​- gibt die aktuelle lineare Geschwindigkeit jedes Rads zurück; </li><li>  wheelGetAngSpeed ​​- Gibt die aktuelle Winkelgeschwindigkeit jedes Rads zurück. </li><li>  wheelGetEncoder - gibt die Anzahl der Antworten der Encoder jedes Rads zurück. </li></ul><br>  Und eine Reihe von Hilfsmethoden.  Sowie eine Antriebskalibrierungsmethode.  Im Detail werden die wichtigsten Methoden der Chassis-Klasse das nächste Mal betrachtet. <br><br>  Mit Blick auf die Zukunft ist an dieser Stelle anzumerken, dass diese gesamte Miro-Bibliothek leicht mit jedem anderen Roboter mit einem zweirädrigen Differenzialbewegungsschema angepasst oder ergänzt werden kann.  Und mit einem gewissen Aufwand - und zu anderen Antriebs- und Lenkkonfigurationen.  Im Falle einer Differentialschaltung müssen Sie nur die Konfigurationsdatei config.h korrekt beschreiben.  Und ohne RPi.  Zum Beispiel haben wir in weniger als einer Stunde für unser regionales BlackMirrorCTF-2019-Cybersicherheitsturnier an unserer Universität alles über solche Kleinen ins Leben gerufen ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link</a> ). <br><br><img src="https://habrastorage.org/webt/z8/ie/nk/z8ienkgagi7itbygujwbur1as4a.png" alt="Bild"><br><br>  Die Roboter hatten eine Schnittstelle für den Zugriff über TELNET und ein Befehlssystem zur Fernsteuerung.  Das Dokument mit dem Befehlssystem war irgendwo versteckt oder verschlüsselt.  Die Teilnehmer haben die IP-Adressen gescannt und die Ports auf den Robotern selbst geöffnet.  Bei einer erfolgreichen Verbindung gaben die Roboter eine Einladung heraus und die Teilnehmer verstanden, dass sie "eingetreten" waren.  Nun, dann brachten die Teams die Roboter entlang der Autobahn zur Ziellinie.  Ursprünglich wollten sie die gesamte Strecke mit Robotern irgendwo in einem isolierten Raum mit installierter IP-Kamera machen, aber die Organisatoren hatten einige Probleme mit der IP-Kamera und verloren etwas an Charme. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/KSd1O-lMriE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Das ist alles für jetzt.  Es ist möglich, dass sich das Programmmodell im Laufe der Entwicklung ändert.  Übrigens, es wurde kürzlich leicht modifiziert, nachdem der Code etwas erfahrener aussah als OOP-shchik. <br><br>  Vor dem fünften Teil - lassen Sie uns über Encoder, Winkel und Kalibrierungen sprechen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de475512/">https://habr.com/ru/post/de475512/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de475494/index.html">"Gibt es ein Leben nach Signor?" Oder worüber werden wir auf der SECR-2019 sprechen</a></li>
<li><a href="../de475496/index.html">So ermitteln Sie die Adresse eines Smart-Vertrags vor der Bereitstellung: Verwenden von CREATE2 für den Krypto-Austausch</a></li>
<li><a href="../de475498/index.html">Windows Server Core vs. GUI und Softwarekompatibilität</a></li>
<li><a href="../de475506/index.html">Interview mit Mikhail Chinkov über Arbeit und Leben in Berlin</a></li>
<li><a href="../de475510/index.html">Inkrementelles Backup in einem Dutzend Zeilen</a></li>
<li><a href="../de475514/index.html">IOS-Killer: Jailbreak mit checkra1n in Fragen und Antworten</a></li>
<li><a href="../de475518/index.html">Das kanadische Unternehmen hat Material entwickelt, das Sie unsichtbar macht</a></li>
<li><a href="../de475520/index.html">CSS-Übergang der Eigenschaft height von 0px zu auto</a></li>
<li><a href="../de475522/index.html">HP: Ihr ursprüngliches Laufwerk ist überhaupt nicht original. Wer ist schuld und was zu tun?</a></li>
<li><a href="../de475536/index.html">Lebenslauf für einen freiberuflichen Übersetzer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>