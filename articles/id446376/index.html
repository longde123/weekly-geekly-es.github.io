<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöµ üöÉ üåü Bagaimana cara menuliskan alamat rumah? üë®‚Äçüéì üò¨ üë≥üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bagaimana Layanan Pajak, OpenStreetMap, dan InterSystems IRIS 
 dapat membantu pengembang mendapatkan alamat yang bersih 

 Pieter Brueghel yang Muda,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bagaimana cara menuliskan alamat rumah?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446376/"><h3>  Bagaimana Layanan Pajak, OpenStreetMap, dan InterSystems IRIS <br>  dapat membantu pengembang mendapatkan alamat yang bersih </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/60d/d11/8ee/60dd118eefedf8b71edb40b5adcfcb77.jpg" alt="gambar"><br>  <i>Pieter Brueghel yang Muda, <b>Membayar Pajak</b> (Pemungut Pajak), 1640</i> <br><br>  Dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel</a> saya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sebelumnya</a> , kami hanya melihat permukaan benda.  Mari kita lanjutkan pengintaian kita.  Topik hari ini adalah topik yang sulit.  Ini bukan DATA BESAR, tetapi masih merupakan data yang tidak mudah untuk dikerjakan: kita sedang berbicara tentang jumlah data yang cukup besar.  Semuanya tidak akan masuk ke RAM sekaligus, dan beberapa bahkan tidak muat di drive (bukan karena kurangnya ruang, tetapi karena ada banyak sampah).  Nama subjek kami adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">FIAS DB</a> : database Sistem Informasi Alamat Federal - basis data alamat di Rusia.  Arsipnya 5,5 GB.  Dan itu adalah file XML terkompresi.  Setelah ekstraksi, ini akan menjadi penuh 53 GB (sisihkan 110 GB untuk ekstraksi).  Dan ketika Anda mulai mem-parsing dan mengubahnya, 110 GB itu tidak akan cukup.  RAM juga tidak akan cukup. <br><a name="habracut"></a><br>  Itu semua akan baik-baik saja, tetapi Anda bisa terus menggali.  Sudah ada proyek sumber terbuka internasional untuk mengumpulkan dan mensistematisasikan data alamat: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">OpenAddresses</a> .  Basis data mereka akan lebih besar.  Saat ini ada banyak tempat kosong di peta mereka.  Rusia, misalnya, hampir kosong.  Ukuran arsip ini adalah 10 GB. <br><br>  Tetapi hal pertama yang pertama, kami mempertimbangkan database dari proyek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">OpenStreetMaps yang</a> cukup terkenal.  Itu dibangun oleh sukarelawan, mengikuti contoh Wikipedia.  Ini cukup menyeluruh dan multibahasa.  Dan proyek ini baru saja menerima penghargaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">The Free Software Foundation 2018</a> .  Saat ini, ukuran seluruh arsip sebagai file XML terkompresi adalah 74 GB. <br><br>  Berbicara tentang alamat, saya telah mendengar beberapa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">berita</a> tak terduga <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dari DuckDuckGo</a> , mesin pencari terbaik dan aman saat ini mengumumkan kepindahannya ke Apple Maps.  Lebih tepatnya, ke Apple MapKit JS.  Yang paling menarik tentang ini untuk tujuan kami adalah "pencarian alamat yang ditingkatkan."  Apakah Apple lebih baik daripada orang lain dalam mengumpulkan dan melindungi data kita dengan cermat?  Kita harus mengawasi ... <br><br>  Jadi, inilah tantangannya.  Bagaimana kita bisa meletakkan semua data alamat ini ke dalam repositori yang mudah digunakan, memungkinkan untuk membayangkan API yang mudah (tentu saja dengan Python), dan mencegah perangkat keras kita yang dicintai runtuh di bawah beban besar ini?  Sebut saja MicroBigData, mD, atau ŒºBD ini. <br><br>  Hampir setiap pengembang telah mendengar sindiran berikut.  Direktori alamat adalah direktori nama tempat, yang merupakan hal yang sangat berguna.  Saya tidak tahu persis berapa banyak data alamat di proyek Anda yang terbaru.  Bagaimanapun, ada begitu banyak daerah, kota, dan jalan.  Tetapi tampaknya mereka diperlukan untuk proyek apa pun yang melibatkan orang.  Ada alamat di mana Anda dapat menemukan seseorang atau mengirim mereka paket.  Lalu ada informasi yang diperlukan untuk paspor dan dokumen lainnya.  Dan mungkin ada alamat kantor atau tengara yang direkomendasikan seseorang kepada Anda.  Jadi apa yang harus kamu lakukan?  Di mana Anda harus mendapatkannya? <br><br>  Tanpa memperhitungkan kesalahan dan duplikat, solusi paling sederhana melibatkan objek primitif yang berisi string string literal (atau konstanta string).  Biarkan pengguna membuat entri tambahan.  Dan benda tahu bagaimana menyelamatkan diri, seperti yang telah kita <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bahas sebelumnya</a> . <br><br>  Ambil objek yang dijelaskan dalam kelas di bawah ini sebagai contoh.  Kasing <a href="">buku teks</a> , meskipun dalam bentuk alamat USA, tetapi dengan penyesuaian untuk dataset Rusia kami: kode pos alih-alih ZIP.  Saya juga akan mengubah kode pos menjadi angka, tetapi saya akan membiarkannya sebagai string agar semuanya tetap seragam.  Siapa pun yang mengenali bahasa (ObjectScript) segera akan mendapatkan "suka" yang gratis. <br><br><pre><code class="plaintext hljs">Class Sample.Address Extends %Persistent { Property streetName As %String; Property cityName As %String; Property areaName As %String; Property postalCode As %String; }</code> </pre> <br>  Tentu saja, banyak orang akan menangis busuk, mengatakan semua literal mencuat dari objek.  Siapa yang pernah mendengar benda yang mengudara di depan umum?  Mari kita biarkan seperti itu untuk saat ini.  Ini adalah contoh yang cukup fasih, dan setiap siswa dapat memahaminya. <br><br>  Sebenarnya, hanya itu yang kita butuhkan.  Kami mengisi kolom.  Menyimpannya.  Menyerahkannya ke benda lain.  Orang lain akan mewarisinya.  Semuanya bekerja.  Dan itu tersimpan! <br><br><blockquote>  Tetapi saya harus mengatakan beberapa kata tentang mengapa itu tidak boleh dilakukan dengan cara ini.  Apa Alamat objek kami?  Mengapa tidak bisa hanya sekelompok string teks?  Keberatan paling jelas yang muncul dari konteks: siapa yang menggunakan Alamat ini, dalam bentuk apa mereka menggunakannya, dan untuk tujuan apa?  Cobalah untuk menempatkan logika programmer Anda ke samping dan bayangkan bagaimana "turis asing," "sejarawan," "pemungut pajak," atau "pengacara" berpikir. <br><br>  Saya menduga Anda segera memunculkan banyak pertanyaan tambahan: bahasa dan pengodean apa yang harus digunakan, periode waktu apa yang harus dipertimbangkan, dan jenis dokumen apa yang terlibat dalam operasi ini: legal atau pos?  Dan sebuah kota: apakah itu nama lokalitas, atau apa?  Bahkan jalan bisa menjadi bulevar, lajur, jalan, atau yang lainnya.  Bagaimana seharusnya semua detail penting ini ditangani? <br><br>  Mari kita lihat contoh kehidupan nyata.  Google sekarang dijalankan oleh Sundar Pichai.  Dia dari India.  Ia dilahirkan di kota Chennai.  Atau Madras?  Pada tahun 1996, penduduk memutuskan bahwa nama kota itu terdengar terlalu Portugis dan berganti nama menjadi ibu kota negara bagian Tamil Nadu dari Madras ke Chennai.  Jadi apa yang harus dimasukkan Sundar dan 72 juta rekan senegaranya ke dalam dokumen elektronik mereka? <br><br>  Bahkan, ada seluruh ilmu yang mempelajari ini: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">toponim terapan</a> . </blockquote>  Jadi, ada beberapa pertanyaan lanjutan.  Bagaimana seharusnya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">waktu dan tanggal</a> ditangani?  Bagaimana dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">yang jelas, uang</a> ?  Atau koordinat geografis?  Dan bagaimana Anda menerapkan ini dalam kode Anda?  Dan apakah Anda dapat mentransfernya ke DBMS pilihan Anda tanpa menurunkan lapisan abstraksi?  Bagaimana Anda menghindari spiral ke bawah ke tipe atom data mesin dan pemikiran konstan tentang rekonstruksinya?  Dalam hal ini, ada baiknya mencari sumber dari API primitif atau berkualitas baik.  Pikirkan ini di waktu luang Anda. <br><br>  Singkatnya, konteks adalah hal yang paling penting.  Dan model objek memungkinkan kita untuk menggunakannya secara langsung dengan merangkum "data mesin" dan menerapkan perilaku "kehidupan nyata" yang bergantung pada konteks.  Bukan karena tuple tingkat rendah diatur dalam tabel ;-) <br><br>  Sementara itu, kami akan kembali ke implementasi "primitif" dan membuat segalanya lebih sulit bagi diri kita sendiri.  Untuk memulai, kami akan menghilangkan kesalahan dan duplikat.  Dengan kata lain, kami akan mencari cara untuk menulis alamat dengan benar saat pertama kali.  Pada saat yang sama, kami akan membantu pengembang UI memberikan petunjuk bagi pengguna saat mereka memasukkan data ke dalam bidang. <br><blockquote>  Ketika ada dua hal di satu tempat - teks dan platform data IRIS InterSystems - seorang pengembang memiliki peluang nyata untuk benar-benar membalikkan keadaan tanpa meninggalkan mesin.  Dengan menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">komponen objek yang tertanam, iKnow dan iFind</a> , misalnya.  Komponen-komponen ini dimaksudkan untuk bekerja dengan data yang tidak terstruktur dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pencarian teks lengkap</a> . </blockquote>  Mari kita coba cari skema data untuk OpenStreetMap.  Ini tidak semudah kelihatannya pada awalnya.  Saya tidak tahu alasan pastinya, tetapi tidak <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ada skema data untuk OSM</a> .  Dan itu akan banyak membantu kita, seperti yang akan dilihat di bawah ini!  Dan itu tidak akan menciptakan kembali roda, gunakan <a href="">XSD yang cocok</a> , yang saya temukan untuk Anda.  Dan terima kasih, Oliver Schrenk.  <a href="">Ini lebih banyak gambar</a> .  Saya harus mengatakan bahwa untuk keperluan kami, ini sesuai dan sesuai dengan struktur internal file XML dan unduhan OSM.  Mengapa ini penting, tetapi baris pertama dalam file XSD harus dimulai dengan "&lt;? Xml ...". <br><br>  Elemen adalah komponen dasar dari model data konseptual OpenStreetMap tentang dunia fisik.  Mereka terdiri dari <br><br><ul><li>  node - mendefinisikan titik-titik dalam ruang, </li><li>  cara - mendefinisikan fitur linier dan batas wilayah, dan </li><li>  hubungan - yang kadang-kadang digunakan untuk menjelaskan bagaimana elemen-elemen lain bekerja bersama. </li></ul><br>  Semua hal di atas dapat memiliki satu atau lebih tag terkait (yang menggambarkan arti elemen tertentu).  Tag terdiri dari dua item, kunci, dan nilai.  Tag menggambarkan fitur spesifik elemen peta: node, cara, atau hubungan. <br><br>  Di mana jalan-jalan dan kota-kota?  Itu rahasia besar!  Geometri itu diajarkan dengan baik?  Lebih lanjut tentang ini lain kali.  :) <br><br>  Selain itu, kami akan menggunakan wizard skema XSD, yang dibuat dengan anggun untuk kami oleh pengembang IRIS, untuk kelas% XML yang sesuai.  Tanda persen di awal hanya berarti bahwa ini adalah kelas dari pustaka sistem.  <a href="">Informasi lebih lanjut tentang itu dapat ditemukan di dokumentasi</a> .  Kami akan melakukan operasi di terminal. <br><br><pre> <code class="plaintext hljs">set xmlSchema = ##class(%XML.Utils.SchemaReader).%New() do xmlSchema.Process("/path/to/OSMSchema.xsd")</code> </pre> <br>  Anda bisa mendapatkan hal yang sama dari <a href="">Atelier IDE</a> (di menu, buka Tools&gt; Add-Ins&gt; Wizard Skema XML): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/881/3a6/6d1/8813a66d16d498f4ae0d07446df14c23.png" alt="gambar"><br><br>  Karena kami menggunakan wizard dengan menunjukkan nama paket yang dihasilkan dan bukan parameter, mereka berakhir di paket Tes.  Seperti yang dapat Anda lihat dari perintah kedua, saya meneruskan file skema ke server Python lokal saya: <br><br><pre> <code class="python hljs">python3 -m http.server <span class="hljs-number"><span class="hljs-number">80</span></span></code> </pre> <br>  Anda dapat menggunakan http-server lain yang Anda inginkan.  Atau muat file di server IRIS Anda dan arahkan ke sana. <br><br>  Akibatnya, kami memiliki delapan kelas yang sepenuhnya mencerminkan struktur XML alamat kami.  Ini adalah kelas utama OSM.osm: <br><br><pre> <code class="plaintext hljs">Class OSM.osm Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "osm"; Parameter XMLSEQUENCE = 1; Property bounds As OSM.bounds(XMLNAME = "bounds", XMLREF = 1) [ Required ]; Relationship node As OSM.node(XMLNAME = "node", XMLPROJECTION = "ELEMENT", XMLREF = 1) [ Cardinality = many, Inverse = osm ]; Relationship way As OSM.way(XMLNAME = "way", XMLPROJECTION = "ELEMENT", XMLREF = 1) [ Cardinality = many, Inverse = osm1 ]; Relationship relation As OSM.relation(XMLNAME = "relation", XMLPROJECTION = "ELEMENT", XMLREF = 1) [ Cardinality = many, Inverse = osm2 ]; Property version As %xsd.float(XMLNAME = "version", XMLPROJECTION = "ATTRIBUTE") [ InitialExpression = ".6", ReadOnly ]; Property generator As %String(MAXLEN = "", XMLNAME = "generator", XMLPROJECTION = "ATTRIBUTE") [ InitialExpression = "CGImap 0.0.2", ReadOnly ]; }</code> </pre> <br>  Dan OSM.node: <br><br><pre> <code class="plaintext hljs">Class OSM.node Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "node"; Parameter XMLSEQUENCE = 1; Relationship tag As OSM.tag(XMLNAME = "tag", XMLPROJECTION = "ELEMENT", XMLREF = 1) [ Cardinality = many, Inverse = node ]; Property id As %xsd.unsignedLong(XMLNAME = "id", XMLPROJECTION = "ATTRIBUTE"); Property lat As %xsd.double(XMLNAME = "lat", XMLPROJECTION = "ATTRIBUTE"); Property lon As %xsd.double(XMLNAME = "lon", XMLPROJECTION = "ATTRIBUTE"); Property user As %String(MAXLEN = "", XMLNAME = "user", XMLPROJECTION = "ATTRIBUTE") [ SqlFieldName = _user ]; Property uid As %xsd.unsignedLong(XMLNAME = "uid", XMLPROJECTION = "ATTRIBUTE"); Property visible As %Boolean(XMLNAME = "visible", XMLPROJECTION = "ATTRIBUTE"); Property version As %xsd.unsignedLong(XMLNAME = "version", XMLPROJECTION = "ATTRIBUTE"); Property changeset As %xsd.unsignedLong(XMLNAME = "changeset", XMLPROJECTION = "ATTRIBUTE"); Property timestamp As %TimeStamp(XMLNAME = "timestamp", XMLPROJECTION = "ATTRIBUTE"); Relationship osm As OSM.osm(XMLPROJECTION = "NONE") [ Cardinality = one, Inverse = node ]; }</code> </pre> <br>  Seperti yang Anda lihat, beberapa opsi yang telah saya nonaktifkan sebagai solusi yang tidak perlu. <br><br>  Ukuran file XML hanya untuk Rusia adalah sekitar 53 GB.  Anda tidak dapat membukanya dengan alat pemrosesan teks yang biasa: mereka tidak dapat menerima file sebesar ini.  Anda dapat mengambil sampel yang lebih kecil untuk berolahraga, misalnya, alamat Rusia tersedia untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">masing-masing wilayah</a> .  Volume kecil wilayah Kaliningrad dalam format terkompresi akan menjadi 18 MB, file XML yang tidak terkompresi adalah 203 MB. <br><blockquote>  Omong-omong, panjang maksimum string literal dalam InterSystems IRIS adalah 3.641.144 karakter.  Dengan kata lain, memuat file atau URL secara langsung ke dalamnya tidak akan berfungsi.  Anda dapat melihat batasan lain <a href="">dalam dokumentasi</a> .  Untuk bekerja dengan sejumlah besar data, Anda dapat menggunakan aliran data yang tidak memiliki batasan panjang. </blockquote>  Mari kita lihat apa yang kita dapatkan untuk set node. <br><br>  Selanjutnya, kita akan melakukan hal-hal <a href="https://docs.intersystems.com/irislatest/csp/docbook/DocBook.UI.Page.cls?KEY=GXML_import#GXML_import_">berdasarkan buku</a> .  Kami akan membuat objek yang memahami XML sebagai bahasa asli dengan menggunakan kelas dari pustaka sistem% XML.Reader: <br><br><pre> <code class="plaintext hljs">set reader = ##class(%XML.Reader).%New()</code> </pre><br>  Kami akan memberikan instruksi tentang apa yang harus diambil, dan mengabaikan sisanya.  Kami akan mengambil satu kelas: <br><br><pre> <code class="plaintext hljs">do reader.Correlate("node","OSM.node")</code> </pre><br>  Setelah itu, ada berbagai cara untuk mendapatkan file mBD asli.  Jika nyaman, Anda bisa meletakkannya di sebelah repositori penyimpanan, secara lokal di sistem file server IRIS.  Atau, seperti dalam contoh saya, minta dikirim melalui HTTP.  Ada juga opsi yang lebih universal, yang akan saya bicarakan sedikit di bawah. <br><br><pre> <code class="plaintext hljs">set url="http://localhost/kaliningrad-latest.osm" write reader.OpenUrl(url)</code> </pre><br><blockquote>  Penting!  Pada titik ini, kebanyakan orang yang mencoba contoh ini sendiri akan menghadapi sesuatu yang mengerikan.  Alih-alih senang "1" (semuanya baik-baik saja), sistem akan mengembalikan sesuatu yang dimulai dengan "0, STORE ..." Dan itu akan mengecewakan.  Dengan kata lain, file dengan apa yang tampaknya mBD ternyata tidak terlalu mikro, dan tidak akan sesuai dengan objek kita.  Tidak ada cukup memori yang dialokasikan untuk itu.  Bisakah ini diperbaiki?  Tentu saja  Platform data IRIS memungkinkan Anda membuat objek hingga 4 TB dalam RAM.  Jadi apa yang salah?  Secara default, ukuran objek adalah 256 MB dalam pengaturan sistem.  Tetapi kita membutuhkan lebih dari itu.  Dan ingat, ini adalah persyaratan RAM.  Apakah Anda memiliki cukup ruang di komputer / server Anda? </blockquote>  Saya bereksperimen untuk menentukan jumlah memori yang kami perlukan untuk mengakomodasi raksasa ini: hampir 170 GB.  Ini harus ditentukan dalam pengaturan (Menu&gt; Konfigurasi memori&gt; Kapasitas memori maks per proses (KB)) atau melalui <a href="">variabel sistem $ ZSTORAGE</a> (dalam kilobyte): <br><br><pre> <code class="plaintext hljs">set $ZSTORAGE=170000000</code> </pre><br>  Apakah Anda menjalankan proses baru dengan pengaturan memori yang tepat?  Maka bagian selanjutnya mudah: kita hanya membaca dan menyimpan. <br><br>  Ada juga opsi alternatif (dan mungkin lebih disukai): <a href="">gunakan properti UsePPG Handler</a> dari kelas% XML. Reader, yang memungkinkan Anda untuk tidak menyimpan XML dalam memori dan bekerja dengan pengaturan memori standar. <br><br><pre> <code class="plaintext hljs">set reader = ##class(%XML.Reader).%New() set reader.UsePPGHandler = 1</code> </pre><br>  Selanjutnya ... Korelasi / Baca, dll.  ... <br><br><pre> <code class="plaintext hljs">do reader.Next(.object) do object.%Save()</code> </pre><br>  Dan seterusnya, 1.180.849 kali untuk setiap operasi :-) Ini membosankan.  Itu sebabnya kami akan menambahkan metode kelas OSM.map kami untuk mengimpor, berdasarkan pada perintah yang sama: <br><br><pre> <code class="plaintext hljs">ClassMethod Import(url) { Set reader = ##class(%XML.Reader).%New() Set reader.UsePPGHandler = 1 Set status = reader.OpenURL(url) Do reader.Correlate("node","OSM.node") While (reader.Next(.object)) { Do object.%Save() } //back to top of XML file Do reader.Rewind() Do reader.Correlate("way","OSM.way") While (reader.Next(.object)) { Do object.%Save() } Do reader.Rewind() Do reader.Correlate("relation","OSM.relation") While (reader.Next(.object)) { Do object.%Save() } }</code> </pre><br>  Kami akan menggunakan kekuatan eksokorteks komputer kami hanya dengan satu perintah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di terminal</a> : <br><br><pre> <code class="plaintext hljs">do ##class(OSM.osm).Import("http://localhost/kaliningrad-latest.osm")</code> </pre><br>  Jadi, kami mendapatkan data alamat dari tempat terbuka dan mungkin bukan sumber yang sangat andal.  Sudah waktunya untuk melewati tahap yang sama, tetapi pada data yang dapat dipercaya.  Dan juga terstandarisasi, dibersihkan, didokumentasikan dengan baik, dan dibuat oleh badan pemerintah yang tepat: itu adalah legenda.  Untuk kreditnya, layanan pajak Rusia melakukan pekerjaan yang baik dengan produk digitalnya.  Sejauh pekerjaan yang baik dimungkinkan.  Yang pasti, memang ada kekurangannya, dan pembersihan data sedang berlangsung.  Bagaimana cara kita menyelesaikan ini, biarkan para pemimpin pemerintahan merenungkan hal itu.  Mereka membuat keputusan untuk diri mereka sendiri yang bermanfaat bagi kita semua. <br><br>  Dan sekarang mari kita ke yang lebih sulit dipahami - kita akan mengajarkan Alamat untuk membaca data yang tepat dari sumber kami.  Untungnya, set data layanan pajak federal memiliki deskripsi siap pakai untuk struktur dokumen XML.  Menurut <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">deskripsi dari situs web FIAS</a> yang menyertai data, kita akan memerlukan set data ADDROBJ yang, dalam kasus saya, sesuai dengan file AS_ADDROBJ_2_250_01_04_01_01.xsd <br><br>  Selanjutnya, mari kita gunakan wizard skema XSD.  Kami akan melakukan operasi di terminal: <br><br><pre> <code class="plaintext hljs">set xmlScheme = ##class(%XML.Utils.SchemaReader).%New() do xmlScheme.Process("/path/to/AS_ADDROBJ_2_250_01_04_01_01.xsd")</code> </pre><br>  Akibatnya, kami memiliki dua kelas yang sepenuhnya mencerminkan struktur XML alamat kami: <br><br>  Test.AddressObjects <br><br><pre> <code class="plaintext hljs">/// Composition and structure of the file with classifier information for FIAS DB elements in address form Class Test.AddressObjects Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "AddressObjects"; Parameter XMLSEQUENCE = 1; /// Classifier for elements in address form Relationship Object As Test.Object(XMLNAME = "Object", XMLPROJECTION = "ELEMENT") [ Cardinality = many, Inverse = AddressObjects ]; }</code> </pre><br>  Test.object <br><br><pre> <code class="plaintext hljs">/// Created from: http://localhost:28869/AS_ADDROBJ_2_250_01_04_01_01.xsd Class Test.Object Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "Object"; Parameter XMLSEQUENCE = 1; /// Global unique identifier of the address object Property AOGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOGUID", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Formal name Property FORMALNAME As %String(MAXLEN = 120, MINLEN = 1, XMLNAME = "FORMALNAME", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Region code Property REGIONCODE As %String(MAXLEN = 2, MINLEN = 2, XMLNAME = "REGIONCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Autonomy code Property AUTOCODE As %String(MAXLEN = 1, MINLEN = 1, XMLNAME = "AUTOCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Area code Property AREACODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "AREACODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// City code Property CITYCODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "CITYCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Code of area within city Property CTARCODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "CTARCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Locality code Property PLACECODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "PLACECODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Planning structure element code Property PLANCODE As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "PLANCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Street code Property STREETCODE As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "STREETCODE", XMLPROJECTION = "ATTRIBUTE"); /// Code of additional element in address form Property EXTRCODE As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "EXTRCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Code of subordinate additional element in address form Property SEXTCODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "SEXTCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Official name Property OFFNAME As %String(MAXLEN = 120, MINLEN = 1, XMLNAME = "OFFNAME", XMLPROJECTION = "ATTRIBUTE"); /// Postal code Property POSTALCODE As %String(MAXLEN = 6, MINLEN = 6, XMLNAME = "POSTALCODE", XMLPROJECTION = "ATTRIBUTE"); /// Federal Tax Service - Private Individual code Property IFNSFL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "IFNSFL", XMLPROJECTION = "ATTRIBUTE"); /// Federal Tax Service - Private Individual territorial district code Property TERRIFNSFL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "TERRIFNSFL", XMLPROJECTION = "ATTRIBUTE"); /// Federal Tax Service - Legal Entity code Property IFNSUL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "IFNSUL", XMLPROJECTION = "ATTRIBUTE"); /// Federal Tax Service - Legal Entity territorial district code Property TERRIFNSUL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "TERRIFNSUL", XMLPROJECTION = "ATTRIBUTE"); /// Russian Classification on Objects of Administrative Division Property OKATO As %String(MAXLEN = 11, MINLEN = 11, XMLNAME = "OKATO", XMLPROJECTION = "ATTRIBUTE"); /// Russian Classification of Territories of Municipal Formations Property OKTMO As %String(MAXLEN = 11, MINLEN = 8, XMLNAME = "OKTMO", XMLPROJECTION = "ATTRIBUTE"); /// Date of record entry Property UPDATEDATE As %Date(XMLNAME = "UPDATEDATE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Short name of object type Property SHORTNAME As %String(MAXLEN = 10, MINLEN = 1, XMLNAME = "SHORTNAME", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Address object level Property AOLEVEL As %Integer(XMLNAME = "AOLEVEL", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; /// Object identifier of the parent object Property PARENTGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "PARENTGUID", XMLPROJECTION = "ATTRIBUTE"); /// Unique record identifier. Key field. Property AOID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOID", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Record identifier associated with previous historical record Property PREVID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "PREVID", XMLPROJECTION = "ATTRIBUTE"); /// Record identifier associated with next historical record Property NEXTID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "NEXTID", XMLPROJECTION = "ATTRIBUTE"); /// Address object code in one string with validity indicator from Russian Classifier of Addresses (KLADR) 4.0. Property CODE As %String(MAXLEN = 17, MINLEN = 0, XMLNAME = "CODE", XMLPROJECTION = "ATTRIBUTE"); /// Address object code from KLADR 4.0 in one string without validity indicator (last two digits) Property PLAINCODE As %String(MAXLEN = 15, MINLEN = 0, XMLNAME = "PLAINCODE", XMLPROJECTION = "ATTRIBUTE"); /// Validity status of FIAS address object. Current address as of today's date. Usually the last entry about the address object. /// 0 - Not current /// 1 - Current Property ACTSTATUS As %Integer(XMLNAME = "ACTSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; /// Center status Property CENTSTATUS As %Integer(XMLNAME = "CENTSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; /// Operation status on record - reason for record's appearance (see description of OperationStatus table): /// 01 ‚Äì Activation; /// 10 ‚Äì Addition; /// 20 ‚Äì Change; /// 21 ‚Äì Group change; /// 30 ‚Äì Deletion; /// 31 - Deletion due to the deletion of the parent object; /// 40 ‚Äì Attachment of the address object (merger); /// 41 ‚Äì Reassignment due to the merger of the parent object; /// 42 - Termination due to the attachment to another address object; /// 43 - Creation of a new address object due to a merger of address objects; /// 50 ‚Äì Reassignment; /// 51 ‚Äì Reassignment due to the reassignment of the parent object; /// 60 ‚Äì Termination due to segmentation; /// 61 ‚Äì Creation of a new address object due to segmentation Property OPERSTATUS As %Integer(XMLNAME = "OPERSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; /// KLADR 4 validity status (last two digits in the code) Property CURRSTATUS As %Integer(XMLNAME = "CURRSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; /// Start of record operation Property STARTDATE As %Date(XMLNAME = "STARTDATE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// End of record operation Property ENDDATE As %Date(XMLNAME = "ENDDATE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Foreign key to requirements document Property NORMDOC As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "NORMDOC", XMLPROJECTION = "ATTRIBUTE"); /// Current address object indicator Property LIVESTATUS As %xsd.byte(VALUELIST = ",0,1", XMLNAME = "LIVESTATUS", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Address type: /// 0 - not defined /// 1 - municipal; /// 2 - administrative/territorial Property DIVTYPE As %xsd.int(VALUELIST = ",0,1,2", XMLNAME = "DIVTYPE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; Relationship AddressObjects As Test.AddressObjects(XMLPROJECTION = "NONE") [ Cardinality = one, Inverse = Object ]; }</code> </pre><br>  Dari seluruh daftar file XML di FIAS, kami hanya akan menggunakan file dengan nama wilayah, kota, dan jalan.  Ketika saya sedang bersiap untuk publikasi, saya memilikinya: <br><br><pre> <code class="plaintext hljs">AS_ADDROBJ_20190106_90809714-fe22-45b2-929c-52bd950963e0.XML</code> </pre> <br><br>  Mari kita memasak beberapa boneka lada FIAS.  Ini hanya persiapan untuk masa depan yang baik di masa depan.  Pertama, kita akan mendapatkan set minimum awal.  Ini adalah satu-satunya bahan yang kami butuhkan: <br><br><pre> <code class="plaintext hljs">Class FIAS.AddressObject Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "Object"; Parameter XMLSEQUENCE = 1; /// Global unique identifier of the address object Property AOGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOGUID", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Official name Property OFFNAME As %String(MAXLEN = 120, MINLEN = 1, XMLNAME = "OFFNAME", XMLPROJECTION = "ATTRIBUTE"); /// Postal code Property POSTALCODE As %String(MAXLEN = 6, MINLEN = 6, XMLNAME = "POSTALCODE", XMLPROJECTION = "ATTRIBUTE"); /// Short name of object type Property SHORTNAME As %String(MAXLEN = 10, MINLEN = 1, XMLNAME = "SHORTNAME", XMLPROJECTION = "ATTRIBUTE") [ Required ]; /// Address object level Property AOLEVEL As %Integer(XMLNAME = "AOLEVEL", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; /// Object identifier of the parent object Property PARENTGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "PARENTGUID", XMLPROJECTION = "ATTRIBUTE"); /// Unique record identifier. Key field. Property AOID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOID", XMLPROJECTION = "ATTRIBUTE") [ Required ]; }</code> </pre><br>  Kami akan membuat objek yang memahami XML sebagai bahasa asli dengan menggunakan kelas dari pustaka sistem% XML.Reader: <br><br><pre> <code class="plaintext hljs">set reader = ##class(%XML.Reader).%New()</code> </pre> <br>  Kami akan memberikan instruksi tentang siapa yang harus diambil, dan memintanya untuk mengabaikan sisanya.  Kami akan mengambil satu porsi untuk pengujian. <br><br>  Selanjutnya ... Korelasi / Baca, dll.  ... <br><br><pre> <code class="plaintext hljs">do reader.Correlate("Object","FIAS.AddressObject") set url="http://localhost/AS_ADDROBJ_20190106_90809714-fe22-45b2-929c-52bd950963e0.XML" write reader.OpenUrl(url)</code> </pre><br>  Maka bagian selanjutnya mudah: kita hanya membaca dan menyimpan. <br><br><pre> <code class="plaintext hljs">do reader.Next(.object) do object.%Save()</code> </pre><br>  Dan seterusnya, 3.722.548 kali untuk setiap operasi :-) <br><br>  Itu bahkan lebih melelahkan dari sebelumnya.  Itu sebabnya kami akan menambahkan metode kelas FIAS.AddressObject kami untuk mengimpor, berdasarkan pada perintah yang sama: <br><br><pre> <code class="plaintext hljs">ClassMethod Import() { // Create object to read XML Set reader = ##class(%XML.Reader).%New() // Get source XML for parsing Set status = reader.OpenURL("http://localhost/AS_ADDROBJ_20190106_90809714-fe22-45b2-929c-52bd950963e0.XML") If $$$ISERR(status) {Do $System.Status.DisplayError(status)} // Join object with the right sample structure Do reader.Correlate("Object","FIAS.AddressObject") // Read and save the object in storage While (reader.Next(.object,.status)) { Set status = object.%Save() If $$$ISERR(status) {do $System.Status.DisplayError(status)} } // If an error occurs during parsing, display a message If $$$ISERR(status) {Do $System.Status.DisplayError(status) }</code> </pre><br>  Kami akan menggunakan kekuatan eksokorteks komputer kami hanya dengan satu perintah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di terminal</a> : <br><br><pre> <code class="plaintext hljs">do ##class(FIAS.AddressObject).Import()</code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/acb/18e/6c0/acb18e6c0f1e4d524accb97686a6b63a.gif" alt="gambar"><br><br>  Makan malam sudah siap, semuanya.  Itu mBD, dan sekarang hidangan jadi, global dengan nama kota Rusia yang terverifikasi. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2d3/abb/06a/2d3abb06a70886fd8338fe747e72d9d6.png" alt="gambar"><br><br>  Dan, akhirnya, beberapa kata tentang apa yang harus dilakukan ketika 4TB tidak cukup.  Dalam hal ini, <a href="">kami menggunakan stream</a> .  Semuanya tercantum dalam dokumentasi.  Anda dapat menggunakan biner atau karakter.  Menyimpan dalam global juga dimungkinkan.  Ini resepnya: ambil alirannya, potong-potong, dan tetapkan ke objek yang kita butuhkan untuk konsumsi. <br><br>  Tidak ada cukup ruang di sini untuk lebih banyak tentang objek ObjectScript dan Python API yang indah.  Itu akan menjadi cerita lain. <br><blockquote>  Berita baik: Gartner baru saja menyelesaikan pengumpulan tahunan penilaian pengguna nyata dan umpan balik dalam kategori DBMS dan menggunakan informasi ini untuk menerbitkan rangking DBMS terbaik 2019. AntarSistem Cach√© dan AntarSistem IRIS Data Platform menerima peringkat tertinggi untuk "Pelanggan 'Pilihan. "  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Anda dapat memeriksa</a> produk mana yang dipertimbangkan dan bagaimana mereka dinilai. </blockquote>  Perangkat Lunak Sistem Manajemen Basis Data Operasional Terbaik 2019 yang diulas oleh Pelanggan. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d01/201/bfc/d01201bfc7d9afa6d4fe0c3638117cd6.png" alt="gambar"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id446376/">https://habr.com/ru/post/id446376/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id446362/index.html">3 Kualitas Utama untuk Manajer Produk yang Sukses: Dmitry Orlov, Manajer Produk Senior</a></li>
<li><a href="../id446364/index.html">Lelucon dan referensi dari The Simpsons dalam Bahasa Inggris ke Explain</a></li>
<li><a href="../id446366/index.html">ZX Spectrum 128k lakukan sendiri. Bagian 2</a></li>
<li><a href="../id446370/index.html">"Yah, sekali lagi, stasiun cuaca"? Tidak juga</a></li>
<li><a href="../id446372/index.html">Cintai pencarian, cintai, dan temukan data pribadi Anda di depan umum</a></li>
<li><a href="../id446378/index.html">Masalah beralih ke waktu musim dingin dan musim panas untuk sekolah Skype tunggal</a></li>
<li><a href="../id446380/index.html">Evolusi H2 - fungsi jendela, CTE, JSON / XML dalam database tertanam</a></li>
<li><a href="../id446384/index.html">Kiat untuk mengembangkan proyek yang sangat besar di Revit</a></li>
<li><a href="../id446388/index.html">Industri minyak dan gas bumi sebagai contoh untuk sistem cloud periferal</a></li>
<li><a href="../id446394/index.html">5. Periksa Titik Memulai R80.20. Gaia & CLI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>