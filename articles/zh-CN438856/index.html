<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛬 🕜 ✉️ 从生活中跌落 🥝 🤐 👴🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="大家好 


 您是否还有一个熟悉的反应开发人员，他讲述了关于redux副作用的惊人故事？ 不？ 我可以成为这个人吗 





 作者可以随意编写关于redux saga库的全部内容的介绍性部分。 他希望在数据不足的情况下，慷慨的读者可以使用Habr搜索或官方教程 。 这些示例已大大简化，以传达其...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>从生活中跌落</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438856/"><p> 大家好 </p><br><p> 您是否还有一个熟悉的反应开发人员，他讲述了关于redux副作用的惊人故事？ 不？ 我可以成为这个人吗 </p><br><p><img src="https://habrastorage.org/webt/7-/lj/cq/7-ljcqfw11ms3jciroq6ls9ekfw.jpeg"></p><br><p>  <em>作者可以随意编写关于redux saga库的全部内容的介绍性部分。</em>  <em>他希望在数据不足的情况下，慷慨的读者可以使用Habr搜索或<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">官方教程</a> 。</em>  <em>这些示例已大大简化，以传达其实质。</em> </p><a name="habracut"></a><br><p> 所以，为什么我要你们在一起。 这将涉及在战斗客户的开放空间中使用redux saga。 更具体地说，与“接受操作=&gt;发送API请求=&gt;创建新操作”相比，情况更加复杂和有趣。 </p><br><p> 我希望激发同胞们对该图书馆的更深入研究，并希望分享复杂的异步事物变得更加易于理解和表达的乐趣。 </p><br><h2 id="websockets"> 网络套接字 </h2><br><p> <em>用例：使用推送模型实时从服务器接收可用空缺列表的更新。</em> </p><br><p> 当然，这与Web套接字的使用有关。 例如，以socket.io为例，但实际上套接字API在这里并不重要。 </p><br><p> 在Sagas中，存在诸如通道之类的东西。 这是一条消息总线，事件源可通过该消息总线与其使用者进行通信。 通道的主要目的是在Sagas之间进行通信，并将异步事件流转换为便于工作的结构。 </p><br><p> 默认情况下，store是redux saga的主要事件渠道。 事件以行动的形式出现。 通道用于处理非存储事件。 </p><br><p> 事实证明，通道正是处理来自套接字的异步消息流所需要的。 让我们尽快创建频道！ </p><br><p> 但首先，创建一个套接字： </p><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> io <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'socket.io-client'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> socket = io.connect(<span class="hljs-string"><span class="hljs-string">'/'</span></span>);</code> </pre> <br><p> 现在声明一个适度的事件列表： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SocketEvents = { <span class="hljs-attr"><span class="hljs-attr">jobsFresh</span></span>: <span class="hljs-string"><span class="hljs-string">'jobs+fresh'</span></span>, };</code> </pre> <br><p> 接下来是用于创建通道的工厂方法。 该代码创建了一种用于从套接字订阅我们感兴趣的事件的方法，一种用于取消订阅的方法以及直接取消事件通道本身的方法： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { eventChannel } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { socket } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../apis/socket'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { SocketEvents } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../constants/socket-events'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createFreshJobsChannel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> subscribe = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">emitter</span></span></span><span class="hljs-function"> =&gt;</span></span> { socket.on(SocketEvents.jobsFresh, emitter); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> socket.removeListener(SocketEvents.jobsFresh, emitter); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> eventChannel(subscribe); }</code> </pre> <br><p> 让我们编写一个相当简单的传奇，等待套接字中的更新并将其转换为相应的动作： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { take, call, put } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga/effects'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { createFreshJobsChannel } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../channels/fresh-jobs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { JobsActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions/jobs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">freshJobsSaga</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> channel = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> call(createFreshJobsChannel); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> jobs = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> take(channel); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> action = JobsActions.fresh(jobs); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> put(action); } }</code> </pre> <br><p> 它仅保留将其绑定到根传奇： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { fork } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga/effects'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { freshJobsSaga } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./fresh-jobs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sagas</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> fork(freshJobsSaga); }</code> </pre> <br><h2 id="google-places-autocomplete">  Google Places自动完成 </h2><br><p>  <em>用例：当用户输入地理位置以供随后搜索附近的房地产时显示提示。</em> </p><br><p> 实际上，我们需要坐标，而用户则需要人类可读的所需区域名称。 </p><br><p> 看来此任务与无聊的“ action =&gt; API =&gt; action”有什么不同？ 在自动完成的情况下，我们希望对外部资源进行尽可能少的无用的调用，并且只向用户显示相关的提示。 </p><br><p> 首先，我们将利用Google地方信息自动填充服务编写一个API方法。 有趣的是，给定国家/地区内提示的局限性： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPlaceSuggestions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">autocompleteService, countryCode, query</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve</span></span></span><span class="hljs-function"> =&gt;</span></span> { autocompleteService.getPlacePredictions({ <span class="hljs-attr"><span class="hljs-attr">componentRestrictions</span></span>: { <span class="hljs-attr"><span class="hljs-attr">country</span></span>: countryCode }, <span class="hljs-attr"><span class="hljs-attr">input</span></span>: query, }, resolve); }); }</code> </pre> <br><p> 有一个我们将提取的API方法，您可以开始编写传奇。 现在该澄清无用的请求了。 </p><br><p> 在用户额头上实现时，当用户键入内容时，我们对每个更改进行读取（对于每个字符，向API发送请求）都无济于事。 用户输入时，他不需要提示。 但是当他停下来时，该为他服务了。 </p><br><p> 另外，我们不希望出现以下情况：用户键入了一些内容，然后停止了，API请求消失了，用户键入了一些东西，另一个请求消失了。 </p><br><p> 因此，我们在两个请求之间创建了竞争。 活动可以通过两种方式发展，但都不太令人满意。 </p><br><p> 例如，不相关的请求将比当前请求更早结束，并且用户一会儿会看到不相关的提示。 令人不愉快，但并不重要。 </p><br><p> 或者，当前请求早于不相关的请求结束，并且在闪烁之后，用户将保持相同的不相关的提示。 这已经很关键。 </p><br><p> 当然，我们并不是第一个遇到这种问题的人，称为反跳的技术将帮助我们-仅在自收到最后一个事件以来的N个时间单位后才执行任务。 这是有关此的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">一些材料</a> 。 </p><br><p> 在redux saga中，使用两种效果<em>-delay</em>和<em>takeLatest</em>实施此技术。 第一个将传奇的执行延迟指定的毫秒数。 当新事件到达时，第二个命令终止已运行的传奇事件的执行。 </p><br><p> 知道了所有这些之后，我们将写一个传奇： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { delay } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { put, call, select } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga/effects'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { PlaceActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions/place'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { MapsActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions/maps'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { getPlaceSuggestions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../api/get-place-suggestions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">placeSuggestionsSaga</span></span></span><span class="hljs-function"> * (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ payload: query }</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-attr"><span class="hljs-attr">maps</span></span>: { isApiLoaded } } = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> select(); <span class="hljs-comment"><span class="hljs-comment">//  API    , //      if (!isApiLoaded) { yield take(MapsActions.apiLoaded); } //     Google Places Autocomplete  store const { maps: { autocompleteService }, countryCode } = yield select(); //    , //        if (query) { yield put(PlaceActions.suggestions([])); yield put(PlaceActions.select(null)); return; } //  250    yield call(delay, 250); //  API  const suggestions = yield call( getPlaceSuggestions, autocompleteService, countryCode, query, ); //  action   const action = PlacesActions.suggestions(suggestions || []); //     store yield put(action); };</span></span></code> </pre> <br><p> 与前面的示例一样，仅保留将其绑定到根传奇： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { takeLatest } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga/effects'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { PlaceActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions/place'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { placeSuggestionsSaga } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./place-suggestions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sagas</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> takeLatest( PlaceActions.changeQuery, placeSuggestionsSaga, ); }</code> </pre> <br><h2 id="dropdowns-closer"> 下拉列表更紧密 </h2><br><p>  <em>使用案例：在控件的区域之外单击时，关闭自写的下拉列表。</em> </p><br><p> 实际上，这是对浏览器选择内置行为的模拟。 您可能需要在div上写一个下拉列表的原因将留给读者的想象力。 </p><br><p> 要解决的任务的关键功能是将事件传递到控件外部，例如，在列表外部单击时。 </p><br><p> 猜到了吗 是的，渠道也会在这里为我们提供帮助。 使用它们，我们会将弹出到最顶部的点击事件变成相应的动作。 </p><br><p> 最好有一个工厂方法为任意窗口事件创建通道。 他在这里： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { eventChannel } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createWindowEventChannel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">eventName</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> subscribe = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">emitter</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.addEventListener(eventName, emitter); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.removeEventListener(eventName, emitter); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> eventChannel(subscribe); }</code> </pre> <br><p> 我们创建一个与第一个示例非常相似的传奇（如果需要，您可以为其创建一个工厂方法）： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { take, put, call } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga/effects'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { createWindowEventChannel } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../channels/window-event'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { DropdownActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions/dropdown'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">closeDropdownsSaga</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> channel = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> call(createWindowEventChannel, <span class="hljs-string"><span class="hljs-string">'onClick'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> event = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> take(channel); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> action = DropdownActions.closeAll(event); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> put(action(event)); } }</code> </pre> <br><p> 有兴趣的减速器会将控件置于关闭状态： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { handleActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-actions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { DropdownActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions/dropdown'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> priceReducer = handleActions({ ..., [DropdownActions.closeAll]: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ ...state, <span class="hljs-attr"><span class="hljs-attr">isOpen</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}), }, {});</code> </pre> <br><p> 下拉列表本身必须停止click事件在任何内部部件上的分发，并将关闭事件自行发送到商店。 例如，当您单击打开时： </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// components/dropdown.js import React from 'react'; export class Dropdown extends React.Component { ... __open(event) { event.stopPropagation(); this.props.open(); } } // dispatchers/open-price-dropdown.js import { DropdownActions } from '../actions/dropdown'; import { PriceActions } from '../actions/price'; export const openPriceDropdownDispatcher = dispatch =&gt; () =&gt; { dispatch( DropdownActions.closeAll() ); dispatch( PriceActions.open() ); };</span></span></code> </pre> <br><p> 否则，该列表将根本无法打开。 选择选项时，单击也是如此。 </p><br><p>  El clasico，登上传奇： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { fork } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga/effects'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { closeDropdownsSaga } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./close-dropdowns'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sagas</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> fork(closeDropdownsSaga); }</code> </pre> <br><h2 id="notifications"> 通知事项 </h2><br><p>  <em>用例：如果选项卡在后台，则显示有关新职位空缺的浏览器通知。</em> </p><br><p> 在活动选项卡中，用户将在特殊控件中看到更改，因此通知不适当。 但是对于背景选项卡可能会派上用场。 当然，要得到用户的许可！ </p><br><p> 我还想单击通知以转到选项卡并显示新的空缺。 如果用户未响应，则关闭通知。 为此，我们需要另一个有用的效果<em>-race</em> 。 它允许您安排其他几种效果之间的竞赛。 在大多数情况下，竞赛用于为某些操作提供超时。 </p><br><p> 由于与上一示例的点击拦截代码相同，因此我们省略了用于跟踪选项卡活动的代码。 </p><br><p> 我们将编写一个工厂方法，该方法将创建一个渠道来请求用户批准以接收通知： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { eventChannel, END } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createRequestNotificationPermissionChannel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> subscribe = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">emitter</span></span></span><span class="hljs-function"> =&gt;</span></span> { Notification.requestPermission(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">permission</span></span></span><span class="hljs-function"> =&gt;</span></span> { emitter(permission); emitter(END); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {}; }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> eventChannel(subscribe); }</code> </pre> <br><p> 为了寻求另一种工厂方法，但具有接收通知的渠道，请单击： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { eventChannel, END } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createNotificationClickChannel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">notification</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> subscribe = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">emitter</span></span></span><span class="hljs-function"> =&gt;</span></span> { notification.onclick = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function"> =&gt;</span></span> { emitter(event); emitter(END); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> notification.onclick = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> eventChannel(subscribe); }</code> </pre> <br><p> 两个通道均为一次性使用，一次最多可拍摄最多，然后关闭。 </p><br><p> 关键仍然是-具有逻辑的传奇。 检查选项卡是否处于活动状态，请求许可，创建通知，等待单击或超时，显示新的职位空缺，使选项卡处于活动状态，然后关闭通知： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { delay } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { call, select, race, take } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga/effects'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { createRequestNotificationPermissionChannel } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../channels/request-notification-permission'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { createNotificationClickChannel } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../channels/notification-click'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { JobsActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions/jobs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">notificationsSaga</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { inFocus } = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> select(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inFocus) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> permissionChannel = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> call(createRequestNotificationPermissionChannel); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> permission = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> take(permissionChannel); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (permission !== <span class="hljs-string"><span class="hljs-string">'granted'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> notification = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Notification( <span class="hljs-string"><span class="hljs-string">`You have </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${action.payload.jobs.length}</span></span></span><span class="hljs-string"> new job posts`</span></span>, { <span class="hljs-attr"><span class="hljs-attr">icon</span></span>: <span class="hljs-string"><span class="hljs-string">'assets/new-jobs.png'</span></span> } ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> clickChannel = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> call(createNotificationClickChannel, notification); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { click, timeout } = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> race({ <span class="hljs-attr"><span class="hljs-attr">click</span></span>: take(clickChannel), <span class="hljs-attr"><span class="hljs-attr">timeout</span></span>: call(delay, <span class="hljs-number"><span class="hljs-number">5000</span></span>), }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (click) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> put(JobsActions.show()); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.focus(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.scrollTo(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } notification.close(); }</code> </pre> <br><p> 在执行此功能检测之前，请先安装传奇： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { takeEvery } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga/effects'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { JobsActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions/jobs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { notificationsSaga } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./notifications'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sagas</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-string"><span class="hljs-string">'Notification'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">window</span></span> &amp;&amp; Notification.permission !== <span class="hljs-string"><span class="hljs-string">'denied'</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> takeEvery(JobsActions.fresh, notificationsSaga); } }</code> </pre> <br><h2 id="global-event-bus"> 全球活动巴士 </h2><br><p>  <em>用例：在Redux商店之间转移指定类别的事件。</em> </p><br><p> 如果页面上存在多个具有公共数据的应用程序，则需要这种总线。 同时，应用程序可以彼此独立地实现。 </p><br><p> 例如，带有过滤器和搜索结果的搜索字符串作为单独的react应用程序。 更改过滤器时，我希望结果应用程序知道它是否也在页面上。 </p><br><p> 我们使用标准的事件发射器： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> EventEmmiter <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'events'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.GlobalEventBus) { <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.GlobalEventBus = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EventEmmiter(); } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> globalEventBus = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.GlobalEventBus;</code> </pre> <br><p>  <em>备受</em>喜爱的<em>eventChannel</em>将标准发射器变成一个通道： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { eventChannel } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { globalEventBus <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> bus } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../utils/global-event-bus'</span></span>; exports <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createGlobalEventBusChannel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> subscribe = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">emitter</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> handler = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function"> =&gt;</span></span> emitter({ ...event, <span class="hljs-attr"><span class="hljs-attr">external</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }); bus.on(<span class="hljs-string"><span class="hljs-string">'global.event'</span></span>, handler); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bus.removeListener(<span class="hljs-string"><span class="hljs-string">'global.event'</span></span>, handler); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> eventChannel(subscribe); }</code> </pre> <br><p> 传奇很简单-我们创建了一个频道并无休止地接受内部或外部事件。 如果我们收到内部事件，则将其发送到总线，如果外部事件则在商店中发送： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { take, put, race, call } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga/effects'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { globalEventBus <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> bus } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../utils/global-event-bus'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { createGlobalEventBusChannel } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../channels/global-event-bus'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">globalEventBusSaga</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">allowedActions</span></span></span><span class="hljs-function">) </span></span>{ allowedActions = allowedActions.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> x.toString()); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> channel = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> call(createGlobalEventBusChannel); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { local, external } = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> race({ <span class="hljs-attr"><span class="hljs-attr">local</span></span>: take(), <span class="hljs-attr"><span class="hljs-attr">external</span></span>: take(channel), }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( external &amp;&amp; allowedActions.some(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">action</span></span></span><span class="hljs-function"> =&gt;</span></span> action === external.type) ) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> put(external); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( local &amp;&amp; !local.external &amp;&amp; allowedActions.some(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">action</span></span></span><span class="hljs-function"> =&gt;</span></span> action === local.type) ) { bus.emit(<span class="hljs-string"><span class="hljs-string">'global.event'</span></span>, local); } } };</code> </pre> <br><p> 最后一个-用必要的事件安装传奇： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { fork } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga/effects'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { globalEventBusSaga } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./global-event-bus'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { DropdownsActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions/dropdowns'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { AreasActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions/areas'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sagas</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> fork(globalEventBusSaga, [ DropdownsActions.closeAll, AreasActions.add, AreasActions.remove, ... ]); }</code> </pre> <br><hr><br><p> 我希望能够证明Sagas使描述复杂的副作用更加容易。 探索库API，转移到您的案例中，编写复杂的事件期望模式并感到高兴。 在JS开放空间见！ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN438856/">https://habr.com/ru/post/zh-CN438856/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN438840/index.html">自豪与激情，将梦想变成太空项目的故事</a></li>
<li><a href="../zh-CN438842/index.html">整理torrent-TV播放列表（Super Wash）</a></li>
<li><a href="../zh-CN438850/index.html">Moscow JS 44-公告</a></li>
<li><a href="../zh-CN438852/index.html">OpenVox的新GSM网关</a></li>
<li><a href="../zh-CN438854/index.html">在不使用伯努利方程的情况下解释“提升力”现象的物理性质</a></li>
<li><a href="../zh-CN438858/index.html">在制定营销策略时如何使用细分，定位和定位（STP）</a></li>
<li><a href="../zh-CN438862/index.html">以Nuxt.js为例，部署同构Web应用程序。</a></li>
<li><a href="../zh-CN438864/index.html">功能冻结C ++ 20。 协程，模块等</a></li>
<li><a href="../zh-CN438866/index.html">生成器与Java语法</a></li>
<li><a href="../zh-CN438868/index.html">安全周06：直播FaceTime</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>