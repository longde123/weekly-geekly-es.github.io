<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ›¬ ğŸ•œ âœ‰ï¸ ä»ç”Ÿæ´»ä¸­è·Œè½ ğŸ¥ ğŸ¤ ğŸ‘´ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¤§å®¶å¥½ 


 æ‚¨æ˜¯å¦è¿˜æœ‰ä¸€ä¸ªç†Ÿæ‚‰çš„ååº”å¼€å‘äººå‘˜ï¼Œä»–è®²è¿°äº†å…³äºreduxå‰¯ä½œç”¨çš„æƒŠäººæ•…äº‹ï¼Ÿ ä¸ï¼Ÿ æˆ‘å¯ä»¥æˆä¸ºè¿™ä¸ªäººå— 





 ä½œè€…å¯ä»¥éšæ„ç¼–å†™å…³äºredux sagaåº“çš„å…¨éƒ¨å†…å®¹çš„ä»‹ç»æ€§éƒ¨åˆ†ã€‚ ä»–å¸Œæœ›åœ¨æ•°æ®ä¸è¶³çš„æƒ…å†µä¸‹ï¼Œæ…·æ…¨çš„è¯»è€…å¯ä»¥ä½¿ç”¨Habræœç´¢æˆ–å®˜æ–¹æ•™ç¨‹ ã€‚ è¿™äº›ç¤ºä¾‹å·²å¤§å¤§ç®€åŒ–ï¼Œä»¥ä¼ è¾¾å…¶...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä»ç”Ÿæ´»ä¸­è·Œè½</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438856/"><p> å¤§å®¶å¥½ </p><br><p> æ‚¨æ˜¯å¦è¿˜æœ‰ä¸€ä¸ªç†Ÿæ‚‰çš„ååº”å¼€å‘äººå‘˜ï¼Œä»–è®²è¿°äº†å…³äºreduxå‰¯ä½œç”¨çš„æƒŠäººæ•…äº‹ï¼Ÿ ä¸ï¼Ÿ æˆ‘å¯ä»¥æˆä¸ºè¿™ä¸ªäººå— </p><br><p><img src="https://habrastorage.org/webt/7-/lj/cq/7-ljcqfw11ms3jciroq6ls9ekfw.jpeg"></p><br><p>  <em>ä½œè€…å¯ä»¥éšæ„ç¼–å†™å…³äºredux sagaåº“çš„å…¨éƒ¨å†…å®¹çš„ä»‹ç»æ€§éƒ¨åˆ†ã€‚</em>  <em>ä»–å¸Œæœ›åœ¨æ•°æ®ä¸è¶³çš„æƒ…å†µä¸‹ï¼Œæ…·æ…¨çš„è¯»è€…å¯ä»¥ä½¿ç”¨Habræœç´¢æˆ–<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®˜æ–¹æ•™ç¨‹</a> ã€‚</em>  <em>è¿™äº›ç¤ºä¾‹å·²å¤§å¤§ç®€åŒ–ï¼Œä»¥ä¼ è¾¾å…¶å®è´¨ã€‚</em> </p><a name="habracut"></a><br><p> æ‰€ä»¥ï¼Œä¸ºä»€ä¹ˆæˆ‘è¦ä½ ä»¬åœ¨ä¸€èµ·ã€‚ è¿™å°†æ¶‰åŠåœ¨æˆ˜æ–—å®¢æˆ·çš„å¼€æ”¾ç©ºé—´ä¸­ä½¿ç”¨redux sagaã€‚ æ›´å…·ä½“åœ°è¯´ï¼Œä¸â€œæ¥å—æ“ä½œ=&gt;å‘é€APIè¯·æ±‚=&gt;åˆ›å»ºæ–°æ“ä½œâ€ç›¸æ¯”ï¼Œæƒ…å†µæ›´åŠ å¤æ‚å’Œæœ‰è¶£ã€‚ </p><br><p> æˆ‘å¸Œæœ›æ¿€å‘åŒèƒä»¬å¯¹è¯¥å›¾ä¹¦é¦†çš„æ›´æ·±å…¥ç ”ç©¶ï¼Œå¹¶å¸Œæœ›åˆ†äº«å¤æ‚çš„å¼‚æ­¥äº‹ç‰©å˜å¾—æ›´åŠ æ˜“äºç†è§£å’Œè¡¨è¾¾çš„ä¹è¶£ã€‚ </p><br><h2 id="websockets"> ç½‘ç»œå¥—æ¥å­— </h2><br><p> <em>ç”¨ä¾‹ï¼šä½¿ç”¨æ¨é€æ¨¡å‹å®æ—¶ä»æœåŠ¡å™¨æ¥æ”¶å¯ç”¨ç©ºç¼ºåˆ—è¡¨çš„æ›´æ–°ã€‚</em> </p><br><p> å½“ç„¶ï¼Œè¿™ä¸Webå¥—æ¥å­—çš„ä½¿ç”¨æœ‰å…³ã€‚ ä¾‹å¦‚ï¼Œä»¥socket.ioä¸ºä¾‹ï¼Œä½†å®é™…ä¸Šå¥—æ¥å­—APIåœ¨è¿™é‡Œå¹¶ä¸é‡è¦ã€‚ </p><br><p> åœ¨Sagasä¸­ï¼Œå­˜åœ¨è¯¸å¦‚é€šé“ä¹‹ç±»çš„ä¸œè¥¿ã€‚ è¿™æ˜¯ä¸€æ¡æ¶ˆæ¯æ€»çº¿ï¼Œäº‹ä»¶æºå¯é€šè¿‡è¯¥æ¶ˆæ¯æ€»çº¿ä¸å…¶ä½¿ç”¨è€…è¿›è¡Œé€šä¿¡ã€‚ é€šé“çš„ä¸»è¦ç›®çš„æ˜¯åœ¨Sagasä¹‹é—´è¿›è¡Œé€šä¿¡ï¼Œå¹¶å°†å¼‚æ­¥äº‹ä»¶æµè½¬æ¢ä¸ºä¾¿äºå·¥ä½œçš„ç»“æ„ã€‚ </p><br><p> é»˜è®¤æƒ…å†µä¸‹ï¼Œstoreæ˜¯redux sagaçš„ä¸»è¦äº‹ä»¶æ¸ é“ã€‚ äº‹ä»¶ä»¥è¡ŒåŠ¨çš„å½¢å¼å‡ºç°ã€‚ é€šé“ç”¨äºå¤„ç†éå­˜å‚¨äº‹ä»¶ã€‚ </p><br><p> äº‹å®è¯æ˜ï¼Œé€šé“æ­£æ˜¯å¤„ç†æ¥è‡ªå¥—æ¥å­—çš„å¼‚æ­¥æ¶ˆæ¯æµæ‰€éœ€è¦çš„ã€‚ è®©æˆ‘ä»¬å°½å¿«åˆ›å»ºé¢‘é“ï¼ </p><br><p> ä½†é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªå¥—æ¥å­—ï¼š </p><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> io <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'socket.io-client'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> socket = io.connect(<span class="hljs-string"><span class="hljs-string">'/'</span></span>);</code> </pre> <br><p> ç°åœ¨å£°æ˜ä¸€ä¸ªé€‚åº¦çš„äº‹ä»¶åˆ—è¡¨ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SocketEvents = { <span class="hljs-attr"><span class="hljs-attr">jobsFresh</span></span>: <span class="hljs-string"><span class="hljs-string">'jobs+fresh'</span></span>, };</code> </pre> <br><p> æ¥ä¸‹æ¥æ˜¯ç”¨äºåˆ›å»ºé€šé“çš„å·¥å‚æ–¹æ³•ã€‚ è¯¥ä»£ç åˆ›å»ºäº†ä¸€ç§ç”¨äºä»å¥—æ¥å­—è®¢é˜…æˆ‘ä»¬æ„Ÿå…´è¶£çš„äº‹ä»¶çš„æ–¹æ³•ï¼Œä¸€ç§ç”¨äºå–æ¶ˆè®¢é˜…çš„æ–¹æ³•ä»¥åŠç›´æ¥å–æ¶ˆäº‹ä»¶é€šé“æœ¬èº«çš„æ–¹æ³•ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { eventChannel } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { socket } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../apis/socket'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { SocketEvents } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../constants/socket-events'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createFreshJobsChannel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> subscribe = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">emitter</span></span></span><span class="hljs-function"> =&gt;</span></span> { socket.on(SocketEvents.jobsFresh, emitter); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> socket.removeListener(SocketEvents.jobsFresh, emitter); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> eventChannel(subscribe); }</code> </pre> <br><p> è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç›¸å½“ç®€å•çš„ä¼ å¥‡ï¼Œç­‰å¾…å¥—æ¥å­—ä¸­çš„æ›´æ–°å¹¶å°†å…¶è½¬æ¢ä¸ºç›¸åº”çš„åŠ¨ä½œï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { take, call, put } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga/effects'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { createFreshJobsChannel } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../channels/fresh-jobs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { JobsActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions/jobs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">freshJobsSaga</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> channel = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> call(createFreshJobsChannel); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> jobs = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> take(channel); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> action = JobsActions.fresh(jobs); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> put(action); } }</code> </pre> <br><p> å®ƒä»…ä¿ç•™å°†å…¶ç»‘å®šåˆ°æ ¹ä¼ å¥‡ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { fork } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga/effects'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { freshJobsSaga } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./fresh-jobs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sagas</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> fork(freshJobsSaga); }</code> </pre> <br><h2 id="google-places-autocomplete">  Google Placesè‡ªåŠ¨å®Œæˆ </h2><br><p>  <em>ç”¨ä¾‹ï¼šå½“ç”¨æˆ·è¾“å…¥åœ°ç†ä½ç½®ä»¥ä¾›éšåæœç´¢é™„è¿‘çš„æˆ¿åœ°äº§æ—¶æ˜¾ç¤ºæç¤ºã€‚</em> </p><br><p> å®é™…ä¸Šï¼Œæˆ‘ä»¬éœ€è¦åæ ‡ï¼Œè€Œç”¨æˆ·åˆ™éœ€è¦äººç±»å¯è¯»çš„æ‰€éœ€åŒºåŸŸåç§°ã€‚ </p><br><p> çœ‹æ¥æ­¤ä»»åŠ¡ä¸æ— èŠçš„â€œ action =&gt; API =&gt; actionâ€æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ åœ¨è‡ªåŠ¨å®Œæˆçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹å¤–éƒ¨èµ„æºè¿›è¡Œå°½å¯èƒ½å°‘çš„æ— ç”¨çš„è°ƒç”¨ï¼Œå¹¶ä¸”åªå‘ç”¨æˆ·æ˜¾ç¤ºç›¸å…³çš„æç¤ºã€‚ </p><br><p> é¦–å…ˆï¼Œæˆ‘ä»¬å°†åˆ©ç”¨Googleåœ°æ–¹ä¿¡æ¯è‡ªåŠ¨å¡«å……æœåŠ¡ç¼–å†™ä¸€ä¸ªAPIæ–¹æ³•ã€‚ æœ‰è¶£çš„æ˜¯ï¼Œç»™å®šå›½å®¶/åœ°åŒºå†…æç¤ºçš„å±€é™æ€§ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPlaceSuggestions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">autocompleteService, countryCode, query</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve</span></span></span><span class="hljs-function"> =&gt;</span></span> { autocompleteService.getPlacePredictions({ <span class="hljs-attr"><span class="hljs-attr">componentRestrictions</span></span>: { <span class="hljs-attr"><span class="hljs-attr">country</span></span>: countryCode }, <span class="hljs-attr"><span class="hljs-attr">input</span></span>: query, }, resolve); }); }</code> </pre> <br><p> æœ‰ä¸€ä¸ªæˆ‘ä»¬å°†æå–çš„APIæ–¹æ³•ï¼Œæ‚¨å¯ä»¥å¼€å§‹ç¼–å†™ä¼ å¥‡ã€‚ ç°åœ¨è¯¥æ¾„æ¸…æ— ç”¨çš„è¯·æ±‚äº†ã€‚ </p><br><p> åœ¨ç”¨æˆ·é¢å¤´ä¸Šå®ç°æ—¶ï¼Œå½“ç”¨æˆ·é”®å…¥å†…å®¹æ—¶ï¼Œæˆ‘ä»¬å¯¹æ¯ä¸ªæ›´æ”¹è¿›è¡Œè¯»å–ï¼ˆå¯¹äºæ¯ä¸ªå­—ç¬¦ï¼Œå‘APIå‘é€è¯·æ±‚ï¼‰éƒ½æ— æµäºäº‹ã€‚ ç”¨æˆ·è¾“å…¥æ—¶ï¼Œä»–ä¸éœ€è¦æç¤ºã€‚ ä½†æ˜¯å½“ä»–åœä¸‹æ¥æ—¶ï¼Œè¯¥ä¸ºä»–æœåŠ¡äº†ã€‚ </p><br><p> å¦å¤–ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›å‡ºç°ä»¥ä¸‹æƒ…å†µï¼šç”¨æˆ·é”®å…¥äº†ä¸€äº›å†…å®¹ï¼Œç„¶ååœæ­¢äº†ï¼ŒAPIè¯·æ±‚æ¶ˆå¤±äº†ï¼Œç”¨æˆ·é”®å…¥äº†ä¸€äº›ä¸œè¥¿ï¼Œå¦ä¸€ä¸ªè¯·æ±‚æ¶ˆå¤±äº†ã€‚ </p><br><p> å› æ­¤ï¼Œæˆ‘ä»¬åœ¨ä¸¤ä¸ªè¯·æ±‚ä¹‹é—´åˆ›å»ºäº†ç«äº‰ã€‚ æ´»åŠ¨å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼å‘å±•ï¼Œä½†éƒ½ä¸å¤ªä»¤äººæ»¡æ„ã€‚ </p><br><p> ä¾‹å¦‚ï¼Œä¸ç›¸å…³çš„è¯·æ±‚å°†æ¯”å½“å‰è¯·æ±‚æ›´æ—©ç»“æŸï¼Œå¹¶ä¸”ç”¨æˆ·ä¸€ä¼šå„¿ä¼šçœ‹åˆ°ä¸ç›¸å…³çš„æç¤ºã€‚ ä»¤äººä¸æ„‰å¿«ï¼Œä½†å¹¶ä¸é‡è¦ã€‚ </p><br><p> æˆ–è€…ï¼Œå½“å‰è¯·æ±‚æ—©äºä¸ç›¸å…³çš„è¯·æ±‚ç»“æŸï¼Œå¹¶ä¸”åœ¨é—ªçƒä¹‹åï¼Œç”¨æˆ·å°†ä¿æŒç›¸åŒçš„ä¸ç›¸å…³çš„æç¤ºã€‚ è¿™å·²ç»å¾ˆå…³é”®ã€‚ </p><br><p> å½“ç„¶ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯ç¬¬ä¸€ä¸ªé‡åˆ°è¿™ç§é—®é¢˜çš„äººï¼Œç§°ä¸ºåè·³çš„æŠ€æœ¯å°†å¸®åŠ©æˆ‘ä»¬-ä»…åœ¨è‡ªæ”¶åˆ°æœ€åä¸€ä¸ªäº‹ä»¶ä»¥æ¥çš„Nä¸ªæ—¶é—´å•ä½åæ‰æ‰§è¡Œä»»åŠ¡ã€‚ è¿™æ˜¯æœ‰å…³æ­¤çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸€äº›ææ–™</a> ã€‚ </p><br><p> åœ¨redux sagaä¸­ï¼Œä½¿ç”¨ä¸¤ç§æ•ˆæœ<em>-delay</em>å’Œ<em>takeLatest</em>å®æ–½æ­¤æŠ€æœ¯ã€‚ ç¬¬ä¸€ä¸ªå°†ä¼ å¥‡çš„æ‰§è¡Œå»¶è¿ŸæŒ‡å®šçš„æ¯«ç§’æ•°ã€‚ å½“æ–°äº‹ä»¶åˆ°è¾¾æ—¶ï¼Œç¬¬äºŒä¸ªå‘½ä»¤ç»ˆæ­¢å·²è¿è¡Œçš„ä¼ å¥‡äº‹ä»¶çš„æ‰§è¡Œã€‚ </p><br><p> çŸ¥é“äº†æ‰€æœ‰è¿™äº›ä¹‹åï¼Œæˆ‘ä»¬å°†å†™ä¸€ä¸ªä¼ å¥‡ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { delay } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { put, call, select } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga/effects'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { PlaceActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions/place'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { MapsActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions/maps'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { getPlaceSuggestions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../api/get-place-suggestions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">placeSuggestionsSaga</span></span></span><span class="hljs-function"> * (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ payload: query }</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-attr"><span class="hljs-attr">maps</span></span>: { isApiLoaded } } = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> select(); <span class="hljs-comment"><span class="hljs-comment">//  API    , //      if (!isApiLoaded) { yield take(MapsActions.apiLoaded); } //     Google Places Autocomplete  store const { maps: { autocompleteService }, countryCode } = yield select(); //    , //        if (query) { yield put(PlaceActions.suggestions([])); yield put(PlaceActions.select(null)); return; } //  250    yield call(delay, 250); //  API  const suggestions = yield call( getPlaceSuggestions, autocompleteService, countryCode, query, ); //  action   const action = PlacesActions.suggestions(suggestions || []); //     store yield put(action); };</span></span></code> </pre> <br><p> ä¸å‰é¢çš„ç¤ºä¾‹ä¸€æ ·ï¼Œä»…ä¿ç•™å°†å…¶ç»‘å®šåˆ°æ ¹ä¼ å¥‡ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { takeLatest } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga/effects'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { PlaceActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions/place'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { placeSuggestionsSaga } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./place-suggestions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sagas</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> takeLatest( PlaceActions.changeQuery, placeSuggestionsSaga, ); }</code> </pre> <br><h2 id="dropdowns-closer"> ä¸‹æ‹‰åˆ—è¡¨æ›´ç´§å¯† </h2><br><p>  <em>ä½¿ç”¨æ¡ˆä¾‹ï¼šåœ¨æ§ä»¶çš„åŒºåŸŸä¹‹å¤–å•å‡»æ—¶ï¼Œå…³é—­è‡ªå†™çš„ä¸‹æ‹‰åˆ—è¡¨ã€‚</em> </p><br><p> å®é™…ä¸Šï¼Œè¿™æ˜¯å¯¹æµè§ˆå™¨é€‰æ‹©å†…ç½®è¡Œä¸ºçš„æ¨¡æ‹Ÿã€‚ æ‚¨å¯èƒ½éœ€è¦åœ¨divä¸Šå†™ä¸€ä¸ªä¸‹æ‹‰åˆ—è¡¨çš„åŸå› å°†ç•™ç»™è¯»è€…çš„æƒ³è±¡åŠ›ã€‚ </p><br><p> è¦è§£å†³çš„ä»»åŠ¡çš„å…³é”®åŠŸèƒ½æ˜¯å°†äº‹ä»¶ä¼ é€’åˆ°æ§ä»¶å¤–éƒ¨ï¼Œä¾‹å¦‚ï¼Œåœ¨åˆ—è¡¨å¤–éƒ¨å•å‡»æ—¶ã€‚ </p><br><p> çŒœåˆ°äº†å— æ˜¯çš„ï¼Œæ¸ é“ä¹Ÿä¼šåœ¨è¿™é‡Œä¸ºæˆ‘ä»¬æä¾›å¸®åŠ©ã€‚ ä½¿ç”¨å®ƒä»¬ï¼Œæˆ‘ä»¬ä¼šå°†å¼¹å‡ºåˆ°æœ€é¡¶éƒ¨çš„ç‚¹å‡»äº‹ä»¶å˜æˆç›¸åº”çš„åŠ¨ä½œã€‚ </p><br><p> æœ€å¥½æœ‰ä¸€ä¸ªå·¥å‚æ–¹æ³•ä¸ºä»»æ„çª—å£äº‹ä»¶åˆ›å»ºé€šé“ã€‚ ä»–åœ¨è¿™é‡Œï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { eventChannel } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createWindowEventChannel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">eventName</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> subscribe = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">emitter</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.addEventListener(eventName, emitter); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.removeEventListener(eventName, emitter); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> eventChannel(subscribe); }</code> </pre> <br><p> æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä¸ç¬¬ä¸€ä¸ªç¤ºä¾‹éå¸¸ç›¸ä¼¼çš„ä¼ å¥‡ï¼ˆå¦‚æœéœ€è¦ï¼Œæ‚¨å¯ä»¥ä¸ºå…¶åˆ›å»ºä¸€ä¸ªå·¥å‚æ–¹æ³•ï¼‰ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { take, put, call } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga/effects'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { createWindowEventChannel } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../channels/window-event'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { DropdownActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions/dropdown'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">closeDropdownsSaga</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> channel = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> call(createWindowEventChannel, <span class="hljs-string"><span class="hljs-string">'onClick'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> event = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> take(channel); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> action = DropdownActions.closeAll(event); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> put(action(event)); } }</code> </pre> <br><p> æœ‰å…´è¶£çš„å‡é€Ÿå™¨ä¼šå°†æ§ä»¶ç½®äºå…³é—­çŠ¶æ€ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { handleActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-actions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { DropdownActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions/dropdown'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> priceReducer = handleActions({ ..., [DropdownActions.closeAll]: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ ...state, <span class="hljs-attr"><span class="hljs-attr">isOpen</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}), }, {});</code> </pre> <br><p> ä¸‹æ‹‰åˆ—è¡¨æœ¬èº«å¿…é¡»åœæ­¢clickäº‹ä»¶åœ¨ä»»ä½•å†…éƒ¨éƒ¨ä»¶ä¸Šçš„åˆ†å‘ï¼Œå¹¶å°†å…³é—­äº‹ä»¶è‡ªè¡Œå‘é€åˆ°å•†åº—ã€‚ ä¾‹å¦‚ï¼Œå½“æ‚¨å•å‡»æ‰“å¼€æ—¶ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// components/dropdown.js import React from 'react'; export class Dropdown extends React.Component { ... __open(event) { event.stopPropagation(); this.props.open(); } } // dispatchers/open-price-dropdown.js import { DropdownActions } from '../actions/dropdown'; import { PriceActions } from '../actions/price'; export const openPriceDropdownDispatcher = dispatch =&gt; () =&gt; { dispatch( DropdownActions.closeAll() ); dispatch( PriceActions.open() ); };</span></span></code> </pre> <br><p> å¦åˆ™ï¼Œè¯¥åˆ—è¡¨å°†æ ¹æœ¬æ— æ³•æ‰“å¼€ã€‚ é€‰æ‹©é€‰é¡¹æ—¶ï¼Œå•å‡»ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ </p><br><p>  El clasicoï¼Œç™»ä¸Šä¼ å¥‡ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { fork } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga/effects'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { closeDropdownsSaga } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./close-dropdowns'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sagas</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> fork(closeDropdownsSaga); }</code> </pre> <br><h2 id="notifications"> é€šçŸ¥äº‹é¡¹ </h2><br><p>  <em>ç”¨ä¾‹ï¼šå¦‚æœé€‰é¡¹å¡åœ¨åå°ï¼Œåˆ™æ˜¾ç¤ºæœ‰å…³æ–°èŒä½ç©ºç¼ºçš„æµè§ˆå™¨é€šçŸ¥ã€‚</em> </p><br><p> åœ¨æ´»åŠ¨é€‰é¡¹å¡ä¸­ï¼Œç”¨æˆ·å°†åœ¨ç‰¹æ®Šæ§ä»¶ä¸­çœ‹åˆ°æ›´æ”¹ï¼Œå› æ­¤é€šçŸ¥ä¸é€‚å½“ã€‚ ä½†æ˜¯å¯¹äºèƒŒæ™¯é€‰é¡¹å¡å¯èƒ½ä¼šæ´¾ä¸Šç”¨åœºã€‚ å½“ç„¶ï¼Œè¦å¾—åˆ°ç”¨æˆ·çš„è®¸å¯ï¼ </p><br><p> æˆ‘è¿˜æƒ³å•å‡»é€šçŸ¥ä»¥è½¬åˆ°é€‰é¡¹å¡å¹¶æ˜¾ç¤ºæ–°çš„ç©ºç¼ºã€‚ å¦‚æœç”¨æˆ·æœªå“åº”ï¼Œåˆ™å…³é—­é€šçŸ¥ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¦ä¸€ä¸ªæœ‰ç”¨çš„æ•ˆæœ<em>-race</em> ã€‚ å®ƒå…è®¸æ‚¨å®‰æ’å…¶ä»–å‡ ç§æ•ˆæœä¹‹é—´çš„ç«èµ›ã€‚ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç«èµ›ç”¨äºä¸ºæŸäº›æ“ä½œæä¾›è¶…æ—¶ã€‚ </p><br><p> ç”±äºä¸ä¸Šä¸€ç¤ºä¾‹çš„ç‚¹å‡»æ‹¦æˆªä»£ç ç›¸åŒï¼Œå› æ­¤æˆ‘ä»¬çœç•¥äº†ç”¨äºè·Ÿè¸ªé€‰é¡¹å¡æ´»åŠ¨çš„ä»£ç ã€‚ </p><br><p> æˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªå·¥å‚æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†åˆ›å»ºä¸€ä¸ªæ¸ é“æ¥è¯·æ±‚ç”¨æˆ·æ‰¹å‡†ä»¥æ¥æ”¶é€šçŸ¥ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { eventChannel, END } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createRequestNotificationPermissionChannel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> subscribe = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">emitter</span></span></span><span class="hljs-function"> =&gt;</span></span> { Notification.requestPermission(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">permission</span></span></span><span class="hljs-function"> =&gt;</span></span> { emitter(permission); emitter(END); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {}; }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> eventChannel(subscribe); }</code> </pre> <br><p> ä¸ºäº†å¯»æ±‚å¦ä¸€ç§å·¥å‚æ–¹æ³•ï¼Œä½†å…·æœ‰æ¥æ”¶é€šçŸ¥çš„æ¸ é“ï¼Œè¯·å•å‡»ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { eventChannel, END } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createNotificationClickChannel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">notification</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> subscribe = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">emitter</span></span></span><span class="hljs-function"> =&gt;</span></span> { notification.onclick = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function"> =&gt;</span></span> { emitter(event); emitter(END); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> notification.onclick = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> eventChannel(subscribe); }</code> </pre> <br><p> ä¸¤ä¸ªé€šé“å‡ä¸ºä¸€æ¬¡æ€§ä½¿ç”¨ï¼Œä¸€æ¬¡æœ€å¤šå¯æ‹æ‘„æœ€å¤šï¼Œç„¶åå…³é—­ã€‚ </p><br><p> å…³é”®ä»ç„¶æ˜¯-å…·æœ‰é€»è¾‘çš„ä¼ å¥‡ã€‚ æ£€æŸ¥é€‰é¡¹å¡æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œè¯·æ±‚è®¸å¯ï¼Œåˆ›å»ºé€šçŸ¥ï¼Œç­‰å¾…å•å‡»æˆ–è¶…æ—¶ï¼Œæ˜¾ç¤ºæ–°çš„èŒä½ç©ºç¼ºï¼Œä½¿é€‰é¡¹å¡å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œç„¶åå…³é—­é€šçŸ¥ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { delay } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { call, select, race, take } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga/effects'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { createRequestNotificationPermissionChannel } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../channels/request-notification-permission'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { createNotificationClickChannel } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../channels/notification-click'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { JobsActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions/jobs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">notificationsSaga</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { inFocus } = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> select(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inFocus) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> permissionChannel = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> call(createRequestNotificationPermissionChannel); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> permission = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> take(permissionChannel); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (permission !== <span class="hljs-string"><span class="hljs-string">'granted'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> notification = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Notification( <span class="hljs-string"><span class="hljs-string">`You have </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${action.payload.jobs.length}</span></span></span><span class="hljs-string"> new job posts`</span></span>, { <span class="hljs-attr"><span class="hljs-attr">icon</span></span>: <span class="hljs-string"><span class="hljs-string">'assets/new-jobs.png'</span></span> } ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> clickChannel = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> call(createNotificationClickChannel, notification); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { click, timeout } = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> race({ <span class="hljs-attr"><span class="hljs-attr">click</span></span>: take(clickChannel), <span class="hljs-attr"><span class="hljs-attr">timeout</span></span>: call(delay, <span class="hljs-number"><span class="hljs-number">5000</span></span>), }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (click) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> put(JobsActions.show()); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.focus(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.scrollTo(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } notification.close(); }</code> </pre> <br><p> åœ¨æ‰§è¡Œæ­¤åŠŸèƒ½æ£€æµ‹ä¹‹å‰ï¼Œè¯·å…ˆå®‰è£…ä¼ å¥‡ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { takeEvery } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga/effects'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { JobsActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions/jobs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { notificationsSaga } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./notifications'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sagas</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-string"><span class="hljs-string">'Notification'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">window</span></span> &amp;&amp; Notification.permission !== <span class="hljs-string"><span class="hljs-string">'denied'</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> takeEvery(JobsActions.fresh, notificationsSaga); } }</code> </pre> <br><h2 id="global-event-bus"> å…¨çƒæ´»åŠ¨å·´å£« </h2><br><p>  <em>ç”¨ä¾‹ï¼šåœ¨Reduxå•†åº—ä¹‹é—´è½¬ç§»æŒ‡å®šç±»åˆ«çš„äº‹ä»¶ã€‚</em> </p><br><p> å¦‚æœé¡µé¢ä¸Šå­˜åœ¨å¤šä¸ªå…·æœ‰å…¬å…±æ•°æ®çš„åº”ç”¨ç¨‹åºï¼Œåˆ™éœ€è¦è¿™ç§æ€»çº¿ã€‚ åŒæ—¶ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥å½¼æ­¤ç‹¬ç«‹åœ°å®ç°ã€‚ </p><br><p> ä¾‹å¦‚ï¼Œå¸¦æœ‰è¿‡æ»¤å™¨å’Œæœç´¢ç»“æœçš„æœç´¢å­—ç¬¦ä¸²ä½œä¸ºå•ç‹¬çš„reactåº”ç”¨ç¨‹åºã€‚ æ›´æ”¹è¿‡æ»¤å™¨æ—¶ï¼Œæˆ‘å¸Œæœ›ç»“æœåº”ç”¨ç¨‹åºçŸ¥é“å®ƒæ˜¯å¦ä¹Ÿåœ¨é¡µé¢ä¸Šã€‚ </p><br><p> æˆ‘ä»¬ä½¿ç”¨æ ‡å‡†çš„äº‹ä»¶å‘å°„å™¨ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> EventEmmiter <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'events'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.GlobalEventBus) { <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.GlobalEventBus = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EventEmmiter(); } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> globalEventBus = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.GlobalEventBus;</code> </pre> <br><p>  <em>å¤‡å—</em>å–œçˆ±çš„<em>eventChannel</em>å°†æ ‡å‡†å‘å°„å™¨å˜æˆä¸€ä¸ªé€šé“ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { eventChannel } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { globalEventBus <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> bus } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../utils/global-event-bus'</span></span>; exports <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createGlobalEventBusChannel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> subscribe = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">emitter</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> handler = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function"> =&gt;</span></span> emitter({ ...event, <span class="hljs-attr"><span class="hljs-attr">external</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }); bus.on(<span class="hljs-string"><span class="hljs-string">'global.event'</span></span>, handler); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bus.removeListener(<span class="hljs-string"><span class="hljs-string">'global.event'</span></span>, handler); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> eventChannel(subscribe); }</code> </pre> <br><p> ä¼ å¥‡å¾ˆç®€å•-æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªé¢‘é“å¹¶æ— ä¼‘æ­¢åœ°æ¥å—å†…éƒ¨æˆ–å¤–éƒ¨äº‹ä»¶ã€‚ å¦‚æœæˆ‘ä»¬æ”¶åˆ°å†…éƒ¨äº‹ä»¶ï¼Œåˆ™å°†å…¶å‘é€åˆ°æ€»çº¿ï¼Œå¦‚æœå¤–éƒ¨äº‹ä»¶åˆ™åœ¨å•†åº—ä¸­å‘é€ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { take, put, race, call } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga/effects'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { globalEventBus <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> bus } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../utils/global-event-bus'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { createGlobalEventBusChannel } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../channels/global-event-bus'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">globalEventBusSaga</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">allowedActions</span></span></span><span class="hljs-function">) </span></span>{ allowedActions = allowedActions.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> x.toString()); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> channel = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> call(createGlobalEventBusChannel); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { local, external } = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> race({ <span class="hljs-attr"><span class="hljs-attr">local</span></span>: take(), <span class="hljs-attr"><span class="hljs-attr">external</span></span>: take(channel), }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( external &amp;&amp; allowedActions.some(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">action</span></span></span><span class="hljs-function"> =&gt;</span></span> action === external.type) ) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> put(external); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( local &amp;&amp; !local.external &amp;&amp; allowedActions.some(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">action</span></span></span><span class="hljs-function"> =&gt;</span></span> action === local.type) ) { bus.emit(<span class="hljs-string"><span class="hljs-string">'global.event'</span></span>, local); } } };</code> </pre> <br><p> æœ€åä¸€ä¸ª-ç”¨å¿…è¦çš„äº‹ä»¶å®‰è£…ä¼ å¥‡ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { fork } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-saga/effects'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { globalEventBusSaga } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./global-event-bus'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { DropdownsActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions/dropdowns'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { AreasActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions/areas'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sagas</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> fork(globalEventBusSaga, [ DropdownsActions.closeAll, AreasActions.add, AreasActions.remove, ... ]); }</code> </pre> <br><hr><br><p> æˆ‘å¸Œæœ›èƒ½å¤Ÿè¯æ˜Sagasä½¿æè¿°å¤æ‚çš„å‰¯ä½œç”¨æ›´åŠ å®¹æ˜“ã€‚ æ¢ç´¢åº“APIï¼Œè½¬ç§»åˆ°æ‚¨çš„æ¡ˆä¾‹ä¸­ï¼Œç¼–å†™å¤æ‚çš„äº‹ä»¶æœŸæœ›æ¨¡å¼å¹¶æ„Ÿåˆ°é«˜å…´ã€‚ åœ¨JSå¼€æ”¾ç©ºé—´è§ï¼ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN438856/">https://habr.com/ru/post/zh-CN438856/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN438840/index.html">è‡ªè±ªä¸æ¿€æƒ…ï¼Œå°†æ¢¦æƒ³å˜æˆå¤ªç©ºé¡¹ç›®çš„æ•…äº‹</a></li>
<li><a href="../zh-CN438842/index.html">æ•´ç†torrent-TVæ’­æ”¾åˆ—è¡¨ï¼ˆSuper Washï¼‰</a></li>
<li><a href="../zh-CN438850/index.html">Moscow JS 44-å…¬å‘Š</a></li>
<li><a href="../zh-CN438852/index.html">OpenVoxçš„æ–°GSMç½‘å…³</a></li>
<li><a href="../zh-CN438854/index.html">åœ¨ä¸ä½¿ç”¨ä¼¯åŠªåˆ©æ–¹ç¨‹çš„æƒ…å†µä¸‹è§£é‡Šâ€œæå‡åŠ›â€ç°è±¡çš„ç‰©ç†æ€§è´¨</a></li>
<li><a href="../zh-CN438858/index.html">åœ¨åˆ¶å®šè¥é”€ç­–ç•¥æ—¶å¦‚ä½•ä½¿ç”¨ç»†åˆ†ï¼Œå®šä½å’Œå®šä½ï¼ˆSTPï¼‰</a></li>
<li><a href="../zh-CN438862/index.html">ä»¥Nuxt.jsä¸ºä¾‹ï¼Œéƒ¨ç½²åŒæ„Webåº”ç”¨ç¨‹åºã€‚</a></li>
<li><a href="../zh-CN438864/index.html">åŠŸèƒ½å†»ç»“C ++ 20ã€‚ åç¨‹ï¼Œæ¨¡å—ç­‰</a></li>
<li><a href="../zh-CN438866/index.html">ç”Ÿæˆå™¨ä¸Javaè¯­æ³•</a></li>
<li><a href="../zh-CN438868/index.html">å®‰å…¨å‘¨06ï¼šç›´æ’­FaceTime</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>