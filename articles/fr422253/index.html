<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòÆ üë©üèæ‚Äçü§ù‚Äçüë©üèª üßñüèΩ If - Cadre frontal de Rust & WebAssembly üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë© üë©üèΩ üë®üèæ‚Äçüíª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Yew est un analogue de React and Elm, enti√®rement √©crit en rouille et compil√© en un honn√™te assemblage Web. Dans l'article, Denis Kolodin, d√©veloppeur...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>If - Cadre frontal de Rust & WebAssembly</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/422253/">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Yew</a> est un analogue de React and Elm, enti√®rement √©crit en rouille et compil√© en un honn√™te assemblage Web.  Dans l'article, Denis Kolodin, d√©veloppeur Yew, explique comment cr√©er un framework sans garbage collector, garantir efficacement l'immuable, sans avoir besoin de copier l'√©tat en raison des r√®gles de propri√©t√© des donn√©es Rust, et quelles sont les fonctionnalit√©s lors de la traduction de Rust en WebAssembly. <br><br><img src="https://habrastorage.org/webt/dc/ro/wt/dcrowtesfnjfmpr7wl9j0suzjug.jpeg"><br><br>  <i>Le message a √©t√© pr√©par√© sur la base du rapport de Denis lors de la conf√©rence <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HolyJS 2018 Piter</a> .</i>  <i>Sous la coupe - transcription vid√©o et texte du rapport.</i> <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/OqFOXMIwzTc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>Denis Kolodin travaille pour Bitfury Group, une soci√©t√© qui d√©veloppe diverses solutions de blockchain.</i>  <i>Depuis plus de deux ans maintenant, il codait en Rust, un langage de programmation de Mozilla Research.</i>  <i>Pendant ce temps, Denis a r√©ussi √† √©tudier en profondeur ce langage et √† l'utiliser pour d√©velopper diverses applications syst√®me, un backend.</i>  <i>Maintenant, dans le cadre de l'av√®nement de la norme WebAssembly, j'ai commenc√© √† regarder vers le front-end.</i> <br><br><h2>  Agenda </h2><br>  Aujourd'hui, nous apprendrons ce qu'est Yew (le nom du framework se lit comme le mot anglais "you" - you; "if" est un arbre d'if traduit de l'anglais). <br><br>  Parlons un peu des aspects architecturaux, des id√©es sur lesquelles le cadre est construit, des possibilit√©s qui y sont int√©gr√©es, ainsi que des fonctionnalit√©s que Rust nous offre en plus par rapport aux autres langages. <br><br>  √Ä la fin, je vais vous montrer comment commencer √† utiliser Yew et WebAssembly d√®s aujourd'hui. <br><br><h2>  Qu'est-ce que l'if? </h2><br>  Tout d'abord, c'est WebAssembly, c'est-√†-dire  bytecode ex√©cutable qui fonctionne dans les navigateurs.  Il est n√©cessaire pour ex√©cuter des algorithmes complexes c√¥t√© utilisateur, par exemple, la cryptographie, le codage / d√©codage.  Il est plus facile de l'impl√©menter dans les langages syst√®me que de visser des b√©quilles. <br><br>  WebAssembly est une norme clairement d√©crite, comprise et prise en charge par tous les navigateurs modernes.  Il vous permet d'utiliser diff√©rents langages de programmation.  Et cela est int√©ressant principalement parce que vous pouvez r√©utiliser le code cr√©√© par la communaut√© dans d'autres langues. <br><br>  Si vous le souhaitez, vous pouvez compl√®tement √©crire une application sur WebAssembly, et Yew vous permet de le faire, mais il est important de ne pas oublier que m√™me dans ce cas, JavaScript reste dans le navigateur.  Il est n√©cessaire de pr√©parer WebAssembly - prenez le module (WASM), ajoutez-y l'environnement et ex√©cutez-le.  C'est-√†-dire  JavaScript est indispensable.  Par cons√©quent, WebAssembly m√©rite d'√™tre consid√©r√© comme une extension plut√¥t qu'une alternative r√©volutionnaire √† JS. <br><br><h3>  √Ä quoi ressemble le d√©veloppement </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/9ef/8d5/b7f/9ef8d5b7ffb36029d2a4d840f9432980.png"><br><br>  Vous avez une source, il y a un compilateur.  Vous traduisez tout cela dans un format binaire et l'ex√©cutez dans un navigateur.  Si le navigateur est ancien, sans prise en charge de WebAssembly, alors emscripten est requis.  Il s'agit, en gros, d'un √©mulateur WebAssembly pour un navigateur. <br><br><h3>  If - framework wasm pr√™t √† l'emploi </h3><br>  Passons √† Yew.  J'ai d√©velopp√© ce cadre √† la fin de l'ann√©e derni√®re.  Ensuite, j'ai √©crit une sorte d'application de crypto-monnaie sur Elm et face au fait qu'en raison de restrictions linguistiques, je ne peux pas cr√©er une structure r√©cursive.  Et √† ce moment, j'ai pens√©: √† Rust, mon probl√®me serait r√©solu tr√®s facilement.  Et puisque 99% du temps j'√©cris en Rust et que j'aime ce langage pr√©cis√©ment pour ses fonctionnalit√©s, j'ai d√©cid√© d'exp√©rimenter - pour compiler l'application avec la m√™me fonction de mise √† jour dans Rust. <br><br>  Le premier croquis m'a pris plusieurs heures, j'ai d√ª comprendre comment compiler WebAssembly.  Je l'ai lanc√© et j'ai r√©alis√© qu'en quelques heures, il avait pos√© le noyau, ce qui est tr√®s facile √† d√©velopper.  Il ne m'a fallu que quelques jours pour tout apporter au moteur de framework minimum. <br><br>  Je l'ai post√© en open source, mais je ne m'attendais pas √† ce qu'il soit populaire.  Cependant, aujourd'hui, il a collect√© plus de 4 000 √©toiles sur GitHub.  Vous pouvez voir le projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Il existe de nombreux exemples. <br><br>  Le cadre est enti√®rement √©crit en Rust.  Yew prend en charge la compilation directement sur WebAssembly (cible wasm32-unknown-unknown) sans emscripten.  Si n√©cessaire, vous pouvez utiliser emscripten. <br><br><h2>  L'architecture </h2><br>  Maintenant, quelques mots sur la fa√ßon dont le cadre diff√®re des approches traditionnelles qui existent dans le monde JavaScript. <br><br>  Tout d'abord, je vais vous montrer les restrictions linguistiques que j'ai rencontr√©es dans Elm.  Prenons le cas quand il y a un mod√®le et qu'il y a un message qui vous permet de transformer ce mod√®le. <br><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">alias</span></span> Model =    { <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> : <span class="hljs-type"><span class="hljs-type">Int</span></span>    }  <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Msg    = <span class="hljs-keyword"><span class="hljs-keyword">Increment</span></span>    | Decrement</code> </pre> <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> msg <span class="hljs-keyword"><span class="hljs-keyword">of</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">Increment</span></span> -&gt;     { value = model.value + <span class="hljs-number"><span class="hljs-number">1</span></span> }   Decrement -&gt;     { <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = model.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span> }</code> </pre><br>  Dans Elm, nous cr√©ons simplement un nouveau mod√®le et l'afficher √† l'√©cran.  La version pr√©c√©dente du mod√®le reste inchang√©e.  Pourquoi je me concentre l√†-dessus?  Parce que dans Yew, le mod√®le est mutable, et c'est l'une des questions les plus courantes.  Ensuite, je vais expliquer pourquoi cela est fait. <br><br>  Au d√©part, j'ai suivi le chemin classique lors de la recr√©ation du mod√®le.  Mais au fur et √† mesure que le cadre s'est d√©velopp√©, j'ai vu que cela n'avait aucun sens de stocker la version pr√©c√©dente du mod√®le.  Rust vous permet de suivre la dur√©e de vie de toutes les donn√©es, qu'elles soient modifi√©es ou non.  Et donc je peux changer le mod√®le en toute s√©curit√©, sachant que Rust contr√¥le l'absence de conflit. <br><br><pre> <code class="rust hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span></span> {   value: <span class="hljs-built_in"><span class="hljs-built_in">i64</span></span>, } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Msg</span></span></span></span> {   Increment,   Decrement, }</code> </pre><br><pre> <code class="hljs php">match msg {   Msg::Increment =&gt; {       <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.value += <span class="hljs-number"><span class="hljs-number">1</span></span>;   }   Msg::Decrement =&gt; {       <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.value -= <span class="hljs-number"><span class="hljs-number">1</span></span>;   } }</code> </pre><br>  Ceci est le premier moment.  Deuxi√®me point: pourquoi avons-nous besoin de l'ancienne version du mod√®le?  Dans le m√™me orme, il n'y a gu√®re de probl√®me d'acc√®s concurrentiel.  L'ancien mod√®le n'est n√©cessaire que pour comprendre quand effectuer le rendu.  La prise de conscience de ce moment m'a permis de me d√©barrasser compl√®tement de l'immuable et de ne pas conserver l'ancienne version. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c98/ff5/d94/c98ff5d946992d46ba910e36375b4fc7.png"><br><br>  Regardez l'option lorsque nous avons la fonction de <code>update</code> et deux champs - <code>value</code> et <code>name</code> .  Une valeur est enregistr√©e lorsque nous entrons des donn√©es dans le champ de <code>input</code> .  Le mod√®le change. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/140/a12/d41/140a12d4106fb15b17204d547de29b82.png"><br><br>  Il est important que la <code>value</code> ne <code>value</code> pas impliqu√©e dans le rendu.  Et donc nous pouvons le changer autant que nous voulons.  Mais nous n'avons pas besoin d'influencer l'arborescence DOM et nous n'avons pas besoin d'initier ces changements. <br><br>  Cela m'a conduit √† l'id√©e que seul le d√©veloppeur peut savoir le bon moment o√π le rendu doit vraiment √™tre lanc√©.  Pour commencer, j'ai commenc√© √† utiliser l'indicateur - juste une valeur bool√©enne - <code>ShouldRender</code> , qui signale que le mod√®le a chang√© et que nous devons commencer le rendu.  Dans le m√™me temps, il n'y a pas de surcharge pour les comparaisons constantes, il n'y a pas de consommation de m√©moire - les applications √©crites en Yew sont les plus efficaces. <br><br>  Dans l'exemple ci-dessus, il n'y avait aucune allocation de m√©moire, √† l'exception du message g√©n√©r√© et envoy√©.  Le mod√®le a conserv√© son √©tat, et cela ne s'est refl√©t√© dans le rendu qu'√† l'aide d'un drapeau. <br><br><h2>  Les possibilit√©s </h2><br>  √âcrire un framework qui fonctionne dans WebAssembly n'est pas une t√¢che facile.  Nous avons JavaScript, mais il devrait cr√©er une sorte d'environnement avec lequel il faut interagir, ce qui repr√©sente une √©norme quantit√© de travail.  La version initiale de ces bundles ressemblait √† ceci: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3ab/5aa/f25/3ab5aaf257e0a6a9f611e885dba4bd8d.png"><br><br>  J'ai pris une d√©mo d'un autre projet.  Il existe de nombreux projets qui vont dans ce sens, mais cela conduit rapidement √† une impasse.  Apr√®s tout, le framework est un d√©veloppement assez important et vous devez √©crire beaucoup de code d'ancrage.  J'ai commenc√© √† utiliser des biblioth√®ques √† Rust qui s'appellent des caisses, en particulier la <code>Stdweb</code> . <br><br><h3>  JS int√©gr√© </h3><br>  Avec l'aide des macros Rust, vous pouvez √©tendre la langue - nous pouvons int√©grer des morceaux de JavaScript dans le code Rust, c'est une fonctionnalit√© tr√®s utile de la langue. <br><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> handle = js! {   var callback = @{callback};   var action = function() {       callback();   };   var delay = @{ms};   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {       interval_id: setInterval(action, delay),       callback: callback,   }; };</code> </pre><br>  L'utilisation de macros et de Stdweb m'a permis d'√©crire rapidement et efficacement tous les liens n√©cessaires. <br><br><h3>  Mod√®les Jsx </h3><br>  Au d√©but, j'ai suivi le chemin Elm et j'ai commenc√© √† utiliser des mod√®les impl√©ment√©s √† l'aide de code. <br><br><pre> <code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) -&gt; Html&lt;Context, <span class="hljs-keyword"><span class="hljs-keyword">Self</span></span>&gt; {   nav(<span class="hljs-string"><span class="hljs-string">"nav"</span></span>, (<span class="hljs-string"><span class="hljs-string">"menu"</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">vec!</span></span>[       button(<span class="hljs-string"><span class="hljs-string">"button"</span></span>, (), (<span class="hljs-string"><span class="hljs-string">"onclick"</span></span>, || Msg::Clicked)),       tag(<span class="hljs-string"><span class="hljs-string">"section"</span></span>, (<span class="hljs-string"><span class="hljs-string">"ontop"</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">vec!</span></span>[           p(<span class="hljs-string"><span class="hljs-string">"My text..."</span></span>)       ])   ]) }</code> </pre><br>  Je n'ai jamais √©t√© partisan de React.  Mais quand j'ai commenc√© √† √©crire mon framework, j'ai r√©alis√© que JSX dans React est une chose tr√®s cool.  Voici une pr√©sentation tr√®s pratique des mod√®les de code. <br><br>  En cons√©quence, j'ai pris une macro sur Rust et impl√©ment√© directement dans Rust la possibilit√© d'√©crire du balisage HTML qui g√©n√®re imm√©diatement des √©l√©ments d'arborescence virtuelle. <br><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> Renderable&lt;Context, Model&gt; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Model {   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) -&gt; Html&lt;Context, <span class="hljs-keyword"><span class="hljs-keyword">Self</span></span>&gt; {       html! {           &lt;div&gt;               &lt;nav class=<span class="hljs-string"><span class="hljs-string">"menu"</span></span>,&gt;                   &lt;button onclick=|_| Msg::Increment,&gt;{ <span class="hljs-string"><span class="hljs-string">"Increment"</span></span> }&lt;/button&gt;                   &lt;button onclick=|_| Msg::Decrement,&gt;{ <span class="hljs-string"><span class="hljs-string">"Decrement"</span></span> }&lt;/button&gt;               &lt;/nav&gt;               &lt;p&gt;{ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.value }&lt;/p&gt;               &lt;p&gt;{ Local::now() }&lt;/p&gt;           &lt;/div&gt;       }   } }</code> </pre><br>  Nous pouvons dire que les mod√®les de type JSX sont des mod√®les de code pur, mais sur des st√©ro√Ødes.  Ils sont pr√©sent√©s dans un format pratique.  Notez √©galement que j'ins√®re ici une expression Rust directement dans le bouton (l'expression Rust peut √™tre ins√©r√©e √† l'int√©rieur de ces mod√®les).  Cela vous permet de vous int√©grer tr√®s √©troitement. <br><br><h3>  Composants assez structur√©s </h3><br>  Ensuite, j'ai commenc√© √† d√©velopper des mod√®les et r√©alis√© la possibilit√© d'utiliser des composants.  Il s'agit du premier probl√®me rencontr√© dans le r√©f√©rentiel.  J'ai impl√©ment√© des composants qui peuvent √™tre utilis√©s dans le code du mod√®le.  Vous d√©clarez simplement une structure honn√™te dans Rust et lui √©crivez quelques propri√©t√©s.  Et ces propri√©t√©s peuvent √™tre d√©finies directement √† partir du mod√®le. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9b9/3d0/d37/9b93d0d3797e46f73650b00689315009.png"><br><br>  Encore une fois, je note la chose importante que ces mod√®les sont du code Rust g√©n√©r√© honn√™tement.  Par cons√©quent, toute erreur ici sera remarqu√©e par le compilateur.  C'est-√†-dire  vous ne pouvez pas vous tromper, comme c'est souvent le cas dans le d√©veloppement JavaScript. <br><br><h3>  Zones dactylographi√©es </h3><br>  Une autre caract√©ristique int√©ressante est que lorsqu'un composant est plac√© √† l'int√©rieur d'un autre composant, il peut voir le type de message du parent. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/933/831/4cb/9338314cb1560b2172c6ab11bbff7977.png"><br><br>  Le compilateur lie rigidement ces types et ne vous donnera pas la possibilit√© de faire une erreur.  Lors du traitement des √©v√©nements, les messages que le composant attend ou peut envoyer doivent correspondre enti√®rement au parent. <br><br><h3>  Autres fonctionnalit√©s </h3><br>  J'ai transf√©r√© une impl√©mentation de Rust directement vers le framework qui vous permet d'utiliser facilement diff√©rents formats de s√©rialisation / d√©s√©rialisation (en lui fournissant des wrappers suppl√©mentaires).  Voici un exemple: nous allons au stockage local et, en restaurant les donn√©es, sp√©cifions un certain wrapper - ce que nous attendons ici est json. <br><br><pre> <code class="rust hljs">Msg::Store =&gt; {   context.local_storage.store(KEY, Json(&amp;model.clients)); } Msg::Restore =&gt; {    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Json(<span class="hljs-literal"><span class="hljs-literal">Ok</span></span>(clients)) = context.local_storage.restore(KEY) {        model.clients = clients;   } }</code> </pre><br>  Il peut s'agir de n'importe quel format, y compris binaire.  En cons√©quence, la s√©rialisation et la d√©s√©rialisation deviennent transparentes et pratiques. <br><br>  L'id√©e d'une autre opportunit√© que j'ai impl√©ment√©e est venue des utilisateurs du framework.  Ils ont demand√© de faire des fragments.  Et l√†, je suis tomb√© sur une chose int√©ressante.  Voyant en JavaScript la possibilit√© d'ins√©rer des fragments dans l'arborescence DOM, j'ai d'abord d√©cid√© qu'il serait tr√®s facile d'impl√©menter une telle fonction dans mon framework.  Mais j'ai essay√© cette option, et il s'est av√©r√© que cela ne fonctionne pas.  Je devais le comprendre, marcher sur cet arbre, voir ce qui avait chang√© l√†-bas, etc. <br><br>  Le framework Yew utilise une arborescence DOM virtuelle, tout y existe initialement.  En fait, quand il y a des changements dans le mod√®le, ils se transforment en correctifs qui changent d√©j√† l'arborescence DOM rendue. <br><br><pre> <code class="hljs xml">html! {   <span class="hljs-tag"><span class="hljs-tag">&lt;&gt;</span></span>       <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>{ "Row" }<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span>       <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>{ "Row" }<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span>       <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>{ "Row" }<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;/&gt;</span></span> }</code> </pre><br><h2>  Des avantages suppl√©mentaires </h2><br>  La rouille offre de nombreuses autres fonctionnalit√©s puissantes, je ne parlerai que des plus importantes. <br><br><h3>  Services: interaction avec le monde ext√©rieur </h3><br>  La premi√®re occasion dont je veux parler concerne les services.  Vous pouvez d√©crire les fonctionnalit√©s n√©cessaires sous la forme d'un service, le publier en tant que caisse et le r√©utiliser. <br><br>  Dans Rust, la possibilit√© de cr√©er des biblioth√®ques, leur int√©gration, l'ancrage et le collage est tr√®s bien impl√©ment√©e.  En fait, vous pouvez cr√©er diverses API pour interagir avec votre service, y compris celles en JavaScript.  Dans le m√™me temps, le framework peut interagir avec le monde ext√©rieur, malgr√© le fait qu'il fonctionne √† l'int√©rieur du runtime WebAssembly. <br><br>  Exemples de services: <br><br><ul><li>  TimeOutService; <br></li><li>  IntervalService; <br></li><li>  FetchService; <br></li><li>  WebSocketService; <br></li><li>  Services personnalis√©s ... <br></li></ul><br>  Services et caisses <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">antirouille</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">crates.io</a> . <br><br><h3>  Contexte: exigences de l'√âtat </h3><br>  Une autre chose que j'ai mise en ≈ìuvre dans le cadre n'est pas enti√®rement traditionnelle, c'est le contexte.  React a une API Context, mais j'ai utilis√© Context dans un sens diff√©rent.  Le cadre Yew se compose des composants que vous cr√©ez et le contexte est un √©tat global.  Les composants peuvent ne pas prendre en compte cet √©tat global, mais peuvent faire certaines demandes - de sorte que l'entit√© globale remplit certains crit√®res. <br><br>  Disons que notre composant abstrait n√©cessite la possibilit√© de t√©l√©charger quelque chose sur S3. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3f6/477/776/3f6477776d227c4b7abcf64be2f17f5c.png"><br><br>  On peut voir ci-dessous qu'il utilise ce t√©l√©chargement, c'est-√†-dire  envoie des donn√©es √† S3.  Un tel composant peut se pr√©senter sous la forme d'un rack.  L'utilisateur qui t√©l√©charge ce composant et l'ajoute √† l'int√©rieur du mod√®le √† son application rencontrera une erreur - le compilateur lui demandera o√π est le support S3?  L'utilisateur devra impl√©menter ce support.  Apr√®s cela, le composant commence automatiquement √† vivre pleinement. <br><br>  O√π est-il n√©cessaire?  Imaginez: vous cr√©ez un composant avec une cryptographie intelligente.  Il a des exigences que le contexte environnant lui permette de se connecter quelque part.  Il vous suffit d'ajouter un formulaire d'autorisation dans le mod√®le et de mettre en place dans votre contexte la connexion avec votre service.  C'est-√†-dire  ce sera litt√©ralement trois lignes de code.  Apr√®s cela, le composant commence √† fonctionner. <br><br>  Imaginez que nous ayons des dizaines de composants diff√©rents.  Et ils ont tous la m√™me exigence.  Cela vous permet d'impl√©menter une sorte de fonctionnalit√© une fois pour relancer tous les composants et r√©cup√©rer les donn√©es n√©cessaires.  Hors contexte.  Et le compilateur ne vous permettra pas de faire une erreur: si vous n'avez pas d'interface qui n√©cessite un composant, rien ne fonctionnera. <br><br>  Par cons√©quent, vous pouvez facilement cr√©er des boutons tr√®s pointilleux qui demanderont une API ou d'autres fonctionnalit√©s.  Gr√¢ce √† Rust et au syst√®me de ces interfaces (elles sont appel√©es trait dans Rust), il devient possible de d√©clarer les exigences des composants. <br><br><h3>  Le compilateur ne vous laissera pas faire d'erreur </h3><br>  Imaginez que nous cr√©ons un composant avec certaines propri√©t√©s, dont la possibilit√© de d√©finir le rappel.  Et, par exemple, nous avons d√©fini la propri√©t√© et manqu√© une lettre dans son nom. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/829/d84/93d/829d8493d52ccff0299dc030661c5b37.png"><br><br>  En essayant de compiler, Rust r√©pond rapidement.  Il dit que nous nous sommes tromp√©s et qu'il n'y a pas une telle propri√©t√©: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/02d/08d/ef7/02d08def74b01670bc6b4b0695f5cc2f.png"><br><br>  Comme vous pouvez le voir, Rust utilise directement ce mod√®le et peut afficher toutes les erreurs √† l'int√©rieur de la macro.  Il vous dit comment la propri√©t√© doit vraiment s'appeler.  Si vous avez r√©ussi le compilateur, vous n'aurez pas d'erreurs d'ex√©cution idiotes comme des fautes de frappe. <br><br>  Imaginez maintenant, nous avons un bouton qui demande √† notre contexte global de pouvoir se connecter √† S3.  Et cr√©ez un contexte qui n'impl√©mente pas le support S3.  Voyons ce qui se passe. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a50/8d6/c7e/a508d6c7e4470c16f7890f36f0bd4135.png"><br><br>  Le compilateur signale que nous avons ins√©r√© un bouton, mais cette interface n'est pas impl√©ment√©e pour le contexte. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/63b/4f9/790/63b4f97902e2460ced9cbbdd0f820f23.png"><br><br>  Il ne reste plus qu'√† entrer dans l'√©diteur, ajouter un lien vers Amazon dans le contexte, et tout commencera.  Vous pouvez cr√©er des services pr√™ts √† l'emploi avec une sorte d'API, puis simplement ajouter au contexte, y substituer un lien et le composant prend imm√©diatement vie.  Cela vous permet de faire des choses tr√®s int√©ressantes: vous ajoutez des composants, cr√©ez un contexte, remplissez-le de services.  Et tout cela fonctionne de mani√®re enti√®rement automatique; des efforts minimes sont n√©cessaires pour tout lier ensemble. <br><br><h2>  Comment commencer √† utiliser Yew? </h2><br>  Par o√π commencer si vous souhaitez essayer de compiler une application WebAssembly?  Et comment cela peut-il √™tre fait en utilisant le cadre Yew? <br><br><h3>  Compilation de rouille √† wasm </h3><br>  Tout d'abord, vous devez installer le compilateur.  Il existe un outil de rustup pour cela: <br><br> <code>curl https://sh.rustup.rs -sSf | sh <br></code> <br>  De plus, vous devrez peut-√™tre emscripten.  √Ä quoi cela peut-il √™tre utile?  La plupart des biblioth√®ques √©crites pour les langages de programmation syst√®me, en particulier pour Rust (√† l'origine un syst√®me), sont d√©velopp√©es pour Linux, Windows et d'autres syst√®mes d'exploitation √† part enti√®re.  De toute √©vidence, le navigateur n'a pas beaucoup de fonctionnalit√©s. <br><br>  Par exemple, la g√©n√©ration de nombres al√©atoires dans un navigateur ne se fait pas de la m√™me mani√®re que sous Linux.  emscripten est utile si vous souhaitez utiliser des biblioth√®ques qui n√©cessitent une API syst√®me. <br><br>  Les biblioth√®ques et l'ensemble de l'infrastructure passent tranquillement √† un assemblage Web honn√™te, et emscripten n'est plus requis (vous utilisez des capacit√©s bas√©es sur JavaScript pour g√©n√©rer des nombres al√©atoires et d'autres choses), mais si vous devez cr√©er quelque chose qui n'est pas du tout pris en charge dans le navigateur, vous ne pouvez pas vous passer d'emscripten . <br><br>  Je recommande √©galement d'utiliser cargo-web: <br><br> <code>cargo install cargo-web <br></code> <br>  Il est possible de compiler WebAssembly sans utilitaires suppl√©mentaires.  Mais cargo-web est un outil g√©nial qui fournit plusieurs choses utiles aux d√©veloppeurs JavaScript.  En particulier, il surveillera les fichiers: si vous apportez des modifications, il commencera √† compiler imm√©diatement (le compilateur ne fournit pas de telles fonctions).  Dans ce cas, Cargo-web vous permettra d'acc√©l√©rer le d√©veloppement.  Il existe diff√©rents syst√®mes de construction pour Rust, mais le fret repr√©sente 99,9% de tous les projets. <br><br>  Un nouveau projet est cr√©√© comme suit: <br><br> <code>cargo new --bin my-project <br></code> <br> <code>[package] <br> name = "my-project" <br> version = "0.1.0" <br> <br> [dependencies] <br> yew = "0.3.0" <br></code> <br>  Ensuite, lancez simplement le projet: <br><br> <code>cargo web start --target wasm32-unknown-unknown <br></code> <br>  J'ai donn√© un exemple de WebAssembly honn√™te.  Si vous devez compiler sous emscripten (le compilateur rust peut connecter emscripten lui-m√™me), vous pouvez ins√©rer le mot <code>emscripten</code> dans le tout dernier √©l√©ment <code>unknown</code> , ce qui vous permet d'utiliser plus de caisses.  N'oubliez pas que emscripten est un kit suppl√©mentaire assez volumineux pour votre fichier.  Par cons√©quent, il est pr√©f√©rable d'√©crire du code WebAssembly honn√™te. <br><br><h3>  Restrictions existantes </h3><br>  Toute personne ayant une exp√©rience du codage dans les langages de programmation syst√®me peut √™tre frustr√©e par les limitations existantes dans le cadre.  Toutes les biblioth√®ques ne peuvent pas √™tre utilis√©es dans WebAssembly.  Par exemple, dans un environnement JavaScript, il n'y a pas de threads.  WebAssembly ne le d√©clare pas en principe, et bien s√ªr vous pouvez l'utiliser dans un environnement multi-thread (c'est une question ouverte), mais JavaScript est toujours un environnement single-thread.  Oui, il y a des travailleurs, mais c'est l'isolement, donc il n'y aura pas de flux l√†-bas. <br><br>  Il semblerait que vous puissiez vivre sans flux.  Mais si vous souhaitez utiliser des biblioth√®ques bas√©es sur des threads, par exemple, vous souhaitez ajouter une sorte d'ex√©cution, cela peut ne pas d√©coller. <br><br>  De plus, il n'y a pas d'API syst√®me, √† l'exception de celle que vous transf√©rerez de JavaScript √† WebAssembly.  Par cons√©quent, de nombreuses biblioth√®ques ne seront pas port√©es.  Vous ne pouvez pas √©crire et lire des fichiers directement, les sockets ne peuvent pas √™tre ouverts et vous ne pouvez pas √©crire sur le r√©seau.  Si vous voulez cr√©er un socket Web, par exemple, vous devez le faire glisser depuis JavaScript. <br><br>  Un autre inconv√©nient est que le d√©bogueur WASM existe, mais personne ne l'a vu.  Il est encore dans un √©tat brut tel qu'il est peu probable qu'il vous soit utile.  Le d√©bogage de WebAssembly est donc une question d√©licate. <br><br>  Lors de l'utilisation de Rust, presque tous les probl√®mes d'ex√©cution seront associ√©s √† des erreurs de logique m√©tier, ils seront faciles √† r√©soudre.  Mais tr√®s rarement des bogues de bas niveau apparaissent - par exemple, l'une des biblioth√®ques fait le mauvais amarrage - et c'est d√©j√† une question difficile.  Par exemple, pour le moment, il y a un tel probl√®me: si je compile le cadre avec emscripten et qu'il y a une cellule de m√©moire variable, dont la possession est supprim√©e, elle est donn√©e, emscripten se d√©sagr√®ge quelque part au milieu (et je ne suis m√™me pas s√ªr que ce soit emscripten).  Sachez que si vous rencontrez un probl√®me quelque part dans le middleware √† un niveau bas, il sera difficile de le r√©soudre pour le moment. <br><br><h2>  L'avenir du cadre </h2><br>  Comment √©voluera Yew?  Je vois son objectif principal dans la cr√©ation de composants monolithiques.  Vous aurez un fichier WebAssembly compil√©, et vous le collez simplement dans l'application.  Par exemple, il peut fournir des capacit√©s cryptographiques, un rendu ou une √©dition. <br><br><h3>  Int√©gration JS </h3><br>  L'int√©gration avec JavaScript sera renforc√©e.  JavaScript a √©crit un grand nombre de biblioth√®ques int√©ressantes qui sont faciles √† utiliser.  Et il y a des exemples dans le r√©f√©rentiel o√π je montre comment vous pouvez utiliser la biblioth√®que JavaScript existante directement √† partir du cadre Yew. <br><br><h3>  CSS typ√© </h3><br>  √âtant donn√© que Rust est utilis√©, il est √©vident que vous pouvez ajouter du CSS typ√© qui peut √™tre g√©n√©r√© avec la m√™me macro que dans l'exemple d'un moteur de mod√®le de type JSX.  Dans ce cas, le compilateur v√©rifiera, par exemple, si vous avez attribu√© un autre attribut au lieu de la couleur.  Cela vous fera √©conomiser beaucoup de temps. <br><br><h3>  Composants pr√™ts </h3><br>  Je regarde √©galement vers la cr√©ation de composants pr√™ts √† l'emploi.  Sur le framework, vous pouvez faire des fissures qui fourniront, par exemple, un ensemble de quelques boutons ou √©l√©ments qui seront connect√©s en tant que biblioth√®que, ajout√©s aux mod√®les et utilis√©s. <br><br><h3>  Am√©lioration des performances dans les affaires priv√©es </h3><br>  La performance est une question tr√®s d√©licate et complexe.  WebAssembly est-il plus rapide que JavaScript?  Je n'ai aucune preuve confirmant une r√©ponse positive ou n√©gative.  On dirait et selon certains tests tr√®s simples que j'ai men√©s, WebAssembly est tr√®s rapide.  Et je suis convaincu que ses performances seront sup√©rieures √† celles de JavaScript, simplement parce que c'est un bytecode de bas niveau o√π l'allocation de m√©moire n'est pas requise et il existe de nombreux autres moments n√©cessitant des ressources. <br><br><h3>  Plus de contributeurs </h3><br>  J'aimerais attirer plus de contributeurs.  Les portes pour participer au cadre sont toujours ouvertes.  Tous ceux qui souhaitent mettre √† niveau quelque chose, comprendre le noyau et transformer les outils avec lesquels un grand nombre de d√©veloppeurs travaillent peuvent facilement se connecter et proposer leurs propres modifications. <br><br>  De nombreux contributeurs ont d√©j√† particip√© au projet.  Mais il n'y a pas de contributeurs Core pour le moment, car pour cela vous devez comprendre le vecteur de d√©veloppement du framework, mais il n'a pas encore √©t√© clairement formul√©.  Mais il y a une colonne vert√©brale, des gars qui connaissent tr√®s bien Yew - environ 30 personnes.  Si vous souhaitez √©galement ajouter quelque chose au cadre, veuillez toujours envoyer une demande d'extraction. <br><br><h3>  La documentation </h3><br>  Un point obligatoire dans mes plans est la cr√©ation d'une grande quantit√© de documentation sur la fa√ßon d'√©crire des applications sur Yew.  De toute √©vidence, l'approche de d√©veloppement dans ce cas est diff√©rente de ce que nous avons vu dans React et Elm. <br><br>  Parfois, les gars me montrent des cas int√©ressants sur la fa√ßon d'utiliser le cadre.  Pourtant, cr√©er un cadre n'est pas la m√™me chose que d'y √©crire professionnellement.  Des pratiques d'utilisation du cadre sont toujours en cours d'√©laboration. <br><br>  Essayez-le, installez Rust, d√©veloppez vos capacit√©s en tant que d√©veloppeur.  La ma√Ætrise de WebAssembly sera utile √† chacun de nous, car la cr√©ation d'applications tr√®s complexes est le moment que nous attendons depuis longtemps.  En d'autres termes, WebAssembly ne concerne pas seulement un navigateur Web, mais c'est g√©n√©ralement un runtime qui se d√©veloppe d√©finitivement et se d√©veloppera encore plus activement. <br><br><blockquote>  Si vous avez aim√© le rapport, faites attention: du 24 au 25 novembre, un nouveau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HolyJS</a> se tiendra √† Moscou, et il y aura aussi beaucoup de choses int√©ressantes.      ‚Äî  ,       ( <b>  </b>  ). </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr422253/">https://habr.com/ru/post/fr422253/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr422239/index.html">Comment lancer la livraison pour des millions d'utilisateurs</a></li>
<li><a href="../fr422241/index.html">KPI - Trois lettres d'achoppement</a></li>
<li><a href="../fr422243/index.html">CRM pour les petites entreprises. En avez-vous besoin?</a></li>
<li><a href="../fr422247/index.html">OK Instant Games Cup. Concurrence pour les d√©veloppeurs de jeux HTML5</a></li>
<li><a href="../fr422251/index.html">"Un haut niveau d'auto-discipline." Jeffrey Richter explique comment coder, √©crire des livres et cr√©er ses propres entreprises</a></li>
<li><a href="../fr422255/index.html">Cr√©ation de personnages dans Blender et Unity</a></li>
<li><a href="../fr422257/index.html">Critique du lecteur PocketBook 627: classe moyenne avec r√©tro-√©clairage, Wi-Fi et service cloud</a></li>
<li><a href="../fr422259/index.html">Structures de donn√©es de base. Mat√©riel. Les bases</a></li>
<li><a href="../fr422261/index.html">Zextras Powerstore et syst√®mes de hi√©rarchisation</a></li>
<li><a href="../fr422263/index.html">¬´Dormammu, je suis tomb√© d'accord¬ª: un algorithme de coop√©ration mutuellement b√©n√©fique avec une personne</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>