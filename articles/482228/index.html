<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñ§ üë≥üèø üßùüèø Escribimos una "calculadora" en C #. Parte I. C√°lculo del valor, derivada, simplificaci√≥n y otros gansos. üôé üë®üèª‚Äçüè´ ‚ûï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola 

 Por alguna raz√≥n, nuestra calculadora est√° asociada con algo que todo principiante deber√≠a escribir. Quiz√°s porque hist√≥ricamente las computad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Escribimos una "calculadora" en C #. Parte I. C√°lculo del valor, derivada, simplificaci√≥n y otros gansos.</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482228/">  Hola <br><br>  Por alguna raz√≥n, nuestra calculadora est√° asociada con algo que todo principiante deber√≠a escribir.  Quiz√°s porque hist√≥ricamente las computadoras para ese prop√≥sito fueron creadas para contar.  Pero escribiremos una calculadora dif√≠cil, no simulada, por supuesto, pero para poder realizar operaciones algebraicas b√°sicas, como la diferenciaci√≥n, la simplificaci√≥n y caracter√≠sticas como la compilaci√≥n para acelerar los c√°lculos. <br><br><div class="spoiler">  <b class="spoiler_title">¬°Menos agua!</b>  <b class="spoiler_title">¬øDe qu√© trata el art√≠culo?</b> <div class="spoiler_text">  Aqu√≠ ser√° superficial sobre la construcci√≥n de una expresi√≥n, el an√°lisis de una cadena, la sustituci√≥n de variables, la derivada anal√≠tica, la resoluci√≥n num√©rica de una ecuaci√≥n y una cierta integral, renderizando a formato LaTeX, n√∫meros complejos, compilando funciones, simplificando, expandiendo corchetes y bla, bla, bla.  Probablemente no en un art√≠culo. <br>  <i>Para aquellos que necesitan clonar algo con urgencia, un <a href="https://github.com/Angourisoft/MathS" rel="nofollow">enlace al repositorio</a> .</i> <br></div></div><br>  Tomamos las galletas restantes del a√±o nuevo, ¬°y manejamos! <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">¬øPara qui√©n es este art√≠culo?</b> <div class="spoiler_text">  Creo que el art√≠culo puede ser √∫til para un principiante, pero tal vez aquellos que tengan un poco m√°s de experiencia tambi√©n encuentren algo interesante.  Sin embargo, espero escribir un art√≠culo para que pueda leerse sin ser un programador de C #. <br></div></div><br><h2>  Conjunto de expresi√≥n </h2><br><h3>  ¬øQu√© es una expresi√≥n? </h3><br><div class="spoiler">  <b class="spoiler_title">Cuando era peque√±o ...</b> <div class="spoiler_text">  Entonces, por supuesto, quer√≠a escribir una calculadora.  ¬øQu√© deber√≠a ser capaz de hacer?  Cuatro operaciones b√°sicas, y en principio mucho m√°s.  Entonces, mi tarea era calcular el valor de una expresi√≥n de cadena, por ejemplo, "1 + (3/4 - (5 + 3 * 1))".  Tom√© mi delf√≠n favorito y escrib√≠ un analizador, que primero se puso entre par√©ntesis de forma recursiva y luego reemplaz√≥ la expresi√≥n entre par√©ntesis por un valor, y elimin√© los par√©ntesis.  B√°sicamente, una forma bastante funcional para m√≠ en ese momento. <br></div></div><br>  Por supuesto, esto no es una l√≠nea.  Es bastante obvio que una f√≥rmula matem√°tica es un √°rbol o una pila, y aqu√≠ nos detenemos en el primero.  Es decir, cada nodo, cada nodo de este √°rbol, es alg√∫n tipo de operaci√≥n, variable o constante. <br><br><img src="https://habrastorage.org/webt/ih/id/g2/ihidg2enlm7vi-es5t5agdoplks.png"><br><br>  Una operaci√≥n es una funci√≥n o un operador, en principio, aproximadamente lo mismo.  Sus hijos son los argumentos de una funci√≥n (operador). <br><br><h3>  Jerarqu√≠a de clases en su c√≥digo </h3><br>  Por supuesto, la implementaci√≥n puede ser cualquiera.  Sin embargo, la idea es que si su √°rbol consta solo de nodos y hojas, entonces son diferentes.  Por lo tanto, llamo a estas "cosas" - entidades.  Por lo tanto, la clase superior ser√° la clase abstracta Entidad. <br><br><div class="spoiler">  <b class="spoiler_title">Resumen?</b> <div class="spoiler_text">  Como todos saben por el aprendizaje b√°sico de idiomas, una clase abstracta es buena porque generaliza algunas clases, por un lado, y por otro lado, le permite separar la l√≥gica y el comportamiento de algunos objetos.  No se puede crear un objeto de una clase abstracta, pero s√≠ su heredero. <br></div></div><br>  Y tambi√©n habr√° cuatro clases sucesoras: NumberEntity, VariableEntity, OperatorEntity, FunctionEntity. <br><br><h3>  ¬øC√≥mo construir una expresi√≥n? </h3><br>  Primero, construiremos una expresi√≥n en el c√≥digo, es decir <br><br><pre><code class="plaintext hljs">var x = new VariableEntity("x"); var expr = x * x + 3 * x + 12;</code> </pre> <br>  Si declara una clase vac√≠a VariableEntity, dicho c√≥digo le arrojar√° un error, dicen que no sabe c√≥mo multiplicar y sumar. <br><br><h5>  Operadores primordiales </h5><br>  Una caracter√≠stica muy importante y √∫til de la mayor√≠a de los idiomas, que le permite personalizar la ejecuci√≥n de operaciones aritm√©ticas.  Se implementa sint√°cticamente de manera diferente seg√∫n el idioma.  Por ejemplo, una implementaci√≥n en C # <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> YourClass <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> +(YourClass a, YourClass b) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> YourClass(a.ToString() + b.ToString()); }</code> </pre><br>  <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/operators/operator-overloading" rel="nofollow">Obtenga m√°s informaci√≥n sobre c√≥mo anular declaraciones en C #</a> <br>  El nabo se implementa <a href="" rel="nofollow">aqu√≠</a> . <br><br><h5>  Fundici√≥n (no) expl√≠cita </h5><br>  En lenguajes compilados como C #, tal cosa suele estar presente y le permite convertir el tipo si es necesario sin llamar adicionalmente a myvar.ToAnotherType ().  Entonces, por ejemplo, ser√≠a conveniente escribir <br><br><pre> <code class="plaintext hljs">NumberEntity myvar = 3;</code> </pre><br>  En lugar de lo habitual <br><br><pre> <code class="plaintext hljs">NumberEntity myvar = new NumberEntity(3);</code> </pre><br>  <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/operators/user-defined-conversion-operators" rel="nofollow">M√°s informaci√≥n sobre la conversi√≥n de tipos en C #</a> <br>  El nabo se implementa en <a href="" rel="nofollow">esta</a> l√≠nea. <br><br><h5>  Colgando </h5><br>  La clase Entity tiene un campo Hijos; esta es solo una lista de Entity, que son los argumentos para esta entidad. <br><br><div class="spoiler">  <b class="spoiler_title">Pensamientos</b> <div class="spoiler_text">  De hecho, solo dos clases de objetos pueden tener hijos: OperatorEntity y FunctionEntity.  Es decir, en principio, podr√≠a crear alg√∫n tipo de NodeEntity y heredar estas dos clases de √©l, y crear un LeafEntity y heredar VariableEntity y NumberEntity de √©l. <br><img src="https://habrastorage.org/webt/ft/i6/kj/fti6kj3h23-tmsd8g30gyyqtyks.png"><br></div></div><br>  Cuando llamamos a una funci√≥n u operador, debemos crear una nueva entidad y poner en ella los elementos secundarios desde los que se llama la funci√≥n u operador.  Por ejemplo, la cantidad en teor√≠a deber√≠a verse as√≠: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Entity <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> +(Entity a, Entity b){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> res = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OperatorEntity(<span class="hljs-string"><span class="hljs-string">"+"</span></span>); res.Children.Add(a); res.Children.Add(b); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res; }</code> </pre><br>  Es decir, ahora si tenemos la entidad xy la entidad 3, entonces x + 3 devolver√° la esencia del operador de suma con dos hijos: 3 y x.  Entonces, podemos construir √°rboles de expresi√≥n. <br><br>  Una llamada de funci√≥n es m√°s simple y no tan bella como con un operador: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Entity </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sin</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Entity a</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> res = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FunctionEntity(<span class="hljs-string"><span class="hljs-string">"sin"</span></span>); res.Children.Add(a); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res; }</code> </pre><br>  Colgar en nabos se implementa <a href="" rel="nofollow">aqu√≠</a> . <br><br>  Ok, inventamos un √°rbol de expresi√≥n. <br><br><h2>  Sustituci√≥n variable </h2><br>  Aqu√≠ todo es extremadamente simple.  Tenemos Entidad: verificamos si es una variable en s√≠ misma; de ser as√≠, devolvemos el valor; de lo contrario, ejecutamos los elementos secundarios. <br><br>  <a href="" rel="nofollow">Este</a> enorme archivo de 48 l√≠neas implementa una funci√≥n tan compleja. <br><br><h2>  C√°lculo del valor </h2><br>  En realidad, por lo que todo esto es.  Aqu√≠ se supone que debemos agregar alg√∫n tipo de m√©todo a la entidad <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Entity </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Eval</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsLeaf) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MathFunctions.InvokeEval(Name, Children); }</code> </pre><br>  La hoja no ha cambiado, pero para todo lo dem√°s tenemos un c√°lculo personalizado.  Nuevamente, dar√© solo un ejemplo: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Entity </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Eval</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">List&lt;Entity&gt; args</span></span></span><span class="hljs-function">)</span></span> { MathFunctions.AssertArgs(args.Count, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r = args[<span class="hljs-number"><span class="hljs-number">0</span></span>].Eval(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (r <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> NumberEntity) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NumberEntity(Number.Sin((r <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> NumberEntity).Value)); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> r.Sin(); }</code> </pre><br>  Si el argumento es un n√∫mero, entonces produciremos una funci√≥n num√©rica, de lo contrario la devolveremos tal como estaba. <br><br><h3>  N√∫mero? </h3><br>  Esta es la unidad m√°s simple, el n√∫mero.  Se pueden realizar operaciones aritm√©ticas en √©l.  Por defecto, es complejo.  Tambi√©n tiene operaciones como Sin, Cos y algunas otras definidas. <br><br>  Si est√° interesado, el n√∫mero se describe <a href="" rel="nofollow">aqu√≠</a> . <br><br><h2>  Derivada </h2><br>  Cualquiera puede calcular la derivada num√©ricamente, y dicha funci√≥n se escribe verdaderamente en una l√≠nea: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Derivative</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Func&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; f, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x</span></span></span><span class="hljs-function">)</span></span> =&gt; (f(x + <span class="hljs-number"><span class="hljs-number">1.0e-5</span></span>) - f(x)) * <span class="hljs-number"><span class="hljs-number">1.0e+5</span></span>;</code> </pre><br>  Pero, por supuesto, queremos una derivada anal√≠tica.  Como ya tenemos un √°rbol de expresi√≥n, podemos reemplazar recursivamente cada nodo de acuerdo con la regla de diferenciaci√≥n.  Deber√≠a funcionar algo como esto: <br><br><img src="https://habrastorage.org/webt/6g/7t/6c/6g7t6ctcfoill4nroqcknz6gaa4.png"><br><br>  Aqu√≠, por ejemplo, c√≥mo se implementa la cantidad en mi c√≥digo: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Entity </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Derive</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">List&lt;Entity&gt; args, VariableEntity variable</span></span></span><span class="hljs-function">)</span></span> { MathFunctions.AssertArgs(args.Count, <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = args[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = args[<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.Derive(variable) + b.Derive(variable); }</code> </pre><br>  Pero el trabajo <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Entity </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Derive</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">List&lt;Entity&gt; args, VariableEntity variable</span></span></span><span class="hljs-function">)</span></span> { MathFunctions.AssertArgs(args.Count, <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = args[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = args[<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.Derive(variable) * b + b.Derive(variable) * a; }</code> </pre><br>  Y aqu√≠ hay una soluci√≥n en s√≠ misma: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Entity </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Derive</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">VariableEntity x</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsLeaf) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> VariableEntity &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Name == x.Name) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NumberEntity(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NumberEntity(<span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MathFunctions.InvokeDerive(Name, Children, x); }</code> </pre><br>  Este es el m√©todo de la entidad.  Y como vemos, la hoja tiene solo dos estados: o es una variable por la cual nos diferenciamos, luego su derivada es 1, o es una constante (n√∫mero o Entidad Variable), luego su derivada es 0, o un nodo, luego hay una referencia por nombre (InvokeDerive se refiere al diccionario de funciones, donde se encuentra el deseado (por ejemplo, la suma o el seno)). <br><br>  Tenga en cuenta que no dejo algo como dy / dx aqu√≠ y digo de inmediato que la derivada de la variable que <b>no</b> nos diferencia es 0. Pero aqu√≠ <a href="https://habr.com/ru/post/150043/">se</a> hace de manera diferente. <br><br>  Toda la diferenciaci√≥n se describe en <a href="" rel="nofollow">un archivo</a> , pero no es necesario m√°s. <br><br><h2>  Simplificaci√≥n de la expresi√≥n.  Patrones </h2><br>  La simplificaci√≥n de la expresi√≥n generalmente no es trivial en principio.  Bueno, por ejemplo, qu√© expresi√≥n es m√°s simple: <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.439ex" height="2.78ex" viewBox="0 -935.7 3202.9 1197.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-32" x="809" y="513"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-2212" x="1248" y="0"></use><g transform="translate(2249,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-79" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-32" x="706" y="513"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-1"> x ^ 2 - y ^ 2 </script>  o <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="14.27ex" height="2.66ex" viewBox="0 -832 6143.9 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-28" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-78" x="389" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-2212" x="1184" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-79" x="2184" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-29" x="2682" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-28" x="3071" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-78" x="3461" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-2B" x="4256" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-79" x="5256" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-29" x="5754" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-2"> (x - y) (x + y) </script>  ?  Pero nos adherimos a algunas ideas y, sobre la base de ellas, queremos hacer esas reglas que simplifiquen con precisi√≥n la expresi√≥n. <br><br>  Es posible escribir en cada Eval que si tenemos la suma, y ‚Äã‚Äãlos ni√±os son trabajos, entonces clasificaremos cuatro opciones, y si algo es igual en alguna parte, eliminaremos el factor ... Pero, por supuesto, no quiero hacer eso.  Por lo tanto, puede adivinar el sistema de reglas y patrones.  Entonces, ¬øqu√© queremos?  Algo as√≠ como esta sintaxis: <br><br><pre> <code class="plaintext hljs">{ any1 / (any2 / any3) -&gt; any1 * any3 / any2 }, { const1 * var1 + const2 * var1 -&gt; (const1 + const2) * var1 }, { any1 + any1 * any2 -&gt; any1 * (Num(1) + any2) },</code> </pre><br>  Aqu√≠ hay un ejemplo de un √°rbol en el que se encontr√≥ un sub√°rbol (marcado en verde) que coincide con el patr√≥n any1 + const1 * any1 (any1 encontrado est√° marcado en naranja). <br><br><img src="https://habrastorage.org/webt/fe/jp/-l/fejp-l9krgdtvhw8d-ccpcekuko.png"><br><br>  Como puede ver, a veces es importante para nosotros que la misma entidad deba repetirse, por ejemplo, para acortar la expresi√≥n x + a * x, necesitamos que x est√© all√≠ y all√≠, porque x + a * y ya no se reduce.  Por lo tanto, necesitamos hacer un algoritmo que no solo verifique que el √°rbol coincida con el patr√≥n, sino que tambi√©n <br><br><ol><li>  Verifique que el mismo patr√≥n de entidad coincida con la misma entidad. </li><li>  Escribir lo que corresponde a qu√©, luego sustituir. </li></ol><br>  El punto de entrada se parece a esto: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> Dictionary&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">, Entity&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EqFits</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Entity tree</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> res = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, Entity&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!tree.PatternMakeMatch(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, res)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res; }</code> </pre><br>  Y en tree.PaternMakeMatch, rellenamos recursivamente el diccionario con claves y sus valores.  Aqu√≠ hay un ejemplo de una lista de Entidades de patrones: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Pattern any1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pattern(<span class="hljs-number"><span class="hljs-number">100</span></span>, PatType.COMMON); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Pattern any2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pattern(<span class="hljs-number"><span class="hljs-number">101</span></span>, PatType.COMMON); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Pattern const1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pattern(<span class="hljs-number"><span class="hljs-number">200</span></span>, PatType.NUMBER); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Pattern const2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pattern(<span class="hljs-number"><span class="hljs-number">201</span></span>, PatType.NUMBER); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Pattern func1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pattern(<span class="hljs-number"><span class="hljs-number">400</span></span>, PatType.FUNCTION);</code> </pre><br>  Cuando escribimos any1 * const1 - func1 y as√≠ sucesivamente, cada nodo tendr√° un n√∫mero, esta es la clave.  En otras palabras, al completar el diccionario, estos n√∫meros aparecer√°n como claves: 100, 101, 200, 201, 400 ... Y al construir un √°rbol, veremos el valor correspondiente a la clave y lo sustituiremos. <br><br>  Implementado <a href="https://github.com/Angourisoft/MathS/tree/master/AngouriMath/Functions/Evaluation/Patterns" rel="nofollow">aqu√≠</a> . <br><br><h2>  Simplificacion  Clasificaci√≥n de √°rboles </h2><br>  En el <a href="https://habr.com/ru/post/150043/">art√≠culo</a> que ya he abordado, el autor decidi√≥ hacerlo de manera simple, y lo clasific√≥ pr√°cticamente por el hash del √°rbol.  Se las arregl√≥ para reducir a y -a, b + c + b para convertir 2b + c.  Pero, por supuesto, tambi√©n queremos que se reduzca (x + y) + x * y - 3 * x, y en general cosas m√°s complicadas. <br><br><h5>  ¬øLos patrones no funcionan? </h5><br>  En general, lo que hicimos antes, los patrones son una cosa monstruosamente maravillosa.  Le permitir√° reducir la diferencia entre los cuadrados y la suma del cuadrado del seno y el coseno, y otras cosas complejas.  Pero la palma elemental, ((((((x + 1) + 1) + 1) + 1), no se reducir√°, porque la regla principal aqu√≠ es la conmutatividad de los t√©rminos.  Por lo tanto, el primer paso es aislar a los "hijos lineales". <br><br><h5>  "Ni√±os lineales" </h5><br>  En realidad, para cada nodo de la suma o diferencia (y, por cierto, el producto / divisi√≥n), queremos obtener una lista de t√©rminos (factores). <br><br><img src="https://habrastorage.org/webt/-x/ku/yw/-xkuywdj1ovbr9rsam0lrhhcw0q.png"><br><br>  Esto es b√°sicamente sencillo.  Deje que la funci√≥n LinearChildren (Entity node) devuelva una lista, luego miramos al ni√±o en el nodo. Ni√±os: si el ni√±o no es una suma, entonces result.Add (child), de lo contrario result.AddRange (LinearChildren (child)). <br><br>  No es la forma m√°s bella implementada <a href="" rel="nofollow">aqu√≠</a> . <br><br><h5>  Agrupando ni√±os </h5><br>  Entonces tenemos una lista de ni√±os, pero ¬øqu√© sigue?  Supongamos que tenemos sin (x) + x + y + sin (x) + 2 * x.  Obviamente, nuestro algoritmo recibir√° cinco t√©rminos.  A continuaci√≥n, queremos agrupar por similitud, por ejemplo, x parece 2 * x m√°s que sin (x). <br><br>  Aqu√≠ hay una buena agrupaci√≥n: <br><br><img src="https://habrastorage.org/webt/s6/qz/eo/s6qzeoeqfech1ow5c8n_nciq9ek.png"><br><br>  Dado que los patrones en √©l har√°n frente a la conversi√≥n de 2 * x + x a 3 * x. <br><br>  Es decir, primero agrupamos por alg√∫n <i>hash</i> , y luego hacemos MultiHang - convirtiendo la sumatoria n-aria a binaria. <br><br><h5>  Hash de nodo </h5><br>  Por un lado <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.455ex" viewBox="0 -520.7 572.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-78" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-3"> x </script>  y <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.333ex" height="2.057ex" viewBox="0 -728.2 2295.9 885.9" role="img" focusable="false" style="vertical-align: -0.366ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-78" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-2B" x="794" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-31" x="1795" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-4"> x + 1 </script>  debe colocarse en un grupo.  Por otro lado, si est√° disponible <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.754ex" height="1.455ex" viewBox="0 -520.7 2046.9 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-61" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-2217" x="751" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-78" x="1474" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-5"> a * x </script>  poner en un grupo con <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.492ex" height="2.66ex" viewBox="0 -832 4517.4 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-79" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-2217" x="719" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-28" x="1442" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-78" x="1831" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-2B" x="2626" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-31" x="3627" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-29" x="4127" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-6"> y * (x + 1) </script>  sin sentido <br><br><div class="spoiler">  <b class="spoiler_title">Pensamientos</b> <div class="spoiler_text">  Si lo piensas, entonces <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="35.74ex" height="2.762ex" viewBox="0 -831.5 15388.2 1189" role="img" focusable="false" style="vertical-align: -0.83ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-61" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-2217" x="751" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-78" x="1474" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-2B" x="2269" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-79" x="3269" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-2217" x="3989" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-28" x="4712" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-78" x="5101" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-2B" x="5896" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-31" x="6897" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-29" x="7397" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-3D" x="8065" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-28" x="9121" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-61" x="9510" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-2B" x="10262" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-79" x="11263" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-29" x="11760" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-2217" x="12372" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-78" x="13095" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-2B" x="13889" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-79" x="14890" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-7"> a * x + y * (x + 1) = (a + y) * x + y </script>  .  Aunque me parece, esto pr√°cticamente no es m√°s f√°cil, y ciertamente no es necesario.  De todos modos, la simplificaci√≥n nunca es algo obvio, y ciertamente no es lo primero que se debe escribir al escribir una "calculadora". <br></div></div><br>  Por lo tanto, implementamos la ordenaci√≥n multinivel.  Primero, pretendemos que <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.333ex" height="2.057ex" viewBox="0 -728.2 2295.9 885.9" role="img" focusable="false" style="vertical-align: -0.366ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-78" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-2B" x="794" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-31" x="1795" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-8"> x + 1 </script>  - Lo mismo.  Ordenado, calmado.  Entonces pretendemos que <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.333ex" height="2.057ex" viewBox="0 -728.2 2295.9 885.9" role="img" focusable="false" style="vertical-align: -0.366ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-78" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-2B" x="794" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-31" x="1795" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-9"> x + 1 </script>  solo se puede colocar con otros <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.333ex" height="2.057ex" viewBox="0 -728.2 2295.9 885.9" role="img" focusable="false" style="vertical-align: -0.366ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-78" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-2B" x="794" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-31" x="1795" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-10"> x + 1 </script>  .  Y ahora nuestro <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.566ex" height="2.66ex" viewBox="0 -832 4549.4 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-61" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-2217" x="751" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-28" x="1474" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-78" x="1863" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-2B" x="2658" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-31" x="3659" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-29" x="4159" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-11"> a * (x + 1) </script>  y <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.492ex" height="2.66ex" viewBox="0 -832 4517.4 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-79" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-2217" x="719" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-28" x="1442" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-78" x="1831" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-2B" x="2626" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-31" x="3627" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-29" x="4127" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-12"> y * (x + 1) </script>  finalmente se uni√≥.  Implementado simplemente: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hash</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SortLevel level</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> FunctionEntity) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Name + <span class="hljs-string"><span class="hljs-string">"_"</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Join(<span class="hljs-string"><span class="hljs-string">"_"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> child <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Children <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> child.Hash(level)); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> NumberEntity) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> level == SortLevel.HIGH_LEVEL ? <span class="hljs-string"><span class="hljs-string">""</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Name + <span class="hljs-string"><span class="hljs-string">" "</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> VariableEntity) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"v_"</span></span> + Name; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (level == SortLevel.LOW_LEVEL ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Name + <span class="hljs-string"><span class="hljs-string">"_"</span></span> : <span class="hljs-string"><span class="hljs-string">""</span></span>) + <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Join(<span class="hljs-string"><span class="hljs-string">"_"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> child <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Children <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> child.Hash(level) != <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> child.Hash(level)); }</code> </pre><br>  Como puede ver, la funci√≥n afecta la clasificaci√≥n de cualquier manera (por supuesto, porque <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.418ex" height="2.66ex" viewBox="0 -832 1902 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-66" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-28" x="550" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-78" x="940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMAIN-29" x="1512" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-13"> f (x) </script>  con <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.455ex" viewBox="0 -520.7 572.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-78" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-14"> x </script>  generalmente no conectado en el caso general).  Como una variable, <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.455ex" viewBox="0 -520.7 572.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-78" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-15"> x </script>  con <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.155ex" height="1.817ex" viewBox="0 -520.7 497.5 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/482228/&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhhEbG4I9Bc4yKDUqSlt1VXa5ZxJgw#MJMATHI-79" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-16"> y </script>  Bueno, no se va a mezclar.  Pero las constantes y los operadores no se tienen en cuenta en todos los niveles.  En este orden, el proceso de simplificaci√≥n en s√≠ mismo <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Entity </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Simplify</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//      :   ,   ,     . . var stage1 = this.InnerSimplify(); Entity res = stage1; for (int i = 0; i &lt; level; i++) { //     .    -  x  x+1 (  ),  -  x-1  x+1 (,   ),  -  x+1  x+1 ( ). switch (i) { case 0: res = res.Sort(SortLevel.HIGH_LEVEL); break; case 2: res = res.Sort(SortLevel.MIDDLE_LEVEL); break; case 4: res = res.Sort(SortLevel.LOW_LEVEL); break; } //    . res = TreeAnalyzer.Replace(Patterns.CommonRules, res).InnerSimplify(); } return res; }</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Pensamientos</b> <div class="spoiler_text">  ¬øEs esta la mejor implementaci√≥n?  Introduzca mensajes privados, tal vez habr√° mejores ideas.  Pens√© durante mucho tiempo c√≥mo hacerlo de la mejor manera posible, aunque en mi opini√≥n, est√° lejos de ser "hermoso". <br></div></div><br>  Ordeno el √°rbol <a href="" rel="nofollow">aqu√≠</a> . <br><br><h2>  "Compilaci√≥n" de funciones </h2><br>  Entre comillas, ya que no est√° en el c√≥digo IL en s√≠, sino solo en un conjunto muy r√°pido de instrucciones.  Pero es muy simple. <br><br><h5>  Problema sustituto </h5><br>  Para calcular el valor de una funci√≥n, solo necesitamos llamar a la sustituci√≥n de variables y evaluar, por ejemplo <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = MathS.Var(<span class="hljs-string"><span class="hljs-string">"x"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> expr = x * x + <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = expr.Substitute(x, <span class="hljs-number"><span class="hljs-number">5</span></span>).Eval();</code> </pre><br>  Pero funciona lentamente, aproximadamente 1,5 microsegundos por seno. <br><br><h5>  Instrucciones </h5><br>  Para acelerar el c√°lculo, hacemos un c√°lculo de funci√≥n en la pila, a saber: <br><br>  1) Creamos la clase FastExpression, que tendr√° una lista de instrucciones <br><br>  2) Al compilar, las instrucciones se apilan en el orden inverso, es decir, si hay una funci√≥n x * x + sin (x) + 3, las instrucciones ser√°n algo como esto: <br><br><pre> <code class="plaintext hljs">PUSHVAR 0 //    0 - x CALL 6 //    6 -  PUSHCONST 3 CALL 0 //    0 -  PUSHVAR 0 PUSHVAR 0 CALL 2 CALL 0</code> </pre><br>  Luego, cuando se nos llama, ejecutamos estas instrucciones y devolvemos el N√∫mero. <br><br>  Un ejemplo de ejecuci√≥n de una declaraci√≥n de suma: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sumf</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Stack&lt;Number&gt; stack</span></span></span><span class="hljs-function">)</span></span> { Number n1 = stack.Pop(); Number n2 = stack.Pop(); stack.Push(n1 + n2); }</code> </pre><br>  La llamada sinusoidal se redujo de 1500ns a 60ns (el sistema Complex.Sin funciona durante 30ns). <br>  El nabo se implementa <a href="https://github.com/Angourisoft/MathS/tree/master/AngouriMath/Functions/Evaluation/Compilation" rel="nofollow">aqu√≠</a> . <br><br>  Fuh, todo parece ser por ahora.  Aunque todav√≠a hay algo que contar, pero me parece que el volumen de un art√≠culo es suficiente.  ¬øAlguien est√° interesado en la secuela?  A saber: analizar desde una cadena, formatear en l√°tex, cierta integral y otras cosas. <br><br>  <a href="https://github.com/Angourisoft/MathS" rel="nofollow">Enlace al repositorio</a> con todo el c√≥digo, as√≠ como pruebas y muestras. <br><br><div class="spoiler">  <b class="spoiler_title">Pensamientos</b> <div class="spoiler_text">  En realidad, sigo trabajando en este proyecto.  Se distribuye bajo MIT (es decir, haga lo que quiera con √©l), y nunca ser√° cerrado ni comercial.  Adem√°s, si hay ideas para mejorar y contribuir, las solicitudes de extracci√≥n son muy bienvenidas. <br></div></div><br>  Gracias por su atencion! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/482228/">https://habr.com/ru/post/482228/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../482218/index.html">Java Digest para el 27 de diciembre</a></li>
<li><a href="../482220/index.html">Localizaci√≥n de marcador de Aruco</a></li>
<li><a href="../482222/index.html">Aplicaci√≥n web en Kotlin + Spring Boot + Vue.js (complemento)</a></li>
<li><a href="../482224/index.html">Cuando un dise√±ador necesita ser un peque√±o programador</a></li>
<li><a href="../482226/index.html">Las 20 mejores aplicaciones que un proveedor de atenci√≥n m√©dica no puede perderse</a></li>
<li><a href="../482230/index.html">La batalla de los servidores WEB. Parte 2: escenario realista de HTTPS:</a></li>
<li><a href="../482232/index.html">StackOverflow es m√°s que un simple dep√≥sito de respuestas a preguntas est√∫pidas</a></li>
<li><a href="../482234/index.html">Modelado digital a anal√≥gico y mixto en PADS Professional</a></li>
<li><a href="../482240/index.html">Desmontamos los primeros dispositivos TP-Link con Wi-Fi 6: enrutador Archer AX6000 y adaptador Archer TX3000E</a></li>
<li><a href="../482244/index.html">Resultados de la prueba de c√°mara oculta: iPhone, Pixel, Huawei, Samsung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>