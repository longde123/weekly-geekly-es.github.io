<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÜé ü§úüèø üßöüèæ Python Code Life Cycle - Modelo de tiempo de ejecuci√≥n de CPython üë©üèæ‚Äçüéì üç† üïØÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos! Ha llegado la primavera, lo que significa que queda menos de un mes antes del inicio del curso Python Developer . Es a este curso que se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Python Code Life Cycle - Modelo de tiempo de ejecuci√≥n de CPython</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/442252/">  Hola a todos!  Ha llegado la primavera, lo que significa que queda menos de un mes antes del inicio del curso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Python Developer</a> .  Es a este curso que se dedicar√° nuestra publicaci√≥n de hoy. <br><br><img src="https://habrastorage.org/webt/8-/3n/pk/8-3npkdv_2mpp742_k0zytidc_k.png"><br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/9g/fe/cn/9gfecnorojbyoxcczknx1pyf--g.png"><br><br>  <i><b>Tareas</b></i> <br><br>  - Aprende sobre la estructura interna de Python; <br>  - Comprender los principios de la construcci√≥n de un √°rbol de sintaxis abstracta (AST); <br>  - Escribir c√≥digo m√°s eficiente en tiempo y memoria. <br><br>  <i><b>Recomendaciones preliminares:</b></i> <br><br>  - Comprensi√≥n b√°sica del int√©rprete (AST, tokens, etc.). <br>  - Conocimiento de Python. <br>  - Conocimientos b√°sicos de C. <br><br><pre><code class="python hljs">batuhan@arch-pc ÓÇ∞ ~/blogs/cpython/exec_model ÓÇ∞ python --version Python <span class="hljs-number"><span class="hljs-number">3.7</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span></code> </pre> <br>  <b>Modelo de ejecuci√≥n de CPython</b> <br><br>  Python es un lenguaje compilado e interpretado.  Por lo tanto, el compilador de Python genera bytecodes y el int√©rprete los ejecuta.  Durante el art√≠culo consideraremos los siguientes problemas: <br><br><ul><li>  An√°lisis y tokenizaci√≥n: </li><li>  Transformaci√≥n en AST; </li><li>  Gr√°fico de flujo de control (CFG); </li><li>  Bytecode </li><li>  Ejecutando en una m√°quina virtual CPython. </li></ul><br>  <b>An√°lisis y tokenizaci√≥n.</b> <b><br></b>  <b>Gram√°tica</b> <br><br>  La gram√°tica define la sem√°ntica del lenguaje Python.  Tambi√©n es √∫til para indicar la forma en que el analizador debe interpretar el idioma.  La gram√°tica de Python usa una sintaxis similar a la forma extendida de Backus-Naur.  Tiene su propia gram√°tica para un traductor del idioma de origen.  Puede encontrar el archivo de gram√°tica en el directorio "cpython / Grammar / Grammar". <br><br>  El siguiente es un ejemplo de una gram√°tica, <br><br><pre> <code class="python hljs">batuhan@arch-pc ÓÇ∞ ~/cpython/Grammar ÓÇ∞ ÓÇ† master ÓÇ∞ grep <span class="hljs-string"><span class="hljs-string">"simple_stmt"</span></span> Grammar | head -n3 | tail -n1 simple_stmt: small_stmt (<span class="hljs-string"><span class="hljs-string">';'</span></span> small_stmt)* [<span class="hljs-string"><span class="hljs-string">';'</span></span>] NEWLINE</code> </pre> <br>  Las expresiones simples contienen peque√±as expresiones y corchetes, y el comando termina con una nueva l√≠nea.  Las expresiones peque√±as parecen una lista de expresiones que importan ... <br>  Algunas otras expresiones :) <br><br><pre> <code class="python hljs">small_stmt: (expr_stmt | del_stmt | pass_stmt | flow_stmt | import_stmt | global_stmt | nonlocal_stmt | assert_stmt) ... del_stmt: <span class="hljs-string"><span class="hljs-string">'del'</span></span> exprlist pass_stmt: <span class="hljs-string"><span class="hljs-string">'pass'</span></span> flow_stmt: break_stmt | continue_stmt | return_stmt | raise_stmt | yield_stmt break_stmt: <span class="hljs-string"><span class="hljs-string">'break'</span></span> continue_stmt: <span class="hljs-string"><span class="hljs-string">'continue'</span></span></code> </pre> <br>  <b>Tokenizaci√≥n (Lexing)</b> <br><br>  La tokenizaci√≥n es el proceso de obtener un flujo de datos de texto y dividirlo en tokens de palabras significativas (para el int√©rprete) con metadatos adicionales (por ejemplo, d√≥nde comienza y termina el token y cu√°l es el valor de cadena de este token). <br><br>  <b>Fichas</b> <br><br>  Un token es un archivo de encabezado que contiene definiciones de todos los tokens.  Hay 59 tipos de tokens en Python (Incluir / token.h). <br><br>  A continuaci√≥n se muestra un ejemplo de algunos de ellos, <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#define NAME 1 #define NUMBER 2 #define STRING 3 #define NEWLINE 4 #define INDENT 5 #define DEDENT 6</span></span></code> </pre> <br>  Los ves si divides alg√∫n c√≥digo de Python en tokens. <br><br>  <b>Tokenizaci√≥n con CLI</b> <br><br>  Aqu√≠ est√° el archivo tests.py <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">greetings</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name: str)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">f"Hello </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{name}</span></span></span><span class="hljs-string">"</span></span>) greetings(<span class="hljs-string"><span class="hljs-string">"Batuhan"</span></span>)</code> </pre> <br>  Luego lo tokenizamos utilizando el comando python -m tokenize y se genera lo siguiente: <br><br><pre> <code class="python hljs">batuhan@arch-pc ÓÇ∞ ~/blogs/cpython/exec_model ÓÇ∞ python -m tokenize tests.py <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>: ENCODING <span class="hljs-string"><span class="hljs-string">'utf-8'</span></span> ... <span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>: INDENT <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>,<span class="hljs-number"><span class="hljs-number">9</span></span>: NAME <span class="hljs-string"><span class="hljs-string">'print'</span></span> ... <span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-4</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>: DEDENT <span class="hljs-string"><span class="hljs-string">''</span></span> ... <span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-5</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>: ENDMARKER <span class="hljs-string"><span class="hljs-string">''</span></span></code> </pre><br>  Aqu√≠ los n√∫meros (por ejemplo, 1.4-1.13) muestran d√≥nde comenz√≥ el token y d√≥nde termin√≥.  Un token de codificaci√≥n es siempre el primer token que recibimos.  Proporciona informaci√≥n sobre la codificaci√≥n del archivo fuente y, si hay alg√∫n problema, el int√©rprete lanza una excepci√≥n. <br><br>  <b>Tokenizaci√≥n con <i>tokenize.tokenize</i></b> <br><br>  Si necesita tokenizar el archivo desde su c√≥digo, puede usar el m√≥dulo <i><b>tokenize</b></i> de <i>stdlib</i> . <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'tests.py'</span></span>, <span class="hljs-string"><span class="hljs-string">'rb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: ... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> token <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tokenize.tokenize(f.readline): ... print(token) ... TokenInfo(type=<span class="hljs-number"><span class="hljs-number">57</span></span> (ENCODING), string=<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>, start=(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), end=(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), line=<span class="hljs-string"><span class="hljs-string">''</span></span>) ... TokenInfo(type=<span class="hljs-number"><span class="hljs-number">1</span></span> (NAME), string=<span class="hljs-string"><span class="hljs-string">'greetings'</span></span>, start=(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>), end=(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>), line=<span class="hljs-string"><span class="hljs-string">'def greetings(name: str):\n'</span></span>) ... TokenInfo(type=<span class="hljs-number"><span class="hljs-number">53</span></span> (OP), string=<span class="hljs-string"><span class="hljs-string">':'</span></span>, start=(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">24</span></span>), end=(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">25</span></span>), line=<span class="hljs-string"><span class="hljs-string">'def greetings(name: str):\n'</span></span>) ...</code> </pre> <br>  El tipo de token es su id en el archivo de encabezado <i>token.h.</i>  La cadena es el valor del token.  Inicio y Fin muestran d√≥nde comienza y termina el token, respectivamente. <br><br>  En otros idiomas, los bloques se indican entre par√©ntesis o declaraciones de inicio / fin, pero Python usa sangr√≠as y diferentes niveles.  Fichas INDENT y DEDENT e indican sangr√≠a.  Estos tokens son necesarios para construir √°rboles de an√°lisis relacional y / o √°rboles de sintaxis abstracta. <br><br>  <b>Generaci√≥n de analizador</b> <br><br>  Generaci√≥n de analizador: un proceso que genera un analizador de acuerdo con una gram√°tica dada.  Los generadores de analizadores se conocen como PGen.  Cpython tiene dos generadores de analizadores.  Uno es el original ( <code>Parser/pgen</code> ) y el otro se reescribe en python ( <code>/Lib/lib2to3/pgen2</code> ). <br><br>  <i>"El generador original fue el primer c√≥digo que escrib√≠ para Python"</i> <i><br></i>  <i>-Guido</i> <br><br>  De la cita anterior, queda claro que <i>pgen</i> es lo m√°s importante en un lenguaje de programaci√≥n.  Cuando llama a pgen (en <i>Parser / pgen</i> ) genera un archivo de encabezado y un archivo C (el analizador en s√≠).  Si observa el c√≥digo C generado, puede parecer in√∫til, ya que su apariencia significativa es opcional.  Contiene muchos datos est√°ticos y estructuras.  A continuaci√≥n, trataremos de explicar sus componentes principales. <br><br>  <b>DFA (m√°quina de estado definida)</b> <br><br>  El analizador define un DFA para cada no terminal.  Cada DFA se define como una matriz de estados. <br><br><pre> <code class="bash hljs">static dfa dfas[87] = { {256, <span class="hljs-string"><span class="hljs-string">"single_input"</span></span>, 0, 3, states_0, <span class="hljs-string"><span class="hljs-string">"\004\050\340\000\002\000\000\000\012\076\011\007\262\004\020\002\000\300\220\050\037\202\000"</span></span>}, ... {342, <span class="hljs-string"><span class="hljs-string">"yield_arg"</span></span>, 0, 3, states_86, <span class="hljs-string"><span class="hljs-string">"\000\040\200\000\002\000\000\000\000\040\010\000\000\000\020\002\000\300\220\050\037\000\000"</span></span>}, };</code> </pre> <br>  Para cada DFA, hay un kit de inicio que muestra con qu√© fichas puede comenzar un no terminal especial. <br><br>  <b>Condici√≥n</b> <br><br>  Cada estado est√° definido por una matriz de transiciones / aristas (arcos). <br><br><pre> <code class="python hljs">static state states_86[<span class="hljs-number"><span class="hljs-number">3</span></span>] = { {<span class="hljs-number"><span class="hljs-number">2</span></span>, arcs_86_0}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, arcs_86_1}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, arcs_86_2}, };</code> </pre> <br>  <b>Transiciones (arcos)</b> <br><br>  Cada matriz de transici√≥n tiene dos n√∫meros.  El primer n√∫mero es el nombre de la transici√≥n (etiqueta de arco), se refiere al n√∫mero de s√≠mbolo.  El segundo n√∫mero es el destino. <br><br><pre> <code class="python hljs">static arc arcs_86_0[<span class="hljs-number"><span class="hljs-number">2</span></span>] = { {<span class="hljs-number"><span class="hljs-number">77</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">47</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, }; static arc arcs_86_1[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">26</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, }; static arc arcs_86_2[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, };</code> </pre><br>  <b>Nombres (etiquetas)</b> <br><br>  Esta es una tabla especial que asigna la identificaci√≥n del personaje al nombre de la transici√≥n. <br><br><pre> <code class="python hljs">static label labels[<span class="hljs-number"><span class="hljs-number">177</span></span>] = { {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"EMPTY"</span></span>}, {<span class="hljs-number"><span class="hljs-number">256</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, ... {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"async"</span></span>}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"def"</span></span>}, ... {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"yield"</span></span>}, {<span class="hljs-number"><span class="hljs-number">342</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, };</code> </pre> <br>  El n√∫mero 1 corresponde a todos los identificadores.  Por lo tanto, cada uno de ellos obtiene diferentes nombres de transici√≥n, incluso si todos tienen la misma identificaci√≥n de personaje. <br><br>  <i><b>Un simple ejemplo:</b></i> <br><br>  Supongamos que tenemos un c√≥digo que genera "Hola" si 1 - verdadero: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: print(<span class="hljs-string"><span class="hljs-string">'Hi'</span></span>)</code> </pre> <br>  El analizador considera este c√≥digo como entrada √∫nica. <br><br><pre> <code class="python hljs">single_input: NEWLINE | simple_stmt | compound_stmt NEWLINE</code> </pre> <br>  Entonces nuestro √°rbol de an√°lisis comienza en el nodo ra√≠z de una entrada √∫nica. <br><br><img src="https://habrastorage.org/webt/xm/nl/r2/xmnlr287d0_vdkigdsqvtvpwhmi.png"><br><br>  Y el valor de nuestro DFA (single_input) es 0. <br><br><pre> <code class="python hljs">static dfa dfas[<span class="hljs-number"><span class="hljs-number">87</span></span>] = { {<span class="hljs-number"><span class="hljs-number">256</span></span>, <span class="hljs-string"><span class="hljs-string">"single_input"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, states_0, <span class="hljs-string"><span class="hljs-string">"\004\050\340\000\002\000\000\000\012\076\011\007\262\004\020\002\000\300\220\050\037\202\000"</span></span>} ... }</code> </pre><br>  Se ver√° as√≠: <br><br><pre> <code class="python hljs">static arc arcs_0_0[<span class="hljs-number"><span class="hljs-number">3</span></span>] = { {<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, }; static arc arcs_0_1[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, }; static arc arcs_0_2[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, }; static state states_0[<span class="hljs-number"><span class="hljs-number">3</span></span>] = { {<span class="hljs-number"><span class="hljs-number">3</span></span>, arcs_0_0}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, arcs_0_1}, {<span class="hljs-number"><span class="hljs-number">1</span></span>,</code> </pre>  arcs_0_2}, <br>  }; <br><br>  Aqu√≠ <code>arc_0_0</code> consta de tres elementos.  El primero es <code>NEWLINE</code> , el segundo es <code>simple_stmt</code> y el √∫ltimo es <code>compound_stmt</code> . <br><br>  Dado el conjunto inicial de <code>simple_stmt</code> podemos concluir que <code>simple_stmt</code> no puede comenzar con <code>if</code> .  Sin embargo, incluso si no es una nueva l√≠nea, <code>compound_stmt</code> a√∫n puede comenzar con <code>if</code> .  Por lo tanto, pasamos del √∫ltimo <code>arc ({4;2})</code> y agregamos el nodo <code>compound_stmt</code> al √°rbol de an√°lisis y antes de pasar al n√∫mero 2, cambiamos al nuevo DFA.  Obtenemos un √°rbol de an√°lisis actualizado: <br><br><img src="https://habrastorage.org/webt/fv/lc/ac/fvlcacpcaci0gacypn7mwu7ldkm.png"><br><br>  El nuevo DFA analiza las declaraciones compuestas. <br><br><pre> <code class="python hljs">compound_stmt: if_stmt | while_stmt | for_stmt | try_stmt | with_stmt | funcdef | classdef | decorated | async_stmt</code> </pre> <br>  Y obtenemos lo siguiente: <br><br><pre> <code class="python hljs">static arc arcs_39_0[<span class="hljs-number"><span class="hljs-number">9</span></span>] = { {<span class="hljs-number"><span class="hljs-number">91</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">92</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">93</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">94</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">95</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">18</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">96</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, }; static arc arcs_39_1[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, }; static state states_39[<span class="hljs-number"><span class="hljs-number">2</span></span>] = { {<span class="hljs-number"><span class="hljs-number">9</span></span>, arcs_39_0}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, arcs_39_1}, };</code> </pre><br>  Solo el primer salto puede comenzar con <code>if</code> .  Obtenemos un √°rbol de an√°lisis actualizado. <br><br><img src="https://habrastorage.org/webt/kh/q2/ru/khq2rutapnl3op6estdsfaznvwo.png"><br><br>  Luego cambiamos nuevamente el DFA y los siguientes ifs de DFA. <br><br><pre> <code class="python hljs">if_stmt: <span class="hljs-string"><span class="hljs-string">'if'</span></span> test <span class="hljs-string"><span class="hljs-string">':'</span></span> suite (<span class="hljs-string"><span class="hljs-string">'elif'</span></span> test <span class="hljs-string"><span class="hljs-string">':'</span></span> suite)* [<span class="hljs-string"><span class="hljs-string">'else'</span></span> <span class="hljs-string"><span class="hljs-string">':'</span></span> suite]</code> </pre> <br>  Como resultado, obtenemos la √∫nica transici√≥n con la designaci√≥n 97. Coincide con el token <code>if</code> . <br><br><pre> <code class="python hljs">static arc arcs_41_0[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">97</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, }; static arc arcs_41_1[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">26</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, }; static arc arcs_41_2[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">27</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>}, }; static arc arcs_41_3[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>}, }; static arc arcs_41_4[<span class="hljs-number"><span class="hljs-number">3</span></span>] = { {<span class="hljs-number"><span class="hljs-number">98</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">99</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>}, }; static arc arcs_41_5[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">27</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>}, }; static arc arcs_41_6[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>}, }; ...</code> </pre> <br>  Cuando cambiamos al siguiente estado, que permanece en el mismo DFA, el siguiente arcs_41_1 tambi√©n tiene solo una transici√≥n.  Esto es cierto para el terminal de prueba.  Debe comenzar con un n√∫mero (por ejemplo, 1). <br><br><img src="https://habrastorage.org/webt/f9/my/mh/f9mymh7fay4vovofermpmyfxegi.png"><br><br>  Solo hay una transici√≥n en arc_41_2 que obtiene el token de dos puntos (:). <br><br><img src="https://habrastorage.org/webt/-f/qf/gn/-fqfgnvebdfvjez63wlbowzihdm.png"><br><br>  Entonces obtenemos un conjunto que puede comenzar con un valor de impresi√≥n.  Finalmente, ve a arcs_41_4.  La primera transici√≥n en el conjunto es una expresi√≥n elif, la segunda es otra cosa y la tercera es para el √∫ltimo estado.  Y obtenemos la vista final del √°rbol de an√°lisis. <br><br><img src="https://habrastorage.org/webt/oj/_l/ye/oj_lyeqesfzsqv_iohr2yiunnqq.png"><br><br>  <b>Interfaz de Python para analizador.</b> <b><br></b> <br><br>  Python le permite editar el √°rbol de an√°lisis para expresiones usando un m√≥dulo llamado analizador. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> parser &gt;&gt;&gt; code = <span class="hljs-string"><span class="hljs-string">"if 1: print('Hi')"</span></span></code> </pre> <br>  Puede generar un √°rbol de sintaxis espec√≠fico (√Årbol de sintaxis concreta, CST) usando parser.suite. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>parser.suite(code).tolist() [<span class="hljs-number"><span class="hljs-number">257</span></span>, [<span class="hljs-number"><span class="hljs-number">269</span></span>, [<span class="hljs-number"><span class="hljs-number">295</span></span>, [<span class="hljs-number"><span class="hljs-number">297</span></span>, [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'if'</span></span>], [<span class="hljs-number"><span class="hljs-number">305</span></span>, [<span class="hljs-number"><span class="hljs-number">309</span></span>, [<span class="hljs-number"><span class="hljs-number">310</span></span>, [<span class="hljs-number"><span class="hljs-number">311</span></span>, [<span class="hljs-number"><span class="hljs-number">312</span></span>, [<span class="hljs-number"><span class="hljs-number">315</span></span>, [<span class="hljs-number"><span class="hljs-number">316</span></span>, [<span class="hljs-number"><span class="hljs-number">317</span></span>, [<span class="hljs-number"><span class="hljs-number">318</span></span>, [<span class="hljs-number"><span class="hljs-number">319</span></span>, [<span class="hljs-number"><span class="hljs-number">320</span></span>, [<span class="hljs-number"><span class="hljs-number">321</span></span>, [<span class="hljs-number"><span class="hljs-number">322</span></span>, [<span class="hljs-number"><span class="hljs-number">323</span></span>, [<span class="hljs-number"><span class="hljs-number">324</span></span>, [<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>]]]]]]]]]]]]]]]], [<span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-string"><span class="hljs-string">':'</span></span>], [<span class="hljs-number"><span class="hljs-number">304</span></span>, [<span class="hljs-number"><span class="hljs-number">270</span></span>, [<span class="hljs-number"><span class="hljs-number">271</span></span>, [<span class="hljs-number"><span class="hljs-number">272</span></span>, [<span class="hljs-number"><span class="hljs-number">274</span></span>, [<span class="hljs-number"><span class="hljs-number">305</span></span>, [<span class="hljs-number"><span class="hljs-number">309</span></span>, [<span class="hljs-number"><span class="hljs-number">310</span></span>, [<span class="hljs-number"><span class="hljs-number">311</span></span>, [<span class="hljs-number"><span class="hljs-number">312</span></span>, [<span class="hljs-number"><span class="hljs-number">315</span></span>, [<span class="hljs-number"><span class="hljs-number">316</span></span>, [<span class="hljs-number"><span class="hljs-number">317</span></span>, [<span class="hljs-number"><span class="hljs-number">318</span></span>, [<span class="hljs-number"><span class="hljs-number">319</span></span>, [<span class="hljs-number"><span class="hljs-number">320</span></span>, [<span class="hljs-number"><span class="hljs-number">321</span></span>, [<span class="hljs-number"><span class="hljs-number">322</span></span>, [<span class="hljs-number"><span class="hljs-number">323</span></span>, [<span class="hljs-number"><span class="hljs-number">324</span></span>, [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'print'</span></span>]], [<span class="hljs-number"><span class="hljs-number">326</span></span>, [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">'('</span></span>], [<span class="hljs-number"><span class="hljs-number">334</span></span>, [<span class="hljs-number"><span class="hljs-number">335</span></span>, [<span class="hljs-number"><span class="hljs-number">305</span></span>, [<span class="hljs-number"><span class="hljs-number">309</span></span>, [<span class="hljs-number"><span class="hljs-number">310</span></span>, [<span class="hljs-number"><span class="hljs-number">311</span></span>, [<span class="hljs-number"><span class="hljs-number">312</span></span>, [<span class="hljs-number"><span class="hljs-number">315</span></span>, [<span class="hljs-number"><span class="hljs-number">316</span></span>, [<span class="hljs-number"><span class="hljs-number">317</span></span>, [<span class="hljs-number"><span class="hljs-number">318</span></span>, [<span class="hljs-number"><span class="hljs-number">319</span></span>, [<span class="hljs-number"><span class="hljs-number">320</span></span>, [<span class="hljs-number"><span class="hljs-number">321</span></span>, [<span class="hljs-number"><span class="hljs-number">322</span></span>, [<span class="hljs-number"><span class="hljs-number">323</span></span>, [<span class="hljs-number"><span class="hljs-number">324</span></span>, [<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"'Hi'"</span></span>]]]]]]]]]]]]]]]]]], [<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">')'</span></span>]]]]]]]]]]]]]]]]]]], [<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>]]]]]], [<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>], [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>]]</code> </pre> <br>  El valor de salida ser√° una lista anidada.  Cada lista en la estructura tiene 2 elementos.  El primero es el id del personaje (0-256 - terminales, 256+ - no terminales) y el segundo es la cadena de tokens para el terminal. <br><br>  <b>√Årbol de sintaxis abstracta</b> <br><br>  De hecho, un √°rbol de sintaxis abstracta (AST) es una representaci√≥n estructural del c√≥digo fuente en forma de √°rbol, donde cada v√©rtice denota diferentes tipos de construcciones de lenguaje (expresi√≥n, variable, operador, etc.) <br><br>  <b>¬øQu√© es un √°rbol?</b> <br><br>  Un √°rbol es una estructura de datos que tiene un v√©rtice ra√≠z como punto de partida.  El v√©rtice ra√≠z se baja por ramas (transiciones) hacia otros v√©rtices.  Cada v√©rtice, excepto la ra√≠z, tiene un v√©rtice padre √∫nico. <br><br>  Hay una cierta diferencia entre el √°rbol de sintaxis abstracta y el √°rbol de an√°lisis. <br><br><img src="https://habrastorage.org/webt/2o/ws/eb/2owsebsx9fqewbfmyxexaid5hm8.png"><br><br>  A la derecha hay un √°rbol de an√°lisis para la expresi√≥n 2 * 7 + 3.  Esta es literalmente una imagen de fuente uno a uno en forma de √°rbol.  Todas las expresiones, t√©rminos y valores son visibles en √©l.  Sin embargo, dicha imagen es demasiado complicada para una simple pieza de c√≥digo, por lo que simplemente podemos eliminar todas las expresiones sint√°cticas que tuvimos que definir en el c√≥digo para los c√°lculos. <br><br>  Tal √°rbol simplificado se llama √°rbol de sintaxis abstracta (AST).  A la izquierda en la figura se muestra exactamente para el mismo c√≥digo.  Todas las expresiones de sintaxis se han descartado para facilitar la comprensi√≥n, pero recuerde que se ha perdido cierta informaci√≥n. <br><br>  <b>Ejemplo</b> <b><br></b> <br>  Python ofrece un m√≥dulo AST incorporado para trabajar con AST.  Para generar c√≥digo a partir de √°rboles AST, puede usar m√≥dulos de terceros, por ejemplo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Astor</a> . <br><br>  Por ejemplo, considere el mismo c√≥digo que antes. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ast &gt;&gt;&gt; code = <span class="hljs-string"><span class="hljs-string">"if 1: print('Hi')"</span></span></code> </pre> <br>  Para obtener AST, utilizamos el m√©todo ast.parse. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>tree = ast.parse(code) &gt;&gt;&gt; tree &lt;_ast.Module object at <span class="hljs-number"><span class="hljs-number">0x7f37651d76d8</span></span>&gt;</code> </pre> <br>  Intente usar el m√©todo <code>ast.dump</code> para obtener un √°rbol de sintaxis abstracta m√°s legible. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>ast.dump(tree) <span class="hljs-string"><span class="hljs-string">"Module(body=[If(test=Num(n=1), body=[Expr(value=Call(func=Name(id='print', ctx=Load()), args=[Str(s='Hi')], keywords=[]))], orelse=[])])"</span></span></code> </pre> <br>  AST generalmente se considera m√°s visual y f√°cil de entender que el √°rbol de an√°lisis. <br><br>  <b>Control de flujo Graf (CFG)</b> <br><br>  Los gr√°ficos de flujo de control son gr√°ficos direccionales que modelan el flujo de un programa utilizando bloques base que contienen una representaci√≥n intermedia. <br><br>  Normalmente, CFG es el paso anterior antes de obtener los valores del c√≥digo de salida.  El c√≥digo se genera directamente desde los bloques base utilizando una b√∫squeda de profundidad hacia atr√°s en CFG, comenzando desde la parte superior. <br><br>  <b>Bytecode</b> <br><br>  Python bytecode es un conjunto intermedio de instrucciones que funcionan en una m√°quina virtual Python.  Cuando ejecuta el c√≥digo fuente, Python crea un directorio llamado __pycache__.  Almacena el c√≥digo compilado para ahorrar tiempo en caso de reiniciar la compilaci√≥n. <br><br>  Considere una funci√≥n simple de Python en func.py. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">say_hello</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name: str)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">"Hello"</span></span>, name) print(<span class="hljs-string"><span class="hljs-string">f"How are you </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{name}</span></span></span><span class="hljs-string">?"</span></span>)</code> </pre> <br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> func <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> say_hello &gt;&gt;&gt; say_hello(<span class="hljs-string"><span class="hljs-string">"Batuhan"</span></span>) Hello Batuhan How are you Batuhan?</code> </pre> <br>  El <code>say_hello</code> objeto <code>say_hello</code> es una funci√≥n. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>type(say_hello) &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">function</span></span></span><span class="hljs-class">'&gt;</span></span></code> </pre> <br>  Tiene el atributo <code>__code__</code> . <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>say_hello.__code__ &lt;code object say_hello at <span class="hljs-number"><span class="hljs-number">0x7f13777d9150</span></span>, file <span class="hljs-string"><span class="hljs-string">"/home/batuhan/blogs/cpython/exec_model/func.py"</span></span>, line <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;</code> </pre> <br>  <b>Objetos de c√≥digo</b> <br><br>  Los objetos de c√≥digo son estructuras de datos inmutables que contienen las instrucciones o metadatos necesarios para ejecutar el c√≥digo.  En pocas palabras, estas son representaciones de c√≥digo Python.  Tambi√©n puede obtener objetos de c√≥digo compilando √°rboles de sintaxis abstracta utilizando el m√©todo de <i>compilaci√≥n</i> . <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ast &gt;&gt;&gt; code = <span class="hljs-string"><span class="hljs-string">""" ... def say_hello(name: str): ... print("Hello", name) ... print(f"How are you {name}?") ... say_hello("Batuhan") ... """</span></span> &gt;&gt;&gt; tree = ast.parse(code, mode=<span class="hljs-string"><span class="hljs-string">'exec'</span></span>) &gt;&gt;&gt; code = compile(tree, <span class="hljs-string"><span class="hljs-string">'&lt;string&gt;'</span></span>, mode=<span class="hljs-string"><span class="hljs-string">'exec'</span></span>) &gt;&gt;&gt; type(code) &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">code</span></span></span><span class="hljs-class">'&gt;</span></span></code> </pre> <br>  Cada objeto de c√≥digo tiene atributos que contienen cierta informaci√≥n (con el prefijo co_).  Aqu√≠ mencionamos solo algunos de ellos. <br><br>  <i><b>co_name</b></i> <br><br>  Para empezar, un nombre.  Si existe una funci√≥n, entonces debe tener un nombre, respectivamente, este nombre ser√° el nombre de la funci√≥n, una situaci√≥n similar con la clase.  En el ejemplo de AST, usamos m√≥dulos y podemos decirle al compilador exactamente c√≥mo queremos nombrarlos.  Que sean solo un <code>module</code> . <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>code.co_name <span class="hljs-string"><span class="hljs-string">'&lt;module&gt;'</span></span> &gt;&gt;&gt; say_hello.__code__.co_name <span class="hljs-string"><span class="hljs-string">'say_hello'</span></span></code> </pre> <br>  <i><b>co_varnames</b></i> <br><br>  Esta es una tupla que contiene todas las variables locales, incluidos los argumentos. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>say_hello.__code__.co_varnames (<span class="hljs-string"><span class="hljs-string">'name'</span></span>,)</code> </pre> <br>  <i><b>co_conts</b></i> <br><br>  Una tupla que contiene todos los literales y valores constantes a los que accedimos en el cuerpo de la funci√≥n.  Aqu√≠ vale la pena se√±alar el valor de Ninguno.  No incluimos None en el cuerpo de la funci√≥n, sin embargo, Python lo indic√≥, porque si la funci√≥n comienza a ejecutarse y luego termina sin recibir ning√∫n valor de retorno, devolver√° None. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>say_hello.__code__.co_consts (<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'Hello'</span></span>, <span class="hljs-string"><span class="hljs-string">'How are you '</span></span>, <span class="hljs-string"><span class="hljs-string">'?'</span></span>)</code> </pre> <br>  <b>Bytecode (co_code)</b> <br><br>  El siguiente es el bytecode de nuestra funci√≥n. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>bytecode = say_hello.__code__.co_code &gt;&gt;&gt; bytecode <span class="hljs-string"><span class="hljs-string">b't\x00d\x01|\x00\x83\x02\x01\x00t\x00d\x02|\x00\x9b\x00d\x03\x9d\x03\x83\x01\x01\x00d\x00S\x00'</span></span></code> </pre> <br>  Esto no es una cadena, es un objeto byte, es decir, una secuencia de bytes. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>type(bytecode) &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bytes</span></span></span><span class="hljs-class">'&gt;</span></span></code> </pre> <br>  El primer car√°cter impreso es "t".  Si solicitamos su valor num√©rico, obtenemos lo siguiente. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>ord(<span class="hljs-string"><span class="hljs-string">'t'</span></span>) <span class="hljs-number"><span class="hljs-number">116</span></span></code> </pre> <br>  116 es lo mismo que bytecode [0]. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> bytecode[<span class="hljs-number"><span class="hljs-number">0</span></span>] == ord(<span class="hljs-string"><span class="hljs-string">'t'</span></span>)</code> </pre><br>  Para nosotros, un valor de 116 no significa nada.  Afortunadamente, Python proporciona una biblioteca est√°ndar llamada dis (desde el desmontaje).  Es √∫til cuando se trabaja con la lista de nombres de operaci√≥n.  Esta es una lista de todas las instrucciones de c√≥digo de bytes, donde cada √≠ndice es el nombre de la instrucci√≥n. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>dis.opname[ord(<span class="hljs-string"><span class="hljs-string">'t'</span></span>)] <span class="hljs-string"><span class="hljs-string">'LOAD_GLOBAL'</span></span></code> </pre> <br>  Creemos otra funci√≥n m√°s compleja. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">multiple_it</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a: int)</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> a % <span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>: ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a * <span class="hljs-number"><span class="hljs-number">2</span></span> ... &gt;&gt;&gt; multiple_it(<span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-number"><span class="hljs-number">0</span></span> &gt;&gt;&gt; multiple_it(<span class="hljs-number"><span class="hljs-number">7</span></span>) <span class="hljs-number"><span class="hljs-number">14</span></span> &gt;&gt;&gt; bytecode = multiple_it.__code__.co_code</code> </pre> <br>  Y descubrimos la primera instrucci√≥n en bytecode. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>dis.opname[bytecode[<span class="hljs-number"><span class="hljs-number">0</span></span>]] <span class="hljs-string"><span class="hljs-string">'LOAD_FAST</span></span></code> </pre> <br>  La instrucci√≥n LOAD_FAST consta de dos elementos. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>dis.opname[bytecode[<span class="hljs-number"><span class="hljs-number">0</span></span>]] + <span class="hljs-string"><span class="hljs-string">' '</span></span> + dis.opname[bytecode[<span class="hljs-number"><span class="hljs-number">1</span></span>]] <span class="hljs-string"><span class="hljs-string">'LOAD_FAST &lt;0&gt;'</span></span></code> </pre> <br>  La instrucci√≥n Loadfast 0 busca buscar nombres de variables en una tupla y empuja un elemento con un √≠ndice cero a una tupla en la pila de ejecuci√≥n. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>multiple_it.__code__.co_varnames[bytecode[<span class="hljs-number"><span class="hljs-number">1</span></span>]] <span class="hljs-string"><span class="hljs-string">'a'</span></span></code> </pre> <br>  Nuestro c√≥digo se puede desmontar usando dis.dis y convertir el c√≥digo de bytes a una vista familiar.  Aqu√≠ los n√∫meros (2,3,4) son los n√∫meros de l√≠nea.  Cada l√≠nea de c√≥digo en Python se expande como un conjunto de instrucciones. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>dis.dis(multiple_it) <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> LOAD_FAST <span class="hljs-number"><span class="hljs-number">0</span></span> (a) <span class="hljs-number"><span class="hljs-number">2</span></span> LOAD_CONST <span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span> BINARY_MODULO <span class="hljs-number"><span class="hljs-number">6</span></span> LOAD_CONST <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">8</span></span> COMPARE_OP <span class="hljs-number"><span class="hljs-number">2</span></span> (==) <span class="hljs-number"><span class="hljs-number">10</span></span> POP_JUMP_IF_FALSE <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> LOAD_CONST <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">14</span></span> RETURN_VALUE <span class="hljs-number"><span class="hljs-number">4</span></span> &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span> LOAD_FAST <span class="hljs-number"><span class="hljs-number">0</span></span> (a) <span class="hljs-number"><span class="hljs-number">18</span></span> LOAD_CONST <span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">20</span></span> BINARY_MULTIPLY <span class="hljs-number"><span class="hljs-number">22</span></span> RETURN_VALUE</code> </pre> <br>  <b>Plazo de entrega</b> <br><br>  CPython es una m√°quina virtual orientada a la pila, no una colecci√≥n de registros.  Esto significa que el c√≥digo Python se compila para una m√°quina virtual con una arquitectura de pila. <br><br>  Al llamar a una funci√≥n, Python usa dos pilas juntas.  La primera es la pila de ejecuci√≥n, y la segunda es la pila de bloques.  La mayor√≠a de las llamadas ocurren en la pila de ejecuci√≥n;  la pila de bloques realiza un seguimiento de cu√°ntos bloques est√°n actualmente activos, as√≠ como otros par√°metros relacionados con bloques y √°mbitos. <br><br>  Esperamos sus comentarios sobre el material y lo invitamos a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un seminario web abierto</a> sobre el tema: "Lib√©relo: aspectos pr√°cticos de la liberaci√≥n de software confiable", que ser√° realizado por nuestro maestro, el programador del sistema de publicidad en Mail.Ru, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Stanislav Stupnikov</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/442252/">https://habr.com/ru/post/442252/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../442238/index.html">Uso de cuentas inteligentes de Waves: de subastas a programas de bonificaci√≥n</a></li>
<li><a href="../442242/index.html">Noticias de √∫ltima hora: Lanzamiento de la planta de c√©lulas solares m√°s grande del hemisferio occidental</a></li>
<li><a href="../442244/index.html">Rust 1.33 Lanzamiento</a></li>
<li><a href="../442248/index.html">La NASA aprob√≥ el lanzamiento de prueba no tripulado de Dragon-2</a></li>
<li><a href="../442250/index.html">Reaccionar y Vue: fortalezas</a></li>
<li><a href="../442256/index.html">Defensa digital del mundo pl√°stico de los reguladores nacionales de Internet.</a></li>
<li><a href="../442258/index.html">Raspado web para desarrolladores web: un breve resumen</a></li>
<li><a href="../442260/index.html">10 comandos de Git que un desarrollador debe saber</a></li>
<li><a href="../442262/index.html">Secreto de firmware</a></li>
<li><a href="../442264/index.html">Eliminando oportunidades para secuestro de tr√°fico</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>