<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📣 📹 👈 React & BEM - colaboração oficial. Parte histórica 🌏 ❌ ⛲️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aqui está a história da integração da metodologia BEM no universo React. O material que você lerá é baseado na experiência dos desenvolvedores Yandex ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>React & BEM - colaboração oficial. Parte histórica</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/438598/"><p>  Aqui está a história da integração da metodologia BEM no universo React.  O material que você lerá é baseado na experiência dos desenvolvedores Yandex no desenvolvimento do maior e mais carregado serviço na Rússia - Yandex.Search.  Nunca falamos com tanto detalhe e profundidade sobre por que o fizemos, e não de outra forma, o que nos motivou e o que realmente queríamos.  O forasteiro recebeu lançamentos secos e críticas em conferências.  Somente à margem podia-se ouvir algo assim.  Como co-autor, fiquei indignado por causa da escassez de informações externas sempre que falava sobre novas versões de bibliotecas.  Mas desta vez vamos compartilhar todos os detalhes. </p><br><img src="https://habrastorage.org/webt/wb/mt/xc/wbmtxcvurtd6cdv1aomjrtcyfw8.png"><br><p>  Todo mundo já ouviu falar sobre a metodologia BEM.  Seletores de CSS com sublinhados.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A abordagem de componente</a> mencionada, tendo em mente a maneira como os seletores de CSS CSS são escritos.  Mas não haverá uma palavra sobre CSS no artigo.  Apenas JS, apenas hardcore! </p><a name="habracut"></a><br><p>  Para entender por que a metodologia apareceu e quais problemas a Yandex enfrentou, recomendo que você <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">se familiarize com o histórico do</a> BEM. </p><br><h2 id="prolog">  Prólogo </h2><br><p> O BEM realmente nasceu como uma salvação da forte conectividade e aninhamento no CSS.  Mas dividir a planilha <code>style.css</code> em arquivos para cada bloco, elemento ou modificador inevitavelmente levou a uma estrutura semelhante do código JavaScript. </p><br><p>  Em 2011, o Open Source adquiriu os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">primeiros commits da estrutura</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>i-bem.js</code></a> , que funcionavam em conjunto com <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>bem-xjst</code></a> modelo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>bem-xjst</code></a> .  Ambas as tecnologias surgiram do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">XSLT</a> e serviram à ideia popular de separar a lógica de negócios e a apresentação de componentes.  No mundo exterior, esses foram os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">grandes tempos do</a> guidão e do sublinhado. </p><br><p>  <code>bem-xjst</code> é um tipo diferente de mecanismo de modelo.  Para aumentar meu conhecimento da arquitetura das abordagens de padronização, recomendo vivamente o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">relatório de Sergei Berezhnoy</a> .  <code>bem-xjst</code> pode experimentar o <code>bem-xjst</code> modelo <code>bem-xjst</code> na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sandbox online</a> . </p><br><p>  Devido às especificidades dos serviços de pesquisa Yandex, as interfaces do usuário são construídas usando dados.  A página de resultados da pesquisa é exclusiva para cada consulta. </p><br><p><img src="https://habrastorage.org/webt/6g/af/sc/6gafsczppz4ul8glzeliauwnkjc.png"><br>  <em>Consulta de pesquisa por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">referência</a></em> </p><br><p><img src="https://habrastorage.org/webt/ni/z5/nc/niz5ncgv3rlci2jfymornobfvcy.png"><br>  <em>Consulta de pesquisa por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">link</a></em> </p><br><p><img src="https://habrastorage.org/webt/eb/6q/ws/eb6qws6vwtclkce_jsumewy4jkk.png"><br>  <em>Consulta de pesquisa por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">referência</a></em> </p><br><p>  Quando a divisão em um bloco, elemento e modificador se espalha pelo sistema de arquivos, isso permite coletar o máximo possível apenas o código necessário, de fato para cada página, para cada solicitação do usuário.  Mas como </p><br><pre> <code class="plaintext hljs">src/components ├── ComponentName │ ├── _modName │ │ ├── ComponentName_modName.tsx —   │ │ └── ComponentName_modName_modVal.tsx —    │ ├── ElementName │ │ └── ComponentName-ElementName.tsx —   ComponentName │ ├── ComponentName.i18n —   │ │ ├── ru.ts —     │ │ ├── en.ts —     │ │ └── index.ts —    │ ├── ComponentName.test —   │ │ ├── ComponentName.page-object.js — Page Object │ │ ├── ComponentName.hermione.js —   │ │ └── ComponentName.test.tsx — unit- │ ├── ComponentName.tsx —    │ ├── ComponentName.scss —   │ ├── ComponentName.examples.tsx —    Storybook │ └── README.md —  </code> </pre> <br><p>  <em>Estrutura moderna de diretório de componentes</em> </p><br><p>  Como em outras empresas, no Yandex, os desenvolvedores de interface são responsáveis ​​pelo frontend, que consiste na parte do cliente no navegador e na parte do servidor no <code>Node.js</code>  A parte do servidor processa os dados da pesquisa "grande" e impõe modelos a eles.  O processamento de dados primário converte JSON em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">BEMJSON</a> , a estrutura de dados <code>bem-xjst</code> modelo <code>bem-xjst</code> .  O mecanismo de modelo percorre cada nó da árvore e impõe um modelo a ele.  Como a conversão primária ocorre no servidor e, devido à divisão em pequenas entidades, os nós correspondem aos arquivos, durante a geração do modelo, enviamos o código para o navegador que será usado apenas na página atual. </p><br><p>  Abaixo está a correspondência dos nós BEMJSON com os arquivos no sistema de arquivos. </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">block</span></span>: <span class="hljs-string"><span class="hljs-string">'Select'</span></span>, <span class="hljs-attr"><span class="hljs-attr">elem</span></span>: <span class="hljs-string"><span class="hljs-string">'Item'</span></span>, <span class="hljs-attr"><span class="hljs-attr">elemMods</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'navigation'</span></span> } };</code> </pre> <br><pre> <code class="plaintext hljs">src/components ├── Select │ ├── Item │ │ _type │ │ ├── Select-Item_type_navigation.js │ │ └── Select-Item_type_navigation.css</code> </pre> <br><p>  O sistema modular <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>YModules</code></a> foi responsável por isolar os componentes do código JavaScript no navegador.  Ele permite que você entregue módulos de forma síncrona e assíncrona ao navegador.  Um exemplo de como os componentes funcionam com o <code>YModules</code> e o <code>i-bem.js</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pode ser encontrado aqui</a> .  Hoje, para a maioria dos desenvolvedores, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>  webpack</code></a> e o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">padrão</a> inédito <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">de importações dinâmicas fazem isso</a> . </p><br><p>  Um conjunto de metodologia BEM, mecanismo de modelo declarativo e estrutura JS com um sistema modular tornou possível resolver qualquer problema.  Mas com o tempo, a dinâmica chegou às interfaces do usuário. </p><br><h2 id="novaya-nadezhda">  Nova esperança </h2><br><p>  Em 2013, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">React encantou o</a> código-fonte aberto.  De fato, o Facebook começou a usá-lo em 2011.  James Long, em suas anotações da conferência <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JS Conf US</a> , diz: </p><br><blockquote>  As duas últimas sessões foram uma surpresa.  O primeiro foi dado por dois desenvolvedores do Facebook e eles anunciaram o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Facebook React</a> .  Não fiz muitas anotações porque fiquei meio chocado com a idéia que acho ruim.  Essencialmente, eles criaram uma linguagem chamada JSX, que permite incorporar XML em JavaScript para criar interfaces de usuário reativas ao vivo.  XML  Em JavaScript. </blockquote><p>  O React mudou a abordagem para projetar aplicativos da web.  Tornou-se tão popular que hoje você não consegue encontrar um desenvolvedor que nunca ouviu falar do React.  Mas outra coisa é importante: as aplicações se tornaram diferentes, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SPA</a> entrou em nossas vidas. </p><br><p>  É geralmente aceito que os desenvolvedores Yandex tenham um senso especial de beleza com relação à tecnologia.  Às vezes estranho, difícil de argumentar, mas nunca sem razão.  Quando o React estava ganhando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">estrelas no GitHub</a> , muitos que estavam familiarizados com as tecnologias da Web Yandex insistiram: o Facebook venceu, abandonou seu trabalho e reescreve tudo no React antes que seja tarde demais.  É importante entender duas coisas. </p><br><p>  Em primeiro lugar, não houve guerra.  As empresas não competem na criação da melhor estrutura na Terra.  Se uma empresa começar a gastar menos tempo (dinheiro de leitura) em tarefas de infraestrutura com a mesma produtividade, todos serão beneficiados.  Não faz sentido escrever estruturas para escrever estruturas.  Os melhores desenvolvedores criam ferramentas que resolvem as tarefas da empresa da melhor maneira.  Empresas, serviços, objetivos - é tudo diferente.  Daí a variedade de ferramentas. </p><br><p>  Em segundo lugar, estávamos procurando uma maneira de usar o React da maneira que gostaríamos que fosse.  Com todos os recursos que nossas tecnologias descritas acima forneceram. </p><br><p>  Acredita-se que o código usando o React seja rápido por padrão.  Se você também pensa assim, está profundamente enganado.  A única coisa que o React faz é, na maioria dos casos, ajudar a interagir de maneira ideal com o DOM. </p><br><p>  Até a versão 16, o React tinha uma falha fatal.  Era 10 vezes mais lento que o <code>bem-xjst</code> no servidor.  Não podíamos pagar esse desperdício.  O tempo de resposta para o Yandex é uma das principais métricas.  Imagine que, ao solicitar uma receita de vinho quente, você terá uma resposta 10 vezes mais lenta que o normal.  Você não ficará satisfeito com as desculpas, mesmo que saiba algo sobre desenvolvimento web.  O que podemos dizer sobre a explicação, como "mas tornou-se mais conveniente para os desenvolvedores se comunicarem com o DOM".  Adicione aqui a relação entre o preço da implementação e o lucro - e você mesmo tomará a única decisão certa. </p><br><p>  Felizmente para a tristeza, os desenvolvedores são pessoas estranhas.  Se algo não der certo, esse não é um motivo para largar tudo ... </p><br><h2 id="shivorot-navyvorot">  De cabeça para baixo </h2><br><p>  Estávamos confiantes de que poderíamos derrotar a lentidão do React.  Já temos um mecanismo de modelo rápido.  Tudo que você precisa é gerar HTML no servidor usando o <code>bem-xjst</code> e, no cliente, "forçar" o React a aceitar esta marcação como sua.  A idéia era tão simples que nada indicava um fracasso. </p><br><p>  Nas versões até 15, inclusive, o React validou a validade da marcação usando uma soma de hash - um algoritmo que transforma qualquer otimização em uma abóbora.  Para convencer o React da validade da marcação, foi necessário definir um ID para cada nó e calcular a soma de hash de todos os nós.  Também significava suportar um conjunto duplo de modelos: reagir para o cliente e <code>bem-xjst</code> para o servidor.  Testes simples de velocidade com instalação de identificação deixaram claro que não havia sentido em continuar. </p><br><p>  O <code>bem-xjst</code> bem <code>bem-xjst</code> é uma ferramenta muito subestimada.  Veja o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">relatório do principal mantenedor da Glory Oliyanchuk</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">veja por</a> si mesmo.  <code>bem-xjst</code> é baseado em uma arquitetura que permite usar uma sintaxe de modelo para diferentes transformações da árvore de origem.  Muito parecido com React, não é?  Hoje, esse recurso permite que ferramentas como o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>react-sketchapp</code></a> . </p><br><p>  Fora da caixa <code>bem-xjst</code> contém dois tipos de conversões: em HTML e em JSON.  Qualquer desenvolvedor suficientemente diligente pode escrever seu próprio mecanismo para transformar modelos em qualquer coisa.  <code>bem-xjst</code> transformar uma árvore de dados em uma sequência de chamadas para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">funções HyperScript</a> .  O que significava total compatibilidade com o React e outras implementações do algoritmo Virtual DOM, por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Preact</a> . </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/yPV6pcMdezM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  <em>Uma introdução detalhada à geração de chamadas de função HyperScript</em> </p><br><p>  Como os modelos React exigem a coexistência de layout e lógica de negócios, tivemos que trazer a lógica do <code>i-bem.js</code> para nossos modelos, que não foram projetados para isso.  Para eles, isso não era natural.  Eles estavam indo de maneira diferente.  A propósito! </p><br><p>  Abaixo está um exemplo das profundidades de colar diferentes mundos em um tempo de execução. </p><br><pre> <code class="javascript hljs">block(<span class="hljs-string"><span class="hljs-string">'select'</span></span>).elem(<span class="hljs-string"><span class="hljs-string">'menu'</span></span>)( def()(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> React = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'react'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Menu = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../components/menu/menu'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MenuItem = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../components/menu-item/menu-item'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> _select = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ctx._select; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> selectComponent = _select._select; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> React.createElement.apply(React, [ Menu, { <span class="hljs-attr"><span class="hljs-attr">mix</span></span>: { <span class="hljs-attr"><span class="hljs-attr">block</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.block, <span class="hljs-attr"><span class="hljs-attr">elem</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elem }, <span class="hljs-attr"><span class="hljs-attr">ref</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">menu</span></span></span><span class="hljs-function"> =&gt;</span></span> selectComponent._menu = menu, <span class="hljs-attr"><span class="hljs-attr">size</span></span>: _select.mods.size, <span class="hljs-attr"><span class="hljs-attr">disabled</span></span>: _select.mods.disabled, <span class="hljs-attr"><span class="hljs-attr">mode</span></span>: _select.mods.mode, <span class="hljs-attr"><span class="hljs-attr">content</span></span>: _select.options, <span class="hljs-attr"><span class="hljs-attr">checkedItems</span></span>: _select.bindings.checkedItems, <span class="hljs-attr"><span class="hljs-attr">style</span></span>: _select.bindings.popupMenuWidth, <span class="hljs-attr"><span class="hljs-attr">onKeyDown</span></span>: _select.bindings.onKeyDown, <span class="hljs-attr"><span class="hljs-attr">theme</span></span>: _select.mods.theme, }].concat(_select.options.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">option</span></span></span><span class="hljs-function"> =&gt;</span></span> React.createElement( MenuItem, { <span class="hljs-attr"><span class="hljs-attr">onClick</span></span>: _select.bindings.onOptionCheck, <span class="hljs-attr"><span class="hljs-attr">theme</span></span>: _select.mods.theme, <span class="hljs-attr"><span class="hljs-attr">val</span></span>: option.value, }, option.content) )) ); }) );</code> </pre> <br><p>  Claro, tivemos nossa própria assembléia.  Como você sabe, a operação mais rápida é a concatenação de cadeias.  O mecanismo <code>bem-xjst</code> foi construído sobre ele, a montagem sobre ele.  Arquivos de blocos, elementos e modificadores estão em pastas, e a montagem apenas teve que colar os arquivos na seqüência correta.  Com essa abordagem, você pode colar JS, CSS e modelos em paralelo, bem como as próprias entidades.  Ou seja, se você possui quatro componentes em um projeto, quatro núcleos no laptop e a montagem de uma tecnologia de componente leva um segundo, a criação do projeto leva dois segundos.  Aqui deve ficar mais claro como conseguimos inserir apenas o código necessário no navegador. </p><br><p>  Tudo isso para nós fez a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ENB</a> .  Recebemos a árvore final para padronização apenas em tempo de execução e, como a dependência entre os componentes precisava surgir um pouco antes para coletar pacotes, essa função foi assumida pela pouco conhecida tecnologia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>deps.js</code></a>  Ele permitiu criar um gráfico de dependência entre os componentes, após o qual o coletor poderia colar o código na sequência desejada, ignorando o gráfico. </p><br><p>  A versão 16 do React parou de funcionar nessa direção.A velocidade de execução dos modelos no servidor foi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">igual</a> .  Nas instalações de produção, a diferença se tornou imperceptível. </p><br><p>  Nó: <strong>v8.4.0</strong> <br>  Crianças: <strong>5K</strong> </p><br><table><thead><tr><th>  renderizador </th><th>  tempo médio </th><th>  ops / s </th></tr></thead><tbody><tr><td>  <strong>pré-</strong> execução v8.2.6 </td><td>  66.235ms </td><td>  15 </td></tr><tr><td>  <strong>bem-xjst</strong> v8.8.4 </td><td>  71.326ms </td><td>  14 </td></tr><tr><td>  react v16.1.0 </td><td>  73.966ms </td><td>  14 </td></tr></tbody></table><br><p>  Usando os links abaixo, você pode restaurar o histórico da abordagem: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://ru.bem.info/forum/961/</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/awinogradov/react-bl</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/awinogradov/xjst-ddsl</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/awinogradov/ddsl-react</a> </li></ul><br><p>  Já tentamos mais alguma coisa? </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/veged/bem-components-react</a> - a primeira abordagem para implementar a metodologia no React; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/Yeti-or/bem-hazard</a> - uma abordagem semelhante com base no mecanismo de modelo BH.  Com BH, a propósito, você pode brincar on-line; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/dfilatov/bem-react</a> - criando componentes através do BEMJSON; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/rebem</a> - utilitários BEM no mundo React. </li></ul><br><p><img src="https://habrastorage.org/webt/uv/si/wt/uvsiwtsrexhffeuznrqhpxvtjva.png"></p><br><h2 id="motivaciya">  Motivação </h2><br><p>  No meio da história, será útil falar sobre o que nos motivou.  Valeu a pena fazer isso no começo, mas - quem se lembra do velho, daquele olho de presente.  Por que precisamos de tudo isso?  O que o BEM pode trazer que o React não pode fazer?  Perguntas que quase todo mundo faz. </p><br><h3 id="dekompoziciya">  Decomposição </h3><br><p>  A funcionalidade dos componentes se torna mais complicada de ano para ano, e o número de variações aumenta.  Isso é expresso pelas construções <code>if</code> ou <code>switch</code> , como resultado, a base de código aumenta inevitavelmente, como resultado - o peso do componente e do projeto usando esse componente aumenta.  A parte principal da lógica do componente React está contida no método <code>render()</code> .  Para alterar a funcionalidade de um componente, é necessário reescrever a maior parte do método, o que inevitavelmente leva a um aumento exponencial no número de componentes altamente especializados. </p><br><p>  Todo mundo conhece as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bibliotecas</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">material-ui</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fabric-ui</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">react-bootstrap</a> .  Em geral, todas as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bibliotecas conhecidas</a> com componentes têm a mesma desvantagem.  Imagine que você tem vários projetos e todos usam a mesma biblioteca.  Você usa os mesmos componentes, mas em variações diferentes: aqui existem seleções com caixas de seleção, não existem, existem botões azuis com um ícone, existem botões vermelhos sem.  O peso de CSS e JS que a biblioteca traz para você será o mesmo em todos os projetos.  Mas porque?  Variações de componentes são incorporadas no próprio componente e vêm com ele, se você deseja ou não.  Para nós, isso é inaceitável. </p><br><p>  O Yandex também possui sua própria biblioteca com componentes - Lego.  É aplicado em ~ 200 serviços.  Queremos que o uso do Lego na Pesquisa custe o mesmo para o Yandex.Health?  Você sabe a resposta. </p><br><h3 id="krossplatformennaya-razrabotka">  Desenvolvimento multiplataforma </h3><br><p>  Para oferecer suporte a várias plataformas, na maioria das vezes, eles criam uma versão separada para cada plataforma ou uma adaptável. </p><br><p>  O desenvolvimento de versões individuais requer recursos adicionais: quanto mais plataformas, mais esforço.  Manter o estado síncrono das propriedades do produto em diferentes versões causará novas dificuldades. </p><br><p>  O desenvolvimento de uma versão adaptável complica o código, aumenta o peso, reduz a velocidade do produto com a diferença adequada entre as plataformas. </p><br><p>  Queremos que nossos pais / amigos / colegas / filhos usem versões para computador no celular com menor velocidade da Internet e menor produtividade?  Você sabe a resposta. </p><br><h3 id="eksperimenty">  Os experimentos </h3><br><p>  Se você estiver desenvolvendo projetos para um grande público, precisará ter certeza de todas as alterações.  Os experimentos A / B são uma maneira de ganhar essa confiança. </p><br><p>  Maneiras de organizar o código para experimentos: </p><br><ul><li>  bifurcação do projeto e criação de instâncias de serviço na produção; </li><li>  condições pontuais dentro da base de código. </li></ul><br><p>  Se o projeto tiver muitas experiências longas, a ramificação da base de código causará custos significativos.  É necessário manter cada filial atualizada com o experimento: erros de porta corrigidos e funcionalidade do produto.  A ramificação da base de código complica experimentos cruzados várias vezes. </p><br><p>  As condições pontuais funcionam com mais flexibilidade, mas complicam a base de código: as condições do experimento podem afetar diferentes partes do projeto.  Um grande número de condições prejudica o desempenho aumentando a quantidade de código para o navegador.  É necessário remover as condições, tornar o código básico ou excluir completamente o experimento com falha. </p><br><p>  Na Pesquisa ~ 100 experiências on-line em várias combinações para diferentes públicos.  Você poderia ver por si mesmo.  Lembre-se, talvez você tenha notado a funcionalidade e, uma semana depois, ela desapareceu magicamente.  Queremos testar as teorias de produtos ao custo de manter centenas de ramificações da base de código ativa de 500.000 linhas, que são alteradas por ~ 60 desenvolvedores diariamente?  Você sabe a resposta. </p><br><h3 id="globalnye-izmeneniya">  Mudança global </h3><br><p>  Por exemplo, você pode criar um componente <code>CustomButton</code> herdado de <code>Button</code> de uma biblioteca.  Mas o <code>CustomButton</code> herdado não se aplicará a todos os componentes da biblioteca que contém <code>Button</code> .  Uma biblioteca pode ter um componente de <code>Search</code> criado a partir de <code>Input</code> e <code>Button</code> .  Nesse caso, o <code>CustomButton</code> herdado não aparece dentro do componente <code>Search</code> .  Queremos contornar manualmente toda a base de códigos em que o <code>Button</code> usado? </p><br><p><img src="https://habrastorage.org/webt/po/7j/fg/po7jfgnxrawurvtkoi-3ch2wneu.jpeg"></p><br><h2 id="dolgaya-doroga-v-kompoziciyu">  Longo caminho para a composição </h2><br><p>  Decidimos mudar a estratégia.  Na abordagem anterior, eles tomaram a tecnologia Yandex como base e tentaram fazer com que o React funcionasse com base nisso.  Novas táticas sugeriam o contrário.  Foi assim que surgiu o projeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bem-react-core</a> . </p><br><blockquote>  Pare com isso!  Por que reagir? </blockquote><p>  Vimos nela a oportunidade de nos livrarmos da renderização inicial explícita em HTML e do suporte manual do estado do componente JS posteriormente no tempo de execução - na verdade, tornou-se possível mesclar modelos BEMHMTL e componentes JS em uma única tecnologia. </p><br><h3 id="v100httpsgithubcombembem-reacttreev100">  <a href="">v1.0.0</a> </h3><br><p>  Inicialmente, planejamos transferir todas as melhores práticas e propriedades <code>bem-xjst</code> para a biblioteca no topo do React.  A primeira coisa que chama sua atenção é a assinatura ou, se preferir, a sintaxe para descrever os componentes. </p><br><p>  <em>O que você fez, existe o JSX!</em> </p><br><p>  A primeira versão foi construída com base na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">herança</a> - uma biblioteca que ajuda a implementar classes e herança.  Como alguns de vocês lembram, naquela época, protótipos de protótipo em JavaScript não tinham classes, não havia <code>super</code> .  Em geral, eles ainda estão ausentes, mais precisamente, essas não são as classes que primeiro vêm à mente.  <code>inherit</code> fez tudo o que as classes no padrão ES2015 podem fazer agora e o que é considerado magia negra: herança múltipla e fusão de protótipos em vez de reconstruir a cadeia, o que afeta positivamente o desempenho.  Você não se enganará se acha que parece fazer sentido como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">herda no Node.js</a> , mas eles funcionam de maneira diferente. </p><br><p>  Abaixo está um exemplo da sintaxe dos modelos <code>bem-react-core@v1.0.0</code> . </p><br><p>  <strong>App-Header.js</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { decl } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'bem-react-core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> decl({ <span class="hljs-attr"><span class="hljs-attr">block</span></span>: <span class="hljs-string"><span class="hljs-string">'App'</span></span>, <span class="hljs-attr"><span class="hljs-attr">elem</span></span>: <span class="hljs-string"><span class="hljs-string">'Header'</span></span>, <span class="hljs-attr"><span class="hljs-attr">attrs</span></span>: { <span class="hljs-attr"><span class="hljs-attr">role</span></span>: <span class="hljs-string"><span class="hljs-string">'heading'</span></span> }, content() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>; } });</code> </pre> <br><p>  <strong>App-Header@desktop.js</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { decl } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'bem-react-core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> decl({ <span class="hljs-attr"><span class="hljs-attr">block</span></span>: <span class="hljs-string"><span class="hljs-string">'App'</span></span>, <span class="hljs-attr"><span class="hljs-attr">elem</span></span>: <span class="hljs-string"><span class="hljs-string">'Header'</span></span>, <span class="hljs-attr"><span class="hljs-attr">tag</span></span>: <span class="hljs-string"><span class="hljs-string">'h1'</span></span>, attrs() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...this.__base(...arguments), <span class="hljs-string"><span class="hljs-string">'aria-level'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }, }, content() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">` </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.__base(...</span></span><span class="hljs-built_in"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-built_in">arguments</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">     h1`</span></span>; } });</code> </pre> <br><p>  <strong>App-Header@touch.js</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { decl } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'bem-react-core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> decl({ <span class="hljs-attr"><span class="hljs-attr">block</span></span>: <span class="hljs-string"><span class="hljs-string">'App'</span></span>, <span class="hljs-attr"><span class="hljs-attr">elem</span></span>: <span class="hljs-string"><span class="hljs-string">'Header'</span></span>, <span class="hljs-attr"><span class="hljs-attr">tag</span></span>: <span class="hljs-string"><span class="hljs-string">'h2'</span></span>, content() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">` </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.__base(...</span></span><span class="hljs-built_in"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-built_in">arguments</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">  `</span></span>; } });</code> </pre> <br><p>  <strong>index.js</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDomServer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom/server'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> AppHeader <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'b:App e:Header'</span></span>; ReactDomServer.renderToStaticMarkup(<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">AppHeader</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">);</span></span></code> </pre> <br><p>  <strong>output@desktop.html</strong> </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"App-Header"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">role</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"heading"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">aria-level</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">&gt;</span></span>A       h1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  <strong>output@touch.html</strong> </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"App-Header"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">role</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"heading"</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  <em>Os modelos de dispositivo para componentes mais complexos podem ser encontrados <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .</em> </p><br><p>  Como uma classe é um objeto e o trabalho com objetos em JavaScript é mais conveniente, a sintaxe é apropriada.  A <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sintaxe</a> posteriormente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">migrou</a> para sua mente <code>bem-xjst</code> . </p><br><p>  A biblioteca era um repositório global de declarações de objetos - os resultados da execução da função <code>decl</code> , partes de entidades: um bloco, elemento ou modificador.  O BEM fornece um mecanismo de nomeação exclusivo e, portanto, é adequado para criar chaves em um cofre.  O componente React resultante foi colado no local de uso.  O truque é que <code>decl</code> funcionou ao importar o módulo.  Isso tornou possível indicar quais partes do componente são necessárias em cada local específico, usando uma lista simples de importações.  Mas lembre-se: os componentes são complexos, existem muitas partes, a lista de importações é longa, os desenvolvedores são preguiçosos. </p><br><h4 id="magiya-importov">  Import Magic </h4><br><p>  Como você pode ver, nos exemplos de código, existem linhas <code>import AppHeader from 'b:App e:Header'</code> . </p><br><p>  <em>Você quebrou o padrão!</em>  <em>É impossível!</em>  <em>Simplesmente não vai funcionar!</em> </p><br><p>  Em primeiro lugar, o padrão de importação não opera com os termos do espírito "deve haver um caminho para um módulo real na linha de importação".  Em segundo lugar, é o açúcar sintático que foi convertido usando Babel.  Terceiro, construções de pontuação de <code>import txt from 'raw-loader!./file.txt';</code> estranhas para o webpack <code>import txt from 'raw-loader!./file.txt';</code>  por algum motivo eles não incomodaram ninguém. <br>  Portanto, nosso bloco é apresentado em duas plataformas: <code>desktop</code> , <code>touch</code> . </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Hello <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'b:Hello'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     : var Hello = [ require('path/to/desktop/Hello/Hello.js'), require('path/to/touch/Hello/Hello.js') ][0].applyDecls();</span></span></code> </pre> <br><p>          <code>Hello</code> ,     <code>applyDecls</code> ,          <code>inherit</code>   ,       React-. </p><br><p>   Babel,   ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> .    webpack,       , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> . </p><br><p>  ,   : </p><br><ul><li> ,   ,         ; </li><li>     ; </li><li>  React-    . </li></ul><br><p>    : </p><br><ul><li>   TypeScript/Flow; </li><li>    React- ; </li><li> -         ; </li><li>      . </li></ul><br><h3 id="v200httpsgithubcombembem-reacttreev200"> <a href="">v2.0.0</a> </h3><br><p>     <code>bem-react-core@v1.0.0</code>  ,       . </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Elem } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'bem-react-core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Button } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../Button'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppHeader</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Elem</span></span></span><span class="hljs-class"> </span></span>{ block = <span class="hljs-string"><span class="hljs-string">'App'</span></span>; elem = <span class="hljs-string"><span class="hljs-string">'Header'</span></span>; tag() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'h2'</span></span>; } content() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } }</code> </pre> <br><p>     ,     .    ,   ,      TypeScript/Flow.   ,     <code>inherit</code>  «» ,     ,            . </p><br><p>   : <br> —         webpack    Babel; <br> —      ; <br> —       ,    . </p><br><p>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">HOC</a> ,             . </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Block, Elem, withMods } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'bem-react-core'</span></span>; interface IButtonProps { <span class="hljs-attr"><span class="hljs-attr">children</span></span>: string; } interface IModsProps extends IButtonProps { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'link'</span></span> | <span class="hljs-string"><span class="hljs-string">'button'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//   Text class Text extends Elem { block = 'Button'; elem = 'Text'; tag() { return 'span'; } } //   Button class Button&lt;T extends IModsProps&gt; extends Block&lt;T&gt; { block = 'Button'; tag() { return 'button'; } mods() { return { type: this.props.type }; } content() { return ( &lt;Text&gt;{this.props.children}&lt;/Text&gt; ); } } //    Button,    type   link class ButtonLink extends Button&lt;IModsProps&gt; { static mod = ({ type }: any) =&gt; type === 'link'; tag() { return 'a'; } mods() { return { type: this.props.type }; } attrs() { return { href: 'www.yandex.ru' }; } } //   Button  ButtonLink const ButtonView = withMods(Button, ButtonLink); ReactDOM.render( &lt;React.Fragment&gt; &lt;ButtonView type='button'&gt;Click me&lt;/ButtonView&gt; &lt;ButtonView type='link'&gt;Click me&lt;/ButtonView&gt; &lt;/React.Fragment&gt;, document.getElementById('root') );</span></span></code> </pre> <br><p>              ,     . </p><br><p> <code>withMods</code>       ,   (),      .   ,     , withMods        ,      .      .       , ,     ,   ( )   .               .       ,   ,    —    ,    . </p><br><p> ,   : </p><br><ul><li>    . ,        .   ,    TS.        ,      .    ES5 TS   super   ,         . , TS     ,    . </li><li>    . TS  ES6  Babel  ES5.      ,    npm-    .  ,          Babel. </li></ul><br><p>  : </p><br><ul><li>       ,   . ,     . :    DOM-.     HOC,      .   withMods       . </li><li>   (, , )       .             <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SFC</a> . </li><li>  CSS-.  CSS-   JS-     .      ,   ,          . </li></ul><br><p>      v2. </p><br><h2 id="manifest">  </h2><br><p> ,    .   .  ,    ,      1  2.      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> . </p><br><p>   —    .   CSS-     HOC,        —  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dependency injection</a> . </p><br><p>       React: </p><br><ul><li>   CSS-. </li><li>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> (, ); </li></ul><br><p>         .         .        <code>React.ComponentType</code>     -.         HOC     compose    . </p><br><p>             . </p><br><p>        dependency injection,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>React.ContextAPI</code></a>    .             ,        ,        .        ,      .   DI —  HOC,     .         .     ,  ,         . </p><br><p> ,    ,         .   ,      ,    4 ,    <code>1.5Kb</code> . </p><br><p>     .  Obrigado a quem leu até o fim.     ,     React  . . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt438598/">https://habr.com/ru/post/pt438598/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt438588/index.html">Widget googleTranslate personalizado para o site</a></li>
<li><a href="../pt438590/index.html">Thunder in Paradise ou Por que você não deve usar o FlylinkDC ++</a></li>
<li><a href="../pt438592/index.html">O que procurar ao escolher um leitor - estamos falando sobre o fator de forma e a exibição</a></li>
<li><a href="../pt438594/index.html">Local de trabalho e 4k a 60Hz</a></li>
<li><a href="../pt438596/index.html">Salvando dados do usuário após o recarregamento da página</a></li>
<li><a href="../pt438600/index.html">SciPy, entrada e saída em MATLAB</a></li>
<li><a href="../pt438602/index.html">Desmontamos o protocolo de mensagens de pager POCSAG, parte 1</a></li>
<li><a href="../pt438604/index.html">Bitrix em um monte de Nginx + PHP-FPM, configurando o CNC, bem como um cache composto com feedback através do nginx. Configuração modificada</a></li>
<li><a href="../pt438606/index.html">Degradação graciosa. Relatório Yandex.Taxi</a></li>
<li><a href="../pt438610/index.html">Templates Figma responsivos: Criando um componente de design flexível para navegação móvel iOS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>