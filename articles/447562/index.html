<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïß üßî üë©üèæ‚Äçü§ù‚Äçüë®üèΩ Introducci√≥n a la ingenier√≠a inversa: formato de datos de juegos de pirater√≠a ü¶Ö üêë üë©üèΩ‚Äçüî¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduccion 
 La ingenier√≠a inversa de un archivo de datos desconocido puede describirse como un proceso de comprensi√≥n gradual. En muchos sentidos, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Introducci√≥n a la ingenier√≠a inversa: formato de datos de juegos de pirater√≠a</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447562/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/xm/us/qv/xmusqvwf26b55v59lw13mtqxrru.png"></div><br><h3>  Introduccion </h3><br>  La ingenier√≠a inversa de un archivo de datos desconocido puede describirse como un proceso de comprensi√≥n gradual.  En muchos sentidos, se asemeja a un m√©todo cient√≠fico, solo aplicado a objetos abstractos creados por el hombre, y no al mundo natural.  Comenzamos recolectando datos y luego usamos esta informaci√≥n para presentar una o m√°s hip√≥tesis.  Probamos las hip√≥tesis y aplicamos los resultados de estas pruebas para aclararlas.  Si es necesario, repita el proceso. <br><br>  Desarrollar habilidades de ingenier√≠a inversa es b√°sicamente una cuesti√≥n de pr√°ctica.  Al ganar experiencia, construye una comprensi√≥n intuitiva de lo que necesita explorar en primer lugar, qu√© patrones debe buscar y qu√© herramientas son m√°s convenientes de usar. <br><br>  En este art√≠culo, hablar√© en detalle sobre el proceso de los archivos de datos de ingenier√≠a inversa de un viejo juego de computadora para demostrar c√≥mo se hace esto. <br><br><h3>  Un poco de historia </h3><br>  Todo comenz√≥ cuando intent√© recrear el <em>Chip's Challenge</em> en Linux. <br><br>  El <em>Chip's Challenge</em> se lanz√≥ originalmente en 1989 para la ahora olvidada consola port√°til Atari Lynx.  Para ese momento, Atari Lynx era un autom√≥vil impresionante, pero sali√≥ al mismo tiempo que el Nintendo Game Boy, que finalmente captur√≥ el mercado. <br><br>  <em>Chip's Challenge</em> es un juego de rompecabezas con una vista superior y un mapa en mosaico.  Como con la mayor√≠a de estos juegos, el objetivo de cada nivel es llegar a la salida.  En la mayor√≠a de los niveles, la salida est√° protegida por un conector para el chip, que solo se puede omitir mediante la recopilaci√≥n de un cierto n√∫mero de chips de computadora. <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d7a/ec3/52a/d7aec352a9ecea5a20825cb1d7eb1273.jpg" alt="imagen"></div><br>  Video: <a href="">Atari Lynx en acci√≥n</a> , <a href="">tutorial de nivel uno</a> . <br><br>  Un nuevo juego comienza desde el primer nivel bajo el nombre "LECCI√ìN 1".  Adem√°s de chips y una ranura para un chip, aparecen llaves y puertas.  En otros niveles, surgen obst√°culos como trampas, bombas, agua y criaturas que (con mayor frecuencia) se mueven a lo largo de rutas predecibles.  Una amplia gama de objetos y dispositivos le permite crear muchos rompecabezas y l√≠mites de tiempo.  Para completar el juego debes pasar por m√°s de 140 niveles. <br><br>  Aunque Lynx finalmente fracas√≥, el <em>Chip's Challenge</em> demostr√≥ ser bastante popular y fue portado a muchas otras plataformas, apareciendo finalmente en Microsoft Windows, donde se generaliz√≥.  Alrededor del juego, se form√≥ una peque√±a pero dedicada base de fan√°ticos, y con el tiempo, se escribi√≥ un editor de niveles que permit√≠a a los jugadores crear innumerables niveles. <br><br>  Y aqu√≠ es donde comienza mi historia.  Decid√≠ que quer√≠a crear una versi√≥n del motor de juego b√°sico de c√≥digo abierto para poder jugar <em>Chip's Challenge</em> en Linux y Windows, y facilitar la ejecuci√≥n de todos los niveles creados por los fan√°ticos. <br><br>  La existencia del editor de niveles result√≥ ser un milagro para m√≠, porque pude explorar las caracter√≠sticas ocultas de la l√≥gica del juego, creando mis propios niveles y realizando pruebas.  Desafortunadamente, no hab√≠a un editor de niveles para el juego Lynx original; apareci√≥ solo en el puerto m√°s conocido en Windows. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a57/5e9/279/a575e927941878177f8b346378d1735d.jpg" alt="imagen"></div><br>  El puerto de Windows no fue creado por los desarrolladores originales, por lo que aparecieron muchos cambios en la l√≥gica del juego (y no todos fueron intencionales).  Cuando comenc√© a escribir mi motor, quer√≠a recrear en √©l la l√≥gica del juego original en Lynx y la versi√≥n m√°s conocida para Windows.  Pero la falta de un editor de niveles en Lynx limit√≥ seriamente mi capacidad de estudiar el juego original en detalle.  El puerto de Windows ten√≠a una ventaja: los niveles se almacenaban en un archivo de datos separado, lo que simplificaba su detecci√≥n e ingenier√≠a inversa.  El juego para Lynx se distribuy√≥ en cartuchos ROM que conten√≠an im√°genes de sprites, efectos de sonido y c√≥digo de m√°quina, as√≠ como datos de nivel que se ejecutaron todos juntos.  No hay ninguna pista sobre d√≥nde se encuentran los datos en este volcado de 128 kilobytes de la ROM, o c√≥mo se ve, y sin este conocimiento, no podr√≠a crear un editor de niveles para la versi√≥n Lynx. <br><br>  Una vez, en un lento proceso de investigaci√≥n, me encontr√© con una copia del puerto de <em>Chip's Challenge</em> en MS-DOS.  Al igual que con la mayor√≠a de los primeros puertos del juego, su l√≥gica estaba m√°s cerca del original que en la versi√≥n de Windows.  Cuando mir√© los datos del programa para averiguar c√≥mo se almacenan, me sorprendi√≥ descubrir que los datos de nivel se asignaron en un directorio separado, y cada nivel se almacen√≥ en su propio archivo.  Teniendo tan convenientemente separados los datos de nivel, suger√≠ que no ser√≠a demasiado dif√≠cil realizar ingenier√≠a inversa en los archivos de datos de nivel.  Y esto te permitir√° escribir un editor de niveles para la versi√≥n del juego en MS-DOS.  Decid√≠ que esta era una oportunidad interesante. <br><br>  Pero luego otro miembro de la comunidad de <em>Chip's Challenge</em> me advirti√≥ de un hecho interesante.  El contenido de los archivos de nivel para MS-DOS result√≥ ser un volcado de bytes de ROM Lynx.  Esto significaba que si pod√≠a decodificar los archivos de MS-DOS, podr√≠a utilizar este conocimiento para leer y cambiar los niveles dentro del volcado de Lynx ROM.  Luego puedes crear un editor de niveles directamente para el juego original en Lynx. <br><br>  De repente, mi principal prioridad eran los archivos de nivel de ingenier√≠a inversa para MS-DOS. <br><br><h3>  Archivos de datos </h3><br>  Aqu√≠ hay un enlace al directorio <a href="">tarball que</a> contiene todos los archivos de datos.  Lo doy en caso de que quiera repetir despu√©s de m√≠ todos los pasos descritos en este art√≠culo, o intente decodificar los archivos de datos usted mismo. <br><blockquote>  <strong>Es legal?</strong>  Buena pregunta  Dado que estos archivos son solo una peque√±a parte del programa para MS-DOS, y por s√≠ mismos son in√∫tiles, y dado que los publico solo con fines educativos, creo que esto cae dentro de los requisitos de uso justo.  Espero que todas las partes interesadas est√©n de acuerdo conmigo.  (Sin embargo, si recibo una carta amenazadora de abogados, puedo cambiar el art√≠culo para presentar los archivos de datos de una manera divertida y luego declarar que es una parodia). </blockquote><br><h3>  Prerrequisitos </h3><br>  Asumir√© que conoce el c√°lculo hexadecimal, incluso si no conoce la decodificaci√≥n de los valores hexadecimales, y tambi√©n que est√° un poco familiarizado con el shell de Unix.  La sesi√≥n de shell que se muestra en este art√≠culo se ejecuta en un sistema Linux est√°ndar, pero los comandos casi utilizados son utilidades comunes de Unix y se distribuyen ampliamente en otros sistemas similares a Unix. <br><br><h3>  Primer vistazo </h3><br>  Aqu√≠ hay una lista del directorio que contiene los archivos de datos del puerto en MS-DOS: <br><blockquote><pre>  Niveles de $ ls
 all_full.pak cake_wal.pak eeny_min.pak iceberg.pak lesson_5.pak mulligan.pak playtime.pak southpol.pak totally_.pak
 alphabet.pak castle_m.pak elementa.pak ice_cube.pak lecci√≥n_6.pak nice_day.pak potpourr.pak special.pak traffic_.pak
 amsterda.pak catacumba.pak fireflie.pak icedeath.pak lecci√≥n_7.pak nightmar.pak problems.pak spirals.pak trinity.pak
 apartmen.pak cellbloc.pak firetrap.pak icehouse.pak lecci√≥n_8.pak now_you_.pak refracti.pak spooks.pak trust_me.pak
 arcticfl.pak chchchip.pak floorgas.pak invincib.pak langosta_.pak nueces_y.pak reverse_.pak steam.pak undergro.pak
 bolas_o_.pak enfriador.pak forzado_e.pak i.pak lock_blo.pak on_the_r.pak rink.pak stripes.pak up_the_b.pak
 beware_o.pak chipmine.pak force_fi.pak i_slide.pak loop_aro.pak oorto_ge.pak roadsign.pak suicide.pak vanishin.pak
 blink.pak citybloc.pak force_sq.pak jailer.pak memory.pak open_que.pak sampler.pak telebloc.pak victim.pak
 blobdanc.pak colony.pak fortune_.pak jumping_.pak metastab.pak oversea_.pak scavenge.pak telenet.pak vortex.pak
 blobnet.pak corridor.pak four_ple.pak kablam.pak mind_blo.pak pain.pak scoundre.pak t_fair.pak wars.pak
 block_fa.pak cypher.pak four_squ.pak knot.pak mishmesh.pak paranoia.pak vista_s.pak the_last.pak escritores_.pak
 block_ii.pak deceptio.pak glut.pak ladder.pak miss_dir.pak partial_.pak short_ci.pak the_mars.pak yorkhous.pak
 block_n_.pak deepfree.pak goldkey.pak lemmings.pak mixed_nu.pak pentagra.pak shrinkin.pak the_pris.pak
 block_ou.pak digdirt.pak go_with_.pak lesson_1.pak mix_up.pak perfect_.pak skelzie.pak three_do.pak
 block.pak digger.pak grail.pak lecci√≥n_2.pak monster_.pak pier_sev.pak slide_st.pak time_lap.pak
 bounce_c.pak doublema.pak hidden_d.pak lecci√≥n_3.pak morton.pak ping_pon.pak slo_mo.pak torturec.pak
 brushfir.pak drawn_an.pak hunt.pak lesson_4.pak mugger_s.pak playhous.pak socialis.pak tossed_s.pak </pre></blockquote>  Como puede ver, todos los archivos terminan en <code>.pak</code> .  <code>.pak</code> es el permiso est√°ndar para el archivo de datos de la aplicaci√≥n, y esto, desafortunadamente, no nos brinda ninguna informaci√≥n sobre su estructura interna.  Los nombres de archivo son los primeros ocho caracteres del nombre del nivel, con algunas excepciones.  (Por ejemplo, en los nombres de los archivos de nivel "BLOCK BUSTER" y "BLOCK BUSTER II" se omite la palabra "buster" para que no coincidan). <br><blockquote><pre>  Niveles de $ ls |  wc
      17 148 1974 </pre></blockquote>  Hay 148 archivos de datos en el directorio, y el juego en realidad tiene exactamente 148 niveles, por lo que aqu√≠ todo es igual. <br><br>  Ahora examinemos qu√© son estos archivos.  <code>xxd</code> es una utilidad est√°ndar para descargar datos hexadecimales (hexdump).  Veamos c√≥mo se ve dentro de la LECCI√ìN 1. <br><blockquote><pre>  $ xxd niveles / lecci√≥n_1.pak
 00000000: 1100 cb00 0200 0004 0202 0504 0407 0505 ................
 00000010: 0807 0709 0001 0a01 010b 0808 0d0a 0a11 ................
 00000020: 0023 1509 0718 0200 2209 0d26 0911 270b. # ...... ".. &amp; .. '.
 00000030: 0b28 0705 291e 0127 2705 020d 0122 0704. (..) ..''.... "..
 00000040: 0902 090a 0215 0426 0925 0111 1502 221d ....... &amp;.% .... ".
 00000050: 0124 011d 0d01 0709 0020 001b 0400 1a00. $ ....... ......
 00000060: 2015 2609 1f00 3300 2911 1522 2302 110d. &amp; ... 3.) .. "# ...
 00000070: 0107 2609 1f18 2911 1509 181a 0223 021b .. &amp; ...) ...... # ..
 00000080: 0215 2201 1c01 1c0d 0a07 0409 0201 0201 .. ".............
 00000090: 2826 0123 1505 0902 0121 1505 220a 2727 (&amp;. # .....! .. ". ''
 000000a0: 0b05 0400 060b 0828 0418 780b 0828 0418 ....... (.. x .. (..
 000000b0: 700b 0828 0418 6400 1710 1e1e 1a19 0103 p .. (.. d .........
 000000c0: 000e 1a17 1710 0e1f 010e 1314 1b29 1f1a .............) ..
 000000d0: 0012 101f 011b 0c1e 1f01 1f13 1001 0e13 ................
 000000e0: 141b 001e 1a0e 1610 1f2d 0020 1e10 0116 .........-.  ....
 000000f0: 1024 291f 1a01 1a1b 1019 000f 1a1a 1d1e. $) .............
 00000100: 2d02 </pre></blockquote><blockquote>  <strong>¬øQu√© es una utilidad hexdump?</strong>  Un volcado hexadecimal es una forma est√°ndar de mostrar los bytes exactos de un archivo binario.  La mayor√≠a de los valores de bytes no se pueden asociar con caracteres ASCII imprimibles, o tienen una apariencia incomprensible (como un car√°cter de tabulaci√≥n).  En un volcado hexadecimal, los bytes individuales se emiten como valores num√©ricos.  Los valores se muestran en hexadecimal, de ah√≠ el nombre.  En el ejemplo anterior, se muestran 16 bytes en una l√≠nea de salida.  La columna m√°s a la izquierda muestra la posici√≥n de la l√≠nea en el archivo, tambi√©n en hexadecimal, por lo que el n√∫mero en cada l√≠nea aumenta en 16. Los bytes se muestran en ocho columnas y se muestran dos bytes en cada columna.  El hexdump de la derecha muestra c√≥mo se ver√≠an los bytes cuando se muestran con caracteres, solo todos los valores ASCII no imprimibles se reemplazan por puntos.  Esto facilita la b√∫squeda de cadenas que se pueden incrustar en un archivo binario. </blockquote>  Obviamente, la ingenier√≠a inversa de estos archivos no se reducir√° a solo explorar los contenidos y explorar lo que est√° visible all√≠.  Hasta ahora, no hay nada que nos diga qu√© funciones realizan los datos. <br><br><h3>  ¬øQu√© esperamos ver? </h3><br>  Retrocedamos y aclaremos la situaci√≥n: ¬øqu√© datos espec√≠ficos esperamos encontrar en estos archivos de datos? <br><br>  Lo m√°s obvio es un cierto "mapa" del nivel: datos que indican las posiciones de paredes y puertas, as√≠ como todo lo dem√°s, lo que hace que el nivel sea √∫nico. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fe5/03a/ae9/fe503aae95f2acaa3a3663c43f528cef.png"></div><br>  (Afortunadamente para nosotros, los fan√°ticos del juego hicieron un trabajo minucioso y recolectaron mapas completos para los 148 niveles, por lo que podemos usarlos para saber qu√© deber√≠a estar en cada mapa). <br><br>  Adem√°s del mapa, cada nivel debe tener varios otros atributos.  Por ejemplo, puede observar que cada nivel tiene un nombre, por ejemplo, "LECCI√ìN 1", "PARTIDO PERFECTO", "SORTEADO Y CUARTRADO", y as√≠ sucesivamente.  Los diferentes niveles tambi√©n tienen l√≠mites de tiempo diferentes, por lo que podemos suponer que esta informaci√≥n tambi√©n est√° contenida en los datos.  Adem√°s, cada nivel tiene su propio n√∫mero de chips ensamblados.  (Podr√≠amos suponer que este n√∫mero simplemente corresponde al n√∫mero de chips en el nivel, pero resulta que en algunos niveles hay m√°s chips de los necesarios para abrir el conector del chip. Al menos para estos niveles, el n√∫mero m√≠nimo debe indicarse en forma expl√≠cita). <br><br>  Otro dato que esperamos encontrar en los datos de nivel es el texto de la sugerencia.  En algunos niveles hay un "bot√≥n de sugerencia": un gran signo de interrogaci√≥n tirado en el suelo.  Cuando el Chip se levanta, se muestra un texto de informaci√≥n sobre herramientas.  El bot√≥n de pista est√° a unos 20 niveles. <br><br>  Finalmente, cada nivel tiene una contrase√±a, una secuencia de cuatro letras que le permite al jugador continuar el juego desde este nivel.  (Esta contrase√±a es necesaria porque Lynx no tiene un almac√©n de datos. Era imposible guardar juegos en la consola, por lo que podr√≠a seguir jugando despu√©s de encender la consola usando contrase√±as). <br><br>  As√≠ que aqu√≠ est√° nuestra lista de datos relevantes: <br><br><ul><li>  Mapa de nivel </li><li>  Nombre de nivel </li><li>  Nivel de contrase√±a </li><li>  L√≠mite de tiempo </li><li>  Numero de chips </li><li>  Texto de informaci√≥n sobre herramientas </li></ul><br>  Vamos a estimar aproximadamente el tama√±o total de los datos.  La forma m√°s f√°cil de determinar el l√≠mite de tiempo y la cantidad de fichas.  Ambos par√°metros pueden tener valores en el rango de 0 a 999, por lo que probablemente se almacenan como valores enteros con un tama√±o total de 4 bytes.  La contrase√±a siempre consta de cuatro letras, por lo que probablemente se almacena como cuatro bytes m√°s, es decir, solo 8 bytes.  La longitud de los nombres de los niveles var√≠a de cuatro a diecinueve caracteres.  Si suponemos que necesitamos otro byte para completar la l√≠nea, entonces esto es veinte bytes, es decir, el subtotal es 28 bytes.  El texto de informaci√≥n sobre herramientas m√°s largo tiene m√°s de 80 bytes de tama√±o;  Si redondeamos este valor a 90, obtendremos 118 bytes en total. <br><br>  ¬øQu√© pasa con el esquema de nivel?  La mayor√≠a de los niveles tienen un tama√±o de 32 √ó 32 fichas.  Los niveles m√°s grandes no existen.  Algunos niveles son m√°s bajos, pero ser√≠a l√≥gico suponer que simplemente est√°n incrustados en una tarjeta de 32 √ó 32. Si asumimos que se requiere un byte para un mosaico, entonces se necesitan 1024 bytes para el circuito completo.  Es decir, en general, obtenemos una estimaci√≥n aproximada de 1142 bytes por nivel.  Por supuesto, esto es solo una estimaci√≥n inicial aproximada.  Es posible que algunos de estos elementos se almacenen de manera diferente, o que no se almacenen en absoluto dentro de los archivos de nivel.  O pueden contener otros datos que no notamos o que no conocemos.  Pero hasta ahora hemos sentado una buena base. <br><br>  Habiendo decidido lo que esperamos ver en los archivos de datos, volvamos a estudiar lo que realmente contienen. <br><br><h3>  ¬øQu√© hay y qu√© no? </h3><br>  Aunque a primera vista el archivo de datos parece completamente incomprensible, a√∫n puede notar un par de puntos en √©l.  En primer lugar, esto es lo que <em>no</em> vemos.  Por ejemplo, no vemos el nombre del nivel o el texto de los consejos.  Puedes entender que esto no es una coincidencia, habiendo estudiado otros archivos: <br><blockquote><pre>  $ niveles de cadenas / * |  menos
 : !!; #
 &amp;&gt; '' :: 4 #
 . ,,!
 -54 ";
 / Y 67
 !) 60
 &lt;171
 * (0 *
 82&gt; '= /
 8&gt; &lt;171 &amp;&amp;
 9&gt; # 2 ') (
 ,) 9
  0hX
 `@PX
 ) "" *
 24 ** 5
 ;)) &lt;
 B777: .. 22C1
 E ,, F
 -GDED
 EGFF16G ;; H &lt;
 IECJ
 9K444
 = MBBB &gt;&gt; N9 "O" 9P3? Q
 l√≠neas 1-24 / 1544 (m√°s) </pre></blockquote>  Aqu√≠ no se ve nada excepto fragmentos arbitrarios de basura ASCII. <br><br>  Presumiblemente, en alg√∫n lugar de estos archivos hay nombres de nivel y sugerencias, pero no est√°n almacenados en ASCII o han sufrido alguna transformaci√≥n (por ejemplo, debido a la compresi√≥n). <br><br>  Tambi√©n vale la pena se√±alar lo siguiente: el archivo apenas alcanza los 256 bytes de tama√±o.  Esto es bastante peque√±o, considerando que inicialmente estimamos su tama√±o en m√°s de 1140 bytes. <br><br>  La opci√≥n <code>-S</code> ordena los archivos en orden descendente de tama√±o. <br><br><blockquote><pre>  $ ls -lS niveles |  cabeza
 total 592
 -rw-r - r-- 1 breadbox breadbox 680 23 de junio de 2015 mulligan.pak
 -rw-r - r-- 1 breadbox breadbox 675 23 de junio de 2015 shrinkin.pak
 -rw-r - r-- 1 breadbox breadbox 671 23 de junio de 2015 balls_o_.pak
 -rw-r - r-- 1 breadbox breadbox 648 23 de junio de 2015 cake_wal.pak
 -rw-r - r-- 1 breadbox breadbox 647 23 de junio de 2015 citybloc.pak
 -rw-r - r-- 1 breadbox breadbox 639 23 de junio de 2015 four_ple.pak
 -rw-r - r-- 1 breadbox breadbox 636 23 de junio de 2015 trust_me.pak
 -rw-r - r-- 1 breadbox breadbox 625 23 de junio de 2015 block_n_.pak
 -rw-r - r-- 1 breadbox breadbox 622 23 jun. 2015 mix_up.pak </pre></blockquote><br>  El archivo m√°s grande toma solo 680 bytes, y esto no es mucho.  ¬øY cu√°l ser√° el m√°s peque√±o? <br><br>  La opci√≥n <code>-r</code> le dice a <code>ls</code> que invierta el orden. <br><br><blockquote><pre>  $ ls -lSr niveles |  cabeza
 total 592
 -rw-r - r-- 1 breadbox breadbox 206 23 de junio de 2015 kablam.pak
 -rw-r - r-- 1 breadbox breadbox 214 23 de junio de 2015 fortune_.pak
 -rw-r - r-- 1 breadbox breadbox 219 23 de junio de 2015 digdirt.pak
 -rw-r - r-- 1 breadbox breadbox 226 23 de junio de 2015 lecci√≥n_2.pak
 -rw-r - r-- 1 breadbox breadbox 229 23 de junio de 2015 lecci√≥n_8.pak
 -rw-r - r-- 1 breadbox breadbox 237 23 de junio de 2015 partial_.pak
 -rw-r - r-- 1 breadbox breadbox 239 23 de junio de 2015 knot.pak
 -rw-r - r-- 1 breadbox breadbox 247 23 de junio de 2015 cellbloc.pak
 -rw-r - r-- 1 breadbox breadbox 248 23 de junio de 2015 torturec.pak </pre></blockquote><br>  El archivo m√°s peque√±o ocupa solo 206 bytes, que es m√°s de tres veces m√°s peque√±o que el m√°s grande.  Este es un rango bastante amplio, teniendo en cuenta el hecho de que esper√°bamos aproximadamente los mismos tama√±os de nivel. <br><br>  En nuestra evaluaci√≥n inicial, asumimos que la tarjeta necesitar√≠a un byte por mosaico y solo 1024 bytes.  Si reducimos esta estimaci√≥n a la mitad, es decir, cada mosaico requerir√° solo 4 bits (o dos mosaicos por byte), entonces la tarjeta seguir√° ocupando 512 bytes.  512 es m√°s peque√±o que 680, pero a√∫n m√°s grande que la mayor√≠a de los niveles.  Y en cualquier caso, 4 bits proporcionar√°n solo 16 valores diferentes, y en el juego hay muchos m√°s objetos diferentes. <br><br>  Es decir, es obvio que las tarjetas no se almacenan en estos archivos en forma abierta.  Utilizan una codificaci√≥n m√°s compleja, que proporciona una descripci√≥n m√°s eficiente, y / o de alguna manera est√°n comprimidos.  Por ejemplo, en el nivel "LECCI√ìN 1", podemos ver c√≥mo las entradas faltantes para los mosaicos "vac√≠os" reducir√°n significativamente el tama√±o general de los datos del mapa. <br><br>  Podemos ver mapas de los archivos m√°s grandes: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b9c/175/2b5/b9c1752b51bd23f6dda6893236e0de52.png"></div><br>  <i>Nivel 57 Mapa: EXTRA√ëO MAZE</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/193/6ec/806/1936ec8062fe1d211522161d7322c213.png"></div><br>  <i>Tarjeta de nivel 98: RESTRICCI√ìN</i> <br><br>  y luego comp√°relos con mapas de los archivos m√°s peque√±os: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/522/4ef/687/5224ef6870b3120bb4cdc7bf0fde9322.png"></div><br>  <i>Tarjeta de nivel 106: KABLAM</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/812/ac5/5c0/812ac55c04b62d73430a182064af2d90.png"></div><br>  <i>Tarjeta de nivel 112: FORTUNE FAVORECE LA</i> <br><br>  Esta comparaci√≥n respalda nuestra idea de que los archivos de datos peque√±os corresponden a niveles m√°s simples o contienen m√°s redundancia.  Por ejemplo, si los datos est√°n comprimidos por alg√∫n tipo de codificaci√≥n de longitud de ejecuci√≥n, esto puede explicar f√°cilmente los intervalos de tama√±o de diferentes archivos. <br><br>  Si los archivos est√°n realmente encriptados, lo m√°s probable es que tengamos que descifrar la compresi√≥n antes de proceder a descifrar los datos de la tarjeta. <br><br><h3>  Estudiamos varios archivos al mismo tiempo. </h3><br>  Nuestro breve estudio del primer archivo de datos nos permiti√≥ hacer algunas suposiciones, pero no encontramos nada concreto.  Como siguiente paso, comenzaremos a explorar los patrones de varios archivos de datos.  Por ahora, suponemos que los 148 archivos usan el mismo esquema de orden para codificar datos, por lo que buscar patrones duplicados en estos archivos nos ayudar√° a comenzar. <br><br>  Comencemos desde el comienzo de los mosaicos.  Lo m√°s probable es que la parte superior del archivo se use para almacenar "metadatos" que nos informan sobre el contenido del archivo.  Al observar solo la primera l√≠nea del volcado hexadecimal, podemos realizar una comparaci√≥n simple y r√°pida de los primeros 16 bytes y buscar patrones prominentes en ellos: <br><br><blockquote><pre>  $ para f en niveles / *;  hacer xxd $ f |  sed -n 1p;  hecho |  menos
 00000000: 2300 dc01 0300 0004 0101 0a03 030b 2323 # ............. ##
 00000000: 2d00 bf01 0300 0015 0101 2203 0329 2222 -... "..)"
 00000000: 2b00 a101 0301 0105 0000 0601 0207 0505 + ...............
 00000000: 1d00 d300 0200 0003 0101 0402 0205 0102 ................
 00000000: 2d00 7a01 0300 0006 1414 0701 0109 0303 -.z .............
 00000000: 3100 0802 0200 0003 0101 0502 0206 1313 1 ...............
 00000000: 1a00 b700 0200 0003 0100 0502 0206 0101 ................
 00000000: 1a00 0601 0300 0005 0001 0601 0107 0303 ................
 00000000: 2000 7a01 0200 0003 0202 0401 0105 0028 .z ............ (
 00000000: 3a00 a400 0200 0003 2828 0428 0205 0303: ....... ((. (....
 00000000: 2600 da00 0300 0004 0507 0901 010a 0303 y ...............
 00000000: 2400 f000 0300 0004 0303 0504 0407 0101 $ ...............
 00000000: 2a00 ef01 0300 0005 0101 0614 0007 0303 * ...............
 00000000: 2c00 8c01 0300 0004 0303 0500 0107 0101, ...............
 00000000: 2a00 0001 0300 0004 0303 0501 0107 0404 * ...............
 00000000: 1b00 6d01 0200 0003 0101 0502 0206 0003 ..m .............
 00000000: 1e00 1701 0200 0003 0202 0401 0105 0013 ................
 00000000: 3200 ee01 0f00 0015 0101 270f 0f29 1414 2 ......... '..) ..
 00000000: 2a00 5b01 0300 0005 0303 0601 0107 1414 *. [.............
 00000000: 2c00 8a01 0200 0003 0202 0401 0105 0303, ...............
 00000000: 1d00 9c00 0216 1604 0000 0516 0107 0205 ................
 00000000: 2000 e100 0200 0003 0101 0402 0205 0303 ...............
 00000000: 2000 2601 0300 0004 0303 0502 0207 0101. &amp; .............
 00000000: 1f00 f600 0132 0403 0000 0532 3206 0404 ..... 2 ..... 22 ...
 l√≠neas 1-24 / 148 (m√°s) </pre></blockquote><br>  Al observar este volcado, puede ver que en cada columna hay algunos valores similares. <br><br>  Comenzando con el primer byte, pronto nos damos cuenta de que su valor est√° en un rango muy limitado de valores, en el rango de hexadecimal <code>40</code> (o aproximadamente <code>20‚Äì60</code> en decimal).  Esta es una caracter√≠stica bastante espec√≠fica. <br><br>  A√∫n m√°s interesante es que el segundo byte de cada archivo siempre es cero, sin excepciones.  El segundo byte probablemente no se usa o es un marcador de posici√≥n.  Sin embargo, existe otra posibilidad: estos dos primeros bytes juntos representan un valor de 16 bits almacenado en orden little endian. <br><br><blockquote>  <strong>¬øQu√© es little endian?</strong>  Al almacenar un valor num√©rico que es m√°s de un byte, primero debe seleccionar el orden en que se almacenar√°n los bytes.  Si primero almacena un byte que representa la parte m√°s peque√±a del n√∫mero, esto se llama orden directo ( <em>little-endian</em> );  si primero almacena bytes que denotan la mayor parte del n√∫mero, entonces este es el orden inverso ( <em>big-endian</em> ).  Por ejemplo, escribimos los valores decimales en orden inverso (big-endian): la l√≠nea "42" significa "cuarenta y dos", no "cuatro y veinte".  Little-endian es un orden natural para muchas familias de microprocesadores, por lo que suele ser m√°s popular, con la excepci√≥n de los protocolos de red, que generalmente requieren big-endian. </blockquote><br>  Si continuamos el an√°lisis, pronto veremos que el tercer byte en el archivo no es similar a los dos anteriores: su valor var√≠a en un amplio rango.  Sin embargo, el cuarto byte siempre es <code>00</code> , <code>01</code> o <code>02</code> , y <code>01</code> es el m√°s com√∫n.  Esto tambi√©n nos sugiere que estos dos bytes constituyen otro valor de 16 bits, que est√° aproximadamente en el rango de valores decimales 0-700.  Esta hip√≥tesis tambi√©n puede confirmarse por el hecho de que el valor del tercer byte suele ser bajo si el valor del cuarto byte es <code>02</code> , y generalmente grande si el cuarto byte es <code>00</code> . <br><br>  Por cierto, vale la pena se√±alar que esta es en parte la raz√≥n por la que el formato de volcado hexadecimal muestra bytes en pares de forma predeterminada, esto facilita la lectura de una secuencia de n√∫meros enteros de 16 bits.  El formato de volcado hexadecimal se estandariz√≥ cuando se usaban computadoras de 16 bits.  Intente reemplazar <code>xxd</code> con <code>xxd -g1</code> para deshabilitar por completo la agrupaci√≥n, y notar√° que reconocer pares de bytes en el medio de una l√≠nea es mucho trabajo.  Este es un ejemplo simple de c√≥mo las herramientas utilizadas para estudiar datos desconocidos tienden a hacernos notar ciertos tipos de patrones.  Es bueno que <code>xxd</code> resalte este patr√≥n de forma predeterminada porque es muy com√∫n (incluso hoy, cuando las computadoras de 64 bits se usan en todas partes).  Pero es √∫til saber c√≥mo cambiar estos par√°metros si no ayudan. <br><br>  Continuemos la exploraci√≥n visual y veamos si este patr√≥n se conserva de los valores enteros de 16 bits.  El quinto byte generalmente tiene valores muy bajos: <code>02</code> y <code>03</code> encuentran con mayor frecuencia, y el valor m√°ximo parece ser <code>05</code> .  El sexto byte de un archivo es a menudo cero, pero a veces contiene valores mucho m√°s grandes, como <code>32</code> o <code>2C</code> .  En este par, nuestra suposici√≥n sobre los valores distribuidos en el intervalo no est√° particularmente confirmada. <br><br><h3>  Estudiamos cuidadosamente los valores iniciales. </h3><br>  Podemos probar nuestra suposici√≥n utilizando <code>od</code> para generar un volcado hexadecimal.  La utilidad <code>od</code> es similar a <code>xxd</code> , pero proporciona una selecci√≥n mucho mayor de formatos de salida.  Podemos usarlo para volcar la salida como enteros decimales de 16 bits: <br><br>  La opci√≥n <code>-t</code> de la utilidad <code>od</code> especifica el formato de salida.  En este caso, <code>u</code> representa n√∫meros decimales sin signo y <code>2</code> representa dos bytes por registro.  (Tambi√©n puede especificar este formato utilizando la opci√≥n <code>-d</code> ). <br><br><blockquote><pre>  $ para f en niveles / *;  do od -tu2 $ f |  sed -n 1p;  hecho |  menos
 0000000 35 476 3 1024 257 778 2819 8995
 0000000 45447 3 5376 257 802 10499 8738
 0000000 43417259 1281 0262 1794 1285
 0000000 29211 2 768 257 516 1282 513
 0000000 45378 3 1536 5140 263 2305 771
 0000000 49 520 2 768 257 517 1538 4883
 0000000 26183 2768 1517 1538257
 0000000 26262 3 1280 256 262 1793 771
 0000000 32378 2 768 514 260 1281 10240
 0000000 58164 2768 10280 10244 1282 771
 0000000 38218 3224 1797265 2561 771
 0000000 36240 3 1024771 1029 1796 257
 0000000 42495 3 1280 257 5126 1792 771
 0000000 44396 3 1024 771 5 1793 257
 0000000 42256 3 1024 771 261 1793 1028
 0000000 27 365 2 768 257 517 1538 768
 0000000 30279 2768514260 1281 4864
 0000000 50494 15 5376 257 3879 10511 5140
 0000000 42347 3 1280771262 1793 5140
 0000000 44394 2 768 514 260 1281 771
 0000000 29156 5634 1046 0 5637 1793 1282
 0000000 32 225 2 768 257 516 1282 771
 0000000 32 294 3 1024 771 517 1794 257
 0000000 31246 12801 772 0 12805 1586 1028
 l√≠neas 1-24 / 148 (m√°s) </pre></blockquote><br>  Este resultado muestra que nuestras suposiciones sobre los primeros bytes fueron correctas.  Vemos que el primer valor de 16 bits est√° en el rango decimal de 20‚Äì70, y el segundo valor de 16 bits est√° en el rango decimal de 100‚Äì600.  Sin embargo, los valores posteriores no se comportan tan bien.  Ciertos patrones aparecen en ellos (por ejemplo, en la cuarta posici√≥n, sorprendentemente a menudo 1024), pero no tienen la repetibilidad inherente a los primeros valores del archivo. <br><br>  Por lo tanto, supongamos primero que los primeros cuatro bytes del archivo son especiales y consisten en dos valores de 16 bits.  Como est√°n al comienzo del archivo, es probable que sean metadatos y ayudan a determinar c√≥mo leer el resto del archivo. <br><br>  De hecho, el segundo intervalo de valores (100‚Äì600) est√° bastante cerca del intervalo de tama√±o de archivo que notamos anteriormente (208‚Äì680).  Tal vez esto no es una coincidencia?  Presentemos una hip√≥tesis: el valor de 16 bits almacenado en el tercer y cuarto bytes del archivo se correlaciona con el tama√±o total del archivo.  Ahora que tenemos una hip√≥tesis, podemos probarla.  Veamos si los archivos grandes en este lugar realmente tienen valores grandes en todo momento, y los peque√±os tienen valores peque√±os. <br><br>  Para mostrar el tama√±o del archivo en bytes sin ninguna otra informaci√≥n, puede usar <code>wc</code> con la opci√≥n <code>-c</code> .  Del mismo modo, puede agregar opciones a <code>od</code> que le permitan mostrar solo los valores que nos interesan.  Luego podemos usar la sustituci√≥n de comandos para escribir estos valores en las variables de shell y mostrarlos juntos: <br><br>  La opci√≥n <code>-An</code> de la utilidad <code>od</code> deshabilita la columna m√°s a la izquierda, que muestra el desplazamiento en el archivo, y <code>-N4</code> le dice a <code>od</code> detenga despu√©s de los primeros 4 bytes del archivo. <br><br><blockquote><pre>  $ para f en niveles / *;  hacer tama√±o = $ (wc -c &lt;$ f);  datos = $ (od -tuS -An -N4 $ f);  echo "$ tama√±o: $ datos";  hecho |  menos
 585: 35 476
 586: 45 447
 550: 43,417
 302: 29,211
 517: 45 378
 671: 49 520
 265: 26 183
 344: 26,262
 478: 32,378
 342: 58 164
 336: 38 218
 352: 36,240
 625: 42 495
 532: 44,396
 386: 42,256
 450: 27 365
 373: 30 279
 648: 50 494
 477: 42 347
 530: 44,394
 247: 29 156
 325: 32,225
 394: 32,294
 343: 31,246 </pre></blockquote><br>  Mirando esta salida, puede ver que los valores est√°n aproximadamente correlacionados.  Los archivos m√°s peque√±os generalmente tienen valores m√°s bajos en la segunda posici√≥n, y los archivos m√°s grandes tienen valores m√°s grandes.  Sin embargo, la correlaci√≥n no es precisa y vale la pena se√±alar que el tama√±o del archivo siempre es significativamente mayor que el valor almacenado en √©l. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adem√°s, el primer valor de 16 bits tambi√©n suele ser m√°s grande con archivos de gran tama√±o, pero la coincidencia tampoco es completa y puede encontrar f√°cilmente ejemplos de archivos de tama√±o mediano con valores relativamente grandes en la primera posici√≥n. Pero tal vez si sumamos estos dos valores, ¬øsu suma estar√° mejor correlacionada con el tama√±o del archivo? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Podemos usar </font></font><code>read</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para extraer dos n√∫meros de la salida </font></font><code>od</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en variables separadas, y luego usar la aritm√©tica de shell para encontrar su suma: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comando de Shell</font></font><code>read</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no se puede usar en el lado derecho de la barra vertical, porque los comandos transferidos a la tuber√≠a se ejecutan en un procesador de comandos secundario (subshell) que, cuando sale, lleva sus variables de entorno al receptor de bits. </font><font style="vertical-align: inherit;">Por lo tanto, en su lugar, debemos usar la funci√≥n de sustituci√≥n del proceso </font></font><code>bash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y dirigir la salida </font></font><code>od</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a un archivo temporal, que luego se puede redirigir al comando </font></font><code>read</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ para f en niveles / *; </font><font style="vertical-align: inherit;">hacer tama√±o = $ (wc -c &lt;$ f); </font><font style="vertical-align: inherit;">lea v1 v2 &lt;&lt; (od -tuS -An -N4 $ f); </font><font style="vertical-align: inherit;">suma = $ (($ v1 + $ v2));</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    echo "$ tama√±o: $ v1 + $ v2 = $ suma"; </font><font style="vertical-align: inherit;">hecho | </font><font style="vertical-align: inherit;">menos</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
585: 35 + 476 = 511</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
586: 45 + 447 = 492</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
550: 43 + 417 = 460</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
302: 29 + 211 = 240</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
517: 45 + 378 = 423</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
671: 49 + 520 = 569</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
265: 26 + 183 = 209</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
344: 26 + 262 = 288</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
478: 32 + 378 = 410</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
342: 58 + 164 = 222</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
336: 38 + 218 = 256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
352: 36 + 240 = 276</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
625: 42 + 495 = 537</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
532: 44 + 396 = 440</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
386: 42 + 256 = 298</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
450: 27 + 365 = 392</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
373: 30 + 279 = 309</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
648: 50 + 494 = 544</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
477: 42 + 347 = 389</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
530: 44 + 394 = 438</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
247: 29 + 156 = 185</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
325: 32 + 225 = 257</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
394: 32 + 294 = 326</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
343: 31 + 246 = 277</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
l√≠neas 1-24 / 148 (m√°s) </font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La suma de los dos n√∫meros tambi√©n se correlaciona aproximadamente con el tama√±o del archivo, pero a√∫n no coinciden. </font><font style="vertical-align: inherit;">¬øQu√© tan diferentes son? </font><font style="vertical-align: inherit;">Demostremos su diferencia:</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ para f en niveles / *; </font><font style="vertical-align: inherit;">hacer tama√±o = $ (wc -c &lt;$ f); </font><font style="vertical-align: inherit;">lea v1 v2 &lt;&lt; (od -tuS -An -N4 $ f); </font><font style="vertical-align: inherit;">diff = $ (($ tama√±o - $ v1 - $ v2));</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    echo "$ tama√±o = $ v1 + $ v2 + $ diff"; </font><font style="vertical-align: inherit;">hecho | </font><font style="vertical-align: inherit;">menos</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
585 = 35 + 476 + 74</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
586 = 45 + 447 + 94</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
550 = 43 + 417 + 90</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
302 = 29 + 211 + 62</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
517 = 45 + 378 + 94</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
671 = 49 + 520 + 102</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
265 = 26 + 183 + 56</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
344 = 26 + 262 + 56</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
478 = 32 + 378 + 68</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
342 = 58 + 164 + 120</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
336 = 38 + 218 + 80</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
352 = 36 + 240 + 76</font></font><font></font>
625 = 42 + 495 + 88<font></font>
532 = 44 + 396 + 92<font></font>
386 = 42 + 256 + 88<font></font>
450 = 27 + 365 + 58<font></font>
373 = 30 + 279 + 64<font></font>
648 = 50 + 494 + 104<font></font>
477 = 42 + 347 + 88<font></font>
530 = 44 + 394 + 92<font></font>
247 = 29 + 156 + 62<font></font>
325 = 32 + 225 + 68<font></font>
394 = 32 + 294 + 68<font></font>
343 = 31 + 246 + 66<font></font>
lines 1-24/148 (more) </pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La diferencia, o el valor "restante", se muestra en el lado derecho de la salida. </font><font style="vertical-align: inherit;">Este valor no cae dentro del patr√≥n constante, pero parece permanecer aproximadamente en un rango limitado de 40-120. </font><font style="vertical-align: inherit;">Y de nuevo, cuanto m√°s grandes son los archivos, generalmente m√°s de su valor residual. </font><font style="vertical-align: inherit;">Pero a veces los archivos peque√±os tambi√©n tienen valores residuales grandes, por lo que esto no es tan constante como nos gustar√≠a. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin embargo, vale la pena se√±alar que los valores de los residuos nunca son negativos. </font><font style="vertical-align: inherit;">Por lo tanto, la idea de que estos dos valores de metadatos indican subsecciones de un archivo sigue siendo atractiva. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Si eres lo suficientemente cuidadoso, ya has visto algo que da una pista sobre una conexi√≥n que a√∫n no se ha notado. Si no lo has hecho, contin√∫a leyendo; el secreto pronto ser√° revelado).</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Grandes comparaciones entre archivos </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En este punto, ser√≠a bueno poder realizar una comparaci√≥n cruzada de m√°s de 16 bytes a la vez. Para esto necesitamos un tipo diferente de visualizaci√≥n. Uno de los buenos enfoques es crear una imagen en la que cada p√≠xel denote un byte separado de uno de los archivos, y el color denote el valor de este byte. Una imagen puede mostrar una porci√≥n de los 148 archivos a la vez si cada archivo de datos se indica mediante una sola fila de p√≠xeles de imagen. Como todos los archivos son de diferentes tama√±os, tomamos los primeros 200 bytes de cada uno para construir una imagen rectangular. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La forma m√°s f√°cil es construir una imagen en escala de grises, en la que el valor de cada byte corresponde a diferentes niveles de gris. Es muy sencillo crear un archivo PGM con nuestros datos, porque el encabezado PGM consta de solo texto ASCII:</font></font><br><br><blockquote><pre> $ echo P5 200 148 255 &gt;hdr.pgm </pre></blockquote><br><blockquote> <strong>   PGM?</strong> PGM,    ¬´portable graymap¬ª (¬´   ¬ª) ‚Äî       ,        :    ASCII,         .        ‚Äî  PBM (¬´portable bitmap¬ª, ¬´  ¬ª),     8   ,  PPM (¬´portable pixmap¬ª, ¬´  ¬ª),     3   . </blockquote><br> <code>P5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es la firma inicial para el formato de archivo PGM. </font><font style="vertical-align: inherit;">Los siguientes dos n√∫meros, </font></font><code>200</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>148</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, especifican el ancho y la altura de la imagen, y el √∫ltimo </font></font><code>255</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, indica el valor m√°ximo por p√≠xel. </font><font style="vertical-align: inherit;">El encabezado PGM termina con una nueva l√≠nea seguida de datos de p√≠xeles. </font><font style="vertical-align: inherit;">(Vale la pena se√±alar que el encabezado PGM a menudo se divide en tres l√≠neas de texto separadas, pero el est√°ndar PGM solo requiere que los elementos est√©n separados por alg√∫n car√°cter de espacio en blanco). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Podemos usar la utilidad </font></font><code>head</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para extraer los primeros 200 bytes de cada archivo:</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ para f en niveles / *; </font><font style="vertical-align: inherit;">hacer cabeza -c200 $ f; </font><font style="vertical-align: inherit;">hecho&gt; out.pgm</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Luego podemos concatenarlos con un encabezado y crear una imagen visualizada: </font></font><br><br> <code>xview</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">este es un antiguo programa X para mostrar im√°genes en una ventana. </font><font style="vertical-align: inherit;">Puede reemplazarlo con su visor de im√°genes favorito, por ejemplo, una utilidad </font></font><code>display</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de ImageMagick, pero tenga en cuenta que sorprendentemente hay muchos visores de im√°genes que no aceptan un archivo de imagen redirigido a la entrada est√°ndar.</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ cat hdr.pgm out.pgm | </font><font style="vertical-align: inherit;">xview / dev / stdin</font></font></pre></blockquote><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/160/236/6cf/1602366cf98b4fd6fd448d5f3cf0b3a8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si le resulta dif√≠cil ver los detalles en una imagen oscura, puede elegir un esquema de color diferente. </font><font style="vertical-align: inherit;">Use la utilidad </font></font><code>pgmtoppm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de ImageMagick para convertir p√≠xeles a un rango diferente de colores. </font><font style="vertical-align: inherit;">Esta versi√≥n crear√° una imagen "negativa":</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ cat hdr.pgm out.pgm | </font><font style="vertical-align: inherit;">pgmtoppm blanco-negro | </font><font style="vertical-align: inherit;">xview / dev / stdin</font></font></pre></blockquote><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/923/1ed/90a/9231ed90a4b0e0b0f94dfb67dc5f4e6d.png"></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Y esta versi√≥n hace que los valores bajos sean amarillos y los valores altos azules: </font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ cat hdr.pgm out.pgm | </font><font style="vertical-align: inherit;">pgmtoppm amarillo-azul | </font><font style="vertical-align: inherit;">xview / dev / stdin</font></font></pre></blockquote><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/44f/61b/53e/44f61b53ecc026af2ad851f24d494c06.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La visibilidad de los colores es una pregunta muy subjetiva, por lo que puede experimentar y elegir cu√°l es el mejor para usted. </font><font style="vertical-align: inherit;">Sea como fuere, la imagen de 200 √ó 148 es bastante peque√±a, por lo que es mejor aumentar la visibilidad aumentando su tama√±o:</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ cat hdr.pgm out.pgm | </font><font style="vertical-align: inherit;">xview -zoom 300 / dev / stdin</font></font></pre></blockquote><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b4d/97a/ed3/b4d97aed3c0baf3086d16c62b146742f.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La imagen es oscura, y esto significa que la mayor√≠a de los bytes contienen valores peque√±os. Una franja notable de p√≠xeles en su mayor√≠a brillantes m√°s cerca del borde izquierdo contrasta con √©l. Esta tira se encuentra en el tercer byte del archivo, que, como dijimos anteriormente, var√≠a en el rango completo de valores. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y aunque no hay muchos valores altos fuera del tercer byte, cuando aparecen, a menudo consisten en series, creando rayas cortas y brillantes en la imagen. Algunas de estas series se interrumpen peri√≥dicamente, creando un efecto de l√≠nea discontinua. (Quiz√°s, con la selecci√≥n de color correcta, ser√° posible notar tales secuencias en colores m√°s oscuros).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Con un estudio cuidadoso de la imagen, se puede entender que principalmente en la parte izquierda dominan peque√±as rayas verticales. Estas bandas nos informan sobre cierta repetibilidad en la mayor√≠a de los archivos. Pero no en todos los archivos, de vez en cuando hay l√≠neas de p√≠xeles donde se interrumpen las bandas, pero esto es m√°s que suficiente para determinar la presencia de un patr√≥n real. Este patr√≥n desaparece en el lado derecho de la imagen, el fondo oscuro de las rayas da paso a algo m√°s ruidoso e indefinido. (Parece que tambi√©n faltan las rayas en la parte izquierda de la imagen, pero, repito, es posible que al usar un esquema de color diferente, pueda ver que comienzan m√°s cerca del borde izquierdo de lo que parece aqu√≠).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las franjas consisten en l√≠neas finas de p√≠xeles ligeramente m√°s brillantes sobre un fondo de p√≠xeles ligeramente m√°s oscuros. Por lo tanto, este patr√≥n gr√°fico debe correlacionarse con el patr√≥n de los archivos de datos en los que valores ligeramente m√°s grandes est√°n igualmente dispersos entre los valores de bytes ligeramente m√°s peque√±os. Parece que las rayas se agotan aproximadamente en el medio de la imagen. Como muestra los primeros 200 bytes de archivos, debe esperar que el patr√≥n de bytes finalice despu√©s de aproximadamente 100 bytes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El hecho de que estos patrones cambien en diferentes archivos de datos deber√≠a llevarnos a la pregunta: ¬øc√≥mo ser√°n los archivos despu√©s de los primeros 200 bytes? Bueno, podemos reemplazar f√°cilmente la utilidad con una </font></font><code>head</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilidad </font></font><code>tail</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y ver c√≥mo se ven los √∫ltimos 200 bytes:</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ para f en niveles / *; </font><font style="vertical-align: inherit;">hacer cola -c200 $ f; </font><font style="vertical-align: inherit;">done&gt; out.pgm; </font><font style="vertical-align: inherit;">gato hdr.pgm out.pgm | </font><font style="vertical-align: inherit;">xview -zoom 300 / dev / stdin</font></font></pre></blockquote><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5b7/e21/262/5b7e2126215bf4e9953890622b4e2767.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inmediatamente vemos que esta √°rea de archivos de datos es muy diferente. </font><font style="vertical-align: inherit;">Aqu√≠, los bytes son mucho m√°s comunes, especialmente hacia el final del archivo. </font><font style="vertical-align: inherit;">(Sin embargo, como antes, prefieren agruparse, cubriendo la imagen con franjas horizontales brillantes.) Parece que la frecuencia de los valores de bytes altos aumenta casi hasta el final, donde se rompe abruptamente y se reemplaza por valores bajos en aproximadamente diez a doce bytes. </font><font style="vertical-align: inherit;">Y el patr√≥n aqu√≠ tampoco es universal, pero es demasiado est√°ndar para ser una coincidencia.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quiz√°s en el medio de los archivos puede haber otras √°reas que a√∫n no hemos considerado. </font><font style="vertical-align: inherit;">Lo siguiente que queremos hacer es examinar los archivos completos de esta manera. </font><font style="vertical-align: inherit;">Pero dado que todos los archivos tienen diferentes tama√±os, no se pueden colocar en una hermosa matriz rectangular de p√≠xeles. </font><font style="vertical-align: inherit;">Podemos llenar el final de cada l√≠nea con p√≠xeles negros, pero ser√≠a mejor cambiarles el tama√±o para que todas las l√≠neas tengan el mismo ancho y las √°reas proporcionales de los diferentes archivos coincidan m√°s o menos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y en realidad podemos hacer esto con un poco m√°s de esfuerzo. </font><font style="vertical-align: inherit;">Puede usar Python y su biblioteca para trabajar con im√°genes </font></font><code>PIL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">("Pillow"): </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">archivo showbytes.py:</font></font><br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> PIL <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Image <span class="hljs-comment"><span class="hljs-comment"># Retrieve the full list of data files. filenames = sys.argv[1:] # Create a grayscale image, its height equal to the number of data files. width = 750 height = len(filenames) image = Image.new('L', (width, height)) # Fill in the image, one row at a time. for y in range(height): # Retrieve the contents of one data file. data = open(filenames[y]).read() linewidth = len(data) # Turn the data into a pixel-high image, each byte becoming one pixel. line = Image.new(image.mode, (linewidth, 1)) linepixels = line.load() for x in range(linewidth): linepixels[x,0] = ord(data[x]) # Stretch the line out to fit the final image, and paste it into place. line = line.resize((width, 1)) image.paste(line, (0, y)) # Magnify the final image and display it. image = image.resize((width, 3 * height)) image.show()</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cuando llamamos a este script, usando la lista completa de archivos de datos como argumentos, crear√° una imagen completa y la mostrar√° en una ventana separada: </font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> $ python showbytes.py niveles / * </font></font></pre></blockquote><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/844/f82/c04/844f82c04bc2b27a36a62ffe2511f8fc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desafortunadamente, aunque esta imagen est√° completa, no nos muestra nada nuevo. </font><font style="vertical-align: inherit;">(Pero en realidad se muestra a√∫n menos, porque el cambio de tama√±o destruy√≥ el patr√≥n de las franjas). Probablemente, para estudiar todo el conjunto de datos, necesitamos un mejor proceso de visualizaci√≥n.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Caracterizar los datos. </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Con esto en mente, deteng√°monos por un momento y completemos un censo completo de datos. </font><font style="vertical-align: inherit;">Necesitamos saber si los archivos de datos dan preferencia a ciertos valores de bytes. </font><font style="vertical-align: inherit;">Por ejemplo, si cada valor suele estar igualmente duplicado, esto ser√° una fuerte evidencia de que los archivos est√°n realmente comprimidos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reescribir </font><font style="vertical-align: inherit;">completamente los valores, solo unas pocas l√≠neas en Python son suficientes: </font><font style="vertical-align: inherit;">El archivo census.py:</font></font><br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys data = sys.stdin.read() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">256</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> c, data.count(chr(c))</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Despu√©s de haber insertado todos los datos en una variable, podemos calcular la frecuencia de aparici√≥n de cada valor de byte. </font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ niveles de gato / * | </font><font style="vertical-align: inherit;">python ./census.py | </font><font style="vertical-align: inherit;">menos</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0 2458</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1 2525</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 1626</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3 1768</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4 1042</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5 1491</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6 1081</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7 1445</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
8 958</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
9 1541</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
10 1279</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
11 1224</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
12,845</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
13 908</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
14 859</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
15 1022</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
16 679</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
17 1087</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
18,881</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
19 1116</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
20 1007</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
21 1189</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
22 1029</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
23,733</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
l√≠neas 1-24 / 256 (m√°s) </font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vemos que con mayor frecuencia hay valores de bytes 0 y 1, los siguientes en frecuencia son 2 y 3, despu√©s de lo cual el n√∫mero contin√∫a disminuyendo (aunque con menos constancia). </font><font style="vertical-align: inherit;">Para visualizar mejor estos datos, podemos transferir la salida </font></font><code>gnuplot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y convertir este censo en un histograma: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la opci√≥n de </font></font><code>-p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilidad </font></font><code>gnuplot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ordena no cerrar la ventana con el gr√°fico despu√©s de completar el trabajo </font></font><code>gnuplot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ niveles de gato / * | </font><font style="vertical-align: inherit;">python ./census.py | </font><font style="vertical-align: inherit;">gnuplot -p -e 'plot "-" con cajas'</font></font></pre></blockquote><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/040/76b/783/04076b783d61f8b6f976333a67a95a25.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es muy notable que los primeros valores de byte son mucho m√°s comunes que todos los dem√°s. </font><font style="vertical-align: inherit;">Varios de los siguientes valores tambi√©n son bastante comunes, y luego las frecuencias de valores de aproximadamente 50 comienzan a disminuir a lo largo de una curva de probabilidad suave. </font><font style="vertical-align: inherit;">Sin embargo, hay un subconjunto de valores altos que se separan uniformemente entre s√≠, cuya frecuencia parece bastante estable. </font><font style="vertical-align: inherit;">Al observar la salida original, podemos asegurarnos de que este subconjunto est√© formado por valores que pueden ser divisibles por ocho.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estas diferencias en el n√∫mero de valores sugieren que hay varias "clases" diferentes de valores de bytes, por lo que ser√° l√≥gico ver c√≥mo se distribuyen estas clases. El primer grupo de valores de bytes ser√°n los valores m√°s bajos: 0, 1, 2 y 3. Luego, el segundo grupo puede tener valores de 4 a 64. Y el tercer grupo tendr√° valores superiores a 64, que son divisibles por 8. Sin dejar rastro, todo lo dem√°s, incluido no divisible por 8 valores mayores que 64 ser√° el cuarto y √∫ltimo grupo.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Con todo esto en mente, podemos cambiar el √∫ltimo script de generaci√≥n de im√°genes escrito. </font><font style="vertical-align: inherit;">En lugar de mostrar los valores reales de cada byte en un color separado, vamos a mostrar a qu√© grupo pertenece cada byte. </font><font style="vertical-align: inherit;">Puede asignar un color √∫nico a cada uno de los cuatro grupos, y esto nos ayudar√° a ver si ciertos valores realmente aparecen en ciertos lugares. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Archivo Showbytes2.py:</font></font><br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> PIL <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Image <span class="hljs-comment"><span class="hljs-comment"># Retrieve the full list of data files. filenames = sys.argv[1:] # Create a color image, its height equal to the number of data files. width = 750 height = len(filenames) image = Image.new('RGB', (width, height)) # Fill in the image, one row at a time. for y in range(height): # Retrieve the contents of one data file. data = open(filenames[y]).read() linewidth = len(data) # Turn the data into a pixel-high image, each byte becoming one pixel. line = Image.new(image.mode, (linewidth, 1)) linepixels = line.load() # Determine which group each byte belongs to and assign it a color. for x in range(linewidth): byte = ord(data[x]) if byte &lt; 0x04: linepixels[x,0] = (255, 0, 0) elif byte &lt; 0x40: linepixels[x,0] = (0, 255, 0) elif byte % 8 == 0: linepixels[x,0] = (0, 0, 255) else: linepixels[x,0] = (255, 255, 255) # Paste the line of pixels into the final image, stretching to fit. line = line.resize((width, 1)) image.paste(line, (0, y)) # Magnify the final image and display it. image = image.resize((width, 3 * height)) image.show()</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Asignamos cuatro grupos rojo, verde, azul y blanco. </font><font style="vertical-align: inherit;">(Nuevamente, puede intentar elegir otros colores que se adapten a sus preferencias).</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> $ python showbytes2.py niveles / * </font></font></pre></blockquote><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/322/77f/f31/32277ff31e600de756627d442671ba9e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gracias a esta imagen, podemos confirmar previamente la exactitud de la separaci√≥n de los archivos de datos en cinco partes: </font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> El encabezado de cuatro bytes que encontramos anteriormente. </font></font></li><li>  ,     ,       (..   ). </li><li>  ,           (.   64). </li><li>    ,      . </li><li>   ,      . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gracias a estos colores, est√° claro que en la cuarta parte, donde prevalecen los valores de byte alto, como se puede ver en la imagen en escala de grises, prevalecen especialmente los valores de byte alto, dividiendo entre 8. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De la imagen anterior sabemos que la segunda parte, es decir, la parte con rayas se extiende sobre un √°rea casi completamente roja. De hecho, en una de las primeras im√°genes vimos que la parte con rayas, que va de izquierda a derecha, se ilumina lentamente en promedio. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vemos nuevamente que los p√≠xeles verdes de la tercera parte principal forman patrones punteados de p√≠xeles verdes y rojos intermitentes (ya sea azul o blanco) de vez en cuando. Sin embargo, este patr√≥n no es particularmente regular y puede ser imaginario.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por supuesto, esta divisi√≥n del archivo en cinco partes es muy arbitraria. </font><font style="vertical-align: inherit;">Una cuarta parte con valores de bytes altos divisibles por ocho puede resultar ser solo el final de la tercera parte. </font><font style="vertical-align: inherit;">O puede resultar que es mejor dividir una tercera parte grande en varias partes que a√∫n no hemos determinado. </font><font style="vertical-align: inherit;">En esta etapa, el descubrimiento de piezas nos ayuda m√°s a encontrar lugares para futuras investigaciones. </font><font style="vertical-align: inherit;">Por ahora, es suficiente para nosotros saber que hay partes en las que cambia la composici√≥n general de los valores de bytes, y una idea aproximada de su tama√±o nos ayudar√° a continuar nuestra investigaci√≥n.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> B√∫squeda de estructura </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© debemos buscar a continuaci√≥n? Bueno, como antes, la forma m√°s f√°cil de comenzar es desde la parte superior del archivo. O m√°s bien, cerca de la cima. Como ya hemos identificado con bastante confianza la primera parte como un encabezado de cuatro bytes, echemos un vistazo m√°s de cerca a lo que viene a continuaci√≥n: el √°rea que llamamos la segunda parte, o parte de las bandas. Estas bandas son el indicio m√°s fuerte de la existencia de la estructura, por lo tanto, es mejor buscar nuevas evidencias de la presencia del patr√≥n aqu√≠. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Por el momento, suponemos que el patr√≥n de tira comienza inmediatamente despu√©s de los primeros cuatro bytes. Visualmente, esto no es obvio, pero parece probable, y examinar los valores de los bytes deber√≠a mostrarnos r√°pidamente la verdad).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Volvamos al volcado hexadecimal, esta vez centr√°ndonos en la segunda parte. </font><font style="vertical-align: inherit;">Recuerde que esperamos encontrar un patr√≥n repetitivo de valores ligeramente m√°s altos distribuidos uniformemente entre valores ligeramente m√°s bajos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La opci√≥n </font></font><code>-s4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ordena </font></font><code>xxd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">omitir los primeros 4 bytes del archivo.</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ para f en niveles / *; </font><font style="vertical-align: inherit;">do xxd -s4 $ f | </font><font style="vertical-align: inherit;">sed -n 1p; </font><font style="vertical-align: inherit;">hecho | </font><font style="vertical-align: inherit;">menos</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 0200 0003 0202 0401 0105 0303 0700 0108 ................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 0201 0104 0000 0504 0407 0202 0902 010a ................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 0300 0004 0303 0504 0407 0505 0801 0109 ................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 0300 0009 0202 1203 0313 0909 1401 0115 ................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 0203 0305 0000 0602 0207 0505 0901 010a ................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 0203 0304 0000 0502 0206 0404 0901 010a ................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 0300 0005 022a 0602 2907 0303 0902 000a ..... * ..) .......</font></font><font></font>
00000004: 0203 0305 0000 0605 0507 0101 0802 0209 ................<font></font>
00000004: 0300 0007 0303 0901 010a 0707 0b09 090c ................<font></font>
00000004: 0300 0004 0101 0903 030e 0404 1609 0920 ...............<font></font>
00000004: 0200 0003 1313 0402 0205 0013 0701 0109 ................<font></font>
00000004: 0500 0006 0505 0701 0109 0606 0e07 070f ................<font></font>
00000004: 0100 0003 0101 0a03 030b 0a0a 0e32 3216 .............22.<font></font>
00000004: 0300 0004 0705 0903 030a 0606 0b08 080c ................<font></font>
00000004: 0200 0003 0701 0402 0209 0501 0a08 080b ................<font></font>
00000004: 0200 0003 0202 0901 010a 0303 0b05 010d ................<font></font>
00000004: 0200 0003 0202 0403 0305 0101 0904 040a ................<font></font>
00000004: 0300 0007 0303 0f01 0115 0707 2114 1422 ............!.."<font></font>
00000004: 0200 0003 0202 0403 0309 0101 0a04 040b ................<font></font>
00000004: 0231 3103 0202 0500 0006 0303 0701 0109 .11.............<font></font>
00000004: 0200 0003 0202 0b32 320c 0303 0e08 0811 .......22.......<font></font>
00000004: 0201 0103 0000 0902 020a 0303 0b09 090c ................<font></font>
00000004: 0200 0003 0202 0a01 010b 0303 0d0b 0b0f ................<font></font>
00000004: 0300 0005 0303 0701 0109 0001 0b05 051b ................<font></font>
lines 27-50/148 (more) </pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al observar cuidadosamente la secuencia de bytes en la cadena, podemos ver un patr√≥n en el que los bytes primero, cuarto, s√©ptimo y d√©cimo son m√°s grandes que sus vecinos m√°s cercanos. Este patr√≥n es imperfecto, tiene excepciones, pero definitivamente es lo suficientemente estable como para crear la repetibilidad visual de las bandas que se ven en todas las im√°genes. (Y es suficiente para confirmar nuestra suposici√≥n de que el patr√≥n de rayas comienza inmediatamente despu√©s del encabezado de cuatro bytes). La </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">constancia de este patr√≥n implica claramente que esta parte del archivo es una matriz o tabla, y cada registro en la matriz tiene una longitud de tres bytes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Puede configurar el formato de volcado hexadecimal para que sea m√°s f√°cil ver la salida como una serie de tripletes: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la opci√≥n </font></font><code>-g3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">establece la agrupaci√≥n por tres bytes en lugar de dos. Opcion</font></font><code>-c18</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> establece 18 bytes (un m√∫ltiplo de 3) por l√≠nea en lugar de 16. </font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ para f en niveles / *; </font><font style="vertical-align: inherit;">do xxd -s4 -g3 -c18 $ f | </font><font style="vertical-align: inherit;">sed -n 1p; </font><font style="vertical-align: inherit;">hecho | </font><font style="vertical-align: inherit;">menos</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 050000 060505 070101 090606 0e0707 0f0001 ..................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 010000 030101 0a0303 0b0a0a 0e3232 161414 ............. 22 ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 030000 040705 090303 0a0606 0b0808 0c0101 ..................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 020000 030701 040202 090501 0a0808 0b0101 ..................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 020000 030202 090101 0a0303 0b0501 0d0302 ..................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 020000 030202 040303 050101 090404 0a0302 ..................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 030000 070303 0f0101 150707 211414 221313 ............! .. "..</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 020000 030202 040303 090101 0a0404 0b0001 ..................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 023131 030202 050000 060303 070101 090505 .11 ...............</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 020000 030202 0b3232 0c0303 0e0808 110b0b ....... 22 .........</font></font><font></font>
00000004: 020101 030000 090202 0a0303 0b0909 0c0a0a ..................<font></font>
00000004: 020000 030202 0a0101 0b0303 0d0b0b 0f2323 ................##<font></font>
00000004: 030000 050303 070101 090001 0b0505 1b0707 ..................<font></font>
00000004: 022323 030000 040202 050303 030101 070505 .##...............<font></font>
00000004: 031414 050000 060303 070505 080101 090707 ..................<font></font>
00000004: 030000 050202 060303 070505 080101 090606 ..................<font></font>
00000004: 030202 040000 050303 070404 080005 090101 ..................<font></font>
00000004: 030202 040000 050303 090404 1d0101 1f0909 ..................<font></font>
00000004: 020000 050303 060101 070202 0f0300 110505 ..................<font></font>
00000004: 050000 070101 0c0505 0d0007 110c0c 120707 ..................<font></font>
00000004: 030202 050000 060303 070505 080101 090606 ..................<font></font>
00000004: 020000 030101 050202 060505 070100 080303 ..................<font></font>
00000004: 020000 030202 050303 090101 0a0505 0b0302 ..................<font></font>
00000004: 022c2c 030000 040202 020303 050101 060202 .,,...............<font></font>
lines 38-61/148 (more) </pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En un volcado formateado de esta forma, algunas otras caracter√≠sticas de este patr√≥n comienzan a aparecer. Como antes, el primer byte de cada triplete suele ser mayor que los bytes que lo rodean. Tambi√©n puede notar que los bytes segundo y tercero de cada triplete a menudo est√°n duplicados. Al bajar la primera columna, veremos que la mayor√≠a de los valores del segundo y tercer bytes son iguales </font></font><code>0000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Pero los valores distintos de cero tambi√©n se encuentran a menudo en pares, por ejemplo, </font></font><code>0101</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o </font></font><code>2323</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Este patr√≥n tambi√©n es imperfecto, pero tiene demasiado en com√∫n como para ser una coincidencia. Y mirando la columna ASCII a la derecha, veremos que cuando tenemos valores de bytes que corresponden al car√°cter ASCII imprimible, a menudo se encuentran en pares.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otro patr√≥n digno de menci√≥n que no se nota de inmediato: el primer byte de cada triple aumenta de izquierda a derecha. Aunque este patr√≥n es menos notable, su estabilidad es alta; Necesitamos mirar muchas l√≠neas antes de encontrar el primer desajuste. Y los bytes generalmente aumentan en valores peque√±os, pero no representan ning√∫n patr√≥n regular. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al estudiar la imagen original, notamos que la parte con las rayas termina en cada archivo no en el mismo lugar. Hay una transici√≥n de crear una franja de patr√≥n a la izquierda a ruido aleatorio a la derecha, pero esta transici√≥n ocurre para cada fila de p√≠xeles en diferentes puntos. Esto implica que debe haber alg√∫n marcador para que el programa que lee el archivo de datos pueda comprender d√≥nde termina la matriz y comienza otro conjunto de datos.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Volvamos al volcado solo el primer nivel para examinar todo el archivo: </font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> $ xxd -s4 -g3 -c18 niveles / lecci√≥n_1.pak</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 020000 040202 050404 070505 080707 090001 ..................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000016: 0a0101 0b0808 0d0a0a 110023 150907 180200 ........... # ......</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000028: 22090d 260911 270b0b 280705 291e01 272705 ".. &amp; .. '.. (..) ..' '.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0000003a: 020d01 220704 090209 0a0215 042609 250111 ... "......... &amp;.% ..</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0000004c: 150222 1d0124 011d0d 010709 002000 1b0400 .. ".. $ ....... ....</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0000005e: 1a0020 152609 1f0033 002911 152223 02110d ... &amp; ... 3.) .. "# ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000070: 010726 091f18 291115 09181a 022302 1b0215 .. &amp; ...) ...... # ....</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000082: 22011c 011c0d 0a0704 090201 020128 260123 "............. (&amp;. #</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000094: 150509 020121 150522 0a2727 0b0504 00060b .....! .. ".''......</font></font><font></font>
000000a6: 082804 18780b 082804 18700b 082804 186400 .(..x..(..p..(..d.<font></font>
000000b8: 17101e 1e1a19 010300 0e1a17 17100e 1f010e ..................<font></font>
000000ca: 13141b 291f1a 001210 1f011b 0c1e1f 011f13 ...)..............<font></font>
000000dc: 10010e 13141b 001e1a 0e1610 1f2d00 201e10 .............-. ..<font></font>
000000ee: 011610 24291f 1a011a 1b1019 000f1a 1a1d1e ...$).............<font></font>
00000100: 2d02 </pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al estudiar la secuencia de tripletes, podemos suponer tentativamente que la parte con bandas en estos datos termina despu√©s de 17 tripletes, por desplazamiento </font></font><code>00000036</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Esto no es exacto, pero el primer byte de cada triplete aumenta constantemente su valor y luego disminuye en el decimoctavo triplete. Una prueba m√°s: en el decimoctavo triplete, el segundo byte tiene el mismo significado que el primero. Todav√≠a no nos hemos dado cuenta de esto, pero si volvemos y miramos, veremos que el primer byte nunca es igual al segundo o tercer byte.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si nuestra teor√≠a de marcadores es correcta, entonces hay dos posibilidades. En primer lugar, es posible que despu√©s de la parte de la tira haya un valor de byte especial (justo despu√©s del decimos√©ptimo triplete). En segundo lugar, es probable que exista un valor almacenado en alg√∫n lugar que sea igual al tama√±o de la parte con franjas. Este tama√±o puede ser igual a 17 (es decir, indica el n√∫mero de tripletes), o 51 (indica el n√∫mero total de bytes en una parte), o 55 (51 m√°s 4, es decir, el desplazamiento del archivo donde termina esta parte). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para la primera opci√≥n, un valor de doble byte puede ser un marcador para el final de la parte (dado que dicha secuencia nunca ocurre en la segunda parte). Sin embargo, el estudio cuidadoso de varios otros archivos de datos contradice esta idea, porque ese patr√≥n no aparece en ning√∫n otro lugar.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para la segunda opci√≥n, obviamente buscar√° el indicador de tama√±o en la primera parte. </font><font style="vertical-align: inherit;">He aqu√≠, el primer valor de 16 bits en el encabezado del archivo de cuatro bytes es 17:</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> $ od -An -tuS -N4 niveles / lecci√≥n_1.pak</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    17 203 </font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si nuestra teor√≠a es correcta, entonces este valor no determina el tama√±o de la parte con franjas, sino el n√∫mero de registros de tres bytes. </font><font style="vertical-align: inherit;">Para probar esta idea, volvamos a la inform√°tica, donde comparamos la suma de dos valores enteros de 16 bits con el tama√±o del archivo. </font><font style="vertical-align: inherit;">Esta vez multiplicamos el primer n√∫mero por tres para obtener el tama√±o real en bytes:</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ para f en niveles / *; </font><font style="vertical-align: inherit;">hacer tama√±o = $ (wc -c &lt;$ f); </font><font style="vertical-align: inherit;">lea v1 v2 &lt;&lt; (od -tuS -An -N4 $ f); </font><font style="vertical-align: inherit;">diff = $ (($ tama√±o - 3 * $ v1 - $ v2));</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    echo "$ tama√±o = 3 * $ v1 + $ v2 + $ diff"; </font><font style="vertical-align: inherit;">hecho | </font><font style="vertical-align: inherit;">menos</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
585 = 3 * 35 + 476 + 4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
586 = 3 * 45 + 447 + 4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
550 = 3 * 43 + 417 + 4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
302 = 3 * 29 + 211 + 4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
517 = 3 * 45 + 378 + 4</font></font><font></font>
671 = 3 * 49 + 520 + 4<font></font>
265 = 3 * 26 + 183 + 4<font></font>
344 = 3 * 26 + 262 + 4<font></font>
478 = 3 * 32 + 378 + 4<font></font>
342 = 3 * 58 + 164 + 4<font></font>
336 = 3 * 38 + 218 + 4<font></font>
352 = 3 * 36 + 240 + 4<font></font>
625 = 3 * 42 + 495 + 4<font></font>
532 = 3 * 44 + 396 + 4<font></font>
386 = 3 * 42 + 256 + 4<font></font>
450 = 3 * 27 + 365 + 4<font></font>
373 = 3 * 30 + 279 + 4<font></font>
648 = 3 * 50 + 494 + 4<font></font>
477 = 3 * 42 + 347 + 4<font></font>
530 = 3 * 44 + 394 + 4<font></font>
247 = 3 * 29 + 156 + 4<font></font>
325 = 3 * 32 + 225 + 4<font></font>
394 = 3 * 32 + 294 + 4<font></font>
343 = 3 * 31 + 246 + 4<font></font>
lines 1-24/148 (more) </pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si! Despu√©s de este cambio, la cantidad total del encabezado siempre es exactamente cuatro menos que el tama√±o de todo el archivo de datos. Y dado que cuatro es tambi√©n el n√∫mero de bytes en el encabezado, es obvio que esto no es una coincidencia. El primer n√∫mero nos da el n√∫mero de entradas de tres bytes en la tabla, y el segundo n√∫mero nos da el n√∫mero de bytes que componen el resto del archivo de datos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encontramos una f√≥rmula constante, lo que significa que ahora entendemos completamente lo que significan los n√∫meros en la primera parte.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Por cierto, aqu√≠ est√° el patr√≥n muy secreto que los lectores atentos podr√≠an notar. Un estudio cuidadoso de las ecuaciones deja en claro que cuando los archivos tienen el mismo primer n√∫mero, obtienen la misma diferencia residual. Esto sucede porque la diferencia siempre es dos veces el valor primer n√∫mero. Este es un patr√≥n no obvio, pero un observador minucioso o exitoso podr√≠a notarlo.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entonces, podemos decir que el archivo tiene tres partes principales:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> encabezado de cuatro bytes; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tabla de registros de tres bytes; </font></font> y </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> el resto del archivo, que supuestamente contiene la mayor√≠a de los datos. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (En consecuencia, las otras partes que hemos determinado aproximadamente anteriormente deber√≠an ser subsecciones de la tercera parte). </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Interpretar metadatos </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dado este esquema, ser√≠a l√≥gico suponer que las entradas en la tabla de la segunda parte son algunos metadatos necesarios para interpretar los datos de la tercera parte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pero, ¬øqu√© tipo de metadatos contiene esta tabla?</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notamos anteriormente que hay un par de signos de que el archivo de datos puede estar comprimido. (Ahora, esto parece a√∫n m√°s plausible, porque sabemos que la tercera parte de cada archivo, que supuestamente contiene datos de cada nivel, tiene un tama√±o de solo 100-600 bytes). Si es as√≠, es muy posible que la tabla que precede a los datos principales contenga metadatos de compresi√≥n. - un diccionario utilizado durante el desempaquetado. Por ejemplo, antes de los datos codificados por el algoritmo Huffman, generalmente hay un diccionario que asigna los valores de bytes originales a secuencias de bits. Aunque no esperamos que estos archivos sean codificados por el algoritmo Huffman (dado que los datos muestran patrones claros en el nivel de bytes, es decir, apenas son un flujo de bits), ser√≠a prudente intentar interpretar esta tabla como un diccionario de descompresi√≥n.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Por supuesto, no todos los tipos de compresi√≥n usan un diccionario almacenado. Por ejemplo, el algoritmo de desinflado utilizado </font></font><code>gzip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y le </font></font><code>zlib</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permite recrear el diccionario directamente desde el flujo de datos. Pero estos casos son la excepci√≥n en lugar de la regla). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por lo general, la entrada del diccionario consta de dos partes: la clave y valores Por supuesto, a veces se implica una clave, por ejemplo, cuando se ordena no en una tabla de b√∫squeda, sino en una matriz. Sin embargo, ya notamos que los registros de tres bytes parecen constar de dos partes, en particular, el primer byte de cada registro sigue un patr√≥n que es claramente diferente del patr√≥n del segundo y tercer bytes. Con esto en mente, una primera hip√≥tesis razonable ser√≠a considerar el primer byte como la clave y los dos bytes restantes como el valor.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si este es el caso, entonces una de las formas m√°s simples de interpretar la parte de la tira es que el primer byte es el valor del byte que debe reemplazarse en los datos comprimidos, y el segundo y el tercer bytes son el valor que debe reemplazarse. </font><font style="vertical-align: inherit;">El resultado creado por este esquema definitivamente ser√° mayor, aunque no est√° claro cu√°nto. </font><font style="vertical-align: inherit;">Sea como fuere, esta es una hip√≥tesis l√≥gica, y es bastante f√°cil de verificar. </font><font style="vertical-align: inherit;">Podemos escribir un programa corto en Python que implemente este esquema de descompresi√≥n: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Archivo decompress.py:</font></font><br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> struct <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-comment"><span class="hljs-comment"># Read the compressed data file. data = sys.stdin.read() # Extract the two integers of the four-byte header. tablesize, datasize = struct.unpack('HH', data[0:4]) data = data[4:] # Separate the dictionary table and the compressed data. tablesize *= 3 table = data[0:tablesize] data = data[tablesize:datasize] # Apply the dictionary entries to the data section. for n in range(0, len(table), 3): key = table[n] val = table[n+1:n+3] data = data.replace(key, val) # Output the expanded result. sys.stdout.write(data)</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ahora podemos verificar este script usando un archivo de datos de ejemplo: </font></font><br><br><blockquote> <code>$ python ./decompress.py &lt;levels/lesson_1.pak | xxd <br> 00000000: 0b0b 0b0b 0404 0000 0a0a 0109 0d05 0502 ................ <br> 00000010: 0200 0100 0000 0101 0100 0009 0702 0209 ................ <br> 00000020: 1100 0125 0100 2309 0700 0009 0d1d 0124 ...%..#........$ <br> 00000030: 011d 0a0a 0105 0500 0100 2000 1b02 0200 .......... ..... <br> 00000040: 1a00 2009 0709 1100 011f 0033 001e 0100 .. ........3.... <br> 00000050: 2309 0709 0d23 0000 0023 0a0a 0105 0509 #....#...#...... <br> 00000060: 1100 011f 0200 1e01 0023 0907 0001 0200 .........#...... <br> 00000070: 1a00 0023 0000 1b00 0009 0709 0d01 1c01 ...#............ <br> 00000080: 1c0a 0a01 0105 0502 0200 0100 0001 0000 ................ <br> 00000090: 0107 0509 1101 2309 0704 0400 0100 0001 ......#......... <br> 000000a0: 2109 0704 0409 0d01 010b 0b0b 0b08 0804 !............... <br> 000000b0: 0402 0200 0608 0807 0707 0502 0202 0078 ...............x <br> 000000c0: 0808 0707 0705 0202 0200 7008 0807 0707 ..........p..... <br> 000000d0: 0502 0202 0064 0017 101e 1e1a 1901 0300 .....d.......... <br> 000000e0: 0e1a 1717 100e 1f01 0e13 141b 1e01 1f1a ................ <br> 000000f0: 0012 101f 011b 0c1e 1f01 1f13 1001 0e13 ................ <br> 00000100: 141b 001e 1a0e 1610 1f2d 0020 1e10 0116 .........-. .... <br> 00000110: 1024 1e01 1f1a 011a 1b10 1900 0f1a 1a1d .$.............. <br> 00000120: 1e2d 0000</code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin embargo, los resultados no son notables. Por supuesto, el flujo de datos resultante se ha desplegado m√°s que el original, pero no mucho. Definitivamente no es suficiente para contener todos los datos que esperamos encontrar. Obviamente, este esquema de desempaquetado es un poco m√°s simple de lo necesario. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si examinamos cuidadosamente la salida resultante, pronto veremos que comienza con muchos bytes repetidos. </font></font><code>0b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>04</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>00</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>0a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- todos ellos se presentan en pares. Mirando el original comprimido, veremos que todos estos pares han surgido debido a un reemplazo del diccionario. Pero en el proceso, notamos de inmediato que todos estos significados duplicados tambi√©n corresponden a entradas en el diccionario. Es decir, si volvemos a aplicar el diccionario, los datos se expandir√°n nuevamente. ¬øQuiz√°s no estamos desempacando lo suficiente?</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nuestra primera suposici√≥n puede ser realizar una segunda pasada, aplicando cada entrada del diccionario por segunda vez para expandir los datos a√∫n m√°s. La segunda suposici√≥n puede ser realizar m√∫ltiples pases con el diccionario, repitiendo el proceso hasta que se reemplacen todos los bytes similares a las claves del diccionario. Sin embargo, si observamos m√°s de cerca la estructura del diccionario, nos damos cuenta de que simplemente aplicamos las entradas </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">del</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diccionario </font><em><font style="vertical-align: inherit;">de derecha a izquierda</font></em><font style="vertical-align: inherit;"> , y no de izquierda a derecha, cuando todos nuestros valores se expanden en una sola pasada.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tomando esta hip√≥tesis, podemos ver la estructura de un algoritmo de compresi√≥n m√°s plausible. El programa toma los datos de origen y los escanea, buscando las secuencias de doble byte m√°s comunes. Luego reemplaza la secuencia de dos bytes con un valor de un byte que no se encuentra en los datos. Luego, repite el proceso y contin√∫a hasta que los datos contengan m√°s de dos repeticiones de secuencias de doble byte. De hecho, dicho algoritmo de compresi√≥n tiene un nombre: se conoce como compresi√≥n "volver a emparejar", que es la abreviatura de "pares recursivos".</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Y esto puede explicar algunos patrones que vemos en el diccionario. Durante la compresi√≥n, el diccionario se construye de izquierda a derecha, por lo que al desempacarlo se debe aplicar de derecha a izquierda. Dado que las entradas del diccionario a menudo se refieren a entradas anteriores, es l√≥gico que el segundo y el tercer bytes a menudo sean m√°s peque√±o que el primero.) </font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aunque la compresi√≥n de emparejamiento no produce resultados muy impresionantes, tiene una ventaja: el descompresor se puede implementar con un m√≠nimo de c√≥digo. </font><font style="vertical-align: inherit;">Yo mismo us√© volver a emparejar en algunas situaciones en las que necesitaba minimizar el </font><font style="vertical-align: inherit;">tama√±o </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">total</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de los datos comprimidos y el c√≥digo de descompresi√≥n.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entonces, podemos hacer un cambio en una l√≠nea del programa Python para aplicar el diccionario de derecha a izquierda: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Archivo decompress2.py:</font></font><br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> struct <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-comment"><span class="hljs-comment"># Read the compressed data file. data = sys.stdin.read() # Extract the two integers of the four-byte header. tablesize, datasize = struct.unpack('HH', data[0:4]) data = data[4:] # Separate the dictionary table and the compressed data. tablesize *= 3 table = data[0:tablesize] data = data[tablesize:datasize] # Apply the dictionary entries to the data section in reverse order. for n in range(len(table) - 3, -3, -3): key = table[n] val = table[n+1:n+3] data = data.replace(key, val) # Output the expanded result. sys.stdout.write(data)</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Si probamos esta versi√≥n, la salida ser√° mucho mayor: </font></font><br><br><blockquote><pre> $ python ./decompress2.py &lt;levels/lesson_1.pak | xxd | less<font></font>
00000000: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000010: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000020: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000030: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000040: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000050: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000060: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000070: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000080: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000090: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
000000a0: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
000000b0: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
000000c0: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
000000d0: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
000000e0: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
000000f0: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000100: 0000 0000 0000 0000 0000 0101 0101 0100 ................<font></font>
00000110: 0101 0101 0100 0000 0000 0000 0000 0000 ................<font></font>
00000120: 0000 0000 0000 0000 0000 0100 0000 0101 ................<font></font>
00000130: 0100 0000 0100 0000 0000 0000 0000 0000 ................<font></font>
00000140: 0000 0000 0000 0000 0000 0100 2300 0125 ............#..%<font></font>
00000150: 0100 2300 0100 0000 0000 0000 0000 0000 ..#.............<font></font>
00000160: 0000 0000 0000 0000 0101 0101 011d 0124 ...............$<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000170: 011d 0101 0101 0100 0000 0000 0000 0000 ................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
l√≠neas 1-24 / 93 (m√°s) </font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vemos muchos bytes nulos en esta salida, pero esto puede corresponder a una tarjeta casi vac√≠a. </font><font style="vertical-align: inherit;">Los bytes distintos de cero parecen estar agrupados uno al lado del otro. </font><font style="vertical-align: inherit;">Como esperamos encontrar una tarjeta de 32 √ó 32, reformateemos la salida a 32 bytes por l√≠nea:</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ python ./decompress2.py &lt;niveles / lecci√≥n_1.pak | </font><font style="vertical-align: inherit;">xxd -c32 | </font><font style="vertical-align: inherit;">menos</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000000: 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 ................................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000020: 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 ................................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000040: 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 ................................</font></font><font></font>
00000060: 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 ................................<font></font>
00000080: 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 ................................<font></font>
000000a0: 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 ................................<font></font>
000000c0: 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 ................................<font></font>
000000e0: 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 ................................<font></font>
00000100: 0000 0000 0000 0000 0000 0101 0101 0100 0101 0101 0100 0000 0000 0000 0000 0000 ................................<font></font>
00000120: 0000 0000 0000 0000 0000 0100 0000 0101 0100 0000 0100 0000 0000 0000 0000 0000 ................................<font></font>
00000140: 0000 0000 0000 0000 0000 0100 2300 0125 0100 2300 0100 0000 0000 0000 0000 0000 ............#..%..#.............<font></font>
00000160: 0000 0000 0000 0000 0101 0101 011d 0124 011d 0101 0101 0100 0000 0000 0000 0000 ...............$................<font></font>
00000180: 0000 0000 0000 0000 0100 2000 1b00 0000 0000 1a00 2000 0100 0000 0000 0000 0000 .......... ......... ...........<font></font>
000001a0: 0000 0000 0000 0000 0100 2300 011f 0033 001e 0100 2300 0100 0000 0000 0000 0000 ..........#....3....#...........<font></font>
000001c0: 0000 0000 0000 0000 0101 0101 0123 0000 0023 0101 0101 0100 0000 0000 0000 0000 .............#...#..............<font></font>
000001e0: 0000 0000 0000 0000 0100 2300 011f 0000 001e 0100 2300 0100 0000 0000 0000 0000 ..........#.........#...........<font></font>
00000200: 0000 0000 0000 0000 0100 0000 1a00 0023 0000 1b00 0000 0100 0000 0000 0000 0000 ...............#................<font></font>
00000220: 0000 0000 0000 0000 0101 0101 0101 1c01 1c01 0101 0101 0100 0000 0000 0000 0000 ................................<font></font>
00000240: 0000 0000 0000 0000 0000 0000 0100 0001 0000 0100 0000 0000 0000 0000 0000 0000 ................................<font></font>
00000260: 0000 0000 0000 0000 0000 0000 0100 2301 2300 0100 0000 0000 0000 0000 0000 0000 ..............#.#...............<font></font>
00000280: 0000 0000 0000 0000 0000 0000 0100 0001 2100 0100 0000 0000 0000 0000 0000 0000 ................!...............<font></font>
000002a0: 0000 0000 0000 0000 0000 0000 0101 0101 0101 0100 0000 0000 0000 0000 0000 0000 ................................<font></font>
000002c0: 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 ................................<font></font>
000002e0: 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 ................................<font></font>
lines 1-24/47 (more) </pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despu√©s de observar cuidadosamente los patrones de valores distintos de cero, veremos que el mapa es claramente visible en la salida. </font><font style="vertical-align: inherit;">De hecho, podemos hacer que este patr√≥n sea m√°s visible utilizando la herramienta de volcado "coloreada", que asigna un color a cada valor de byte, simplificando la b√∫squeda de patrones de valores repetidos: </font></font><br><br> <code>xcd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es una herramienta no est√°ndar, pero puede descargarla </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desde aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Tenga en cuenta la opci√≥n de </font></font><code>-r</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilidad </font></font><code>less</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que le indica que borre las secuencias de control.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w4/8p/68/w48p68o5f00b_zuu13pagsfb0um.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Compare esto con un mapa de primer nivel dibujado por un fan: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fe5/03a/ae9/fe503aae95f2acaa3a3663c43f528cef.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin duda, vemos los datos del mapa de nivel. </font><font style="vertical-align: inherit;">Puede estar bastante seguro de que hemos determinado correctamente el algoritmo de desempaquetado.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Interpretaci√≥n de datos </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al comparar los valores de bytes con la imagen del mapa, podemos determinar qu√© </font></font><code>00</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">codifica un mosaico vac√≠o, </font></font><code>01</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">codifica un muro y </font></font><code>23</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">denota un chip. </font></font><code>1A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">denota una puerta roja, </font></font><code>1B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">una puerta azul, y as√≠ sucesivamente. Podemos asignar valores exactos a las fichas, llaves, puertas y todas las dem√°s fichas que componen el mapa de nivel completo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora podemos pasar al siguiente nivel y encontrar los valores de byte para los objetos que aparecen all√≠. Y contin√∫e con los siguientes niveles hasta que obtengamos una lista completa de los valores de bytes y los objetos del juego que codifican. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como sugerimos inicialmente, la tarjeta termina exactamente despu√©s de 1024 bytes (en el desplazamiento </font></font><code>000003FF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta vez, para eliminar las primeras 32 l√≠neas del volcado, usamos</font></font><code>sed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Como tenemos 32 bytes por l√≠nea, omitiremos los primeros 1024 bytes.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lq/xf/tu/lqxftuj5dvg9tletfkavcjd3n6m.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inmediatamente despu√©s de los datos del mapa hay una secuencia de 384 bytes (cuyos valores est√°n en el intervalo </font></font><code>00000400</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><code>0000057F</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), casi todos iguales a cero, pero los valores distintos de cero tambi√©n se encuentran entre ellos. </font><font style="vertical-align: inherit;">Despu√©s de esto viene un patr√≥n de bytes completamente diferente, por lo que ser√≠a l√≥gico suponer que esta secuencia de 384 bytes es una parte separada. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si observamos algunos niveles m√°s, notamos r√°pidamente el patr√≥n. </font><font style="vertical-align: inherit;">La parte de 384 bytes en realidad consta de tres subsecciones, cada una de 128 bytes de longitud. </font><font style="vertical-align: inherit;">Cada subsecci√≥n comienza con unos pocos bytes distintos de cero seguidos de ceros que llenan el resto de la subsecci√≥n.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algunos niveles contienen muchos datos; para otros (por ejemplo, para el primer nivel) solo el m√≠nimo. Al comparar los niveles con sus tarjetas, pronto notaremos que la cantidad de datos en esta parte del archivo est√° directamente relacionada con el n√∫mero de "mobs" por nivel. En este caso, el n√∫mero de "mobs" incluye todas las criaturas en el nivel, bloques de tierra (que no se mueven independientemente, pero pueden ser empujados) y el personaje principal Chip (jugador). Es decir, los mobs no est√°n indicados en el mapa en s√≠, sino que est√°n codificados en estos tres buffers. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despu√©s de que supimos que estas tres subsecciones contienen datos sobre las turbas en el nivel, no ser√° muy dif√≠cil averiguar qu√© contiene cada una de las subsecciones. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La primera subsecci√≥n de 128 bytes es una lista de valores de bytes que determinan el tipo de mafia. Por ejemplo, los b√∫feres de segundo nivel se ven as√≠:</font></font><br><br><blockquote><pre> $ python ./decompress2.py &lt;levels/lesson_2.pak | xxd | less<font></font>
00000400: 0608 1c1c 0808 0000 0000 0000 0000 0000 ................<font></font>
00000410: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000420: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000430: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000440: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000450: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000460: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000470: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000480: a870 98a0 6868 0000 0000 0000 0000 0000 .p..hh..........<font></font>
00000490: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
000004a0: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
000004b0: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
000004c0: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
000004d0: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
000004e0: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
000004f0: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000500: 6060 6060 5868 0000 0000 0000 0000 0000 ````Xh..........<font></font>
00000510: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000520: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000530: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000540: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000550: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000560: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000570: 0000 0000 0000 0000 0000 0000 0000 0000 ................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
l√≠neas 64-87 / 93 (m√°s) </font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Compare esto con un mapa de nivel: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/705/4aa/f21/7054aaf21da6d4ccaf7c7d30a31cee94.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En este nivel, hay seis mobs: tres errores, dos bloques y un Chip. </font><font style="vertical-align: inherit;">La primera subclave de 128 bytes contiene un byte </font></font><code>06</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, tres bytes </font></font><code>08</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y dos bytes </font></font><code>1C</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ser√≠a razonable concluir qu√© </font></font><code>06</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">significa Chip </font></font><code>08</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: un error y </font></font><code>1C</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un bloque. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Continuando con la comparaci√≥n de archivos de datos a partir de los niveles de las tarjetas y de relleno en el diccionario turbas, r√°pidamente encontr√≥ una falla en esta teor√≠a: El chip puede ser referido a cuatro valores diferentes, a saber </font></font><code>04</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>05</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>06</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font><code>07</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Este conjunto de anotaciones en realidad contiene todas las turbas. Cuando estudiemos cuidadosamente los diferentes valores, eventualmente entenderemos que el valor 0, 1, 2 o 3 se agrega al valor de byte que indica el tipo, que indica la direcci√≥n inicial de la mafia: norte, este, sur u oeste. Es decir, por ejemplo, un valor de byte </font></font><code>06</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">denota un Chip mirando hacia el sur).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La importancia de las otras dos subsecciones es menos obvia. Pero habiendo estudiado los valores repetidos en estas subsecciones y comparando las tarjetas para estos mobs, entenderemos que los bytes en la segunda subsecci√≥n almacenan la coordenada X de cada mafia, y los bytes en la tercera subsecci√≥n almacenan la coordenada Y de cada mafia. La comprensi√≥n de esta decisi√≥n se ve obstaculizada por el hecho de que las coordenadas almacenadas en estas subsecciones en realidad se desplazan 3 bits hacia la izquierda, es decir. multiplicado por 8. Este peque√±o hecho explica el grupo "azul", que encontramos en el censo de valores. (Las razones por las que se realiz√≥ este cambio no est√°n claras, pero lo m√°s probable es que los tres bits inferiores se usen para representar la animaci√≥n cuando se mueven los mobs.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Habiendo tratado esta parte, ahora podemos ver cu√°ntos archivos de datos solo quedan unos pocos bytes despu√©s: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota que</font></font><code>xxd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acepta un </font></font><code>-s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor hexadecimal </font><font style="vertical-align: inherit;">para la opci√≥n </font><font style="vertical-align: inherit;">.</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ para f en niveles / *; </font><font style="vertical-align: inherit;">do python ./decompress2.py &lt;$ f | </font><font style="vertical-align: inherit;">xxd -s 0x580 | </font><font style="vertical-align: inherit;">sed -n 1p; </font><font style="vertical-align: inherit;">hecho | </font><font style="vertical-align: inherit;">menos</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000580: 9001 0c17 1701 1120 1717 00 ....... ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000580: 0000 0c17 1b13 0c0d 101f 011e 1a20 1b00 ............. ..</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000580: f401 0c18 1e1f 101d 0f0c 1800 ............</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000580: 2c01 0c1b 0c1d 1f18 1019 1f00, ...........</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000580: 9001 0c1d 0e1f 140e 1117 1a22 00 ............ "</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000580: 2c01 0d0c 1717 1e01 1a01 1114 1d10 00, ..............</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000580: 2c01 0d10 220c 1d10 011a 1101 0d20 1200, ... "........ ..</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000580: 5802 0d17 1419 1600 X .......</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000580: 0000 0d17 1a0d 0f0c 190e 1000 ............</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000580: f401 0d17 1a0d 1910 1f00 ..........</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000580: f401 0d17 1a0e 1601 110c 0e1f 1a1d 2400 .............. $.</font></font><font></font>
00000580: ee02 0d17 1a0e 1601 0d20 1e1f 101d 0114 ......... ......<font></font>
00000580: 5802 0d17 1a0e 1601 1901 1d1a 1717 00 X..............<font></font>
00000580: 5e01 0d17 1a0e 1601 1a20 1f00 ^........ ..<font></font>
00000580: c201 0d17 1a0e 1601 0d20 1e1f 101d 00 ......... .....<font></font>
00000580: 2c01 0d1a 2019 0e10 010e 141f 2400 ,... .......$.<font></font>
00000580: 5000 0d1d 201e 1311 141d 1000 P... .......<font></font>
00000580: e703 0e0c 1610 0122 0c17 1600 ......."....<font></font>
00000580: 5802 0e0c 1e1f 1710 0118 1a0c 1f00 X.............<font></font>
00000580: 8f01 0e0c 1f0c 0e1a 180d 1e00 ............<font></font>
00000580: 0000 0e10 1717 0d17 1a0e 1610 0f00 1b1d ................<font></font>
00000580: 2c01 0e13 0e13 0e13 141b 1e00 ,...........<font></font>
00000580: 8f01 0e13 1417 1710 1d00 ..........<font></font>
00000580: bc02 0e13 141b 1814 1910 00 ...........<font></font>
lines 1-24/148 (more) </pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Examinar el primer par de bytes en el resto r√°pidamente nos sugiere que contienen otro valor entero de 16 bits. </font><font style="vertical-align: inherit;">Si los tomamos as√≠, la mayor√≠a de los valores aparecen en notaci√≥n decimal como n√∫meros redondos: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el comando </font></font><code>od</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usa en su </font></font><code>-j</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lugar </font><font style="vertical-align: inherit;">para moverse al desplazamiento original </font></font><code>-s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Tambi√©n vale la pena se√±alar el comando </font></font><code>printf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: adem√°s de proporcionar formato, es una forma conveniente de mostrar texto sin una nueva l√≠nea colgando al final.</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ para f en niveles / *; </font><font style="vertical-align: inherit;">hacer printf "% -20s" $ f; </font><font style="vertical-align: inherit;">python ./decompress2.py &lt;$ f | </font><font style="vertical-align: inherit;">od -An -j 0x580 -tuS -N2; </font><font style="vertical-align: inherit;">hecho | </font><font style="vertical-align: inherit;">menos</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveles / all_full.pak 400</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveles / alfabeto.pak 0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveles / amsterda.pak 500</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveles / apartmen.pak 300</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveles / arcticfl.pak 400</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveles / bolas_o_.pak 300</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveles / beware_o.pak 300</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveles / blink.pak 600</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveles / blobdanc.pak 0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveles / blobnet.pak 500</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveles / block_fa.pak 500</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveles / block_ii.pak 750</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveles / block_n_.pak 600</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveles / block_ou.pak 350</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveles / block.pak 450</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveles / bounce_c.pak 300</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveles / brushfir.pak 80</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveles / cake_wal.pak 999</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveles / castle_m.pak 600</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveles / catacomb.pak 399</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveles / cellbloc.pak 0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveles / chchchip.pak 300</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveles / chiller.pak 399</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveles / chipmine.pak 700</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
l√≠neas 1-24 / 148 (m√°s) </font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si volvemos a la lista, creada originalmente a partir de los datos que esper√°bamos encontrar en los archivos, nos damos cuenta de que este n√∫mero es el momento de pasar el nivel (si el valor es cero, entonces no hay l√≠mite de tiempo en el nivel). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despu√©s de estos dos bytes, los datos se vuelven m√°s vol√°tiles. </font><font style="vertical-align: inherit;">El hecho de que para la mayor√≠a de los niveles quedan aproximadamente diez bytes en el archivo limita seriamente su contenido:</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ python ./decompress2.py &lt;niveles / all_full.pak | </font><font style="vertical-align: inherit;">xxd -s 0x0582</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000582: 0c17 1701 1120 1717 00 ..... ... </font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por ejemplo, solo quedan nueve bytes en este nivel. </font><font style="vertical-align: inherit;">Tomamos en cuenta este tama√±o limitado, as√≠ como el hecho de que estos nueve bytes contienen cuatro ocurrencias del valor </font></font><code>17</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, recopilados en dos pares. </font><font style="vertical-align: inherit;">Notaremos de inmediato que el patr√≥n de n√∫meros </font></font><code>17</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corresponde al patr√≥n de letras </font></font><code>L</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en el nombre del nivel "TODO COMPLETO". </font><font style="vertical-align: inherit;">El nombre tiene ocho caracteres de longitud, por lo que el byte nulo al final es probablemente el car√°cter de final de l√≠nea. </font><font style="vertical-align: inherit;">Despu√©s de descubrir esto, puedes mirar trivialmente todos los dem√°s niveles y usar sus nombres para crear una lista completa de personajes:</font></font><br><br><table><tbody><tr><td> <code>00</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fin de l√≠nea </font></font></td></tr><tr><td> <code>01</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> barra espaciadora </font></font></td></tr><tr><td> <code>02</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><code>0B</code> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d√≠gitos 0-9 </font></font></td></tr><tr><td> <code>0C</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><code>25</code> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> letras AZ </font></font></td></tr><tr><td> <code>26</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><code>30</code> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> signos de puntuaci√≥n </font></font></td></tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para la mayor√≠a de los niveles, el archivo de datos termina aqu√≠. </font><font style="vertical-align: inherit;">Sin embargo, un par de docenas del nombre todav√≠a tiene datos. </font><font style="vertical-align: inherit;">Si echamos un vistazo a la lista, veremos que hay niveles con botones de sugerencia, y estos datos restantes contienen el texto de la l√≠nea de sugerencia de nivel codificada con el mismo conjunto de caracteres que los nombres de nivel. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despu√©s de eso, llegamos al final de todos los archivos. </font><font style="vertical-align: inherit;">Ahora tenemos una descripci√≥n completa del esquema de estos niveles. </font><font style="vertical-align: inherit;">Nuestra tarea est√° completa.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Asuntos pendientes </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un lector atento puede notar que inicialmente esper√°bamos encontrar dos elementos m√°s en estos archivos que nunca conocimos. Explicaremos la ausencia de ambos: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el primer elemento es el n√∫mero de chips, es decir El n√∫mero total de fichas que un jugador debe recolectar para pasar a trav√©s del conector de fichas. Como dijimos inicialmente, a menudo es igual al n√∫mero total de fichas en un nivel, pero esto no siempre sucede. Por lo tanto, estos datos deben obtenerse de alguna manera. La respuesta se puede encontrar estudiando tarjetas de aquellos niveles en los que hay fichas adicionales. Resulta que dos valores diferentes se utilizan para indicar chips. El valor </font></font><code>23</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que encontramos inicialmente, pero el valor tambi√©n se usa.</font></font><code>31</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">denota un chip que no afecta la cantidad total requerida para abrir el conector del chip. (Sin embargo, desde el punto de vista del juego, ambos tipos de fichas son iguales. Si hay un tipo de ficha </font></font><code>31</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en el nivel, entonces en el nivel no puedes recoger ninguna cantidad de fichas).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El segundo elemento es la contrase√±a de nivel de cuatro letras. </font><font style="vertical-align: inherit;">No est√° oculto en ning√∫n lugar de los datos de nivel. </font><font style="vertical-align: inherit;">Desafortunadamente, este problema no puede resolverse mediante una investigaci√≥n adicional del archivo de datos. </font><font style="vertical-align: inherit;">Nos vemos obligados a concluir que las contrase√±as simplemente se almacenan en otro lugar. </font><font style="vertical-align: inherit;">La explicaci√≥n m√°s probable: est√°n codificadas en alg√∫n lugar del programa. </font><font style="vertical-align: inherit;">Sin embargo, m√°s tarde qued√≥ claro que las contrase√±as no se almacenan directamente. </font><font style="vertical-align: inherit;">De personas familiarizadas con el c√≥digo en s√≠, aprend√≠ que las contrase√±as se generan din√°micamente usando un generador de n√∫meros pseudoaleatorios inicializado con una secuencia espec√≠fica. </font><font style="vertical-align: inherit;">Por lo tanto, las contrase√±as a niveles no se pueden cambiar directamente, esto solo se puede hacer cambiando el c√≥digo del ensamblador.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ep√≠logo </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una vez completada la ingenier√≠a inversa completa de los datos en los archivos de nivel, podr√≠a comenzar a escribir un programa capaz de codificar y decodificar los datos de nivel. Gracias a ella, pude crear el tan esperado editor de niveles para la versi√≥n de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chip's Challenge</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para Lynx, y la presencia de esta herramienta aument√≥ enormemente mi capacidad de estudiar la l√≥gica del juego, y tambi√©n mejor√≥ la calidad de su emulaci√≥n.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pero ... debo admitir que personalmente hice el desarrollo inverso de los archivos de datos de una manera no descrita anteriormente. Comenc√© desde el otro extremo, con la definici√≥n de datos de cadena. Comenc√© a estudiar los archivos de los primeros ocho niveles. Como se llaman de "LECCI√ìN 1" a "LECCI√ìN 8", busqu√© los datos de las subcadenas id√©nticas en ellos. Y tuve suerte: ninguno de los nombres de estos niveles estaba comprimido, por lo que los ocho nombres se almacenan en los archivos de datos en su forma original. Por supuesto, me daba verg√ºenza que estas l√≠neas no estuvieran almacenadas en caracteres ASCII, pero la doble S en el nombre me ayud√≥ a detectar un patr√≥n que se repiti√≥ en los ocho archivos de datos. Y al encontrar el nombre, reconoc√≠ la codificaci√≥n de caracteres de letras, n√∫meros y el espacio. Luego apliqu√© esta codificaci√≥n al resto del archivo, y justo despu√©s del nombre vi l√≠neas de aviso, y comenc√© a observar las anomal√≠as:</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una gran utilidad </font></font><code>tr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">facilita la conversi√≥n de su propio conjunto de caracteres de archivos de datos a ASCII.</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ tr '\ 001- \ 045' '0-9A-Z' &lt;niveles / lecci√≥n_1.pak | </font><font style="vertical-align: inherit;">xxd</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000000: 4600 cb00 3000 0032 3030 3332 3235 3333 F ... 0..200322533</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000010: 3635 3537 0020 3820 2039 3636 4238 3846 6557. 8 966B88F</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000020: 0058 4a37 354d 3000 5737 4226 3746 2739 .XJ75M0.W7B y 7F'9</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000030: 3928 3533 2953 2027 2733 3042 2057 3532 9 (53) S '' 30B W52</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000040: 3730 3738 304a 3226 375a 2046 4a30 5752 70780J2 y 7Z FJ0WR</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000050: 2059 2052 4220 3537 0055 0050 3200 4f00 Y RB 57.U.P2.O.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000060: 554a 2637 5400 3300 2946 4a57 5830 4642 UJ y 7T.3.) FJWX0FB</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000070: 2035 2637 544d 2946 4a37 4d4f 3058 3050 5 &amp; 7TM) FJ7MO0X0P</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000080: 304a 5720 5120 5142 3835 3237 3020 3020 0JW Q QB85270 0</font></font><font></font>
00000090: 2826 2058 4a33 3730 2056 4a33 5738 2727 (&amp; XJ370 VJ3W8''<font></font>
000000a0: 3933 3200 3439 3628 324d 7839 3628 324d 932.496(2Mx96(2M<font></font>
000000b0: 7039 3628 324d 6400 4c45 5353 4f4e 2031 p96(2Md.LESSON 1<font></font>
000000c0: 0043 4f4c 4c45 4354 2043 4849 5029 544f .COLLECT CHIP)TO<font></font>
000000d0: 0047 4554 2050 4153 5420 5448 4520 4348 .GET PAST THE CH<font></font>
000000e0: 4950 0053 4f43 4b45 542d 0055 5345 204b IP.SOCKET-.USE K<font></font>
000000f0: 4559 2954 4f20 4f50 454e 0044 4f4f 5253 EY)TO OPEN.DOORS<font></font>
00000100: 2d30 -0 </pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por ejemplo, en el texto de ayuda hay dos lugares donde la secuencia de S y el espacio se reemplazan por el corchete derecho. </font><font style="vertical-align: inherit;">Estas anomal√≠as me dieron suficiente evidencia para calcular deductivamente la presencia de compresi√≥n y obtener informaci√≥n sobre su naturaleza. </font><font style="vertical-align: inherit;">M√°s tarde, asoci√© valores de bytes anormales con sus ocurrencias m√°s cerca del comienzo del archivo de datos. </font><font style="vertical-align: inherit;">(Por ejemplo, en el volcado de desplazamiento hexadecimal que se muestra arriba </font></font><code>00000035</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hay un corchete derecho, seguido de una S may√∫scula y un espacio). A partir de esto, calcul√© el esquema de compresi√≥n de manera similar al proceso descrito en el art√≠culo. </font><font style="vertical-align: inherit;">Todo lo dem√°s era bastante simple. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Me parece que se puede extraer una lecci√≥n de esto: no hay una forma √∫nica de examinar un archivo de datos desconocido. </font><font style="vertical-align: inherit;">Cualquier herramienta que le convenga son las herramientas adecuadas para la ingenier√≠a inversa.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/447562/">https://habr.com/ru/post/447562/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../447552/index.html">C√≥mo optimizar las secciones del cat√°logo en una tienda en l√≠nea: instrucciones paso a paso</a></li>
<li><a href="../447554/index.html">Descripci√≥n general de las nuevas caracter√≠sticas de NestJS 6</a></li>
<li><a href="../447556/index.html">Extensi√≥n Mypy con complementos</a></li>
<li><a href="../447558/index.html">Realidad virtual: juego, tratamiento, vida. Tecnolog√≠a VR al servicio de la medicina de rehabilitaci√≥n.</a></li>
<li><a href="../447560/index.html">Construyendo un proyecto BEM usando Webpack</a></li>
<li><a href="../447564/index.html">La autorizaci√≥n del repositorio cambia en GitLab.com</a></li>
<li><a href="../447566/index.html">Los cient√≠ficos primero mostraron una "foto" real de un agujero negro</a></li>
<li><a href="../447568/index.html">Entrevista con el astronauta Alexander Laveikin sobre cine espacial, sobrecargas de 20 unidades y aterrizaje suave</a></li>
<li><a href="../447570/index.html">GoLand 2019.1: an√°lisis de rendimiento de c√≥digo, Smart Step Into, refactorizaci√≥n de interfaz de extracci√≥n, analizador de nilness y m√°s</a></li>
<li><a href="../447572/index.html">Energ√≠a, calor y agua: segunda parte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>