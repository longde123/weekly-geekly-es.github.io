<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔡 🛢️ 🕺🏽 Saat saya menulis pemantauan saya 👈 🐏 🎼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saya memutuskan untuk membagikan cerita saya. Mungkin bahkan seseorang akan menemukan solusi anggaran ini untuk masalah terkenal yang bermanfaat. 

 K...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Saat saya menulis pemantauan saya</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453430/"> Saya memutuskan untuk membagikan cerita saya.  Mungkin bahkan seseorang akan menemukan solusi anggaran ini untuk masalah terkenal yang bermanfaat. <br><br>  Ketika saya masih muda dan panas dan tidak tahu di mana harus menaruh energi saya, saya memutuskan untuk sedikit lepas.  Saya berhasil mendapatkan peringkat dengan cepat dan saya menemukan beberapa pelanggan reguler yang meminta saya untuk memelihara server mereka secara berkelanjutan. <br><a name="habracut"></a><br>  Hal pertama yang saya pikirkan adalah perlunya pemantauan.  Saya memutuskan untuk melakukannya sebagai orang pintar, bukan untuk menemukan kembali roda, tetapi untuk melihat opsi yang sudah jadi, seperti Munin atau Zabbix.  Tetapi segera ditemukan bahwa versi Web memerlukan koneksi internet yang baik, terutama jika Anda pertama kali membukanya dari ponsel Anda.  Jika Anda bersantai di alam yang jauh dari kota, sulit untuk mendapatkan koneksi yang stabil.  Oleh karena itu, opsi pemantauan konsol dipilih. <br><br>  Atop dan atops log reader atopsar banyak membantu saya sebagai pemantauan konsol.  Mereka sudah disebutkan di habr, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di atas bahkan dibongkar</a> , tetapi hampir tidak ada yang dikatakan tentang atopsar. <br><br><h3>  Instalasi </h3><br>  Instalasi sangat sederhana, hanya tiga tim. <br><br>  #Centos <br><br><pre><code class="plaintext hljs">yum install atop</code> </pre> <br>  # Debian / Ubuntu <br><br><pre> <code class="plaintext hljs">apt-get install atop</code> </pre> <br><br>  Selanjutnya, Anda dapat mengkonfigurasi operasi pemantauan untuk diri sendiri atau menggunakan pengaturan default. <br><br>  # Debian / Ubuntu / Centos <br><br><pre> <code class="plaintext hljs">/etc/default/atop</code> </pre> <br>  File standar: <br><br><pre> <code class="plaintext hljs"> #cat /etc/default/atop INTERVAL=60 #,       ,    10  LOGPATH="/var/log/atop" #     OUTFILE="$LOGPATH/daily.log" #     </code> </pre><br>  Tambahkan ke autorun <br>  # Debian / Ubuntu / Centos <br><br><pre> <code class="plaintext hljs">systemctl enable atop</code> </pre> <br>  Jalankan di atas sebagai daemon <br>  # Debian / Ubuntu / Centos <br><br><pre> <code class="plaintext hljs">systemctl start atop</code> </pre> <br>  Untuk malas berkumpul di satu tim <br>  #Centos <br><br><pre> <code class="plaintext hljs">yum install atop &amp;&amp; systemctl enable atop &amp;&amp; systemctl start atop</code> </pre> <br>  # Debian / Ubuntu <br><br><pre> <code class="plaintext hljs">apt-get install atop &amp;&amp; systemctl enable atop &amp;&amp; systemctl start atop</code> </pre> <br><h3>  Atopsar </h3><br>  Seiring dengan di atas, atopsar juga diinstal, yang merupakan penganalisa konsol yang nyaman dari log biner yang dijalankan oleh daemon di atas.  Tentu saja, Anda dapat membaca log di atas itu sendiri, tetapi ini tidak begitu nyaman jika Anda ingin menangkap interval waktu yang besar. <br><br>  Program pendidikan kecil tentang karya atopsar. <br><br>  Ketika atopsar dimulai tanpa kunci, itu membuka log untuk hari ini dan menampilkan beban pada setiap inti secara individual dan string idl untuk semua kernel. <br><br>  Kunci yang saya gunakan adalah: <br><br>  <b>-A</b> = cetak semua informasi dari log <br>  <b>-c</b> = menampilkan informasi tentang beban pada inti prosesor, kunci default <br>  <b>-m</b> = RAM dan beban swap <br>  <b>-d</b> = aktivitas disk <br>  <b>-O</b> = 3 proses pemuatan CPU teratas <br>  <b>-G</b> = top 3 proses pemuatan RAM <br>  <b>-D</b> = 3 proses pemuatan disk teratas <br>  <b>-N</b> = 3 proses pemuatan jaringan teratas <br>  <b>-r</b> = tentukan path ke log yang ingin Anda baca, jika Anda perlu melihat muatannya selama beberapa hari terakhir <br>  <b>-b</b> = waktu untuk memulai output <br>  <b>-e</b> = waktu untuk menyelesaikan output <br>  <b>-M</b> = membuat kolom tambahan di akhir, di mana kekritisan baris ditandai (+ ada beban, * - beban kritis) <br><br>  Berkat pemantauan, kami dapat memahami penyebab perilaku server yang salah kapan saja. <br><br><h3>  Notifikasi </h3><br>  Jadi, ada pemantauan beban, tetapi masih tidak memungkinkan untuk dengan cepat menemukan dan menyelesaikan masalah.  Kami membutuhkan pemberitahuan tentang masalah tersebut. <br><br>  Saya satu-satunya yang mengikuti server, jadi saya perlu memberi tahu di mana saya selalu bisa melihatnya dan setidaknya entah bagaimana bereaksi terhadapnya. <br><br>  Pada awalnya ada SMS - cepat, dapat diandalkan, gratis.  Tetapi kemudian operator seluler menutupi distribusi SMS gratis melalui gateway mereka. <br>  Mail - untuk waktu yang lama, mungkin ada masalah dengan pengiriman. <br>  Utusan - harus diletakkan di telepon, Anda harus membuat bot. <br><br>  Sebagai hasil pencarian, messenger Telegram dipilih karena kesederhanaan dan aplikasi yang mudah digunakan pada ponsel dan desktop. <br><br>  Membuat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">botnya</a> menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">botfather</a> . <br>  Setelah saya meletakkan beberapa skrip di server yang melacak beban di server (IDL, smartct, etc..l), adanya kesalahan seperti "oom killer", kesalahan saat membuat cadangan, dan operasi lain yang perlu dikontrol. <br><br>  Skrip cukup sederhana ditulis dalam bash, misalnya, memeriksa LA dan memberitahukan bahwa Load Averadge telah melebihi jumlah core di server. <br><br><pre> <code class="plaintext hljs">if [ ${LA[0]} -gt 2000 ] || [ ${LA[1]} -gt 3000 ] || [ ${LA[2]} -gt 4000 ] then wget -O /dev/null "https://api.telegram.org/$bot_id:$bot_key/sendMessage?chat_id=$chat_id&amp;text=  $ip LA $LAd" wget -O /dev/null "https://api.telegram.org/$bot_id:$bot_key/sendMessage?chat_id=$chat_id&amp;text=`top -b -n 1 | grep Cpu`" wget -O /dev/null "https://api.telegram.org/$bot_id:$bot_key/sendMessage?chat_id=$chat_id&amp;text= 5  `top -b -n 1 | grep -A 5 'PID USER' | tail -5`" fi</code> </pre> <br>  Kesederhanaan sintaksis memberikan banyak kasus penggunaan (dan siapa pun yang tahu setidaknya sedikit bahasa pemrograman dapat menulis / menambahkan). <br><br>  Satu-satunya peringatan - jika server terletak di Rusia (dan Anda tidak memiliki IPv6 di server), maka Anda perlu menggunakan proxy.  Untuk melakukan ini, di awal skrip, Anda harus mendaftarkan string koneksi ke proxy: <br><br><pre> <code class="plaintext hljs">export https_proxy=http://:@IP.:</code> </pre> <br><h3>  Ini bukan akhirnya </h3><br>  Anda berjalan dengan tenang melewati pegunungan dengan ransel di belakang Anda, beristirahat sejenak dari peradaban, dan kemudian telepon, tanpa sengaja menangkap koneksi, melempar pemberitahuan tentang masalah yang muncul pada server Anda.  Apa yang harus dilakukan  Suasana hati yang tenang tertiup angin.  Panggil istri dan perintah dikte saya?  Haha <br><br>  Sangatlah mendesak untuk menemukan cara untuk menyelesaikan masalah dengan cepat dan tanpa ketersediaan Internet yang baik.  Di sini saya sekali lagi diselamatkan oleh kurir (# telegrammivi).  Saya mengajar bot saya untuk berkomunikasi hanya dengan saya, mengabaikan orang lain.  Sekarang, bersama dengan pemberitahuan masalah, saya mendapatkan sedikit lebih banyak data, yang menurutnya saya mengerti siapa sumber masalahnya, dan saya bisa mencoba menyelesaikannya dari jarak jauh.  Cukup dengan menulis pesan ke bot, melemparkan telepon lebih tinggi sehingga pesan ini hilang, dan voila - bot pergi untuk melakukan pekerjaan Anda.  Jadi, saya dapat, misalnya, mematikan beberapa proses yang tidak diinginkan, memulai ulang daemon, memblokir IP dan sebagainya. <br><br>  Di sini saya juga mentransfer permintaan yang diperlukan di masa depan dari klien, misalnya, reset kata sandi yang mendesak kepada pengguna (karena "Ahhh, kami tidak bisa sampai ke server, kami kehilangan jutaan!"), Mencari pengguna yang memiliki akses ke folder yang diinginkan, menghidupkan dan mematikan situs, dan lain-lain .  Tentu saja, saya terus-menerus mengubah fungsi bot, karena imajinasi pelanggan terkadang muncul secara tak terduga dan tidak disediakan oleh saya.  Tapi yang dasar puas. <br><br>  Ada juga versi untuk VK, tetapi entah bagaimana tidak berakar. <br><br>  Sekarang saya dengan tenang melakukan perjalanan dan menjelajahi dunia ini, tidak takut bahwa sesuatu akan pecah di sana, dan saya tidak akan dapat menemukan atau memperbaikinya. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id453430/">https://habr.com/ru/post/id453430/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id453414/index.html">Naik turunnya IEO, semua yang perlu Anda ketahui tentang gelombang baru penggalangan dana</a></li>
<li><a href="../id453416/index.html">Cara konfigurasi bekerja di .NET Core</a></li>
<li><a href="../id453418/index.html">Apa yang perlu Anda ketahui sebelum pindah ke Akka toolkit untuk mengimplementasikan Pengadaan Acara dan CQRS</a></li>
<li><a href="../id453422/index.html">Berkenalan dengan ITSM: 10 habratopik dan materi ahli untuk “pencelupan cepat” dalam topik ini</a></li>
<li><a href="../id453428/index.html">Meningkatkan keterbacaan kode dalam pengembangan iOS</a></li>
<li><a href="../id453432/index.html">Dari kritik hingga algoritma: suara para elit yang memudar di dunia musik</a></li>
<li><a href="../id453434/index.html">Fleksibilitas Cartridge: Sensor dalam Game untuk Game Boy</a></li>
<li><a href="../id453438/index.html">Teknologi mikroelektronika di jari: Hukum Moore, gerakan pemasaran, dan mengapa nanometer tidak sama sekarang. Bagian 1</a></li>
<li><a href="../id453440/index.html">Menumpang untuk Ketersediaan: Tautan untuk Melewati Navigasi dan Bagian</a></li>
<li><a href="../id453442/index.html">7 Hal yang Perlu Diketahui tentang Langganan yang Dapat Diperbarui Secara Otomatis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>