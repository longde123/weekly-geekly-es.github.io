<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚪 🦃 🐫 Verwalten des Status mit React Hooks - Ohne Redux- und Kontext-API 💌 👩🏽‍🚀 🕵🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits! Mein Name ist Arthur, ich arbeite als VKontakte im mobilen Webteam , ich bin am VKUI- Projekt beteiligt - einer Bibliothek von React...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Verwalten des Status mit React Hooks - Ohne Redux- und Kontext-API</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vk/blog/454348/">  Hallo allerseits!  Mein Name ist Arthur, ich arbeite als VKontakte im mobilen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Webteam</a> , ich bin am <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">VKUI-</a> Projekt beteiligt - einer Bibliothek von React-Komponenten, mit deren Hilfe einige unserer Schnittstellen in mobilen Anwendungen geschrieben werden.  Die Frage der Arbeit mit einem globalen Staat steht uns noch offen.  Es gibt mehrere bekannte Ansätze: Redux, MobX, Context API.  Kürzlich bin ich auf einen Artikel von André Gardi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">State Management mit React Hooks - No Redux oder Context API gestoßen</a> , in dem der Autor vorschlägt, React Hooks zu verwenden, um den Status der Anwendung zu steuern. <br><br>  Hooks brechen schnell in das Leben von Entwicklern ein und bieten neue Möglichkeiten, um verschiedene Aufgaben und Ansätze zu lösen oder zu überdenken.  Sie verändern unser Verständnis nicht nur der Beschreibung von Komponenten, sondern auch des Umgangs mit Daten.  Lesen Sie die Übersetzung des Artikels und den Kommentar des Übersetzers unter der Katze. <br><br><img src="https://habrastorage.org/webt/_t/kp/9x/_tkp9x7oiiowebtqtcvbhlblydo.jpeg" alt="Bild"><br><a name="habracut"></a><br><h2>  Reaktionshaken sind leistungsfähiger als Sie denken </h2><br>  Heute werden wir React Hooks untersuchen und einen benutzerdefinierten Hook zum Verwalten des globalen Status der Anwendung entwickeln, der einfacher als die Redux-Implementierung und produktiver als die Context-API ist. <br><br><h3>  Grundlagen von Hooks reagieren </h3><br>  Sie können diesen Teil überspringen, wenn Sie bereits mit Hooks vertraut sind. <br><br><h4>  useState () </h4><br>  Vor dem Auftreten von Hooks konnten Funktionskomponenten keinen lokalen Status festlegen.  Die Situation hat sich mit dem Aufkommen von <code>useState()</code> geändert. <br><br><img src="https://habrastorage.org/webt/eh/uc/_k/ehuc_krferg3j4eccjos_rkf_fq.jpeg"><br><br>  Dieser Aufruf gibt ein Array zurück.  Das erste Element ist eine Variable, die den Zugriff auf den Statuswert ermöglicht.  Das zweite Element ist eine Funktion, die den Status aktualisiert und die Komponente neu zeichnet, um die Änderungen widerzuspiegeln. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { useState } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Example</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [state, setState] = useState({<span class="hljs-attr"><span class="hljs-attr">counter</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> add1ToCounter = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newCounterValue = state.counter + <span class="hljs-number"><span class="hljs-number">1</span></span>; setState({ <span class="hljs-attr"><span class="hljs-attr">counter</span></span>: newCounterValue}); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">You clicked {state.counter} times</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{add1ToCounter}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Click me </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); }</code> </pre><br><h4>  useEffect () </h4><br>  Klassenkomponenten reagieren auf Nebenwirkungen mithilfe von Lebenszyklusmethoden wie <code>componentDidMount()</code> .  Mit dem <code>useEffect()</code> Hook können Sie dasselbe in Funktionskomponenten tun. <br><br>  Standardmäßig werden Effekte nach jedem Neuzeichnen ausgelöst.  Sie können jedoch sicherstellen, dass sie erst ausgeführt werden, nachdem Sie die Werte bestimmter Variablen geändert haben, und ihnen den zweiten optionalen Parameter in Form eines Arrays übergeben. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     useEffect(() =&gt; { console.log('     '); }); //    useEffect(() =&gt; { console.log('     valueA'); }, [valueA]);</span></span></code> </pre><br>  Um ein ähnliches Ergebnis wie <code>componentDidMount()</code> zu erzielen, übergeben wir ein leeres Array an den zweiten Parameter.  Da der Inhalt eines leeren Arrays immer unverändert bleibt, wird der Effekt nur einmal ausgeführt. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     useEffect(() =&gt; { console.log('    '); }, []);</span></span></code> </pre><br><h3>  Staatsteilung </h3><br>  Wir haben gesehen, dass ein Hook-Status genauso funktioniert wie ein Klassenkomponentenstatus.  Jede Komponenteninstanz hat ihren eigenen internen Status. <br><br>  Um den Status zwischen den Komponenten zu teilen, erstellen wir unseren eigenen Hook. <br><br><img src="https://habrastorage.org/webt/hp/lw/ke/hplwkebnp9jtdu7vywj5phhsndi.jpeg"><br><br>  Die Idee ist, ein Array von Listenern und nur einen Status zu erstellen.  Jedes Mal, wenn eine Komponente den Status ändert, rufen alle abonnierten Komponenten ihren <code>getState()</code> und werden aus diesem Grund aktualisiert. <br><br>  Wir können dies erreichen, indem <code>useState()</code> in unserem benutzerdefinierten Hook aufrufen.  Anstatt die Funktion <code>setState()</code> , fügen wir sie dem Array von Listenern hinzu und geben eine Funktion zurück, die das <code>setState()</code> intern aktualisiert und alle Listener aufruft. <br><br><h4>  Warte einen Moment.  Wie erleichtert es mir das Leben? </h4><br>  Ja, Sie haben Recht.  Ich habe ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">NPM-Paket erstellt</a> , das die gesamte beschriebene Logik enthält. <br><br>  Sie müssen es nicht in jedem Projekt implementieren.  Wenn Sie keine Zeit mehr mit Lesen verbringen und das Endergebnis sehen möchten, fügen Sie dieses Paket einfach Ihrer Anwendung hinzu. <br><br><pre> <code class="plaintext hljs">npm install -s use-global-hook</code> </pre> <br>  Um zu verstehen, wie mit einem Paket gearbeitet wird, lesen Sie die Beispiele in der Dokumentation.  Und jetzt möchte ich mich darauf konzentrieren, wie das Paket im Inneren angeordnet ist. <br><br><h3>  Erste Version </h3><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useState, useEffect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> listeners = []; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> state = { <span class="hljs-attr"><span class="hljs-attr">counter</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> setState = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newState</span></span></span><span class="hljs-function">) =&gt;</span></span> { state = { ...state, ...newState }; listeners.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">listener</span></span></span><span class="hljs-function">) =&gt;</span></span> { listener(state); }); }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> useCustom = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newListener = useState()[<span class="hljs-number"><span class="hljs-number">1</span></span>]; useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { listeners.push(newListener); }, []); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [state, setState]; }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> useCustom;</code> </pre><br><h4>  Verwendung in Komponenten </h4><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> useCustom <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./customHook'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Counter = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [globalState, setGlobalState] = useCustom(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> add1Global = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newCounterValue = globalState.counter + <span class="hljs-number"><span class="hljs-number">1</span></span>; setGlobalState({ <span class="hljs-attr"><span class="hljs-attr">counter</span></span>: newCounterValue }); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> counter: {globalState.counter} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{add1Global}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> +1 to global </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Counter;</code> </pre><br>  Diese Version bietet bereits den Freigabestatus.  Sie können Ihrer Anwendung eine beliebige Anzahl von Zählern hinzufügen, die alle einen gemeinsamen globalen Status haben. <br><br><h3>  Aber wir können es besser machen </h3><br>  Was willst du: <br><br><ul><li>  Entfernen Sie den Listener aus dem Array, wenn Sie die Bereitstellung der Komponente aufheben. </li><li>  Machen Sie den Hook abstrakter, um ihn in anderen Projekten zu verwenden. </li><li>  Verwalten von <code>initialState</code> mithilfe von Parametern. </li><li>  Schreiben Sie den Haken in einem funktionaleren Stil um. </li></ul><br><h4>  Aufrufen einer Funktion kurz vor dem Aufheben der Bereitstellung einer Komponente </h4><br>  Wir haben bereits herausgefunden, dass das Aufrufen von <code>useEffect(function, [])</code> mit einem leeren Array genauso funktioniert wie <code>componentDidMount()</code> .  Wenn die im ersten Parameter übergebene Funktion jedoch eine andere Funktion zurückgibt, wird die zweite Funktion unmittelbar vor dem Aufheben der Bereitstellung der Komponente aufgerufen.  Genau wie <code>componentWillUnmount()</code> . <br><br>  Im Code der zweiten Funktion können Sie also die Logik zum Entfernen einer Komponente aus einem Array von Listenern schreiben. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> useCustom = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newListener = useState()[<span class="hljs-number"><span class="hljs-number">1</span></span>]; useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     listeners.push(newListener); return () =&gt; { //     listeners = listeners.filter(listener =&gt; listener !== newListener); }; }, []); return [state, setState]; };</span></span></code> </pre><br><h3>  Zweite Version </h3><br>  Zusätzlich zu diesem Update planen wir auch: <br><br><ul><li>  Übergeben Sie den React-Parameter und entfernen Sie den Import. </li><li>  exportiere nicht customHook, sondern eine Funktion, die customHook mit dem angegebenen <code>initalState</code> ; </li><li>  Erstellen Sie ein <code>store</code> , das den <code>setState()</code> und die Funktion <code>setState()</code> . </li><li>  Ersetzen Sie die <code>setState()</code> durch die üblichen in <code>setState()</code> und <code>useCustom()</code> damit Sie den <code>store</code> verknüpfen können. </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newState</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = { ...this.state, ...newState }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">listener</span></span></span><span class="hljs-function">) =&gt;</span></span> { listener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state); }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useCustom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">React</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newListener = React.useState()[<span class="hljs-number"><span class="hljs-number">1</span></span>]; React.useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     this.listeners.push(newListener); return () =&gt; { //     this.listeners = this.listeners.filter(listener =&gt; listener !== newListener); }; }, []); return [this.state, this.setState]; } const useGlobalHook = (React, initialState) =&gt; { const store = { state: initialState, listeners: [] }; store.setState = setState.bind(store); return useCustom.bind(store, React); }; export default useGlobalHook;</span></span></code> </pre><br><h3>  Trennen Sie Aktionen von Komponenten </h3><br>  Wenn Sie jemals mit komplexen Statusverwaltungsbibliotheken gearbeitet haben, wissen Sie, dass die Manipulation eines globalen Status aus Komponenten keine gute Idee ist. <br><br>  Es wäre richtiger, die Geschäftslogik zu trennen, indem Aktionen zum Ändern des Status erstellt werden.  Daher möchte ich, dass die neueste Version des Pakets den Komponenten Zugriff nicht auf <code>setState()</code> , sondern auf eine Reihe von Aktionen <code>setState()</code> . <br><br>  Dazu liefern wir unseren <code>useGlobalHook(React, initialState, actions)</code> dritten Argument.  Ich möchte nur ein paar Kommentare hinzufügen. <br><br><ul><li>  Aktionen haben Zugriff auf das <code>store</code> .  Auf diese Weise können Aktionen den Inhalt von <code>store.state</code> lesen, den <code>store.setState()</code> Aufrufen von <code>store.setState()</code> aktualisieren und sogar andere <code>store.actions</code> durch <code>store.actions</code> von <code>store.actions</code> . </li><li>  Um Unordnung zu vermeiden, kann das Aktionsobjekt Unterobjekte enthalten.  Auf diese Weise können Sie <code>actions.addToCounter(amount</code> ) mit allen Gegenaktionen an ein Unterobjekt übertragen: <code>actions.counter.add(amount)</code> . </li></ul><br><h3>  Endgültige Version </h3><br>  Das folgende Snippet ist die aktuelle Version des NPM-Pakets <code>use-global-hook</code> . <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newState</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = { ...this.state, ...newState }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">listener</span></span></span><span class="hljs-function">) =&gt;</span></span> { listener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state); }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useCustom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">React</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newListener = React.useState()[<span class="hljs-number"><span class="hljs-number">1</span></span>]; React.useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners.push(newListener); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners.filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">listener</span></span></span><span class="hljs-function"> =&gt;</span></span> listener !== newListener); }; }, []); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.actions]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">associateActions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">store, actions</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> associatedActions = {}; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(actions).forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> actions[key] === <span class="hljs-string"><span class="hljs-string">'function'</span></span>) { associatedActions[key] = actions[key].bind(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, store); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> actions[key] === <span class="hljs-string"><span class="hljs-string">'object'</span></span>) { associatedActions[key] = associateActions(store, actions[key]); } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> associatedActions; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> useGlobalHook = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">React, initialState, actions</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = { <span class="hljs-attr"><span class="hljs-attr">state</span></span>: initialState, <span class="hljs-attr"><span class="hljs-attr">listeners</span></span>: [] }; store.setState = setState.bind(store); store.actions = associateActions(store, actions); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> useCustom.bind(store, React); }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> useGlobalHook;</code> </pre><br><h3>  Anwendungsbeispiele </h3><br>  Sie müssen sich nicht mehr mit <code>useGlobalHook.js</code> befassen.  Jetzt können Sie sich auf Ihre Anwendung konzentrieren.  Im Folgenden finden Sie zwei Beispiele für die Verwendung des Pakets. <br><br><h4>  Mehrere Zähler, ein Wert </h4><br>  Fügen Sie so viele Zähler hinzu, wie Sie möchten: Sie haben alle einen globalen Wert.  Jedes Mal, wenn einer der Zähler den globalen Status erhöht, werden alle anderen neu gezeichnet.  In diesem Fall muss die übergeordnete Komponente nicht neu gezeichnet werden. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Lebendes Beispiel</a> . <br><br><h4>  Asynchrone Ajax-Anforderungen </h4><br>  Durchsuchen Sie GitHub-Repositorys nach Benutzernamen.  Wir verarbeiten Ajax-Anfragen asynchron mit async / await.  Wir aktualisieren den Abfragezähler bei jeder neuen Suche. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Lebendes Beispiel</a> . <br><br><h3>  Nun, das ist alles </h3><br>  Wir haben jetzt unsere eigene State-Management-Bibliothek für React Hooks. <br><br><h3>  Übersetzerkommentar </h3><br>  Die meisten vorhandenen Lösungen sind im Wesentlichen separate Bibliotheken.  In diesem Sinne ist der vom Autor beschriebene Ansatz insofern interessant, als er nur die integrierten React-Funktionen verwendet.  Darüber hinaus reduziert dieser Ansatz im Vergleich zu derselben Context-API, die ebenfalls sofort verfügbar ist, die Anzahl unnötiger Neuzeichnungen und gewinnt somit an Leistung. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de454348/">https://habr.com/ru/post/de454348/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de454332/index.html">Wie der Telegramm-Bot den Aufschub der Designer überwunden und zur Steigerung der Einnahmen aus digitalen Agenturen beigetragen hat</a></li>
<li><a href="../de454334/index.html">Moto. Weinen Sie AWS</a></li>
<li><a href="../de454336/index.html">Kunde: - Wie viel kostet eine Kopie von Facebook?</a></li>
<li><a href="../de454340/index.html">% tutnazvanievu% ist die erste Universität der Welt, an der Jetpacks offiziell entwickelt werden</a></li>
<li><a href="../de454346/index.html">Effizienzalgorithmen: Nobelic 2019 Surveillance Camera Review</a></li>
<li><a href="../de454352/index.html">Mathematische Unsicherheiten in Python</a></li>
<li><a href="../de454354/index.html">Praktikum bei JetBrains und wie ich es fast geschafft hätte</a></li>
<li><a href="../de454356/index.html">Habr Weekly # 3 / Runet gegen TV, ARM gegen Intel, Vereinheitlichung von Staatsdaten, ohne Smartphone im Jahr 2019, sowjetische Zukunftsträume</a></li>
<li><a href="../de454366/index.html">Sieg bei PHDays 9. Wir teilen Life Hacks in drei Teilen. Teil 2</a></li>
<li><a href="../de454368/index.html">Entwicklerwettbewerb für TeamCity-Plugins</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>