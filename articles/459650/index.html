<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äçü§ù‚Äçüë®üèΩ ü§ú ‚åõÔ∏è C√≥mo no perder dinero en la caja negra: m√©todos de prueba de facturaci√≥n üèÇ ‚úîÔ∏è üë°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La validaci√≥n de los servicios pagos es uno de los principales problemas de ingenier√≠a en las pruebas de Badoo. Nuestra aplicaci√≥n est√° integrada con ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo no perder dinero en la caja negra: m√©todos de prueba de facturaci√≥n</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/459650/">  La validaci√≥n de los servicios pagos es uno de los principales problemas de ingenier√≠a en las pruebas de Badoo.  Nuestra aplicaci√≥n est√° integrada con 70 proveedores de pago en 250 pa√≠ses del mundo, y un error en al menos uno de ellos puede tener consecuencias impredecibles. <br><br>  En este art√≠culo, hablar√© sobre los m√©todos de prueba que usamos en Badoo y los l√≠mites de aplicabilidad de estos m√©todos, las etapas de prueba en las que son m√°s efectivos. <br><br>  Este art√≠culo ser√° √∫til para probadores, desarrolladores y gerentes de productos, cuyos proyectos ya est√°n integrados con proveedores de pagos, o el proceso de integraci√≥n reci√©n comienza.  Si en su trabajo se enfrenta con el problema de elegir m√©todos de prueba para tales integraciones, ¬°bienvenido a cat! <br><br><img src="https://habrastorage.org/webt/u0/dg/6k/u0dg6kdremnwjnqjqiabc_wq1m8.jpeg"><br><br><a name="habracut"></a><br>  <i>Mi nombre es Vladimir Solodov, soy ingeniero de control de calidad de facturaci√≥n en Badoo: me encargo de verificar las integraciones de prueba y el procesamiento de pagos.</i>  <i>Mi colega Viktor Koronevich me ayud√≥ a preparar el texto: junto con √©l elaboramos un informe en la conferencia de Heisenbug ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">video</a> ).</i>  <i>En el art√≠culo, ampliamos el √°rea de descripci√≥n a todas las integraciones con proveedores de pago que se usan en Badoo, clasificamos y describimos la pr√°ctica de eliminar dependencias externas con m√°s detalle.</i> <br><br>  Utilizando los estudios de casos de negocios como ejemplo, le dir√© por qu√© deber√≠a prestar m√°s atenci√≥n a probar los servicios pagos y c√≥mo no agravar los problemas si, sin embargo, surgen.  Y luego describiremos los problemas t√©cnicos de probar la integraci√≥n y las formas de resolverlos. <br><br>  La segunda parte del art√≠culo, en la que hablamos m√°s sobre la automatizaci√≥n de probar servicios pagos en aplicaciones iOS, est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br>  Vamos! <br><br><h2>  Datos espec√≠ficos de la prueba de facturaci√≥n </h2><br>  Por lo general, el objetivo de un negocio es generar ingresos.  En Badoo, una red social para citas, los ingresos se obtienen mediante pr√©stamos y suscripciones premium.  Los pr√©stamos son la moneda interna de Badoo.  Con su ayuda, por ejemplo, puede elevar su perfil en los resultados de b√∫squeda en primer lugar, hacer un regalo a otro usuario y m√°s.  La suscripci√≥n premium es v√°lida por un cierto per√≠odo de tiempo y le brinda varias opciones a la vez: active el modo "invisible", vea a las personas que han mostrado inter√©s en usted, confirme la autenticidad de su cuenta y mucho m√°s. <br><br>  Para que estos servicios pagos funcionen, utilizamos integraciones con m√°s de 70 proveedores de pago.  La elecci√≥n del proveedor depende de la plataforma, el pa√≠s, el dispositivo, el operador m√≥vil y otros factores.  Por lo tanto, la cuesti√≥n de probar los servicios pagos es muy urgente. <br><br>  Para comenzar, considere por qu√© las pruebas de servicios pagados deben abordarse con especial atenci√≥n.  Hay dos razones <br><br><h4>  1. Los errores de facturaci√≥n son cr√≠ticos para los negocios. </h4><br>  El primer problema es de reputaci√≥n.  El usuario que pag√≥ por el servicio se vuelve m√°s sensible (y menos tolerante) a los errores en la aplicaci√≥n.  Cualquier comentario en el espacio p√∫blico, ya sea una revisi√≥n de una aplicaci√≥n de blog o un comentario en la App Store o Google Play, de un usuario que encuentra un error en un servicio pago, ser√° m√°s emotivo: este es un factor que conduce a la p√©rdida de reputaci√≥n. <br><br>  El segundo problema es que, tan pronto como comienza a recibir dinero de un usuario para un servicio, se convierte en objeto de una ley que protege al consumidor del servicio.  Y las p√©rdidas de reputaci√≥n pueden convertirse f√°cilmente en financieras. <br><br>  Las empresas pierden dinero de tres maneras. <br><br>  La primera forma es <b>reembolsos</b> .  Supongamos que un usuario descubre que le ha vendido un servicio que no cumple con sus expectativas.  En este caso, se pondr√° en contacto con su equipo de soporte.  Sus empleados realizan una investigaci√≥n y descubren que las expectativas del usuario realmente no se materializaron debido a un error en la aplicaci√≥n.  Usted inicia un reembolso.  En este caso, hay un reembolso: como resultado, la empresa se enfrenta a la p√©rdida de beneficios, y esta es la forma m√°s inofensiva de perder dinero. <br><br>  La segunda forma es <b>contracargos</b> .  Supongamos que ocurre la misma situaci√≥n, solo el usuario no se comunic√≥ con su servicio de soporte, sino con el banco que le emiti√≥ la tarjeta o el proveedor de pagos.  El banco / proveedor inicia un reembolso.  En este caso, estamos lidiando con un contracargo.  El peligro para los negocios aqu√≠ no es solo la p√©rdida de ganancias.  Despu√©s de un cierto n√∫mero de contracargos, la empresa recibe una multa y su calificaci√≥n de riesgo disminuye.  La rebaja, a su vez, conduce a un aumento en el costo de los servicios de los proveedores de pagos. <br><br>  La tercera v√≠a: <b>demandas (reclamos)</b> .  En los casos m√°s descuidados, pueden llevarse a cabo demandas (incluidas las colectivas), lo que lleva a las consecuencias m√°s graves.  Entonces, en 2015, despu√©s de una demanda por parte del regulador de Ofgem, British Gas se vio obligado a pagar una compensaci√≥n multimillonaria a los usuarios que cobraron una tarifa m√°s alta debido a un error en el sistema de carga.  Lea m√°s sobre esto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br><h4>  2. Para probar integraciones, se necesitan conocimientos y experiencia. </h4><br>  Los equipos que reci√©n comienzan el proceso de integraci√≥n con los proveedores de pagos a menudo enfrentan este problema.  Sin conocer todos los posibles casos de facturaci√≥n, pierden matices importantes cuando se dan cuenta de la reacci√≥n del sistema a las notificaciones de los proveedores de pagos. <br><br>  Esto puede llevar a consecuencias impredecibles, desde ganancias perdidas hasta usuarios insatisfechos. <br><br>  Veamos el esquema que enumera los tipos de servicios pagos y consideremos el problema con m√°s cuidado. <br><br><img src="https://habrastorage.org/webt/k0/qu/he/k0quhers6cgrorlijjpdjb8pex4.jpeg"><br>  <i><font color="gray">Figura 1. Posibles casos de facturaci√≥n</font></i> <br><br>  Hay tres casos principales: un error, un pago exitoso y un reembolso al usuario.  Pero cada caso tiene detalles, cada caso que su sistema tiene que manejar de manera diferente. <br><br>  <b>Los errores</b> pueden ser cr√≠ticos y no cr√≠ticos.  El error de notificaci√≥n se puede atribuir a no cr√≠tico, cuando el proveedor de pagos informa sobre la falta de fondos en la cuenta del usuario, y cr√≠tico, el bloqueo del m√©todo de pago del usuario.  Y si en el primer caso puede intentar pagar m√°s tarde, en el segundo, ser√≠a bueno saber por qu√© el m√©todo est√° bloqueado.  Quiz√°s el usuario fue notado en fraude y usted deber√≠a ser m√°s cuidadoso con sus transacciones. <br><br>  <b>Reembolsos</b>  Ya sabe que hay dos tipos de devoluciones: reembolsos y devoluciones de cargo.  Su sistema debe responder de manera diferente a ellos.  Por ejemplo, despu√©s de una devoluci√≥n de cargo, tiene sentido pensar en bloquear algunas funciones de su aplicaci√≥n para el usuario, porque la devoluci√≥n de cargo es uno de los m√©todos de fraude m√°s populares. <br><br>  <b>Un pago exitoso</b> puede ser un <b>pago √∫nico</b> o puede ser una suscripci√≥n. <br><br>  Los pagos √∫nicos pueden ser consumibles y no consumibles.  Un ejemplo de un pago gastado, lo examinamos al comienzo del art√≠culo: estos son pr√©stamos en Badoo.  Se puede dar un ejemplo de un pago no prescindible de los juegos.  Supongamos que tienes un personaje que juegas.  Desea comprar para √©l superpoderes que han existido durante alg√∫n tiempo.  En este caso, la compra pertenece a la clase de pagos no prescindibles. <br><br>  <b>Suscripciones</b>  Aqu√≠ est√° la mayor variedad de casos.  Adem√°s de la compra inicial de una suscripci√≥n, puede tener: <br><br><ul><li>  renovaci√≥n de una suscripci√≥n (renovar); <br></li><li>  cerrar suscripci√≥n (cancelar suscripci√≥n); <br></li><li>  suscripci√≥n de prueba (prueba); <br></li><li>  suscripci√≥n al per√≠odo de gracia: cuando no podemos renovar la suscripci√≥n e intentamos pagar nuevamente por un per√≠odo de tiempo llamado per√≠odo de gracia.  Para el usuario, el per√≠odo de gracia se ve as√≠.  Suponga que compr√≥ una suscripci√≥n mensual al peri√≥dico.  La compa√±√≠a que le env√≠a peri√≥dicos est√° tratando de cancelar el pago para el pr√≥ximo mes de suscripci√≥n despu√©s del final del primer mes, pero no puede hacerlo (debido a un bloqueo de tarjeta, falta de fondos en la cuenta, etc.).  Si el per√≠odo de validez del per√≠odo de gracia es de diez d√≠as, durante este tiempo la compa√±√≠a intenta cancelar el pago, mientras que la suscripci√≥n sigue siendo v√°lida.  Si la empresa no puede cancelar el dinero, la suscripci√≥n se cancela.  Si es as√≠, la suscripci√≥n se renueva a partir de la fecha del √∫ltimo pago; <br></li><li>  pago parcial (facturaci√≥n parcial).  Por ejemplo, PayPal le permite realizar pagos parciales si la cuenta del usuario no tiene fondos suficientes (pago parcial) o dividir el pago en partes (factura parcial). <br></li></ul><br>  Tambi√©n debe tener en cuenta dos caracter√≠sticas que dependen completamente del proveedor de pagos: la suscripci√≥n puede ser controlada por su aplicaci√≥n o administrada externamente. <br><br><ul><li>  Una suscripci√≥n administrada internamente es, por ejemplo, una suscripci√≥n que utiliza tarjetas de cr√©dito o PayPal, cuando despu√©s del primer pago se le entrega un token con el que vuelve a presentar una solicitud al proveedor, sin tener los detalles de pago del usuario. <br></li><li>  Una suscripci√≥n administrada externamente es cuando el agregador de pagos toma el control total de sus suscripciones y simplemente le env√≠a notificaciones sobre sus estados actuales. <br></li></ul><br>  En la figura, las √°reas m√°s obvias, cuya reacci√≥n generalmente se realiza en primer lugar, est√°n resaltadas en p√∫rpura.  Todos los dem√°s comienzan a tenerse en cuenta mucho m√°s tarde, como la acumulaci√≥n de experiencia.  Esto se ve facilitado en gran medida por la aplicaci√≥n incorrecta de metodolog√≠as de desarrollo iterativo en el campo de la facturaci√≥n. <br><br><img src="https://habrastorage.org/webt/7x/kf/bj/7xkfbjf-z3shfhzuftrl3p0tms4.jpeg"><br>  <i><font color="gray">Figura 2. Casos de facturaci√≥n que se implementan principalmente en sistemas</font></i> <br><br>  Tal implementaci√≥n por etapas puede conducir a consecuencias impredecibles.  Por ejemplo, en uno de los proyectos en los que trabaj√© antes de Badoo, no se tuvo en cuenta la posibilidad de hacer un reembolso.  Como resultado, todos los retornos se realizaron no a trav√©s de reembolsos, sino a trav√©s de devoluciones de cargo, lo que afect√≥ negativamente la calificaci√≥n de riesgo de la compa√±√≠a y condujo a fallas en la recolecci√≥n de estad√≠sticas de ingresos.  La ignorancia de toda la variedad de casos de facturaci√≥n puede conducir a la p√©rdida de ganancias o a la vulnerabilidad de la empresa a los usuarios que se sienten enga√±ados. <br><br>  Por lo tanto, por un lado, los errores en el procesamiento de pagos deben encontrarse antes del lanzamiento, ya que pueden tener las consecuencias m√°s negativas.  Si esto no fuera posible, es importante comprender lo m√°s r√°pido posible que el error entr√≥ en la versi√≥n de lanzamiento de la aplicaci√≥n, solucionarlo y, lo m√°s importante, lo que muchas personas olvidan, "tranquilizar" a los usuarios que se encuentran con este error. <br><br>  Por otro lado, la situaci√≥n se complica por el hecho de que la integraci√≥n con los proveedores de pagos es siempre una interacci√≥n con el recuadro negro, que agrega muchas variables al proceso de prueba. <br><br><h2>  Problemas t√©cnicos durante las pruebas de facturaci√≥n </h2><br>  Consideremos el ejemplo de la integraci√≥n de Badoo con la App Store. <br><br>  Las suscripciones en la App Store pertenecen a la clase de administraci√≥n externa, es decir, se administran completamente del lado del proveedor, y nuestro sistema solo puede solicitar el estado actual o recibir una notificaci√≥n de su cambio. <br><br>  Elegimos espec√≠ficamente esta integraci√≥n, ya que es la m√°s compleja y contiene toda la variedad de casos que se pueden encontrar en el proceso de integraci√≥n del servicio con otros proveedores de pagos. <br><br>  Para empezar, recurrimos a una compra desechable por √∫nica vez. <br><br><img src="https://habrastorage.org/webt/ob/xi/rd/obxirdlzjhofj6uvioqwixp-r2k.png"><br>  <i><font color="gray">Figura 3. El proceso de hacer un pago prescindible por √∫nica vez</font></i> <br><br>  En el paso 1, el usuario realiza una solicitud para comprar el servicio.  La aplicaci√≥n decide que se debe realizar el pago y, en el paso 2, el control se transfiere al proveedor de pagos (App Store).  Paso 3: se le presenta al usuario un formulario para realizar un pago.  Paso 4: el usuario proporciona datos para el pago.  Paso 5: el proveedor completa la transacci√≥n e informa el resultado a la aplicaci√≥n, devolviendo un recibo que contiene informaci√≥n completa sobre la compra (fecha, servicio, estado, etc.).  Paso 6: el cheque, complementado con los datos del usuario, se env√≠a al servidor para su procesamiento.  El servidor procesa los datos de verificaci√≥n y genera una notificaci√≥n push para la aplicaci√≥n en el s√©ptimo paso.  En el octavo paso, la notificaci√≥n se muestra al usuario. <br><br>  El problema es que los pasos 3, 4 y 5 se realizan del lado del proveedor de pagos, pr√°cticamente no est√°n controlados por nosotros y pueden tener varias variaciones.  Por lo tanto, el proceso en realidad no tiene una estructura lineal, como se muestra en la Figura 2, sino una ramificaci√≥n (ver Figura 4), y cada rama debe ser manejada de manera diferente por la aplicaci√≥n. <br><br><img src="https://habrastorage.org/webt/8h/ur/mv/8hurmv5_d6mact7vy90jcdb9s_i.png"><br>  <i><font color="gray">Figura 4. Ramificaci√≥n de un diagrama de estado de pago √∫nico</font></i> <br><br>  La compra de suscripciones comienza de la misma manera que un pago √∫nico, pero el control adicional del proceso es bastante dif√≠cil de controlar. <br><br><img src="https://habrastorage.org/webt/lj/di/eb/ljdiebqce8tfo236xv8gir0jaa4.png"><br>  <i><font color="gray">Figura 5. Estados de suscripci√≥n gestionados externamente</font></i> <br><br>  Perm√≠tame recordarle que la suscripci√≥n de Apple, que consideramos como un ejemplo, se administra de forma externa.  Esto significa que el usuario despu√©s de la compra puede administrarlo de forma as√≠ncrona: cerrar, cambiar la fecha de vencimiento, solicitar un reembolso.  Vemos esto en el paso 9. Dado que la acci√≥n se lleva a cabo fuera de nuestro sistema, en la figura la marqu√© con una l√≠nea de puntos. <br><br>  En el paso 10, App Store puede cambiar el estado de la suscripci√≥n: renovar, cerrar, ingresar el per√≠odo de gracia en la ventana. <br><br>  Para que podamos averiguar en qu√© estado se encuentra la suscripci√≥n, hay un paso 11, que es espec√≠fico para los agregadores como App Store y Google Wallet.  En este paso, el sistema env√≠a un token, que se utiliza como un recibo recibido al principio al comprar una suscripci√≥n o despu√©s de su renovaci√≥n anterior. <br><br>  El paso 12 es la respuesta del proveedor.  Recibimos un cheque con el estado actual de la suscripci√≥n.  El resultado en este paso depende de los pasos asincr√≥nicos 9 y 10. <br><br>  En el oto√±o de 2018, Apple implement√≥ un mecanismo de <b>notificaciones</b> de <b>servidor a servidor</b> , que le permite notificar los cambios que se han producido con una suscripci√≥n.  La recepci√≥n de dicha notificaci√≥n se muestra en el paso 13. Para la mayor√≠a de los otros proveedores, el mecanismo de notificaci√≥n de servidor a servidor es el √∫nico, por lo que se puede argumentar que el ejemplo de Apple cubre toda la variedad de casos.  En el caso de otros proveedores, el paso 13 le permite excluir los pasos 11 y 12 del esquema. <br><br>  En el paso 14, el servidor genera una respuesta para que la aplicaci√≥n cambie el estado de la suscripci√≥n. <br><br>  Por lo tanto, obtuvimos un gr√°fico completo de los estados que se deben aprobar para verificar los servicios pagados. <br><br><img src="https://habrastorage.org/webt/tg/he/vx/tghevxtlppxvc9xuqt4wczbav0s.png"><br>  <i><font color="gray">Figura 6. El proceso completo de cambio de estados de pago (usando un ejemplo de suscripci√≥n administrado externamente)</font></i> <br><br>  Las partes que no controlamos en nuestro sistema est√°n coloreadas en naranja y son cajas negras para nosotros. <br><br><h2>  M√©todos de prueba de facturaci√≥n </h2><br>  Por lo tanto, el principal problema t√©cnico al probar servicios pagos es la presencia de "cajas negras", cuyos estados tenemos muy poco control.  Esto define un conjunto de m√©todos que pueden cubrir toda la variedad de casos. <br><br>  No hay muchos de estos m√©todos, y los dividimos en tres categor√≠as: pagos reales, cajas de arena y eliminaci√≥n de dependencias externas de las "cajas negras". <br><br><h3>  Pagos reales </h3><br>  Los pagos reales como m√©todo de prueba son buenos porque dan una idea clara del estado de integraci√≥n.  Un error al hacer un pago real es una evidencia incondicional de un error. <br><br>  De lo contrario, los pagos reales son malos.  En primer lugar, es costoso: es obvio que para realizar un pago real, debe gastar dinero real.  Se equivoca si cree que al final se devolver√° el monto total a la empresa: en primer lugar, los proveedores cobran una tarifa por cada transacci√≥n, cuyo tama√±o, como se describe anteriormente, depende de la calificaci√≥n de riesgo de la organizaci√≥n y puede alcanzar el 40% (e incluso m√°s) ;  en segundo lugar, puede perder dinero al probar pagos en otros pa√≠ses debido al diferencial de divisas: la diferencia entre las tasas de compra y venta de la moneda (realizar√° la compra a la tasa de venta de moneda extranjera del banco, y la devoluci√≥n se realizar√° a la tasa de compra). <br><br>  Adem√°s, este m√©todo puede llevar mucho tiempo, ya que debe esperar hasta el final del per√≠odo de renovaci√≥n de la suscripci√≥n, la finalizaci√≥n de los per√≠odos de gracia y estos pueden ser meses. <br><br><h3>  Cajones de arena </h3><br>  Las cajas de arena son hermosas.  De hecho, esta es la misma funcionalidad que nos brinda un proveedor de pagos en el caso de un pago real, pero sin gastar dinero real.  Es totalmente compatible con el proveedor, lo que significa que la integraci√≥n con el sandbox es barata. <br><br>  El problema de la duraci√≥n de las pruebas a lo largo del tiempo se resuelve, por regla general, utilizando varios trucos.  Por ejemplo, el sandbox de App Store usa la siguiente conversi√≥n de caducidad de suscripci√≥n. <br><br><div class="scrollable-table"><table><tbody><tr><td>  Suscripci√≥n en tiempo real <br></td><td>  Tiempo de suscripci√≥n de Apple Sandbox <br></td></tr><tr><td>  1 semana <br></td><td>  3 minutos <br></td></tr><tr><td>  1 mes <br></td><td>  5 minutos <br></td></tr><tr><td>  2 meses <br></td><td>  10 minutos <br></td></tr><tr><td>  3 meses <br></td><td>  15 minutos <br></td></tr><tr><td>  6 meses <br></td><td>  30 minutos <br></td></tr><tr><td>  1 a√±o <br></td><td>  1 hora <br></td></tr></tbody></table></div>  <i><font color="gray">Tabla 1. La relaci√≥n del per√≠odo de validez de una suscripci√≥n real y una suscripci√≥n en el sandbox de Apple</font></i> <br><br>  Las suscripciones de sandbox predeterminadas de Google Wallet se enumeran en la tabla 2 y se pueden configurar en la consola del vendedor. <br><br><div class="scrollable-table"><table><tbody><tr><td>  Suscripci√≥n en tiempo real <br></td><td>  Tiempo de suscripci√≥n a Google Sandbox <br></td></tr><tr><td>  1 semana <br></td><td>  5 minutos <br></td></tr><tr><td>  1 mes <br></td><td>  5 minutos <br></td></tr><tr><td>  3 meses <br></td><td>  10 minutos <br></td></tr><tr><td>  6 meses <br></td><td>  15 minutos <br></td></tr><tr><td>  1 a√±o <br></td><td>  30 minutos <br></td></tr></tbody></table></div>  <i><font color="gray">Tabla 2. Configuraci√≥n de la duraci√≥n de una suscripci√≥n en el sandbox de Google</font></i> <br><br>  A diferencia del sandbox de Apple, tambi√©n puede verificar la versi√≥n de prueba, el per√≠odo de gracia, etc., en el sandbox de Google, utilizando la proporci√≥n de la Tabla 3. <br><br><div class="scrollable-table"><table><tbody><tr><td>  Suscripci√≥n en tiempo real <br></td><td>  Tiempo de suscripci√≥n a Google Sandbox <br></td></tr><tr><td>  Periodo de prueba <br></td><td>  3 minutos <br></td></tr><tr><td>  Per√≠odo de prueba (introductorio) <br></td><td>  Igual al tiempo de la suscripci√≥n correspondiente. <br></td></tr><tr><td>  Per√≠odo de gracia (3/7 d√≠as) <br></td><td>  5 minutos <br></td></tr><tr><td>  Bloqueo temporal de cuenta (retener) <br></td><td>  10 minutos <br></td></tr><tr><td>  Pausa (1/2/3 meses) <br></td><td>  5/10/15 minutos (respectivamente) <br></td></tr></tbody></table></div>  <i><font color="gray">Tabla 3. Validez de las caracter√≠sticas de suscripci√≥n adicionales en el entorno limitado de Google</font></i> <br><br>  El cierre de una suscripci√≥n tambi√©n se puede implementar de diferentes maneras: en el sandbox de App Store, el cierre se realiza despu√©s de la quinta renovaci√≥n, y en Google Wallet se realiza desde la consola del vendedor o en el dispositivo desde Play Store. <br><br>  El problema con los sandboxes es que los proveedores tienen una actitud diferente con respecto a su calidad.  Nuestra experiencia muestra que de los m√°s de 70 proveedores de pagos que est√°n integrados en Badoo, solo dos sandboxes cuentan con funcionalidad completa y operaci√≥n estable.  Estas son las cajas de arena de Adyen y PayPal.  Otros proveedores tienen funciones estables, pero truncadas en t√©rminos de funcionalidades (como Google Wallet), o inestables y muy truncadas en funcionalidad (como App Store y Fortumo).  Y hay proveedores que no tienen ni van a tener una caja de arena. <br><br><img src="https://habrastorage.org/webt/iz/as/im/izasimha0d95e0w214ym9kyfhcy.png"><br>  <i><font color="gray">Figura 7. Clasificaci√≥n de sandboxes por estabilidad y funcionalidad.</font></i> <br><br><h3>  Eliminar dependencias externas </h3><br>  Si lo convencimos de que las pruebas con pagos reales son costosas e ineficientes, y los proveedores de pagos no proporcionan cajas de arena de calidad adecuada, entonces queda por recurrir a varias formas de eliminar las dependencias externas.  Solo hay tres de ellos: moki, falsificaciones y trozos. <br><br>  Moki en la facturaci√≥n es la formaci√≥n de las reacciones de su sistema a las solicitudes con par√°metros predeterminados sin una llamada real al proveedor de pagos (ver Fig. 8).  Por ejemplo, una solicitud a un proveedor de pagos por SMS al n√∫mero + 7111-111-11-11 se intercepta en la etapa de enviar una solicitud al proveedor y genera una respuesta del sistema en forma de un pago exitoso.  La solicitud al n√∫mero + 7111-111-11-12 tambi√©n se intercepta, pero provoca una reacci√≥n a un error con el c√≥digo "No hay suficiente dinero para completar la transacci√≥n". <br><br><img width="340" src="https://habrastorage.org/webt/cb/zi/xy/cbzixy8v5c16-fjdnobzksxoij4.png"><br>  <i><font color="gray">Figura 8. Diagrama simulado</font></i> <br><br>  Las falsificaciones en la facturaci√≥n son falsificaciones de notificaciones (como si vinieran de un proveedor real) (ver. Fig. 9).  La integraci√≥n con cada proveedor implica un conjunto limitado de reacciones del sistema a un conjunto limitado de tipos de notificaciones o restablecimientos.             (      ),          . <br><br><img width="340" src="https://habrastorage.org/webt/t5/nz/_h/t5nz_hwuq-49im9ow_csqennjh4.png"><br> <i><font color="gray"> 9.  </font></i> <br><br>    ‚Äî               (. . 10),                        . <br><br><img width="340" src="https://habrastorage.org/webt/-z/3p/f8/-z3pf8attjz-fiitaqbanlhmbbe.png"><br> <i><font color="gray"> 10.  </font></i> <br><br>          ,      ,                     .      (, , )      .  ,      , ,             ,   . <br><br>      .  3, 4, 5    :    ,      .             -   :          ,    ‚Äî   ,    ‚Äî  .     ¬´  ¬ª. <br><br><img src="https://habrastorage.org/webt/2p/cu/w-/2pcuw-rvhju4ngyzr3ez7rqlhco.png"><br> <i><font color="gray"> 11.            (     App Store)</font></i> <br><br>   ,       (,      ).   ‚Äî      ,     .       . ,   ,           ,            .    ,          . ,              . <br><br><h2>     </h2><br>      .   ,          ?        : <br><br><ul><li>    ‚Äî          ? <br></li><li>   end-to-end ‚Äî    :             -  ? <br></li><li>  ‚Äî   :     ,        . <br></li></ul><br>      . <br><br><img src="https://habrastorage.org/webt/ck/sn/re/cksnrehqrplo3q14juwsyrar31m.png"><br> <i><font color="gray"> 4.     </font></i> <br><br> <b> .</b>    .     .     ,      .   :     ,   . <br><br> <b>.</b> , ,  Apple  Google, .        (   ).      end-to-end :           .  , ,   . <br><br> <b>, , </b> ‚Äî   .      .            .  :         . <br><br><h2>    </h2><br>    ,       ,     . <br><br>      ,        .         . <br><br>      :     .  ,     , ‚Äî            . <br><br>         ,    :     ‚Äî , , ;     ‚Äî    :    . <br><br><img src="https://habrastorage.org/webt/hc/rg/ka/hcrgka-jxqtj6rftvexttwrlvqw.jpeg"><br> <i><font color="gray"> 12.        </font></i> <br><br><h2>     </h2><br>   ,  ,       ,      ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> . <br><br>      ,      12,      Badoo. <br><br><h4>     </h4><br>          .       .    QA-      .   ,    . ,  -   ,              ,   .   ,         . <br><br>  :      . <br><br><h4>      </h4><br>  ,      , ‚Äî     . ,    Apple      .         .   ,     .       :            -  . <br><br>   ‚Äî ,   . -,       . -,    ,  -,   ,          . <br><br>      ‚Äî    :                    ,   Apple   .       1  ‚Äî ,         . <br><br><h4>      </h4><br>            .          ,       .        ,     -    . <br><br>          ,             (       ). <br><br><h2>  Conclusiones </h2><br><ol><li>      ,          . <br></li><li>       (     )         .           ,          . <br></li><li>     ¬´ ¬ª  ,     .     -         ‚Äî     .     ,  : ,    ‚Äî  ,     ‚Äî     . <br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al utilizar falsificaciones, mokas y talones, es importante recordar que estos son modelos de pago reales y, como cualquier modelo, tienen un grado de aproximaci√≥n a la realidad y los riesgos. </font><font style="vertical-align: inherit;">Estos riesgos deben evaluarse y cubrirse mediante pagos reales o mediante controles adicionales.</font></font><br></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre c√≥mo logramos lograr una automatizaci√≥n estable y econ√≥mica de probar servicios pagados en una aplicaci√≥n iOS, hablamos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en el pr√≥ximo art√≠culo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gracias por su atencion! </font><font style="vertical-align: inherit;">¬°Todas las grandes ganancias y menos errores!</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/459650/">https://habr.com/ru/post/459650/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../459638/index.html">Crear una base de conocimiento global sobre bater√≠as</a></li>
<li><a href="../459640/index.html">Documentos como c√≥digo. Parte 1: automatizar la actualizaci√≥n</a></li>
<li><a href="../459642/index.html">Acceso seguro para registrar campos en C ++ sin sacrificar la eficiencia (utilizando CortexM como ejemplo)</a></li>
<li><a href="../459644/index.html">Atenuadores LED</a></li>
<li><a href="../459648/index.html">Todo deber√≠a estar bien en el analizador: tanto la funcionalidad como la interfaz ... Estamos explorando la nueva interfaz Solar appScreener 3.1</a></li>
<li><a href="../459652/index.html">Enfoque de prueba de regresi√≥n automatizada</a></li>
<li><a href="../459656/index.html">Servicio OData sin escribir c√≥digo</a></li>
<li><a href="../459658/index.html">PVS-Studio quer√≠a pero no pudo encontrar errores en robots.txt</a></li>
<li><a href="../459662/index.html">PVS-Studio quer√≠a, pero no pudo encontrar errores en robots.txt</a></li>
<li><a href="../459668/index.html">C√≥mo reconocer el texto de una foto: nuevas caracter√≠sticas del marco Vision</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>