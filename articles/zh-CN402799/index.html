<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👶🏽 🔐 🕐 Noolite MTRF-32 + Arduino + Domoticz 👨🏿‍🚀 👭 🆒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在本文中，我描述了如何将Noolite MTRF-32模块连接到基于Domoticz的智能家居控制系统。 

 关于房屋本身的一些知识 
 我的房子是私人的。 它已经在MySensors上引入了一些基于Domoticz的智能家居和无线执行器的基础知识。 

 目前，已经实现了开门传感器，房屋照明，家...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Noolite MTRF-32 + Arduino + Domoticz</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/402799/"> 在本文中，我描述了如何将Noolite MTRF-32模块连接到基于Domoticz的智能家居控制系统。 <br><a name="habracut"></a><br><h3> 关于房屋本身的一些知识 </h3><br> 我的房子是私人的。 它已经在MySensors上引入了一些基于Domoticz的智能家居和无线执行器的基础知识。 <br><br> 目前，已经实现了开门传感器，房屋照明，家庭和街道上的温度和湿度传感器，有关事件和天气预报的语音通知。 <br><br> 房子是木制的，所以我真的不想通过关闭来自中国的卷轴来控制照明。 也不能选择在任何地方拉电线。 经过深思熟虑，灯光控制已在动力装置和Noolite控制台上完成，但仍以某种方式与Domoticz成为了朋友。 <br><br> 此时，Noolite的有关MTRF-32模块的文章引起了我的注意。  Domoticz支持发送HTTP GET请求。 使用带有反馈的模块的前景也很诱人，因此订购了该模块。 <br><br><h3> 关于切割前需要测量7次的内容 </h3><br> 事实证明，我购买的不是您所需要的。 购买时，有一个MTRF-32模块可用。 在阅读本文时，我没有看到有关这些模块种类的信息。 通常，我需要USB版本的MTRF-32-USB。 <br><br><div class="spoiler">  <b class="spoiler_title">应该澄清</b> <div class="spoiler_text">  32表示可以控制32个通道。 迄今为止，noolite网站上提供了具有64个通道的模块，具有带或不带USB的两个选项。 给MTRF-32读者的问题可以以某种方式更新为MTRF-64吗？ <br></div></div><br> 完成的工作已经完成。 披肩被推迟，直到<s>有人</s>安排<s>了</s>更好的<s>图书馆</s> 。 <br><br> 由于某些原因，最好的时机还没有到。 尽管我认为该系统很受欢迎。 <br><br><h3> 第一次尝试 </h3><br> 访问该站点后，Noolite找到了可与MTRF-64-USB一起使用的NooliteOne软件。 事实证明，它通过一个COM端口工作，我意识到MTRF-64与带有内置USB-COM适配器的MTRF-64-USB不同。 捆绑的软件包括来自FTDI芯片的驱动程序，而我的开发板具有合适的接触垫。 <br><br> 我没有焊接芯片。 但是我用FTDI用中文Arduino Nano制造了一个USB-COM适配器，并将其连接到板上。 <br><br> 它没有起飞。 由于某些原因，NooliteOne无法找到我的适配器。 当我发现MT1132模块的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">库</a>时，我已经开始着眼于反编译。 <br><br><h3> 第二次尝试 </h3><br> 我比较了模块的描述，并意识到在数据传输方面，它们几乎没有区别。 对于我来说，在MT1132库中实现的功能就足够了（尚不需要反馈-没有合适的电源装置）。 <br><br> 在更正了库中的代码之后，我开始收到来自MTRF-32的响应。 奇怪的是，一切都在第一次生效。 这是最后发生的事情： <br><br><div class="spoiler">  <b class="spoiler_title">阿敦努</b> <div class="spoiler_text"><pre><code class="javascript hljs"> </code> </pre> <br>  #ifndef ARDUNOO_H <br>  ＃定义ARDUNOO_H <br><br>  ＃如果已定义（ARDUINO）&amp;&amp; ARDUINO&gt; = 100 <br>  #include“ Arduino.h” <br>  #else <br>  #include“ WProgram.h” <br>  #endif <br><br>  #include &lt;SoftwareSerial.h&gt; <br><br>  ArduNoo类{ <br><br> 字节chnl; <br>  ns系列软件； <br><br> 公开： <br>  ArduNoo（字节rx，字节tx，字节ch = 0）; <br> 无效（字节ch = -1）； <br> 无效（字节ch = -1）; <br> 无效的onoff（字节ch = -1）; <br> 无效绑定（字节ch = -1）; <br> 无效解除绑定（字节ch = -1）; <br><br>  bool命令（字节通道，字节命令）； <br>  }; <br><br>  #endif <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Ardunoo.cpp</b> <div class="spoiler_text">  #include &lt;ardunoo.h&gt; <br><br>  ArduNoo :: ArduNoo（字节RX，字节TX，字节ch）：ns（RX，TX）{ <br>  chnl = ch; <br>  ns.begin（9600）; <br>  } <br><br>  void ArduNoo ::关闭（字节ch）{ <br> 命令（ch，0）; <br>  } <br><br>  void ArduNoo :: on（字节ch）{ <br> 命令（ch，2）; <br>  } <br><br>  void ArduNoo :: onoff（字节ch）{ <br> 命令（ch，4）; <br>  } <br><br>  void ArduNoo ::解除绑定（字节ch）{ <br> 命令（ch，9）; <br>  } <br><br>  void ArduNoo ::绑定（字节ch）{ <br> 命令（ch，15）; <br>  } <br><br>  bool ArduNoo ::命令（字节chnl，字节命令）{ <br> 静态字节i，r，buf [17] = {171,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,172）; <br>  int sum = 0; <br><br>  memset（buf + 2,0,14）;  / *清除邮件正文* / <br>  buf [4] = chnl; <br>  buf [5] =命令； <br><br> 对于（i = 0; i &lt;15; ++ i）{// 10 <br> 和+ = buf [i]; <br>  } <br>  buf [15] = lowByte（sum）; // 10 <br>  buf [16] = 172; // 11 <br><br> 对于（i = 0; i &lt;17; ++ i）{ <br>  ns.write（buf [i]）; <br>  } <br>  //调试代码 <br> 对于（i = 0; i &lt;17; ++ i）{ <br>  while（！ns.available（））延迟（10）; <br>  r = ns.read（）; <br>  Serial.print®; <br>  } <br>  Serial.println（）; <br><br> 返回true； <br>  } <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Ardunoo.ino</b> <div class="spoiler_text">  #include &lt;SoftwareSerial.h&gt; <br>  #include &lt;ardunoo.h&gt; <br><br>  ＃定义RXpin 10 <br>  ＃定义TXpin 11 <br><br>  ArduNoo noo（RXpin，TXpin）; <br> 字符串readString，chString; <br><br> 无效设置（）{ <br>  Serial.begin（9600）; <br>  } <br><br> 无效循环（）{ <br>  readString =“”; <br>  chString =“”; <br> 而（Serial.available（））{ <br> 延迟（3）;  //延迟以允许缓冲区填充 <br> 如果（Serial.available（）&gt; 0）{ <br>  char c = Serial.read（）;  //从串行缓冲区获取一个字节 <br>  readString + = c;  //使字符串为readString <br>  } <br>  } <br>  if（readString.length（）&gt; 1 &amp;&amp; readString.length（）&lt;4）{//我们期望1个字母和1或2个数字（ch = 0-31） <br>  for（int i = 1; i &lt;readString.length（）; i ++）{ <br> 如果（isDigit（readString [i]））{ <br>  chString.concat（readString [i]）; <br>  } <br>  } <br>  //Serial.println(readString[0]）; <br>  int ch = chString.toInt（）; <br> 开关（readString [0]）{ <br> 情况'n'：//开 <br>  noo.on（ch）; <br> 打破 <br> 情况'f'：//关闭 <br>  noo.off（ch）; <br> 打破 <br>  case'x'：//切换 <br>  noo.onoff（ch）; <br> 打破 <br> 案例'b'：//绑定 <br>  noo.bind（ch）; <br> 打破 <br> 案例'u'：//取消绑定 <br>  noo.unbind（ch）; <br> 打破 <br> 案例'y'：//在所有频道上 <br>  for（int i = 0; i &lt;32; i ++）{ <br> 不（i）; <br> 延误（100）; <br>  } <br> 打破 <br> 案例'z'：//关闭所有频道 <br>  for（int i = 0; i &lt;32; i ++）{ <br>  noo.off（i）; <br> 延误（100）; <br>  } <br> 打破 <br>  } <br>  } <br>  } <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Zhumatiy Sergey的图书馆许可</b> <div class="spoiler_text">  MIT许可证（MIT） <br><br> 版权所有©2014 Zhumatiy Sergey <br><br> 特此授予获得副本的任何人免费的许可 <br> 软件和相关文档文件（以下简称“软件”）的交易 <br> 在软件中不受限制，包括但不限于权利 <br> 使用，复制，修改，合并，发布，分发，再许可和/或出售 <br> 本软件的副本，并允许本软件所针对的人 <br> 具备以下条件： <br><br> 上述版权声明和此许可声明应包含在所有 <br> 软件的副本或实质性部分。 <br><br> 本软件按“原样”提供，不提供任何形式的明示或明示保证。 <br> 暗示（包括但不限于对适销性的保证）， <br> 适用于特定目的和非侵权。 在任何情况下都不会 <br> 作者或版权持有人对任何索赔，损害或其他责任 <br> 无论是由于合同，侵权或其他原因而引起的责任， <br> 与软件或软件的使用或其他处理无关或与之有关 <br> 软件。 <br></div></div><br> 已实现的命令将关闭，打开，切换，全部打开，全部关闭。 <br><br> 事情很小，您需要向com端口提供命令。 由于这在Windows上的Domoticz中是有问题的，因此我决定编写一个控制台应用程序，该应用程序将转换lua脚本中的命令。 命令作为启动参数传递给应用程序。 <br><br><div class="spoiler">  <b class="spoiler_title">noo.cs</b> <div class="spoiler_text"> 使用系统； <br> 使用System.Collections.Generic; <br> 使用System.Linq; <br> 使用System.Text; <br> 使用System.IO.Ports; <br><br> 命名空间noo <br>  { <br> 班级计划 <br>  { <br> 静态void Main（字符串[] args） <br>  { <br> 如果（args.Length == 2） <br>  { <br>  SerialPort COM =新的SerialPort（参数[0]）； <br>  COM.Open（）; <br>  COM.WriteLine（args [1]）; <br>  COM.Close（）; <br>  } <br>  } <br>  } <br>  } <br></div></div><br><h3> 命令示例： </h3><br>  noo.exe com5 n4-打开通道4上的灯，将其传输到COM5端口上的Arduino板。 第二个触发器参数的可能值： <br><br><ul><li>  nX-启用通道X </li><li>  fX-关闭频道X </li><li>  xX-切换频道X </li><li>  bX-将电源块绑定到通道X </li><li>  uX-从通道X解开电源块 </li><li>  yX-启用所有通道，X任意值 </li><li>  zX-关闭所有通道，X任意值 </li></ul><br><div class="spoiler">  <b class="spoiler_title">lua脚本</b> <div class="spoiler_text"> 本地传感器1 ='SWHallWay' <br> 本地传感器2 ='SWHall' <br> 本地传感器3 ='SWKitchen' <br> 本地传感器4 ='SWBedroom' <br> 本地传感器5 ='BTNLiteOff' <br>  commandArray = {} <br> 如果（devicechanged [sensor1] =='On'），则 <br>  os.execute（“ c：\\ PROGRA〜1 \\ Domoticz \\脚本\\ noo.exe com4 n3”） <br> 结束 <br> 如果（devicechanged [sensor1] =='Off'），则 <br>  os.execute（“ c：\\ PROGRA〜1 \\ Domoticz \\脚本\\ noo.exe com4 f3”） <br> 结束 <br> 如果（devicechanged [sensor2] =='On'），则 <br>  os.execute（“ c：\\ PROGRA〜1 \\ Domoticz \\脚本\\ noo.exe com4 n0”） <br> 结束 <br> 如果（devicechanged [sensor2] =='Off'），则 <br>  os.execute（“ c：\\ PROGRA〜1 \\ Domoticz \\脚本\\ noo.exe com4 f0”） <br> 结束 <br> 如果（devicechanged [sensor3] =='On'），则 <br>  os.execute（“ c：\\ PROGRA〜1 \\ Domoticz \\脚本\\ noo.exe com4 n1”） <br> 结束 <br> 如果（devicechanged [sensor3] =='Off'），则 <br>  os.execute（“ c：\\ PROGRA〜1 \\ Domoticz \\脚本\\ noo.exe com4 f1”） <br> 结束 <br> 如果（devicechanged [sensor4] =='On'），则 <br>  os.execute（“ c：\\ PROGRA〜1 \\ Domoticz \\脚本\\ noo.exe com4 n2”） <br> 结束 <br> 如果（devicechanged [sensor4] =='Off'），则 <br>  os.execute（“ c：\\ PROGRA〜1 \\ Domoticz \\脚本\\ noo.exe com4 f2”） <br> 结束 <br> 如果（devicechanged [sensor5] =='Off'），则 <br>  os.execute（“ c：\\ PROGRA〜1 \\ Domoticz \\脚本\\ noo.exe com4 z9”） <br> 结束 <br> 返回commandArray <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Domoticz底层平面图</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/9b9/300/3b5/9b93003b5232474da997a3bf950765b1.PNG"><br></div></div><br> 短片 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN402799/">https://habr.com/ru/post/zh-CN402799/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN402785/index.html">在Nintendo Switch上保存游戏可能会随时丢失：无备份</a></li>
<li><a href="../zh-CN402791/index.html">Xfce中可能导致监视器故障的严重漏洞尚未修复</a></li>
<li><a href="../zh-CN402793/index.html">热声发动机-不带活塞的斯特林发动机</a></li>
<li><a href="../zh-CN402795/index.html">什么是抗生素</a></li>
<li><a href="../zh-CN402797/index.html">在挪威，鱼类寄生虫是通过带激光的水下机器人进行战斗的</a></li>
<li><a href="../zh-CN402803/index.html">“人工智能”一词已失去所有含义</a></li>
<li><a href="../zh-CN402805/index.html">俄罗斯制造：带有声音反馈的Oscor姿势校正器</a></li>
<li><a href="../zh-CN402807/index.html">在车库里的电子显微镜。 高电压</a></li>
<li><a href="../zh-CN402809/index.html">行人交通事故数量的增加可能归咎于智能手机</a></li>
<li><a href="../zh-CN402811/index.html">RuTracker被阻止，但下载的种子数量未更改</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>