<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐ฉ๐พโ๐คโ๐จ๐ผ ๐จ๐ฝโ๐ค WebSockets ุงูุฒุงูู. ุงูุฌุฒุก 2. ุญููู ุงูููุชุฌ ๐๐พ ๐ ๐จ๐ฝโ๐ง</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูู ููุงู ุณุงุจู ุ ุชุญุฏุซูุง ุนู ุญู ุนุงู ูููุงุจุณ ุงูููุจ ูู Angular ุ ุญูุซ ูููุง ุจุจูุงุก ุญุงููุฉ ูุน ุฅุนุงุฏุฉ ุงูุงุชุตุงู ูุงูุฎุฏูุฉ ููุงุณุชุฎุฏุงู ูู ุงูููููุงุช ุงููุงุฆูุฉ ุนูู WebSocketSub...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>WebSockets ุงูุฒุงูู. ุงูุฌุฒุก 2. ุญููู ุงูููุชุฌ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419099/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/hf/xh/dl/hfxhdlv7katnrbytwzqmhjy3xom.png" alt="ุงูุตูุฑุฉ"><br><br>  ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุงู ุณุงุจู ุ</a> ุชุญุฏุซูุง ุนู ุญู ุนุงู ูููุงุจุณ ุงูููุจ ูู Angular ุ ุญูุซ ูููุง ุจุจูุงุก ุญุงููุฉ ูุน ุฅุนุงุฏุฉ ุงูุงุชุตุงู ูุงูุฎุฏูุฉ ููุงุณุชุฎุฏุงู ูู ุงูููููุงุช ุงููุงุฆูุฉ ุนูู WebSocketSubject.  ูุฐุง ุงูุชูููุฐ ููุงุณุจ ููุนุธู ุงูุญุงูุงุช ุงูุจุณูุทุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุชููู ูุฅุฑุณุงู ุฑุณุงุฆู ุงูุฏุฑุฏุดุฉ ุ ููุง ุฅูู ุฐูู ุ ูููู ูุฏ ูุง ุชููู ูุฏุฑุงุชู ูุงููุฉ ุญูุซ ุชุญุชุงุฌ ุฅูู ุจูุงุก ุดูุก ุฃูุซุฑ ูุฑููุฉ ูุชุญูููุง.  ูู ูุฐู ุงูููุงูุฉ ุ ุณุฃูุดู ุนู ุจุนุถ ุงูููุฒุงุช ุนูุฏ ุงูุนูู ูุน ูุขุฎุฐ ุงูููุจ ูุฃุชุญุฏุซ ุนู ุงููุชุทูุจุงุช ุงูุชู ูุงุฌูุชูุง ุจููุณู ุ ูุฑุจูุง ุณุชูุงุฌููุง. <br><a name="habracut"></a><br>  ูู ูุซูุฑ ูู ุงูุฃุญูุงู ุ ูู ุงููุดุงุฑูุน ุงููุจูุฑุฉ ุฐุงุช ุงูุญุถูุฑ ุงููุฑุชูุน ุ ุชูุงุฌู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ููุงู ุชููู ุ ูู ุธุฑูู ุฃุฎุฑู ุ ุฃูุซุฑ ุดููุนูุง ููุดุงูุฏุชูุง ูู ุงูููุงูุฉ ุงูุฎูููุฉ.  ูู ุธุฑูู ุงูุชูุดู ูู ููุงุฑุฏ ุงูุฎุงุฏู ุ ูุชู ุชุฑุญูู ุฌุฒุก ูู ุงููุดุงูู ุฅูู ููุทูุฉ ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ุ ูููุฐุง ุงูุณุจุจ ูุชู ูุถุน ุฃูุตู ูุฏุฑ ูู ุงูุชูุณุนุฉ ูุงูุชุญูู ูู ุงููุดุฑูุน. <br><br>  ูููุง ููู ูุงุฆูุฉ ุจุงููุชุทูุจุงุช ุงูุฃุณุงุณูุฉ ูุนููู ูุฃุฎุฐ ุงูููุจ ุงูุชู ุณูุชู ุชูุงูููุง ูู ูุฐู ุงูููุงูุฉ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅุนุงุฏุฉ ุงูุงุชุตุงู "ุงูุฐูู" ุงูุชููุงุฆู ุ </li><li style=";text-align:right;direction:rtl">  ูุถุน ุงูุชุตุญูุญ </li><li style=";text-align:right;direction:rtl">  ูุธุงู ุงุดุชุฑุงู ุงูุฃุญุฏุงุซ ุนูู ุฃุณุงุณ RxJs ุ </li><li style=";text-align:right;direction:rtl">  ุงุณุชูุจุงู ูุชุญููู ุงูุจูุงูุงุช ุงูุซูุงุฆูุฉ ุ </li><li style=";text-align:right;direction:rtl">  ุฅุณูุงุท (ุฑุณู ุฎุฑุงุฆุท) ุงููุนูููุงุช ุงููุณุชููุฉ ุนูู ุงููููุฐุฌ ุ </li><li style=";text-align:right;direction:rtl">  ุงูุชุญูู ูู ุชุบููุฑุงุช ุงููููุฐุฌ ุนูุฏ ูุตูู ุงูุฃุญุฏุงุซ ุงูุฌุฏูุฏุฉ ุ </li><li style=";text-align:right;direction:rtl">  ุชุฌุงูู ุงูุฃุญุฏุงุซ ุงูุชุนุณููุฉ ูุฅูุบุงุก ุชุฌุงูู. </li></ul><br>  ุถุน ูู ุงุนุชุจุงุฑู ูู ุนูุตุฑ ุจูุฒูุฏ ูู ุงูุชูุตูู. <br><br><h2 style=";text-align:right;direction:rtl">  ุฅุนุงุฏุฉ ุงูุงุชุตุงู / Debag </h2><br>  ููุฏ ูุชุจุช ุนู ุฅุนุงุฏุฉ ุงูุงุชุตุงู ูู ููุงู ุณุงุจู ุ ูุฐูู ุณุฃูุชุจุณ ููุท ุฌุฒุกูุง ูู ุงููุต: <br><br><blockquote style=";text-align:right;direction:rtl">  ูุนุฏ ุฅุนุงุฏุฉ ุงูุงุชุตุงู ุ ุฃู ูุคุณุณุฉ ุฅุนุงุฏุฉ ุงูุงุชุตุงู ุจุงูุฎุงุฏู ุ ุนุงููุงู ุจุงูุบ ุงูุฃูููุฉ ุนูุฏ ุงูุนูู ูุน ูุขุฎุฐ ุงูููุจ ุ ูุซู  ูููู ุฃู ุชุชุณุจุจ ููุงุตู ุงูุดุจูุฉ ุฃู ุชุนุทู ุงูุฎุงุฏู ุฃู ุงูุฃุฎุทุงุก ุงูุฃุฎุฑู ุงูุชู ุชุชุณุจุจ ูู ูุทุน ุงูุงุชุตุงู ูู ุชุนุทู ุงูุชุทุจูู. <br>  ูู ุงูููู ุฃู ููุงุญุธ ุฃู ูุญุงููุงุช ุฅุนุงุฏุฉ ุงูุงุชุตุงู ูุง ูุฌุจ ุฃู ุชููู ูุชูุฑุฑุฉ ููุบุงูุฉ ููุง ูุฌุจ ุฃู ุชุณุชูุฑ ุฅูู ูุง ูุง ููุงูุฉ ุ ููุง ูู  ูููู ููุฐุง ุงูุณููู ุชุนููู ุงูุนููู. </blockquote><br>  ูุง ูุนุฑู ููุจุณ ุงูููุจ ููุณู ููููุฉ ุฅุนุงุฏุฉ ุงูุงุชุตุงู ุนูุฏ ูุทุน ุงูุงุชุตุงู.  ูุฐูู ุ ุฅุฐุง ุชู ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู ุฃู ุชุนุทู ุงูุฎุงุฏู ุ ุฃู ูุงู ุงููุณุชุฎุฏู ุจุฅุนุงุฏุฉ ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช ุ ุซู ููุชุงุจุนุฉ ุงูุนูู ุ ูุณุชุญุชุงุฌ ุฃูุถูุง ุฅูู ุฅุนุงุฏุฉ ุชูุตูู ููุจุณ ุงูููุจ. <br><br>  ูู ูุฐู ุงูููุงูุฉ ุ ูุฅุนุงุฏุฉ ุงูุงุชุตุงู ูุงูุชุตุญูุญ ุ ุณูุณุชุฎุฏู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Reconnecting WebSocket</a> ุ ุงูุฐู ูุญุชูู ุนูู ุงููุธุงุฆู ุงูุถุฑูุฑูุฉ ูุงูุฎูุงุฑุงุช ุงูุฃุฎุฑู ุ ูุซู ุชุบููุฑ ุนููุงู url ุงูุฎุงุต ุจููุจุณ ุงูููุจ ุจูู ุนูููุงุช ุฅุนุงุฏุฉ ุงูุงุชุตุงู ุ ูุงุฎุชูุงุฑ ูููุดุฆ WebSocket ุงูุชุนุณูู ุ ุฅูุฎ.  ุงูุจุฏุงุฆู ุงูุฃุฎุฑู ููุงุณุจุฉ ุฃูุถูุง.  ุฅุนุงุฏุฉ ุงูุงุชุตุงู ูู ุงูููุงูุฉ ุงูุณุงุจูุฉ ููุณุช ููุงุณุจุฉ ุ ูุฃู  ูู ููุชูุจ ุชุญุช WebSocketSubject ุ ูุงูุฐู ูุง ููุทุจู ูุฐู ุงููุฑุฉ. <br><br><h2 style=";text-align:right;direction:rtl">  ูุธุงู ุงุดุชุฑุงู ุงูุฃุญุฏุงุซ RxJs </h2><br>  ูุงุณุชุฎุฏุงู ูุขุฎุฐ ุงูููุจ ูู ุงูููููุงุช ุ ุชุญุชุงุฌ ุฅูู ุงูุงุดุชุฑุงู ูู ุงูุฃุญุฏุงุซ ูุฅูุบุงุก ุงูุงุดุชุฑุงู ูููุง ุนูุฏ ุงูุถุฑูุฑุฉ.  ููููุงู ุจุฐูู ุ ุงุณุชุฎุฏู ููุท ุชุตููู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Pub / Sub</a> ุงูุดููุฑ. <br><blockquote style=";text-align:right;direction:rtl">  "Publisher-subscriber (eng. ุ Publisher-subscriberber ุฃู eng. Pub / sub) - ูููุฐุฌ ุชุตููู ุณูููู ูููู ุงูุฑุณุงุฆู ูุง ูุฑุชุจุท ููู ูุฑุณูู ุงูุฑุณุงุฆู ุ ุงูุฐูู ูุทูู ุนูููู ุงููุงุดุฑูู (eng. ุงููุงุดุฑูู) ุ ูุจุงุดุฑุฉ ุจุฑูุฒ ุงูุจุฑูุงูุฌ ูุฅุฑุณุงู ุงูุฑุณุงุฆู ุฅูู ุงููุดุชุฑููู (eng. ุงููุดุชุฑููู )  ุจุฏูุงู ูู ุฐูู ุ ูุชู ุชูุณูู ุงูุฑุณุงุฆู ุฅูู ูุฆุงุช ููุง ุชุญุชูู ุนูู ูุนูููุงุช ุญูู ุงููุดุชุฑููู ูููุง ุ ุฅู ูุฌุฏุช.  ูุจุงููุซู ุ ูุชุนุงูู ุงููุดุชุฑููู ูุน ูุฆุฉ ูุงุญุฏุฉ ุฃู ุฃูุซุฑ ูู ุงูุฑุณุงุฆู ุ ูุณุชุฎูุตุฉ ูู ูุงุดุฑูู ูุญุฏุฏูู ". </blockquote><br>  ูุง ูุชุตู ุงููุดุชุฑู ุจุงููุงุดุฑ ูุจุงุดุฑุฉ ุ ูููู ุนุจุฑ ุงูุญุงููุฉ ุงููุณูุทุฉ - ุฎุฏูุฉ ุงููููุน.  ูุฌุจ ุฃู ูููู ูู ุงููููู ุฃูุถูุง ุงูุงุดุชุฑุงู ูู ุฃุญุฏุงุซ ูุชุนุฏุฏุฉ ุจููุณ ููุน ุงูุฅุฑุฌุงุน.  ููุดุฆ ูู ุงุดุชุฑุงู ููุถูุนู ุงูุฎุงุต ุ ูุงูุฐู ุชุชู ุฅุถุงูุชู ุฅูู ูุงุฆู ุงููุณุชูุนูู ุ ูุงูุฐู ูุณูุญ ูู ุจุชูุฌูู ุฃุญุฏุงุซ ูุฃุฎุฐ ุงูููุจ ุฅูู ุงูุงุดุชุฑุงูุงุช ุงูุถุฑูุฑูุฉ.  ุนูุฏ ุงูุนูู ูุน ููุถูุน RxJs ุ ููุงู ุจุนุถ ุงูุตุนูุจุงุช ูู ุฅูุบุงุก ุงูุงุดุชุฑุงู ุ ูุฐูู ุ ุณูููู ุจุฅูุดุงุก ุฌุงูุน ููุงูุฉ ุจุณูุท ูููู ุจุฅุฒุงูุฉ ุงููุงุฆูุงุช ุงููุฑุนูุฉ ูู ูุงุฆู ุงููุณุชูุนูู ุนูุฏูุง ูุง ูููู ูุฏููู ูุฑุงูุจูู. <br><br><h2 style=";text-align:right;direction:rtl">  ุงุณุชูุจุงู ูุชุญููู ุงูุจูุงูุงุช ุงูุซูุงุฆูุฉ </h2><br>  ูุฏุนู WebSocket ููู ุงูุจูุงูุงุช ุงูุซูุงุฆูุฉ ุฃู ุงููููุงุช ุฃู ุงูุชุฏููุงุช ุ ูุงูุชู ุบุงูุจูุง ูุง ุชุณุชุฎุฏู ูู ุงููุดุงุฑูุน ุงููุจูุฑุฉ.  ูุจุฏู ุดูุก ูุซู ูุฐุง: <br><blockquote style=";text-align:right;direction:rtl">  0x80 ุ &lt;ุทูู - ุจุงูุช ูุงุญุฏ ุฃู ุฃูุซุฑ&gt; ุ &lt;ูุต ุงูุฑุณุงูุฉ&gt; </blockquote><br>  ูู ุฃุฌู ุนุฏู ุฅูุดุงุก ูููุฏ ุนูู ุทูู ุงูุฑุณุงูุฉ ุงููุฑุณูุฉ ููู ููุณ ุงูููุช ุนุฏู ุฅููุงู ูุญุฏุงุช ุงูุจุงูุช ุจุดูู ุบูุฑ ุนููุงูู ุ ุงุณุชุฎุฏู ูุทูุฑู ุงูุจุฑูุชูููู ุงูุฎูุงุฑุฒููุฉ ุงูุชุงููุฉ.  ูุชู ุงููุธุฑ ุฅูู ูู ุจุงูุช ูู ูุคุดุฑ ุงูุทูู ุจุดูู ูููุตู: ูุดูุฑ ุงูุฃุนูู ุฅูู ูุง ุฅุฐุง ูุงู ุงูุจุงูุช ุงูุฃุฎูุฑ (0) ุฃู ุงูุขุฎุฑ (1) ูุชุจุนู ุ ูุชุญุชูู ุงูุจุชุงุช ุงูุณูููุฉ ุงูุณุจุน ุนูู ุงูุจูุงูุงุช ุงููุฑุณูุฉ.  ูุฐูู ุ ุนูุฏูุง ุชุธูุฑ ุนูุงูุฉ ุฅุทุงุฑ ุงูุจูุงูุงุช ุงูุซูุงุฆูุฉ 0x80 ุ ูุชู ุฃุฎุฐ ุงูุจุงูุช ุงูุชุงูู ูุชุฎุฒููู ูู "ุจูู ุฃุตุจุน" ูููุตู.  ุซู ูุชู ุชุญููู ุงูุจุงูุช ุงูุชุงูู ุ ุฅุฐุง ูุงู ูุญุชูู ุนูู ูุฌููุนุฉ ุงูุจุช ุงูุฃูุซุฑ ุฃูููุฉ ุ ุฅูู "ุงูุจูู ุงูุฎูุฒูุฑ" ูููุฐุง ุญุชู ูุชู ุงูุชุดุงู ุงูุจุงูุช ุงูุฐู ูุญุชูู ุนูู ุตูุฑ ูู ุงูุจุช ุงูุฃูุซุฑ ุฃูููุฉ.  ูุฐู ุงูุจุงูุช ูู ุงูุฃุฎูุฑุฉ ูู ูุคุดุฑ ุงูุทูู ูุชุชู ุฅุถุงูุชูุง ุฃูุถูุง ุฅูู "ุจูู ุฃุตุจุน".  ุงูุขู ุ ุชุชู ุฅุฒุงูุฉ ุงูุจุชุงุช ุงูุนุงููุฉ ูู ุงูุจุงูุชุงุช ูู ุงูุฎูุฒูุฑ ุ ููุชู ุฏูุฌ ุงูุจุงูู.  ุณูููู ูุฐุง ูู ุทูู ูุต ุงูุฑุณุงูุฉ - ุฃุฑูุงู 7 ุจุช ุจุฏูู ุงูุจุช ุงูุฃูุซุฑ ุฃูููุฉ. <br><br>  ุขููุฉ ุชุญููู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ูุงูุชุฏูู ุงูุซูุงุฆู ูุนูุฏุฉ ูุชุฑุชุจุท ุจุชุฎุทูุท ุงูุจูุงูุงุช ูู ุงููููุฐุฌ.  ูููู ุชุฎุตูุต ููุงู ูููุตู ููุฐุง ุงูุบุฑุถ.  ูุฐู ุงููุฑุฉ ุณูููู ุจุชุญููู ุฎูุงุฑ ุจุณูุท ุ ููุชุฑู ุงูุญุงูุงุช ุงูุตุนุจุฉ ููููุดูุฑุงุช ุงูุชุงููุฉ ุ ุฅุฐุง ูุงู ููุงู ุงูุชูุงู ุจุงูููุถูุน. <br><br><h2 style=";text-align:right;direction:rtl">  ุฅุณูุงุท (ุฑุณู ุฎุฑุงุฆุท) ุงููุนูููุงุช ุงููุณุชููุฉ ุนูู ุงููููุฐุฌ </h2><br>  ุจุบุถ ุงููุธุฑ ุนู ููุน ุงูุฅุฑุณุงู ุงููุณุชูู ุ ูุฌุจ ุนููู ูุฑุงุกุชู ูุชุนุฏููู ุจุฃูุงู.  ูุง ููุฌุฏ ุชูุงูู ูู ุงูุขุฑุงุก ุญูู ููููุฉ ุงูููุงู ุจุฐูู ุจุดูู ุฃูุถู ุ ูุฃูุง ุฃูุชุฒู ุจูุธุฑูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููุฐุฌ ุงูุจูุงูุงุช</a> ุ ูุฃููู ุฃุนุชุจุฑูุง ููุทููุฉ ูููุซููุฉ ููุจุฑูุฌุฉ ุจุฃุณููุจ OOP. <br><blockquote style=";text-align:right;direction:rtl">  "ุฅู ูููุฐุฌ ุงูุจูุงูุงุช ุนุจุงุฑุฉ ุนู ุชุนุฑูู ููุทูู ูููุชูู ุฐุงุชููุง ููุฃุดูุงุก ูุงูุนูุงูู ูุงูุนูุงุตุฑ ุงูุฃุฎุฑู ุงูุชู ุชุดูู ูุนูุง ุขูุฉ ูุตูู ุฅูู ุงูุจูุงูุงุช ุงููุฌุฑุฏุฉ ุงูุชู ูุชูุงุนู ูุนูุง ุงููุณุชุฎุฏู.  "ุชุณูุญ ูู ูุฐู ุงููุงุฆูุงุช ุจููุฐุฌุฉ ุจููุฉ ุงูุจูุงูุงุช ูุงูุนูุงูู - ุณููู ุงูุจูุงูุงุช." </blockquote><br>  ุฌููุน ุฃููุงุน ุงูุฅุทุงุฑุงุช ุงูุดุงุฆุนุฉ ุงูุชู ูุง ุชุนุทู ููุฑุฉ ุนู ูุงุฆู ูุทุจูุฉ ูุชู ูููุง ุชุนุฑูู ุงูุณููู ุ ูุงูุจููุฉ ุ ููุง ุฅูู ุฐูู ุ ุชุฎูู ุงุฑุชุจุงููุง ุ ูุชููู ุฃูู ุชุญูููุง ุจุดูู ุฌูุฏ ูุฃุญูุงููุง ูุชุถุฎูุฉ ูุน ุดูุก ุบูุฑ ูููุฐุฌู ุจุงููุณุจุฉ ููุง.  ุนูู ุณุจูู ุงููุซุงู ุ ูุฌุจ ุฃู ูุตู ูุตู ุงูููุจ ููุจูุง ุชุญุช ุฃู ุธุฑู ูู ุงูุธุฑูู.  ุฅุฐุง ุชู ุงููุธุฑ ุฅูู ุงูููุจ ุนูู ุฃูู ูุฌููุนุฉ ูู ุงูุญููู: ุงูุฐูู ูุงูููู ูุงููุฌู ููุง ุฅูู ุฐูู ุ ููุฏ ูููู ุงูููุจ ูุฎูุจูุง ุฅุถุงูููุง ุ ูุณูุธูุฑ ููุจ ุขุฎุฑ ุจุฏูุงู ูู ุงูุฑุฃุณ. <br><br><img src="https://habrastorage.org/webt/sq/fa/xu/sqfaxulbeyaffws-46gxho3-dcg.jpeg" alt="ุงูุตูุฑุฉ"><br><br><h2 style=";text-align:right;direction:rtl">  ุงูุชุญูู ูู ุชุบููุฑุงุช ุงููููุฐุฌ ุนูุฏ ูุตูู ุงูุฃุญุฏุงุซ ุงูุฌุฏูุฏุฉ </h2><br>  ูู ูุฐู ุงูููุฑุฉ ุณูู ุฃุตู ุงููุดููุฉ ุงูุชู ูุงุฌูุชูุง ุฃุซูุงุก ุงูุนูู ุนูู ูุงุฌูุฉ ุงูููุจ ุงูุฎุงุตุฉ ุจุชุทุจูู ุงูุฌูุงู ุงูุฑูุงู ุงูุฑูุงุถู.  ุนููุช ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ููุชุทุจูู ูู ุฎูุงู ูุขุฎุฐ ุงูููุจ ุงูุชู ุชูููุง ูู ุฎูุงููุง: ุชุญุฏูุซ ุงูุงุญุชูุงูุงุช ุ ูุฅุถุงูุฉ ูุฅุฒุงูุฉ ุฃููุงุน ุฌุฏูุฏุฉ ูู ุงูุฑูุงูุงุช ุ ูุฅุฎุทุงุฑุงุช ุญูู ุจุฏุงูุฉ ุฃู ููุงูุฉ ุงููุจุงุฑุงุฉ ุ ููุง ุฅูู ุฐูู.  - ุฅุฌูุงูู ุญูุงูู ุซูุงุซูุงุฆุฉ ุญุฏุซ ูููุจุณ ุงูููุจ.  ุฃุซูุงุก ุงููุจุงุฑุงุฉ ุ ูุชู ุชุญุฏูุซ ุงูุฑูุงูุงุช ูุงููุนูููุงุช ุจุงุณุชูุฑุงุฑ ุ ุฃุญูุงููุง 2-3 ูุฑุงุช ูู ุงูุซุงููุฉ ุ ูุฐูู ูุงูุช ุงููุดููุฉ ูู ุฃูู ุจุนุฏูุง ุชู ุชุญุฏูุซ ุงููุงุฌูุฉ ุจุฏูู ุชุญูู ูุณูุท. <br><br>  ุนูุฏูุง ูุงู ุงููุณุชุฎุฏู ุจูุฑุงูุจุฉ ุงูุนุทุงุก ูู ุฌูุงุฒ ูุญููู ุ ููู ููุณ ุงูููุช ุชู ุชุญุฏูุซ ุงูููุงุฆู ุนูู ุดุงุดุฉ ุงูุนุฑุถ ุงูุฎุงุตุฉ ุจู ุ ุงุฎุชูู ุงูุนุทุงุก ูู ูุฌุงู ุงูุฑุคูุฉ ุ ูุฐูู ูุงู ุนูู ุงููุณุชุฎุฏู ุงูุจุญุซ ุนู ุงูุนุทุงุก ุงููุชุชุจุน ูุฑุฉ ุฃุฎุฑู.  ุชู ุชูุฑุงุฑ ูุฐุง ุงูุณููู ููู ุชุญุฏูุซ. <br><br><img src="https://habrastorage.org/webt/tq/5p/e8/tq5pe8qxiepdjj7dx5-jry10bjs.gif" alt="ุงูุตูุฑุฉ"><br><br>  ูุชุทูุจ ุงูุญู ุนุฏู ุซุจุงุช ุงููุงุฆูุงุช ุงูุชู ุชู ุนุฑุถูุง ุนูู ุงูุดุงุดุฉ ุ ูููู ูู ููุณ ุงูููุช ูุฌุจ ุฃู ุชุชุบูุฑ ูุนุงููุงุช ุงูุฑูุงู ุ ูุฃู ุชุตุจุญ ุงูุนุทุงุกุงุช ุบูุฑ ุฐุงุช ุงูุตูุฉ ุบูุฑ ูุดุทุฉ ุ ููุง ุชุชู ุฅุถุงูุฉ ุฃุฎุฑู ุฌุฏูุฏุฉ ุญุชู ูููู ุงููุณุชุฎุฏู ุจุชูุฑูุฑ ุงูุดุงุดุฉ.  ูู ูุชู ุชุฎุฒูู ุงูุฎูุงุฑุงุช ุงููุฏููุฉ ุนูู ุงููุงุฌูุฉ ุงูุฎูููุฉ ุ ูุฐูู ูุงู ูุง ุจุฏ ูู ุชุฐูุฑ ูุฐู ุงูุฎุทูุท ูุชูููุฒูุง ุจุนูุงูุฉ "ูุญุฐููุฉ" ุ ูุงูุชู ุชู ุฅูุดุงุก ูุฎุฒู ุจูุงูุงุช ูุณูุท ููุง ุจูู ููุจุณ ุงูููุจ ูุงูุงุดุชุฑุงู ุ ููุง ูุถูู ุงูุชุญูู ูู ุงูุชุบููุฑุงุช. <br><br>  ูู ุงูุฎุฏูุฉ ุงูุฌุฏูุฏุฉ ุ <a href="">ุณููุดุฆ</a> ุฃูุถูุง ุทุจูุฉ ุจุฏููุฉ ููุฐู ุงููุฑุฉ ุณูู ูุณุชุฎุฏู <a href="">Dexie.js</a> - ููู ูุฌูุนุฉ ููู IndexedDB API ุ ูููู ุฃู ูุงุนุฏุฉ ุจูุงูุงุช ุงูุชุฑุงุถูุฉ ุฃู ูุชุตูุญ ุฃุฎุฑู ุณุชูุนู.  Redux ููุจูู. <br><br><h2 style=";text-align:right;direction:rtl">  ุชุฌุงูู ุงูุฃุญุฏุงุซ ุงูุชุนุณููุฉ ูุฅูุบุงุก ุชุฌุงูู </h2><br>  ูู ููุณ ุงูุดุฑูุฉ ุบุงูุจูุง ูุง ูููู ููุงู ุงูุนุฏูุฏ ูู ุงููุดุงุฑูุน ูู ููุณ ุงูููุน ูู ููุช ูุงุญุฏ: ุฅุตุฏุงุฑุงุช ุงูุฌูุงู ูุงูููุจ ุ ุฅุตุฏุงุฑุงุช ุฐุงุช ุฅุนุฏุงุฏุงุช ูุฎุชููุฉ ููุฌููุนุงุช ุงููุณุชุฎุฏููู ุงููุฎุชููุฉ ุ ุฅุตุฏุงุฑุงุช ูุชูุฏูุฉ ููุจุชูุฑุฉ ูู ููุณ ุงูุชุทุจูู. <br><br>  ุบุงูุจูุง ูุง ูุณุชุฎุฏููู ุฌููุนูุง ูุงุนุฏุฉ ุฑูุฒ ูุงุญุฏุฉ ุ ูุฐูู ุชุญุชุงุฌ ูู ุจุนุถ ุงูุฃุญูุงู ุฅูู ุฅููุงู ุชุดุบูู ุงูุฃุญุฏุงุซ ุบูุฑ ุงูุถุฑูุฑูุฉ ูู ููุช ุงูุชุดุบูู ุฃู ุฃุซูุงุก DI ุฏูู ุญุฐู ุงูุงุดุชุฑุงู ูุชุดุบููู ูุฑุฉ ุฃุฎุฑู ุ ุฃู  ุชุฌุงูู ุจุนุถูุง ุ ุญุชู ูุง ูุชู ูุนุงูุฌุฉ ุงูุฃุญุฏุงุซ ุบูุฑ ุงูุถุฑูุฑูุฉ.  ูุฐู ููุฒุฉ ุจุณูุทุฉ ูููููุง ูููุฏุฉ ุชุถูู ูุฑููุฉ ุฅูู ูุงูู Pub / Sub. <br><br>  ููุจุฏุฃ ุจูุตู ุงููุงุฌูุงุช: <br><br><pre style=";text-align:right;direction:rtl"><code class="hljs cmake"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface IWebsocketService { //    addEventListener&lt;T&gt;(topics: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[], id?: number): Observable&lt;T&gt;; runtimeIgnore(topics: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[]): void; runtimeRemoveIgnore(topics: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[]): void; sendMessage(event: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, data: any): void; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface WebSocketConfig { //   DI url: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; ignore?: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[]; garbageCollectInterval?: number; options?: Options; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface ITopic&lt;T&gt; { //   Pub/Sub [hash: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]: MessageSubject&lt;T&gt;; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface IListeners { //    [topic: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]: ITopic&lt;any&gt;; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface IBuffer { //    ws.<span class="hljs-keyword"><span class="hljs-keyword">message</span></span> type: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; data: number[]; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface IWsMessage { // ws.<span class="hljs-keyword"><span class="hljs-keyword">message</span></span> event: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; buffer: IBuffer; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface IMessage { //   id: number; text: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> type ITopicDataType = IMessage[] | number | <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[]; //  callMessage  </code> </pre> <br>  ุณูู ูุฑุซ ุงูููุถูุน ูุฅูุดุงุก ุฌุงูุน ุงูููุงูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MessageSubject</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Subject</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>( private listeners: IListeners, //    private topic: string, //   private id: string // id  ) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); } <span class="hljs-comment"><span class="hljs-comment">/* *   next, *       , *   garbageCollect */</span></span> public next(value?: T): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.closed) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ObjectUnsubscribedError(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.isStopped) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {observers} = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> len = observers.length; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> copy = observers.slice(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; len; i++) { copy[i].next(value); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!len) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.garbageCollect(); <span class="hljs-comment"><span class="hljs-comment">//   } } } /* * garbage collector * */ private garbageCollect(): void { delete this.listeners[this.topic][this.id]; //  Subject if (!Object.keys(this.listeners[this.topic]).length) { //    delete this.listeners[this.topic]; } } }</span></span></code> </pre> <br>  ุนูู ุนูุณ ุงูุชูููุฐ ุงูุณุงุจู ุ ุณูููู websocket.events.ts ุฌุฒุกูุง ูู ูุญุฏุฉ ููุจุณ ุงูููุจ <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> WS_API = { <span class="hljs-attr"><span class="hljs-attr">EVENTS</span></span>: { <span class="hljs-attr"><span class="hljs-attr">MESSAGES</span></span>: <span class="hljs-string"><span class="hljs-string">'messages'</span></span>, <span class="hljs-attr"><span class="hljs-attr">COUNTER</span></span>: <span class="hljs-string"><span class="hljs-string">'counter'</span></span>, <span class="hljs-attr"><span class="hljs-attr">UPDATE_TEXTS</span></span>: <span class="hljs-string"><span class="hljs-string">'update-texts'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">COMMANDS</span></span>: { <span class="hljs-attr"><span class="hljs-attr">SEND_TEXT</span></span>: <span class="hljs-string"><span class="hljs-string">'set-text'</span></span>, <span class="hljs-attr"><span class="hljs-attr">REMOVE_TEXT</span></span>: <span class="hljs-string"><span class="hljs-string">'remove-text'</span></span> } };</code> </pre> <br>  ููุชููุฆุฉ ุนูุฏ ุชูุตูู ุงููุญุฏุฉ ุ ูู ุจุฅูุดุงุก websocket.config: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { InjectionToken } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular/core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config: InjectionToken&lt;string&gt; = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InjectionToken(<span class="hljs-string"><span class="hljs-string">'websocket'</span></span>);</code> </pre> <br>  ุฅูุดุงุก ูููุฐุฌ ูููููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Dexie <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'dexie'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { IMessage, IWsMessage } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./websocket.interfaces'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { WS_API } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./websocket.events'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> MessagesDatabase extends Dexie { //    Dexie  typescript <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> messages!: Dexie.<span class="hljs-keyword"><span class="hljs-keyword">Table</span></span>&lt;IMessage, number&gt;; // id <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> number <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> this <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> constructor() { super(<span class="hljs-string"><span class="hljs-string">'MessagesDatabase'</span></span>); //   this.version(<span class="hljs-number"><span class="hljs-number">1</span></span>).stores({ //   messages: <span class="hljs-string"><span class="hljs-string">'++id,text'</span></span> }); } }</code> </pre> <br>  ูุญูู ูููุฐุฌ ุจุณูุท ุ ูู ุงูุธุฑูู ุงูุญููููุฉ ูู ุงูุฃูุถู ุชูุณููู ุฅูู ุนุฏุฉ ูููุงุช: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">export</span></span> const modelParser = (message: <span class="hljs-type"><span class="hljs-type">IWsMessage</span></span>) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (message &amp;&amp; message.buffer) { /*  */ const encodeUint8Array = <span class="hljs-type"><span class="hljs-type">String</span></span>.fromCharCode .apply(<span class="hljs-type"><span class="hljs-type">String</span></span>, new <span class="hljs-type"><span class="hljs-type">Uint8Array</span></span>(message.buffer.<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">)); const parseData = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">JSON</span></span></span><span class="hljs-class">.parse(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">encodeUint8Array</span></span></span><span class="hljs-class">); let </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MessagesDB</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MessagesDatabase</span></span></span><span class="hljs-class">; // </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IndexedDB</span></span></span><span class="hljs-class"> if (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">message</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">event</span></span></span><span class="hljs-class"> === </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WS_API</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EVENTS</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MESSAGES</span></span></span><span class="hljs-class">) { // </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IMessage</span></span></span><span class="hljs-class">[] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> (!</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MessagesDB</span></span></span><span class="hljs-class">) { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MessagesDB</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MessagesDatabase</span></span></span><span class="hljs-class">(); } parseData.forEach((</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">messageData</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IMessage</span></span></span><span class="hljs-class">) =&gt; { /*   */ </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MessagesDB</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">transaction</span></span></span><span class="hljs-class">('</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rw'</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MessagesDB</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">messages</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">async</span></span></span><span class="hljs-class"> () =&gt; { /* ,    */ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> ((</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">await</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MessagesDB</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">messages</span></span></span><span class="hljs-class"> .</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">where</span></span></span><span class="hljs-class">({</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">messageData</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">}).count()) === 0) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">await</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MessagesDB</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">messages</span></span></span><span class="hljs-class"> .</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">add</span></span></span><span class="hljs-class">({</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">messageData</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">text</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">messageData</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">text</span></span></span><span class="hljs-class">}); console.log(`</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Addded</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">message</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class"> ${</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">}`); } }).catch(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">e</span></span></span><span class="hljs-class"> =&gt; { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">console</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">error</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">e</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">stack</span></span></span><span class="hljs-class"> || </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">e</span></span></span><span class="hljs-class">); }); }); return </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MessagesDB</span></span></span><span class="hljs-class">.messages.toArray(); //   </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IMessage</span></span></span><span class="hljs-class">[] } if (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">message</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">event</span></span></span><span class="hljs-class"> === </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WS_API</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EVENTS</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">COUNTER</span></span></span><span class="hljs-class">) { // </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">counter</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Promise</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">r</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">r</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">parseData</span></span></span><span class="hljs-class">)); //    } if (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">message</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">event</span></span></span><span class="hljs-class"> === </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WS_API</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EVENTS</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UPDATE_TEXTS</span></span></span><span class="hljs-class">) { // </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">text</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">texts</span></span></span><span class="hljs-class"> = []; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">parseData</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">forEach</span></span></span><span class="hljs-class">((</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">textData</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">) =&gt; { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">texts</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">push</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">textData</span></span></span><span class="hljs-class">); }); return new </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Promise</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">r</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">r</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">texts</span></span></span><span class="hljs-class">)); //     } } else { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">console</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">log</span></span></span><span class="hljs-class">(`[${</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Date</span></span></span><span class="hljs-class">()}] </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Buffer</span></span></span><span class="hljs-class"> is "undefined"`); } };</span></span></code> </pre> <br>  ุงููุญุฏุฉ ุงูููุทูุฉ Websocket: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs powershell">@NgModule({ imports: [ <span class="hljs-type"><span class="hljs-type">CommonModule</span></span> ] }) export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebsocketModule</span></span></span></span> { public <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> config(wsConfig: WebSocketConfig): ModuleWithProviders { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ngModule: WebsocketModule, providers: [{<span class="hljs-type"><span class="hljs-type">provide</span></span>: <span class="hljs-type"><span class="hljs-type">config</span></span>, <span class="hljs-type"><span class="hljs-type">useValue</span></span>: <span class="hljs-type"><span class="hljs-type">wsConfig</span></span>}] }; } }</code> </pre> <br>  ููุจุฏุฃ ูู ุฅูุดุงุก ุฎุฏูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs ruby">private <span class="hljs-symbol"><span class="hljs-symbol">listeners:</span></span> IListeners; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   private <span class="hljs-symbol"><span class="hljs-symbol">uniqueId:</span></span> number; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   id  private <span class="hljs-symbol"><span class="hljs-symbol">websocket:</span></span> ReconnectingWebSocket; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   constructor(@Inject(config) private <span class="hljs-symbol"><span class="hljs-symbol">wsConfig:</span></span> WebSocketConfig) { this.uniqueId = -<span class="hljs-number"><span class="hljs-number">1</span></span>; this.listeners = {}; this.wsConfig.ignore = wsConfig.ignore ? wsConfig.ignore : []; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  this.connect(); } ngOnDestroy() { this.websocket.close(); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     }</code> </pre> <br>  ุทุฑููุฉ ุงูุงุชุตุงู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs coffeescript">private connect(): void { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ReconnectingWebSocket config const options = { connectionTimeout: <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  ,    maxRetries: <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  ,    ...<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.wsConfig.options }; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.websocket = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ReconnectingWebSocket(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.wsConfig.url, [], options); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.websocket.addEventListener(<span class="hljs-string"><span class="hljs-string">'open'</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event: Event)</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(`<span class="javascript"><span class="javascript">[${</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">Date</span></span></span><span class="javascript">()}] WebSocket connected!</span></span>`); }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.websocket.addEventListener(<span class="hljs-string"><span class="hljs-string">'close'</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event: CloseEvent)</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(`<span class="javascript"><span class="javascript">[${</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">Date</span></span></span><span class="javascript">()}] WebSocket close!</span></span>`); }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.websocket.addEventListener(<span class="hljs-string"><span class="hljs-string">'error'</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event: ErrorEvent)</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(`<span class="javascript"><span class="javascript">[${</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">Date</span></span></span><span class="javascript">()}] WebSocket error!</span></span>`); }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.websocket.addEventListener(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event: MessageEvent)</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.onMessage(event); }); setInterval(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.garbageCollect(); }, (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.wsConfig.garbageCollectInterval || <span class="hljs-number"><span class="hljs-number">10000</span></span>)); }</code> </pre> <br>  ูู ุจุชูุฑุงุฑ ุฌุงูุน ุงูููุงูุฉ ุ ูุณูู ูุชุญูู ูู ุงูุงุดุชุฑุงูุงุช ุญุณุจ ุงููููุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">garbageCollect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>): </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners.hasOwnProperty(<span class="hljs-keyword"><span class="hljs-keyword">event</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> topic = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners[<span class="hljs-keyword"><span class="hljs-keyword">event</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> topic) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (topic.hasOwnProperty(key)) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> subject = topic[key]; <span class="hljs-comment"><span class="hljs-comment">//  Subject    if (!subject.observers.length) { delete topic[key]; } } }  ,   if (!Object.keys(topic).length) { delete this.listeners[event]; } } } }</span></span></code> </pre> <br>  ูุญู ูุจุญุซ ูู ุฃู ุงุดุชุฑุงู ูุฅุฑุณุงู ุงูุญุฏุซ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> onMessage(event: MessageEvent): void { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> message = JSON.parse(event.<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> name <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners.hasOwnProperty(name) &amp;&amp; !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.wsConfig.ignore.includes(name)) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> topic = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners[name]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> keys = name.split(<span class="hljs-string"><span class="hljs-string">'/'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//      const isMessage = keys.includes(message.event); const model = modelParser(message); //     if (isMessage &amp;&amp; typeof model !== 'undefined') { model.then((data: ITopicDataType) =&gt; { //   Subject this.callMessage&lt;ITopicDataType&gt;(topic, data); }); } } } }</span></span></code> </pre> <br>  ุญุฏุซ ุฎูุฐุฉ ูู ุงูููุถูุน: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs powershell">private callMessage&lt;T&gt;(topic: ITopic&lt;T&gt;, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>: T): void { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (const key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> topic) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (topic.hasOwnProperty(key)) { const subject = topic[<span class="hljs-type"><span class="hljs-type">key</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (subject) { //   subject.next(<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { console.log(`[<span class="hljs-variable"><span class="hljs-variable">$</span></span>{Date()}] Topic Subject is <span class="hljs-string"><span class="hljs-string">"undefined"</span></span>`); } } } }</code> </pre> <br>  ุฅูุดุงุก ููุถูุน Pub / Sub: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs markdown">private addTopic<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">T</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>(topic: string, id?: number): MessageSubject<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">T</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> { const token = (++this.uniqueId).toString(); const key = id ? token + id : token; //  id   const hash = sha256.hex(key); // SHA256-   id  if (!this.listeners[<span class="hljs-string"><span class="hljs-string">topic</span></span>]) { this.listeners[<span class="hljs-string"><span class="hljs-string">topic</span></span>] = <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">any</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>{}; } return this.listeners[<span class="hljs-string"><span class="hljs-string">topic</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">hash</span></span>] = new MessageSubject<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">T</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>(this.listeners, topic, hash); }</code> </pre> <br>  ุงูุงุดุชุฑุงู ูู ุญุฏุซ ุฃู ุฃูุซุฑ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> addEventListener&lt;T&gt;(topics: string | string[], id?: number): Observable&lt;T&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (topics) { //       const topicsKey = typeof topics === <span class="hljs-string"><span class="hljs-string">'string'</span></span> ? topics : topics.<span class="hljs-keyword"><span class="hljs-keyword">join</span></span>(<span class="hljs-string"><span class="hljs-string">'/'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> this.addTopic&lt;T&gt;(topicsKey, id).asObservable(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { console.log(`[${<span class="hljs-type"><span class="hljs-type">Date</span></span>()}] Can<span class="hljs-string"><span class="hljs-string">'t add EventListener. Type of event is "undefined".`); } }</span></span></code> </pre> <br>  ูู ุดูุก ููุง ูุจุณุท ุนู ูุตุฏ ุ ูููู ูููู ุชุญูููู ุฅูู ููุงูุงุช ุซูุงุฆูุฉ ุ ููุง ูู ุงูุญุงู ูุน ุงูุฎุงุฏู.  ุฅุฑุณุงู ุงูุฃูุงูุฑ ุฅูู ุงูุฎุงุฏู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> sendMessage(event: string, data: <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> = {}): <span class="hljs-type"><span class="hljs-type">void</span></span> { //   ,      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event &amp;&amp; this.websocket.readyState === <span class="hljs-number"><span class="hljs-number">1</span></span>) { this.websocket.send(<span class="hljs-type"><span class="hljs-type">JSON</span></span>.stringify({event, data})); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { console.log(<span class="hljs-string"><span class="hljs-string">'Send error!'</span></span>); } }</code> </pre> <br>  ุฃุถู ุงูุฃุญุฏุงุซ ุฅูู ูุงุฆูุฉ ุงูุชุฌุงูู ูู ููุช ุงูุชุดุบูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runtimeIgnore</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">topics: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">): </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (topics &amp;&amp; topics.length) { <span class="hljs-comment"><span class="hljs-comment">//    this.wsConfig.ignore.push(...topics); } }</span></span></code> </pre> <br>  ุญุฐู ุงูุฃุญุฏุงุซ ูู ูุงุฆูุฉ ุงูุฌุงูููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runtimeRemoveIgnore</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">topics: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">): </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (topics &amp;&amp; topics.length) { topics.forEach((topic: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>) =&gt; { <span class="hljs-comment"><span class="hljs-comment">//      const topicIndex = this.wsConfig.ignore.findIndex(t =&gt; t === topic); if (topicIndex &gt; -1) { //    this.wsConfig.ignore.splice(topicIndex, 1); } }); } }</span></span></code> </pre> <br>  ูููู ุจุชูุตูู ูุญุฏุฉ ููุงุจุณ ุงูููุจ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs powershell">@NgModule({ declarations: [ <span class="hljs-type"><span class="hljs-type">AppComponent</span></span> ], imports: [ <span class="hljs-type"><span class="hljs-type">BrowserModule</span></span>, <span class="hljs-type"><span class="hljs-type">ReactiveFormsModule</span></span>, <span class="hljs-type"><span class="hljs-type">WebsocketModule.config</span></span>({ <span class="hljs-type"><span class="hljs-type">url</span></span>: <span class="hljs-type"><span class="hljs-type">environment.ws</span></span>, //  <span class="hljs-string"><span class="hljs-string">"ws://mywebsocketurl"</span></span> //    <span class="hljs-type"><span class="hljs-type">ignore</span></span>: [<span class="hljs-type"><span class="hljs-type">WS_API.EVENTS.ANY_1</span></span>, <span class="hljs-type"><span class="hljs-type">WS_API.EVENTS.ANY_2</span></span>], <span class="hljs-type"><span class="hljs-type">garbageCollectInterval</span></span>: <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>, //    <span class="hljs-type"><span class="hljs-type">options</span></span>: { <span class="hljs-type"><span class="hljs-type">connectionTimeout</span></span>: <span class="hljs-number"><span class="hljs-number">1000</span></span>, //   <span class="hljs-type"><span class="hljs-type">maxRetries</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> //   } }) ], providers: [], bootstrap: [<span class="hljs-type"><span class="hljs-type">AppComponent</span></span>] }) export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppModule</span></span></span></span> { }</code> </pre> <br>  ูุณุชุฎุฏู ูู ุงูููููุงุช: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs kotlin"><span class="hljs-meta"><span class="hljs-meta">@Component({ selector: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'app-root'</span></span></span><span class="hljs-meta">, templateUrl: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'./app.component.html'</span></span></span><span class="hljs-meta">, styleUrls: [</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'./app.component.css'</span></span></span><span class="hljs-meta">] })</span></span> export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnInit</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OnDestroy { private messages$: Observable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IMessage[]</span></span></span><span class="hljs-class">&gt;; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">messagesMulti</span></span></span><span class="hljs-class">$: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Observable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IMessage[]</span></span></span><span class="hljs-class">&gt;; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">counter</span></span></span><span class="hljs-class">$: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Observable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">number</span></span></span><span class="hljs-class">&gt;; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">texts</span></span></span><span class="hljs-class">$: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Observable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">string[]</span></span></span><span class="hljs-class">&gt;; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">public</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FormGroup; constructor</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> fb: FormBuilder, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> wsService: WebsocketService) { } ngOnInit() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.form = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fb.group({ text: [<span class="hljs-literal"><span class="hljs-literal">null</span></span>, [ Validators.required ]] }); <span class="hljs-comment"><span class="hljs-comment">// get messages this.messages$ = this.wsService .addEventListener&lt;IMessage[]&gt;(WS_API.EVENTS.MESSAGES); // get messages multi this.messagesMulti$ = this.wsService .addEventListener&lt;IMessage[]&gt;([ WS_API.EVENTS.MESSAGES, WS_API.EVENTS.MESSAGES_1 ]); // get counter this.counter$ = this.wsService .addEventListener&lt;number&gt;(WS_API.EVENTS.COUNTER); // get texts this.texts$ = this.wsService .addEventListener&lt;string[]&gt;(WS_API.EVENTS.UPDATE_TEXTS); } ngOnDestroy() { } public sendText(): void { if (this.form.valid) { this.wsService .sendMessage(WS_API.COMMANDS.SEND_TEXT, this.form.value.text); this.form.reset(); } } public removeText(index: number): void { this.wsService.sendMessage(WS_API.COMMANDS.REMOVE_TEXT, index); } }</span></span></code> </pre> <br>  ุงูุฎุฏูุฉ ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู. <br><br><hr><br>  ุนูู ุงูุฑุบู ูู ุฃู ุงููุซุงู ูู ุงูููุงูุฉ ููุณ ุญูุงู ุดุงููุงู ููู ูุดุฑูุน ุ ุฅูุง ุฃูู ููุถุญ ุฃุญุฏ ุงูุฃุณุงููุจ ููุนูู ูุน ูุขุฎุฐ ุงูููุจ ูู ุงูุชุทุจููุงุช ุงููุจูุฑุฉ ูุงููุนูุฏุฉ.  ููููู ุฃุฎุฐูุง ูู ุงูุฎุฏูุฉ ูุชุนุฏูููุง ุญุณุจ ุงูููุงู ุงูุญุงููุฉ. <br><br>  ูููู ุงูุนุซูุฑ ุนูู ุงููุณุฎุฉ ุงููุงููุฉ ูู ุงูุฎุฏูุฉ ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">GitHub</a> . <br><br>  ูุฌููุน ุงูุฃุณุฆูุฉ ููููู ุงูุงุชุตุงู ูู ุงูุชุนูููุงุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูู</a> ุนูู Telegram ุฃู ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุงุฉ Angular</a> ููุงู. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar419099/">https://habr.com/ru/post/ar419099/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar419087/index.html">ููู ุนูู ุดุฎุต ุขุฎุฑ ูู ุฎุฑุงูุฉ</a></li>
<li><a href="../ar419089/index.html">ููููุฉ ุงูุบุด ุนูุฏ ูุนุจ ุงููุฑุฏ - ูุตุงุฆุญ ุฎุจุฑุงุก ุงููุนุจุฉ</a></li>
<li><a href="../ar419091/index.html">ุงูุฃุดูุงุก ุงููุดุนุฉ ุจูููุง</a></li>
<li><a href="../ar419095/index.html">ููุชุจ CSS ุฃูุถู ูุฃูุซุฑ ุฌูุงูุง</a></li>
<li><a href="../ar419097/index.html">Mambot - ุฑูุจูุช ูู Telegram ูููุณุงุก ุงูุญูุงูู</a></li>
<li><a href="../ar419101/index.html">ุฅูุดุงุก ูุนุจุฉ ูููุง hackathon</a></li>
<li><a href="../ar419103/index.html">ูุชุงุจุฉ ูุชุฑุฌู ุจุณูุท ูู Lisp - I</a></li>
<li><a href="../ar419105/index.html">ุฑุงุจุท ุงูุจุซ Slurm (Kubernetes Intensive)</a></li>
<li><a href="../ar419107/index.html">ูุธุฑุฉ ุนุงูุฉ ุนูู ุฌุฒุก ููู Dell EMC ูุฃูุซูุฉ ุนูู ุงูุชูููู</a></li>
<li><a href="../ar419109/index.html">ุดุฑุญ ุงูุงููุฌุงุฑุงุช ูู Android P. ูุงุฐุง ุชูุนู ูุน Android Cutoutุ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>