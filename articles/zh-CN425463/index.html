<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ˜ ğŸ° ğŸ˜‘ Unityå…­è¾¹å½¢åœ°å›¾ï¼šæ°´ï¼Œåœ°æ ‡å’Œå ¡å’å¢™ ğŸšƒ ğŸ’¦ ğŸ§™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç¬¬1-3éƒ¨åˆ†ï¼šç½‘æ ¼ï¼Œé¢œè‰²å’Œåƒå…ƒé«˜åº¦ 

 ç¬¬4-7éƒ¨åˆ†ï¼šé¢ ç°¸ï¼Œæ²³æµå’Œé“è·¯ 

 ç¬¬8-11éƒ¨åˆ†ï¼šæ°´ï¼Œåœ°è²Œå’ŒåŸå¢™ 

 ç¬¬12-15éƒ¨åˆ†ï¼šä¿å­˜å’ŒåŠ è½½ï¼Œçº¹ç†ï¼Œè·ç¦» 

 ç¬¬16-19éƒ¨åˆ†ï¼šæ‰¾åˆ°é“è·¯ï¼Œé˜Ÿå‘˜ï¼ŒåŠ¨ç”» 

 ç¬¬20-23éƒ¨åˆ†ï¼šæˆ˜äº‰è¿·é›¾ï¼Œåœ°å›¾ç ”ç©¶ï¼Œç¨‹åºç”Ÿæˆ 

 ç¬¬24-27éƒ¨åˆ†ï¼šæ°´å¾ªç¯ï¼Œä¾µèš€ï¼Œç”Ÿ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Unityå…­è¾¹å½¢åœ°å›¾ï¼šæ°´ï¼Œåœ°æ ‡å’Œå ¡å’å¢™</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/425463/">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬1-3éƒ¨åˆ†ï¼šç½‘æ ¼ï¼Œé¢œè‰²å’Œåƒå…ƒé«˜åº¦</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬4-7éƒ¨åˆ†ï¼šé¢ ç°¸ï¼Œæ²³æµå’Œé“è·¯</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬8-11éƒ¨åˆ†ï¼šæ°´ï¼Œåœ°è²Œå’ŒåŸå¢™</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬12-15éƒ¨åˆ†ï¼šä¿å­˜å’ŒåŠ è½½ï¼Œçº¹ç†ï¼Œè·ç¦»</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬16-19éƒ¨åˆ†ï¼šæ‰¾åˆ°é“è·¯ï¼Œé˜Ÿå‘˜ï¼ŒåŠ¨ç”»</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬20-23éƒ¨åˆ†ï¼šæˆ˜äº‰è¿·é›¾ï¼Œåœ°å›¾ç ”ç©¶ï¼Œç¨‹åºç”Ÿæˆ</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬24-27éƒ¨åˆ†ï¼šæ°´å¾ªç¯ï¼Œä¾µèš€ï¼Œç”Ÿç‰©ç¾¤è½ï¼Œåœ†æŸ±å›¾</a> <br><br><h1> ç¬¬8éƒ¨åˆ†ï¼šæ°´ </h1><br><ul><li> åŠ æ°´åˆ°ç»†èƒã€‚ </li><li> å¯¹æ°´è¡¨é¢è¿›è¡Œä¸‰è§’å‰–åˆ†ã€‚ </li><li> ç”¨æ³¡æ²«åˆ¶ä½œå†²æµªã€‚ </li><li> ç»“åˆæ°´å’Œæ²³æµã€‚ </li></ul><br> æˆ‘ä»¬å·²ç»å¢åŠ äº†æ²³æµæ”¯æŒï¼Œåœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†æŠŠç»†èƒå®Œå…¨æµ¸å…¥æ°´ä¸­ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a9/73c/b6e/2a973cb6eb97eba7d04a325f3ac89a3e.jpg"></div><br>  <i>æ°´æ¥äº†ã€‚</i> <br><a name="habracut"></a><br><h2> æ°´ä½ </h2><br> æœ€ç®€å•çš„æ–¹æ³•æ˜¯é€šè¿‡å°†å…¶è®¾ç½®åœ¨åŒä¸€çº§åˆ«æ¥å®ç°æ°´æ”¯æŒã€‚ æ‰€æœ‰é«˜åº¦ä½äºæ­¤æ°´å¹³çš„ç”µæ± éƒ½å°†æµ¸å…¥æ°´ä¸­ã€‚ ä½†æ˜¯ï¼Œæ›´çµæ´»çš„æ–¹æ³•æ˜¯å°†æ°´ä¿æŒåœ¨ä¸åŒçš„é«˜åº¦ï¼Œå› æ­¤è®©æˆ‘ä»¬æ›´æ”¹æ°´ä½ã€‚ ä¸ºæ­¤ï¼Œ <code>HexCell</code>éœ€è¦ç›‘æ§å…¶æ°´ä½ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> WaterLevel { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> waterLevel; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (waterLevel == <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } waterLevel = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; Refresh(); } } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> waterLevel;</code> </pre> <br> å¦‚æœéœ€è¦ï¼Œæ‚¨å¯ä»¥ç¡®ä¿æµ®é›•çš„æŸäº›åŠŸèƒ½åœ¨æ°´ä¸‹ä¸å­˜åœ¨ã€‚ ä½†æ˜¯ç°åœ¨æˆ‘ä¸ä¼šè¿™æ ·åšã€‚ è¯¸å¦‚æ°´ä¸‹é“è·¯ä¹‹ç±»çš„ä¸œè¥¿é€‚åˆæˆ‘ã€‚ å®ƒä»¬å¯ä»¥è¢«è®¤ä¸ºæ˜¯æœ€è¿‘è¢«æ´ªæ°´æ·¹æ²¡çš„åœ°åŒºã€‚ <br><br><h3> æ·¹æ²¡ç»†èƒ </h3><br> ç°åœ¨æˆ‘ä»¬æœ‰äº†æ°´ä½ï¼Œæœ€é‡è¦çš„é—®é¢˜æ˜¯ç»†èƒæ˜¯å¦åœ¨æ°´ä¸‹ã€‚ å¦‚æœå•å…ƒæ ¼çš„æ°´ä½é«˜äºå…¶é«˜åº¦ï¼Œåˆ™è¯¥å•å…ƒæ ¼åœ¨æ°´ä¸‹ã€‚ ä¸ºäº†è·å¾—æ­¤ä¿¡æ¯ï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªå±æ€§ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsUnderwater { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> waterLevel &gt; elevation; } }</code> </pre> <br> è¿™æ„å‘³ç€å½“æ°´ä½å’Œé«˜åº¦ç›¸ç­‰æ—¶ï¼Œå•å…ƒä¼šä¸Šå‡åˆ°æ°´é¢ä¹‹ä¸Šã€‚ å³ï¼Œæ°´çš„çœŸå®è¡¨é¢ä½äºè¯¥é«˜åº¦ã€‚ ä¸æ²³æµè¡¨é¢ä¸€æ ·ï¼Œè®©æˆ‘ä»¬â€‹â€‹æ·»åŠ ç›¸åŒçš„åç§»é‡<code>HexMetrics.riverSurfaceElevationOffset</code> ã€‚ å°†å…¶åç§°æ›´æ”¹ä¸ºæ›´é€šç”¨çš„åç§°ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// public const float riverSurfaceElevationOffset = -0.5f; public const float waterElevationOffset = -0.5f;</span></span></code> </pre> <br> æ›´æ”¹<code>HexCell.RiverSurfaceY</code> ï¼Œä½¿å…¶ä½¿ç”¨æ–°åç§°ã€‚ ç„¶åï¼Œæˆ‘ä»¬å‘æ·¹æ²¡å•å…ƒçš„æ°´é¢æ·»åŠ ç±»ä¼¼çš„å±æ€§ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> RiverSurfaceY { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (elevation + HexMetrics.waterElevationOffset) * HexMetrics.elevationStep; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> WaterSurfaceY { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (waterLevel + HexMetrics.waterElevationOffset) * HexMetrics.elevationStep; } }</code> </pre> <br><h3> æ°´ç¼–è¾‘ </h3><br> ç¼–è¾‘æ°´ä½ç±»ä¼¼äºæ›´æ”¹é«˜åº¦ã€‚ å› æ­¤ï¼Œ <code>HexMapEditor</code>å¿…é¡»ç›‘è§†æ´»åŠ¨æ°´ä½ä»¥åŠæ˜¯å¦åº”å°†å…¶åº”ç”¨äºå•å…ƒæ ¼ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> activeElevation; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> activeWaterLevel; â€¦ <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> applyElevation = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> applyWaterLevel = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;</code> </pre><br> æ·»åŠ å°†è¿™äº›å‚æ•°ä¸UIè¿æ¥çš„æ–¹æ³•ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetApplyWaterLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> toggle</span></span></span><span class="hljs-function">)</span></span> { applyWaterLevel = toggle; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetWaterLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level</span></span></span><span class="hljs-function">)</span></span> { activeWaterLevel = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)level; }</code> </pre> <br> å¹¶å°†æ°´ä½æ·»åŠ åˆ°<code>EditCell</code> ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyColor) { cell.Color = activeColor; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyElevation) { cell.Elevation = activeElevation; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyWaterLevel) { cell.WaterLevel = activeWaterLevel; } â€¦ } }</code> </pre> <br> è¦å°†æ°´ä½æ·»åŠ åˆ°UIï¼Œè¯·å¤åˆ¶æ ‡ç­¾å’Œé«˜åº¦æ»‘å—ï¼Œç„¶åè¿›è¡Œæ›´æ”¹ã€‚ è¯·è®°ä½å°†å…¶äº‹ä»¶é™„åŠ åˆ°é€‚å½“çš„æ–¹æ³•ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/42b/a13/de4/42ba13de4120b43e460628021c77d99f.png"></div><br>  <i>æ°´ä½æ»‘å—ã€‚</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç»Ÿä¸€åŒ…è£…</a> <br><br><h2> æ°´ä¸‰è§’å‰–åˆ† </h2><br> è¦å¯¹æ°´è¿›è¡Œä¸‰è§’å‰–åˆ†ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æ–°æè´¨çš„æ–°ç½‘æ ¼ã€‚ é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ª<em>Water</em>ç€è‰²å™¨ï¼Œå¤åˆ¶<em>River</em>ç€è‰²å™¨ã€‚ å¯¹å…¶è¿›è¡Œæ›´æ”¹ï¼Œä»¥ä½¿å…¶ä½¿ç”¨colorå±æ€§ã€‚ <br><br><pre> <code class="hljs pgsql">Shader "Custom/Water" { Properties { _Color ("Color", Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) _MainTex ("Albedo (RGB)", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} _Glossiness ("Smoothness", Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0.5</span></span> _Metallic ("Metallic", Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0.0</span></span> } SubShader { Tags { "RenderType"="Transparent" "Queue"="Transparent" } LOD <span class="hljs-number"><span class="hljs-number">200</span></span> CGPROGRAM #pragma surface surf Standard alpha #pragma target <span class="hljs-number"><span class="hljs-number">3.0</span></span> sampler2D _MainTex; struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; }; half _Glossiness; half _Metallic; fixed4 _Color; <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { fixed4 c = _Color; o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; } ENDCG } FallBack "Diffuse" }</code> </pre> <br> é€šè¿‡å¤åˆ¶â€œ <em>æ°´â€</em>æè´¨å¹¶å°†å…¶æ›¿æ¢ä¸ºç€è‰²å™¨ï¼Œä½¿ç”¨æ­¤ç€è‰²å™¨åˆ›å»ºæ–°æè´¨ã€‚ ä¿ç•™å™ªæ³¢çº¹ç†ï¼Œå› ä¸ºç¨åå°†ä½¿ç”¨å®ƒã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fd9/238/283/fd9238283d92bacd26a3ff5dce73b17b.png"></div><br>  <i>æ°´ææ–™ã€‚</i> <br><br> é€šè¿‡å¤åˆ¶<em>Rivers</em>å­ä»£å°†æ–°å­ä»£æ·»åŠ åˆ°é¢„åˆ¶ä¸­ã€‚ ä»–ä¸éœ€è¦UVåæ ‡ï¼Œå¹¶ä¸”å¿…é¡»ä½¿ç”¨<em>Water</em> ã€‚ ä¸å¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬å°†é€šè¿‡åˆ›å»ºé¢„åˆ¶å®ä¾‹ï¼Œå¯¹å…¶è¿›è¡Œæ›´æ”¹ï¼Œç„¶åå°†æ‰€åšçš„æ›´æ”¹åº”ç”¨äºé¢„åˆ¶æ¥å®ç°ã€‚ åœ¨é‚£ä¹‹åï¼Œæ‘†è„±å®ä¾‹ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6ec/6e6/82f/6ec6e682f16c604d75c0e5b835d5b03e.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7c5/3f3/eeb/7c53f3eeb282e533f9f0b8a20e813091.png"></div><br>  <i>å„¿ç«¥å¯¹è±¡æ°´ã€‚</i> <br><br> æ¥ä¸‹æ¥ï¼Œå‘<code>HexGridChunk</code>æ·»åŠ æ°´ç½‘æ ¼æ”¯æŒã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexMesh terrain, rivers, roads, water; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { terrain.Clear(); rivers.Clear(); roads.Clear(); water.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Length; i++) { Triangulate(cells[i]); } terrain.Apply(); rivers.Apply(); roads.Apply(); water.Apply(); }</code> </pre> <br> å¹¶å°†å…¶è¿æ¥åˆ°é¢„åˆ¶å­ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b4d/19a/76a/b4d19a76a745d550314b277fd2c0e13c.png"></div><br>  <i>æ°´å¯¹è±¡å·²è¿æ¥ã€‚</i> <br><br><h3> æ°´å…­è¾¹å½¢ </h3><br> ç”±äºæ°´å½¢æˆç¬¬äºŒå±‚ï¼Œå› æ­¤è®©æˆ‘ä»¬é’ˆå¯¹æ¯ä¸ªæ–¹å‘ä½¿ç”¨è‡ªå·±çš„ä¸‰è§’å‰–åˆ†æ–¹æ³•ã€‚ æˆ‘ä»¬ä»…åœ¨å°†ç”µæ± æµ¸å…¥æ°´ä¸­æ—¶æ‰éœ€è¦è°ƒç”¨å®ƒã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IsUnderwater) { TriangulateWater(direction, cell, center); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br> ä¸æ²³æµä¸€æ ·ï¼Œåœ¨æ°´ä½ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œæ°´é¢çš„é«˜åº¦å˜åŒ–ä¹Ÿä¸å¤§ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬ä¼¼ä¹ä¸éœ€è¦å¤æ‚çš„è‚‹éª¨ã€‚ ä¸€ä¸ªç®€å•çš„ä¸‰è§’å½¢å°±è¶³å¤Ÿäº†ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { center.y = cell.WaterSurfaceY; Vector3 c1 = center + HexMetrics.GetFirstSolidCorner(direction); Vector3 c2 = center + HexMetrics.GetSecondSolidCorner(direction); water.AddTriangle(center, c1, c2); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a51/72b/99b/a5172b99ba382c6e79abff653e4b7fb2.png"></div><br>  <i>æ°´çš„å…­è¾¹å½¢ã€‚</i> <br><br><h3> æ°´åŒ–åˆç‰© </h3><br> æˆ‘ä»¬å¯ä»¥å°†ç›¸é‚»çš„å•å…ƒæ ¼ä¸ä¸€ä¸ªå››è¾¹å½¢çš„æ°´ç›¸è¿ã€‚ <br><br><pre> <code class="cs hljs"> water.AddTriangle(center, c1, c2); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.SE) { HexCell neighbor = cell.GetNeighbor(direction); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (neighbor == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || !neighbor.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } Vector3 bridge = HexMetrics.GetBridge(direction); Vector3 e1 = c1 + bridge; Vector3 e2 = c2 + bridge; water.AddQuad(c1, c2, e1, e2); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0a6/3af/949/0a63af9496da925e966b008f41f808a8.png"></div><br>  <i>æ°´çš„è¾¹ç¼˜çš„è¿æ¥ã€‚</i> <br><br> å¹¶ç”¨ä¸€ä¸ªä¸‰è§’å½¢å¡«å……è§’ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.SE) { â€¦ water.AddQuad(c1, c2, e1, e2); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.E) { HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextNeighbor == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || !nextNeighbor.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } water.AddTriangle( c2, e2, c2 + HexMetrics.GetBridge(direction.Next()) ); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c32/37e/5b4/c3237e5b4e492f9a1c334f90aaa88ee4.png"></div><br>  <i>æ°´è§’çš„å…³èŠ‚ã€‚</i> <br><br> ç°åœ¨ï¼Œå½“æ°´ç»†èƒåœ¨é™„è¿‘æ—¶ï¼Œæˆ‘ä»¬å°†å®ƒä»¬è¿æ¥èµ·æ¥ã€‚ å®ƒä»¬ä¸è¾ƒé«˜é«˜åº¦çš„å¹²ç»†èƒä¹‹é—´ç•™æœ‰é—´éš™ï¼Œä½†æˆ‘ä»¬å°†ç•™ç»™ä»¥åä½¿ç”¨ã€‚ <br><br><h3> åè°ƒæ°´ä½ </h3><br> æˆ‘ä»¬å‡è®¾ç›¸é‚»çš„æ°´ä¸‹ç»†èƒå…·æœ‰ç›¸åŒçš„æ°´ä½ã€‚ å¦‚æœæ˜¯è¿™æ ·ï¼Œé‚£ä¹ˆä¸€åˆ‡çœ‹èµ·æ¥éƒ½å¾ˆå¥½ï¼Œä½†æ˜¯å¦‚æœè¿åäº†æ­¤å‡è®¾ï¼Œåˆ™ä¼šå‘ç”Ÿé”™è¯¯ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fcf/a8b/b4f/fcfa8bb4fb960ddc788d358e60f9023f.png"></div><br>  <i>æ°´ä½ä¸ä¸€è‡´ã€‚</i> <br><br> æˆ‘ä»¬å¯ä»¥ä½¿æ°´ä¿æŒåœ¨åŒä¸€æ°´å¹³ä¸Šã€‚ ä¾‹å¦‚ï¼Œå½“æ·¹æ²¡å•å…ƒçš„æ°´ä½å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ›´æ”¹ä¼ æ’­åˆ°ç›¸é‚»å•å…ƒï¼Œä»¥ä¿æŒæ°´ä½åŒæ­¥ã€‚ ä½†æ˜¯ï¼Œæ­¤è¿‡ç¨‹åº”ç»§ç»­è¿›è¡Œï¼Œç›´åˆ°é‡åˆ°æœªæµ¸å…¥æ°´ä¸­çš„ç»†èƒä¸ºæ­¢ã€‚ è¿™äº›å•å…ƒå®šä¹‰äº†æ°´å›¢çš„è¾¹ç•Œã€‚ <br><br> è¿™ç§æ–¹æ³•çš„å±é™©åœ¨äºå®ƒå¯èƒ½å¾ˆå¿«å¤±æ§ã€‚ å¦‚æœç¼–è¾‘ä¸æˆåŠŸï¼Œåˆ™æ°´å¯èƒ½ä¼šè¦†ç›–æ•´ä¸ªåœ°å›¾ã€‚ ç„¶åï¼Œæ‰€æœ‰ç‰‡æ®µéƒ½å¿…é¡»åŒæ—¶è¿›è¡Œä¸‰è§’å‰–åˆ†ï¼Œè¿™å°†å¯¼è‡´å»¶è¿Ÿçš„å·¨å¤§è·³è·ƒã€‚ <br><br> å› æ­¤ï¼Œè®©æˆ‘ä»¬æš‚æ—¶ä¸åšã€‚ å¯ä»¥åœ¨æ›´å¤æ‚çš„ç¼–è¾‘å™¨ä¸­æ·»åŠ æ­¤åŠŸèƒ½ã€‚ è™½ç„¶æ°´ä½çš„ä¸€è‡´æ€§ï¼Œæˆ‘ä»¬ç¦»å¼€äº†ç”¨æˆ·çš„è‰¯å¿ƒã€‚ <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ç»Ÿä¸€åŒ…è£…</a> <br><br><h2> æ°´åŠ¨ç”» </h2><br> æˆ‘ä»¬å°†åˆ›å»ºç±»ä¼¼äºæ³¢æµªçš„é¢œè‰²ï¼Œè€Œä¸æ˜¯å‡åŒ€çš„é¢œè‰²ã€‚ ä¸å…¶ä»–ç€è‰²å™¨ä¸€æ ·ï¼Œç°åœ¨æˆ‘ä»¬å°†ä¸å†åŠªåŠ›äº‰å–ç²¾ç¾çš„å›¾å½¢ï¼Œåªéœ€è¦æŒ‡å®šæ³¢æµªå³å¯ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ca1/a2f/1f9/ca1a2f1f978cd2f2993a96b44440227b.png"></div><br>  <i>å®Œå…¨å¹³å¦çš„æ°´ã€‚</i> <br><br> è®©æˆ‘ä»¬åšäº›ä¸æ²³æµæœ‰å…³çš„äº‹æƒ…ã€‚ æˆ‘ä»¬æ ¹æ®ä¸–ç•Œçš„ä½ç½®å¯¹å™ªå£°è¿›è¡Œé‡‡æ ·ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°ç»Ÿä¸€çš„é¢œè‰²ä¸­ã€‚ è¦è®¾ç½®æ›²é¢åŠ¨ç”»ï¼Œè¯·åœ¨Våæ ‡ä¸Šæ·»åŠ æ—¶é—´ã€‚ <br><br><pre> <code class="hljs pgsql"> struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; float3 worldPos; }; â€¦ <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { float2 uv = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz; uv.y += _Time.y; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(_MainTex, uv * <span class="hljs-number"><span class="hljs-number">0.025</span></span>); <span class="hljs-type"><span class="hljs-type">float</span></span> waves = noise.z; fixed4 c = saturate(_Color + waves); o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; }</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>æ»šåŠ¨æ°´ï¼Œæ—¶é—´Ã—10ã€‚</i> <br><br><h3> ä¸¤ä¸ªæ–¹å‘ </h3><br> åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™æ ¹æœ¬ä¸åƒæ³¢æµªã€‚ è®©æˆ‘ä»¬é€šè¿‡æ·»åŠ ç¬¬äºŒä¸ªå™ªå£°æ ·æœ¬æ¥ä½¿å›¾ç‰‡å¤æ‚åŒ– <br> ç„¶åæ·»åŠ Uåæ ‡æˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªä¸åŒçš„å™ªå£°é€šé“æ¥å¾—åˆ°ä¸¤ä¸ªä¸åŒçš„æ¨¡å¼ å®Œæˆçš„æ³¢å°†è¿™ä¸¤ä¸ªæ ·æœ¬å †å åœ¨ä¸€èµ·ã€‚ <br><br><pre> <code class="hljs pgsql"> float2 uv1 = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz; uv1.y += _Time.y; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise1 = tex2D(_MainTex, uv1 * <span class="hljs-number"><span class="hljs-number">0.025</span></span>); float2 uv2 = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz; uv2.x += _Time.y; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise2 = tex2D(_MainTex, uv2 * <span class="hljs-number"><span class="hljs-number">0.025</span></span>); <span class="hljs-type"><span class="hljs-type">float</span></span> waves = noise1.z + noise2.x;</code> </pre> <br> å½“å¯¹ä¸¤ä¸ªæ ·æœ¬æ±‚å’Œæ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°çš„ç»“æœèŒƒå›´ä¸º0â€“2ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°†å…¶ç¼©æ”¾å›0â€“1ã€‚ ä»£æ›¿ç®€å•åœ°å°†æ³¢åˆ†æˆä¸¤åŠï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>smoothstep</code>å‡½æ•°åˆ›å»ºæ›´æœ‰è¶£çš„ç»“æœã€‚ æˆ‘ä»¬å°†Â¾â€“ 2æ”¾åœ¨0â€“1ä¸Šï¼Œä»¥ä½¿æ°´é¢æ²¡æœ‰å¯è§æ³¢ã€‚ <br><br><pre> <code class="hljs mel"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> waves = noise1.z + noise2.x; waves = <span class="hljs-keyword"><span class="hljs-keyword">smoothstep</span></span>(<span class="hljs-number"><span class="hljs-number">0.75</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, waves);</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>ä¸¤ä¸ªæ–¹å‘ï¼Œæ—¶é—´Ã—10ã€‚</i> <br><br><h3> æ··åˆæµªæ½® </h3><br> ä»ç„¶å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªå®é™…ä¸Šæ²¡æœ‰å˜åŒ–çš„è¿åŠ¨å™ªå£°æ¨¡å¼ã€‚ å¦‚æœæ¨¡å¼å‘ç”Ÿå˜åŒ–ï¼Œé‚£å°†æ›´åŠ åˆç†ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å™ªå£°æ ·æœ¬çš„ä¸åŒé€šé“ä¹‹é—´è¿›è¡Œæ’å€¼æ¥å®ç°è¿™ä¸€ç‚¹ã€‚ ä½†è¿™ä¸èƒ½ä»¥ç›¸åŒçš„æ–¹å¼è¿›è¡Œï¼Œå¦åˆ™æ°´çš„æ•´ä¸ªè¡¨é¢å°†åŒæ—¶å˜åŒ–ï¼Œè¿™æ˜¯éå¸¸æ˜æ˜¾çš„ã€‚ ç›¸åï¼Œæˆ‘ä»¬å°†é€ æˆä¸€æ³¢æ··ä¹±ã€‚ <br><br> æˆ‘ä»¬å°†åœ¨æ­£å¼¦æ³¢çš„å¸®åŠ©ä¸‹åˆ›å»ºä¸€ä¸ªæ··åˆæ³¢ï¼Œè¯¥æ··åˆæ³¢å°†æ²¿æ°´è¡¨é¢å¯¹è§’çº¿ç§»åŠ¨ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä¸–ç•Œåæ ‡Xå’ŒZç›¸åŠ ï¼Œå¹¶å°†æ€»å’Œç”¨ä½œ<code>sin</code>å‡½æ•°çš„è¾“å…¥ã€‚ ç¼©å°ä»¥è·å–è¶³å¤Ÿå¤§çš„æ³¢æ®µã€‚ å½“ç„¶ï¼Œè®©æˆ‘ä»¬æ·»åŠ ç›¸åŒçš„å€¼æ¥åˆ¶ä½œåŠ¨ç”»ã€‚ <br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float</span></span> blendWave = sin((<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.x + <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.z) * <span class="hljs-number"><span class="hljs-number">0.1</span></span> + _Time.y);</code> </pre> <br> æ­£å¼¦æ³¢çš„èŒƒå›´æ˜¯-1å’Œ1ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª0â€“1çš„é—´éš”ã€‚ æ‚¨å¯ä»¥é€šè¿‡å¹³æ–¹æ³¢æ¥è·å¾—å®ƒã€‚ è¦æŸ¥çœ‹éš”ç¦»çš„ç»“æœï¼Œè¯·ä½¿ç”¨å®ƒä»£æ›¿æ›´æ”¹çš„é¢œè‰²ä½œä¸ºè¾“å‡ºå€¼ã€‚ <br><br><pre> <code class="hljs pgsql"> sin((<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.x + <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.z) * <span class="hljs-number"><span class="hljs-number">0.1</span></span> + _Time.y); blendWave *= blendWave; <span class="hljs-type"><span class="hljs-type">float</span></span> waves = noise1.z + noise2.x; waves = smoothstep(<span class="hljs-number"><span class="hljs-number">0.75</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, waves); fixed4 c = blendWave; //saturate(_Color + waves);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa3/3d9/d70/aa33d9d70a022df57a0348423181b258.png"></div><br>  <i>æ··åˆæµªæ½®ã€‚</i> <br><br> ä¸ºäº†ä½¿æ··åˆæ³¢ä¸é‚£ä¹ˆå¼•äººæ³¨ç›®ï¼Œè¯·ä»ä¸¤ä¸ªæ ·æœ¬ä¸­æ·»åŠ ä¸€äº›å™ªå£°ã€‚ <br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float</span></span> blendWave = sin( (<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.x + <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.z) * <span class="hljs-number"><span class="hljs-number">0.1</span></span> + (noise1.y + noise2.z) + _Time.y ); blendWave *= blendWave;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/618/c8f/697/618c8f697cd2e463d7349030277d1a82.png"></div><br>  <i>æ‰­æ›²çš„æ··åˆæ³¢ã€‚</i> <br><br> æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨æ··åˆæ³¢åœ¨ä¸¤ä¸ªå™ªå£°æ ·æœ¬çš„ä¸¤ä¸ªé€šé“ä¹‹é—´è¿›è¡Œå†…æ’ã€‚ ä¸ºäº†è·å¾—æœ€å¤§çš„å˜åŒ–ï¼Œé‡‡ç”¨å››ä¸ªä¸åŒçš„é€šé“ã€‚ <br><br><pre> <code class="hljs lisp"> float waves = lerp(<span class="hljs-name"><span class="hljs-name">noise1</span></span>.z, noise1.w, blendWave) + lerp(<span class="hljs-name"><span class="hljs-name">noise2</span></span>.x, noise2.y, blendWave)<span class="hljs-comment"><span class="hljs-comment">; waves = smoothstep(0.75, 2, waves); fixed4 c = saturate(_Color + waves);</span></span></code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>æ··æ³¢ï¼Œæ—¶é—´Ã—2ã€‚</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ç»Ÿä¸€åŒ…è£…</a> <br><br><h2> æµ·å²¸ </h2><br> æˆ‘ä»¬å·²ç»å®Œæˆäº†å¼€æ”¾æ°´åŸŸï¼Œä½†ç°åœ¨æˆ‘ä»¬éœ€è¦å¡«è¡¥æ²¿æµ·æ°´åŸŸçš„ç©ºç™½ã€‚ ç”±äºæˆ‘ä»¬å¿…é¡»ç¬¦åˆåœŸåœ°çš„è½®å»“ï¼Œå› æ­¤æ²¿æµ·æ°´éœ€è¦é‡‡å–ä¸åŒçš„æ–¹æ³•ã€‚ è®©æˆ‘ä»¬å°†<code>TriangulateWater</code>åˆ†ä¸ºä¸¤ç§æ–¹æ³•-ä¸€ç§ç”¨äºå¼€æ”¾æ°´åŸŸï¼Œå¦ä¸€ç§ç”¨äºæµ·å²¸æ°´åŸŸã€‚ è¦äº†è§£ä½•æ—¶ä¸æµ·å²¸åˆä½œï¼Œæˆ‘ä»¬éœ€è¦æŸ¥çœ‹é‚»è¿‘çš„å•å…ƒã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨<code>TriangulateWater</code>æˆ‘ä»¬å°†å¾—åˆ°ä¸€ä¸ªé‚»å±…ã€‚ å¦‚æœæœ‰é‚»å±…å¹¶ä¸”ä»–ä¸åœ¨æ°´ä¸‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ­£åœ¨ä¸æµ·å²¸æ‰“äº¤é“ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { center.y = cell.WaterSurfaceY; HexCell neighbor = cell.GetNeighbor(direction); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (neighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; !neighbor.IsUnderwater) { TriangulateWaterShore(direction, cell, neighbor, center); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateOpenWater(direction, cell, neighbor, center); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateOpenWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { Vector3 c1 = center + HexMetrics.GetFirstSolidCorner(direction); Vector3 c2 = center + HexMetrics.GetSecondSolidCorner(direction); water.AddTriangle(center, c1, c2); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.SE &amp;&amp; neighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// HexCell neighbor = cell.GetNeighbor(direction); // if (neighbor == null || !neighbor.IsUnderwater) { // return; // } Vector3 bridge = HexMetrics.GetBridge(direction); â€¦ } } void TriangulateWaterShore ( HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center ) { }</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f04/799/441/f0479944178dcb5646bbf935700a798e.png"></div><br>  <i>æ²¿æµ·æ²¡æœ‰ä¸‰è§’å‰–åˆ†ã€‚</i> <br><br> ç”±äºæµ·å²¸å˜å½¢ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿æµ·å²¸çš„æ°´ä¸‰è§’å½¢å˜å½¢ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è¾¹ç¼˜çš„é¡¶éƒ¨å’Œä¸‰è§’å½¢çš„æ‰‡å½¢ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWaterShore</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { EdgeVertices e1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( center + HexMetrics.GetFirstSolidCorner(direction), center + HexMetrics.GetSecondSolidCorner(direction) ); water.AddTriangle(center, e1.v1, e1.v2); water.AddTriangle(center, e1.v2, e1.v3); water.AddTriangle(center, e1.v3, e1.v4); water.AddTriangle(center, e1.v4, e1.v5); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bbd/761/283/bbd76128386859bb388e6e2d3f105ff0.png"></div><br>  <i>æ²¿æµ·å²¸çš„ä¸‰è§’å½¢é£æ‰‡ã€‚</i> <br><br> æ¥ä¸‹æ¥æ˜¯ä¸€æ¡è‚‹éª¨ï¼Œå°±åƒé€šå¸¸çš„æµ®é›•ä¸€æ ·ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬æ²¡æœ‰ä¹‰åŠ¡å°†è‡ªå·±ä»…é™äºæŸäº›åŒºåŸŸï¼Œå› ä¸ºæˆ‘ä»¬åœ¨é‡åˆ°æµ·å²¸æ—¶åªå‘¼å«<code>TriangulateWaterShore</code> ï¼Œè€Œå¯¹äºè¯¥æµ·å²¸è€Œè¨€ï¼Œåˆ™å§‹ç»ˆéœ€è¦è¯¥åŒºåŸŸã€‚ <br><br><pre> <code class="cs hljs"> water.AddTriangle(center, e1.v4, e1.v5); Vector3 bridge = HexMetrics.GetBridge(direction); EdgeVertices e2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( e1.v1 + bridge, e1.v5 + bridge ); water.AddQuad(e1.v1, e1.v2, e2.v1, e2.v2); water.AddQuad(e1.v2, e1.v3, e2.v2, e2.v3); water.AddQuad(e1.v3, e1.v4, e2.v3, e2.v4); water.AddQuad(e1.v4, e1.v5, e2.v4, e2.v5);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7da/fbc/aa9/7dafbcaa95a4b48509ab68fbf111c703.png"></div><br>  <i>è‚‹éª¨æ¡çº¹æ²¿æµ·ã€‚</i> <br><br> åŒæ ·ï¼Œæˆ‘ä»¬æ¯æ¬¡ä¹Ÿå¿…é¡»æ·»åŠ ä¸€ä¸ªä¸‰è§’å½¢çš„ä¸‰è§’å½¢ã€‚ <br><br><pre> <code class="cs hljs"> water.AddQuad(e1.v4, e1.v5, e2.v4, e2.v5); HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextNeighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { water.AddTriangle( e1.v5, e2.v5, e1.v5 + HexMetrics.GetBridge(direction.Next()) ); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/064/18f/8b1/06418f8b10cc0fc0a4e2276b86375385.png"></div><br>  <i>æ²¿æµ·çš„è‚‹éª¨çš„è§’è½ã€‚</i> <br><br> ç°åœ¨æˆ‘ä»¬å·²ç»ä¸ºæµ·å²¸å‡†å¤‡äº†æ°´ã€‚ å®ƒçš„ä¸€éƒ¨åˆ†å§‹ç»ˆåœ¨æµ®é›•ç½‘æ ¼ä¸‹æ–¹ï¼Œå› æ­¤æ²¡æœ‰å­”ã€‚ <br><br><h3> ç´«å¤–çº¿æµ·å²¸ </h3><br> æˆ‘ä»¬å¯ä»¥ä¿ç•™ä¸€åˆ‡ï¼Œä½†å¦‚æœæ²¿æµ·æ°´æœ‰è‡ªå·±çš„æ—¶é—´è¡¨ï¼Œé‚£å°†å¾ˆæœ‰è¶£ã€‚ ä¾‹å¦‚ï¼Œæ³¡æ²«çš„å½±å“ï¼Œåœ¨é è¿‘æµ·å²¸æ—¶ä¼šå˜å¾—æ›´å¤§ã€‚ è¦å®ç°å®ƒï¼Œç€è‰²å™¨å¿…é¡»çŸ¥é“ç‰‡æ®µç¦»æµ·å²¸æœ‰å¤šè¿‘ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡UVåæ ‡ä¼ è¾“æ­¤ä¿¡æ¯ã€‚ <br><br> å¼€æ”¾æ°´æ²¡æœ‰ç´«å¤–çº¿åæ ‡ï¼Œä¹Ÿä¸éœ€è¦æ³¡æ²«ã€‚ ä»…æµ·å²¸é™„è¿‘çš„æ°´æ‰éœ€è¦ã€‚ å› æ­¤ï¼Œå¯¹ä¸¤ç§æ°´çš„è¦æ±‚éƒ½å¤§ä¸ç›¸åŒã€‚ ä¸ºæ¯ç§ç±»å‹åˆ›å»ºè‡ªå·±çš„ç½‘æ ¼æ˜¯åˆä¹é€»è¾‘çš„ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å‘HexGridChunkæ·»åŠ äº†å¯¹å¦ä¸€ä¸ªç½‘æ ¼å¯¹è±¡çš„æ”¯æŒã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexMesh terrain, rivers, roads, water, waterShore; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { terrain.Clear(); rivers.Clear(); roads.Clear(); water.Clear(); waterShore.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Length; i++) { Triangulate(cells[i]); } terrain.Apply(); rivers.Apply(); roads.Apply(); water.Apply(); waterShore.Apply(); }</code> </pre> <br> è¿™ä¸ªæ–°çš„ç½‘æ ¼å°†ä½¿ç”¨<code>TriangulateWaterShore</code> ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWaterShore</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { â€¦ waterShore.AddQuad(e1.v1, e1.v2, e2.v1, e2.v2); waterShore.AddQuad(e1.v2, e1.v3, e2.v2, e2.v3); waterShore.AddQuad(e1.v3, e1.v4, e2.v3, e2.v4); waterShore.AddQuad(e1.v4, e1.v5, e2.v4, e2.v5); HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextNeighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { waterShore.AddTriangle( e1.v5, e2.v5, e1.v5 + HexMetrics.GetBridge(direction.Next()) ); } }</code> </pre> <br> å¤åˆ¶æ°´å¯¹è±¡ï¼Œå°†å…¶è¿æ¥åˆ°é¢„åˆ¶ä»¶å¹¶è¿›è¡Œè®¾ç½®ï¼Œä»¥ä½¿å…¶ä½¿ç”¨UVåæ ‡ã€‚ æˆ‘ä»¬è¿˜ä¸ºæ²¿æµ·æ°´åˆ›å»ºäº†ä¸€ä¸ªç€è‰²å™¨å’Œæè´¨ï¼Œå¤åˆ¶äº†ç°æœ‰çš„ç€è‰²å™¨å’Œæ°´æè´¨ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/561/77e/e73/56177ee7331ce092a859a058645f0364.png"></div><br>  <i>æ°´å²¸è®¾æ–½å’Œç´«å¤–çº¿ææ–™ã€‚</i> <br><br> æ›´æ”¹â€œ <em>æ°´å²¸â€</em>ç€è‰²å™¨ï¼Œä»¥ä½¿å…¶æ˜¾ç¤ºUVåæ ‡è€Œä¸æ˜¯æ°´ã€‚ <br><br><pre> <code class="hljs lisp"> fixed4 c = fixed4(<span class="hljs-name"><span class="hljs-name">IN</span></span>.uv_MainTex, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br> ç”±äºå°šæœªè®¾ç½®åæ ‡ï¼Œå®ƒå°†æ˜¾ç¤ºçº¯è‰²ã€‚ å› æ­¤ï¼Œå¾ˆå®¹æ˜“çœ‹åˆ°æµ·å²¸å®é™…ä¸Šä½¿ç”¨äº†å¸¦æœ‰ææ–™çš„å•ç‹¬ç½‘æ ¼ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/630/45c/ec0/63045cec0f1f367bfee191f69cfa11ad.png"></div><br>  <i>ç”¨äºæµ·å²¸çš„å•ç‹¬ç½‘æ ¼ã€‚</i> <br><br> è®©æˆ‘ä»¬å°†æµ·å²¸ä¿¡æ¯æ”¾ç½®åœ¨åæ ‡Vä¸­ã€‚åœ¨æ°´ä¾§ï¼Œå°†å…¶åˆ†é…ä¸º0ï¼Œåœ¨é™†åœ°ä¾§å°†å…¶åˆ†é…ä¸º-å€¼1ã€‚ç”±äºæˆ‘ä»¬æ— éœ€ä¼ è¾“å…¶ä»–ä»»ä½•å†…å®¹ï¼Œå› æ­¤æ‰€æœ‰Uåæ ‡éƒ½å°†ç®€å•åœ°ä¸º0ã€‚ <br><br><pre> <code class="cs hljs"> waterShore.AddQuad(e1.v1, e1.v2, e2.v1, e2.v2); waterShore.AddQuad(e1.v2, e1.v3, e2.v2, e2.v3); waterShore.AddQuad(e1.v3, e1.v4, e2.v3, e2.v4); waterShore.AddQuad(e1.v4, e1.v5, e2.v4, e2.v5); waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextNeighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { waterShore.AddTriangle( e1.v5, e2.v5, e1.v5 + HexMetrics.GetBridge(direction.Next()) ); waterShore.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8f4/3fa/f86/8f43faf864c259e21c2ce731d08f43f6.png"></div><br>  <i>å‘æµ·å²¸è¿‡æ¸¡æ˜¯é”™è¯¯çš„ã€‚</i> <br><br> ä¸Šé¢çš„ä»£ç é€‚ç”¨äºè¾¹ç¼˜ï¼Œä½†æ˜¯åœ¨æŸäº›è§’åº¦ä¸Šæ˜¯é”™è¯¯çš„ã€‚ å¦‚æœä¸‹ä¸€ä¸ªé‚»å±…åœ¨æ°´ä¸‹ï¼Œåˆ™æ­¤æ–¹æ³•å°†æ˜¯æ­£ç¡®çš„ã€‚ ä½†æ˜¯ï¼Œå½“ä¸‹ä¸€ä¸ªé‚»å±…ä¸åœ¨æ°´ä¸‹æ—¶ï¼Œä¸‰è§’å½¢çš„ç¬¬ä¸‰ä¸ªå³°å°†åœ¨é™†åœ°ä¸‹ã€‚ <br><br><pre> <code class="cs hljs"> waterShore.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, nextNeighbor.IsUnderwater ? <span class="hljs-number"><span class="hljs-number">0f</span></span> : <span class="hljs-number"><span class="hljs-number">1f</span></span>) );</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c2e/9e9/6e6/c2e9e96e63c161d0f71f81e31742af89.png"></div><br>  <i>è¿‡æ¸¡åˆ°æµ·å²¸æ˜¯æ­£ç¡®çš„ã€‚</i> <br><br><h3> æµ·å²¸ä¸Šçš„æ³¡æ²« </h3><br> ç°åœ¨å·²ç»æ­£ç¡®å®ç°äº†å‘æµ·å²¸çš„è¿‡æ¸¡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒä»¬åˆ›å»ºæ³¡æ²«æ•ˆæœã€‚ æœ€ç®€å•çš„æ–¹æ³•æ˜¯å°†æƒ¯æ€§è¿åŠ¨çš„å€¼æ·»åŠ åˆ°ç»Ÿä¸€çš„é¢œè‰²ã€‚ <br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { <span class="hljs-type"><span class="hljs-type">float</span></span> shore = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y; <span class="hljs-type"><span class="hljs-type">float</span></span> foam = shore; fixed4 c = saturate(_Color + foam); o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ef5/502/a56/ef5502a56ab665732312be25a6961817.png"></div><br>  <i>çº¿æ€§æ³¡æ²«ã€‚</i> <br><br> ä¸ºäº†ä½¿æ³¡æ²«æ›´æœ‰è¶£ï¼Œè¯·å°†å…¶ä¹˜ä»¥æ­£å¼¦æ›²çº¿çš„å¹³æ–¹ã€‚ <br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float</span></span> foam = sin(shore * <span class="hljs-number"><span class="hljs-number">10</span></span>); foam *= foam * shore;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c2e/acf/6d8/c2eacf6d83e9f7c1298cdd7a05e551d0.png"></div><br>  <i>è¤ªè‰²æ­£å¼¦æ–¹å½¢æ³¡æ²«ã€‚</i> <br><br> é è¿‘å²¸è¾¹æ—¶ï¼Œè®©æ³¡æ²«å‰ç«¯å˜å¤§ã€‚ è¿™å¯ä»¥é€šè¿‡åœ¨ä½¿ç”¨Coastå€¼ä¹‹å‰å–å…¶å¹³æ–¹æ ¹æ¥å®Œæˆã€‚ <br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float</span></span> shore = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y; shore = sqrt(shore);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/762/675/e98/762675e987d119034cd5b643c86ca672.png"></div><br>  <i>é è¿‘å²¸è¾¹çš„æ³¡æ²«å˜ç¨ ã€‚</i> <br><br> æ·»åŠ å˜å½¢ä»¥ä½¿å…¶çœ‹èµ·æ¥æ›´è‡ªç„¶ã€‚ è®©æˆ‘ä»¬åœ¨æ¥è¿‘æµ·å²¸æ—¶ä½¿å˜å½¢å‡å¼±ã€‚ å› æ­¤ï¼Œæœ€å¥½æ²¿ç€æµ·å²¸èµ°ã€‚ <br><br><pre> <code class="hljs pgsql"> float2 noiseUV = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(_MainTex, noiseUV * <span class="hljs-number"><span class="hljs-number">0.015</span></span>); <span class="hljs-type"><span class="hljs-type">float</span></span> distortion = noise.x * (<span class="hljs-number"><span class="hljs-number">1</span></span> - shore); <span class="hljs-type"><span class="hljs-type">float</span></span> foam = sin((shore + distortion) * <span class="hljs-number"><span class="hljs-number">10</span></span>); foam *= foam * shore;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/31a/7fd/59a/31a7fd59ad215b200571133543f1406b.png"></div><br>  <i>æ³¡æ²«å˜å½¢ã€‚</i> <br><br> è€Œä¸”ï¼Œå½“ç„¶ï¼Œæˆ‘ä»¬æ­£åœ¨ä¸ºæ‰€æœ‰è¿™äº›åŠ¨ç”»ï¼šæ­£å¼¦æ›²çº¿å’Œæ‰­æ›²ã€‚ <br><br><pre> <code class="hljs pgsql"> float2 noiseUV = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz + _Time.y * <span class="hljs-number"><span class="hljs-number">0.25</span></span>; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(_MainTex, noiseUV * <span class="hljs-number"><span class="hljs-number">0.015</span></span>); <span class="hljs-type"><span class="hljs-type">float</span></span> distortion = noise.x * (<span class="hljs-number"><span class="hljs-number">1</span></span> - shore); <span class="hljs-type"><span class="hljs-type">float</span></span> foam = sin((shore + distortion) * <span class="hljs-number"><span class="hljs-number">10</span></span> - _Time.y); foam *= foam * shore;</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>åŠ¨ç”»æ³¡æ²«ã€‚</i> <br><br> é™¤äº†ä¼ å…¥çš„æ³¡æ²«å¤–ï¼Œè¿˜æœ‰ä¸€ç§åé€€æ³¡æ²«ã€‚ è®©æˆ‘ä»¬æ·»åŠ ç¬¬äºŒä¸ªæ­£å¼¦æ›²çº¿æ¥æ¨¡æ‹Ÿå®ƒï¼Œå®ƒä»¥ç›¸åçš„æ–¹å‘ç§»åŠ¨ã€‚ ä½¿å…¶å˜å¼±å¹¶æ·»åŠ æ—¶ç§»ã€‚ æˆå“æ³¡æ²«å°†æ˜¯è¿™ä¸¤ä¸ªæ­£å¼¦æ³¢çš„æœ€å¤§å€¼ã€‚ <br><br><pre> <code class="hljs mel"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> distortion1 = <span class="hljs-keyword"><span class="hljs-keyword">noise</span></span>.x * (<span class="hljs-number"><span class="hljs-number">1</span></span> - shore); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> foam1 = <span class="hljs-keyword"><span class="hljs-keyword">sin</span></span>((shore + distortion1) * <span class="hljs-number"><span class="hljs-number">10</span></span> - _Time.y); foam1 *= foam1; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> distortion2 = <span class="hljs-keyword"><span class="hljs-keyword">noise</span></span>.y * (<span class="hljs-number"><span class="hljs-number">1</span></span> - shore); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> foam2 = <span class="hljs-keyword"><span class="hljs-keyword">sin</span></span>((shore + distortion2) * <span class="hljs-number"><span class="hljs-number">10</span></span> + _Time.y + <span class="hljs-number"><span class="hljs-number">2</span></span>); foam2 *= foam2 * <span class="hljs-number"><span class="hljs-number">0.7</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> foam = <span class="hljs-keyword"><span class="hljs-keyword">max</span></span>(foam1, foam2) * shore;</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>è¿›å‡ºæ³¡æ²«ã€‚</i> <br><br><h3> æ³¢æµªå’Œæ³¡æ²«çš„æ··åˆ </h3><br> åœ¨å¼€æ”¾æ°´åŸŸå’Œæ²¿æµ·æ°´åŸŸä¹‹é—´æœ‰ä¸€ä¸ªæ€¥å‰§çš„è¿‡æ¸¡ï¼Œå› ä¸ºå¼€æ”¾æ°´æ³¢ä¸åŒ…æ‹¬åœ¨æ²¿æµ·æ°´åŸŸä¸­ã€‚ è¦è§£å†³æ­¤é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦åœ¨<em>Water Shore</em>ç€è‰²å™¨ä¸­åŒ…æ‹¬è¿™äº›æ³¢æµªã€‚ <br><br> è®©æˆ‘ä»¬å°†å…¶ç²˜è´´åˆ°<em>Water.cginc</em>åŒ…å«æ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯å¤åˆ¶æ³¢å½¢ä»£ç ã€‚ å®é™…ä¸Šï¼Œæˆ‘ä»¬åœ¨å…¶ä¸­æ’å…¥äº†ç”¨äºæ³¡æ²«å’Œæ³¢æµªçš„ä»£ç ï¼Œæ¯ä¸ªéƒ½æ˜¯ç‹¬ç«‹çš„åŠŸèƒ½ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">ç€è‰²å™¨åŒ…å«æ–‡ä»¶å¦‚ä½•å·¥ä½œï¼Ÿ</b> <div class="spoiler_text"> åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Rendering 5</a>æ•™ç¨‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">â€œ Multiple Lightsâ€ä¸­</a>ä»‹ç»äº†å¦‚ä½•åˆ›å»ºè‡ªå·±çš„åŒ…å«ç€è‰²å™¨æ–‡ä»¶ã€‚ </div></div><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">float</span></span> Foam (<span class="hljs-type"><span class="hljs-type">float</span></span> shore, float2 worldXZ, sampler2D noiseTex) { // <span class="hljs-type"><span class="hljs-type">float</span></span> shore = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y; shore = sqrt(shore); float2 noiseUV = worldXZ + _Time.y * <span class="hljs-number"><span class="hljs-number">0.25</span></span>; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(noiseTex, noiseUV * <span class="hljs-number"><span class="hljs-number">0.015</span></span>); <span class="hljs-type"><span class="hljs-type">float</span></span> distortion1 = noise.x * (<span class="hljs-number"><span class="hljs-number">1</span></span> - shore); <span class="hljs-type"><span class="hljs-type">float</span></span> foam1 = sin((shore + distortion1) * <span class="hljs-number"><span class="hljs-number">10</span></span> - _Time.y); foam1 *= foam1; <span class="hljs-type"><span class="hljs-type">float</span></span> distortion2 = noise.y * (<span class="hljs-number"><span class="hljs-number">1</span></span> - shore); <span class="hljs-type"><span class="hljs-type">float</span></span> foam2 = sin((shore + distortion2) * <span class="hljs-number"><span class="hljs-number">10</span></span> + _Time.y + <span class="hljs-number"><span class="hljs-number">2</span></span>); foam2 *= foam2 * <span class="hljs-number"><span class="hljs-number">0.7</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> max(foam1, foam2) * shore; } <span class="hljs-type"><span class="hljs-type">float</span></span> Waves (float2 worldXZ, sampler2D noiseTex) { float2 uv1 = worldXZ; uv1.y += _Time.y; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise1 = tex2D(noiseTex, uv1 * <span class="hljs-number"><span class="hljs-number">0.025</span></span>); float2 uv2 = worldXZ; uv2.x += _Time.y; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise2 = tex2D(noiseTex, uv2 * <span class="hljs-number"><span class="hljs-number">0.025</span></span>); <span class="hljs-type"><span class="hljs-type">float</span></span> blendWave = sin( (worldXZ.x + worldXZ.y) * <span class="hljs-number"><span class="hljs-number">0.1</span></span> + (noise1.y + noise2.z) + _Time.y ); blendWave *= blendWave; <span class="hljs-type"><span class="hljs-type">float</span></span> waves = lerp(noise1.z, noise1.w, blendWave) + lerp(noise2.x, noise2.y, blendWave); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> smoothstep(<span class="hljs-number"><span class="hljs-number">0.75</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, waves); }</code> </pre> <br> æ›´æ”¹<em>æ°´</em>ç€è‰²å™¨ï¼Œä½¿å…¶ä½¿ç”¨æ–°çš„åŒ…å«æ–‡ä»¶ã€‚ <br><br><pre> <code class="hljs pgsql"> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "Water.cginc" sampler2D _MainTex; â€¦ <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { <span class="hljs-type"><span class="hljs-type">float</span></span> waves = Waves(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz, _MainTex); fixed4 c = saturate(_Color + waves); o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; }</code> </pre> <br> åœ¨â€œ <em>æ°´å²¸â€</em>ç€è‰²å™¨ä¸­ï¼Œå°†åŒæ—¶è®¡ç®—æ³¡æ²«å’Œæ³¢æµªçš„å€¼ã€‚ ç„¶åï¼Œå½“æˆ‘ä»¬æ¥è¿‘æµ·å²¸æ—¶ï¼Œæˆ‘ä»¬å°†æµ·æµªæ¶ˆå£°ã€‚ æœ€ç»ˆç»“æœå°†æ˜¯æ³¡æ²«å’Œæ³¢æµªçš„æœ€å¤§åŒ–ã€‚ <br><br><pre> <code class="hljs pgsql"> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "Water.cginc" sampler2D _MainTex; â€¦ <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { <span class="hljs-type"><span class="hljs-type">float</span></span> shore = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y; <span class="hljs-type"><span class="hljs-type">float</span></span> foam = Foam(shore, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz, _MainTex); <span class="hljs-type"><span class="hljs-type">float</span></span> waves = Waves(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz, _MainTex); waves *= <span class="hljs-number"><span class="hljs-number">1</span></span> - shore; fixed4 c = saturate(_Color + max(foam, waves)); o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; }</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>æ³¡æ²«å’Œæ³¢æµªçš„æ··åˆç‰©ã€‚</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ç»Ÿä¸€åŒ…è£…</a> <br><br><h2> å†è°ˆæ²¿æµ·æ°´ </h2><br> æµ·å²¸ç½‘æ ¼çš„ä¸€éƒ¨åˆ†éšè—åœ¨æµ®é›•ç½‘æ ¼ä¸‹æ–¹ã€‚ è¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œä½†æ˜¯åªæœ‰ä¸€å°éƒ¨åˆ†è¢«éšè—ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œé™¡å³­çš„æ‚¬å´–æ©ç›–äº†å¤§éƒ¨åˆ†æ²¿æµ·æ°´åŸŸï¼Œå› æ­¤ä¹Ÿèµ·æ³¡æ²«ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dea/adf/7e3/deaadf7e3290f93b28ed6177c713bbaa.png"></div><br>  <i>å‡ ä¹éšè—çš„æ²¿æµ·æ°´åŸŸã€‚</i> <br><br> æˆ‘ä»¬å¯ä»¥é€šè¿‡å¢åŠ æµ·å²¸å¸¦çš„å¤§å°æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ è¿™å¯ä»¥é€šè¿‡å‡å°æ°´çš„å…­è¾¹å½¢çš„åŠå¾„æ¥å®Œæˆã€‚ ä¸ºæ­¤ï¼Œé™¤äº†å®Œæ•´æ€§ç³»æ•°å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦<code>HexMetrics</code>æ°´ç³»æ•°ä»¥åŠè·å–æ°´è§’çš„æ–¹æ³•ã€‚ <br><br> å®Œæ•´æ€§ç³»æ•°ä¸º0.8ã€‚ è¦ä½¿æ°´åŒ–åˆç‰©çš„å¤§å°å¢åŠ ä¸€å€ï¼Œæˆ‘ä»¬éœ€è¦å°†æ°´ç³»æ•°è®¾ç½®ä¸º0.6ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> waterFactor = <span class="hljs-number"><span class="hljs-number">0.6f</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetFirstWaterCorner</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> corners[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction] * waterFactor; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSecondWaterCorner</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> corners[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction + <span class="hljs-number"><span class="hljs-number">1</span></span>] * waterFactor; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä½¿ç”¨è¿™äº›æ–°æ–¹æ³•</font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥æŸ¥æ‰¾æ°´çš„è§’åº¦ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateOpenWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { Vector3 c1 = center + HexMetrics.GetFirstWaterCorner(direction); Vector3 c2 = center + HexMetrics.GetSecondWaterCorner(direction); â€¦ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWaterShore</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { EdgeVertices e1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( center + HexMetrics.GetFirstWaterCorner(direction), center + HexMetrics.GetSecondWaterCorner(direction) ); â€¦ }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/123/b85/fcf/123b85fcffde7ae313f177f76f882ef5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨æ°´è§’ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®é™…ä¸Šï¼Œæ°´çš„å…­è¾¹å½¢ä¹‹é—´çš„è·ç¦»å¢åŠ äº†ä¸€å€ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨</font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®ƒä¹Ÿåº”è¯¥æœ‰ä¸€ç§åœ¨æ°´ä¸­å»ºç«‹æ¡¥æ¢çš„æ–¹æ³•ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> waterBlendFactor = <span class="hljs-number"><span class="hljs-number">1f</span></span> - waterFactor; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetWaterBridge</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (corners[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction] + corners[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction + <span class="hljs-number"><span class="hljs-number">1</span></span>]) * waterBlendFactor; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿›è¡Œæ›´æ”¹ï¼Œ</font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä¾¿ä»–ä½¿ç”¨æ–°æ–¹æ³•ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateOpenWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.SE &amp;&amp; neighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Vector3 bridge = HexMetrics.GetWaterBridge(direction); â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.E) { â€¦ water.AddTriangle( c2, e2, c2 + HexMetrics.GetWaterBridge(direction.Next()) ); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWaterShore</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { â€¦ Vector3 bridge = HexMetrics.GetWaterBridge(direction); â€¦ HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextNeighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { waterShore.AddTriangle( e1.v5, e2.v5, e1.v5 + HexMetrics.GetWaterBridge(direction.Next()) ); â€¦ } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/99b/756/1fa/99b7561fad8556733ea1f10b2dcdd233.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ°´ä¸­çš„é•¿æ¡¥ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åœ¨æ°´é™†ä¹‹é—´ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°½ç®¡è¿™ä¸ºæˆ‘ä»¬æä¾›äº†æ›´å¤šçš„æ³¡æ²«ç©ºé—´ï¼Œä½†åœ¨æµ®é›•ä¸‹éšè—äº†æ›´å¤šçš„ç©ºé—´ã€‚</font><font style="vertical-align: inherit;">ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿåœ¨æ°´ä¾§ä½¿ç”¨æ°´è‚‹ï¼Œåœ¨é™†ä¾§ä½¿ç”¨è‚‹æ°´è‚‹ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬ä»æ°´çš„è§’è½å¼€å§‹ï¼Œæˆ‘ä»¬å°†æ— æ³•ä½¿ç”¨ç®€å•çš„æ¡¥æ¢æ¥æ‰¾åˆ°åœŸåœ°çš„ç›¸å¯¹è¾¹ç¼˜ã€‚</font><font style="vertical-align: inherit;">ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥ä»é‚»å±…çš„ä¸­å¿ƒå‘ç›¸åçš„æ–¹å‘å‰è¿›ã€‚</font><font style="vertical-align: inherit;">æ›´æ”¹</font></font><code>TriangulateWaterShore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºä½¿ç”¨æ­¤æ–°æ–¹æ³•ã€‚</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Vector3 bridge = HexMetrics.GetWaterBridge(direction); Vector3 center2 = neighbor.Position; center2.y = center.y; EdgeVertices e2 = new EdgeVertices( center2 + HexMetrics.GetSecondSolidCorner(direction.Opposite()), center2 + HexMetrics.GetFirstSolidCorner(direction.Opposite()) ); â€¦ HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); if (nextNeighbor != null) { Vector3 center3 = nextNeighbor.Position; center3.y = center.y; waterShore.AddTriangle( e1.v5, e2.v5, center3 + HexMetrics.GetFirstSolidCorner(direction.Previous()) ); â€¦ }</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b29/3f2/01f/b293f201f065b7921f1098484e3b725d.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¾¹è§’é”™è¯¯ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™è¡Œä¹‹æœ‰æ•ˆï¼Œåªæ˜¯ç°åœ¨æˆ‘ä»¬å†æ¬¡éœ€è¦è€ƒè™‘è§’åº¦ä¸‰è§’å½¢çš„ä¸¤ç§æƒ…å†µã€‚</font></font><br><br><pre> <code class="cs hljs"> HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextNeighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// Vector3 center3 = nextNeighbor.Position; // center3.y = center.y; Vector3 v3 = nextNeighbor.Position + (nextNeighbor.IsUnderwater ? HexMetrics.GetFirstWaterCorner(direction.Previous()) : HexMetrics.GetFirstSolidCorner(direction.Previous())); v3.y = center.y; waterShore.AddTriangle(e1.v5, e2.v5, v3); waterShore.AddTriangleUV( new Vector2(0f, 0f), new Vector2(0f, 1f), new Vector2(0f, nextNeighbor.IsUnderwater ? 0f : 1f) ); }</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4e1/f64/db1/4e1f64db1a34a8e6cff0f402f5fc6bd8.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¾¹ç¼˜çš„æ­£ç¡®è§’ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™ç§æ–¹æ³•æ•ˆæœå¾ˆå¥½ï¼Œä½†æ˜¯ç°åœ¨å¤§å¤šæ•°æ³¡æ²«å¯è§ï¼Œå› æ­¤å˜å¾—éå¸¸æ˜æ˜¾ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†å¼¥è¡¥è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†é€šè¿‡å‡å°‘ç€è‰²å™¨ä¸­çš„æƒ¯æ€§è¿åŠ¨å€¼çš„æ¯”ä¾‹æ¥ä½¿æ•ˆæœå˜å¼±ã€‚</font></font><br><br><pre> <code class="hljs lisp"> shore = sqrt(<span class="hljs-name"><span class="hljs-name">shore</span></span>) * <span class="hljs-number"><span class="hljs-number">0.9</span></span><span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡†å¤‡å¥½çš„æ³¡æ²«ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æµ·åº•æ²³æµ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€ç»ˆï¼Œæˆ‘ä»¬è‡³å°‘åœ¨æ²¡æœ‰æ²³æµæµå…¥çš„åœ°æ–¹å–äº†æ°´ã€‚</font><font style="vertical-align: inherit;">ç”±äºæ°´å’Œæ²³æµå°šæœªç›¸äº’æ³¨æ„åˆ°ï¼Œå› æ­¤æ²³æµå°†åœ¨æ°´ä¸­æµåŠ¨ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/051/1ee/bc5/0511eebc5420c9203475b65ce5c478b3.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²³æµåœ¨æ°´ä¸­æµåŠ¨ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¸²æŸ“åŠé€æ˜å¯¹è±¡çš„é¡ºåºå–å†³äºå®ƒä»¬ä¸ç›¸æœºçš„è·ç¦»ã€‚</font><font style="vertical-align: inherit;">æœ€è¿‘çš„å¯¹è±¡æœ€åæ¸²æŸ“ï¼Œå› æ­¤å®ƒä»¬åœ¨é¡¶éƒ¨ã€‚</font><font style="vertical-align: inherit;">ç§»åŠ¨ç›¸æœºæ—¶ï¼Œè¿™æ„å‘³ç€æœ‰æ—¶æ²³æµå’Œæ°´æœ‰æ—¶ä¼šå½¼æ­¤å ç½®ã€‚</font><font style="vertical-align: inherit;">é¦–å…ˆï¼Œä½¿æ¸²æŸ“é¡ºåºæ’å®šã€‚</font><font style="vertical-align: inherit;">å¿…é¡»åœ¨æ°´é¢ä¸Šç»˜åˆ¶æ²³æµï¼Œä»¥ä¾¿æ­£ç¡®æ˜¾ç¤ºç€‘å¸ƒã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡æ›´æ”¹</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">River</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç€è‰²å™¨çš„é˜Ÿåˆ—æ¥å®ç°</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="hljs objectivec"> Tags { <span class="hljs-string"><span class="hljs-string">"RenderType"</span></span>=<span class="hljs-string"><span class="hljs-string">"Transparent"</span></span> <span class="hljs-string"><span class="hljs-string">"Queue"</span></span>=<span class="hljs-string"><span class="hljs-string">"Transparent+1"</span></span> }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4bc/74e/d91/4bc74ed9179598f5b9e82c3ff0cde851.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬æœ€åç”»äº†æ²³ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> éšè—æ°´ä¸‹æ²³ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°½ç®¡æ²³åºŠå¾ˆå¯èƒ½åœ¨æ°´ä¸‹ï¼Œå¹¶ä¸”æ°´å®é™…ä¸Šå¯ä»¥æµè¿‡æ²³æ°´ï¼Œä½†æˆ‘ä»¬ä¸åº”çœ‹åˆ°è¿™ç§æ°´ã€‚</font><font style="vertical-align: inherit;">æ›´é‡è¦çš„æ˜¯ï¼Œä¸åº”å°†å…¶æ¸²æŸ“åœ¨çœŸå®çš„æ°´é¢ä¹‹ä¸Šã€‚</font><font style="vertical-align: inherit;">ä»…å½“å½“å‰å•å…ƒæ ¼ä¸åœ¨æ°´ä¸‹æ—¶ï¼Œæ‰å¯ä»¥é€šè¿‡æ·»åŠ æ²³æ®µæ¥æ‘†è„±æµ·åº•æ²³æµçš„æ°´ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithRiverBeginOrEnd</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> reversed = cell.HasIncomingRiver; â€¦ } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> reversed = cell.IncomingRiver == direction; â€¦ } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦</font></font><code>TriangulateConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¼€å§‹ï¼Œå°†å¢åŠ æ²³æµçš„éƒ¨åˆ†ï¼Œå½“æ²¡æœ‰ç”µæµï¼Œæ²¡æœ‰ç›¸é‚»å°åŒºä¸æ˜¯åœ¨æ°´ä¸­ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction)) { e2.v3.y = neighbor.StreamBedY; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !neighbor.IsUnderwater) { TriangulateRiverQuad( e1.v2, e1.v4, e2.v2, e2.v4, cell.RiverSurfaceY, neighbor.RiverSurfaceY, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>, cell.HasIncomingRiver &amp;&amp; cell.IncomingRiver == direction ); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/899/0c7/cf6/8990c7cf6af7bf25596b4ffc05204817.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²¡æœ‰æ›´å¤šçš„æ°´ä¸‹æ²³æµã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç€‘å¸ƒ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸å†æœ‰æ°´ä¸‹æ²³ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬åœ¨æ²³ä¸æ°´é¢ç›¸é‡çš„é‚£äº›åœ°æ–¹å¼€äº†å­”ã€‚ä¸æ°´ä½ç›¸åŒçš„æ²³æµä¼šå½¢æˆå°æ´æˆ–è¦†ç›–å±‚ã€‚ä½†æ˜¯æœ€å¼•äººæ³¨ç›®çš„æ˜¯ä»æ›´é«˜çš„é«˜åº¦æµå‡ºçš„æ²³æµç¼ºå°‘çš„ç€‘å¸ƒã€‚è®©æˆ‘ä»¬å…ˆç…§é¡¾ä»–ä»¬ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€æ¡å¸¦æœ‰ç€‘å¸ƒçš„æ²³æ®µï¼Œç”¨äºç©¿è¿‡æ°´é¢ã€‚ç»“æœï¼Œä»–å‘ç°è‡ªå·±éƒ¨åˆ†åœ¨æ°´ä¸Šï¼Œéƒ¨åˆ†åœ¨æ°´ä¸‹ã€‚æˆ‘ä»¬éœ€è¦ä¿æŒä¸€éƒ¨åˆ†é«˜äºæ°´ä½ï¼Œä¸¢å¼ƒå…¶ä»–æ‰€æœ‰ä¸œè¥¿ã€‚æ‚¨å°†ä¸ºæ­¤è€ŒåŠªåŠ›ï¼Œå› æ­¤è¯·åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„æ–¹æ³•ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–°æ–¹æ³•éœ€è¦å››ä¸ªå³°å€¼ï¼Œä¸¤ä¸ªæ²³æµæ°´ä½å’Œä¸€ä¸ªæ°´ä½ã€‚æˆ‘ä»¬å°†å¯¹å…¶è¿›è¡Œè®¾ç½®ï¼Œä»¥ä½¿æˆ‘ä»¬æœç€ç€‘å¸ƒä¸‹æ–¹çš„æ°´æµæ–¹å‘çœ‹ã€‚å› æ­¤ï¼Œå‰ä¸¤ä¸ªå³°å’Œå·¦ä¾§å’Œå³ä¾§å°†åœ¨é¡¶éƒ¨ï¼Œè€Œè¾ƒä½çš„å³°å°†è·Ÿéšã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWaterfallInWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> waterY </span></span></span><span class="hljs-function">)</span></span> { v1.y = v2.y = y1; v3.y = v4.y = y2; rivers.AddQuad(v1, v2, v3, v4); rivers.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"></font><code>TriangulateConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“é‚»å±…åœ¨æ°´ä¸‹å¹¶åˆ›å»ºç€‘å¸ƒæ—¶ï¼Œ</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†è°ƒç”¨æ­¤æ–¹æ³•</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!neighbor.IsUnderwater) { TriangulateRiverQuad( e1.v2, e1.v4, e2.v2, e2.v4, cell.RiverSurfaceY, neighbor.RiverSurfaceY, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>, cell.HasIncomingRiver &amp;&amp; cell.IncomingRiver == direction ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.Elevation &gt; neighbor.WaterLevel) { TriangulateWaterfallInWater( e1.v2, e1.v4, e2.v2, e2.v4, cell.RiverSurfaceY, neighbor.RiverSurfaceY, neighbor.WaterSurfaceY ); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å½“å½“å‰å•å…ƒæ ¼åœ¨æ°´ä¸‹ï¼Œè€Œä¸‹ä¸€ä¸ªä¸åœ¨æ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä»¥ç›¸åçš„æ–¹å‘å¤„ç†ç€‘å¸ƒã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater) { â€¦ } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !neighbor.IsUnderwater &amp;&amp; neighbor.Elevation &gt; cell.WaterLevel ) { TriangulateWaterfallInWater( e2.v4, e2.v2, e1.v4, e1.v2, neighbor.RiverSurfaceY, cell.RiverSurfaceY, cell.WaterSurfaceY ); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å†æ¬¡å¾—åˆ°äº†åŸå§‹æ²³çš„å››è¾¹å½¢ã€‚</font><font style="vertical-align: inherit;">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œæ›´æ”¹ï¼Œ</font></font><code>TriangulateWaterfallInWater</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä¾¿å°†è¾ƒä½çš„å³°å‡é«˜åˆ°æ°´ä½ã€‚</font><font style="vertical-align: inherit;">ä¸å¹¸çš„æ˜¯ï¼Œä»…æ›´æ”¹Yåæ ‡æ˜¯ä¸å¤Ÿçš„ã€‚</font><font style="vertical-align: inherit;">è¿™å¯ä»¥å°†ç€‘å¸ƒä»æ‚¬å´–ä¸Šæ¨å¼€ï¼Œå¯èƒ½å½¢æˆæ´ã€‚</font><font style="vertical-align: inherit;">ç›¸åï¼Œæ‚¨å¿…é¡»ä½¿ç”¨æ’å€¼å°†è¾ƒä½çš„é¡¶ç‚¹ç§»åŠ¨åˆ°è¾ƒé«˜çš„é¡¶ç‚¹ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/942/11b/250/94211b250d95b614a5d6be6ff52c9e9e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ’å€¼ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦å‘ä¸Šç§»åŠ¨è¾ƒä½çš„å³°ï¼Œè¯·å°†å…¶åœ¨æ°´é¢ä»¥ä¸‹çš„è·ç¦»é™¤ä»¥ç€‘å¸ƒçš„é«˜åº¦ã€‚</font><font style="vertical-align: inherit;">è¿™å°†ä¸ºæˆ‘ä»¬æä¾›å†…æ’å™¨å€¼ã€‚</font></font><br><br><pre> <code class="cs hljs"> v1.y = v2.y = y1; v3.y = v4.y = y2; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> t = (waterY - y2) / (y1 - y2); v3 = Vector3.Lerp(v3, v1, t); v4 = Vector3.Lerp(v4, v2, t); rivers.AddQuad(v1, v2, v3, v4); rivers.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»“æœï¼Œæˆ‘ä»¬å¾—åˆ°äº†å…·æœ‰ç›¸åŒæ–¹å‘çš„ç¼©çŸ­çš„ç€‘å¸ƒã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œç”±äºä¸‹é¡¶ç‚¹çš„ä½ç½®å·²æ›´æ”¹ï¼Œå› æ­¤å®ƒä»¬ä¸ä¼šåƒåŸå§‹é¡¶ç‚¹ä¸€æ ·å˜å½¢ã€‚</font><font style="vertical-align: inherit;">è¿™æ„å‘³ç€æœ€ç»ˆç»“æœä»å°†ä¸åŸå§‹ç€‘å¸ƒä¸ä¸€è‡´ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ’å€¼ä¹‹å‰æ‰‹åŠ¨æ‰­æ›²é¡¶ç‚¹ï¼Œç„¶åæ·»åŠ æœªæ‰­æ›²çš„å››è¾¹å½¢ã€‚</font></font><br><br><pre> <code class="cs hljs"> v1.y = v2.y = y1; v3.y = v4.y = y2; v1 = HexMetrics.Perturb(v1); v2 = HexMetrics.Perturb(v2); v3 = HexMetrics.Perturb(v3); v4 = HexMetrics.Perturb(v4); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> t = (waterY - y2) / (y1 - y2); v3 = Vector3.Lerp(v3, v1, t); v4 = Vector3.Lerp(v4, v2, t); rivers.AddQuadUnperturbed(v1, v2, v3, v4); rivers.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬å·²ç»æœ‰äº†æ·»åŠ ä¸å˜å½¢ä¸‰è§’å½¢çš„æ–¹æ³•ï¼Œå› æ­¤æˆ‘ä»¬å®é™…ä¸Šä¸éœ€è¦ä¸ºå››è¾¹å½¢åˆ›å»ºä¸€ä¸ªã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬æ·»åŠ äº†å¿…è¦çš„æ–¹æ³•</font></font><code>HexMesh.AddQuadUnperturbed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddQuadUnperturbed</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4 </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vertexIndex = vertices.Count; vertices.Add(v1); vertices.Add(v2); vertices.Add(v3); vertices.Add(v4); triangles.Add(vertexIndex); triangles.Add(vertexIndex + <span class="hljs-number"><span class="hljs-number">2</span></span>); triangles.Add(vertexIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>); triangles.Add(vertexIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>); triangles.Add(vertexIndex + <span class="hljs-number"><span class="hljs-number">2</span></span>); triangles.Add(vertexIndex + <span class="hljs-number"><span class="hljs-number">3</span></span>); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dc4/605/bdd/dc4605bdd24ed9460b0ca3a310a11fb5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç€‘å¸ƒç»ˆæ­¢äºæ°´é¢ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ²³å£ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“æ²³æµä»¥ä¸æ°´é¢ç›¸åŒçš„é«˜åº¦æµåŠ¨æ—¶ï¼Œæ²³æµç½‘ä¼šè§¦åŠæ²¿æµ·ç½‘ã€‚å¦‚æœå®ƒæ˜¯ä¸€æ¡æµå…¥å¤§æµ·æˆ–æµ·æ´‹çš„æ²³æµï¼Œé‚£æ¡æ²³å°†ä¸æµ·æµªç›¸é‡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ç§°æ­¤ç±»åŒºåŸŸä¸ºæ²³å£ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ddd/27b/efa/ddd27befa12ec543e2969505365b0d91.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™æ¡æ²³ä¸æµ·å²¸äº¤æ±‡è€Œä¸ä¼šæ‰­æ›²å±±å³°ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬çš„å˜´å·´æœ‰ä¸¤ä¸ªé—®é¢˜ã€‚é¦–å…ˆï¼Œå››è§’æ²³è¿æ¥äº†æ’éª¨çš„ç¬¬äºŒå’Œç¬¬å››é¡¶éƒ¨ï¼Œè·³è¿‡äº†ç¬¬ä¸‰ã€‚ç”±äºæ°´çš„æµ·å²¸ä¸ä½¿ç”¨ç¬¬ä¸‰ä¸ªå³°ï¼Œå› æ­¤å¯èƒ½ä¼šå½¢æˆä¸€ä¸ªæ´æˆ–é‡å ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ›´æ”¹å˜´çš„å‡ ä½•å½¢çŠ¶æ¥è§£å†³æ­¤é—®é¢˜ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬äºŒä¸ªé—®é¢˜æ˜¯æ³¡æ²«å’Œæ²³æµææ–™ä¹‹é—´å­˜åœ¨æ€¥å‰§çš„è¿‡æ¸¡ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å¦ä¸€ç§å¯ä»¥å°†æ²³æµå’Œæ°´çš„å½±å“æ··åˆåœ¨ä¸€èµ·çš„ææ–™ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™æ„å‘³ç€å˜´éœ€è¦ä¸€ç§ç‰¹æ®Šçš„æ–¹æ³•ï¼Œå› æ­¤è®©æˆ‘ä»¬ä¸ºå®ƒä»¬åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„æ–¹æ³•ã€‚</font></font><code>TriangulateWaterShore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“æœ‰æ²³æµæ²¿å½“å‰æ–¹å‘è¡Œé©¶æ—¶</font><font style="vertical-align: inherit;">ï¼Œåº”è°ƒç”¨å®ƒ</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWaterShore</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction)) { TriangulateEstuary(e1, e2); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { waterShore.AddQuad(e1.v1, e1.v2, e2.v1, e2.v2); waterShore.AddQuad(e1.v2, e1.v3, e2.v2, e2.v3); waterShore.AddQuad(e1.v3, e1.v4, e2.v3, e2.v4); waterShore.AddQuad(e1.v4, e1.v5, e2.v4, e2.v5); waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); } â€¦ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEstuary</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EdgeVertices e1, EdgeVertices e2</span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸éœ€è¦æ··åˆä¸¤ç§æ•ˆæœçš„åŒºåŸŸæ¥å¡«å……æ•´ä¸ªæ¡å¸¦ã€‚</font><font style="vertical-align: inherit;">æ¢¯å½¢è¶³ä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€è¦ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¾§é¢ä½¿ç”¨ä¸¤ä¸ªæ²¿æµ·ä¸‰è§’å½¢ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEstuary</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EdgeVertices e1, EdgeVertices e2</span></span></span><span class="hljs-function">)</span></span> { waterShore.AddTriangle(e2.v1, e1.v2, e1.v1); waterShore.AddTriangle(e2.v5, e1.v5, e1.v4); waterShore.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); waterShore.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ece/ca1/fc9/ececa1fc9852f7350a54e00fa71df0b3.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¢¯å½¢å­”ä¸ºæ··åˆåŒºåŸŸã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> UV2åæ ‡ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦åˆ›å»ºæ²³æµæ•ˆæœï¼Œæˆ‘ä»¬éœ€è¦UVåæ ‡ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯è¦åˆ›å»ºæ³¡æ²«æ•ˆæœï¼Œè¿˜éœ€è¦UVåæ ‡ã€‚</font><font style="vertical-align: inherit;">ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ··åˆå®ƒä»¬æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ç»„UVåæ ‡ã€‚</font><font style="vertical-align: inherit;">å¹¸è¿çš„æ˜¯ï¼ŒUnityå¼•æ“ç½‘æ ¼ç‰©ä½“æœ€å¤šå¯ä»¥æ”¯æŒå››ä¸ªUVé›†ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬åªéœ€è¦æ·»åŠ </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹ç¬¬äºŒç»„çš„æ”¯æŒå³å¯ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> useCollider, useColors, useUVCoordinates, useUV2Coordinates; [NonSerialized] List&lt;Vector2&gt; uvs, uv2s; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useUVCoordinates) { uvs = ListPool&lt;Vector2&gt;.Get(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useUV2Coordinates) { uv2s = ListPool&lt;Vector2&gt;.Get(); } triangles = ListPool&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.Get(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Apply</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useUVCoordinates) { hexMesh.SetUVs(<span class="hljs-number"><span class="hljs-number">0</span></span>, uvs); ListPool&lt;Vector2&gt;.Add(uvs); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useUV2Coordinates) { hexMesh.SetUVs(<span class="hljs-number"><span class="hljs-number">1</span></span>, uv2s); ListPool&lt;Vector2&gt;.Add(uv2s); } â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è¦æ·»åŠ ç¬¬äºŒç»„UVï¼Œæˆ‘ä»¬å¤åˆ¶ä½¿ç”¨UVçš„æ–¹æ³•å¹¶æ›´æ”¹æ‰€éœ€çš„æ–¹å¼ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddTriangleUV2</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector2 uv1, Vector2 uv2, Vector3 uv3</span></span></span><span class="hljs-function">)</span></span> { uv2s.Add(uv1); uv2s.Add(uv2); uv2s.Add(uv3); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddQuadUV2</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector2 uv1, Vector2 uv2, Vector3 uv3, Vector3 uv4</span></span></span><span class="hljs-function">)</span></span> { uv2s.Add(uv1); uv2s.Add(uv2); uv2s.Add(uv3); uv2s.Add(uv4); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddQuadUV2</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> uMin, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> uMax, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> vMin, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> vMax</span></span></span><span class="hljs-function">)</span></span> { uv2s.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(uMin, vMin)); uv2s.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(uMax, vMin)); uv2s.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(uMin, vMax)); uv2s.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(uMax, vMax)); }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ²³æ˜æš—å™¨åŠŸèƒ½ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬å°†åœ¨ä¸¤ä¸ªç€è‰²å™¨ä¸­ä½¿ç”¨riveræ•ˆæœï¼Œå› æ­¤å°†ä»£ç ä»</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">River</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç€è‰²å™¨ç§»åŠ¨</font><font style="vertical-align: inherit;">åˆ°æ–°çš„</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Water</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> include fileå‡½æ•°</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">float</span></span> River (float2 riverUV, sampler2D noiseTex) { float2 uv = riverUV; uv.x = uv.x * <span class="hljs-number"><span class="hljs-number">0.0625</span></span> + _Time.y * <span class="hljs-number"><span class="hljs-number">0.005</span></span>; uv.y -= _Time.y * <span class="hljs-number"><span class="hljs-number">0.25</span></span>; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(noiseTex, uv); float2 uv2 = riverUV; uv2.x = uv2.x * <span class="hljs-number"><span class="hljs-number">0.0625</span></span> - _Time.y * <span class="hljs-number"><span class="hljs-number">0.0052</span></span>; uv2.y -= _Time.y * <span class="hljs-number"><span class="hljs-number">0.23</span></span>; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise2 = tex2D(noiseTex, uv2); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> noise.x * noise2.w; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›´æ”¹</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">River</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç€è‰²å™¨</font><font style="vertical-align: inherit;">ä»¥ä½¿ç”¨æ­¤æ–°åŠŸèƒ½ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "Water.cginc" sampler2D _MainTex; â€¦ <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { <span class="hljs-type"><span class="hljs-type">float</span></span> river = River(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex, _MainTex); fixed4 c = saturate(_Color + river); â€¦ }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å£å¯¹è±¡ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·»åŠ </font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å˜´</font><font style="vertical-align: inherit;">ä»¥</font><font style="vertical-align: inherit;">æ”¯æ’‘ç½‘æ ¼ç‰©ä½“ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexMesh terrain, rivers, roads, water, waterShore, estuaries; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { terrain.Clear(); rivers.Clear(); roads.Clear(); water.Clear(); waterShore.Clear(); estuaries.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Length; i++) { Triangulate(cells[i]); } terrain.Apply(); rivers.Apply(); roads.Apply(); water.Apply(); waterShore.Apply(); estuaries.Apply(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ›å»ºç€è‰²å™¨ï¼Œæè´¨å’Œå˜´å·´å¯¹è±¡ï¼Œå¤åˆ¶æµ·å²¸å¹¶è¿›è¡Œæ›´æ”¹ã€‚</font><font style="vertical-align: inherit;">å°†å…¶è¿æ¥åˆ°ç‰‡æ®µï¼Œå¹¶ä½¿å…¶ä½¿ç”¨UVå’ŒUV2åæ ‡ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/540/77a/7fc/54077a7fc8653228cd723ca855330fed.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹è±¡æ²³å£ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å£ä¸‰è§’å‰–åˆ† </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨æ²³çš„æœ«ç«¯å’Œæ°´çš„è¾¹ç¼˜çš„ä¸­é—´æ”¾ç½®ä¸€ä¸ªä¸‰è§’å½¢æ¥è§£å†³å­”æ´æˆ–é‡å çš„é—®é¢˜ã€‚</font><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬çš„å˜´éƒ¨ç€è‰²å™¨æ˜¯æµ·å²¸ç€è‰²å™¨çš„å‰¯æœ¬ï¼Œå› æ­¤æˆ‘ä»¬è®¾ç½®UVåæ ‡ä»¥åŒ¹é…æ³¡æ²«æ•ˆæœã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEstuary</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EdgeVertices e1, EdgeVertices e2</span></span></span><span class="hljs-function">)</span></span> { â€¦ estuaries.AddTriangle(e1.v3, e2.v2, e2.v4); estuaries.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) ); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f02/bb6/f76/f02bb6f768f915d39c05296055cc0b83.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸­é—´ä¸‰è§’å½¢ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ä¸­é—´ä¸‰è§’å½¢çš„ä¸¤ä¾§æ·»åŠ ä¸€ä¸ªå››è¾¹å½¢æ¥å¡«å……æ•´ä¸ªæ¢¯å½¢ã€‚</font></font><br><br><pre> <code class="cs hljs"> estuaries.AddQuad(e1.v2, e1.v3, e2.v1, e2.v2); estuaries.AddTriangle(e1.v3, e2.v2, e2.v4); estuaries.AddQuad(e1.v3, e1.v4, e2.v4, e2.v5); estuaries.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); estuaries.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) ); estuaries.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ef2/672/e7e/ef2672e7e62b9d66463e4fc44dc43b7a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡†å¤‡å¥½æ¢¯å½¢ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å°†å››è¾¹å½¢æ–¹å‘å‘å·¦æ—‹è½¬ï¼Œä½¿å…¶å¯¹è§’çº¿è¿æ¥ç¼©çŸ­ï¼Œç»“æœæˆ‘ä»¬å¾—åˆ°å¯¹ç§°çš„å‡ ä½•å½¢çŠ¶ã€‚</font></font><br><br><pre> <code class="cs hljs"> estuaries.AddQuad(e2.v1, e1.v2, e2.v2, e1.v3); estuaries.AddTriangle(e1.v3, e2.v2, e2.v4); estuaries.AddQuad(e1.v3, e1.v4, e2.v4, e2.v5); estuaries.AddQuadUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); <span class="hljs-comment"><span class="hljs-comment">// estuaries.AddQuadUV(0f, 0f, 0f, 1f);</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cd5/dd0/7d1/cd5dd07d1b9f1fb8126e6a5a7c1bc29b.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ—‹è½¬å››è¾¹å½¢ï¼Œå¯¹ç§°å‡ ä½•</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ²³æ°´æµé‡ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†æ”¯æŒæ²³æµæ•ˆæœï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ UV2åæ ‡ã€‚</font><font style="vertical-align: inherit;">ä¸­é—´ä¸‰è§’å½¢çš„åº•éƒ¨åœ¨æ²³æµçš„ä¸­é—´ï¼Œå› æ­¤å…¶åæ ‡Uåº”è¯¥ç­‰äº0.5ã€‚</font><font style="vertical-align: inherit;">ç”±äºæ²³æµæ²¿æ°´çš„æ–¹å‘æµåŠ¨ï¼Œå› æ­¤å·¦ç‚¹æ¥æ”¶çš„Uåæ ‡ç­‰äº1ï¼Œå³ç‚¹æ¥æ”¶çš„Uåæ ‡å€¼ä¸º0ã€‚æˆ‘ä»¬å°†Yåæ ‡è®¾ç½®ä¸º0å’Œ1ï¼Œå¯¹åº”äºæ°´æµçš„æ–¹å‘ã€‚</font></font><br><br><pre> <code class="cs hljs"> estuaries.AddTriangleUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) );</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸‰è§’å½¢ä¸¤ä¾§çš„å››è¾¹å½¢åº”ä¸æ­¤æ–¹å‘ä¸€è‡´ã€‚</font><font style="vertical-align: inherit;">å¯¹äºè¶…è¿‡æ²³æµå®½åº¦çš„ç‚¹ï¼Œæˆ‘ä»¬ä¿æŒç›¸åŒçš„Uåæ ‡ã€‚</font></font><br><br><pre> <code class="cs hljs"> estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) ); estuaries.AddTriangleUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) );</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a98/475/d50/a98475d50fe84d16eeeff5397f6aa43f.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UV2æ¢¯å½¢ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºç¡®ä¿æ­£ç¡®è®¾ç½®UV2åæ ‡ï¼Œè¯·ä½¿</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estuary</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç€è‰²å™¨</font><font style="vertical-align: inherit;">æ¸²æŸ“å®ƒä»¬ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ åˆ°è¾“å…¥ç»“æ„ä¸­æ¥è®¿é—®è¿™äº›åæ ‡</font></font><code>float2 uv2_MainTex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; float2 uv2_MainTex; float3 worldPos; }; â€¦ <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { <span class="hljs-type"><span class="hljs-type">float</span></span> shore = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y; <span class="hljs-type"><span class="hljs-type">float</span></span> foam = Foam(shore, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz, _MainTex); <span class="hljs-type"><span class="hljs-type">float</span></span> waves = Waves(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz, _MainTex); waves *= <span class="hljs-number"><span class="hljs-number">1</span></span> - shore; fixed4 c = fixed4(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv2_MainTex, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); â€¦ }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/efd/416/d95/efd416d95c7827f264f2f0e8360e6fde.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UV2åæ ‡ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€åˆ‡çœ‹èµ·æ¥éƒ½ä¸é”™ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç€è‰²å™¨åˆ›å»ºæ²³æµæ•ˆæœã€‚</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { â€¦ <span class="hljs-type"><span class="hljs-type">float</span></span> river = River(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv2_MainTex, _MainTex); fixed4 c = saturate(_Color + river); â€¦ }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0e3/2c9/fda/0e32c9fda58b356534c2070d0b74adae.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨UV2åˆ›å»ºæ²³æµæ•ˆæœã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä»¥å¦‚ä¸‹æ–¹å¼åˆ›å»ºæ²³æµï¼šåœ¨å¯¹å•å…ƒæ ¼ä¹‹é—´çš„è¿æ¥è¿›è¡Œä¸‰è§’æµ‹é‡æ—¶ï¼ŒVæ²³çš„åæ ‡ä»0.8æ›´æ”¹ä¸º1ã€‚å› æ­¤ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¹Ÿåº”è¯¥ä½¿ç”¨æ­¤é—´éš”ï¼Œè€Œä¸æ˜¯ä»0åˆ°1ã€‚ä½†æ˜¯ï¼Œæ²¿æµ·è¿æ¥æ¯”æ™®é€šå•å…ƒè¿æ¥å¤š50ï¼… ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œä¸ºäº†æœ€é€‚åˆæ²³é“ï¼Œæˆ‘ä»¬å¿…é¡»å°†å€¼ä»0.8æ›´æ”¹ä¸º1.1ã€‚</font></font><br><br><pre> <code class="cs hljs"> estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>) ); estuaries.AddTriangleUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>) ); estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>) );</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/27d/beb/7c6/27dbeb7c67553163422fd560e64ddb03.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b0c/4d9/2e3/b0c4d92e3797274e2534a6921334d184.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²³æµä¸æ²³å£åŒæ­¥æµåŠ¨ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æµé‡è®¾å®š </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“æ²³æ°´åœ¨ä¸€æ¡ç›´çº¿ä¸Šç§»åŠ¨æ—¶ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå½“æ°´æµå…¥æ›´å¤§çš„åŒºåŸŸæ—¶ï¼Œå®ƒä¼šè†¨èƒ€ã€‚</font><font style="vertical-align: inherit;">ç”µæµå°†å¼¯æ›²ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡æŠ˜å UV2åæ ‡æ¥æ¨¡æ‹Ÿè¿™ä¸€ç‚¹ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸è¦å°†ä¸ŠUåæ ‡åœ¨æ²³çš„å®½åº¦ä¹‹å¤–ä¿æŒæ’å®šï¼Œè€Œæ˜¯å°†å®ƒä»¬ç§»åŠ¨0.5ã€‚</font><font style="vertical-align: inherit;">æœ€å·¦è¾¹çš„ç‚¹æ˜¯1.5ï¼Œæœ€å³è¾¹çš„æ˜¯-0.5ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒæ—¶ï¼Œæˆ‘ä»¬é€šè¿‡ç§»åŠ¨å·¦å³åº•ç‚¹çš„Uåæ ‡æ¥æ‰©å±•æµç¨‹ã€‚</font><font style="vertical-align: inherit;">å°†å·¦ä¸€ä¸ªä»1æ›´æ”¹ä¸º0.7ï¼Œå³ä¸€ä¸ªä»0æ›´æ”¹ä¸º0.3ã€‚</font></font><br><br><pre> <code class="cs hljs"> estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1.5f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.7f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>) ); â€¦ estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.3f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">-0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>) );</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/850/99d/976/85099d97610434a630621e9e06f885ad.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0c1/567/f72/0c1567f72c979734719b298c7850b59e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰©æ²³ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦å®Œæˆæ›²ç‡æ•ˆæœï¼Œè¯·æ›´æ”¹ç›¸åŒå››ä¸ªç‚¹çš„Våæ ‡ã€‚</font><font style="vertical-align: inherit;">ç”±äºæ°´ä»æ²³çš„æœ«ç«¯æµèµ°ï¼Œå› æ­¤æˆ‘ä»¬å°†è¾ƒé«˜ç‚¹çš„Våæ ‡å¢åŠ åˆ°1ã€‚ä¸ºåˆ›å»ºæ›´å¥½çš„æ›²çº¿ï¼Œæˆ‘ä»¬å°†è¾ƒä½ä¸¤ä¸ªç‚¹çš„Våæ ‡å¢åŠ åˆ°1.15ã€‚</font></font><br><br><pre> <code class="cs hljs"> estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.7f</span></span>, <span class="hljs-number"><span class="hljs-number">1.15f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>) ); estuaries.AddTriangleUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>) ); estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.3f</span></span>, <span class="hljs-number"><span class="hljs-number">1.15f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">-0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) );</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1fa/86d/320/1fa86d32037da7fab579ce9a195d1e71.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b07/edb/dfe/b07edbdfeb3615b1a597712a6bda5c8e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™æ¡æ²³çš„å¼¯é“ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ²³æµå’Œæµ·å²¸æ··åˆ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å‰©ä¸‹çš„å°±æ˜¯å°†æµ·å²¸å’Œæ²³æµçš„å½±å“æ··åˆåœ¨ä¸€èµ·ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨çº¿æ€§æ’å€¼ï¼Œå°†æƒ¯æ€§è¿åŠ¨å€¼ç”¨ä½œæ’å€¼å™¨ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float</span></span> shoreWater = max(foam, waves); <span class="hljs-type"><span class="hljs-type">float</span></span> river = River(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv2_MainTex, _MainTex); <span class="hljs-type"><span class="hljs-type">float</span></span> water = lerp(shoreWater, river, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.x); fixed4 c = saturate(_Color + water);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°½ç®¡è¿™åº”è¯¥å¯è¡Œï¼Œä½†æ˜¯æ‚¨å¯èƒ½ä¼šé‡åˆ°ç¼–è¯‘é”™è¯¯ã€‚</font><font style="vertical-align: inherit;">ç¼–è¯‘å™¨æŠ±æ€¨é‡æ–°å®šä¹‰</font></font><code>_MainTex_ST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">åŸå› æ˜¯ç”±äºåŒæ—¶ä½¿ç”¨</font></font><code>uv_MainTex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font><font style="vertical-align: inherit;">å¼•èµ·çš„Unityè¡¨é¢ç€è‰²å™¨ç¼–è¯‘å™¨å†…éƒ¨é”™è¯¯</font></font><code>uv2_MainTex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ç§è§£å†³æ–¹æ³•ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è€Œä¸æ˜¯ä½¿ç”¨</font></font><code>uv2_MainTex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®ƒï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸æ‰‹åŠ¨ä¼ è¾“è¾…åŠ©UVåæ ‡ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œè¯·é‡å‘½å</font></font><code>uv2_MainTex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸º</font></font><code>riverUV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç„¶åå‘ç€è‰²å™¨æ·»åŠ ä¸€ä¸ªé¡¶ç‚¹å‡½æ•°ï¼Œè¯¥ç€è‰²å™¨ä¸ºå…¶æŒ‡å®šåæ ‡ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> #pragma surface surf Standard alpha vertex:vert â€¦ struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; float2 riverUV; float3 worldPos; }; â€¦ <span class="hljs-type"><span class="hljs-type">void</span></span> vert (<span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> o) { UNITY_INITIALIZE_OUTPUT(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>, o); o.riverUV = v.texcoord1.xy; } <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { â€¦ <span class="hljs-type"><span class="hljs-type">float</span></span> river = River(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.riverUV, _MainTex); â€¦ }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/904/b40/c98/904b40c98323b2e9f32bd16513344181.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŸºäºæµ·å²¸å€¼çš„æ’å€¼ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ’å€¼æœ‰æ•ˆï¼Œä½†é¡¶éƒ¨çš„å·¦ä¾§å’Œå³ä¾§é¡¶ç‚¹é™¤å¤–ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™äº›æ—¶å€™ï¼Œæ²³æµåº”è¯¥æ¶ˆå¤±äº†ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨æµ·å²¸çš„ä»·å€¼ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä¸å¾—ä¸ä½¿ç”¨ä¸€ä¸ªä¸åŒçš„å€¼ï¼Œåœ¨è¿™ä¸¤ä¸ªé¡¶ç‚¹å¤„çš„å€¼ä¸º0ã€‚å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬ä»ç„¶å…·æœ‰ç¬¬ä¸€ä¸ªUVé›†çš„Uåæ ‡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†å…¶å­˜å‚¨åœ¨é‚£é‡Œã€‚</font></font><br><br><pre> <code class="cs hljs"> estuaries.AddQuadUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); estuaries.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) ); estuaries.AddQuadUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) ); <span class="hljs-comment"><span class="hljs-comment">// estuaries.AddQuadUV(0f, 0f, 0f, 1f);</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b34/e93/432/b34e93432248fb7be818b53aca4d8b20.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­£ç¡®çš„æ­é…ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæ²³æ°´åœ¨ä¸æ–­æ‰©å¼ çš„æ²³æµï¼Œæ²¿æµ·æ°´åŸŸå’Œæ³¡æ²«ä¹‹é—´ç›¸äº’èåˆã€‚</font><font style="vertical-align: inherit;">å°½ç®¡è¿™å¹¶ä¸èƒ½ä¸ç€‘å¸ƒå®Œå…¨åŒ¹é…ï¼Œä½†æ˜¯è¿™ç§æ•ˆæœåœ¨ç€‘å¸ƒä¸­ä¹Ÿçœ‹èµ·æ¥ä¸é”™ã€‚</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"></font></i> <font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">å‡ºæµ·å£ç»Ÿä¸€</font></a><i><font style="vertical-align: inherit;">è¡ŒåŠ¨</font></i></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ¥è‡ªæ°´ä½“çš„æ²³æµ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å·²ç»æœ‰æ²³æµæµå…¥æ°´åŸŸï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ”¯æŒå‘ä¸åŒæ–¹å‘æµåŠ¨çš„æ²³æµã€‚</font><font style="vertical-align: inherit;">æœ‰æ²³æµä»é‚£é‡Œæµå‡ºçš„æ¹–æ³Šï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿéœ€è¦æ·»åŠ å®ƒä»¬ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“æ²³æµä»æ°´ä½“ä¸­æµå‡ºæ—¶ï¼Œå®ƒå®é™…ä¸Šä¼šæµå‘æ›´é«˜çš„é«˜åº¦ã€‚</font><font style="vertical-align: inherit;">ç›®å‰è¿™æ˜¯ä¸å¯èƒ½çš„ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ°´ä½ä¸ç›®æ ‡ç‚¹çš„é«˜åº¦ç›¸å¯¹åº”ï¼Œæˆ‘ä»¬éœ€è¦ä¾‹å¤–ï¼Œå¹¶å…è®¸è¿™ç§æƒ…å†µã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ª</font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§æœ‰æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ ¹æ®æˆ‘ä»¬çš„æ–°æ ‡å‡†æ£€æŸ¥é‚»å±…æ˜¯å¦æ˜¯æµå‡ºæ²³çš„æ­£ç¡®ç›®æ ‡ç‚¹ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsValidRiverDestination</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell neighbor</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> neighbor &amp;&amp; ( elevation &gt;= neighbor.elevation || waterLevel == neighbor.elevation ); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬å°†ä½¿ç”¨æ–°æ–¹æ³•æ¥ç¡®å®šæ˜¯å¦æœ‰å¯èƒ½åˆ›å»ºæµå‡ºçš„æ²³æµã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetOutgoingRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasOutgoingRiver &amp;&amp; outgoingRiver == direction) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } HexCell neighbor = GetNeighbor(direction); <span class="hljs-comment"><span class="hljs-comment">// if (!neighbor || elevation &lt; neighbor.elevation) { if (!IsValidRiverDestination(neighbor)) { return; } RemoveOutgoingRiver(); â€¦ }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦å¤–ï¼Œåœ¨æ›´æ”¹å•å…ƒæ ¼æˆ–æ°´ä½çš„é«˜åº¦æ—¶ï¼Œæ‚¨éœ€è¦æ£€æŸ¥æ²³æµã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç§æœ‰æ–¹æ³•æ¥æ‰§è¡Œæ­¤ä»»åŠ¡ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ValidateRivers</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( hasOutgoingRiver &amp;&amp; !IsValidRiverDestination(GetNeighbor(outgoingRiver)) ) { RemoveOutgoingRiver(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( hasIncomingRiver &amp;&amp; !GetNeighbor(incomingRiver).IsValidRiverDestination(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) ) { RemoveIncomingRiver(); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†åœ¨</font></font><code>Elevation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font><font style="vertical-align: inherit;">å±æ€§ä¸­ä½¿ç”¨æ­¤æ–°æ–¹æ³•</font></font><code>WaterLevel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Elevation { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { â€¦ <span class="hljs-comment"><span class="hljs-comment">// if ( // hasOutgoingRiver &amp;&amp; // elevation &lt; GetNeighbor(outgoingRiver).elevation // ) { // RemoveOutgoingRiver(); // } // if ( // hasIncomingRiver &amp;&amp; // elevation &gt; GetNeighbor(incomingRiver).elevation // ) { // RemoveIncomingRiver(); // } ValidateRivers(); â€¦ } } public int WaterLevel { â€¦ set { if (waterLevel == value) { return; } waterLevel = value; ValidateRivers(); Refresh(); } }</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c04/ca4/b49/c04ca4b49ccff20e71dba70dc1a2bea7.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡ºå…¥æ²³æ¹–ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ‰­è½¬æ½®æµ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬åˆ›å»ºäº†</font></font><code>HexGridChunk.TriangulateEstuary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œæš—ç¤ºæ²³æµåªèƒ½æµå…¥æ°´åŸŸã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œç»“æœï¼Œæ²³é“æ€»æ˜¯æ²¿ä¸€ä¸ªæ–¹å‘ç§»åŠ¨ã€‚</font><font style="vertical-align: inherit;">å½“å¤„ç†ä»æ°´ä½“æµå‡ºçš„æ²³æµæ—¶ï¼Œæˆ‘ä»¬éœ€è¦é€†å‘æµåŠ¨ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦</font></font><code>TriangulateEstuary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">äº†è§£æµå‘ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬ç»™ä»–ä¸€ä¸ªå¸ƒå°”å‚æ•°ï¼Œè¯¥å¸ƒå°”å‚æ•°ç¡®å®šæˆ‘ä»¬æ˜¯å¦åœ¨å¤„ç†ä¼ å…¥çš„æ²³æµã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEstuary</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices e1, EdgeVertices e2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> incomingRiver </span></span></span><span class="hljs-function">)</span></span> { â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“ä»ä¸­è°ƒç”¨æ­¤æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å°†ä¼ é€’æ­¤ä¿¡æ¯</font></font><code>TriangulateWaterShore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction)) { TriangulateEstuary(e1, e2, cell.IncomingRiver == direction); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡æ›´æ”¹UV2çš„åæ ‡æ¥æ‰©å±•æ²³æµæµé‡ã€‚</font><font style="vertical-align: inherit;">éœ€è¦é•œåƒå‡ºæ²³çš„Uåæ ‡ï¼š-0.5å˜ä¸º1.5ï¼Œ0å˜ä¸º1ï¼Œ1å˜ä¸º0ï¼Œ1.5å˜ä¸º-0.5ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨Våæ ‡ï¼Œæƒ…å†µä¼šç¨å¾®å¤æ‚ä¸€äº›ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ‚¨çœ‹ä¸€ä¸‹æˆ‘ä»¬å¦‚ä½•å¤„ç†åå‘æ²³æµè¿æ¥ï¼Œé‚£ä¹ˆ0.8åº”è¯¥æ˜¯0ï¼Œè€Œ1åº”è¯¥æ˜¯-0.2ã€‚</font><font style="vertical-align: inherit;">è¿™æ„å‘³ç€1.1å˜ä¸º-0.3ï¼Œè€Œ1.15å˜ä¸º-0.35ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºæ¯ç§æƒ…å†µä¸‹çš„UV2åæ ‡éƒ½éå¸¸ä¸åŒï¼Œå› æ­¤è®©æˆ‘ä»¬ä¸ºå®ƒä»¬ç¼–å†™ä¸€ä¸ªå•ç‹¬çš„ä»£ç ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEstuary</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices e1, EdgeVertices e2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> incomingRiver </span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (incomingRiver) { estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.7f</span></span>, <span class="hljs-number"><span class="hljs-number">1.15f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>) ); estuaries.AddTriangleUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>) ); estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.3f</span></span>, <span class="hljs-number"><span class="hljs-number">1.15f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">-0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">-0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">-0.2f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.3f</span></span>, <span class="hljs-number"><span class="hljs-number">-0.35f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">-0.3f</span></span>) ); estuaries.AddTriangleUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">-0.3f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">-0.3f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.7f</span></span>, <span class="hljs-number"><span class="hljs-number">-0.35f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1.5f</span></span>, <span class="hljs-number"><span class="hljs-number">-0.2f</span></span>) ); } }</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­£ç¡®çš„æ²³æµè·¯çº¿ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç¬¬9éƒ¨åˆ†ï¼šæ•‘æµç‰¹å¾ </font></font></h1><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å‘æµ®é›•ä¸­æ·»åŠ å¯¹è±¡ã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬åˆ›å»ºå¯¹å¯¹è±¡å¯†åº¦çº§åˆ«çš„æ”¯æŒã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬åœ¨å…³å¡ä¸­ä½¿ç”¨å„ç§å¯¹è±¡ã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ··åˆä¸‰ç§ä¸åŒç±»å‹çš„å¯¹è±¡ã€‚ </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå°†å¯¹è±¡æ·»åŠ åˆ°åœ°å½¢ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†åˆ›å»ºè¯¸å¦‚å»ºç­‘ç‰©å’Œæ ‘æœ¨ä¹‹ç±»çš„å¯¹è±¡ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b8b/1ec/f84/b8b1ecf8496a03d50c881bbd47c262ad.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ£®æ—ï¼Œå†œä¸šç”¨åœ°ä¸åŸå¸‚åŒ–ä¹‹é—´çš„å†²çªã€‚</font></font></i> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ·»åŠ å¯¹å¯¹è±¡çš„æ”¯æŒ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°½ç®¡æµ®é›•çš„å½¢çŠ¶æœ‰æ‰€å˜åŒ–ï¼Œä½†åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ²¡æœ‰ä»»ä½•å˜åŒ–ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯ä¸€ç‰‡æ­»æ°”æ²‰æ²‰çš„åœŸåœ°ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†è®©ç”Ÿæ´»å……æ»¡æ´»åŠ›ï¼Œæ‚¨éœ€è¦æ·»åŠ æ­¤ç±»å¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">åƒæ ‘æœ¨å’Œæˆ¿å±‹ã€‚</font><font style="vertical-align: inherit;">è¿™äº›å¯¹è±¡ä¸æ˜¯æµ®é›•ç½‘æ ¼çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯å•ç‹¬çš„å¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">ä½†è¿™å¹¶ä¸èƒ½é˜»æ­¢æˆ‘ä»¬åœ¨å¯¹åœ°å½¢è¿›è¡Œä¸‰è§’å‰–åˆ†æ—¶æ·»åŠ å®ƒä»¬ã€‚</font></font><br><br> <code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸åœ¨ä¹ç½‘æ ¼å¦‚ä½•å·¥ä½œã€‚</font><font style="vertical-align: inherit;">ä»–åªæ˜¯å‘½ä»¤ä»–çš„ä¸€ä¸ªå­©å­</font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·»åŠ ä¸€ä¸ªä¸‰è§’å½¢æˆ–å››è¾¹å½¢ã€‚</font><font style="vertical-align: inherit;">åŒæ ·ï¼Œå®ƒå¯ä»¥å…·æœ‰ä¸€ä¸ªå­å…ƒç´ ï¼Œç”¨äºå¤„ç†å¯¹è±¡åœ¨å…¶ä¸Šçš„æ”¾ç½®ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¯¹è±¡ç®¡ç†å™¨ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç»„ä»¶</font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font><font style="vertical-align: inherit;">è¯¥ç»„ä»¶</font><font style="vertical-align: inherit;">è´Ÿè´£å•ä¸ªç‰‡æ®µä¸­çš„å¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä½¿ç”¨ä¸</font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»™ä»–æ–¹æ³•</font><font style="vertical-align: inherit;">ç›¸åŒçš„æ–¹æ¡ˆ</font></font><code>Clear</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><code>Apply</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><code>AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç”±äºéœ€è¦å°†å¯¹è±¡æ”¾ç½®åœ¨æŸå¤„ï¼Œå› æ­¤è¯¥æ–¹æ³•å°†</font></font><code>AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥æ”¶positionå‚æ•°ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä»ä¸€ä¸ªç©ºç™½çš„å®ç°å¼€å§‹ï¼Œç›®å‰æš‚æ—¶ä»€ä¹ˆä¹Ÿä¸åšã€‚</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HexFeatureManager</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Apply</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> {} }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸­æ·»åŠ æŒ‡å‘æ­¤ç±»ç»„ä»¶çš„é“¾æ¥</font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œæ‚¨å¯ä»¥åƒæ‰€æœ‰å­å…ƒç´ ä¸€æ ·å°†å…¶åŒ…æ‹¬åœ¨ä¸‰è§’æµ‹é‡è¿‡ç¨‹ä¸­</font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexFeatureManager features; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { terrain.Clear(); rivers.Clear(); roads.Clear(); water.Clear(); waterShore.Clear(); estuaries.Clear(); features.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Length; i++) { Triangulate(cells[i]); } terrain.Apply(); rivers.Apply(); roads.Apply(); water.Apply(); waterShore.Apply(); estuaries.Apply(); features.Apply(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é¦–å…ˆï¼Œåœ¨æ¯ä¸ªå•å…ƒæ ¼çš„ä¸­å¿ƒæ”¾ç½®ä¸€ä¸ªå¯¹è±¡ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (HexDirection d = HexDirection.NE; d &lt;= HexDirection.NW; d++) { Triangulate(d, cell); } features.AddFeature(cell.Position); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬éœ€è¦ä¸€ä¸ªçœŸæ­£çš„å¯¹è±¡ç®¡ç†å™¨ã€‚</font><font style="vertical-align: inherit;">å‘</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hex Grid Chunk</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¢„åˆ¶ä»¶ä¸­æ·»åŠ </font><font style="vertical-align: inherit;">ä¸€ä¸ªå­ä»£ï¼Œå¹¶ç»™å®ƒä¸€ä¸ªç»„ä»¶</font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œæ‚¨å¯ä»¥å°†ç‰‡æ®µè¿æ¥åˆ°å®ƒã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eeb/1f4/626/eeb1f462652650c6dfe5e3cb34a2ec12.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/51b/7ec/8f2/51b7ec8f20b4a79589fd2b464744230b.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/620/c6f/8cd/620c6f8cd7c54c52597fcc289b160c57.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹è±¡ç®¡ç†å™¨æ·»åŠ åˆ°ç‰‡æ®µé¢„åˆ¶ä¸­ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é¢„åˆ¶ç‰©ä»¶ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†åˆ›å»ºä»€ä¹ˆåœ°å½¢å¯¹è±¡ï¼Ÿ</font><font style="vertical-align: inherit;">å¯¹äºç¬¬ä¸€ä¸ªæµ‹è¯•ï¼Œç«‹æ–¹ä½“éå¸¸é€‚åˆã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¶³å¤Ÿå¤§çš„å¤šç»´æ•°æ®é›†ï¼Œä¾‹å¦‚ï¼Œç¼©æ”¾æ¯”ä¾‹ä¸ºï¼ˆ3ï¼Œ3ï¼Œ3ï¼‰ï¼Œç„¶åå°†å…¶å˜æˆé¢„åˆ¶ä»¶ã€‚</font><font style="vertical-align: inherit;">ä¹Ÿä¸ºä»–åˆ›é€ ææ–™ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä½¿ç”¨é»˜è®¤æè´¨å’Œçº¢è‰²ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬åˆ é™¤å®ƒçš„å¯¹æ’æœºï¼Œå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦å®ƒã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a7a/1b1/315/a7a1b1315e7f2756ac2940dac661f95a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¢„åˆ¶ç«‹æ–¹ä½“ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹è±¡ç®¡ç†å™¨å°†éœ€è¦ä¸€ä¸ªæŒ‡å‘è¯¥é¢„åˆ¶ä»¶çš„é“¾æ¥ï¼Œå› æ­¤å°†å…¶æ·»åŠ åˆ°</font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç„¶åè¿›è¡Œè¿æ¥ã€‚</font><font style="vertical-align: inherit;">ç”±äºéœ€è¦è®¿é—®è½¬æ¢ç»„ä»¶æ‰èƒ½æ”¾ç½®å¯¹è±¡ï¼Œå› æ­¤æˆ‘ä»¬å°†å…¶ç”¨ä½œé“¾æ¥çš„ç±»å‹ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform featurePrefab;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cfc/34d/e84/cfc34de84fbc12ac5fde17d7d1d09b58.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¢„åˆ¶å¯¹è±¡ç®¡ç†å™¨ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åˆ›å»ºå¯¹è±¡å®ä¾‹ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»“æ„å·²ç»å‡†å¤‡å°±ç»ªï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹æ·»åŠ åœ°å½¢è¦ç´ äº†ï¼</font><font style="vertical-align: inherit;">åªéœ€åœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ªé¢„åˆ¶å®ä¾‹</font></font><code>HexFeatureManager.AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶è®¾ç½®å…¶ä½ç½®å³å¯ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Transform instance = Instantiate(featurePrefab); instance.localPosition = position; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dd8/59c/ae5/dd859cae56fa9439e91d0ccb5d659f62.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ°å½¢è¦ç´ å®ä¾‹ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»ç°åœ¨å¼€å§‹ï¼Œåœ°å½¢å°†å……æ»¡ç«‹æ–¹ä½“ã€‚</font><font style="vertical-align: inherit;">è‡³å°‘æ˜¯ç«‹æ–¹ä½“çš„ä¸ŠåŠéƒ¨åˆ†ï¼Œå› ä¸ºåœ¨Unityä¸­ç«‹æ–¹ä½“ç½‘æ ¼çš„æœ¬åœ°åŸç‚¹åœ¨ç«‹æ–¹ä½“çš„ä¸­å¿ƒï¼Œè€Œåº•éƒ¨åœ¨å‡¸ç‰ˆçš„è¡¨é¢ä¸‹æ–¹ã€‚</font><font style="vertical-align: inherit;">è¦å°†ç«‹æ–¹ä½“æ”¾ç½®åœ¨åœ°å½¢ä¸Šï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶ä¸Šç§»ä¸€åŠçš„é«˜åº¦ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Transform instance = Instantiate(featurePrefab); position.y += instance.localScale.y * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.localPosition = position; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bb0/6be/89b/bb06be89b647d5ff29f1894bfdcf199b.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æµ®é›•è¡¨é¢ä¸Šçš„ç«‹æ–¹ä½“ã€‚</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬ä½¿ç”¨å¦ä¸€ä¸ªç½‘æ ¼æ€ä¹ˆåŠï¼Ÿ</font></font></b> <div class="spoiler_text">       .     ,      ,        .       . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“ç„¶ï¼Œæˆ‘ä»¬çš„å•å…ƒä¼šå˜å½¢ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ‰­æ›²å¯¹è±¡çš„ä½ç½®ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬æ‘†è„±äº†å®Œç¾çš„ç½‘æ ¼é‡å¤æ€§ã€‚</font></font><br><br><pre> <code class="cs hljs"> instance.localPosition = HexMetrics.Perturb(position);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e5/7ec/a43/9e57eca43cf9127691cb5eb11bc6a11a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹è±¡çš„ä½ç½®å˜å½¢ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç ´åæ•‘æµç‰© </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¯æ¬¡æ›´æ–°ç‰‡æ®µæ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šåˆ›å»ºæ–°çš„æ•‘æµå¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">è¿™æ„å‘³ç€å½“æˆ‘ä»¬åœ¨ç›¸åŒä½ç½®åˆ›å»ºè¶Šæ¥è¶Šå¤šçš„å¯¹è±¡æ—¶ã€‚</font><font style="vertical-align: inherit;">ä¸ºé¿å…é‡å¤ï¼Œæ¸…æ´ç¢ç‰‡æ—¶æˆ‘ä»¬éœ€è¦æ¸…é™¤æ—§ç‰©ä½“ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€å¿«çš„æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªæ¸¸æˆå®¹å™¨å¯¹è±¡ï¼Œå¹¶å°†æ‰€æœ‰é‡Šæ”¾å¯¹è±¡å˜æˆå…¶å­å¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œå½“è¢«è°ƒç”¨æ—¶ï¼Œ</font></font><code>Clear</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†é”€æ¯è¯¥å®¹å™¨å¹¶åˆ›å»ºä¸€ä¸ªæ–°å®¹å™¨ã€‚</font><font style="vertical-align: inherit;">å®¹å™¨æœ¬èº«å°†æ˜¯å…¶ç®¡ç†è€…çš„å­©å­ã€‚</font></font><br><br><pre> <code class="cs hljs"> Transform container; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (container) { Destroy(container.gameObject); } container = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GameObject(<span class="hljs-string"><span class="hljs-string">"Features Container"</span></span>).transform; container.SetParent(transform, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Transform instance = Instantiate(featurePrefab); position.y += instance.localScale.y * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.localPosition = HexMetrics.Perturb(position); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯èƒ½æ¯æ¬¡åˆ›å»ºå’Œé”€æ¯æ•‘æµå¯¹è±¡çš„æ•ˆç‡éƒ½å¾ˆä½ã€‚</font></font></b> <div class="spoiler_text"> , ,   .       .      .   ,  ,      ,    .          <code>HexFeatureManager.Apply</code> .      .  ,    ,       . </div></div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ•‘æµç‰©çš„æ”¾ç½® </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“æˆ‘ä»¬å°†å¯¹è±¡æ”¾ç½®åœ¨æ¯ä¸ªå•å…ƒæ ¼çš„ä¸­å¿ƒæ—¶ã€‚</font><font style="vertical-align: inherit;">å¯¹äºç©ºçš„å•å…ƒæ ¼ï¼Œè¿™çœ‹èµ·æ¥å¾ˆæ­£å¸¸ï¼Œä½†æ˜¯åœ¨åŒ…å«æ²³æµå’Œé“è·¯ä»¥åŠè¢«æ°´æ·¹æ²¡çš„å•å…ƒæ ¼ä¸Šï¼Œè¿™ä¼¼ä¹å¾ˆå¥‡æ€ªã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/01d/e88/ab8/01de88ab8777d38afeb4ca374571a2f1.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹è±¡æ— å¤„ä¸åœ¨ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œè®©æˆ‘ä»¬åœ¨æ”¾ç½®å¯¹è±¡ä¹‹å‰æ£€æŸ¥</font></font><code>HexGridChunk.Triangulate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å•å…ƒæ ¼æ˜¯å¦ä¸ºç©ºã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !cell.HasRiver &amp;&amp; !cell.HasRoads) { features.AddFeature(cell.Position); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5db/b98/75f/5dbb9875f8510c7f9224f8ba10465ae4.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰é™çš„ä½å®¿ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ¯ä¸ªæ–¹å‘ä¸€ä¸ªå¯¹è±¡ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¯ä¸ªå•å…ƒæ ¼åªæœ‰ä¸€ä¸ªå¯¹è±¡ä¸æ˜¯å¤ªå¤šã€‚</font><font style="vertical-align: inherit;">ä»ç„¶æœ‰è¶³å¤Ÿçš„ç©ºé—´å®¹çº³ä¸€å †ç‰©å“ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å‘è¯¥å•å…ƒæ ¼çš„å…­ä¸ªä¸‰è§’å½¢ä¸­çš„æ¯ä¸ªä¸‰è§’å½¢çš„ä¸­å¿ƒæ·»åŠ ä¸€ä¸ªé™„åŠ å¯¹è±¡ï¼Œå³æ¯ä¸ªæ–¹å‘ä¸€ä¸ªã€‚</font><font style="vertical-align: inherit;">å½“æˆ‘ä»¬çŸ¥é“è¯¥å•å…ƒæ ¼ä¸­æ²¡æœ‰æ²³æµæ—¶ï¼Œ</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†ä»¥å¦ä¸€ç§æ–¹æ³•è¿›è¡Œæ­¤æ“ä½œ</font></font><code>Triangulate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä»ç„¶éœ€è¦æ£€æŸ¥æ˜¯å¦åœ¨æ°´ä¸‹ä»¥åŠç‰¢æˆ¿ä¸­æ˜¯å¦æœ‰é“è·¯ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªå¯¹æ²¿å½“å‰æ–¹å‘è¡Œé©¶çš„é“è·¯æ„Ÿå…´è¶£ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiver) { â€¦ } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateWithoutRiver(direction, cell, center, e); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !cell.HasRoadThroughEdge(direction)) { features.AddFeature((center + e.v1 + e.v5) * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>)); } } â€¦ }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7e7/b60/d4b/7e7b60d4b54d2f9a7b3119e78554507a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®¾æ–½å¾ˆå¤šï¼Œä½†æ˜¯ä¸åœ¨æ²³æµé™„è¿‘ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™ä¼šåˆ›å»ºæ›´å¤šå¯¹è±¡ï¼</font><font style="vertical-align: inherit;">å®ƒä»¬å‡ºç°åœ¨é“è·¯é™„è¿‘ï¼Œä½†ä»ç„¶é¿å¼€æ²³æµã€‚</font><font style="vertical-align: inherit;">è¦æ²¿æ²³æµæ”¾ç½®å¯¹è±¡ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨å…¶ä¸­æ·»åŠ å¯¹è±¡</font></font><code>TriangulateAdjacentToRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œä»…å½“ä¸‰è§’å½¢ä¸åœ¨æ°´ä¸‹ä¸”ä¸Šé¢æ²¡æœ‰è·¯æ—¶ï¼Œæ‰å†æ¬¡å‡ºç°ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateAdjacentToRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !cell.HasRoadThroughEdge(direction)) { features.AddFeature((center + e.v1 + e.v5) * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>)); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/30c/90a/f9f/30c90af9ffb31cec360ea027fc4f1815.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰©ä½“å‡ºç°åœ¨æ²³è¾¹ã€‚</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯ä»¥æ¸²æŸ“è¿™ä¹ˆå¤šå¯¹è±¡å—ï¼Ÿ</font></font></b> <div class="spoiler_text">       ,    dynamic batching  Unity.    ,       .         batch.     Â« Â»,       .    instancing,          dynamic batching. </div></div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å„ç§ç‰©ä½“ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬æ‰€æœ‰çš„æµ®é›•å¯¹è±¡éƒ½å…·æœ‰ç›¸åŒçš„æ–¹å‘ï¼Œè¿™çœ‹èµ·æ¥å®Œå…¨ä¸è‡ªç„¶ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ç»™æ¯ä¸ªäººä¸€ä¸ªéšæœºçš„è½¬æŠ˜ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Transform instance = Instantiate(featurePrefab); position.y += instance.localScale.y * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.localPosition = HexMetrics.Perturb(position); instance.localRotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">360f</span></span> * Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b42/8bd/0bc/b428bd0bcb9b27676853f7bb1e491165.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éšæœºå›åˆã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ç»“æœå˜å¾—æ›´åŠ å¤šæ ·åŒ–ã€‚</font><font style="vertical-align: inherit;">ä¸å¹¸çš„æ˜¯ï¼Œæ¯æ¬¡æ›´æ–°ç‰‡æ®µæ—¶ï¼Œå¯¹è±¡éƒ½ä¼šæ”¶åˆ°æ–°çš„éšæœºæ—‹è½¬ã€‚</font><font style="vertical-align: inherit;">ç¼–è¾‘å•å…ƒæ ¼ä¸åº”æ›´æ”¹é™„è¿‘çš„å¯¹è±¡ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¦ä¸€ç§æ–¹æ³•ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å…·æœ‰å§‹ç»ˆç›¸åŒçš„å™ªå£°çº¹ç†ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œæ­¤çº¹ç†åŒ…å«Perlinæ¢¯åº¦å™ªå£°ï¼Œå¹¶ä¸”å±€éƒ¨ä¸€è‡´ã€‚</font><font style="vertical-align: inherit;">è¿™æ­£æ˜¯ä½¿å•å…ƒæ ¼ä¸­é¡¶ç‚¹çš„ä½ç½®å¤±çœŸæ—¶æ‰€éœ€è¦çš„ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯è½¬å¼¯ä¸å¿…ä¿æŒä¸€è‡´ã€‚</font><font style="vertical-align: inherit;">æ‰€æœ‰è½¬å¼¯éƒ½åº”åŒæ ·å¯èƒ½ä¸”æ··åˆã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå…·æœ‰éæ¸å˜éšæœºå€¼çš„çº¹ç†ï¼Œæ— éœ€åŒçº¿æ€§æ»¤æ³¢å³å¯å¯¹å…¶è¿›è¡Œé‡‡æ ·ã€‚</font><font style="vertical-align: inherit;">æœ¬è´¨ä¸Šï¼Œè¿™æ˜¯ä¸€ä¸ªå“ˆå¸Œç½‘æ ¼ï¼Œå®ƒæ„æˆäº†æ¢¯åº¦å™ªå£°çš„åŸºç¡€ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åˆ›å»ºå“ˆå¸Œè¡¨ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥ä»æµ®ç‚¹å€¼æ•°ç»„åˆ›å»ºå“ˆå¸Œè¡¨ï¼Œå¹¶ç”¨éšæœºå€¼å¡«å……ä¸€æ¬¡ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬æ ¹æœ¬ä¸éœ€è¦çº¹ç†ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å°†å…¶æ·»åŠ åˆ°ä¸­</font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">256 x 256çš„å¤§å°è¶³ä»¥å®ç°è¶³å¤Ÿçš„å˜åŒ–ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> hashGridSize = <span class="hljs-number"><span class="hljs-number">256</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] hashGrid; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitializeHashGrid</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hashGrid = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[hashGridSize * hashGridSize]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; hashGrid.Length; i++) { hashGrid[i] = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éšæœºå€¼ç”±å§‹ç»ˆæä¾›ç›¸åŒç»“æœçš„æ•°å­¦å…¬å¼ç”Ÿæˆã€‚</font><font style="vertical-align: inherit;">ç»“æœåºåˆ—å–å†³äºç§å­çš„æ•°é‡ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥æ•°é‡ç­‰äºæ—¶é—´çš„å½“å‰å€¼ã€‚</font><font style="vertical-align: inherit;">è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨æ¯ä¸ªæ¸¸æˆç¯èŠ‚æˆ‘ä»¬éƒ½ä¼šå¾—åˆ°ä¸åŒçš„ç»“æœçš„åŸå› ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†ç¡®ä¿å§‹ç»ˆåˆ›å»ºç›¸åŒçš„å¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦å°†ç§å­å‚æ•°æ·»åŠ åˆ°åˆå§‹åŒ–æ–¹æ³•ä¸­ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitializeHashGrid</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> seed</span></span></span><span class="hljs-function">)</span></span> { hashGrid = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[hashGridSize * hashGridSize]; Random.InitState(seed); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; hashGrid.Length; i++) { hashGrid[i] = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å·²ç»åˆå§‹åŒ–äº†éšæœºæ•°æµï¼Œæˆ‘ä»¬å°†å§‹ç»ˆä»ä¸­è·å¾—ç›¸åŒçš„åºåˆ—ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œåœ¨ç”Ÿæˆåœ°å›¾ä¹‹åå‘ç”Ÿçš„çœ‹ä¼¼éšæœºäº‹ä»¶ä¹Ÿå°†å§‹ç»ˆç›¸åŒã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨åˆå§‹åŒ–éšæœºæ•°ç”Ÿæˆå™¨ä¹‹å‰å­˜å‚¨å…¶çŠ¶æ€æ¥é¿å…è¿™ç§æƒ…å†µã€‚</font><font style="vertical-align: inherit;">å®Œæˆå·¥ä½œåï¼Œæˆ‘ä»¬å¯ä»¥é—®ä»–ä»¥å‰çš„çŠ¶æ€ã€‚</font></font><br><br><pre> <code class="cs hljs"> Random.State currentState = Random.state; Random.InitState(seed); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; hashGrid.Length; i++) { hashGrid[i] = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } Random.state = currentState;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å“ˆå¸Œè¡¨</font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨åˆ†é…å™ªå£°çº¹ç†çš„åŒæ—¶</font><font style="vertical-align: inherit;">è¢«åˆå§‹åŒ–</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨</font></font><code>HexGrid.Start</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œä¸­</font></font><code>HexGrid.Awake</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬è¿™æ ·åšæ˜¯ä¸ºäº†é¿å…ä¸å¿…è¦åœ°é¢‘ç¹ç”Ÿæˆå€¼ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> seed; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexMetrics.noiseSource = noiseSource; HexMetrics.InitializeHashGrid(seed); â€¦ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnable</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!HexMetrics.noiseSource) { HexMetrics.noiseSource = noiseSource; HexMetrics.InitializeHashGrid(seed); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šç”¨ç§å­å˜é‡å…è®¸æˆ‘ä»¬é€‰æ‹©åœ°å›¾çš„ç§å­å€¼ã€‚</font><font style="vertical-align: inherit;">ä»»ä½•å€¼éƒ½å¯ä»¥ã€‚</font><font style="vertical-align: inherit;">æˆ‘é€‰æ‹©äº†1234ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/60c/8b3/5a3/60c8b35a3b6a92b61165ed3a00473076.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§å­çš„é€‰æ‹©ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä½¿ç”¨å“ˆå¸Œè¡¨ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦ä½¿ç”¨å“ˆå¸Œè¡¨ï¼Œè¯·æ·»åŠ åˆ°</font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é‡‡æ ·æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">åƒä¸€æ ·</font></font><code>SampleNoise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå®ƒä½¿ç”¨XZä½ç½®çš„åæ ‡æ¥è·å–å€¼ã€‚</font><font style="vertical-align: inherit;">é€šè¿‡å°†åæ ‡é™åˆ¶ä¸ºæ•´æ•°å€¼ï¼Œç„¶åè·å–æ•´æ•°é™¤ä»¥è¡¨çš„å¤§å°ï¼Œå¯ä»¥æ‰¾åˆ°å“ˆå¸Œç´¢å¼•ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SampleHashGrid</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)position.x % hashGridSize; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> z = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)position.z % hashGridSize; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hashGrid[x + z * hashGridSize]; }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼…åšä»€ä¹ˆï¼Ÿ</font></font></b> <div class="spoiler_text">   ,     ,    â€”  . ,  âˆ’4, âˆ’3, âˆ’2, âˆ’1, 0, 1, 2, 3, 4 modulo 3   âˆ’1, 0, âˆ’2, âˆ’1, 0, 1, 2, 0, 1. </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™é€‚ç”¨äºæ­£åæ ‡ï¼Œä½†ä¸é€‚ç”¨äºè´Ÿåæ ‡ï¼Œå› ä¸ºå¯¹äºæ­¤ç±»æ•°å­—ï¼Œä½™æ•°å°†ä¸ºè´Ÿã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†è¡¨çš„å¤§å°æ·»åŠ åˆ°è´Ÿé¢ç»“æœä¸­æ¥è§£å†³æ­¤é—®é¢˜ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)position.x % hashGridSize; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { x += hashGridSize; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> z = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)position.z % hashGridSize; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (z &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { z += hashGridSize; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªå¹³æ–¹å•ä½åˆ›å»ºè‡ªå·±çš„ä»·å€¼ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå®é™…ä¸Šï¼Œæˆ‘ä»¬ä¸éœ€è¦è¿™æ ·çš„è¡¨å¯†åº¦ã€‚</font><font style="vertical-align: inherit;">å¯¹è±¡å½¼æ­¤éš”å¼€ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨è®¡ç®—ç´¢å¼•ä¹‹å‰å‡å°ä½ç½®æ¯”ä¾‹æ¥æ‹‰ä¼¸è¡¨æ ¼ã€‚</font><font style="vertical-align: inherit;">ä¸€ä¸ª4ä¹˜4å¹³æ–¹çš„å”¯ä¸€å€¼å°±è¶³å¤Ÿäº†ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> hashGridScale = <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SampleHashGrid</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(position.x * hashGridScale) % hashGridSize; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { x += hashGridSize; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> z = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(position.z * hashGridScale) % hashGridSize; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (z &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { z += hashGridSize; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hashGrid[x + z * hashGridSize]; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å›åˆ°</font></font><code>HexFeatureManager.AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶ä½¿ç”¨æ–°çš„å“ˆå¸Œè¡¨æ¥è·å–å€¼ã€‚</font><font style="vertical-align: inherit;">åº”ç”¨å®ƒæŒ‡å®šæ—‹è½¬åï¼Œåœ¨ç¼–è¾‘åœ°å½¢æ—¶å¯¹è±¡å°†ä¿æŒé™æ­¢ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> hash = HexMetrics.SampleHashGrid(position); Transform instance = Instantiate(featurePrefab); position.y += instance.localScale.y * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.localPosition = HexMetrics.Perturb(position); instance.localRotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">360f</span></span> * hash, <span class="hljs-number"><span class="hljs-number">0f</span></span>); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ”¾ç½®é˜ˆå€¼ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°½ç®¡å¯¹è±¡å…·æœ‰ä¸åŒçš„æ—‹è½¬è§’åº¦ï¼Œä½†æ˜¯åœ¨å…¶ä½ç½®ä¸Šä»ç„¶å¯ä»¥çœ‹åˆ°å›¾æ¡ˆã€‚</font><font style="vertical-align: inherit;">æ¯ä¸ªå•å…ƒéƒ½æœ‰ä¸ƒä¸ªå¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥ç»™è¿™ä¸ªæ–¹æ¡ˆå¢åŠ æ··ä¹±ï¼Œä»»æ„è·³è¿‡ä¸€äº›å¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¦‚ä½•å†³å®šæ˜¯å¦æ·»åŠ å¯¹è±¡ï¼Ÿ</font><font style="vertical-align: inherit;">å½“ç„¶ï¼Œè¯·æ£€æŸ¥å¦ä¸€ä¸ªéšæœºå€¼ï¼</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¹Ÿå°±æ˜¯è¯´ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ä¸ªè€Œä¸æ˜¯ä¸€ä¸ªå“ˆå¸Œå€¼ã€‚</font><font style="vertical-align: inherit;">å¯ä»¥é€šè¿‡ä½¿ç”¨å“ˆå¸Œä»£æ›¿è¡¨æ•°ç»„ç±»å‹çš„</font></font><code>float</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å˜é‡</font><font style="vertical-align: inherit;">æ¥å¢åŠ å¯¹å®ƒä»¬çš„æ”¯æŒ</font></font><code>Vector2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯å‘é‡è¿ç®—å¯¹äºæ•£åˆ—å€¼æ²¡æœ‰æ„ä¹‰ï¼Œå› æ­¤è®©æˆ‘ä»¬ä¸ºæ­¤åˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„ç»“æ„ã€‚</font><font style="vertical-align: inherit;">å¥¹åªéœ€è¦ä¸¤ä¸ªæµ®ç‚¹å€¼ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªé™æ€æ–¹æ³•æ¥åˆ›å»ºä¸€å¯¹éšæœºå€¼ã€‚</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> HexHash { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a, b; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HexHash </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexHash hash; hash.a = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; hash.b = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hash; } }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸éœ€è¦åºåˆ—åŒ–å—ï¼Ÿ</font></font></b> <div class="spoiler_text">        ,  ,        Unity. ,     . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹å…¶è¿›è¡Œæ›´æ”¹ï¼Œ</font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä½¿å…¶ä½¿ç”¨æ–°ç»“æ„ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> HexHash[] hashGrid; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitializeHashGrid</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> seed</span></span></span><span class="hljs-function">)</span></span> { hashGrid = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HexHash[hashGridSize * hashGridSize]; Random.State currentState = Random.state; Random.InitState(seed); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; hashGrid.Length; i++) { hashGrid[i] = HexHash.Create(); } Random.state = currentState; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HexHash </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SampleHashGrid</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨</font></font><code>HexFeatureManager.AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯ä»¥è®¿é—®ä¸¤ä¸ªå“ˆå¸Œå€¼ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä½¿ç”¨ç¬¬ä¸€ä¸ªæ¥å†³å®šæ˜¯æ·»åŠ å¯¹è±¡è¿˜æ˜¯è·³è¿‡å¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">å¦‚æœè¯¥å€¼ç­‰äºæˆ–å¤§äº0.5ï¼Œåˆ™è·³è¿‡ã€‚</font><font style="vertical-align: inherit;">è¿™æ ·ï¼Œæˆ‘ä»¬å°†æ‘†è„±å¤§çº¦ä¸€åŠçš„å¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">ç¬¬äºŒä¸ªå€¼å°†ç…§å¸¸ç”¨äºç¡®å®šæ—‹è½¬è§’åº¦ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { HexHash hash = HexMetrics.SampleHashGrid(position); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hash.a &gt;= <span class="hljs-number"><span class="hljs-number">0.5f</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } Transform instance = Instantiate(featurePrefab); position.y += instance.localScale.y * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.localPosition = HexMetrics.Perturb(position); instance.localRotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">360f</span></span> * hash.b, <span class="hljs-number"><span class="hljs-number">0f</span></span>); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e89/e69/761/e89e697613f8eef3d149b07720e8a26a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰©ä½“çš„å¯†åº¦é™ä½äº†50ï¼…ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç»˜å›¾å¯¹è±¡ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸å…¶å°†å¯¹è±¡æ”¾ç½®åœ¨å„å¤„ï¼Œä¸å¦‚è®©å®ƒä»¬å¯ç¼–è¾‘ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯æˆ‘ä»¬ä¸ä¼šç»˜åˆ¶å•ç‹¬çš„å¯¹è±¡ï¼Œè€Œæ˜¯å°†å¯¹è±¡çš„çº§åˆ«æ·»åŠ åˆ°æ¯ä¸ªå•å…ƒæ ¼ä¸­ã€‚</font><font style="vertical-align: inherit;">æ­¤çº§åˆ«å°†æ§åˆ¶å¯¹è±¡å‡ºç°åœ¨å•å…ƒä¸­çš„å¯èƒ½æ€§ã€‚</font><font style="vertical-align: inherit;">é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å€¼ä¸ºé›¶ï¼Œå³ä¸å­˜åœ¨å¯¹è±¡ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬åœ°å½¢ä¸Šçš„çº¢è‰²ç«‹æ–¹ä½“çœ‹èµ·æ¥ä¸åƒè‡ªç„¶ç‰©ä½“ï¼Œå› æ­¤æˆ‘ä»¬å°†å…¶ç§°ä¸ºå»ºç­‘ç‰©ã€‚</font><font style="vertical-align: inherit;">å®ƒä»¬å°†ä»£è¡¨åŸå¸‚åŒ–ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å¢åŠ </font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŸå¸‚åŒ–æ°´å¹³ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> UrbanLevel { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> urbanLevel; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (urbanLevel != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { urbanLevel = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; RefreshSelfOnly(); } } } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> urbanLevel;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥ä½¿æ°´ä¸‹å•å…ƒæ ¼çš„åŸå¸‚åŒ–æ°´å¹³ç­‰äºé›¶ï¼Œä½†è¿™ä¸æ˜¯å¿…éœ€çš„ï¼Œæ— è®ºå¦‚ä½•æˆ‘ä»¬å°†è·³è¿‡æ°´ä¸‹å¯¹è±¡çš„åˆ›å»ºã€‚</font><font style="vertical-align: inherit;">ä¹Ÿè®¸åœ¨æŸä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°†æ·»åŠ åŸå¸‚åŒ–çš„æ°´ä½“ï¼Œä¾‹å¦‚ç å¤´å’Œæ°´ä¸‹å»ºç­‘ç‰©ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¯†åº¦æ»‘å— </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†æ”¹å˜åŸå¸‚åŒ–æ°´å¹³ï¼Œæˆ‘ä»¬å¢åŠ äº†</font></font><code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€ä¸ªæ»‘å—ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> activeUrbanLevel; â€¦ <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> applyUrbanLevel; â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetApplyUrbanLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> toggle</span></span></span><span class="hljs-function">)</span></span> { applyUrbanLevel = toggle; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetUrbanLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level</span></span></span><span class="hljs-function">)</span></span> { activeUrbanLevel = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)level; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell) { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyWaterLevel) { cell.WaterLevel = activeWaterLevel; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyUrbanLevel) { cell.UrbanLevel = activeUrbanLevel; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (riverMode == OptionalToggle.No) { cell.RemoveRiver(); } â€¦ } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†å¦ä¸€ä¸ªæ»‘å—æ·»åŠ åˆ°UIå¹¶å°†å…¶ä¸é€‚å½“çš„æ–¹æ³•ç»“åˆã€‚</font><font style="vertical-align: inherit;">æˆ‘å°†åœ¨å±å¹•çš„å³ä¾§æ”¾ç½®ä¸€ä¸ªæ–°é¢æ¿ï¼Œä»¥é¿å…æº¢å‡ºå·¦ä¾§é¢æ¿ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦å‡ ä¸ªçº§åˆ«ï¼Ÿ</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬è¯¦ç»†ä»‹ç»å››ä¸ªï¼Œåˆ†åˆ«è¡¨ç¤ºé›¶ï¼Œä½ï¼Œä¸­å’Œé«˜å¯†åº¦ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/02f/e64/996/02fe649968954603df834d2a3b5f633b.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/95e/9e4/6f5/95e9e46f5ff83a9b7d713e85db86d67a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŸå¸‚åŒ–æ»‘å—ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é˜ˆå€¼å˜åŒ– </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†åŸå¸‚åŒ–æ°´å¹³ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å®ƒæ¥ç¡®å®šæ˜¯å¦æ”¾ç½®ç‰©ä½“ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†åŸå¸‚åŒ–æ°´å¹³ä½œä¸ºçš„é™„åŠ å‚æ•°</font></font><code>HexFeatureManager.AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å†è¿ˆå‡ºä¸€æ­¥ï¼Œåªè½¬ç§»å•å…ƒæ ¼æœ¬èº«ã€‚</font><font style="vertical-align: inherit;">å°†æ¥ï¼Œå®ƒå°†ä¸ºæˆ‘ä»¬å¸¦æ¥æ›´å¤šä¾¿åˆ©ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨åŸå¸‚åŒ–æ°´å¹³çš„æœ€å¿«æ–¹æ³•æ˜¯å°†å…¶ä¹˜ä»¥0.25ï¼Œç„¶åå°†è¯¥å€¼ç”¨ä½œè·³è¿‡å¯¹è±¡çš„æ–°é˜ˆå€¼ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæ¯ä¸ªçº§åˆ«çš„ç‰©ä½“å‡ºç°çš„å¯èƒ½æ€§éƒ½ä¼šå¢åŠ 25ï¼…ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, Vector3 position</span></span></span><span class="hljs-function">)</span></span> { HexHash hash = HexMetrics.SampleHashGrid(position); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hash.a &gt;= cell.UrbanLevel * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œè®©æˆ‘ä»¬å°†å•å…ƒæ ¼ä¼ é€’ç»™</font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !cell.HasRiver &amp;&amp; !cell.HasRoads) { features.AddFeature(cell, cell.Position); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !cell.HasRoadThroughEdge(direction)) { features.AddFeature(cell, (center + e.v1 + e.v5) * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>)); } â€¦ } â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateAdjacentToRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !cell.HasRoadThroughEdge(direction)) { features.AddFeature(cell, (center + e.v1 + e.v5) * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>)); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fd8/7e9/de5/fd87e9de5b6b6ea4b4b490549ae5cbf5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»˜åˆ¶åŸå¸‚åŒ–å¯†åº¦æ°´å¹³ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å‡ ç§æ•‘æµç‰©é¢„åˆ¶ä»¶ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰©ä½“å‡ºç°å¯èƒ½æ€§çš„å·®å¼‚ä¸è¶³ä»¥åœ¨ä½æ°´å¹³çš„åŸå¸‚åŒ–ä¸é«˜æ°´å¹³çš„åŸå¸‚åŒ–ä¹‹é—´å»ºç«‹æ˜æ˜¾çš„éš”ç¦»ã€‚åœ¨æŸäº›å•å…ƒä¸­ï¼Œå»ºç­‘ç‰©çš„æ•°é‡æˆ–å¤šæˆ–å°‘éƒ½å°†å°‘äºé¢„æœŸæ•°é‡ã€‚é€šè¿‡ä¸ºæ¯ä¸ªçº§åˆ«ä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„é¢„åˆ¶ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿å·®å¼‚æ›´åŠ æ¸…æ™°ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†æ‘†è„±è¿™ä¸ªé¢†åŸŸ</font></font><code>featurePrefab</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è€Œå°†å…¶æ›¿æ¢ä¸ºç”¨äºåŸå¸‚åŒ–é¢„åˆ¶ä»¶çš„é˜µåˆ—ã€‚ä¸ºäº†è·å¾—åˆé€‚çš„é¢„åˆ¶ä»¶ï¼Œæˆ‘ä»¬å°†ä»åŸå¸‚åŒ–æ°´å¹³ä¸­å‡å»ä¸€ä¸ªï¼Œå¹¶å°†å…¶ç”¨ä½œæŒ‡æ ‡ã€‚</font></font><br><br><pre> <code class="cs hljs">&lt;del&gt;<span class="hljs-comment"><span class="hljs-comment">// public Transform featurePrefab;&lt;/del&gt; public Transform[] urbanPrefabs; public void AddFeature (HexCell cell, Vector3 position) { â€¦ Transform instance = Instantiate(urbanPrefabs[cell.UrbanLevel - 1]); â€¦ }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ›å»ºå¯¹è±¡çš„é¢„åˆ¶ä»¶çš„ä¸¤ä¸ªå‰¯æœ¬ï¼Œé‡å‘½åå¹¶æ›´æ”¹å®ƒä»¬ï¼Œä»¥ä¾¿å®ƒä»¬æŒ‡ç¤ºä¸‰ä¸ªä¸åŒçš„åŸå¸‚åŒ–æ°´å¹³ã€‚</font><font style="vertical-align: inherit;">çº§åˆ«1æ˜¯ä½å¯†åº¦çš„ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨å•ä½é•¿åº¦ä¸ºè¾¹çš„ç«‹æ–¹ä½“è¡¨ç¤ºæ£šå±‹ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä¼šå°†2å±‚é¢„åˆ¶ä»¶çš„æ¯”ä¾‹ç¼©æ”¾ä¸ºï¼ˆ1.5ï¼Œ2ï¼Œ1.5ï¼‰ï¼Œä»¥ä½¿å…¶çœ‹èµ·æ¥åƒä¸€åº§ä¸¤å±‚æ¥¼çš„å»ºç­‘ã€‚</font><font style="vertical-align: inherit;">å¯¹äº3å±‚è¾ƒé«˜çš„å»ºç­‘ç‰©ï¼Œæˆ‘ä½¿ç”¨äº†æ¯”ä¾‹å°ºï¼ˆ2ã€5ã€2ï¼‰ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b83/4ad/cb6/b834adcb61a34d1e30cdec28925f066f.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d4f/41d/552/d4f41d5529d4716924345520ffc36280.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºåŸå¸‚åŒ–çš„æ¯ä¸ªçº§åˆ«ä½¿ç”¨ä¸åŒçš„é¢„åˆ¶ä»¶ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é¢„åˆ¶æ··åˆç‰© </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä¸éœ€è¦ä¸¥æ ¼é™åˆ¶å»ºç­‘ç‰©çš„ç±»å‹ã€‚æ‚¨å¯ä»¥å°†å®ƒä»¬æ··åœ¨ä¸€èµ·ï¼Œå°±åƒåœ¨ç°å®ä¸–ç•Œä¸­ä¸€æ ·ã€‚è®©æˆ‘ä»¬ä½¿ç”¨ä¸‰ä¸ªï¼Œè€Œä¸æ˜¯æ¯ä¸ªçº§åˆ«ä¸€ä¸ªé˜ˆå€¼ï¼Œæ¯ç§ç±»å‹çš„å»ºç­‘ç‰©ä¸€ä¸ªã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ç¬¬1çº§ï¼Œæˆ‘ä»¬åœ¨40ï¼…çš„æƒ…å†µä¸‹ä½¿ç”¨æ£šå±‹å¸ƒç½®ã€‚è¿™é‡Œæ ¹æœ¬æ²¡æœ‰å…¶ä»–å»ºç­‘ç‰©ã€‚å¯¹äºçº§åˆ«ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‰ä¸ªå€¼ï¼ˆ0.4ã€0ã€0ï¼‰ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ç¬¬2å±‚ï¼Œç”¨æ›´å¤§çš„å»ºç­‘ç‰©ä»£æ›¿æ£šå±‹ï¼Œå¹¶å¢åŠ 20ï¼…çš„æœºä¼šå¢åŠ æ£šå±‹ã€‚æˆ‘ä»¬ä¸ä¼šåšé«˜å±‚å»ºâ€‹â€‹ç­‘ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä½¿ç”¨é˜ˆå€¼ä¸‰ä¸ªå€¼ï¼ˆ0.2ã€0.4ã€0ï¼‰ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ç¬¬3å±‚ï¼Œæˆ‘ä»¬å°†é«˜å±‚å»ºç­‘æ›¿æ¢ä¸ºä¸­å‹å»ºç­‘ï¼Œå†æ¬¡æ›¿æ¢æ£šå±‹ï¼Œå†å¢åŠ 20ï¼…çš„æ£šå±‹æœºä¼šã€‚é˜ˆå€¼å°†ç­‰äºï¼ˆ0.2ï¼Œ0.2ï¼Œ0.4ï¼‰ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çš„æƒ³æ³•æ˜¯éšç€åŸå¸‚åŒ–æ°´å¹³çš„æé«˜ï¼Œæˆ‘ä»¬å°†å‡çº§ç°æœ‰å»ºç­‘ç‰©å¹¶å°†æ–°å»ºç­‘ç‰©æ·»åŠ åˆ°ç©ºæ—·çš„åœ°æ–¹ã€‚è¦åˆ é™¤ç°æœ‰å»ºç­‘ç‰©ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ç›¸åŒçš„å“ˆå¸Œå€¼é—´éš”ã€‚å¦‚æœçº§åˆ«1çš„0åˆ°0.4ä¹‹é—´çš„å“ˆå¸Œå€¼æ˜¯æ£šå±‹ï¼Œé‚£ä¹ˆçº§åˆ«3çš„ç›¸åŒé—´éš”å°†åˆ›å»ºé«˜å±‚å»ºç­‘ç‰©ã€‚åœ¨ç¬¬3å±‚ï¼Œåº”åˆ›å»ºå…·æœ‰0-0.4èŒƒå›´å†…çš„å“ˆå¸Œå€¼ï¼Œ0.4-0.6èŒƒå›´å†…çš„ä¸¤å±‚å»ºç­‘ç‰©ä»¥åŠ0.6-0.8èŒƒå›´å†…çš„æ£šå±‹çš„é«˜å±‚å»ºç­‘ç‰©ã€‚å¦‚æœä»æœ€å¤§åˆ°æœ€å°æ£€æŸ¥å®ƒä»¬ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä¸‰ä¸ªé˜ˆå€¼ï¼ˆ0.4ã€0.6ã€0.8ï¼‰æ¥å®Œæˆã€‚ç„¶åï¼Œçº§åˆ«2çš„é˜ˆå€¼å°†å˜ä¸ºï¼ˆ0ï¼Œ0.4ï¼Œ0.6ï¼‰ï¼Œçº§åˆ«1çš„é˜ˆå€¼å°†å˜ä¸ºï¼ˆ0ï¼Œ0ï¼Œ0.4ï¼‰ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å°†è¿™äº›é˜ˆå€¼ä¿å­˜åœ¨</font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½œä¸ºæ•°ç»„çš„é›†åˆï¼Œå…¶æ–¹æ³•å…è®¸æ‚¨è·å–ç‰¹å®šçº§åˆ«çš„é˜ˆå€¼ã€‚</font><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬ä»…å¯¹å¸¦æœ‰å¯¹è±¡çš„çº§åˆ«æ„Ÿå…´è¶£ï¼Œå› æ­¤å¿½ç•¥çº§åˆ«0ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[][] featureThresholds = { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] {<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.4f</span></span>}, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] {<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.4f</span></span>, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>}, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] {<span class="hljs-number"><span class="hljs-number">0.4f</span></span>, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>} }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function">[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetFeatureThresholds</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> featureThresholds[level]; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥ä¸‹æ¥ï¼Œæ·»åŠ åˆ°</font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨å“ˆå¸Œçº§åˆ«å’Œå€¼æ¥é€‰æ‹©é¢„åˆ¶çš„æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">å¦‚æœè¯¥çº§åˆ«å¤§äºé›¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½¿ç”¨å‡å°‘äº†ä¸€ä¸ªçº§åˆ«çš„é˜ˆå€¼æ¥è·å¾—é˜ˆå€¼ã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œæˆ‘ä»¬å¾ªç¯éå†é˜ˆå€¼ï¼Œç›´åˆ°å…¶ä¸­ä¸€ä¸ªé˜ˆå€¼è¶…è¿‡å“ˆå¸Œå€¼ä¸ºæ­¢ã€‚</font><font style="vertical-align: inherit;">è¿™æ„å‘³ç€æˆ‘ä»¬å·²ç»æ‰¾åˆ°äº†é¢„åˆ¶ä»¶ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™è¿”å›nullã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Transform </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PickPrefab</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hash</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (level &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] thresholds = HexMetrics.GetFeatureThresholds(level - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; thresholds.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hash &lt; thresholds[i]) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> urbanPrefabs[i]; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è¿™ç§æ–¹æ³•è¦æ±‚å¯¹é¢„åˆ¶ä»¶çš„é“¾æ¥è¿›è¡Œé‡æ–°æ’åºï¼Œä»¥ä½¿å®ƒä»¬ä»é«˜å¯†åº¦å˜ä¸ºä½å¯†åº¦ã€‚ </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4dc/eb5/80e/4dceb580e2410400a003b2ecad72d5c5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¢„åˆ¶è®¢å•å€’ç½®ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä½¿ç”¨æ–°æ–¹æ³•</font></font><code>AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥é€‰æ‹©é¢„åˆ¶ä»¶ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ²¡æœ‰æ”¶åˆ°ï¼Œåˆ™è·³è¿‡è¯¥å¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">å¦åˆ™ï¼Œåˆ›å»ºå®ƒçš„ä¸€ä¸ªå®ä¾‹ï¼Œç„¶ååƒä»¥å‰ä¸€æ ·ç»§ç»­ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, Vector3 position</span></span></span><span class="hljs-function">)</span></span> { HexHash hash = HexMetrics.SampleHashGrid(position); <span class="hljs-comment"><span class="hljs-comment">// if (hash.a &gt;= cell.UrbanLevel * 0.25f) { // return; // } // Transform instance = Instantiate(urbanPrefabs[cell.UrbanLevel - 1]); Transform prefab = PickPrefab(cell.UrbanLevel, hash.a); if (!prefab) { return; } Transform instance = Instantiate(prefab); position.y += instance.localScale.y * 0.5f; instance.localPosition = HexMetrics.Perturb(position); instance.localRotation = Quaternion.Euler(0f, 360f * hash.b, 0f); instance.SetParent(container, false); }</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d33/6f0/fcb/d336f0fcbf85285b38bb9c3de27ad77f.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ··åˆé¢„åˆ¶ä»¶ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ°´å¹³å˜åŒ– </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬æœ‰æ··åˆçš„å»ºç­‘ç‰©ï¼Œä½†æ˜¯åˆ°ç›®å‰ä¸ºæ­¢åªæœ‰ä¸‰åº§ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†é¢„åˆ¶ä»¶çš„é›†åˆä¸åŸå¸‚åŒ–å¯†åº¦çš„å„ä¸ªçº§åˆ«è”ç³»èµ·æ¥ï¼Œè¿›ä¸€æ­¥æé«˜å¯å˜æ€§ã€‚</font><font style="vertical-align: inherit;">ä¹‹åï¼Œå¯ä»¥éšæœºé€‰æ‹©å…¶ä¸­ä¹‹ä¸€ã€‚</font><font style="vertical-align: inherit;">è¿™å°†éœ€è¦ä¸€ä¸ªæ–°çš„éšæœºå€¼ï¼Œå› æ­¤æ·»åŠ ç¬¬ä¸‰ä¸ªc </font></font><code>HexHash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a, b, c; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HexHash </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexHash hash; hash.a = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; hash.b = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; hash.c = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hash; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å°†å…¶</font></font><code>HexFeatureManager.urbanPrefabs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å˜æˆä¸€ä¸ªæ•°ç»„æ•°ç»„ï¼Œç„¶åå‘methodä¸­æ·»åŠ ä¸€ä¸ª</font></font><code>PickPrefab</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‚æ•°</font></font><code>choice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä½¿ç”¨å®ƒæ¥é€‰æ‹©å†…ç½®æ•°ç»„çš„ç´¢å¼•ï¼Œå°†å…¶ä¹˜ä»¥è¯¥æ•°ç»„çš„é•¿åº¦ï¼Œç„¶åå°†å…¶è½¬æ¢ä¸ºæ•´æ•°ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform[][] urbanPrefabs; â€¦ <span class="hljs-function"><span class="hljs-function">Transform </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PickPrefab</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hash, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> choice</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (level &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] thresholds = HexMetrics.GetFeatureThresholds(level - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; thresholds.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hash &lt; thresholds[i]) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> urbanPrefabs[i][(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(choice * urbanPrefabs[i].Length)]; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬æ ¹æ®ç¬¬äºŒä¸ªå“ˆå¸Œï¼ˆBï¼‰çš„å€¼æ¥è¯æ˜æˆ‘ä»¬çš„é€‰æ‹©ã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œæ‚¨éœ€è¦ä»Bè½¬åˆ°Cã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, Vector3 position</span></span></span><span class="hljs-function">)</span></span> { HexHash hash = HexMetrics.SampleHashGrid(position); Transform prefab = PickPrefab(cell.UrbanLevel, hash.a, hash.b); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!prefab) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } Transform instance = Instantiate(prefab); position.y += instance.localScale.y * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.localPosition = HexMetrics.Perturb(position); instance.localRotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">360f</span></span> * hash.c, <span class="hljs-number"><span class="hljs-number">0f</span></span>); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ç»§ç»­ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘</font></font><code>Random.value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯èƒ½è¿”å›å€¼1çš„å†…å®¹ã€‚å› æ­¤ï¼Œæ•°ç»„ç´¢å¼•å¯èƒ½ä¼šè¶…å‡ºèŒƒå›´ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œè®©æˆ‘ä»¬ç¨å¾®è°ƒæ•´ä¸€ä¸‹å“ˆå¸Œå€¼ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬åªæ˜¯å°†å®ƒä»¬å…¨éƒ¨ç¼©æ”¾ï¼Œä»¥å…æ‹…å¿ƒæˆ‘ä»¬ä½¿ç”¨çš„ç‰¹å®šå¯¹è±¡ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HexHash </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexHash hash; hash.a = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * <span class="hljs-number"><span class="hljs-number">0.999f</span></span>; hash.b = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * <span class="hljs-number"><span class="hljs-number">0.999f</span></span>; hash.c = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * <span class="hljs-number"><span class="hljs-number">0.999f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hash; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸å¹¸çš„æ˜¯ï¼Œæ£€æŸ¥å™¨ä¸ä¼šæ˜¾ç¤ºæ•°ç»„çš„æ•°ç»„ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬æ— æ³•å¯¹å…¶è¿›è¡Œé…ç½®ã€‚</font><font style="vertical-align: inherit;">è¦è§£å†³æ­¤é™åˆ¶ï¼Œè¯·åˆ›å»ºä¸€ä¸ªå¯åºåˆ—åŒ–çš„ç»“æ„ä»¥å°†å†…ç½®æ•°ç»„å°è£…åˆ°å…¶ä¸­ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ç»™å¥¹ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ä»¥ä»é€‰æ‹©è½¬æ¢ä¸ºæ•°ç»„ç´¢å¼•å¹¶è¿”å›ä¸€ä¸ªé¢„åˆ¶ã€‚</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; [System.Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> HexFeatureCollection { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform[] prefabs; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Transform </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Pick</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> choice</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prefabs[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(choice * prefabs.Length)]; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä½¿ç”¨</font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­¤ç±»é›†åˆçš„æ•°ç»„ä»£æ›¿å†…ç½®æ•°ç»„ã€‚</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// public Transform[][] urbanPrefabs; public HexFeatureCollection[] urbanCollections; â€¦ Transform PickPrefab (int level, float hash, float choice) { if (level &gt; 0) { float[] thresholds = HexMetrics.GetFeatureThresholds(level - 1); for (int i = 0; i &lt; thresholds.Length; i++) { if (hash &lt; thresholds[i]) { return urbanCollections[i].Pick(choice); } } } return null; }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªå¯†åº¦çº§åˆ«åˆ†é…å‡ åº§å»ºç­‘ç‰©ã€‚</font><font style="vertical-align: inherit;">ç”±äºå®ƒä»¬æ˜¯ç‹¬ç«‹çš„ï¼Œå› æ­¤æˆ‘ä»¬ä¸å¿…åœ¨æ¯ä¸ªçº§åˆ«ä½¿ç”¨ç›¸åŒçš„æ•°é‡ã€‚</font><font style="vertical-align: inherit;">æˆ‘åªåœ¨æ¯ä¸ªçº§åˆ«ä¸Šä½¿ç”¨äº†ä¸¤ä¸ªé€‰é¡¹ï¼Œä¸ºæ¯ä¸ªçº§åˆ«æ·»åŠ äº†ä¸€ä¸ªæ›´é•¿çš„è¾ƒä½é€‰é¡¹ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä¸ºå®ƒä»¬é€‰æ‹©äº†æ¯”ä¾‹ï¼ˆ3.5ã€3ã€2ï¼‰ï¼Œï¼ˆ2.75ã€1.5ã€1.5ï¼‰å’Œï¼ˆ1.75ã€1ã€1ï¼‰ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b71/a6e/c9f/b71a6ec9f2c379c223e007dda071c94b.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a72/618/81d/a7261881d23703b54aaf22ba59942d2a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¯ä¸ªå¯†åº¦çº§åˆ«æœ‰ä¸¤ç§ç±»å‹çš„å»ºç­‘ç‰©ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å‡ ç§ç‰©ä½“ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ç°æœ‰æ–¹æ¡ˆä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºç›¸å½“æœ‰ä»·å€¼çš„åŸå¸‚ç»“æ„ã€‚</font><font style="vertical-align: inherit;">ä½†æ•‘æµå¯èƒ½ä¸ä»…åŒ…æ‹¬å»ºç­‘ç‰©ã€‚</font><font style="vertical-align: inherit;">å†œåœºæˆ–æ¤ç‰©æ€ä¹ˆæ ·ï¼Ÿ</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬</font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºå®ƒä»¬</font><font style="vertical-align: inherit;">æ·»åŠ </font><font style="vertical-align: inherit;">çº§åˆ«ã€‚</font><font style="vertical-align: inherit;">å®ƒä»¬ä¸æ˜¯äº’æ–¥çš„å¹¶ä¸”å¯ä»¥æ··åˆã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> FarmLevel { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> farmLevel; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (farmLevel != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { farmLevel = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; RefreshSelfOnly(); } } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> PlantLevel { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> plantLevel; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (plantLevel != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { plantLevel = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; RefreshSelfOnly(); } } } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> urbanLevel, farmLevel, plantLevel;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“ç„¶ï¼Œè¿™éœ€è¦</font></font><code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦å¤–ä¸¤ä¸ªæ»‘å—çš„</font><font style="vertical-align: inherit;">æ”¯æŒ</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> activeUrbanLevel, activeFarmLevel, activePlantLevel; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> applyUrbanLevel, applyFarmLevel, applyPlantLevel; â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetApplyFarmLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> toggle</span></span></span><span class="hljs-function">)</span></span> { applyFarmLevel = toggle; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetFarmLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level</span></span></span><span class="hljs-function">)</span></span> { activeFarmLevel = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)level; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetApplyPlantLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> toggle</span></span></span><span class="hljs-function">)</span></span> { applyPlantLevel = toggle; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetPlantLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level</span></span></span><span class="hljs-function">)</span></span> { activePlantLevel = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)level; } â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell) { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyUrbanLevel) { cell.UrbanLevel = activeUrbanLevel; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyFarmLevel) { cell.FarmLevel = activeFarmLevel; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyPlantLevel) { cell.PlantLevel = activePlantLevel; } â€¦ } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å°†å®ƒä»¬æ·»åŠ åˆ°ç”¨æˆ·ç•Œé¢ã€‚ </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/956/70b/f35/95670bf35594faa69fe46201b78080f7.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸‰ä¸ªæ»‘å—ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦å¤–ï¼Œå°†éœ€è¦å…¶ä»–é›†åˆ</font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexFeatureCollection[] urbanCollections, farmCollections, plantCollections;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f5d/001/cec/f5d001cecb2bee3c60a0dad637de7dc9.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ•‘æµå¯¹è±¡çš„ä¸‰ä¸ªé›†åˆã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä¸ºå†œåœºå’Œå·¥å‚åˆ›å»ºäº†æ¯ä¸ªå¯†åº¦çº§åˆ«çš„ä¸¤ä¸ªé¢„åˆ¶ä»¶ï¼Œä»¥åŠå»ºç­‘ç‰©é›†åˆã€‚å¯¹äºæ‰€æœ‰è¿™äº›ï¼Œæˆ‘éƒ½ä½¿ç”¨äº†å¤šç»´æ•°æ®é›†ã€‚å†œåœºæœ‰æµ…ç»¿è‰²çš„ç‰©è´¨ï¼Œæ¤ç‰©æœ‰æ·±ç»¿è‰²çš„ç‰©è´¨ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘åˆ¶ä½œäº†é«˜åº¦ä¸º0.1ä¸ªå•ä½çš„å†œåœºç«‹æ–¹ä½“ï¼Œä»¥è¡¨ç¤ºå†œç”°çš„æ–¹å½¢åˆ†é…ã€‚ä½œä¸ºé«˜å¯†åº¦æ ‡åº¦ï¼Œæˆ‘é€‰æ‹©äº†ï¼ˆ2.5ï¼Œ0.1ï¼Œ2.5ï¼‰å’Œï¼ˆ3.5ï¼Œ0.1ï¼Œ2ï¼‰ã€‚å¹³å‡è€Œè¨€ï¼Œç«™ç‚¹çš„é¢ç§¯ä¸º1.75ï¼Œå¤§å°ä¸º2.5 x 1.25ã€‚åœ¨åŒºåŸŸ1å¤„è·å¾—çš„å¯†åº¦è¾ƒä½ï¼Œå°ºå¯¸ä¸º1.5 x 0.75ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¢„åˆ¶æ¤ç‰©è¡¨ç¤ºé«˜å¤§çš„æ ‘æœ¨å’Œå¤§å‹çŒæœ¨ã€‚é«˜å¯†åº¦é¢„åˆ¶ä»¶æœ€å¤§ï¼Œåˆ†åˆ«ä¸ºï¼ˆ1.25ï¼Œ4.5ï¼Œ1.25ï¼‰å’Œï¼ˆ1.5ï¼Œ3ï¼Œ1.5ï¼‰ã€‚å¹³å‡æ¯”ä¾‹ä¸ºï¼ˆ0.75ã€3ã€0.75ï¼‰å’Œï¼ˆ1ã€1.5ã€1ï¼‰ã€‚æœ€å°çš„æ¤ç‰©å¤§å°åˆ†åˆ«ä¸ºï¼ˆ0.5ã€1.5ã€0.5ï¼‰å’Œï¼ˆ0.75ã€1ã€0.75ï¼‰ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æµ®é›•ç‰¹å¾çš„é€‰æ‹© </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¯ç§ç±»å‹çš„å¯¹è±¡éƒ½å¿…é¡»æ¥æ”¶è‡ªå·±çš„å“ˆå¸Œå€¼ï¼Œä»¥ä¾¿å®ƒä»¬å…·æœ‰ä¸åŒçš„åˆ›å»ºæ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥æ··åˆä½¿ç”¨å®ƒä»¬ã€‚</font><font style="vertical-align: inherit;">æ·»åŠ </font></font><code>HexHash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸¤ä¸ªé™„åŠ å€¼ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a, b, c, d, e; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HexHash </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexHash hash; hash.a = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * <span class="hljs-number"><span class="hljs-number">0.999f</span></span>; hash.b = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * <span class="hljs-number"><span class="hljs-number">0.999f</span></span>; hash.c = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * <span class="hljs-number"><span class="hljs-number">0.999f</span></span>; hash.d = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * <span class="hljs-number"><span class="hljs-number">0.999f</span></span>; hash.e = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * <span class="hljs-number"><span class="hljs-number">0.999f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hash; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæ‚¨å¿…é¡»</font></font><code>HexFeatureManager.PickPrefab</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨ä¸åŒçš„é›†åˆã€‚</font><font style="vertical-align: inherit;">æ·»åŠ å‚æ•°ä»¥ç®€åŒ–è¿‡ç¨‹ã€‚</font><font style="vertical-align: inherit;">å¦å¤–ï¼Œå°†æ‰€é€‰é¢„åˆ¶ä»¶çš„å˜ä½“ä½¿ç”¨çš„å“ˆå¸Œæ›´æ”¹ä¸ºDï¼Œå¹¶å°†æ—‹è½¬çš„å“ˆå¸Œæ›´æ”¹ä¸ºEã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Transform </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PickPrefab</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexFeatureCollection[] collection, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hash, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> choice </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (level &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] thresholds = HexMetrics.GetFeatureThresholds(level - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; thresholds.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hash &lt; thresholds[i]) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> collection[i].Pick(choice); } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, Vector3 position</span></span></span><span class="hljs-function">)</span></span> { HexHash hash = HexMetrics.SampleHashGrid(position); Transform prefab = PickPrefab( urbanCollections, cell.UrbanLevel, hash.a, hash.d ); â€¦ instance.localRotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">360f</span></span> * hash.e, <span class="hljs-number"><span class="hljs-number">0f</span></span>); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›®å‰</font></font><code>AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€‰æ‹©é¢„åˆ¶åŸå¸‚åŒ–ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œæˆ‘ä»¬éœ€è¦æ›´å¤šé€‰æ‹©ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬ä»å†œåœºä¸­æ·»åŠ äº†å¦ä¸€ä¸ªé¢„åˆ¶ä»¶ã€‚</font><font style="vertical-align: inherit;">ä½œä¸ºå“ˆå¸Œå€¼ï¼Œè¯·ä½¿ç”¨Bã€‚é€‰é¡¹çš„é€‰æ‹©å°†å†æ¬¡ä¸ºDã€‚</font></font><br><br><pre> <code class="cs hljs"> Transform prefab = PickPrefab( urbanCollections, cell.UrbanLevel, hash.a, hash.d ); Transform otherPrefab = PickPrefab( farmCollections, cell.FarmLevel, hash.b, hash.d ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!prefab) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»“æœï¼Œæˆ‘ä»¬å°†åˆ›å»ºå“ªç§é¢„åˆ¶å®ä¾‹ï¼Ÿ</font><font style="vertical-align: inherit;">å¦‚æœå…¶ä¸­ä¹‹ä¸€ä¸ºç©ºï¼Œåˆ™é€‰æ‹©æ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå¦‚æœä¸¤è€…éƒ½å­˜åœ¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦åšå‡ºå†³å®šã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬åªæ·»åŠ å…·æœ‰æœ€ä½å“ˆå¸Œå€¼çš„é¢„åˆ¶ä»¶ã€‚</font></font><br><br><pre> <code class="cs hljs"> Transform otherPrefab = PickPrefab( farmCollections, cell.FarmLevel, hash.b, hash.d ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prefab) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab &amp;&amp; hash.b &lt; hash.a) { prefab = otherPrefab; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab) { prefab = otherPrefab; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/baf/369/d71/baf369d71420a1ded309880b38d94c53.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŸä¹¡æ··åˆä½“ã€‚</font></font></i> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥ä¸‹æ¥ï¼Œä½¿ç”¨Cå“ˆå¸Œå€¼å¯¹æ¤ç‰©è¿›è¡Œç›¸åŒçš„å¤„ç†ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prefab) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab &amp;&amp; hash.b &lt; hash.a) { prefab = otherPrefab; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab) { prefab = otherPrefab; } otherPrefab = PickPrefab( plantCollections, cell.PlantLevel, hash.c, hash.d ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prefab) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab &amp;&amp; hash.c &lt; hash.a) { prefab = otherPrefab; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab) { prefab = otherPrefab; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½åªå¤åˆ¶ä»£ç ã€‚</font><font style="vertical-align: inherit;">å½“æˆ‘ä»¬é€‰æ‹©å†œæ‘è€Œä¸æ˜¯åŸå¸‚å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†æ¤ç‰©çš„å“ˆå¸Œä¸å†œåœºçš„å“ˆå¸Œè¿›è¡Œæ¯”è¾ƒï¼Œè€Œä¸æ˜¯ä¸åŸå¸‚çš„å“ˆå¸Œè¿›è¡Œæ¯”è¾ƒã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è·Ÿè¸ªæˆ‘ä»¬å†³å®šé€‰æ‹©çš„å“ˆå¸Œå¹¶ä¸ä¹‹è¿›è¡Œæ¯”è¾ƒã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> usedHash = hash.a; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prefab) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab &amp;&amp; hash.b &lt; hash.a) { prefab = otherPrefab; usedHash = hash.b; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab) { prefab = otherPrefab; usedHash = hash.b; } otherPrefab = PickPrefab( plantCollections, cell.PlantLevel, hash.c, hash.d ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prefab) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab &amp;&amp; hash.c &lt; usedHash) { prefab = otherPrefab; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab) { prefab = otherPrefab; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8eb/2e2/215/8eb2e2215e6219b08e8bc42612b31493.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŸå¸‚ï¼Œå†œæ‘å’Œæ¤ç‰©çš„æ··åˆç‰©ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç¬¬10éƒ¨åˆ†ï¼šå¢™ </font></font></h1><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬å›´ä½å•å…ƒæ ¼ã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬æ²¿ç€ç»†èƒè¾¹ç¼˜å»ºé€ å¢™ã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è®©æˆ‘ä»¬ç©¿è¶Šæ²³æµå’Œé“è·¯ã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é¿å…æµ‡æ°´ï¼Œå¹¶ä¸æ‚¬å´–ç›¸è¿ã€‚ </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨å¢™çš„å•å…ƒä¹‹é—´æ·»åŠ ã€‚ </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/924/d07/0cd/924d070cd67c3baccf02a0284ef9cdc4.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²¡æœ‰ä»€ä¹ˆæ¯”ä¸€å µé«˜å¢™æ›´å…·å¸å¼•åŠ›äº†ã€‚</font></font></i> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¢™é¢ç¼–è¾‘ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†æ”¯æ’‘å¢™å£ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“å°†å¢™å£æ”¾ç½®åœ¨ä½•å¤„ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†å®ƒä»¬æ²¿ç€è¿æ¥å®ƒä»¬çš„è¾¹ç¼˜æ”¾åœ¨å•å…ƒä¹‹é—´ã€‚</font><font style="vertical-align: inherit;">ç”±äºå·²ç»å­˜åœ¨çš„å¯¹è±¡ä½äºå•å…ƒçš„ä¸­å¤®ï¼Œå› æ­¤æˆ‘ä»¬ä¸å¿…æ‹…å¿ƒå£ä¼šç©¿è¿‡å®ƒä»¬ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a1/bbb/c11/7a1bbbc1158301bb0091638858fa79fd.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²¿è¾¹ç¼˜çš„å¢™å£ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¢™æ˜¯åœ°å½¢ç‰©ä½“ï¼Œå°½ç®¡å¾ˆå¤§ã€‚</font><font style="vertical-align: inherit;">ä¸å…¶ä»–å¯¹è±¡ä¸€æ ·ï¼Œæˆ‘ä»¬ä¸ä¼šç›´æ¥å¯¹å…¶è¿›è¡Œç¼–è¾‘ã€‚</font><font style="vertical-align: inherit;">ç›¸åï¼Œæˆ‘ä»¬å°†æ›´æ”¹å•å…ƒæ ¼ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä¸ä¼šåœ¨å¢™å£ä¸Šæœ‰å•ç‹¬çš„éƒ¨åˆ†ï¼Œä½†æ˜¯ä¼šæŠŠæ•´ä¸ªç»†èƒå›´èµ·æ¥ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åŸå¢™è´¢äº§ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦æ”¯æŒå›´æ …å•å…ƒï¼Œè¯·æ·»åŠ åˆ°</font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å±æ€§</font></font><code>Walled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯ä¸€ä¸ªç®€å•çš„å¼€å…³ã€‚</font><font style="vertical-align: inherit;">ç”±äºå¢™å£ä½äºå•å…ƒä¹‹é—´ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ›´æ–°å·²ç¼–è¾‘çš„å•å…ƒåŠå…¶ç›¸é‚»å•å…ƒã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Walled { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> walled; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (walled != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { walled = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; Refresh(); } } } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> walled;</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç¼–è¾‘å™¨å¼€å…³ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦åˆ‡æ¢å•å…ƒæ ¼çš„â€œéš”ç¦»çŠ¶æ€â€ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ </font></font><code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹åˆ‡â€‹â€‹æ¢çš„æ”¯æŒã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬æ·»åŠ äº†å¦ä¸€ä¸ªå­—æ®µ</font></font><code>OptionalToggle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŠå…¶è®¾ç½®æ–¹æ³•ã€‚</font></font><br><br><pre> <code class="cs hljs"> OptionalToggle riverMode, roadMode, walledMode; â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetWalledMode</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mode</span></span></span><span class="hljs-function">)</span></span> { walledMode = (OptionalToggle)mode; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸æ²³æµå’Œé“è·¯ä¸åŒï¼Œå›´å¢™ä¸æ˜¯ä»ä¸€ä¸ªå•å…ƒåˆ°å¦ä¸€ä¸ªå•å…ƒçš„ï¼Œè€Œæ˜¯åœ¨å®ƒä»¬ä¹‹é—´ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬æ— éœ€è€ƒè™‘æ‹–æ”¾ã€‚</font><font style="vertical-align: inherit;">å½“å¢™å£å¼€å…³å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬ä»…åŸºäºæ­¤å¼€å…³çš„çŠ¶æ€æ¥è®¾ç½®å½“å‰å•å…ƒçš„éš”ç¦»çŠ¶æ€ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell) { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (roadMode == OptionalToggle.No) { cell.RemoveRoads(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (walledMode != OptionalToggle.Ignore) { cell.Walled = walledMode == OptionalToggle.Yes; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isDrag) { â€¦ } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¤åˆ¶UIå¼€å…³çš„å…ˆå‰å…ƒç´ ä¹‹ä¸€ï¼Œå¹¶å¯¹å…¶è¿›è¡Œæ›´æ”¹ï¼Œä»¥ä½¿å®ƒä»¬æ§åˆ¶â€œå›´æ â€çš„çŠ¶æ€ã€‚</font><font style="vertical-align: inherit;">æˆ‘å°†å®ƒä»¬ä¸å…¶ä»–å¯¹è±¡ä¸€èµ·æ”¾åœ¨UIé¢æ¿ä¸­ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0ac/f7f/0ca/0acf7f0caaaae171e31d42141fa75947.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¼€å…³â€œå›´æ â€ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åˆ›å»ºå¢™ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºå£éµå¾ªå•å…ƒçš„è½®å»“ï¼Œå› æ­¤å®ƒä»¬ä¸åº”å…·æœ‰æ’å®šçš„å½¢çŠ¶ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬ä¸èƒ½åƒå…¶ä»–åœ°å½¢ç‰¹å¾é‚£æ ·ä»…å¯¹å®ƒä»¬ä½¿ç”¨é¢„åˆ¶ä»¶ã€‚</font><font style="vertical-align: inherit;">ç›¸åï¼Œæˆ‘ä»¬éœ€è¦åƒä½¿ç”¨æµ®é›•ä¸€æ ·æ„å»ºä¸€ä¸ªç½‘æ ¼ã€‚</font><font style="vertical-align: inherit;">è¿™æ„å‘³ç€æˆ‘ä»¬çš„é¢„åˆ¶ç‰‡æ®µéœ€è¦å¦ä¸€ä¸ªå­å…ƒç´ </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å¤åˆ¶å…¶ä»–å­ç½‘æ ¼ä¹‹ä¸€ï¼Œå¹¶ä½¿æ–°çš„</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Walls</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹è±¡</font><font style="vertical-align: inherit;">æŠ•å°„é˜´å½±ã€‚</font><font style="vertical-align: inherit;">é™¤äº†é¡¶ç‚¹å’Œä¸‰è§’å½¢å¤–ï¼Œå®ƒä»¬ä¸éœ€è¦ä»»ä½•å…¶ä»–å†…å®¹ï¼Œå› æ­¤</font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¿…é¡»ç¦ç”¨</font><font style="vertical-align: inherit;">æ‰€æœ‰é€‰é¡¹</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/615/387/31d/61538731d2eed271c9348c4da2f5d844.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2bf/c6e/af5/2bfc6eaf5ff31f5467ab252c00b7bcce.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å­å…¬å¸é¢„åˆ¶å¢™ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¢™å£æ˜¯åŸå¸‚ç‰©ä½“ï¼Œè¿™æ˜¯åˆä¹é€»è¾‘çš„ï¼Œæ‰€ä»¥å¯¹äºå®ƒä»¬ï¼Œæˆ‘ä½¿ç”¨å»ºç­‘ç‰©çš„çº¢è‰²ææ–™ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¢™é¢ç®¡ç† </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºå¢™å£æ˜¯æ•‘æµçš„å¯¹è±¡ï¼Œå› æ­¤å¿…é¡»åŠ ä»¥å¤„ç†</font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å°†ç»™æ•‘æµå¯¹è±¡çš„ç®¡ç†è€…ä¸€ä¸ªæŒ‡å‘</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Walls</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹è±¡çš„é“¾æ¥</font><font style="vertical-align: inherit;">ï¼Œå¹¶ä½¿å®ƒè°ƒç”¨</font></font><code>Clear</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font><font style="vertical-align: inherit;">æ–¹æ³•</font></font><code>Apply</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexMesh walls; â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ walls.Clear(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Apply</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { walls.Apply(); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/31d/8f9/0f3/31d8f90f315c7aa43910c67aab6b73cb.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¢™è¿æ¥åˆ°åœ°å½¢ç®¡ç†å™¨ã€‚</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wallsä¸åº”è¯¥æˆä¸ºFeatureçš„å­ä»£å—ï¼Ÿ</font></font></b> <div class="spoiler_text">       ,   .             ,    <em>Walls</em>    <em>Hex Grid Chunk</em> . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å‘ç®¡ç†å™¨æ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…è®¸æˆ‘ä»¬å‘å…¶æ·»åŠ å¢™ã€‚</font><font style="vertical-align: inherit;">ç”±äºå¢™å£æ²¿ç€å•å…ƒä¹‹é—´çš„è¾¹ç¼˜ï¼Œå› æ­¤ä»–éœ€è¦çŸ¥é“è¾¹ç¼˜å’Œå•å…ƒçš„ç›¸åº”é¡¶ç‚¹ã€‚</font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¼š</font></font><code>TriangulateConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å¯¹å•å…ƒæ ¼åŠå…¶é‚»å±…ä¹‹ä¸€è¿›è¡Œä¸‰è§’å‰–åˆ†æ—¶</font><font style="vertical-align: inherit;">ä½¿å…¶é€šè¿‡</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä»è¿™ä¸ªè§’åº¦æ¥çœ‹ï¼Œå½“å‰å•å…ƒæ ¼åœ¨å¢™çš„è¿‘ä¾§ï¼Œå¦ä¸€ä¸ªåœ¨è¿œä¾§ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWall</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices near, HexCell nearCell, EdgeVertices far, HexCell farCell </span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br><font style="vertical-align: inherit;"></font><code>HexGridChunk.TriangulateConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å®Œæˆæ‰€æœ‰å…¶ä»–è¿æ¥å·¥ä½œä¹‹åä»¥åŠç´§æ¥è¿‡æ¸¡åˆ°ä¸‰è§’å½¢ä¸‰è§’å½¢ä¹‹å‰ï¼Œ</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†è°ƒç”¨æ­¤æ–°æ–¹æ³•</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†è®©æ•‘æµå¯¹è±¡çš„ç®¡ç†è€…è‡ªå·±å†³å®šå¢™åº”å®é™…ä½äºçš„ä½ç½®ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateConnection</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, EdgeVertices e1 </span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.GetEdgeType(direction) == HexEdgeType.Slope) { â€¦ } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { â€¦ } features.AddWall(e1, cell, e2, neighbor); HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.E &amp;&amp; nextNeighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { â€¦ } }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å»ºé€ å¢™æ®µ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ•´ä¸ªå¢™å£å°†èœ¿èœ’ç©¿è¿‡ç»†èƒçš„å‡ ä¸ªè¾¹ç¼˜ã€‚</font><font style="vertical-align: inherit;">æ¯ä¸ªè¾¹ç¼˜ä»…åŒ…å«ä¸€ä¸ªå¢™å…ƒç´ ã€‚</font><font style="vertical-align: inherit;">ä»è¿‘å•å…ƒçš„è§’åº¦æ¥çœ‹ï¼Œè¯¥æ®µä»è‚‹çš„å·¦ä¾§å¼€å§‹ï¼Œåœ¨å³ä¾§ç»ˆæ­¢ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ª</font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å•ç‹¬çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨ä¸€æ¡è¾¹çš„è§’ä¸Šä½¿ç”¨å››ä¸ªé¡¶ç‚¹ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 nearLeft, Vector3 farLeft, Vector3 nearRight, Vector3 farRight </span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f32/2a0/d7b/f322a0d7bc325b13f65c62cfb76b2d0c.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿‘ç«¯å’Œè¿œç«¯ã€‚</font></font></i> <br><br> <code>AddWall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯ä»¥ä½¿ç”¨è¾¹ç¼˜çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªè¾¹ç¼˜è°ƒç”¨æ­¤æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œä»…å½“æˆ‘ä»¬åœ¨å›´æ …å•å…ƒå’Œéå›´æ …å•å…ƒä¹‹é—´å»ºç«‹è¿æ¥æ—¶ï¼Œæ‰åº”æ·»åŠ å¢™ã€‚</font><font style="vertical-align: inherit;">å“ªä¸€ä¸ªå•å…ƒåœ¨å†…éƒ¨å’Œå“ªä¸ªå•å…ƒåœ¨å¤–éƒ¨éƒ½æ²¡æœ‰å…³ç³»ï¼Œä»…è€ƒè™‘å…¶çŠ¶æ€çš„å·®å¼‚ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWall</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices near, HexCell nearCell, EdgeVertices far, HexCell farCell </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nearCell.Walled != farCell.Walled) { AddWallSegment(near.v1, far.v1, near.v5, far.v5); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¢™çš„æœ€ç®€å•éƒ¨åˆ†æ˜¯å››åˆ†ä¹‹ä¸€ï¼Œä½äºè‚‹éª¨çš„ä¸­é—´ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä¼šå‘ç°å…¶è¾ƒä½çš„å³°ï¼Œä»æœ€è¿‘åˆ°æœ€è¿œçš„å³°æ’å€¼åˆ°ä¸­é—´ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 nearLeft, Vector3 farLeft, Vector3 nearRight, Vector3 farRight </span></span></span><span class="hljs-function">)</span></span> { Vector3 left = Vector3.Lerp(nearLeft, farLeft, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); Vector3 right = Vector3.Lerp(nearRight, farRight, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¢™åº”è¯¥å¤šé«˜ï¼Ÿ</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å°†å…¶é«˜åº¦è®¾ç½®ä¸º</font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘å°†å®ƒä»¬è®¾ç½®ä¸ºä¸€ä¸ªå•å…ƒæ ¼é«˜åº¦çº§åˆ«çš„å¤§å°ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> wallHeight = <span class="hljs-number"><span class="hljs-number">3f</span></span>;</code> </pre> <br> <code>HexFeatureManager.AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯ä»¥ä½¿ç”¨æ­¤é«˜åº¦æ¥å®šä½å››è¾¹å½¢çš„ç¬¬ä¸‰å’Œç¬¬å››é¡¶ç‚¹ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°ç½‘æ ¼ä¸­</font></font><code>walls</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> Vector3 left = Vector3.Lerp(nearLeft, farLeft, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); Vector3 right = Vector3.Lerp(nearRight, farRight, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); Vector3 v1, v2, v3, v4; v1 = v3 = left; v2 = v4 = right; v3.y = v4.y = left.y + HexMetrics.wallHeight; walls.AddQuad(v1, v2, v3, v4);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å¯ä»¥ç¼–è¾‘å¢™å£ï¼Œå®ƒä»¬å°†æ˜¾ç¤ºä¸ºå››è¾¹å½¢æ¡çº¹ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸ä¼šçœ‹åˆ°è¿ç»­çš„å¢™ã€‚</font><font style="vertical-align: inherit;">æ¯ä¸ªå››è¾¹å½¢ä»…åœ¨ä¸€ä¾§å¯è§ã€‚</font><font style="vertical-align: inherit;">å®ƒçš„è„¸æœå‘æ·»åŠ å®ƒçš„å•å…ƒæ ¼ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e5a/2f0/442/e5a2f0442a2d1812b73dd2977d80d565.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å•é¢å››è¾¹å½¢å¢™ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ç›¸åçš„æ–¹å¼æ·»åŠ ç¬¬äºŒä¸ªå››è¾¹å½¢æ¥å¿«é€Ÿè§£å†³æ­¤é—®é¢˜ã€‚</font></font><br><br><pre> <code class="cs hljs"> walls.AddQuad(v1, v2, v3, v4); walls.AddQuad(v2, v1, v4, v3);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/302/e53/129/302e53129e87c3432848772688e9d896.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒè¾¹å¢™ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæ‰€æœ‰å¢™å£éƒ½å¯ä»¥å®Œæ•´çœ‹åˆ°ï¼Œä½†æ˜¯åœ¨ä¸‰ä¸ªå•å…ƒç›¸äº¤çš„å•å…ƒçš„è§’è½ä»ç„¶æœ‰å­”ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ç¨åä¼šå¡«å†™ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åšå£ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°½ç®¡å¢™å£çš„ä¸¤ä¾§éƒ½å·²ç»å¯è§ï¼Œä½†æ˜¯å®ƒä»¬æ²¡æœ‰åšåº¦ã€‚</font><font style="vertical-align: inherit;">å®é™…ä¸Šï¼Œå¢™å£å¾ˆè–„ï¼Œå°±åƒçº¸ä¸€æ ·ï¼Œå¹¶ä¸”åœ¨ä¸€å®šè§’åº¦å‡ ä¹çœ‹ä¸è§ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œè®©æˆ‘ä»¬é€šè¿‡å¢åŠ åšåº¦æ¥ä½¿å®ƒä»¬å®Œæ•´ã€‚</font><font style="vertical-align: inherit;">åœ¨ä¸­è®¾ç½®å…¶åšåº¦</font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘é€‰æ‹©0.75å•ä½çš„å€¼ï¼Œå¯¹æˆ‘æ¥è¯´ä¼¼ä¹å¾ˆåˆé€‚ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> wallThickness = <span class="hljs-number"><span class="hljs-number">0.75f</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦ä½¿ä¸¤å µå¢™å˜åšï¼Œéœ€è¦å°†ä¸¤ä¸ªå››è¾¹å½¢åˆ†å¼€åˆ°ä¾§é¢ã€‚</font><font style="vertical-align: inherit;">å®ƒä»¬åº”æœç›¸åçš„æ–¹å‘ç§»åŠ¨ã€‚</font><font style="vertical-align: inherit;">ä¸€ä¾§åº”ç§»å‘è¿‘è¾¹ç¼˜ï¼Œå¦ä¸€ä¾§åº”ç§»å‘è¿œè¾¹ç¼˜ã€‚</font><font style="vertical-align: inherit;">åç§»å‘é‡æ˜¯ç›¸ç­‰çš„</font></font><code>far - near</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä½†</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦ä½¿</font><font style="vertical-align: inherit;">å¢™çš„é¡¶éƒ¨ä¿æŒå¹³å¦ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶åˆ†é‡Yè®¾ç½®ä¸º0ã€‚</font><font style="vertical-align: inherit;">ç”±äºéœ€è¦å¯¹å£æ®µçš„å·¦ä¾§å’Œå³ä¾§éƒ½è¿›è¡Œæ­¤æ“ä½œï¼Œå› æ­¤ï¼Œè¯·å‘è¯¥</font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–¹æ³•</font><font style="vertical-align: inherit;">æ·»åŠ </font><font style="vertical-align: inherit;">åç§»å‘é‡</font><font style="vertical-align: inherit;">ä»¥</font><font style="vertical-align: inherit;">è¿›è¡Œè®¡ç®—ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WallThicknessOffset</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 near, Vector3 far</span></span></span><span class="hljs-function">)</span></span> { Vector3 offset; offset.x = far.x - near.x; offset.y = <span class="hljs-number"><span class="hljs-number">0f</span></span>; offset.z = far.z - near.z; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> offset; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†ä½¿å£ä¿ç•™åœ¨è‚‹éª¨çš„ä¸­å¿ƒï¼Œæ²¿è¯¥çŸ¢é‡çš„å®é™…ç§»åŠ¨è·ç¦»åº”ç­‰äºæ¯ä¾§åšåº¦çš„ä¸€åŠã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†ç¡®ä¿æˆ‘ä»¬ç¡®å®ç§»åŠ¨äº†æ­£ç¡®çš„è·ç¦»ï¼Œæˆ‘ä»¬åœ¨ç¼©æ”¾ä½ç§»å‘é‡ä¹‹å‰å¯¹å…¶è¿›è¡Œäº†å½’ä¸€åŒ–ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> offset.normalized * (wallThickness * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä½¿ç”¨æ­¤æ–¹æ³•</font></font><code>HexFeatureManager.AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥æ›´æ”¹å››è¾¹å½¢çš„ä½ç½®ã€‚</font><font style="vertical-align: inherit;">ç”±äºä½ç§»çŸ¢é‡ä»æœ€è¿‘çš„å•å…ƒæ ¼åˆ°æœ€è¿œçš„å•å…ƒæ ¼ï¼Œå› æ­¤ä»è¿‘å››è¾¹å½¢å‡å»å®ƒï¼Œç„¶ååŠ åˆ°è¿œä¸€å•å…ƒæ ¼ä¸Šã€‚</font></font><br><br><pre> <code class="cs hljs"> Vector3 left = Vector3.Lerp(nearLeft, farLeft, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); Vector3 right = Vector3.Lerp(nearRight, farRight, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); Vector3 leftThicknessOffset = HexMetrics.WallThicknessOffset(nearLeft, farLeft); Vector3 rightThicknessOffset = HexMetrics.WallThicknessOffset(nearRight, farRight); Vector3 v1, v2, v3, v4; v1 = v3 = left - leftThicknessOffset; v2 = v4 = right - rightThicknessOffset; v3.y = v4.y = left.y + HexMetrics.wallHeight; walls.AddQuad(v1, v2, v3, v4); v1 = v3 = left + leftThicknessOffset; v2 = v4 = right + rightThicknessOffset; v3.y = v4.y = left.y + HexMetrics.wallHeight; walls.AddQuad(v2, v1, v4, v3);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/df7/746/08b/df774608b2b06114b4afbc6ec2904e61.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…·æœ‰åç§»é‡çš„å¢™ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œå››è¾¹å½¢æœ‰åå·®ï¼Œå°½ç®¡è¿™å¹¶ä¸ååˆ†æ˜æ˜¾ã€‚</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å£åšæ˜¯å¦ç›¸åŒï¼Ÿ</font></font></b> <div class="spoiler_text">    ,      Â«-Â»     .      ,    .       .       ,   .    ,    .  , -      ,     .      . </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¢™é¡¶ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†ä½¿å¢™çš„åšåº¦ä»ä¸Šæ–¹å¯è§ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¢™çš„é¡¶éƒ¨æ·»åŠ ä¸€ä¸ªå››è¾¹å½¢ã€‚</font><font style="vertical-align: inherit;">æœ€ç®€å•çš„æ–¹æ³•æ˜¯è®°ä½ç¬¬ä¸€ä¸ªå››è¾¹å½¢çš„ä¸¤ä¸ªä¸Šé¡¶ç‚¹ï¼Œå¹¶å°†å®ƒä»¬ä¸ç¬¬äºŒä¸ªå››è¾¹å½¢çš„ä¸¤ä¸ªä¸Šé¡¶ç‚¹è¿æ¥èµ·æ¥ã€‚</font></font><br><br><pre> <code class="cs hljs"> Vector3 v1, v2, v3, v4; v1 = v3 = left - leftThicknessOffset; v2 = v4 = right - rightThicknessOffset; v3.y = v4.y = left.y + HexMetrics.wallHeight; walls.AddQuad(v1, v2, v3, v4); Vector3 t1 = v3, t2 = v4; v1 = v3 = left + leftThicknessOffset; v2 = v4 = right + rightThicknessOffset; v3.y = v4.y = left.y + HexMetrics.wallHeight; walls.AddQuad(v2, v1, v4, v3); walls.AddQuad(t1, t2, v3, v4);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d7/15d/627/1d715d627770a9e7a17bf135a461833d.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¢™å£ä¸é¡¶éƒ¨ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è½¬å¼¯ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬åœ¨å•å…ƒçš„è§’è½ä»ç„¶æœ‰å­”ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†å¡«å……å®ƒä»¬ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å•å…ƒæ ¼ä¹‹é—´çš„ä¸‰è§’å½¢åŒºåŸŸæ·»åŠ ä¸€ä¸ªçº¿æ®µã€‚</font><font style="vertical-align: inherit;">æ¯ä¸ªè§’è¿æ¥ä¸‰ä¸ªå•å…ƒã€‚</font><font style="vertical-align: inherit;">æ¯ä¸ªå•å…ƒå¯èƒ½æœ‰ä¹Ÿå¯èƒ½æ²¡æœ‰å¢™ã€‚</font><font style="vertical-align: inherit;">å³ï¼Œå…«ä¸ªé…ç½®æ˜¯å¯èƒ½çš„ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ed9/277/8ee/ed92778ee39106d3a448892a124d366c.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è§’åº¦é…ç½®ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä»…å°†å£æ”¾ç½®åœ¨å…·æœ‰ä¸åŒæ …æ çŠ¶æ€çš„å•å…ƒä¹‹é—´ã€‚</font><font style="vertical-align: inherit;">è¿™æ ·å¯ä»¥å°†é…ç½®æ•°é‡å‡å°‘åˆ°å…­ä¸ªã€‚</font><font style="vertical-align: inherit;">åœ¨æ¯ä¸ªå•å…ƒä¸­ï¼Œä¸€ä¸ªå•å…ƒä½äºå£çš„æ›²çº¿å†…ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å°†æ­¤å•å…ƒæ ¼è§†ä¸ºå£å¼¯æ›²çš„å‚è€ƒç‚¹ã€‚</font><font style="vertical-align: inherit;">ä»è¯¥å•å…ƒçš„è§’åº¦æ¥çœ‹ï¼Œå¢™ä»ä¸å·¦å•å…ƒå…±åŒçš„è¾¹ç¼˜å¼€å§‹ï¼Œåˆ°ä¸å³å•å…ƒå…±åŒçš„è¾¹ç¼˜ç»“æŸã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/48e/f68/19a/48ef6819a839339a17d1513f7ca546b5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å•å…ƒè§’è‰²ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–¹æ³•ï¼Œ</font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¶å‚æ•°ä¸ºæ‹è§’çš„ä¸‰ä¸ªé¡¶ç‚¹ã€‚</font><font style="vertical-align: inherit;">å°½ç®¡æˆ‘ä»¬å¯ä»¥ç¼–å†™ä»£ç æ¥å¯¹è¯¥éƒ¨åˆ†è¿›è¡Œä¸‰è§’å‰–åˆ†ï¼Œä½†å®é™…ä¸Šè¿™æ˜¯è¯¥æ–¹æ³•çš„ç‰¹ä¾‹</font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">é”šç‚¹åœ¨ä¸¤ä¸ªé¡¶ç‚¹é™„è¿‘éƒ½èµ·ä½œç”¨ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 pivot, HexCell pivotCell, Vector3 left, HexCell leftCell, Vector3 right, HexCell rightCell </span></span></span><span class="hljs-function">)</span></span> { AddWallSegment(pivot, left, pivot, right); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥ä¸‹æ¥ï¼Œ</font></font><code>AddWall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºè§’åº¦çš„ä¸‰ä¸ªé¡¶ç‚¹åŠå…¶åƒå…ƒ</font><font style="vertical-align: inherit;">åˆ›å»ºæ–¹æ³•çš„å˜ä½“</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¯¥æ–¹æ³•çš„ç›®çš„æ˜¯ç¡®å®šè§’åº¦ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œå®ƒæ˜¯å‚è€ƒç‚¹ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œä»–å¿…é¡»è€ƒè™‘æ‰€æœ‰å…«ä¸ªå¯èƒ½çš„é…ç½®å¹¶è¦æ±‚å…¶ä¸­</font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…­ä¸ªã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWall</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 c1, HexCell cell1, Vector3 c2, HexCell cell2, Vector3 c3, HexCell cell3 </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell1.Walled) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell2.Walled) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell3.Walled) { AddWallSegment(c3, cell3, c1, cell1, c2, cell2); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell3.Walled) { AddWallSegment(c2, cell2, c3, cell3, c1, cell1); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AddWallSegment(c1, cell1, c2, cell2, c3, cell3); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell2.Walled) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell3.Walled) { AddWallSegment(c1, cell1, c2, cell2, c3, cell3); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AddWallSegment(c2, cell2, c3, cell3, c1, cell1); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell3.Walled) { AddWallSegment(c3, cell3, c1, cell1, c2, cell2); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦æ·»åŠ è§’çº¿æ®µï¼Œè¯·åœ¨æœ«å°¾è°ƒç”¨æ­¤æ–¹æ³•</font></font><code>HexGridChunk.TriangulateCorner</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateCorner</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 bottom, HexCell bottomCell, Vector3 left, HexCell leftCell, Vector3 right, HexCell rightCell </span></span></span><span class="hljs-function">)</span></span> { â€¦ features.AddWall(bottom, bottomCell, left, leftCell, right, rightCell); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a8e/e63/304/a8ee63304fce04d4db9dcdf46076b3a9.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¢™å£æœ‰è§’ï¼Œä½†ä»ç„¶æœ‰å­”ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å°é—­å­” </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å£ä¸Šä»ç„¶æœ‰å­”ï¼Œå› ä¸ºå£æ®µçš„é«˜åº¦æ˜¯å¯å˜çš„ã€‚æ²¿è¾¹ç¼˜çš„çº¿æ®µå…·æœ‰æ’å®šçš„é«˜åº¦ï¼Œè€Œè§’çº¿æ®µåˆ™ä½äºä¸¤ä¸ªä¸åŒçš„è¾¹ç¼˜ä¹‹é—´ã€‚ç”±äºæ¯ä¸ªè¾¹ç¼˜å¯ä»¥æœ‰å…¶è‡ªå·±çš„é«˜åº¦ï¼Œå› æ­¤åœ¨æ‹è§’å¤„ä¼šå‡ºç°å­”ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦è§£å†³æ­¤é—®é¢˜ï¼Œè¯·å¯¹å…¶è¿›è¡Œæ›´æ”¹</font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä»¥ä½¿å…¶åˆ†åˆ«å­˜å‚¨å·¦å³é¡¶éƒ¨é¡¶ç‚¹çš„Yåæ ‡ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> leftTop = left.y + HexMetrics.wallHeight; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> rightTop = right.y + HexMetrics.wallHeight; Vector3 v1, v2, v3, v4; v1 = v3 = left - leftThicknessOffset; v2 = v4 = right - rightThicknessOffset; v3.y = leftTop; v4.y = rightTop; walls.AddQuad(v1, v2, v3, v4); Vector3 t1 = v3, t2 = v4; v1 = v3 = left + leftThicknessOffset; v2 = v4 = right + rightThicknessOffset; v3.y = leftTop; v4.y = rightTop; walls.AddQuad(v2, v1, v4, v3);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9cd/f1d/a88/9cdf1da889ce427e1d519a284532d6a8.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°é—­çš„å¢™å£ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œå¢™å£å·²å…³é—­ï¼Œä½†æ‚¨å¯èƒ½ä»ä¼šåœ¨å¢™å£çš„é˜´å½±ä¸­çœ‹åˆ°å­”ã€‚è¿™æ˜¯ç”±</font><font style="vertical-align: inherit;">æ–¹å‘é˜´å½±è®¾ç½®</font><font style="vertical-align: inherit;">çš„â€œ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­£å¸¸åç§»â€</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‚æ•°å¼•èµ·çš„</font><font style="vertical-align: inherit;">ã€‚å½“å®ƒå¤§äºé›¶æ—¶ï¼ŒæŠ•å°„é˜´å½±çš„å¯¹è±¡çš„ä¸‰è§’å½¢æ²¿æ›²é¢çš„æ³•çº¿ç§»åŠ¨ã€‚è¿™æ ·å¯ä»¥é¿å…è‡ªé®è”½ï¼Œä½†åŒæ—¶åœ¨ä¸‰è§’å½¢æœä¸åŒæ–¹å‘çœ‹çš„æƒ…å†µä¸‹ä¹Ÿä¼šäº§ç”Ÿå­”æ´ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥åœ¨ç²¾ç»†å‡ ä½•å½¢çŠ¶çš„é˜´å½±ï¼ˆä¾‹å¦‚æˆ‘ä»¬çš„å¢™ï¼‰ä¸­åˆ›å»ºå­”ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‚¨å¯ä»¥é€šè¿‡å°†æ³•å‘åå·®é™ä½ä¸ºé›¶æ¥æ¶ˆé™¤è¿™äº›é˜´å½±ä¼ªå½±ã€‚æˆ–å°†</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cast Shadows</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç½‘æ ¼æ¸²æŸ“å™¨çš„å¢™</font><font style="vertical-align: inherit;">æ¨¡å¼æ›´æ”¹ä¸º</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒé¢</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚è¿™å°†ä½¿é˜´å½±æŠ•å°„å¯¹è±¡æ¸²æŸ“æ¯ä¸ªå¢™å£ä¸‰è§’å½¢çš„ä¸¤ä¾§ä»¥è¿›è¡Œæ¸²æŸ“ï¼Œè¿™å°†å…³é—­æ‰€æœ‰å­”ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b14/9d5/d0b/b149d5d0bb36f049faa5ca9d49261618.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é˜´å½±ä¸­æ²¡æœ‰æ›´å¤šçš„å­”äº†ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å£æ¶å¢™ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„å¢™è¶³å¤Ÿç›´ã€‚</font><font style="vertical-align: inherit;">å¯¹äºå¹³å¦çš„åœ°å½¢ï¼Œè¿™ä¸€ç‚¹éƒ½è¿˜ä¸é”™ï¼Œä½†æ˜¯å½“å¢™å£ä¸å£æ¶é‡åˆæ—¶ï¼Œè¿™çœ‹èµ·æ¥å¾ˆå¥‡æ€ªã€‚</font><font style="vertical-align: inherit;">å½“å¢™çš„ç›¸å¯¹ä¸¤ä¾§çš„å•å…ƒä¹‹é—´å­˜åœ¨ä¸€ä¸ªé«˜åº¦å·®æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/065/481/c1a/065481c1a0859ced22d0ae6568acbe86.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å£æ¶ä¸Šçš„ç›´å¢™ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è·Ÿéšè¾¹ç¼˜ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸å…¶ä¸ºæ•´ä¸ªè¾¹ç¼˜åˆ›å»ºä¸€ä¸ªçº¿æ®µï¼Œä¸å¦‚ä¸ºè¾¹ç¼˜æ¡çš„æ¯ä¸ªéƒ¨åˆ†åˆ›å»ºä¸€ä¸ªçº¿æ®µã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡</font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨</font></font><code>AddWall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">edge </font><font style="vertical-align: inherit;">ç‰ˆæœ¬ä¸­</font><font style="vertical-align: inherit;">è°ƒç”¨å››æ¬¡æ¥åšåˆ°è¿™ä¸€ç‚¹</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWall</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices near, HexCell nearCell, EdgeVertices far, HexCell farCell </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nearCell.Walled != farCell.Walled) { AddWallSegment(near.v1, far.v1, near.v2, far.v2); AddWallSegment(near.v2, far.v2, near.v3, far.v3); AddWallSegment(near.v3, far.v3, near.v4, far.v4); AddWallSegment(near.v4, far.v4, near.v5, far.v5); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a96/8aa/0f9/a968aa0f984b31e81dc9edb12e8d31bb.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¼¯æ›²çš„å¢™å£ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œå¢™å£ä¼šé‡å¤å˜å½¢çš„è¾¹ç¼˜å½¢çŠ¶ã€‚</font><font style="vertical-align: inherit;">ç»“åˆå£æ¶ï¼Œçœ‹èµ·æ¥æ›´å¥½ã€‚</font><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œå®ƒè¿˜åœ¨å¹³å¦çš„æµ®é›•ä¸Šåˆ›å»ºäº†æ›´å¤šæœ‰è¶£çš„å¢™ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å°†å¢™å£æ”¾åœ¨åœ°é¢ä¸Š </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çœ‹ç€å£æ¶ä¸Šçš„å¢™å£ï¼Œæ‚¨ä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ã€‚å¢™å£æ‚¬åœ¨åœ°é¢ä¸Šï¼å¯¹äºå€¾æ–œçš„å¹³å¦è¾¹ç¼˜æ¥è¯´ç¡®å®å¦‚æ­¤ï¼Œä½†é€šå¸¸ä¸ä¼šé‚£ä¹ˆæ˜æ˜¾ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/039/8f0/a59/0398f0a59aca756824e162c3fba5a891.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¢™å£æ‚¬åœ¨ç©ºä¸­ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦é™ä½å¢™å£ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯é™ä½æ•´ä¸ªå¢™å£ï¼Œä½¿å…¶é¡¶éƒ¨ä¿æŒå¹³å¦ã€‚åŒæ—¶ï¼Œä¸Šä¾§çš„ä¸€éƒ¨åˆ†å¢™ä¼šç¨å¾®é™ä½åˆ°æµ®é›•ä¸­ï¼Œä½†è¿™å°†é€‚åˆæˆ‘ä»¬ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦é™ä½å¢™çš„é«˜åº¦ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šå“ªä¸€ä¾§è¾ƒä½-è¿‘æˆ–è¿œã€‚æˆ‘ä»¬å¯ä»¥åªä½¿ç”¨æœ€ä½è¾¹çš„é«˜åº¦ï¼Œè€Œä¸å¿…èµ°å¾—å¤ªä½ã€‚æ‚¨å¯ä»¥å°†Yåæ ‡ä»ä½åˆ°é«˜æ’å€¼ï¼Œå…¶åç§»é‡å°äº0.5ã€‚ç”±äºå£å¶å°”ä»…ä¼šå˜å¾—é«˜äºå£æ¶çš„è¾ƒä½å°é˜¶ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†å£æ¶çš„å‚ç›´å°é˜¶ç”¨ä½œåç§»é‡ã€‚å£æ¶æ„é€ çš„ä¸åŒå£åšå¯èƒ½éœ€è¦ä¸åŒçš„åç§»é‡ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/960/61c/817/96061c817bfdc69db9682e0799ba3751.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é™ä½çš„å¢™ã€‚</font></font></i> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é™¤äº†å¹³å‡è¿‘é¡¶ç‚¹å’Œè¿œé¡¶ç‚¹çš„Xå’ŒZåæ ‡å¤–ï¼Œ</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬è¿˜æ·»åŠ äº†</font><font style="vertical-align: inherit;">å¤„ç†è¯¥æ’å€¼</font><font style="vertical-align: inherit;">çš„</font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–¹æ³•</font></font><code>WallLerp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å®ƒåŸºäºä¸€ç§æ–¹æ³•</font></font><code>TerraceLerp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> wallElevationOffset = verticalTerraceStepSize; â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WallLerp</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 near, Vector3 far</span></span></span><span class="hljs-function">)</span></span> { near.x += (far.x - near.x) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; near.z += (far.z - near.z) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> v = near.y &lt; far.y ? wallElevationOffset : (<span class="hljs-number"><span class="hljs-number">1f</span></span> - wallElevationOffset); near.y += (far.y - near.y) * v; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> near; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¼ºåˆ¶ä½¿ç”¨</font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­¤æ–¹æ³•ç¡®å®šå·¦é¡¶ç‚¹å’Œå³é¡¶ç‚¹ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 nearLeft, Vector3 farLeft, Vector3 nearRight, Vector3 farRight </span></span></span><span class="hljs-function">)</span></span> { Vector3 left = HexMetrics.WallLerp(nearLeft, farLeft); Vector3 right = HexMetrics.WallLerp(nearRight, farRight); â€¦ }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/957/a4c/b49/957a4cb498eb8a712064a0b99a4041be.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç«™åœ¨åœ°é¢ä¸Šçš„å¢™å£ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¢™ä½“å˜å½¢å˜åŒ– </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬çš„å¢™å£é«˜åº¦ä¸€è‡´ã€‚å°½ç®¡å®ƒä»¬é è¿‘æ‰­æ›²çš„è¾¹ç¼˜ï¼Œä½†å®ƒä»¬ä»æœªå®Œå…¨å¯¹åº”äºæ‰­æ›²çš„è¾¹ç¼˜ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µæ˜¯å› ä¸ºæˆ‘ä»¬é¦–å…ˆç¡®å®šå¢™å£çš„é¡¶éƒ¨ï¼Œç„¶åå°†å…¶å˜å½¢ã€‚ç”±äºè¿™äº›é¡¶ç‚¹ä½äºè¿‘ç«¯å’Œè¿œç«¯è¾¹ç¼˜çš„é¡¶ç‚¹ä¹‹é—´ï¼Œå› æ­¤å®ƒä»¬çš„å˜å½¢ä¼šç•¥æœ‰ä¸åŒã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å£ä¸æ­£ç¡®åœ°è·Ÿéšè‚‹çš„äº‹å®ä¸æ˜¯é—®é¢˜ã€‚ä½†æ˜¯ï¼Œå£é¡¶éƒ¨çš„å˜å½¢ä¼šæ”¹å˜åšåº¦ç›¸å¯¹å‡åŒ€çš„åšåº¦ã€‚å¦‚æœæˆ‘ä»¬æ ¹æ®å˜å½¢çš„é¡¶ç‚¹æ’åˆ—å¢™ï¼Œç„¶åæ·»åŠ æœªå˜å½¢çš„å››è¾¹å½¢ï¼Œåˆ™å…¶åšåº¦åº”è¯¥ä¸ä¼šæœ‰å¤ªå¤§å˜åŒ–ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 nearLeft, Vector3 farLeft, Vector3 nearRight, Vector3 farRight </span></span></span><span class="hljs-function">)</span></span> { nearLeft = HexMetrics.Perturb(nearLeft); farLeft = HexMetrics.Perturb(farLeft); nearRight = HexMetrics.Perturb(nearRight); farRight = HexMetrics.Perturb(farRight); â€¦ walls.AddQuadUnperturbed(v1, v2, v3, v4); â€¦ walls.AddQuadUnperturbed(v2, v1, v4, v3); walls.AddQuadUnperturbed(t1, t2, v3, v4); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b10/fa3/03d/b10fa303dc91a50665bf92b47feed5e7.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¢™å£çš„é¡¶éƒ¨æœªå˜å½¢ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºè¿™ç§æ–¹æ³•ï¼Œå¢™å£å°†ä¸å†åƒä»¥å‰é‚£æ ·ç²¾ç¡®åœ°è·Ÿéšè¾¹ç¼˜ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ä½œä¸ºå›æŠ¥ï¼Œå®ƒä»¬å°†å˜å¾—ä¸é‚£ä¹ˆç ´è£‚ï¼Œå¹¶ä¸”åšåº¦å°†æ›´æ’å®šã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d38/7f6/b6f/d387f6b6f1c4fed424d2582a8ef5c12c.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å£åšæ›´ä¸€è‡´ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¢™ä¸Šçš„æ´ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¿½ç•¥äº†æ²³æµæˆ–é“è·¯æ¨ªç©¿éš”ç¦»å¢™çš„å¯èƒ½æ€§ã€‚</font><font style="vertical-align: inherit;">å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨å¢™å£ä¸Šæ‰“ä¸€ä¸ªæ´ï¼Œæ²³æµæˆ–é“è·¯å¯ä»¥é€šè¿‡ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæ·»åŠ </font></font><code>AddWall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸¤ä¸ªå¸ƒå°”å‚æ•°ä»¥æŒ‡ç¤ºæ²³æµæˆ–é“è·¯æ˜¯å¦é€šè¿‡ä¸€æ¡è¾¹ã€‚</font><font style="vertical-align: inherit;">å°½ç®¡æˆ‘ä»¬å¯ä»¥ç”¨ä¸åŒçš„æ–¹å¼å¤„ç†å®ƒä»¬ï¼Œä½†åœ¨ä¸¤ç§æƒ…å†µä¸‹æˆ‘ä»¬éƒ½åªåˆ é™¤ä¸¤ä¸ªä¸­é—´éƒ¨åˆ†ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWall</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices near, HexCell nearCell, EdgeVertices far, HexCell farCell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRiver, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoad </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nearCell.Walled != farCell.Walled) { AddWallSegment(near.v1, far.v1, near.v2, far.v2); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRiver || hasRoad) { <span class="hljs-comment"><span class="hljs-comment">// Leave a gap. } else { AddWallSegment(near.v2, far.v2, near.v3, far.v3); AddWallSegment(near.v3, far.v3, near.v4, far.v4); } AddWallSegment(near.v4, far.v4, near.v5, far.v5); } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨å®ƒ</font></font><code>HexGridChunk.TriangulateConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åº”è¯¥æä¾›å¿…è¦çš„æ•°æ®ã€‚</font><font style="vertical-align: inherit;">ç”±äºä»–å·²ç»éœ€è¦ç›¸åŒçš„ä¿¡æ¯ï¼Œå› æ­¤è®©æˆ‘ä»¬å°†å…¶ç¼“å­˜åœ¨å¸ƒå°”å˜é‡ä¸­ï¼Œå¹¶åªè®°å½•ä¸€æ¬¡å¯¹ç›¸åº”æ–¹æ³•çš„è°ƒç”¨ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateConnection</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, EdgeVertices e1 </span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasRiver = cell.HasRiverThroughEdge(direction); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasRoad = cell.HasRoadThroughEdge(direction); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRiver) { â€¦ } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.GetEdgeType(direction) == HexEdgeType.Slope) { TriangulateEdgeTerraces(e1, cell, e2, neighbor, hasRoad); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateEdgeStrip(e1, cell.Color, e2, neighbor.Color, hasRoad); } features.AddWall(e1, cell, e2, neighbor, hasRiver, hasRoad); â€¦ }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/64c/d05/425/64cd0542540b5d9347a071d727fe2fa4.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¢™å£ä¸Šçš„å­”ä¾›æ²³æµå’Œé“è·¯é€šè¿‡ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬è¦†ç›–å¢™å£ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™äº›æ–°çš„å¼€å£åˆ›é€ äº†å®Œæˆå¢™å£çš„åœ°æ–¹ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦ç”¨å››è¾¹å½¢å°é—­è¿™äº›ç«¯ç‚¹ï¼Œä»¥ä¾¿æˆ‘ä»¬æ— æ³•çœ‹ç©¿å¢™å£çš„ä¾§é¢ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä¸ºæ­¤åˆ›å»ºä¸€ä¸ª</font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–¹æ³•</font></font><code>AddWallCap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å®ƒçš„å·¥ä½œæ–¹å¼ç±»ä¼¼äº</font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä½†åªéœ€è¦ä¸€å¯¹è¿‘å³°ã€‚</font><font style="vertical-align: inherit;">è®©ä»–æ·»åŠ ä¸€ä¸ªå››è¾¹å½¢ï¼Œä»å¢™çš„è¿‘ç«¯åˆ°è¿œç«¯ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallCap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 near, Vector3 far</span></span></span><span class="hljs-function">)</span></span> { near = HexMetrics.Perturb(near); far = HexMetrics.Perturb(far); Vector3 center = HexMetrics.WallLerp(near, far); Vector3 thickness = HexMetrics.WallThicknessOffset(near, far); Vector3 v1, v2, v3, v4; v1 = v3 = center - thickness; v2 = v4 = center + thickness; v3.y = v4.y = center.y + HexMetrics.wallHeight; walls.AddQuadUnperturbed(v1, v2, v3, v4); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“</font></font><code>AddWall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘ç°éœ€è¦å­”æ—¶ï¼Œåœ¨ç¬¬äºŒå¯¹å’Œç¬¬å››å¯¹è¾¹ç¼˜ä¹‹é—´æ·»åŠ ä¸€ä¸ªè¦†ç›–ã€‚</font><font style="vertical-align: inherit;">å¯¹äºç¬¬å››å¯¹é¡¶ç‚¹ï¼Œæ‚¨éœ€è¦åˆ‡æ¢æ–¹å‘ï¼Œå¦åˆ™å››è¾¹å½¢å°†å‘å†…çœ‹ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWall</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices near, HexCell nearCell, EdgeVertices far, HexCell farCell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRiver, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoad </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nearCell.Walled != farCell.Walled) { AddWallSegment(near.v1, far.v1, near.v2, far.v2); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRiver || hasRoad) { AddWallCap(near.v2, far.v2); AddWallCap(far.v4, near.v4); } â€¦ } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/413/98c/828/41398c82892a2c1f706ca85c9230813a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¢™å£ä¸Šçš„å°é—­å­”ã€‚</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å›´ç»•åœ°å›¾è¾¹ç¼˜çš„å­”æ€ä¹ˆåŠï¼Ÿ</font></font></b> <div class="spoiler_text">   ,     .        .    ,        . </div></div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é¿å…æ‚¬å´–å’Œæ°´ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹åŒ…å«æ‚¬å´–æˆ–æ°´çš„è¾¹ç¼˜ã€‚</font><font style="vertical-align: inherit;">ç”±äºæ‚¬å´–æœ¬è´¨ä¸Šæ˜¯å¤§å¢™ï¼Œå› æ­¤åœ¨å…¶ä¸Šæ”¾ç½®é¢å¤–çš„å¢™æ˜¯ä¸åˆé€»è¾‘çš„ã€‚</font><font style="vertical-align: inherit;">å¦å¤–ï¼Œå®ƒçœ‹èµ·æ¥ä¼šå¾ˆç³Ÿç³•ã€‚</font><font style="vertical-align: inherit;">æ°´ä¸‹å¢™ä¹Ÿæ˜¯å®Œå…¨ä¸åˆé€»è¾‘çš„ï¼Œæµ·å²¸å¢™çš„é™åˆ¶ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/45a/94e/027/45a94e027094c6ebdae0763663d6eb8e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¢™å£åœ¨å³­å£ä¸Šå’Œåœ¨æ°´ä¸­ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡é¢å¤–çš„æ£€æŸ¥æ¥å»é™¤è¿™äº›ä¸å¿…è¦çš„è¾¹ç¼˜ä¸Šçš„å¢™</font></font><code>AddWall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å¢™ä¸èƒ½åœ¨æ°´ä¸‹ï¼Œä¸ä¹‹å…±é€šçš„è‚‹éª¨ä¸èƒ½æ˜¯æ‚¬å´–ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWall</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices near, HexCell nearCell, EdgeVertices far, HexCell farCell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRiver, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoad </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( nearCell.Walled != farCell.Walled &amp;&amp; !nearCell.IsUnderwater &amp;&amp; !farCell.IsUnderwater &amp;&amp; nearCell.GetEdgeType(farCell) != HexEdgeType.Cliff ) { â€¦ } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/128/baf/75a/128baf75ace7d0cf4ed5f12ef380eec8.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å»é™¤äº†æ²¿è‚‹éª¨çš„éšœç¢å¢™ï¼Œä½†è§’è½ä»ç„¶ä¿ç•™ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å»é™¤å¢™è§’ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å»é™¤ä¸å¿…è¦çš„è§’éƒ¨æ®µå°†éœ€è¦æ›´å¤šçš„åŠªåŠ›ã€‚</font><font style="vertical-align: inherit;">æœ€ç®€å•çš„æƒ…å†µæ˜¯æ”¯æ’‘æ± åœ¨æ°´ä¸‹ã€‚</font><font style="vertical-align: inherit;">è¿™æ ·å¯ä»¥ç¡®ä¿é™„è¿‘æ²¡æœ‰å¯è¿æ¥çš„å¢™æ®µã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 pivot, HexCell pivotCell, Vector3 left, HexCell leftCell, Vector3 right, HexCell rightCell </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pivotCell.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } AddWallSegment(pivot, left, pivot, right); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ecc/475/9f3/ecc4759f38ced7802ad8743626f91d51.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²¡æœ‰æ›´å¤šçš„æ°´ä¸‹æ”¯æŒå®¤ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬éœ€è¦çœ‹çœ‹å…¶ä»–ä¸¤ä¸ªå•å…ƒã€‚</font><font style="vertical-align: inherit;">å¦‚æœå…¶ä¸­ä¹‹ä¸€åœ¨æ°´ä¸‹æˆ–é€šè¿‡ä¸­æ–­è¿æ¥åˆ°æ”¯æ’‘å•å…ƒï¼Œåˆ™æ²¿è¯¥è‚‹æ²¡æœ‰å£ã€‚</font><font style="vertical-align: inherit;">å¦‚æœè‡³å°‘ä¸€ä¾§ä¸ºçœŸï¼Œåˆ™æ­¤è§’ä¸åº”æœ‰å¢™æ®µã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬åˆ†åˆ«ç¡®å®šæ˜¯å¦æœ‰å·¦å¢™æˆ–å³å¢™ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ç»“æœæ”¾å…¥å¸ƒå°”å˜é‡ä¸­ï¼Œä»¥ä½¿å…¶æ›´æ˜“äºä½¿ç”¨ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pivotCell.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasLeftWall = !leftCell.IsUnderwater &amp;&amp; pivotCell.GetEdgeType(leftCell) != HexEdgeType.Cliff; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasRighWall = !rightCell.IsUnderwater &amp;&amp; pivotCell.GetEdgeType(rightCell) != HexEdgeType.Cliff; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasLeftWall &amp;&amp; hasRighWall) { AddWallSegment(pivot, left, pivot, right); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8cd/f17/82d/8cdf1782d522d5b9e19e461ee5253436.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å»é™¤äº†æ‰€æœ‰å¹²æ‰°è§’ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ­»è§’ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“å·¦å³è¾¹ç¼˜éƒ½æ²¡æœ‰å¢™æ—¶ï¼Œå·¥ä½œå°±å®Œæˆäº†ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå¦‚æœå¢™å£ä»…åœ¨ä¸€ä¸ªæ–¹å‘ä¸Šï¼Œåˆ™æ„å‘³ç€å¢™å£ä¸Šè¿˜æœ‰å¦ä¸€ä¸ªå­”ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæ‚¨éœ€è¦å…³é—­å®ƒã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasLeftWall) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRighWall) { AddWallSegment(pivot, left, pivot, right); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AddWallCap(pivot, left); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRighWall) { AddWallCap(right, pivot); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/20e/c4d/176/20ec4d17689500d123fc5fd41d447e88.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å…³é—­å¢™å£ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¢™å£ä¸æ‚¬å´–çš„è¿æ¥ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ä¸€ç§æƒ…å†µä¸‹ï¼Œå¢™å£çœ‹èµ·æ¥ä¸å®Œç¾ã€‚</font><font style="vertical-align: inherit;">å½“å¢™åˆ°è¾¾æ‚¬å´–çš„åº•éƒ¨æ—¶ï¼Œå®ƒç»“æŸäº†ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ç”±äºæ‚¬å´–å¹¶éå®Œå…¨å‚ç›´ï¼Œå› æ­¤åœ¨å¢™å£å’Œæ‚¬å´–è¾¹ç¼˜ä¹‹é—´ä¼šå½¢æˆä¸€ä¸ªç‹­çª„çš„å­”ã€‚</font><font style="vertical-align: inherit;">åœ¨æ‚¬å´–çš„é¡¶éƒ¨ï¼Œä¸ä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/633/5c6/9a7/6335c69a7f45dcd1c2a0609503b2504a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¢™å£å’Œæ‚¬å´–å£ä¹‹é—´çš„å­”ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœå¢™ä¸€ç›´å»¶ä¼¸åˆ°æ‚¬å´–çš„è¾¹ç¼˜ï¼Œé‚£å°±æ›´å¥½äº†ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¢™çš„å½“å‰ç«¯ä¸æ‚¬å´–çš„è§’é¡¶ä¹‹é—´æ·»åŠ å¦ä¸€ä¸ªå¢™æ®µã€‚</font><font style="vertical-align: inherit;">ç”±äºæ­¤éƒ¨åˆ†çš„å¤§éƒ¨åˆ†å°†éšè—åœ¨æ‚¬å´–å†…éƒ¨ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¸å°†æ‚¬å´–å†…éƒ¨çš„å£åšå‡å°åˆ°é›¶ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œå¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œåˆ›å»ºä¸€ä¸ªæ¥”å½¢å°±è¶³å¤Ÿäº†ï¼šä¸¤ä¸ªå››è¾¹å½¢æŒ‡å‘è¯¥ç‚¹ï¼Œè€Œä¸‰è§’å½¢ä½äºå®ƒä»¬çš„é¡¶éƒ¨ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä¸ºæ­¤åˆ›å»ºä¸€ä¸ªæ–¹æ³•</font></font><code>AddWallWedge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¿™å¯ä»¥é€šè¿‡å¤åˆ¶</font></font><code>AddWallCap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶æ·»åŠ æ¥”å½¢ç‚¹</font><font style="vertical-align: inherit;">æ¥å®Œæˆ</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallWedge</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 near, Vector3 far, Vector3 point</span></span></span><span class="hljs-function">)</span></span> { near = HexMetrics.Perturb(near); far = HexMetrics.Perturb(far); point = HexMetrics.Perturb(point); Vector3 center = HexMetrics.WallLerp(near, far); Vector3 thickness = HexMetrics.WallThicknessOffset(near, far); Vector3 v1, v2, v3, v4; Vector3 pointTop = point; point.y = center.y; v1 = v3 = center - thickness; v2 = v4 = center + thickness; v3.y = v4.y = pointTop.y = center.y + HexMetrics.wallHeight; <span class="hljs-comment"><span class="hljs-comment">// walls.AddQuadUnperturbed(v1, v2, v3, v4); walls.AddQuadUnperturbed(v1, point, v3, pointTop); walls.AddQuadUnperturbed(point, v2, pointTop, v4); walls.AddTriangleUnperturbed(pointTop, v3, v4); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½œä¸º</font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”¨äºè§’éƒ¨ï¼Œæˆ‘ä»¬å°†å½“å£è¿›å…¥ä»…åœ¨ä¸€ä¸ªæ–¹å‘ï¼Œå¹¶ä¸”è¯¥å£ä½äºæ¯”å¦ä¸€ä¾§çš„é«˜åº¦ä½è°ƒç”¨æ­¤æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™äº›æ¡ä»¶ä¸‹ï¼Œæˆ‘ä»¬é‡åˆ°äº†æ‚¬å´–çš„è¾¹ç¼˜ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasLeftWall) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRighWall) { AddWallSegment(pivot, left, pivot, right); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (leftCell.Elevation &lt; rightCell.Elevation) { AddWallWedge(pivot, left, right); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AddWallCap(pivot, left); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRighWall) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rightCell.Elevation &lt; leftCell.Elevation) { AddWallWedge(right, pivot, left); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AddWallCap(right, pivot); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b5c/30f/33a/b5c30f33ac93582e2ce319996d9ed1ac.png"></div><br> <i> ,   .</i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">unitypackage</a> <br><br><h1>  11:    </h1><br><ul><li>    . </li><li>     . </li><li>     . </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ef5/a07/5ea/ef5a075ea4c14c810825388be274f817.jpg"></div><br> <i>  .</i> <br><br><h2>    </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ä¸Šä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†å¢™é¢æ”¯æ’‘ã€‚è¿™äº›æ˜¯ç®€å•çš„ç›´å£æ®µï¼Œæ²¡æœ‰æ˜æ˜¾å·®å¼‚ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†é€šè¿‡åœ¨å…¶ä¸Šæ·»åŠ å¡”æ¥ä½¿å¢™æ›´æœ‰è¶£ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¿…é¡»æŒ‰ç¨‹åºåˆ›å»ºå¢™æ®µä»¥åŒ¹é…æµ®é›•ã€‚å¡”ä¸æ˜¯å¿…éœ€çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¸¸è§„çš„é¢„åˆ¶ä»¶ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥ç”¨çº¢è‰²ææ–™åˆ›å»ºä¸€ä¸ªç”±ä¸¤ä¸ªç«‹æ–¹ä½“ç»„æˆçš„ç®€å•å¡”ã€‚å¡”çš„åº•éƒ¨å°ºå¯¸ä¸º2 x 2ä¸ªå•ä½ï¼Œé«˜åº¦ä¸º4ä¸ªå•ä½ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ¯”å¢™æ›´åšä¸”æ›´é«˜ã€‚åœ¨æ­¤ç«‹æ–¹ä½“ä¸Šæ–¹ï¼Œæˆ‘ä»¬å°†æ”¾ç½®ä¸€ä¸ªè¡¨ç¤ºå¡”é¡¶çš„å•ä½ç«‹æ–¹ä½“ã€‚åƒæ‰€æœ‰å…¶ä»–é¢„åˆ¶ä»¶ä¸€æ ·ï¼Œè¿™äº›ç«‹æ–¹ä½“ä¸éœ€è¦å¯¹æ’æœºã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºå¡”æ¨¡å‹ç”±å¤šä¸ªå¯¹è±¡ç»„æˆï¼Œå› æ­¤æˆ‘ä»¬å°†å®ƒä»¬è®¾ä¸ºæ ¹å¯¹è±¡çš„å­ä»£ã€‚</font><font style="vertical-align: inherit;">æ”¾ç½®å®ƒä»¬ï¼Œä½¿æ ¹çš„æœ¬åœ°åŸç‚¹ä½äºå¡”çš„åº•éƒ¨ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾ç½®å¡”è€Œä¸å¿…æ‹…å¿ƒå®ƒä»¬çš„é«˜åº¦ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2f1/a54/335/2f1a54335d81a6682707e740107362c6.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¢„åˆ¶å¡”ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ­¤é¢„åˆ¶ä¸­æ·»åŠ é“¾æ¥</font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶è¿›è¡Œè¿æ¥ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform wallTower;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f76/df1/c7e/f76df1c7e5b1c808d2ae636f7e823487.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é“¾æ¥åˆ°é¢„åˆ¶å¡”ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å»ºç­‘å¡” </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä»åœ¨æ¯ä¸ªå¢™æ®µçš„ä¸­é—´æ”¾ç½®å¡”å¼€å§‹ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åœ¨æ–¹æ³•æœ«å°¾åˆ›å»ºä¸€ä¸ªå¡”</font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å¥¹çš„ä½ç½®å°†æ˜¯è¯¥æ®µå·¦ï¼Œå³ç‚¹çš„å¹³å‡å€¼ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 nearLeft, Vector3 farLeft, Vector3 nearRight, Vector3 farRight </span></span></span><span class="hljs-function">)</span></span> { â€¦ Transform towerInstance = Instantiate(wallTower); towerInstance.transform.localPosition = (left + right) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; towerInstance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/559/541/487/559541487b79dd6877b4456dbdf010b1.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¯ä¸ªå¢™æ®µä¸€å¡”ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬æ²¿ç€å¢™æœ‰å¾ˆå¤šå¡”ï¼Œä½†æ˜¯å®ƒä»¬çš„æ–¹å‘æ²¡æœ‰æ”¹å˜ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦æ›´æ”¹å…¶æ—‹è½¬è§’åº¦ï¼Œä»¥ä½¿å…¶ä¸å¢™å¯¹é½ã€‚</font><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬å…·æœ‰å¢™çš„å·¦å³ä¸¤ä¸ªç‚¹ï¼Œå› æ­¤æˆ‘ä»¬çŸ¥é“å“ªä¸ªæ–¹å‘æ˜¯æ­£ç¡®çš„ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™äº›çŸ¥è¯†æ¥ç¡®å®šå¢™æ®µçš„æ–¹å‘ï¼Œä»è€Œç¡®å®šå¡”çš„æ–¹å‘ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ— éœ€è‡ªå·±è®¡ç®—æ—‹è½¬é‡ï¼Œæˆ‘ä»¬åªéœ€å°†ä¸€ä¸ª</font></font><code>Transform.right</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘é‡</font><font style="vertical-align: inherit;">åˆ†é…ç»™propertyå³å¯</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç»Ÿä¸€ä»£ç å°†æ”¹å˜å¯¹è±¡çš„æ—‹è½¬ï¼Œä»¥ä½¿å…¶å±€éƒ¨æ–¹å‘å³ä¸æ‰€ä¼ è¾“çš„çŸ¢é‡ç›¸å¯¹åº”ã€‚</font></font><br><br><pre> <code class="cs hljs"> Transform towerInstance = Instantiate(wallTower); towerInstance.transform.localPosition = (left + right) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; Vector3 rightDirection = right - left; rightDirection.y = <span class="hljs-number"><span class="hljs-number">0f</span></span>; towerInstance.transform.right = rightDirection; towerInstance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5d3/2c3/777/5d32c3777d5b63db90ddf9f8fbbf1dee.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¡”ä¸å¢™å¯¹é½ã€‚</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transform.rightåˆ†é…å¦‚ä½•å·¥ä½œï¼Ÿ</font></font></b> <div class="spoiler_text">     <code>Quaternion.FromToRotation</code>   .   . <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 right { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rotation * Vector3.right; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { rotation = Quaternion.FromToRotation(Vector3.right, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } }</code> </pre> </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å‡å°‘å¡”æ•° </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¯ä¸ªå¢™æ®µä¸€ä¸ªå¡”å¤ªå¤šã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬é€šè¿‡å‘</font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¸ƒå°”å€¼</font><font style="vertical-align: inherit;">æ·»åŠ </font><font style="vertical-align: inherit;">å‚æ•°</font><font style="vertical-align: inherit;">æ¥ä½¿æ·»åŠ å¡”æˆä¸ºå¯é€‰æ“ä½œ</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å°†å…¶è®¾ç½®ä¸ºé»˜è®¤å€¼</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„å¡”éƒ½å°†æ¶ˆå¤±ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 nearLeft, Vector3 farLeft, Vector3 nearRight, Vector3 farRight, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> addTower = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (addTower) { Transform towerInstance = Instantiate(wallTower); towerInstance.transform.localPosition = (left + right) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; Vector3 rightDirection = right - left; rightDirection.y = <span class="hljs-number"><span class="hljs-number">0f</span></span>; towerInstance.transform.right = rightDirection; towerInstance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å°†å¡”ä»…æ”¾ç½®åœ¨ç‰¢æˆ¿çš„è§’è½ã€‚</font><font style="vertical-align: inherit;">ç»“æœï¼Œæˆ‘ä»¬å¾—åˆ°çš„å¡”æ•°æ›´å°‘ï¼Œå¹¶ä¸”å®ƒä»¬ä¹‹é—´çš„è·ç¦»ç›¸å½“æ’å®šã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 pivot, HexCell pivotCell, Vector3 left, HexCell leftCell, Vector3 right, HexCell rightCell </span></span></span><span class="hljs-function">)</span></span> { â€¦ AddWallSegment(pivot, left, pivot, right, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); â€¦ }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d60/823/d7b/d60823d7b381eccaf5916bf2bc636061.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¡”åªåœ¨è§’è½ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çœ‹èµ·æ¥è¶³å¤Ÿå¥½ï¼Œä½†æ˜¯æˆ‘ä»¬å¯èƒ½éœ€è¦æ›´å°‘çš„å¡”å®šæœŸæ”¾ç½®ã€‚</font><font style="vertical-align: inherit;">ä¸å…¶ä»–åœ°å½¢ç‰¹å¾ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å“ˆå¸Œè¡¨æ¥å†³å®šæ˜¯å¦å°†å¡”æ¥¼æ”¾åœ¨è§’è½ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨è§’çš„ä¸­å¿ƒå¯¹è¡¨è¿›è¡Œé‡‡æ ·ï¼Œç„¶åå°†å“ˆå¸Œå€¼ä¹‹ä¸€ä¸å¡”çš„é˜ˆå€¼è¿›è¡Œæ¯”è¾ƒã€‚</font></font><br><br><pre> <code class="cs hljs"> HexHash hash = HexMetrics.SampleHashGrid( (pivot + left + right) * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasTower = hash.e &lt; HexMetrics.wallTowerThreshold; AddWallSegment(pivot, left, pivot, right, hasTower);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é˜ˆå€¼ä¸º</font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å€¼ä¸º0.5æ—¶ï¼Œå°†åœ¨ä¸€åŠæƒ…å†µä¸‹åˆ›å»ºå¡”ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ›å»ºå…·æœ‰è®¸å¤šå¡”æˆ–æ ¹æœ¬æ²¡æœ‰å¡”çš„å¢™ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> wallTowerThreshold = <span class="hljs-number"><span class="hljs-number">0.5f</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b54/40c/f0f/b5440cf0ffa4f615f2dcbf37532bbb0a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éšæœºå¡”ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬ä»å±±å¡ä¸Šå¸ä¸‹å¡”æ¥¼ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæ— è®ºåœ°å½¢å¦‚ä½•ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥æ”¾ç½®å¡”ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œåœ¨å¡”çš„æ–œå¡ä¸Šçœ‹èµ·æ¥ä¸åˆé€»è¾‘ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™é‡Œï¼Œå¢™å£æˆä¸€å®šè§’åº¦ï¼Œå¯ä»¥åˆ‡ç©¿å¡”é¡¶ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/24c/c5e/2dd/24cc5e2ddb97b83d14e0826bc64e3f20.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¡”åœ¨æ–œå¡ä¸Šã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†é¿å…å€¾æ–œï¼Œæˆ‘ä»¬å°†æ£€æŸ¥å·¦å³è§’å•å…ƒæ˜¯å¦åœ¨ç›¸åŒçš„é«˜åº¦ã€‚</font><font style="vertical-align: inherit;">ä»…åœ¨è¿™ç§æƒ…å†µä¸‹æ‰å¯ä»¥æ”¾ç½®å¡”ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasTower = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (leftCell.Elevation == rightCell.Elevation) { HexHash hash = HexMetrics.SampleHashGrid( (pivot + left + right) * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>) ); hasTower = hash.e &lt; HexMetrics.wallTowerThreshold; } AddWallSegment(pivot, left, pivot, right, hasTower);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/770/1b4/fd9/7701b4fd9d0a4952fce2a9e00bbb4571.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–œå¡çš„å¢™å£ä¸Šä¸å†æœ‰å¡”ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬å°†å¢™å£å’Œå¡”æ¥¼æ”¾åœ¨åœ°é¢ä¸Š </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°½ç®¡æˆ‘ä»¬é¿å…åœ¨å€¾æ–œçš„åœ°æ–¹ä½¿ç”¨å¢™ï¼Œä½†å¢™ä¸¤ä¾§çš„æµ®é›•ä»å¯ä»¥å…·æœ‰ä¸åŒçš„é«˜åº¦ã€‚</font><font style="vertical-align: inherit;">å¢™å£å¯ä»¥æ²¿ç€å£æ¶å»¶ä¼¸ï¼Œè€Œç›¸åŒé«˜åº¦çš„å•å…ƒå¯ä»¥å…·æœ‰ä¸åŒçš„å‚ç›´ä½ç½®ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œå¡”æ¶çš„åº•éƒ¨å¯èƒ½åœ¨ç©ºä¸­ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cd2/4d8/b10/cd24d8b1012804af5d073c3901c874ad.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¡”åœ¨ç©ºä¸­ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®é™…ä¸Šï¼Œæ–œå¡ä¸Šçš„å¢™å£ä¹Ÿå¯ä»¥æ‚¬æŒ‚åœ¨ç©ºä¸­ï¼Œä½†è¿™å¹¶ä¸åƒå¡”æ¥¼é‚£ä¹ˆæ˜æ˜¾ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8b6/ae3/d24/8b6ae3d2489f253ae1a78593af0abd6c.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¢™å£åœ¨ç©ºä¸­ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™å¯ä»¥é€šè¿‡å°†å¢™å£å’Œå¡”çš„åº•éƒ¨æ‹‰ä¼¸åˆ°åœ°é¢æ¥è§£å†³ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œè¯·ä¸ºä¸­çš„å¢™æ·»åŠ Yåç§»</font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä¸€å•ä½ä¸‹æ¥å°±è¶³å¤Ÿäº†ã€‚</font><font style="vertical-align: inherit;">å°†å¡”çš„é«˜åº¦å¢åŠ ç›¸åŒçš„æ•°é‡ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> wallHeight = <span class="hljs-number"><span class="hljs-number">4f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> wallYOffset = <span class="hljs-number"><span class="hljs-number">-1f</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯¹å…¶è¿›è¡Œæ›´æ”¹ï¼Œ</font></font><code>HexMetrics.WallLerp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä¾¿åœ¨ç¡®å®šYåæ ‡æ—¶è€ƒè™‘æ–°çš„åç§»é‡ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WallLerp</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 near, Vector3 far</span></span></span><span class="hljs-function">)</span></span> { near.x += (far.x - near.x) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; near.z += (far.z - near.z) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> v = near.y &lt; far.y ? wallElevationOffset : (<span class="hljs-number"><span class="hljs-number">1f</span></span> - wallElevationOffset); near.y += (far.y - near.y) * v + wallYOffset; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> near; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬è¿˜éœ€è¦æ›´æ”¹å¡”çš„é¢„åˆ¶ä»¶ï¼Œå› ä¸ºåŸºåº§ç°åœ¨å°†åœ¨åœ°ä¸‹ä¸€å±‚ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å°†åŸºç¡€ç«‹æ–¹ä½“çš„é«˜åº¦å¢åŠ äº†ä¸€ä¸ªå•ä½ï¼Œå¹¶ç›¸åº”åœ°æ›´æ”¹äº†ç«‹æ–¹ä½“çš„å±€éƒ¨ä½ç½®ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f2d/e4e/503/f2de4e50398fbae4ee296737dbe3a922.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ecd/5d7/0eb/ecd5d70ebb620e3bae84f17aedb4a2a9.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨åœ°é¢ä¸Šçš„å¢™å£å’Œå¡”ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2> æ¡¥æ¢ </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬æœ‰æ²³æµå’Œé“è·¯ï¼Œä½†æ˜¯é“è·¯æ— æ³•ä»¥ä»»ä½•æ–¹å¼ç©¿è¶Šæ²³æµã€‚</font><font style="vertical-align: inherit;">ç°åœ¨æ˜¯æ·»åŠ ç½‘æ¡¥çš„åˆé€‚æ—¶é—´ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„å¯ç¼©æ”¾ç«‹æ–¹ä½“å¼€å§‹ï¼Œå®ƒå°†æ‰®æ¼”é¢„åˆ¶æ¡¥æ¢çš„è§’è‰²ã€‚</font><font style="vertical-align: inherit;">æ²³æµçš„å®½åº¦å„ä¸ç›¸åŒï¼Œä½†ä¸¤ä¾§é“è·¯ä¸­å¿ƒä¹‹é—´å¤§çº¦æœ‰ä¸ƒä¸ªè·ç¦»å•ä½ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬ç»™å®ƒä¸€ä¸ªè¿‘ä¼¼çš„æ¯”ä¾‹ï¼ˆ3ï¼Œ1ï¼Œ7ï¼‰ã€‚</font><font style="vertical-align: inherit;">æ·»åŠ é¢„åˆ¶çš„çº¢è‰²åŸå¸‚ææ–™ï¼Œå¹¶æ‘†è„±å…¶å¯¹æ’æœºã€‚</font><font style="vertical-align: inherit;">ä¸å¡”ä¸€æ ·ï¼Œå°†ç«‹æ–¹ä½“æŒ‰ç›¸åŒæ¯”ä¾‹æ”¾ç½®åœ¨æ ¹å¯¹è±¡ä¸­ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæ¡¥æœ¬èº«çš„å‡ ä½•å½¢çŠ¶å¹¶ä¸é‡è¦ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ¡¥çš„é¢„åˆ¶ä»¶ä¸Šæ·»åŠ ä¸€ä¸ªé“¾æ¥ï¼Œ</font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶ä¸ºå…¶åˆ†é…ä¸€ä¸ªé¢„åˆ¶ä»¶ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform wallTower, bridge;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/808/ac6/dc5/808ac6dc523d16d2005da48dcf4d1f65.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å·²åˆ†é…æ¡¥æ¢é¢„åˆ¶ä»¶ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ¡¥çš„ä½ç½® </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦æ”¾ç½®æ¡¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•</font></font><code>HexFeatureManager.AddBridge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æ¡¥æ¢åº”ä½äºæ²³æµä¸­å¿ƒå’Œæ²³æµä¸¤ä¾§ä¹‹é—´ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddBridge</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 roadCenter1, Vector3 roadCenter2</span></span></span><span class="hljs-function">)</span></span> { Transform instance = Instantiate(bridge); instance.localPosition = (roadCenter1 + roadCenter2) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬å°†ä¼ è¾“æœªå˜å½¢çš„é“è·¯ä¸­å¿ƒï¼Œå› æ­¤åœ¨æ”¾ç½®æ¡¥æ¢ä¹‹å‰ï¼Œæˆ‘ä»¬å°†å¿…é¡»å¯¹å®ƒä»¬è¿›è¡Œå˜å½¢ã€‚ </font></font><br><br><pre> <code class="cs hljs"> roadCenter1 = HexMetrics.Perturb(roadCenter1); roadCenter2 = HexMetrics.Perturb(roadCenter2); Transform instance = Instantiate(bridge);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†æ­£ç¡®å¯¹å‡†æ¡¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸æ—‹è½¬å¡”æ—¶ç›¸åŒçš„æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé“è·¯ä¸­å¿ƒå®šä¹‰æ¡¥æ¢çš„å‰å‘çŸ¢é‡ã€‚</font><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬ä¿æŒåœ¨åŒä¸€åƒå…ƒå†…ï¼Œå› æ­¤æ­¤å‘é‡è‚¯å®šæ˜¯æ°´å¹³çš„ï¼Œå› æ­¤æˆ‘ä»¬ä¸éœ€è¦å°†å…¶åˆ†é‡Yå½’é›¶ã€‚</font></font><br><br><pre> <code class="cs hljs"> Transform instance = Instantiate(bridge); instance.localPosition = (roadCenter1 + roadCenter2) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.forward = roadCenter2 - roadCenter1; instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>);</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬åœ¨ç›´æ²³ä¸Šæ¶èµ·æ¡¥æ¢ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å”¯ä¸€éœ€è¦æ¡¥æ¢çš„æ²³æµæ„é€ æ˜¯ç›´çš„å’Œå¼¯æ›²çš„ã€‚é“è·¯å¯ä»¥é€šè¿‡ç«¯ç‚¹ï¼Œè€Œåœ¨ä¹‹å­—å½¢é“è·¯åªèƒ½åœ¨é™„è¿‘ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ‰¾å‡ºç›´æ²³ã€‚åœ¨å†…éƒ¨ï¼Œ</font></font><code>HexGridChunk.TriangulateRoadAdjacentToRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬ä¸€æ“ä½œå‘˜</font></font><code>else if</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿™äº›æ²³æµé™„è¿‘å¸ƒç½®é“è·¯ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†åœ¨æ­¤å¤„æ·»åŠ ç½‘æ¡¥ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬åœ¨æ²³çš„ä¸€ä¾§ã€‚é“è·¯çš„ä¸­å¿ƒä»æ²³ä¸Šç§»å¼€ï¼Œç„¶åå•å…ƒçš„ä¸­å¿ƒä¹Ÿç§»åŠ¨äº†ã€‚è¦åœ¨å¦ä¸€ä¾§æ‰¾åˆ°é“è·¯çš„ä¸­å¿ƒï¼Œæˆ‘ä»¬éœ€è¦å°†ç›¸åçš„æ–¹å‘ç§»åŠ¨ç›¸åŒçš„é‡ã€‚å¿…é¡»åœ¨æ›´æ”¹ä¸­å¿ƒæœ¬èº«ä¹‹å‰å®Œæˆæ­¤æ“ä½œã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoadAdjacentToRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == cell.OutgoingRiver.Opposite()) { â€¦ roadCenter += corner * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; features.AddBridge(roadCenter, center - corner * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); center += corner * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; } â€¦ }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/97c/c7f/420/97cc7f42004ba86c6cd0333af352f24b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›´æ²³ä¸Šçš„æ¡¥æ¢ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¡¥æ¢å‡ºç°äº†ï¼</font><font style="vertical-align: inherit;">ä½†æ˜¯ç°åœ¨ï¼Œåœ¨æ²³ä¸æµç»çš„æ¯ä¸ªæ–¹å‘ä¸Šéƒ½æœ‰ä¸€ä¸ªæ¡¥æ¢å®ä¾‹ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦ç¡®ä¿åœ¨å•å…ƒä¸­ä»…ç”Ÿæˆä¸€ä¸ªæ¡¥å®ä¾‹ã€‚</font><font style="vertical-align: inherit;">è¿™å¯ä»¥é€šè¿‡é€‰æ‹©ç›¸å¯¹äºæ²³æµçš„ä¸€ä¸ªæ–¹å‘å¹¶åœ¨å…¶åŸºç¡€ä¸Šç”Ÿæˆæ¡¥æ¢æ¥å®Œæˆã€‚</font><font style="vertical-align: inherit;">æ‚¨å¯ä»¥é€‰æ‹©ä»»ä½•æ–¹å‘ã€‚</font></font><br><br><pre> <code class="cs hljs"> roadCenter += corner * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == direction.Next()) { features.AddBridge(roadCenter, center - corner * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); } center += corner * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œæˆ‘ä»¬ä»…åœ¨æ²³ä¸¤å²¸éƒ½æœ‰é“è·¯æ—¶æ‰éœ€è¦åŠ æ¡¥ã€‚</font><font style="vertical-align: inherit;">ç›®å‰ï¼Œæˆ‘ä»¬å·²ç»ç¡®å®šå½“å‰çš„é“è·¯ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæ‚¨éœ€è¦æ£€æŸ¥åœ¨æ²³çš„å¦ä¸€è¾¹æ˜¯å¦æœ‰é“è·¯ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == direction.Next() &amp;&amp; ( cell.HasRoadThroughEdge(direction.Next2()) || cell.HasRoadThroughEdge(direction.Opposite()) )) { features.AddBridge(roadCenter, center - corner * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/635/a47/978/635a4797816f9f35297f67224a0ec449.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒæ–¹é“è·¯ä¹‹é—´çš„æ¡¥æ¢ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¼¯æ›²çš„æ²³æµä¸Šçš„æ¡¥æ¢ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¼¯æ›²æ²³æµä¸Šçš„æ¡¥æ¢å·¥ä½œåŸç†ç›¸ä¼¼ï¼Œä½†æ‹“æ‰‘ç»“æ„ç•¥æœ‰ä¸åŒã€‚</font><font style="vertical-align: inherit;">å½“æˆ‘ä»¬åœ¨æ›²çº¿çš„å¤–éƒ¨æ—¶ï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªæ¡¥ã€‚</font><font style="vertical-align: inherit;">è¿™å‘ç”Ÿåœ¨æœ€åä¸€ä¸ªå—ä¸­</font></font><code>else</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å®ƒä½¿ç”¨ä¸­é—´æ–¹å‘æ¥åç§»é“è·¯çš„ä¸­å¿ƒã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†éœ€è¦ä»¥ä¸åŒçš„æ¯”ä¾‹ä¸¤æ¬¡ä½¿ç”¨æ­¤åç§»é‡ï¼Œå› æ­¤å°†å…¶ä¿å­˜åˆ°å˜é‡ä¸­ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoadAdjacentToRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { HexDirection middle; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver) { middle = direction.Next(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextHasRiver) { middle = direction.Previous(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { middle = direction; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !cell.HasRoadThroughEdge(middle) &amp;&amp; !cell.HasRoadThroughEdge(middle.Previous()) &amp;&amp; !cell.HasRoadThroughEdge(middle.Next()) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } Vector3 offset = HexMetrics.GetSolidEdgeMiddle(middle); roadCenter += offset * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; } â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›²çº¿å¤–éƒ¨çš„ä½ç§»æ¯”ä¾‹ä¸º0.25ï¼Œå†…éƒ¨ä¸º</font></font><code>HexMetrics.innerToOuter * 0.7f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ç”¨å®ƒæ¥æ”¾ç½®æ¡¥ã€‚</font></font><br><br><pre> <code class="cs hljs"> Vector3 offset = HexMetrics.GetSolidEdgeMiddle(middle); roadCenter += offset * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; features.AddBridge( roadCenter, center - offset * (HexMetrics.innerToOuter * <span class="hljs-number"><span class="hljs-number">0.7f</span></span>) );</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/612/f9e/da9/612f9eda9f9e4cd31ba20dfe2db7687b.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¼¯æ›²çš„æ²³æµä¸Šçš„æ¡¥æ¢ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å†æ¬¡ï¼Œæˆ‘ä»¬éœ€è¦é¿å…é‡å¤çš„æ¡¥æ¥ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»…ä»ä¸­é—´æ–¹å‘æ·»åŠ æ¡¥æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚</font></font><br><br><pre> <code class="cs hljs"> Vector3 offset = HexMetrics.GetSolidEdgeMiddle(middle); roadCenter += offset * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction == middle) { features.AddBridge( roadCenter, center - offset * (HexMetrics.innerToOuter * <span class="hljs-number"><span class="hljs-number">0.7f</span></span>) ); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åŒæ ·ï¼Œæ‚¨éœ€è¦ç¡®ä¿é“è·¯åœ¨å¯¹é¢ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( direction == middle &amp;&amp; cell.HasRoadThroughEdge(direction.Opposite()) ) { features.AddBridge( roadCenter, center - offset * (HexMetrics.innerToOuter * <span class="hljs-number"><span class="hljs-number">0.7f</span></span>) ); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/744/33c/275/74433c2750e413c44d17139982ecff3b.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒæ–¹é“è·¯ä¹‹é—´çš„æ¡¥æ¢ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ¡¥æ¢ç¼©æ”¾ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬æ‰­æ›²äº†åœ°å½¢ï¼Œå› æ­¤é“è·¯ä¸­å¿ƒå’Œæ²³æµå¯¹å²¸ä¹‹é—´çš„è·ç¦»ä¼šå‘ç”Ÿå˜åŒ–ã€‚</font><font style="vertical-align: inherit;">æœ‰æ—¶æ¡¥å¤ªçŸ­ï¼Œæœ‰æ—¶å¤ªé•¿ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/770/f2c/e53/770f2ce537ab16628c799eceb6ca4ad7.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è·ç¦»å¯å˜ï¼Œä½†æ¡¥é•¿ä¸å˜ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°½ç®¡æˆ‘ä»¬åˆ›å»ºçš„æ¡¥çš„é•¿åº¦ä¸º7ä¸ªå•ä½ï¼Œä½†æ‚¨å¯ä»¥å¯¹å…¶è¿›è¡Œç¼©æ”¾ä»¥åŒ¹é…é“è·¯ä¸­å¿ƒä¹‹é—´çš„çœŸå®è·ç¦»ã€‚</font><font style="vertical-align: inherit;">è¿™æ„å‘³ç€æ¡¥æ¢æ¨¡å‹å˜å½¢äº†ã€‚</font><font style="vertical-align: inherit;">ç”±äºè·ç¦»å˜åŒ–ä¸å¤§ï¼Œå› æ­¤å˜å½¢æ¯”ä¸é€‚åˆé•¿åº¦çš„æ¡¥æ›´å®¹æ˜“æ¥å—ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†è¿›è¡Œé€‚å½“çš„ç¼©æ”¾ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æ¡¥æ¢é¢„åˆ¶ä»¶çš„åˆå§‹é•¿åº¦ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†æ­¤é•¿åº¦å­˜å‚¨åœ¨ä¸­</font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> bridgeDesignLength = <span class="hljs-number"><span class="hljs-number">7f</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ²¿æ¡¥æ¢Zå®ä¾‹çš„æ¯”ä¾‹åˆ†é…ç»™é“è·¯ä¸­å¿ƒä¹‹é—´çš„è·ç¦»ï¼Œå†é™¤ä»¥åŸå§‹é•¿åº¦ã€‚</font><font style="vertical-align: inherit;">ç”±äºæ¡¥çš„é¢„åˆ¶ä»¶çš„æ ¹éƒ¨å…·æœ‰ç›¸åŒçš„æ¯”ä¾‹ï¼Œå› æ­¤æ¡¥å°†æ­£ç¡®æ‹‰ä¼¸ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddBridge</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 roadCenter1, Vector3 roadCenter2</span></span></span><span class="hljs-function">)</span></span> { roadCenter1 = HexMetrics.Perturb(roadCenter1); roadCenter2 = HexMetrics.Perturb(roadCenter2); Transform instance = Instantiate(bridge); instance.localPosition = (roadCenter1 + roadCenter2) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.forward = roadCenter2 - roadCenter1; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> length = Vector3.Distance(roadCenter1, roadCenter2); instance.localScale = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3( <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, length * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / HexMetrics.bridgeDesignLength) ); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/21e/b73/49c/21eb7349c5e7ae6d5480b2e61d19e046.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä¸æ–­å˜åŒ–çš„æ¡¥æ¢é•¿åº¦ã€‚ </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ¡¥æ¢å»ºè®¾ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»£æ›¿ç®€å•çš„å¤šç»´æ•°æ®é›†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ›´æœ‰è¶£çš„æ¡¥æ¨¡å‹ã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åˆ›å»ºç”±ä¸‰ä¸ªç¼©æ”¾å’Œæ—‹è½¬çš„å¤šç»´æ•°æ®é›†ç»„æˆçš„ç²—ç³™æ‹±å½¢æ¡¥ã€‚</font><font style="vertical-align: inherit;">å½“ç„¶ï¼Œæ‚¨å¯ä»¥åˆ›å»ºæ›´å¤æ‚çš„3Dæ¨¡å‹ï¼ŒåŒ…æ‹¬é“è·¯çš„ä¸€éƒ¨åˆ†ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯è¯·æ³¨æ„ï¼Œæ•´ä¸ªå¯¹è±¡å°†ç•¥å¾®å‹ç¼©å’Œæ‹‰ä¼¸ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eee/83f/3b6/eee83f3b67cf879abe3114117614af08.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8a9/741/f7f/8a9741f7f024aa8914e29b12c1ae9d94.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸åŒé•¿åº¦çš„æ‹±å½¢æ¡¥ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç‰¹æ®Šç‰©å“ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„å•å…ƒæ ¼å¯ä»¥åŒ…å«åŸå¸‚ï¼Œå†œæ‘å’Œæ¤ç‰©å¯¹è±¡ã€‚å³ä½¿å®ƒä»¬æ¯ä¸ªéƒ½æœ‰ä¸‰ä¸ªçº§åˆ«ï¼Œä½†ä¸å•å…ƒæ ¼çš„å¤§å°ç›¸æ¯”ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½éå¸¸å°ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€å¹¢å¤§å‹å»ºç­‘ï¼Œä¾‹å¦‚åŸå ¡ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å‘åœ°å½¢æ·»åŠ ä¸€ç§ç‰¹æ®Šç±»å‹çš„å¯¹è±¡ã€‚è¿™æ ·çš„ç‰©ä½“å¤ªå¤§ï¼Œä»¥è‡³äºå æ®äº†æ•´ä¸ªå•å…ƒã€‚è¿™äº›å¯¹è±¡ä¸­çš„æ¯ä¸€ä¸ªéƒ½æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”éœ€è¦è‡ªå·±çš„é¢„åˆ¶ä»¶ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç®€å•çš„åŸå ¡å¯ä»¥ç”±ä¸€ä¸ªä¸­å¤®ç«‹æ–¹ä½“å’Œå››ä¸ªè§’æ¥¼ç»„æˆã€‚ä¸­å¤®ç«‹æ–¹ä½“çš„åˆ»åº¦ï¼ˆ6ã€4ã€6ï¼‰å°†äº§ç”Ÿè¶³å¤Ÿå¤§çš„é”ï¼Œå³ä½¿åœ¨ä¸¥é‡å˜å½¢çš„å•å…ƒä¸­ä¹Ÿå¯ä»¥å®‰è£…ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7e1/9bf/0dc/7e19bf0dc5f1568bf4b21ec467ba9063.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŸå ¡çš„é¢„åˆ¶ä»¶ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡å¯ä»¥æ˜¯ä¹‹å­—å½¢ï¼Œä¾‹å¦‚ï¼Œç”±ä¸‰ä¸ªç›¸äº’å ç½®çš„ç«‹æ–¹ä½“æ„æˆã€‚</font><font style="vertical-align: inherit;">å¯¹äºä¸‹éƒ¨ç«‹æ–¹ä½“ï¼Œåˆ»åº¦ï¼ˆ8ã€2.5ã€8ï¼‰æ˜¯åˆé€‚çš„ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ad/7d3/291/1ad7d3291224358562b3472f528973a1.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¢„åˆ¶é”¯é½¿å½¢ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰¹æ®Šå¯¹è±¡å¯ä»¥æ˜¯ä»»ä½•å¯¹è±¡ï¼Œä¸ä¸€å®šæ˜¯å»ºç­‘å¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œä¸€ç»„é«˜è¾¾åä¸ªå•ä½é«˜çš„å¤§æ ‘å¯ä»¥æŒ‡ç¤ºä¸€ä¸ªå……æ»¡å·¨å‹æ¤ç‰©çš„ç»†èƒã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1bb/e91/907/1bbe91907deba70f6ab9d02cd13de795.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¢„åˆ¶å¤§å‹æ¤ç‰©ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·»åŠ åˆ°</font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é˜µåˆ—ä»¥è·Ÿè¸ªè¿™äº›é¢„åˆ¶ä»¶ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform[] special;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é¦–å…ˆï¼Œå‘é˜µåˆ—ä¸­æ·»åŠ ä¸€ä¸ªåŸå ¡ï¼Œç„¶åæ·»åŠ zigguratï¼Œç„¶åæ·»åŠ å¤§å‹æ¤ç‰©ã€‚ </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bbc/2e3/e94/bbc2e3e949b25efc800a8f2e799490c7.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰¹æ®Šå¯¹è±¡çš„å®šåˆ¶ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä½¿ç»†èƒå˜å¾—ç‰¹åˆ« </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨</font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œéœ€è¦ç‰¹æ®Šå¯¹è±¡çš„ç´¢å¼•ï¼Œè¯¥ç´¢å¼•ç¡®å®šç‰¹æ®Šå¯¹è±¡çš„ç±»å‹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> specialIndex;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åƒå…¶ä»–æ•‘æµå¯¹è±¡ä¸€æ ·ï¼Œè®©æˆ‘ä»¬â€‹â€‹ä¸ºå…¶æä¾›æ¥æ”¶å’Œè®¾ç½®æ­¤å€¼çš„èƒ½åŠ›ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> SpecialIndex { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> specialIndex; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (specialIndex != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { specialIndex = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; RefreshSelfOnly(); } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å•å…ƒæ ¼ä¸åŒ…å«ç‰¹æ®Šå¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ç”¨ç´¢å¼•0è¡¨ç¤ºå®ƒã€‚æ·»åŠ ä½¿ç”¨æ­¤æ–¹æ³•ç¡®å®šå•å…ƒæ ¼æ˜¯å¦ç‰¹æ®Šçš„å±æ€§ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsSpecial { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> specialIndex &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦ç¼–è¾‘å•å…ƒæ ¼ï¼Œè¯·æ·»åŠ å¯¹ç‰¹æ®Šå¯¹è±¡ç´¢å¼•çš„æ”¯æŒ</font></font><code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å®ƒçš„å·¥ä½œæ–¹å¼ç±»ä¼¼äºåŸå¸‚ï¼Œå†œæ‘å’Œå·¥å‚è®¾æ–½çš„æ°´å¹³ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> activeUrbanLevel, activeFarmLevel, activePlantLevel, activeSpecialIndex; â€¦ <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> applyUrbanLevel, applyFarmLevel, applyPlantLevel, applySpecialIndex; â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetApplySpecialIndex</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> toggle</span></span></span><span class="hljs-function">)</span></span> { applySpecialIndex = toggle; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetSpecialIndex</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index</span></span></span><span class="hljs-function">)</span></span> { activeSpecialIndex = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)index; } â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyColor) { cell.Color = activeColor; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyElevation) { cell.Elevation = activeElevation; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyWaterLevel) { cell.WaterLevel = activeWaterLevel; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applySpecialIndex) { cell.SpecialIndex = activeSpecialIndex; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyUrbanLevel) { cell.UrbanLevel = activeUrbanLevel; } â€¦ } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†æ»‘å—æ·»åŠ åˆ°UIä¸­ä»¥æ§åˆ¶ç‰¹æ®Šå¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬æœ‰ä¸‰ä¸ªå¯¹è±¡ï¼Œå› æ­¤åœ¨æ»‘å—ä¸­ä½¿ç”¨é—´éš”0â€“3ã€‚</font><font style="vertical-align: inherit;">é›¶è¡¨ç¤ºæ²¡æœ‰ç‰©ä½“ï¼Œä¸€ä¸ª-åŸå ¡ï¼Œä¸¤ä¸ª-é”¯é½¿å½¢ç´ï¼Œä¸‰ä¸ª-å·¨å‹æ¤ç‰©ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ab4/2ea/9bf/ab42ea9bf68565a294f4ded5d2d7ebf0.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰¹æ®Šå¯¹è±¡çš„æ»‘å—ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ·»åŠ ç‰¹æ®Šå¯¹è±¡ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å¯ä»¥ä¸ºå•å…ƒæ ¼åˆ†é…ç‰¹æ®Šçš„å¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†ä½¿å®ƒä»¬å‡ºç°ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ åˆ°</font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦ä¸€ç§æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">å®ƒä»…åˆ›å»ºæ‰€éœ€ç‰¹æ®Šå¯¹è±¡çš„å®ä¾‹å¹¶å°†å…¶æ”¾ç½®åœ¨æ‰€éœ€ä½ç½®ã€‚</font><font style="vertical-align: inherit;">ç”±äºé›¶è¡¨ç¤ºä¸å­˜åœ¨å¯¹è±¡ï¼Œå› æ­¤åœ¨è®¿é—®é¢„åˆ¶é˜µåˆ—ä¹‹å‰ï¼Œå¿…é¡»ä»å•å…ƒçš„ç‰¹æ®Šå¯¹è±¡çš„ç´¢å¼•ä¸­å‡å»å•ä½ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddSpecialFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Transform instance = Instantiate(special[cell.SpecialIndex - <span class="hljs-number"><span class="hljs-number">1</span></span>]); instance.localPosition = HexMetrics.Perturb(position); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è®©æˆ‘ä»¬ä½¿ç”¨å“ˆå¸Œè¡¨å¯¹å¯¹è±¡è¿›è¡Œä»»æ„æ—‹è½¬ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddSpecialFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Transform instance = Instantiate(special[cell.SpecialIndex - <span class="hljs-number"><span class="hljs-number">1</span></span>]); instance.localPosition = HexMetrics.Perturb(position); HexHash hash = HexMetrics.SampleHashGrid(position); instance.localRotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">360f</span></span> * hash.e, <span class="hljs-number"><span class="hljs-number">0f</span></span>); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹å•å…ƒæ ¼è¿›è¡Œä¸‰è§’å‰–åˆ†æ—¶ï¼Œæˆ‘ä»¬</font></font><code>HexGridChunk.Triangulate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†æ£€æŸ¥è¯¥å•å…ƒæ ¼æ˜¯å¦åŒ…å«ç‰¹æ®Šå¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ˜¯è¿™æ ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åƒä¸€æ ·è°ƒç”¨æˆ‘ä»¬çš„æ–°æ–¹æ³•</font></font><code>AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (HexDirection d = HexDirection.NE; d &lt;= HexDirection.NW; d++) { Triangulate(d, cell); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !cell.HasRiver &amp;&amp; !cell.HasRoads) { features.AddFeature(cell, cell.Position); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IsSpecial) { features.AddSpecialFeature(cell, cell.Position); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b69/242/657/b692426576e292bbdc9ed0752624db51.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰¹æ®Šå¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">å®ƒä»¬æ¯”å¹³å¸¸å¤§å¾—å¤šã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é¿å¼€æ²³æµ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç”±äºç‰¹æ®Šå¯¹è±¡ä½äºå•å…ƒæ ¼çš„ä¸­å¿ƒï¼Œå› æ­¤å®ƒä»¬ä¸ä¼šä¸æ²³æµç»“åˆï¼Œå› ä¸ºå®ƒä»¬ä¼šæ‚¬åœ¨æ²³æµä¸Šæ–¹ã€‚ </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a51/92f/cc2/a5192fcc2c5718f33bafc631f60a07a8.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ²³ä¸Šçš„å¯¹è±¡ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†é˜²æ­¢åœ¨æ²³æµä¸Šåˆ›å»ºç‰¹æ®Šå¯¹è±¡ï¼Œæˆ‘ä»¬æ›´æ”¹äº†å±æ€§</font></font><code>HexCell.SpecialIndex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä»…å½“å•å…ƒæ ¼ä¸­æ²¡æœ‰æ²³æµæ—¶ï¼Œæˆ‘ä»¬æ‰ä¼šæ›´æ”¹ç´¢å¼•ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> SpecialIndex { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (specialIndex != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &amp;&amp; !HasRiver) { specialIndex = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; RefreshSelfOnly(); } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦å¤–ï¼Œæ·»åŠ æ²³æµæ—¶ï¼Œæˆ‘ä»¬å°†éœ€è¦é™¤å»æ‰€æœ‰ç‰¹æ®Šå¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">æ²³æ°´åº”å°†å®ƒä»¬æ´—å‡€ã€‚</font><font style="vertical-align: inherit;">è¿™å¯ä»¥é€šè¿‡åœ¨æ–¹æ³•ä¸­å°†</font></font><code>HexCell.SetOutgoingRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰¹æ®Šå¯¹è±¡çš„ç´¢å¼•è®¾ç½®ä¸º0 </font><font style="vertical-align: inherit;">æ¥å®Œæˆ</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetOutgoingRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { â€¦ hasOutgoingRiver = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; outgoingRiver = direction; specialIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; neighbor.RemoveIncomingRiver(); neighbor.hasIncomingRiver = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; neighbor.incomingRiver = direction.Opposite(); neighbor.specialIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; SetRoad((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬é¿å¼€é“è·¯ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åƒæ²³æµä¸€æ ·ï¼Œé“è·¯ä¸Šçš„ç‰¹æ®Šç‰©ä½“ä¹Ÿå¾ˆå·®åŠ²ï¼Œä½†å¹¶éä¸€åˆ‡éƒ½é‚£ä¹ˆå¯æ€•ã€‚</font><font style="vertical-align: inherit;">æ‚¨ç”šè‡³å¯ä»¥åŸæ ·ç¦»å¼€é“è·¯ã€‚</font><font style="vertical-align: inherit;">ä¸€äº›è®¾æ–½å¯èƒ½ä¸é“è·¯å…¼å®¹ï¼Œè€Œå…¶ä»–è®¾æ–½åˆ™å¯èƒ½ä¸å…¼å®¹ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œå¯ä»¥ä½¿å®ƒä»¬ä¾èµ–äºå¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯æˆ‘ä»¬å°†ä½¿å…¶å˜å¾—æ›´å®¹æ˜“ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b3b/ebf/939/b3bebf9399ed016e8d79a4c1ee53ace8.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è·¯ä¸Šçš„å¯¹è±¡ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯·è®©ç‰¹æ®Šçš„ç‰©ä½“æŒ¡è·¯ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œåœ¨æ›´æ”¹ç‰¹æ®Šå¯¹è±¡çš„ç´¢å¼•æ—¶ï¼Œæˆ‘ä»¬è¿˜å°†ä»å•å…ƒæ ¼ä¸­åˆ é™¤æ‰€æœ‰é“è·¯ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> SpecialIndex { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (specialIndex != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &amp;&amp; !HasRiver) { specialIndex = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; RemoveRoads(); RefreshSelfOnly(); } } }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬åˆ é™¤ç‰¹å®šå¯¹è±¡æ€ä¹ˆåŠï¼Ÿ</font></font></b> <div class="spoiler_text">      0,   ,       .            . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œè¿™æ„å‘³ç€åœ¨æ·»åŠ é“è·¯æ—¶ï¼Œæˆ‘ä»¬å°†å¿…é¡»æ‰§è¡Œå…¶ä»–æ£€æŸ¥ã€‚</font><font style="vertical-align: inherit;">ä»…å½“æ‰€æœ‰åƒå…ƒéƒ½ä¸æ˜¯å…·æœ‰ç‰¹æ®Šå¯¹è±¡çš„åƒå…ƒæ—¶ï¼Œæˆ‘ä»¬æ‰æ·»åŠ é“è·¯ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddRoad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !roads[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction] &amp;&amp; !HasRiverThroughEdge(direction) &amp;&amp; !IsSpecial &amp;&amp; !GetNeighbor(direction).IsSpecial &amp;&amp; GetElevationDifference(direction) &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span> ) { SetRoad((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é¿å…å…¶ä»–ç‰©ä½“ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰¹æ®Šå¯¹è±¡ä¸èƒ½ä¸å…¶ä»–ç±»å‹çš„å¯¹è±¡æ··åˆã€‚</font><font style="vertical-align: inherit;">å¦‚æœå®ƒä»¬é‡å ï¼Œåˆ™çœ‹èµ·æ¥ä¼šä¸æ•´æ´ã€‚</font><font style="vertical-align: inherit;">å®ƒä¹Ÿå¯èƒ½å–å†³äºç‰¹å®šçš„å¯¹è±¡ï¼Œä½†æ˜¯æˆ‘ä»¬å°†ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/03b/7f1/8fc/03b7f18fc9f9d7543bdb0d9c24a074e2.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸å…¶ä»–å¯¹è±¡ç›¸äº¤çš„å¯¹è±¡ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†éšè—è¾ƒå°çš„å¯¹è±¡ï¼Œå°±åƒå®ƒä»¬åœ¨æ°´ä¸‹ä¸€æ ·ã€‚</font><font style="vertical-align: inherit;">è¿™æ¬¡æˆ‘ä»¬å°†ç­¾å…¥</font></font><code>HexFeatureManager.AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, Vector3 position</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IsSpecial) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } â€¦ }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é¿å…é¥®æ°´ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä¹Ÿæœ‰æ°´é—®é¢˜ã€‚</font><font style="vertical-align: inherit;">æ´ªæ°´æœŸé—´ç‰¹æ®ŠåŠŸèƒ½ä¼šæŒç»­å­˜åœ¨å—ï¼Ÿ</font><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬è¦æ‘§æ¯æ·¹æ²¡å•å…ƒä¸­çš„å°ç‰©ä½“ï¼Œå› æ­¤å¯¹ç‰¹æ®Šç‰©ä½“ä¹Ÿè¦è¿™æ ·åšã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8d9/479/e79/8d9479e79cb0555c81f562dc32937552.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ°´ä¸­çš„ç‰©ä½“ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äº</font></font><code>HexGridChunk.Triangulate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬æ‰§è¡Œäº†æ´ªæ°´å’Œç‰¹æ®Šï¼Œå’Œæ™®é€šå¯¹è±¡ç›¸åŒçš„æ£€æŸ¥ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (HexDirection d = HexDirection.NE; d &lt;= HexDirection.NW; d++) { Triangulate(d, cell); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !cell.HasRiver &amp;&amp; !cell.HasRoads) { features.AddFeature(cell, cell.Position); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; cell.IsSpecial) { features.AddSpecialFeature(cell, cell.Position); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºä¸¤ä¸ªæ“ä½œå‘˜</font></font><code>if</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨éƒ½åœ¨æ£€æŸ¥ç”µæ± æ˜¯å¦åœ¨æ°´ä¸‹ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è½¬ç§»æµ‹è¯•å¹¶ä»…æ‰§è¡Œä¸€æ¬¡ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (HexDirection d = HexDirection.NE; d &lt;= HexDirection.NW; d++) { Triangulate(d, cell); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.HasRiver &amp;&amp; !cell.HasRoads) { features.AddFeature(cell, cell.Position); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IsSpecial) { features.AddSpecialFeature(cell, cell.Position); } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹äºå®éªŒæ¥è¯´ï¼Œè¿™ä¹ˆå¤šçš„å¯¹è±¡å¯¹æˆ‘ä»¬æ¥è¯´å°±è¶³å¤Ÿäº†ã€‚</font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN425463/">https://habr.com/ru/post/zh-CN425463/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN425449/index.html">æ›´æ–°ä¸Šä¸‹æ–‡å¹¿å‘Šçš„æ–¹æ³•ï¼šYandex.Direct Turbo Pages</a></li>
<li><a href="../zh-CN425453/index.html">ä»å¤ªç©ºä¾µç•¥è€…åˆ°åŠæ¡å‘½2ï¼šDzdoksæ¸¸æˆçš„æ•…äº‹</a></li>
<li><a href="../zh-CN425457/index.html">äºŒåä¸ªè°œé¢˜ï¼ˆç–¯ç‹‚ï¼ŒæƒŠäººçš„å‡ ä½•å½¢çŠ¶ï¼‰</a></li>
<li><a href="../zh-CN425459/index.html">å‡çº§åˆ°Windows 1809ï¼ˆæœ‰æ—¶ï¼‰ä¼šç ´åé…ç½®æ–‡ä»¶ä¸­çš„æ‰€æœ‰æ–‡ä»¶</a></li>
<li><a href="../zh-CN425461/index.html">å‘å±•ä¸å®‰å…¨ï¼šå¡æ€Â·æ²ƒæˆˆï¼ˆSeth Wargoï¼‰å’Œä¸½å…¹Â·èµ–æ–¯ï¼ˆLiz Riceï¼‰è®¿è°ˆ</a></li>
<li><a href="../zh-CN425465/index.html">è®¾è®¡å¸ˆå¦‚ä½•èµšé’±ï¼Œè¿™æ˜¯å·¥ä½œå’Œå¯»æ‰¾æƒ³æ³•çš„ç†æƒ³å·¥å…·</a></li>
<li><a href="../zh-CN425467/index.html">å¼•æ“é›·è¯ºD4F> B4Dï¼ˆåˆåSCeï¼‰ã€‚ ä»£é™…å˜åŒ–ã€‚ é©¾é©¶è€…å¤–è§‚</a></li>
<li><a href="../zh-CN425469/index.html">Pythonä½œè€…ä¸å†é¢†å¯¼å¼€å‘ã€‚ å®ƒä¼šä½¿è¯­è¨€å˜å¾—æ›´å¥½è¿˜æ˜¯æ›´åï¼Ÿ</a></li>
<li><a href="../zh-CN425471/index.html">ä½¿ç”¨Pythonå¤„ç†å›¾ç‰‡</a></li>
<li><a href="../zh-CN425473/index.html">å…³äºPythonå’Œé€šä¿¡çš„ä¼šè®®</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>