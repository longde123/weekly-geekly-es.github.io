<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👲🏼 🧒🏻 🖖🏼 Créer un bouton avec Ripple Effect pour XMars UI 🤰🏼 🙋🏼 🏢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour à tous, aujourd'hui, je vais vous dire comment j'ai développé le bouton pour le projet XMars UI . Oh oui, c'est une bagatelle, mais il y a que...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Créer un bouton avec Ripple Effect pour XMars UI</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484554/"><p><img src="https://habrastorage.org/webt/qb/fw/za/qbfwzabrpaxjd5t8yzbqojymgwg.jpeg"></p><br><p> Bonjour à tous, aujourd'hui, je vais vous dire comment j'ai développé le bouton pour le projet <a href="http://bit.ly/2RAsroW" rel="nofollow">XMars UI</a> .  Oh oui, c'est une bagatelle, mais il y a quelque chose à dire.  Je vais omettre les détails associés à l'ajout d'un nouveau composant au projet open source.  Plus en détail, je parlerai du projet dans un article séparé. </p><br><h3 id="vvedenie">  Présentation </h3><br><p>  <a href="http://bit.ly/2RbfuDn" rel="nofollow">XMars UI</a> est l'un de mes nouveaux projets open source.  Une bibliothèque simple de composants d'interface utilisateur pour HTML / CSS et React.  À l'avenir, je prévois de soutenir Vue.  Jusqu'à présent, il n'a qu'un bouton et des icônes :) </p><br><p>  Le projet est né comme une idée dans le cadre du Telegram Contest, dont l'essence était de développer une version web du client.  Avec un collègue, nous avons décidé, pourquoi ne pas y participer.  Les rôles ont été partagés afin d'avoir une mise en page, et lorsqu'un collègue comprend l'autorisation, je me connecte pour écrire des composants.  Tout irait bien, mais se connecter au Telegram n'est pas si simple.  En conséquence, nous n'avons rien envoyé, mais j'ai rattrapé un tas de tout et cela s'est avéré - en vain.  Mais comme le dit Varlamov, votre projet vaut déjà quelque chose, puisque vous y avez consacré votre temps.  Il est difficile d'être en désaccord avec cela, car si vous transférez en heures et en argent, la simple configuration de Webpack au tout début du projet n'est plus gratuite.  En regardant toute cette honte, j'ai décidé que je devais en quelque sorte la jeter sur l'open source.  Quel bootstrap unique utiliser?  Je veux mon propre cadre d'interface utilisateur pour mes autres projets. </p><a name="habracut"></a><br><h3 id="the-button">  Le bouton </h3><br><p>  Le bouton de l'interface est peut-être l'élément principal avec lequel l'utilisateur interagit avec l'application.  Par conséquent, c'est l'un des premiers composants de tout framework / bibliothèque d'interface utilisateur. </p><br><p>  Dans la conception de Telegram, il n'y a pas beaucoup de variations de boutons: </p><br><p><img src="https://habrastorage.org/webt/6h/g7/t6/6hg7t6irtlvoinmtwbgu7t1zezu.png"></p><br><p>  J'ai mis en évidence 3 principaux (par défaut, accent, primaire), rond avec une icône et vert.  Il est encore semi transparent, mais laisse tomber.  Pour l'essentiel, en développant l' <a href="http://bit.ly/2tr72a0" rel="nofollow">interface utilisateur XMars,</a> j'essaie de partir des besoins, je n'ai pas compris où le bouton transparent serait nécessaire. </p><br><p> L'utilisateur de la bibliothèque doit être à l'aise avec les classes CSS.  Je ne suis pas un fan de systèmes de nommage tels que BEM.  J'aime la façon dont Bootstrap nomme les classes.  Mais je simplifierais un peu plus.  Au lieu de <code>.btn .btn-primary</code> , juste <code>.btn .primary</code> .  Et dans le cas du composant React, il ressemblera à ceci: </p><br><pre> <code class="javascript hljs">&lt;Button primary&gt;Hey&lt;<span class="hljs-regexp"><span class="hljs-regexp">/Button&gt;</span></span></code> </pre> <br><p>  Le même bouton mais effet d'entraînement: </p><br><pre> <code class="javascript hljs">&lt;Button primary ripple&gt;Hey&lt;<span class="hljs-regexp"><span class="hljs-regexp">/Button&gt;</span></span></code> </pre> <br><h3 id="html--css">  HTML / CSS </h3><br><p>  La bibliothèque d'interface utilisateur ne doit être liée à aucun cadre d'interface utilisateur.  À l'avenir, je prévois d'étendre la disposition sur les composants <code>Vue</code> .  Commençons par le HTML / CSS simple. </p><br><p>  Sous le capot du projet <a href="http://bit.ly/364UK4g" rel="nofollow">Tailwindcss</a> , il s'agit d'un framework CSS d'abord utilitaire, c'est-à-dire un framework qui vous fournit des utilitaires, au lieu de composants à part entière. </p><br><p><img src="https://habrastorage.org/webt/by/c_/rk/byc_rkdkrpk4-igmro0h4wnbkli.png"></p><br><p>  En plus de Tailwindcss, PostCSS est utilisé pour les <a href="https://github.com/postcss/postcss-mixins" rel="nofollow">mixins</a> , les <a href="https://github.com/postcss/postcss-custom-properties" rel="nofollow">variables</a> et <a href="https://github.com/postcss/postcss-nested" rel="nofollow">les styles imbriqués.</a> </p><br><p>  Plus en détail sur l'utilisation d'un tel framework et comment le projet est configuré, je le dirai dans un article séparé.  À ce stade, il suffit d'avoir une boîte à outils aussi puissante et d'utiliser pleinement les composants. </p><br><p>  La <code>&lt;button&gt;</code> a un certain nombre de styles par défaut que nous devons supprimer ou redéfinir. </p><br><p><img src="https://habrastorage.org/webt/rq/uw/ad/rquwad-pftcaam8vqie3bwhsmew.png"></p><br><p>  Dans le cas de Tailwindcss, la balise button a ce style: </p><br><p><img src="https://habrastorage.org/webt/ok/c9/2c/okc92cjctwgo5v8nf0qes8_dcvu.png"></p><br><p>  Tous inutiles par défaut supprimés.  Vous pouvez sculpter ce que vous voulez sans craindre qu'une bordure par défaut ne tombe sur un état.  Mais voici une mise en garde, le <code>outline</code> par défaut doit encore être cloué: </p><br><p><img src="https://habrastorage.org/webt/6d/7w/d7/6d7wd77y15peye0xdl8luutiscq.png"></p><br><p>  Un bouton dans l' <a href="http://bit.ly/30yxc6C" rel="nofollow">interface utilisateur de XMars</a> a une classe <code>.btn</code> : </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn"</span></span></span><span class="hljs-tag">&gt;</span></span>Button<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Ajoutez cette classe à nos styles: </p><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.btn</span></span> { @apply text-black text-base leading-snug; @apply py-3 px-4 border-none rounded-lg; @apply inline-block cursor-pointer no-underline; &amp;:focus { @apply outline-none; } }</code> </pre> <br><p>  Outre le fait que Tailwindcss fournit des classes que vous pouvez utiliser, il fournit une sorte de <code>mixins</code> .  <code>@apply</code> n'est pas SCSS ou une sorte de plugin pour PostCSS.  C'est la syntaxe de Tailwindcss elle-même.  Les styles appliqués sont généralement sémantiquement clairs du nom.  <code>py-3</code> et <code>px-4</code> seuls peuvent poser des questions.  Le premier est le remplissage le long de y, c'est-à-dire verticalement, à savoir le <code>padding-top: 0.75rem;</code> <code>padding-bottom: 0.75rem;</code>  .  Par conséquent, le <code>px-4</code> horizontalement est <code>padding-right: 1rem;</code>  , <code>padding-left: 1rem;</code>  . </p><br><p>  Le design que Telegram a fourni pour le dire légèrement est mal documenté et des choses comme <code>border-radius</code> boutons de <code>border-radius</code> doivent être prises avec une règle directement à partir de l'image.  Vous êtes-vous déjà demandé ce que signifient exactement les valeurs dans <code>border-radius</code> ? </p><br><p><img src="https://habrastorage.org/webt/t1/61/sp/t161sp5vhq_sw2hwtb56ibfylgs.gif"></p><br><p>  C'est littéralement le rayon du cercle résultant dans le coin.  Si la ferme collective, vous pouvez changer la règle comme indiqué dans l'image ci-dessus.  J'ai donc utilisé la sélection rectangulaire dans Gimp. </p><br><p><img src="https://habrastorage.org/webt/9b/-x/bk/9b-xbkbj3mbmrmsgttlhpzx2nbc.png"></p><br><p>  <code>border-radius</code> boutons dans la conception est de 10 pixels, malheureusement il n'y a pas une telle classe dans la boîte de Tailwindcss, mais j'avais visuellement <code>rounded-lg</code> qui est de 8 <code>8px</code> pour la taille de police par défaut (rem). </p><br><p>  Voici ce qui s'est passé en ce moment, j'ai peint le bouton en gris pour que les bords soient visibles: </p><br><p><img src="https://habrastorage.org/webt/a2/tz/z-/a2tzz-khw1guvggfgjz0vjecfnm.png"></p><br><p>  Ensuite, nous devons faire un effet sur <code>:hover</code> .  Ensuite, les concepteurs de Telegram ont décidé de faire la lumière et ont indiqué la couleur à 0,08% par rapport à <code>#707579</code> .  Je vois deux options, prenez simplement la couleur avec la pipette ou faites-le comme indiqué.  La première option est plus simple, mais à l'avenir ce n'est pas la meilleure.  Le fait est que si l'arrière-plan est différent du blanc, alors <code>:hover</code> nous obtiendrons une couleur spécifique, perdrons la «légèreté» et la transparence du bouton.  Pour cela il vaut mieux suivre la documentation et poser alpha <del>  mâle </del>  la chaîne.  Cela peut être fait de nombreuses manières, par exemple en utilisant les fonctions de couleur SCSS.  Mais il n'y a pas de SCSS dans le projet, et à cause de la même couleur, je ne veux pas connecter de plug-in à PostCSS, nous rendrons tout très simple.  Dans Chrome, il existe un colopaker qui vous permet de transformer les couleurs en différents systèmes, de piloter les couleurs HEX <code>#707579</code> , de les traduire en <code>rgba</code> et de définir le canal alpha - 0,08%. </p><br><p><img src="https://habrastorage.org/webt/tx/oe/hv/txoehvpf_ams30-5kvkur8q-2bc.png"></p><br><p>  Voila!  Quelque chose a brusquement flashé ma photo: </p><br><p><img src="https://habrastorage.org/webt/9g/nc/7b/9gnc7bjgm-uljw_rwbxn8cve71c.png"></p><br><p>  Nous <code>rgba(112, 117, 121, 0.08)</code> - <code>rgba(112, 117, 121, 0.08)</code> . </p><br><p><img src="https://habrastorage.org/webt/vn/hc/kh/vnhckhj8plbr9_rmbvr0ug9eawm.png"><br>  (: survoler) </p><br><p>  Plus ennuyeux et sans trop d'effort, j'ai ajouté le reste de l'état: </p><br><pre> <code class="css hljs"> &amp;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:hover</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--grey04); } &amp;<span class="hljs-selector-class"><span class="hljs-selector-class">.accent</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--blue01); } &amp;<span class="hljs-selector-class"><span class="hljs-selector-class">.primary</span></span> { @apply text-white; <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--blue01); &amp;:hover { <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--blue02); } }</code> </pre> <br><h3 id="react-komponent">  Composant React </h3><br><p>  Initialement, le bouton était composé pour le concours Telegram et il était impossible d'utiliser un cadre.  J'ai dû implémenter un effet d'entraînement sur du JS pur.  J'aimerais vraiment que cela reste ainsi, mais pendant que vous faites le projet seul, vous devez sacrifier quelque chose. </p><br><p>  Les composants qui nécessitent une sorte de logique, comme l'effet d'entraînement, seront implémentés et disponibles uniquement en tant que composants React. </p><br><p>  Envelopper le bouton dans le composant React n'est pas difficile: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { FunctionComponent } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface ButtonProps { } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Button: FunctionComponent&lt;ButtonProps&gt; = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"btn"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">props.children</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Button;</code> </pre> <br><p>  Ce bouton sera affiché dans le style spécifié, mais en fait il est de peu d'utilité.  Nous devons permettre à l'utilisateur de personnaliser le bouton, d'ajouter des styles personnalisés, de bloquer les gestionnaires d'événements, etc. </p><br><p>  Pour que l'utilisateur puisse transférer tout ce qui est nécessaire, vous devez d'abord surmonter Typescript, sinon même <code>onClick</code> ne vous permettra pas de transférer normalement.  <code>ButtonProps</code> modifiant légèrement l'interface <code>ButtonProps</code> , nous résolvons le problème: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface ButtonProps extends ButtonHTMLAttributes&lt;HTMLButtonElement&gt;</code> </pre> <br><p>  après quoi nous pouvons faire la destruction des <code>props</code> toute sécurité: </p><br><pre> <code class="javascript hljs">&lt;button className=<span class="hljs-string"><span class="hljs-string">"btn"</span></span> {...props}&gt;props.children&lt;<span class="hljs-regexp"><span class="hljs-regexp">/button&gt;</span></span></code> </pre> <br><p>  Une utilisation similaire du bouton se comportera comme prévu: </p><br><pre> <code class="javascript hljs">&lt;Button onClick={() =&gt; alert()}&gt;Hey&lt;<span class="hljs-regexp"><span class="hljs-regexp">/Button&gt;</span></span></code> </pre> <br><p><img src="https://habrastorage.org/webt/-_/aq/qb/-_aqqbmdkzkmdf2sr8lodd_wy-o.png"></p><br><p>  Ensuite, nous ajoutons les styles de bouton et la possibilité d'enregistrer une classe personnalisée (tout à coup, quelqu'un aura besoin).  Le package npm <a href="https://www.npmjs.com/package/classnames" rel="nofollow">classnames</a> est parfait à ces fins. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface ButtonProps extends ButtonHTMLAttributes&lt;HTMLButtonElement&gt; { primary?: boolean, accent?: boolean, additionalClass?: string, } ... const classNames = classnames( <span class="hljs-string"><span class="hljs-string">'btn'</span></span>, { primary }, { accent }, additionalClass ); ... &lt;button className={classNames} {...props}&gt;props.children&lt;<span class="hljs-regexp"><span class="hljs-regexp">/button&gt;</span></span></code> </pre> <br><p>  La classe <code>btn</code> est toujours définie, mais <code>primary</code> et <code>accent</code> uniquement si <code>true</code> .  Les noms de classe ajoutent une classe si elle a une <code>true</code> valeur logique, en utilisant l'abréviation ES6, nous obtenons une simple entrée <code>{ primary }</code> , au lieu de <code>{ primary: true }</code> . </p><br><p>  <code>additionalClass</code> est une chaîne, et si elle est vide ou non définie, elle ne joue pas un rôle spécial pour nous, rien ne sera ajouté à l'élément. </p><br><p>  Au début, j'ai attribué les <code>props</code> comme suit: </p><br><pre> <code class="javascript hljs">{...omit(props, [<span class="hljs-string"><span class="hljs-string">'additionalClass'</span></span>, <span class="hljs-string"><span class="hljs-string">'primary'</span></span>])}</code> </pre> <br><p>  Omettre tout ce qui ne s'applique pas aux <code>props</code> de l'élément bouton, mais ce n'est pas nécessaire car React ne rendra pas trop. </p><br><h3 id="ripple-effect">  Effet d'entraînement </h3><br><p><img src="https://habrastorage.org/webt/36/ys/8w/36ys8wseofyhctlp1cm5r5kiwqo.gif"></p><br><p>  En fait, c'est à cela qu'il ressemble, mais il est souhaitable que la «vague» diverge de l'endroit du clic. <br>  Il existe d'innombrables façons de faire une telle animation, c'est comme une blague sur le <a href="https://css-tricks.com/blue-box/" rel="nofollow">carré bleu</a> . </p><br><p>  Mais Google, en regardant les exemples sur codepen, il est devenu clair que dans la plupart des cas, une "vague" est réalisée à travers un élément enfant, qui se dilate et disparaît. </p><br><p>  Il est positionné à l'intérieur du bouton en fonction des coordonnées du clic.  Dans <a href="http://bit.ly/2RbcVRD" rel="nofollow">XMars UI</a> , pour le moment, j'ai décidé de ne pas implémenter cet effet sur <code>onPress</code> comme le fait l'interface utilisateur Material, mais je prévois de l' <code>onPress</code> à l'avenir.  Jusqu'à présent, uniquement <code>onClick</code> . </p><br><p><img src="https://habrastorage.org/webt/dr/rr/wy/drrrwydtouv_xhq3fi6pyahyaye.png"></p><br><p>  L'image ci-dessus est toute magique.  Un clic crée un élément de bouton enfant, il est positionné absolument, au centre du clic et se développe.  La propriété <code>overflow: hidden</code> onde de dépasser le bouton.  L'élément doit être supprimé à la fin de l'animation. </p><br><p>  Tout d'abord, nous allons définir les styles où nous pouvons, en utilisant autant que possible Tailwindcss: </p><br><pre> <code class="plaintext hljs">.with-ripple { @apply relative overflow-hidden; @keyframes ripple { to { @apply opacity-0; transform: scale(2.5); } } .ripple { @apply absolute; z-index: 1; border-radius: 50%; background-color: var(--grey04); transform: scale(0); animation: ripple 0.6s linear; } &amp;.primary { .ripple { background-color: var(--black02); } } }</code> </pre> <br><p>  L'élément responsable de l'effet se verra attribuer la classe <code>.ripple</code> . <code>border-radius: 50%;</code>  est égal à un cercle (50% de congé à un angle * 2), le bouton a un positionnement relatif, le bouton <code>.ripple</code> a un positionnement absolu.  L'animation est très simple, l'augmentation de l'onde devient transparente en 0,6 seconde.  La couleur d'arrière-plan est la même que <code>:hover</code> et pliage, deux couleurs et boutons transparents «vague» nous donnent le résultat souhaité.  Sur le bouton bleu <code>.primary</code> , ce n'est pas si important et là vous pouvez utiliser une couleur non transparente. </p><br><p>  Au clic, vous devez créer l'élément "vague".  Par conséquent, nous créons un état pour cette entreprise et ajoutons le gestionnaire de clics approprié au bouton, mais de telle manière qu'il n'interfère pas avec le onClick personnalisé. </p><br><pre> <code class="javascript hljs">... const [rippleElements, setRippleElements] = useState&lt;JSX.Element[]&gt;<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">); ... </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">renderRippleElements</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">rippleElements</span></span></span><span class="hljs-function">; } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;button className={classNames} {...props} onClick={(event</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (props.onClick) { props.onClick(event); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ripple) { onRippleClick(event); } }} &gt; {children} {renderRippleElements()} &lt;<span class="hljs-regexp"><span class="hljs-regexp">/button&gt; );</span></span></code> </pre> <br><p>  <code>rippleElements</code> - un tableau d'éléments JSX, la fonction de rendu ici peut sembler redondante, mais c'est plus une question de style et d'incorporation pour l'avenir. </p><br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onRippleClick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event: React.MouseEvent&lt;HTMLButtonElement, MouseEvent&gt;</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rect = event.currentTarget.getBoundingClientRect(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> d = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.max(event.currentTarget.clientWidth, event.currentTarget.clientHeight); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> left = event.clientX - rect.left - d/<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-string"><span class="hljs-string">'px'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> top = event.clientY - rect.top - d/<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-string"><span class="hljs-string">'px'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rippleElement = newRippleElement(d, left, top); setRippleElements([...rippleElements, rippleElement]); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newRippleElement</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d: number, left: string, top: string</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> key = uuid(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;div key={key} className=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"ripple"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> style={{width: d, height: d, left, top}} onAnimationEnd={(</span></span></span><span class="hljs-function">) =&gt;</span></span> onAnimationEnd(key)} &gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); }</code> </pre> <br><p>  <code>onRippleClick</code> qui crée des "vagues".  En cliquant sur le bouton, nous découvrons la taille du bouton qui est utilisé pour positionner correctement le cercle, après quoi tout le nécessaire est passé à la fonction <code>newRippleElement</code> qui à son tour crée simplement un élément <code>div</code> avec la classe d' <code>ripple</code> , créant les styles nécessaires pour le positionnement. </p><br><p>  Parmi les principales choses qui méritent d'être soulignées <code>onAnimationEnd</code> .  Nous avons besoin de cet événement pour effacer le DOM des éléments déjà utilisés. </p><br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAnimationEnd</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key: string</span></span></span><span class="hljs-function">) </span></span>{ setRippleElements(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">rippleElements</span></span></span><span class="hljs-function"> =&gt;</span></span> rippleElements.filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">element</span></span></span><span class="hljs-function"> =&gt;</span></span> element.key !== key)); }</code> </pre> <br><p>  Il est très important de ne pas oublier, de passer les <code>rippleElements</code> actuels en arguments, sinon vous pouvez obtenir un tableau avec des anciennes valeurs, et tout ne fonctionnera pas comme prévu. </p><br><p>  Code de bouton complet: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { FunctionComponent, ButtonHTMLAttributes, useState } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> uuid <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'uuid/v4'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> classnames <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'classnames'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface ButtonProps extends ButtonHTMLAttributes&lt;HTMLButtonElement&gt; { primary?: boolean, accent?: boolean, circle?: boolean, ripple?: boolean, additionalClass?: string, } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Button: FunctionComponent&lt;ButtonProps&gt; = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [rippleElements, setRippleElements] = useState&lt;JSX.Element[]&gt;<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> {</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">primary</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">accent</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">circle</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ripple</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">additionalClass</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">children</span></span></span><span class="hljs-function">} = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">classNames</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">classnames</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'btn'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, { primary }, { </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'with-ripple'</span></span></span></span><span class="hljs-function"><span class="hljs-params">: ripple }, { circle }, { accent }, additionalClass </span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">onAnimationEnd</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key: string</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">setRippleElements</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">rippleElements =&gt; rippleElements.filter(element =&gt; element.key !== key</span></span></span><span class="hljs-function">)); } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">onRippleClick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event: React.MouseEvent&lt;HTMLButtonElement, MouseEvent&gt;</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">var</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">rect</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">currentTarget</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">getBoundingClientRect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">max</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event.currentTarget.clientWidth, event.currentTarget.clientHeight</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">rect</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">left</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function">/2 + '</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">px</span></span></span><span class="hljs-function">'; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">rect</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">top</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function">/2 + '</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">px</span></span></span><span class="hljs-function">'; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">rippleElement</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newRippleElement</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d, left, top</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">setRippleElements</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[...rippleElements, rippleElement]</span></span></span><span class="hljs-function">); } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newRippleElement</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d: number, left: string, top: string</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uuid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;div key={key} className=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"ripple"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> style={{width: d, height: d, left, top}} onAnimationEnd={(</span></span></span><span class="hljs-function">) =&gt;</span></span> onAnimationEnd(key)} &gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">renderRippleElements</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rippleElements; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;button className={classNames} {...props} onClick={(event</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (props.onClick) { props.onClick(event); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ripple) { onRippleClick(event); } }} &gt; {children} {renderRippleElements()} &lt;<span class="hljs-regexp"><span class="hljs-regexp">/button&gt; ); } export default Button;</span></span></code> </pre> <br><p>  Le résultat final peut être rapporté <a href="https://ui.xmars.io/docs/components/buttons" rel="nofollow">ici.</a> </p><br><h3 id="zaklyuchenie">  Conclusion </h3><br><p>  Beaucoup a été omis, par exemple, comment le projet a été mis en place, comment la documentation est écrite, les tests pour un nouveau composant dans le projet.  J'essaierai de couvrir ces sujets avec des publications séparées. </p><br><p>  <a href="http://bit.ly/36dT1JM" rel="nofollow">Référentiel Github XMars UI</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr484554/">https://habr.com/ru/post/fr484554/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr484544/index.html">Quelques méthodes intéressantes d'objets console</a></li>
<li><a href="../fr484546/index.html">10 questions d'interview TypeScript populaires (avec des réponses courtes)</a></li>
<li><a href="../fr484548/index.html">Comment Citrix NetScaler CVE-2019-19781 a exposé des problèmes critiques de l'industrie informatique cachée</a></li>
<li><a href="../fr484550/index.html">L'holacratie est-elle nécessaire dans une entreprise informatique: avantages et inconvénients</a></li>
<li><a href="../fr484552/index.html">Lecture pour un geek: 10 documents sur la technologie audio - comment les pistes musicales, les enregistrements HD et le son 8D sont organisés</a></li>
<li><a href="../fr484556/index.html">Alors, quand est-il encore possible d'utiliser! Important?</a></li>
<li><a href="../fr484564/index.html">Nous écrivons un pilote pour un ordinateur portable pour le plaisir et le profit, ou comment s'engager dans le noyau même si vous êtes un imbécile</a></li>
<li><a href="../fr484568/index.html">Hack The Box - Walkthrough Player. FFmpeg exploit, JWT et diverses listes Web</a></li>
<li><a href="../fr484572/index.html">Mon approche de gestion du temps / des tâches avec VSCode</a></li>
<li><a href="../fr484574/index.html">Pas de tiques! Plantes vs vecteur de la maladie de Lyme</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>