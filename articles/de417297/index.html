<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>㊙️ 🤛🏼 👩🏽‍🌾 Angst und Abscheu vor Bedrohungsintelligenz oder 8 TI-Tipps 🔘 🚣🏿 🙋🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wir hatten zwei kommerzielle APT-Abonnements, zehn Informationsaustausche, ungefähr zehn kostenlose Feeds und Thors Exit-Node-Liste. Und außerdem fünf...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Angst und Abscheu vor Bedrohungsintelligenz oder 8 TI-Tipps</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/solarsecurity/blog/417297/"><img src="https://habrastorage.org/webt/31/k_/ho/31k_hosvjz67wnrm9qu0rrd_pp0.jpeg"><br><br>  Wir hatten zwei kommerzielle APT-Abonnements, zehn Informationsaustausche, ungefähr zehn kostenlose Feeds und Thors Exit-Node-Liste.  Und außerdem fünf starke Reverser, ein Meister der Powershell-Skripte, ein Loki-Scanner und ein kostenpflichtiges Abonnement für Virustotal.  Es ist nicht so, dass das Überwachungszentrum ohne dies nicht funktioniert, aber wenn Sie es gewohnt sind, komplexe Angriffe zu fangen, müssen Sie den ganzen Weg zu diesem Hobby gehen.  Vor allem waren wir besorgt über die mögliche Automatisierung der Überprüfung auf Kompromissindikatoren.  Es gibt nichts Unmoralischeres als künstliche Intelligenz, die eine Person in der Arbeit ersetzt, bei der man nachdenken muss.  Wir haben jedoch verstanden, dass wir uns mit zunehmender Anzahl von Kunden früher oder später darauf einlassen würden. <br><a name="habracut"></a><br>  Viele sagen, dass Threat Intelligence köstlich ist, aber nicht jeder versteht, wie man es kocht.  Noch weniger, die verstehen, welche Prozesse aufgebaut werden müssen, damit TI funktioniert und Gewinn bringt.  Und nur sehr wenige Menschen wissen, wie man einen Feed-Anbieter auswählt, wo der Indikator auf Stürze überprüft wird und ob es notwendig ist, die Domain zu blockieren, die der Kollege an WhatsApp gesendet hat. <br><br>  Während unserer jahrelangen ständigen Arbeit mit TI haben wir es geschafft, auf verschiedenen Rechen zu laufen, und heute möchten wir einige praktische Ratschläge geben, die Anfängern helfen, Fehler zu vermeiden. <br><br><h3>  Tipp Nummer 1.  Hoffen Sie nicht, einen Hash zu fangen: Die meiste Malware ist seit langem polymorph </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Im letzten Artikel haben</a> wir darüber gesprochen, was TI ist, und einige Beispiele für die Organisation des Arbeitsprozesses gegeben.  Ich möchte Sie daran erinnern, dass Informationen zu Bedrohungen (Bedrohungsinformationen) in verschiedenen Formaten und Ansichten vorliegen: Dies können die IP-Adressen von Botnet-Kontrollzentren und die E-Mail-Adressen von Absendern von Phishing-E-Mails sowie Artikel sein, in denen Sicherheitsumgehungstechniken beschrieben werden, die APT gruppiert -das wird anfangen zu verwenden.  Im Allgemeinen passieren viele Dinge. <br><br>  Um all diese Schande zu rationalisieren, schlug David Bianco vor einigen Jahren die sogenannte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">"Schmerzpyramide" vor.</a>  Es beschreibt ziemlich gut die Beziehung zwischen den Arten von Indikatoren, mit denen Sie den Angreifer erkennen, und dem Schmerz, den Sie dem Angreifer zufügen, wenn Sie eine bestimmte Art von Indikator erkennen können. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lz/ix/mv/lzixmvhlrhcdqpcjwi63chisyzq.png"></div><br><br>  Wenn Sie beispielsweise den MD5-Hash einer schädlichen Datei kennen, kann dieser recht einfach erkannt und genau erkannt werden.  Dies wird dem Angreifer jedoch nur sehr wenig Schmerzen bereiten. Fügen Sie der Datei nur 1 Bit Information hinzu, und der Hash ist bereits anders. <br><br><h3>  Tipp Nummer 2.  Versuchen Sie, diese Indikatoren zu verwenden, deren Änderung für den Angreifer technisch oder wirtschaftlich unrentabel sein wird </h3><br>  Ich antizipiere die Frage, wie ich herausfinden kann, ob auf den Arbeitsstationen unseres Unternehmens eine Datei mit diesem Hash vorhanden ist, und antworte: Es gibt verschiedene Möglichkeiten.  Eine der einfachsten Möglichkeiten ist die Installation von Kaspersky Security Center, das eine Datenbank mit MD5-Hashes aller ausführbaren Dateien im Unternehmen enthält, auf die Sie SELECT setzen können. <br><br>  Kehren wir zur Pyramide des Schmerzes zurück.  Im Gegensatz zur Hash-Erkennung ist es produktiver, wenn Sie die TTP (Taktik, Technik, Vorgehensweise) des Angreifers erkennen können.  Es ist komplizierter und erfordert mehr Aufwand, aber Sie werden mehr Schmerzen liefern. <br><br>  Wenn Sie beispielsweise wissen, dass eine APT-Gruppe, die sich an Ihren Wirtschaftszweig richtet, Phishing-E-Mails mit * .HTA-Dateien verteilt, wird die Entwicklung einer Erkennungsregel, die nach Dateien in E-Mails mit ähnlichen Anhängen sucht, den Angreifer schwer treffen.  Er muss die Taktik des Mailings ändern und vielleicht sogar $ $ in den Kauf von 0-Tage- oder 1-Tage-Exploits investieren, und das ist nicht billig ... <br><br><h3>  Tipp Nummer 3.  Hoffen Sie nicht auf die Erkennungsregeln, die nicht von Ihnen entwickelt wurden. Sie müssen auf falsch positive Ergebnisse überprüft und geändert werden </h3><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lb/fi/gx/lbfigxu0qc_msq7-qwn3hng6svw.jpeg"></div><br>  Bei der Entwicklung von Erkennungsregeln ist es immer verlockend, vordefinierte Regeln zu verwenden.  Ein kostenloses Beispiel ist das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sigma-</a> Repository, ein SIEM-unabhängiges Erkennungsregelformat, das Regeln von Sigma in ElasticSearch-Abfragen und Splunk- oder Arcsight-Regeln übersetzt.  Gleichzeitig enthält das Repository etwa 200 Regeln, von denen ~ 130 Angriffe auf Windows beschreiben.  Auf den ersten Blick ist es sehr cool, aber der Teufel steckt wie immer im Detail. <br><br>  Schauen wir uns eine <a href="">der</a> Mimikatz-Erkennungsregeln <a href="">im</a> Detail an: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cg/sw/eu/cgsweugcondwgea0klgqmwafznw.png"></div><br>  Die Regel erkennt Prozesse, die versucht haben, den Speicher des Prozesses lsass.exe zu lesen.  Mimikatz tut dies, wenn er versucht, NTLM-Hashes abzurufen, und die Regel Malware erkennt. <br><br>  Für uns als Spezialisten, die nicht nur Vorfälle erkennen, sondern auch darauf reagieren, ist es jedoch äußerst wichtig, dass dies wirklich ein Mimikatz ist.  Leider gibt es in der Praxis viele andere legitime Prozesse, die den Speicher von lsass.exe mit denselben Masken lesen (z. B. einige Virenschutzprogramme).  In einer realen Kampfumgebung bringt eine solche Regel daher mehr falsch positive als gute Ergebnisse. <br><br>  Es gibt noch interessantere Vorfälle im Zusammenhang mit der automatischen Übersetzung von Regeln von Sigma in SIEM-Regeln: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xu/0t/9l/xu0t9lchwgmepeu0hh9xnp92yko.png"></div><br>  Bei einem der Webinare zeigten Kollegen von SOC Prime, die Regeln für die bezahlte Erkennung bereitstellten, ein nicht funktionierendes Beispiel für eine solche Übersetzung: Das Feld deviceProduct in SIEM muss sowohl Sysmon als auch Microsoft Windows entsprechen, was unmöglich ist. <br><br>  Ich möchte niemandem die Schuld geben und einen Finger stechen - jeder ist verrückt, das ist in Ordnung.  Verbraucher von Threat Intelligence müssen jedoch verstehen, dass eine erneute Überprüfung und Verfeinerung der Regeln, die sowohl aus offenen als auch aus geschlossenen Quellen stammen, weiterhin erforderlich ist. <br><br><h3>  Tipp 4: Überprüfen Sie Domänennamen und IP-Adressen nicht nur auf dem Proxyserver und der Firewall, sondern auch in den DNS-Serverprotokollen auf Malware, und achten Sie dabei sowohl auf erfolgreiche als auch auf erfolglose Lösungsversuche </h3><br>  Schädliche Domänen und IP-Adressen sind ein optimaler Indikator für die einfache Erkennung und den Schmerz, den Sie einem Angreifer zufügen.  Aber bei ihnen ist alles nur auf den ersten Blick einfach.  Zumindest fragen Sie sich möglicherweise, woher das Domain-Protokoll stammt. <br><br>  Wenn Sie sich darauf beschränken, nur Proxy-Server-Protokolle zu überprüfen, können Sie Malware verpassen, die versucht, direkt auf das Netzwerk zuzugreifen, oder einen nicht vorhandenen Domänennamen anfordert, der von DGA generiert wird, ganz zu schweigen von DNS-Tunneln - all dies ist nicht in Unternehmens-Proxy-Protokollen enthalten. <br><br><h3>  Tipp Nummer 5.  "Sie können den Monitor nicht blockieren" - Setzen Sie ein Komma erst, nachdem Sie wissen, um welche Art von Anzeige es sich handelt, und erkennen Sie die möglichen Folgen einer Blockierung </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0x/cl/hi/0xclhi5dr1fohibe7rbsjseyze4.jpeg"></div><br>  Jeder praktizierende Wachmann stand vor einer schwierigen Frage: Die Bedrohung blockieren oder überwachen und, falls es positive Ergebnisse gibt, eine Untersuchung einleiten?  Einige Vorschriften und Anweisungen blockieren direkt - und manchmal ist diese Aktion fehlerhaft. <br><br>  Wenn der Indikator der von der APT-Gruppierung verwendete Domänenname ist, <u>setzen Sie ihn nicht auf eine Sperre</u> , sondern starten Sie die Überwachung.  Moderne Taktiken für gezielte Angriffe implizieren die Existenz eines zusätzlichen verdeckten Backup-Kommunikationskanals, der nur während einer detaillierten Untersuchung identifiziert werden kann.  Das automatische Blockieren behindert in diesem Fall die Suche nach diesem Kanal, und Kameraden auf der anderen Seite der Barrikade werden schnell verstehen, was Sie über ihre Aktivitäten gelernt haben. <br><br>  Wenn der Indikator hingegen eine Verschlüsselungsdomäne ist, <u>sollte er</u> bereits <u>gesperrt sein</u> .  Vergessen Sie jedoch nicht, erfolglose Versuche, auf blockierte Domänen zuzugreifen, zu überwachen. In die Verschlüsselungskonfiguration können mehrere Adressen von Verwaltungsservern integriert werden.  Einige von ihnen fehlen möglicherweise in den Feeds und werden daher nicht blockiert.  Früher oder später wird die Malware sie kontaktieren, um einen Schlüssel zu erhalten, den der Host sofort verschlüsselt.  Nur eine umgekehrte Analyse der Stichprobe kann garantieren, dass Sie alle Adressen des Verwaltungsservers blockiert haben. <br><br><h3>  Tipp Nummer 6.  Überprüfen Sie alle eingehenden Indikatoren auf Relevanz, bevor Sie sie für die Überwachung oder Blockierung festlegen. </h3><br>  Denken Sie daran, dass Informationen über Bedrohungen von Personen erstellt werden, die dazu neigen, Fehler zu machen, oder von Algorithmen für maschinelles Lernen, die davon noch stärker betroffen sind.  Wir haben bereits gesehen, wie verschiedene Anbieter von bezahlten Berichten über die Aktivitäten von APT-Gruppen versehentlich rechtmäßige Stichproben in die Liste der böswilligen MD5s aufgenommen haben.  Selbst wenn bezahlte Bedrohungsberichte Indikatoren von geringer Qualität enthalten, was können wir über Indikatoren sagen, die durch Informationen in offenen Quellen erhalten wurden?  TI-Analysten überprüfen die von ihnen erstellten Indikatoren nicht immer auf falsch positive Ergebnisse, da eine solche Überprüfung auf die Schultern des Verbrauchers fällt. <br><br>  Wenn Sie beispielsweise die IP-Adresse der nächsten Zeus- oder Dimnie-Änderung erhalten haben, bevor Sie sie in Erkennungssystemen verwenden, <u>überprüfen Sie</u> , <u>ob sie Teil des</u> Hostings <u>oder Dienstes ist, auf dem Ihre IP angegeben ist</u> .  Andernfalls ist es unangenehm, eine große Anzahl von Fehlalarmen zu analysieren, wenn Benutzer einer auf diesem Hosting gehosteten Site zu völlig harmlosen Sites gehen.  Eine ähnliche Überprüfung kann leicht durchgeführt werden mit: <br><br><ol><li>  Kategorisierungsdienste, die Sie über die Art der Aktivitäten der Website informieren.  Zum Beispiel schreibt ipinfo.io direkt den Typ "Hosting". </li><li>  Services Reverse IP, die angibt, wie viele Domains unter dieser IP-Adresse registriert sind.  Wenn es viele davon gibt, ist es sehr wahrscheinlich, dass Sie Websites hosten. </li></ol><br>  So sieht beispielsweise das Ergebnis der Überprüfung des Indikators so aus, dass es ein Indikator für die Cobalt APT-Gruppe ist (gemäß dem Bericht eines angesehenen TI-Anbieters): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qa/f-/dw/qaf-dw_6qr6st4mkhd6ju0owzzs.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bc/dk/gy/bcdkgys-vierrjaj2san0gjz79k.png"></div><br>  Wir Antwortspezialisten verstehen, dass die Herren von Cobalt diese IP-Adresse verwendet haben müssen.  Dieser Indikator bietet jedoch keinen Nutzen - er ist irrelevant, da er zu viele Fehlalarme liefert. <br><br><h3>  Tipp Nummer 7.  Automatisieren Sie alle Prozesse so weit wie möglich mit Bedrohungsinformationen.  Beginnen Sie mit einer einfachen Methode - automatisieren Sie die Überprüfung auf Fehlalarme über die Stoppliste vollständig, indem Sie in SIEM weitere streifenfreie Indikatoren für die Überwachung festlegen </h3><br>  Um eine große Anzahl von Fehlalarmen im Zusammenhang mit Informationen zu verhindern, die aus offenen Quellen stammen, kann eine vorläufige Suche dieser Indikatoren in Stopplisten (Warnlisten) durchgeführt werden.  Solche Listen können auf der Grundlage der Alexa-Bewertung (Top-1000), Adressen interner Subnetze, Domains großer Dienstanbieter wie Google, Amazon AWS, MS Azure und anderer Hosting-Dienste erstellt werden.  Sehr effektiv wird auch eine Lösung sein, die Stopplisten, die aus den Top-Domains / IP-Adressen bestehen, die von Mitarbeitern des Unternehmens in der letzten Woche oder im letzten Monat besucht wurden, dynamisch ändert. <br><br>  Die Entwicklung solcher Listen und eines Verifizierungssystems kann für den durchschnittlichen SOC schwierig sein. Daher ist es sinnvoll, über die Implementierung der sogenannten Threat Intelligence-Plattformen nachzudenken.  Vor ungefähr einem halben Jahr hatte Anti-malware.ru einen guten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Überblick über</a> kostenpflichtige und kostenlose Lösungen dieser Klasse. <br><br><h3>  Tipp Nummer 8.  Durchsuchen Sie das gesamte Unternehmen nach Hostindikatoren, nicht nur nach Hosts, die mit SIEM verbunden sind </h3><br>  Aufgrund der Tatsache, dass in der Regel nicht alle Unternehmenshosts mit SIEM verbunden sind, ist es nicht möglich, nur mit der Standard-SIEM-Funktionalität nach einer schädlichen Datei mit einem bestimmten Namen oder Pfad zu suchen.  Sie können auf folgende Weise aus dieser Situation herauskommen: <br><br><ol><li>  Verwenden Sie IoC-Scanner wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Loki</a> .  Sie können es auf allen Hosts des Unternehmens über dasselbe SCCM ausführen und die Ausgabe in einen öffentlichen Netzwerkordner umleiten. </li><li>  Verwenden Sie Schwachstellenscanner.  Einige von ihnen verfügen über Kompatibilitätsmodi, in denen Sie auf einem bestimmten Pfad nach einer bestimmten Datei suchen können. </li><li>  Schreiben Sie ein Powershell-Skript und führen Sie es über WinRM aus.  Wenn Sie selbst Faulheit schreiben, können Sie eines der vielen Skripte verwenden, zum Beispiel dieses. </li></ol><br>  Wie eingangs erwähnt, enthält dieser Artikel keine umfassenden Informationen zur korrekten Arbeit mit Threat Intelligence.  Nach unserer Erfahrung können Anfänger jedoch auch nach diesen einfachen Regeln nicht auf den Rechen treten und sofort mit der effektiven Arbeit mit verschiedenen Kompromissindikatoren beginnen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de417297/">https://habr.com/ru/post/de417297/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de417285/index.html">Wo in IPv6 ein Anführungszeichen eingefügt werden soll</a></li>
<li><a href="../de417287/index.html">"Testerkalender" für Juli. Analytics-Tests</a></li>
<li><a href="../de417289/index.html">Trainee-Tagebuch: Tag 1. Trainee bis Junior</a></li>
<li><a href="../de417293/index.html">Kennwortwiederherstellung und Primärspeicherung in der Cloud oder Neue Funktionen in Zimbra 8.8.9</a></li>
<li><a href="../de417295/index.html">Wie habe ich die Standard-C ++ 11-Bibliothek geschrieben oder warum ist Boost so beängstigend? Kapitel 3</a></li>
<li><a href="../de417299/index.html">Online, Offline und P2P: So kaufen Sie Bitcoin in Russland</a></li>
<li><a href="../de417301/index.html">Rezept für eine reibungslose Freigabe: PMy Hinweis</a></li>
<li><a href="../de417303/index.html">Hack zur Unterstützung von Windows Android-Headset-Tasten</a></li>
<li><a href="../de417305/index.html">Ultima Online: ein Backstage-Look</a></li>
<li><a href="../de417307/index.html">Glaukom - noch nichts von ihr gehört? Lernen Sie den Serienkiller für stille Visionen kennen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>