<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìå üîπ ü§ü Melhor Prioriza√ß√£o HTTP / 2 para Acelera√ß√£o da Web üßìüèΩ üö¢ üôá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O HTTP / 2 prometeu acelerar significativamente a web e o Cloudflare h√° muito tempo implantava o acesso HTTP / 2 para todos os clientes. Mas um recurs...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Melhor Prioriza√ß√£o HTTP / 2 para Acelera√ß√£o da Web</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452020/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/57d/5cf/dbe/57d5cfdbe917c7b464a249fb187b3ffd.png"></div><br>  O HTTP / 2 prometeu acelerar significativamente a web e o Cloudflare h√° muito tempo implantava o acesso HTTP / 2 para todos os clientes.  Mas um recurso do HTTP / 2, a prioriza√ß√£o, n√£o atendeu √†s expectativas.  N√£o porque est√° fundamentalmente quebrado, mas por causa da implementa√ß√£o nos navegadores. <br><br>  Hoje, o Cloudflare se oferece para alterar a prioriza√ß√£o HTTP / 2, que d√° aos nossos servidores controle sobre as decis√µes de prioriza√ß√£o que realmente aceleram a Internet. <br><br>  Historicamente, era o navegador que controlava como e quando baixar o conte√∫do da web.  Hoje, para todos os planos pagos, estamos fazendo mudan√ßas radicais nesse modelo.  Eles transferem o controle diretamente para o propriet√°rio do site.  Na guia "Velocidade" no painel do Cloudflare, os clientes podem ativar a "Prioriza√ß√£o HTTP / 2 avan√ßada": substitui as configura√ß√µes padr√£o do navegador por um esquema de agendamento aprimorado, que acelera significativamente o acesso aos visitantes (em alguns casos, vimos um aumento de 50%).  Com os funcion√°rios do Cloudflare, os propriet√°rios do site podem ir ainda mais longe e personalizar totalmente as configura√ß√µes para suas necessidades espec√≠ficas. <br><a name="habracut"></a><br><h1>  Situa√ß√£o atual </h1><br>  As p√°ginas da Web consistem em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://discuss.">dezenas (√†s vezes centenas) de</a> recursos individuais que s√£o baixados e coletados pelo navegador no conte√∫do final exibido.  Isso inclui o conte√∫do vis√≠vel com o qual o usu√°rio interage (HTML, CSS, imagens), bem como a l√≥gica do aplicativo (JavaScript) para o site em si, publicidade, an√°lises e beacons de rastreamento de marketing.  Do ponto de vista do usu√°rio, a sequ√™ncia na qual esses recursos s√£o carregados √© muito importante: isso afeta o momento em que ele v√™ o conte√∫do e pode interagir com a p√°gina. <br><br>  Um navegador √©, de fato, um mecanismo de processamento HTML que passa por um documento HTML e segue as instru√ß√µes em ordem: do in√≠cio ao fim do HTML, construindo a p√°gina √† medida que ela se move.  Os links da folha de estilos (CSS) informam ao navegador como estilizar o conte√∫do da p√°gina, e o navegador atrasar√° a exibi√ß√£o do conte√∫do at√© carregar a folha de estilo.  Os scripts na p√°gina podem ter comportamentos diferentes.  Se o script estiver marcado como "ass√≠ncrono" ou "pendente", o navegador poder√° continuar processando o documento e simplesmente executar o script quando ele estiver dispon√≠vel.  Se o script n√£o estiver marcado como ass√≠ncrono ou adiado, o navegador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">DEVE</a> parar de processar o documento at√© que o script seja carregado e executado.  Esses scripts s√£o chamados de "bloqueio" porque impedem o navegador de continuar processando o documento. <br><br>  O documento HTML √© dividido em duas partes.  O t√≠tulo do documento &lt;head&gt; est√° no in√≠cio e cont√©m folhas de estilo, scripts e outras instru√ß√µes do navegador necess√°rias para exibir o conte√∫do.  Depois que o cabe√ßalho √© o corpo do documento &lt;body&gt;, ele cont√©m o conte√∫do real exibido na janela do navegador (embora scripts e folhas de estilo tamb√©m possam estar no corpo).  At√© o navegador chegar ao corpo do documento, o usu√°rio n√£o tem nada para mostrar e a p√°gina permanece em branco.  Portanto, √© importante processar o cabe√ßalho o mais r√°pido poss√≠vel.  Se voc√™ estiver interessado nos detalhes, o site do <i>HTML5 Rocks</i> tem um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√≥timo tutorial</a> sobre como os navegadores funcionam. <br><br>  O navegador geralmente √© respons√°vel pela ordem em que os v√°rios recursos necess√°rios para construir a p√°gina e processar o documento s√£o carregados.  No HTTP / 1.x, h√° restri√ß√µes sobre quantos objetos o navegador pode solicitar de qualquer servidor por vez (geralmente 6 conex√µes e apenas um recurso por vez por conex√£o), portanto, a ordem das solicita√ß√µes √© estritamente controlada pelo navegador.  No HTTP / 2, a situa√ß√£o √© completamente diferente.  O navegador pode solicitar todos os recursos de uma s√≥ vez (pelo menos assim que descobrir sobre eles) e fornece ao servidor instru√ß√µes detalhadas sobre como fornecer esses recursos. <br><br><h1>  Ordem ideal de carregamento de recursos </h1><br>  Para a maioria das pe√ßas, existe um pedido ideal no ciclo de carregamento da p√°gina que maximiza a disponibilidade da p√°gina para o usu√°rio (e a diferen√ßa entre o pedido de carregamento √≥timo e o n√£o ideal pode atingir 50% ou mais). <br><br>  Como descrito acima, antes que o navegador possa exibir qualquer conte√∫do, ele √© bloqueado por CSS e JavaScript na se√ß√£o <code>&lt;head&gt;</code> .  Nesse est√°gio, √© mais lucrativo usar 100% do canal para carregar recursos de bloqueio, em vez de carreg√°-los em ordem, conforme eles est√£o escritos no c√≥digo HTML.  Isso permite que o navegador analise e execute cada elemento enquanto carrega o pr√≥ximo recurso de bloqueio, o que cria um pipeline ideal. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/db9/e18/fbe/db9e18fbe00d27755a152a8deabbcaa4.png"><br><br>  O tempo de carregamento do script para carregamento paralelo ou seq√ºencial n√£o difere, mas para carregamento sequencial, o primeiro script pode ser processado e executado durante o segundo carregamento. <br><br>  Depois de carregar os recursos de bloqueio, a situa√ß√£o se torna um pouco mais interessante.  Aqui, a carga ideal pode depender de um site espec√≠fico ou mesmo de prioridades de neg√≥cios (sele√ß√£o de conte√∫do ou publicidade gerada pelo usu√°rio ou an√°lise, etc.).  Um problema separado com as fontes, porque o navegador detecta as fontes desejadas ap√≥s aplicar a folha de estilo ao conte√∫do exibido.  Portanto, quando o navegador descobrir a fonte, √© necess√°rio exibir o texto que j√° est√° pronto para exibi√ß√£o na tela.  Qualquer atraso no carregamento da fonte resulta em nenhum texto na tela (ou o texto √© exibido na fonte incorreta). <br><br>  Como regra, algumas compensa√ß√µes precisam ser consideradas: <br><br><ul><li>  Fontes e imagens personalizadas na parte vis√≠vel da p√°gina (janela de visualiza√ß√£o) devem ser carregadas o mais r√°pido poss√≠vel.  Eles afetam diretamente a experi√™ncia visual do usu√°rio ao carregar a p√°gina. <br></li><li>  O JavaScript sem bloqueio deve ser carregado sequencialmente em rela√ß√£o a outros recursos JavaScript, para que cada um deles possa ser canalizado.  O JavaScript pode incluir l√≥gica de aplicativo personalizada, al√©m de rastrear beacons para an√°lises e marketing, e seu atraso pode levar a uma diminui√ß√£o nos indicadores rastreados pela empresa. <br></li><li>  As imagens podem ser carregadas em paralelo.  Os primeiros bytes do arquivo de imagem cont√™m seu tamanho, o que pode ser necess√°rio para o layout do navegador, e o carregamento paralelo de imagens progressivas pode fornecer integridade visual ap√≥s a transfer√™ncia de cerca de 50% do volume total. </li></ul><br>  Dadas as compensa√ß√µes, na maioria dos casos, essa estrat√©gia funciona bem: <br><br><ul><li>  As fontes personalizadas s√£o baixadas sequencialmente e compartilham a largura de banda dispon√≠vel com as imagens no escopo. <br></li><li>  Imagens vis√≠veis s√£o carregadas em paralelo, compartilhando entre si a parte da largura de banda alocada a eles. <br></li><li>  Quando n√£o houver mais fontes ou imagens vis√≠veis: <br><ul><li>  Os scripts sem bloqueio s√£o carregados sequencialmente e compartilham a largura de banda dispon√≠vel com imagens invis√≠veis (que est√£o fora do escopo). <br></li><li>  Imagens invis√≠veis s√£o carregadas em paralelo, compartilhando entre si a parte da largura de banda alocada a eles. </li></ul></li></ul><br>  Assim, o conte√∫do vis√≠vel para o usu√°rio √© carregado o mais r√°pido poss√≠vel, a l√≥gica do aplicativo √© adiada ao m√≠nimo e as imagens invis√≠veis s√£o carregadas de forma a concluir o layout o mais r√°pido poss√≠vel. <br><br><h1>  Exemplo </h1><br>  Para ilustrar, use uma p√°gina de categoria de produto simplificada de um site de com√©rcio eletr√¥nico t√≠pico: <br><br><ul><li>  <b>Azul</b> - arquivo HTML da pr√≥pria p√°gina. <br></li><li>  <b>Verde</b> - uma folha de estilo externa (arquivo CSS). <br></li><li>  <b>Laranja</b> - quatro scripts externos (JavaScript).  Dois scripts de bloqueio na parte superior da p√°gina e dois scripts ass√≠ncronos.  Os scripts de bloqueio s√£o mostrados em um tom mais escuro de laranja. <br></li><li>  <b>Vermelho</b> √© uma fonte da web personalizada. <br></li><li>  <b>Violeta</b> - 13 imagens.  O logotipo da p√°gina e quatro imagens do produto s√£o exibidas na janela de visualiza√ß√£o; outras 8 imagens do produto requerem rolagem.  As cinco imagens vis√≠veis s√£o indicadas por um tom mais escuro de p√∫rpura. </li></ul><br>  Para simplificar, suponha que todos os recursos tenham o mesmo tamanho e cada carregamento em 1 segundo.  O download de todos os recursos leva um total de 20 segundos, mas a ordem e o m√©todo de carregamento s√£o extremamente importantes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fbd/07b/58a/fbd07b58a4c8aeff2a758ad1946d8523.png"><br><br>  Aqui est√° como ser√° o carregamento ideal de recursos em um navegador: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8b2/6a8/2cd/8b26a82cdb5c546e9005200e5528b988.gif"><br><br><ul><li>  A p√°gina fica em branco pelos primeiros 4 segundos ao carregar HTML, CSS e scripts de bloqueio: todos eles usam 100% de conex√£o. <br></li><li>  Na marca de 4 segundos, o plano de fundo e a estrutura da p√°gina s√£o exibidos sem texto ou imagens. <br></li><li>  Ap√≥s um segundo, em cerca de 5 segundos, o texto da p√°gina √© exibido. <br></li><li>  No intervalo de 5 a 10 segundos, as imagens s√£o baixadas, tremidas no in√≠cio, mas muito rapidamente elas se tornam n√≠tidas.  Em cerca de 7 segundos, o resultado √© quase indistingu√≠vel da vers√£o final. <br></li><li>  Em cerca de 10 segundos, o carregamento de todo o conte√∫do visual na parte vis√≠vel da p√°gina √© conclu√≠do. <br></li><li>  Nos pr√≥ximos dois segundos, o JavaScript ass√≠ncrono √© carregado e executado, executando qualquer l√≥gica n√£o cr√≠tica (an√°lises, tags de marketing etc.). <br></li><li>  Durante os √∫ltimos 8 segundos, as imagens restantes s√£o carregadas, caso o usu√°rio role a p√°gina. </li></ul><br><h1>  Prioriza√ß√£o atual do navegador </h1><br>  Todos os mecanismos de navegador atuais implementam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://calendar.perfplanet.com/2018/">v√°rias estrat√©gias de prioriza√ß√£o</a> , nenhuma das quais √© ideal. <br><br>  <b>O Microsoft Edge e o Internet Explorer</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://calendar.perfplanet.com/2018/">n√£o oferecem suporte √† prioriza√ß√£o</a> ; portanto, eles trabalham com as configura√ß√µes HTTP / 2 padr√£o, que carregam tudo em paralelo, distribuindo uniformemente a largura de banda entre todos os recursos.  O Microsoft Edge em vers√µes futuras passar√° a usar o mecanismo Chromium, o que pode melhorar a situa√ß√£o.  Mas, por enquanto, em nosso exemplo, o navegador fica preso no cabe√ßalho da p√°gina na maioria das vezes, pois as imagens atrasam a transmiss√£o de scripts de bloqueio e folhas de estilo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e9c/844/a65/e9c844a65472a56d92cb37cd27f2f035.png"><br><br>  Visualmente, isso leva a uma experi√™ncia bastante dolorosa: o usu√°rio olha para uma tela em branco por 19 segundos e, em seguida, h√° um atraso de 1 segundo para exibir o texto.  Ao visualizar a anima√ß√£o abaixo, seja paciente, pois durante 19 segundos pode parecer que nada est√° acontecendo em uma tela em branco (embora seja): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6c9/fae/539/6c9fae539ae1d3c99570cf53af415be4.gif"><br><br>  <b>O Safari</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://calendar.perfplanet.com/2018/">carrega todos os recursos em paralelo</a> , compartilhando a largura de banda com base em sua import√¢ncia, de acordo com o Safari (recursos de bloqueio como scripts e folhas de estilo s√£o mais importantes que imagens).  As imagens s√£o carregadas em paralelo, mas tamb√©m simultaneamente com o conte√∫do bloqueado. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c75/a7d/f05/c75a7df05716f5706aa4b037774733d2.png"><br><br>  Embora o Safari seja semelhante ao Edge no sentido de que tudo carrega ao mesmo tempo, alocar mais largura de banda aos recursos de bloqueio permite exibir o conte√∫do muito antes: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f0c/840/5a1/f0c8405a1b6ddc40645ab7985e28a5eb.gif"><br><br><ul><li>  Ap√≥s cerca de 8 segundos, o carregamento da folha de estilo e dos scripts est√° conclu√≠do, para que voc√™ possa come√ßar a renderizar a p√°gina.  Como as imagens foram carregadas em paralelo, elas tamb√©m podem ser exibidas parcialmente (tremidas para imagens progressivas).  Isso ainda √© duas vezes mais lento que o cen√°rio ideal, mas muito melhor que no Edge. <br></li><li>  Ap√≥s cerca de 11 segundos, a fonte √© carregada.  Voc√™ pode exibir o texto.  Nesse momento, mais dados est√£o sendo carregados para as imagens e elas est√£o ficando um pouco mais n√≠tidas.  Isso √© compar√°vel √† situa√ß√£o em torno da marca de 7 segundos para um cen√°rio de carregamento ideal. <br></li><li>  Nos 9 segundos restantes, as imagens ficam mais n√≠tidas √† medida que mais dados s√£o baixados at√© que, finalmente, o processo seja conclu√≠do em 20 segundos. </li></ul><br>  <b>O Firefox</b> cria uma √°rvore de depend√™ncia que agrupa recursos e, em seguida, planeja que os grupos carreguem um ap√≥s o outro ou compartilhem a largura de banda entre os grupos.  Nesse grupo, os recursos compartilham largura de banda e carregam simultaneamente.  As imagens s√£o planejadas para serem carregadas ap√≥s folhas de estilo que bloqueiam a renderiza√ß√£o e carregadas em paralelo, mas scripts e folhas de estilo que bloqueiam a renderiza√ß√£o tamb√©m s√£o carregados em paralelo e n√£o se beneficiam do pipelining. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/870/e6d/83c/870e6d83c673b9c706dac49c78d3848d.png"><br><br>  No nosso exemplo, isso acontece um pouco mais r√°pido do que no Safari, pois as imagens est√£o aguardando o carregamento da folha de estilo: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bd2/806/b55/bd2806b55e830bd4c2a7e08bb1b18ce4.gif"><br><br><ul><li>  Em cerca de 6 segundos, o conte√∫do da p√°gina original √© exibido com vers√µes em segundo plano e emba√ßadas das imagens do produto (em compara√ß√£o com 8 segundos no Safari e 4 segundos na melhor das hip√≥teses). <br></li><li>  Em 8 segundos, a fonte foi carregada e voc√™ pode exibir o texto juntamente com imagens um pouco mais n√≠tidas do produto (comparado aos 11 segundos e 7 segundos do Safari, na melhor das hip√≥teses). <br></li><li>  Nos 12 segundos restantes, as imagens ficam mais n√≠tidas √† medida que o conte√∫do restante √© carregado. </li></ul><br>  <b>O Chrome</b> (e todos os navegadores baseados no Chromium) priorizam o invent√°rio.  Isso funciona muito bem para bloquear recursos que s√£o carregados de maneira ideal, mas n√£o t√£o bons para imagens.  Cada imagem √© carregada at√© 100% antes de iniciar a pr√≥xima. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e22/14d/4e0/e2214d4e04fab810f0a4398fe02434c1.png"><br><br>  Na pr√°tica, esse √© um cen√°rio de download quase ideal, com a √∫nica diferen√ßa de que as imagens s√£o baixadas uma de cada vez e n√£o em paralelo: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/91e/76c/d1d/91e76cd1d814aef138b35345eda46d82.gif"><br><br><ul><li>  At√© 5 segundos, o carregamento do Chrome √© id√™ntico ao cen√°rio ideal, exibindo o plano de fundo no 4¬∫ segundo e o conte√∫do de texto no 5¬∫. <br></li><li>  Nos pr√≥ximos 5 segundos, as imagens da √°rea de visibilidade s√£o carregadas uma de cada vez at√© que o processo seja conclu√≠do em cerca de 10 segundos (em compara√ß√£o com o cen√°rio ideal, quando s√£o exibidas de forma ligeiramente desfocada por cerca de 7 segundos e se tornam mais n√≠tidas pelos tr√™s segundos restantes). <br></li><li>  Depois que a parte visual da p√°gina √© conclu√≠da em 10 segundos (id√™ntico ao cen√°rio ideal), os 10 segundos restantes s√£o gastos na execu√ß√£o de scripts ass√≠ncronos e no carregamento de imagens ocultas (assim como no cen√°rio ideal). </li></ul><br><h1>  Compara√ß√£o visual </h1><br>  A diferen√ßa visual √© bem diferente, embora tecnicamente carregar todo o conte√∫do leve o mesmo tempo: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/62e/2a1/d5f/62e2a1d5f10b801af61992517d7f5a5a.gif"><br><br><h1>  Prioriza√ß√£o do lado do servidor </h1><br>  A prioriza√ß√£o de HTTP / 2 √© solicitada pelo cliente (navegador) e o servidor deve decidir o que fazer com base na solicita√ß√£o.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://github.com/andydavies/">Um grande n√∫mero de servidores n√£o suporta essa fun√ß√£o</a> e o restante atende a uma solicita√ß√£o do cliente.  Outra op√ß√£o √© decidir sobre a melhor prioriza√ß√£o do lado do servidor com base na solicita√ß√£o do cliente. <br><br>  De acordo com a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://http2.github.io/">especifica√ß√£o</a> , a prioriza√ß√£o de HTTP / 2 √© uma √°rvore de depend√™ncia que requer conhecimento completo de todas as solicita√ß√µes atuais para poder priorizar recursos em rela√ß√£o uns aos outros.  Isso permite implementar estrat√©gias incrivelmente complexas, mas √© dif√≠cil implement√°-lo bem no lado do navegador ou do servidor (como evidenciado por v√°rias estrat√©gias do navegador e diferentes n√≠veis de suporte do servidor).  Para simplificar o gerenciamento da prioriza√ß√£o, desenvolvemos um esquema mais simples que ainda possui toda a flexibilidade necess√°ria para o planejamento ideal. <br><br>  O esquema de prioriza√ß√£o do Cloudflare consiste em 64 "n√≠veis" priorit√°rios e, em cada n√≠vel, existem grupos de recursos que determinam como dividir a conex√£o entre si: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ba5/7e5/efa/ba57e5efa56119a58bbd39596da3f9ce.png"><br><br>  Primeiro, todos os recursos s√£o baixados em um n√≠vel de prioridade mais alto e, em seguida, ocorre uma transi√ß√£o para um n√≠vel mais baixo. <br><br>  Dentro de um determinado n√≠vel de prioridade, existem tr√™s grupos de simultaneidade diferentes: <br><br><ul><li>  <b>0</b> : todos os recursos do grupo "0" s√£o enviados seq√ºencialmente na ordem em que foram solicitados usando 100% de largura de banda.  Somente ap√≥s o carregamento de todos os recursos do grupo "0" s√£o considerados outros grupos no mesmo n√≠vel. <br></li><li>  <b>1</b> : todos os recursos no grupo de simultaneidade "1" s√£o enviados sequencialmente na ordem em que foram solicitados.  A largura de banda dispon√≠vel √© distribu√≠da igualmente entre o grupo de paralelismo "1" e o grupo de paralelismo "n". <br></li><li>  <b>n</b> : os recursos no grupo de simultaneidade "n" s√£o transmitidos em paralelo, compartilhando a largura de banda dispon√≠vel. </li></ul><br>  Na pr√°tica, o grupo de paralelismo "0" √© √∫til para conte√∫do cr√≠tico que precisa ser processado sequencialmente (scripts, CSS, etc.).  O grupo "1" √© √∫til para conte√∫do menos importante que pode compartilhar largura de banda com outros recursos, mas onde os pr√≥prios recursos ainda se beneficiam do processamento seq√ºencial (scripts ass√≠ncronos, imagens n√£o progressivas etc.).  O grupo de simultaneidade "n" √© √∫til para recursos que se beneficiam do processamento paralelo (imagens progressivas, v√≠deo, √°udio, etc.). <br><br><h1>  Prioriza√ß√£o padr√£o do Cloudflare </h1><br>  Com a op√ß√£o de prioriza√ß√£o avan√ßada, a ordem ‚Äúideal‚Äù de carregamento de recursos, conforme descrito acima, √© implementada.  As prioridades espec√≠ficas aplicadas s√£o as seguintes: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b89/e96/e4f/b89e96e4f4534f5df00d732e97b5db62.png"><br><br>  Esse esquema permite enviar seq√ºencialmente recursos que bloqueiam a renderiza√ß√£o, enviar imagens vis√≠veis em paralelo e o restante do conte√∫do da p√°gina com algum n√≠vel de compartilhamento de largura de banda para equilibrar o carregamento do aplicativo e do conte√∫do.  A <i>ressalva * Se detect√°vel</i> √© que nem todos os navegadores distinguem entre diferentes tipos de folhas de estilo e scripts, mas ainda assim ser√° muito mais r√°pido em todos os casos.  Acelera√ß√£o de 50%, especialmente para visitantes do Edge e Safari, n√£o ser√° nada incomum: <br><br> <a href=""><img src="https://habrastorage.org/webt/u_/1n/px/u_1npxrzhg0svmgdyzelnamxj84.png"></a> <br><br><h1>  Definindo prioriza√ß√£o com trabalhadores </h1><br>  O trabalho padr√£o mais r√°pido √© √≥timo, mas fica realmente interessante gra√ßas √† capacidade de configurar a prioriza√ß√£o com o suporte do Cloudflare Workers, para que os sites possam substituir a prioridade padr√£o dos recursos ou implementar seus pr√≥prios esquemas de prioriza√ß√£o. <br><br>  Se o trabalhador adicionar o cabe√ßalho <code>cf-priority</code> √† resposta, os servidores de borda Cloudflare aplicar√£o a prioridade e a simultaneidade especificadas.  O formato do cabe√ßalho √© &lt;priority&gt; / &lt;concurrency&gt;, portanto, o <code>response.headers.set('cf-priority', ‚Äú30/0‚Äù);</code>  definir√° a prioridade 30 e o paralelismo 0. para essa resposta. Da mesma forma, "30/1" definir√° o paralelismo "1" e "30 / n" definir√° o paralelismo para n. <br><br>  Com essa flexibilidade, um site pode definir prioridade arbitr√°ria de recursos para suas necessidades.  Por exemplo, para aumentar a prioridade de alguns scripts ass√≠ncronos importantes ou imagens principais: eles s√£o baixados mesmo antes de o navegador determinar que est√£o dentro do alcance. <br><br>  Para informar sobre decis√µes de prioriza√ß√£o, o tempo de execu√ß√£o dos trabalhadores tamb√©m indica as informa√ß√µes solicitadas pelo navegador na prioriza√ß√£o no objeto de solicita√ß√£o, que s√£o passadas ao destinat√°rio dos eventos do trabalhador (request.cf.requestPriority).  As prioridades de entrada s√£o uma lista de atributos separados por ponto e v√≠rgula.  Parece algo assim: <code>weight=192;exclusive=0;group=3;group-weight=127</code> . <br><br><ul><li>  <b>weight</b> : weight para priorizar o HTTP / 2. <br></li><li>  <b>exclusive</b> : o sinalizador HTTP / 2 exclusivo (1 para navegadores baseados em Chromium, 0 para outros). <br></li><li>  <b>group</b> : identificador de fluxo HTTP / 2 para o grupo de solicita√ß√µes (diferente de zero para o Firefox). <br></li><li>  <b>peso do grupo</b> : <b>peso</b> HTTP / 2 para o grupo de solicita√ß√µes (diferente de zero para o Firefox). </li></ul><br><h1>  Este √© apenas o come√ßo. </h1><br>  A capacidade de configurar e controlar a prioridade das respostas √© o principal componente para um √≥timo trabalho futuro.  Pretendemos introduzir nossas pr√≥prias otimiza√ß√µes avan√ßadas, mas com o apoio dos trabalhadores, todos os sites e pesquisadores podem experimentar v√°rias estrat√©gias de prioriza√ß√£o.  Por meio do Apps Marketplace, as empresas tamb√©m podem criar novos servi√ßos de otimiza√ß√£o sobre a plataforma de trabalho e disponibiliz√°-los para uso em outros sites. <br><br>  Se voc√™ estiver em um plano Pro ou superior, v√° para a guia "Velocidade" no painel Cloudflare e ative a "prioriza√ß√£o HTTP / 2 avan√ßada" para acelerar seu site. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/386/d53/276/386d532767b6396ee628a7e0eb837282.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt452020/">https://habr.com/ru/post/pt452020/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt452004/index.html">Encontrou a localiza√ß√£o da queda do dispositivo "Bereshit" na lua</a></li>
<li><a href="../pt452006/index.html">Metaverso √âpico: Por que os autores do Fortnite devem obt√™-lo</a></li>
<li><a href="../pt452008/index.html">Abordagens de engenharia e lista de verifica√ß√£o: como n√£o enlouquecer no caos de tarefas</a></li>
<li><a href="../pt452010/index.html">Osmo Action: a primeira c√¢mera de a√ß√£o da DJI</a></li>
<li><a href="../pt452016/index.html">12 anos na nuvem</a></li>
<li><a href="../pt452022/index.html">Google informa os usu√°rios sobre uma vulnerabilidade com suas chaves Titan Security</a></li>
<li><a href="../pt452026/index.html">20 anos atr√°s, a Microsoft mudou para sempre a maneira como usamos o mouse</a></li>
<li><a href="../pt452028/index.html">Raio de luz no reino sombrio: como a tecnologia retorna a vis√£o perdida</a></li>
<li><a href="../pt452030/index.html">Hist√≥rico da Internet: Descobrindo a interatividade</a></li>
<li><a href="../pt452034/index.html">Autocontrole do tempo para auto-educa√ß√£o e tempo para leitura de livros</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>