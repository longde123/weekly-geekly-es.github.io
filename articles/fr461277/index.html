<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äçüè´ üóÇÔ∏è üîã Pr√©sentation de l'outil gratuit SQLIndexManager üö∂üèº üë©‚Äçüëß ü¶Å</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Comme vous le savez, les index jouent un r√¥le important dans le SGBD, fournissant une recherche rapide des enregistrements n√©cessaires. Par cons√©quent...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pr√©sentation de l'outil gratuit SQLIndexManager</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461277/">  Comme vous le savez, les index jouent un r√¥le important dans le SGBD, fournissant une recherche rapide des enregistrements n√©cessaires.  Par cons√©quent, il est si important de les entretenir en temps opportun.  De nombreux documents ont √©t√© √©crits sur l'analyse et l'optimisation, y compris sur Internet.  Par exemple, une revue r√©cente de ce sujet a √©t√© faite dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cette publication</a> . <br><br>  Il existe de nombreuses solutions payantes et gratuites pour cela.  Par exemple, il existe une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">solution</a> cl√© en main bas√©e sur une m√©thode d'optimisation adaptative d'index. <br><br>  Ensuite, consid√©rez l'utilitaire gratuit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SQLIndexManager</a> , cr√©√© par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">AlanDenton</a> . <br><a name="habracut"></a><br>  La principale diff√©rence technique entre SQLIndexManager et un certain nombre d'autres analogues est faite par l'auteur lui-m√™me <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Dans le m√™me article, nous examinons le projet et les possibilit√©s d'utilisation de cette solution logicielle. <br><br>  Discutez de cet utilitaire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br>  Au fil du temps, la plupart des commentaires et bogues ont √©t√© corrig√©s. <br><br>  Passons maintenant √† l'utilitaire SQLIndexManager lui-m√™me. <br><br>  L'application est √©crite en C # .NET Framework 4.5 dans Visual Studio 2017 et utilise DevExpress pour les formulaires: <br><br> <a href=""><img src="https://habrastorage.org/webt/i0/wo/do/i0wodozvszemgmmash24snfzrgk.jpeg"></a> <br><br>  et ressemble √† ceci: <br><br> <a href=""><img src="https://habrastorage.org/webt/xc/mf/ac/xcmfacmb7wxiz5pfvg5m2ybyet4.jpeg"></a> <br><br>  Toutes les demandes sont g√©n√©r√©es dans les fichiers suivants: <br><br><ol><li>  Index </li><li>  Requ√™te </li><li>  Queryengine </li><li>  ServerInfo </li></ol><br> <a href=""><img src="https://habrastorage.org/webt/ya/ox/fo/yaoxfojk1yhfujv5nhu8wxfjx64.jpeg"></a> <br><br>  Lors de la connexion √† la base de donn√©es et de l'envoi de demandes au SGBD, l'application est sign√©e comme suit: <br><br><pre><code class="1c hljs">ApplicationName=‚ÄùSQLIndexManager‚Äù</code> </pre> <br>  Lorsque l'application d√©marre, une fen√™tre modale s'ouvre pour ajouter une connexion: <br> <a href=""><img src="https://habrastorage.org/webt/77/kw/uh/77kwuhjmxnartbvfvmpnk8fpi7k.jpeg"></a> <br><br>  Ici, le chargement de la liste compl√®te de toutes les instances de MS SQL Server disponibles sur les r√©seaux locaux ne fonctionne pas encore. <br><br>  Vous pouvez √©galement ajouter une connexion en utilisant le bouton le plus √† gauche du menu principal: <br><br> <a href=""><img src="https://habrastorage.org/webt/id/l0/w_/idl0w_a4afakmyqmegzbrbomksc.jpeg"></a> <br><br>  Ensuite, les requ√™tes SGBD suivantes seront lanc√©es: <br><br><ol><li><div class="spoiler">  <b class="spoiler_title">Obtention d'informations sur le SGBD</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ProductLevel = SERVERPROPERTY(<span class="hljs-string"><span class="hljs-string">'ProductLevel'</span></span>) , <span class="hljs-keyword"><span class="hljs-keyword">Edition</span></span> = SERVERPROPERTY(<span class="hljs-string"><span class="hljs-string">'Edition'</span></span>) , ServerVersion = SERVERPROPERTY(<span class="hljs-string"><span class="hljs-string">'ProductVersion'</span></span>) , IsSysAdmin = <span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>(IS_SRVROLEMEMBER(<span class="hljs-string"><span class="hljs-string">'sysadmin'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIT</span></span>)</code> </pre><br></div></div></li><li><div class="spoiler">  <b class="spoiler_title">Obtenir une liste des bases de donn√©es disponibles avec leurs br√®ves propri√©t√©s</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> DatabaseName = t.[<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>] , d.DataSize , DataUsedSize = <span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>(<span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>) , d.LogSize , LogUsedSize = <span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>(<span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>) , RecoveryModel = t.recovery_model_desc , LogReuseWait = t.log_reuse_wait_desc <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.databases t <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span>(NOLOCK) <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> [database_id] , DataSize = <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>) , LogSize = <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>] = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.master_files <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span>(NOLOCK) <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> [database_id] ) d <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> d.[database_id] = t.[database_id] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> t.[state] = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> t.[database_id] != <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ISNULL</span></span>(HAS_DBACCESS(t.[<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>]), <span class="hljs-number"><span class="hljs-number">1</span></span>) = <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br></div></div></li></ol><br>  Apr√®s avoir ex√©cut√© les scripts ci-dessus, une fen√™tre appara√Æt contenant de br√®ves informations sur les bases de donn√©es de l'instance s√©lectionn√©e de MS SQL Server: <br><br> <a href=""><img src="https://habrastorage.org/webt/bc/fy/gz/bcfygzsztslx32ll82uxflshfhi.jpeg"></a> <br><br>  Il convient de noter que des informations √©tendues sont affich√©es en fonction des droits.  S'il existe un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">administrateur syst√®me</a> , vous pouvez s√©lectionner des donn√©es dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vue sys.master_files</a> .  S'il n'y a pas de tels droits, moins de donn√©es sont renvoy√©es afin de ne pas ralentir la demande. <br><br>  Ici, vous devez s√©lectionner la base de donn√©es d'int√©r√™t et cliquer sur le bouton "OK". <br><br>  Ensuite, le script suivant sera ex√©cut√© pour chaque base de donn√©es s√©lectionn√©e pour analyser l'√©tat des index: <br><br><div class="spoiler">  <b class="spoiler_title">Analyse de l'√©tat de l'index</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> @Fragmentation <span class="hljs-built_in"><span class="hljs-built_in">float</span></span>=<span class="hljs-number"><span class="hljs-number">15</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> @MinIndexSize <span class="hljs-built_in"><span class="hljs-built_in">bigint</span></span>=<span class="hljs-number"><span class="hljs-number">768</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> @MaxIndexSize <span class="hljs-built_in"><span class="hljs-built_in">bigint</span></span>=<span class="hljs-number"><span class="hljs-number">1048576</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> @PreDescribeSize <span class="hljs-built_in"><span class="hljs-built_in">bigint</span></span>=<span class="hljs-number"><span class="hljs-number">32768</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> NOCOUNT <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> ARITHABORT <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> NUMERIC_ROUNDABORT <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> OBJECT_ID(<span class="hljs-string"><span class="hljs-string">'tempdb.dbo.#AllocationUnits'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-comment"><span class="hljs-comment">#AllocationUnits CREATE TABLE #AllocationUnits ( ContainerID BIGINT PRIMARY KEY , ReservedPages BIGINT NOT NULL , UsedPages BIGINT NOT NULL ) INSERT INTO #AllocationUnits (ContainerID, ReservedPages, UsedPages) SELECT [container_id] , SUM([total_pages]) , SUM([used_pages]) FROM sys.allocation_units WITH(NOLOCK) GROUP BY [container_id] HAVING SUM([total_pages]) BETWEEN @MinIndexSize AND @MaxIndexSize IF OBJECT_ID('tempdb.dbo.#ExcludeList') IS NOT NULL DROP TABLE #ExcludeList CREATE TABLE #ExcludeList (ID INT PRIMARY KEY) INSERT INTO #ExcludeList SELECT [object_id] FROM sys.objects WITH(NOLOCK) WHERE [type] IN ('V', 'U') AND ( [is_ms_shipped] = 1 ) IF OBJECT_ID('tempdb.dbo.#Partitions') IS NOT NULL DROP TABLE #Partitions SELECT [object_id] , [index_id] , [partition_id] , [partition_number] , [rows] , [data_compression] INTO #Partitions FROM sys.partitions WITH(NOLOCK) WHERE [object_id] &gt; 255 AND [rows] &gt; 0 AND [object_id] NOT IN (SELECT * FROM #ExcludeList) IF OBJECT_ID('tempdb.dbo.#Indexes') IS NOT NULL DROP TABLE #Indexes CREATE TABLE #Indexes ( ObjectID INT NOT NULL , IndexID INT NOT NULL , IndexName SYSNAME NULL , PagesCount BIGINT NOT NULL , UnusedPagesCount BIGINT NOT NULL , PartitionNumber INT NOT NULL , RowsCount BIGINT NOT NULL , IndexType TINYINT NOT NULL , IsAllowPageLocks BIT NOT NULL , DataSpaceID INT NOT NULL , DataCompression TINYINT NOT NULL , IsUnique BIT NOT NULL , IsPK BIT NOT NULL , FillFactorValue INT NOT NULL , IsFiltered BIT NOT NULL , PRIMARY KEY (ObjectID, IndexID, PartitionNumber) ) INSERT INTO #Indexes SELECT ObjectID = i.[object_id] , IndexID = i.index_id , IndexName = i.[name] , PagesCount = a.ReservedPages , UnusedPagesCount = CASE WHEN ABS(a.ReservedPages - a.UsedPages) &gt; 32 THEN a.ReservedPages - a.UsedPages ELSE 0 END , PartitionNumber = p.[partition_number] , RowsCount = ISNULL(p.[rows], 0) , IndexType = i.[type] , IsAllowPageLocks = i.[allow_page_locks] , DataSpaceID = i.[data_space_id] , DataCompression = p.[data_compression] , IsUnique = i.[is_unique] , IsPK = i.[is_primary_key] , FillFactorValue = i.[fill_factor] , IsFiltered = i.[has_filter] FROM #AllocationUnits a JOIN #Partitions p ON a.ContainerID = p.[partition_id] JOIN sys.indexes i WITH(NOLOCK) ON i.[object_id] = p.[object_id] AND p.[index_id] = i.[index_id] WHERE i.[type] IN (0, 1, 2, 5, 6) AND i.[object_id] &gt; 255 DECLARE @files TABLE (ID INT PRIMARY KEY) INSERT INTO @files SELECT DISTINCT [data_space_id] FROM sys.database_files WITH(NOLOCK) WHERE [state] != 0 AND [type] = 0 IF @@ROWCOUNT &gt; 0 BEGIN DELETE FROM i FROM #Indexes i LEFT JOIN sys.destination_data_spaces dds WITH(NOLOCK) ON i.DataSpaceID = dds.[partition_scheme_id] AND i.PartitionNumber = dds.[destination_id] WHERE ISNULL(dds.[data_space_id], i.DataSpaceID) IN (SELECT * FROM @files) END DECLARE @DBID INT , @DBNAME SYSNAME SET @DBNAME = DB_NAME() SELECT @DBID = [database_id] FROM sys.databases WITH(NOLOCK) WHERE [name] = @DBNAME IF OBJECT_ID('tempdb.dbo.#Fragmentation') IS NOT NULL DROP TABLE #Fragmentation CREATE TABLE #Fragmentation ( ObjectID INT NOT NULL , IndexID INT NOT NULL , PartitionNumber INT NOT NULL , Fragmentation FLOAT NOT NULL , PRIMARY KEY (ObjectID, IndexID, PartitionNumber) ) INSERT INTO #Fragmentation (ObjectID, IndexID, PartitionNumber, Fragmentation) SELECT i.ObjectID , i.IndexID , i.PartitionNumber , r.[avg_fragmentation_in_percent] FROM #Indexes i CROSS APPLY sys.dm_db_index_physical_stats(@DBID, i.ObjectID, i.IndexID, i.PartitionNumber, 'LIMITED') r WHERE i.PagesCount &lt;= @PreDescribeSize AND r.[index_level] = 0 AND r.[alloc_unit_type_desc] = 'IN_ROW_DATA' AND i.IndexType IN (0, 1, 2) IF OBJECT_ID('tempdb.dbo.#Columns') IS NOT NULL DROP TABLE #Columns CREATE TABLE #Columns ( ObjectID INT NOT NULL , ColumnID INT NOT NULL , ColumnName SYSNAME NULL , SystemTypeID TINYINT NULL , IsSparse BIT , IsColumnSet BIT , MaxLen INT , PRIMARY KEY (ObjectID, ColumnID) ) INSERT INTO #Columns SELECT ObjectID = [object_id] , ColumnID = [column_id] , ColumnName = [name] , SystemTypeID = [system_type_id] , IsSparse = [is_sparse] , IsColumnSet = [is_column_set] , MaxLen = [max_length] FROM sys.columns WITH(NOLOCK) WHERE [object_id] IN (SELECT DISTINCT i.ObjectID FROM #Indexes i) IF OBJECT_ID('tempdb.dbo.#IndexColumns') IS NOT NULL DROP TABLE #IndexColumns CREATE TABLE #IndexColumns ( ObjectID INT NOT NULL , IndexID INT NOT NULL , OrderID INT NOT NULL , ColumnID INT NOT NULL , IsIncluded BIT NOT NULL , PRIMARY KEY (ObjectID, IndexID, ColumnID) ) INSERT INTO #IndexColumns SELECT ObjectID = [object_id] , IndexID = [index_id] , OrderID = CASE WHEN [is_included_column] = 0 THEN [key_ordinal] ELSE [index_column_id] END , ColumnID = [column_id] , IsIncluded = ISNULL([is_included_column], 0) FROM sys.index_columns ic WITH(NOLOCK) WHERE EXISTS( SELECT * FROM #Indexes i WHERE i.ObjectID = ic.[object_id] AND i.IndexID = ic.[index_id] AND i.IndexType IN (1, 2) ) IF OBJECT_ID('tempdb.dbo.#Lob') IS NOT NULL DROP TABLE #Lob CREATE TABLE #Lob ( ObjectID INT NOT NULL , IndexID INT NOT NULL , IsLobLegacy BIT , IsLob BIT , PRIMARY KEY (ObjectID, IndexID) ) INSERT INTO #Lob (ObjectID, IndexID, IsLobLegacy, IsLob) SELECT c.ObjectID , IndexID = ISNULL(i.IndexID, 1) , IsLobLegacy = MAX(CASE WHEN c.SystemTypeID IN (34, 35, 99) THEN 1 END) , IsLob = 0 FROM #Columns c LEFT JOIN #IndexColumns i ON c.ObjectID = i.ObjectID AND c.ColumnID = i.ColumnID WHERE c.SystemTypeID IN (34, 35, 99) GROUP BY c.ObjectID , i.IndexID IF OBJECT_ID('tempdb.dbo.#Sparse') IS NOT NULL DROP TABLE #Sparse CREATE TABLE #Sparse (ObjectID INT PRIMARY KEY) INSERT INTO #Sparse SELECT DISTINCT ObjectID FROM #Columns WHERE IsSparse = 1 OR IsColumnSet = 1 IF OBJECT_ID('tempdb.dbo.#AggColumns') IS NOT NULL DROP TABLE #AggColumns CREATE TABLE #AggColumns ( ObjectID INT NOT NULL , IndexID INT NOT NULL , IndexColumns NVARCHAR(MAX) , IncludedColumns NVARCHAR(MAX) , PRIMARY KEY (ObjectID, IndexID) ) INSERT INTO #AggColumns SELECT t.ObjectID , t.IndexID , IndexColumns = STUFF(( SELECT ', [' + c.ColumnName + ']' FROM #IndexColumns i JOIN #Columns c ON i.ObjectID = c.ObjectID AND i.ColumnID = c.ColumnID WHERE i.ObjectID = t.ObjectID AND i.IndexID = t.IndexID AND i.IsIncluded = 0 ORDER BY i.OrderID FOR XML PATH(''), TYPE).value('(./text())[1]', 'NVARCHAR(MAX)'), 1, 2, '') , IncludedColumns = STUFF(( SELECT ', [' + c.ColumnName + ']' FROM #IndexColumns i JOIN #Columns c ON i.ObjectID = c.ObjectID AND i.ColumnID = c.ColumnID WHERE i.ObjectID = t.ObjectID AND i.IndexID = t.IndexID AND i.IsIncluded = 1 ORDER BY i.OrderID FOR XML PATH(''), TYPE).value('(./text())[1]', 'NVARCHAR(MAX)'), 1, 2, '') FROM ( SELECT DISTINCT ObjectID, IndexID FROM #Indexes WHERE IndexType IN (1, 2) ) t SELECT i.ObjectID , i.IndexID , i.IndexName , ObjectName = o.[name] , SchemaName = s.[name] , i.PagesCount , i.UnusedPagesCount , i.PartitionNumber , i.RowsCount , i.IndexType , i.IsAllowPageLocks , u.TotalWrites , u.TotalReads , u.TotalSeeks , u.TotalScans , u.TotalLookups , u.LastUsage , i.DataCompression , f.Fragmentation , IndexStats = STATS_DATE(i.ObjectID, i.IndexID) , IsLobLegacy = ISNULL(lob.IsLobLegacy, 0) , IsLob = ISNULL(lob.IsLob, 0) , IsSparse = CAST(CASE WHEN p.ObjectID IS NULL THEN 0 ELSE 1 END AS BIT) , IsPartitioned = CAST(CASE WHEN dds.[data_space_id] IS NOT NULL THEN 1 ELSE 0 END AS BIT) , FileGroupName = fg.[name] , i.IsUnique , i.IsPK , i.FillFactorValue , i.IsFiltered , a.IndexColumns , a.IncludedColumns FROM #Indexes i JOIN sys.objects o WITH(NOLOCK) ON o.[object_id] = i.ObjectID JOIN sys.schemas s WITH(NOLOCK) ON s.[schema_id] = o.[schema_id] LEFT JOIN #AggColumns a ON a.ObjectID = i.ObjectID AND a.IndexID = i.IndexID LEFT JOIN #Sparse p ON p.ObjectID = i.ObjectID LEFT JOIN #Fragmentation f ON f.ObjectID = i.ObjectID AND f.IndexID = i.IndexID AND f.PartitionNumber = i.PartitionNumber LEFT JOIN ( SELECT ObjectID = [object_id] , IndexID = [index_id] , TotalWrites = NULLIF([user_updates], 0) , TotalReads = NULLIF([user_seeks] + [user_scans] + [user_lookups], 0) , TotalSeeks = NULLIF([user_seeks], 0) , TotalScans = NULLIF([user_scans], 0) , TotalLookups = NULLIF([user_lookups], 0) , LastUsage = ( SELECT MAX(dt) FROM ( VALUES ([last_user_seek]) , ([last_user_scan]) , ([last_user_lookup]) , ([last_user_update]) ) t(dt) ) FROM sys.dm_db_index_usage_stats WITH(NOLOCK) WHERE [database_id] = @DBID ) u ON i.ObjectID = u.ObjectID AND i.IndexID = u.IndexID LEFT JOIN #Lob lob ON lob.ObjectID = i.ObjectID AND lob.IndexID = i.IndexID LEFT JOIN sys.destination_data_spaces dds WITH(NOLOCK) ON i.DataSpaceID = dds.[partition_scheme_id] AND i.PartitionNumber = dds.[destination_id] JOIN sys.filegroups fg WITH(NOLOCK) ON ISNULL(dds.[data_space_id], i.DataSpaceID) = fg.[data_space_id] WHERE o.[type] IN ('V', 'U') AND ( f.Fragmentation &gt;= @Fragmentation OR i.PagesCount &gt; @PreDescribeSize OR i.IndexType IN (5, 6) )</span></span></code> </pre><br></div></div><br>  Comme vous pouvez le voir dans les requ√™tes elles-m√™mes, des tables temporaires sont souvent utilis√©es.  Ceci est fait de mani√®re √† ce qu'il n'y ait pas de recompilation, et dans le cas d'un grand sch√©ma, le plan pourrait √™tre g√©n√©r√© en parall√®le lors de l'insertion de donn√©es, car l'insertion avec des variables de table n'est possible que dans un seul flux. <br><br>  Apr√®s avoir ex√©cut√© le script ci-dessus, une fen√™tre avec la table d'index appara√Ætra: <br><br> <a href=""><img src="https://habrastorage.org/webt/yd/rl/oh/ydrlohqwbtggc8n8equratfkkr0.jpeg"></a> <br><br>  Ici, vous pouvez √©galement afficher d'autres informations d√©taill√©es, telles que: <br><br><ol><li>  une base de donn√©es </li><li>  nombre de sections </li><li>  date et heure du dernier appel </li><li>  compression </li><li>  groupe de fichiers </li></ol><br>  etc. <br>  Les colonnes elles-m√™mes peuvent √™tre personnalis√©es: <br><br> <a href=""><img src="https://habrastorage.org/webt/7z/qw/jf/7zqwjfox2zagl5ox0oji648jnta.jpeg"></a> <br><br>  Dans les cellules de la colonne Fix, vous pouvez choisir quelle action sera effectu√©e lors de l'optimisation.  De plus, une fois la num√©risation termin√©e, l'action par d√©faut est s√©lectionn√©e en fonction des param√®tres s√©lectionn√©s: <br><br> <a href=""><img src="https://habrastorage.org/webt/yp/c9/o2/ypc9o2ooiylu7n0pw7zbdo97tbi.jpeg"></a> <br><br>  Vous devez s√©lectionner les index souhait√©s pour le traitement. <br><br>  En utilisant le menu principal, vous pouvez enregistrer le script (le m√™me bouton d√©marre le processus d'optimisation d'index lui-m√™me): <br><br> <a href=""><img src="https://habrastorage.org/webt/tt/tu/fn/tttufnve3kmo_siz_d0ahcxfew8.jpeg"></a> <br><br>  enregistrer le tableau dans diff√©rents formats (le m√™me bouton vous permet d'ouvrir des param√®tres d√©taill√©s pour l'analyse et l'optimisation des indices): <br><br> <a href=""><img src="https://habrastorage.org/webt/tt/8w/gv/tt8wgvpzqx1cl0a1qvkdfxf1ffm.jpeg"></a> <br><br>  De plus, les informations peuvent √™tre mises √† jour en cliquant sur le troisi√®me bouton √† gauche dans le menu principal √† c√¥t√© de la loupe. <br><br>  Un bouton avec une loupe vous permet de s√©lectionner la base de donn√©es souhait√©e pour examen. <br><br>  Il n'existe actuellement aucun syst√®me d'aide complet.  Par cons√©quent, en appuyant sur le "?"  cela provoquera simplement l'apparition d'une fen√™tre modale contenant des informations de base sur le produit logiciel: <br><br> <a href=""><img src="https://habrastorage.org/webt/e5/p_/mq/e5p_mqbcsumjihbb3qnwurxyqdk.jpeg"></a> <br><br>  En plus de tout ce qui pr√©c√®de, le menu principal dispose d'une barre de recherche: <br><br> <a href=""><img src="https://habrastorage.org/webt/bm/1c/nn/bm1cnnxagvohdo3a4qtprhvpqbe.jpeg"></a> <br><br>  Lors du d√©marrage du processus d'optimisation d'index: <br><br> <a href=""><img src="https://habrastorage.org/webt/qn/xa/en/qnxaenzm91ifrvoc2l0aipezq5o.jpeg"></a> <br><br>  Toujours en bas de la fen√™tre, vous pouvez voir le journal des actions effectu√©es: <br><br> <a href=""><img src="https://habrastorage.org/webt/wc/aq/zs/wcaqzsz72m6dbuwe3bv1fxqm_3k.jpeg"></a> <br><br>  Dans la fen√™tre d'analyse d√©taill√©e et d'optimisation des index, vous pouvez configurer des options plus subtiles: <br><br> <a href=""><img src="https://habrastorage.org/webt/kc/6x/gp/kc6xgpndlhe19ueeehpobprsomc.jpeg"></a> <br><br>  <b>Suggestions pour l'application:</b> <br><br><ol><li>  permettre la mise √† jour s√©lective des statistiques non seulement pour les index mais √©galement de diff√©rentes mani√®res (mise √† jour compl√®te ou partielle) </li><li>  permettent non seulement de s√©lectionner la base de donn√©es, mais aussi diff√©rents serveurs (c'est tr√®s pratique quand il y a beaucoup d'instances de MS SQL Server) </li><li>  pour une plus grande flexibilit√© d'utilisation, il est propos√© d'envelopper les commandes dans les biblioth√®ques et de les exporter vers les commandes PowerShell, comme cela se fait, par exemple, ici: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dbatools.io/commands</a> </li><li>  permettent d'enregistrer et de modifier les param√®tres personnels √† la fois pour l'ensemble de l'application et, si n√©cessaire, pour chaque instance de MS SQL Server et chaque base de donn√©es </li><li>  des clauses 2 et 4, il d√©coule de la volont√© de faire des groupes sur les bases de donn√©es et des groupes sur les instances de MS SQL Server, pour lesquels les param√®tres sont les m√™mes </li><li>  rechercher des indices en double (complets et incomplets, qui diff√®rent l√©g√®rement ou ne diff√®rent que dans les colonnes incluses) </li><li>  √âtant donn√© que SQLIndexManager est utilis√© uniquement pour le SGBD MS SQL Server, vous devez refl√©ter cela dans le nom, par exemple, comme suit: SQLIndexManager pour MS SQL Server </li><li>  Supprimez toutes les parties de l'application de l'interface graphique dans des modules s√©par√©s et r√©√©crivez-les dans .NET Core 2.1 </li></ol><br>  Au moment de la r√©daction de cet article, l'article 6 des souhaits est en cours d'√©laboration et il existe d√©j√† un soutien sous la forme d'une recherche de doublons complets et similaires: <br><br> <a href=""><img src="https://habrastorage.org/webt/zk/bw/d3/zkbwd3hem7xtdtj_5yuqhctasac.jpeg"></a> <br><br><h3>  Les sources </h3><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">m√©thode d'optimisation d'index adaptative</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Utilitaire SQLIndexManager</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un bref aper√ßu technique de l'utilitaire SQLIndexManager</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">discussion sur l'utilitaire SQLIndexManager</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SQL Index Manager - Outil GUI gratuit pour la maintenance des index sur SQL Server et Azure</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Analyse et optimisation d'index SQL Server</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr461277/">https://habr.com/ru/post/fr461277/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr461265/index.html">√Ä propos de l'abus de l'utilisation du syst√®me d'exploitation dans les projets de microcontr√¥leurs</a></li>
<li><a href="../fr461267/index.html">Nouvelles technologies Intel pour le conditionnement des puces</a></li>
<li><a href="../fr461269/index.html">La solution de travail avec pwnable.kr 08 est leg et 10 est shellshock. Assembleur ARM. Vuln√©rabilit√© Bash</a></li>
<li><a href="../fr461271/index.html">Comment promouvoir une application mobile en 2019: 4 fa√ßons pratiques + outils utiles</a></li>
<li><a href="../fr461273/index.html">Approche gourmande et machines √† sous. Analyse des t√¢ches de la piste ML du championnat de programmation</a></li>
<li><a href="../fr461279/index.html">Comment cr√©er un microservice simple sur Golang et gRPC et le conteneuriser √† l'aide de Docker</a></li>
<li><a href="../fr461281/index.html">Proc√©dure pas √† pas pour configurer un serveur DNS BIND dans un environnement chroot pour Red Hat (RHEL / CentOS) 7</a></li>
<li><a href="../fr461283/index.html">Architecture logicielle et conception de syst√®mes: guide g√©n√©ral et ressources</a></li>
<li><a href="../fr461285/index.html">5 algorithmes d'√©chantillonnage principaux</a></li>
<li><a href="../fr461287/index.html">D√©velopper une IA astucieuse dans un jeu tactique bas√© sur l'heuristique et les mutations</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>