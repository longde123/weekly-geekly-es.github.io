<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéê üêé üåª La historia de c√≥mo actualic√© Yandex MapKit en iOS o mapas, dinero, 2 mapas üóΩ üòπ üë©üèª‚Äçüéì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pr√≥logo 

 Hola amigos , al principio explicar√© de inmediato el prop√≥sito del art√≠culo: ahorrar tiempo si necesita actualizar o insertar mapas de Yand...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>La historia de c√≥mo actualic√© Yandex MapKit en iOS o mapas, dinero, 2 mapas</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427611/"><h3>  Pr√≥logo </h3><br><br>  <b>Hola amigos</b> , al principio explicar√© de inmediato el prop√≥sito del art√≠culo: <b>ahorrar tiempo</b> si necesita <b>actualizar o insertar mapas de Yandex</b> en su cliente m√≥vil iOS, adem√°s del deseo de compartir su experiencia. <br><br>  Una vez incorporamos la aplicaci√≥n YandexMapkit (aproximadamente en octubre de 2017) en lugar de tarjetas de correo electr√≥nico (nada personal, solo negocios).  Despu√©s de aproximadamente 3 meses, en un hermoso d√≠a de invierno, la versi√≥n Androyd de las tarjetas sali√≥ de servicio el d√≠a 2 debido a las llaves, la tarjeta se convirti√≥ en una calabaza) ¬øCu√°l es el consejo del manual: "En el Android, las tarjetas estaban rotas, no saben c√≥mo arreglarlo" En ese momento como cliente iOS, esto no afect√≥.  Pobres chicos del androide ... esta vez los chicos no ten√≠an nada que ver.  En aquellos d√≠as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">, muchos puntos bajos cayeron</a> : el puesto de Rusia, el Ornitorrinco, ¬øpueden recordarlo? <br><br><img src="https://habrastorage.org/webt/ny/sl/uk/nysluk1xq_j6lfzmv2tmusk_gci.png"><br><br>  Quiero decir, cuando su aplicaci√≥n est√° vinculada a servicios de terceros, ser√≠a bueno tener un plan "B" para este caso, por ejemplo, cambiar a la versi√≥n anterior de la implementaci√≥n de tarjetas de Apple, y no reemplazar una por otra ... <br><br>  Despu√©s de otros 3 meses, en alg√∫n lugar de marzo, lleg√≥ una carta de Yandex que finalmente hab√≠an actualizado sdk (ha pasado muy poco tiempo, 4-5 a√±os desde la actualizaci√≥n anterior): <br>  "-Actualizaci√≥n, apague el viejo en un a√±o", en resumen.  Antes de eso, simplemente hab√≠a una versi√≥n antigua 1.0 <br><br><img src="https://habrastorage.org/webt/mk/bn/el/mkbnelhsho-0yzuynyrwg8fw6by.png"><br><a name="habracut"></a><br>  Bueno, por supuesto, despu√©s de tal advertencia, no tiramos e inmediatamente comenzamos la transici√≥n ... despu√©s de 3 meses) en agosto. <br><br><h2>  Etapa de "comentarios" (Desactivar funcionalidad) </h2><br>  Dices, ja ... lo que se actualiza all√≠, el pod actualizado, se corrigi√≥ un par de lugares y eso es todo.  As√≠ que no, muchachos, la nueva API de mapas no es absolutamente compatible con la anterior, y adem√°s, como result√≥ m√°s tarde, ¬°incluso hay muchas necesidades vitales que est√°n listas para usar en la versi√≥n anterior y otras bibliotecas de tarjetas! <br><br>  Entonces, mapkit 3.0 (al escribir un art√≠culo versi√≥n 3.1 fue lanzado), un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enlace a la documentaci√≥n</a> . <br><br>  ¬øY por qu√©, adem√°s de una advertencia de Yandex?  Mientras tanto, en una versi√≥n beta de Xcode 10, un proyecto con una ballena vieja est√∫pidamente no va a funcionar, porque C ++ se usa en alg√∫n lugar dentro, lo que est√° privado en la nueva versi√≥n.  Es necesario cambiarle el nombre en la sublista, incluso actualizarlo all√≠, etc., en resumen, no hice esto, porque al final todav√≠a necesito actualizar <br><br>  1) Actualizamos SDK, en lugar de la versi√≥n 1.0 inmediatamente 3.0, por supuesto, la API ha cambiado, pero mucho ... <br><br>  Entonces, el antiguo Protocolo de anotaci√≥n YMK simplemente falta <br><br><img src="https://habrastorage.org/webt/0y/ma/2j/0yma2jg0ol_cmlsv5iawysjcq4c.png"><br><br><br>  En forma r√°pida, parece una tira forjada forzada (: eso no es un zumbido, y luego llevas un cartel "!" Para ti mismo ... Ejemplo de implementaci√≥n de protocolo: <br><br><img src="https://habrastorage.org/webt/6_/7u/uw/6_7uuw9qsz5xa0xydgf5rqeturk.png"><br><br>  Bueno, volvamos a escribir) el nuestro, solo que en lugar del m√©todo coordinar () haremos las propiedades, todo es simple, el m√©todo es redundante;  title! () se reemplaza por un t√≠tulo sin forma (), por otro lado, puede hacer una propiedad, bueno, mucho, donde tiene que cambiar el proyecto, as√≠ que simplemente elimin√© el signo de exclamaci√≥n. <br><br>  En nuestro proyecto, fue necesario reemplazar en 3 controladores un par de veces, importar CoreLocation en otro, ya que ahora no se importa en ninguno de los encabezados Yandex MapPocket. <br><br>  Para no cambiar el nombre del familiar YMKMapCoordinate (ballena vieja) a lo largo del proyecto, se hicieron typealias para YMKPoint (nueva ballena) <br><br><img src="https://habrastorage.org/webt/bk/xi/iv/bkxiivvenzq6k_yulfn8thesay8.png"><br><br>  2) Adem√°s, declaremos algunas propiedades que necesitaremos en el futuro para trabajar con el mapa, principalmente getters: <br><br><img src="https://habrastorage.org/webt/wx/15/zu/wx15zujdm2ylkpok3cujwbagzog.png"><br><br>  3) Lo primero que hay que crear es YMKMapView (todo est√° bien, ese objeto todav√≠a est√° disponible).  Anteriormente, lo inicialic√© de inmediato, ahora no puedes hacer esto, se bloquear√°, ¬°porque primero debes poner la llave!  La clave actual no funcionar√° y debe solicitar una nueva.  Agregar a AppDelegate, de acuerdo con la documentaci√≥n.  Solo despu√©s de configurar la clave, podemos crear YMKMapView y configurarlo de la manera que necesitamos en el m√©todo setupMap () <br><br><img src="https://habrastorage.org/webt/ab/fp/8b/abfp8ba-jefubna2qmqsmsxpg7q.png"><br><br>  Lo que sucede aqu√≠, lo analizaremos en detalle m√°s adelante en el curso de la necesidad de configuraciones apropiadas <br><br>  4) ¬øQu√© sigue?, Y luego tuvimos la ubicaci√≥n inicial de CLLocation, pero ahora para usarlo debe agregar el marco CoreLocation manualmente, o ... o reemplazarlo con YMKPoint desde el mapa de Yandex <br><br><img src="https://habrastorage.org/webt/jw/eo/hj/jweohjs_xdkhqdjhg5ludux4qsi.png"><br><br>  5) Adem√°s, el mapa se centr√≥ en esta coordenada por un m√©todo muy simple, pero ahora no hay un simple <br><br><img src="https://habrastorage.org/webt/db/w_/sf/dbw_sf_pf_7nqkfk4wil_mlt8kw.png"><br><br>  Pero hay un poco m√°s complicado y un poco m√°s profundo, el objeto de mapa) ... mapView.mapWindow.map! .Move.  Aqu√≠ aprendemos sobre la existencia de un objeto como YMKCameraPosition. <br><br><img src="https://habrastorage.org/webt/6y/hd/lt/6yhdltmfe8hap6p06qzpyk7clj8.png"><br><br>  6) A continuaci√≥n, comentamos la configuraci√≥n del mapa, ya que no existen tales api / propiedades.  Ahora solo lo omitimos para comenzar al menos m√≠nimamente. <br><br>  Comentamos sobre agregar anotaciones (prestar√© atenci√≥n a que esta es la funcionalidad est√°ndar), tambi√©n comentamos sobre mostrar los puntos m√°s cercanos (esto ya es alg√∫n tipo de nuestra funcionalidad). <br><br>  Y todo el YMKMapViewDelegate tambi√©n es un comentario, que no encontr√© en el nuevo marco, y un an√°logo similar tambi√©n. <br><br><img src="https://habrastorage.org/webt/ug/jg/ix/ugjgixhzbdvdjtqnyz3g-vawas8.png"><br><br>  Omit√≠ la implementaci√≥n, solo los m√©todos mismos: <br><br>  - si mostrar la ubicaci√≥n del usuario, <br>  - qu√© vistas usar para los pines, <br>  - reacci√≥n al hacer clic en la anotaci√≥n, <br>  - qu√© llamadas para anotaci√≥n, <br>  - La reacci√≥n al hacer clic en la llamada, es decir, todo lo que usamos habitualmente.  Al final, hubo alg√∫n tipo de nuestro m√©todo, que tambi√©n utilizaba una tarjeta API espec√≠fica. <br><br>  <b>TODO</b> descifrado con MapVC: esta es la clase principal donde se utiliz√≥ el mapkit <br><br>  7) Un peque√±o comentario sobre la llamada personalizada, ya no heredar√° YMKCalloutView, ya no hay m√°s en la nueva ballena. <br><br>  Hurra, ahora que el proyecto se ha reunido, pude comenzar todo y ... ver el cuaderno en la caja, porque despu√©s de que comienza, debes dar tiempo para "calentar")), pero no lo sab√≠a y pens√© que algo no estaba entonces, aunque suger√≠ que lleva tiempo activar la clave.  Resulta que la suposici√≥n era correcta.  Debe esperar aproximadamente una hora (tal vez algo ha cambiado ahora). <br><br>  Con otro intento de modificar la antigua API de una manera nueva, se mostr√≥ el mapa. <br><br><h2>  Etapa dos: "b√∫squeda" (c√≥mo implementar la funcionalidad anterior de una manera nueva) </h2><br>  Comencemos a restaurar la funcionalidad perdida.  Por lo tanto, debe mostrar el bloqueo de usuario, pero a la antigua usanza simplemente no se puede cambiar la propiedad y configurar el delegado. <br><br>  Ahora esto se hace a trav√©s de la capa, consulte el m√©todo 3 de setupMap (). <br><br><img src="https://habrastorage.org/webt/cs/w5/c8/csw5c8t0hyasi5x87xzmgeffs60.png"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Echaremos un vistazo</a> al ejemplo en la demostraci√≥n ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">descarga desde Yandex github</a> ), ya que est√° all√≠.  Por cierto, debes prestar atenci√≥n a setAnchorWith.  M√°s adelante dir√© por qu√©, est√° asociado con el zoom.  Ok ubicaci√≥n funciona. <br><br>  2) Lo que sigue, por supuesto, anotaciones.  No puede agregar a la antigua usanza, volvemos a ver la demostraci√≥n.  Hay una clase all√≠: MapObjectsViewController.  En la nueva versi√≥n, para agregar pines al mapa, el delegado no es necesario, para esto necesita acceder a la propiedad mapObjects, llamar al m√©todo addPlacemark en el objeto y pasar la coordenada all√≠ (todav√≠a hay otras sobrecargas) Ejemplo: <br><br><img src="https://habrastorage.org/webt/-c/au/s4/-caus4cx0bkkkniwy66g8mpqi6k.png"><br><br>  Repetimos la colecci√≥n de anotaciones (por ejemplo, despu√©s de recibir del servidor) y agregamos una al mapa.  El m√©todo, por cierto, devuelve "placeMark" (etiqueta de lugar), que se puede utilizar para realizar configuraciones adicionales, por ejemplo, cambiar el orden de visualizaci√≥n a trav√©s de la propiedad zIndex. <br><br>  Aqu√≠, sin embargo, perd√≠ el punto de que antes de eso, sub√≠ a buscar un delegado y no lo encontr√© de manera segura y ni un solo delegado (de hecho, simplemente comenzaron a llamarse de manera diferente, ahora son oyentes).  S√© por experiencia previa con la ballena Apple y la vieja ballena Yandex que las anotaciones se reutilizan, al igual que con las celdas, pero solo hay addPlacemark en la demostraci√≥n.  A la pregunta sobre el plomo de las tarjetas Yandex (un peque√±o conocido personal ayud√≥ aqu√≠) "- ¬øC√≥mo optimizar el uso de memoria, reutilizar objetos?"  Respuesta: "Por qu√©, entonces funciona bien" ... bueno, m√°s o menos s√≠, funciona. <br><br>  Nota: 1) Es importante tener en cuenta que Yandex.Maps usa un mapkit y no lo desarrolla.  Esto lo hace el equipo de mapkit (el apodo de Nikolai en el centro: likhogrud @). <br><br>  2) Explicaci√≥n de por qu√© los objetos no se reutilizan: <br><br>  En la antigua ballena, annotationViews eran vistas, fueron creadas por el usuario y, por supuesto, las vistas deben reutilizarse, porque crearlas no es barato.  En la nueva ballena, el mapkit crea marcas de posici√≥n directamente en GL abierto.  Y tal vez se reutilizan all√≠, pero esto es inexacto.  En cualquier caso, esto es mucho m√°s eficiente que crear una vista. <br><br>  3) Desde el nuevo, por cierto, existe la posibilidad de modificar el icono de anotaci√≥n para el usuario.  Implementado de la siguiente manera: debe agregar un oyente (an√°logo del delegado), implementar el protocolo apropiado: 1 de 3 m√©todos, 2 simplemente dejar en blanco. <br><br>  Al mismo tiempo, vuelva a cargar la marca de posici√≥n con nuestros iconos. <br><br><img src="https://habrastorage.org/webt/yq/2t/cv/yq2tcvkmlgp6mxfh5hpppwqgmk4.png"><br><br>  Adem√°s, llamo su atenci√≥n sobre la propiedad del ancla.  Despu√©s de presionar el bot√≥n de ubicaci√≥n del usuario en el mapa, la c√°mara mueve el foco al centro de la ubicaci√≥n.  Pero el problema es que presionar la acci√≥n nuevamente no produce.  Que?  Comentamos sobre el m√©todo de anclaje y todo funciona. <br><br>  4) Ahora debe mostrar el texto destacado, respectivamente, para calcular el clic.  Hay varios m√©todos en las interfaces, el correcto es YMKMapObjectTapListener.  Hay 1 m√©todo interesante importante con el que tuve que atormentarme m√°s tarde, devuelve verdadero para no integrarse m√°s si se encuentra un suscriptor.  Le llamo la atenci√≥n, primero debe suscribirse, se suscribir√°n los mapObjects (l√≠nea 149). <br><br><img src="https://habrastorage.org/webt/ar/2j/gp/ar2jgphtrvt_or_szwtibdupw74.png"><br><br><img src="https://habrastorage.org/webt/9f/rw/zi/9frwzi06e8ur4pyrga4jhv7cyua.png"><br><br>  Entonces los clics se cumplen.  <b>¬°Hurra</b> !  A√∫n as√≠, sin embargo, hubo intentos de mostrar los pines solo en la zona visible, esto es superfluo, mostrar todo de una vez, as√≠ que vamos a dejarlo (solo porque no se ralentiza) <br><br>  5) Entonces quer√≠a hacer que los botones se acerquen / alejen para mayor comodidad.  Copie y pegue un poco por analog√≠a con el bot√≥n de ubicaci√≥n, y ya est√°. <br><br>  Adem√°s, dado que conocemos la c√°mara, utilice el m√©todo de movimiento y, en consecuencia, el zoom actual + - 1 o 0.5, seg√∫n lo necesite.  Todo est√° bien aqu√≠. <br><br><img src="https://habrastorage.org/webt/ar/_s/-p/ar_s-pit7r4wjzzbrbgyiylgm00.png"><br><br>  6) Pasamos a la funci√≥n principal: llamada (este es un rect√°ngulo con informaci√≥n adicional, con un tri√°ngulo en la parte inferior).  Resulta que no hay API ("intoxicante en el verano" - Yandex reconoci√≥ mi discurso cuando le√≠ las notas de un folleto para no escribir manualmente este art√≠culo). <br><br><img src="https://habrastorage.org/webt/ck/b3/ew/ckb3ewygj9uy3itbzrlq63wqtfk.png"><br><br>  Como estan chicos  100 500 aplicaciones usan una llamada. <br><br>  Escribimos bien en "soporte t√©cnico" (Kolya) c√≥mo hacer esto manualmente, descubr√≠.  Cuales son tus opciones? <br><br>  <s>Convierta la vista en una imagen, ya que no puede agregar directamente una vista</s> (agreg√≥ un archivo en 3.1), cambie el icono ... <br><br><img src="https://habrastorage.org/webt/tz/w2/qd/tzw2qdppbx86whmrgmqqzmhysge.png"><br><br>  Estas muletas se obtienen en un plano, parec√≠a lugar. <br>  De hecho, no muletas, por supuesto, sino simplemente la ausencia. Considero la funcionalidad b√°sica. <br><br>  7) Bien, primero agreguemos una llamada de prueba, como tal usamos un cuadrado rojo.  Entonces, al hacer clic en nuestro pin, se llama al m√©todo delegado / oyente, donde se transfieren el punto de clic y el objeto.  Sin esperar un truco, tomamos "punto" como el punto donde desea agregar la llamada.  (Atenci√≥n, ¬øtodo est√° hecho correctamente: "Hicieron clic, tomaron el punto, lo ataron?" Alrededor del 80% respondi√≥ correctamente, 20% - no) <br><br><img src="https://habrastorage.org/webt/9f/rw/zi/9frwzi06e8ur4pyrga4jhv7cyua.png"><br><br>  Y llame al m√©todo auxiliar showCallout en el cuerpo del m√©todo: <br><br><img src="https://habrastorage.org/webt/sq/aa/8w/sqaa8wmstqdunxobdbyr0xa0jg4.png"><br><br>  l√≠nea 544 <br>  En el interior, cree una vista de prueba del color rojo cuarenta por cuarenta, convi√©rtalo en una imagen, declare una constante x con un valor de 0.5, se usar√° para la posici√≥n del tri√°ngulo de llamada en el medio del punto.  Rechaz√≥ la idea de cambiar su posici√≥n, luego prefiri√≥ mover la c√°mara para que la llamada seleccionada se muestre en el centro de la pantalla del tel√©fono <br><br>  A continuaci√≥n, declaramos el √°rea de "inserci√≥n" de tappableArea, existe tal propiedad en el estilo de icono para el pin.  Bueno, puedes limitar la zona de clic, y lo haremos.  La zona var√≠a de 0.0 a 1.1.  necesitamos la parte inferior, donde supuestamente hay un bot√≥n que se transform√≥ en una imagen antes (recuerde).  Bien, esto significa la zona (0,0.5 - 1.1) ya que el bot√≥n est√° debajo. <br>  La restricci√≥n de zona funciona, pero hay un matiz que niega todo.  Si hay otro pin debajo del √°rea no presionada, entonces presionar funcionar√° en √©l.  El significado de esta √°rea?  ¬øHar√≠an una bandera o algo para que el clic no pase?  Esta bien ... <br><br>  L√≠nea 550 <br>  creemos un estilo para el icono, puede especificar inmediatamente la posici√≥n del ancla en el primer par√°metro, por ejemplo, lo hice a continuaci√≥n en la l√≠nea 557.  La posici√≥n y es 1.05 para elevar el tri√°ngulo sobre el pasador nuevamente verticalmente <br><br>  L√≠nea 559 <br>  cree nuestra llamada personalizada de cierto tama√±o, <br>  configuramos los campos que necesitamos utilizando la informaci√≥n de la anotaci√≥n seleccionada Anotaci√≥n seleccionada, en particular el t√≠tulo y el subt√≠tulo, la inscripci√≥n en el bot√≥n para esta llamada.  Entonces t√∫ mismo puedes hacer lo que quieras.  La anotaci√≥n seleccionada se define anteriormente en el delegado.  Pero por ahora, agregue el cuadrado rojo creado anteriormente <br>  A continuaci√≥n, agregue un pin a la colecci√≥n mapObjects, el m√©todo nos devolver√° la marca de posici√≥n agregada, gu√°rdela en una variable, <br>  Al hacer clic en la llamada en s√≠, se abre un controlador detallado, por lo que el matiz es que si debajo de la ventana emergente tambi√©n ingres√≥ otro pin, el delegado volver√° a funcionar, por lo que aqu√≠ debe cambiar el orden en la jerarqu√≠a a trav√©s de zIndex.  Establezca la visibilidad y mueva nuestra llamada al centro en la l√≠nea 564 <br><br>  <b>Matices</b> : la marca de posici√≥n variable es un puntero a la llamada. <br>  Al principio no lo tenemos, despu√©s de hacer clic en el pin, parece que, despu√©s de hacer clic en el siguiente pin, necesitamos eliminar nuestro primer texto destacado y agregar uno nuevo.  Por lo tanto, si la marca de posici√≥n variable! = Nil, debe eliminar la llamada anterior de la colecci√≥n mapObjects) <br><br><img src="https://habrastorage.org/webt/3r/fo/dg/3rfodg0siuahk0tsvk1qzyvydae.png"><br><br>  Adem√°s, en el caso de las tapas en la tarjeta, debe ocultar la llamada, por lo que en el m√©todo de delegado asignamos una marca de posici√≥n, el observador funciona, la llamada se elimina, y borramos la anotaci√≥n seleccionada <br><br>  Para esto, nos registramos en YMKMapInputListener anteriormente <br><br><img src="https://habrastorage.org/webt/ew/f-/a2/ewf-a2uvc7khz8okkxw-s6etxds.png"><br><br>  <s>A su vez, el m√©todo para convertir vistas es el siguiente.</s>  (En la versi√≥n 3.1, se agreg√≥ la capacidad de agregar vistas al mapa) <br>  No describo c√≥mo hacer la vista), pero si habr√° muchos problemas (es posible con un tri√°ngulo) con esto, entonces escriba, agregar√© esta etapa <br><br><img src="https://habrastorage.org/webt/v1/mx/nk/v1mxnkmtkahrp5j6umoevtwadlc.png"><br><br>  La magia 20 agregada a la altura es necesaria para un lugar debajo del tri√°ngulo a continuaci√≥n, que deber√° dibujar <br><br>  Tambi√©n queremos que la ventana emergente aparezca (se adjunte) al pin en un lugar espec√≠fico (izquierda, derecha, en el medio), para esto hay una propiedad de anclaje.  Definido de la siguiente manera: <br>  Dividimos el √°rea visible del mapa en 3 zonas verticales y determinamos en cu√°l estamos, dependiendo de esto, cambiamos la posici√≥n del enlace.  En el ejemplo de c√≥digo, verificamos si estamos en el lado izquierdo, por analog√≠a lo hacemos para el medio, si no para el izquierdo y no para el medio, respectivamente, el punto a la derecha es <br><br><img src="https://habrastorage.org/webt/o-/xq/ii/o-xqiijbnowv2clav2ny2tl5drc.png"><br><br>  Una funci√≥n auxiliar para verificar si un punto cae en una regi√≥n: <br><br><img src="https://habrastorage.org/webt/dr/os/5e/dros5emmil06hsac_h-rdbwk_jq.png"><br><br>  Inicio.  Funciona  Pero hay un matiz, parece que estamos tratando de hacer zoom, uno, dos, tres, y la llamada se aleja del pin.  Que?  Como? <br><br><img src="https://habrastorage.org/webt/9v/il/7f/9vil7fru-hbitdlkvqtu6oeyhnw.gif"><br><br>  7) Comenzamos a depurar, las coordenadas son las mismas <br><br><img src="https://habrastorage.org/webt/tt/t1/u1/ttt1u1jgezg-_ld3n_ksj-e_m90.png"><br><br>  Luego hubo intentos de comprender qu√© est√° sucediendo y c√≥mo funciona, otro regreso a la demostraci√≥n, una b√∫squeda a√∫n m√°s atenta de las diferencias ... <br><br><img src="https://habrastorage.org/webt/oc/nb/d_/ocnbd_n89jitplbg4_dtukbnvlo.jpeg"><br><br>  Me doy cuenta de que las coordenadas se transmiten directamente, ¬°y no la que est√° tocando!  Pero debat√≠, est√° claro que las coordenadas son las mismas, es decir, el c√≠rculo y el cuadrado tienen la misma coordenada. <br>  Es por eso que en el m√©todo no acced√≠ inmediatamente al objeto, sino al punto pasado, que es incorrecto. <br><br><img src="https://habrastorage.org/webt/9f/rw/zi/9frwzi06e8ur4pyrga4jhv7cyua.png"><br><br>  Pero, ¬ønecesita lanzar un objeto, tomar una propiedad (en todas partes todo se llama de manera diferente, luego coordinar, luego se√±alar, aqu√≠ ahora la geometr√≠a) ¬øes esto tan creativo o qu√©?  493 l√≠neas <br><br><img src="https://habrastorage.org/webt/_u/oo/5h/_uoo5hjrg5okyoodbijb7s0rzzo.png"><br><br>  Dado que necesitamos procesar dos opciones de presi√≥n: la primera para anclar, la segunda para llamar y no procesar clics si volvemos a hacer clic en el mismo pin, lo <b>primero</b> que hacemos es encontrar el pin en el que hicimos clic en la colecci√≥n de pin, comparando coordina la l√≠nea 495, de lo contrario, devuelve verdadero, lo que indica que procesamos el clic y no es necesario ir m√°s all√° en la jerarqu√≠a <br><br>  <b>Segundo</b> : lo determinamos haciendo clic en el pin o en la llamada, tambi√©n compararemos las coordenadas de las etiquetas de la l√≠nea 499.  Prueba de igualdad: <br><br><img src="https://habrastorage.org/webt/xd/z5/lk/xdz5lkm2g-zehkggfea6rqdxkfa.png"><br><br>  <b>Adem√°s,</b> si se trata de una llamada y queremos responder a un clic en el bot√≥n (o simular, ya que ahora es una imagen), y no a toda el √°rea, entonces tenemos que hacer algunos c√°lculos con bol√≠grafos :) <br><br><ol><li>  Convierta la coordenada mundial a la l√≠nea de la pantalla 501 <br>  Nos consideramos: convertiremos las coordenadas del mapa a la pantalla, sabemos d√≥nde estamos ubicados, luego agregando el ancho y la altura de la vista, obtenemos los puntos de las esquinas, pero por alguna raz√≥n no coinciden y los multipliqu√© manualmente por tres, en mi caso para el d√©cimo iPhone).  Como result√≥ m√°s tarde, olvid√© y no tom√© en cuenta la cantidad de p√≠xeles por punto.  Que podemos tener 1x, (un punto 1 p√≠xel), 2x, 3x un punto es tres p√≠xeles. </li><li>  Calculemos la altura del bot√≥n: la altura de la llamada + la altura del tri√°ngulo multiplicado por la escala, informaci√≥n sobre la escala (l√≠nea 498).  Luego, dividimos todo esto en dos, ya que la altura del bot√≥n es la mitad de la altura de la llamada </li><li>  Luego calculamos las coordenadas de los √°ngulos, en funci√≥n del hecho de que el ancla (x: 0.5, y: 1), dada la escala y el √°rea del tri√°ngulo) </li><li>  Luego convierta estas coordenadas de pantalla a mundo </li><li>  Crear un √°rea visible basada en ellos, es una zona de botones </li><li>  Y verificamos si presionamos la zona del bot√≥n o no.  Si presiona, verifique el tipo de anotaci√≥n, dependiendo del tipo que llamemos a nuestro m√©todo: vaya a la pantalla detallada o seleccione esta tienda para la entrega en casos con StorePoint </li></ol><br>  De lo contrario, es un clic en el pin y necesitamos agregar un texto destacado, lo que en realidad hicimos anteriormente. <br><br>  Eso es todo, en este conocimiento inicial de la nueva ballena ha terminado. <br><br>  <s>Qu√© m√°s quiero decir, en la implementaci√≥n actual de los mapas de mapkit, contiene una gran cantidad de funcionalidades que no se utilizan, esto tambi√©n afecta el tama√±o del binario resultante.</s>  <s>¬øEst√°s listo para tales sacrificios? En el futuro, los chicos deber√≠an ser demolidos en m√≥dulos despu√©s de todo</s> .  Tambi√©n escuch√© de colegas en el androide del taller que hay problemas de compatibilidad con Kotlin. <br><br>  P.S.  Si bien decid√≠ y comenc√© a escribir un art√≠culo, sali√≥ la actualizaci√≥n 3.1, donde a partir de los problemas anteriores se resolvieron e implementaron: <br><br>  Agregado <br><br>  Para Android, aparecieron las compilaciones arm64 y x86. <br>  <b>Puede agregar cualquier objeto Ver al mapa.</b> <b><br></b>  Enrutamiento de bicicletas ha aparecido. <br>  Se agregaron anotaciones anulables para Android. <br><br>  Cambiado <br><br>  <b>MapKit se divide en partes:</b> <b><br></b>  MapKit: solo un mapa; <br>  Direcciones de MapKit: ruta del autom√≥vil; <br>  Transporte MapKit: enrutamiento peatonal, enrutamiento de transporte p√∫blico y en bicicleta; <br>  B√∫squeda de MapKit: b√∫squeda y geocodificaci√≥n; <br>  MapKit Places - panoramas. <br>  Para iOS, las anotaciones anulables se han vuelto m√°s estrictas. <br><br>  Fijo <br><br>  Se han corregido varios errores. <br>  Rendimiento mejorado. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tech.yandex.ru/maps/doc/mapkit/3.x/concepts/versions-docpage</a> <br><br>  <b>Escribe tus comentarios, preguntas.</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es427611/">https://habr.com/ru/post/es427611/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es427601/index.html">Caso 5 + 1 donde la especificaci√≥n REST API juega un papel muy importante</a></li>
<li><a href="../es427603/index.html">C√≥mo finalmente comenzar a escribir pruebas y no arrepentirse</a></li>
<li><a href="../es427605/index.html">C√≥mo la plataforma de crowdsourcing de Yandex ayuda a entrenar drones y evaluar la calidad del servicio</a></li>
<li><a href="../es427607/index.html">Datacenter en Suiza: trabajar como un reloj</a></li>
<li><a href="../es427609/index.html">Resolviendo la ecuaci√≥n con divisi√≥n entera sin fuerza bruta</a></li>
<li><a href="../es427613/index.html">10 blogs √∫tiles para programadores en ingl√©s</a></li>
<li><a href="../es427615/index.html">Deja de hacer sitios de desplazamiento sin fin«É</a></li>
<li><a href="../es427617/index.html">Evoluci√≥n del vag√≥n de ferrocarril</a></li>
<li><a href="../es427623/index.html">3 libros sobre C ++ 17 (en ingl√©s)</a></li>
<li><a href="../es427625/index.html">C√≥mo escribir un esc√°ner de vulnerabilidades y ganar dinero con exploits</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>