<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚Äçüè≠ üë©üèΩ üë®‚Äç‚öïÔ∏è Un autre appareil domestique intelligent ü§ô üß¶ üò©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Entr√©e 
 √âtant engag√© dans la domotique depuis trois ans, j'essaie de garder une trace de tous les nouveaux appareils dans ce domaine. R√©cemment, l'ex...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Un autre appareil domestique intelligent</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/410597/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/b8/7e/rp/b87erppacywqripfkc5as0cvpxu.png"></div><br><h3>  Entr√©e </h3><br>  √âtant engag√© dans la domotique depuis trois ans, j'essaie de garder une trace de tous les nouveaux appareils dans ce domaine.  R√©cemment, l'exposition a attir√© l'attention d'un nouveau dispositif de production nationale.  Apr√®s avoir cherch√© sur Internet, je n'ai trouv√© aucune information √† leur sujet.  J'ai pens√© bizarrement et j'ai d√©cid√© de contacter le fabricant (je ne le signalerai pas).  Apr√®s avoir parl√©, j'ai r√©ussi √† obtenir un √©chantillon de test pendant un mois.  Un mois plus tard, j'ai d√©cid√© de partager mes impressions sur ce produit. <br><br><h3>  Description du fabricant </h3><br>  Selon le fabricant, l'appareil √† l'√©tude est une plate-forme qui vous permet de cr√©er des syst√®mes automatis√©s de surveillance et de gestion des infrastructures.  La plate-forme vous permet de d√©velopper des syst√®mes centralis√©s et distribu√©s, y compris la connexion de tous les appareils intelligents, et les fonctionnalit√©s du syst√®me sont d√©termin√©es par le logiciel install√©. <br><br>  Le fabricant d√©clare les caract√©ristiques suivantes de l'appareil: <br><a name="habracut"></a><table><tbody><tr><td>  CPU </td><td>  ‚Ä¢ Processeur: Allwinner H5 Ôºå Quad-core 64 bits Cortex A53 <br>  ‚Ä¢ RAM: 1 Go <br>  ‚Ä¢ Stockage: eMMC 8 Go, carte MicroSD </td></tr><tr><td>  Syst√®me d'exploitation </td><td>  ‚Ä¢ Linux Debian ou Ubuntu </td></tr><tr><td>  Les communications </td><td>  ‚Ä¢ R√©seau: Ethernet Gbps <br>  ‚Ä¢ WiFi: 802.11b / g / n <br>  ‚Ä¢ Bluetooth: 4.0 double mode <br>  ‚Ä¢ Radio: 2,4 GHz <br>  ‚Ä¢ 2 x h√¥tes USB <br>  ‚Ä¢ 1 x RS485 </td></tr><tr><td>  Ports d'entr√©e / sortie </td><td>  ‚Ä¢ 4 contacts "secs" 350 v / 120mA <br>  ‚Ä¢ 4 sorties 12 v / 1A <br>  ‚Ä¢ 4 entr√©es 0 - 12 v </td></tr><tr><td>  Indication d'√©tat </td><td>  ‚Ä¢ √âcran OLED <br>  ‚Ä¢ LED </td></tr><tr><td>  La nutrition </td><td>  ‚Ä¢ DC 12 v </td></tr></tbody></table><br><h3>  Nous pr√©parons le client <br></h3><br>  L'appareil est disponible en deux versions: juste du m√©tal nu et une solution pr√™te √† l'emploi avec un logiciel.  J'ai eu la premi√®re option, mais encore plus int√©ressante - il y a o√π gambader la fantaisie. <br><br>  L'apparence de l'appareil est assez asc√©tique: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b8/7e/rp/b87erppacywqripfkc5as0cvpxu.png"></div><br>  Le bo√Ætier de l'appareil permet le montage dans une armoire sur un rail DIN et occupe quatre modules de largeur. <br><br>  Sur le panneau avant: <br><br><ul><li>  affichage </li><li>  quatre boutons; </li><li>  Indicateur LED de l'√©tat de l'appareil (¬´rouge¬ª - d√©sactiv√©, ¬´vert¬ª - l'alimentation est fournie, ¬´bleu¬ª - indique l'activit√© du processeur); </li></ul><br>  Sous les couvertures se trouvent: <br><br><ul><li>  Connecteurs E / S (√† premi√®re vue il me semblait que leur nombre √©tait peut-√™tre insuffisant, mais je commenterai ce moment un peu plus bas); </li><li>  Interface RS485 </li><li>  connexion √©lectrique. </li></ul><br>  Tous les connecteurs sont viss√©s, ce qui m'a fait plaisir car je n'aime pas le serrage.  Il n'y a pas de connecteurs et de commandes sur le c√¥t√© droit de la bo√Æte, ce qui peut g√©n√©ralement √™tre utile pour une installation plus serr√©e de l'√©quipement dans l'armoire. <br><br>  Tous les connecteurs sont assembl√©s sur le c√¥t√© gauche: <br><br><ul><li>  antenne WiFi amovible; </li><li>  2 USB; </li><li>  1 Eth </li><li>  prise audio. </li></ul><br>  L'antenne WiFi interf√®re avec la connexion des p√©riph√©riques USB et du c√¢ble r√©seau.  Elle doit √™tre soit baiss√©e, soit amen√©e √† l'avant de l'armoire avec un c√¢ble, la deuxi√®me option est probablement plus correcte, am√©liorant ainsi le niveau du signal. <br><br>  On proc√®de √† "l'ouverture du patient" (l'ensemble du bo√Ætier est mont√© sur des loquets, il n'est pas difficile de le d√©monter) et on voit de quoi il s'agit √† l'int√©rieur / Ouvrez le capot avant et voyez: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ka/j4/d4/kaj4d4omm3_z-78fnhmpqiv5ws4.png"></div><br><ul><li>  √âcran OLED SSD1306 (128x64px): l'√©cran est certes petit, mais vous pouvez obtenir un minimum d'informations; </li><li>  Quatre boutons pour le contr√¥le local de l'appareil, √† en juger par la d√©signation, pour contr√¥ler la sortie d'informations sur l'√©cran; </li><li>  Bouton de gestion de l'alimentation (comme ATtiny13 l'a compris plus tard pour la gestion de l'alimentation); </li><li>  LED RGB </li><li>  Sous l'inscription se trouve l'antenne du module radio. </li></ul><br>  Nous allons plus loin - ouvrir le bo√Ætier et voir que l'appareil se compose de trois cartes: la carte principale, la carte processeur y est attach√©e et la carte "sup√©rieure", dont la face avant est d√©crite ci-dessus, est reli√©e par un c√¢ble.  Nous les examinons de plus pr√®s: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lt/ty/hz/lttyhznbz7tcf5yn8dzppnqxjtc.png"></div><br><br><ul><li>  Le module processeur est un ordinateur monocarte NanoPi NEO Plus2.  Pas trop excit√© OBC, mais tr√®s int√©ressant d'un point de vue technique.  Vous pouvez en lire plus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gp/3p/x-/gp3px-m9pebjgkevd2dnqi-fsbm.png"></div><br>  Sur la carte principale se trouve: <br><br><ul><li>  Protection contre l'inversion de polarit√© (nous avons pens√© √† la ¬´protection contre les imb√©ciles¬ª d√©j√† pas mal); </li><li>  Le convertisseur DC-DC du XL4005E1 5A, heureux de ne pas avoir s√©journ√© sur la puissante diode Schottky (12A), mais la bobine est enroul√©e avec un fil mince - 3A tirera, mais je ne le chargerais plus, les polygones de refroidissement du convertisseur sont faits √† l'arri√®re de la carte, ce qui ajoute de la confiance dans le travail (le convertisseur d'ATtiny13 est contr√¥l√©); </li><li>  Le reste des d√©tails est inclus dans les sch√©mas standard: le r√©gulateur de tension AMS 1117 pour 3,3 v, le prolongateur MCP23017, le SP3485 pour organiser l'interface RS485, l'ADC 16 bits ADS1115, la pr√©sence du capteur de pression atmosph√©rique BMP180 agr√©ablement surpris. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qk/iw/r_/qkiwr_vhzvpuc6l9aii7ovcb6u0.png"></div><br>  Sur le verso de la carte ¬´sup√©rieure¬ª sont install√©s: <br><br><ul><li>  Module RTC DS3231; </li><li>  Extension de port PCF8574 responsable du traitement des clics sur les boutons; </li><li>  Module radio nRF24L01P avec amplificateur. </li></ul><br><h3>  Utilisation et programmation </h3><br>  Comme je l'ai d√©j√† dit, j'ai obtenu du bare metal et j'ai d√ª v√©rifier le fonctionnement des modules et cr√©er moi-m√™me des scripts.  Il n'a pas philosophe, Armbian a pris l'assemblage Linux et a fait toute la programmation en Python - rapide, bon march√© et joyeux!  Tous les microcircuits sont bien connus d'un large √©ventail de passionn√©s de radioamateurs; trouver une description et des m√©thodes de base d'utilisation ne sera pas difficile. <br><br>  Apr√®s avoir √©tudi√© l'appareil, une liste approximative des t√¢ches a √©t√© form√©e: <br><br><ol><li>  Connectez les contacteurs 220v via les sorties des contacts ¬´secs¬ª.  (Obtenez des lignes √©lectriques contr√¥lables) </li><li>  √Ä deux sorties 12v / 1A et deux entr√©es connectent des capteurs de s√©curit√© et d'incendie standard.  (Obtenez un syst√®me de s√©curit√© et d'incendie, sans acc√®s √† la t√©l√©commande, mais ce n'est souvent pas n√©cessaire). </li><li>  Connectez-vous aux entr√©es et sorties libres, aux capteurs de fuite et aux vannes √† boisseau sph√©rique avec entra√Ænement √©lectrique 12 v.  (Obtenez une protection contre les fuites). </li><li>  Relevez le serveur WEB et √©crivez une interface de gestion (Get remote control). </li><li>  V√©rifiez la connexion via radio, WiFi et RS485 d'appareils suppl√©mentaires (V√©rifiez la possibilit√© de construire un r√©seau distribu√©). </li><li>  V√©rifiez le fonctionnement du modem USB. </li><li>  V√©rifiez le fonctionnement en tant que routeur. </li></ol><br><img src="https://habrastorage.org/webt/zc/za/cu/zczacu4t1wrx2kogetbvn3kx53u.png"><br><br>  Pour les tests, j'ai rapidement mont√© un stand et commenc√© √† m'amuser: <br><br>  ATtiny13 a d√©j√† √©t√© programm√©, je ne l'ai pas touch√©, laissez-le se charger de l'alimentation selon le plan du constructeur. <br><br>  MCP23017, ADS1115, PCF8574, DS3231, BMP180 - tout cela fonctionne selon I2C, donc la compr√©hension du fonctionnement de ce bus d√©termine imm√©diatement environ 80% du code.  Tout a d√©marr√© (comme pr√©vu), puisque l'adressage des appareils a d√©j√† √©t√© r√©gl√© par le constructeur. <br><br>  nRF24L01P fonctionne sur le bus SPI, dont des exemples sont √©galement suffisants.  J'ai contact√© une paire d'appareils sur Arduino, tout fonctionne comme pr√©vu. <br><br>  Le RS485 a √©t√© test√© sur le protocole Modbus avec un wattm√®tre Eastron SDM220.  Des lectures sont prises, aucune surprise n'est survenue. <br><br>  La prise USB du modem Huawei E1550 a tout d√©termin√©, a pris le client vpn et a contact√© le serveur domestique.  Install√© un serveur web et jou√© avec t√©l√©commande. <br><br>  Le module WiFi fonctionne √† la fois en mode client et en mode point d'acc√®s.  Il a mis le module en mode AP, install√© un serveur DHCP, configur√© des iptables et re√ßu un routeur WiFi. <br><br>  L'installation d'un serveur Blynk local n'a pas caus√© de probl√®mes.  Travail v√©rifi√© avec ESP8266.  Le contr√¥le du smartphone fonctionne, les lectures sont affich√©es. <br><br>  Ainsi, toutes les t√¢ches sont termin√©es, le dispositif central de la maison intelligente est lanc√©!  Il peut sembler que tout est programm√©, configur√© facilement et simplement, ou je suis un g√©nie. <br><br>  Je vous assure que ce n'est pas le cas!  J'ai d√©j√† rencontr√© la plupart des microcircuits et des modules, donc je suis mont√© sur un r√¢teau plus t√¥t et mon front me faisait tr√®s mal ÔÅä, mais les bosses sont pass√©es, mais les connaissances sont rest√©es! <br><br>  La puissance du module processeur est plus que suffisante pour r√©soudre mes t√¢ches, lors des tests la charge moyenne sur le processeur n'a pas d√©pass√© 15%.  La pr√©sence de m√©moire eMMC et de cartes MicroSD permettra la duplication des OS et des logiciels.  La consommation sans connexion de p√©riph√©riques USB est d'environ 300 mA.  Avec ce type de consommation, il ne sera pas difficile d'organiser une alimentation sans interruption √† partir d'une batterie d'heures pour 5 travaux. <br><br>  La base d'√©l√©ment s√©lectionn√©e pour la construction de p√©riph√©riques est assez fiable, ce qui donne confiance en un fonctionnement sans probl√®me de l'appareil en mode 24x7. <br><br>  La pr√©sence d'un petit nombre d'entr√©es et de sorties sur l'appareil lui-m√™me est enti√®rement compens√©e par la pr√©sence d'un bus 485 et d'un module radio, c'est-√†-dire que la construction d'un syst√®me de contr√¥le distribu√© ne sera pas tr√®s difficile, et l'ensemble des entr√©es et sorties qui sont √† bord peut √™tre utilis√© pour le contr√¥le local dans l'armoire √©lectrique. <br><br><h3>  Conclusions </h3><br>  Cet appareil, d√©clar√© par le constructeur, int√©grera-t-il tous les appareils intelligents?  Avec un √©tirement, vous pouvez dire que ce sera le cas.  Mais malheureusement, il n'y a pas assez de module radio pour 433 MHz, bus CAN, prise en charge de ZigBee, mais la pr√©sence de RS485, de module radio √† 2,4 GHz et de WiFi permettra de connecter un nombre suffisant d'appareils, et des protocoles de communication peuvent √™tre impl√©ment√©s dans le logiciel. <br><br>  Je le r√©p√®te, l'appareil en question est fabriqu√© en deux versions: une solution enti√®rement pr√™te √† l'emploi pour la construction d'un syst√®me de contr√¥le distribu√© et uniquement du mat√©riel.  √Ä mon avis, une solution toute faite ne peut √™tre achet√©e que si vous ne voulez pas g√©rer la programmation et la paresse.  Dans d'autres cas, il est beaucoup plus int√©ressant de prendre la plateforme et de la programmer par vous-m√™me. <br><br>  Le co√ªt de l'appareil m'est actuellement inconnu.  √Ä mon avis, si le constructeur ne conduit pas le prix de plus de 13 tr.  pour la version "nue", alors cet appareil est assez int√©ressant √† acheter.  Apr√®s avoir achet√© toutes les pi√®ces en Chine et les avoir mises dans un seul emballage, il est peu probable que vous obteniez moins cher. <br><br>  Un concurrent peut √™tre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Wiren Board 5</a> .  Il gagne en nombre de ports et d'interfaces possibles, mais perd en puissance du module processeur.  Cela n'affecte pas les t√¢ches standard, mais l'installation d'un serveur Blynk localement ou la cr√©ation d'un module de commande vocale peut √™tre probl√©matique.  Si quelqu'un a essay√© de le faire sur WB5, veuillez commenter dans les commentaires. <br><br>  <b>PS:</b> Ayant d√©j√† termin√© l'article, j'ai √©galement trouv√© la puce de cryptographie ATSHA204 sur la carte.  Il prend en charge l'algorithme cryptographique SHA-256 et est id√©al pour les t√¢ches d'authentification sym√©trique.  Eh bien, c'est absolument pour les Geeks! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr410597/">https://habr.com/ru/post/fr410597/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr410585/index.html">Comment devenir magicien (partie 1)</a></li>
<li><a href="../fr410587/index.html">Apple a l'intention d'acheter du cobalt exclusivement aupr√®s de soci√©t√©s mini√®res</a></li>
<li><a href="../fr410589/index.html">Des √©cosyst√®mes marins capables de s'adapter au r√©chauffement climatique</a></li>
<li><a href="../fr410591/index.html">L'histoire √©motionnelle des processeurs pour les premiers ordinateurs des ann√©es 70 au d√©but des ann√©es 90</a></li>
<li><a href="../fr410593/index.html">Telegram m√®ne une nouvelle s√©rie d'ICO</a></li>
<li><a href="../fr410599/index.html">Une vague de vols d'√©quipement dans les exploitations mini√®res a balay√© l'Islande</a></li>
<li><a href="../fr410601/index.html">Qu'est-ce que la robotique √©ducative aujourd'hui</a></li>
<li><a href="../fr410603/index.html">Manifeste de biens√©ance</a></li>
<li><a href="../fr410605/index.html">Un astronome amateur a test√© un nouvel appareil photo et a accidentellement photographi√© une supernova</a></li>
<li><a href="../fr410607/index.html">SpaceX continue de fonctionner: les deux premiers satellites du r√©seau Internet sans fil mondial et la chasse aux car√©nages</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>