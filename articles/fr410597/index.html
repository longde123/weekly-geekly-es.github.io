<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏻‍🏭 👩🏽 👨‍⚕️ Un autre appareil domestique intelligent 🤙 🧦 😩</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Entrée 
 Étant engagé dans la domotique depuis trois ans, j'essaie de garder une trace de tous les nouveaux appareils dans ce domaine. Récemment, l'ex...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Un autre appareil domestique intelligent</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/410597/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/b8/7e/rp/b87erppacywqripfkc5as0cvpxu.png"></div><br><h3>  Entrée </h3><br>  Étant engagé dans la domotique depuis trois ans, j'essaie de garder une trace de tous les nouveaux appareils dans ce domaine.  Récemment, l'exposition a attiré l'attention d'un nouveau dispositif de production nationale.  Après avoir cherché sur Internet, je n'ai trouvé aucune information à leur sujet.  J'ai pensé bizarrement et j'ai décidé de contacter le fabricant (je ne le signalerai pas).  Après avoir parlé, j'ai réussi à obtenir un échantillon de test pendant un mois.  Un mois plus tard, j'ai décidé de partager mes impressions sur ce produit. <br><br><h3>  Description du fabricant </h3><br>  Selon le fabricant, l'appareil à l'étude est une plate-forme qui vous permet de créer des systèmes automatisés de surveillance et de gestion des infrastructures.  La plate-forme vous permet de développer des systèmes centralisés et distribués, y compris la connexion de tous les appareils intelligents, et les fonctionnalités du système sont déterminées par le logiciel installé. <br><br>  Le fabricant déclare les caractéristiques suivantes de l'appareil: <br><a name="habracut"></a><table><tbody><tr><td>  CPU </td><td>  • Processeur: Allwinner H5 ， Quad-core 64 bits Cortex A53 <br>  • RAM: 1 Go <br>  • Stockage: eMMC 8 Go, carte MicroSD </td></tr><tr><td>  Système d'exploitation </td><td>  • Linux Debian ou Ubuntu </td></tr><tr><td>  Les communications </td><td>  • Réseau: Ethernet Gbps <br>  • WiFi: 802.11b / g / n <br>  • Bluetooth: 4.0 double mode <br>  • Radio: 2,4 GHz <br>  • 2 x hôtes USB <br>  • 1 x RS485 </td></tr><tr><td>  Ports d'entrée / sortie </td><td>  • 4 contacts "secs" 350 v / 120mA <br>  • 4 sorties 12 v / 1A <br>  • 4 entrées 0 - 12 v </td></tr><tr><td>  Indication d'état </td><td>  • Écran OLED <br>  • LED </td></tr><tr><td>  La nutrition </td><td>  • DC 12 v </td></tr></tbody></table><br><h3>  Nous préparons le client <br></h3><br>  L'appareil est disponible en deux versions: juste du métal nu et une solution prête à l'emploi avec un logiciel.  J'ai eu la première option, mais encore plus intéressante - il y a où gambader la fantaisie. <br><br>  L'apparence de l'appareil est assez ascétique: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b8/7e/rp/b87erppacywqripfkc5as0cvpxu.png"></div><br>  Le boîtier de l'appareil permet le montage dans une armoire sur un rail DIN et occupe quatre modules de largeur. <br><br>  Sur le panneau avant: <br><br><ul><li>  affichage </li><li>  quatre boutons; </li><li>  Indicateur LED de l'état de l'appareil («rouge» - désactivé, «vert» - l'alimentation est fournie, «bleu» - indique l'activité du processeur); </li></ul><br>  Sous les couvertures se trouvent: <br><br><ul><li>  Connecteurs E / S (à première vue il me semblait que leur nombre était peut-être insuffisant, mais je commenterai ce moment un peu plus bas); </li><li>  Interface RS485 </li><li>  connexion électrique. </li></ul><br>  Tous les connecteurs sont vissés, ce qui m'a fait plaisir car je n'aime pas le serrage.  Il n'y a pas de connecteurs et de commandes sur le côté droit de la boîte, ce qui peut généralement être utile pour une installation plus serrée de l'équipement dans l'armoire. <br><br>  Tous les connecteurs sont assemblés sur le côté gauche: <br><br><ul><li>  antenne WiFi amovible; </li><li>  2 USB; </li><li>  1 Eth </li><li>  prise audio. </li></ul><br>  L'antenne WiFi interfère avec la connexion des périphériques USB et du câble réseau.  Elle doit être soit baissée, soit amenée à l'avant de l'armoire avec un câble, la deuxième option est probablement plus correcte, améliorant ainsi le niveau du signal. <br><br>  On procède à "l'ouverture du patient" (l'ensemble du boîtier est monté sur des loquets, il n'est pas difficile de le démonter) et on voit de quoi il s'agit à l'intérieur / Ouvrez le capot avant et voyez: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ka/j4/d4/kaj4d4omm3_z-78fnhmpqiv5ws4.png"></div><br><ul><li>  Écran OLED SSD1306 (128x64px): l'écran est certes petit, mais vous pouvez obtenir un minimum d'informations; </li><li>  Quatre boutons pour le contrôle local de l'appareil, à en juger par la désignation, pour contrôler la sortie d'informations sur l'écran; </li><li>  Bouton de gestion de l'alimentation (comme ATtiny13 l'a compris plus tard pour la gestion de l'alimentation); </li><li>  LED RGB </li><li>  Sous l'inscription se trouve l'antenne du module radio. </li></ul><br>  Nous allons plus loin - ouvrir le boîtier et voir que l'appareil se compose de trois cartes: la carte principale, la carte processeur y est attachée et la carte "supérieure", dont la face avant est décrite ci-dessus, est reliée par un câble.  Nous les examinons de plus près: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lt/ty/hz/lttyhznbz7tcf5yn8dzppnqxjtc.png"></div><br><br><ul><li>  Le module processeur est un ordinateur monocarte NanoPi NEO Plus2.  Pas trop excité OBC, mais très intéressant d'un point de vue technique.  Vous pouvez en lire plus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gp/3p/x-/gp3px-m9pebjgkevd2dnqi-fsbm.png"></div><br>  Sur la carte principale se trouve: <br><br><ul><li>  Protection contre l'inversion de polarité (nous avons pensé à la «protection contre les imbéciles» déjà pas mal); </li><li>  Le convertisseur DC-DC du XL4005E1 5A, heureux de ne pas avoir séjourné sur la puissante diode Schottky (12A), mais la bobine est enroulée avec un fil mince - 3A tirera, mais je ne le chargerais plus, les polygones de refroidissement du convertisseur sont faits à l'arrière de la carte, ce qui ajoute de la confiance dans le travail (le convertisseur d'ATtiny13 est contrôlé); </li><li>  Le reste des détails est inclus dans les schémas standard: le régulateur de tension AMS 1117 pour 3,3 v, le prolongateur MCP23017, le SP3485 pour organiser l'interface RS485, l'ADC 16 bits ADS1115, la présence du capteur de pression atmosphérique BMP180 agréablement surpris. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qk/iw/r_/qkiwr_vhzvpuc6l9aii7ovcb6u0.png"></div><br>  Sur le verso de la carte «supérieure» sont installés: <br><br><ul><li>  Module RTC DS3231; </li><li>  Extension de port PCF8574 responsable du traitement des clics sur les boutons; </li><li>  Module radio nRF24L01P avec amplificateur. </li></ul><br><h3>  Utilisation et programmation </h3><br>  Comme je l'ai déjà dit, j'ai obtenu du bare metal et j'ai dû vérifier le fonctionnement des modules et créer moi-même des scripts.  Il n'a pas philosophe, Armbian a pris l'assemblage Linux et a fait toute la programmation en Python - rapide, bon marché et joyeux!  Tous les microcircuits sont bien connus d'un large éventail de passionnés de radioamateurs; trouver une description et des méthodes de base d'utilisation ne sera pas difficile. <br><br>  Après avoir étudié l'appareil, une liste approximative des tâches a été formée: <br><br><ol><li>  Connectez les contacteurs 220v via les sorties des contacts «secs».  (Obtenez des lignes électriques contrôlables) </li><li>  À deux sorties 12v / 1A et deux entrées connectent des capteurs de sécurité et d'incendie standard.  (Obtenez un système de sécurité et d'incendie, sans accès à la télécommande, mais ce n'est souvent pas nécessaire). </li><li>  Connectez-vous aux entrées et sorties libres, aux capteurs de fuite et aux vannes à boisseau sphérique avec entraînement électrique 12 v.  (Obtenez une protection contre les fuites). </li><li>  Relevez le serveur WEB et écrivez une interface de gestion (Get remote control). </li><li>  Vérifiez la connexion via radio, WiFi et RS485 d'appareils supplémentaires (Vérifiez la possibilité de construire un réseau distribué). </li><li>  Vérifiez le fonctionnement du modem USB. </li><li>  Vérifiez le fonctionnement en tant que routeur. </li></ol><br><img src="https://habrastorage.org/webt/zc/za/cu/zczacu4t1wrx2kogetbvn3kx53u.png"><br><br>  Pour les tests, j'ai rapidement monté un stand et commencé à m'amuser: <br><br>  ATtiny13 a déjà été programmé, je ne l'ai pas touché, laissez-le se charger de l'alimentation selon le plan du constructeur. <br><br>  MCP23017, ADS1115, PCF8574, DS3231, BMP180 - tout cela fonctionne selon I2C, donc la compréhension du fonctionnement de ce bus détermine immédiatement environ 80% du code.  Tout a démarré (comme prévu), puisque l'adressage des appareils a déjà été réglé par le constructeur. <br><br>  nRF24L01P fonctionne sur le bus SPI, dont des exemples sont également suffisants.  J'ai contacté une paire d'appareils sur Arduino, tout fonctionne comme prévu. <br><br>  Le RS485 a été testé sur le protocole Modbus avec un wattmètre Eastron SDM220.  Des lectures sont prises, aucune surprise n'est survenue. <br><br>  La prise USB du modem Huawei E1550 a tout déterminé, a pris le client vpn et a contacté le serveur domestique.  Installé un serveur web et joué avec télécommande. <br><br>  Le module WiFi fonctionne à la fois en mode client et en mode point d'accès.  Il a mis le module en mode AP, installé un serveur DHCP, configuré des iptables et reçu un routeur WiFi. <br><br>  L'installation d'un serveur Blynk local n'a pas causé de problèmes.  Travail vérifié avec ESP8266.  Le contrôle du smartphone fonctionne, les lectures sont affichées. <br><br>  Ainsi, toutes les tâches sont terminées, le dispositif central de la maison intelligente est lancé!  Il peut sembler que tout est programmé, configuré facilement et simplement, ou je suis un génie. <br><br>  Je vous assure que ce n'est pas le cas!  J'ai déjà rencontré la plupart des microcircuits et des modules, donc je suis monté sur un râteau plus tôt et mon front me faisait très mal , mais les bosses sont passées, mais les connaissances sont restées! <br><br>  La puissance du module processeur est plus que suffisante pour résoudre mes tâches, lors des tests la charge moyenne sur le processeur n'a pas dépassé 15%.  La présence de mémoire eMMC et de cartes MicroSD permettra la duplication des OS et des logiciels.  La consommation sans connexion de périphériques USB est d'environ 300 mA.  Avec ce type de consommation, il ne sera pas difficile d'organiser une alimentation sans interruption à partir d'une batterie d'heures pour 5 travaux. <br><br>  La base d'élément sélectionnée pour la construction de périphériques est assez fiable, ce qui donne confiance en un fonctionnement sans problème de l'appareil en mode 24x7. <br><br>  La présence d'un petit nombre d'entrées et de sorties sur l'appareil lui-même est entièrement compensée par la présence d'un bus 485 et d'un module radio, c'est-à-dire que la construction d'un système de contrôle distribué ne sera pas très difficile, et l'ensemble des entrées et sorties qui sont à bord peut être utilisé pour le contrôle local dans l'armoire électrique. <br><br><h3>  Conclusions </h3><br>  Cet appareil, déclaré par le constructeur, intégrera-t-il tous les appareils intelligents?  Avec un étirement, vous pouvez dire que ce sera le cas.  Mais malheureusement, il n'y a pas assez de module radio pour 433 MHz, bus CAN, prise en charge de ZigBee, mais la présence de RS485, de module radio à 2,4 GHz et de WiFi permettra de connecter un nombre suffisant d'appareils, et des protocoles de communication peuvent être implémentés dans le logiciel. <br><br>  Je le répète, l'appareil en question est fabriqué en deux versions: une solution entièrement prête à l'emploi pour la construction d'un système de contrôle distribué et uniquement du matériel.  À mon avis, une solution toute faite ne peut être achetée que si vous ne voulez pas gérer la programmation et la paresse.  Dans d'autres cas, il est beaucoup plus intéressant de prendre la plateforme et de la programmer par vous-même. <br><br>  Le coût de l'appareil m'est actuellement inconnu.  À mon avis, si le constructeur ne conduit pas le prix de plus de 13 tr.  pour la version "nue", alors cet appareil est assez intéressant à acheter.  Après avoir acheté toutes les pièces en Chine et les avoir mises dans un seul emballage, il est peu probable que vous obteniez moins cher. <br><br>  Un concurrent peut être <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Wiren Board 5</a> .  Il gagne en nombre de ports et d'interfaces possibles, mais perd en puissance du module processeur.  Cela n'affecte pas les tâches standard, mais l'installation d'un serveur Blynk localement ou la création d'un module de commande vocale peut être problématique.  Si quelqu'un a essayé de le faire sur WB5, veuillez commenter dans les commentaires. <br><br>  <b>PS:</b> Ayant déjà terminé l'article, j'ai également trouvé la puce de cryptographie ATSHA204 sur la carte.  Il prend en charge l'algorithme cryptographique SHA-256 et est idéal pour les tâches d'authentification symétrique.  Eh bien, c'est absolument pour les Geeks! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr410597/">https://habr.com/ru/post/fr410597/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr410585/index.html">Comment devenir magicien (partie 1)</a></li>
<li><a href="../fr410587/index.html">Apple a l'intention d'acheter du cobalt exclusivement auprès de sociétés minières</a></li>
<li><a href="../fr410589/index.html">Des écosystèmes marins capables de s'adapter au réchauffement climatique</a></li>
<li><a href="../fr410591/index.html">L'histoire émotionnelle des processeurs pour les premiers ordinateurs des années 70 au début des années 90</a></li>
<li><a href="../fr410593/index.html">Telegram mène une nouvelle série d'ICO</a></li>
<li><a href="../fr410599/index.html">Une vague de vols d'équipement dans les exploitations minières a balayé l'Islande</a></li>
<li><a href="../fr410601/index.html">Qu'est-ce que la robotique éducative aujourd'hui</a></li>
<li><a href="../fr410603/index.html">Manifeste de bienséance</a></li>
<li><a href="../fr410605/index.html">Un astronome amateur a testé un nouvel appareil photo et a accidentellement photographié une supernova</a></li>
<li><a href="../fr410607/index.html">SpaceX continue de fonctionner: les deux premiers satellites du réseau Internet sans fil mondial et la chasse aux carénages</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>