<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤶🏻 🧛🏽 ▫️ 使用S3，NFS安装与客户端兼容的LeoFS分布式故障安全存储设施 🥪 💆🏻 ⛸️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="我来自Luxoft。 
 根据Opennet的说法： LeoFS是LeoFS对象的分布式容错存储设施，与使用Amazon S3 API和REST-API的客户端兼容，并且还支持作为NFS服务器的操作模式。 有用于存储大小对象的优化，有内置的缓存机制，可以在数据中心之间复制存储。 该项目的目标之一是通...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>使用S3，NFS安装与客户端兼容的LeoFS分布式故障安全存储设施</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/478990/"><p> 我来自Luxoft。 <br> 根据<a href="http://leo-project.net/leofs/index.html" rel="nofollow">Opennet的</a>说法： <a href="http://leo-project.net/leofs/index.html" rel="nofollow">LeoFS</a>是<a href="http://leo-project.net/leofs/index.html" rel="nofollow">LeoFS</a>对象的分布式容错存储设施，与使用Amazon S3 API和REST-API的客户端兼容，并且还支持作为NFS服务器的操作模式。 有用于存储大小对象的优化，有内置的缓存机制，可以在数据中心之间复制存储。 该项目的目标之一是通过重复复制和消除单点故障来实现99.9999999％的可靠性。 项目代码用Erlang编写。 </p><br><p>  LeoFS包含三个组件： </p><br><ul><li> <a href="https://leo-project.net/leofs/docs/architecture/leo_storage/" rel="nofollow">LeoFS存储</a> -服务于添加，检索和删除对象和元数据的操作，负责复制，还原和排队客户端请求。 </li><li>  <a href="https://leo-project.net/leofs/docs/architecture/leo_gateway/" rel="nofollow">LeoFS网关</a> -使用REST-API或S3-API提供HTTP请求并将响应重定向到客户端，并在内存和磁盘上缓存请求最多的数据。 </li><li>  <a href="https://leo-project.net/leofs/docs/architecture/leo_manager/" rel="nofollow">LeoFS管理器</a> -监视LeoFS网关和LeoFS存储节点的操作，监视节点的状态并检查校验和。 确保数据完整性和高存储可用性。 </li></ul><br><p> 在这篇文章中，使用ansible-playbook安装Leofs，测试S3，NFS。 </p><a name="habracut"></a><br><p> 如果您尝试使用官方手册来安装LeoFS，则将等待其他错误： <a href="https://github.com/leo-project/leofs_ansible/issues/4" rel="nofollow">1，2</a> 。 在这篇文章中，我将写一些避免这些错误的方法。 </p><br><p> 您将在哪里运行ansible-playbook，需要安装netcat。 </p><br><h4 id="primer-inventory"> 库存示例 </h4><br><div class="spoiler">  <b class="spoiler_title">示例清单（在hosts.sample存储库中）：</b> <div class="spoiler_text"><pre><code class="plaintext hljs"># Please check roles/common/vars/leofs_releases for available versions [all:vars] leofs_version=1.4.3 build_temp_path="/tmp/leofs_builder" build_install_path="/tmp/" build_branch="master" source="package" #[builder] #172.26.9.177 # nodename of leo_manager_0 and leo_manager_1 are set at group_vars/all [leo_manager_0] 172.26.9.176 # nodename of leo_manager_0 and leo_manager_1 are set at group_vars/all [leo_manager_1] 172.26.9.178 [leo_storage] 172.26.9.179 leofs_module_nodename=S0@172.26.9.179 172.26.9.181 leofs_module_nodename=S0@172.26.9.181 172.26.9.182 leofs_module_nodename=S0@172.26.9.182 172.26.9.183 leofs_module_nodename=S0@172.26.9.183 [leo_gateway] 172.26.9.180 leofs_module_nodename=G0@172.26.9.180 172.26.9.184 leofs_module_nodename=G0@172.26.9.184 [leofs_nodes:children] leo_manager_0 leo_manager_1 leo_gateway leo_storage</code> </pre> </div></div><br><h4 id="podgotovka-serverov"> 服务器准备 </h4><br><p> 禁用Selinux。 我希望社区为LeoFS创建Selinux策略。 </p><br><pre> <code class="plaintext hljs"> - name: Install libselinux as prerequisite for SELinux Ansible module yum: name: "{{item}}" state: latest with_items: - libselinux-python - libsemanage-python - name: Disable SELinux at next reboot selinux: state: disabled - name: Set SELinux in permissive mode until the machine is rebooted command: setenforce 0 ignore_errors: true changed_when: false</code> </pre><br><p> 安装<code>netcat</code>和<code>redhat-lsb-core</code> 。  <code>leofs-adm</code>需要<code>netcat</code> ， <a href="" rel="nofollow">在这里</a>确定OS版本需要<code>redhat-lsb-core</code> 。 </p><br><pre> <code class="plaintext hljs"> - name: Install Packages yum: name={{ item }} state=present with_items: - nmap-ncat - redhat-lsb-core</code> </pre> <br><p> 创建用户leofs并将其添加到wheel组 </p><br><pre> <code class="plaintext hljs"> - name: Create user leofs group: name: leofs state: present - name: Allow 'wheel' group to have passwordless sudo lineinfile: dest: /etc/sudoers state: present regexp: '^%wheel' line: '%wheel ALL=(ALL) NOPASSWD: ALL' validate: 'visudo -cf %s' - name: Add the user 'leofs' to group 'wheel' user: name: leofs groups: wheel append: yes</code> </pre> <br><p> 安装Erlang </p><br><pre> <code class="plaintext hljs"> - name: Remote erlang-20.3.8.23-1.el7.x86_64.rpm install with yum yum: name=https://github.com/rabbitmq/erlang-rpm/releases/download/v20.3.8.23/erlang-20.3.8.23-1.el7.x86_64.rpm</code> </pre><br><p> 可在此处找到已更正的ansible剧本的完整版本： <a href="https://github.com/patsevanton/leofs_ansible" rel="nofollow">https</a> : <a href="https://github.com/patsevanton/leofs_ansible" rel="nofollow">//github.com/patsevanton/leofs_ansible</a> </p><br><h4 id="ustanovka-konfigurirovanie-zapusk"> 安装，配置，开始 </h4><br><p> 接下来，按照<a href="https://github.com/leo-project/leofs_ansible" rel="nofollow">https://github.com/leo-project/leofs_ansible中的说明</a>执行，不带build_leofs.yml </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">## Install LeoFS $ ansible-playbook -i hosts install_leofs.yml ## Config LeoFS $ ansible-playbook -i hosts config_leofs.yml ## Start LeoFS $ ansible-playbook -i hosts start_leofs.yml</span></span></code> </pre> <br><h4 id="proveryaem-status-klastera-na-primary-leomanager"> 在主要LeoManager上检查群集状态 </h4><br><pre> <code class="bash hljs">leofs-adm status</code> </pre> <br><p> 在ansible-playbook日志中可以看到Primary和Secondary </p><br><p><img src="https://habrastorage.org/webt/do/kp/oj/dokpoj8lmzwh3bmakpxx9anc-4i.png"></p><br><p><img src="https://habrastorage.org/webt/ku/0o/bt/ku0obtn6ezvfghyfai01zldeaws.png"></p><br><div class="spoiler">  <b class="spoiler_title">结论将是这样的</b> <div class="spoiler_text"><pre> <code class="bash hljs"> [System Confiuration] -----------------------------------+---------- Item | Value -----------------------------------+---------- Basic/Consistency level -----------------------------------+---------- system version | 1.4.3 cluster Id | leofs_1 DC Id | dc_1 Total replicas | 2 number of successes of R | 1 number of successes of W | 1 number of successes of D | 1 number of rack-awareness replicas | 0 ring size | 2^128 -----------------------------------+---------- Multi DC replication settings -----------------------------------+---------- [mdcr] max number of joinable DCs | 2 [mdcr] total replicas per a DC | 1 [mdcr] number of successes of R | 1 [mdcr] number of successes of W | 1 [mdcr] number of successes of D | 1 -----------------------------------+---------- Manager RING <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span> -----------------------------------+---------- current ring-hash | a0314afb previous ring-hash | a0314afb -----------------------------------+---------- [State of Node(s)] -------+----------------------+--------------+---------+----------------+----------------+---------------------------- <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> | node | state | rack id | current ring | prev ring | updated at -------+----------------------+--------------+---------+----------------+----------------+---------------------------- S | S0@172.26.9.179 | running | | a0314afb | a0314afb | 2019-12-05 10:33:47 +0000 S | S0@172.26.9.181 | running | | a0314afb | a0314afb | 2019-12-05 10:33:47 +0000 S | S0@172.26.9.182 | running | | a0314afb | a0314afb | 2019-12-05 10:33:47 +0000 S | S0@172.26.9.183 | attached | | | | 2019-12-05 10:33:58 +0000 G | G0@172.26.9.180 | running | | a0314afb | a0314afb | 2019-12-05 10:33:49 +0000 G | G0@172.26.9.184 | running | | a0314afb | a0314afb | 2019-12-05 10:33:49 +0000 -------+----------------------+--------------+---------+----------------+----------------+----------------------------</code> </pre> </div></div><br><h4 id="sozdaem-yuzera"> 创建一个用户 </h4><br><p> 创建用户leof： </p><br><pre> <code class="bash hljs">leofs-adm create-user leofs leofs access-key-id: 9c2615f32e81e6a1caf5 secret-access-key: 8aaaa35c1ad78a2cbfa1a6cd49ba8aaeb3ba39eb</code> </pre> <br><p> 用户列表： </p><br><pre> <code class="bash hljs">leofs-adm get-users user_id | role_id | access_key_id | created_at ------------+---------+------------------------+--------------------------- _test_leofs | 9 | 05236 | 2019-12-02 06:56:49 +0000 leofs | 1 | 9c2615f32e81e6a1caf5 | 2019-12-02 10:43:29 +0000</code> </pre> <br><h4 id="sozdaem-bucket"> 创建一个桶 </h4><br><p> 做一个水桶 </p><br><pre> <code class="bash hljs">leofs-adm add-bucket leofs 9c2615f32e81e6a1caf5 OK</code> </pre> <br><p> 遗愿清单： </p><br><pre> <code class="bash hljs"> leofs-adm get-buckets cluster id | bucket | owner | permissions | created at -------------+----------+--------+------------------+--------------------------- leofs_1 | leofs | leofs | Me(full_control) | 2019-12-02 10:44:02 +0000</code> </pre> <br><h4 id="konfigurirovanie-s3cmd"> 配置s3cmd </h4><br><p> 在“ <code>HTTP Proxy server name</code>字段中，指定网关服务器IP </p><br><pre> <code class="bash hljs">s3cmd --configure Enter new values or accept defaults <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> brackets with Enter. Refer to user manual <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> detailed description of all options. Access key and Secret key are your identifiers <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Amazon S3. Leave them empty <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> using the env variables. Access Key [9c2615f32e81e6a1caf5]: Secret Key [8aaaa35c1ad78a2cbfa1a6cd49ba8aaeb3ba39eb]: Default Region [US]: Use <span class="hljs-string"><span class="hljs-string">"s3.amazonaws.com"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> S3 Endpoint and not modify it to the target Amazon S3. S3 Endpoint [s3.amazonaws.com]: Use <span class="hljs-string"><span class="hljs-string">"%(bucket)s.s3.amazonaws.com"</span></span> to the target Amazon S3. <span class="hljs-string"><span class="hljs-string">"%(bucket)s"</span></span> and <span class="hljs-string"><span class="hljs-string">"%(location)s"</span></span> vars can be used <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> the target S3 system supports dns based buckets. DNS-style bucket+hostname:port template <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> accessing a bucket [%(bucket)s.s3.amazonaws.com]: leofs Encryption password is used to protect your files from reading by unauthorized persons <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> transfer to S3 Encryption password: Path to GPG program [/usr/bin/gpg]: When using secure HTTPS protocol all communication with Amazon S3 servers is protected from 3rd party eavesdropping. This method is slower than plain HTTP, and can only be proxied with Python 2.7 or newer Use HTTPS protocol [No]: On some networks all internet access must go through a HTTP proxy. Try setting it here <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> you can<span class="hljs-string"><span class="hljs-string">'t connect to S3 directly HTTP Proxy server name [172.26.9.180]: HTTP Proxy server port [8080]: New settings: Access Key: 9c2615f32e81e6a1caf5 Secret Key: 8aaaa35c1ad78a2cbfa1a6cd49ba8aaeb3ba39eb Default Region: US S3 Endpoint: s3.amazonaws.com DNS-style bucket+hostname:port template for accessing a bucket: leofs Encryption password: Path to GPG program: /usr/bin/gpg Use HTTPS protocol: False HTTP Proxy server name: 172.26.9.180 HTTP Proxy server port: 8080 Test access with supplied credentials? [Y/n] Y Please wait, attempting to list all buckets... Success. Your access key and secret key worked fine :-) Now verifying that encryption works... Not configured. Never mind. Save settings? [y/N] y Configuration saved to '</span></span>/home/user/.s3cfg<span class="hljs-string"><span class="hljs-string">'</span></span></code> </pre> <br><p> 如果收到错误ERROR：S3错误：403（AccessDenied）：访问被拒绝： </p><br><pre> <code class="bash hljs">s3cmd put test.py s3://leofs/ upload: <span class="hljs-string"><span class="hljs-string">'test.py'</span></span> -&gt; <span class="hljs-string"><span class="hljs-string">'s3://leofs/test.py'</span></span> [1 of 1] 382 of 382 100% <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 0s 3.40 kB/s <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> ERROR: S3 error: 403 (AccessDenied): Access Denied</code> </pre> <br><p> 然后，您需要在True s3cmd配置中更正signature_v2。  <a href="https://github.com/leo-project/leofs/issues/487" rel="nofollow">本期</a>详细内容。 </p><br><p> 如果signature_v2为False，则将出现这样的错误： </p><br><pre> <code class="bash hljs">WARNING: Retrying failed request: /?delimiter=%2F (getaddrinfo() argument 2 must be <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> or string) WARNING: Waiting 3 sec... WARNING: Retrying failed request: /?delimiter=%2F (getaddrinfo() argument 2 must be <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> or string) WARNING: Waiting 6 sec... ERROR: Test failed: Request failed <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: /?delimiter=%2F</code> </pre> <br><h4 id="testirovanie-zagruzki"> 开机测试 </h4><br><p> 创建一个1GB的文件 </p><br><pre> <code class="bash hljs">fallocate -l 1GB 1gb</code> </pre> <br><p> 将其上传到Leofs </p><br><pre> <code class="bash hljs">time s3cmd put 1gb s3://leofs/ real 0m19.099s user 0m7.855s sys 0m1.620s</code> </pre> <br><h4 id="statistika"> 统计资料 </h4><br><p>  leofs-adm du适用于1个节点： </p><br><pre> <code class="bash hljs">leofs-adm du S0@172.26.9.179 active number of objects: 156 total number of objects: 156 active size of objects: 602954495 total size of objects: 602954495 ratio of active size: 100.0% last compaction start: ____-__-__ __:__:__ last compaction end: ____-__-__ __:__:__</code> </pre> <br><p> 我们看到结论并不十分有益。 </p><br><p> 让我们看看这个文件的位置。 <br>  leofs-adm whereis leofs / 1GB </p><br><pre> <code class="bash hljs">leofs-adm whereis leofs/1gb -------+----------------------+--------------------------------------+------------+--------------+----------------+----------------+----------------+---------------------------- del? | node | ring address | size | checksum | has children | total chunks | clock | when -------+----------------------+--------------------------------------+------------+--------------+----------------+----------------+----------------+---------------------------- | S0@172.26.9.181 | 657a9f3a3db822a7f1f5050925b26270 | 976563K | a4634eea55 | <span class="hljs-literal"><span class="hljs-literal">true</span></span> | 64 | 598f2aa976a4f | 2019-12-05 10:48:15 +0000 | S0@172.26.9.182 | 657a9f3a3db822a7f1f5050925b26270 | 976563K | a4634eea55 | <span class="hljs-literal"><span class="hljs-literal">true</span></span> | 64 | 598f2aa976a4f | 2019-12-05 10:48:15 +0000</code> </pre> <br><h4 id="aktiviruem-nfs"> 激活NFS </h4><br><p> 我们在Leo Gateway 172.26.9.184服务器上激活NFS。 </p><br><p> 在服务器和客户端上，安装nfs-utils </p><br><pre> <code class="bash hljs">sudo yum install nfs-utils</code> </pre> <br><p> 根据说明，我们将修复配置文件<code>/usr/local/leofs/current/leo_gateway/etc/leo_gateway.conf</code> </p><br><pre> <code class="bash hljs">protocol = nfs</code> </pre> <br><p> 在服务器172.26.9.184上，运行rpcbind和leofs-gateway </p><br><pre> <code class="bash hljs">sudo service rpcbind start sudo service leofs-gateway restart</code> </pre> <br><p> 在运行leo_manager的服务器上，为NFS创建存储桶并生成一个密钥以连接到NFS </p><br><pre> <code class="bash hljs">leofs-adm add-bucket <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> 05236 leofs-adm gen-nfs-mnt-key <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> 05236 ip--nfs-</code> </pre> <br><h4 id="podklyuchenie-k-nfs"> 连接到NFS </h4><br><pre> <code class="bash hljs">sudo mkdir /mnt/leofs <span class="hljs-comment"><span class="hljs-comment">## for Linux - "sudo mount -t nfs -o nolock &lt;host&gt;:/&lt;bucket&gt;/&lt;token&gt; &lt;dir&gt;" sudo mount -t nfs -o nolock ip--nfs-------gateway:/bucket/access_key_id/---gen-nfs-mnt-key /mnt/leofs sudo mount -t nfs -o nolock 172.26.9.184:/test/05236/bb5034f0c740148a346ed663ca0cf5157efb439f /mnt/leofs</span></span></code> </pre> <br><h4 id="prosmotr-diskovogo-prostanstva-cherez-nfs-klient"> 通过NFS客户端查看磁盘空间 </h4><br><p> 考虑到每个存储节点都有一个40GB磁盘（3个正在运行的节点，1个连接的节点）的磁盘空间： </p><br><pre> <code class="bash hljs">df -hP Filesystem Size Used Avail Use% Mounted on 172.26.9.184:/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/05236/e7298032e78749149dd83a1e366afb328811c95b 60G 3.6G 57G 6% /mnt/leofs</code> </pre> <br><h4 id="ustanovka-leofs-s-6-storage-nodami"> 使用6个存储节点安装LeoFS。 </h4><br><div class="spoiler">  <b class="spoiler_title">库存（无生成器）：</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Please check roles/common/vars/leofs_releases for available versions [all:vars] leofs_version=1.4.3 build_temp_path="/tmp/leofs_builder" build_install_path="/tmp/" build_branch="master" source="package" # nodename of leo_manager_0 and leo_manager_1 are set at group_vars/all [leo_manager_0] 172.26.9.177 # nodename of leo_manager_0 and leo_manager_1 are set at group_vars/all [leo_manager_1] 172.26.9.176 [leo_storage] 172.26.9.178 leofs_module_nodename=S0@172.26.9.178 172.26.9.179 leofs_module_nodename=S0@172.26.9.179 172.26.9.181 leofs_module_nodename=S0@172.26.9.181 172.26.9.182 leofs_module_nodename=S0@172.26.9.182 172.26.9.183 leofs_module_nodename=S0@172.26.9.183 172.26.9.185 leofs_module_nodename=S0@172.26.9.185 [leo_gateway] 172.26.9.180 leofs_module_nodename=G0@172.26.9.180 172.26.9.184 leofs_module_nodename=G0@172.26.9.184 [leofs_nodes:children] leo_manager_0 leo_manager_1 leo_gateway leo_storage</span></span></code> </pre> </div></div><br><h4 id="vyvod-leofs-adm-status">  Leofs-ADM状态输出 </h4><br><div class="spoiler">  <b class="spoiler_title">Leofs-ADM状态输出</b> <div class="spoiler_text"><pre> <code class="bash hljs"> [System Confiuration] -----------------------------------+---------- Item | Value -----------------------------------+---------- Basic/Consistency level -----------------------------------+---------- system version | 1.4.3 cluster Id | leofs_1 DC Id | dc_1 Total replicas | 2 number of successes of R | 1 number of successes of W | 1 number of successes of D | 1 number of rack-awareness replicas | 0 ring size | 2^128 -----------------------------------+---------- Multi DC replication settings -----------------------------------+---------- [mdcr] max number of joinable DCs | 2 [mdcr] total replicas per a DC | 1 [mdcr] number of successes of R | 1 [mdcr] number of successes of W | 1 [mdcr] number of successes of D | 1 -----------------------------------+---------- Manager RING <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span> -----------------------------------+---------- current ring-hash | d8ff465e previous ring-hash | d8ff465e -----------------------------------+---------- [State of Node(s)] -------+----------------------+--------------+---------+----------------+----------------+---------------------------- <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> | node | state | rack id | current ring | prev ring | updated at -------+----------------------+--------------+---------+----------------+----------------+---------------------------- S | S0@172.26.9.178 | running | | d8ff465e | d8ff465e | 2019-12-06 05:18:29 +0000 S | S0@172.26.9.179 | running | | d8ff465e | d8ff465e | 2019-12-06 05:18:29 +0000 S | S0@172.26.9.181 | running | | d8ff465e | d8ff465e | 2019-12-06 05:18:30 +0000 S | S0@172.26.9.182 | running | | d8ff465e | d8ff465e | 2019-12-06 05:18:29 +0000 S | S0@172.26.9.183 | running | | d8ff465e | d8ff465e | 2019-12-06 05:18:29 +0000 S | S0@172.26.9.185 | running | | d8ff465e | d8ff465e | 2019-12-06 05:18:29 +0000 G | G0@172.26.9.180 | running | | d8ff465e | d8ff465e | 2019-12-06 05:18:31 +0000 G | G0@172.26.9.184 | running | | d8ff465e | d8ff465e | 2019-12-06 05:18:31 +0000 -------+----------------------+--------------+---------+----------------+----------------+----------------------------</code> </pre> </div></div><br><p> 磁盘空间，并考虑到每个存储节点都有一个40GB磁盘（6个正在运行的节点）： </p><br><pre> <code class="bash hljs">df -hP Filesystem Size Used Avail Use% Mounted on 172.26.9.184:/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/05236/e7298032e78749149dd83a1e366afb328811c95b 120G 3.6G 117G 3% /mnt/leofs</code> </pre> <br><h4 id="esli-ispolzuetsya-5-nod-storage"> 如果使用5个存储节点 </h4><br><pre> <code class="bash hljs">[leo_storage] 172.26.9.178 leofs_module_nodename=S0@172.26.9.178 172.26.9.179 leofs_module_nodename=S1@172.26.9.179 172.26.9.181 leofs_module_nodename=S2@172.26.9.181 172.26.9.182 leofs_module_nodename=S3@172.26.9.182 172.26.9.183 leofs_module_nodename=S4@172.26.9.183</code> </pre> <br><pre> <code class="bash hljs">df -hP 172.26.9.184:/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/05236/e7298032e78749149dd83a1e366afb328811c95b 100G 3.0G 97G 3% /mnt/leofs</code> </pre> <br><h4 id="logi"> 日志 </h4><br><p> 日志位于目录<code>/usr/local/leofs/current/*/log</code> </p><br><h4 id="esli-vy-budete-ustanavlivatnastraivat-leofs-vruchnuyu-to-vozmozhno-stolknetes-so-sleduyuschimi-oshibkami"> 如果您手动安装/配置Leofs，则可能会遇到以下错误。 </h4><br><h5 id="error-mnesia-is-not-available">  [错误]无法使用Mnesia </h5><br><p> 启动systemctl服务启动leofs-manager-master </p><br><pre> <code class="bash hljs">leofs-adm status [ERROR] Mnesia is not available</code> </pre> <br><p> 需要在leo_manager_1上启动systemctl start leofs-manager-slave </p><br><h5 id="ne-startuet-leofs-storage">  Leofs-storage无法启动。 </h5><br><p>  leofs-manager-master和leofs-manager-slave和leofs-adm status必须运行才能显示该状态。 </p><br><h5 id="attached-nodes-less-than--of-replicas"> 附加节点少于副本数 </h5><br><p> 当您启动leofs-adm start时，会出现以下错误： </p><br><pre> <code class="bash hljs">leofs-adm start [ERROR] Attached nodes less than <span class="hljs-comment"><span class="hljs-comment"># of replicas</span></span></code> </pre> <br><p> 没有足够的存储节点。  leofs-adm状态将向您显示少于2个存储节点。 所需的最少存储节点数2。 </p><br><h5 id="leofs-adm-status-pokazyvaet-attached-ostalnye-running">  leofs-adm状态显示为已附着，其余正在运行。 </h5><br><p> 需要重新平衡节点 </p><br><pre> <code class="bash hljs">leofs-adm rebalance</code> </pre> <br><h5 id="posle-starta-leofs-gateway-vy-ne-vidite-nodu-gateway-v-leofs-adm-status"> 启动leofs-gateway之后，您看不到leofs-adm状态的Gateway节点 </h5><br><p> 需要启动leofs-adm </p><br><pre> <code class="bash hljs">leofs-adm start</code> </pre> <br><h5 id="couldnt-connect-to-leofs-manager-na-slave-uzle"> 无法连接到从节点上的LeoFS Manager </h5><br><p>  （默认情况下，leofs-adm在从属节点上不起作用！]（ <a href="https://leo-project.net/leofs/docs/issues/documentation-issues/" rel="nofollow">Https://leo-project.net/leofs/docs/issues/documentation-issues/</a> ） </p><br><h3 id="nagruzochnoe-testirovanie"> 负载测试 </h3><br><p> 使用以下配置在2个节点上进行测试： </p><br><pre> <code class="bash hljs">CPU: Single Core Intel Core (Broadwell) (-MCP-) speed: 2295 MHz Kernel: 3.10.0-862.3.2.el7.x86_64 x86_64 Up: 1h 08m Mem: 1023.8/1999.6 MiB (51.2%) Storage: 10.00 GiB (43.5% used) Procs: 98 Shell: bash 4.2.46 inxi: 3.0.37</code> </pre> <br><p> 为了测试，请拿一个小磁盘 <br> 在两个节点上，我们都看到了9.4G和5.9G的可用空间磁盘。 </p><br><pre> <code class="bash hljs">df -hP Filesystem Size Used Avail Use% Mounted on /dev/vda1 9.4G 5.9G 3.1G 66% /</code> </pre> <br><p> 电报频道： <a href="https://t.me/sds_ru" rel="nofollow">SDS和Cluster FS</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN478990/">https://habr.com/ru/post/zh-CN478990/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN478972/index.html">Miro平台竞赛的获胜者</a></li>
<li><a href="../zh-CN478974/index.html">使用动态导入自动加载模块</a></li>
<li><a href="../zh-CN478984/index.html">TimTam-具有独特的尖端加热功能的新一代敲击按摩器</a></li>
<li><a href="../zh-CN478986/index.html">Yandex对复古游戏发起了广泛的投票。 复古游戏之战入围2019</a></li>
<li><a href="../zh-CN478988/index.html">威尼斯：一对裸石上的暴利</a></li>
<li><a href="../zh-CN478992/index.html">缺乏对IT的恐惧和生活乐趣</a></li>
<li><a href="../zh-CN478994/index.html">德国邮政计划周一放慢工作并休息</a></li>
<li><a href="../zh-CN478996/index.html">工作不是狼，第4部分。有经验的员工：如何不倦怠，不放弃</a></li>
<li><a href="../zh-CN478998/index.html">为什么我们总是想看到黄金分割率？ 使用C ++神经网络尝试（失败）进化分析</a></li>
<li><a href="../zh-CN479000/index.html">14岁时的Parallels实习</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>