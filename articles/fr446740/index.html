<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§õüèæ üåΩ ü§úüèæ Utiliser Python pour cr√©er des rapports dans une seule entreprise üï£ üë©‚Äçüè´ üë©üèº‚Äçüé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cette histoire s'est produite dans une vraie entreprise, malgr√© le fait que certains noms et √©v√©nements sont fictifs. 

 Glory √©tait un d√©veloppeur or...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Utiliser Python pour cr√©er des rapports dans une seule entreprise</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446740/"> Cette histoire s'est produite dans une vraie entreprise, malgr√© le fait que certains noms et √©v√©nements sont fictifs. <br><br>  Glory √©tait un d√©veloppeur ordinaire dans une petite entreprise de la ville de N. L'entreprise √©tait engag√©e dans la fourniture de services aux organisations √©ducatives.  Plusieurs applications devaient √™tre prises en charge, se d√©veloppant progressivement petit √† petit.  Mais les autorit√©s de Glory ne croyaient pas en ses efforts et au fait qu'il mange son pain pour une raison.  De plus, les patrons des technologies de l'information ne le voulaient pas vraiment, mais voulaient comprendre ce que faisaient les employ√©s et quel type de productivit√© le service commercial (qui je dois dire √©tait compos√© d'une personne et demie). <br><a name="habracut"></a><br>  Les autorit√©s ont regard√© le directeur des ventes avec un ≈ìil rus√© et ont demand√©: qu'avez-vous fait aujourd'hui pour la Patrie.  Le vendeur a r√©pondu: tenu tant de r√©unions, offert des services √† tant de gens.  La direction est venue √† Glory et dit: dites-moi si les employ√©s disent la v√©rit√© ou s'ils portent un b√¢illon.  Besoin de statistiques. <br><br>  Le dialogue a eu lieu: <br><br>  - Les utilisateurs paient-ils le service via un service tiers pour recevoir des paiements en ligne?  Alors? <br>  - Alors. <br>  - La direction de l'entreprise a-t-elle acc√®s √† ce service? <br>  - Il y en a. <br>  - Donc, probablement, il y a un d√©chargement des paiements l√†-bas. <br>  - Il y en a. <br>  "Mais avez-vous besoin d'un rapport suppl√©mentaire?" <br>  - N√©cessaire. <br>  - Pourquoi? <br>  - Parce que c'est plus pratique, parce que vous devez le faire, parce que "tel ou tel". <br><br>  En toute justice, il faut dire que des donn√©es suppl√©mentaires √©taient n√©cessaires. <br><br>  Sans h√©sitation, Glory a rempli une simple requ√™te avec s√©lection ult√©rieure dans Excel. <br><br>  Le rapport √©tait un ensemble de donn√©es dans une colonne sur une page.  Au d√©but, ils se sont approch√©s de Glory de mani√®re chaotique, au milieu de la journ√©e et ont demand√©.  Mais donnez-moi un rapport sur cette organisation, et maintenant sur celle-ci.  Sans h√©sitation, Slava a d√©cid√© qu'il suffisait de supporter cela et que quelque chose de beau et d'unifi√© devait √™tre fait pour satisfaire les besoins de ceux qui le demandaient. <br><br>  Un petit script est apparu qui a permis d'envoyer des newsletters aux personnes int√©ress√©es: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> openpyxl, pymysql, os <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> smtplib <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> SMTP_SSL <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> email.mime.multipart <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> MIMEMultipart <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> email.mime.base <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> MIMEBase <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> email <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> encoders <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> datetime <span class="hljs-comment"><span class="hljs-comment"># Excel Settings today = datetime.date.today().strftime('%d.%m.%Y') excel_file = 'Oplata_polzovateley_' + today + '.xlsx' # SQL settings host = '' user = '' passwd = '' db = '' port=0000 headers = ['id', 'email', '', '', ' ', ' ', '', '- ', ' '] # SMTP Mail settings smtp_server = 'smtp.gmail.com' mail_login = '' mail_passwd = '' receiver = [''] cc = [''] def main(): # Fetch Data from SQL server conn = pymysql.connect(host=host, user=user, passwd=passwd, db=db, port=port) cursor = conn.cursor() cursor.execute('''select * from table''') data = cursor.fetchall() conn.close() # Write Data to Excel file wb = openpyxl.Workbook() contractors = {} for item in data: diff = item[6] - item[5] item = list(item) # print(item) if diff.days &gt; 10: item.append('') else: item.append('') item = tuple(item) if item[0][:30] in contractors: contractors[item[0][:30]] += 1 else: wb.create_sheet(item[0][:30]) contractors[item[0][:30]] = 2 for i in range(1, len(headers) + 1): letter = openpyxl.utils.get_column_letter(i) wb[item[0][:30]][letter + '1'] = headers[i - 1] wb[item[0][:30]]['A' + str(contractors[item[0][:30]])] = contractors[item[0][:30]] - 1 for i in range(2, len(headers) + 1): letter = openpyxl.utils.get_column_letter(i) wb[item[0][:30]][letter + str(contractors[item[0][:30]])] = item[i] wb.save(excel_file) wb.remove(wb['Sheet']) wb.save(excel_file) # Compose attachment part = MIMEBase('application', "octet-stream") part.set_payload(open(excel_file, "rb").read()) encoders.encode_base64(part) part.add_header('Content-Disposition', 'attachment; filename="%s"' % os.path.basename(excel_file)) # Compose message msg = MIMEMultipart() msg['From'] = mail_login msg['To'] = ', '.join(receiver) msg['Cc'] = ', '.join(cc) msg['Subject'] = excel_file msg.attach(part) # Send mail tosend = receiver + cc smtp = SMTP_SSL('smtp.gmail.com') smtp.connect(smtp_server) smtp.login(mail_login, mail_passwd) smtp.sendmail(mail_login, tosend, msg.as_string()) smtp.quit() # Wipe file os.remove(excel_file) if __name__ == '__main__': main()</span></span></code> </pre> <br>  Made, bien s√ªr, ne pensait pas vraiment √† Glory.  Mais comme on dit: "Ah, et √ßa fera l'affaire." <br><br>  Chaque matin, Slava est venu travailler, a ex√©cut√© un script et a envoy√© un e-mail aux parties int√©ress√©es. <br>  L'√©tape suivante consistait √† configurer l'envoi automatique.  Cela a fonctionn√© comme ceci: <br><br>  <i>docker build --tag = rapports.</i> <i><br></i>  <i>docker run -it --rm rapports</i> <br>  Et en mots dans la couronne: <br>  <i>0 8 * * * docker run --rm foo</i> <br><br>  Chaque jour √† 8 heures du matin, la lettre partait.  La direction √©tait jolie et a m√™me commenc√© √† penser que Slava venait travailler tous les jours √† exactement 8 heures du matin, r√©digeait un rapport dans Excel, puis l'envoyait par la poste √† ses mains.  Et il l'a fait samedi et dimanche, et dans la neige, et sous la pluie, et dans la nuit polaire. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Github</a> <br><br>  Pour le moment, pendant un moment tout allait bien et la direction a perdur√©, mais pas pour longtemps.  Une fois, il y a eu une r√©union au cours de laquelle un nouvel ordre a √©t√© annonc√©.  √âcoutez, √©coutez et ne dites pas que vous n'avez pas entendu.  Sim d√©clare que chaque employ√©, chaque jour doit se rapporter √† un rang sup√©rieur, et m√™me sup√©rieur.  Eh bien, en g√©n√©ral, vous comprenez. <br><br>  "Tous les jours?", Demanda Glory. <br>  - Tous les jours.  - a r√©pondu le chef du service technique. <br>  - Ou peut-√™tre pas? <br>  - Il faut la gloire, c'est n√©cessaire. <br><br>  Slava avait plusieurs questions concernant cette situation.  La responsabilit√© imm√©diate √©tait de finaliser le logiciel et ses rapports devraient consister en quelque chose comme ceci: <br>  <b>feat (Module) Correction d'un bug dans NoteLineCount ... pas s√©rieusement ...</b> <b><br></b>  <b>upd (Module2) Ne faites pas attention √† l'homme derri√®re le rideau</b> <b><br></b>  <b>fixe (Module3) on m'a dit de le laisser tranquille, mais j'ai ce truc appel√© OCD, vous voyez</b> <br>  * Remarque: le nom des messages √† valider <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">est tir√© d'ici</a> <br><br>  Glory a d√©cid√© qu'il r√©digerait un rapport sur cette base.  Une semaine s'est √©coul√©e.  Une nouvelle conversation a eu lieu sur le contenu suivant: <br><br>  - Vous envoyez donc des rapports tous les jours, mais aucun progr√®s n'est visible.  Par exemple: ¬´un masque a √©t√© ajout√© lors de la saisie d'un num√©ro de t√©l√©phone sur le front-end¬ª. <br>  - Eh bien, regarde.  Auparavant, vous deviez entrer votre num√©ro de t√©l√©phone et v√©rifier le nombre de chiffres, ce qui n'√©tait pas pratique.  Et donc c'est pratique. <br>  - Hm.  Bon.  Je vois.  Et comment expliquez-vous cela: ¬´Refactorisation de code pour le module Contreparties.  La fonction de validation est dans une m√©thode distincte. " <br>  - Tu vois.  Il existe une telle chose - le syst√®me de contr√¥le de version, qui indique qui, quand et quoi.  Regardez ici.  Voici les commits, et voici le code qui a √©t√© modifi√©.  Voici le code ajout√©, voici le code supprim√©. <br>  - Bien.  Faisons-le alors.  Faites un rapport sur la base de ces commits, puis nous nous r√©unirons et v√©rifierons si oui ce que vous y avez √©crit. <br><br>  En fin de compte - c'est ce qui s'est pass√©: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>Github</b></a> <br><br>  Le script a modifi√© le r√©f√©rentiel et envoy√© une lettre sur ce qui a √©t√© fait et ce qui ne l'a pas √©t√©. <br><br>  Plus t√¥t, Slava a √©t√© g√™n√© de signaler que ceux qui ne v√©rifieront rien du tout ne comprennent pas comment √©crire du code.  Peut-√™tre que la direction comprend les ventes, les achats et toutes sortes d'autres choses et paie de l'argent, mais vous verrez certaines lignes de code dans un langage peu familier, observez comment les lignes vertes et rouges scintillent lorsque vous passez de commit √† commit. <br><br>  Oui, Slava est une personne responsable et le travail a fonctionn√©, mais il y a eu des jours o√π le code √©tait √† peine finalis√© ou c'√©tait la paresse.  Quoi qu'il en soit, en g√©n√©ral, le syst√®me fonctionnait sans √©checs et ne voulait pas ajouter 15 couches d'abstraction suppl√©mentaires, mais des rapports devaient √™tre envoy√©s tous les jours. <br><br>  Il n'y avait plus rien √† faire que de devenir un nouveau Mayakovsky et d'√©crire un b√¢illon avec une √©chelle.  Mais chaque jour, je ne voulais pas vraiment en inventer un nouveau.  En cons√©quence, Vyacheslav a commenc√© √† d√©velopper la premi√®re solution qui est venue √† l'esprit et s'est av√©r√©e √™tre un code simple, o√π, en l'absence de tout travail effectu√© et de modifications pouss√©es, un rapport a √©t√© compil√©.  Cela ressemblait √† ceci: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Github</a> <br><br>  Il restait √† faire pour qu'un faux code soit form√© avec les commits suivants.  Est-il n√©cessaire de le faire?  Le temps nous le dira. <br><br>  PS: L'histoire de Glory ne s'arr√™te pas l√†.  Il y a eu plusieurs autres √©v√©nements qui ont influenc√© son destin, mais c'est une histoire compl√®tement diff√©rente.  Il est int√©ressant de lire dans les commentaires des histoires similaires de la vie et les d√©cisions qui ont √©t√© cr√©√©es sur leur base.  Il est possible que le projet soit d√©velopp√© sur la base de ces commentaires. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr446740/">https://habr.com/ru/post/fr446740/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr446728/index.html">Comment la puissance re√ßue de la charge sans fil change en fonction de l'emplacement du t√©l√©phone</a></li>
<li><a href="../fr446730/index.html">Section backend sur DUMP: Serverless, Postgres and Go, .NET Core, GraphQL et plus</a></li>
<li><a href="../fr446732/index.html">Les feropodes n'aideront pas: recherche et mod√©lisation math√©matique des pi√®ges √† fosse pour les larves de fourmis lionnes</a></li>
<li><a href="../fr446736/index.html">Oracle APEX Rapports</a></li>
<li><a href="../fr446738/index.html">Bases du traitement du langage naturel pour le texte</a></li>
<li><a href="../fr446742/index.html">Th√®mes de la Top 3D Expo 2019: ¬´Anisoprinting - la technologie pour la production de structures composites d'une nouvelle g√©n√©ration¬ª, Fedor Antonov</a></li>
<li><a href="../fr446744/index.html">VR avec interfaces neuronales - une immersion compl√®te dans la r√©alit√© virtuelle</a></li>
<li><a href="../fr446746/index.html">Un employ√© d'UBS a entendu une conversation sur un voisin du train Eurostar et a d√©couvert un accord de 15 milliards de dollars. Maintenant, lui et la banque seront condamn√©s √† une amende</a></li>
<li><a href="../fr446750/index.html">Nouvelles du bas: les g√©ants de l'informatique ont commenc√© √† construire activement leurs propres r√©seaux de sous-marins</a></li>
<li><a href="../fr446752/index.html">Services de tra√ßage, OpenTracing et Jaeger</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>