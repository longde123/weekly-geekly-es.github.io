<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔇 🤚 🎾 L'édition de texte vous déteste aussi 🤛🏽 👛 💆🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'article d'Alexis Bingessner, «Text Rendering Hates You», publié il y a un mois , est très proche de moi. 

 En 2017, je développais un éditeur de te...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>L'édition de texte vous déteste aussi</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474036/">  L'article d'Alexis Bingessner, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«Text Rendering Hates You»,</a> publié il y a un mois <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">, est</a> très proche de moi. <br><br>  En 2017, je développais un éditeur de texte interactif dans un navigateur.  Insatisfait des bibliothèques ContentEditable existantes, je me suis dit: «Hé, re-réalisons juste la sélection de texte!  C'est dur? "  J'étais jeune.  Naïf.  J'ai pensé que je pourrais le gérer en deux semaines.  En fait, une tentative pour résoudre ce problème a pris plusieurs années de ma vie, y compris un an de travail rémunéré du matin au soir pour développer un éditeur de texte pour le nouvel OS. <br><br>  Au travail, j'ai eu la chance d'apprendre beaucoup de <abbr title="comme toujours, grâce à Raf Levien et Yokhey Yukawa qui m'ont appris tout ce que je sais sur la dactylographie">mentors ayant une vaste expérience dans ce domaine</abbr> .  J'ai entendu beaucoup, beaucoup d'histoires effrayantes.  Y compris un ingénieur qui a pris en charge une application Windows avec une implémentation personnalisée d'un champ de texte - et qui voulait passer d'une API de saisie de texte obsolète à une nouvelle version.  Voici une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">liste des interfaces de</a> saisie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de</a> texte dans cette nouvelle version: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/905/ade/db0/905adedb0a3bd875236bfadd2c9f533d.png"><br><a name="habracut"></a><br>  C'est vrai, 128 interfaces pour saisir du texte.  Je suis presque sûr qu’il existe huit (8!) Différents types de verrous pour résoudre les problèmes de concurrence, même si je n’ai honnêtement pas lu leur documentation, alors ne me citez pas à ce sujet.  Cet ingénieur d'un an et demi (à plein temps!) A modifié son éditeur, mais a finalement échoué et est resté sur l'ancienne API. <br><br>  La dactylographie est difficile. <br><br>  Alexis mentionne parfois la sélection de texte, mais son expérience personnelle est plus liée au rendu.  En tant que personne, d'autre part, je peux ajouter quelques points sur la contribution. <br><br><h3>  Mouvement vertical du curseur </h3><br>  J'ai déjà couvert cela dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article précédent</a> , mais nous pouvons répéter rapidement ici. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d7/dcb/be8/2d7dcbbe886a8da0e23abaf51f092ced.png"></div><br><br>  Dans cet exemple, si vous appuyez vers le haut, le curseur se place au début de la ligne, avant le mot <i>bonjour</i> .  Jusqu'à présent, tout est assez raisonnable.  Mais si vous appuyez vers le haut puis vers le bas, le curseur sautera d'abord devant <i>bonjour</i> , puis se tiendra après <i>certains</i> . <br><br>  Cela peut ne pas sembler très logique.  Vous demandez pourquoi il saute à droite?  Eh bien, avec les mouvements verticaux, chaque curseur se souvient de la position <i>x</i> en pixels, et il ne se met à jour que lorsque vous appuyez sur la gauche ou la droite, et non vers le haut et vers le bas.  Le même comportement empêche les curseurs de se déplacer vers la gauche lors d'un déplacement vertical sur de courtes lignes. <br><br><h3>  Proximité </h3><br>  Bon, maintenant nous savons que lorsque nous sélectionnons du texte, nous avons <i>deux</i> éléments d'état: le décalage d'octet à l'intérieur de la ligne et la coordonnée <i>x</i> en pixels, mentionnée ci-dessus.  Le problème est-il résolu?  Et bien non. <br><br>  Considérez deux positions de curseur sur une très longue ligne: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bf1/a02/0f5/bf1a020f5aa7512ad957b47717fd4bc2.png"></div><br><br>  Puisque <i>loooooooooong</i> est un mot, deux positions de curseur ont <i>exactement le même décalage d'octet dans la chaîne</i> .  Il n'y a pas de nouvelle ligne entre eux, car la ligne est doucement enveloppée.  Nos curseurs ont besoin d'un bit supplémentaire qui leur indique vers quelle ligne aller.  La plupart des systèmes appellent ce bit affinité.  Il est également utilisé dans le texte mixte bidirectionnel, dont nous parlerons bientôt. <br><br><h3>  Modificateurs Emoji </h3><br>  Supposons que j'envoie un message à un ami.  Pour exprimer mes sentiments, je veux ajouter un emoji drôle.  J'entre dans la zone de texte un pouce vers le haut, <code>a</code> lettre <code>a</code> et un modificateur d'emoji pour le teint.  Cela ressemble à ceci: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4fd/f6b/1e8/4fdf6b1e84ddd2774b68d335e8b597b8.png"></div><br><br>  Oh, je ne voulais pas écrire une lettre.  Je place le curseur après et clique sur Retour arrière.  Que va-t-il se passer?  J'ai vu plusieurs options, selon l'éditeur. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/237/c58/054/237c580542b2d5921a07adbdfb2d32c5.png"></div><br><br><ul><li>  <b>Le mauvais numéro 1</b> peut <i>sembler</i> correct.  Mais c'est ainsi qu'un éditeur de texte fonctionne avec la prise en charge du rendu d'emoji hérité, par exemple, Sublime Text.  C'est mauvais car les emoji à doigts légers sont encodés comme un doigt jaune, suivi immédiatement d'un modificateur de teint.  Ils ne sont pas combinés en un seul symbole, comme prévu.  Même si je copie le doigt léger d'une autre application, il ne s'affichera toujours pas correctement, comme ici. <br></li><li>  <b>Le mauvais # 2</b> est ce que fait Chrome 77 dans la barre d'adresse.  Pas sur les pages Web, mais uniquement dans la barre d'adresse.  Ce n'est pas un problème de rendu, car les emoji copier-coller avec le teint fonctionnent.  Au lieu de cela, Chrome supprime la lettre, et après avoir remarqué le modificateur suivant la lettre, il le supprime également.  Oups <br></li><li>  <b>Le mauvais numéro 3</b> correspond à la spécification Unicode de la façon dont les emoji doivent être fusionnés.  Mais cela est assez incompréhensible pour les utilisateurs, et en passant, vous devez déplacer le curseur pour qu'il ne reste pas coincé à mi-chemin à l'intérieur de l'emoji. </li></ul><br>  Toutes les options sont mauvaises, vous pouvez donc supposer qu'il existe probablement une quatrième option.  Voilà!  De nombreux éditeurs, tels que TextEdit, ne vous permettent même pas de placer le curseur après la lettre, car le modificateur de teint est considéré comme une seule unité avec le caractère précédent.  Cela a du sens dans le contexte des emoji et fonctionne même bien dans ce cas, mais que faire si le modificateur est indiqué par le premier caractère de la chaîne? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ef/a2e/3ad/2efa2e3ad0396bd2362cd08694c841fc.png"></div><br><br>  Maintenant, le modificateur change le caractère de nouvelle ligne.  TextEdit ne vous permettra pas de placer le curseur au début de la deuxième ligne!  Personnellement, je considère cette décision «aussi mauvaise». <br><br>  Vous avez peut-être également remarqué que le pouce vers le haut est devenu le pouce vers le bas.  Je l'ai fait moi-même pour refléter mes sentiments sur la situation dans son ensemble. <br><br>  Soit dit en passant, TextEdit rend le curseur sur la première ligne <i>très</i> bogué.  Par exemple, devinez ce qui se passe si j'appuie sur <code>4</code> ici? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c8/988/687/1c898868781c9461aba7ab1e7cb74255.png"></div><br><br>  Ouais.  Vous pourriez également penser qu'il y a des espaces entre les chiffres.  Ils ne sont pas là. <br><br><h3>  Texte bidirectionnel </h3><br>  Alexis mentionne les sélections fractionnées dans un texte bidirectionnel mixte, comme dans cet exemple de TextEdit: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/14b/dd3/8c3/14bdd38c366451ff768fc4aa15dc17b3.png"></div><br><br>  Cela a vraiment du sens, car la langue arabe dans les lignes est codée de droite à gauche, de sorte que la sélection semble être divisée, mais les octets sont une plage continue. <br><br>  Par conséquent, il est un peu surprenant que nous puissions obtenir cette sélection: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/53d/d86/9aa/53dd869aa064eb6ebc8cac8114147800.png"></div><br><br>  Oui, il est visuellement continu, mais séparé en octets.  Oui, c'est mauvais.  Certains éditeurs le font si vous sélectionnez du texte avec les touches fléchées au lieu de la souris.  Une alternative consiste à échanger les touches gauche / droite à l'intérieur du texte avec la direction de droite à gauche, ce qui est également mauvais.  Il n'y a pas de bonnes options ici. <br><br>  En prime, essayez de comprendre ce qui se passe ici: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e88/2bb/b48/e882bbb480ea0a67812b862fc778d815.png"></div><br><br>  Seigneur ... je ne veux pas faire de commentaire à ce sujet. <br><br><h3>  La chose sur les méthodes de saisie </h3><br>  Un logiciel qui traduit les frappes en entrée est appelé méthode d'entrée ou éditeur de méthode d'entrée.  Pour l'alphabet latin, ce n'est pas un logiciel très intéressant, car chaque frappe est directement associée à l'insertion d'un caractère.  Mais dans de nombreux scripts, les personnages ne tiennent pas sur le clavier, vous devez donc être créatif.  Par exemple, dans certaines méthodes de saisie pour la langue chinoise, l'utilisateur entre des sons - et obtient une liste de caractères similaires dans le son: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/257/4be/547/2574be547e63c1408db959a8bd107c90.png"></div><br><br>  Ce champ est parfois appelé région de composition et apparaît souvent <abbr title="zone de composition">au-dessus du texte souligné</abbr> .  Parfois, la méthode d'entrée doit le styliser.  Par exemple, la méthode de saisie japonaise sur Android utilise la couleur d'arrière-plan pour créer une zone de partage de phrases: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b27/583/4c2/b275834c23880b9375d4da714632f1cc.png"></div><br>  <i><font color="gray">(Merci à Shae pour la capture d'écran!)</font></i> <br><br>  Toutes ces sélections et zones de composition interagissent-elles avec du texte bidirectionnel?  N'y pensons pas. <br><br>  Les méthodes de saisie devraient fonctionner partout, <i>même à l'intérieur du terminal</i> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/24d/b76/f54/24db76f544a936d70edb9143a36fdba0.png"></div><br><br>  Rien n'ira à Vim tant qu'un caractère chinois n'aura pas été sélectionné dans la liste.  Vous pensez probablement: "Mais comment ça marche en mode de commande Vim?"  Pas très bien.  C'est pourquoi, sur Internet, la saisie de texte et les frappes sont des événements distincts.  Dans la console, ils se mélangent, causant des problèmes. <br><br>  Ceci n'est qu'un exemple de nombreuses méthodes de saisie de texte différentes.  (N'oubliez pas les méthodes de saisie sans clavier telles que la voix et l'écriture manuscrite!) Heureusement, le système d'exploitation vous fournit toutes ces méthodes.  Mais, malheureusement, votre zone de texte doit parler du protocole de saisie de texte général utilisé par toutes ces méthodes.  Pour Windows, ce sont les 128 interfaces répertoriées au début de l'article.  Dans d'autres systèmes d'exploitation, les interfaces sont plus simples, mais elles sont toujours difficiles à implémenter. <br><br>  Vous pouvez également remarquer que la méthode d'entrée est un processus distinct, de sorte que la méthode d'entrée et l'application peuvent apporter des modifications à l'état du champ de texte.  Il s'agit en fait d'un protocole d'édition parallèle.  Windows résout le problème avec huit (8!) Types de verrous.  Bien que le maintien d'un verrou au-delà des limites du processus puisse sembler douteux, la plupart des autres plates-formes essaient d'utiliser des heuristiques imparfaites pour résoudre les problèmes de concurrence.  Ou ils espèrent simplement que la condition de course ne se produira pas.  D'après mon expérience, la prière n'est pas une primitive très efficace du parallélisme. <br><br><h3>  Pourquoi tout est-il si compliqué ?? </h3><br>  Jonathan Blow, dans une conférence sur la dégradation des logiciels, mentionne l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">éditeur de texte Ken Thompson</a> , qu'il a écrit en une semaine.  La plupart du code de cet article est une complexité introduite au hasard.  Windows a-t-il vraiment besoin de 128 interfaces et de 8 types de verrous pour la saisie de texte?  Pas question.  Les erreurs dans TextEdit sont-elles le résultat d'un modèle d'édition complexe?  Oui  La dispersion des bogues dans les programmes modernes est-elle une source de préoccupation?  Du moins pour moi, ça l'est. <br><br>  Cependant, l'éditeur de Ken Thompson était également beaucoup, beaucoup plus simple que ce que nous attendons des éditeurs de texte modernes.  Unicode prend en charge presque toutes les langues vivantes dans le monde (il y en a environ 7 000) et beaucoup d'autres sont mortes.  Il existe différents scripts, directions de texte et méthodes de saisie, chacun imposant des restrictions complexes (et dans certains cas insolubles) à tout éditeur.  Mais il doit également prendre en charge les lecteurs d'écran. <br><br>  Une énorme complexité s'accumule <i>inévitablement</i> , et dans cet article, nous ne l'avons que légèrement touchée.  Il s'agit d'un véritable miracle de programmation que vous pouvez simplement gifler <code>&lt;textarea&gt;</code> sur une page Web - et fournir instantanément une entrée de texte à chaque internaute du monde entier. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr474036/">https://habr.com/ru/post/fr474036/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr474020/index.html">Comment Methodius est devenue Anna: l'expérience du développement et du lancement de classificateurs de messages vocaux. 3e partie</a></li>
<li><a href="../fr474024/index.html">Nous transformons un robot aspirateur en soldat universel</a></li>
<li><a href="../fr474026/index.html">Histoires de consommateurs, Asos abandonne son magazine et TikTok</a></li>
<li><a href="../fr474028/index.html">De quelles compétences générales les développeurs ont-ils besoin? L'avis de Yandex</a></li>
<li><a href="../fr474032/index.html">Organisation des cellules standard (notes d'un étranger)</a></li>
<li><a href="../fr474038/index.html">Mises à jour périodiques des données</a></li>
<li><a href="../fr474040/index.html">Interview de Playboy: Steve Jobs, partie 1</a></li>
<li><a href="../fr474042/index.html">Compétition! Histoires à la lumière de serveurs vacillants ...</a></li>
<li><a href="../fr474046/index.html">Séminaires sur les services cloud, l'IA, la blockchain, la science des données, les microservices: maintenant à Moscou et à Saint-Pétersbourg</a></li>
<li><a href="../fr474048/index.html">HILDACRYPT: un nouveau ransomware frappe les systèmes de sauvegarde et les solutions antivirus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>