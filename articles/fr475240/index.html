<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî± üçò ü•• Utilisation de modules stricts dans des projets Python √† grande √©chelle: exp√©rience Instagram. Partie 1 üïñ üíÖüèæ üîÜ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nous publions la premi√®re partie de la traduction du prochain article d'une s√©rie sur le fonctionnement d'Instagram avec Python. Le premier article de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Utilisation de modules stricts dans des projets Python √† grande √©chelle: exp√©rience Instagram. Partie 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/475240/">  Nous publions la premi√®re partie de la traduction du prochain article d'une s√©rie sur le fonctionnement d'Instagram avec Python.  Le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">premier</a> article de cette s√©rie a parl√© des fonctionnalit√©s du code de serveur Instagram, qu'il s'agit d'un monolithe qui change fr√©quemment et de la fa√ßon dont les outils de v√©rification de type statique aident √† g√©rer ce monolithe.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le deuxi√®me</a> √©l√©ment concerne la saisie de l'API HTTP.  Nous parlerons ici d'approches pour r√©soudre certains des probl√®mes rencontr√©s par Instagram en utilisant Python dans son projet.  L'auteur du document esp√®re que l'exp√©rience Instagram sera utile √† ceux qui peuvent rencontrer des probl√®mes similaires. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/0h/_k/s9/0h_ks9h22wcs8uc2ohwld0f6uau.png"></a> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Aper√ßu de la situation</font> </h2><br>  Regardons le module suivant, qui, √† premi√®re vue, semble compl√®tement innocent: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> re <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> mywebframework <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> db, route VALID_NAME_RE = re.compile(<span class="hljs-string"><span class="hljs-string">"^[a-zA-Z0-9]+$"</span></span>) @route(<span class="hljs-string"><span class="hljs-string">'/'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">home</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(db.Model)</span></span></span><span class="hljs-class">:</span></span>     name: str</code> </pre> <br>  Quel code sera ex√©cut√© si quelqu'un importe ce module? <br><br><ul><li>  Tout d'abord, le code associ√© √† l'expression r√©guli√®re qui compile la cha√Æne dans un objet mod√®le sera ex√©cut√©. </li><li>  Ensuite, le d√©corateur <code>@route</code> sera ex√©cut√©.  Si nous nous appuyons sur ce que nous voyons, alors nous pouvons supposer qu'ici, peut-√™tre, la repr√©sentation correspondante est enregistr√©e dans le syst√®me de mappage d'URL.  Cela signifie que l'importation habituelle de ce module conduit au fait que, ailleurs, l'√©tat global de l'application est en train de changer. </li><li>  Nous allons maintenant ex√©cuter tout le code du corps de la classe <code>Person</code> .  Il peut contenir n'importe quoi.  La classe de base <code>Model</code> peut avoir une m√©thode de m√©taclasse ou <code>__init_subclass__</code> , qui, √† son tour, peut contenir un autre code qui est ex√©cut√© lors de l'importation de notre module. </li></ul><br><h2>  <font color="#3AC1EF">Probl√®me n ¬∞ 1: d√©marrage et red√©marrage lent du serveur</font> </h2><br>  La seule ligne de code pour ce module qui (√©ventuellement) ne s'ex√©cute pas lors de son importation est de <code>return "Hello World!"</code>  .  Certes, avec certitude, nous ne pouvons pas dire cela!  En cons√©quence, il s'av√®re qu'en important ce module simple compos√© de huit lignes (et ne l'utilisant toujours pas dans notre programme), nous pouvons provoquer le lancement de centaines voire de milliers de lignes de code Python.  Et cela sans oublier que l'importation de ce module entra√Æne une modification du mappage d'URL global situ√© √† un autre endroit du programme. <br><br>  Que faire  Devant nous fait partie de la cons√©quence du fait que Python est un langage interpr√©t√© dynamique.  Cela nous permet de r√©soudre avec succ√®s divers probl√®mes en utilisant des m√©thodes de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">m√©taprogrammation</a> .  Mais qu'est-ce qui ne va pas avec ce code? <br><br>  En fait, ce code est en parfait √©tat.  Il en est ainsi tant que quelqu'un l'utilise dans des bases de code relativement petites, sur lesquelles travaillent de petites √©quipes de programmeurs.  Ce code ne cause pas de probl√®me tant que celui qui l'utilise est garanti de maintenir un certain niveau de discipline dans l'utilisation exacte des fonctionnalit√©s Python.  Mais certains aspects de ce dynamisme peuvent devenir un probl√®me s'il y a des millions de lignes de code dans le projet sur lesquelles des centaines de programmeurs travaillent, dont beaucoup n'ont pas une connaissance approfondie de Python. <br><br>  Par exemple, l'une des grandes fonctionnalit√©s de Python est la vitesse des √©tapes impliqu√©es dans le d√©veloppement par phases.  A savoir, le r√©sultat des modifications de code peut √™tre vu litt√©ralement imm√©diatement apr√®s avoir effectu√© de telles modifications, sans avoir besoin de compiler le code.  Mais si nous parlons d'un projet de plusieurs millions de lignes (et d'un diagramme de d√©pendance plut√¥t d√©routant de ce projet), alors ce plus de Python commence √† se transformer en moins. <br><br>  Il faut plus de 20 secondes pour d√©marrer notre serveur.  Et parfois, lorsque nous ne pr√™tons pas l'attention voulue √† l'optimisation, ce temps passe √† environ une minute.  Cela signifie que le d√©veloppeur a besoin de 20 √† 60 secondes pour voir les r√©sultats des modifications apport√©es au code.  Cela s'applique √† ce que vous pouvez voir dans le navigateur et m√™me √† la vitesse d'ex√©cution des tests unitaires.  Malheureusement, ce temps est suffisant pour qu'une personne soit distraite par quelque chose et oublie ce qu'elle avait fait auparavant.  La plupart de ce temps, litt√©ralement, est consacr√© √† l'importation de modules et √† la cr√©ation de fonctions et de classes. <br><br>  D'une certaine mani√®re, cela revient √† attendre les r√©sultats de la compilation d'un programme √©crit dans un autre langage.  Mais g√©n√©ralement, la compilation peut √™tre effectu√©e de mani√®re <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">incr√©mentielle</a> .  Le fait est que vous ne pouvez recompiler que ce qui a chang√© et ce qui d√©pend directement du code modifi√©.  Par cons√©quent, la compilation des projets, effectu√©e apr√®s avoir apport√© de petites modifications, est rapide.  Mais lorsque vous travaillez avec Python, car les commandes d'importation peuvent avoir tout type d'effets secondaires, il n'existe aucun moyen fiable et s√ªr de red√©marrer le serveur de mani√®re incr√©mentielle.  Dans le m√™me temps, l'√©chelle des modifications est sans importance et chaque fois que nous devons red√©marrer compl√®tement le serveur, importer tous les modules, recr√©er toutes les classes et fonctions, recompiler toutes les expressions r√©guli√®res, etc.  Habituellement, √† partir du dernier red√©marrage du serveur, 99% du code n'a pas chang√©, mais nous devons toujours faire la m√™me chose encore et encore pour entrer les modifications. <br><br>  En plus de ralentir les d√©veloppeurs, cela conduit au gaspillage improductif de quantit√©s importantes de ressources syst√®me.  Le fait est que nous travaillons dans un mode de d√©ploiement continu des changements, ce qui signifie un rechargement constant du code du serveur de production. <br><br>  En fait, voici notre premier probl√®me: d√©marrage et red√©marrage lent du serveur.  Ce probl√®me est d√ª au fait que le syst√®me doit constamment effectuer une grande quantit√© d'actions r√©p√©titives lors de l'importation de code. <br><br><h2>  <font color="#3AC1EF">Probl√®me n ¬∞ 2: effets secondaires des commandes d'importation non s√©curis√©es</font> </h2><br>  Voici une autre t√¢che que les d√©veloppeurs r√©solvent souvent lors de l'importation de modules.  Ceci charge les param√®tres √† partir du stockage r√©seau des configurations: <br><br><pre> <code class="python hljs">MY_CONFIG = get_config_from_network_service()</code> </pre> <br>  En plus de ralentir le d√©marrage du serveur, il est √©galement dangereux.  Si le service r√©seau n'est pas disponible, cela entra√Ænera non seulement le fait que nous recevrons des messages d'erreur concernant l'impossibilit√© de r√©pondre √† certaines demandes.  Cela entra√Ænera le d√©marrage du serveur. <br><br>  √âpaississons les couleurs et imaginons que quelqu'un ait ajout√© au module charg√© d'initialiser un service r√©seau important, du code qui est ex√©cut√© lors de l'importation.  Le d√©veloppeur ne savait tout simplement pas o√π lui ajouter ce code, il l'a donc plac√© dans un module qui est import√© au d√©but du d√©marrage du serveur.  Il s'est av√©r√© que ce sch√©ma fonctionne, donc la solution a √©t√© consid√©r√©e comme r√©ussie et le travail s'est poursuivi. <br><br>  Mais ensuite, quelqu'un d'autre a ajout√© ailleurs l'√©quipe d'importation, ce qui, √† premi√®re vue, √©tait inoffensif.  Par cons√©quent, √† travers une cha√Æne d'importations avec une profondeur de douze modules, cela a conduit au fait que le module t√©l√©chargeant les param√®tres du r√©seau est maintenant import√© dans le module qui initialise le service r√©seau correspondant. <br><br>  Maintenant, il s'av√®re que nous essayons d'utiliser le service avant son initialisation.  Le syst√®me plante naturellement.  Dans le meilleur des cas, si nous parlons d'un syst√®me dans lequel les interactions sont compl√®tement d√©terministes, cela peut conduire au fait que le d√©veloppeur passera une heure ou deux √† comprendre comment un changement mineur a conduit √† un √©chec de quelque chose, avec lui, semble d√©connect√©.  Mais dans des situations plus complexes, cela peut conduire √† une ¬´chute¬ª du projet en production.  Cependant, il n'existe aucun moyen universel d'utiliser le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">linter</a> pour lutter contre ces probl√®mes ou pour les √©viter. <br><br>  La racine du probl√®me r√©side dans deux facteurs dont l'interaction entra√Æne des cons√©quences d√©vastatrices: <br><br><ol><li>  Python permet aux modules d'avoir des effets secondaires arbitraires et dangereux qui se produisent lors de l'importation. </li><li>  L'ordre d'importation du code n'est pas explicitement d√©fini et n'est pas contr√¥l√©.  A l'√©chelle d'un projet, une sorte d '¬´importation globale¬ª est constitu√©e des commandes d'importation contenues dans tous les modules.  Dans ce cas, l'ordre d'importation des modules peut varier en fonction du point d'entr√©e du syst√®me utilis√©. </li></ol><br>  <i><font color="#999999">√Ä suivre ...</font></i> <br><br>  <b>Chers lecteurs!</b>  Avez-vous rencontr√© des probl√®mes concernant le d√©marrage lent des projets Python? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/-o/2e/tu/-o2etuqogwhmdnmysb9_vivc9v4.png"></a> </div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr475240/">https://habr.com/ru/post/fr475240/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr475214/index.html">Quand une entreprise d√©c√®de: comment survivre √† la faillite</a></li>
<li><a href="../fr475218/index.html">Protocoles cryptographiques: d√©finitions, enregistrements, propri√©t√©s, classification, attaques</a></li>
<li><a href="../fr475226/index.html">Stage √† la Fondation Haxe</a></li>
<li><a href="../fr475228/index.html">Fourchette de paie. Vous √™tes programmeur pour maman</a></li>
<li><a href="../fr475236/index.html">N'ignorez plus jamais l'entra√Ænement de renforcement.</a></li>
<li><a href="../fr475242/index.html">Utilisation de modules stricts dans des projets Python √† grande √©chelle: exp√©rience Instagram. 2e partie</a></li>
<li><a href="../fr475244/index.html">Nouvelles fonctionnalit√©s JavaScript attendues que vous devez conna√Ætre</a></li>
<li><a href="../fr475246/index.html">Programmation asynchrone Python: un bref aper√ßu</a></li>
<li><a href="../fr475248/index.html">L'utilisation de polyfills lors de l'√©criture d'applications inter-navigateurs</a></li>
<li><a href="../fr475250/index.html">Comme Redash l'a remarqu√© et a corrig√© un probl√®me qui provoquait une d√©gradation des performances du code Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>