<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚃 🏴 🚰 ¿Es fácil y conveniente preparar Kubernetes Cluster? Anunciar operador de complemento 🚣🏻 🚢 💇🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Siguiendo al operador de shell, presentamos a su hermano mayor: operador de complemento . Este es un proyecto de código abierto que se utiliza para in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>¿Es fácil y conveniente preparar Kubernetes Cluster? Anunciar operador de complemento</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/455543/"><img src="https://habrastorage.org/webt/bs/rd/gp/bsrdgphybyglvkpf6vxtw-agpvk.png"><br><br>  Siguiendo al <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">operador de shell,</a> presentamos a su hermano mayor: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">operador de complemento</a> .  Este es un proyecto de código abierto que se utiliza para instalar componentes del sistema en el clúster de Kubernetes, que se puede llamar una palabra común: complementos. <a name="habracut"></a><br><br><h2>  ¿Por qué hacer alguna adición? </h2><br>  No es ningún secreto que Kubernetes no es un producto terminado todo en uno, y se necesitarán varias adiciones para construir un clúster "adulto".  Addon-operator ayudará a instalar, configurar y mantener estos complementos actualizados. <br><br>  La necesidad de componentes adicionales en el clúster se revela en un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">informe de</a> colegas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">driusha</a> .  En resumen, la situación con Kubernetes en este momento es que para una instalación simple puede "jugar" con componentes listos para usar, para desarrolladores y pruebas puede agregar Ingress, pero para una instalación completa, que puede decir "su producción está lista", necesita agregar una docena de complementos diferentes: algo para monitorear, algo para registros, no olvide ingresar y cert-manager, seleccionar grupos de hosts, agregar políticas de red, condimentar con configuraciones de sysctl y pod autoscaler ... <br><br><img src="https://habrastorage.org/webt/tv/2e/fb/tv2efbqltghsfxe7aibe0oor-qi.png"><br><br><h2>  ¿Cuáles son los detalles de trabajar con ellos? </h2><br>  Como muestra la práctica, el caso no se limita a una instalación.  Para un trabajo cómodo con el clúster, los complementos deberán actualizarse, deshabilitarse (eliminarse del clúster) y deberá probar algo antes de instalarlo en el clúster de producción. <br><br>  Entonces, ¿tal vez Ansible es suficiente aquí?  Posiblemente  Pero <b>las adiciones completas en el caso general no viven sin configuraciones</b> .  Esta configuración puede variar según la opción del clúster (aws, gce, azure, bare-metal, do, ...).  Algunas configuraciones no se pueden establecer de antemano; deben obtenerse del clúster.  Y el clúster no es estático: para algunas configuraciones tendrá que seguir los cambios.  Y aquí ya falta Ansible: necesitamos un programa que viva en un clúster, es decir  Operador Kubernetes. <br><br>  Quienes hayan probado el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">operador de shell</a> en funcionamiento dirán que las tareas de instalación y actualización de complementos y configuraciones de seguimiento se pueden resolver completamente con la ayuda de <a href="">ganchos</a> para el operador de shell.  Puede escribir una secuencia de comandos que haga que <code>kubectl apply</code> condicional se <code>kubectl apply</code> y monitoree, por ejemplo, ConfigMap, donde se guardarán las configuraciones.  Esto es aproximadamente lo que se implementa en addon-operator. <br><br><h2>  ¿Cómo se organiza esto en addon-operator? </h2><br>  Al crear una nueva solución, partimos de los siguientes principios: <br><br><ul><li>  El instalador del complemento debe admitir la <b>configuración de plantillas y declarativa</b> .  No hacemos scripts mágicos que instalen complementos.  El operador de complementos usa Helm para instalar complementos.  Para instalar, debe crear un gráfico y resaltar los valores que se utilizarán para configurar. </li><li>  Las configuraciones se pueden <b>generar durante la instalación</b> , se pueden <b>obtener del clúster</b> o <b>recibir actualizaciones</b> al monitorear los recursos del clúster.  Estas operaciones se pueden implementar utilizando ganchos. </li><li>  La configuración se puede <b>almacenar en un clúster</b> .  Para almacenar la configuración en el clúster, se crea un ConfigMap / addon-operator y Addon-operator monitorea los cambios de este ConfigMap.  Addon-operator le da a los ganchos acceso a la configuración usando convenciones simples. </li><li>  <b>La adición depende de la configuración</b> .  Si la configuración ha cambiado, entonces Addon-operator despliega el Helm-chart con nuevos valores.  La unión de la tabla Helm, los valores y los ganchos que llamamos módulo (ver más abajo para más detalles). </li><li>  <b>Puesta en escena</b> .  No hay guiones de lanzamiento mágico.  El mecanismo de actualización es similar a una aplicación normal: recopile complementos y operador de complementos en una imagen, pruebe y despliegue. </li><li>  <b>Control del resultado</b> .  Addon-operator puede proporcionar métricas para Prometheus. </li></ul><br><h2>  ¿Cuál es el complemento en addon-operator? </h2><br>  Una adición se puede considerar todo lo que agrega nuevas funciones al clúster.  Por ejemplo, instalar Ingress es un gran complemento.  Puede ser cualquier operador o controlador con su propio CRD: prometheus-operator, cert-manager, kube-controller-manager, etc.  O algo pequeño, pero que simplifica la operación, por ejemplo, copiadora secreta, copia de secretos de registro en nuevos espacios de nombres o sintonizador sysctl, configuración de parámetros sysctl en nuevos nodos. <br><br>  Addon-operator proporciona varios conceptos para implementar complementos: <br><br><ul><li>  <b>El diagrama Helm se</b> usa para instalar varios programas en el clúster, por ejemplo, Prometheus, Grafana, nginx-ingress.  Si el componente requerido tiene una tabla Helm, entonces instalarlo usando el operador Addon será muy simple. </li><li>  <b>Tienda de valores</b> .  Los gráficos de timón generalmente tienen muchas configuraciones diferentes que pueden cambiar con el tiempo.  Addon-operator admite el almacenamiento de estas configuraciones y puede monitorear sus cambios para restablecer el Helm-chart con nuevos valores. </li><li>  <b>Los ganchos</b> son archivos ejecutables que Addon-operator ejecuta en eventos y que acceden al almacén de valores.  El enlace puede monitorear los cambios en el clúster y actualizar los valores en el almacén de valores.  Es decir  Con la ayuda de ganchos, puede realizar un descubrimiento para recopilar valores del clúster al inicio o de acuerdo con una programación, o un descubrimiento continuo, mediante la recopilación de valores del clúster mediante cambios en el clúster. </li><li>  <b>Un módulo</b> es una unión de un gráfico Helm, almacenamiento de valores y ganchos.  Los módulos se pueden encender y apagar.  La desactivación de un módulo es la eliminación de todas las versiones del gráfico Helm.  Los módulos pueden activarse dinámicamente, por ejemplo, si se incluyen todos los módulos que necesita o si el descubrimiento encuentra los parámetros necesarios en los ganchos, esto se hace utilizando un script habilitado auxiliar. </li><li>  <b>Ganchos globales</b>  Estos son ganchos "por sí mismos", no están incluidos en los módulos y tienen acceso al almacenamiento de valores globales, cuyos valores están disponibles para todos los ganchos en los módulos. </li></ul><br>  ¿Cómo funcionan juntas estas partes?  Considere la imagen de la documentación: <br><br><img src="https://habrastorage.org/webt/d3/ws/wj/d3wswjubdglnla2eg0icgl8-uhe.gif"><br><br>  Dos escenarios de trabajo: <br><br><ol><li>  Un evento global desencadena un enlace global, por ejemplo, cuando cambia un recurso en un clúster.  Este enlace procesa los cambios y escribe los nuevos valores en el almacenamiento de valores globales.  Addon-operator nota que el almacenamiento global ha cambiado y lanza todos los módulos.  Cada módulo, usando sus ganchos, determina si necesita ser activado y actualiza su almacén de valores.  Si el módulo está habilitado, entonces Addon-operator comienza la instalación del Helm-chart.  En este caso, los valores del almacenamiento del módulo y del almacenamiento global son accesibles para el diagrama Helm. </li><li>  El segundo escenario es más simple: un evento de activación de un enlace de módulo cambia los valores en el almacenamiento de valores del módulo.  Addon-operator lo nota y lanza el gráfico Helm con valores actualizados. </li></ol><br>  El complemento se puede implementar como un enlace único o como un diagrama de Helm, o <b>incluso como varios módulos dependientes</b> ; esto depende de la complejidad del componente instalado en el clúster y del nivel deseado de flexibilidad de configuración.  Por ejemplo, en el repositorio ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">/ ejemplos</a> ) hay un complemento sysctl-tuner, que se implementa como un módulo simple con un gancho y un gráfico Helm, y que usa el almacenamiento de valores, lo que permite agregar configuraciones mediante la edición de ConfigMap. <br><br><h2>  Actualización de entrega </h2><br>  Algunas palabras sobre la organización de actualizaciones de componentes que instala Addon-operator. <br><br>  Para ejecutar Addon-operator en un clúster, debe <b>recopilar una imagen con adiciones</b> en forma de archivos de gráfico de gancho y timón, agregar el archivo binario <code>addon-operator</code> y todo lo que se necesita para ganchos: <code>bash</code> , <code>kubectl</code> , <code>jq</code> , <code>python</code> , etc.  Además, esta imagen se puede implementar en el clúster como una aplicación normal, y lo más probable es que desee organizar este o aquel esquema de etiquetado.  Si hay pocos grupos, el mismo enfoque que con las aplicaciones puede ser adecuado: una nueva versión, una nueva versión, revise todos los grupos y corrija la imagen para Pods.  Sin embargo, en el caso de un lanzamiento a un número notable de grupos, el concepto de autorrenovación del canal fue más adecuado para nosotros. <br><br>  Lo tenemos organizado así: <br><br><ul><li>  Un canal es esencialmente un identificador que puede establecer cualquier persona (por ejemplo, dev / stage / ea / stable). </li><li>  El nombre del canal es la etiqueta de la imagen.  Cuando necesite implementar actualizaciones para el canal, se recopila una nueva imagen y se etiqueta con el nombre del canal. </li><li>  Cuando aparece una nueva imagen en el registro, Addon-operator se reinicia y comienza con la nueva imagen. </li></ul><br>  Esta no es una práctica recomendada, como se describe en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentación de Kubernetes</a> .  Esto no se recomienda, pero estamos hablando de una <i>aplicación regular que vive en un clúster</i> .  En el caso de Addon-operator, una aplicación es una gran cantidad de implementaciones dispersas en clústeres, y la actualización automática es muy útil y simplifica la vida. <br><br>  Los canales ayudan <b>en las pruebas</b> : si hay un clúster auxiliar, puede configurarlo en el canal del <code>stage</code> y actualizarlo antes de desplegarlo en <code>ea</code> y canales <code>stable</code> .  Si se produce un error con el clúster en el canal <code>ea</code> , puede cambiarlo a <code>stable</code> mientras se lleva a cabo una investigación del problema con este clúster.  Si el clúster se retira del soporte activo, cambia a su canal "congelado", por ejemplo, <code>freeze-2019-03-20</code> . <br><br>  Además de actualizar los ganchos y los gráficos de Helm, es posible que deba <b>actualizar un componente de terceros</b> .  Por ejemplo, notó un error en el exportador de nodos condicional e incluso descubrió cómo parcharlo.  Luego abrimos PR y esperamos que una nueva versión pase por todos los clústeres y aumente la versión de la imagen.  Para no esperar indefinidamente, puede recopilar su exportador de nodos y cambiar a él antes de aceptar el RP. <br><br>  En general, esto se puede hacer sin Addon-operator, pero con Addon-operator el módulo para instalar node-exporter estará visible en un repositorio, puede mantener el Dockerfile para construir su imagen allí mismo, se hace más fácil para todos los participantes en el proceso comprender que sucede ... Y si hay varios grupos, ¡será más fácil probar tu PR y enrollar una nueva versión! <br><br>  Esta organización de actualizaciones de componentes funciona con éxito con nosotros, pero puede implementar cualquier otro esquema adecuado, porque <b>en este caso Addon-operator es un archivo binario simple</b> . <br><br><h2>  Conclusión </h2><br>  Los principios implementados en Addon-operator le permiten construir un proceso transparente de creación, prueba, instalación y actualización de complementos en un clúster, similar a los procesos de desarrollo de aplicaciones ordinarias. <br><br>  Los complementos para Addon-operator en el formato de módulos (Helm-chart + hooks) se pueden cargar al público.  Nosotros, la compañía Flant, planeamos exponer nuestros logros durante el verano en forma de tales adiciones.  Únase al desarrollo en GitHub ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">shell-operator</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><b>addon-operator</b></a> ), intente hacer su adición basada en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ejemplos</a> y <a href="">documentación</a> , ¡espere noticias sobre Habré y en nuestro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">canal de YouTube</a> ! <br><br>  <i><b>ACTUALIZADO (14 de junio)</b> : si tiene colegas de habla inglesa que puedan estar interesados ​​en el operador adicional, entonces el anuncio correspondiente para ellos está disponible en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nuestro blog en Medium</a> .</i> <br><br><h2>  PS </h2><br>  Lea también en nuestro blog: <br><br><ul><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Extendiendo y complementando Kubernetes (revisión y video informe)</a> "; </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Presentación del operador de shell: hacer que los operadores de Kubernetes sean aún más fáciles</a> ". </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/455543/">https://habr.com/ru/post/455543/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../455529/index.html">Invertir y piratear el HDD externo de autocifrado de Aigo. Parte 2: Dumping con Cypress PSoC</a></li>
<li><a href="../455533/index.html">Bubble Physics: A Search for Foam Destruction Mechanism</a></li>
<li><a href="../455535/index.html">Administrar certificados SSL / TLS en las nubes y contenedores, no trabajo humano</a></li>
<li><a href="../455537/index.html">Amplia optimización de búsqueda: cómo procesar un gráfico con 10 mil millones de estados</a></li>
<li><a href="../455539/index.html">Psíquicos móviles: 10 datos nuevos sobre cómo los dispositivos portátiles lo están mirando</a></li>
<li><a href="../455545/index.html">Construyendo procesos desde cero: del caos al orden</a></li>
<li><a href="../455547/index.html">Internet de las cosas en ruso. Baseband Hotel LoRaWAN para propietarios de RTL-SDR</a></li>
<li><a href="../455549/index.html">Cómo usar grupos de Facebook para promocionar: crear una web</a></li>
<li><a href="../455553/index.html">Luchamos con Msg demasiado grande en aplicaciones Elm</a></li>
<li><a href="../455555/index.html">Pieza para el gerente mecánico</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>