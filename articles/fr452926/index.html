<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßóüèΩ ü§∂üèº üë©üèΩ‚Äçüíª Des tests statiques ou sauvez le soldat Ryan ü§∏üèæ üë®üèΩ‚ÄçüöÄ ‚ôâÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Une version se glisse souvent inaper√ßue. Et toute erreur qui a √©t√© soudainement d√©couverte devant lui nous menace d'un d√©calage des d√©lais, des hotfix...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Des tests statiques ou sauvez le soldat Ryan</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/playrix/blog/452926/">  Une version se glisse souvent inaper√ßue.  Et toute erreur qui a √©t√© soudainement d√©couverte devant lui nous menace d'un d√©calage des d√©lais, des hotfix, du travail jusqu'au matin et des nerfs √©puis√©s.  Quand une telle ru√©e a commenc√© √† se produire syst√©matiquement, nous avons r√©alis√© que vous ne pouvez plus vivre comme √ßa.  Il a √©t√© d√©cid√© de d√©velopper un syst√®me de validation complet pour sauver <s>le</s> d√©veloppeur <s>ordinaire de Ryan</s> , Artyom, qui est rentr√© chez lui avant 21 h, ou √† 10 ou √† 11 heures ... vous comprenez.  L'id√©e √©tait que le d√©veloppeur d√©couvre l'erreur alors que les modifications n'avaient pas encore atteint le r√©f√©rentiel, et lui-m√™me n'a pas perdu le contexte de la t√¢che. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e0c/050/6ad/e0c0506adfa607df0102904b82c0d96a.png"></div><br>  Aujourd'hui, les modifications apport√©es sont soigneusement v√©rifi√©es d'abord localement, puis avec une s√©rie de tests d'int√©gration sur la ferme d'assemblage.  Dans cet article, nous parlerons de la premi√®re √©tape de la v√©rification - les tests statiques, qui surveillent l'exactitude des ressources et analysent le code.  Il s'agit du premier sous-syst√®me de la cha√Æne et il repr√©sente la majeure partie des erreurs trouv√©es. <br><a name="habracut"></a><br><h2>  Comment tout a commenc√© </h2><br>  Le processus manuel de v√©rification du jeu avant la sortie a commenc√© dans QA une semaine et demie avant la sortie.  Naturellement, les bogues qui sont √† ce stade doivent √™tre corrig√©s d√®s que possible. <br><br>  En raison du manque de temps pour une bonne solution, une ¬´b√©quille¬ª temporaire est ajout√©e, qui prend alors racine pendant longtemps et est entour√©e d'autres solutions peu populaires. <br><br>  Tout d'abord, nous avons d√©cid√© d'automatiser la recherche d'erreurs apparentes: plantages, incapacit√© √† terminer l'ensemble principal des actions du jeu (ouvrir un magasin, faire un achat, jouer √† un niveau).  Pour ce faire, le jeu d√©marre dans un mode de jeu automatique sp√©cial et si quelque chose s'est mal pass√©, nous le saurons juste apr√®s avoir pass√© le test sur notre ferme. <br><br>  Mais la plupart des erreurs que les testeurs et notre test de fum√©e automatis√© ont constat√©es √©taient le manque de ressources ou des param√®tres incorrects de diff√©rents syst√®mes.  Par cons√©quent, l'√©tape suivante consistait en <i>des tests statiques</i> - v√©rifier la disponibilit√© des ressources, leurs relations et leurs param√®tres sans lancer l'application.  Ce syst√®me a √©t√© lanc√© par une √©tape suppl√©mentaire sur la ferme d'assemblage et a grandement simplifi√© la recherche et la correction des erreurs.  Mais pourquoi gaspiller les ressources de la ferme d'assemblage si vous pouvez d√©tecter une erreur avant m√™me de valider et de placer le code du probl√®me dans le r√©f√©rentiel?  Cela peut √™tre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fait avec des hooks de pr√©-validation</a> , qui sont juste d√©marr√©s avant que la validation ne soit cr√©√©e et envoy√©e au r√©f√©rentiel. <br><br>  Et oui, nous sommes tellement cool que les tests statiques avant de valider et sur la ferme d'assemblage sont effectu√©s par un seul code, ce qui simplifie consid√©rablement sa prise en charge. <br><br>  Nos efforts peuvent √™tre divis√©s en trois domaines: <br><br><ul><li>  cr√©ation d'une ferme d'assemblage - l'endroit m√™me o√π tout ce qui a √©t√© collect√© et v√©rifi√© sera collect√©; </li><li>  d√©veloppement de tests statiques - v√©rification de l'exactitude des ressources, de leurs relations, lancement d'analyseurs de code; </li><li>  d√©veloppement de tests d'ex√©cution - lancement de l'application en mode lecture automatique. </li></ul><br>  Une t√¢che distincte consistait √† organiser le lancement des tests sur la machine par le d√©veloppeur.  Il √©tait n√©cessaire de minimiser le temps d'ex√©cution localement (le d√©veloppeur n'a pas √† attendre 10 minutes pour valider une ligne) et de s'assurer que chaque syst√®me qui effectue les modifications a install√© notre syst√®me. <br><br><h2>  De nombreuses exigences - un seul syst√®me </h2><br>  Pendant le d√©veloppement, il y a tout un ensemble d'assemblages qui peuvent √™tre utiles: avec et sans tricheurs, b√™ta ou alpha, iOS ou Android.  Dans chaque cas, diff√©rentes ressources, param√®tres ou m√™me code diff√©rent peuvent √™tre n√©cessaires.  L'√©criture de scripts pour des tests statiques pour chaque assemblage possible entra√Æne un syst√®me complexe avec de nombreux param√®tres.  En plus d'√™tre difficile √† entretenir et √† modifier, chaque projet dispose √©galement de son propre jeu de v√©los √† b√©quille. <br><br>  Par essais et erreurs, nous sommes arriv√©s √† un syst√®me, chaque test dans lequel peut prendre en compte le contexte de lancement et d√©cider de l'ex√©cuter ou non, quoi exactement et comment v√©rifier.  Au d√©but des tests, nous avons identifi√© trois propri√©t√©s principales: <br><br><ul><li>  type d'assemblage: pour les ressources de publication et de d√©bogage, les contr√¥les seront diff√©rents en termes de rigueur, d'exhaustivit√© de la couverture, ainsi que de param√®tres pour les identifiants et la v√©rification des fonctionnalit√©s disponibles; </li><li>  plate-forme: ce qui est valide pour Android peut √™tre incorrect pour iOS, les ressources sont √©galement collect√©es diff√©remment et toutes les ressources de la version Android ne seront pas dans iOS et vice versa; </li><li>  emplacement de lancement: o√π exactement allons-nous lancer - sur l'agent de build o√π tous les tests disponibles sont n√©cessaires ou sur l'ordinateur de l'utilisateur o√π la liste des startups doit √™tre minimis√©e. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e86/9b4/a61/e869b4a61b7f46ba9d545058baa4af5a.png"></div><br><h2>  Syst√®me de test statique </h2><br>  Le c≈ìur du syst√®me et l'ensemble de base des tests statiques sont impl√©ment√©s en python.  La base n'est que quelques entit√©s: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d09/e44/1fd/d09e441fd62385fb616c3875cdc67a4d.png"></div><br>  <i>Le contexte de test</i> est un concept √©tendu.  Il stocke √† la fois les param√®tres de construction et de lancement, dont nous avons parl√© ci-dessus, ainsi que les m√©ta-informations que les tests remplissent et utilisent. <br><br>  Vous devez d'abord comprendre quels tests ex√©cuter.  Pour cela, la m√©ta-information contient les types de ressources qui nous int√©ressent sp√©cifiquement dans ce lancement.  Les types de ressources sont d√©termin√©s par des tests enregistr√©s dans le syst√®me.  Un test peut √™tre ¬´associ√©¬ª √† un ou plusieurs types, et si, au moment de la validation, il s'av√®re que les fichiers que ce test v√©rifie ont chang√©, alors la ressource associ√©e a chang√©.  Cela convient parfaitement √† notre id√©ologie - pour ex√©cuter localement le moins de v√©rifications possible: si les fichiers dont le test est responsable n'ont pas chang√©, vous n'avez pas besoin de l'ex√©cuter. <br><br>  Par exemple, il y a une description du poisson, dans laquelle le mod√®le 3D et la texture sont indiqu√©s. Si le fichier de description a chang√©, il est v√©rifi√© que le mod√®le et la texture qui y sont indiqu√©s existent.  Dans d'autres cas, il n'est pas n√©cessaire d'effectuer une v√©rification du poisson. <br><br>  D'un autre c√¥t√©, changer une ressource peut n√©cessiter des changements et des entit√©s en fonction: si l'ensemble des textures stock√©es dans nos fichiers xml a chang√©, alors il est n√©cessaire de v√©rifier des mod√®les 3D suppl√©mentaires, car il peut s'av√©rer que la texture n√©cessaire au mod√®le est supprim√©e.  Les optimisations d√©crites ci-dessus ne sont appliqu√©es que localement sur la machine de l'utilisateur au moment de la validation, et lors du lancement sur la ferme d'assemblage, il est suppos√© que tous les fichiers ont chang√© et nous ex√©cutons tous les tests. <br><br>  Le probl√®me suivant est la d√©pendance de certains tests par rapport √† d'autres: il est impossible de v√©rifier le poisson avant de trouver toutes les textures et mod√®les.  Par cons√©quent, nous avons divis√© toute l'ex√©cution en deux √©tapes: <br><br><ul><li>  pr√©paration du contexte </li><li>  v√©rification </li></ul><br>  Dans un premier temps, le contexte est rempli d'informations sur les ressources trouv√©es (dans le cas des poissons, avec des identifiants de motifs et de textures).  Dans la deuxi√®me √©tape, en utilisant les informations stock√©es, v√©rifiez simplement si la ressource souhait√©e existe.  Un contexte simplifi√© est pr√©sent√© ci-dessous. <br><br><pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VerificationContext</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, app_path, build_type, platform, changed_files=None)</span></span></span><span class="hljs-function">:</span></span>       self.__app_path = app_path       self.__build_type = build_type       self.__platform = platform       <span class="hljs-comment"><span class="hljs-comment">#          self.__modified_resources = set()       self.__expected_resources = set()       #      ,              self.__changed_files = changed_files       # -  ,          self.__resources = {} def expect_resources(self, resources):   self.__expected_resources.update(resources) def is_resource_expected(self, resource):   return resource in self.__expected_resources def register_resource(self, resource_type, resource_id, resource_data=None):   self.__resources.setdefault(resource_type, {})[resource_id] = resource_data def get_resource(self, resource_type, resource_id):   if resource_type not in self.__resources or resource_id not in self.__resources[resource_type]:       return None, None   return resource_id, self.__resources[resource_type][resource_id]</span></span></code> </pre> <br>  Apr√®s avoir d√©termin√© tous les param√®tres qui affectent le lancement du test, nous avons r√©ussi √† cacher toute la logique √† l'int√©rieur de la classe de base.  Dans un test sp√©cifique, il reste √† √©crire uniquement le test lui-m√™me et les valeurs n√©cessaires pour les param√®tres. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestCase</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span>  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, name, context, build_types=None, platforms=None, predicate=None,               expected_resources=None, modified_resources=None)</span></span></span><span class="hljs-function">:</span></span>      self.__name = name      self.__context = context      self.__build_types = build_types      self.__platforms = platforms      self.__predicate = predicate      self.__expected_resources = expected_resources      self.__modified_resources = modified_resources      <span class="hljs-comment"><span class="hljs-comment">#               #   ,          self.__need_run = self.__check_run()      self.__need_resource_run = False  @property  def context(self):      return self.__context  def fail(self, message):      print('Fail: {}'.format(message))  def __check_run(self):      build_success = self.__build_types is None or self.__context.build_type in self.__build_types      platform_success = self.__platforms is None or self.__context.platform in self.__platforms      hook_success = build_success      if build_success and self.__context.is_build('hook') and self.__predicate:          hook_success = any(self.__predicate(changed_file) for changed_file in self.__context.changed_files)      return build_success and platform_success and hook_success  def __set_context_resources(self):      if not self.__need_run:          return      if self.__modified_resources:          self.__context.modify_resources(self.__modified_resources)      if self.__expected_resources:          self.__context.expect_resources(self.__expected_resources)   def init(self):      """        ,                    ,          """      self.__need_resource_run = self.__modified_resources and any(self.__context.is_resource_expected(resource) for resource in self.__modified_resources)  def _prepare_impl(self):      pass  def prepare(self):      if not self.__need_run and not self.__need_resource_run:          return      self._prepare_impl()  def _run_impl(self):      pass  def run(self):      if self.__need_run:          self._run_impl()</span></span></code> </pre> <br>  Pour revenir √† l'exemple des poissons, nous avons besoin de deux tests, dont l'un trouve les textures et les enregistre en contexte, l'autre recherche les textures pour les mod√®les trouv√©s. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VerifyTexture</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TestCase)</span></span></span><span class="hljs-class">:</span></span>  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, context)</span></span></span><span class="hljs-function">:</span></span>      super(VerifyTexture, self).__init__(<span class="hljs-string"><span class="hljs-string">'VerifyTexture'</span></span>, context,                                          build_types=[<span class="hljs-string"><span class="hljs-string">'production'</span></span>, <span class="hljs-string"><span class="hljs-string">'hook'</span></span>],                                          platforms=[<span class="hljs-string"><span class="hljs-string">'windows'</span></span>, <span class="hljs-string"><span class="hljs-string">'ios'</span></span>],                                          expected_resources=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>,                                          modified_resources=[<span class="hljs-string"><span class="hljs-string">'Texture'</span></span>],                                          predicate=<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> file_path: os.path.splitext(file_path)[<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-string"><span class="hljs-string">'.png'</span></span>)  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepare_impl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span>      texture_dir = os.path.join(self.context.app_path, <span class="hljs-string"><span class="hljs-string">'resources'</span></span>, <span class="hljs-string"><span class="hljs-string">'textures'</span></span>)      <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> root, dirs, files <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.walk(texture_dir):          <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> tex_file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> files:              self.context.register_resource(<span class="hljs-string"><span class="hljs-string">'Texture'</span></span>, tex_file) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VerifyModels</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TestCase)</span></span></span><span class="hljs-class">:</span></span>  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, context)</span></span></span><span class="hljs-function">:</span></span>      super(VerifyModels, self).__init__(<span class="hljs-string"><span class="hljs-string">'VerifyModels'</span></span>, context,                                         expected_resources=[<span class="hljs-string"><span class="hljs-string">'Texture'</span></span>],                                         predicate=<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> file_path: os.path.splitext(file_path)[<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-string"><span class="hljs-string">'.obj'</span></span>)  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_run_impl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span>      models_descriptions = etree.parse(os.path.join(self.context.app_path, <span class="hljs-string"><span class="hljs-string">'resources'</span></span>, <span class="hljs-string"><span class="hljs-string">'models.xml'</span></span>))      <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> model_xml <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> models_descriptions.findall(<span class="hljs-string"><span class="hljs-string">'.//Model'</span></span>):          texture_id = model_xml.get(<span class="hljs-string"><span class="hljs-string">'texture'</span></span>)          texture = self.context.get_resource(<span class="hljs-string"><span class="hljs-string">'Texture'</span></span>, texture_id)          <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> texture <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>:              self.fail(<span class="hljs-string"><span class="hljs-string">'Texture for model {} was not found: {}'</span></span>.format(model_xml.get(<span class="hljs-string"><span class="hljs-string">'id'</span></span>), texture_id))</code> </pre> <br><h2>  R√©partition du projet </h2><br>  Le d√©veloppement de jeux dans Playrix s'effectue sur son propre moteur et, par cons√©quent, tous les projets ont une structure de fichiers et un code similaires utilisant les m√™mes r√®gles.  Par cons√©quent, de nombreux tests g√©n√©raux sont √©crits une seule fois et figurent dans le code g√©n√©ral.  Il suffit que les projets mettent √† jour la version du syst√®me de test et connectent un nouveau test. <br><br>  Pour simplifier l'int√©gration, nous avons √©crit un runner qui re√ßoit le fichier de configuration et les tests de conception (√† leur sujet plus tard).  Le fichier de configuration contient des informations de base sur lesquelles nous avons √©crit ci-dessus: type d'assemblage, plate-forme, chemin d'acc√®s au projet. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Runner</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span>  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config_str, setup_function)</span></span></span><span class="hljs-function">:</span></span>      self.__tests = []      config_parser = RawConfigParser()      config_parser.read_string(config_str)      app_path = config_parser.get(<span class="hljs-string"><span class="hljs-string">'main'</span></span>, <span class="hljs-string"><span class="hljs-string">'app_path'</span></span>)      build_type = config_parser.get(<span class="hljs-string"><span class="hljs-string">'main'</span></span>, <span class="hljs-string"><span class="hljs-string">'build_type'</span></span>)      platform = config_parser.get(<span class="hljs-string"><span class="hljs-string">'main'</span></span>, <span class="hljs-string"><span class="hljs-string">'platform'</span></span>)      <span class="hljs-string"><span class="hljs-string">'''      get_changed_files         CVS      '''</span></span>      changed_files = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> build_type != <span class="hljs-string"><span class="hljs-string">'hook'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> get_changed_files()      self.__context = VerificationContext(app_path, build_type, platform, changed_files)      setup_function(self)  @property  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">context</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span>      <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.__context  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add_test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, test)</span></span></span><span class="hljs-function">:</span></span>      self.__tests.append(test)  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span>      <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> test <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.__tests:          test.init()      <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> test <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.__tests:          test.prepare()      <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> test <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.__tests:          test.run()</code> </pre> <br>  La beaut√© du fichier de configuration est qu'il peut √™tre g√©n√©r√© sur la ferme d'assemblage pour diff√©rents assemblages en mode automatique.  Mais passer des param√®tres pour tous les tests via ce fichier peut ne pas √™tre tr√®s pratique.  Pour ce faire, il existe un fichier de configuration sp√©cial qui est stock√© dans le r√©f√©rentiel du projet et des listes de fichiers ignor√©s, des masques de recherche dans le code, etc., y sont √©crits. <br><br><div class="spoiler">  <b class="spoiler_title">Exemple de fichier de configuration</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">[main] app_path = {app_path} build_type = production platform = ios</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Exemple d'optimisation de XML</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">root</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VerifySourceCodepage</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">allow_utf8</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">allow_utf8Bom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autofix_path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ci/autofix"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">IgnoreFiles</span></span></span><span class="hljs-tag">&gt;</span></span>*android/tmp/*<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">IgnoreFiles</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VerifySourceCodepage</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VerifyCodeStructures</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Checker</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"NsStringConversion"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Checker</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LogConstructions"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VerifyCodeStructures</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">root</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></div></div><br>  En plus de la partie g√©n√©rale, les projets ont leurs propres particularit√©s et diff√©rences; par cons√©quent, il existe des ensembles de tests de projet qui sont connect√©s au syst√®me via la configuration du runner.  Pour le code des exemples, quelques lignes suffiront pour s'ex√©cuter: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(runner)</span></span></span><span class="hljs-function">:</span></span>  runner.add_test(VerifyTexture(runner.context))  runner.add_test(VerifyModels(runner.context)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>  raw_config = <span class="hljs-string"><span class="hljs-string">'''  [main]  app_path = {app_path}  build_type = production  platform = ios  '''</span></span>  runner = Runner(raw_config, setup)  runner.run()</code> </pre> <br><h2>  R√¢teau collect√© </h2><br>  Bien que python lui-m√™me soit multiplateforme, nous avons r√©guli√®rement eu des probl√®mes avec le fait que les utilisateurs ont leur propre environnement unique, dans lequel ils peuvent ne pas avoir la version que nous attendons, plusieurs versions, ou aucun interpr√®te du tout.  Par cons√©quent, cela ne fonctionne pas comme pr√©vu ou ne fonctionne pas du tout.  Il y a eu plusieurs it√©rations pour r√©soudre ce probl√®me: <br><br><ol><li>  Python et tous les packages sont install√©s par l'utilisateur.  Mais il y a deux ¬´mais¬ª: tous les utilisateurs ne sont pas des programmeurs et l'installation via pip install pour les concepteurs, et pour les programmeurs aussi, peut √™tre un probl√®me. </li><li>  Il existe un script qui installe tous les packages n√©cessaires.  C'est d√©j√† mieux, mais si l'utilisateur a install√© le mauvais python, des conflits peuvent survenir dans le travail. </li><li>  Fourniture de la version correcte de l'interpr√©teur et des d√©pendances du stockage d'artefacts (Nexus) et ex√©cution de tests dans un environnement virtuel. </li></ol><br>  Un autre probl√®me est la performance.  Plus il y a de tests, plus la modification est v√©rifi√©e sur l'ordinateur de l'utilisateur.  Tous les quelques mois, il y a un profilage et une optimisation des goulots d'√©tranglement.  Le contexte a donc √©t√© am√©lior√©, un cache pour les fichiers texte est apparu, les m√©canismes des pr√©dicats ont √©t√© am√©lior√©s (d√©terminant que ce fichier est int√©ressant pour le test). <br><br>  Et puis il ne reste plus qu'√† r√©soudre le probl√®me de la fa√ßon d'impl√©menter le syst√®me sur tous les projets et de forcer tous les d√©veloppeurs √† inclure des hooks d'occasion, mais c'est une histoire compl√®tement diff√©rente ... <br><br><h2>  Conclusion </h2><br>  Pendant le processus de d√©veloppement, nous avons dans√© sur le rake, nous nous sommes battus, mais nous avons tout de m√™me un syst√®me qui nous permet de trouver des erreurs lors de la validation, de r√©duire le travail des testeurs et les t√¢ches avant la publication concernant la texture manquante appartenaient au pass√©.  Pour un bonheur complet, une simple configuration de l'environnement et l'optimisation des tests individuels ne suffisent pas, mais les golems du d√©partement ci y travaillent dur. <br><br>  Un exemple complet du code utilis√© comme exemples dans l'article peut √™tre trouv√© dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">notre r√©f√©rentiel</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr452926/">https://habr.com/ru/post/fr452926/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr452910/index.html">Bonjour, Habr! Bonjour Tercon</a></li>
<li><a href="../fr452914/index.html">ML sur Scala avec le sourire, pour ceux qui n'ont pas peur de l'exp√©rimentation</a></li>
<li><a href="../fr452916/index.html">Levez-vous et partez. Chirurgie vert√©brale: quand faire, ce qui est dangereux</a></li>
<li><a href="../fr452922/index.html">Tables de grille CSS flexibles</a></li>
<li><a href="../fr452924/index.html">Ce que vous devez faire pour emp√™cher le vol de votre compte Google</a></li>
<li><a href="../fr452928/index.html">Nous restaurons les machines virtuelles √† partir du magasin de donn√©es initialis√© par erreur. L'histoire d'un non-sens avec une fin heureuse</a></li>
<li><a href="../fr452938/index.html">Les pistolets de l'imprimante 3D sont de retour, et maintenant ils ne peuvent plus √™tre arr√™t√©s</a></li>
<li><a href="../fr452942/index.html">GeekBrains organise 12 r√©unions en ligne gratuites avec des experts en programmation</a></li>
<li><a href="../fr452944/index.html">Quel sera le "Dialogue" des linguistes et des sp√©cialistes de l'analyse des donn√©es</a></li>
<li><a href="../fr452946/index.html">Relire la ¬´philosophie de programmation de Windows 95 / NT¬ª de Lou Greenaw</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>