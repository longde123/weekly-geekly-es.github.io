<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏼‍🚀 🌐 🧙🏻 Comment les machines communiquent: protocole Modbus 🏴 🍠 👨🏾‍⚕️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le protocole Modbus est le protocole industriel le plus courant pour la communication M2M . Il s'agit d'une norme de facto et est pris en charge par p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment les machines communiquent: protocole Modbus</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/advantech/blog/450234/"><div style="text-align:center;"><img width="500" src="https://habrastorage.org/webt/bb/c7/yu/bbc7yu_iqs8ucr9ofnja0lv48fm.png"></div><br>  Le protocole Modbus est le protocole industriel le plus courant pour la communication <abbr title="Machine à machine">M2M</abbr> .  Il s'agit d'une norme de facto et est pris en charge par presque tous les fabricants d'équipements industriels. <br><br>  En raison de sa polyvalence et de son ouverture, la norme permet l'intégration d'équipements de différents fabricants.  Modbus est utilisé pour collecter les lectures des capteurs, contrôler les relais et contrôleurs, surveiller, etc. <br><br>  Dans l'article, nous analyserons la mise en œuvre du protocole Modbus, les formats de données, les logiciels pour travailler avec le protocole.  Essayons de lire les données de l'appareil dans la pratique. <br><a name="habracut"></a><br><h2>  Histoire de Modbus </h2><br>  Modbus a été introduit en 1979 par Modicon (aujourd'hui Schneider Electric).  Il s'agissait d'un standard ouvert fonctionnant sur l'interface RS-232.  Plus tard, des implémentations de protocole pour les interfaces RS-485 et Modbus TCP sont apparues.  Le protocole a rapidement gagné en popularité et de nombreux fabricants ont commencé à l'implémenter dans leurs appareils. <br><br>  Plus tard, les droits du protocole ont été transférés à l'organisation à but non lucratif <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Modbus Organisation</a> , qui possède jusqu'à aujourd'hui la norme. <br><br>  La norme Modbus utilise une terminologie dérivée de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">logique à relais</a> .  Ainsi, par exemple, certains registres sont appelés bobines (bobine anglaise). <br><br><h2>  Niveau physique </h2><br><img src="https://habrastorage.org/webt/m5/34/_z/m534_zwjmv1mjx1rl0b1n-soqew.png"><br><br><ul><li>  <b>Les RS-232/422/485</b> sont des interfaces série largement utilisées dans l'industrie.  Les interfaces RS-422/485 fournissent une gamme de signaux jusqu'à 1200 mètres.  Protocoles Modbus RTU / ASCII utilisés </li><li>  <b>Réseaux TCP / IP</b> - toutes les interfaces Ethernet peuvent être un canal de transmission de données physiques.  Utilisation du protocole Modbus TCP </li></ul><br><h2>  Niveau logique </h2><br><img src="https://habrastorage.org/webt/dn/mb/cx/dnmbcxephexiyanr-ipj70jvx58.png"><br>  <font color="999999">Différences du protocole Modbus</font> <br><br><h4>  Modbus ASCII </h4><br>  Les données sont encodées avec des caractères de la table ASCII et transmises au format hexadécimal.  Le début de chaque paquet est indiqué par deux points, et la fin par un retour chariot et un saut de ligne.  Cela permet au protocole d'être utilisé sur des lignes avec des délais plus longs et des équipements avec des temporisateurs moins précis. <br><br><h4>  Modbus RTU </h4><br>  Dans le protocole Modbus RTU, les données sont codées au format binaire et un intervalle de temps sert de séparateur de paquets.  Ce protocole est essentiel aux retards et ne peut pas fonctionner, par exemple, sur les lignes de modem.  Dans le même temps, la surcharge pour le transfert de données est moindre qu'en Modbus ASCII, car la longueur du message est moindre. <br><br><h4>  Modbus TCP </h4><br>  La structure des paquets est similaire à Modbus RTU, les données sont également codées au format binaire et emballées dans un paquet TCP normal pour la transmission sur les réseaux IP.  La vérification d'intégrité utilisée dans Modbus RTU n'est pas appliquée, car TCP a déjà son propre mécanisme de contrôle d'intégrité. <br><br><h2>  Format du paquet </h2><br><img src="https://habrastorage.org/webt/l2/r0/0n/l2r00nqrxcfnjpcabmcqgo0kpx0.png"><br>  <font color="999999">Formats de packages pour diverses implémentations Modbus</font> <br><br>  Tous les appareils Modbus communiquent selon le modèle maître-esclave.  Les demandes ne peuvent être lancées que par le périphérique maître, les esclaves ne peuvent répondre qu'aux demandes et ne peuvent pas démarrer le transfert de données par eux-mêmes.  Selon l'implémentation du protocole, les en-têtes de paquets sont différents.  Voici les principaux composants du package qu'il est important de connaître: <br><br>  <b>ADU (Application Data Unit)</b> - l'ensemble du module Modbus, avec tous les en-têtes, PDU, somme de contrôle, adresse et jetons.  Elle diffère selon la mise en œuvre du protocole. <br><br>  <b>PDU (unité de données de protocole)</b> - la partie principale du package, la même pour toutes les implémentations du protocole.  Contient la charge utile elle-même. <br><br>  Adresse du <b>périphérique</b> - l'adresse du destinataire, c'est-à-dire le périphérique esclave.  Jusqu'à 247 appareils peuvent être situés dans un segment d'un réseau Modbus.  Seuls les esclaves ont des adresses différentes, le maître n'a pas d'adresse.  L'adresse «0» est utilisée pour les demandes de diffusion du maître, tandis que les esclaves ne peuvent pas répondre à ces paquets de diffusion. <br><br>  <b>Checksum</b> - algorithmes d'intégrité des paquets.  Modbus RTU et ASCII utilisent 2 octets de somme de contrôle.  Modbus RTU utilise l'algorithme CRC16, tandis que Modbus ASCII utilise le LRC8 plus simple et moins fiable.  Dans Modbus TCP, la somme de contrôle n'est pas ajoutée à l'ADU car l'intégrité est vérifiée au niveau TCP. <br><br>  Nous n'analyserons pas les en-têtes supplémentaires spécifiques à chaque implémentation de protocole individuelle, car cela n'est pas significatif lorsque vous travaillez avec le protocole au niveau de l'application. <br><br><h2>  Registres et fonctions Modbus </h2><br>  Sous une forme simplifiée, la structure de demande Modbus se compose d'un code de fonction (lecture / écriture) et de données qui doivent être lues ou écrites.  En même temps, les codes de fonction diffèrent pour différents types de données.  Nous analyserons ce que sont les registres et les fonctions pour travailler avec eux. <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/webt/4a/wl/ph/4awlphxzog5eg3h5ntjnfjvnkwg.png"></div><br><ul><li>  <b>Entrées discrètes</b> - Les entrées discrètes de l'appareil sont en lecture seule.  Plage d'adresses de registre: de 10001 à 19999. Elles ont une fonction "02" - lecture d'un groupe de registres </li><li>  <b>Bobines</b> - sorties discrètes de l'appareil ou valeurs internes.  Disponible pour la lecture et l'écriture.  La plage d'adresses de registre va de 20001 à 29999. Il a des fonctions: "01" - lit un groupe de registres, "05" - écrit un seul registre, "15" - écrit un groupe de registres </li><li>  <b>Registres d'entrée</b> - entrées de périphérique 16 bits.  Lecture seule.  Plage d'adresses de registres: de 30001 à 39999. Avoir une fonction: "04" - lire un groupe de registres </li><li>  <b>Registres de maintien</b> - Sorties de périphérique 16 bits ou valeurs internes.  Disponible pour la lecture et l'écriture.  La plage d'adresses de registre: de 40001 à 49999. Ont </li></ul><br>  Malgré les noms, les entrées et sorties peuvent en fait être des variables internes, stocker des compteurs, des indicateurs ou être des déclencheurs de contrôle.  Il existe également d'autres gammes de registres, mais dans la grande majorité des appareils, ils ne sont pas utilisés, nous considérerons donc quatre types principaux de registres.  Différents appareils peuvent utiliser différentes plages de registres, ou en même temps. <br><br><h2>  Exemples de travaux </h2><br>  Pour un exemple de travail avec le protocole Modbus TCP, nous utiliserons l'utilitaire de console le plus simple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">modbus-cli</a> , écrit en Ruby.  Il facilite la lecture et l'écriture de données dans les registres Modbus. <br><br>  Essayons de lire l'état des compteurs des paquets transmis sur un commutateur industriel Advantech EKI-5524SSI.  Vous devez d'abord déterminer les adresses des registres qui stockent les informations nécessaires, pour cela, consultez la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation de l'</a> appareil.  Les descriptions des registres se trouvent dans la section Table de mappage Modbus: <br><br><img src="https://habrastorage.org/webt/gv/fb/nl/gvfbnliwkc7paqecufmcym_5hcw.png"><br>  <font color="999999">Description des valeurs de registre dans la documentation du commutateur EKI</font> <br><br>  On peut voir que la valeur des paquets transmis pour un port est stockée dans quatre registres, et pour le premier port ce sont les registres 38193 à 38197. Une description est également donnée du format de stockage de données, d'où il résulte que le nombre entier de paquets transmis est stocké au format hexadécimal, et la valeur de 11223344 paquets sera écrit comme 0xAB4130, de droite à gauche. <br><br>  Faire une demande: <br><br><pre><code class="plaintext hljs">$ modbus read 192.168.0.17 38193 4 38193 0x0000 38194 0x0000 38195 0x0000 38196 0x3459</code> </pre> <br>  <b>read</b> est une commande de <b>lecture</b> .  Le programme lui-même comprend la commande de lecture spécifique à utiliser en fonction de l'adresse du registre, dans notre cas, la commande "04" sera utilisée pour lire les registres 16 bits. <br><br>  <b>192.168.0.17</b> - Adresse IP de l'appareil. <br><br>  <b>38193</b> - L'adresse de départ du registre. <br><br>  <b>4</b> - décalage par rapport à l'adresse de début.  Nous lisons quatre registres pour le port 1, comme suit de la fiche technique. <br><br>  Nous obtenons une réponse contenant les valeurs de quatre registres.  Nous voyons que le nombre de paquets est petit: 0x3459, c'est-à-dire 13401, - le commutateur a été activé récemment. <br><br><h2>  Inconvénients du protocole Modbus </h2><br>  En toute justice, il convient de mentionner les lacunes du protocole.  Depuis qu'il a été développé il y a plus de 40 ans, lorsque les performances du processeur étaient nettement inférieures et que les protocoles ont été développés sans prendre en compte la protection des données, il présente un certain nombre d'inconvénients: <br><br><ul><li>  Le protocole ne fournit pas d'authentification et de cryptage des données transmises.  Par conséquent, lors de l'utilisation de Modbus TCP, des tunnels VPN supplémentaires doivent être utilisés. </li><li>  L'esclave ne peut pas lancer le transfert de données, le maître doit donc constamment interroger les esclaves </li><li>  Le périphérique esclave ne peut pas détecter la perte de connexion avec le maître.  Ce problème découle directement du précédent. </li></ul><br>  Cependant, malgré toutes les lacunes, Modbus reste le protocole industriel le plus courant et, grâce à son ouverture, il permet de combiner facilement des appareils de différents fabricants.  Les faibles besoins en ressources permettent d'intégrer le protocole dans les appareils les plus écoénergétiques. <br><br><h2>  Matériel compatible Modbus </h2><br>  Advantech propose une large gamme d'équipements industriels avec prise en charge du protocole Modbus pour toutes les tâches: automatisation, contrôle, collecte et transmission de données. <br><br><h3>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ADAM-6000</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">WISE-4000</a> - Modules d'E / S distantes </h3><br><br><img width="300" align="left" src="https://habrastorage.org/webt/bm/b9/b-/bmb9b-docciwnsxbugs_iurafge.png">  Les modules des séries <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ADAM-6000</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">WISE-4000</a> vous permettent de contrôler à distance les entrées / sorties numériques et analogiques à l'aide du protocole Modbus TCP.  Utilisé pour contrôler les périphériques et collecter des données en mode esclave.  Ils peuvent être associés à un contrôleur logique programmable ou se connecter directement à un serveur SCADA. ⠀⠀⠀ ⠀⠀⠀⠀⠀ ⠀⠀⠀⠀⠀ ⠀⠀⠀⠀⠀ ⠀⠀⠀⠀⠀ ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀ ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀ ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀ <br><br><h3>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">EKI-1200</a> - Passerelles Modbus pour la conversion d'interface </h3><br><img width="150" align="left" src="https://habrastorage.org/webt/am/pe/59/ampe59uyvdyrklbjfex5upjfcdu.png"><br>  Pour convertir les protocoles Modbus RTU / ASCII en Modbus TCP, des passerelles Modbus sont utilisées.  Les appareils de la série <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">EKI-1200</a> ont à bord jusqu'à quatre interfaces série RS-232/422/485 et deux ports Ethernet.  Ils vous permettent de combiner des appareils avec différents protocoles en un seul réseau.  Par exemple, connectez un périphérique esclave qui prend uniquement en charge Modbus RTU via l'interface RS-485 à un segment de réseau Modbus TCP. <br><br><h3>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">APAX-5000, ADAM-3600, WISE-5000</a> - contrôleurs d'automatisation </h3><br>  Les contrôleurs prennent en charge les fonctions Modbus RTU en tant qu'esclave / maître et client / serveur Modbus TCP. <br><br><img src="https://habrastorage.org/webt/31/ko/qu/31koqu3d3rpq4z-ibxpekx6mzbk.jpeg"><br><br><h2>  Exemples d'application </h2><br><h3>  Système de surveillance des serres </h3><br>  La solution de surveillance Advantech intègre les logiciels TPC-1070H, ADAM-6024, ADAM-6050, ADAM-6060 et WebAccess dans une armoire de machine à côté des terres agricoles.  En se connectant à divers appareils sensibles, les modules ADAM-6000 peuvent recevoir des données environnementales en temps réel et surveiller la commutation des équipements pour s'assurer que la serre est dans l'environnement optimal pour la croissance des plantes.  Grâce à la fonction spéciale d'Advantech - la logique de condition graphique (GCL), les utilisateurs peuvent définir leurs propres règles de logique de contrôle et charger ces règles dans les modules d'E / S Ethernet ADAM-6000, puis les modules exécutent automatiquement des règles logiques comme les modules autonomes.  le contrôleur.  Autre fonctionnalité - le Peer-to-Peer (P2P) utilise le réseau Ethernet le plus ouvert et le plus flexible pour non seulement simplifier le processus de mise en œuvre sans contrôleur, mais également économiser sur les coûts matériels. <br><br>  Toutes les données reçues sont ensuite transmises via Ethernet à un ordinateur équipé d'un écran tactile TPC-1070H.  Doté d'un système de refroidissement sans ventilateur et d'un panneau avant conforme à IP65, le TPC-1070H est une conception robuste et compacte adaptée à un environnement d'exploitation changeant, et ses puissantes capacités informatiques peuvent gérer de grandes quantités de données.  Pour la gestion des appareils, Advantech WebAccess permet aux ingénieurs ou aux gestionnaires de visualiser, surveiller et configurer le système de surveillance via un intranet ou Internet à l'aide d'un navigateur Web standard à partir de n'importe quel appareil, y compris les tablettes et les smartphones. <br><br><img src="https://habrastorage.org/webt/10/ek/ui/10ekuin0sxm2gbaxe8ptasqze8u.png"><br><br><h3>  Surveillance du système de chauffe-eau solaire </h3><br>  La société d'ingénierie aurait dû être en mesure de contrôler la quantité d'énergie solaire, la température et le débit d'eau dans un système de chauffage à eau solaire pour une piscine de taille olympique fournie par leur panneau solaire nouvellement développé.  Ils devraient également pouvoir surveiller directement ces valeurs et leurs alarmes sur les panneaux LCD et stocker ces valeurs pour référence future. <br><br>  Les modules Adam d'Advantech ont fourni au client une solution qui utilisait des modules d'acquisition de données connectés via RS485 et un bus à deux fils pour transmettre les données de tous les capteurs.  Cette architecture système présente deux avantages principaux: d'une part, elle vous permet d'ajouter à tout moment plus de capteurs aux modules de collecte de données, et d'autre part, il est très facile d'ajouter des balises supplémentaires au logiciel pour surveiller et enregistrer ces valeurs sur un PC. <br><br><img src="https://habrastorage.org/webt/44/3z/q7/443zq73odzxkcymwcnc6m1giwe0.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr450234/">https://habr.com/ru/post/fr450234/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr450216/index.html">Vacances ou vacances?</a></li>
<li><a href="../fr450222/index.html">5 services de marketing numérique sympas non entendus en Russie</a></li>
<li><a href="../fr450228/index.html">10 mythes sur la rage</a></li>
<li><a href="../fr450230/index.html">Vous n'êtes pas google</a></li>
<li><a href="../fr450232/index.html">Systèmes de purification d'eau par osmose inverse - super ou pas?</a></li>
<li><a href="../fr450236/index.html">Comment j'ai cessé de m'inquiéter et jeté un regard différent sur les systèmes de suivi du temps</a></li>
<li><a href="../fr450238/index.html">Validation de l'interface TypeScript à l'aide de Joi</a></li>
<li><a href="../fr450240/index.html">Walmart ouvre son premier magasin axé sur l'IA</a></li>
<li><a href="../fr450242/index.html">Pourquoi aviez-vous besoin d'un autre framework PHP?</a></li>
<li><a href="../fr450244/index.html">Comment rédiger et promouvoir le Livre blanc?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>