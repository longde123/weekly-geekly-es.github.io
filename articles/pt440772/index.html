<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî∞ ü§∞üèø üêî Design orientado a dom√≠nio: uma receita para um pragm√°tico üëæ üëç üïë</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Por que os DDDs geralmente s√£o abordados do lado errado? E de que lado voc√™ quer? O que girafas e ornitorrincos t√™m a ver com tudo isso? 

 Especialme...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Design orientado a dom√≠nio: uma receita para um pragm√°tico</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/440772/"><img src="https://habrastorage.org/webt/0d/g2/_y/0dg2_yqhafnwjnnd2iqwabmrysc.jpeg"><br>  Por que os DDDs geralmente s√£o abordados do lado errado?  E de que lado voc√™ quer?  O que girafas e ornitorrincos t√™m a ver com tudo isso? <br><br>  Especialmente para Habr - uma transcri√ß√£o em texto do relat√≥rio "Design orientado a dom√≠nio: uma receita para um pragm√°tico".  O relat√≥rio foi feito na confer√™ncia DotNext .NET, mas pode ser √∫til n√£o apenas para doadores, mas para todos os interessados ‚Äã‚Äãem DDD (acreditamos que voc√™ domine alguns exemplos de c√≥digo C #).  Uma grava√ß√£o em v√≠deo do relat√≥rio tamb√©m √© anexada. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/CR9mLGN9jh0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Ol√° pessoal, meu nome √© Alexey Merson.  Vou lhe dizer o que √© Design Orientado a Dom√≠nio e qual √© sua ess√™ncia, mas primeiro, vamos descobrir por que ele √© necess√°rio. <br><br><img src="https://habrastorage.org/webt/mb/3q/2v/mb3q2vmpui3hndlrdyxscvi-ovo.jpeg"><br><br>  Martin Fowler disse: "Existem poucas coisas que s√£o menos l√≥gicas que a l√≥gica de neg√≥cios".  A girafa √© definitivamente uma dessas poucas.  A dist√¢ncia entre o c√©rebro e a laringe de uma girafa √© de apenas alguns cent√≠metros.  No entanto, o nervo que os liga atinge 4 metros.  Primeiro, ele desce pelo pesco√ßo todo, ali passa pela art√©ria e depois volta quase da mesma maneira. <br><br>  √Ä primeira vista, realmente n√£o h√° l√≥gica.  Mas este √© apenas um denso legado deixado por peixes antigos.  Nos peixes, como voc√™ sabe, n√£o h√° pesco√ßo, ent√£o esse nervo percorre o caminho ideal.  E quando os mam√≠feros apareceram ap√≥s v√°rios milh√µes de anos de refatora√ß√£o, o nervo teve que ser estendido para manter a compatibilidade com vers√µes anteriores.  Bem, n√£o remodele por causa de alguma girafa? <br><br>  Mas a girafa est√° bem, porque h√° um ornitorrinco. <br><br><img src="https://habrastorage.org/webt/j0/fv/t3/j0fvt3ieyzwdykfidna95z9w-vw.jpeg"><br>  Pense sobre isso.  O mam√≠fero  Com bico.  Vive principalmente na √°gua.  P√µe ovos.  E al√©m disso, venenoso.  Pode parecer que a √∫nica explica√ß√£o l√≥gica para sua exist√™ncia √© que ele √© da Austr√°lia. <br><br>  Mas acho que tudo √© mais banal.  O contratado simplesmente esqueceu o design e economizou com o StackOverflow, bem, ou o que havia naquele tempo. <br><img src="https://habrastorage.org/webt/hr/xm/lw/hrxmlwxz0r0fwr4xfrueljqhc7e.jpeg"><br>  Sei o que voc√™ est√° pensando agora: "Alexey, bem, voc√™ nos prometeu um Design Orientado a Dom√≠nios, e aqui est√° um tipo de" No mundo animal "!" <br><br>  Colegas, o que √© desenvolvimento?  Desenvolvimento √© quando pegamos parte do mundo real, um processo de neg√≥cios, e o transformamos em c√≥digo, ou seja, constru√≠mos um modelo de software.  Que problemas nos aguardam ao longo do caminho? <br><br>  A primeira √© a complexidade dos pr√≥prios processos de neg√≥cios, ou seja, a dificuldade de entender como os neg√≥cios funcionam, quais processos est√£o ocorrendo l√°, por que l√≥gica eles s√£o constru√≠dos. <br><br>  O segundo problema √© a implementa√ß√£o desses processos de neg√≥cios na forma de c√≥digo, o uso dos padr√µes corretos, as abordagens corretas e assim por diante.  Este tamb√©m √© um t√≥pico bastante complicado. <br><img src="https://habrastorage.org/webt/41/de/a2/41dea2lr4g73nouzxekhq8-t3qm.jpeg"><br>  Veja, os processos de neg√≥cios s√£o como aquela girafa: eles come√ßaram com os mais simples unicelulares, e ent√£o "ele" olha para voc√™, e ningu√©m entende "de onde veio" ou "como funciona". <br><br>  Para construir um modelo bem-sucedido desse processo, voc√™ deve primeiro responder √† pergunta "por qu√™?".  Por que queremos construir esse modelo?  Quais objetivos queremos alcan√ßar?  Afinal, se o cliente quisesse uma girafa empalhada, mas tivesse coragem, ele ficar√° chateado, mesmo que a digest√£o neste modelo seja implementada para um banquete para os olhos.  E o cliente perder√° n√£o apenas dinheiro e tempo, ele perder√° a confian√ßa em n√≥s como desenvolvedores e perderemos nossa reputa√ß√£o e cliente. <br><br>  Mas mesmo se descobrimos os objetivos, isso ainda n√£o garante que n√£o obteremos o ornitorrinco como resultado.  O fato √© que o objetivo √© pouco para entender.  O objetivo deve ser alcan√ßado.  E isso nos ajuda a um design orientado a dom√≠nio. <br><img src="https://habrastorage.org/webt/qb/dz/ib/qbdzibra6bypzj_36zfv-dnhlti.jpeg"><br>  O principal objetivo do Design Orientado a Dom√≠nio √© combater a complexidade dos processos de neg√≥cios e sua automa√ß√£o e implementa√ß√£o em c√≥digo.  "Dom√≠nio" √© traduzido como "dom√≠nio", e o desenvolvimento e o design, dentro da estrutura dessa abordagem, s√£o afastados do dom√≠nio. <br><br>  O Design Orientado a Dom√≠nio inclui muitas coisas.  Esse design estrat√©gico, a intera√ß√£o entre as pessoas, as abordagens da arquitetura e os padr√µes t√°ticos - esse √© um arsenal inteiro que realmente funciona e realmente ajuda a criar projetos.  Existe apenas um "mas".  Antes de come√ßar a lidar com a complexidade do Design Orientado a Dom√≠nio, voc√™ precisa aprender a lidar com a complexidade do pr√≥prio Design Orientado a Dom√≠nio. <br><br><img src="https://habrastorage.org/webt/ho/xz/9k/hoxz9k3iyujhnbgzlt8dlfzd4b0.png"><br><br>  Quando uma pessoa come√ßa a mergulhar nesse t√≥pico, uma enorme quantidade de informa√ß√£o cai sobre ele: livros grossos, um monte de artigos, padr√µes, exemplos.  Tudo isso √© confuso, e √© f√°cil, como eles dizem, n√£o notar atr√°s das √°rvores da floresta.  Certa vez, senti isso comigo mesmo, mas hoje quero compartilhar minha experi√™ncia com voc√™ e ajud√°-lo a atravessar essa selva, finalmente come√ßando a usar o Design Orientado a Dom√≠nio. <br><img src="https://habrastorage.org/webt/bm/mi/hs/bmmihsln4udtdm2d892qwb9elmo.jpeg"><br>  O termo Design Orientado a Dom√≠nio foi proposto por Eric Evans em 2003 em seu livro impronunci√°vel, que √© simplesmente chamado de Livro Azul na comunidade.  O problema √© que a primeira metade do livro Evans fala sobre padr√µes t√°ticos (todos voc√™s os conhecem: s√£o f√°bricas, entidades, reposit√≥rio, servi√ßos), e as pessoas geralmente n√£o chegam √† segunda metade.  O homem parece: tudo √© familiar, eu vou buscar o aplicativo DDD. <br><img src="https://habrastorage.org/webt/7y/xz/_r/7yxz_r9ayavde_qjite3vti58fi.jpeg"><br>  √Ä direita est√° o que acontece se voc√™ lan√ßar loucamente padr√µes t√°ticos no compilador.  Esquerda - se voc√™ usar padr√µes estrat√©gicos. <br><br><img src="https://habrastorage.org/webt/g9/bd/cj/g9bdcj-skoztnm7s3rsbxyo9w68.jpeg"><br><br>  Desde o lan√ßamento do Blue Book, uma comunidade DDD bastante forte se formou, muitas coisas foram repensadas.  Sim, e o pr√≥prio Evans admitiu que n√£o entende mais como poderia p√¥r fim a uma coisa t√£o importante quanto o design estrat√©gico. <br><br>  E 10 anos depois, em 2013, o Red Book foi publicado por Vaughn Vernon.  E neste livro, a apresenta√ß√£o j√° foi criada na ordem correta: come√ßa com o design estrat√©gico, com o b√°sico.  E quando o leitor recebe a base necess√°ria, ele j√° come√ßa a falar sobre padr√µes t√°ticos e detalhes de implementa√ß√£o. <br><br>  Geralmente, nos relat√≥rios sobre DDD, eles recomendam a leitura de Evans; na Internet, existem at√© manuais inteiros em que ordem √© necess√°rio ler os cap√≠tulos para uma imers√£o adequada.  Eu recomendo que seja mais f√°cil: comece com o Red Book, leia-o e s√≥ ent√£o passe para o Blue. <br><br>  E como o design estrat√©gico √© uma coisa t√£o importante, vamos falar sobre suas ideias principais. <br><br><h2>  "Ideias-chave do design estrat√©gico" </h2><br>  Em qualquer projeto de automa√ß√£o comercial, sempre h√° especialistas em dom√≠nio.  S√£o pessoas que entendem melhor como funcionam os processos de neg√≥cios a serem modelados.  Estes podem ser desenvolvedores l√≠deres, executivos, gerentes de topo.  Em geral, pode ser qualquer um, se ele entender os processos de neg√≥cios com os quais precisamos lidar. <br><br><img src="https://habrastorage.org/webt/c0/s1/ho/c0s1ho_prs7h-b-qbkh7_rrroaa.jpeg"><br><br>  Por outro lado, existem especialistas t√©cnicos: desenvolvedores, arquitetos que est√£o diretamente envolvidos na automa√ß√£o e implementa√ß√£o de aplicativos.  No exemplo mostrado, o cliente provavelmente queria uma ferrovia infantil, mas acabou sendo uma esp√©cie de monstro. <br><br>  Por que isso est√° acontecendo?  Como a intera√ß√£o entre especialistas t√©cnicos e especialistas em dom√≠nio em uma situa√ß√£o t√≠pica √© mais ou menos assim: existe um grande muro entre eles, e um gerente caminha ao longo do topo desse muro e primeiro tenta ouvir o que eles est√£o gritando em um lado do muro, depois tenta gritar com o melhor dos ligamentos. do outro lado da parede e assim por diante em um c√≠rculo. <br><br>  √Äs vezes, um gerente √© surdo, ent√£o toda uma cadeia de gerentes pode ser constru√≠da, o que, √© claro, n√£o contribui para o sucesso do projeto.  E como deveria ser? <br><br><img src="https://habrastorage.org/webt/wc/ov/sh/wcovshn5e04eei99ry9a9ydm4gy.jpeg"><br><br>  Deve haver intera√ß√£o constante.  Especialistas t√©cnicos, especialistas em dom√≠nio - todos os participantes do projeto devem manter constantemente a comunica√ß√£o, sincronizar, discutir metas, maneiras de alcan√ß√°-las e por que fazemos tudo isso. <br><br>  E aqui chegamos ao primeiro e, provavelmente, o ponto chave mais importante do design estrat√©gico e do Design Orientado a Dom√≠nios em geral. <br><br><img src="https://habrastorage.org/webt/tz/nl/jg/tznljgxy0ptqsd5vw-5s3ptopdk.jpeg"><br><br>  A comunica√ß√£o entre os participantes do projeto forma o que o Design Orientado a Dom√≠nio chama de linguagem onipresente.  Ele n√£o √© um no sentido de ser um para todas as ocasi√µes.  Exatamente o oposto.  √â √∫nico no sentido em que todos os participantes se comunicam nele, toda a discuss√£o ocorre em termos de um √∫nico idioma e todos os artefatos devem estar no m√°ximo em termos de um √∫nico idioma, ou seja, iniciando no TK e terminando com um c√≥digo. <br><br><h2>  Cen√°rios de neg√≥cios </h2><br>  Para uma discuss√£o mais aprofundada, precisamos de algum tipo de cen√°rio comercial.  Vamos imaginar esta situa√ß√£o: <br><br><img src="https://habrastorage.org/webt/nm/4g/ig/nm4gigksgfmt0bgp-iixvbbxow4.jpeg"><br><br>  O diretor do grupo JUG.ru chega at√© n√≥s e diz: ‚ÄúPessoal, o fluxo de relat√≥rios est√° crescendo, as pessoas, em geral, s√£o torturadas para fazer tudo manualmente ... Vamos automatizar o processo de prepara√ß√£o da confer√™ncia.‚Äù  N√≥s respondemos: "Ok!"  - e comece a trabalhar. <br><br>  O primeiro cen√°rio que automatizaremos √©: "O palestrante envia uma solicita√ß√£o de relat√≥rio em um evento espec√≠fico e adiciona informa√ß√µes sobre o relat√≥rio".  O que vemos neste cen√°rio?  O que √© um palestrante, h√° um evento e h√° um relat√≥rio, o que significa que j√° √© poss√≠vel criar o primeiro modelo de dom√≠nio. <br><br><img src="https://habrastorage.org/webt/e_/up/_t/e_up_tj4aagy5ewxeq1xwdnim_k.jpeg"><br><br>  Aqui temos um modelo de dom√≠nio: Speaker - speaker, Talk - report, Event - event.  Mas o modelo de dom√≠nio n√£o pode ser ilimitado, n√£o pode abranger tudo; caso contr√°rio, ficar√° emba√ßado e perder√° o foco; portanto, o modelo de dom√≠nio deve ser limitado por algo.  Este √© o pr√≥ximo ponto-chave. <br><br><img src="https://habrastorage.org/webt/e_/0w/w8/e_0ww82sof-x_waqu_epiihi8de.jpeg"><br><br>  O modelo de dom√≠nio e a linguagem onipresente s√£o limitados pelo contexto que o Design Orientado a Dom√≠nio chama de contexto limitado.  Ele restringe o modelo de dom√≠nio de forma que todos os conceitos contidos nele sejam inequ√≠vocos e todos entendam o que est√° em jogo. <br><br>  Se eles dizem "Usu√°rio", tudo deve ficar claro de uma s√≥ vez, deve ter um papel compreens√≠vel, um significado compreens√≠vel, n√£o deve ser algum tipo de usu√°rio abstrato do ponto de vista da ind√∫stria de TI. <br><br><img src="https://habrastorage.org/webt/fv/v-/7r/fvv-7rprlvfbdhyo81bgitdvvny.jpeg"><br><br>  No nosso caso, esse modelo de dom√≠nio √© v√°lido para o contexto da prepara√ß√£o da confer√™ncia; portanto, √© no contexto que chamaremos de "contexto de planejamento de eventos".  Mas, para o palestrante adicionar algo, alterar informa√ß√µes, ele deve, de alguma forma, fazer login, ele precisa receber alguns direitos.  E esse j√° ser√° outro contexto, "contexto de identidade", no qual haver√° algum tipo de entidade pr√≥pria: usu√°rio, fun√ß√£o, perfil. <br><br>  E veja qual √© a coisa aqui.  Quando uma pessoa efetua login no sistema e pretende inserir algum tipo de informa√ß√£o, fisicamente √© a mesma pessoa, mas em contextos diferentes, ela √© representada por entidades diferentes, e essas entidades n√£o est√£o diretamente relacionadas. <br><br>  Se pegarmos e, por exemplo, herdarmos Speaker do User, misturaremos coisas que n√£o podem ser misturadas e alguns atributos poder√£o ser misturados pela l√≥gica.  E o modelo perderia o foco no significado espec√≠fico que possui, sendo dividido em v√°rios contextos. <br><br><h2>  Demo: servi√ßo de vendas </h2><br>  Vamos discordar um pouco da teoria seca e ver o c√≥digo. <br><br>  Uma confer√™ncia n√£o √© apenas a prepara√ß√£o do conte√∫do, mas tamb√©m as vendas.  Vamos imaginar que um servi√ßo de venda de ingressos j√° tenha sido gravado e um gerente de vendas venha at√© n√≥s e diga: ‚ÄúGente!  Depois que algu√©m escreveu esse servi√ßo, vamos descobrir, algo n√£o est√° claro para mim como o desconto para clientes regulares √© considerado. ‚Äù <br><br>  Ap√≥s conversar com o gerente, descobrimos que todo o cen√°rio desse servi√ßo √© o seguinte: ao clicar em Checkout, o pre√ßo final do ingresso √© considerado, levando em considera√ß√£o o desconto regular do cliente, e o pedido entra no estado ‚ÄúAguardando pagamento‚Äù. <br><br>  O c√≥digo que analisaremos agora pode ser exibido separadamente no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reposit√≥rio</a> . <br><br>  Solu√ß√£o aberta, observe a estrutura: <br><br><img src="https://habrastorage.org/webt/hy/wl/j4/hywlj4jodqlkuhsfza7b_gglj2u.png"><br><br>  Parece que tudo parece bom: h√° Application e Core (aparentemente, as pessoas sabem sobre camadas), Reposit√≥rio ... Aparentemente, a pessoa dominou a primeira metade de Evans. <br><br>  Abra OrderCheckoutService.  O que vemos l√°?  Aqui <a href="">est√° o c√≥digo</a> : <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Checkout</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ord = _ordersRepository.GetOrder(id); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> orders = _ordersRepository.GetOrders() .Count(o =&gt; o.CustomerId == ord.CustomerId &amp;&amp; o.StateId == <span class="hljs-number"><span class="hljs-number">3</span></span> &amp;&amp; o.OrderDate &gt;= DateTime.UtcNow.AddYears(<span class="hljs-number"><span class="hljs-number">-3</span></span>)); ord.Price *= (<span class="hljs-number"><span class="hljs-number">100</span></span> - (orders &gt;= <span class="hljs-number"><span class="hljs-number">5</span></span> ? <span class="hljs-number"><span class="hljs-number">30</span></span>m : orders &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span> ? <span class="hljs-number"><span class="hljs-number">20</span></span>m : orders &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span> ? <span class="hljs-number"><span class="hljs-number">10</span></span>m : <span class="hljs-number"><span class="hljs-number">0</span></span>)) / <span class="hljs-number"><span class="hljs-number">100</span></span>; ord.StateId = <span class="hljs-number"><span class="hljs-number">1</span></span>; _ordersRepository.SaveOrder(ord); }</code> </pre> <br><br>  Observamos a linha com pre√ßo: aqui o pre√ßo muda.  Chamamos nosso gerente de vendas e dizemos: ‚ÄúAqui, em resumo, o desconto √© considerado aqui, tudo est√° claro‚Äù: <br><br><pre> <code class="cs hljs">ord.Price *= (<span class="hljs-number"><span class="hljs-number">100</span></span> - (orders &gt;= <span class="hljs-number"><span class="hljs-number">5</span></span> ? <span class="hljs-number"><span class="hljs-number">30</span></span>m : orders &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span> ? <span class="hljs-number"><span class="hljs-number">20</span></span>m : orders &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span> ? <span class="hljs-number"><span class="hljs-number">10</span></span>m : <span class="hljs-number"><span class="hljs-number">0</span></span>)) / <span class="hljs-number"><span class="hljs-number">100</span></span>;</code> </pre><br><br>  Ele olha por cima do ombro: ‚ÄúOh!  Ent√£o √© assim que o Brainfuck se parece!  E eles meio que me disseram que os caras est√£o escrevendo em C # ‚Äù. <br><br>  Obviamente, o desenvolvedor deste c√≥digo respondeu bem a uma entrevista sobre algoritmos e estruturas de dados.  Escrevi nas olimp√≠adas da escola quase no mesmo estilo.  Depois de algum tempo, usando a formata√ß√£o e a refatora√ß√£o <s>obscena</s> , descobrimos o que √© o qu√™ e explicamos ao nosso gerente de vendas que a l√≥gica √© a seguinte: se o n√∫mero de pedidos nos √∫ltimos 3 anos n√£o for menor que um, ele receber√° 10% de desconto , n√£o inferior a tr√™s - 20% e n√£o inferior a cinco - 30%.  Ele sai alegre - agora est√° claro como tudo funciona. <br><br>  Acho que muitos leram o C√≥digo Limpo de Bob Martin.  L√°, ele diz sobre a regra dos escoteiros: "O estacionamento depois de sairmos deve ser mais limpo do que era antes de chegarmos l√°".  Portanto, vamos refatorar esse c√≥digo para que pare√ßa humano e corresponda ao que falamos um pouco antes sobre linguagem onipresente e seu uso no c√≥digo. <br><br>  Aqui est√° o c√≥digo refatorado. <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DiscountCalculator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IOrdersRepository _ordersRepository; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DiscountCalculator</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IOrdersRepository ordersRepository</span></span></span><span class="hljs-function">)</span></span> { _ordersRepository = ordersRepository; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">decimal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CalculateDiscountBy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> customerId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> completedOrdersCount = _ordersRepository.GetLast3YearsCompletedOrdersCountFor(customerId); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DiscountBy(completedOrdersCount); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">decimal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DiscountBy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> completedOrdersCount</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (completedOrdersCount &gt;= <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (completedOrdersCount &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (completedOrdersCount &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre><br><br>  A primeira coisa que fazemos √© transferir o c√°lculo do desconto para um DiscountCalculator separado, no qual o m√©todo CalculateDiscountBy customerId aparece.  Tudo √© lido humanamente, tudo √© claro: o que, por que e como.  Dentro desse m√©todo, vemos que temos duas etapas globais para calcular o desconto.  Primeiro: obtemos algo do reposit√≥rio de pedidos, tudo de acordo com o caso do usu√°rio, voc√™ nem precisa entrar, se essa n√£o √© a parte que lhe interessa agora.  O fato √© que obtemos o n√∫mero de alguns pedidos conclu√≠dos, ap√≥s os quais consideramos imediatamente o segundo desconto dessa quantidade como a segunda etapa. <br><br>  Se queremos ver como isso √© considerado, vamos ao DiscountBy, e aqui quase a mesma coisa est√° escrita em ingl√™s quase humano do que nosso "tipo de c√©rebro" antes, tudo √© claro e preciso. <br><br>  A √∫nica quest√£o que pode surgir √© em que unidades o desconto √© medido.  Seria poss√≠vel adicionar a palavra "porcentagem" no nome do m√©todo, para deixar claro, mas, a partir do contexto e das figuras envolvidas, provavelmente sup√µe-se que essas s√£o porcentagens e, por brevidade, pode ser omitida.  Se quisermos ver qual era o n√∫mero de pedidos, iremos ao c√≥digo do Reposit√≥rio e veremos.  Agora n√£o faremos isso.  Em nosso servi√ßo, precisamos adicionar uma nova depend√™ncia DiscountCalculator.  E vamos ver o que acabamos na segunda vers√£o do m√©todo Checkout. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckoutV2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> orderId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> order = _ordersRepository.GetOrder(orderId); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> discount = _discountCalculator.CalculateDiscountBy(order.CustomerId); order.ApplyDiscount(discount); order.State = OrderState.AwaitingPayment; _ordersRepository.SaveOrder(order); }</code> </pre><br><br>  Veja, o m√©todo Checkout recebe orderId e, em seguida, recebe um orderId por orderId, de acordo com o CustomerId desse pedido, ele considera o desconto usando a calculadora de descontos, aplica o desconto ao pedido, define o status como AwaitingPayment e salva o pedido.  T√≠nhamos um script em russo no slide, mas aqui praticamente lemos a tradu√ß√£o desse script para o ingl√™s e tudo est√° claro, tudo √© √≥bvio. <br><br>  Voc√™ v√™ qual √© o charme?  Esse c√≥digo pode ser mostrado a qualquer pessoa: n√£o apenas programadores, mas tamb√©m QA, analistas e clientes.  Todos eles entender√£o o que est√° acontecendo, porque tudo est√° escrito em linguagem humana.  Eu uso isso em nosso projeto, realmente o controle de qualidade pode analisar algumas partes, verificar com o Wiki e entender que h√° algum tipo de erro.  Porque o Wiki diz isso, e o c√≥digo √© um pouco diferente, mas ele entende o que est√° acontecendo l√°, embora ele n√£o seja um desenvolvedor.  E da mesma maneira, podemos discutir o c√≥digo com o analista e discuti-lo em detalhes.  Eu digo: "Veja, √© assim que funciona no c√≥digo".  Nosso √∫ltimo recurso n√£o √© o Wiki, mas o c√≥digo.  Tudo funciona como est√° escrito no c√≥digo.  √â muito importante usar linguagem onipresente ao escrever c√≥digo. <br><br><img src="https://habrastorage.org/webt/-a/15/pc/-a15pcu9tfp6xjadw-98qlpcxrs.jpeg"><br><br>  Este √© o terceiro ponto-chave. <br><br>  H√° muita confus√£o sobre o Design Orientado a Dom√≠nio em coisas como Dom√≠nio, Subdom√≠nio, Contexto Limitado, como elas se relacionam com o que significam.  Parece que todo mundo est√° limitando alguma coisa, todos est√£o de alguma forma arrumados.  Mas n√£o est√° claro ent√£o qual √© a diferen√ßa, por que elas s√£o t√£o diferentes inventadas. <br><br><img src="https://habrastorage.org/webt/tp/zo/nf/tpzonf_lfbysx7pgiiqrxbiineo.jpeg"><br><br>  Dom√≠nio √© uma coisa global, √© uma √°rea de assunto global em que esse neg√≥cio em particular ganha dinheiro.  Por exemplo, para DotNext, √© uma confer√™ncia; para Pyaterochka, √© uma venda a varejo de mercadorias. <br><br>  Grandes corpora√ß√µes podem ter v√°rios dom√≠nios.  Por exemplo, a Amazon est√° envolvida na venda de mercadorias via Internet e na presta√ß√£o de servi√ßos em nuvem, essas s√£o √°reas diferentes. <br><br>  No entanto, √© algo global e n√£o pode ser automatizado diretamente, mesmo para investigar √© dif√≠cil.  Para an√°lise, o dom√≠nio √© inevitavelmente dividido em subdom√≠nios, ou seja, em subdom√≠nios. <br><br><img src="https://habrastorage.org/webt/rc/wv/qz/rcwvqzdcicpkiw57o6p1lzunmn4.jpeg"><br><br>  Subdom√≠nios s√£o partes de uma empresa que, em nossa linguagem, s√£o altamente conectadas, ou seja, s√£o algum tipo de processo l√≥gico isolado que interage entre si em algum n√≠vel principal. <br><br>  Por exemplo, se pegarmos uma loja on-line, ser√° a forma√ß√£o e o processamento de pedidos, a entrega, o trabalho com fornecedores, o marketing, a contabilidade.  Aqui est√£o algumas dessas pe√ßas - √© nisso que o neg√≥cio est√° dividido. <br><br><img src="https://habrastorage.org/webt/yc/rc/ub/ycrcubvepugwbmk-xpidrsxc1pu.jpeg"><br><br>  Do ponto de vista do DDD, os subdom√≠nios s√£o divididos em tr√™s tipos.  E aqui quero dizer mais uma coisa: geralmente em livros e artigos, o subdom√≠nio √© simplesmente reduzido a dom√≠nio, mas geralmente no caso em que √© combinado com o tipo de subdom√≠nio.  Ou seja, quando eles dizem "Dom√≠nio principal", eles significam Subdom√≠nio principal, por favor, n√£o se confunda com isso.  Isso me impressionou a princ√≠pio. <br><br>  Subdom√≠nios s√£o divididos em tr√™s tipos. <br><br><img src="https://habrastorage.org/webt/a0/vg/jh/a0vgjhuiklcpufzsw_lsdzgisnw.jpeg"><br><br>  O primeiro e mais importante √© o Core.  O n√∫cleo √© o principal subdom√≠nio, √© a vantagem competitiva da empresa, o que faz com que a empresa ganhe dinheiro, como ela difere de seus concorrentes, seu know-how, como voc√™ chama.  Se fizermos a confer√™ncia DotNext, esse √© o conte√∫do.  Voc√™s todos vieram aqui em busca de conte√∫do, se n√£o houvesse esse conte√∫do aqui, n√£o iriam ou participariam de outra confer√™ncia.  N√£o haveria DotNext no formato em que est√°. <br><br><img src="https://habrastorage.org/webt/up/dr/cc/updrcc6vh3xb0niwkpsuqnrlr-s.jpeg"><br><br>  O segundo tipo √© Subdom√≠nio de suporte.  Isso tamb√©m √© importante para ganhar dinheiro, tamb√©m √© algo sem o qual √© imposs√≠vel, mas n√£o √© algum tipo de know-how, uma vantagem competitiva real.  √â isso que o Subdom√≠nio Principal suporta.  Do ponto de vista da aplica√ß√£o do Design Orientado a Dom√≠nio, isso significa que menos esfor√ßo √© gasto no Subdom√≠nio de Suporte, todas as principais for√ßas s√£o lan√ßadas no Core. <br><br>  Um exemplo para o mesmo DotNext √© o marketing.  √â imposs√≠vel sem marketing, caso contr√°rio, ningu√©m saberia sobre a confer√™ncia, mas sem marketing de conte√∫do n√£o √© necess√°rio. <br><br><img src="https://habrastorage.org/webt/ad/in/ar/adinar6ki4kdf1xnozjylhho9ea.jpeg"><br><br>  E, finalmente, o subdom√≠nio gen√©rico.  Gen√©rico √© uma tarefa comercial t√≠pica, que, como regra, pode ser automatizada com produtos acabados ou terceirizada.  Isso √© o que tamb√©m √© necess√°rio, mas n√£o requer necessariamente uma implementa√ß√£o independente por n√≥s e, mais do que isso, geralmente ser√° uma boa ideia usar um produto de terceiros. <br><br>  Por exemplo, vendendo ingressos.  DotNext vende bilhetes atrav√©s do TimePad.  Esse subdom√≠nio √© perfeitamente automatizado pelo TimePad, e voc√™ n√£o precisa escrever um segundo TimePad. <br><br><img src="https://habrastorage.org/webt/38/xi/5c/38xi5cgogl1edatrnmd4jy6o5yg.jpeg"><br><br>  E, finalmente, contexto limitado.  O contexto limitado e o subdom√≠nio est√£o sempre em algum lugar pr√≥ximo, mas h√° uma diferen√ßa significativa entre eles.  Isso √© muito importante. <br><br><img src="https://habrastorage.org/webt/pa/xm/bo/paxmbosiaaglpdk-fc-38ouji3g.jpeg"><br><br>  H√° uma pergunta no StackExchange sobre como o contexto delimitado difere do Subdom√≠nio.  Subdom√≠nio √© um peda√ßo de neg√≥cio, um peda√ßo do mundo real, √© o conceito de um espa√ßo de declara√ß√£o de problemas.  O contexto limitado limita o modelo de dom√≠nio e a linguagem onipresente, ou seja, qual √© o resultado da modelagem e, consequentemente, o contexto limitado √© o conceito de espa√ßo de solu√ß√£o.  No processo de implementa√ß√£o do projeto, um tipo de mapeamento de Subdom√≠nios ocorre em contextos limitados. <br><br><img src="https://habrastorage.org/webt/ba/91/mi/ba91mikbrcn3l50d_k2dwedusug.jpeg"><br><br>  Um exemplo cl√°ssico: a contabilidade como um subdom√≠nio, como o processo √© mapeado, √© automatizada, por exemplo, 1C Bookkeeping, Elba ou "My business" - de alguma forma √© automatizada por algum produto.  Esse √© o contexto limitado da contabilidade, no qual h√° sua linguagem onipresente, sua pr√≥pria terminologia.  Essa √© a diferen√ßa entre eles. <br><br><img src="https://habrastorage.org/webt/fs/y1/lv/fsy1lvc6qabh0flcrli7bkxvpho.jpeg"><br><br>  Se retornarmos ao DotNext, como eu disse, os tickets ser√£o mapeados para o TimePad e o conte√∫do do nosso Subdom√≠nio Principal ser√° mapeado para um aplicativo personalizado que estamos desenvolvendo para o gerenciamento de conte√∫do. <br><br><h3>  Tamanho do contexto limitado </h3><br>  H√° um momento que levanta muitas quest√µes.  Como escolher o tamanho certo para o contexto delimitado?  Nos livros, pode-se encontrar essa defini√ß√£o: "O contexto limitado deve ser exatamente tal que a linguagem onipresente seja completa, consistente, inequ√≠voca, inequ√≠voca, consistente".  Defini√ß√£o legal, no estilo de um matem√°tico de uma piada famosa: muito precisa, mas in√∫til. <br><br>  Vamos discutir como entendemos o mesmo: se deve ser uma solu√ß√£o, um projeto ou um espa√ßo para nome - qual escala deve ser anexada ao contexto delimitado? <br><br><img src="https://habrastorage.org/webt/l8/h5/7y/l8h57y11erupofzzpnc3q6li7ei.jpeg"><br><br>  A primeira coisa que voc√™ pode ler em quase todos os lugares: idealmente, <b>um subdom√≠nio deve mapear para um contexto limitado</b> , ou seja, ser automatizado por um contexto limitado.  Parece l√≥gico, porque, al√©m de haver limita√ß√µes de um processo de neg√≥cios separado, em ambos os casos, alguns termos de neg√≥cios, um √∫nico idioma √© exibido.  Mas aqui voc√™ precisa entender que esta √© uma situa√ß√£o ideal, voc√™ n√£o ter√° necessariamente isso e n√£o √© necess√°rio tentar conseguir isso. <br><br>  Como, por um lado, o Subdom√≠nio pode ser bastante grande e v√°rios aplicativos ou servi√ßos podem ser obtidos para automatiz√°-lo; portanto, v√°rios contextos limitados correspondem a um Subdom√≠nio. <br><br>  Mas h√° uma situa√ß√£o inversa, como regra, isso √© t√≠pico para o Legacy.  Ou seja, quando eles criaram um aplicativo grande que automatiza tudo o que h√° no mundo nesta empresa, o oposto ser√° o contr√°rio.  Uma aplica√ß√£o √© um contexto limitado; √© prov√°vel que o modelo seja amb√≠guo, mas os Subdom√≠nios n√£o desapareceram disso, respectivamente, um contexto limitado corresponder√° a v√°rios Subdom√≠nios. <br><br>  Quando a arquitetura de microsservi√ßo se tornou moda, outra recomenda√ß√£o apareceu (embora n√£o se contradigam): <b>um contexto limitado por microsservi√ßo</b> .  Mais uma vez, parece l√≥gico, as pessoas realmente fazem isso.  Como o microsservi√ßo deve assumir alguma fun√ß√£o clara, que possui alta conectividade internamente, e se comunica com outros servi√ßos por meio de algum tipo de intera√ß√£o.  Se voc√™ usa uma arquitetura de microsservi√ßo, voc√™ pode seguir esta recomenda√ß√£o. <br><br>  Mas isso n√£o √© tudo.  Deixe-me lembr√°-lo mais uma vez que o Design Orientado a Dom√≠nio √© muito: sobre o idioma, sobre as pessoas.  E voc√™ n√£o pode ignorar as pessoas e fazer apenas crit√©rios t√©cnicos nesse assunto.  Portanto, escrevi o seguinte: <b>um contexto √© igual ao X-man</b> .  Eu pensava que x √© cerca de 10, mas conversamos um pouco com Igor Labutin ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">twitter.com/ilabutin</a> ) e a quest√£o permaneceu em aberto. <br><br>  Aqui √© importante entender isso: um √∫nico idioma permanece unificado enquanto todos os participantes falam, discutem e todos o entendem sem ambiguidade.  √â claro que um n√∫mero infinito de pessoas n√£o pode falar a mesma l√≠ngua.  Nossa hist√≥ria da humanidade mostra isso claramente.  De qualquer forma, alguns dialetos aparecem, alguns de seus significados, agora voc√™ pode at√© adicionar memes e assim por diante.  De uma forma ou de outra, o idioma ficar√° desfocado. <br><br>  Portanto, deve-se entender que o n√∫mero de pessoas que usam essa linguagem √∫nica e, consequentemente, participam do desenvolvimento, da automa√ß√£o, √© limitado.  Os livros tamb√©m falam sobre algumas raz√µes pol√≠ticas: se duas equipes trabalham sob a lideran√ßa de gerentes diferentes e trabalham no mesmo contexto limitado, e por alguma raz√£o esses gerentes n√£o s√£o amigos, conflitos come√ßar√£o e o foco ser√° perdido.  Portanto, ser√° muito mais simples e mais correto criar dois contextos limitados para cada comando e n√£o tentar combinar o que n√£o est√° combinado. <br><br><h2>  Arquitetura e Gerenciamento de Depend√™ncias </h2><br>  Do ponto de vista do Design Orientado a Dom√≠nio, n√£o importa realmente qual arquitetura voc√™ escolher.  Design Orientado a Dom√≠nio n√£o √© sobre isso; Design Orientado a Dom√≠nio √© sobre linguagem e comunica√ß√£o. <br><br><img src="https://habrastorage.org/webt/3r/de/2i/3rde2isfgddxyjfzswpj2nvxtbe.jpeg"><br><br>  Mas h√° um ponto importante, do ponto de vista dos crit√©rios para escolher a arquitetura que nos interessa da perspectiva do Design Orientado a Dom√≠nio: <b>nosso objetivo √© livrar ao m√°ximo a l√≥gica de neg√≥cios das depend√™ncias de terceiros</b> .  Como, assim que aparecem depend√™ncias de terceiros, a terminologia aparece, aparecem palavras que n√£o entram em um √∫nico idioma e come√ßam a desarrumar nossa l√≥gica de neg√≥cios. <br><br><img src="https://habrastorage.org/webt/nz/pw/nu/nzpwnurj_5kkbnmjo6uhosycd1u.jpeg"><br><br>  Vejamos um exemplo cl√°ssico de arquitetura: a conhecida arquitetura de tr√™s camadas.  Assim que eles n√£o chamam uma camada de dom√≠nio (aqui a camada Neg√≥cios): neg√≥cios, n√∫cleo e dom√≠nio s√£o todos iguais.  De qualquer forma, essa √© a camada na qual a l√≥gica de neg√≥cios est√° localizada e, se ela depende da camada de dados, significa que alguns conceitos da camada de dados de alguma forma fluem para a camada de dom√≠nio e a desarrumam. <br><br><img src="https://habrastorage.org/webt/ft/kh/34/ftkh34ce3zbpt26jx3v8id9vaym.jpeg"><br><br>  A arquitetura de quatro camadas √© essencialmente a mesma, a camada de dom√≠nio ainda depende e, como depende de depend√™ncias desnecess√°rias de terceiros, chegar√£o a ela. <br><br><img src="https://habrastorage.org/webt/wz/uv/ky/wzuvky-2bgljcwwarvtseclyqjy.jpeg"><br><br>  E, nesse sentido, existe uma arquitetura que permite que isso seja evitado - √© a arquitetura da cebola (‚Äúcebola‚Äù).  Sua diferen√ßa √© que consiste em camadas conc√™ntricas, as depend√™ncias v√£o de fora para o centro.  Ou seja, a camada externa pode depender de quaisquer camadas internas, a camada interna n√£o pode depender das externas. <br><br>  A camada mais externa √© a interface do usu√°rio em um sentido global (ou seja, n√£o √© necessariamente uma interface do usu√°rio humana, pode ser uma API REST ou qualquer outra coisa).  E a infraestrutura, que geralmente tamb√©m se parece com E / S, √© o mesmo banco de dados, de fato, uma camada de dados.  Todas essas coisas est√£o na camada externa.  Ou seja, devido ao qual o aplicativo de alguma forma recebe alguns dados, comandos e assim por diante, ele √© removido e a camada de dom√≠nio se livra da depend√™ncia dessas coisas. <br><br>  Em seguida, vem a camada Aplicativo - um tema bastante hol√≠stico, mas √© a camada na qual os scripts e casos de usu√°rio est√£o localizados.  Essa camada usa a camada de dom√≠nio para implementar seus conceitos. <br><br>  No centro est√° a camada de dom√≠nio.  Como vemos, ele n√£o depende mais de nada, ele se torna uma coisa em si mesmo.  E √© por isso que a camada de dom√≠nio costuma ser chamada de "n√∫cleo", porque √© o n√∫cleo, √© o que est√° no centro, o que n√£o depende de coisas de terceiros. <br><br><img src="https://habrastorage.org/webt/h4/cl/_n/h4cl_nmaowsib1bw1thjvpolr8u.jpeg"><br><br>  Uma das op√ß√µes para implementar essa arquitetura de cebola √© a arquitetura hexagonal, ou ‚Äúportas e adaptadores‚Äù.  Eu trouxe essa foto por intimida√ß√£o, n√£o vou falar sobre isso.  No final do post, h√° um link para um de um milh√£o de artigos sobre essa arquitetura, voc√™ pode ler. <br><br><h2>  Um pouco sobre padr√µes t√°ticos: Interface Separada </h2><br>  Como eu disse, em primeiro lugar, a maioria dos padr√µes t√°ticos √© familiar a todos e, em segundo lugar, o ponto principal do meu relat√≥rio √© que eles n√£o s√£o a ess√™ncia.  Mas gosto do padr√£o Separated Interface separadamente e quero falar sobre isso separadamente. <br><br>  Vamos voltar ao c√≥digo do nosso microsservi√ßo e ver o que aconteceu com o reposit√≥rio. <br><br><img src="https://habrastorage.org/webt/jl/c7/_d/jlc7_dwrkqw8mfy4zd1nibrdwti.png"><br><br>  A camada de dom√≠nio tinha <a href="">a</a> interface do <a href="">reposit√≥rio</a> IOrdersRepository.cs e sua <a href="">implementa√ß√£o,</a> OrdersRepository.cs. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">DotNext.Sales.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IOrdersRepository</span></span> { <span class="hljs-function"><span class="hljs-function">Order </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetOrder</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveOrder</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Order order</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-function">IQueryable&lt;Order&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetOrders</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> V2 int GetLast3YearsCompletedOrdersCountFor(long customerId); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> } }</span></span></code> </pre><br><br>  Aqui, adicionamos aqui um determinado m√©todo para receber pedidos nos √∫ltimos tr√™s anos GetLast3YearsCompletedOrdersCountFor. <br><br>  E eles o implementaram de alguma forma (neste caso, atrav√©s do Entity Framework, mas pode ser qualquer coisa): <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetLast3YearsCompletedOrdersCountFor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> customerId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> threeYearsAgo = DateTime.UtcNow.AddYears(<span class="hljs-number"><span class="hljs-number">-3</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _dbContext.Orders .Count(o =&gt; o.CustomerId == customerId &amp;&amp; o.State == OrderState.Completed &amp;&amp; o.OrderDate &gt;= threeYearsAgo); }</code> </pre><br><br>  Veja qual √© o problema.  O reposit√≥rio acabou na camada de dom√≠nio, sua implementa√ß√£o na camada de dom√≠nio, mas o c√≥digo, come√ßando com DateTime.UtcNow.AddYears (-3), n√£o pertence inerentemente √† camada de dom√≠nio e n√£o √© uma l√≥gica de neg√≥cios.  Sim, o LINQ o torna mais ou menos humanizado, mas se, por exemplo, houvesse consultas SQL aqui, tudo seria completamente triste. <br><br>  O significado do padr√£o Interface Separada √© que a interface de servi√ßo que usamos na l√≥gica do dom√≠nio seja declarada na camada de dom√≠nio.  Estamos falando de reposit√≥rios e servi√ßos similares, nos quais os detalhes da implementa√ß√£o desses servi√ßos n√£o s√£o l√≥gicos de neg√≥cios.  A l√≥gica de neg√≥cios √© o fato da exist√™ncia desses servi√ßos e o fato de serem chamados e usados ‚Äã‚Äãna camada de dom√≠nio.  Portanto, a interface do reposit√≥rio permanece na camada de dom√≠nio e a implementa√ß√£o √© movida para a camada de infraestrutura. <br><br>  Eu preparei outra op√ß√£o.  A interface do reposit√≥rio permanece no assembly Principal, mas a implementa√ß√£o √© movida para Infrastructure.EF. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rh/k0/b_/rhk0b_dgbqe72y--hxcx13qlqco.png"></div><br><br>  Assim, trouxemos para a infraestrutura os conceitos que n√£o eram peculiares √† camada de dom√≠nio.  Como efeito colateral, podemos substituir essa infraestrutura por outra implementa√ß√£o.  Mas esse n√£o √© o objetivo principal, o objetivo principal √©, como eu disse, livrar a l√≥gica do dom√≠nio das depend√™ncias de terceiros. <br><br><h2>  Mais uma vez sobre o idioma </h2><br>  Vamos falar de novo e de novo e de novo sobre o idioma. <br><br>  Desde o in√≠cio, criamos o modelo de dom√≠nio ‚Äúspeaker - talk - event‚Äù.  Eu acho que ningu√©m levantou nenhuma pergunta especial. <br><br>  E aqui est√° o cen√°rio com base no qual constru√≠mos este modelo de dom√≠nio: <br><br><img src="https://habrastorage.org/webt/2r/go/hp/2rgohppxhq7iqwvndfimzctuit8.jpeg"><br><br>  Veja, o script est√° em russo e o modelo de dom√≠nio est√° em ingl√™s. <br><br>  Para desenvolvedores que n√£o falam ingl√™s, √© algo com o qual voc√™ precisa conviver constantemente. <br><br><img src="https://habrastorage.org/webt/jm/3p/rf/jm3prfqcjwydo3mg2c1p0zh3olc.jpeg"><br><br>  Provavelmente, cada um de voc√™s faz esse processo constantemente: traduz do russo para o ingl√™s e vice-versa.  Aqueles que trabalham com clientes e projetos que falam ingl√™s s√£o um pouco mais f√°ceis, porque os requisitos s√£o em ingl√™s, discuss√µes com clientes em ingl√™s, como regra geral, todos os cen√°rios est√£o em ingl√™s, o c√≥digo est√° em ingl√™s e h√° apenas comunica√ß√£o dentro da equipe em russo, que cresce rapidamente em ingl√™s (cliente - cliente, pedido - pedido).  E essa carga cognitiva, essa sobrecarga, criada por uma tradu√ß√£o constante, recua um pouco. <br><br>   ,     ,        ,    .    ,    . <br><br>         1,        .   ,  ‚Äî    ,     ,          . <br><br><img src="https://habrastorage.org/webt/1e/b7/jh/1eb7jhuiy5i1ft1bsfrnu1x7_9u.jpeg"><br><br>      1. PascalCase  ,     ,     ,     <s></s>  ,      ,    , ,  - -     . <br><br>  ,  -  ? <br><br><img src="https://habrastorage.org/webt/lj/js/vd/ljjsvdrqh4v9117mps2yrelyxna.jpeg"><br><br>   ,     use case,   ,     .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> ,   .        C#,  ,  , .       ,    ,   ,  . <br><br>        ,  ,      Domain-Driven Design.      ,   ,    , ,        C#    .                    . <br><br>   ,      -  Continuous Integration.  ,       ,    , -   - .   ,     -  ,   ,  .  ,  95%      ,      ,  Continuous Integration,  , TeamCity .   . <br><br>               ,          .  N√£o.   ,           1-,  ,    .        ¬´¬ª  ,     .    ,   ,    . <br><br><img src="https://habrastorage.org/webt/qh/ff/32/qhff32udhgwxb4cav3gjjoakn4e.jpeg"><br><br>         ,   Domain-Driven Design. <br><br>  ‚Äî  ,   . Domain-Driven Design ‚Äî    ,    .  ‚Äî    ,  ,          ubiquitous language.     ,     ,   .      ,   ,      ,        . <br><br> .    ,  .    - ,      ,    ,     ,  ,     ,  ,  ,  ,      ,  ‚Äî .     . <br><br>       .      .      .      .   ,    ,      .        DSL-.        .NET-,     - ,    ,  ,  ,   .   ,     . <br><br> , -    .    ,    ,     ubiquitous language  -.     . <br><br><h2>    </h2><br><ul><li> <b>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">marshinov</a> </b> .    ,      DDD: , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">¬´   DDD, CQRS  Event Sourcing    ¬ª</a> .    ,    ,      . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  </a> ,  AutoMapper   MediatR.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  </a> ,       Domain-Driven Design,      . </li><li>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">¬´F# for fun and profit¬ª</a> ,   ,   F#  Domain-Driven Design.  ,  ,   ,    . </li><li>  , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>    ,   . </li></ul><br>   , ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  GitHub</a> . <br><br><blockquote>   DotNext: <br>   , ¬´       ,     ¬ª.   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>  <b>DotNext</b> ( <b>15-16   </b> )     .    ,   1   ,         . <br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt440772/">https://habr.com/ru/post/pt440772/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt440756/index.html">CI / CD sem servidor na AWS</a></li>
<li><a href="../pt440758/index.html">V√° ao Meetup na Acronis! (Moscou, Fiztehpark)</a></li>
<li><a href="../pt440760/index.html">A nova era de ouro da arquitetura de computadores</a></li>
<li><a href="../pt440762/index.html">Revis√µes dos empregadores: a natureza e a falta de sentido das revis√µes an√¥nimas</a></li>
<li><a href="../pt440766/index.html">De geeks a geeks: presentes para 23 de fevereiro</a></li>
<li><a href="../pt440774/index.html">Graves erros de matem√°tica do NHTSA permitem que a Tesla reivindique seguran√ßa no piloto autom√°tico</a></li>
<li><a href="../pt440776/index.html">E-mail, vis√£o interna</a></li>
<li><a href="../pt440778/index.html">Segundo encontro do OpenStack no Mail.ru Group: 22 de fevereiro</a></li>
<li><a href="../pt440780/index.html">O Google n√£o bloquear√° bloqueadores de an√∫ncios de terceiros no navegador Chromium</a></li>
<li><a href="../pt440782/index.html">Estou indo mais fundo, ou sobre o que voc√™ deve saber, otimizando o aplicativo de rede</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>