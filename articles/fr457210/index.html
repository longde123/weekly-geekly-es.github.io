<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌔 👉🏽 🧒🏾 Stockez des ressources statiques sur votre hébergement 👵 👨‍💼 🏕️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'une des premières choses que je recommande à mes clients pour accélérer les sites Web semblera d'abord un paradoxe: vous devez placer des ressources...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Stockez des ressources statiques sur votre hébergement</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457210/">  L'une des premières choses que je recommande à mes clients pour accélérer les sites Web semblera d'abord un paradoxe: vous devez placer des ressources statiques sur votre hébergement, abandonnant l'infrastructure CDN tierce.  Dans ce court article et, je l'espère, très simple, je veux souligner les inconvénients du stockage de vos fichiers statiques «sur le côté» et les formidables avantages de les héberger sur mon hébergement. <br><a name="habracut"></a><br><h4>  De quoi je parle? </h4><br>  Il est courant pour les développeurs de cliquer sur le lien vers des actifs statiques, tels que des bibliothèques ou des plugins, qui se trouvent sur des sites et des ressources CDN.  Un exemple classique est jQuery. <br><br>  Il y a un certain nombre d'avantages évidents, mais mon objectif plus loin dans l'article est d'exposer cette approche et de montrer que les inconvénients sont beaucoup plus répandus. <br><br>  (Tout d'abord, considérez les avantages). <br><br><ul><li>  <b>C'est pratique.</b>  Cela nécessite très peu d'efforts pour connecter les fichiers.  Copiez la ligne de code HTML et vous avez terminé.  C'est facile. </li><li>  <b>Nous avons accès au CDN.</b>  code.jquery.com est fourni par StackPath, c'est un CDN.  En vous connectant au contenu de cette ressource, nous obtenons gratuitement une livraison de qualité CDN. </li><li> <b>Les fichiers utilisateur peuvent déjà être mis en cache.</b>  Si website-a.com est lié à <a href="">code.jquery.com/jquery-3.3.1.slim.min.js</a> et que l'utilisateur va d'ici à website-b.com, qui est également lié à <a href="">code.jquery.com/jquery-3.3 .1.slim.min.js</a> , alors l'utilisateur aura ce fichier dans le cache. </li></ul><br><h4>  Risque: baisse de vitesse et échecs </h4><br>  Je n'entrerai pas dans trop de détails dans ce post.  J'ai un article complet sur la viabilité d'un tiers et les risques liés aux retards et interruptions.  Qu'il suffise de dire que si vous avez des ressources critiques liées à des fournisseurs tiers, et si le fournisseur souffre de plantages et d'une baisse de vitesse ou de pannes, c'est une très mauvaise nouvelle pour vous.  Vous en souffrirez aussi. <br><br>  Si vous avez des CSS bloquant le rendu ou des JS synchrones hébergés sur des ressources tierces, allez-y et transférez-les immédiatement dans votre propre infrastructure.  Les actifs critiques sont trop précieux pour être laissés sur des serveurs tiers. <br><br><h4>  Risque: Résiliation du service </h4><br>  Il s'agit d'un événement beaucoup moins courant, mais que se passe-t-il si le fournisseur décide qu'il doit arrêter le service?  C'est exactement ce que Rawgit a fait en octobre 2018, jusqu'à présent (au moment de la rédaction), une recherche brute sur le code GitHub fournit toujours plus d'un million de liens vers le service, qui est actuellement fermé, et près de 20000 sites actifs continuent de fonctionner. référez-vous-y. <br><br><h4>  Risque: vulnérabilités de sécurité </h4><br>  Une autre chose à laquelle il faut prêter attention est une simple question de confiance.  Si nous apportons du contenu à partir de ressources tierces sur notre page, nous devons espérer que les fichiers que nous recevons sont exactement ce que nous attendons de recevoir, et ils font exactement ce que nous attendons d'eux. <br><br>  Imaginez le mal qui pourrait être fait si quelqu'un pouvait prendre le contrôle d'un fournisseur tel que code.jquery.com et commencer à fournir du contenu compromis ou malveillant.  Ça fait peur d'y penser! <br><br><h4>  Intégrité des sous-ressources </h4><br>  Nous devons rendre hommage à tous les fournisseurs tiers mentionnés jusqu'ici dans cet article, ils font tout pour garantir l'intégrité de la sous-ressource (Subresource Integrity - SRI).  SRI est le mécanisme par lequel le fournisseur fournit le hachage (techniquement, un hachage suivi d'un encodage Base64) du fichier spécifique que vous attendez et avez l'intention d'utiliser.  Le navigateur peut alors vérifier que le fichier que vous avez reçu correspond exactement à ce que vous avez demandé. <br><br><pre><code class="plaintext hljs">&lt;script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8=" crossorigin="anonymous"&gt;&lt;/script&gt;</code> </pre> <br>  Encore une fois, si vous devez absolument connecter du contenu statique à une ressource tierce, assurez-vous que SRI est actif.  Vous pouvez vous connecter SRI vous-même. <br><br><h4>  Reckoning: Network Negotiations </h4><br>  L'un des coûts les plus importants et les plus urgents que nous encourons est celui de l'ouverture de nouvelles connexions TCP.  Chaque nouvelle ressource que nous devons visiter nécessite d'ouvrir une connexion, ce qui peut être très coûteux: résolution DNS, négociation TCP, négociation TLS, qui contribuent tous, et l'histoire s'aggrave à mesure que la connexion tarde. <br><br>  Je vais donner un exemple tiré directement de la propre page de démarrage de Bootstrap.  Ils demandent aux utilisateurs de joindre quatre fichiers. <br><br>  Ces quatre fichiers sont situés sur trois ressources différentes, c'est-à-dire que nous devons ouvrir trois connexions TCP.  Combien cela coûte-t-il?  Eh bien, avec une connexion assez rapide, le contenu de ces fichiers statiques sur le côté est de 311 ms, soit 1,65 fois plus lent que lors de leur placement sur votre propre hébergement. <br><br>  En contactant trois sources différentes pour la maintenance des actifs statiques, nous perdons collectivement les 805 ms inutiles pour les approbations du réseau. <br><br>  D'accord, ce n'est pas si effrayant, mais Trainline, mon client, a constaté que lorsque le retard a été réduit de 300 ms, les visiteurs ont payé 8 millions de livres supplémentaires par an.  C'est un moyen assez simple de gagner 8 millions. <br><br>  En déplaçant simplement nos ressources vers votre domaine, nous éliminons complètement le coût des connexions supplémentaires. <br><br>  Pour une connexion plus lente, avec un délai plus long, l'histoire est bien pire.  Pour la 3G, la version tierce est plus lente que 1,765 s.  Je pensais que c'était destiné à rendre notre site plus rapide. <br><br>  Lorsque vous vous connectez avec un retard important, le coût total du réseau est de 5,037 monstrueux.  Ce qui peut être complètement évité. <br><br>  Le déplacement de fichiers vers notre propre infrastructure réduit le temps de téléchargement de 5,4 s à 3,6 s. <br><br>  Si ce n'est pas une bonne raison d'héberger vos ressources statiques, je ne sais pas quoi apporter d'autre. <br><br><h4>  Se connecter </h4><br>  Naturellement, tout l'intérêt de ma présentation ici est que vous ne devez pas publier de ressources statiques sur le côté si vous êtes en mesure de le faire sur votre hébergement.  Cependant, si vos mains sont en quelque sorte liées, vous pouvez utiliser la préconnexion de Resource Hint pour ouvrir de manière proactive une connexion TCP à une ou des sources spécifiques: De plus, leur déploiement en tant qu'en-têtes HTTP sera encore plus rapide. <br>  <b>Remarque</b>  Même si vous utilisez la préconnexion, le temps perdu ne diminuera que légèrement: vous devez toujours ouvrir les connexions appropriées et il est peu probable que les coûts soient jamais justifiés, en particulier pour les connexions lentes. <br><br><h4>  Reckoning: perte de priorité </h4><br>  Le deuxième calcul se présente sous la forme d'une optimisation au niveau du protocole, ce qui nous manque lorsque nous divisons le contenu en domaines.  Si vous utilisez HTTP / 2, ce qui doit être fait, vous avez accès à la priorisation. <br><br>  Tous les flux (donc les ressources) avec la même connexion TCP conservent la priorité, et le navigateur et le serveur travaillent en tandem pour construire l'arborescence de dépendances de tous ces flux priorisés, afin que nous puissions renvoyer les ressources critiques plus rapidement et éventuellement retarder la livraison des moins importantes. <br><br>  <b>Remarque</b>  Techniquement, en raison de la fusion des connexions HTTP / 2, les demandes peuvent être hiérarchisées les unes par rapport aux autres sur différents domaines, à condition qu'elles partagent la même adresse IP. <br><br>  Si nous distribuons nos ressources sur différents domaines, nous devons ouvrir plusieurs connexions TCP uniques.  Nous ne pouvons pas croiser les priorités pour ces connexions, c'est-à-dire que nous perdons la capacité de livrer des fichiers d'une manière bien réfléchie. <br><br>  En hébergeant tout le contenu sur un seul hébergement, nous pouvons construire une arborescence de dépendances plus complexe.  Chaque thread a son propre ID, car ils appartiennent à la même arborescence.  Si nous fournissons autant de contenu que possible à partir d'un domaine, nous pouvons laisser HTTP / 2 faire son travail et hiérarchiser les actifs plus complètement dans l'espoir d'une réponse plus rapide. <br><br><h4>  Mise en cache </h4><br>  Dans l'ensemble, les hôtes de ressources statiques semblent assez bien faire pour définir des directives max-age à longue durée de vie.  Cela est logique car le contenu statique sur les URL versionnées (comme indiqué ci-dessus) ne changera jamais.  Cela rend très sûr et rationnel l'application d'une politique de cache raisonnablement agressive. <br><br>  Cependant, ce n'est pas toujours le cas et en plaçant indépendamment vos ressources, vous pouvez développer des stratégies de mise en cache beaucoup plus individuelles. <br><br><h4>  Mythe: mise en cache inter-domaines </h4><br>  Plus intéressant est la possibilité de mettre en cache des actifs entre domaines.  Autrement dit, si de nombreux sites sont liés à la même version de jQuery, située sur le CDN, les utilisateurs ont sûrement déjà ce fichier particulier sur leur ordinateur.  Quelque chose comme le partage de ressources d'égal à égal.  Il s'agit de l'un des arguments les plus courants pour utiliser un fournisseur d'actifs statique tiers. <br><br>  Malheureusement, aucune preuve publiée ne vient étayer ces affirmations: il n'y a aucune raison de croire que cela est vrai.  À l'inverse, une étude récente de Paul Calvano laisse entendre que le contraire peut être vrai: <br><br>  Il existe un écart notable entre l'âge du cache de ressources CSS et les polices Web de premier et de troisième niveau.  95% des polices tierces datent de plus d'une semaine, contre 50% des polices tierces de moins d'une semaine.  Cela fournit de bonnes raisons pour les polices Web auto-hébergées. <br><br>  En général, il semble que le contenu tiers soit mis en cache pire que le sien. <br><br>  Plus important encore, Safari a complètement désactivé cette fonctionnalité en raison de problèmes d'abus de confidentialité, de sorte que la technologie de cache partagé pourrait ne pas fonctionner au moment de la rédaction de cet article pour 16% des utilisateurs dans le monde. <br><br>  En bref, bien que cela soit théoriquement bon, rien ne prouve que la mise en cache interdomaine soit en quelque sorte efficace. <br><br><h4>  Accès CDN </h4><br>  Un autre avantage répandu de contacter un fournisseur de ressources statiques est qu'il est susceptible d'utiliser une infrastructure puissante avec des capacités CDN: distribution mondiale, évolutivité, faible latence et haute disponibilité. <br><br>  Étant donné que cela est absolument vrai, si vous vous souciez de vos performances, vous devez exécuter votre propre contenu à partir du CDN.  Avec le niveau des prix d'hébergement actuels, il y a très peu d'excuses pour lesquelles vous ne l'utilisez pas pour vos ressources. <br><br>  En d'autres termes: si vous pensez avoir besoin d'un CDN pour votre jQuery, vous aurez besoin d'un CDN pour tout. <br><br><h4>  Hébergez des ressources statiques sur votre hébergement </h4><br>  En fait, il y a très peu de raisons de laisser vos ressources statiques dans l'infrastructure de quelqu'un d'autre.  Les avantages possibles sont souvent un mythe et même si ce n'est pas le cas, les compromis n'en valent tout simplement pas la peine.  Le chargement des ressources à partir de différentes sources est beaucoup plus lent.  Au cours des prochains jours, passez dix minutes à auditer vos projets et prenez le contrôle de toutes les ressources statiques tierces. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr457210/">https://habr.com/ru/post/fr457210/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr457200/index.html">Un robot de dessin pour réaliser des scènes de tous les jours et même des histoires</a></li>
<li><a href="../fr457202/index.html">Comment nous choisissons les idées pour le développement de nos produits: le vendeur doit pouvoir entendre ...</a></li>
<li><a href="../fr457204/index.html">Windows PowerShell et longs chemins</a></li>
<li><a href="../fr457206/index.html">SQL Index Manager - une longue histoire sur SQL Server, les fouilles et la maintenance des index</a></li>
<li><a href="../fr457208/index.html">Génération dynamique de robots.txt pour les sites ASP.NET Core en fonction de l'environnement</a></li>
<li><a href="../fr457212/index.html">Pourquoi n'est-il jamais trop tard pour commencer à apprendre Java (ou d'autres langages Java)</a></li>
<li><a href="../fr457224/index.html">Une approche moderne de la concurrence dans Android: Corotins chez Kotlin</a></li>
<li><a href="../fr457232/index.html">Abeille robot "Bumble" - le premier vol d'essai à l'intérieur de l'ISS</a></li>
<li><a href="../fr457234/index.html">Biais cognitif du produit</a></li>
<li><a href="../fr457236/index.html">Comment une entreprise informatique a eu du mal à vendre de la musique</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>