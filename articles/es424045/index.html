<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèÑ üì§ üïë Algunas veces se necesitan algunos trucos cuando se trabaja con git üíô üèÜ üö£üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quiero compartir recetas para resolver un par de tareas que a veces surgen cuando se trabaja con git y que no son "directamente obvias". 


 Al princi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Algunas veces se necesitan algunos trucos cuando se trabaja con git</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424045/"><p>  Quiero compartir recetas para resolver un par de tareas que a veces surgen cuando se trabaja con git y que no son "directamente obvias". </p><br><p>  Al principio pens√© en acumular m√°s recetas, pero todo tiene su tiempo.  Creo que si hay alg√∫n beneficio, entonces es posible y poco a poco ... </p><br><p>  Entonces ... </p><a name="habracut"></a><br><h1>  Combinar ramas viejas con un dolor m√≠nimo </h1><br><p> Pre√°mbulo  Hay una rama principal ( <code>master</code> ), que compromete activamente nuevas caracter√≠sticas y correcciones;  hay una rama de <code>feature</code> paralelas, en la que los desarrolladores navegaron durante un tiempo hasta su propio nirvana, y de repente descubrieron que no hab√≠an ca√≠do durante un mes con el maestro, y la fusi√≥n "en la frente" (cabeza a cabeza) ya no era trivial. </p><br><p>  (S√≠, no se trata de un mundo ideal donde todo es correcto, el crimen est√° ausente, los ni√±os siempre son obedientes e incluso cruzan el camino estrictamente de la mano con su madre, mirando cuidadosamente a su alrededor). </p><br><p>  Prop√≥sito: frenar.  Al mismo tiempo, por lo que fue una fusi√≥n "pura", sin caracter√≠sticas.  Es decir  de modo que en el repositorio p√∫blico en el gr√°fico de rama, dos hilos est√°n conectados en un solo punto con el mensaje "rama fusionada 'maestro' en funci√≥n".  Y todo el dolor de cabeza "este" sobre cu√°nto tiempo y esfuerzo tom√≥, cu√°ntos conflictos se resolvieron y cu√°nto cabello qued√≥ innecesariamente manchado. </p><br><p>  La trama  El hecho de que en el git puede editar la √∫ltima confirmaci√≥n con la clave, <code>--amend</code> saben.  El truco es que este "√∫ltimo compromiso" puede ubicarse en cualquier lugar y contener cualquier cosa.  Por ejemplo, puede ser no solo el "√∫ltimo compromiso con la rama lineal", donde se olvidaron de corregir el error tipogr√°fico, sino tambi√©n el compromiso de fusi√≥n de la fusi√≥n habitual o de "pulpo".  <code>--amend</code> simplemente <code>--amend</code> sobre los cambios propuestos y "incrustar√°" la confirmaci√≥n modificada en el √°rbol, como si realmente apareciera como resultado de una fusi√≥n honesta y la resoluci√≥n de conflictos.  En esencia, <code>git merge</code> y <code>git commit --amend</code> permite separar completamente el "lugar de replanteo" ("este commit en el √°rbol estar√° AQU√ç") y el contenido del commit en s√≠. </p><br><p>  La idea b√°sica de un compromiso de fusi√≥n complejo con un historial limpio es simple: primero "hacemos un lugar" creando un compromiso de fusi√≥n limpio (independientemente del contenido), luego lo reescribimos con <code>--amend</code> , haciendo que el contenido sea "correcto". </p><br><ol><li><p>  "P√≠ldorame un lugar".  Esto es f√°cil de hacer estableciendo una estrategia de fusi√≥n que no haga preguntas innecesarias sobre la resoluci√≥n de conflictos. </p><br><pre> <code class="plaintext hljs">git checkout feature git merge master -s ours</code> </pre> <br></li><li><p>  Oh si  Antes de la fusi√≥n, era necesario crear una rama de "copia de seguridad" desde el encabezado de la caracter√≠stica.  Despu√©s de todo, nada se fusion√≥ realmente ... Pero que sea el segundo p√°rrafo, y no el 0.  En general, cambiamos a la funci√≥n no fusionada y ahora nos fusionamos honestamente.  De cualquier manera posible, a pesar de cualquier "truco sucio".  Mi manera personal es mirar la rama maestra desde el momento de la √∫ltima fusi√≥n y evaluar posibles confirmaciones de problemas (por ejemplo: corregir un error tipogr√°fico en un lugar, no uno problem√°tico. Masivamente (muchos archivos) cambiaron el nombre de una entidad, una problem√°tica, etc.).  A partir de confirmaciones de problemas, creamos nuevas ramas (lo hago de manera ingeniosa: master1, master2, master3, etc.).  Y luego fusionamos rama por rama, pasando de viejos a nuevos y corrigiendo conflictos (que generalmente son evidentes con este enfoque).  Sugiera otros m√©todos (no soy un mago; solo estoy aprendiendo; ¬°me complacer√° hacer comentarios constructivos!).  En √∫ltima instancia, al pasar (tal vez) unas horas en operaciones puramente rutinarias (que se pueden confiar al junior, porque simplemente no hay conflictos complicados con este enfoque), obtenemos el estado final del c√≥digo: todas las innovaciones / correcciones del asistente se transfirieron con √©xito a la rama de caracter√≠sticas, todas las pruebas relevantes pis√≥ este c√≥digo, etc.  Se debe confirmar un c√≥digo exitoso. </p><br></li><li><p>  Reescribiendo la "historia de √©xito".  Estando en el commit, donde "todo est√° hecho", ejecuta lo siguiente: </p><br></li></ol><br><pre> <code class="plaintext hljs">git tag mp git checkout mp git reset feature git checkout feature git tag -d mp</code> </pre> <br><p>  (Descifro: usando la etiqueta (mp - merge point), cambiamos al estado HEAD separado, y desde all√≠ lo reiniciamos a la cabecera de nuestra rama, donde al principio se hizo un "replanteo" por un compromiso de fusi√≥n fraudulento. La etiqueta ya no es necesaria, as√≠ que la eliminamos).  Ahora estamos en el commit de fusi√≥n "puro" original;  Al mismo tiempo, en la copia de trabajo tenemos los archivos "correctos", donde se encuentra todo lo que necesita.  Ahora debe agregar todos los archivos modificados al √≠ndice y, especialmente, mirar cuidadosamente los archivos no montados (habr√° todos los archivos nuevos que aparecieron en la rama principal).  Agregamos todo lo que necesitamos desde all√≠, tambi√©n. </p><br><p>  Finalmente, cuando todo est√© listo, ingresamos nuestra confirmaci√≥n correcta en el lugar reservado: </p><br><pre> <code class="plaintext hljs">git commit --amend</code> </pre> <br><p>  ¬°Hurra!  ¬°Todo sali√≥ bien!  Puede insertar una rama de forma casual en un repositorio p√∫blico, y nadie sabr√° que realmente pas√≥ medio d√≠a de trabajo en esta fusi√≥n. </p><br><p>  Upd: forma m√°s concisa </p><br><p>  Tres meses despu√©s de esta publicaci√≥n, el art√≠culo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C√≥mo y por qu√© robar √°rboles en git</a> " por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">capslocky</a> </p><br><p>  En funci√≥n de sus motivos, es posible lograr exactamente el mismo objetivo de una manera m√°s corta y sin mecanismos auxiliares: no es necesario "publicar espacio", considerar los archivos sin clasificar despu√©s de restablecer y realizar modificaciones;  Puede crear una confirmaci√≥n de fusi√≥n directa con el contenido deseado en un solo paso. </p><br><p>  Comenzamos de inmediato con la fusi√≥n utilizando cualquier m√©todo disponible (como en el p√°rrafo 2 anterior).  La historia intermedia y los hacks a√∫n son irrelevantes.  Y luego, en lugar de la reivindicaci√≥n 3, con la sustituci√≥n del compromiso de fusi√≥n, hacemos una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">fusi√≥n artificial</a> , como en el art√≠culo: </p><br><pre> <code class="plaintext hljs">git tag mp git checkout feature git merge --ff $(git commit-tree mp^{tree} -m "merged branch 'master' into 'feature'" -p feature -p master) git tag -d mp</code> </pre> <br><p>  Toda la magia aqu√≠ se realiza en un solo paso mediante el tercer comando (git commit-tree). </p><br><h1>  Seleccione parte del archivo, manteniendo el historial </h1><br><p>  Pre√°mbulo: el archivo fue codificado-codificado, y finalmente codificado, de modo que incluso el estudio visual comenz√≥ a disminuir la velocidad, digiri√©ndolo (sin mencionar JetBrains).  (S√≠, estamos de vuelta en el mundo "imperfecto". Como siempre). </p><br><p>  Los cerebros inteligentes pensaron, pensaron y seleccionaron varias entidades que se pueden representar en un archivo separado.  Pero!  Si solo lo toma, copie y pegue una parte del archivo y p√©guelo en otro; este ser√° un archivo completamente nuevo desde el punto de vista de git.  En caso de alg√∫n problema, una b√∫squeda en el historial indicar√° inequ√≠vocamente solo ‚Äú¬ød√≥nde est√° esta persona discapacitada?‚Äù Qui√©n comparti√≥ el archivo.  Y puede ser necesario encontrar la fuente original para nada "para represiones", sino puramente constructiva, para descubrir por qu√© se cambi√≥ esta l√≠nea;  qu√© error solucion√≥ (o no solucion√≥).  ¬°Quiero que el archivo sea nuevo, pero al mismo tiempo toda la historia de cambios a√∫n permanece! </p><br><p>  La trama  Con algunos efectos de borde ligeramente molestos, esto se puede hacer.  Para mayor claridad, hay un archivo <code>file.txt</code> , del que quiero resaltar una parte en <code>file2.txt</code> .  (y a√∫n mantengo la historia, s√≠).  Ejecute este fragmento: </p><br><pre> <code class="plaintext hljs">f=file.txt; f1=file1.txt; f2=file2.txt cp $f $f2 git add $f2 git mv $f $f1 git commit -m"split $f step 1, converted to $f1 and $f2"</code> </pre> <br><p>  Como resultado, obtenemos los archivos <code>file1.txt</code> y <code>file2.txt</code> .  Ambos tienen exactamente la misma historia (real; como el archivo original).  S√≠, el <code>file.txt</code> original.txt tuvo que ser renombrado;  Este es el efecto de borde "ligeramente molesto".  Desafortunadamente, no pude encontrar una manera de guardar la historia, pero para NO renombrar el archivo fuente (si alguien puede, ¬°d√≠melo!).  Sin embargo, el git lo soportar√° todo;  ahora nadie se molesta en cambiar el nombre del archivo en una confirmaci√≥n por separado: </p><br><pre> <code class="plaintext hljs">git mv $f1 $f git commit -m"split finish, rename $f1 to $f"</code> </pre> <br><p>  Ahora <code>file2.txt</code> dorado mostrar√° el mismo historial de l√≠nea que el archivo original.  Lo principal es no fusionar estos dos commits juntos (de lo contrario, toda la magia desaparecer√°; ¬°lo intent√©!).  Pero al mismo tiempo, nadie se molesta en editar archivos directamente en el proceso de separaci√≥n;  no es necesario hacer esto m√°s tarde con confirmaciones separadas.  Y s√≠, ¬°puedes seleccionar muchos archivos a la vez! </p><br><p>  El punto clave de la receta: cambiar el nombre del archivo fuente a otro en el mismo commit, donde se hace (y posiblemente edita) una copia (copias).  Y deje que esta confirmaci√≥n viva en el futuro (nunca se equivocar√° con el cambio de nombre inverso). </p><br><p>  Upd: un par de recetas de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Lissov</a> </p><br><h1>  Separe la parte del repositorio de historia </h1><br><p>  Est√°s en la √∫ltima versi√≥n del repositorio inicial.  La tarea es separar una carpeta.  (Vi opciones para varias carpetas, pero es m√°s f√°cil y m√°s comprensible ya sea doblar todo primero en uno o repetir lo siguiente varias veces). </p><br><p>  Importante!  Todos los movimientos deben hacerse con el <code>git mv</code> , de lo contrario, el git puede perder el historial. </p><br><p>  Realizamos: </p><br><pre> <code class="plaintext hljs">git filter-branch --prune-empty --subdirectory-filter "{directory}" [branch]</code> </pre> <br><p>  {directorio} es la carpeta que se separar√°.  Como resultado, obtenemos la carpeta junto con el historial completo de confirmaciones solo, es decir, en cada confirmaci√≥n, solo se muestran los archivos de esta carpeta.  Naturalmente, parte de los commits estar√°n vac√≠os, --prune-empty los elimina. <br>  Ahora cambia el origen: </p><br><pre> <code class="plaintext hljs">git remote set-url origin {another_repository_url}` git checkout move_from_Repo_1</code> </pre> <br><p>  Si el segundo repositorio est√° limpio, puede ir directamente al maestro.  Bueno, empuja: </p><br><pre> <code class="plaintext hljs">git push -u move_from_Repo_1</code> </pre> <br><p>  Fragmento completo (para copiar y pegar f√°cilmente): </p><br><pre> <code class="plaintext hljs">directory="directory_to_extract"; newurl="another_repository_url" git filter-branch --prune-empty --subdirectory-filter "$directory" git remote set-url origin "$newurl" git checkout move_from_Repo_1 git push -u move_from_Repo_1</code> </pre> <br><h1>  Fusiona dos repositorios juntos </h1><br><p>  Suponga que hizo algo 2 veces m√°s alto y obtuvo brunches <code>move_from_Repo_1</code> y <code>move_from_Repo_2</code> , y en cada uno transfiri√≥ archivos usando <code>git mv</code> a donde deber√≠an estar despu√©s de la fusi√≥n.  Ahora queda por controlar: </p><br><pre> <code class="plaintext hljs">br1="move_from_Repo_1"; br2="move_from_Repo_2" git checkout master git merge origin/$br1 --allow-unrelated-histories git merge origin/$br2 --allow-unrelated-histories git push</code> </pre> <br><p>  Todo el truco est√° en --permitir historias no relacionadas.  Como resultado, obtenemos un repositorio con un historial completo de todos los cambios. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es424045/">https://habr.com/ru/post/es424045/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es424035/index.html">2019 es el a√±o en que Intel se detuvo</a></li>
<li><a href="../es424037/index.html">Un breve recorrido por GraphQL</a></li>
<li><a href="../es424039/index.html">Criptograf√≠a despu√©s de aterrizar alien√≠genas</a></li>
<li><a href="../es424041/index.html">Una breve introducci√≥n a la biolog√≠a celular</a></li>
<li><a href="../es424043/index.html">Sunny hat trick. Hay tres pueblos de Dobrovlyany en Ucrania. Y los tres tienen poderosas plantas de energ√≠a solar.</a></li>
<li><a href="../es424049/index.html">Presentamos el libro "Harry Potter y los m√©todos del pensamiento racional" a la Olimpiada</a></li>
<li><a href="../es424051/index.html">El Manifiesto del Programador Limpio o el Resumen del Libro de C√≥digo Corto de Robert Martin</a></li>
<li><a href="../es424053/index.html">Serie MicroSD hecha de un lienzo en blanco</a></li>
<li><a href="../es424057/index.html">Integraci√≥n de aplicaciones web con Spring Cloud Contract</a></li>
<li><a href="../es424059/index.html">Highlights #GitLabLive del 20 de septiembre de 2018</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>