<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöò üñ®Ô∏è üë©üèΩ‚Äç‚öñÔ∏è Cr√©ation de traces dans la neige dans Unreal Engine 4 üßùüèø ü¶à ‚è©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Si vous jouez √† des jeux AAA modernes, vous avez peut-√™tre remarqu√© une tendance √† utiliser des paysages enneig√©s. Par exemple, ils sont dans Horizon ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cr√©ation de traces dans la neige dans Unreal Engine 4</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/416703/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ox/49/ct/ox49ctzii2nk6gryoeuvbcxf96a.gif"></div><br>  Si vous jouez √† des jeux AAA modernes, vous avez peut-√™tre remarqu√© une tendance √† utiliser des paysages enneig√©s.  Par exemple, ils sont dans <i>Horizon Zero Dawn</i> , <i>Rise of the Tomb Raider</i> et <i>God of War</i> .  Dans tous ces jeux, la neige a une caract√©ristique importante: vous pouvez y laisser des traces! <br><br>  Gr√¢ce √† cette interaction avec l'environnement, l'immersion du joueur dans le jeu est am√©lior√©e.  Cela rend l'environnement plus r√©aliste, et soyons honn√™tes - c'est juste int√©ressant.  Pourquoi passer de longues heures √† cr√©er un m√©canicien curieux si vous pouvez simplement laisser le joueur tomber au sol et faire des anges de neige? <br><br>  Dans ce didacticiel, vous apprendrez ce qui suit: <br><br><ul><li>  Cr√©ez des empreintes √† l'aide de la capture de sc√®ne pour masquer des objets proches du sol </li><li>  Utilisez un masque avec un mat√©riau de terrain pour cr√©er de la neige d√©formable </li><li>  Pour optimiser, afficher les empreintes dans la neige uniquement √† c√¥t√© du joueur </li></ul><a name="habracut"></a><br><blockquote>  <em>Remarque:</em> il est entendu que vous connaissez d√©j√† les bases de l'utilisation d'Unreal Engine.  Si vous √™tes nouveau, consultez notre s√©rie de didacticiels <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Unreal Engine pour les d√©butants</a> . </blockquote><br><h2>  Se rendre au travail </h2><br>  T√©l√©chargez le <a href="">mat√©riel</a> pour ce tutoriel.  D√©compressez-les, acc√©dez √† <em>SnowDeformationStarter</em> et ouvrez <em>SnowDeformation.uproject</em> .  Dans ce tutoriel, nous allons cr√©er des traces √† l'aide d'un personnage et de plusieurs cases. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a1f/8c7/b72/a1f8c7b7279319c558685c1b09858726.gif"></div><br>  Avant de commencer, vous devez savoir que la m√©thode de ce didacticiel n'enregistrera les traces que dans une zone donn√©e, et non dans le monde entier, car la vitesse d√©pend de la r√©solution du rendu cible. <br><br>  Par exemple, si nous voulons stocker des traces sur une grande surface, nous devrons augmenter la r√©solution.  Mais cela augmente √©galement l'impact de la capture de sc√®ne sur la vitesse du jeu et la taille de la m√©moire pour le rendu cible.  Pour l'optimisation, vous devez limiter la port√©e et la r√©solution. <br><br>  Apr√®s avoir r√©gl√© cela, d√©couvrons ce qu'il faut pour r√©aliser les empreintes de pas dans la neige. <br><br><h2>  Mise en place d'empreintes dans la neige </h2><br>  La premi√®re chose dont vous avez besoin pour cr√©er des traces est le <em>rendu cible</em> .  La cible de rendu sera un masque en niveaux de gris, dans lequel le blanc indique la pr√©sence d'une trace et le noir indique son absence.  Ensuite, nous pouvons projeter le rendu cible sur le sol et l'utiliser pour m√©langer les textures et d√©caler les sommets. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ea7/f0c/7f4/ea7f0c7f4eee82e34ebf74afeab25a72.gif"></div><br>  La deuxi√®me chose dont nous avons besoin est un moyen de masquer uniquement les objets affectant la neige.  Cela peut √™tre impl√©ment√© en rendant d'abord les objets dans la <em>profondeur personnalis√©e</em> .  Vous pouvez ensuite utiliser la <em>capture de sc√®ne</em> avec le <em>mat√©riau</em> de <em>post-traitement</em> pour masquer tous les objets rendus dans la profondeur personnalis√©e.  Vous pouvez ensuite afficher le masque dans le rendu cible. <br><br><blockquote>  <em>Remarque: la</em> capture de sc√®ne est essentiellement une cam√©ra avec la possibilit√© de produire un rendu cible. </blockquote><br>  La partie la plus importante de la capture d'une sc√®ne est son emplacement.  Voici un exemple de rendu cible captur√© √† partir d'une <em>vue de dessus</em> .  Ici, un personnage √† la troisi√®me personne et des cases sont masqu√©s. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/886/2e0/4cf/8862e04cfeb3f6ce26918d4ffa8b00a0.jpg"></div><br>  √Ä premi√®re vue, une capture avec une vue de dessus nous convient.  Les formulaires semblent appropri√©s aux maillages, donc il ne devrait pas y avoir de probl√®me, non? <br><br>  Pas vraiment.  Le probl√®me de la capture √† partir d'une vue de dessus est qu'elle ne capture rien sous le point le plus large.  Voici un exemple: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6ae/952/8b1/6ae9528b111143c408aab2642fe4c781.gif"></div><br>  Imaginez que les fl√®ches jaunes vont jusqu'au sol.  Dans le cas d'un cube et d'un c√¥ne, la pointe de fl√®che restera toujours √† l'int√©rieur de l'objet.  Cependant, dans le cas d'une sph√®re, le point en √©merge √† l'approche de la terre.  Mais selon la cam√©ra, la pointe est toujours √† l'int√©rieur de la sph√®re.  Voici √† quoi ressemblera la sph√®re de la cam√©ra: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/35f/580/cab/35f580cab1df39d4707c344f9e902e9d.jpg"></div><br>  Par cons√©quent, le masque de sph√®re sera plus grand qu'il ne devrait, m√™me si la zone de contact avec la terre est petite. <br><br>  De plus, ce probl√®me est compl√©t√© par le fait qu'il nous est difficile de d√©terminer si l'objet concerne le terrain. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e3/df9/a48/9e3df9a4804b5c317f40f57389fc1a8c.gif"></div><br>  Pour faire face √† ces deux probl√®mes, vous pouvez utiliser la capture <em>par le bas</em> . <br><br><h3>  Poign√©e inf√©rieure </h3><br>  La capture ci-dessous est la suivante: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c3f/348/aad/c3f348aad117b479acf5fd9505f9c860.gif"></div><br>  Comme vous pouvez le voir, la cam√©ra capture maintenant le c√¥t√© inf√©rieur, c'est-√†-dire celui qui touche le sol.  Cela √©limine le probl√®me de la "zone la plus large" qui appara√Æt lors de la capture par le haut. <br><br>  Pour d√©terminer si un objet touche le sol, vous pouvez utiliser un mat√©riau de post-traitement pour effectuer un contr√¥le de profondeur.  Il v√©rifie si la profondeur de l'objet est sup√©rieure √† la profondeur de la terre <i>et</i> si elle est inf√©rieure √† un d√©calage pr√©d√©termin√©.  Si les deux conditions sont remplies, nous pouvons masquer ce pixel. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a6b/83f/e87/a6b83fe8713950c52f917314de9d7c88.jpg"></div><br>  Voici un exemple √† l'int√©rieur d'un moteur avec une zone de capture de 20 unit√©s au-dessus du sol.  Notez que le masque n'appara√Æt que lorsque l'objet passe par un certain point.  Notez √©galement que le masque devient plus blanc lorsque l'objet s'approche du sol. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/949/1bb/d76/9491bbd768781cbca7c07a652172ba2c.gif"></div><br>  Tout d'abord, cr√©ez un mat√©riau de post-traitement pour effectuer un contr√¥le de profondeur. <br><br><h2>  Cr√©ation d'un mat√©riau de test de profondeur </h2><br>  Pour effectuer un contr√¥le de profondeur, vous devez utiliser deux tampons de profondeur - l'un pour le sol, l'autre pour les objets affectant la neige.  Puisque la capture de la sc√®ne ne voit que la terre, la <em>profondeur de la sc√®ne</em> d√©duira la profondeur de la terre.  Pour obtenir la profondeur des objets, nous allons simplement les rendre en <em>profondeur personnalis√©e</em> . <br><br><blockquote>  <em>Remarque:</em> pour gagner du temps, j'ai d√©j√† rendu le caract√®re et les cases en profondeur personnalis√©e.  Si vous souhaitez ajouter d'autres objets qui affectent la neige, vous devez activer le <em>Render CustomDepth Pass</em> pour eux. </blockquote><br>  Tout d'abord, vous devez calculer la distance de chaque pixel au sol.  Ouvrez <em>Materials \ PP_DepthCheck</em> et cr√©ez ce qui suit: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f32/7bb/226/f327bb226d1764c3f848d1c43a6304ca.jpg"></div><br>  Ensuite, vous devez cr√©er une zone de capture.  Pour ce faire, ajoutez les n≈ìuds en surbrillance: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/908/37d/0eb/90837d0eb07af42121b2a113b1229230.jpg"></div><br>  Maintenant, si le pixel est √† moins de <em>25</em> unit√©s de la terre, il appara√Ætra dans le masque.  La luminosit√© du masquage d√©pend de la proximit√© du pixel avec le sol.  Cliquez sur <em>Appliquer</em> et revenez √† l'√©diteur principal. <br><br>  Ensuite, vous devez cr√©er une capture de sc√®ne. <br><br><h2>  Cr√©er une capture de sc√®ne </h2><br>  Tout d'abord, nous avons besoin d'un rendu cible pour capturer une capture de sc√®ne.  Acc√©dez au dossier <em>RenderTargets</em> et cr√©ez une nouvelle <em>cible de rendu</em> appel√©e <em>RT_Capture</em> . <br><br>  Cr√©ons maintenant une capture de sc√®ne.  Dans ce tutoriel, nous ajouterons la capture de sc√®ne au plan, car plus tard, nous aurons besoin d'un script pour cela.  Ouvrez <em>Blueprints \ BP_Capture</em> et ajoutez le <em>composant de capture de sc√®ne 2D</em> .  Nommez-le <em>SceneCapture</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3d0/df9/915/3d0df9915e8aa04d9577193a53bcfc05.jpg"></div><br>  Nous devons d'abord r√©gler le tour de capture de sorte qu'il regarde le sol.  Acc√©dez au panneau D√©tails et d√©finissez la <em>rotation sur</em> <em>(0, 90, 90)</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6e2/c35/407/6e2c354070055e1f427d626b1c0df408.jpg"></div><br>  Vient ensuite le type de projection.  √âtant donn√© que le masque est une repr√©sentation 2D de la sc√®ne, nous devons nous d√©barrasser de la distorsion en perspective.  Pour ce faire, d√©finissez <em>Projection \ Type de projection</em> sur <em>Orthographique</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/78b/e54/adf/78be54adf3666b52564582f07153f8df.jpg"></div><br>  Ensuite, nous devons indiquer √† la capture de sc√®ne dans quel rendu cible enregistrer.  Pour ce faire, s√©lectionnez la valeur de <em>RT_Capture</em> pour <em>Capture de sc√®ne \ Cible de texture</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5c6/a76/2c5/5c6a762c53867499e5f3ace3de1b1eee.jpg"></div><br>  Enfin, nous devons utiliser du mat√©riel de v√©rification de la profondeur.  Ajoutez PP_DepthCheck aux <em>fonctions de rendu \ Mat√©riaux post-traitement</em> .  Pour que le post-traitement fonctionne, nous devons √©galement changer la <em>capture de sc√®ne \ source de capture</em> en <em>couleur finale (LDR) en RVB</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ec/1f1/26f/3ec1f126fce6ccea0625ae5d33193fdd.jpg"></div><br>  Maintenant que la capture de sc√®ne est configur√©e, nous devons sp√©cifier la taille de la zone de capture. <br><br><h3>  D√©finition de la taille de la zone de capture </h3><br>  Puisqu'il est pr√©f√©rable d'utiliser de faibles r√©solutions pour le rendu cible, nous devons utiliser l'espace efficacement.  Autrement dit, nous devons choisir quelle zone un pixel couvrira.  Par exemple, si les r√©solutions de la zone de capture et du rendu cible sont identiques, nous obtenons un rapport 1: 1.  Chaque pixel couvrira une zone 1 √ó 1 (en unit√©s du monde). <br><br>  Pour les pistes dans la neige, un rapport de 1: 1 n'est pas requis, car nous n'aurons probablement pas besoin de tels d√©tails.  Je recommande d'utiliser des ratios plus importants car cela vous permettra d'augmenter la taille de la zone de capture √† basse r√©solution.  Mais ne faites pas le rapport trop grand, sinon les d√©tails commenceront √† se perdre.  Dans ce tutoriel, nous utiliserons un rapport 8: 1, c'est-√†-dire que la taille de chaque pixel sera de 8 √ó 8 unit√©s du monde. <br><br>  Vous pouvez redimensionner la zone de capture en modifiant la propri√©t√© <em>Scene Capture \ Ortho Width</em> .  Par exemple, si vous souhaitez capturer une zone de 1024 √ó 1024, d√©finissez la valeur sur 1024. √âtant donn√© que nous utilisons un rapport 8: 1, d√©finissez la valeur sur <em>2048</em> (la r√©solution par d√©faut du rendu cible est 256 √ó 256). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/411/c60/994/411c60994d4b52dc80553a375496363b.jpg"></div><br>  Cela signifie que la capture de sc√®ne capturera la zone de <em>2048 √ó 2048</em> .  Elle mesure environ 20 √ó 20 m√®tres. <br><br>  Le mat√©riau au sol doit √©galement avoir acc√®s √† la taille de capture pour projeter correctement le rendu cible.  Pour ce faire, la m√©thode la plus simple consiste √† enregistrer la taille de capture dans la <em>collection de param√®tres de mat√©riau</em> .  Il s'agit essentiellement d'une collection de variables auxquelles <i>tout</i> mat√©riel peut acc√©der. <br><br><h3>  Enregistrement de la taille de capture </h3><br>  Revenez √† l'√©diteur principal et acc√©dez au dossier <em>Mat√©riaux</em> .  Cr√©ez une <em>collection de param√®tres de mat√©riau</em> qui sera dans <em>Mat√©riaux et textures</em> .  Renommez-le en <em>MPC_Capture</em> et ouvrez-le. <br><br>  Cr√©ez ensuite un nouveau <em>param√®tre scalaire</em> et nommez-le <em>CaptureSize</em> .  Ne vous inqui√©tez pas de d√©finir sa valeur - nous le ferons en toute franchise. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3bd/e83/fd4/3bde83fd4df9a960ef4ebde57830b749.jpg"></div><br>  Revenez √† <em>BP_Capture</em> et ajoutez les n≈ìuds en surbrillance √† l' <em>√©v√©nement BeginPlay</em> .  D√©finissez <em>Collection</em> sur <em>MPC_Capture</em> et <em>Nom du param√®tre</em> sur <em>CaptureSize</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eed/843/d3d/eed843d3d5ddc063f9e1c7664b514286.jpg"></div><br>  D√©sormais, tout mat√©riau peut obtenir la valeur de la <em>largeur ortho</em> en la lisant dans le param√®tre <em>CaptureSize</em> .  Jusqu'√† pr√©sent, avec la capture de la sc√®ne, nous avons termin√©.  Cliquez sur <em>Compiler</em> et revenez √† l'√©diteur principal.  L'√©tape suivante consiste √† projeter le rendu cible sur le sol et √† l'utiliser pour d√©former le paysage. <br><br><h2>  D√©formation du paysage </h2><br>  Ouvrez <em>M_Landscape</em> et acc√©dez au panneau D√©tails.  D√©finissez ensuite les propri√©t√©s suivantes: <br><br><ul><li>  Pour <em>Deux faces,</em> s√©lectionnez <em>activ√©</em> .  Puisque la capture de la sc√®ne ¬´regardera¬ª d'en bas, elle ne verra que les faces inverses de la terre.  Par d√©faut, le moteur ne rend pas les faces arri√®re des maillages.  Cela signifie qu'il ne stockera pas la profondeur de la terre dans le tampon de profondeur.  Pour r√©soudre ce probl√®me, nous devons dire au moteur de rendre les deux c√¥t√©s du maillage. </li><li>  Pour la <em>pavage D3D11,</em> s√©lectionnez <em>Pavage</em> <em>plat</em> (les triangles PN peuvent √©galement √™tre utilis√©s).  La tessellation divisera les triangles maill√©s en plus petits.  Essentiellement, cela augmente la r√©solution du maillage et nous permet d'obtenir des d√©tails plus fins lors du d√©placement des sommets.  Sans cela, la densit√© des pics sera trop faible pour cr√©er des traces cr√©dibles. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dc2/99b/a26/dc299ba26cb64d251af3844faf0f5079.jpg"></div><br>  Une fois les pavages activ√©s, le <em>Multiplicateur</em> <em>mondial de d√©placement</em> et de <em>pavage</em> s'allume. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e8d/675/c53/e8d675c535ce64980597cf10a16ffafe.jpg"></div><br>  <em>Le multiplicateur de pavage</em> contr√¥le la quantit√© de pavage.  Dans ce didacticiel, nous ne connecterons pas ce n≈ìud, c'est-√†-dire que nous utilisons la valeur par d√©faut ( <em>1</em> ). <br><br>  <em>Le d√©placement mondial</em> obtient une valeur vectorielle qui d√©crit dans quelle direction et √† quelle distance d√©placer le sommet.  Pour calculer la valeur de ce contact, nous devons d'abord projeter le rendu cible sur le sol. <br><br><h3>  Rendu cible du projet </h3><br>  Pour projeter le rendu cible, vous devez calculer ses coordonn√©es UV.  Pour ce faire, cr√©ez le sch√©ma suivant: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cbb/88f/b59/cbb88fb598e75fc8c9bd9991806d5892.jpg"></div><br>  Que se passe-t-il ici: <br><br><ol><li>  Nous devons d'abord obtenir la position XY du sommet actuel.  Puisque nous capturons par le bas, la coordonn√©e X est retourn√©e, vous devez donc la retourner (si nous devions capturer par le dessus, nous n'en aurions pas besoin). </li><li>  Cette partie effectue deux t√¢ches.  Premi√®rement, il centre le rendu cible de telle mani√®re que son milieu se trouve dans les coordonn√©es <em>(0, 0) de l'</em> espace mondial.  Elle convertit ensuite les coordonn√©es de l'espace mondial en espace UV. </li></ol><br>  Ensuite, cr√©ez les n≈ìuds s√©lectionn√©s et combinez les calculs pr√©c√©dents comme indiqu√© ci-dessous.  Pour <em>√âchantillon de texture,</em> s√©lectionnez <em>RT_Capture</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e95/38d/398/e9538d398f9ba02da2aea238c45651dd.jpg"></div><br>  Cela projettera le rendu cible au sol.  Cependant, tous les sommets situ√©s en dehors de la zone de capture √©chantillonneront les bords du rendu cible.  Il s'agit en fait d'un probl√®me car le rendu cible ne doit √™tre utilis√© que pour les sommets de la zone de capture.  Voici √† quoi cela ressemble dans un jeu: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1a4/e28/a04/1a4e28a04c7b6356bff76d8e1c4f4ce9.gif"></div><br>  Pour r√©soudre ce probl√®me, nous devons masquer tous les UV qui se trouvent en dehors de la plage de 0 √† 1 (c'est-√†-dire la zone de capture).  Pour cela, j'ai cr√©√© la fonction <em>MF_MaskUV0-1</em> .  Il renvoie <em>0</em> si les UV transmis sont en dehors de la plage de 0 √† 1 et renvoie <em>1</em> s'il se trouve √† l'int√©rieur.  En multipliant le r√©sultat par le rendu cible, nous effectuons le masquage. <br><br>  Maintenant que nous avons projet√© le rendu cible, nous pouvons l'utiliser pour m√©langer les couleurs et d√©placer les sommets. <br><br><h3>  Utilisation du rendu cible </h3><br>  Commen√ßons par m√©langer les couleurs.  Pour ce faire, nous connectons simplement <em>1-x</em> √† <em>Lerp</em> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc2/4e2/6fa/bc24e26fab908757ce5a0dded5d9ce21.jpg"></div><br><blockquote>  <em>Remarque:</em> si vous ne comprenez pas pourquoi j'utilise <em>1-x</em> , je vais vous expliquer - cela est n√©cessaire pour inverser le rendu cible, afin que les calculs deviennent un peu plus faciles. </blockquote><br>  Maintenant que nous avons une trace, la couleur de la terre devient brune.  S'il n'y a pas de couleur, il reste blanc. <br><br>  L'√©tape suivante est le d√©placement des sommets.  Pour ce faire, ajoutez les n≈ìuds s√©lectionn√©s et connectez tout comme suit: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4d7/6b2/6bd/4d76b26bddbf7640fae8032449bea285.jpg"></div><br>  Cela fera monter toutes les zones de neige de <em>25</em> unit√©s.  Les zones sans neige ont un d√©calage nul, ce qui cr√©era un sentier. <br><br><blockquote>  <em>Remarque: vous</em> pouvez modifier la <em>hauteur</em> de <em>d√©placement</em> pour augmenter ou diminuer les niveaux de neige.  Notez √©galement que D√©placementHauteur est la m√™me valeur que le d√©calage de capture.  Quand ils ont la m√™me signification, cela nous donne la d√©formation exacte.  Mais il y a des cas o√π vous devez les changer individuellement, alors je les ai laiss√©s comme param√®tres s√©par√©s. </blockquote><br>  Cliquez sur <em>Appliquer</em> et revenez √† l'√©diteur principal.  Cr√©ez une instance <em>BP_Capture</em> au niveau et donnez-lui les coordonn√©es <em>(0, 0, -2000)</em> pour la placer sous terre.  Cliquez sur <em>Play</em> et d√©ambulez avec les touches <em>W</em> , <em>A</em> , <em>S</em> et <em>D</em> pour d√©former la neige. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f6d/a1e/47b/f6da1e47b364e53b0245e53919f4a654.gif"></div><br>  La d√©formation fonctionne, mais il ne reste aucune trace!  Cela est d√ª au fait que la capture √©crase le rendu cible √† chaque ex√©cution de la capture.  Nous avons besoin d'un moyen de rendre les pistes <em>permanentes</em> . <br><br><h2>  Cr√©ation de traces permanentes </h2><br>  Pour cr√©er la persistance, nous avons besoin d'un autre rendu cible ( <em>tampon constant</em> ), dans lequel tout le contenu de la capture sera enregistr√© avant l'√©crasement.  Ensuite, nous ajouterons un tampon constant √† la capture (apr√®s l'avoir √©cras√©).  Nous obtenons une boucle dans laquelle chaque rendu cible √©crit dans un autre.  C'est ainsi que nous cr√©erons une trace permanente. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/04e/3bd/a26/04e3bda26fe04e7832163e2e08abdd64.gif"></div><br>  Tout d'abord, nous devons cr√©er un tampon constant. <br><br><h3>  Cr√©ation d'un tampon persistant </h3><br>  Acc√©dez au dossier <em>RenderTargets</em> et cr√©ez une nouvelle <em>cible de rendu</em> appel√©e <em>RT_Persistent</em> .  Dans ce didacticiel, nous n'avons pas √† modifier les param√®tres de texture, mais dans votre propre projet, vous devrez vous assurer que les deux rendus cibles utilisent la m√™me r√©solution. <br><br>  Ensuite, nous avons besoin de mat√©riel qui copiera la capture dans un tampon permanent.  Ouvrez <em>Materials \ M_DrawToPersistent</em> et ajoutez un n≈ìud d' <em>√©chantillon de texture</em> .  S√©lectionnez la texture <em>RT_Capture</em> et connectez-la comme suit: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/29e/b31/328/29eb3132825b6b7ee68ddd5c45a73454.jpg"></div><br>  Maintenant, nous devons utiliser le mat√©riau d'√©tirage.  Cliquez sur <em>Appliquer</em> , puis ouvrez <em>BP_Capture</em> .  Tout d'abord, cr√©ez une instance dynamique du mat√©riau (plus tard, nous devrons lui transmettre des valeurs).  Ajoutez les n≈ìuds en surbrillance √† l' <em>√©v√©nement BeginPlay</em> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ca2/1d0/6a1/ca21d06a1bfa563eee0df19b4da6e129.jpg"></div><br>  <em>Clear Render Target Les</em> n≈ìuds <em>2D</em> effacent chaque rendu cible avant utilisation. <br><br>  Ouvrez ensuite la fonction <em>DrawToPersistent</em> et ajoutez les n≈ìuds en surbrillance: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c21/88c/051/c2188c0511541f5fcaee1773318653ac.jpg"></div><br>  Ensuite, nous devons nous assurer que le dessin dans le tampon constant est effectu√© dans chaque image, car la capture a lieu dans chaque image.  Pour ce faire, ajoutez <em>DrawToPersistent</em> √† la <em>coche</em> d' <em>√©v√©nement</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a88/47a/e9d/a8847ae9d4bafffbaacf448af86f538d.jpg"></div><br>  Enfin, nous devons ajouter un tampon persistant au rendu de capture cible. <br><br><h3>  Enregistrez pour capturer </h3><br>  Cliquez sur <em>Compiler</em> et ouvrez <em>PP_DepthCheck</em> .  Ajoutez ensuite les n≈ìuds en surbrillance.  Pour <em>√âchantillon de texture,</em> d√©finissez la valeur sur <em>RT_Persistent</em> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/afb/ff2/a99/afbff2a99105d523fd44acf437787e06.jpg"></div><br>  Maintenant que la cible se transcrit en √©criture, nous obtenons des traces qui restent.  Cliquez sur <em>Appliquer</em> , puis fermez le mat√©riau.  Cliquez sur <em>Play</em> et commencez √† laisser des pistes! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d79/b8a/fd8/d79b8afd898378111e1fc6b62464bf2a.gif"></div><br>  Le r√©sultat est superbe, mais le circuit r√©sultant ne fonctionne que pour une seule zone de la carte.  Si vous allez au-del√† de la zone de capture, les traces cesseront d'appara√Ætre. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/764/641/1a7/7646411a7886c8c1004a34b2d6f3bda9.gif"></div><br>  Vous pouvez r√©soudre ce probl√®me en d√©pla√ßant la zone de capture avec le lecteur.  Cela signifie que des traces appara√Ætront toujours autour de la zone dans laquelle se trouve le joueur. <br><br>  <em>Remarque:</em> lorsque la capture se d√©place, toutes les informations en dehors de la zone de capture sont supprim√©es.  Cela signifie que si vous retournez dans la zone o√π il y avait d√©j√† des traces, elles dispara√Ætront d√©j√†.  Dans le didacticiel suivant, je vais vous montrer comment cr√©er des pistes partiellement conserv√©es. <br><br><h2>  Capture de mouvement </h2><br>  Vous pouvez d√©cider qu'il est assez simple de lier la position de capture XY √† la position XY du joueur.  Mais si vous le faites, le rendu cible commencera √† devenir flou.  En effet, nous d√©pla√ßons le rendu cible avec un pas inf√©rieur √† un pixel.  Lorsque cela se produit, la nouvelle position des pixels se situe <i>entre les</i> pixels.  Par cons√©quent, un pixel est interpol√© par plusieurs pixels.  Voici √† quoi √ßa ressemble: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d6f/e29/d8e/d6fe29d8ea33db2479e5e897e6d90344.gif"></div><br>  Pour r√©soudre ce probl√®me, nous devons d√©placer la capture par √©tapes discr√®tes.  Nous calculons <em>la taille des pixels dans le monde</em> , puis d√©pla√ßons la capture √† des √©tapes √©gales √† cette taille.  Ensuite, chaque pixel ne sera jamais entre les autres, donc le flou n'appara√Ætra pas. <br><br>  Pour commencer, cr√©ons un param√®tre dans lequel l'emplacement de capture sera stock√©.  Le mat√©riau terrestre en aura besoin pour effectuer des calculs de projection.  Ouvrez <em>MPC_Capture</em> et ajoutez un <em>param√®tre vectoriel</em> appel√© <em>CaptureLocation</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e4/0c7/4c3/1e40c74c3c19e6e8a2520d10874b9c13.jpg"></div><br>  Ensuite, vous devez mettre √† jour le mat√©riau terrestre pour utiliser le nouveau param√®tre.  Fermez <em>MPC_Capture</em> et ouvrez <em>M_Landscape</em> .  Modifiez la premi√®re partie des calculs de projection comme suit: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d22/8e4/411/d228e4411ac885ec3a29878f7b5d930f.jpg"></div><br>  Maintenant, le rendu cible sera toujours projet√© sur l'emplacement de capture.  Cliquez sur <em>Appliquer</em> et fermez le mat√©riau. <br><br>  Ensuite, nous allons faire le mouvement de capture avec une √©tape discr√®te. <br><br><h3>  Mouvement de capture de pas discret </h3><br>  Pour calculer la taille des pixels dans le monde, vous pouvez utiliser l'√©quation suivante: <br><br><pre><code class="cpp hljs">(<span class="hljs-number"><span class="hljs-number">1</span></span> / RenderTargetResolution) * CaptureSize</code> </pre> <br>  Pour calculer la nouvelle position, nous utilisons l'√©quation ci-dessous pour chaque composante de la position (dans notre cas, pour les coordonn√©es X et Y). <br><br><pre> <code class="cpp hljs">(<span class="hljs-built_in"><span class="hljs-built_in">floor</span></span>(Position / PixelWorldSize) + <span class="hljs-number"><span class="hljs-number">0.5</span></span>) * PixelWorldSize</code> </pre> <br>  Maintenant, utilisez-les dans la capture de plans.  Pour gagner du temps, j'ai cr√©√© la macro <em>SnapToPixelWorldSize</em> pour la deuxi√®me √©quation.  Ouvrez <em>BP_Capture</em> , puis ouvrez la fonction <em>MoveCapture</em> .  Ensuite, cr√©ez le diagramme suivant: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c10/e17/55d/c10e1755df187bb3578d1b496402101f.jpg"></div><br>  Il calculera le nouvel emplacement, puis enregistrera la diff√©rence entre le nouvel emplacement et l'emplacement actuel dans <em>MoveOffset</em> .  Si vous utilisez une r√©solution autre que 256 √ó 256, modifiez la valeur en surbrillance. <br><br>  Ensuite, ajoutez les n≈ìuds s√©lectionn√©s: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e9/963/879/1e9963879bfe2465f49a71665317db20.jpg"></div><br>  Ce circuit d√©place la capture avec le d√©calage calcul√©.  Elle enregistrera ensuite le nouvel emplacement de capture dans <em>MPC_Capture</em> afin qu'il puisse √™tre utilis√© par le mat√©riel au sol. <br><br>  Enfin, nous devons effectuer une mise √† jour de position dans chaque image.  Fermez la fonction et ajoutez-la √† la <em>coche d'</em> <em>√©v√©nement</em> avant <em>DrawToPersistent</em> <em>MoveCapture</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f15/3c6/d54/f153c6d5438ba54a85f2b3749b179bb9.jpg"></div><br>  D√©placer une capture n'est que la moiti√© de la solution.  Nous devons √©galement d√©placer le tampon constant.  Sinon, la capture et le tampon persistant seront d√©synchronis√©s et produiront des r√©sultats √©tranges. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e1f/4fa/008/e1f4fa0086dc9f41412b70856f246149.gif"></div><br><h3>  D√©placement de tampon permanent </h3><br>  Pour d√©placer un tampon constant, nous devons passer le d√©calage de d√©placement calcul√©.  Ouvrez <em>M_DrawToPersistent</em> et ajoutez les n≈ìuds en surbrillance: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e65/d15/16b/e65d1516bc33002a2e2a3bc7e9c96b00.jpg"></div><br>  Pour cette raison, le tampon constant sera d√©cal√© de la valeur du d√©calage transmis.  Comme dans le mat√©riau de la terre, nous devons inverser la coordonn√©e X et effectuer le masquage.  Cliquez sur <em>Appliquer</em> et fermez le mat√©riau. <br><br>  Ensuite, vous devez transf√©rer le d√©calage.  Ouvrez <em>BP_Capture</em> , puis ouvrez la fonction <em>DrawToPersistent</em> .  Ensuite, ajoutez les n≈ìuds en surbrillance: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/666/621/f22/666621f22bde013dd710991d5adfa7e4.jpg"></div><br>  C'est ainsi que nous convertissons <em>MoveOffset</em> en espace UV, puis le passons dans le mat√©riau de dessin. <br><br>  Cliquez sur <em>Compiler</em> , puis fermez le plan.  Cliquez sur <em>Play</em> et courez au contenu de votre c≈ìur!  Peu importe la distance parcourue, les traces resteront toujours autour de vous. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a94/097/5cb/a940975cb157444251cdb31bf195c8f2.gif"></div><br><h2>  O√π aller ensuite? </h2><br>  Le projet termin√© peut √™tre t√©l√©charg√© ici. <br><br>  Il n'est pas n√©cessaire d'utiliser les pistes cr√©√©es dans ce didacticiel uniquement pour la neige.  Vous pouvez m√™me les utiliser pour des choses comme l'herbe concass√©e (dans le prochain tutoriel, je montrerai comment cr√©er une version avanc√©e du syst√®me). <br><br>  Si vous souhaitez travailler avec des paysages et des rendus cibles, je vous recommande de regarder la vid√©o de Chris Murphy <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Building High-End Gameplay Effects with Blueprint</a> .  Ce tutoriel vous montrera comment cr√©er un √©norme laser qui br√ªle la terre et l'herbe! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr416703/">https://habr.com/ru/post/fr416703/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr416691/index.html">S√©curit√© de l'apprentissage automatique: techniques de d√©fense efficaces ou nouvelles menaces?</a></li>
<li><a href="../fr416693/index.html">Certificats D-Link et √©volution des technologies de l'information utilis√©s pour signer les logiciels malveillants</a></li>
<li><a href="../fr416695/index.html">Prise en charge de vSphere 6.7 et d'autres fonctionnalit√©s de la derni√®re mise √† jour 3a de Veeam Backup & Replication 9.5</a></li>
<li><a href="../fr416697/index.html">Fusion d'op√©rateurs t√©l√©coms en 2018</a></li>
<li><a href="../fr416699/index.html">Sniper Geek ou comment faire un "oeil vif"</a></li>
<li><a href="../fr416707/index.html">Logiciel de gestion de bureau √† distance - Aspia</a></li>
<li><a href="../fr416709/index.html">IoT et progr√®s naturel: les technologies et gadgets les plus controvers√©s</a></li>
<li><a href="../fr416711/index.html">Pages de l'histoire d'Intel. Incendie de l'usine de Penang</a></li>
<li><a href="../fr416713/index.html">Rapport du Club de Rome 2018, chapitre 3.14: ¬´Pas un seul PIB ...¬ª</a></li>
<li><a href="../fr416719/index.html">Extension PHP et Kotlin Native. Deuxi√®me partie, consciente</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>