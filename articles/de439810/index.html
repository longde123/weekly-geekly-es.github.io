<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤦🏼 💪🏾 🐔 Lernen Sie das Moleculer Microservice Framework kennen 👩🏾‍🤝‍👩🏽 👩🏾 🥋</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo% habrauser%! 

 Heute möchte ich Ihnen von einem meiner Meinung nach ausgezeichneten Moleculer Microservice Framework erzählen. 



 Ursprünglic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lernen Sie das Moleculer Microservice Framework kennen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439810/"> Hallo% habrauser%! <br><br>  Heute möchte ich Ihnen von einem meiner Meinung nach ausgezeichneten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Moleculer</a> Microservice Framework erzählen. <br><br><img src="https://habrastorage.org/webt/n1/8a/ew/n18aewfs_oj6ndbonuakkyjfwte.png"><br><br>  Ursprünglich wurde dieses Framework in Node.js geschrieben, später jedoch an Ports in anderen Sprachen wie Java, Go, Python und .NET, und höchstwahrscheinlich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">werden</a> in naher Zukunft andere Implementierungen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">erscheinen</a> .  Wir verwenden es seit ungefähr einem Jahr in der Produktion in mehreren Produkten und es ist schwer mit Worten zu beschreiben, wie gesegnet er uns nach der Verwendung von Seneca und unseren Motorrädern erschien.  Wir haben alles, was wir brauchen, sofort einsatzbereit: Sammeln von Metriken, Zwischenspeichern, Ausgleichen, Fehlertoleranz, Auswählen von Transporten, Parameterüberprüfung, Protokollieren, präzise Methodendeklarationen, verschiedene Arten der Interaktion zwischen Diensten, Mixins und vieles mehr.  Und jetzt in Ordnung. <br><a name="habracut"></a><br><h2>  Einführung </h2><br>  Das Framework besteht in der Tat aus drei Komponenten (in der Tat, nein, aber Sie werden unten mehr darüber erfahren). <br><br><h4>  Transporter </h4><br>  Verantwortlich für die Entdeckung von Diensten und die Kommunikation zwischen ihnen.  Dies ist eine Schnittstelle, die Sie selbst implementieren können, wenn Sie dies wünschen, oder Sie können vorgefertigte Implementierungen verwenden, die Teil des Frameworks selbst sind.  Ab der Box stehen 7 Transporte zur Verfügung: TCP, Redis, AMQP, MQTT, NATS, NATS-Streaming, Kafka.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hier</a> können Sie mehr sehen.  Wir verwenden den Redis-Transport, planen jedoch, mit dem Verlassen des experimentellen Zustands auf TCP umzusteigen. <br><br>  In der Praxis interagieren wir beim Schreiben von Code nicht mit dieser Komponente.  Sie müssen nur wissen, was er ist.  Der verwendete Transport wird in der Konfiguration angegeben.  Um von einem Transport zum anderen zu wechseln, ändern Sie einfach die Konfiguration.  Das ist alles.  Ungefähr so: <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ./moleculer.config.js module.exports = { transporter: 'redis://:pa$$w0rd@127.0.0.1:6379', // ...   }</span></span></code> </pre> <br>  Daten werden standardmäßig im JSON-Format geliefert.  Sie können jedoch alles verwenden: Avro, MsgPack, Notepack, ProtoBuf, Thrift usw. <br><br><h4>  Service </h4><br>  Die Klasse, von der wir beim Schreiben unserer Microservices erben. <br><br>  Hier ist der einfachste Dienst ohne Methoden, der jedoch von anderen Diensten erkannt wird: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ./services/telemetry/telemetry.service.js const { Service } = require('moleculer'); module.exports = class TelemetryService extends Service { constructor(broker) { super(broker); this.parseServiceSchema({ name: 'telemetry', }); } };</span></span></code> </pre><br><br><h4>  Service Broker </h4><br>  Der Kern des Frameworks. <br><br><img src="https://habrastorage.org/webt/t7/wp/qo/t7wpqorpz4zhmczcvir_fs9cems.png"><br><br>  Übertreibend können wir sagen, dass dies eine Schicht zwischen Transport und Service ist.  Wenn ein Dienst irgendwie mit einem anderen Dienst interagieren möchte, geschieht dies über einen Broker (Beispiele werden unten angegeben).  Der Broker befasst sich mit dem Lastausgleich (unterstützt standardmäßig mehrere Strategien, einschließlich benutzerdefinierter Strategien - Round-Robin), wobei Live-Dienste, verfügbare Methoden in diesen Diensten usw. berücksichtigt werden.  Zu diesem Zweck verwendet ServiceBroker eine andere Komponente unter der Haube - die Registrierung, aber ich werde nicht darauf eingehen, wir werden sie nicht für Bekanntschaften benötigen. <br><br>  Einen Makler zu haben, gibt uns eine äußerst bequeme Sache.  Jetzt werde ich versuchen zu klären, muss aber ein wenig beiseite treten.  Im Kontext des Frameworks gibt es so etwas wie einen Knoten.  In einfacher Sprache ist ein Knoten ein Prozess im Betriebssystem (dh was passiert, wenn wir beispielsweise "node index.js" in die Konsole eingeben).  Jeder Knoten ist ein ServiceBroker mit einem Satz von einem oder mehreren Mikrodiensten.  Ja, du hast richtig gehört.  Wir können unseren Service-Stack nach Herzenslust aufbauen.  Warum ist das bequem?  Für die Entwicklung starten wir einen Knoten, in dem alle Microservices gleichzeitig gestartet werden (jeweils 1), nur einen Prozess im System, mit dem beispielsweise Hotreload sehr einfach verbunden werden kann.  In der Produktion - ein separater Knoten für jede Instanz des Dienstes.  Nun, oder eine Mischung, wenn ein Teil der Dienste in einem Knoten, ein Teil in einem anderen usw. (obwohl ich nicht weiß, warum ich das tun soll, nur um zu verstehen, dass Sie dies auch tun können). <br><br><div class="spoiler">  <b class="spoiler_title">So sieht unsere index.js aus</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { resolve } = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { ServiceBroker } = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'moleculer'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./moleculer.config.js'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { SERVICES, NODE_ENV, } = process.env; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> broker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServiceBroker(config); broker.loadServices( resolve(__dirname, <span class="hljs-string"><span class="hljs-string">'services'</span></span>), SERVICES ? <span class="hljs-string"><span class="hljs-string">`*/@(</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${SERVICES.split(</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">','</span></span></span></span><span class="hljs-string"><span class="hljs-subst">).map(i =&gt; i.trim()).join(</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'|'</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">).service.js`</span></span> : <span class="hljs-string"><span class="hljs-string">'*/*.service.js'</span></span>, ); broker.start().then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (NODE_ENV === <span class="hljs-string"><span class="hljs-string">'development'</span></span>) { broker.repl(); } });</code> </pre><br></div></div><br>  Wenn keine Umgebungsvariable vorhanden ist, werden alle Dienste aus dem Verzeichnis geladen, andernfalls per Maske.  Broker.repl () ist übrigens eine weitere praktische Funktion des Frameworks.  Wenn Sie im Entwicklungsmodus starten, haben wir genau dort in der Konsole eine Schnittstelle zum Aufrufen von Methoden (was Sie beispielsweise über einen Postboten in Ihrem Microservice tun würden, der über http kommuniziert). Nur hier ist es viel praktischer: Die Schnittstelle befindet sich in derselben Konsole wo sie npm angefangen haben. <br><br><h2>  Interservice-Interaktion </h2><br>  Es wird auf drei Arten durchgeführt: <br><br><h4>  anrufen </h4><br>  Am häufigsten verwendet.  Eine Anfrage gestellt, eine Antwort (oder einen Fehler) erhalten. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   "report",     "csv". async getCsvReport({ jobId }) { const rows = []; // ... return this.broker.call('csv.stringify', { rows }); }</span></span></code> </pre><br>  Wie oben erwähnt, werden Anrufe automatisch ausgeglichen.  Wir erhöhen nur die erforderliche Anzahl von Service-Instanzen, und das Framework selbst übernimmt den Ausgleich. <br><br><img src="https://habrastorage.org/webt/jl/nj/r4/jlnjr4zxz943pfzpc9epoxpbgw8.gif"><br><br><h4>  emittieren </h4><br>  Wird verwendet, wenn wir nur andere Dienste über ein Ereignis benachrichtigen möchten, das Ergebnis jedoch nicht benötigen. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   "user"    . async registerUser({ email, password }) { // ... this.broker.emit('user_registered', { email }); return true; }</span></span></code> </pre><br>  Andere Dienste können dieses Ereignis abonnieren und entsprechend reagieren.  Optional können Sie als drittes Argument explizit die Dienste festlegen, die für den Empfang dieses Ereignisses verfügbar sind. <br><br>  Der wichtige Punkt ist, dass das Ereignis nur eine Instanz jeder Art von Dienst empfängt, d. H.  Wenn wir 10 "Mail" - und 5 "Abonnement" -Dienste haben, die dieses Ereignis abonniert haben, erhalten es tatsächlich nur 2 Kopien - eine "Mail" und ein "Abonnement".  Sieht schematisch so aus: <br><br><img src="https://habrastorage.org/webt/yf/fg/oj/yffgoj5ce8pzhcfdl_rdian6hpg.gif"><br><br><h4>  Sendung </h4><br>  Das gleiche wie emittieren, aber ohne Einschränkungen.  Alle 10 Mail- und 5 Abonnementdienste werden diese Veranstaltung abfangen. <br><br><h2>  Validierung von Parametern </h2><br>  Standardmäßig wird der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">schnellste Validator</a> verwendet, um die Parameter zu validieren. Er scheint sehr schnell zu sein.  Nichts hindert Sie jedoch daran, ein anderes, beispielsweise dasselbe Joi, zu verwenden, wenn Sie eine erweiterte Validierung benötigen. <br><br>  Wenn wir einen Service schreiben, erben wir von der Service-Basisklasse, deklarieren Methoden mit darin enthaltener Geschäftslogik, aber diese Methoden sind "privat". Sie können nicht von außen (von einem anderen Service) aufgerufen werden, bis wir dies explizit deklarieren möchten Abschnitt "Sonderaktionen" während der Dienstinitialisierung (öffentliche Dienstmethoden im Kontext des Frameworks werden als Aktionen bezeichnet). <br><br><div class="spoiler">  <b class="spoiler_title">Beispiel einer Methodendeklaration mit Validierung</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JobService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(broker) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(broker); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.parseServiceSchema({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'job'</span></span>, <span class="hljs-attr"><span class="hljs-attr">actions</span></span>: { <span class="hljs-attr"><span class="hljs-attr">update</span></span>: { <span class="hljs-attr"><span class="hljs-attr">params</span></span>: { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'number'</span></span>, <span class="hljs-attr"><span class="hljs-attr">convert</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'string'</span></span>, <span class="hljs-attr"><span class="hljs-attr">empty</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">optional</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'object'</span></span>, <span class="hljs-attr"><span class="hljs-attr">optional</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, }, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> handler(ctx) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.update(ctx.params); }, }, }, }); } <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> update({ id, name, data }) { <span class="hljs-comment"><span class="hljs-comment">// ... } }</span></span></code> </pre><br></div></div><br><h2>  Mixins </h2><br>  Wird beispielsweise zum Initialisieren einer Datenbankverbindung verwendet.  Vermeiden Sie die Vervielfältigung von Code von Dienst zu Dienst. <br><br><div class="spoiler">  <b class="spoiler_title">Beispiel-Mixin zum Initialisieren einer Verbindung zu Redis</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Redis = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'ioredis'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ key = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'redis'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, options } = {}</span></span></span><span class="hljs-function">) =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">settings</span></span>: { [key]: options, }, created() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[key] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Redis(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.settings[key]); }, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> started() { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[key].connect(); }, stopped() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[key].disconnect(); }, });</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Mixin im Service verwenden</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { Service, Errors } = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'moleculer'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> redis = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../../mixins/redis'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> server = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../../mixins/server'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> router = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./router'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { REDIS_HOST, REDIS_PORT, REDIS_PASSWORD, } = process.env; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> redisOpts = { <span class="hljs-attr"><span class="hljs-attr">host</span></span>: REDIS_HOST, <span class="hljs-attr"><span class="hljs-attr">port</span></span>: REDIS_PORT, <span class="hljs-attr"><span class="hljs-attr">password</span></span>: REDIS_PASSWORD, <span class="hljs-attr"><span class="hljs-attr">lazyConnect</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, }; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AuthService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(broker) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(broker); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.parseServiceSchema({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'auth'</span></span>, <span class="hljs-attr"><span class="hljs-attr">mixins</span></span>: [redis({ <span class="hljs-attr"><span class="hljs-attr">options</span></span>: redisOpts }), server({ router })], }); } }</code> </pre> <br></div></div><br><h2>  Caching </h2><br>  Methodenaufrufe (Aktionen) können auf verschiedene Arten zwischengespeichert werden: LRU, Speicher, Redis.  Optional können Sie angeben, nach welchen Schlüsselaufrufen zwischengespeichert werden soll (standardmäßig wird der Objekt-Hash als Caching-Schlüssel verwendet) und mit welcher TTL. <br><br><div class="spoiler">  <b class="spoiler_title">Beispiel für eine zwischengespeicherte Methodendeklaration</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InventoryService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(broker) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(broker); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.parseServiceSchema({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'inventory'</span></span>, <span class="hljs-attr"><span class="hljs-attr">actions</span></span>: { <span class="hljs-attr"><span class="hljs-attr">getInventory</span></span>: { <span class="hljs-attr"><span class="hljs-attr">params</span></span>: { <span class="hljs-attr"><span class="hljs-attr">steamId</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'string'</span></span>, <span class="hljs-attr"><span class="hljs-attr">pattern</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/^76\d{15}$/</span></span> }, <span class="hljs-attr"><span class="hljs-attr">appId</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'number'</span></span>, <span class="hljs-attr"><span class="hljs-attr">integer</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">contextId</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'number'</span></span>, <span class="hljs-attr"><span class="hljs-attr">integer</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, }, <span class="hljs-attr"><span class="hljs-attr">cache</span></span>: { <span class="hljs-attr"><span class="hljs-attr">keys</span></span>: [<span class="hljs-string"><span class="hljs-string">'steamId'</span></span>, <span class="hljs-string"><span class="hljs-string">'appId'</span></span>, <span class="hljs-string"><span class="hljs-string">'contextId'</span></span>], <span class="hljs-attr"><span class="hljs-attr">ttl</span></span>: <span class="hljs-number"><span class="hljs-number">15</span></span>, }, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> handler(ctx) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }, }, }, }); } <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre><br></div></div><br>  Die Caching-Methode wird über die ServiceBroker-Konfiguration festgelegt. <br><br><h2>  Protokollierung </h2><br>  Hier ist aber auch alles ganz einfach.  Es gibt einen ziemlich guten eingebauten Logger, der in die Konsole schreibt. Es ist möglich, benutzerdefinierte Formatierungen anzugeben.  Nichts hindert daran, andere beliebte Holzfäller zu stehlen, sei es Winston oder Bunyan.  Ein ausführliches Handbuch finden Sie in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> .  Persönlich verwenden wir den integrierten Logger. Der benutzerdefinierte Formatierer für einige Codezeilen, die in die JSON-Konsole gelangen, wird einfach im Produkt abgeschnitten. Anschließend gelangen sie mithilfe des Docker-Protokolltreibers in Graylog. <br><br><h2>  Metriken </h2><br>  Falls gewünscht, können Sie Metriken für jede Methode sammeln und alles in einem Zipkin verfolgen.  Hier finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">die</a> vollständige Liste der verfügbaren Exporteure.  Derzeit gibt es fünf davon: Zipkin, Jaeger, Prometheus, Elastic, Console.  Es wird wie das Caching konfiguriert, wenn eine Methode (Aktion) deklariert wird. <br><br>  Visualisierungsbeispiele für das Elasticsearch + Kibana-Bundle unter Verwendung des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Elastic-Apm-Node-</a> Moduls können unter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diesem Link</a> in Github eingesehen werden. <br><br>  Am einfachsten ist es natürlich, die Konsolenoption zu verwenden.  Es sieht so aus: <br><br><img src="https://habrastorage.org/webt/eu/dq/20/eudq20mgo7wtbqmstlp_aiidicy.png"><br><br><h2>  Fehlertoleranz </h2><br>  Das Framework verfügt über einen eingebauten Leistungsschalter, der über die ServiceBroker-Einstellungen gesteuert wird.  Wenn ein Dienst ausfällt und die Anzahl dieser Fehler einen bestimmten Schwellenwert überschreitet, wird er als fehlerhaft markiert. Die Anforderungen werden stark eingeschränkt, bis keine Fehler mehr auftreten. <br><br>  Als Bonus gibt es auch einen Fallback, der für jede Methode (Aktion) individuell einstellbar ist, falls wir davon ausgehen, dass die Methode fehlschlägt, und beispielsweise zwischengespeicherte Daten oder einen Stub senden. <br><br><h2>  Fazit </h2><br>  Die Einführung dieses Frameworks wurde für mich zu einem Hauch frischer Luft, der eine große Menge an Bunts sparte (mit Ausnahme der Tatsache, dass die Microservice-Architektur eine große Bunt ist) und das Radfahren das Schreiben des nächsten Microservice einfach und transparent machte.  Es ist nichts überflüssig, es ist einfach und sehr flexibel, und Sie können den ersten Dienst innerhalb von ein oder zwei Stunden nach dem Lesen der Dokumentation schreiben.  Ich werde mich freuen, wenn dieses Material für Sie nützlich ist und Sie in Ihrem nächsten Projekt dieses Wunder versuchen möchten, wie wir es getan haben (und es noch nicht bereut haben).  Gut zu allen! <br><br>  Wenn Sie an diesem Framework interessiert sind, nehmen Sie am Chat in Telegram - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@moleculerchat teil</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de439810/">https://habr.com/ru/post/de439810/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de439794/index.html">Rückenschmerzen - Verständnis aus Sicht der modernen Medizin</a></li>
<li><a href="../de439796/index.html">Spring Boot 2: Was sie nicht in Versionshinweisen schreiben</a></li>
<li><a href="../de439804/index.html">Zen des Unit Testing</a></li>
<li><a href="../de439806/index.html">Gültige SSL-Domänennamen für lokale Docker-Container</a></li>
<li><a href="../de439808/index.html">Die größten Teleskope. Von Notebook und Augen bis hin zu 340-Megapixel-Kameras und Rechenzentren. Teil 1</a></li>
<li><a href="../de439812/index.html">Kaggle-Ansätze für CV in Prod: Sie können nicht implementieren, um zu schneiden</a></li>
<li><a href="../de439818/index.html">Merkmale von Designansätzen im realen Fertigungssektor</a></li>
<li><a href="../de439822/index.html">Erstellen einer alternativen Anzeige für den Ensoniq EPS16 + und ASR10 Synthesizer / Sampler</a></li>
<li><a href="../de439824/index.html">Wann verschwinden JavaScript-Frameworks?</a></li>
<li><a href="../de439826/index.html">Analog deaktivieren. Was wird mit dem Fernsehen passieren?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>