<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöµüèΩ üë®üèø‚Äçüç≥ üë©üèΩ‚Äçüè´ Servidor de Ad Exchange: a diferencia de otros üë®üèº‚Äçüîß üë©üèº üçï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ad Exchange como parte de Real-Time Bidding (RTB) es una de las soluciones de AdTech que est√°n transformando el mercado publicitario en l√≠nea. Su func...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Servidor de Ad Exchange: a diferencia de otros</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/maxilect/blog/421471/">  Ad Exchange como parte de Real-Time Bidding (RTB) es una de las soluciones de AdTech que est√°n transformando el mercado publicitario en l√≠nea.  Su funci√≥n principal es acoplar una gran cantidad de SSP y DSP que no tienen integraci√≥n directa entre s√≠, as√≠ como revender una variedad de tr√°fico publicitario entre ellos. <br><br>  Gracias a un pedido para el mercado estadounidense, nos sumergimos de lleno en los detalles espec√≠ficos de la construcci√≥n de la plataforma Ad Exchange.  Y en este art√≠culo presentamos algunas ideas y resultados. <br><br><img src="https://habrastorage.org/webt/ua/tj/gw/uatjgwrn-musoqo-_gchjt2fptc.jpeg" alt="imagen"><br><a name="habracut"></a><br><h2>  Declaraci√≥n del problema. </h2><br>  Las ofertas en tiempo real (RTB) ofrecen la venta de espacios publicitarios en sitios en tiempo real para mostrar anuncios relevantes al p√∫blico objetivo. <br><br>  En resumen, el diagrama del proceso es el siguiente: <br><br><img src="https://habrastorage.org/webt/u4/e9/3w/u4e93wxmuauj4qskiyt0wt4gz-q.png" alt="imagen"><br><br><ul><li>  el usuario final solicita una p√°gina web o aplicaci√≥n m√≥vil donde se reserva un lugar para un banner (el c√≥digo para la plataforma de venta de inventario publicitario est√° incorporado: SSP, plataforma de suministro lateral); </li><li>  Para garantizar el precio de venta m√°ximo del inventario, el SSP organiza licitaciones entre los diversos DSP (plataforma del lado de la demanda) a trav√©s de Ad Exchange, cuyo objetivo es comprar el inventario lo m√°s barato posible; </li><li>  despu√©s del anuncio del ganador de la subasta, el DSP ganador env√≠a un c√≥digo de banner SSP, que se muestra al usuario; </li><li>  Otro aspecto del proceso es DMP, un sistema de terceros que proporciona a DSP informaci√≥n detallada sobre el usuario final (m√°s all√° de lo que puede transmitir SSP en forma de cookies, etc.) para justificar la conveniencia de la compra y el costo propuesto. </li></ul><br>  Hay bastantes intercambios de Ad Exchange hoy.  Adem√°s, muchos SSP implementan sus propias ofertas (en realidad cierran la funcionalidad de Ad Exchange).  Pero nuestro cliente estaba seguro de que, debido a algunas ideas nuevas, podr√≠a ingresar r√°pidamente al mercado y resistir la competencia. <br><br>  Los intercambios funcionan seg√∫n diferentes principios: alguien ofrece un margen mayor, alguien menos, alguien vende equipos √∫nicos, otros se centran en bienes de consumo condicionales.  El mercado es bastante joven y se est√° desarrollando activamente, por lo tanto, no hay modelos de negocio probados a lo largo de los a√±os: todo se basa en hip√≥tesis y experimentos audaces.  La mayor√≠a de los jugadores trabajan de acuerdo con un esquema simple: reciben una solicitud de uno de varios SSP con los que pudieron ponerse de acuerdo y la env√≠an a todos los DSP integrados en anticipaci√≥n de una mejor apuesta.  Ingresos de Ad Exchange: la diferencia entre el precio de compra y venta del inventario publicitario en SSP y DSP menos los costos operativos. <br><br>  Nuestro cliente sugiri√≥ optimizar este esquema distribuyendo correctamente las solicitudes de SSP al DSP, no enviando deliberadamente solicitudes "perdidas", reduciendo as√≠ los costos operativos.  Debido a esto, puede reducir la comisi√≥n del intercambio sin perder ingresos y hacer que su oferta sea m√°s atractiva en el contexto de Ad Exchange compitiendo en la lucha por SSP y DSP.  Y conectar m√°s socios dar√° ingresos y estabilidad en el mercado. <br><br>  Para implementar esta estrategia en el mercado de EE. UU., Se nos asign√≥ la tarea de realizar Ad Exchange con una distribuci√≥n inteligente de las solicitudes, que deb√≠a proporcionar un buen porcentaje de recompra.  En teor√≠a, para dicha distribuci√≥n, puede usar mucha informaci√≥n que acompa√±a a la solicitud, incluso datos de los sistemas de terceros (DMP) mencionados anteriormente.  Sin embargo, el an√°lisis complejo requiere recursos, por lo que la tarea es encontrar un equilibrio entre los costos de la distribuci√≥n inteligente y la ganancia (en comparaci√≥n con otros actores del mercado) de su implementaci√≥n.  En un mercado inmaduro relativamente nuevo, construir soluciones muy complejas, exprimir d√©cimas de optimizaci√≥n, simplemente no tiene sentido. <br><br>  Una caracter√≠stica importante del proyecto, adem√°s de las altas cargas esperadas, fue el cumplimiento de los requisitos no funcionales para la velocidad de la subasta presentada por SSP.  En este segmento del mercado, es adecuado el tiempo de espera para esperar una respuesta del SSP a 300 ms, que tuvo que cumplirse junto con las llamadas a sistemas externos (DSP). <br><br>  El proyecto comenz√≥ en el oto√±o de 2016.  Gracias a la experiencia del equipo en esta √°rea, despu√©s de tres meses hicimos el primer prototipo y despu√©s de tres MVP (Producto m√≠nimo viable) m√°s listo, lo que nos permiti√≥ recopilar los primeros an√°lisis para comenzar la distribuci√≥n inteligente de solicitudes dentro de Ad Exchange. <br><br>  El lanzamiento de MVP mostr√≥ que la hip√≥tesis sobre el √©xito comercial del proyecto es correcta: Ad Exchange comenz√≥ a ganar dinero para el cliente.  Los planes de desarrollo iniciales para Ad Exchange incluyeron un estudio m√°s profundo de los datos, conectando la informaci√≥n del usuario final desde sistemas externos a an√°lisis.  Pero en la etapa de MVP, se decidi√≥ usar solo los datos que tiene el SSP.  Esto fue suficiente para obtener el beneficio esperado. <br><br><h2>  Arquitectura de soluciones </h2><br>  La soluci√≥n se basa en la plantilla de la Cadena de responsabilidad, que permite no corregir la ruta de las solicitudes dentro del sistema, agregando f√°cilmente procesadores y diversos servicios, desde la subasta misma hasta las herramientas de filtrado. <br><br><img src="https://habrastorage.org/webt/oo/kd/gk/ookdgk5zkuz2ryzrq7xahistsno.jpeg" alt="imagen"><br><br>  El cliente no nos limit√≥ en la pila de tecnolog√≠as utilizadas.  Por lo tanto, cuidando el desarrollo futuro y el soporte del proyecto, creamos una soluci√≥n escalable horizontalmente usando Postgres y Hadoop. <br><br>  Ad Exchange en s√≠ est√° escrito en Java; al mismo tiempo, no utilizamos ning√∫n marco para no hundirnos en la carga (trabajamos en un nivel bajo). <br>  Para mantenernos dentro del tiempo de espera de SSP mencionado, seleccionamos los par√°metros del recolector de basura (se us√≥ G1) y elaboramos un trabajo sincr√≥nico con una gran cantidad de solicitudes: utilizamos un cliente HTTP que no bloquea el flujo, as√≠ como una extensi√≥n del protocolo HTTP Keep-Live que permite enviar varias solicitudes dentro Una conexi√≥n TCP. <br><br>  Los componentes de software se implementan en el hardware arrendado del host, como  Las condiciones de la tarea no permitieron el uso de la nube debido a la superposici√≥n de recursos de m√°quinas virtuales en la nube (la asignaci√≥n de los recursos necesarios puede llevar tiempo, pero no la tenemos).  Por el momento, Ad Exchange utiliza cuatro servidores f√≠sicos, uno de los cuales es redundante (para actualizaciones integradas, etc.). <br><br>  El c√≥digo abierto Apache Kafka se utiliza como intermediario de mensajes; est√° idealmente integrado en nuestro modelo de "un solo suscriptor: muchos editores", aunque tuvo que estar ligeramente torcido para que no llegaran mensajes repetidos. <br><br>  Cada uno de los servidores proporciona en el modo normal el procesamiento de aproximadamente 10 mil solicitudes por segundo (estos par√°metros se establecieron durante el desarrollo de la soluci√≥n).  Ahora, la carga promedio es de 15-20 mil solicitudes por segundo, y en el pico el flujo de solicitudes alcanz√≥ 40 mil por segundo durante varias horas, y Ad Exchange hizo un gran trabajo al respecto. <br><br>  La distribuci√≥n de solicitudes entre servidores se realiza mediante el equilibrador de carga de software nginx, que est√° configurado para nuestra tarea.  En nuestra experiencia, en nginx puede mantener hasta 60-70 mil solicitudes por segundo, sin asignar un equilibrador de hardware por separado.  Si en el futuro la carga en Ad Exchange supere este umbral, planeamos comprar un equilibrador de hardware que distribuir√° las solicitudes entre varios del mismo tipo nginx. <br><br>  Supervisa lo que est√° sucediendo, sujeto a un aumento constante de la carga, un sistema de supervisi√≥n, que forma parte del Ad Exchange creado. <br><br><h2>  Almacenamiento </h2><br>  Dada la dependencia del an√°lisis durante la distribuci√≥n de consultas, la base de datos es una parte integral de nuestro Ad Exchange.  El sistema almacena informaci√≥n sobre ofertas, participantes en subastas y transacciones. <br><br>  No tiene sentido recopilar ese volumen de datos durante todo el per√≠odo de Ad Exchange, por lo que el almacenamiento tiene una arquitectura de varios niveles.  Todos los datos de la subasta se almacenan por semana.  En base a ellos, se construyen unidades intermedias de nivel superior, que se almacenan durante varios meses.  Y sobre la base de los intermedios, se utilizan los agregados finales, que se utilizan en an√°lisis a largo plazo y para conciliaciones con SSP y DSP.  Entre otra informaci√≥n en estas unidades, hay datos sobre cu√°ntas apuestas se han realizado y cu√°nto dinero pagar√° el intercambio SSP o esperar√° recibir de DSP. <br>  Los puntos finales se almacenan durante toda la duraci√≥n de Ad Exchange. <br><br>  La recopilaci√≥n de an√°lisis y la formaci√≥n de agregados proporcionan servicios separados. <br><br>  Para que el almacenamiento correspondiera a la velocidad del sistema en s√≠, tambi√©n tuve que trabajar con √©l.  En particular, por alg√∫n tiempo peleamos con el hoster, porque  los datos de la transacci√≥n simplemente no tuvieron tiempo de escribir en la base de datos.  Result√≥ que la falla era un problema de hardware con la matriz RAID.  Despu√©s de reemplazarlo, pudimos exprimir 90,000 solicitudes por segundo en Postgres (insertando datos en la base de datos). <br><br>  El resto de Ad Exchange no tiene estado, lo que proporciona una escala horizontal f√°cil en el futuro.  No almacena ning√∫n dato sobre solicitudes: la informaci√≥n m√°xima recibida sobre qu√© DSP debe seleccionarse.  Para que podamos agregar nuevos servidores para procesar las solicitudes seg√∫n sea necesario. <br><br><h2>  Filtrado de tr√°fico </h2><br>  Un elemento clave del sistema que le permite reducir la carga y mantenerse dentro de los tiempos de espera indicados por el cliente es el filtrado de tr√°fico. <br><br>  Seg√∫n la tarea en cuesti√≥n, cualquier Ad Exchange: <br><ul><li>  acepta solicitudes del SSP; </li><li>  realiza una subasta (env√≠a solicitudes a varios DSP, compara los precios ofrecidos, identifica al ganador); </li><li>  est√° de acuerdo con la victoria del SSP (informa el precio del ganador menos su comisi√≥n, espera una respuesta con el precio final del espect√°culo); </li><li>  completa la transacci√≥n (informa al DSP necesario sobre su victoria, conduce el tr√°fico de usuarios). </li></ul><br>  La distribuci√≥n de solicitudes inteligentes en nuestro Ad Exchange se incluye en la etapa inicial de la subasta. <br><br>  Cuando recibimos una solicitud del SSP con cierta informaci√≥n (IP, agente de usuario), la detallamos utilizando la informaci√≥n acumulada en el sistema: informaci√≥n de usuario conocida, una lista de DSP a los que se enviaron solicitudes similares, sus respuestas, etc.  Esto es necesario para seleccionar la combinaci√≥n m√°s ventajosa de DSP para cada solicitud.  Gracias a la selecci√≥n de tal combinaci√≥n, el sistema le permite no enviar solicitudes a aquellos DSP que no ofertan o lo hacen, pero son demasiado bajos.  Para hacer esto, un servicio separado en tiempo real compila un mapa de c√≥mo el DSP responde a las solicitudes (estas tarjetas se almacenan en Redis). <br><br>  Paralelamente, verificamos el estado del DSP: si la proporci√≥n de respuestas dentro del tiempo de espera disminuye, el sistema reduce autom√°ticamente el n√∫mero de solicitudes a este DSP.  Tan pronto como se reduce la carga en el DSP (y aumenta la proporci√≥n de respuestas correctas en un tiempo aceptable), el n√∫mero de solicitudes vuelve gradualmente a su nivel anterior. <br><br>  Entre los DSP que respondieron a tiempo, realizamos una subasta interna: seleccione la mejor oferta y env√≠ela al SSP.  Desde el momento de la solicitud del SSP hasta nuestra respuesta, no pasan m√°s de 300 ms, de acuerdo con los requisitos de la industria. <br><br>  Dado que enviamos los datos al SSP, donde se realiza nuestra subasta, debemos considerar las ofertas ganadas all√≠.  El servidor de subastas ya est√° realizando su registro en la siguiente etapa, cuando procesa el tr√°fico de usuarios.  Gracias a √©l, el mapa de respuesta DSP se enriquece con nuevos datos (junto con la informaci√≥n recopilada sobre el usuario final). <br><br>  Una comparaci√≥n de los datos obtenidos en la etapa de subasta y los par√°metros conocidos del tr√°fico de usuarios nos permite filtrar los bots (clickers publicitarios, bots de b√∫squeda, etc.).  DSP no canjea dicho tr√°fico y, en ausencia de su propio sistema de filtrado, se convierte en p√©rdidas para el cliente, que deber√°n cubrirse con margen. <br><br>  Cabe se√±alar que el filtrado de tr√°fico de bot no se inici√≥ de inmediato.  Pero despu√©s de la inclusi√≥n de bloqueos simples, la ganancia de margen fue de aproximadamente el 50%. <br><br>  Por cierto, adem√°s de las herramientas autom√°ticas de filtrado de tr√°fico en nuestro sistema, es posible que el cliente cambie manualmente los valores de umbral de varios par√°metros, ajustando as√≠ el margen. <br><br>  El tr√°fico de usuarios en s√≠ mismo es cr√≠tico para nosotros, pero cuando se procesa, ya no es necesario encajar en 300 ms.  Utiliza un sistema de procesamiento separado, que puede contener un poco al usuario, pero no permitir√° perder esta solicitud. <br><br>  Para garantizar la estabilidad de la soluci√≥n, se introdujo un subsistema que, al comprender la carga actual de Ad Exchange, "corta" las solicitudes de subastas, que f√≠sicamente no puede procesar.  Por lo tanto, el sistema est√° protegido del crecimiento de carga incontrolado del SSP. <br><br><h2>  Perspectivas </h2><br>  Hasta la fecha, el Ad Exchange que creamos funciona y genera buenas ganancias.  Y brindamos soporte e integraci√≥n de nuevos socios (DSP / SSP) seg√∫n sea necesario.  En total, varias docenas de sistemas ya se han integrado.  Cada integraci√≥n de este tipo implica no solo una conexi√≥n de software, sino tambi√©n pruebas exhaustivas del servicio, ya que bajo cargas pesadas los problemas del servicio conectado pueden afectar a otros socios. <br><br>  En general, el mercado se est√° moviendo hacia el hecho de que SSP y DSP se conectar√°n directamente, lo que har√° innecesarios los intercambios.  Pero la integraci√≥n se basa en las capacidades de SSP y DSP.  A pesar de la existencia de la API abierta descrita (protocolo OpenRTB), todav√≠a no se reconoce universalmente en el mercado.  Por ejemplo, un jugador importante como Appnexus ha integrado recientemente el soporte para OpenRTB. <br><br>  Esencialmente, Ad Exchange es un proveedor de liquidez.  Por lo tanto, es poco probable que la decisi√≥n en el futuro cercano pierda relevancia.  Adem√°s, el modelo de intercambio solo est√° ganando popularidad en el resto del mercado publicitario. <br><br><hr><br>  Autor del art√≠culo: Nikolay Eremin <br><br>  PD: publicamos nuestros art√≠culos en varios sitios de Runet.  Suscr√≠base a nuestras p√°ginas en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">VK</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">FB</a> o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Telegram-channel</a> para conocer todas nuestras publicaciones y otras noticias de Maxilect. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es421471/">https://habr.com/ru/post/es421471/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es421461/index.html">Time Tracker para Google Scripts, documentos y hojas de c√°lculo</a></li>
<li><a href="../es421463/index.html">La vida nocturna del cielo o en busca de Perseidas - procesamiento</a></li>
<li><a href="../es421465/index.html">DevOps m√≥viles en la pr√°ctica</a></li>
<li><a href="../es421467/index.html">Desarrollo de un robot para recoger pelotas de golf.</a></li>
<li><a href="../es421469/index.html">Telegram acord√≥ transferir a los servicios especiales [pero no a Rusia] las direcciones IP y los n√∫meros de algunos usuarios</a></li>
<li><a href="../es421473/index.html">¬øQu√© son las corutinas en Kotlin?</a></li>
<li><a href="../es421475/index.html">OutOfLine: patr√≥n en memoria para aplicaciones C ++ de alto rendimiento</a></li>
<li><a href="../es421477/index.html">Lo que est√° escrito en el archivo .ssh / known_hosts</a></li>
<li><a href="../es421481/index.html">Micr√≥fonos, capturas de pantalla y video local: c√≥mo el SDK Voximplant Web controla los medios en un navegador</a></li>
<li><a href="../es421485/index.html">Aviso importante para los usuarios de Gitlab Pages</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>