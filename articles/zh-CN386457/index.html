<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎭 🔖 🧗🏽 我的家庭自动化系统的实现 🙅🏾 ❓ 🍣</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="很长时间以来，我在Habré上阅读了有关家庭自动化系统的文章，我想描述我已经从事了2年多的工作。为了更好地了解我的情况，您需要做一个简短的介绍。
 
 三年前，我和我的家人搬到了一套新的三居室公寓（67.5平方米），尽管从技术上讲公寓当然是旧的-斯大林，这是一栋建于1946年的房子。铝制两线制电线，...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>我的家庭自动化系统的实现</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/386457/"><img src="https://habrastorage.org/files/ea9/62e/a6d/ea962ea6d63c4af99f2a68e426d88fa5.jpg" align="right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">很长时间以来，我在Habré上阅读了有关家庭自动化系统的文章，我想描述我已经从事了2年多的工作。为了更好地了解我的情况，您需要做一个简短的介绍。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
三年前，我和我的家人搬到了一套新的三居室公寓（67.5平方米），尽管从技术上讲公寓当然是旧的-斯大林，这是一栋建于1946年的房子。铝制两线制电线，某些地方用1平方毫米的铜绞线组成。检修工作即将进行，我决定自己动手做，并从彻底更换布线开始。他们购买了700m的电力电缆，用于照明和1.5和2.5平方毫米的插座，双绞线托架，一些用于电视天线的同轴电缆（以防万一）。为什么这么多以及产生了什么-我要一只猫。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我决定立即进行布线，即：没有配电箱，电缆从每个点到屏蔽层（除了插座（可以是2-3点的一组），电缆从极端到屏蔽层，其余通过回路连接）-t。 e。以防万一，从每个开关将其自己的电缆连接到屏蔽层，从每个照明点将其自己的电缆连接到屏蔽层，沿rj-45点对的插座附近。当然，电缆很多。遵循PUE的所有规则将其放置在地板</font></font><br>
<br>
<img src="https://habrastorage.org/files/09e/071/732/09e0717328cb46a0b0df95701ac88122.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上的某个地方</font><font style="vertical-align: inherit;">，例如在托儿所中：</font><font style="vertical-align: inherit;">某个地方-在天花板上，例如卧室门的视图：</font></font><br>
<br>
<img src="https://habrastorage.org/files/f0f/f50/510/f0ff505103224720825920b62b9da86c.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结果，我们将所有电缆都放置在将放置屏蔽的地方的走廊中，并且可以根据需要在它们之间进行切换。即使将来必须更改连接方案，也不会花费太多时间，也不必破坏维修。当然，在所有场合都制作了许多插座-整个公寓总共约90点。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是实验过程中临时的“防护罩”的样子：</font></font><br>
<br>
<img src="https://habrastorage.org/files/1e4/0bd/131/1e40bd1311d2412686170c0ae8619274.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可怕的景象，但一切正常，这种怪物以这种形式生活了几个月。晴朗的一天，星星成功地形成了，而盾牌又经过了故意的决定而重做。在天花板下的摇摇欲坠的楼梯上花了3天（斯大林的天花板在3m内），但这是值得的。此后，遮阳板开始看起来像这样：</font></font><br>
<br>
<img src="https://habrastorage.org/files/34b/2e4/1e9/34b2e41e94a54217bad80ce53d2e0e45.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和一般视图：</font></font><br>
<br>
<img src="https://habrastorage.org/files/054/e15/85e/054e1585eeb74b7ebe62e3fcd946e1a3.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这与屏蔽的最终形式相去甚远，仍然没有足够的RCD，断路器的数量比必要的少3倍，没有脉冲继电器-但是有非断开线，所有电缆都连接到端子，至少具有某种断路器选择性。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
既然您对我必须使用的东西有一个大致的了解，那么您就可以开始描述系统的``大脑''了。事不宜迟，我以arduino为基础，尤其是因为我早就购买了2个freeduino板，2个以太网防护罩和一个电动机防护罩。还从中文订购了几个继电器模块，每个模块4个。我还发现，根据Ob上Habré上一篇文章的建议，可以在其中插入特殊弹簧的开关会变成不固定的开关。是时候编写代码了。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
总的来说，我与生活中的计算机息息相关。他完成了自己没写过的皮草垫-pascal，c＃，c ++，1c，php，javascript-您仍然可以列出很多。我上一次在Web开发领域工作时，我还处理ip-telephony。因此，提出一种算法很简单，但是对于“为您服务”的电子产品，我知道并知道简单的事情，而涉及到更复杂的事物（微控制器，保险丝，触点弹跳）则更加困难。但是不是神在烧锅，眼睛在害怕，但是手在烧。我决定简化一切。我将arduino的大地馈送到开关的输入，将开关的输出连接到arduino的模拟引脚（尽管可以数字化，但这并不重要）。我将arduino的引脚与继电器模块上的引脚相连。从技术上讲，一切准备就绪，当您按下开关时，arduino会在所需引脚上看到LOW值，并在与继电器模块相连的引脚上设置LOW。假设所有从公寓中的点到终端的电缆都已连接到终端，则连接过程不会花费很多时间。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了应对联系反弹，在互联网上研究了主题之后，选择了Bounce2库。通常，我最初想编写一个通用代码，以便它可以与至少2个开关（至少22个）一起使用。正是这一任务构成了整个算法的基础。好吧，现在从单词到代码。我不会完全上传所有代码；到github的链接将在本文的结尾。从我的角度来看，我只会展示重要的时刻。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，声明库和变量：</font></font><br>
<br>
<pre><code class="hljs apache"><span class="hljs-comment">#include &lt;Bounce2.h&gt;</span><font></font>
<span class="hljs-comment">#include &lt;EEPROM.h&gt;</span><font></font>
<font></font>
<span class="hljs-attribute">const</span> byte cnt = <span class="hljs-number">8</span>;<font></font>
<span class="hljs-attribute">const</span> byte pin_cnt = <span class="hljs-number">19</span>;<font></font>
<font></font>
<span class="hljs-attribute">int</span> pins[] = {<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">16</span>,<span class="hljs-number">17</span>};<font></font>
<span class="hljs-attribute">int</span> leds[] = {<span class="hljs-number">6</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>};<font></font>
<font></font>
<span class="hljs-attribute">byte</span> init_leds[cnt] ;<font></font>
<span class="hljs-attribute">byte</span> init_buttons[cnt];<font></font>
<span class="hljs-attribute">int</span> button_states[cnt];<font></font>
<span class="hljs-attribute">Bounce</span> debouncers[cnt];<font></font>
<span class="hljs-attribute">unsigned</span> long buttonPressTimeStamps[cnt];<font></font>
<span class="hljs-attribute">boolean</span> changed[cnt];<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重点是：随灯/开关的数量增加常数并在阵列中注册新的关联就足够了-就是说，将添加新的灯或开关。</font><font style="vertical-align: inherit;">同时，代码结构允许一个开关一次控制多个灯具。</font><font style="vertical-align: inherit;">或几个开关立即控制一盏灯。</font><font style="vertical-align: inherit;">此外，对于每个开关，都会创建其自己的Bounce对象实例以进行反跳动。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在设置功能中，所有阵列均被初始化，而照明设备的状态存储在非易失性存储器中，以便在发生电源故障或重新启动时，一切都与发生故障之前相同。</font></font><br>
<br>
<pre><code class="hljs matlab">  <span class="hljs-keyword">for</span>(byte <span class="hljs-built_in">i</span>=<span class="hljs-number">0</span>; <span class="hljs-built_in">i</span>&lt;cnt; <span class="hljs-built_in">i</span>=<span class="hljs-built_in">i</span>+<span class="hljs-number">1</span>) {<font></font>
    EEPROM.write(pins[<span class="hljs-built_in">i</span>], <span class="hljs-number">10</span>);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">for</span>(byte <span class="hljs-built_in">i</span>=<span class="hljs-number">0</span>; <span class="hljs-built_in">i</span>&lt;cnt; <span class="hljs-built_in">i</span>=<span class="hljs-built_in">i</span>+<span class="hljs-number">1</span>) {<font></font>
    button_states[<span class="hljs-built_in">i</span>] = <span class="hljs-number">0</span>;<font></font>
    <font></font>
    byte value = EEPROM.read(leds[<span class="hljs-built_in">i</span>]);<font></font>
    <span class="hljs-keyword">if</span>(value==<span class="hljs-number">11</span>) {<font></font>
      init_leds[<span class="hljs-built_in">i</span>] = LOW ;<font></font>
    }<span class="hljs-keyword">else</span>{<font></font>
      init_leds[<span class="hljs-built_in">i</span>] = HIGH ;<font></font>
    }<font></font>
    init_buttons[<span class="hljs-built_in">i</span>] = HIGH;<font></font>
    buttonPressTimeStamps[<span class="hljs-built_in">i</span>] = <span class="hljs-number">0</span>;<font></font>
    changed[<span class="hljs-built_in">i</span>] = <span class="hljs-built_in">false</span>;<font></font>
<font></font>
    debouncers[<span class="hljs-built_in">i</span>] = Bounce();<font></font>
<font></font>
    pinMode(pins[<span class="hljs-built_in">i</span>], INPUT);<font></font>
    pinMode(leds[<span class="hljs-built_in">i</span>], OUTPUT);<font></font>
    <font></font>
    digitalWrite(pins[<span class="hljs-built_in">i</span>], init_buttons[<span class="hljs-built_in">i</span>]);<font></font>
    digitalWrite(leds[<span class="hljs-built_in">i</span>], init_leds[<span class="hljs-built_in">i</span>]);<font></font>
    <font></font>
    debouncers[<span class="hljs-built_in">i</span>].attach( pins[<span class="hljs-built_in">i</span>] );<font></font>
    debouncers[<span class="hljs-built_in">i</span>].interval(<span class="hljs-number">5</span>);<font></font>
  }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
关于第一个周期，我什么也不会说，我们稍后再讲。</font><font style="vertical-align: inherit;">最有趣的开始是主体循环的主体。</font></font><br>
<br>
<pre><code class="hljs matlab">void loop(){<font></font>
  <span class="hljs-keyword">for</span>(byte <span class="hljs-built_in">i</span>=<span class="hljs-number">0</span>; <span class="hljs-built_in">i</span>&lt;cnt; <span class="hljs-built_in">i</span>=<span class="hljs-built_in">i</span>+<span class="hljs-number">1</span>){<font></font>
    byte dvalue = EEPROM.read(pins[<span class="hljs-built_in">i</span>]);<font></font>
    <span class="hljs-keyword">if</span>(dvalue!=<span class="hljs-number">11</span>) {<font></font>
      changed[<span class="hljs-built_in">i</span>] = debouncers[<span class="hljs-built_in">i</span>].update();<font></font>
      <font></font>
      <span class="hljs-keyword">if</span> ( changed[<span class="hljs-built_in">i</span>] ) {<font></font>
        int value = debouncers[<span class="hljs-built_in">i</span>].read();<font></font>
        <span class="hljs-keyword">if</span> ( value == HIGH) {<font></font>
         button_states[<span class="hljs-built_in">i</span>] = <span class="hljs-number">0</span>;   <font></font>
        } <span class="hljs-keyword">else</span> {<font></font>
           <span class="hljs-keyword">if</span> (<span class="hljs-built_in">i</span> &gt; <span class="hljs-number">0</span> and pins[<span class="hljs-built_in">i</span>] == pins[<span class="hljs-built_in">i</span><span class="hljs-number">-1</span>]) {<font></font>
             byte prev_value = EEPROM.read(leds[<span class="hljs-built_in">i</span><span class="hljs-number">-1</span>]);<font></font>
                            <font></font>
             <span class="hljs-keyword">if</span>(prev_value == <span class="hljs-number">11</span>) {<font></font>
               digitalWrite(leds[<span class="hljs-built_in">i</span>], LOW );<font></font>
               EEPROM.write(leds[<span class="hljs-built_in">i</span>], <span class="hljs-number">11</span>);<font></font>
             }<span class="hljs-keyword">else</span>{<font></font>
               digitalWrite(leds[<span class="hljs-built_in">i</span>], HIGH);<font></font>
               EEPROM.write(leds[<span class="hljs-built_in">i</span>], <span class="hljs-number">10</span>);<font></font>
             }<font></font>
           } <span class="hljs-keyword">else</span> {               <font></font>
             byte value = EEPROM.read(leds[<span class="hljs-built_in">i</span>]);<font></font>
             <span class="hljs-keyword">if</span>(value==<span class="hljs-number">11</span>) {<font></font>
               digitalWrite(leds[<span class="hljs-built_in">i</span>], HIGH );<font></font>
               EEPROM.write(leds[<span class="hljs-built_in">i</span>], <span class="hljs-number">10</span>);<font></font>
             }<span class="hljs-keyword">else</span>{<font></font>
               digitalWrite(leds[<span class="hljs-built_in">i</span>], LOW);<font></font>
               EEPROM.write(leds[<span class="hljs-built_in">i</span>], <span class="hljs-number">11</span>);<font></font>
             }<font></font>
           }<font></font>
                 <font></font>
           button_states[<span class="hljs-built_in">i</span>] = <span class="hljs-number">1</span>;<font></font>
           buttonPressTimeStamps[<span class="hljs-built_in">i</span>] = millis();     <font></font>
        }<font></font>
      }<font></font>
   <font></font>
      <span class="hljs-keyword">if</span> ( button_states[<span class="hljs-built_in">i</span>] == <span class="hljs-number">1</span> ) {<font></font>
        <span class="hljs-keyword">if</span> ( millis() - buttonPressTimeStamps[<span class="hljs-built_in">i</span>] &gt;= <span class="hljs-number">200</span> ) {<font></font>
            button_states[<span class="hljs-built_in">i</span>] = <span class="hljs-number">2</span>;<font></font>
        }<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
<font></font>
  delay( <span class="hljs-number">10</span> );<font></font>
} <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在测试算法的第一个版本时，注意到孩子（我有三个，男孩）真的很喜欢单击开关。</font><font style="vertical-align: inherit;">因此，有必要能够关闭某些开关，以使控制器不响应它们。</font><font style="vertical-align: inherit;">最明显的选择是简单地从板上移去必要的引脚，但这是错误的，没有意思。</font><font style="vertical-align: inherit;">因此，还将标志写入非易失性存储器，以指示开关是否断开。</font><font style="vertical-align: inherit;">这是使用以下循环初始化的：</font></font><br>
<br>
<pre><code class="hljs matlab">  <span class="hljs-keyword">for</span>(byte <span class="hljs-built_in">i</span>=<span class="hljs-number">0</span>; <span class="hljs-built_in">i</span>&lt;cnt; <span class="hljs-built_in">i</span>=<span class="hljs-built_in">i</span>+<span class="hljs-number">1</span>) {<font></font>
    EEPROM.write(pins[<span class="hljs-built_in">i</span>], <span class="hljs-number">10</span>);<font></font>
  }<font></font>
<font></font>
  ...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
并在这里检查：</font></font><br>
<br>
<pre><code class="hljs lisp">  for(<span class="hljs-name">byte</span> i=0<span class="hljs-comment">; i&lt;cnt; i=i+1){</span><font></font>
    byte dvalue = EEPROM.read(<span class="hljs-name">pins</span>[i])<span class="hljs-comment">;</span><font></font>
    if(<span class="hljs-name">dvalue!=11</span>) {<font></font>
    ...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这个阶段，墙壁上的本地开关已经开始起作用。但是，如果没有界面，智慧家庭将不会变得聪明。由于我正在从事Web开发，因此决定创建一个Web界面。这就是以太网屏蔽派上用场的地方。不幸的是，我找不到使用以太网屏蔽进行远程控制的程序的第一个版本的源。我将尝试搜索备份，也许它们在那里。但是含义是原始的，可耻的。每个控制器都有自己的IP地址。 Web服务器在arduino上上升，该服务器分析GET请求并根据端口号打开或关闭相应的指示灯。 Internet上有很多此类示例。对于Web界面，服务器是在主板上内置英特尔Atom的服务器，已安装Ubuntu Server 14.02，已安装标准的LAMP套件，一个简单的界面被写在那里。所有资源也将在本文的结尾。目前，它看起来像这样：</font></font><br>
<br>
<img src="https://habrastorage.org/files/7ba/5b2/d4c/7ba5b2d4c95c48f0ac3873cef3c76b23.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如您所见，厨房中的一盏灯已打开，并且负责该开关的开关已锁定。管理非常简单-只需单击所需的项目，即可更改其状态。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果不是一个“但是”，一切都会很棒。以太网防护罩一直挂着。不，来自交换机的本地控制始终像时钟一样工作。但是从Web界面进行的远程控制不断下降。如果管理层工作一天，那就太好了。但是更常见的是，重新启动后仅几个小时，防护罩就挂了。我只是不尝试处理看门狗，但我的董事会不支持它。我在中国订购并在en28j60上用其他盾牌替换了盾牌，它变的更好了，但仍然定期挂断。我向控制器添加了一个继电器模块，通过其常闭触点为arduino板供电，其中一个arduino板以一定的频率拉动了继电器，并切断了电源，然后恢复了该状态-但是，这也并不总是起作用，并且在重启时闪烁点亮，即使是几秒钟，但仍然如此。这是控制器此时的外观：</font></font><br>
<br>
<img src="https://habrastorage.org/files/ab0/71d/eb3/ab071deb30a94677a261c5378a809124.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后决定完全放弃以太网屏蔽。我开始寻找其他远程管理功能。我试图将arduins直接连接到服务器，并通过Serial.read（）/ Serial.print（）发送命令-它每隔两次就工作一次，但由于每次从脚本访问它时板都重新启动，因此无法实现稳定性在服务器上。我读到了很多有关此类错误的信息，我只是意识到它与DTR相连，在他们写道可以用其他标志初始化端口的地方，给出了对我不起作用的示例。一段时间后，我碰到一篇有关用USBAsp编程器制作USB-I2C适配器的文章。我决定-为什么不呢？我从中文订购了几个这样的程序员-然后等待。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一周前，我的包裹到达了。</font><font style="vertical-align: inherit;">一个程序员用i2c微型USB固件刷新，然后我再次坐下来重写代码。</font><font style="vertical-align: inherit;">此处的协议功能开始出现。</font><font style="vertical-align: inherit;">当然，服务器是主机，所有Arduino板都是从机。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该代码应解决以下任务：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -报告所请求端口的状态；</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -切换请求端口的状态；</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -关闭或打开所有灯。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我遇到了一个问题。</font><font style="vertical-align: inherit;">我可以使用i2c-tools套件中的标准命令与arduino板进行通信。</font><font style="vertical-align: inherit;">这是一个团队</font></font><br>
<br>
<pre><code class="bash hljs">i2cget -y &lt; &gt; &lt;&gt;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和</font></font><br>
<br>
<pre><code class="bash hljs">i2cset -y &lt; &gt; &lt;&gt; 0x00 &lt;byte &gt;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从芒的角度来看，您似乎可以传递“值”一词，但这对我没有用，或者我在某个地方弄错了。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
问题是，首先，如果需要切换某个端口的状态，则必须首先传递负责此操作的命令的编号，然后再传递端口号。</font><font style="vertical-align: inherit;">我什至尝试执行此操作，发送2个命令，并在代码中依次收集它们-但是这很丑陋且不合理。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
第二个问题-Arduino在收到数据时无法回答某些问题。</font><font style="vertical-align: inherit;">Wire库有两种方法-从主机接收数据时使用onReceive（），当主机请求数据时使用onRequest（）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
所以我这样做：Web服务器有6个命令：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令“ 1”-获取所有指示灯的状态</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令“ 2”-获取所有开关的阻塞状态</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令“ 5”-打开整个世界</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令“ 6”-关闭整个世界</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
命令的格式如下：十进制数，其格式为&lt;百（1或2）-切换灯或开关锁&gt; &lt;端口号（从0到99）&gt;；</font><font style="vertical-align: inherit;">例如105-开关5端口，213-开关13端口锁定。</font><font style="vertical-align: inherit;">该命令被转换为十六进制并传递给arduino，后者执行逆变换并了解需要执行的操作。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是服务器端的样子：</font></font><br>
<br>
<pre><code class="php hljs">  ...<font></font>
  <span class="hljs-keyword">if</span> ($action == <span class="hljs-number">3</span>)<font></font>
     $val_hex = dechex(intval($port) + <span class="hljs-number">100</span>);<font></font>
  <span class="hljs-keyword">else</span><font></font>
     $val_hex = dechex(intval($port) + <span class="hljs-number">200</span>);<font></font>
  <font></font>
  exec(<span class="hljs-string">"sudo i2cset -y 7 $addr 0x00 0x$val_hex"</span>, $output);<font></font>
  ...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从arduino方面：</font></font><br>
<br>
<pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">receiveEvent</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> howMany</span>)</span> {<font></font>
  <span class="hljs-keyword">byte</span> bytes = Wire.available();<font></font>
  <span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>;<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">byte</span> i=<span class="hljs-number">1</span>; i &lt;= bytes; i=i+<span class="hljs-number">1</span>) {<font></font>
    x = Wire.read();<font></font>
  }<font></font>
  <font></font>
  <span class="hljs-keyword">if</span> (x == <span class="hljs-number">1</span> or x == <span class="hljs-number">2</span> or x == <span class="hljs-number">5</span> or x == <span class="hljs-number">6</span>) {<font></font>
    do_action(x, <span class="hljs-number">0</span>);<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    <span class="hljs-keyword">if</span> ( x &gt; <span class="hljs-number">200</span>) {<font></font>
      do_action (<span class="hljs-number">4</span>, x - <span class="hljs-number">200</span>);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      do_action (<span class="hljs-number">3</span>, x - <span class="hljs-number">100</span>);<font></font>
    }<font></font>
  }  <font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
它看起来很原始，但是可以工作。</font><font style="vertical-align: inherit;">解决第二个问题如下。</font><font style="vertical-align: inherit;">这是do_action函数：</font></font><br>
<br>
<pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">do_action</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span> command, <span class="hljs-keyword">byte</span> port</span>)</span> {<font></font>
  <span class="hljs-keyword">byte</span> <span class="hljs-keyword">value</span> = <span class="hljs-number">0</span>;<font></font>
  <span class="hljs-keyword">byte</span> dvalue = <span class="hljs-number">0</span>;<font></font>
  <span class="hljs-keyword">switch</span> (command) {<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<font></font>
      start_request = <span class="hljs-literal">true</span>;<font></font>
      request_type = <span class="hljs-number">1</span>;<font></font>
      current_port = <span class="hljs-number">0</span>;<font></font>
      <font></font>
      <span class="hljs-keyword">break</span>;<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
      start_request = <span class="hljs-literal">true</span>;<font></font>
      request_type = <span class="hljs-number">2</span>;<font></font>
      current_port = <span class="hljs-number">0</span>;<font></font>
      <font></font>
      <span class="hljs-keyword">break</span>;<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<font></font>
      <span class="hljs-keyword">value</span> = EEPROM.read(port);<font></font>
      <span class="hljs-keyword">if</span>(<span class="hljs-keyword">value</span>==<span class="hljs-number">11</span>) {<font></font>
        digitalWrite(port, HIGH);<font></font>
        EEPROM.write(port, <span class="hljs-number">10</span>);<font></font>
      } <span class="hljs-keyword">else</span> {<font></font>
        digitalWrite(port, LOW);<font></font>
        EEPROM.write(port, <span class="hljs-number">11</span>);<font></font>
      }<font></font>
      <font></font>
      <span class="hljs-keyword">break</span>;<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<font></font>
      dvalue = EEPROM.read(port);<font></font>
      <span class="hljs-keyword">if</span>(dvalue==<span class="hljs-number">11</span>) {<font></font>
        EEPROM.write(port, <span class="hljs-number">10</span>);<font></font>
      } <span class="hljs-keyword">else</span> {<font></font>
        EEPROM.write(port, <span class="hljs-number">11</span>);<font></font>
      }<font></font>
      <font></font>
      <span class="hljs-keyword">break</span>;<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:<font></font>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">byte</span> i=<span class="hljs-number">0</span>; i&lt;cnt; i = i + <span class="hljs-number">1</span>) {<font></font>
        digitalWrite(leds[i], LOW);<font></font>
        EEPROM.write(leds[i], <span class="hljs-number">11</span>);<font></font>
      }<font></font>
      <font></font>
      <span class="hljs-keyword">break</span>;<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:<font></font>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">byte</span> i=<span class="hljs-number">0</span>; i&lt;cnt; i = i + <span class="hljs-number">1</span>) {<font></font>
        digitalWrite(leds[i], HIGH);<font></font>
        EEPROM.write(leds[i], <span class="hljs-number">10</span>);<font></font>
      }<font></font>
      <font></font>
      <span class="hljs-keyword">break</span>;<font></font>
    <span class="hljs-keyword">default</span>:<font></font>
      <font></font>
    <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于第3-6队，一切都很明确，但是第1或第2队可以更详细地描述。</font><font style="vertical-align: inherit;">服务器首先发送所需的命令，并且当arduino收到命令1或2时，将初始化标志：</font></font><br>
<br>
<pre><code class="hljs nginx">  <span class="hljs-attribute">start_request</span> = <span class="hljs-literal">true</span>;<font></font>
  <span class="hljs-attribute">request_type</span> = <span class="hljs-number">1</span>;<font></font>
  <span class="hljs-attribute">current_port</span> = <span class="hljs-number">0</span>;<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后，服务器开始向arduino发送请求的次数与其要轮询的端口的次数相同。</font><font style="vertical-align: inherit;">在服务器端：</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_data</span>(<span class="hljs-params">$address, $action, $cnt</span>) </span>{<font></font>
	exec(<span class="hljs-string">"sudo i2cset -y 7 $address 0x00 0x0$action"</span>, $output);<font></font>
	$tmp = @$output[<span class="hljs-number">0</span>];<font></font>
	<span class="hljs-keyword">while</span> (strpos($tmp,<span class="hljs-string">"rror"</span>)!==<span class="hljs-literal">false</span>) {<font></font>
		exec(<span class="hljs-string">"sudo i2cset -y 7 $address 0x00 0x0$action"</span>, $output);<font></font>
		$tmp = @$output[<span class="hljs-number">0</span>];<font></font>
	}<font></font>
	$str = <span class="hljs-string">""</span>;<font></font>
	<span class="hljs-keyword">for</span> ($i = <span class="hljs-number">1</span>; $i &lt;= $cnt; $i++) {<font></font>
		exec(<span class="hljs-string">"sudo i2cget -y 7 $address"</span>, $output);<font></font>
		$tmp = @$output[<span class="hljs-number">0</span>];<font></font>
		<span class="hljs-keyword">while</span> (strpos($tmp,<span class="hljs-string">"rror"</span>)!==<span class="hljs-literal">false</span>) {<font></font>
			exec(<span class="hljs-string">"sudo i2cget -y 7 $address"</span>, $output);<font></font>
			$tmp = @$output[<span class="hljs-number">0</span>];<font></font>
		}<font></font>
		<span class="hljs-keyword">if</span> ($tmp) {<font></font>
			<span class="hljs-keyword">if</span> (strpos($tmp,<span class="hljs-string">"1"</span>)!==<span class="hljs-literal">false</span>)<font></font>
				$str .= <span class="hljs-string">"1"</span>;<font></font>
			<span class="hljs-keyword">else</span><font></font>
				$str .= <span class="hljs-string">"0"</span>;<font></font>
		}<font></font>
		<span class="hljs-keyword">unset</span>($output);<font></font>
		<span class="hljs-keyword">unset</span>($tmp);<font></font>
	}<font></font>
			<font></font>
	<span class="hljs-keyword">return</span> $str;<font></font>
}<font></font>
<font></font>
$str = <span class="hljs-keyword">array</span>();<font></font>
$c = <span class="hljs-number">1</span>;<font></font>
<span class="hljs-keyword">while</span> ($c &lt;= $tryes) {<font></font>
	$tmp = get_data($addr, $action, $cnt);<font></font>
	<font></font>
	<span class="hljs-keyword">if</span> (strlen($tmp) == $cnt)<font></font>
		$str[] = $tmp;<font></font>
	<font></font>
	$c++;<font></font>
}<font></font>
<font></font>
$new_array = array_count_values($str);<font></font>
<font></font>
asort($new_array);<font></font>
<font></font>
$res = <span class="hljs-string">""</span>;<font></font>
$max = <span class="hljs-number">0</span>;<font></font>
<span class="hljs-keyword">foreach</span> ($new_array <span class="hljs-keyword">AS</span> $key=&gt;$val) {<font></font>
	<span class="hljs-keyword">if</span> ($val &gt;= $max) {<font></font>
		$res = $key;<font></font>
		$max = $val;<font></font>
	}<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">return</span> preg_split(<span class="hljs-string">'//'</span>, $res, <span class="hljs-number">-1</span>, PREG_SPLIT_NO_EMPTY);<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
简而言之-我们进行了几次（$ tryes&gt; 3）次尝试来询问arduino，我们得到了一条由0或1组成的行。我们可以在任何地方用任何命令查看答案，如果有单词Error的话-这意味着传输过程中存在错误，您需要重复传输。</font><font style="vertical-align: inherit;">为了确保传输的字符串的正确性，我们进行了多次尝试，使用array_count_values（$ str）方法按字符串折叠数组; </font><font style="vertical-align: inherit;">最后，我们得到一个包含相同行出现次数的数组，我们给出了从arduino获得的大部分行。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从arduino的角度来看，一切都更加简单：</font></font><br>
<br>
<pre><code class="hljs pgsql"><span class="hljs-type">void</span> requestEvent() {<font></font>
  <span class="hljs-keyword">if</span> (request_type == <span class="hljs-number">1</span>) {<font></font>
    byte <span class="hljs-keyword">value</span> = EEPROM.<span class="hljs-keyword">read</span>(leds[current_port]);<font></font>
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">value</span>==<span class="hljs-number">11</span>) {<font></font>
      Wire.<span class="hljs-keyword">write</span>(<span class="hljs-number">1</span>);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      Wire.<span class="hljs-keyword">write</span>(<span class="hljs-number">0</span>);<font></font>
    }<font></font>
    <font></font>
    current_port = current_port + <span class="hljs-number">1</span>;<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (request_type == <span class="hljs-number">2</span>) {<font></font>
    byte dvalue = EEPROM.<span class="hljs-keyword">read</span>(pins[current_port]);<font></font>
    <span class="hljs-keyword">if</span>(dvalue==<span class="hljs-number">11</span>) {<font></font>
      Wire.<span class="hljs-keyword">write</span>(<span class="hljs-number">1</span>);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      Wire.<span class="hljs-keyword">write</span>(<span class="hljs-number">0</span>);<font></font>
    }<font></font>
<font></font>
    current_port = current_port + <span class="hljs-number">1</span>;<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该网页的代码包含以下控件：</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lamp living_room"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lamp0x4d3"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">'0x4d'</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"lamp_click('0x4d',this.id, 3);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lamp kitchen"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lamp0x4d4"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">'0x4d'</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"lamp_click('0x4d',this.id, 4);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lamp children_main"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lamp0x4d5"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">'0x4d'</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"lamp_click('0x4d',this.id, 5);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lamp children_second"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lamp0x4d6"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">'0x4d'</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"lamp_click('0x4d',this.id, 6);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lamp sleeproom_main"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lamp0x423"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">'0x42'</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"lamp_click('0x42',this.id, 3);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lamp sleeproom_lyuda"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lamp0x424"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">'0x42'</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"lamp_click('0x42',this.id, 4);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lamp sleeproom_anton"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lamp0x425"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">'0x42'</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"lamp_click('0x42',this.id, 5);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_living_room"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4d15"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x4d',this.id, 15);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_kitchen"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4d14"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x4d',this.id, 14);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_children_main"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4d16"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x4d',this.id, 16);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_children_second"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4d17"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x4d',this.id, 17);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_sleeproom_door1"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4212"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x42',this.id, 12);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_sleeproom_door2"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4213"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x42',this.id, 13);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_sleeproom_lyuda1"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4214"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x42',this.id, 14);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_sleeproom_lyuda2"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4215"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x42',this.id, 15);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_sleeproom_anton1"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4216"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x42',this.id, 16);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_sleeproom_anton2"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4217"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x42',this.id, 17);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实际上，我明确指出了我需要访问的板卡地址和端口号。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
哦，是的，控制器现在看起来像这样：</font></font><br>
<br>
<img src="https://habrastorage.org/files/05d/20e/6f0/05d20e6f0e8747bc940f202e2606fd2a.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一切都安装到位后，一切都在第一次启动。第二天，出现了难以理解的效果-如果打开卧室中的所有灯，卧室中的所有灯每2-3秒开始闪烁一次。我花了一整夜的时间挑选代码；测试台上没有这样的门框，所以问题不在代码中。我在多个论坛中翻阅，在其中一个论坛的toga中，我找到了类似症状的描述，检查了我的猜测-问题消失了。关键是我用计算机电源（12V）给所有三个arduins供电，而旧的freeduino安静地进食并且没有嗡嗡声，而arduino uno v3却不能，并且在打开所有继电器时，功率调节器被加热了，以便这是不可能的。将电源电压降低到5V 2A-并可以正常工作。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有很多计划，我们需要完成公寓，走廊和带卫生间的浴室的维修，在我的梦里我想控制热水器和每个插座，因为现在我可以在I2C总线上挂任何数量的arduin，并且每个人都可以做自己的事。</font><font style="vertical-align: inherit;">还计划在DIN导轨上增加脉冲继电器，以便继电器模块仅控制这些脉冲继电器，并且整个负载已经通过了后者。</font><font style="vertical-align: inherit;">因为对中国继电器模块的可靠性存在严重怀疑。</font><font style="vertical-align: inherit;">但这就是将来的一切。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如承诺的那样，链接到github：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">arduino的</font></a><font style="vertical-align: inherit;"> Sketchy </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web界面</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN386457/">https://habr.com/ru/post/zh-CN386457/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN386443/index.html">现代技术消除打s：非侵入性的Nora系统</a></li>
<li><a href="../zh-CN386447/index.html">Location Magic服务将在没有GPS的情况下跟踪您设备的位置</a></li>
<li><a href="../zh-CN386449/index.html">29美元，用于建立变压器表的说明</a></li>
<li><a href="../zh-CN386451/index.html">与智能手表的最佳互动：SHIFT表带</a></li>
<li><a href="../zh-CN386455/index.html">提出了用于确定行星的计算标准。</a></li>
<li><a href="../zh-CN386459/index.html">老朋友胜过两个新朋友。景观发生器。第1部分</a></li>
<li><a href="../zh-CN386461/index.html">火星火卫一卫星在潮汐力的影响下逐渐坍塌</a></li>
<li><a href="../zh-CN386463/index.html">走出阴影：如何产生新的交流</a></li>
<li><a href="../zh-CN386465/index.html">古生物学中的3D扫描和打印。延续性</a></li>
<li><a href="../zh-CN386467/index.html">暴雪起诉机器人开发者侵犯版权</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>