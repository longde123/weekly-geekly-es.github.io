<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë≤ üêøÔ∏è üìä DIY KVM IP 3.0 ‚úçüèæ üç® ‚õΩÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ini adalah variasi ketiga pada tema IP KVM, kali ini konsepnya telah sepenuhnya direvisi, mari kita mulai membangun sesuatu yang baru. Akan ada banyak...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DIY KVM IP 3.0</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/406059/"> Ini adalah variasi ketiga pada tema IP KVM, kali ini konsepnya telah sepenuhnya direvisi, mari kita mulai membangun sesuatu yang baru.  Akan ada banyak hal menarik, jangan tinggalkan layar.  Perangkat lain yang tidak biasa akan muncul, buang hampir semua komponen lama, kembali ke arduino asli Anda dan mainkan sedikit hacker. <br><br>  Bagi mereka yang baru saja bergabung, ringkasan episode sebelumnya: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel pertama</a> <br>  Mengumpulkan IP KVM di Arduino dan Raspberry Pi, ternyata mahal dan dengan kualitas video yang buruk. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel kedua</a> <br>  OrangePI dan Atmega16u2, belajar dengan murah, tetapi kualitas gambar masih menjijikkan. </li></ul><br>  Dan akhirnya, dalam artikel ini, semua kerugian dari yang sebelumnya akan diperbaiki.  Penekanan khusus akan ditempatkan pada pengurangan maksimum dalam biaya komponen. <br><a name="habracut"></a><br>  <b>Secara tradisional, kami mempertimbangkan komponen perangkat yang dirakit:</b> <br><br>  <b>1.</b> Teman lama kami Atmega16u2: <br><div style="text-align:center;"><img src="https://habrastorage.org/files/d38/32f/4a0/d3832f4a098f4cf8abe96103b11496a3.jpg"></div><br>  Ini adalah satu-satunya komponen yang akan pindah dari artikel sebelumnya. <br><br>  <b>2.</b> ESP8266 terkenal, dalam hal ini ESP8266-12e: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/d3/d9/59d3d9e494103245224131.jpeg"></div><br>  Anda dapat menggunakan versi lain dari ESP8266, hanya Anda yang perlu mempertimbangkan jumlah dan lokasi port. <br><br>  <b>3.</b> Dan, pada kenyataannya, pahlawan acara LKV373A <br><br><img src="https://habrastorage.org/webt/59/d3/da/59d3da94466d8417530057.jpeg"><br><br>  Berkat perangkat ini, menjadi mungkin untuk mengirimkan video melalui jaringan lokal dengan tinggi <br>  resolusi hingga full-HD. <br><br><h3>  Rencana tindakan adalah sebagai berikut: </h3><br><ol><li>  Sembunyikan dan cari: Kami mencari LKV373A tempat ia bersembunyi di jaringan dengan alamat ip apa </li><li>  Game peretas: Isi firmware, setel ulang kata sandi, dan konfigurasikan LKV373A </li><li>  Mencari teman baru: ESP8266, Arduino IDE, dan gambar lucu </li><li>  Bagian akhir perayaan.  Kami menghubungkan semua komponen dan mengirimkan penekanan tombol melalui telnet </li></ol><br><h3>  Latar Belakang LKV373A </h3><br>  Jadi mari kita mulai!  LKV373A atau perangkat HDMI Extender untuk mengambil gambar langsung dari port HDMI dan disiarkan ke jaringan lokal, perangkat ini juga disebut exti HDMI.  Seperti yang direncanakan oleh pabrikan, satu set perangkat tersebut harus terdiri dari pemancar (pemancar) dan penerima (penerima), masing-masing menunjuk TX dan RX.  Mereka harus digunakan, mungkin, untuk membawa keuntungan lebih banyak kepada produsen, hanya berpasangan.  Tetapi ada seorang pria, di bawah nama panggilan Danman, di sini ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tautan</a> ke blog-nya, yang tertarik dengan cara kerjanya.  Dia membuka Wireshark, mengendus lalu lintas yang ditransmisikan oleh perangkat TX, apa yang ternyata? <br><br>  Aliran video ditransmisikan tanpa enkripsi apa pun, dan menggunakan VLC Player, Anda dapat menontonnya tanpa terlalu banyak usaha.  Tapi dia tidak berhenti di situ, "merasa": dia menarik antarmuka web, TTL, telnet, dan bahkan menarik firmware dengan programmer.  Dia membicarakan hal ini secara rinci di blog-nya.  Firmware yang menarik minat kami juga diunggah di sana: IPTV_TX_PKG_v4_0_0_0_20160427.PKG.  Dalam firmware ini, antarmuka web dengan pengaturan lanjutan, dan tidak seperti yang standar, hanya memiliki tombol pembaruan.  Selain itu, firmware ini memiliki telnet dengan banyak perintah untuk dikonfigurasi.  Dengan firmware ini kami mengkonfigurasi ulang HDMI Extender untuk tugas-tugas kami.  Saya memposting firmware dan semua yang saya butuhkan di github, ini <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tautannya</a> , kita akan membutuhkannya nanti, tetapi untuk sekarang kita selesai dengan teorinya.  Mari kita lanjutkan berlatih. <br><br><h2>  Pemancar </h2><br><h3>  Kami mencari LKV373A di jaringan </h3><br>  Saya jatuh ke tangan orang yang sama dengan Danman (y).  Semua yang akan dijelaskan di bawah ini cocok secara khusus untuk HDMI Extender LKV373A versi V3.0! <br><br>  Kami menghubungkan LKV373A ke jaringan lokal, nyalakan daya.  Sekarang mari kita coba untuk memastikan bahwa perangkat terlihat pada jaringan <code>ping 192.168.1.238</code> . <br><br>  192.168.1.238 adalah alamat IP default.  Jika extender tidak mengubah alamat firmware lama, terlepas dari apakah ada server DHCP di jaringan atau tidak.  Versi firmware yang lebih baru menggunakan IP secara default hanya jika perangkat tidak dapat memperoleh alamat dari DHCP.  Jika Anda menerima respons untuk melakukan ping, lanjutkan.  Jika tidak, jangan putus asa, coba sambungkan extender langsung ke port LAN komputer dan gunakan sniffer. <br><br><h3>  Berkedip </h3><br>  HDMI Extender ditemukan, beralih ke firmware.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Ayo buka github</a> dan unduh semua yang ada di sana.  Sekarang buka antarmuka web extender melalui browser dan lihat gambar berikut: <br><br><img src="https://habrastorage.org/webt/59/d3/d9/59d3d91fbcc37298629734.png"><br><br>  Klik "Browse ...", pilih firmware, file yang disebut IPTV_TX_PKG_v4_0_0_0_20160427.PKG, dan klik "Upgrade".  Tadam!  Firmware selesai, sekarang terhubung ke LKV373A melalui telnet untuk mereset kata sandi. <br><br>  Perintah untuk terhubung akan terlihat seperti Telnet 192.168.1.238 9999, di mana 9999 adalah port untuk terhubung.  CEP memperingatkan: alamat yang diperoleh dari DHCP dapat ditemukan menggunakan pemindai jaringan. <br><br><h3>  Terhubung melalui telnet </h3><br>  Saat menghubungkan, pesan berikut akan muncul: <br><br><pre> <code class="bash hljs">============================== ========IPTV TX Server======== ============================== input&gt;</code> </pre><br>  Kami menulis <code>list</code> .  Sebagai tanggapan, kami mendapatkan daftar perintah: <br><br><pre> <code class="bash hljs">============================== ========IPTV TX Server======== ============================== input&gt;list set_group_id get_group_id set_dhcp get_dhcp set_uart_baudrate get_uart_baudrate set_static_ip get_static_ip set_mac_address get_mac_address get_lan_status get_hdcp get_video_lock get_ip_config set_session_key set_device_name get_device_name set_video_bitrate get_video_bitrate set_downscale_mode get_downscale_mode set_video_out_mode get_video_out_mode set_streaming_mode get_streaming_mode get_fw_version get_company_id factory_reset reboot list <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre> <br>  Untuk mengatur ulang semua pengaturan dan kata sandi, gunakan perintah <code>factory_reset</code> .  Kami menulis perintah, tekan enter dan dapatkan gambar ini: <br><br><pre> <code class="bash hljs">input&gt;factory_reset Processing factory reset! System will reboot after few seconds! Connection closed by foreign host.</code> </pre><br><h3>  Antarmuka web </h3><br>  Sekarang kita dapat mengkonfigurasi perangkat sesuai kebutuhan.  Mari kita pergi ke antarmuka web.  Kami menggunakan login standar: kata sandi admin: 123456 dan ini dia, antarmuka web "incaran" dengan pengaturan tambahan: <br><br><img src="https://habrastorage.org/webt/59/d4/e7/59d4e71a2b694981418223.png"><br><br>  Meskipun peluang di antarmuka web telah meningkat, tetapi masih belum cukup untuk tujuan kita.  Terutama yang kurang adalah pengaturan yang lebih bebas dalam hal streaming, itu adalah kode-keras, jauh dari yang paling nyaman, daftar alamat IP yang dapat Anda streaming.  Tentu saja ada multicast, tetapi lebih baik meninggalkannya untuk televisi.  Keterbatasan dapat dielakkan, lebih lanjut tentang itu nanti. <br><br>  Jadi, mereka menemukan perangkat di jaringan, menggulungnya, mereset kata sandi.  Pemancar hampir siap untuk pindah ke penerima. <br><br><h2>  Penerima </h2><br>  Mari kita putuskan perangkat di bawah kendali sistem operasi mana yang akan kita transmit stream.  Saya tidak berpikir Anda akan mengalami pergolakan pilihan, hanya ada dua pilihan: <br><br><h4>  Windows </h4><br>  Untuk Windows, saya mencoba beberapa pemain, tetapi hasilnya begitu-begitu.  Saat menangkap dan kemudian memutar streaming video, penundaan muncul, yang terutama tergantung pada pemain yang memainkan streaming.  Pada berbagai pemain, penundaan berkisar dari satu detik, hingga lima atau lebih.  Yang terbaik dari semuanya, pada Windows, VLC Player terbukti. <br><br>  Mari kita mulai bisnis.  Luncurkan VLC Player, dari atas di menu tarik-turun "Media", pilih "Buka URL ..." di bidang alamat jaringan, tulis <code>udp://@:5004</code> , masukkan daw di kotak centang "Tampilkan pengaturan lanjutan" dan masukkan nilai kami di bidang "Caching", parameter ini ditentukan secara individual.  Semakin kecil nilainya di bidang ini, semakin rendah penundaannya, tetapi terlalu kecil nilainya dapat menyebabkan "artefak" dan penurunan bingkai, semuanya akan tergantung pada infrastruktur jaringan lokal.  Hasil terbaik yang bisa saya capai adalah penundaan sekitar satu detik.  Di Linux, hasilnya jauh lebih baik sekitar 200-300 milidetik. <br><br><h4>  Linux </h4><br>  Sebagai latihan menunjukkan, hasil terbaik diperoleh dengan menggunakan kombinasi program socat dan mplayer.  Ubuntu diinstal di komputer saya, jadi perintah untuk menginstal socat akan terlihat seperti ini: <br><br><pre> <code class="bash hljs">sudo apt-get install socat</code> </pre> <br>  Mplayer diinstal dengan cara yang sama: <br><br><pre> <code class="bash hljs">sudo apt-get install mplayer</code> </pre> <br>  Baiklah, dan ikuti saran Danman: <br><br><pre> <code class="bash hljs">sudo iptables -t raw -A PREROUTING -p udp -m length --length 28 -j DROP</code> </pre> <br>  Perintah ini diperlukan untuk menghapus apa yang disebut "Paket UDP Nol Panjang" dari aliran - paket ukuran nol yang "menyumbat" aliran. <br><br><h2>  Tayangkan! </h2><br>  Penerima siap, Anda dapat memulai siaran!  Kami mengetik di konsol komputer penerima <code>ifconfig</code> atau <code>ipconfig</code> , tergantung pada sistem operasinya, kami ingat alamat IP penerima dan kembali ke antarmuka web pemancar.  Kami akan membuka antarmuka web, jika kami sudah menutupnya, masukkan nama pengguna, kata sandi, dan tulis langsung di bilah alamat peramban: <br><br><pre> <code class="hljs objectivec">http:<span class="hljs-comment"><span class="hljs-comment">///dev/info.cgi?action=streaminfo&amp;udp=n&amp;rtp=y&amp;multicast=n&amp;unicast=y&amp;mcastaddr=&amp;port=5004</span></span></code> </pre> <br>  Ganti alamat IP Anda dan tekan enter.  Baris ini akan mengonfigurasi HDMI Extender untuk menyiarkan video yang diambil ke ip pilihan Anda dan mematikan multicast. <br><br>  Kami memulai VLC di Windows.  Atau di terminal Linux kami menulis: <br><br><pre> <code class="bash hljs">socat UDP-RECV:5004 - | mplayer ‚Äì</code> </pre> <br>  Abra Cadabra!  Dan inilah desktop hidup kita, atau bukan milik kita. <br><br><img src="https://habrastorage.org/webt/59/d3/f3/59d3f3c6a0c3b976110026.png"><br><br>  Jadi, dengan beberapa metode peretas, kami memaksa perangkat untuk melakukan apa yang kami butuhkan. <br><br>  Dengan transfer video yang diurutkan, buka remote control. <br><br><h2>  Kontrol transfer </h2><br><h3>  Pemilihan komponen </h3><br>  Karena  biaya HDMI Extender rendah, sekitar 1800 rubel, dan juga karena komentar itu, mereka mengatakan, sedikit mahal, saya mengedepankan slogan: "Berikan IP KVM untuk 2000 rubel!".  Nilai tukar rubel akan sangat mempengaruhi kesetiaan pernyataan ini, tapi jangan bicara tentang hal-hal yang menyedihkan, saya ingin percaya pada masa depan yang cerah.  Untuk mencapai tujuan, kita akan membutuhkan elemen yang sangat murah, pilihan saya jatuh pada ESP8266 sebagai pengontrol, dan semua Atmega (8/16/32) u2 yang sama sebagai aktuator. <br><br>  Tentu saja Anda dapat mempertimbangkan kandidat lain untuk peran perangkat eksekutif (keyboard).  Firmware yang mengemulasi keyboard ditulis di perpustakaan LUFA (semacam).  Perpustakaan ini dapat digunakan untuk seluruh keluarga AVR dengan konektivitas USB.  Oleh karena itu sebagai emulator keyboard, Anda dapat mengambil, mungkin lebih murah, mikrokontroler.  Ini adalah informasi untuk dipertimbangkan, tetapi sekarang kami melanjutkan. <br><br>  Anda dapat membeli ESP8266 dengan harga sekitar 90 rubel, Atmega (8/16/32) u2 seharga sekitar 100 rubel, dan bahkan lebih murah jika Anda mengambil dalam batch kecil 5, atau lebih banyak potongan.  Tentu saja, bahan habis pakai untuk pengikat mikrokontroler akan dibutuhkan, tetapi biayanya sangat kecil, jadi saya tidak akan mempertimbangkannya. <br><br><h2>  ESP8266 </h2><br>  Keajaiban industri Cina ini tidak perlu diperkenalkan, oleh karena itu saya hanya akan mengatakan bahwa dalam proyek ini saya menggunakan versi ESP8266-12e.  Tentu saja, Anda dapat menggunakan versi lain, hanya Anda yang perlu mempertimbangkan lokasi port, karena  dalam versi ini, salah satu port ESP8266 digunakan untuk menyalakan Atmega (8/16/32) u2, itu akan ditunjukkan dalam diagram di bawah ini. <br><br><h3>  Firmware </h3><br>  Firmware untuk ESP8266 ditulis dalam lingkungan ArduinoIDE, jadi mari kita unduh versi terbaru dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">situs pengembang</a> .  Selanjutnya Anda perlu menambahkan dukungan untuk ESP8266 - cara termudah dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tautan</a> ini.  Pada halaman yang sama Anda dapat menemukan banyak informasi berguna, misalnya, skema koneksi daya dan TTL.  Bagi mereka yang tidak mutakhir, ESP8266 hanya menggunakan <b>3,3 volt!</b>  Jika Anda tidak yakin dengan kemampuan Anda sendiri, lebih baik menggunakan opsi papan yang disesuaikan untuk USB, seperti NodeMCU: <br><br><img src="https://habrastorage.org/webt/59/d3/d9/59d3d92043a87951368720.jpeg"><br><br>  Jika semuanya siap, buka ArduinoIDE dan salin sketsa saya: <br><br><div class="spoiler">  <b class="spoiler_title">Sketsa</b> <div class="spoiler_text"><pre> <code class="hljs lua">#include &lt;ESP8266WiFi.h&gt; #include &lt;WiFiClient.h&gt; #include &lt;ESP8266WebServer.h&gt; #include &lt;ESP8266mDNS.h&gt; #include &lt;SoftwareSerial.h&gt; #include &lt;HIDKeyboard.h&gt; #define MAX_SRV_CLIENTS <span class="hljs-number"><span class="hljs-number">3</span></span> HIDKeyboard keyboard; const <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>* host = <span class="hljs-string"><span class="hljs-string">"esp8266"</span></span>; const <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>* ssid = <span class="hljs-string"><span class="hljs-string">""</span></span>; const <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>* pass = <span class="hljs-string"><span class="hljs-string">""</span></span>; int rebootdev = <span class="hljs-number"><span class="hljs-number">0</span></span>; int modeswitch = <span class="hljs-number"><span class="hljs-number">0</span></span>; // ,    ESP8266    #define Port1 <span class="hljs-number"><span class="hljs-number">15</span></span> #define Port2 <span class="hljs-number"><span class="hljs-number">14</span></span> #define Port3 <span class="hljs-number"><span class="hljs-number">12</span></span> #define Port4 <span class="hljs-number"><span class="hljs-number">4</span></span> #define Port5 <span class="hljs-number"><span class="hljs-number">5</span></span> //  String ColorB1; String ColorB2; String ColorB3; String ColorB4; String ColorB5; ESP8266WebServer server(<span class="hljs-number"><span class="hljs-number">80</span></span>); WiFiClient serverClients[MAX_SRV_CLIENTS]; const <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>* serverIndex = <span class="hljs-string"><span class="hljs-string">"&lt;form method='POST' action='/update' enctype='multipart/form-data'&gt;&lt;input type='file' name='update'&gt;&lt;input type='submit' value='Update'&gt;&lt;/form&gt;&lt;a href='/'&gt;BACK&lt;/a&gt;"</span></span>;//Update //    void handleRedirect(){ String content = <span class="hljs-string"><span class="hljs-string">"&lt;html&gt;&lt;head&gt;&lt;meta http-equiv='refresh' content='0;/'&gt;&lt;head&gt;&lt;/html&gt;"</span></span>; server.send(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>, content); } //  WI-FI void handleLogin(){ String msg = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (server.hasArg(<span class="hljs-string"><span class="hljs-string">"SSID"</span></span>) &amp;&amp; server.hasArg(<span class="hljs-string"><span class="hljs-string">"PASSAP"</span></span>)){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((server.<span class="hljs-built_in"><span class="hljs-built_in">arg</span></span>(<span class="hljs-string"><span class="hljs-string">"SSID"</span></span>) != NULL) &amp;&amp; (server.<span class="hljs-built_in"><span class="hljs-built_in">arg</span></span>(<span class="hljs-string"><span class="hljs-string">"PASSAP"</span></span>) != NULL)){ String header = <span class="hljs-string"><span class="hljs-string">"HTTP/1.1 301 OK\r\r\nLocation: /\r\nCache-Control: no-cache\r\n\r\n"</span></span>; server.sendContent(header); String web_ssid = server.<span class="hljs-built_in"><span class="hljs-built_in">arg</span></span>(<span class="hljs-string"><span class="hljs-string">"SSID"</span></span>); String web_pass = server.<span class="hljs-built_in"><span class="hljs-built_in">arg</span></span>(<span class="hljs-string"><span class="hljs-string">"PASSAP"</span></span>); ssid = web_ssid.c_str();//       C pass = web_pass.c_str(); Serial.println(); Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"SSID "</span></span>); Serial.println(ssid); Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Pass "</span></span>); Serial.println(pass); WiFi.begin(ssid, pass); digitalWrite(LED_BUILTIN, LOW); ESP.reset(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } msg = <span class="hljs-string"><span class="hljs-string">"Wrong ssid/password! try again."</span></span>; Serial.println(<span class="hljs-string"><span class="hljs-string">"Login Failed"</span></span>); } String content = <span class="hljs-string"><span class="hljs-string">"&lt;html&gt;&lt;body&gt;&lt;form action='/' method='POST'&gt;Enter the access point name and password &lt;br&gt;"</span></span>;//  SSID   content += <span class="hljs-string"><span class="hljs-string">"Name AP:&lt;input type='text' name='SSID' placeholder='SSID'&gt;&lt;br&gt;"</span></span>; content += <span class="hljs-string"><span class="hljs-string">"Password:&lt;input type='password' name='PASSAP' placeholder='password'&gt;&lt;br&gt;&lt;br&gt;"</span></span>; content += <span class="hljs-string"><span class="hljs-string">"&lt;input type='submit' name='SUBMIT' value='Connect to WI-FI'&gt;&lt;/form&gt;&lt;b&gt;&lt;font color='red'&gt;"</span></span> + msg + <span class="hljs-string"><span class="hljs-string">"&lt;/font&gt;&lt;/b&gt;&lt;br&gt;"</span></span>; content += <span class="hljs-string"><span class="hljs-string">"Firmware update &lt;a href='/upload'&gt;UPDATE&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;"</span></span>; server.send(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>, content); } void handleNotFound(){ String message = <span class="hljs-string"><span class="hljs-string">"File Not Found\n\n"</span></span>; message += <span class="hljs-string"><span class="hljs-string">"URI: "</span></span>; message += server.uri(); message += <span class="hljs-string"><span class="hljs-string">"\nMethod: "</span></span>; message += (server.method() == HTTP_GET)?<span class="hljs-string"><span class="hljs-string">"GET"</span></span>:<span class="hljs-string"><span class="hljs-string">"POST"</span></span>; message += <span class="hljs-string"><span class="hljs-string">"\nArguments: "</span></span>; message += server.args(); message += <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (uint8_t i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;server.args(); i++){ message += <span class="hljs-string"><span class="hljs-string">" "</span></span> + server.argName(i) + <span class="hljs-string"><span class="hljs-string">": "</span></span> + server.<span class="hljs-built_in"><span class="hljs-built_in">arg</span></span>(i) + <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; } server.send(<span class="hljs-number"><span class="hljs-number">404</span></span>, <span class="hljs-string"><span class="hljs-string">"text/plain"</span></span>, message); } //  int controlPin(int UsePin){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (UsePin &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>){ int StPort; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(UsePin) == <span class="hljs-number"><span class="hljs-number">1</span></span>) {//      digitalWrite(UsePin, LOW); StPort = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { digitalWrite(UsePin, HIGH); StPort = <span class="hljs-number"><span class="hljs-number">1</span></span>; } digitalWrite(LED_BUILTIN, HIGH);//    Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Port "</span></span>); Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(UsePin); Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"="</span></span>); Serial.println(StPort); delay(<span class="hljs-number"><span class="hljs-number">500</span></span>); digitalWrite(LED_BUILTIN, LOW); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(StPort); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(<span class="hljs-number"><span class="hljs-number">-1</span></span>); } //  int clientConnect(int Seconds){ Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"connection "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (int i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt;= Seconds; i++){ WiFi.begin(ssid, pass); digitalWrite(LED_BUILTIN, LOW); delay(<span class="hljs-number"><span class="hljs-number">250</span></span>); digitalWrite(LED_BUILTIN, HIGH); delay(<span class="hljs-number"><span class="hljs-number">250</span></span>); Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">" "</span></span>); Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (WiFi.<span class="hljs-built_in"><span class="hljs-built_in">status</span></span>() == WL_CONNECTED) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); Serial.println(); } void setup(void){ Serial.begin(<span class="hljs-number"><span class="hljs-number">115200</span></span>); delay(<span class="hljs-number"><span class="hljs-number">1000</span></span>); pinMode(LED_BUILTIN, OUTPUT); digitalWrite(LED_BUILTIN, HIGH); //uint8_t i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (modeswitch == <span class="hljs-number"><span class="hljs-number">0</span></span>) WiFi.mode(WIFI_STA);//  modeswitch = <span class="hljs-number"><span class="hljs-number">0</span></span>     Serial.println(); Serial.println(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (clientConnect(<span class="hljs-number"><span class="hljs-number">30</span></span>) != <span class="hljs-number"><span class="hljs-number">0</span></span>) modeswitch = <span class="hljs-number"><span class="hljs-number">1</span></span>;//            <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (modeswitch == <span class="hljs-number"><span class="hljs-number">1</span></span>){ Serial.println(<span class="hljs-string"><span class="hljs-string">""</span></span>); Serial.println(<span class="hljs-string"><span class="hljs-string">"WiFi switch AP mode"</span></span>); //WiFi.mode(WIFI_AP_STA);    +  .     WiFi.mode(WIFI_AP); WiFi.softAP(<span class="hljs-string"><span class="hljs-string">"TD"</span></span>, <span class="hljs-string"><span class="hljs-string">"testtest"</span></span>); Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"AP mode ip adress "</span></span>); Serial.println(WiFi.softAPIP()); digitalWrite(LED_BUILTIN, LOW); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (modeswitch != <span class="hljs-number"><span class="hljs-number">1</span></span>){ WiFiServer server(<span class="hljs-number"><span class="hljs-number">23</span></span>); Serial.println(); Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Client mod ip address: "</span></span>); Serial.println(WiFi.localIP()); digitalWrite(LED_BUILTIN, LOW); } MDNS.begin(host); pinMode(Port1, OUTPUT); pinMode(Port2, OUTPUT); pinMode(Port3, OUTPUT); pinMode(Port4, OUTPUT); pinMode(Port5, OUTPUT); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (modeswitch == <span class="hljs-number"><span class="hljs-number">1</span></span>){ //     server.on(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, handleLogin);//  (SSID)   //  server.on(<span class="hljs-string"><span class="hljs-string">"/upload"</span></span>, HTTP_GET, [](){ server.sendHeader(<span class="hljs-string"><span class="hljs-string">"Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"close"</span></span>); server.send(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>, serverIndex); }); server.on(<span class="hljs-string"><span class="hljs-string">"/update"</span></span>, HTTP_POST, [](){ server.sendHeader(<span class="hljs-string"><span class="hljs-string">"Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"close"</span></span>); int uperror = Update.hasError(); Serial.printf(<span class="hljs-string"><span class="hljs-string">"UPERR %u\nRebooting...\n"</span></span>,Update.hasError()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (uperror == <span class="hljs-number"><span class="hljs-number">0</span></span>) server.send(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>, <span class="hljs-string"><span class="hljs-string">"Firmware update successfully &lt;a href='/'&gt;BACK&lt;/a&gt;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> server.send(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>, <span class="hljs-string"><span class="hljs-string">"Update error &lt;a href='/'&gt;BACK&lt;/a&gt;"</span></span>); ESP.restart(); },[](){ HTTPUpload&amp; upload = server.upload(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(upload.<span class="hljs-built_in"><span class="hljs-built_in">status</span></span> == UPLOAD_FILE_START){ Serial.setDebugOutput(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); WiFiUDP::stopAll(); Serial.printf(<span class="hljs-string"><span class="hljs-string">"Update: %s\n"</span></span>, upload.filename.c_str()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (upload.filename == NULL) { Serial.printf(<span class="hljs-string"><span class="hljs-string">"ERROR: zero file size"</span></span>); server.send(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>, <span class="hljs-string"><span class="hljs-string">"&lt;html&gt; zero file size &lt;a href='/upload'&gt;BACK&lt;/a&gt;&lt;/html&gt;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(<span class="hljs-number"><span class="hljs-number">-1</span></span>); } uint32_t maxSketchSpace = (ESP.getFreeSketchSpace() - <span class="hljs-number"><span class="hljs-number">0x1000</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xFFFFF000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!Update.begin(maxSketchSpace)){//start with <span class="hljs-built_in"><span class="hljs-built_in">max</span></span> available size Update.printError(Serial); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(upload.<span class="hljs-built_in"><span class="hljs-built_in">status</span></span> == UPLOAD_FILE_WRITE){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Update.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(upload.buf, upload.currentSize) != upload.currentSize){ Update.printError(Serial); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(upload.<span class="hljs-built_in"><span class="hljs-built_in">status</span></span> == UPLOAD_FILE_END){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Update.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(<span class="hljs-literal"><span class="hljs-literal">true</span></span>)){ //<span class="hljs-literal"><span class="hljs-literal">true</span></span> to set the size to the current progress Serial.printf(<span class="hljs-string"><span class="hljs-string">"Update Success: %u\nRebooting...\n"</span></span>, upload.totalSize); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Update.printError(Serial); } Serial.setDebugOutput(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">yield</span></span>(); }); //  server.on(<span class="hljs-string"><span class="hljs-string">"/PoRt1"</span></span>, [] { controlPin(Port1); handleRedirect();//    }); server.on(<span class="hljs-string"><span class="hljs-string">"/PoRt2"</span></span>, [] { controlPin(Port2); handleRedirect(); }); server.on(<span class="hljs-string"><span class="hljs-string">"/PoRt3"</span></span>, [] { controlPin(Port3); handleRedirect(); }); server.on(<span class="hljs-string"><span class="hljs-string">"/PoRt4"</span></span>, [] { controlPin(Port4); handleRedirect(); }); server.on(<span class="hljs-string"><span class="hljs-string">"/PoRt5"</span></span>, [] { controlPin(Port5); handleRedirect(); }); server.on(<span class="hljs-string"><span class="hljs-string">"/reboot"</span></span>, [] { rebootdev = <span class="hljs-number"><span class="hljs-number">1</span></span>;//      handleRedirect(); }); server.onNotFound(handleNotFound);//    //server.begin(); MDNS.addService(<span class="hljs-string"><span class="hljs-string">"http"</span></span>, <span class="hljs-string"><span class="hljs-string">"tcp"</span></span>, <span class="hljs-number"><span class="hljs-number">80</span></span>); Serial.println(); Serial.println(<span class="hljs-string"><span class="hljs-string">"HTTP server started"</span></span>); } server.begin(); } void loop(void){ uint8_t i; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (modeswitch == <span class="hljs-number"><span class="hljs-number">1</span></span>) server.handleClient(); delay(<span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (modeswitch != <span class="hljs-number"><span class="hljs-number">1</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (WiFi.<span class="hljs-built_in"><span class="hljs-built_in">status</span></span>() != WL_CONNECTED) clientConnect(<span class="hljs-number"><span class="hljs-number">30</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { digitalWrite(<span class="hljs-number"><span class="hljs-number">5</span></span>, HIGH);//  ATMEGA16U2 digitalWrite(LED_BUILTIN, LOW); } } WiFiServer server(<span class="hljs-number"><span class="hljs-number">23</span></span>); server.setNoDelay(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); server.begin(); keyboard.begin(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(WiFi.<span class="hljs-built_in"><span class="hljs-built_in">status</span></span>() == WL_CONNECTED) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (server.hasClient()){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; MAX_SRV_CLIENTS; i++){ //<span class="hljs-built_in"><span class="hljs-built_in">find</span></span> free/disconnected spot <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!serverClients[i] || !serverClients[i].connected()){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(serverClients[i]) serverClients[i].stop(); serverClients[i] = server.available(); Serial.println(<span class="hljs-string"><span class="hljs-string">"New client: "</span></span>); Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(i); continue; } } //no free/disconnected spot so reject WiFiClient serverClient = server.available(); serverClient.stop(); } //check clients <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> data <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; MAX_SRV_CLIENTS; i++){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (serverClients[i] &amp;&amp; serverClients[i].connected()){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(serverClients[i].available()){ //get data from the telnet client <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> push it to the UART String bufkey; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(serverClients[i].available()) bufkey += (serverClients[i].<span class="hljs-built_in"><span class="hljs-built_in">read</span></span>());//     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bufkey != <span class="hljs-number"><span class="hljs-number">0</span></span>) { bufkey = bufkey.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>);//  int key = bufkey.toInt();//   switch (key){ case <span class="hljs-number"><span class="hljs-number">277980</span></span>: keyboard.pressSpecialKey(F1); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">277981</span></span>: keyboard.pressSpecialKey(F2); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">277982</span></span>: keyboard.pressSpecialKey(F3); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">277983</span></span>: keyboard.pressSpecialKey(F4); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">27914953</span></span>: keyboard.pressSpecialKey(F5); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">27914955</span></span>: keyboard.pressSpecialKey(F6); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">27914956</span></span>: keyboard.pressSpecialKey(F7); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">27914957</span></span>: keyboard.pressSpecialKey(F8); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">27915048</span></span>: keyboard.pressSpecialKey(F9); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">27915049</span></span>: keyboard.pressSpecialKey(F10); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">27915051</span></span>: keyboard.pressSpecialKey(F11); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">27915052</span></span>: keyboard.pressSpecialKey(F12); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">1310</span></span>: keyboard.pressSpecialKey(ENTER); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">130</span></span>: keyboard.pressSpecialKey(ENTER); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">27</span></span>: keyboard.pressSpecialKey(ESCAPE); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">8</span></span>: keyboard.pressSpecialKey(BACKSPACE); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">9</span></span>: keyboard.pressSpecialKey(TAB); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">32</span></span>: keyboard.pressSpecialKey(SPACEBAR); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">27915012</span></span>: keyboard.pressSpecialKey(INSERT); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">27914912</span></span>: keyboard.pressSpecialKey(HOME); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">27915312</span></span>: keyboard.pressSpecialKey(PAGEUP); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">27915212</span></span>: keyboard.pressSpecialKey(END); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">27915412</span></span>: keyboard.pressSpecialKey(PAGEDOWN); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">279167</span></span>: keyboard.pressSpecialKey(RIGHTARROW); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">279168</span></span>: keyboard.pressSpecialKey(LEFTARROW); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">279166</span></span>: keyboard.pressSpecialKey(DOWNARROW); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">279165</span></span>: keyboard.pressSpecialKey(UPARROW); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">127</span></span>: keyboard.pressSpecialKey(DELETE); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">27915112</span></span>: keyboard.pressSpecialKey(DELETE); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">4</span></span>: keyboard.pressSpecialKey((LCTRL | ALT), DELETE); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; //CTRL+ALT+DELETE  Ctrl + d case <span class="hljs-number"><span class="hljs-number">6</span></span>: keyboard.pressSpecialKey(ALT, F4); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; //alt+f4  Ctrl + f case <span class="hljs-number"><span class="hljs-number">19</span></span>: keyboard.pressSpecialKey(ALT | SHIFT); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;//   Ctrl+s case <span class="hljs-number"><span class="hljs-number">2</span></span>: keyboard.pressSpecialKey(LCTRL | SHIFT); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;//   Ctrl+b //    case <span class="hljs-number"><span class="hljs-number">17</span></span>: controlPin(Port1); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;//Ctrl+q case <span class="hljs-number"><span class="hljs-number">23</span></span>: controlPin(Port2); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;//Ctrl+w case <span class="hljs-number"><span class="hljs-number">5</span></span>: controlPin(Port3); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;//Ctrl+e case <span class="hljs-number"><span class="hljs-number">18</span></span>: controlPin(Port4); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;//Ctrl+r case <span class="hljs-number"><span class="hljs-number">20</span></span>: controlPin(Port5); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;//Ctrl+t default: keyboard.pressKey(key); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;//  } keyboard.releaseKey();//  Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">" string: "</span></span>); Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(key);//  Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">" KEY: "</span></span>); Serial.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(bufkey.toInt()); bufkey = <span class="hljs-string"><span class="hljs-string">'0'</span></span>;//    } } } } //check UART <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Serial.available()){ size_t <span class="hljs-built_in"><span class="hljs-built_in">len</span></span> = Serial.available(); uint8_t sbuf[<span class="hljs-built_in"><span class="hljs-built_in">len</span></span>]; Serial.readBytes(sbuf, <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>); //push UART data to all connected telnet clients <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; MAX_SRV_CLIENTS; i++){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (serverClients[i] &amp;&amp; serverClients[i].connected()){ serverClients[i].<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(sbuf, <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>); delay(<span class="hljs-number"><span class="hljs-number">1</span></span>); } } } } }</code> </pre><br></div></div><br>  Hubungkan perpustakaan yang diinginkan: <br><br>  Pilih tab "Sketsa" ‚Üí "Sambungkan perpustakaan" ‚Üí "Tambahkan .ZIP perpustakaan". Pilih perpustakaan yang disebut "UNO-HIDKeyboard-Library-master (mod) .zip", yang diunduh dari github.  Kami mengkompilasi dan mengisi firmware.  Untuk mengunduh firmware, hubungkan ESP8266 TTL, atur port yang diinginkan di ArduinoIDE.  Pengaturan akan terlihat seperti ini: <br><br><img src="https://habrastorage.org/webt/59/d3/d9/59d3d920b385c613386705.png"><br><br>  Untuk mengunduh firmware, Anda perlu membuat hubungan pendek port GPIO0 ke ground, dan me-restart mikrokontroler dengan melakukan hubungan pendek pada port Reset ke ground juga.  Saya tidak akan melukis secara detail, agar tidak mengembang artikel, Google akan membantu Anda. <br><br>  Logika dari ESP8266 adalah sebagai berikut: Ketika daya diterapkan, mikrokontroler mencoba untuk terhubung ke titik akses Wi-Fi selama sekitar tiga puluh detik: <br><br>  <b>Jika koneksi berhasil</b> : membuka port 23, yang dapat dihubungkan menggunakan telnet dan mengirimkan penekanan tombol.  Selain tombol, Anda dapat mentransfer kombinasi yang dibuat di atas "tombol Ctrl +" yang akan menekan kombinasi tertentu.  Misalnya, jika Anda meneruskan "Ctrl + d", kombinasi CTRL + ALT + DELETE akan ditekan pada komputer yang dikelola. <br><br>  Ada juga kombinasi untuk mengendalikan port ESP8266, misalnya, Anda dapat menghubungkan relai dan menggunakan kombinasi "Ctrl + q" untuk menghidupkan dan mematikan relai, dengan demikian nyalakan dan matikan komputer yang dikelola dari jarak jauh.  Anda dapat melihat kombinasi ini dan lainnya di sumber. <br><br>  <b>Jika gagal</b> : ESP8266 beralih ke mode titik akses dengan nama "TD", Kata Sandi "testtest" dan membuka antarmuka web kecil, dapat diakses di 192.168.4.1, di mana Anda dapat mengonfigurasi pengaturan untuk menghubungkan melalui WI-FI. <br><br><img src="https://habrastorage.org/webt/59/d3/d9/59d3d920802fd033414007.png"><br><br>  Dengan demikian, perangkat dapat dengan mudah dihubungkan ke jalur akses lain.  Ya, lalat di salep disembunyikan di sini, untuk pengoperasian IP KVM kami, kami akan membutuhkan kabel LAN dan Wi-Fi.  Itu akan menjadi biaya untuk murahnya perangkat. <br><br>  Kami berurusan dengan ESP8266, dengan Atmega16u2 semuanya seperti pada artikel sebelumnya, kami menginstal program Flip, firmware ada di arsip yang diunduh dari github. <br><br><h2>  Koneksi Komponen </h2><br>  Untuk koneksi komponen yang benar, saya pasang sirkuit.  Perlu diingat, ini adalah skema kondisional, ini berfungsi untuk kejelasan dan tidak mengklaim sebagai ideal.  Setiap orang bebas untuk "melengkapinya" sesuka hatinya. <br><br><img src="https://habrastorage.org/webt/59/d6/52/59d6521903f44207012758.jpeg"><br><br>  Izinkan saya menjelaskan beberapa hal: Transistor dalam diagram diperlukan untuk mengaktifkan Atmega16u2 setelah memuat ESP8266, karena ketika Anda menghidupkan ESP8266, informasi debug ditransmisikan ke semua port TX, dan jika Atmega16u2 dihidupkan dan terhubung ke komputer, aliran data dengan volume yang ditransmisikan pengemudi tidak bisa mengatasinya.  Tidak diketahui pasti apa yang terjadi pada saat ini, buffer driver agaknya meluap, efeknya sangat tidak menyenangkan: ratusan tombol ditekan, jika editor teks dibuka, ia mengeluarkan banyak omong kosong, dan semua kunci layanan macet dan akibatnya, bekerja dengan keyboard menjadi tidak mungkin .  Untuk menghindari hal ini, Atmega16u2 perlu dinyalakan setelah memuat ESP8266.  Dalam firmware, momen ini diperhitungkan. <br><br>  Tentu saja, ada alternatif untuk skema ini, tetapi ini adalah opsi untuk yang kaya, atau yang malas.  Dan omong-omong, opsi ini tidak membatalkan yang di atas: <br><br><img src="https://habrastorage.org/webt/59/d3/d9/59d3d920e7d2e067456748.jpeg"><br><br>  Dalam gambar, Arduino UNO tanpa chip Atmega328p terhubung ke mitra Cina NodeMCU.  Garis 3,3 volt terhubung ke saluran dengan level tegangan yang sama pada Arduino, serta ground dan pin GPIO2 (ESP8266) terhubung ke pin TX pada Arduino. <br><br><h2>  Pemeriksaan terakhir </h2><br>  Kami terhubung melalui telnet ke port 23 dan memeriksa kinerjanya.  Anda dapat melakukan ini: Di ‚Äã‚ÄãWindows dengan perintah <code>telnet [ip- ESP8266]</code> . <br><br>  Di Linux akan sedikit lebih rumit: <br><br>  Perintah <code>telnet [ip- ESP8266]</code> maka Anda perlu menekan karakter kontrol, standarnya adalah "Ctrl +]", telnet harus masuk ke mode perintah, kemudian tekan "l" dan "Enter".  Dengan tindakan ini, kami akan mengalihkan telnet ke mode simbol. <br><br><pre> <code class="bash hljs">$ telnet 192.168.***.*** Trying 192.168.***.***... Connected to 192.168.***.***. Escape character is <span class="hljs-string"><span class="hljs-string">'^]'</span></span>. ^] telnet&gt; l</code> </pre><br>  Semuanya siap, kita bisa mengecek operasi perangkat yang kita buat.  Biarkan saya mengingatkan Anda kemungkinan kombinasi untuk menekan "Alt + Tab", "Ctrl + Alt + Del" dan lain-lain  bisa lihat di sketsa.  Itu saja, inkarnasi IP KVM DIY ketiga sudah siap. <br><br><h2>  Untuk meringkas </h2><br><h3>  Pro: </h3><br><ul><li>  Mungkin plus yang paling penting adalah harganya, ternyata muat dalam 2000 rubel </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Seharusnya tidak ada keluhan tentang kualitas video, Anda dapat melakukan streaming hingga Full HD tanpa masalah </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kemampuan untuk memperluas fungsionalitas dengan menambahkan hingga empat relay atau aktuator lainnya. </font></font></li></ul><br><h3>  Cons: </h3><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Perlu terhubung melalui Wi-Fi dan kabel Lan </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Saat digunakan dengan VGA, diperlukan adaptor, yang tentu saja akan memengaruhi biaya </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secara umum, perangkat ini ternyata layak mendapat perhatian, tentu saja, itu bukan pesaing untuk IP KVM serial dengan semua "barang" mereka, tetapi memenangkan banyak harga. </font><font style="vertical-align: inherit;">Dan untuk penggunaan di rumah, dan mungkin tidak hanya itu, sangat cocok. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya ingin mengambil kesempatan ini untuk mengucapkan terima kasih kepada pengguna </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DaylightIsBurning</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font><font style="vertical-align: inherit;">Lelaki baik ini menyarankan arah yang tepat untuk menggali.</font></font><br><br>  Terima kasih atas perhatian anda<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sampai ketemu lagi! </font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id406059/">https://habr.com/ru/post/id406059/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id406047/index.html">Uberisasi truk derek</a></li>
<li><a href="../id406049/index.html">Tampilkan grafik 3D di PSP</a></li>
<li><a href="../id406051/index.html">Dalam perjalanan ke bintang-bintang: bahaya perjalanan ruang angkasa</a></li>
<li><a href="../id406055/index.html">Seseorang yang telah menerima pembaruan sistem kekebalan untuk melawan kanker</a></li>
<li><a href="../id406057/index.html">Tim Kontes PRIZE Google Lunar X Akan Mendapatkan Waktu Tambahan</a></li>
<li><a href="../id406061/index.html">Spesialis Keamanan Informasi Meretas Perlindungan Kriptografis Enklave Aman Apple</a></li>
<li><a href="../id406063/index.html">Apa sebenarnya yang akan terjadi ketika garpu bitwit segwit2x diaktifkan pada bulan November?</a></li>
<li><a href="../id406065/index.html">Spesialis keamanan informasi: "Mobil pintar jauh dari selalu mobil yang aman"</a></li>
<li><a href="../id406067/index.html">Kontrak yang cerdas. Bagian 1. Ketika kertas itu tahu apa yang Anda katakan kepadanya dan melakukannya</a></li>
<li><a href="../id406069/index.html">Kontrak yang cerdas. Bagian 2. Dari hype ke kenyataan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>