<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😠 🎁 👌 介绍Grafana的新插件-状态图面板 🀄️ 🤬 🙊</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Grafana具有显示状态的能力，Grafana具有及时显示数据的能力。 然而，自相矛盾的是， 随着时间的流逝 ，Grafana还没有一种方便的方式来显示状态 ！ 

 我们展示了我们的插件-Statusmap面板 。 它使您可以在选定的时间段内直观地显示一组对象的状态。 以演示插件操作的示例为例，...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>介绍Grafana的新插件-状态图面板</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/423851/">  Grafana具有<b>显示状态</b>的能力，Grafana具有及时显示<b>数据</b>的能力。 然而，自相矛盾的是， <b>随着时间的流逝</b> ，Grafana还没有一种方便的方式来显示<b>状态</b> ！ <br><br> 我们展示了我们的插件<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-Statusmap面板</a> 。 它使您可以在选定的时间段内直观地显示一组对象的状态。 以演示插件操作的示例为例，想象一下为某人准备咖啡的许多位置： <br><br><img src="https://habrastorage.org/webt/gh/is/-v/ghis-vmfpoxwf0pfrgp9uy76qfo.png"><br>  <i>您会看到Nikki如何节省能源，Gerry迅速补充水供应，Valera的咖啡机经常是垃圾，而且Bifrost的Wi-Fi显然比月球站好，那里的水似乎非常紧。</i> <br><br> 看起来有趣吗？ 但是，让我们从大家如何开始这件事开始。 <a name="habracut"></a><br><br><h2> 怎么了 </h2><br> 为了更好地进行数据可视化，我们为自己设置了一个简单的任务：显示一段时间内一组时间序列的状态。 一组对象意味着不同的时间序列：它们在一组标签和一个名称上可以不同。 而且，时间序列值应该方便，即 没有拐杖，以文本和颜色显示。 <br><br> 将这种可视化用于我们的业务的实际示例是Kubernetes服务器或Pod的运行状况，即检查HTTP服务的结果。 因此在Flant，一个名为Statusmap的Grafana插件诞生了。 考虑到将其应用到其他任务中的巨大可能性，我们迅速做出了与国际社会共享代码的承诺。 但是，实际上，没有人在我们之前解决过这个问题吗？ <br><br><h2> 为什么不准备好？ </h2><br> 这个任务真的很受欢迎，因此我们并没有成为它的先驱。 一切始于这样一个事实：我们有几个带有酷炫的插件<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Status Panel</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Status Dot的</a>仪表板。 这些插件可让您显示一组对象的当前状态，例如，世界不同地区的主机或炉灶...或咖啡机。 <br><br><img src="https://habrastorage.org/webt/vb/qo/tb/vbqotbeezghqnvin2pgw4gqpleq.png"><br><br><img src="https://habrastorage.org/webt/lq/b5/zl/lqb5zlkv0lo82uon9c9qnllu4mo.png"><br><br> 一切顺利，直到我们想及时查看这些对象的状态。 第一种最简单的解决方案是添加带有<i>堆叠复选</i>标记的规则图形。 <br><br><img src="https://habrastorage.org/webt/bf/ib/mm/bfibmmrpcxlzn2snfzed3mn3_py.png"><br><br> 根据该想法，状态面板+堆叠图将使我们能够“立即”查看对象的状态和及时的情况。 但是，堆积图不是很清楚： <br><br><ul><li> 颜色表示不同的时间序列，而不是状态点或状态面板以彩色显示的值。 也就是说，两个图表的颜色不相同，这很容易混淆。 </li><li>如果在值之间出现<code>null</code> ，则图形将失败。 </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">他们</a>试图改编标准的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Heatmap</a> ，但没有用：该插件只能在Y轴上使用值级别，并且不知道如何在此处显示标签。 然后，我们尝试使用以下Grafana插件： <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">地毯图</a> -按日期和当天选定的片段对值进行分组； </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">离散面板</a>是一个很好的插件，但是随着时间的推移，我们需要离散地显示状态。 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">“按组</a>显示状态” <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">面板</a>是对“状态”面板的一个很好的改进，允许您显示许多状态，但仍然没有我们需要的功能。 </li></ul><br> 根据所有研究的结果，我们为插件制定了以下要求： <br><br><ul><li> 每个对象在图形上突出显示的清晰线条； </li><li> 对象的名称沿Y轴显示，并在图例字段中设置； </li><li> 一个对象可以具有几种状态-在这种情况下，最重要的将以彩色显示，其余的将在工具提示中显示； </li><li> 存储桶应至少以给定的宽度（5 px）显示，因为 单像素不方便指向鼠标； </li><li> 手动颜色管理-能够为离散集中的每个数值设置颜色的功能。 </li></ul><br> 现在，让我对热图，Prometheus图形和离散状态做些小的论述…… <br><br><h2> 一点理论 </h2><br> 经典的热图是一个3维图： <br><br><ul><li>  x轴代表时间 </li><li> 沿Y轴是一定数量的可能值 </li><li> 沿Z轴的位置是给定时间的观测值数量。 </li></ul><br> 标准的Heatmap插件以颜色显示Z轴-例如，从白色到红色或通过绿-黄-红色渐变显示。 这对于连续值非常有效：响应时间，队列长度，对服务器的请求数量...对于一组对象的离散状态，您需要执行以下操作：在Y轴上显示我们正在监视的对象的名称，在Z轴上显示每个对象的可观察对象在给定时间的状态...但是等等！ 一次对象的状态集是什么意思？ 我将尝试描述。 <br><br> 那些将Prometheus与Grafana结合使用的人知道<code>step</code>或<code>interval</code> -“ <i>查询”</i>选项卡上的设置。 如果在<code>1m</code>指定<code>1m</code> ，并且您以<code>5s</code>的间隔收集数据，那么当您执行简单的指标请求时， <code>coffee_maker_status</code> Prometheus将返回第12个值，并且在图表上看不到11个值。 情况如何改善？ <br><br> 首先想到的是使用聚合函数，例如<code>*_over_time(coffee_maker_status[1m])</code> 。 我应该选择哪个功能？ 是时候弄清楚状态如何在Prometheus指标中显示。 在大多数情况下，状态由一组特定的值指示。 例如，对于<code>coffee_maker_status</code>可能会有以下状态值： <br><br><ul><li>  0-好 </li><li>  1-关 </li><li>  2-没有豆子， </li><li>  3-没有水， </li><li>  4-失败。 </li></ul><br> 此外，这看起来很简单：取零，一，二等的数量。 一分钟内……我们将在图表上显示出色的数据！ 但是Prometheus对此有自己的看法： <code>coffee_maker_status[1m]</code>是范围向量，因此，像<code>max_over_time(coffee_maker_status[1m]==2)</code>或<code>count_values_over_time(coffee_maker_status[1m], 3)</code>这样的表达式是非常合适的。 <br><br> 如果度量标准中有两个值，则一切工作正常： <code>0</code> （未观察到状态）和<code>1</code> （观察到状态），并且状态本身存储在标签中。 然后，您可以发出这样的请求： <code>(max_over_time(coffee_maker_status{status="3"}[1m]) == 1) *3</code> <br><br> 如何处理具有多个值的指标？ 注释“ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在PromQL中组成范围向量函数</a> ”提出了将离散值的度量转换为带有标签的度量的想法。 可以使用以下记录规则来完成此操作： <br><br><pre> <code class="hljs pgsql">- <span class="hljs-type"><span class="hljs-type">record</span></span>: coffee_maker_status:discrete expr: | count_values("status", coffee_maker_status)</code> </pre> <br> 该规则将如下<code>coffee_maker_status</code>转换<code>coffee_maker_status</code>指标：如果值为<code>3</code> ，则Prometheus创建一个<code>coffee_maker_status:discrete{status="3"}</code>指标<code>coffee_maker_status:discrete{status="3"}</code> ，值为1。因此，对于每个观察到的值。 <br><br> 通常，状态是预先定义的，因此您可以创建一组查询，以免遗漏必要的值。 所有查询的图例必须匹配才能对值进行分组： <br><br><img src="https://habrastorage.org/webt/wp/lw/fr/wplwfrej6vn8i9o36vjhkytrzco.png"><br><br> 现在，如果一分钟内咖啡机关闭了30秒（状态为关闭<code>1</code> ），而其余时间仍在工作（状态为ok- <code>0</code> ），那么我们将获得有关关机的信息，因为 插件将一次收到两个带有一个图例的值：查询A的<code>0</code>和查询B的<code>1</code> 。 <br><br> 很好：我们想出了如何汇总离散状态下的数据并且仍然不会丢失信息。 还需要弄清楚如何根据图例组合数据并将其绘制在面板上。 <br><br><h2> 状态图插件 </h2><br> 当然，我们并没有立即谈到上面所描述的内容，但是当所有这些放在一起时，很显然，渲染机制还远远不够。 现在有一种机制<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-Statusmap面板插件</a> ，可以执行以下操作： <br><br><ul><li> 每个时间点的值通过<i>Query中</i>指定的图例文本的一致分组为篮子; </li><li> 每个图例文本在图表上都有自己的线，并且该文本在Y轴上显示为标签，空值显示为空格或<code>0</code> ： <br><br><img src="https://habrastorage.org/webt/6w/3q/oc/6w3qoczr5li9fou2rktxb3h58ke.png"></li><li> 对于任何值，您可以指定购物篮的确切颜色： <br><br><img src="https://habrastorage.org/webt/zn/c-/1n/znc-1nrw5teu5-mo7g4w5zhcwne.png"></li><li> 如果购物篮中有多个值，则颜色将采用“ <i>颜色”</i>选项卡上上面定义的值，并且当您将鼠标悬停在购物篮上时，将显示所有落入其中的值： <br><br><img src="https://habrastorage.org/webt/8o/b4/dt/8ob4dtdp_urq5r903oys4wmcwte.png"></li><li> 该插件能够形成对Prometheus的请求<code>interval</code> ，从而使购物篮不会变成像素行。 </li></ul><br> 结果是非常方便地表示<b>了几个对象</b>的<b>状态</b> 。 此外，您可以同时看到当前状态（这些是最右边的购物篮）和对象的状态。 <br><br><h2> 去哪儿 </h2><br>  Grafana Statusmap插件的源代码在免费的MIT许可下分发<i>（类似于其他Grafana插件）</i> 。 当前可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">我们的GitHub上找到</a> 。  <s>我们衷心希望在不久的将来它将进入<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Grafana插件库</a> 。</s>  <b>更新（18/10/18）：</b>该插件已被<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">接受到</a> Grafana官方目录中。 <br><br> 最后-关于状态图如何帮助可视化来自Kubernetes生产集群的炉床状态的数据的说明： <br><br><img src="https://habrastorage.org/webt/mp/xc/lv/mpxclvizmci-pbwjjqpmy6zvwaw.png"><br><br><h2> 聚苯乙烯 </h2><br> 另请参阅我们的博客： <br><br><ul><li>  “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">介绍日志仓库-一个用于在Kubernetes中处理日志的开源系统</a> ”； </li><li>  “我们<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">正式推出了用于维护CI / CD的dapp-DevOps实用程序</a> 。” </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN423851/">https://habr.com/ru/post/zh-CN423851/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN423837/index.html">如何快速破坏任何项目？ 17个最佳坏提示</a></li>
<li><a href="../zh-CN423839/index.html">每颗牙齿的sha256测试用于神经网络</a></li>
<li><a href="../zh-CN423843/index.html">如果您位于喀山或新西伯利亚，并且想要设计微芯片，例如库比蒂诺</a></li>
<li><a href="../zh-CN423845/index.html">企业安全套</a></li>
<li><a href="../zh-CN423847/index.html">使用APDS-9960识别颜色和光线</a></li>
<li><a href="../zh-CN423853/index.html">S3 DataLine存储如何工作</a></li>
<li><a href="../zh-CN423855/index.html">合勤星云-易于管理是节省的基础</a></li>
<li><a href="../zh-CN423857/index.html">学习自己编程时会遇到的6个挑战</a></li>
<li><a href="../zh-CN423861/index.html">太阳能灯笼-我们需要更亮的</a></li>
<li><a href="../zh-CN423863/index.html">PH第8天的对抗-SOC视图</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>