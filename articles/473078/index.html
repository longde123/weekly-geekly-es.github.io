<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚ÄçüöÄ üñ±Ô∏è üôä Administre f√°cilmente configuraciones de microservicios con microconfig.io üíà üëù ‚õÑÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Uno de los principales problemas en el desarrollo y posterior operaci√≥n de microservicios es el ajuste competente y preciso de sus instancias. En mi o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Administre f√°cilmente configuraciones de microservicios con microconfig.io</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473078/">  Uno de los principales problemas en el desarrollo y posterior operaci√≥n de microservicios es el ajuste competente y preciso de sus instancias.  En mi opini√≥n, el nuevo marco <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">microconfig.io</a> puede ayudar.  Le permite resolver con bastante elegancia algunas de las tareas rutinarias de configuraci√≥n de aplicaciones. <br><a name="habracut"></a><br>  Si tiene muchos microservicios, y cada uno de ellos viene con sus propios archivos / archivos de configuraci√≥n, es probable que cometa un error en uno de ellos, que sin la destreza adecuada y un sistema de registro puede ser muy dif√≠cil de detectar.  La tarea principal que establece el marco es minimizar la configuraci√≥n de instancias duplicadas, reduciendo as√≠ la probabilidad de agregar un error. <br><br>  Veamos un ejemplo.  Supongamos que hay una aplicaci√≥n simple con un <b>archivo de</b> configuraci√≥n <b>yaml</b> .  Puede ser cualquier microservicio en cualquier idioma.  Veamos c√≥mo se puede aplicar el marco a este servicio. <br><br>  Pero primero, para mayor conveniencia, crearemos un proyecto vac√≠o en el IDE de Idea instalando primero el complemento microconfig.io en √©l: <br><br><img src="https://habrastorage.org/webt/zp/db/uc/zpdbuckv5ezy0gbc5mcikpywfdm.png" alt="imagen"><br><br>  Configuramos la configuraci√≥n de inicio del complemento, puede usar la configuraci√≥n predeterminada, como en la captura de pantalla anterior. <br><br>  Nuestro servicio se llama orden, luego en un nuevo proyecto crearemos una estructura similar: <br><br><img src="https://habrastorage.org/webt/jl/an/x5/jlanx519xbvcfj7gje6jdy8emfa.png"><br><br>  En la carpeta con el nombre del servicio colocamos el archivo de configuraci√≥n - <b>application.yaml</b> .  Todos los microservicios se inician en alg√∫n tipo de entorno, por lo que, adem√°s de crear la configuraci√≥n del servicio en s√≠, es necesario describir el entorno en s√≠: para esto, cree la carpeta <b>envs</b> y agregue un archivo con el nombre de nuestro entorno de trabajo.  Por lo tanto, el marco crear√° archivos de configuraci√≥n para los servicios en el entorno de desarrollo, ya que este par√°metro se establece en la configuraci√≥n del complemento. <br><br>  La estructura del archivo <b>dev.yaml</b> ser√° bastante simple: <br><br><pre><code class="plaintext hljs">mainorder: components: - order</code> </pre> <br>  El marco funciona con configuraciones que se agrupan.  Para nuestro servicio, seleccione un nombre para el grupo de orden principal.  El marco encuentra cada grupo de aplicaciones en el archivo de entorno y crea configuraciones para todas ellas que encuentra en las carpetas correspondientes. <br><br>  En el archivo de configuraci√≥n del servicio de <b>pedidos</b> , indicaremos hasta ahora solo un par√°metro: <br><br><pre> <code class="plaintext hljs">spring.application.name: order</code> </pre> <br>  Ahora ejecute el complemento y generar√° la configuraci√≥n deseada de nuestro servicio para nosotros de acuerdo con la ruta especificada en las propiedades: <br><br><img src="https://habrastorage.org/webt/ba/2s/uq/ba2suqlkzmxnzxisilo5wdu8ebs.png"><br><br>  Puede <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hacerlo</a> sin instalar el complemento simplemente descargando el kit de distribuci√≥n del marco y ejecut√°ndolo desde la l√≠nea de comandos. <br>  Esta soluci√≥n es adecuada para su uso en el servidor de compilaci√≥n. <br><br>  Vale la pena se√±alar que el marco comprende perfectamente la sintaxis de <b>propiedad</b> , es decir, los archivos de propiedad ordinarios que se pueden usar juntos en configuraciones <b>yaml</b> . <br><br>  Agregue otro servicio de <b>pago</b> y complique el existente al mismo tiempo. <br>  En <b>orden</b> : <br><br><pre> <code class="plaintext hljs">eureka: instance.preferIpAddress: true client: serviceUrl: defaultZone: http://192.89.89.111:6782/eureka/ server.port: 9999 spring.application.name: order db.url: 192.168.0.100</code> </pre> <br>  En <b>pago</b> : <br><br><pre> <code class="plaintext hljs">eureka: instance.preferIpAddress: true client: serviceUrl: defaultZone: http://192.89.89.111:6782/eureka/ server.port: 9998 spring.application.name: payments db.url: 192.168.0.100</code> </pre> <br>  El principal problema con estas configuraciones es la presencia de una gran cantidad de copiar y pegar en la configuraci√≥n del servicio.  Veamos c√≥mo el marco ayuda a deshacerse de √©l.  Comencemos con lo m√°s obvio: la presencia de la configuraci√≥n de <b>Eureka</b> en la descripci√≥n de cada microservicio.  Cree un nuevo directorio con el archivo de configuraci√≥n y agregue una nueva configuraci√≥n: <br><br><img src="https://habrastorage.org/webt/bv/41/qz/bv41qzovbxaeodybgaxlpy7em4k.png"><br><br>  Y en cada uno de nuestros proyectos ahora agregaremos la l√≠nea <i>#include eureka</i> . <br><br>  El marco buscar√° autom√°ticamente la configuraci√≥n de eureka y la copiar√° a los archivos de configuraci√≥n del servicio, mientras que no se crear√° una configuraci√≥n de eureka separada, ya que no la especificaremos en el <b>archivo de</b> entorno <b>dev.yaml</b> .  <b>Orden de</b> servicio: <br><br><pre> <code class="1c hljs"><span class="hljs-meta"><span class="hljs-meta">#include eureka server.port: 9999 spring.application.name: order db.url: 192.168.0.100</span></span></code> </pre> <br>  Tambi√©n podemos hacer la configuraci√≥n de la base de datos en una configuraci√≥n separada cambiando la l√≠nea de importaci√≥n a <i>#include eureka, oracle</i> . <br><br>  Vale la pena se√±alar que cada cambio durante la regeneraci√≥n de los archivos de configuraci√≥n que el marco monitorea y coloca en un archivo especial al lado del archivo de configuraci√≥n principal.  La entrada en su registro se ve as√≠: "La propiedad almacenada 1 cambia a <b>order / diff-application.yaml</b> ".  Esto le permite detectar r√°pidamente cambios en archivos de configuraci√≥n grandes. <br><br>  Eliminar las partes comunes de la configuraci√≥n le permite deshacerse de muchos copiar y pegar innecesarios, pero no le permite crear de manera flexible una configuraci√≥n para varios entornos: los puntos finales de nuestros servicios son √∫nicos y codificados, lo cual es malo.  Intentemos eliminarlo. <br><br>  Una buena soluci√≥n ser√≠a mantener todos los puntos finales en una configuraci√≥n a la que otros puedan hacer referencia.  Para hacer esto, el soporte para marcadores de posici√≥n se ha introducido en el marco.  As√≠ es como cambia el archivo de configuraci√≥n de <b>Eureka</b> : <br><br><pre> <code class="plaintext hljs"> client: serviceUrl: defaultZone: http://${endpoints@eurekaip}:6782/eureka/</code> </pre> <br>  Ahora veamos c√≥mo funciona este marcador de posici√≥n.  El sistema encuentra un componente llamado <b>puntos finales</b> y busca <b>eurekaip</b> en √©l, y luego lo sustituye en nuestra configuraci√≥n.  ¬øPero qu√© pasa con los diferentes entornos?  Para hacer esto, cree el archivo de configuraci√≥n en <b>puntos finales del</b> siguiente tipo <b>application.dev.yaml</b> .  El marco de forma independiente, por extensi√≥n de archivo, decide a qu√© entorno pertenece esta configuraci√≥n y la carga: <br><br><img src="https://habrastorage.org/webt/-l/pv/ru/-lpvruiphufubb2m-bihizph78m.png"><br><br>  El contenido del archivo dev: <br><br><pre> <code class="plaintext hljs">eurekaip: 192.89.89.111 dbip: 192.168.0.100</code> </pre> <br>  Podemos crear la misma configuraci√≥n para los puertos de nuestros servicios: <br><br><pre> <code class="plaintext hljs">server.port: ${ports@order}.</code> </pre> <br>  Todas las configuraciones importantes est√°n en un solo lugar, lo que reduce la probabilidad de un error debido a los par√°metros dispersos en los archivos de configuraci√≥n. <br><br>  El marco proporciona muchos marcadores de posici√≥n listos para usar, por ejemplo, puede obtener el nombre del directorio en el que se encuentra el archivo de configuraci√≥n y asignarlo: <br><br><pre> <code class="1c hljs"><span class="hljs-meta"><span class="hljs-meta">#include eureka, oracle server.port: ${ports@order} spring.application.name: ${this@name}</span></span></code> </pre> <br>  Debido a esto, no es necesario especificar adicionalmente el nombre de la aplicaci√≥n en la configuraci√≥n y tambi√©n se puede mover a un m√≥dulo com√∫n, por ejemplo, al mismo eureka: <br><br><pre> <code class="plaintext hljs">client: serviceUrl: defaultZone: http://${endpoints@eurekaip}:6782/eureka/ spring.application.name: ${this@name}</code> </pre> <br>  El archivo de configuraci√≥n del <b>pedido</b> se reducir√° a una l√≠nea: <br><br><pre> <code class="1c hljs"><span class="hljs-meta"><span class="hljs-meta">#include eureka, oracle server.port: ${ports@order}</span></span></code> </pre> <br>  En caso de que no necesitemos ning√∫n ajuste de la configuraci√≥n principal, podemos especificarlo en nuestra configuraci√≥n y se aplicar√° durante la generaci√≥n.  Es decir, si por alguna raz√≥n necesitamos un nombre √∫nico para el servicio de pedidos, simplemente deje el par√°metro <b>spring.application.name</b> . <br><br>  Supongamos que necesita agregar configuraciones de registro personalizadas al servicio, que se almacenan en un archivo separado, por ejemplo, <b>logback.xml</b> .  Cree un grupo separado de configuraciones para ello: <br><br><img src="https://habrastorage.org/webt/fs/gg/x7/fsggx7dxwx1hako1mysofzssgy0.png"><br><br>  En la configuraci√≥n b√°sica, indicaremos el marco donde colocar el archivo de configuraci√≥n de registro que necesitamos usando el <b>marcador de posici√≥n</b> @ConfigDir: <br><br><pre> <code class="plaintext hljs">microconfig.template.logback.fromFile: ${logback@configDir}/logback.xml</code> </pre> <br>  En el archivo <b>logback.xml</b> , configuramos <b>ap√©ndices</b> est√°ndar, que a su vez tambi√©n pueden contener marcadores de posici√≥n, que el marco cambiar√° durante la generaci√≥n de configuraciones, por ejemplo: <br><br><pre> <code class="1c hljs">&lt;file&gt;logs/${this@name}.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>&lt;/file&gt;</code> </pre> <br>  Al <b>agregar la</b> importaci√≥n de <b>logback</b> en la configuraci√≥n del servicio, obtenemos autom√°ticamente el registro configurado para cada servicio: <br><br><pre> <code class="1c hljs"><span class="hljs-meta"><span class="hljs-meta">#include eureka, oracle, logback server.port: ${ports@order}</span></span></code> </pre> <br>  Es hora de familiarizarse con todos los marcadores de posici√≥n del marco disponibles con m√°s detalle: <br><br>  <b>$ {this @ env}</b> : devuelve el nombre del entorno actual. <br>  <b>$ {... @ name}</b> : devuelve el nombre del componente. <br>  <b>$ {... @ configDir}</b> : devuelve la ruta completa al directorio de configuraci√≥n del componente. <br>  <b>$ {... @ resultDir}</b> : devuelve la ruta completa al directorio de destino del componente (los archivos recibidos se colocar√°n en este directorio). <br>  <b>$ {this @ configRoot}</b> : devuelve la ruta completa al directorio ra√≠z del almac√©n de configuraci√≥n. <br><br>  El sistema tambi√©n le permite obtener variables de entorno, por ejemplo, la ruta a Java: <br>  <b>$ {env @ JAVA_HOME}</b> <br>  O bien, dado que el marco est√° escrito en <b>JAVA</b> , podemos obtener variables del sistema similares a llamar a <b>System :: getProperty</b> usando una construcci√≥n como esta: <br>  <b>${system@os.name}</b> <br>  Vale la pena mencionar el soporte para el lenguaje de extensi√≥n <b>Spring EL</b> .  En la configuraci√≥n, se aplican expresiones similares: <br><br><pre> <code class="1c hljs">connection.timeoutInMs: <span class="hljs-meta"><span class="hljs-meta">#{5 * 60 * 1000} datasource.maximum-pool-size: #{${this@datasource.minimum-pool-size} + 10}</span></span></code> </pre> <br>  y puedes usar variables locales en archivos de configuraci√≥n usando la expresi√≥n <b>#var</b> : <br><br><pre> <code class="1c hljs"><span class="hljs-meta"><span class="hljs-meta">#var feedRoot: ${system@user.home}/feed folder: root: ${this@feedRoot} success: ${this@feedRoot}/archive error: ${this@feedRoot}/error</span></span></code> </pre> <br>  Por lo tanto, el marco es una herramienta bastante poderosa para la configuraci√≥n fina y flexible de microservicios.  El marco realiza perfectamente su tarea principal: eliminar copiar y pegar en la configuraci√≥n, consolidar la configuraci√≥n y, como resultado, minimizar los posibles errores, al tiempo que facilita la combinaci√≥n de configuraciones y cambios para diferentes entornos. <br><br>  Si est√° interesado en este marco, le recomiendo que visite su p√°gina oficial y lea la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n</a> completa, o profundice en la fuente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/473078/">https://habr.com/ru/post/473078/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../473062/index.html">User.js subjetivo para Mozilla Firefox y no solo</a></li>
<li><a href="../473064/index.html">L√°grimas b√°tavas, autos y Gorilla Glass: sobre algunos tipos de vidrio reforzado</a></li>
<li><a href="../473066/index.html">√Årboles de cuadrante y reconocimiento de colisi√≥n</a></li>
<li><a href="../473070/index.html">Redux - ¬°No es necesario! ¬øReemplazar con useContext y useReducer en React?</a></li>
<li><a href="../473072/index.html">C√≥mo Gazpromneft crea una ruta digital para un cliente corporativo</a></li>
<li><a href="../473082/index.html">C√≥mo escribimos microservicios y por qu√© no lo hacemos r√°pidamente</a></li>
<li><a href="../473084/index.html">"Ivan" es una profesi√≥n de chat bot. O experimentos creativos con asistentes virtuales</a></li>
<li><a href="../473086/index.html">C√≥mo el malware evade sandboxes con Visual Basic</a></li>
<li><a href="../473090/index.html">PocketBook 632 y 632 Aqua review: peque√±os lectores insignia de 6 pulgadas con E Ink</a></li>
<li><a href="../473092/index.html">AMA con Habr, # 13: noticias importantes para usuarios y empresas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>