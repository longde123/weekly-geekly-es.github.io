<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöç üéß üèçÔ∏è Os bancos de dados vivem no Kubernetes? üì´ üßëüèæ üåÆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De alguma forma, historicamente, o setor de TI, por qualquer motivo, est√° dividido em dois campos condicionais: a favor e contra. Al√©m disso, o assunt...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Os bancos de dados vivem no Kubernetes?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/453602/"><img src="https://habrastorage.org/webt/iq/xw/bx/iqxwbxcjzz4tipitwhcc-_mqe5q.jpeg"><br><br>  De alguma forma, historicamente, o setor de TI, por qualquer motivo, est√° dividido em dois campos condicionais: a favor e contra.  Al√©m disso, o assunto da controv√©rsia pode ser absolutamente arbitr√°rio.  Qual sistema operacional √© melhor: Win ou Linux?  Em um smartphone Android ou iOS?  Mantenha tudo nas nuvens ou fa√ßa o upload para um armazenamento RAID frio e coloque os parafusos em um cofre?  Os schnicks do PHP t√™m o direito de ser chamados de programadores?  Essas disputas s√£o, √†s vezes, de natureza exclusivamente existencial e n√£o t√™m outra base al√©m do interesse esportivo. <br><br>  Aconteceu que, com o advento dos cont√™ineres e de toda essa amada cozinha com estivadores e k8s condicionais, as disputas pr√≥ e contra come√ßaram a usar novas oportunidades em v√°rias √°reas do back-end.  (Faremos uma reserva antecipada de que, embora na maioria das vezes o Kubernetes seja indicado como orquestrador nesta discuss√£o, a escolha deste instrumento n√£o importa. Em vez disso, voc√™ pode substituir qualquer outro que lhe pare√ßa mais conveniente e familiar.) <br><br>  E, ao que parece, seria um argumento simples sobre os dois lados da mesma moeda.  T√£o sem sentido e sem piedade quanto o eterno confronto Win vs Linux, no qual pessoas adequadas existem para si mesmas em algum lugar no meio.  Isso √© apenas no caso da conteineriza√ß√£o n√£o √© t√£o simples.  Geralmente, em tais disputas, n√£o existe o lado certo, mas no caso de cont√™ineres ‚Äúaplicar‚Äù ou ‚Äún√£o aplicar‚Äù para armazenar o banco de dados, tudo fica de cabe√ßa para baixo.  Porque, em certo sentido, apoiadores e oponentes de tal abordagem est√£o certos. <br><a name="habracut"></a><br><h4>  Bright Side </h4><br>  Voc√™ pode descrever brevemente os argumentos do Bright Side com uma frase: "Ol√°, 2k19 fora da janela!"  Parece populismo, √© claro, mas se voc√™ se aprofundar na situa√ß√£o em detalhes, ela ter√° suas vantagens.  Vamos analis√°-los agora. <br><br>  Suponha que voc√™ tenha um grande projeto da web.  Inicialmente, ele poderia ser constru√≠do com base em uma abordagem de microsservi√ßo ou, em algum momento, evoluiu de maneira evolutiva - na verdade, isso n√£o √© muito importante.  Voc√™ dispersou nosso projeto em microsservi√ßos separados, configurou orquestra√ß√£o, balanceamento de carga, dimensionamento.  E agora, com a consci√™ncia limpa, beba mojito na rede durante um efeito habr, em vez de aumentar os servidores ca√≠dos.  Mas todas as a√ß√µes devem ser consistentes.  Muitas vezes, apenas o aplicativo em si √© cont√™iner - o c√≥digo.  O que mais temos al√©m do c√≥digo? <br><br>  Certo, dados.  O cora√ß√£o de qualquer projeto √© seus dados: ele pode ser um DBMS t√≠pico - MySQL, Postgre, MongoDB ou armazenamento usado para pesquisa (ElasticSearch), armazenamento de valor-chave para armazenamento em cache - por exemplo, redis etc. Agora n√£o falaremos sobre op√ß√µes de implementa√ß√£o de back-end torto quando o banco de dados falhar devido a consultas mal escritas e, em vez disso, falaremos sobre garantir a toler√¢ncia a falhas desse mesmo banco de dados sob carga do cliente.  De fato, quando cont√™ineres nosso aplicativo e permitimos que ele seja escalado livremente para lidar com qualquer n√∫mero de solicita√ß√µes recebidas, isso naturalmente aumenta a carga no banco de dados. <br><br>  De fato, o canal para acessar o banco de dados e o servidor no qual ele gira torna-se o olho da agulha em nosso belo back-end em cont√™iner.  Ao mesmo tempo, o principal motivo da virtualiza√ß√£o de cont√™ineres √© a mobilidade e a plasticidade da estrutura, o que possibilita organizar a distribui√ß√£o do pico de carga em toda a infraestrutura dispon√≠vel para n√≥s da maneira mais eficiente poss√≠vel.  Ou seja, se n√£o contivermos e agruparmos todos os elementos dispon√≠veis do sistema em um cluster, cometeremos um erro muito s√©rio. <br><br>  √â muito mais l√≥gico agrupar n√£o apenas o aplicativo em si, mas tamb√©m os servi√ßos respons√°veis ‚Äã‚Äãpelo armazenamento de dados.  Ao agrupar e implantar, trabalhando e distribuindo independentemente a carga de servidores da Web nos k8s, j√° resolvemos o problema da sincroniza√ß√£o de dados - os mesmos coment√°rios para as postagens, se voc√™ usar algum tipo de m√≠dia ou plataforma de blog como exemplo.  De qualquer forma, iniciamos uma representa√ß√£o intracluster, at√© virtual, do banco de dados como um ExternalService.  A quest√£o √© que o pr√≥prio banco de dados ainda n√£o foi armazenado em cluster - os servidores da Web implantados no cubo obt√™m informa√ß√µes sobre as altera√ß√µes de nossa base de combate est√°tica, que gira separadamente. <br><br>  Sinta a pegadinha?  Usamos o k8s ou o Swarm para distribuir a carga e evitar a queda do servidor web principal, mas n√£o fazemos isso no banco de dados.  Afinal, se o banco de dados falhar, em toda a infraestrutura em cluster n√£o faz sentido - de que serve p√°ginas da Web vazias que retornam um erro de acesso ao banco de dados? <br><br>  √â por isso que n√£o apenas os servidores da web precisam ser agrupados, como geralmente √© feito, mas tamb√©m a infraestrutura do banco de dados.  Somente dessa maneira podemos garantir que elementos da mesma estrutura que estejam totalmente operacionais em uma equipe, mas ao mesmo tempo, sejam independentes um do outro.  Ao mesmo tempo, mesmo que metade do nosso back-end sob carga "desmorone", o restante sobreviver√°, e o sistema de sincroniza√ß√£o do banco de dados entre si no cluster e a possibilidade de dimensionamento e implanta√ß√£o infinitos de novos clusters ajudar√£o a alcan√ßar rapidamente as capacidades necess√°rias - haveria racks no data center . <br><br>  Al√©m disso, o modelo de banco de dados distribu√≠do em clusters permite levar esse mesmo banco de dados para onde for necess√°rio;  se estamos falando de um servi√ßo global, √© il√≥gico distorcer um cluster da Web em algum lugar da √°rea de S√£o Francisco e, ao mesmo tempo, gerar pacotes ao acessar o banco de dados na regi√£o de Moscou e vice-versa. <br><br>  Al√©m disso, a conteineriza√ß√£o do banco de dados permite criar todos os elementos do sistema no mesmo n√≠vel de abstra√ß√£o.  O que, por sua vez, torna poss√≠vel gerenciar esse sistema diretamente do c√≥digo, pelos desenvolvedores, sem o envolvimento ativo dos administradores.  Os desenvolvedores pensaram que precisavam de um DBMS separado para um novo subprojeto - f√°cil!  escreveu um arquivo yaml, carregado no cluster e pronto. <br><br>  Bem, √© claro, a opera√ß√£o interna √© bastante simplificada.  Diga-me, quantas vezes voc√™ apertou os olhos nos momentos em que um novo membro da equipe enfiou as m√£os no banco de dados de combate para trabalhar?  Qual, de fato, est√° girando agora?  √â claro que todos n√≥s aqui somos adultos e, em algum lugar, temos um novo backup, e ainda mais - atr√°s de uma prateleira com pepinos da av√≥ e esquis velhos - outro backup, possivelmente at√© em um armazenamento a frio, porque uma vez que seu escrit√≥rio estava pegando fogo.  Mas, ainda assim, toda introdu√ß√£o de um novo membro da equipe com acesso √† infraestrutura de combate e, √© claro, ao banco de dados de combate √© um balde de validol para todos os que est√£o ao redor.  Bem, quem, um novato, sabe, talvez ele esteja apertando os olhos?  Assustador, concordo. <br><br>  A conteineriza√ß√£o e, de fato, a topologia do banco de dados f√≠sico distribu√≠do do seu projeto ajudam a evitar esses momentos v√°lidos.  N√£o confie no novato?  Ok  Criaremos nosso pr√≥prio cluster para ele e o desconectaremos do restante dos clusters de banco de dados - sincroniza√ß√£o apenas por envio manual e rota√ß√£o simult√¢nea de duas chaves (um l√≠der de equipe, o segundo administrador).  E todo mundo est√° feliz. <br><br>  E agora √© hora de trocar de roupa nos oponentes da conteineriza√ß√£o de banco de dados. <br><br><h4>  Lado escuro </h4><br>  Argumentando por que n√£o √© necess√°rio containerizar o banco de dados e continuar a rotacion√°-lo em um servidor central, n√£o vamos nos inclinar para a ret√≥rica da ortodoxia e declara√ß√µes como "av√≥s transformaram o banco de dados em hardware, e vamos!"  Em vez disso, vamos tentar chegar a uma situa√ß√£o em que a conteineriza√ß√£o realmente traga dividendos tang√≠veis. <br><br>  Voc√™ deve admitir que os projetos que realmente precisam de uma base no cont√™iner podem ser contados com os dedos de uma m√£o como o melhor operador de fresadora.  Na maioria das vezes, at√© mesmo o uso de k8s ou Docker Swarm √© redundante - muitas vezes eles recorrem a essas ferramentas devido √† natureza hype geral da tecnologia e √†s "mais poderosas" na pessoa de g√™nero para conduzir tudo para nuvens e cont√™ineres.  Bem, porque agora est√° na moda e todo mundo faz. <br><br>  Pelo menos na metade dos casos, usar o kubernetis ou apenas uma janela de encaixe em um projeto √© redundante.  A quest√£o √© que nem todas as equipes ou empresas de terceiriza√ß√£o contratadas para atender √† infraestrutura do cliente est√£o cientes disso.  Pior - quando os cont√™ineres s√£o impostos, porque aumentam em uma certa quantidade de moedas para o cliente. <br><br>  Em geral, h√° uma opini√£o de que o docker / mafia cubo esmaga estupidamente os clientes que terceirizam esses problemas de infraestrutura.  De fato, para trabalhar com clusters, voc√™ precisa de engenheiros capazes disso e que compreendam a arquitetura da solu√ß√£o implementada em geral.  De alguma forma, j√° descrevemos nosso caso com a edi√ß√£o da Rep√∫blica - treinamos a equipe do cliente para trabalhar nas realidades dos kubernetis e todos ficaram satisfeitos.  E foi decente.  Muitas vezes, os "implementadores" do k8 tomam ref√©m da infraestrutura do cliente - agora eles s√≥ entendem como tudo funciona l√°, n√£o h√° especialistas no lado do cliente. <br><br>  Agora imagine que dessa maneira fornecemos n√£o apenas a parte do servidor da web para a terceiriza√ß√£o, mas tamb√©m a manuten√ß√£o do banco de dados.  Dissemos que um DB √© um cora√ß√£o e a perda de cora√ß√£o √© fatal para qualquer organismo vivo.  Em suma, as perspectivas n√£o s√£o as melhores.  Portanto, em vez do hype kubernetis, muitos projetos simplesmente n√£o devem enlouquecer com a tarifa normal da AWS, que resolver√° todos os problemas com a carga em seu site / projeto.  Mas a AWS n√£o est√° mais na moda e as exibi√ß√µes s√£o mais caras que o dinheiro - infelizmente tamb√©m no ambiente de TI. <br><br>  Ok  Talvez o projeto realmente precise de cluster, mas se tudo estiver claro com aplicativos sem estado, como podemos organizar o fornecimento decente de conectividade de rede para o banco de dados em cluster? <br><br>  Se estamos falando de uma solu√ß√£o de engenharia cont√≠nua, que parece ser a transi√ß√£o para o k8s, nossa principal dor de cabe√ßa √© a replica√ß√£o de dados em um banco de dados em cluster.  Alguns DBMSs s√£o inicialmente bastante leais √† distribui√ß√£o de dados entre suas inst√¢ncias individuais.  Muitos outros n√£o s√£o t√£o acolhedores.  E, muitas vezes, o principal argumento na escolha de um DBMS para o nosso projeto n√£o √© a capacidade de replicar com recursos m√≠nimos e custos de engenharia.  Especialmente se o projeto n√£o foi originalmente planejado como um microsservi√ßo, mas simplesmente evoluiu nessa dire√ß√£o. <br><br>  N√£o precisamos falar sobre a velocidade das unidades de rede - elas s√£o lentas.  I.e.  ainda n√£o temos uma possibilidade real; nesse caso, atualizar uma inst√¢ncia do DBMS em algum lugar, onde h√° mais, por exemplo, capacidades do processador ou RAM livre.  Rapidamente, encontramos o desempenho de um subsistema de disco virtualizado.  Consequentemente, o DBMS deve ser pregado em seu pr√≥prio conjunto pessoal de m√°quinas nas proximidades.  Ou, √© necess√°rio separar de alguma forma a sincroniza√ß√£o suficientemente r√°pida da sincroniza√ß√£o de dados com as reservas estimadas. <br><br>  Continuando o tema do FS virtual: Docker Volumes, infelizmente, n√£o s√£o isentos de problemas.  Em geral, no caso de armazenamento de dados confi√°vel a longo prazo, eu gostaria de gerenciar com os esquemas t√©cnicos mais simples.  E adicionar uma nova camada de abstra√ß√£o do cont√™iner FS ao host pai FS √© um risco por si s√≥.  Mas quando tamb√©m h√° dificuldades na transmiss√£o de dados entre essas camadas na opera√ß√£o do sistema de suporte √† conteineriza√ß√£o, √© realmente um desastre.  No momento, a maioria dos problemas conhecidos pela humanidade progressista parece ser erradicada.  Mas voc√™ mesmo entende que, quanto mais complexo o mecanismo, mais f√°cil ele quebra. <br><br>  √Ä luz de todas essas "aventuras", √© muito mais lucrativo e f√°cil manter o banco de dados em um s√≥ lugar, e mesmo se voc√™ precisar de conteineriza√ß√£o do aplicativo, deixe-o girar sozinho e atrav√©s do gateway de distribui√ß√£o receba comunica√ß√£o simult√¢nea com o banco de dados, que ser√° lido e gravado apenas uma vez e em um s√≥ lugar  Essa abordagem reduz a probabilidade de erros e m√° sincroniza√ß√£o para valores m√≠nimos. <br><br>  Para o que estamos levando?  Al√©m disso, a conteineriza√ß√£o do banco de dados √© apropriada onde houver uma necessidade real.  Voc√™ n√£o pode amontoar a base do aplicativo completo e gir√°-la como se tivesse duas d√∫zias de microsservi√ßos - isso n√£o funciona.  E isso deve ser claramente entendido. <br><br><h4>  Em vez de sa√≠da </h4><br>  Se voc√™ est√° esperando a conclus√£o intelig√≠vel de "virtualizar ou n√£o o banco de dados", ent√£o estamos desapontados: ele n√£o estar√° aqui.  Porque, ao criar qualquer solu√ß√£o de infraestrutura, n√£o se deve guiar pela moda e pelo progresso, mas, antes de tudo, pelo bom senso. <br><br>  Existem projetos nos quais os princ√≠pios e ferramentas que acompanham o kubernetis se encaixam perfeitamente e, nesses projetos, a paz ocorre pelo menos na √°rea de back-end.  E existem projetos que n√£o precisam de conteineriza√ß√£o, mas uma infraestrutura de servidor normal, porque eles basicamente n√£o podem ser redimensionados para um modelo de cluster de microsservi√ßo, porque eles cair√£o. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt453602/">https://habr.com/ru/post/pt453602/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt453590/index.html">Seu pr√≥prio SaaS pessoal</a></li>
<li><a href="../pt453592/index.html">Ganhar a vida e ganhar jogos: 11 dicas da Levelord</a></li>
<li><a href="../pt453594/index.html">Fazendo jogos para viver: 11 dicas da Levelord</a></li>
<li><a href="../pt453596/index.html">Fraudadores e EDS - tudo est√° muito ruim</a></li>
<li><a href="../pt453598/index.html">Jap√£o: um pa√≠s de bom senso que, em alguns lugares, √© irracional</a></li>
<li><a href="../pt453608/index.html">Pythonhosted.org bloqueado por engano por Roskomnadzor</a></li>
<li><a href="../pt453610/index.html">Como vender neg√≥cios SD-WAN</a></li>
<li><a href="../pt453612/index.html">Futebol nas nuvens - moda ou uma necessidade?</a></li>
<li><a href="../pt453614/index.html">Reposit√≥rio local (offline) do npm</a></li>
<li><a href="../pt453616/index.html">O que h√° de errado com a lei federal ‚ÄúSobre assinaturas eletr√¥nicas‚Äù (63-FZ) e como corrigi-la</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>