<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîñ üèÇ üåì Donn√©es de base en d√©tail üñäÔ∏è üèë üçé</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="R√©cemment, j'ai commenc√© √† travailler sur un grand projet utilisant Core Data. La chose habituelle est que les gens sur les projets changent, l'exp√©ri...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Donn√©es de base en d√©tail</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436510/"> R√©cemment, j'ai commenc√© √† travailler sur un grand projet utilisant Core Data.  La chose habituelle est que les gens sur les projets changent, l'exp√©rience est perdue et les nuances sont oubli√©es.  Il est impossible d'approfondir tout le monde dans l'√©tude d'un cadre sp√©cifique - chacun a ses propres probl√®mes de travail.  Par cons√©quent, j'ai pr√©par√© une courte pr√©sentation, √† partir des points que je consid√®re importants ou insuffisamment trait√©s dans les tutoriels.  Je partage avec tout le monde et j'esp√®re que cela aidera √† √©crire du code efficace et √† ne pas faire d'erreurs.  On suppose que vous √™tes d√©j√† un peu dans le sujet. <br><br>  Je vais commencer par le banal. <br><br>  Core Data est un cadre qui g√®re et stocke les donn√©es dans une application.  Vous pouvez consid√©rer Core Data comme un wrapper sur un stockage relationnel physique qui repr√©sente des donn√©es sous forme d'objets, tandis que Core Data lui-m√™me n'est pas une base de donn√©es. <br><br><h2>  Objets de donn√©es de base </h2><br><img src="https://habrastorage.org/webt/aq/ka/bk/aqkabk_js9w9knvyat6xp_u4u5a.png" alt="image"><br><a name="habracut"></a><br>  Pour cr√©er du stockage, l'application utilise les <b>classes</b> <b>NSPersistentStoreCoordinator</b> ou <b>NSPersistentContainer</b> .  NSPersistentStoreCoordinator cr√©e un stockage du type sp√©cifi√© en fonction du mod√®le, vous pouvez sp√©cifier l'emplacement et des options suppl√©mentaires.  NSPersistentContainer peut √™tre utilis√© avec iOS10, offre la possibilit√© de cr√©er avec un minimum de code. <br><br>  Il fonctionne comme suit: si une base de donn√©es existe sur le chemin sp√©cifi√©, le coordinateur v√©rifie sa version et, si n√©cessaire, effectue une migration.  Si la base de donn√©es n'existe pas, elle est cr√©√©e sur la base du mod√®le NSManagedObjectModel.  Pour que tout cela fonctionne correctement, avant d'apporter des modifications au mod√®le, cr√©ez une nouvelle version dans Xcode via le menu Editeur -&gt; Ajouter une version de mod√®le.  Si vous obtenez le chemin, vous pouvez trouver et ouvrir la base dans l'√©mulateur. <br><br><div class="spoiler">  <b class="spoiler_title">Exemple avec NSPersistentStoreCoordinator</b> <div class="spoiler_text"><pre><code class="objectivec hljs">var persistentCoordinator: <span class="hljs-built_in"><span class="hljs-built_in">NSPersistentStoreCoordinator</span></span> = { let modelURL = Bundle.main.url(forResource: <span class="hljs-string"><span class="hljs-string">"Test"</span></span>, withExtension: <span class="hljs-string"><span class="hljs-string">"momd"</span></span>) let managedObjectModel = <span class="hljs-built_in"><span class="hljs-built_in">NSManagedObjectModel</span></span>(contentsOf: modelURL!) let persistentCoordinator = <span class="hljs-built_in"><span class="hljs-built_in">NSPersistentStoreCoordinator</span></span>(managedObjectModel: managedObjectModel!) let documentsPath = <span class="hljs-built_in"><span class="hljs-built_in">NSSearchPathForDirectoriesInDomains</span></span>(.documentDirectory, .userDomainMask, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>] let storeURL = URL(fileURLWithPath: documentsPath.appending(<span class="hljs-string"><span class="hljs-string">"/Test.sqlite"</span></span>)) print(<span class="hljs-string"><span class="hljs-string">"storeUrl = \(storeURL)"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { try persistentCoordinator.addPersistentStore(ofType: <span class="hljs-built_in"><span class="hljs-built_in">NSSQLiteStoreType</span></span>, configurationName: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, at: storeURL, options: [<span class="hljs-built_in"><span class="hljs-built_in">NSSQLitePragmasOption</span></span>: [<span class="hljs-string"><span class="hljs-string">"journal_mode"</span></span>:<span class="hljs-string"><span class="hljs-string">"MEMORY"</span></span>]]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> persistentCoordinator } catch { abort() } } ()</code> </pre> <br></div></div><div class="spoiler">  <b class="spoiler_title">Exemple NSPersistentContainer</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">var persistentContainer: <span class="hljs-built_in"><span class="hljs-built_in">NSPersistentContainer</span></span> = { let container = <span class="hljs-built_in"><span class="hljs-built_in">NSPersistentContainer</span></span>(name: <span class="hljs-string"><span class="hljs-string">"CoreDataTest"</span></span>) container.loadPersistentStores(completionHandler: { (storeDescription, error) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> print(<span class="hljs-string"><span class="hljs-string">"storeDescription = \(storeDescription)"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let error = error as <span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span>? { fatalError(<span class="hljs-string"><span class="hljs-string">"Unresolved error \(error), \(error.userInfo)"</span></span>) } }) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> container } ()</code> </pre><br></div></div><br>  Core Data utilise 4 types de stockage: <br><br>  - SQLite <br>  - binaire <br>  - en m√©moire <br>  - XML ‚Äã‚Äã(Mac OS uniquement) <br><br>  Si, par exemple, pour des raisons de s√©curit√©, vous ne souhaitez pas stocker de donn√©es sous forme de fichier mais en m√™me temps utiliser la mise en cache pendant la session et des donn√©es sous forme d'objets, le stockage de type ¬´In-Memory¬ª est tout √† fait adapt√©.  En fait, il n'est pas interdit d'avoir plusieurs types de stockages diff√©rents dans une m√™me application. <br><br>  Je veux dire quelques mots sur l'objet <b>NSManagedObjectContext</b> .  En g√©n√©ral, Apple fournit une formulation tr√®s vague pour NSManagedObjectContext - un environnement pour travailler avec des objets Core Data.  Tout cela du d√©sir de se dissocier des associations avec les bases de donn√©es relationnelles, et de pr√©senter Core Data comme un outil facile √† utiliser qui ne n√©cessite pas une compr√©hension des cl√©s, des transactions et d'autres attributs Bazdan.  Mais dans le langage des bases de donn√©es relationnelles, NSManagedObjectContext peut, dans un sens, √™tre appel√© un gestionnaire de transactions.  Vous avez probablement remarqu√© qu'il dispose de m√©thodes de sauvegarde et de restauration, bien que vous n'utilisiez probablement que la premi√®re. <br><br>  Une m√©connaissance de ce simple fait conduit √† l'utilisation d'un mod√®le √† contexte unique, m√™me dans des situations o√π il ne suffit pas.  Par exemple, vous modifiez un document volumineux et en m√™me temps, vous avez d√ª t√©l√©charger quelques r√©pertoires.  √Ä quel moment appelez-vous save?  Si nous travaillions avec une base de donn√©es relationnelle, il n'y aurait pas de question, puisque chaque op√©ration serait effectu√©e dans sa propre transaction.  Core Data a √©galement un moyen tr√®s pratique de r√©soudre ce probl√®me - il s'agit d'une branche du contexte enfant.  Mais malheureusement, pour une raison quelconque, cela est rarement utilis√©.  Voici un bon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> sur ce sujet. <br><br><h2>  H√©ritage </h2><br>  Pour une raison que je ne comprends pas, il existe un tr√®s grand nombre de manuels et d'exemples o√π l'h√©ritage pour Entity / NSManagedObject (tables) n'est utilis√© en aucune fa√ßon.  En attendant, c'est un outil tr√®s pratique.  Si vous n'utilisez pas l'h√©ritage, vous pouvez affecter des valeurs aux attributs (champs) uniquement via le m√©canisme KVC, qui ne v√©rifie pas les noms et les types d'attributs, ce qui peut facilement entra√Æner des erreurs d'ex√©cution. <br><br>  La red√©finition de classe pour NSManagedObject est effectu√©e dans le concepteur de donn√©es de base: <br><br><img src="https://habrastorage.org/webt/ce/52/_p/ce52_pz39mzguhyiotm5rvhh00k.png" alt="image"><br><br><h2>  H√©ritage et g√©n√©ration de code </h2><br>  Apr√®s avoir sp√©cifi√© le nom de classe pour Entity, vous pouvez utiliser la g√©n√©ration de code et obtenir une classe avec du code pr√™t √† l'emploi: <br><br><img src="https://habrastorage.org/webt/al/dn/7a/aldn7aozwsnv-l7sjv8vau4iwmi.png" alt="image"><br><br><img src="https://habrastorage.org/webt/kj/ra/kh/kjrakhjgijvth5obsls22g6vtjk.png" alt="image"><br><br>  Si vous voulez voir le code g√©n√©r√© automatiquement, mais ne voulez pas ajouter de fichiers au projet, vous pouvez utiliser une autre fa√ßon: d√©finissez l'option "Codegen" pour Entity.  Dans ce cas, le code doit √™tre recherch√© dans ../ DerivedData / ... <br><br><img src="https://habrastorage.org/webt/zg/vw/9e/zgvw9e3sulaf6g7qici-uitdsei.png" alt="image"><br><br>  Utilisez la g√©n√©ration de code pour cr√©er des classes, les fautes de frappe dans les noms de variables peuvent entra√Æner des erreurs d'ex√©cution. <br><br>  Voici un code comme celui-ci: <br><br><pre> <code class="objectivec hljs">@objc public <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Company: <span class="hljs-built_in"><span class="hljs-built_in">NSManagedObject</span></span> {    @<span class="hljs-built_in"><span class="hljs-built_in">NSManaged</span></span> public var inn: String?  @<span class="hljs-built_in"><span class="hljs-built_in">NSManaged</span></span> public var name: String?  @<span class="hljs-built_in"><span class="hljs-built_in">NSManaged</span></span> public var uid: String?  @<span class="hljs-built_in"><span class="hljs-built_in">NSManaged</span></span> public var employee: <span class="hljs-built_in"><span class="hljs-built_in">NSSet</span></span>? }</code> </pre><br>  Dans swift, @NSManaged a la m√™me signification que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">dynamique</a> dans Objective C. <br>  Core Data s'occupe lui-m√™me de la r√©ception des donn√©es (a des accesseurs internes) pour les attributs de ses classes.  Si vous avez des champs de transit, vous devez ajouter des fonctions pour les calculer. <br><br>  Les classes h√©rit√©es de NSManagedObject (tables) n'avaient pas de constructeur ¬´normal¬ª avant IOS10, contrairement aux autres classes.  Pour cr√©er un objet de type Company, il a fallu √©crire une construction plut√¥t maladroite en utilisant NSEntityDescription.  Il existe maintenant une m√©thode d'initialisation plus pratique via le contexte (NSManagedObjectContext).  Le code est ci-dessous.  Notez l'avantage de l'h√©ritage lors de l'attribution d'attributs par rapport au m√©canisme KVC: <br><br><pre> <code class="objectivec hljs"><span class="hljs-comment"><span class="hljs-comment">// 1 -    NSEntityDescription,    KVO let company1 = NSEntityDescription.insertNewObject(forEntityName: "Company", into: moc) company1.setValue("077456789111", forKey: "inn") company1.setValue(" ", forKey: "name") // 2 -    NSEntityDescription,     let company2 = NSEntityDescription.insertNewObject(forEntityName: "Company", into: moc) as! Company company2.inn = "077456789222" company2.name = " " // 3 -     (IOS10+),     let company3 = Company(context: moc) company3.inn = "077456789222" company3.name = " "</span></span></code> </pre><br><h2>  Espace de noms pour NSManagedObject </h2><br>  Un autre √©l√©ment √† mentionner est l'espace de noms. <br><br><img src="https://habrastorage.org/webt/fk/a7/wl/fka7wlfqlf4cvi1ezcqst4kiiyi.png" alt="image"><br><br>  Vous n'aurez aucune difficult√© si vous travaillez sur ObjectiveC ou Swift.  Habituellement, ce champ est correctement rempli par d√©faut.  Mais dans les projets mixtes, cela peut vous surprendre que pour les classes en swift et ObjectiveC, vous ayez besoin de proposer diff√©rentes options.  Dans Swift, le ¬´Module¬ª doit √™tre rempli.  Si ce champ n'est pas rempli, un pr√©fixe avec le nom du projet sera ajout√© au nom de la classe, ce qui provoquera une erreur d'ex√©cution.  Dans l'Objectif C, laissez le ¬´Module¬ª vide, sinon NSManagedObject ne sera pas trouv√© lors de l'acc√®s via le nom de la classe. <br><br><h2>  Liens entre objets </h2><br>  En principe, le sujet des relations est bien couvert, mais je veux me concentrer sur la fa√ßon d'ajouter des entit√©s enfants au parent.  Par cons√©quent, tout d'abord, un rappel rapide du m√©canisme de cr√©ation de liens.  Prenons un exemple traditionnel, une entreprise est des employ√©s, une relation un-√†-plusieurs: <br><br><ul><li>  Cr√©ez une connexion de chaque c√¥t√© (tableau) </li><li>  Apr√®s cela, le champ Inverse devient disponible, il doit √™tre rempli dans chaque tableau. </li></ul><br><img src="https://habrastorage.org/webt/_m/fx/si/_mfxsi_lcnxt8t3zlhh0vbrbsus.png" alt="image"><br><br><img src="https://habrastorage.org/webt/kb/uo/my/kbuomy1etksutabvijrvxlztiyy.png" alt="image"><br><br>  Apple insiste pour sp√©cifier des relations inverses.  Dans le m√™me temps, l'inversion ne renforce pas la coh√©rence, mais aide Core Data √† suivre les changements des deux c√¥t√©s de la connexion, elle est importante pour la mise en cache et la mise √† jour des informations. <br><br>  Il est √©galement important de sp√©cifier correctement la r√®gle de suppression.  Une r√®gle de suppression est une action qui sera effectu√©e avec cet objet lorsque l'objet parent est supprim√©. <br><br><ul><li>  Cascade - suppression de tous les objets enfants, lorsque le parent est supprim√©. </li><li>  Refuser - interdiction de supprimer un parent s'il y a un enfant </li><li>  Nullify - annuler la r√©f√©rence parent </li><li>  Aucune action - aucune action sp√©cifi√©e, il donnera un avertissement lors de la compilation </li></ul><br>  Dans cet exemple, lorsqu'une entreprise est supprim√©e, tous les employ√©s seront supprim√©s (cascade).  Lorsque vous supprimez un employ√©, le lien vers lui dans l'entreprise sera r√©initialis√© (pr√©-√©cran) <br><br><h2>  Fa√ßons d'ajouter des entit√©s enfants au parent </h2><br>  <b>1)</b> La premi√®re m√©thode consiste √† ajouter via NSSet.  Par exemple, ajoutez 2 employ√©s √† l'entreprise: <br><br><pre> <code class="objectivec hljs">let set = <span class="hljs-built_in"><span class="hljs-built_in">NSMutableSet</span></span>();    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let employee1 = <span class="hljs-built_in"><span class="hljs-built_in">NSEntityDescription</span></span>.insertNewObject(forEntityName: <span class="hljs-string"><span class="hljs-string">"Employee"</span></span>, into: moc) as? Employee { employee1.firstName = <span class="hljs-string"><span class="hljs-string">""</span></span> employee1.secondName = <span class="hljs-string"><span class="hljs-string">""</span></span> set.add(employee1) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let emploee2 = <span class="hljs-built_in"><span class="hljs-built_in">NSEntityDescription</span></span>.insertNewObject(forEntityName: <span class="hljs-string"><span class="hljs-string">"Employee"</span></span>, into: moc) as? Employee { employee2.firstName = <span class="hljs-string"><span class="hljs-string">""</span></span> employee2.secondName = <span class="hljs-string"><span class="hljs-string">""</span></span> set.add(employee2) }    company.employee = set</code> </pre><br>  Cette m√©thode est pratique pour initialiser l'objet ou remplir la base de donn√©es.  Il y a une l√©g√®re nuance.  Si l'entreprise avait d√©j√† des employ√©s et que vous avez affect√© un nouvel ensemble, les anciens employ√©s r√©initialiseront le lien vers l'entreprise, mais ils ne seront pas supprim√©s.  Alternativement, vous pouvez obtenir une liste d'employ√©s et travailler d√©j√† avec cet ensemble. <br><br><pre> <code class="objectivec hljs">let set = company.mutableSetValue(forKey: <span class="hljs-string"><span class="hljs-string">"employee"</span></span>)</code> </pre> <br>  <b>2)</b> Ajout d'objets enfants via l'ID parent <br><br><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let employee = <span class="hljs-built_in"><span class="hljs-built_in">NSEntityDescription</span></span>.insertNewObject(forEntityName: <span class="hljs-string"><span class="hljs-string">"Employee"</span></span>, into: moc) as? Employee { employee.firstName = <span class="hljs-string"><span class="hljs-string">""</span></span> employee.secondName = <span class="hljs-string"><span class="hljs-string">""</span></span> employee.company = company }</code> </pre><br>  La deuxi√®me m√©thode est pratique lors de l'ajout ou de la modification d'un objet enfant dans <br>  formulaire s√©par√©. <br><br>  <b>3)</b> Ajout d'objets enfants via des m√©thodes g√©n√©r√©es automatiquement <br><br><pre> <code class="objectivec hljs">extension Company {    @objc(addEmployeeObject:)  @<span class="hljs-built_in"><span class="hljs-built_in">NSManaged</span></span> public func addEmployee(_ value: Employee)    @objc(removeEmployeeObject:)  @<span class="hljs-built_in"><span class="hljs-built_in">NSManaged</span></span> public func removeFromEmployee(_ value: Employee)    @objc(addEmployee:)  @<span class="hljs-built_in"><span class="hljs-built_in">NSManaged</span></span> public func addEmployee(_ values: <span class="hljs-built_in"><span class="hljs-built_in">NSSet</span></span>)    @objc(removeEmployee:)  @<span class="hljs-built_in"><span class="hljs-built_in">NSManaged</span></span> public func removeFromEmployee(_ values: <span class="hljs-built_in"><span class="hljs-built_in">NSSet</span></span>) }</code> </pre><br>  Par souci d'exhaustivit√©, il est utile de conna√Ætre cette m√©thode, mais d'une certaine mani√®re, cela ne m'a pas √©t√© utile, et je supprime le code suppl√©mentaire afin de ne pas encombrer le projet. <br><br><h2>  Requ√™tes de clause enfant </h2><br>  Dans Core Data, vous ne pouvez pas effectuer de requ√™te arbitraire entre des donn√©es, comme nous pouvons le faire en SQL.  Mais entre les objets d√©pendants, il est facile de suivre √† l'aide d'un pr√©dicat standard.  Voici un exemple de requ√™te qui s√©lectionne toutes les entreprises dans lesquelles il y a un employ√© avec le nom sp√©cifi√©: <br><br><pre> <code class="objectivec hljs">public <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> func getCompanyWithEmployee(name: String) -&gt; [Company] { let request = <span class="hljs-built_in"><span class="hljs-built_in">NSFetchRequest</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">NSFetchRequestResult</span></span>&gt;(entityName: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.className()) request.predicate = <span class="hljs-built_in"><span class="hljs-built_in">NSPredicate</span></span>(format: <span class="hljs-string"><span class="hljs-string">"ANY employee.firstName = %@"</span></span>, name) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let result = try moc.fetch(request) as? [Company] { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result } } catch { } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [Company]() }</code> </pre><br>  L'appel de m√©thode dans le code ressemblera √† ceci: <br><br><pre> <code class="objectivec hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,    let companies = Company.getCompanyWithEmployee(name: "")</span></span></code> </pre><br>  N'utilisez pas de champs de transit dans les requ√™tes; leurs valeurs ne sont pas d√©finies au moment de l'ex√©cution de la requ√™te.  Aucune erreur ne se produira, mais le r√©sultat sera incorrect. <br><br><h2>  D√©finition des attributs (champs) </h2><br>  Vous avez probablement remarqu√© que les attributs d'entit√© ont plusieurs options. <br>  Avec facultatif, tout est clair d'apr√®s le nom. <br><br>  L'option d'utilisation du type scalaire est apparue dans swif.  Objective-C n'utilise pas de types scalaires pour les attributs, car ils ne peuvent pas √™tre nuls.  Toute tentative d'attribution d'une valeur scalaire √† un attribut via KVC entra√Ænera une erreur d'ex√©cution.  Cela montre clairement pourquoi les types d'attribut dans Core Data n'ont pas une correspondance stricte avec les types de langage.  Dans les projets rapides et mixtes, des attributs de type scalaire peuvent √™tre utilis√©s. <br><br>  Les attributs de transit sont des champs calcul√©s qui <b>ne</b> sont <b>pas</b> stock√©s dans la base de donn√©es.  Ils peuvent √™tre utilis√©s pour le cryptage.  Ces attributs re√ßoivent des valeurs via un accesseur substitu√©, ou en affectant des primitives selon les besoins (par exemple, willSave et awakeFromFetch substitu√©s). <br><br><h2>  Accesseurs d'attribut: </h2><br>  Si vous n'avez pas besoin d'utiliser des champs calcul√©s, par exemple, pour effectuer le chiffrement ou autre chose, alors vous n'avez pas √† penser √† ce que sont les accessoires d'attribut.  Pendant ce temps, les op√©rations d'obtention et d'affectation de valeurs aux attributs ne sont pas ¬´atomiques¬ª.  Pour comprendre ce que je veux dire, consultez le code ci-dessous: <br><br><pre> <code class="objectivec hljs"><span class="hljs-comment"><span class="hljs-comment">//  let name = company.name //  company.willAccessValue(forKey: "name") let name = company.primitiveValue(forKey: "name") company.didAccessValue(forKey: "name") //  company.name = " " //  company.willChangeValue(forKey: "name") company.setPrimitiveValue(" ", forKey: "name") company.didChangeValue(forKey: "name")</span></span></code> </pre><br>  Utilisez des primitives dans les √©v√©nements NSManagedObject au lieu de l'affectation habituelle pour √©viter le bouclage.  Un exemple: <br><br><pre> <code class="objectivec hljs">override func willSave() {   let nameP = encrypt(field: primitiveValue(forKey: <span class="hljs-string"><span class="hljs-string">"name"</span></span>), password: password)   setPrimitiveValue(nameP, forKey: <span class="hljs-string"><span class="hljs-string">"nameC"</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.willSave() }  override func awakeFromFetch() {   let nameP = decrypt(field: primitiveValue(forKey: <span class="hljs-string"><span class="hljs-string">"nameC"</span></span>), password: password)   setPrimitiveValue(nameP, forKey: <span class="hljs-string"><span class="hljs-string">"name"</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.awakeFromFetch() }</code> </pre><br>  Si vous devez soudainement visser la fonction awakeFromFetch dans un projet, vous serez surpris que cela fonctionne tr√®s bizarrement, mais en fait, elle n'est pas appel√©e du tout lorsque vous ex√©cutez la demande.  Cela est d√ª au fait que Core Data dispose d'un m√©canisme de mise en cache tr√®s intelligent, et si la s√©lection est d√©j√† en m√©moire (par exemple, parce que vous venez de remplir ce tableau), la m√©thode ne sera pas appel√©e.  Cependant, mes exp√©riences ont montr√© qu'en termes de valeurs calcul√©es, vous pouvez compter en toute s√©curit√© sur l'utilisation de awakeFromFetch, comme le dit la documentation d'Apple.  Si pour les tests et le d√©veloppement, vous devez forcer awakeFromFetch, ajoutez managedObjectContext.refreshAllObjects () avant la demande. <br><br>  C‚Äôest tout. <br><br>  Merci √† tous ceux qui ont lu jusqu'√† la fin. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr436510/">https://habr.com/ru/post/fr436510/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr436500/index.html">Comment le cadre de Rise of the Tomb Raider est rendu</a></li>
<li><a href="../fr436502/index.html">Abonnement Pampers ou comment vendre plus aux m√™mes clients</a></li>
<li><a href="../fr436504/index.html">Syst√®me en emballage ou contenu de l'emballage sous puce?</a></li>
<li><a href="../fr436506/index.html">Comment cr√©er un IA-raciste sans trop d'effort</a></li>
<li><a href="../fr436508/index.html">10 millions de dollars d'investissements et les louanges de Wozniak - cr√©er un ordinateur √©ducatif pour les enfants</a></li>
<li><a href="../fr436512/index.html">Comment nous trouvons les versions probl√©matiques avec Graphite et Moira. D√©couvrez Yandex.Money</a></li>
<li><a href="../fr436514/index.html">Cr√©er des histoires pour Instagram √† partir de PHP</a></li>
<li><a href="../fr436518/index.html">Haiku Œ≤1 - rendre le / b / OS g√©nial √† nouveau</a></li>
<li><a href="../fr436520/index.html">N'utilisez pas les services de v√©rification en ligne lors de la fuite de donn√©es personnelles</a></li>
<li><a href="../fr436522/index.html">Contrairement aux instructions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>