<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👢 🤚🏼 🤓 Stéganographie en paquets IP 🧦 🔠 🏂🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Une fois, avant de défendre un autre travail de laboratoire, ils m'ont posé une question: quels champs d'un paquet IP peuvent être utilisés pour le ma...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Stéganographie en paquets IP</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413851/">  Une fois, avant de défendre un autre travail de laboratoire, ils m'ont posé une question: quels champs d'un paquet IP peuvent être utilisés pour le matelassé?  Je ne savais pas et je haussai simplement les épaules.  Mais bientôt, j'ai quand même décidé d'étudier cette question. <br><br>  Sous la coupe, vous trouverez l'étude des en-têtes de paquets IP, le propre utilitaire ping de Python et plusieurs façons de transférer des données sans attirer l'attention. <br><a name="habracut"></a><br><h1>  Table des matières </h1><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Structure des paquets IP</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Réglage de l'environnement</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ping: option facile</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ping: option difficile</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Des améliorations?</a> </li></ol><br><a name="ip-struct"></a><h1>  Structure des paquets IPv4 </h1><br><img src="https://habrastorage.org/webt/r9/29/fa/r929fayvayajg2jl6a8016g3fbw.png"><br><br>  Sélectionnez les champs dont le changement n'affectera pas grandement le package: <br><br>  <b><abbr title="Longueur d'en-tête Internet">Le DIH</abbr></b> peut varier de 5 à 15. <br>  Le champ <b><abbr title="Type de service">ToS</abbr></b> est utilisé pour hiérarchiser les notifications de trafic et de congestion sans perdre de paquets.  Le plus souvent, ce champ est 0. Théoriquement, il peut être utilisé pour transmettre un octet entier d'informations. <br>  <b>La longueur du paquet est un</b> excellent champ pour transmettre des nombres de 20 à 65535. <br>  <b><abbr title="Il est temps de vivre">TTL</abbr></b> peut transmettre jusqu'à 7 bits d'informations.  Vous devez connaître le nombre de sauts vers l'hôte et en tenir compte. <br><br><a name="setup"></a><h1>  Réglage de l'environnement </h1><br>  Pour répéter l'expérience, vous aurez besoin de deux machines avec Python et le framework scapy. <br><br>  Vous pouvez l'installer en suivant les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">instructions de la documentation</a> .  Dans mon cas, il s'agissait de deux gouttelettes sur DO avec le réseau local activé.  Pour tester l'opérabilité du stegano, deux itinéraires ont été choisis: via le réseau local pour 1 saut et via Internet pour 2 sauts. <br><br><a name="simple-ping"></a><h1>  Ping: option facile </h1><br>  D'abord, nous implémentons sender.py, qui enverra des paquets ICMP sans messages cachés. <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> scapy.all <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-comment"><span class="hljs-comment">#    10.0.0.2  icmp-type 8 (echo-request) pkt = IP(src="10.0.0.1", dst="10.0.0.2") / ICMP(type = 8) #      sr1(pkt)</span></span></code> </pre> <br>  Scapy remplira les champs restants avec des valeurs par défaut avant l'envoi et calculera la somme de contrôle. <br><br>  Du côté de la réception, écrivez listener.py, qui écoutera et affichera tous les paquets ICMP entrants. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> scapy.all <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-comment"><span class="hljs-comment">#    # filter --  icmp # timeout --   10  # count --    100  # iface --    eth1 packets = sniff(filter = "icmp", timeout = 10, count = 100, iface = "eth1") #      for pkt in packets: #     echo-request if pkt[ICMP].type != 8: continue #    pkt.show()</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Sortie d'écoute</b> <div class="spoiler_text"><pre> <code class="hljs tex">###[ Ethernet ]### dst = hh:hh:hh:hh:hh:hh src = gg:gg:gg:gg:gg:gg type = 0x800 ###[ IP ]### version = 4 ihl = 5 tos = 0x0 len = 28 id = 24923 flags = frag = 0 ttl = 64 proto = icmp chksum = 0x4364 src = 10.0.0.1 dst = 10.0.0.2 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">options</span></span></span></span> <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>###[ ICMP ]### type = echo-request code = 0 chksum = 0xf7ff id = 0x0 seq = 0x0 ###[ Padding ]### load = '<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00'</code> </pre> <br></div></div><br>  L'en-tête de paquet IP a un champ identifiant.  Remplissez-le avec les symboles «A» et «B»: <br><br><pre> <code class="python hljs">payload = ord(<span class="hljs-string"><span class="hljs-string">"A"</span></span>) * <span class="hljs-number"><span class="hljs-number">0x100</span></span> + ord(<span class="hljs-string"><span class="hljs-string">"B"</span></span>) pkt = IP(src=<span class="hljs-string"><span class="hljs-string">"10.0.0.1"</span></span>, dst=<span class="hljs-string"><span class="hljs-string">"10.0.0.2"</span></span>, id = payload) / ICMP(type = <span class="hljs-number"><span class="hljs-number">8</span></span>)</code> </pre><br>  De plus, dans l'en-tête ICMP, il y a exactement le même champ dans lequel deux octets peuvent également être chargés. <br><br>  Modifiez l'écouteur pour afficher les données reçues: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> scapy.all <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys packets = sniff(filter=<span class="hljs-string"><span class="hljs-string">"icmp"</span></span>, timeout = <span class="hljs-number"><span class="hljs-number">10</span></span>, count = <span class="hljs-number"><span class="hljs-number">100</span></span>, iface=<span class="hljs-string"><span class="hljs-string">"eth0"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> pkt <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> packets: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pkt[ICMP].type != <span class="hljs-number"><span class="hljs-number">8</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> <span class="hljs-comment"><span class="hljs-comment">#    a, b = divmod(pkt[IP].id, 0x100) sys.stdout.write(chr(a)) sys.stdout.write(chr(b)) sys.stdout.flush()</span></span></code> </pre><br>  Dans l'image et la ressemblance, vous pouvez remplir presque n'importe quel champ qui a été précédemment noté comme approprié pour la courtepointe. <br><br><a name="complex-ping"></a><h1>  Ping: option difficile </h1><br>  Le transfert de données du paragraphe précédent n'était pas le plus évident, mais nous pouvons le rendre encore moins évident.  Vous pouvez masquer les données dans le champ de la somme de contrôle.  Selon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RFC1071,</a> une somme de contrôle est (soudain!) Une inversion au niveau du bit d'une somme arithmétique légèrement plus complexe. <br><br><div class="spoiler">  <b class="spoiler_title">Explication avec un exemple</b> <div class="spoiler_text">  Supposons que nous ayons un en-tête pour lequel nous voulons calculer la somme de contrôle.  Au moment du calcul, le champ de somme de contrôle est réinitialisé. <br><br><pre> <code class="hljs go"><span class="hljs-number"><span class="hljs-number">4500</span></span> <span class="hljs-number"><span class="hljs-number">003</span></span>c <span class="hljs-number"><span class="hljs-number">000</span></span>a <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">8001</span></span> [checksum] c0a8 <span class="hljs-number"><span class="hljs-number">000d</span></span> c0a8 <span class="hljs-number"><span class="hljs-number">000d</span></span></code> </pre> <br>  1. Additionnez tous les mots de 16 bits, en vous souvenant du transfert de haut niveau: <br><br><pre> <code class="hljs powershell"><span class="hljs-number"><span class="hljs-number">4500</span></span> + <span class="hljs-number"><span class="hljs-number">003</span></span>c + <span class="hljs-number"><span class="hljs-number">000</span></span>a + <span class="hljs-number"><span class="hljs-number">0000</span></span> + <span class="hljs-number"><span class="hljs-number">8001</span></span> + [<span class="hljs-type"><span class="hljs-type">checksum</span></span>=<span class="hljs-number"><span class="hljs-number">0000</span></span>] + c0a8 + <span class="hljs-number"><span class="hljs-number">000</span></span>d + c0a8 + <span class="hljs-number"><span class="hljs-number">000</span></span>e = = (<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">46</span></span>b2</code> </pre> <br>  2. Additionnez le résultat avec les transferts: <br><br><pre> <code class="hljs">46b2 + 2 = 46b4</code> </pre> <br>  3. Inverser: <br><br><pre> <code class="hljs">~(46b4) = b94b</code> </pre> <br>  <b>b94b</b> est la somme de contrôle que nous <b>recherchons</b> .  Pour vérification, vous pouvez remplacer dans l'en-tête et effectuer les étapes 1 et 2. Si vous obtenez FFFF, le montant trouvé est correct. <br><br>  Vérification: <br><br><pre> <code class="hljs powershell"><span class="hljs-number"><span class="hljs-number">1</span></span>. <span class="hljs-number"><span class="hljs-number">4500</span></span> + <span class="hljs-number"><span class="hljs-number">003</span></span>c + <span class="hljs-number"><span class="hljs-number">000</span></span>a + <span class="hljs-number"><span class="hljs-number">0000</span></span> + <span class="hljs-number"><span class="hljs-number">8001</span></span> + [<span class="hljs-type"><span class="hljs-type">checksum</span></span>=<span class="hljs-type"><span class="hljs-type">b94b</span></span>] + c0a8 + <span class="hljs-number"><span class="hljs-number">000</span></span>d + c0a8 + <span class="hljs-number"><span class="hljs-number">000</span></span>e = = (<span class="hljs-number"><span class="hljs-number">2</span></span>) FFFD <span class="hljs-number"><span class="hljs-number">2</span></span>. FFFD + <span class="hljs-number"><span class="hljs-number">2</span></span> = FFFF</code> </pre><br></div></div><br>  Nous savons que la somme de contrôle d'un paquet change à mesure que les nœuds traversent le réseau, à mesure que le TTL change.  De plus, lors du passage par NAT dans le paquet, «l'adresse source» est remplacée, ce qui affecte également la somme de contrôle.  Et combien TTL diminuera en atteignant notre auditeur ... La cerise sur le gâteau est que le témoin de l '"identifiant" coïncide avec le témoin de la somme de contrôle.  Ce fait nous permet d'influencer la somme de contrôle et de la changer en n'importe quelle valeur de la zone de définition.  Étant donné que la somme de contrôle (charge utile) sera calculée uniquement lors du passage du dernier nœud de la route, il est important de prendre en compte tout ce qui peut être modifié dans le paquet pendant la route lors du calcul. <br><br>  L'algorithme de recherche de "l'identifiant", qui nous donnera la somme de contrôle souhaitée: <br><br><ol><li>  Nous configurons le package comme lors du passage sur le dernier nœud (IP, TTL, etc.) </li><li>  Dans "l'identifiant", écrivez la charge utile </li><li>  Nous calculons la somme de contrôle </li><li>  Le résultat doit être écrit dans "l'identifiant" du paquet envoyé </li></ol><br>  Nous allons écrire une fonction qui formera un paquet par le nombre d'espoirs, les IP derrière NAT et deux octets de charge utile. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># src -   # src_nat -    NAT # dst -   # dttl -       # a, b --      def send_stegano(src, src_nat, dst, dttl, a, b): #       payload = ord(a)*0x100 + ord(b) #         pkt = IP(dst=dst, src=src_nat, ttl=64-dttl, id = payload) / ICMP(type=8) #  Scapy  chksum pkt = IP(raw(pkt)) #     pkt[IP].src = src pkt[IP].ttl = 64 pkt[IP].id = pkt[IP].chksum #   chksum,  Scapy   del pkt[IP].chksum # Scapy      pkt = IP(raw(pkt)) #      sr1(pkt)</span></span></code> </pre><br><a name="the-cake-is-a-lie"></a><h1>  Des améliorations? </h1><br><ul><li>  les champs chksum, seq, id dans l'en-tête du protocole ICMP peuvent également être utilisés pour transmettre des données </li><li>  Les ToS peuvent être utilisés pour identifier les packages "par eux-mêmes" et ignorer la demande d'écho des autres. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr413851/">https://habr.com/ru/post/fr413851/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr413839/index.html">AI, cours pratique. Collection et recherche d'images</a></li>
<li><a href="../fr413841/index.html">Alternatives aux produits Google</a></li>
<li><a href="../fr413843/index.html">Waymo devance les autres: les robots de la société ont parcouru 11 millions de kilomètres</a></li>
<li><a href="../fr413847/index.html">Monument déclencheur "vivant"</a></li>
<li><a href="../fr413849/index.html">Histoire de la marque Sennheiser: liberté et vision</a></li>
<li><a href="../fr413853/index.html">Aperçu des méthodes de gradient dans les problèmes d'optimisation mathématique</a></li>
<li><a href="../fr413855/index.html">L'algorithme de détermination des bots et des offres sur Vkontakte</a></li>
<li><a href="../fr413857/index.html">Biostar Racing P1: échappement à froid</a></li>
<li><a href="../fr413859/index.html">Révéler les secrets d'un extraterrestre interplanétaire</a></li>
<li><a href="../fr413861/index.html">L'Europe reproduit l'approche de réutilisabilité de SpaceX</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>