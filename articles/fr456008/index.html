<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÜüèø üèáüèø üÜí D√©veloppement de programmes pour le processeur central Redd utilisant l'acc√®s au FPGA ü§µüèº üëãüèª ü§∏üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans un article pr√©c√©dent, j'ai dit qu'il √©tait temps pour nous de passer aux protocoles de streaming. Mais apr√®s avoir commenc√© √† pr√©parer une histoi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>D√©veloppement de programmes pour le processeur central Redd utilisant l'acc√®s au FPGA</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456008/">  Dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article pr√©c√©dent,</a> j'ai dit qu'il √©tait temps pour nous de passer aux protocoles de streaming.  Mais apr√®s avoir commenc√© √† pr√©parer une histoire √† leur sujet, j'ai r√©alis√© que je nage moi-m√™me dans un sujet tr√®s important.  Comme d√©j√† not√©, ma relation avec Linux est assez particuli√®re.  En g√©n√©ral, je me suis rendu compte que je ne pouvais pas moi-m√™me cr√©er √† partir de z√©ro une application C ++ qui satisferait tous les principes de programmation pour Redd.  Vous pouvez demander √† quelqu'un de le faire, puis utiliser simplement le mod√®le pr√™t √† l'emploi, mais la s√©rie d'articles est con√ßue pour enseigner √† tout le monde comment d√©velopper sous Redd √† partir de z√©ro.  Par cons√©quent, j'ai demand√© √† mon patron (un grand sp√©cialiste de Linux), et il m'a expliqu√© sur quoi cliquer.  Puis j'ai l√©g√®rement repens√© ses paroles et maintenant je consid√®re qu'il est n√©cessaire de fixer toutes les connaissances par √©crit.  Cela sauvera des gens comme moi de pens√©es douloureuses: "Alors ... Ce qu'il a fait est compr√©hensible, mais comment puis-je r√©p√©ter cela?"  En g√©n√©ral, toute personne travaillant sous Linux peut ex√©cuter les deux sections suivantes en diagonale.  Il est peu probable que vous y trouviez quelque chose de nouveau (vous trouverez plus loin).  Et pour le reste, je propose un choix de deux m√©thodes de d√©veloppement qui correspondent aux principes d√©clar√©s de travailler sous Redd: des co√ªts de main d'≈ìuvre bas pour le d√©veloppement et le d√©bogage √† distance. <br><br><img src="https://habrastorage.org/webt/kb/sk/5c/kbsk5cbh98eftndkgneifjnzgao.jpeg"><br><a name="habracut"></a><br>  Tous les articles du cycle: <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">D√©veloppement du ¬´firmware¬ª le plus simple pour les FPGA install√©s dans Redd, et d√©bogage en utilisant le test de m√©moire comme exemple</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">D√©veloppement du ¬´firmware¬ª le plus simple pour les FPGA install√©s dans Redd.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2. Code de programme</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">D√©veloppement de son propre noyau pour l'int√©gration dans un syst√®me de processeur bas√© sur FPGA</a> </li></ol><br><h2>  Travailler avec Visual Studio Tools </h2><br>  Il s'av√®re que vous pouvez effectuer le d√©veloppement pour Linux distant, sans l'avoir du tout sur votre machine locale et sans installer d'outils logiciels non Microsoft.  Ici, il est montr√© comment il est mis sur Visual Studio (je l'ai install√© dans la version 2019, mais il semble qu'il soit apparu en 2015) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">docs.microsoft.com/ru-ru/cpp/linux/download-install-and-setup- the-linux-development-workload? view = vs-2019</a> <br><br>  Et voici la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">th√©orie du travail</a> . <br><br>  Eh bien, l√†, vous pouvez vous promener dans les onglets, beaucoup de th√©orie et tout en russe. <br><br>  Super!  Essayons d'utiliser les connaissances acquises pour acc√©der √† la puce FT2232H, √† travers laquelle le processeur central Redd est connect√© au FPGA.  C'est cette cha√Æne √† l'avenir qui constituera la base de notre travail de streaming.  Ouvrez Visual Studio, s√©lectionnez ¬´Cr√©er un projet¬ª.  Dans les filtres, s√©lectionnez "Langage - C ++", "Plateforme - Linux", "Type de projet - Console".  Je montrerai o√π cela se trouve d√©j√† pour le type de projet.  A partir de ce que nous avons filtr√©, nous s√©lectionnons ¬´Application console¬ª: <br><br><img src="https://habrastorage.org/webt/ao/5x/h4/ao5xh4h5fwoldpjdn_-rpx8ay2a.png"><br><br>  Appelons-le, disons, SimpleConsole.  Nous avons cr√©√© un tel code source Spartan: <br><br><pre><code class="plaintext hljs">#include &lt;cstdio&gt; int main() { printf("hello from SimpleConsole!\n"); return 0; }</code> </pre> <br>  Essayons de le collecter.  Et on nous pose une question tr√®s int√©ressante sur l'√©tablissement d'une connexion.  Il s'agit d'une fonctionnalit√© de d√©veloppement dans Visual Studio.  L'environnement ne contient pas de compilateur crois√© et aucune biblioth√®que.  Il cr√©e simplement un r√©pertoire source sur la machine distante, apr√®s quoi, pour chaque compilation, il y copie les fichiers mis √† jour et y d√©marre la compilation.  C'est pourquoi la connexion avec la machine distante ne doit pas √™tre √©tablie pour d√©marrer, mais d√©j√† pour l'assemblage normal du projet. <br><br>  Nous remplissons les param√®tres pour l'utilisateur Redd, pour le compte duquel les travaux seront effectu√©s sur le projet. <br><br><img src="https://habrastorage.org/webt/jd/sx/hk/jdsxhkvvklw29zjoecvrr1svvda.png"><br><br>  Si quelque chose - les param√®tres peuvent √™tre modifi√©s ici dans cet endroit secret (n'essayez pas de changer les propri√©t√©s du projet, cela ne m√®nera √† rien de bon): <br><br><img src="https://habrastorage.org/webt/dn/xe/yd/dnxeydmzx11e50rtxzjayuleto0.png"><br><br><img src="https://habrastorage.org/webt/ow/k-/le/owk-leapmriognn1l-kk4tavvyc.png"><br><br>  En fait, vous pouvez mettre un point d'arr√™t sur une seule ligne et v√©rifier que le projet d√©marre et fonctionne.  Mais c'est trivial.  Par cons√©quent, nous passons √† une t√¢che plus int√©ressante - travailler avec FT2232.  La question se pose: o√π trouver les biblioth√®ques n√©cessaires?  Pour Linux, tout est inclus dans le package de pilotes.  Il y a le pilote lui-m√™me, et les biblioth√®ques, et des exemples d'applications pour travailler avec eux, et m√™me une br√®ve instruction.  En g√©n√©ral, nous entrons dans le moteur de recherche: <br><br><pre> <code class="plaintext hljs">FTDI D2XX drivers</code> </pre> <br>  Il montrera o√π ils peuvent √™tre t√©l√©charg√©s.  Certes, tout √©tait mauvais pour moi.  Mon fournisseur bloque le site Web FTDI (ainsi que reprap, 7zip et m√™me osronline), se r√©f√©rant √† RosKomNadzor.  ILV, en r√©ponse aux d√©clarations, envoie des d√©sabonnements, disant que nous ne bloquons rien, mais traitons avec le fournisseur vous-m√™me.  O√π seulement dans ces d√©sabonnements ne m'ont-ils pas propos√© de me tourner, m√™me √† la police.  Ils sont tr√®s d√©sabonn√©s.  Les tentatives de se plaindre de l'inaction d'ILV finissent par √™tre transmises √† ILV, d'o√π proviennent les prochains d√©sabonnements.  En g√©n√©ral, il se peut que votre fournisseur bloque √©galement l'acc√®s.  Ne vous inqui√©tez pas, recherchez simplement d'autres moyens de t√©l√©charger, en y consacrant du temps.  Et puis ils sont surpris que les dates de d√©veloppement des missiles soient retard√©es de plusieurs dizaines d'ann√©es ... J'ai commenc√© la correspondance avec ILV en novembre dernier, maintenant c'est en juin, sauf pour les d√©sabonnements - aucune action ... Mais j'ai √©t√© distrait. <br><br>  Comment utiliser les pilotes peut √™tre trouv√© dans le fichier readme, dans le package lui-m√™me.  Vous pouvez √©galement trouver le document <b>Guide d'installation des pilotes FTDI AN_220 pour Linux</b> .  Enfin, vous pouvez trouver sur YouTube une vid√©o du <b>Guide d'installation du pilote Linux d2xx</b> par FTDI Chips.  Un lien vers celui-ci se trouve √©galement sur la page de t√©l√©chargement du pilote.  En g√©n√©ral, FTDI n'a pas h√©sit√© sur les options d'information des utilisateurs.  En fait, si vous avez re√ßu un package Redd pr√™t √† l'emploi, les pilotes eux-m√™mes sont d√©j√† install√©s et configur√©s dessus.  Et nous serons int√©ress√©s par des fichiers d'en-t√™te et des exemples. <br><br>  Ins√©rons un exemple de tranche <b>\ release \ examples \ EEPROM \ read</b> .  Le tout d√©but de la fonction <b>principale</b> , o√π l'appareil s'ouvre et son type est pris.  Ce sera suffisant pour vous assurer que tout fonctionne.  Je d√©teste les √©tiquettes, mais comme nous glissons et d√©posons rapidement le code qui dure 10 minutes, je vais faire glisser l'√©tiquette qui √©tait dans l'exemple d'origine pour gagner du temps.  Il se pr√©sente comme ceci: <br><br><pre> <code class="plaintext hljs">#include &lt;cstdio&gt; #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;sys/time.h&gt; #include "ftd2xx.h" int main(int argc, char* argv[]) { printf("hello from ConsoleApplication1!\n"); FT_STATUS ftStatus; FT_HANDLE ftHandle0; int iport; static FT_PROGRAM_DATA Data; static FT_DEVICE ftDevice; DWORD libraryVersion = 0; int retCode = 0; ftStatus = FT_GetLibraryVersion(&amp;libraryVersion); if (ftStatus == FT_OK) { printf("Library version = 0x%x\n", (unsigned int)libraryVersion); } else { printf("Error reading library version.\n"); return 1; } if (argc &gt; 1) { sscanf(argv[1], "%d", &amp;iport); } else { iport = 0; } printf("Opening port %d\n", iport); ftStatus = FT_Open(iport, &amp;ftHandle0); if (ftStatus != FT_OK) { /* This can fail if the ftdi_sio driver is loaded use lsmod to check this and rmmod ftdi_sio to remove also rmmod usbserial */ printf("FT_Open(%d) failed\n", iport); return 1; } printf("FT_Open succeeded. Handle is %p\n", ftHandle0); ftStatus = FT_GetDeviceInfo(ftHandle0, &amp;ftDevice, NULL, NULL, NULL, NULL); if (ftStatus != FT_OK) { printf("FT_GetDeviceType FAILED!\n"); retCode = 1; goto exit; } printf("FT_GetDeviceInfo succeeded. Device is type %d.\n", (int)ftDevice); exit: return 0; }</code> </pre><br>  Essayer de collecter - ne va pas.  Pas assez de fichiers d'en-t√™te. <br><br><pre> <code class="plaintext hljs">1&gt;main.cpp 1&gt;D:\Work\SimpleConsole\SimpleConsole\main.cpp(5,20): error : ftd2xx.h:      1&gt;D:\Work\SimpleConsole\SimpleConsole\main.cpp(5,20): error : #include "ftd2xx.h" 1&gt;D:\Work\SimpleConsole\SimpleConsole\main.cpp(5,20): error : ^ 1&gt;D:\Work\SimpleConsole\SimpleConsole\main.cpp(5,20): error : compilation terminated.</code> </pre><br>  Mais je les mets ensuite!  Tout est simple.  Localement, ils sont √† proximit√©, mais le montage se fait √† distance.  Pour que le Studio les transf√®re sur une machine distante, vous devez les ajouter au projet.  De plus, √† partir du fichier <b>main.cpp</b> , j'ajoute uniquement <b>ftd2xx.h</b> , mais il <b>tire</b> toujours <b>WinTypes.h en transit</b> .  Vous devez ajouter les deux. <br><br><img src="https://habrastorage.org/webt/gy/-2/-j/gy-2-jt8ej_mbavcpupdsphb5g8.png"><br><br><img src="https://habrastorage.org/webt/kp/ye/l1/kpyel11pdcxgnd5ojt39rhkkslk.png"><br><br>  Maintenant, l'√©diteur de liens jure. <br><br><pre> <code class="plaintext hljs">1&gt;  1&gt;D:\Work\SimpleConsole\SimpleConsole\obj\x64\Debug\main.o : error : In function `main': 1&gt;D:\Work\SimpleConsole\SimpleConsole\main.cpp(18): error : undefined reference to `FT_GetLibraryVersion' 1&gt;D:\Work\SimpleConsole\SimpleConsole\main.cpp(37): error : undefined reference to `FT_Open' 1&gt;D:\Work\SimpleConsole\SimpleConsole\main.cpp(55): error : undefined reference to `FT_GetDeviceInfo' 1&gt;collect2 : error : ld returned 1 exit status</code> </pre><br>  Il est clair qu'il n'y a pas assez de biblioth√®que.  En inspectant les <b>makefiles de l'</b> exemple, j'ai r√©alis√© que je devais ajouter quelques param√®tres aux param√®tres de l'√©diteur de liens: <br><br><img src="https://habrastorage.org/webt/xy/zm/2i/xyzm2igciaxlmevvppuug4vk2go.png"><br><br><img src="https://habrastorage.org/webt/xd/p2/f1/xdp2f1nxqd3bue69dqx8m-dgabc.png"><br><br>  Maintenant, le projet se d√©roule avec succ√®s.  Nous avons mis un point d'arr√™t sur la derni√®re ligne, essayons de courir.  Nous voyons le texte suivant: <br><br><pre> <code class="plaintext hljs">hello from ConsoleApplication1! Library version = 0x10408 Opening port 0 FT_Open succeeded. Handle is 0x555555768540 FT_GetDeviceInfo succeeded. Device is type 10.</code> </pre><br>  Dans l'ensemble - pas mal.  Quelque chose s'est ouvert, m√™me un appareil a √©t√© trouv√©.  Qu'est-ce que le type 10?  Dans le fichier d'en-t√™te de FTDI, nous trouvons: <br><br><pre> <code class="plaintext hljs">enum { FT_DEVICE_BM, FT_DEVICE_AM, FT_DEVICE_100AX, FT_DEVICE_UNKNOWN, FT_DEVICE_2232C, FT_DEVICE_232R, FT_DEVICE_2232H, FT_DEVICE_4232H, FT_DEVICE_232H, FT_DEVICE_X_SERIES, FT_DEVICE_4222H_0, FT_DEVICE_4222H_1_2, FT_DEVICE_4222H_3, FT_DEVICE_4222_PROG, };</code> </pre><br>  Nous comptons le doigt de haut en bas - devant nous est le FT4222H.  Oui, Redd a beaucoup d'appareils FTDI.  Maintenant, je vais simplement dire bri√®vement que nous devons trier le num√©ro du p√©riph√©rique pass√© √† la fonction <b>FT_Open ()</b> , ce nombre est pass√© √† la fonction <b>main ()</b> comme argument.  Il peut √™tre d√©fini dans les propri√©t√©s de d√©bogage du projet. <br><br>  Il est utile de placer une plaque pr√©sentant des probl√®mes typiques.  G√©n√©ralement, il est indiqu√© ¬´configurer Redd¬ª partout sans d√©tails.  Le fait est que les complexes seront distribu√©s sur mesure, donc tous les lecteurs n'ont pas besoin de r√®gles de configuration.  En cas de probl√®me, les administrateurs s'occupent g√©n√©ralement de la configuration.  Il s'av√®re donc que vous pouvez, bien s√ªr, d√©crire les r√®gles de configuration, mais cela prendra beaucoup de place.  Il est logique de consacrer de l'√©nergie √† cela uniquement si quelqu'un en a vraiment besoin.  Alors ici, je me limiterai √† indiquer les probl√®mes et comment les r√©soudre, je d√©crirai s'il y a des applications dans les commentaires. <br><br><div class="scrollable-table"><table><tbody><tr><th>  Sympt√¥me </th><th>  Raison </th></tr><tr><td>  Pas un seul appareil ne s'ouvre. </td><td>  Par d√©faut, Linux n√©cessite des droits d'administrateur pour ouvrir des p√©riph√©riques USB, mais l'utilisateur qui se connecte pour le d√©bogage ne les poss√®de pas.  Vous devez configurer les ports afin qu'ils puissent √™tre utilis√©s par un utilisateur normal. </td></tr><tr><td>  Seuls quelques appareils s'ouvrent, les deux FT4222H. </td><td>  Par d√©faut, un pilote de port COM virtuel standard est install√© sur le contr√¥leur FT2232H.  Vous devez dire au syst√®me d'exploitation de ne pas le faire. </td></tr><tr><td>  Aucune biblioth√®que trouv√©e. </td><td>  Les pilotes D2XX ne sont pas install√©s sur le syst√®me d'exploitation du p√©riph√©rique Redd. </td></tr></tbody></table></div><br>  Super.  Nous sommes pr√™ts pour des r√©alisations utilisant exclusivement des outils Microsoft.  En g√©n√©ral, cela peut √™tre suffisant, mais juste au cas o√π, je vais vous parler d'une alternative que mon patron m'a apprise. <br><br><h2>  Travailler avec Linux ex√©cut√© sur une machine virtuelle </h2><br>  Le principal inconv√©nient de la m√©thode pr√©c√©dente est l'assemblage √† distance.  Vous pouvez penser √† mille et une raisons pour lesquelles l'assemblage doit √™tre fait localement, et seul le fichier binaire termin√© sera transf√©r√© vers la machine distante.  Ce sont toutes sortes de restrictions parano√Øaques (bien que les fichiers soient transf√©r√©s √† l'aide d'un protocole s√©curis√©, et vous pouvez s√©parer leur stockage des autres utilisateurs avec des politiques de s√©curit√©), c'est juste le soin que le lecteur Redd ne d√©borde pas de toutes sortes de biblioth√®ques, c'est aussi la r√©ticence √† enregistrer chaque fichier d'en-t√™te, s'il y en a des milliers ... Eh bien, et bien plus encore.  En g√©n√©ral, la technique d'assemblage local peut √™tre utile, alors pensez-y. <br><br>  Tout d'abord, nous avons plac√© le programme VirtualBox d'Oracle sur la machine locale.  S'il y a des probl√®mes de licence (je l'utilise gratuitement, en tant qu'individu, mais je ne sais pas exactement ce qui se passe avec les entit√©s juridiques), s√©lectionnez une machine physique distincte et mettez Linux √† cet endroit.  Lequel?  C‚Äôest plus facile pour moi, je les comprends tous de la m√™me fa√ßon.  Je veux dire, je ne comprends presque pas un.  Par cons√©quent, le patron m'a dit que vous devez utiliser Debian, j'ai install√© Debian.  Vous pouvez suivre le m√™me chemin (utilisez le principe ¬´Pourquoi pas?¬ª).  Au moins √† l'avenir, je compterai sur ma collaboration avec lui. <br><br>  Lorsque vous travaillez avec Linux, vous devez respecter deux r√®gles qui facilitent grandement la vie: <br><br><ol><li>  Si, en r√©ponse √† une commande, ils nous disent qu'il n'y a pas assez de droits, cela vaut la peine de le r√©p√©ter, en ajoutant au d√©but le sort magique <b>sudo</b> . </li><li>  Si en r√©ponse √† une commande, on nous dit qu'il n'en existe pas, cela vaut la peine d'essayer de l'installer en lan√ßant le sort magique <b>apt-get install &lt;chose manquante&gt;</b> . </li></ol><br>  Alors.  Nous venons d'installer le syst√®me d'exploitation.  Ajoutez imm√©diatement la prise en charge C ++ en installant le compilateur g ++, ainsi que le d√©bogueur gdb.  Comment?  Donc, en utilisant la r√®gle 2: <br><br>  <b>apt-get install g ++</b> <b><br></b>  <b>apt-get install gdb</b> <br><br>  Ne donnez pas?  Super!  R√©p√©tez en utilisant la r√®gle 1: <br><br>  <b>sudo apt-get install g ++</b> <b><br></b>  <b>sudo apt-get install gdb</b> <br><br>  Maintenant on va sur Internet, dans le moteur de recherche on tape: <br><br>  <b>IDE Eclipse</b> <br><br>  Nous trouvons un lien vers eclipse.org, o√π les premi√®res options sont pour Java, nous trouvons et t√©l√©chargeons une option pour C / C ++: <br><br><img src="https://habrastorage.org/webt/96/qw/qk/96qwqkb0litad1r1tujou2a9bae.png"><br><br>  T√©l√©chargez et d√©ballez, disons, √† la maison. <br><br>  En fait, aucune installation n'est requise.  Acc√©dez simplement au r√©pertoire o√π tout vient d'√™tre d√©compress√© et ex√©cutez le fichier eclipse: <br><br><img src="https://habrastorage.org/webt/ir/70/5r/ir705r0y6iwxnnixuxatl8ajg5m.png"><br><br>  Nous sommes dans un environnement de d√©veloppement.  Eh bien, si vous avez d√©j√† travaill√© avec des microcontr√¥leurs et m√™me des c≈ìurs de processeur pour FPGA, vous savez probablement d√©j√† ce qu'est Eclipse.  Les choses inconnues sont donc presque termin√©es.  Nous commen√ßons √† regarder autour de choses plus ou moins famili√®res.  Nous cr√©ons le projet C ++.  Je dois dire tout de suite qu'il y a deux fa√ßons.  L'un m√®nera au succ√®s, le second √† une impasse.  Par cons√©quent, suivez attentivement le chemin que je parcours: <br><br><img src="https://habrastorage.org/webt/pn/p2/am/pnp2amrhevvek40jz7nqsocol5g.png"><br><br><img src="https://habrastorage.org/webt/a_/ge/sx/a_gesxu9d6u_hhbocj0mqah5xik.png"><br><br><img src="https://habrastorage.org/webt/14/zg/b0/14zgb0day-st8r8cyejyvxahtsk.png"><br><br>  Nous avons cr√©√© un projet qui va bien.  Pour configurer son d√©bogage, acc√©dez aux propri√©t√©s GDB: <br><br><img src="https://habrastorage.org/webt/zd/zf/tz/zdzftzvpbfwkbs1mphkqdyrfv1a.png"><br><br>  Cr√©ez une configuration de type Application distante C / C ++, dans le groupe Connexion, cliquez sur Nouveau: <br><br><img src="https://habrastorage.org/webt/u1/dy/wb/u1dywbnrislxi82tujf7k3crbks.png"><br><br>  Choisissez une connexion comme SSH: <br><br><img src="https://habrastorage.org/webt/j8/nt/td/j8nttddgczes40njsbis01oamzi.png"><br><br>  Nous remplissons les propri√©t√©s de connexion en basculant le bouton radio du type d'autorisation sur l'autorisation de mot de passe: <br><br><img src="https://habrastorage.org/webt/i_/we/l1/i_wel1jpfgrjiale5pgsh7un8mg.png"><br><br>  En fait, le syst√®me est pr√™t pour le d√©bogage.  Apr√®s avoir v√©rifi√© que le texte de bienvenue est r√©ellement affich√©, nous essayons de transf√©rer le code de l'exemple pr√©c√©dent (qui √©tait dans Visual Studio) ici.  Pour enregistrer des biblioth√®ques suppl√©mentaires, s√©lectionnez les propri√©t√©s du projet: <br><br><img src="https://habrastorage.org/webt/9i/b0/7r/9ib07rvhf55tqf7hvkewqsqbqau.png"><br><br>  De plus, comme l'assembly se d√©roule localement, les biblioth√®ques doivent √©galement se trouver dans le r√©pertoire local usr / local / lib.  Je vous rappelle que les biblioth√®ques sont t√©l√©charg√©es avec le pilote, et comment les installer est lisez-moi, ainsi que les vid√©os AN220 et YouTube, pour plus de d√©tails, voir la section sur Visual Studio. <br><br>  Apr√®s toute cette pr√©paration, nous obtenons les lignes famili√®res.  C'est-√†-dire que le code compl√®tement identique √† celui consid√©r√© dans la section pr√©c√©dente est ex√©cut√© de la m√™me mani√®re. <br><br>  C‚Äôest tout.  Maintenant, selon la situation, nous pouvons ex√©cuter le code √† la fois via Visual Studio et via une machine virtuelle.  Comme vous pouvez le voir, purement en termes de param√®tres, Visual Studio est plus simple, donc, ceteris paribus, je vais le choisir.  Mais il vaut mieux poss√©der les deux technologies, car travailler √† travers le Studio a ses inconv√©nients li√©s au fait que non seulement le d√©bogage, mais aussi l'assemblage y sont distants. <br><br><h2>  Mesure de vitesse d'√©criture FPGA via FT2232H </h2><br>  Eh bien quoi.  Fixons les comp√©tences acquises sur un projet plus ou moins r√©el.  Bien s√ªr, commencer quelque chose de tr√®s s√©rieux n'est plus possible, tout le monde est d√©j√† fatigu√©.  Mais nous obtenons un r√©sultat plus ou moins pratique.  Par exemple, nous mesurons √† quelle vitesse maximale nous pouvons transf√©rer des donn√©es vers le FPGA via la puce FT2232H.  Le protocole n‚Äôest pas le plus simple, donc nous ne le transmettrons pas des deux c√¥t√©s, mais nous nous limiterons √† transmettre de nous au canal, √† l‚Äôautre extr√©mit√© o√π le FPGA est install√©.  Le document <b>AN_130 FT2232H utilis√© dans un mode FIFO synchrone de style FT245</b> nous y aidera, car dans le complexe le contr√¥leur est activ√© pr√©cis√©ment dans ce mode (FIFO synchrone).  Ce document contient √©galement une description des conclusions, sous la forme dans laquelle elles sont utilis√©es dans ce mode, et des chronogrammes, et m√™me des exemples de code, dont nous nous inspirerons. <br><br>  Alors.  Nous voulons enregistrer en FIFO en utilisant le contr√¥leur.  Qu'adviendra-t-il de nous?  J'ai essay√©, je sais.  Cela prendra 1 kilo-octet de donn√©es, apr√®s quoi le contr√¥leur se bloquera.  Il refusera d'accepter des donn√©es suppl√©mentaires.  Le fait est qu'un kilo-octet est la taille de son tampon interne.  Bien que cela soit possible, les donn√©es seront prises √† partir de l'USB et stock√©es dans cet espace.  Mais pour qu'ils se rendent sur le canal synchrone, il doit informer de leur disponibilit√© √† les recevoir.  Nous regardons le fortune de fortune correspondant. <br><br><img src="https://habrastorage.org/webt/qq/9x/lj/qq9xljp4ma4jlpcprp5emofdraa.png"><br><br>  Alors.  Lorsque le contr√¥leur a des donn√©es en FIFO, il supprime le signal RXF.  En r√©ponse √† cela, nous devons d'abord supprimer le signal OE et le maintenir √† z√©ro pendant au moins un cycle d'horloge (cela d√©coule plus de la description du diagramme que du diagramme lui-m√™me).  Nous recevrons des donn√©es sur le bus, nous devons confirmer leur r√©ception avec un faible niveau de signal RD.  Et donc - pour l'ensemble du cadre.  Lorsque le contr√¥leur soul√®ve la ligne RXF, nous devons supprimer l'OE et le RD.  Nous n'utiliserons pas les donn√©es aujourd'hui.  Pour mesurer la vitesse, simulez simplement la r√©ception de donn√©es sur le FPGA du FT2232H.  Eh bien.  Pour une op√©ration aussi simple, aucun syst√®me de processeur n'est n√©cessaire.  Il suffit de faire un automate d√©g√©n√©r√©, dont le d√©veloppement prendra beaucoup moins de temps que de s'occuper de la pr√©paration du processeur et du programme.  Par cons√©quent, nous cr√©ons un projet contenant un seul fichier SystemVerilog avec le contenu suivant: <br><br><pre> <code class="plaintext hljs">module JustRead( input logic clk, input logic rxf_n, output logic oe_n, output logic rd_n ); enum {IDLE,TRANSFER} state = IDLE; always @ (posedge clk) begin oe_n &lt;= 1; rd_n &lt;= 1; case (state) IDLE: begin if (rxf_n == 0) begin oe_n &lt;= 0; state &lt;= TRANSFER; end end TRANSFER: begin if (rxf_n == 0) begin oe_n &lt;= 0; rd_n &lt;= 0; end else begin state &lt;= IDLE; end end endcase end endmodule</code> </pre><br>  La machine a deux √©tats.  Dans ce cas, la dur√©e du signal OE est d√©termin√©e par le fait qu'il est arm√© imm√©diatement apr√®s l'impulsion d'horloge et est maintenu jusqu'√† la suivante.  Cela peut √™tre v√©rifi√© en utilisant le mod√®le suivant: <br><br><pre> <code class="plaintext hljs">module JustReadTB( output logic clk, output logic rxf_n, input logic oe_n, input logic rd_n ); JustRead dut ( .clk, .rxf_n, .oe_n, .rd_n ); always begin clk = 1; #16; clk = 0; #16; end initial begin rxf_n = 1; #120; rxf_n = 0; #120; rxf_n = 1; end endmodule</code> </pre><br>  Le temps que j'ai pris est le premier disponible, c'est la s√©quence de commutation qui est attach√©e au signal d'horloge qui est importante.  Nous obtenons le chronogramme suivant: <br><br> <a href=""><img src="https://habrastorage.org/webt/ps/kw/jw/pskwjww-komvozbyogvdndsukq8.png"></a> <br><br>  En premi√®re approximation, cela correspond √† ce que requiert le document.  Mais nous ne traiterons pas les donn√©es r√©elles de toute fa√ßon. <br><br>  L'affectation des jambes FPGA dans ce projet ne pose pas non plus de difficult√©s, m√™me pour l'√©dition via une table (il faudra plus de temps pour transf√©rer les affectations √† partir du fichier * .QSF, et je souligne constamment que lors du d√©veloppement de syst√®mes d'un jour sous Redd, gagner du temps est une priorit√©). <br><br><img src="https://habrastorage.org/webt/kp/8s/wq/kp8swq3ni8n0x02znmnexvjpfsk.png"><br><br>  Nous collectons, remplissons, avant de couper l'alimentation du complexe, vous pouvez travailler avec le programme, il ne se bloquera plus apr√®s un d√©bordement de tampon. <br><br>  Dans le programme, j'ai fait deux fonctions.  Le premier recherche et ouvre l'appareil.  J'ai pris quelque chose du dernier test, j'ai emprunt√© quelque chose √† <b>AN130</b> : <br><br><pre> <code class="plaintext hljs">FT_HANDLE OpenFT2232H() { FT_HANDLE ftHandle0; static FT_DEVICE ftDevice; //      int nDevice = 0; while (true) { //     if (FT_Open(nDevice, &amp;ftHandle0) != FT_OK) { //  ,      return 0; } //     ? if (FT_GetDeviceInfo(ftHandle0, &amp;ftDevice, NULL, NULL, NULL, NULL) == FT_OK) { // ,    if (ftDevice == FT_DEVICE_2232H) { // ,     AN130 FT_SetBitMode(ftHandle0, 0xff, 0x00); usleep(1000000); //Sync FIFO mode FT_SetBitMode(ftHandle0, 0xff, 0x40); FT_SetLatencyTimer(ftHandle0, 2); FT_SetUSBParameters(ftHandle0, maxBlockSize, maxBlockSize); return ftHandle0; } } //    FT_Close(ftHandle0); //    nDevice += 1; } }</code> </pre><br>  En tant que fan de Windows, j'ai d√ª √©crire la fonction de mesure de vitesse, en v√©rifiant constamment Internet, car j'utilise g√©n√©ralement les minuteries haute r√©solution classiques de l'API WIN32.  Vous pouvez peut-√™tre √©crire plus efficacement, mais il s'agit d'un programme d'une journ√©e. <br><br><pre> <code class="plaintext hljs">const int maxBlockSize = 0x100000; uint8_t buf[maxBlockSize]; ‚Ä¶ //   BlockSize ,  1 double TestSpeed(FT_HANDLE ftHandle0,int totalSize, int blockSize) { if (blockSize &gt; maxBlockSize) { return -1; } DWORD dwWrittenTotal = 0; timespec before; clock_gettime(CLOCK_REALTIME, &amp;before); for (int i = 0; i &lt; totalSize; i += blockSize) { DWORD dwWritten; FT_Write(ftHandle0, buf, blockSize, &amp;dwWritten); //     dwWrittenTotal += dwWritten; } timespec after; clock_gettime(CLOCK_REALTIME, &amp;after); if (dwWrittenTotal &lt; (DWORD)totalSize) { return -2; } //     uint64_t nsBefore = before.tv_nsec; uint64_t nsAfter = after.tv_nsec; //      nsAfter += (after.tv_sec - before.tv_sec) * 1000000000; //   nsAfter -= nsBefore; //      double res = ((double)nsAfter)/((double)1000000000); //   -    return ((double)dwWrittenTotal) / res; }</code> </pre><br>  Eh bien, le code qui ex√©cute la fonctionnalit√© de base s'est av√©r√© comme ceci: <br><br><pre> <code class="plaintext hljs">int main(int argc, char* argv[]) { FT_HANDLE ftHandle0 = OpenFT2232H(); if (ftHandle0 == 0) { printf("Cannot open device\n"); return -1; } const int totalSize = 0x100000; static const int blockSizes[] = { 0x10,0x20,0x40,0x80,0x100,0x200,0x400,0x800,0x1000,0x2000, 0x4000,0x8000,0x10000,0x20000,0x40000,0x80000,0 }; for (int i = 0; blockSizes[i] != 0; i++) { double speed = TestSpeed(ftHandle0, totalSize, blockSizes[i]); printf("%d,%d\n", blockSizes[i], (int)(speed/1000.)); int stop = 0; } // ,    FT_Close(ftHandle0); return 0; }</code> </pre><br>  Je sais qu'en USB, la vitesse d√©pend fortement de la taille du bloc envoy√©, donc je v√©rifie la vitesse pour diff√©rentes options.  L'√©num√©ration lin√©aire n'est gu√®re n√©cessaire.  Je viens de vous pr√©senter une liste de tailles typiques.  Je produis les donn√©es en kilo-octets par seconde.  Les octets sont inconfortables pour les yeux, les m√©gaoctets ont une faible r√©solution avec une petite taille de bloc.  Les kilo-octets par seconde sont un compromis raisonnable.  Nous obtenons les r√©sultats suivants: <br><pre> <code class="plaintext hljs">16,59 32,110 64,237 128,490 256,932 512,1974 1024,3760 2048,5594 4096,10729 8192,16109 16384,20170 32768,24248 65536,26664 131072,28583 262144,29370 524288,29832</code> </pre><br>  Nous les enregistrons dans un fichier * .csv, les chargeons dans Excel, construisons un graphique de la vitesse en fonction de la taille du bloc. <br><br><img src="https://habrastorage.org/webt/_o/ep/xe/_oepxe_wz65g7otcfeo3qete8xa.png"><br><br>  La limite est de 30 m√©gaoctets par seconde.  Jusqu'√† un maximum th√©orique de 52 Mo / s.  Peut-√™tre pouvez-vous acc√©l√©rer d'une mani√®re ou d'une autre, mais laissez-le aux lecteurs sous forme de travaux pratiques.  L'essentiel est que nous ma√Ætrisions toutes les √©tapes de l'utilisation du canal et sommes pr√™ts √† connecter le FPGA au processeur central en un seul syst√®me. <br><br>  Pendant la <b>compilation de</b> l'article, le document <b>AN_165 a</b> √©t√© trouv√©, indiquant que la vitesse maximale en mode FIFO synchrone √©tait de 35 Mo / s.  Autrement dit, l'espace pour la croissance - jusqu'√† une taille donn√©e.  Mais il est toujours l√†. <br><br><h2>  Conclusion </h2><br>  Nous nous sommes familiaris√©s avec deux strat√©gies de d√©veloppement et de d√©bogage de code programme ex√©cut√©es sur le processeur central du complexe Redd (√† l'aide des outils Microsoft Visual Studio et sur une machine virtuelle avec Linux OS).  Nous avons √©galement acquis des comp√©tences pratiques en travaillant avec le canal par lequel le processeur central du complexe communique avec le FPGA. <br><br>  Apparemment, maintenant rien ne nous emp√™che de transmettre des donn√©es significatives du CPU au FPGA et vice versa (bien que dans le dernier article j'ai √©crit ces mots). <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un exemple contenant le ¬´firmware¬ª le plus simple pour les FPGA et un programme qui mesure la vitesse d'√©criture sur USB peut √™tre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t√©l√©charg√© ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr456008/">https://habr.com/ru/post/fr456008/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr455996/index.html">Transformation num√©rique de la publicit√© dans le r√©seau de vente au d√©tail. Sur les traces de l'analytique vid√©o dans le commerce de d√©tail</a></li>
<li><a href="../fr456000/index.html">Cr√©ation d'un jeu Tic-Tac-Toe avec TypeScript, React et Mocha</a></li>
<li><a href="../fr456002/index.html">M√©moire d√©di√©e au foyer et intervention OOM Killer</a></li>
<li><a href="../fr456004/index.html">Nous vous invitons √† une r√©union de d√©veloppement front-end dans des services tr√®s charg√©s</a></li>
<li><a href="../fr456006/index.html">Augmentez vos revenus gr√¢ce aux achats int√©gr√©s</a></li>
<li><a href="../fr456010/index.html">Comment Java 10 change la fa√ßon dont vous utilisez les classes internes anonymes</a></li>
<li><a href="../fr456016/index.html">Protocole de communication entre iframe et la fen√™tre principale</a></li>
<li><a href="../fr456020/index.html">Se pr√©parer √† conqu√©rir le monde</a></li>
<li><a href="../fr456024/index.html">PHP 2019: mieux que vous ne le pensez</a></li>
<li><a href="../fr456026/index.html">Face √† face NeoQUEST-2019: abattez des drones et cr√©ez un VirusTotal de poche</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>