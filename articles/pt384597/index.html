<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëπ üêΩ üíì Medi√ß√£o de eletricidade. Parte 1. Medi√ß√£o de tens√£o e corrente üéß üëäüèº üë®‚Äçüë®‚Äçüë¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introdu√ß√£o
 Ol√° a todos! Ap√≥s o t√©rmino do ciclo nos sensores, havia perguntas de um plano diferente para medir os par√¢metros de consumo de aparelhos ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Medi√ß√£o de eletricidade. Parte 1. Medi√ß√£o de tens√£o e corrente</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/384597/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/files/4df/1f8/1cd/4df1f81cd86c4e2a8f5afa1441fb88e5.jpg" alt="imagem" align="left"></a><br>
<h4><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introdu√ß√£o</font></font></b></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ol√° a todos! </font><font style="vertical-align: inherit;">Ap√≥s o t√©rmino do ciclo nos sensores, havia perguntas de um plano diferente para medir os par√¢metros de consumo de aparelhos dom√©sticos e n√£o muito el√©tricos. </font><font style="vertical-align: inherit;">Quem consome quanto, como conectar o que medir, quais sutilezas acontecem e assim por diante. </font><font style="vertical-align: inherit;">√â hora de revelar todas as cartas nesta √°rea. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesta s√©rie de artigos, consideraremos o t√≥pico de medi√ß√£o dos par√¢metros de eletricidade. </font><font style="vertical-align: inherit;">Esses par√¢metros s√£o na verdade um n√∫mero muito grande, que tentarei contar gradualmente em pequenas s√©ries. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At√© agora, os planos s√£o tr√™s s√©ries:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medi√ß√£o de eletricidade. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A qualidade da eletricidade.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dispositivos para medir os par√¢metros de eletricidade.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No processo de an√°lise, resolveremos certos problemas pr√°ticos nos microcontroladores at√© que um resultado seja alcan√ßado. </font><font style="vertical-align: inherit;">Obviamente, a maior parte desse ciclo ser√° dedicada √† medi√ß√£o da tens√£o CA e pode ser √∫til para todos os ventiladores para controlar os aparelhos el√©tricos de sua casa inteligente. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com base nos resultados de todo o ciclo, fabricaremos um certo medidor el√©trico inteligente com acesso √† Internet. </font><font style="vertical-align: inherit;">Ventiladores muito not√≥rios para controlar os aparelhos el√©tricos de sua casa inteligente podem fornecer toda a assist√™ncia poss√≠vel na implementa√ß√£o da parte de comunica√ß√£o com base, por exemplo, no MajorDomo. </font><font style="vertical-align: inherit;">Vamos tornar o OpenSource uma casa inteligente melhor, por assim dizer. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesta s√©rie, em duas partes, discutiremos as seguintes perguntas:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conex√£o de sensores de corrente e tens√£o em dispositivos CC, bem como circuitos CA monof√°sicos e trif√°sicos;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medi√ß√£o de valores de corrente de corrente e tens√£o;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medi√ß√£o do fator de pot√™ncia;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pot√™ncia plena, ativa e reativa;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consumo de energia;</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao abordar, voc√™ encontrar√° respostas para as duas primeiras perguntas desta lista. </font><font style="vertical-align: inherit;">Eu deliberadamente n√£o ligo para as quest√µes de precis√£o dos indicadores de medi√ß√£o e, a partir desta s√©rie, estou satisfeito apenas com os resultados obtidos com a precis√£o de sapatos de mais ou menos bast. </font><font style="vertical-align: inherit;">Certamente dedicarei um artigo separado a esta edi√ß√£o na terceira s√©rie.</font></font><br>
<a name="habracut"></a><br>
<h4><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Conex√£o de sensores</font></font></b></h4><br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.youtube.com/embed/ueE-XPjVkRY%3Ffeature%3Doembed&amp;usg=ALkJrhjcB4OrRIqymB2crjbcwNN64x4PKw" frameborder="0" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na √∫ltima s√©rie sobre sensores de tens√£o e corrente, falei sobre os tipos de sensores, mas n√£o falei sobre como us√°-los e onde coloc√°-los. </font><font style="vertical-align: inherit;">Est√° na hora de consertar</font></font><br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conex√£o de sensores DC</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â claro que todo o ciclo ser√° dedicado a sistemas de corrente alternada, mas tamb√©m passaremos rapidamente pelos circuitos de corrente cont√≠nua, pois isso pode nos ser √∫til no desenvolvimento de fontes de alimenta√ß√£o de corrente cont√≠nua. Tomemos, por exemplo, um </font><i><font style="vertical-align: inherit;">conversor buck </font></i></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cl√°ssico </font><font style="vertical-align: inherit;">: </font></font><br>
<img src="https://habrastorage.org/files/d35/255/0f2/d352550f2c04401ea57bcda120ee3790.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 1. Um conversor buck PWM</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nosso objetivo √© fornecer uma tens√£o de sa√≠da est√°vel. Al√©m disso, com base nas informa√ß√µes do sensor de corrente, √© poss√≠vel controlar o modo de opera√ß√£o do indutor L1, impedindo sua satura√ß√£o, e tamb√©m implementar a prote√ß√£o de corrente do conversor. E, francamente, n√£o h√° op√ß√µes espec√≠ficas para a instala√ß√£o de sensores.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um sensor de tens√£o na forma de um divisor resistivo R1-R2, que √© o √∫nico capaz de trabalhar com corrente direta, √© instalado na sa√≠da do conversor. Como regra, um microcircuito conversor especializado tem uma entrada de realimenta√ß√£o e faz todos os esfor√ßos para garantir que nessa entrada (3) exista um certo n√≠vel de tens√£o prescrito na documenta√ß√£o para o microcircuito. Por exemplo, 1,25V. Se nossa tens√£o de sa√≠da corresponder a esse n√≠vel - tudo est√° bem -, aplicaremos diretamente a tens√£o de sa√≠da nessa entrada. Caso contr√°rio, defina o divisor. Se precisarmos fornecer uma tens√£o de sa√≠da de 5V, o divisor deve fornecer um fator de divis√£o de 4, ou seja, por exemplo, R1 = 30k, R2 = 10k.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um sensor de corrente geralmente √© instalado entre a fonte de energia e o conversor e no chip. A partir da diferen√ßa de potencial entre os pontos 1 e 2, e com uma resist√™ncia conhecida, os resistores Rs podem determinar o valor atual da corrente do nosso indutor. Instalar um sensor de corrente entre as fontes e a carga n√£o √© uma boa ideia, pois o capacitor do filtro ser√° cortado pelo resistor pelos consumidores de correntes pulsadas. Instalar um resistor na abertura do fio comum tamb√©m n√£o promete nada de bom - haver√° dois n√≠veis de terra com os quais ainda √© divertido mexer. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os problemas de queda de tens√£o podem ser evitados usando sensores de corrente sem contato - por exemplo, sensores hall: </font></font><br>
<img src="https://habrastorage.org/files/90c/b6b/1e2/90cb6b1e298b4d408bd27d971218781e.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 2. Sensor de corrente sem contato</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, existe uma maneira mais complicada de medir a corrente. Afinal, a tens√£o tamb√©m cai no transistor e a mesma corrente flui como a indut√¢ncia atrav√©s dele. Portanto, pela queda de tens√£o atrav√©s dela, voc√™ tamb√©m pode determinar o valor atual da corrente. Honestamente, se voc√™ observar a estrutura interna dos circuitos conversores, por exemplo, da Texas Instruments, esse m√©todo √© encontrado com a mesma frequ√™ncia que os anteriores. A precis√£o desse m√©todo certamente n√£o √© a mais alta, mas isso √© suficiente para o corte atual funcionar. </font></font><br>
<img src="https://habrastorage.org/files/2fd/ecb/bab/2fdecbbab26c483ea476483e32e2a0c9.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 3. Transistor como um sensor de corrente N√≥s fazemos o</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
mesmo em outros circuitos de conversores similares, seja aumentando ou invertendo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, √© necess√°rio mencionar separadamente os conversores lineares e flyback do transformador.</font></font><br>
<img src="https://habrastorage.org/files/1d7/ebd/4b1/1d7ebd4b13214a919014f35a8a672b24.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 4. Conex√£o dos sensores de corrente nos conversores flyback.Eles</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
tamb√©m podem usar resist√™ncia externa ou um transistor em sua fun√ß√£o. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com isso, conectamos os sensores aos conversores DC / DC. </font><font style="vertical-align: inherit;">Se voc√™ tiver sugest√µes para outras op√ß√µes, terei prazer em adicionar um artigo a elas.</font></font><br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2 Conex√£o de sensores a circuitos CA monof√°sicos</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos circuitos CA, temos uma sele√ß√£o muito maior de poss√≠veis sensores. </font><font style="vertical-align: inherit;">Vamos considerar v√°rias op√ß√µes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mais simples √© o uso de um divisor de tens√£o resistivo e deriva√ß√£o de corrente. </font></font><br>
<img src="https://habrastorage.org/files/458/c52/e43/458c52e436ac451d96927f6d3a14d772.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 5. Conex√£o dos sensores do resistor</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
No entanto, ela tem algumas desvantagens significativas:</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiramente, forneceremos uma amplitude significativa do sinal da deriva√ß√£o atual, alocando uma grande quantidade de energia nele, ou ficaremos satisfeitos com a pequena amplitude do sinal e posteriormente o amplificaremos. E segundo, o resistor cria uma diferen√ßa potencial entre o neutro da rede e o neutro do dispositivo. Se o dispositivo estiver isolado, n√£o importa, se ele tiver um terminal de aterramento, correremos o risco de permanecer sem sinal do sensor de corrente, pois o curto-circuito. Talvez voc√™ deva tentar sensores que funcionem com outros princ√≠pios.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, usamos transformadores de corrente e tens√£o, ou um sensor de corrente de efeito Hall e um transformador de tens√£o. </font><font style="vertical-align: inherit;">Aqui, h√° muito mais oportunidades para trabalhar com equipamentos, uma vez que o fio neutro n√£o tem perdas e, o mais importante - em ambos os casos, h√° isolamento galv√¢nico do equipamento de medi√ß√£o, o que geralmente pode ser √∫til. </font><font style="vertical-align: inherit;">No entanto, deve-se ter em mente que os sensores de corrente e tens√£o do transformador t√™m uma resposta de frequ√™ncia limitada e, se quisermos medir a composi√ß√£o harm√¥nica das distor√ß√µes, isso n√£o √© um fato que funcionar√°. </font></font><br>
<img src="https://habrastorage.org/files/b59/304/c28/b59304c2821d45ef87501f76acfa232a.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 6. Conex√£o do transformador e dos sensores de corrente e tens√£o sem contato</font></font></i><br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.3 Conex√£o de sensores a circuitos CA multif√°sicos</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em redes multif√°sicas, nossa capacidade de conectar sensores de corrente √© um pouco menor. Isso se deve ao fato de que a deriva√ß√£o de corrente n√£o pode ser usada, uma vez que a diferen√ßa de potencial entre as deriva√ß√µes de fase varia dentro de centenas de volts e eu n√£o conhe√ßo nenhum controlador de uso geral cujas entradas anal√≥gicas possam suportar essa zombaria. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, h√° uma maneira de usar deriva√ß√µes de corrente - para cada canal √© necess√°rio fazer uma entrada anal√≥gica galvanicamente isolada. Mas √© muito mais f√°cil e confi√°vel usar outros sensores. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No meu analisador de qualidade, uso divisores de tens√£o resistivos e sensores de corrente de efeito de hall remotos. </font></font><br>
<img src="https://habrastorage.org/files/3e5/d90/547/3e5d90547af64b41a48bcfe42ee82429.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 7 Sensores de corrente em uma rede trif√°sica</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como pode ser visto na figura, usamos uma conex√£o de quatro fios. </font><font style="vertical-align: inherit;">Obviamente, em vez de sensores de corrente no efeito hall, voc√™ pode usar transformadores de corrente ou loops de Rogowski. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em vez de divisores resistivos, podem ser usados ‚Äã‚Äãtransformadores de tens√£o, tanto para um sistema de quatro e tr√™s fios. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste √∫ltimo caso, os enrolamentos prim√°rios dos transformadores de tens√£o s√£o conectados por um tri√¢ngulo e o secund√°rio por uma estrela, cujo ponto comum √© o ponto comum do circuito de medi√ß√£o </font></font><br>
<img src="https://habrastorage.org/files/e4d/100/cf4/e4d100cf4d3048338dd15cacdb92a373.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Fig. 8. Utilizando transformadores de tens√£o em uma rede trif√°sica</font></font></i><br>
<h4><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 Valor atual da tens√£o e corrente</font></font></b></h4><br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.youtube.com/embed/TOaW9xvr8NE%3Ffeature%3Doembed&amp;usg=ALkJrhgp_zQOkDmuh4i7DdKz-vFxy6l0zg" frameborder="0" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chegou a hora de resolver o problema de medir nossos sinais. O significado pr√°tico para n√≥s √© principalmente o valor atual da corrente e da tens√£o. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deixe-me lembr√°-lo do material do ciclo do sensor. Usando o ADC do nosso microcontrolador em intervalos regulares, fixaremos o valor instant√¢neo da tens√£o. Assim, durante o per√≠odo de medi√ß√£o, teremos uma matriz de dados do n√≠vel do valor instant√¢neo da tens√£o (para a corrente, tudo √© semelhante). </font></font><br>
<img src="https://habrastorage.org/files/f70/ca7/063/f70ca706313a41a784c27c270cbd6eb2.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 9. Uma s√©rie de valores instant√¢neos de tens√£o</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nossa tarefa √© calcular o valor efetivo. Para come√ßar, usamos a f√≥rmula integral: </font></font><br>
<img src="https://habrastorage.org/files/417/546/27d/41754627def647e89dce0c4037146eba.gif"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(1) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em um sistema digital, temos que nos limitar a um certo quantum de tempo, ent√£o vamos √† soma: </font></font><br>
<img src="https://habrastorage.org/files/17c/f0a/b23/17cf0ab2355a4a86a67504036f331c6b.gif"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(2) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Onde </font></font><img src="https://habrastorage.org/files/c7c/ac5/dec/c7cac5dece7f4d03b262ad4c8ad30317.gif"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est√° o per√≠odo de amostragem do nosso sinal e</font></font><img src="https://habrastorage.org/files/289/63f/958/28963f958bf74b1888aeef21b047c567.gif"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- o n√∫mero de amostras para o per√≠odo de medi√ß√£o. Em algum lugar aqui, em um v√≠deo, come√ßo a esfregar o jogo sobre a igualdade de √°reas. Eu tive que dormir naquele dia. =) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos microcontroladores MSP430FE4252, usados ‚Äã‚Äãem medidores el√©tricos Mercury monof√°sicos, s√£o realizadas 4096 leituras por um per√≠odo de medi√ß√£o de 1, 2 ou 4 segundos. Em T = 1s e N = 4096, contaremos ainda mais. Al√©m disso, 4096 pontos por segundo nos permitir√° usar algoritmos de transforma√ß√£o r√°pida de Fourier para determinar o espectro harm√¥nico de at√© 40 harm√¥nicos, conforme exigido pelo GOST. Mas mais sobre isso na pr√≥xima s√©rie.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√≥s descrevemos o algoritmo para o nosso programa. Precisamos garantir um in√≠cio est√°vel do ADC a cada 1/8192 segundos, pois temos dois canais e mediremos esses dados alternadamente. Para isso, configure o temporizador e o sinal de interrup√ß√£o reiniciar√° automaticamente o ADC. Todos os ADCs fazem isso. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Escreveremos o futuro programa no arduino, como muitos o t√™m em m√£os. At√© agora, temos um interesse puramente acad√™mico. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tendo uma frequ√™ncia de quartzo do sistema de 16 MHz e um timer de 8 bits (para que a vida n√£o pare√ßa mel), precisamos garantir a frequ√™ncia de opera√ß√£o de qualquer interrup√ß√£o do timer com uma frequ√™ncia de 8192 Hz. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estamos tristes com o fato de que 16 MHz n√£o est√° completamente dividido conforme a necessidade e a frequ√™ncia final do temporizador √© 8198 Hz. Fechamos os olhos para um erro de 0,04% e ainda lemos 4096 amostras por canal.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lamentamos que a interrup√ß√£o de estouro no arduino esteja ocupada calculando o tempo (√© respons√°vel por milis e atrasos, portanto isso ir√° parar de funcionar normalmente), por isso usamos a interrup√ß√£o em compara√ß√£o. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E de repente percebemos que o sinal chega at√© n√≥s bipolar e que o msp430fe4252 lida com ele perfeitamente. Estamos satisfeitos com um ADC unipolar, portanto, montamos um conversor simples de um sinal bipolar em um unipolar em um amplificador operacional: </font></font><br>
<img src="https://habrastorage.org/files/18f/0dd/c20/18f0ddc202544b24be6d684ce9d98c23.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 10. Conversor de um sinal bipolar em um unipolar</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Al√©m disso, nossa tarefa √© garantir que o nosso senoide oscile em rela√ß√£o √† metade da tens√£o de refer√™ncia - subtrairemos metade da faixa ou ativaremos a op√ß√£o nas configura√ß√µes do ADC e obtenha os valores dos sinais.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como o Arduino possui um ADC de 10 bits, subtra√≠mos metade do resultado n√£o assinado entre 0 e 1023 e obtemos -512-511. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verificamos o modelo montado no LTSpiceIV e garantimos que tudo funcione como deveria. </font><font style="vertical-align: inherit;">No material de v√≠deo, tamb√©m verificamos experimentalmente. </font></font><br>
<img src="https://habrastorage.org/files/3de/320/1f6/3de3201f66f94937b29504236ded1044.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 11. Resultado da simula√ß√£o. </font><font style="vertical-align: inherit;">Verde √© o sinal original, azul √© a sa√≠da</font></font></i><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esbo√ßo para Arduino para um canal</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{<font></font>
  autoadcsetup();<font></font>
  DDRD |=(<span class="hljs-number">1</span>&lt;&lt;PD2)|(<span class="hljs-number">1</span>&lt;&lt;PD3);<font></font>
  Serial.begin(<span class="hljs-number">38400</span>);<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">double</span> urms = <span class="hljs-number">0</span>;
<span class="hljs-keyword">double</span> utemp = <span class="hljs-number">0</span>;
<span class="hljs-keyword">int</span> umoment = <span class="hljs-number">0</span>;
<span class="hljs-keyword">int</span> N = <span class="hljs-number">0</span>;
<span class="hljs-keyword">int</span> flag = <span class="hljs-number">0</span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">if</span> (flag){<font></font>
    flag = <span class="hljs-number">0</span>;<font></font>
    Serial.println(urms);<font></font>
  }<font></font>
}<font></font>
<span class="hljs-keyword">int</span> i = <span class="hljs-number">255</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">autoadcsetup</span><span class="hljs-params">()</span></span>{
  <span class="hljs-comment">//set up TIMER0 to  4096Hz</span>
  <span class="hljs-comment">//TIMER0_OVF will be the trigger for ADC</span>
  <span class="hljs-comment">/*normal mode, prescaler 16
   16MHz / 64 / 61 = 4098 Hz 0.04% to 4096Hz*/</span>
  TCCR0B = (<span class="hljs-number">1</span> &lt;&lt; CS01)|(<span class="hljs-number">1</span> &lt;&lt; CS00);<span class="hljs-comment">//timer frequency = clk/64</span>
  OCR0A = <span class="hljs-number">60</span>;<span class="hljs-comment">//61-1</span>
  TIMSK0 = (<span class="hljs-number">1</span>&lt;&lt;OCIE0A);
  <span class="hljs-comment">//set ADC.</span>
  ADMUX =  (<span class="hljs-number">1</span> &lt;&lt; REFS0);<span class="hljs-comment">//8-bit mode, ADC0 channel, AVVCC as ref</span>
  ADCSRA = (<span class="hljs-number">1</span> &lt;&lt; ADEN) | (<span class="hljs-number">1</span> &lt;&lt; ADATE) | (<span class="hljs-number">1</span> &lt;&lt; ADIE) | (<span class="hljs-number">1</span> &lt;&lt; ADPS2);<span class="hljs-comment">//TUrn ADC On, trigger enable, Interrupt enable, sysclk/16=1MHz_ADC_clk=76kHz conv freq(13ticks per conversion)</span>
  ADCSRB = (<span class="hljs-number">1</span>&lt;&lt; ADTS1) | (<span class="hljs-number">1</span>&lt;&lt;ADTS0) | (<span class="hljs-number">1</span>&lt;&lt;MUX5);<span class="hljs-comment">//Auto trigger source</span><font></font>
}<font></font>
<font></font>
ISR(TIMER0_COMPA_vect){<font></font>
  <span class="hljs-keyword">if</span> (PIND &amp; (<span class="hljs-number">1</span>&lt;&lt;PD2)){<font></font>
    PORTD &amp;= ~(<span class="hljs-number">1</span>&lt;&lt;PD2);<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span>{<font></font>
    PORTD |=(<span class="hljs-number">1</span>&lt;&lt;PD2);<font></font>
  }<font></font>
  TCNT0 = <span class="hljs-number">0</span>;<font></font>
<font></font>
}<font></font>
<font></font>
<font></font>
ISR(ADC_vect){<font></font>
<font></font>
  <span class="hljs-keyword">if</span>( ( UCSR0A &amp; (<span class="hljs-number">1</span>&lt;&lt;UDRE0)) ){<font></font>
    umoment = ADCL;<span class="hljs-comment">//copy result.</span>
    umoment += (ADCH&lt;&lt;<span class="hljs-number">8</span>);<font></font>
    umoment = umoment - <span class="hljs-number">512</span>;<font></font>
    utemp = utemp + <span class="hljs-built_in">pow</span>((<span class="hljs-keyword">double</span>)(umoment),<span class="hljs-number">2</span>)/<span class="hljs-number">4096</span>;<font></font>
    N++;<font></font>
    <span class="hljs-keyword">if</span> (N == <span class="hljs-number">4095</span>){<font></font>
      urms = <span class="hljs-built_in">sqrt</span>(utemp)/<span class="hljs-number">102</span>;<font></font>
      N = <span class="hljs-number">0</span>;<font></font>
      utemp = <span class="hljs-number">0</span>;<font></font>
      flag = <span class="hljs-number">1</span>;
      <span class="hljs-keyword">if</span> (PIND &amp; (<span class="hljs-number">1</span>&lt;&lt;PD3)){<font></font>
        PORTD &amp;= ~(<span class="hljs-number">1</span>&lt;&lt;PD3);<font></font>
      }<font></font>
      <span class="hljs-keyword">else</span>{<font></font>
        PORTD |=(<span class="hljs-number">1</span>&lt;&lt;PD3);<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O programa foi escrito no IDE do Arduino para o microcontrolador ATmega1280. </font><font style="vertical-align: inherit;">Na minha placa de depura√ß√£o, os 8 primeiros canais s√£o roteados para as necessidades internas da placa, ent√£o o canal ADC8 √© usado. </font><font style="vertical-align: inherit;">√â poss√≠vel usar este esbo√ßo para uma placa com ATmega168, no entanto, voc√™ deve selecionar o canal correto. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por dentro das interrup√ß√µes, giramos alguns pinos de servi√ßo para ver visualmente a frequ√™ncia de digitaliza√ß√£o em funcionamento. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algumas palavras sobre a origem do coeficiente 102. Na primeira partida, um sinal de v√°rias amplitudes foi fornecido pelo gerador, uma indica√ß√£o do valor efetivo da tens√£o foi lida no oscilosc√≥pio e o valor calculado em unidades absolutas do ADC foi retirado do console.</font></font><br>
<table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Umax, V</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Urms, In</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contado</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.08</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">212</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,5</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,73</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">176</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,38</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">141</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,5</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,03</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">106</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 1</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,684</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">71</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,5</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,358</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">36.</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,25</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,179</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dezenove</font></font></td>
</tr>
</tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dividindo os valores da terceira coluna pelos valores da segunda, obtemos uma m√©dia de 102. Este ser√° o nosso coeficiente de "calibra√ß√£o". No entanto, pode-se notar que, quando a tens√£o diminui, a precis√£o cai acentuadamente. Isto √© devido √† baixa sensibilidade do nosso ADC. De fato, 10 descargas para c√°lculos precisos s√£o desastrosamente pequenas e, se for poss√≠vel medir a tens√£o no soquete dessa maneira, colocar um ADC de 10 bits para medir a corrente consumida pela carga ser√° um crime contra a metrologia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste ponto, vamos parar. Na pr√≥xima parte, consideraremos as outras tr√™s perguntas desta s√©rie e prosseguiremos suavemente para a cria√ß√£o do pr√≥prio dispositivo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O firmware apresentado, bem como outro firmware para esta s√©rie (como estou gravando v√≠deos mais rapidamente do que preparando artigos), voc√™ encontrar√° no reposit√≥rio no GitHub: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/radiolok/arduino_rms_count</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Quanto ao desenvolvimento do medidor el√©trico, a refer√™ncia do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TI SimpleLink WiFi CC3200</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ser√° tomada como base </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">SmartPlug</font></a><font style="vertical-align: inherit;"> , cujas not√≠cias </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">chegaram</font></a><font style="vertical-align: inherit;"> no outro dia. </font><font style="vertical-align: inherit;">Eu realmente gosto do microcontrolador CC3200, por isso vamos desenvolver um booster para o lunchpad existente e perceber todos os recursos nos quais estamos interessados. </font><font style="vertical-align: inherit;">N√£o se esque√ßa de faz√™-lo funcionar t√£o bem em outros microcontroladores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Coment√°rios s√£o convidados  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">progchip666</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, para coment√°rios e acr√©scimos ao material, bem como  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smart_alex</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como anteriormente interessado em medir corrente e tens√£o usando o Arduino.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt384597/">https://habr.com/ru/post/pt384597/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt384583/index.html">F√£s de "My Little Pony" arrecadam dinheiro para um jogo de luta baseado na s√©rie animada (mas com novos personagens)</a></li>
<li><a href="../pt384585/index.html">Uma hist√≥ria detalhada do fracasso da Volkswagen preocupa-se com uma falsifica√ß√£o de testes de compatibilidade ambiental</a></li>
<li><a href="../pt384589/index.html">Conversando com uma l√¢mpada - Revis√£o do cartucho inteligente VOCCA</a></li>
<li><a href="../pt384593/index.html">Eclipse total do Super Moon 28 de setembro</a></li>
<li><a href="../pt384595/index.html">Risco de radia√ß√£o: reatores de fiss√£o versus reatores de fus√£o</a></li>
<li><a href="../pt384599/index.html">Por que trocar l√¢mpadas para LED</a></li>
<li><a href="../pt384603/index.html">Lima review: servi√ßo ilimitado de nuvem pessoal</a></li>
<li><a href="../pt384605/index.html">Tornando um microondas convencional mais inteligente com o IFTTT e o OpenHAB</a></li>
<li><a href="../pt384607/index.html">Qual √© a forma da internet?</a></li>
<li><a href="../pt384611/index.html">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∫–æ—Å–º–æ—Å–∞ –∑–∞ –Ω–µ–¥–µ–ª—é (21.09-27.09)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>