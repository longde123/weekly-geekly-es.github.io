<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëàüèø üßõüèª üåª Verificando um projeto CDK com o IntelliJ IDEA Static Analyzer üïé ü•ö üôÜüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Decidi testar o analisador de c√≥digo Java est√°tico IntelliJ IDEA e, com ele, testei o projeto The Chemistry Development Kit . Aqui vou dar alguns erro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Verificando um projeto CDK com o IntelliJ IDEA Static Analyzer</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/JetBrains/blog/436278/"><p>  Decidi testar o analisador de c√≥digo Java est√°tico IntelliJ IDEA e, com ele, testei o projeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">The Chemistry Development Kit</a> .  Aqui vou dar alguns erros que encontrei.  Eu acho que alguns deles s√£o t√≠picos para programas Java como um todo, para que possam ser interessantes. </p><br><p>  O Chemistry Development Kit √© uma biblioteca Java de c√≥digo aberto para resolver os problemas de quimioinform√°tica e bioinform√°tica.  Quando eu estava envolvido em bioinform√°tica, n√≥s o usamos ativamente.  O projeto est√° em desenvolvimento h√° mais de 20 anos, possui dezenas de autores e a qualidade do c√≥digo √© muito desigual.  No entanto, existem testes de unidade no projeto, e a integra√ß√£o com o analisador de cobertura <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JaCoCo</a> √© prescrita em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pom.xml</a> .  Al√©m disso, plugins para tr√™s analisadores est√°ticos s√£o configurados l√°: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">FindBugs</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PMD</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Checkstyle</a> .  √â ainda mais interessante verificar quais avisos permanecem. </p><a name="habracut"></a><br><p>  O analisador de c√≥digo Java est√°tico incorporado no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">IntelliJ IDEA</a> n√£o √© inferior √†s ferramentas especializadas de an√°lise est√°tica, mas, de certa forma, as ultrapassa.  Al√©m disso, praticamente todos os recursos de an√°lise est√°tica est√£o dispon√≠veis no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Community Edition</a> , um IDE de c√≥digo aberto gratuito.  Em particular, a vers√£o gratuita produz todos os avisos descritos neste artigo. </p><br><p>  Por padr√£o, a an√°lise est√°tica √© realizada constantemente no modo de edi√ß√£o de c√≥digo; portanto, se voc√™ escrever um c√≥digo no IntelliJ IDEA, corrigir√° muitos erros literalmente em segundos ap√≥s a execu√ß√£o, mesmo antes de executar os testes.  Voc√™ pode verificar o projeto inteiro ou sua parte no modo de lote usando o <em>bot√£o Analisar |</em>  <em>Inspecione o c√≥digo</em> ou execute uma inspe√ß√£o separada usando o <em>Analyze |</em>  <em>Execute a inspe√ß√£o por nome</em> .  Nesse caso, algumas inspe√ß√µes ficam dispon√≠veis que, devido √† complexidade, n√£o funcionam no modo de edi√ß√£o.  No entanto, existem poucas inspe√ß√µes. </p><br><p> Muitas inspe√ß√µes do IntelliJ IDEA n√£o relatam bugs, mas c√≥digos imprecisos ou oferecem uma alternativa mais idiom√°tica, bonita ou r√°pida.  Isso √© √∫til quando voc√™ est√° trabalhando constantemente no IDE.  No entanto, no meu caso, √© melhor come√ßar com aquelas mensagens que alertam sobre erros reais.  Basicamente, a categoria <em>Java</em> √© interessante <em>|</em>  <em>Bugs prov√°veis</em> , embora existam outras categorias que vale a pena explorar, como <em>Problemas num√©ricos</em> . </p><br><p>  Vou falar apenas sobre alguns avisos interessantes. </p><br><h3 id="1-unarnyy-plyus">  1. Un√°rio mais </h3><br><p> J√° havia 66 vantagens un√°rias no projeto.  Para escrever <code>+1</code> vez de apenas <code>1</code> √†s vezes eu quero ser bonita.  No entanto, em alguns casos, o plus un√°rio sai se, em vez de <code>+=</code> <a href="">escreverem</a> <code>=+</code> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> totalCharge1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (atoms1.hasNext()) { totalCharge1 = +((IAtom) atoms1.next()).getFormalCharge(); } Iterator&lt;IAtom&gt; atoms2 = products.atoms().iterator(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> totalCharge2 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (atoms2.hasNext()) { totalCharge2 = +((IAtom) atoms2.next()).getFormalCharge(); }</code> </pre> <br><p>  Um erro de digita√ß√£o √≥bvio que ignora todas as itera√ß√µes do loop, exceto a √∫ltima.  Pode parecer estranho que n√£o esteja escrito ‚Äúespa√ßo igual a mais espa√ßo‚Äù, mas ‚Äúespa√ßo igual a espa√ßo mais‚Äù.  No entanto, a estranheza desaparece se voc√™ se <a href="">aprofundar na hist√≥ria</a> .  Inicialmente, "igual" e "mais" estavam realmente l√°, mas em 2008 eles passaram por um formatador autom√°tico, e o c√≥digo mudou.  A prop√≥sito, aqui est√° a moral para os analisadores est√°ticos: √© razo√°vel emitir avisos com base em formata√ß√£o estranha, mas se o c√≥digo for formatado automaticamente, os avisos desaparecer√£o e os erros permanecer√£o. </p><br><h3 id="2-celochislennoe-delenie-s-privedeniem-k-drobnomu">  2. Divis√£o inteira levando a fracion√°rio </h3><br><p>  Um erro bastante irritante, mas os analisadores est√°ticos o acham bem.  Aqui est√° <a href="">um exemplo</a> : </p><br><pre> <code class="java hljs">angle = <span class="hljs-number"><span class="hljs-number">1</span></span> / <span class="hljs-number"><span class="hljs-number">180</span></span> * Math.PI;</code> </pre> <br><p>  Infelizmente, o √¢ngulo acabou n√£o sendo um grau, mas zero.  <a href="">Erro semelhante</a> : </p><br><pre> <code class="java hljs">Integer c1 = features1.get(key); Integer c2 = features2.get(key); c1 = c1 == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ? <span class="hljs-number"><span class="hljs-number">0</span></span> : c1; c2 = c2 == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ? <span class="hljs-number"><span class="hljs-number">0</span></span> : c2; sum += <span class="hljs-number"><span class="hljs-number">1.0</span></span> - Math.abs(c1 - c2) / (c1 + c2); <span class="hljs-comment"><span class="hljs-comment">// integer division in floating-point context</span></span></code> </pre> <br><p>  Parece que os n√∫meros <code>c1</code> e <code>c2</code> n√£o <code>c2</code> negativos, o que significa que o m√≥dulo de diferen√ßa nunca exceder√° a soma.  Portanto, o resultado ser√° 0 se os dois n√∫meros forem diferentes de zero ou 1 se um deles for 0. </p><br><h3 id="3-vyzov-classgetclass">  3. Chame Class.getClass () </h3><br><p>  √Äs vezes, as pessoas chamam o m√©todo <code>getClass()</code> em um objeto do tipo <code>Class</code> .  O resultado √© novamente um objeto do tipo <code>Class</code> com o valor constante <code>Class.class</code> .  Isso geralmente √© um erro: <code>getClass()</code> n√£o precisa ser chamado.  Por exemplo, <a href="">aqui</a> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;T extends ICDKObject&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ofClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Class&lt;T&gt; intf, Object... objects)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!intf.isInterface()) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"expected interface, got "</span></span> + intf.getClass()); ...</code> </pre> <br><p>  Se ocorrer uma exce√ß√£o, o relat√≥rio ser√° completamente in√∫til.  A prop√≥sito, os erros no procedimento de tratamento de erros s√£o frequentemente encontrados pela an√°lise est√°tica em projetos antigos: como regra, os procedimentos de tratamento de erros s√£o testados de maneira pior. </p><br><h3 id="4-vyzov-tostring-na-massive">  4. Chame toString () em uma matriz </h3><br><p>  Este √© um cl√°ssico do g√™nero: toString () n√£o √© redefinido para matrizes e seu resultado √© bastante in√∫til.  Geralmente, isso pode ser encontrado nas <a href="">mensagens de diagn√≥stico</a> . </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] dim = {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}; ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Dim:"</span></span> + dim + <span class="hljs-string"><span class="hljs-string">" SizeX:"</span></span> + grid.length + <span class="hljs-string"><span class="hljs-string">" SizeY:"</span></span> + grid[<span class="hljs-number"><span class="hljs-number">0</span></span>].length + <span class="hljs-string"><span class="hljs-string">" SizeZ:"</span></span>...</code> </pre> <br><p>  √â dif√≠cil perceber o problema com os olhos, porque aqui <code>dim.toString()</code> impl√≠cito, mas a concatena√ß√£o de strings delega a ele.  Uma corre√ß√£o √© sugerida imediatamente - envolva em <code>Arrays.toString(dim)</code> . </p><br><h3 id="5-kollekciya-chitaetsya-no-ne-zapolnyaetsya">  5. A cole√ß√£o √© lida, mas n√£o preenchida </h3><br><p>  Isso tamb√©m √© frequentemente encontrado em uma base de c√≥digo que n√£o passa por testes constantes por um analisador est√°tico.  Aqui est√° um <a href="">exemplo simples</a> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Set&lt;IBond&gt; bondsToHydrogens = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;IBond&gt;(); <span class="hljs-comment"><span class="hljs-comment">// ... 220  ,  bondsToHydrogens   ! for (IBond bondToHydrogen : bondsToHydrogens) //     sgroup.removeBond(bondToHydrogen);</span></span></code> </pre> <br><p>  Obviamente, o preenchimento faltou.  Os analisadores est√°ticos t√™m verifica√ß√µes mais simples que indicam uma vari√°vel n√£o utilizada, mas a vari√°vel √© usada aqui, portanto, elas s√£o silenciosas.  Precisamos de uma inspe√ß√£o mais inteligente que saiba sobre cole√ß√µes. </p><br><h3 id="6-naoborot-zapolnyaem-no-ne-chitaem">  6. Pelo contr√°rio: preenchemos, mas n√£o lemos </h3><br><p>  Casos inversos tamb√©m s√£o poss√≠veis.  Aqui est√° <a href="">um exemplo com uma matriz</a> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] tmp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[trueBits.length - <span class="hljs-number"><span class="hljs-number">1</span></span>]; System.arraycopy(trueBits, <span class="hljs-number"><span class="hljs-number">0</span></span>, tmp, <span class="hljs-number"><span class="hljs-number">0</span></span>, i); System.arraycopy(trueBits, i + <span class="hljs-number"><span class="hljs-number">1</span></span>, tmp, i, trueBits.length - i - <span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> <br><p>  A inspe√ß√£o sabe que o terceiro argumento para o m√©todo arraycopy √© usado apenas para gravar a matriz e, depois disso, a matriz n√£o √© usada.  A julgar pela l√≥gica do c√≥digo, a linha <code>trueBits = tmp;</code> ignorada <code>trueBits = tmp;</code>  . </p><br><h3 id="7-sravnenie-integer-po-">  7. Compara√ß√£o de Inteiro por == </h3><br><p>  Esse √© um bug insidioso, porque pequenos valores de objetos Inteiros s√£o armazenados em cache e tudo pode funcionar bem at√© que um dia o n√∫mero exceda 127. Esse problema pode n√£o <a href="">ser evidente</a> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = <span class="hljs-number"><span class="hljs-number">0</span></span>; a &lt; cliqueSize; a++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">0</span></span>; b &lt; vecSize; b += <span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cliqueList.get(a) == compGraphNodes.get(b + <span class="hljs-number"><span class="hljs-number">2</span></span>)) { cliqueMapping.add(compGraphNodes.get(b)); cliqueMapping.add(compGraphNodes.get(b + <span class="hljs-number"><span class="hljs-number">1</span></span>)); } } }</code> </pre> <br><p>  Bem, parece que alguns objetos em algumas listas s√£o comparados, talvez esteja tudo bem.  √â preciso ter cuidado para ver que essas listas cont√™m objetos do tipo Inteiro. </p><br><h3 id="8-dublikat-v-map">  8. Duplicar no mapa </h3><br><p>  Nesta inspe√ß√£o, uma imagem vale mais que mil palavras.  <a href="">V√™ o erro</a> ? <br><img src="https://habrastorage.org/webt/xc/ha/jh/xchajhzrjrstzxdo3uod6yatxue.png"></p><br><div class="spoiler">  <b class="spoiler_title">√â melhor?</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/dr/pi/n0/drpin0xkjvcmgrkqygsldhcl5ws.png"></p></div></div><br><h3 id="9-ne-ispolzuetsya-rezultat-metoda">  9. O resultado do m√©todo n√£o √© usado. </h3><br><p>  O resultado de alguns m√©todos √© tolice n√£o usar, o que a IDEA <a href="">relata prontamente</a> : </p><br><pre> <code class="java hljs">currentChars.trim();</code> </pre> <br><p>  Provavelmente, isso significava <code>currentChars = currentChars.trim();</code>  .  Como as seq√º√™ncias de caracteres em Java s√£o imut√°veis, se o resultado n√£o for reatribu√≠do, nada acontecer√°.  Tamb√©m √© encontrado, <a href="">por exemplo</a> , <code>str.substring(2)</code> . </p><br><p>  A prop√≥sito, esta √© uma inspe√ß√£o bastante complicada.  Al√©m de uma lista pr√©-preparada de m√©todos, √†s vezes tentamos determinar automaticamente m√©todos cujo resultado vale a pena usar.  Aqui, √© necess√°ria uma an√°lise interprocedural, tanto no texto de origem quanto no c√≥digo de bytes das bibliotecas.  E tudo isso √© feito em tempo real no processo de edi√ß√£o do c√≥digo! </p><br><h3 id="10-nedostizhimye-vetki-switch">  10. Ramos de switch inacess√≠veis </h3><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// if character is out of scope don't if (c &gt; 128) return 0; switch (c) { case '\u002d': // hyphen case '\u2012': // figure dash case '\u2013': // en-dash case '\u2014': // em-dash case '\u2212': // minus return '-'; // 002d default: return c; }</span></span></code> </pre> <br><p>  Como exclu√≠mos caracteres com um c√≥digo maior que 128, os ramos <code>\u2012-\u2212</code> inacess√≠veis.  Parece que n√£o valia a pena excluir. </p><br><h3 id="11-nedostizhimoe-uslovie">  11. Condi√ß√£o inating√≠vel </h3><br><p>  Um problema absolutamente maravilhoso na <a href="">cadeia de condi√ß√µes</a> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (oxNum == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hybrid.equals(<span class="hljs-string"><span class="hljs-string">"sp3"</span></span>)) { ... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hybrid.equals(<span class="hljs-string"><span class="hljs-string">"sp2"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">47</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (oxNum == <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; hybrid.equals(<span class="hljs-string"><span class="hljs-string">"sp3"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">47</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((oxNum == <span class="hljs-number"><span class="hljs-number">2</span></span> &amp;&amp; hybrid.equals(<span class="hljs-string"><span class="hljs-string">"sp3"</span></span>)) || (oxNum == <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; hybrid.equals(<span class="hljs-string"><span class="hljs-string">"sp2"</span></span>)) || (oxNum == <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; hybrid.equals(<span class="hljs-string"><span class="hljs-string">"sp"</span></span>))) <span class="hljs-comment"><span class="hljs-comment">//     return 48; else if ((oxNum == 3 &amp;&amp; hybrid.equals("sp3")) || (oxNum &gt;= 2 &amp;&amp; hybrid.equals("sp2")) || (oxNum &gt;= 1 &amp;&amp; hybrid.equals("sp"))) return 49;</span></span></code> </pre> <br><p>  Na l√≥gica condicional complexa, isso n√£o √© incomum: verificamos uma condi√ß√£o que n√£o pode ser verdadeira, porque seu fragmento j√° foi verificado acima.  Aqui temos um ramo separado <code>oxNum == 0</code> , caso contr√°rio, verificamos <code>oxNum == 0 &amp;&amp; hybrid.equals("sp")</code> , que, √© claro, n√£o pode ser. </p><br><h3 id="12-pishem-v-massiv-nulevoy-dliny">  12. N√≥s escrevemos para uma matriz de comprimento zero </h3><br><p>  √Äs vezes, o IntelliJ IDEA notar√° se voc√™ gravar em uma matriz <a href="">fora do seu tamanho</a> : </p><br><pre> <code class="java hljs">Point3d points[] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point3d[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-comment"><span class="hljs-comment">//    0  if (nwanted == 1) { points = new Point3d[1]; points[0] = new Point3d(aPoint); points[0].add(new Vector3d(length, 0.0, 0.0)); } else if (nwanted == 2) { //       ‚Äî   points[0] = new Point3d(aPoint); points[0].add(new Vector3d(length, 0.0, 0.0)); points[1] = new Point3d(aPoint); points[1].add(new Vector3d(-length, 0.0, 0.0)); }</span></span></code> </pre> <br><h3 id="13-proverka-dliny-posle-obrascheniya-po-indeksu">  13. Verificando o comprimento ap√≥s acessar o √≠ndice </h3><br><p>  Outro problema comum com o procedimento e novamente <a href="">durante o tratamento de erros</a> : </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setParameters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object[] params)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> CDKException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (params.length &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CDKException(<span class="hljs-string"><span class="hljs-string">"..."</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(params[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Integer)) { <span class="hljs-comment"><span class="hljs-comment">//     throw new CDKException("The parameter must be of type Integer"); } if (params.length == 0) return; //      maxIterations = (Integer) params[0]; }</span></span></code> </pre> <br><p>  No caso de uma matriz vazia, o autor do c√≥digo queria sair silenciosamente, mas, devido √† verifica√ß√£o, sairia, batendo com for√ßa em ArrayIndexOutOfBoundsException.  Obviamente, a ordem de verifica√ß√£o est√° fora de ordem. </p><br><h3 id="14-proverka-na-null-posle-obrascheniya">  14. Verifique se h√° nulo ap√≥s o acesso </h3><br><p>  E, novamente, a ordem das a√ß√µes √© violada, <a href="">desta vez com nulo</a> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!line.startsWith(<span class="hljs-string"><span class="hljs-string">"frame:"</span></span>) &amp;&amp; input.ready() &amp;&amp; line != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { line = input.readLine(); logger.debug(lineNumber++ + <span class="hljs-string"><span class="hljs-string">": "</span></span>, line); }</code> </pre> <br><p>  A IDEA escreve essa <code>line != null</code> sempre verdadeiro.  Acontece que a verifica√ß√£o √© realmente redundante, mas aqui o c√≥digo parece como se fosse nulo. </p><br><h3 id="15-dizyunkciya-vmesto-konyunkcii">  15. Disjun√ß√£o em vez de conjun√ß√£o </h3><br><p>  As pessoas frequentemente confundem os operadores l√≥gicos AND e OR.  O projeto CDK <a href="">n√£o</a> √© <a href="">exce√ß√£o</a> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rStereo != <span class="hljs-number"><span class="hljs-number">4</span></span> || pStereo != <span class="hljs-number"><span class="hljs-number">4</span></span> || rStereo != <span class="hljs-number"><span class="hljs-number">3</span></span> || pStereo != <span class="hljs-number"><span class="hljs-number">3</span></span>) { ... }</code> </pre> <br><p>  Qualquer que seja o <code>rStereo</code> e o <code>pStereo</code> , √© claro que eles n√£o podem ser iguais a quatro e tr√™s ao mesmo tempo, portanto, essa condi√ß√£o √© sempre verdadeira. </p><br><h3 id="16-i-snova-dizyunkciya-vmesto-konyunkcii">  16. Novamente disjun√ß√£o em vez de conjun√ß√£o </h3><br><p>  <a href="">Um erro semelhante</a> , mas capturado por outra mensagem: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getFirstMapping() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || !getFirstMapping().isEmpty()) { ... }</code> </pre> <br><p>  Podemos chegar ao lado direito apenas se <code>getFirstMapping()</code> retornou <code>null</code> , mas neste caso, temos a garantia de uma NullPointerException, sobre a qual a IDEA alerta.  A prop√≥sito, aqui contamos com a estabilidade dos resultados do m√©todo <code>getFirstMapping()</code> .  √Äs vezes usamos heur√≠sticas, mas a estabilidade √© diretamente analisada aqui.  Como a classe √© final, o m√©todo n√£o pode ser substitu√≠do.  <code>return firstSolution.isEmpty() ? null : firstSolution</code> IDEA verifica se seu corpo <code>return firstSolution.isEmpty() ? null : firstSolution</code>  <code>return firstSolution.isEmpty() ? null : firstSolution</code> e determina que a estabilidade se resume √† estabilidade do m√©todo <code>Map#isEmpty</code> , anteriormente anotado como est√°vel. </p><br><h3 id="17-ierarhiya-interfeysov-i-instanceof">  17. Hierarquia de interfaces e inst√¢ncia de </h3><br><p>  Ao verificar se um objeto pertence a qualquer interface, n√£o esque√ßa que as interfaces podem herdar <a href="">uma da outra</a> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (object <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> IAtomContainer) { root = convertor.cdkAtomContainerToCMLMolecule((IAtomContainer) object); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (object <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> ICrystal) { root = convertor.cdkCrystalToCMLMolecule((ICrystal) object); } ...</code> </pre> <br><p>  A interface <code>ICrystal</code> <a href="">estende</a> a interface <code>IAtomContainer</code> , de modo que o segundo ramo √© obviamente inating√≠vel: se um cristal chegar aqui, ele cair√° no primeiro ramo. </p><br><h3 id="18-obhod-pustogo-spiska">  18. Atravessando uma lista vazia </h3><br><p>  O autor deste c√≥digo provavelmente <a href="">n√£o est√° muito familiarizado</a> com a linguagem Java: </p><br><pre> <code class="java hljs">List&lt;Integer&gt; posNumList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;Integer&gt;(size); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; posNumList.size(); i++) { posNumList.add(i, <span class="hljs-number"><span class="hljs-number">0</span></span>); }</code> </pre> <br><p>  O par√¢metro size no <code>ArrayList</code> indica o tamanho inicial da matriz interna.  Isso √© usado para otimiza√ß√£o, a fim de reduzir o n√∫mero de aloca√ß√µes, se voc√™ souber com anteced√™ncia quantos itens colocar l√°.  No entanto, na verdade, os itens da lista n√£o aparecem e o m√©todo <code>size()</code> retorna 0. Portanto, o pr√≥ximo ciclo com uma tentativa de inicializar os itens da lista com zeros √© completamente in√∫til. </p><br><h3 id="19-ne-zabyvaem-inicializirovat-polya">  19. N√£o se esque√ßa de inicializar os campos </h3><br><p>  O analisador verifica de maneira especial os construtores, levando em considera√ß√£o os inicializadores de campo.  Gra√ßas a isso, foi encontrado <a href="">um erro</a> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IMatrix</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>[][] realmatrix; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>[][] imagmatrix; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rows; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> columns; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IMatrix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Matrix m)</span></span></span><span class="hljs-function"> </span></span>{ rows = m.rows; columns = m.columns; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i, j; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; rows; i++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; columns; j++) { realmatrix[i][j] = m.matrix[i][j]; <span class="hljs-comment"><span class="hljs-comment">// NullPointerException  imagmatrix[i][j] = 0d; } } }</span></span></code> </pre> <br><p>  Apesar do fato de os campos serem p√∫blicos, ningu√©m aqui poderia defini-los e inicializ√°-los na frente do construtor.  Portanto, a IDEA emite um aviso ousado de que o acesso a um elemento da matriz gera uma NullPointerException. </p><br><h3 id="20-po-dva-raza-ne-povtoryat">  20. N√£o repita duas vezes </h3><br><p>  Condi√ß√µes repetidas tamb√©m acontecem com frequ√™ncia.  Aqui est√° <a href="">um exemplo</a> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (commonAtomCount &gt; vfMCSSize &amp;&amp; commonAtomCount &gt; vfMCSSize) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre> <br><p>  Esses erros s√£o insidiosos, porque voc√™ nunca sabe, a segunda condi√ß√£o √© simplesmente sup√©rflua ou o autor queria verificar outra coisa.  Se isso n√£o for corrigido imediatamente, pode ser dif√≠cil descobrir.  Essa √© outra raz√£o pela qual a an√°lise est√°tica deve ser usada constantemente. </p><br><p>  Eu relatei alguns desses erros no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rastreador</a> de erros do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">projeto</a> .  √â curioso que, quando os autores do projeto corrigiram uma parte, eles mesmos usaram o analisador IntelliJ IDEA, encontraram outros problemas sobre os quais n√£o escrevi e tamb√©m <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">come√ßaram a corrigi-los</a> .  Eu acho que este √© um bom sinal: os autores perceberam a import√¢ncia da an√°lise est√°tica. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt436278/">https://habr.com/ru/post/pt436278/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt436266/index.html">Escalada extrema no Alibaba JDK</a></li>
<li><a href="../pt436268/index.html">Coletamos um baralho completo</a></li>
<li><a href="../pt436270/index.html">35% da audi√™ncia do Runet n√£o usa computador para a Internet.</a></li>
<li><a href="../pt436272/index.html">Programa√ß√£o Visual para Sonoff Basic</a></li>
<li><a href="../pt436276/index.html">Visualiza√ß√£o tridimensional em simuladores de material circulante com base no mecanismo OpenSceneGraph</a></li>
<li><a href="../pt436280/index.html">Implementar honeypot em roteadores Cisco</a></li>
<li><a href="../pt436282/index.html">Desafio de uma empresa estrangeira ou como eu falhei em uma entrevista</a></li>
<li><a href="../pt436284/index.html">Hackear o Amazon Echo e o Google Home para proteger a privacidade</a></li>
<li><a href="../pt436288/index.html">Como o monop√≥lio come√ßou, ou um pouco de confus√£o com o IBM PC 5150</a></li>
<li><a href="../pt436292/index.html">Controlar, modificar, excluir: os 10 principais relat√≥rios do DotNext 2018 Moscow</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>