<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😜 👎🏽 😜 Als Programmierer haben Rechenzentrumskerne geschrieben 🍆 🛣️ 🤵🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nur wenige Leute glauben, dass der moderne Data Science Stack nicht auf Python aufgebaut werden kann, aber es gibt solche Präzedenzfälle :). Der Odnok...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Als Programmierer haben Rechenzentrumskerne geschrieben</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/odnoklassniki/blog/439394/"><img src="https://habrastorage.org/getpro/habr/post_images/ff7/128/e7e/ff7128e7e376b301570865e4d2436d4e.png"><br><p>  Nur wenige Leute glauben, dass der moderne Data Science Stack nicht auf Python aufgebaut werden kann, aber es gibt solche Präzedenzfälle :).  Der Odnoklassniki-Stack wurde viele Jahre lang hauptsächlich von Programmierern entwickelt, die auf Data Science umgestiegen sind, aber dennoch in der Nähe des Produkts blieben. Daher basiert er auf den offenen Technologien des JVM-Stacks: Hadoop, Spark, Kafka, Cassandra usw.  Dies hilft uns, Zeit und Kosten für die Inbetriebnahme von Modellen zu reduzieren, führt jedoch manchmal zu Schwierigkeiten.  Bei der Vorbereitung grundlegender Lösungen für Teilnehmer des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SNA Hackathon 2019</a> mussten sie beispielsweise ihre Willenskraft komprimieren und in die Welt des dynamischen Schreibens eintauchen.  Details (und einfaches Trolling) unter dem Schnitt :) </p><a name="habracut"></a><br><h3>  Installation </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/dc2/4eb/aff/dc24ebaff7995594e4a9abdef0f65bf6.jpg"><br><p> Auf fast jeder Entwicklungsmaschine gibt es eine Art Python.  Er wurde auf meiner bereits doppelt gefunden - 2.7 und 3.4.  Nachdem ich in den Speicherfächern gestöbert hatte, erinnerte ich mich, dass ich vor drei Jahren Version 3.4 installiert hatte, nachdem die Teilnehmer beim SNA Hackathon 2016 auf epische Probleme gestoßen waren und versucht hatten, ein halbes Gigabyte-Diagramm im Speicher zu erweitern (als Ergebnis eines kleinen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Trainingsvideos</a> und eines <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">separaten Wettbewerbs</a> ), aber heute ist es so Die Wirtschaft ist moralisch bereits veraltet und muss aktualisiert werden. </p><br><p>  In der Java-Welt zeigt jedes Projekt während der Montage alles an, was es in sich integrieren möchte, und lebt damit weiter.  Theoretisch ist alles einfach und schön, aber in der Praxis wird sich herausstellen, dass beide die C-Bibliothek mit zwei verschiedenen inkompatiblen Versionen benötigen, wenn Sie Bibliothek A und Bibliothek B benötigen :).  Bei vergeblichen Versuchen, diesen Teufelskreis zu durchbrechen, packen einige Bibliotheken alle ihre Abhängigkeiten in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">sich</a> und verstecken sich vor den anderen, während sich die anderen drehen, wie sie können. </p><br><p>  Was ist damit in Python los?  Es gibt kein Projekt als solches, aber es gibt eine „Umgebung“, und innerhalb jeder Umgebung kann aus Paketen bestimmter Versionen ein unabhängiges Ökosystem gebildet werden.  Gleichzeitig gibt es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tools für Faule</a> , mit deren Hilfe die lokale Python-Umgebung nicht schwieriger zu verwalten ist als ein verteilter heterogener Cluster von Clauder oder Horton.  Aber gegenseitige Konflikte zwischen Paketversionen werden nirgendwo hingehen. Ich sah mich sofort mit der Tatsache konfrontiert, dass die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Pandas</a> 0.24-Version die private _maybe_box_datetimelike-Methode auf die öffentliche API übertrug, und plötzlich stellte sich heraus, dass viele Leute sie in ihrer vorherigen Form verwendet hatten und jetzt abfielen :) (und ja, in Java-Welt ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">die gleiche</a> ).  Aber am Ende wurde alles repariert, abgesehen von den schrecklichen Warnungen um neues Depriycheyshin, es funktionierte. </p><br><h3>  Kollaborative Basislinie </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/014/e7e/7b5/014e7e7b5ff3aa7c85a439e588e738fd.png" alt="Bild"><br><p>  Die Aufgaben beim <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SNA Hackathon 2019 sind</a> in drei Bereiche unterteilt - Empfehlungen zu Protokollen, Texten und Bildern.  Beginnen wir mit den Protokollen (Spoiler - Megapattern Cmd + C / Cmd + V mit Stackoverflow funktioniert auch mit Python).  Die Daten wurden aus einer Live-Produktion gesammelt - jedem Benutzer wurde zufällig, ohne zu wiegen, ein Feed aus seiner Umgebung angezeigt, wonach alle Zeichen zum Zeitpunkt der Show und die endgültige Reaktion im Protokoll aufgezeichnet wurden.  Das Stück Kuchen Aufgabe: Wir nehmen Zeichen, wir schieben in einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Logg</a> , Gewinn! </p><br><p>  Aber der Plan blitzte in der ersten Phase beim Lesen von Daten auf.  Theoretisch gibt es ein wunderbares <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Apache Arrow-</a> Paket, das die Arbeit mit Daten in verschiedenen Ökosystemen vereinheitlichen und insbesondere das Lesen von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">"Parkett" -Dateien</a> aus Python ohne Funken ermöglichen soll.  In der Praxis stellte sich heraus.  dass er selbst beim Lesen einfacher verschachtelter Strukturen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Probleme</a> hat und unsere schöne Hierarchie sich in einen flachen Elend verwandelt hat :(. </p><br><p>  Aber es gab positive Aspekte.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jupyter</a> war im Allgemeinen erfreut, es ist fast so bequem, wenn auch nicht so hübsch wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zeppelin</a> .  Es gibt sogar einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Felskern</a> !  Nun, die Geschwindigkeit der logistischen Regression für ein kleines Datenelement im Speicher ist erfreulich - es erreicht nicht die Leistung der verteilten Option, lernt jedoch sofort anhand von vier Zeichen und ein paar hunderttausend Beispielen. </p><br><p>  Dann wurde jedoch die Begeisterung hart getroffen: Wenn die erforderliche Datentransformation (Gruppieren nach Schlüssel und Zusammenstellen zu einer Liste) nicht in der Standardliste enthalten ist und angewendet wird oder eine Karte angezeigt wird, sinkt die Geschwindigkeit um Größenordnungen.  Infolgedessen lesen 80% der Basiszeit nicht Daten, Verknüpfungen, Modelltraining und -sortierung, sondern die Erstellung banaler Listen. </p><br><p>  Übrigens, gerade wegen dieser Funktion bin ich immer wieder überrascht von pySpark-Benutzern - schließlich ist fast die gesamte Standardfunktionalität in Form von Spark SQL verfügbar, das in Python und Rock gleich ist, und nach dem ersten pythonähnlichen Yudf-In mit etwas Persönlichem Zehntausendstel Der Cluster verwandelt sich in einen Kürbis ... </p><br><p>  Aber am Ende waren alle Hindernisse überwunden und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">neun</a> Punkte reichten für eine Punktzahl von 0,65! </p><br><h3>  Textgrundlinie </h3><br><img src="https://habrastorage.org/webt/f2/tq/ei/f2tqei-pbxqoaan8z1jhmyesija.png"><br><p>  Nun ist unsere Aufgabe komplizierter - wenn das Logreg in Hunderten von Implementierungen für alle Plattformen zu finden ist, gibt es eine größere Auswahl an Tools für die Arbeit mit Texten unter Python.  Glücklicherweise werden die Texte bereits nicht nur in Rohform gesendet, sondern auch von unserem regulären Vorverarbeitungssystem auf Basis von Spark und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Lucene verarbeitet</a> .  Daher können Sie sofort die Liste der Token übernehmen und müssen sich keine Gedanken über Tokenisierung / Lematisierung / Stemming machen. </p><br><p>  Für einige Zeit bezweifelte ich, was ich nehmen sollte: inländisches <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">BigARTM</a> oder importiertes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Gensim</a> .  Infolgedessen habe ich mich für das zweite entschieden und das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">doc2vec-Tutorial</a> kopiert :).  Ich hoffe, dass Kollegen aus dem BigARTM-Team die Chance nutzen und beim Wettbewerb die Vorteile ihrer Bibliothek zeigen. </p><br><p>  Wir haben wieder einen einfachen Plan: Wir nehmen alle Texte aus dem Test, trainieren das Doc2Vec-Modell, schließen es dann im Zug ab und lernen das Logreg über seine Ergebnisse (Stapeln ist unser Alles!).  Aber wie immer begannen die Probleme sofort.  Trotz der relativ bescheidenen Menge an Texten im Trainingssatz (nur eineinhalb Gigabyte) hat der Python beim Versuch, sie in die Pandas zu ziehen, 20 (20 Karl!) Gigabyte Speicherplatz verbraucht, wurde ausgetauscht und kehrte nicht zurück.  Ich musste teilweise einen Elefanten essen. </p><br><p>  Beim Lesen geben wir immer an, welche Spalten vom Boden abgehoben werden sollen, sodass wir den Rohtext im Speicher nicht lesen können.  Dies spart die Hälfte der Nutzung, die Dokumente des Testsatzes werden problemlos zum Training in den Speicher geladen.  Mit einem Trainingssatz reicht ein solcher Trick nicht aus, daher laden wir zu einem Zeitpunkt nicht mehr als eine "Parkett" -Datei hoch.  Außerdem belassen wir in der heruntergeladenen Datei nur die ID der Tage, die wir für das Training verwenden möchten, und schließen sie bereits daraus ab. </p><br><p>  Darüber hinaus funktioniert das Anmelden genauso schnell, und am Ende erhalten wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">14 Absätze</a> und eine Punktzahl von 0,54 :) </p><br><h3>  Bildgrundlinie </h3><br><p><img src="https://habrastorage.org/webt/7_/6s/aw/7_6sawssmwohrrk1spxk9_zuqy8.jpeg"></p><br><p>  Was könnte beliebter sein als Deep Learning?  Nur Katzen!  Aus diesem Grund haben wir für das Basisbild einen genial einfachen Plan erstellt: Führen Sie einen Katzendetektor für die Bilder aus dem Test-Set aus und ordnen Sie den Inhalt nach der Punktzahl :) </p><br><p>  Und wieder gibt es eine große Auswahl.  Klassifizierung oder Erkennung?  pyTorch oder Tensorflow?  Das Hauptkriterium ist die einfache Implementierung durch Copy-Paste-Methode.  Und der Gewinner ist ... <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">YOLOv3 auf MXNet</a> :).  Die Prägnanz ihrer Demo faszinierte auf den ersten Blick, aber dann begannen wie üblich Probleme. </p><br><p>  Womit beginnt die Arbeit mit Big Data normalerweise?  Mit Leistungsschätzungen und der notwendigen Maschinenzeit!  Ich wollte die Grundlinie so autonom wie möglich gestalten, deshalb haben sie ihr beigebracht, direkt mit der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">TAR-Datei zu arbeiten,</a> und schnell erkannt, dass es bei einer Geschwindigkeit von 200 Fotos pro Sekunde von TAR zu TMPFS ungefähr eine halbe Stunde dauern würde, um 352.758 Bilder zu verarbeiten.  Fügen Sie das Laden und Vorverarbeiten von Fotos hinzu - 100 pro Sekunde, ungefähr eine Stunde für alles, Normen.  Fügen Sie die Berechnung des neuronalen Netzwerks hinzu - 20 Fotos pro Sekunde, 5 Stunden, na ja ... ok. Fügen Sie die Ergebnisextraktion hinzu - 1 Foto pro Sekunde, Woche, WTF? </p><br><p>  Nach ein paar Stunden Tanzen mit Tamburinen kommt das Verständnis, dass das NDArray, das wir beobachten, niemals numpy ist, und die interne Struktur von MXNet, die alle Berechnungen träge durchführt.  Bingo!  Was tun?  Jeder unerfahrene Diplerner weiß, dass es nur um die Größe der Charge geht!  Wenn MXNet die Punktzahl träge berechnet, wenn wir sie zuerst für ein paar Dutzend Fotos anfordern und dann mit dem Extrahieren beginnen, wird die Verarbeitung der Fotos möglicherweise stapelweise durchgeführt?  Und ja, nachdem ich die Stapelverarbeitung mit einer Geschwindigkeit von 10 Fotos pro Sekunde hinzugefügt hatte, gelang es mir, alle Katzen zu finden :). </p><br><p>  Dann wenden wir die bekannte Technik an und in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">10 Absätzen erhalten</a> wir die Punktzahl 0,504 :). </p><br><h3>  Schlussfolgerungen </h3><br><img src="https://habrastorage.org/webt/aq/yf/0n/aqyf0navjrowlvcgvn0k3a7hcne.jpeg"><br><p>  Als ein weiser Sensei gefragt wurde: "Wer wird gewinnen, Aikido-Meister oder Karate?", Antwortete er: "Meister wird gewinnen."  Wir wurden durch dieses Experiment zu ungefähr den gleichen Schlussfolgerungen geführt: Es gibt keine und kann nicht für alle Gelegenheiten eine ideale Sprache sein.  Mit Python können Sie schnell eine Lösung aus vorgefertigten Blöcken zusammenstellen. Der Versuch, sich mit ausreichend großen Datenmengen von diesen zu entfernen, ist jedoch sehr schmerzhaft.  In Java und Scala finden Sie auch viele vorgefertigte Tools, mit denen Sie problemlos Ihre eigenen Ideen umsetzen können. Die Sprachen selbst stellen jedoch höhere Anforderungen an die Qualität des Codes. </p><br><p>  Und natürlich viel Glück an alle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SNA Hackathon 2019</a> Mitglieder! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de439394/">https://habr.com/ru/post/de439394/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de439382/index.html">Mit Ansible, Terraform, Docker, Consul, Nomad in den Wolken (Alexey Vakhov, Uchi.ru)</a></li>
<li><a href="../de439384/index.html">Metropolis-Modellierung</a></li>
<li><a href="../de439388/index.html">Roboter im Journalismus oder Verwendung künstlicher Intelligenz zum Erstellen von Inhalten</a></li>
<li><a href="../de439390/index.html">Die besten Innovationen sozialer Netzwerke im Jahr 2018</a></li>
<li><a href="../de439392/index.html">Die Meisterschaftssaison 2019 ist eröffnet! Das SNA Hackathon Ala ML Boot Camp 8 startet</a></li>
<li><a href="../de439396/index.html">Setzen Sie das UniFi Controller-Passwort zurück</a></li>
<li><a href="../de439402/index.html">JavaScript: Das große Ganze gut warum</a></li>
<li><a href="../de439404/index.html">Eine kurze Geschichte des elektronischen öffentlichen Beschaffungswesens in Russland</a></li>
<li><a href="../de439408/index.html">Pseudo Lens Flare</a></li>
<li><a href="../de439410/index.html">Jeff Hawkins ist endlich bereit, seine Gehirnforschung zu erklären</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>